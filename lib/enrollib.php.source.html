<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /lib/enrollib.php source</title>
    <link rel="stylesheet" href="../sample.css" type="text/css">
    <link rel="stylesheet" href="../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../';
subdir='lib';
filename='enrollib.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/lib/</a> -> <a href="enrollib.php.html">enrollib.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="enrollib.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="enrollib.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">//</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">//</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">//</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l16"><span class="linenum">  16</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l17"><span class="linenum">  17</span></a>  
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment">/**</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> * This library includes the basic parts of enrol api.</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * It is available on each page.</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> *</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @package    core</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @subpackage enrol</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> * @copyright  2010 Petr Skoda {@link http://skodak.org}</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment"> */</span>
<a name="l27"><span class="linenum">  27</span></a>  
<a name="l28"><span class="linenum">  28</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l29"><span class="linenum">  29</span></a>  
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment">/** Course enrol instance enabled. (used in enrol-&gt;status) */</span>
<a name="l31"><span class="linenum">  31</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('ENROL_INSTANCE_ENABLED')" href="../_constants/ENROL_INSTANCE_ENABLED.html" onMouseOver="constPopup(event,'ENROL_INSTANCE_ENABLED')">ENROL_INSTANCE_ENABLED</a>', 0);
<a name="l32"><span class="linenum">  32</span></a>  
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment">/** Course enrol instance disabled, user may enter course if other enrol instance enabled. (used in enrol-&gt;status)*/</span>
<a name="l34"><span class="linenum">  34</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('ENROL_INSTANCE_DISABLED')" href="../_constants/ENROL_INSTANCE_DISABLED.html" onMouseOver="constPopup(event,'ENROL_INSTANCE_DISABLED')">ENROL_INSTANCE_DISABLED</a>', 1);
<a name="l35"><span class="linenum">  35</span></a>  
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment">/** User is active participant (used in user_enrolments-&gt;status)*/</span>
<a name="l37"><span class="linenum">  37</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('ENROL_USER_ACTIVE')" href="../_constants/ENROL_USER_ACTIVE.html" onMouseOver="constPopup(event,'ENROL_USER_ACTIVE')">ENROL_USER_ACTIVE</a>', 0);
<a name="l38"><span class="linenum">  38</span></a>  
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment">/** User participation in course is suspended (used in user_enrolments-&gt;status) */</span>
<a name="l40"><span class="linenum">  40</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('ENROL_USER_SUSPENDED')" href="../_constants/ENROL_USER_SUSPENDED.html" onMouseOver="constPopup(event,'ENROL_USER_SUSPENDED')">ENROL_USER_SUSPENDED</a>', 1);
<a name="l41"><span class="linenum">  41</span></a>  
<a name="l42"><span class="linenum">  42</span></a>  <span class="comment">/** @deprecated - enrol caching was reworked, use ENROL_MAX_TIMESTAMP instead */</span>
<a name="l43"><span class="linenum">  43</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('ENROL_REQUIRE_LOGIN_CACHE_PERIOD')" href="../_constants/ENROL_REQUIRE_LOGIN_CACHE_PERIOD.html" onMouseOver="constPopup(event,'ENROL_REQUIRE_LOGIN_CACHE_PERIOD')">ENROL_REQUIRE_LOGIN_CACHE_PERIOD</a>', 1800);
<a name="l44"><span class="linenum">  44</span></a>  
<a name="l45"><span class="linenum">  45</span></a>  <span class="comment">/** The timestamp indicating forever */</span>
<a name="l46"><span class="linenum">  46</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('ENROL_MAX_TIMESTAMP')" href="../_constants/ENROL_MAX_TIMESTAMP.html" onMouseOver="constPopup(event,'ENROL_MAX_TIMESTAMP')">ENROL_MAX_TIMESTAMP</a>', 2147483647);
<a name="l47"><span class="linenum">  47</span></a>  
<a name="l48"><span class="linenum">  48</span></a>  <span class="comment">/** When user disappears from external source, the enrolment is completely removed */</span>
<a name="l49"><span class="linenum">  49</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('ENROL_EXT_REMOVED_UNENROL')" href="../_constants/ENROL_EXT_REMOVED_UNENROL.html" onMouseOver="constPopup(event,'ENROL_EXT_REMOVED_UNENROL')">ENROL_EXT_REMOVED_UNENROL</a>', 0);
<a name="l50"><span class="linenum">  50</span></a>  
<a name="l51"><span class="linenum">  51</span></a>  <span class="comment">/** When user disappears from external source, the enrolment is kept as is - one way sync */</span>
<a name="l52"><span class="linenum">  52</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('ENROL_EXT_REMOVED_KEEP')" href="../_constants/ENROL_EXT_REMOVED_KEEP.html" onMouseOver="constPopup(event,'ENROL_EXT_REMOVED_KEEP')">ENROL_EXT_REMOVED_KEEP</a>', 1);
<a name="l53"><span class="linenum">  53</span></a>  
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment">/** @deprecated since 2.4 not used any more, migrate plugin to new restore methods */</span>
<a name="l55"><span class="linenum">  55</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('ENROL_RESTORE_TYPE')" href="../_constants/ENROL_RESTORE_TYPE.html" onMouseOver="constPopup(event,'ENROL_RESTORE_TYPE')">ENROL_RESTORE_TYPE</a>', 'enrolrestore');
<a name="l56"><span class="linenum">  56</span></a>  
<a name="l57"><span class="linenum">  57</span></a>  <span class="comment">/**</span>
<a name="l58"><span class="linenum">  58</span></a>  <span class="comment"> * When user disappears from external source, user enrolment is suspended, roles are kept as is.</span>
<a name="l59"><span class="linenum">  59</span></a>  <span class="comment"> * In some cases user needs a role with some capability to be visible in UI - suc has in gradebook,</span>
<a name="l60"><span class="linenum">  60</span></a>  <span class="comment"> * assignments, etc.</span>
<a name="l61"><span class="linenum">  61</span></a>  <span class="comment"> */</span>
<a name="l62"><span class="linenum">  62</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('ENROL_EXT_REMOVED_SUSPEND')" href="../_constants/ENROL_EXT_REMOVED_SUSPEND.html" onMouseOver="constPopup(event,'ENROL_EXT_REMOVED_SUSPEND')">ENROL_EXT_REMOVED_SUSPEND</a>', 2);
<a name="l63"><span class="linenum">  63</span></a>  
<a name="l64"><span class="linenum">  64</span></a>  <span class="comment">/**</span>
<a name="l65"><span class="linenum">  65</span></a>  <span class="comment"> * When user disappears from external source, the enrolment is suspended and roles assigned</span>
<a name="l66"><span class="linenum">  66</span></a>  <span class="comment"> * by enrol instance are removed. Please note that user may &quot;disappear&quot; from gradebook and other areas.</span>
<a name="l67"><span class="linenum">  67</span></a>  <span class="comment"> * */</span>
<a name="l68"><span class="linenum">  68</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('ENROL_EXT_REMOVED_SUSPENDNOROLES')" href="../_constants/ENROL_EXT_REMOVED_SUSPENDNOROLES.html" onMouseOver="constPopup(event,'ENROL_EXT_REMOVED_SUSPENDNOROLES')">ENROL_EXT_REMOVED_SUSPENDNOROLES</a>', 3);
<a name="l69"><span class="linenum">  69</span></a>  
<a name="l70"><span class="linenum">  70</span></a>  <span class="comment">/**</span>
<a name="l71"><span class="linenum">  71</span></a>  <span class="comment"> * Returns instances of enrol plugins</span>
<a name="l72"><span class="linenum">  72</span></a>  <span class="comment"> * @param bool $enabled return enabled only</span>
<a name="l73"><span class="linenum">  73</span></a>  <span class="comment"> * @return array of enrol plugins name=&gt;instance</span>
<a name="l74"><span class="linenum">  74</span></a>  <span class="comment"> */</span>
<a name="l75"><span class="linenum">  75</span></a>  function <a class="function" onClick="logFunction('enrol_get_plugins')" href="../_functions/enrol_get_plugins.html" onMouseOver="funcPopup(event,'enrol_get_plugins')">enrol_get_plugins</a>(<a class="var it2082" onMouseOver="hilite(2082)" onMouseOut="lolite()" onClick="logVariable('enabled')" href="../_variables/enabled.html">$enabled</a>) {
<a name="l76"><span class="linenum">  76</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l77"><span class="linenum">  77</span></a>  
<a name="l78"><span class="linenum">  78</span></a>      <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a> = array();
<a name="l79"><span class="linenum">  79</span></a>  
<a name="l80"><span class="linenum">  80</span></a>      if (<a class="var it2082" onMouseOver="hilite(2082)" onMouseOut="lolite()" onClick="logVariable('enabled')" href="../_variables/enabled.html">$enabled</a>) {
<a name="l81"><span class="linenum">  81</span></a>  <span class="comment">        // sorted by enabled plugin order</span>
<a name="l82"><span class="linenum">  82</span></a>          <a class="var it2082" onMouseOver="hilite(2082)" onMouseOut="lolite()" onClick="logVariable('enabled')" href="../_variables/enabled.html">$enabled</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enrol_plugins_enabled')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/enrol_plugins_enabled.html">enrol_plugins_enabled</a>);
<a name="l83"><span class="linenum">  83</span></a>          <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a> = array();
<a name="l84"><span class="linenum">  84</span></a>          foreach (<a class="var it2082" onMouseOver="hilite(2082)" onMouseOut="lolite()" onClick="logVariable('enabled')" href="../_variables/enabled.html">$enabled</a> as <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>) {
<a name="l85"><span class="linenum">  85</span></a>              <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>[<a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>] = &quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>/enrol/<a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>&quot;;
<a name="l86"><span class="linenum">  86</span></a>          }
<a name="l87"><span class="linenum">  87</span></a>      } else {
<a name="l88"><span class="linenum">  88</span></a>  <span class="comment">        // sorted alphabetically</span>
<a name="l89"><span class="linenum">  89</span></a>          <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a> = <a class="class" onClick="logClass('core_component')" href="../_classes/core_component.html" onMouseOver="classPopup(event,'core_component')">core_component</a>::<a class="function" onClick="logFunction('get_plugin_list')" href="../_functions/get_plugin_list.html" onMouseOver="funcPopup(event,'get_plugin_list')">get_plugin_list</a>('enrol');
<a name="l90"><span class="linenum">  90</span></a>          <a class="phpfunction" onClick="logFunction('ksort')" href="../_functions/ksort.html" onMouseOver="phpfuncPopup(event,'ksort')">ksort</a>(<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>);
<a name="l91"><span class="linenum">  91</span></a>      }
<a name="l92"><span class="linenum">  92</span></a>  
<a name="l93"><span class="linenum">  93</span></a>      foreach (<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a> as <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>=&gt;<a class="var it3200" onMouseOver="hilite(3200)" onMouseOut="lolite()" onClick="logVariable('location')" href="../_variables/location.html">$location</a>) {
<a name="l94"><span class="linenum">  94</span></a>          <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('class')" href="../_variables/class.html">$class</a> = &quot;enrol_{<a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>}_plugin&quot;;
<a name="l95"><span class="linenum">  95</span></a>          if (!<a class="phpfunction" onClick="logFunction('class_exists')" href="../_functions/class_exists.html" onMouseOver="phpfuncPopup(event,'class_exists')">class_exists</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('class')" href="../_variables/class.html">$class</a>)) {
<a name="l96"><span class="linenum">  96</span></a>              if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(&quot;<a class="var it3200" onMouseOver="hilite(3200)" onMouseOut="lolite()" onClick="logVariable('location')" href="../_variables/location.html">$location</a>/lib.php&quot;)) {
<a name="l97"><span class="linenum">  97</span></a>                  continue;
<a name="l98"><span class="linenum">  98</span></a>              }
<a name="l99"><span class="linenum">  99</span></a>              include_once(&quot;<a class="var it3200" onMouseOver="hilite(3200)" onMouseOut="lolite()" onClick="logVariable('location')" href="../_variables/location.html">$location</a>/lib.php&quot;);
<a name="l100"><span class="linenum"> 100</span></a>              if (!<a class="phpfunction" onClick="logFunction('class_exists')" href="../_functions/class_exists.html" onMouseOver="phpfuncPopup(event,'class_exists')">class_exists</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('class')" href="../_variables/class.html">$class</a>)) {
<a name="l101"><span class="linenum"> 101</span></a>                  continue;
<a name="l102"><span class="linenum"> 102</span></a>              }
<a name="l103"><span class="linenum"> 103</span></a>          }
<a name="l104"><span class="linenum"> 104</span></a>  
<a name="l105"><span class="linenum"> 105</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>[<a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>] = new <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('class')" href="../_variables/class.html">$class</a>();
<a name="l106"><span class="linenum"> 106</span></a>      }
<a name="l107"><span class="linenum"> 107</span></a>  
<a name="l108"><span class="linenum"> 108</span></a>      return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>;
<a name="l109"><span class="linenum"> 109</span></a>  }
<a name="l110"><span class="linenum"> 110</span></a>  
<a name="l111"><span class="linenum"> 111</span></a>  <span class="comment">/**</span>
<a name="l112"><span class="linenum"> 112</span></a>  <span class="comment"> * Returns instance of enrol plugin</span>
<a name="l113"><span class="linenum"> 113</span></a>  <span class="comment"> * @param  string $name name of enrol plugin ('manual', 'guest', ...)</span>
<a name="l114"><span class="linenum"> 114</span></a>  <span class="comment"> * @return enrol_plugin</span>
<a name="l115"><span class="linenum"> 115</span></a>  <span class="comment"> */</span>
<a name="l116"><span class="linenum"> 116</span></a>  function <a class="function" onClick="logFunction('enrol_get_plugin')" href="../_functions/enrol_get_plugin.html" onMouseOver="funcPopup(event,'enrol_get_plugin')">enrol_get_plugin</a>(<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>) {
<a name="l117"><span class="linenum"> 117</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l118"><span class="linenum"> 118</span></a>  
<a name="l119"><span class="linenum"> 119</span></a>      <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = <a class="function" onClick="logFunction('clean_param')" href="../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>, <a class="constant" onClick="logConstant('PARAM_PLUGIN')" href="../_constants/PARAM_PLUGIN.html" onMouseOver="constPopup(event,'PARAM_PLUGIN')">PARAM_PLUGIN</a>);
<a name="l120"><span class="linenum"> 120</span></a>  
<a name="l121"><span class="linenum"> 121</span></a>      if (empty(<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>)) {
<a name="l122"><span class="linenum"> 122</span></a>  <span class="comment">        // ignore malformed or missing plugin names completely</span>
<a name="l123"><span class="linenum"> 123</span></a>          return null;
<a name="l124"><span class="linenum"> 124</span></a>      }
<a name="l125"><span class="linenum"> 125</span></a>  
<a name="l126"><span class="linenum"> 126</span></a>      <a class="var it3200" onMouseOver="hilite(3200)" onMouseOut="lolite()" onClick="logVariable('location')" href="../_variables/location.html">$location</a> = &quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>/enrol/<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>&quot;;
<a name="l127"><span class="linenum"> 127</span></a>  
<a name="l128"><span class="linenum"> 128</span></a>      if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(&quot;<a class="var it3200" onMouseOver="hilite(3200)" onMouseOut="lolite()" onClick="logVariable('location')" href="../_variables/location.html">$location</a>/lib.php&quot;)) {
<a name="l129"><span class="linenum"> 129</span></a>          return null;
<a name="l130"><span class="linenum"> 130</span></a>      }
<a name="l131"><span class="linenum"> 131</span></a>      include_once(&quot;<a class="var it3200" onMouseOver="hilite(3200)" onMouseOut="lolite()" onClick="logVariable('location')" href="../_variables/location.html">$location</a>/lib.php&quot;);
<a name="l132"><span class="linenum"> 132</span></a>      <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('class')" href="../_variables/class.html">$class</a> = &quot;enrol_{<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>}_plugin&quot;;
<a name="l133"><span class="linenum"> 133</span></a>      if (!<a class="phpfunction" onClick="logFunction('class_exists')" href="../_functions/class_exists.html" onMouseOver="phpfuncPopup(event,'class_exists')">class_exists</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('class')" href="../_variables/class.html">$class</a>)) {
<a name="l134"><span class="linenum"> 134</span></a>          return null;
<a name="l135"><span class="linenum"> 135</span></a>      }
<a name="l136"><span class="linenum"> 136</span></a>  
<a name="l137"><span class="linenum"> 137</span></a>      return new <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('class')" href="../_variables/class.html">$class</a>();
<a name="l138"><span class="linenum"> 138</span></a>  }
<a name="l139"><span class="linenum"> 139</span></a>  
<a name="l140"><span class="linenum"> 140</span></a>  <span class="comment">/**</span>
<a name="l141"><span class="linenum"> 141</span></a>  <span class="comment"> * Returns enrolment instances in given course.</span>
<a name="l142"><span class="linenum"> 142</span></a>  <span class="comment"> * @param int $courseid</span>
<a name="l143"><span class="linenum"> 143</span></a>  <span class="comment"> * @param bool $enabled</span>
<a name="l144"><span class="linenum"> 144</span></a>  <span class="comment"> * @return array of enrol instances</span>
<a name="l145"><span class="linenum"> 145</span></a>  <span class="comment"> */</span>
<a name="l146"><span class="linenum"> 146</span></a>  function <a class="function" onClick="logFunction('enrol_get_instances')" href="../_functions/enrol_get_instances.html" onMouseOver="funcPopup(event,'enrol_get_instances')">enrol_get_instances</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>, <a class="var it2082" onMouseOver="hilite(2082)" onMouseOut="lolite()" onClick="logVariable('enabled')" href="../_variables/enabled.html">$enabled</a>) {
<a name="l147"><span class="linenum"> 147</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l148"><span class="linenum"> 148</span></a>  
<a name="l149"><span class="linenum"> 149</span></a>      if (!<a class="var it2082" onMouseOver="hilite(2082)" onMouseOut="lolite()" onClick="logVariable('enabled')" href="../_variables/enabled.html">$enabled</a>) {
<a name="l150"><span class="linenum"> 150</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('enrol', array('courseid'=&gt;<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>), 'sortorder,id');
<a name="l151"><span class="linenum"> 151</span></a>      }
<a name="l152"><span class="linenum"> 152</span></a>  
<a name="l153"><span class="linenum"> 153</span></a>      <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('enrol', array('courseid'=&gt;<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>, 'status'=&gt;<a class="constant" onClick="logConstant('ENROL_INSTANCE_ENABLED')" href="../_constants/ENROL_INSTANCE_ENABLED.html" onMouseOver="constPopup(event,'ENROL_INSTANCE_ENABLED')">ENROL_INSTANCE_ENABLED</a>), 'sortorder,id');
<a name="l154"><span class="linenum"> 154</span></a>  
<a name="l155"><span class="linenum"> 155</span></a>      <a class="var it2082" onMouseOver="hilite(2082)" onMouseOut="lolite()" onClick="logVariable('enabled')" href="../_variables/enabled.html">$enabled</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enrol_plugins_enabled')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/enrol_plugins_enabled.html">enrol_plugins_enabled</a>);
<a name="l156"><span class="linenum"> 156</span></a>      foreach (<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l157"><span class="linenum"> 157</span></a>          if (!<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>, <a class="var it2082" onMouseOver="hilite(2082)" onMouseOut="lolite()" onClick="logVariable('enabled')" href="../_variables/enabled.html">$enabled</a>)) {
<a name="l158"><span class="linenum"> 158</span></a>              unset(<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>]);
<a name="l159"><span class="linenum"> 159</span></a>              continue;
<a name="l160"><span class="linenum"> 160</span></a>          }
<a name="l161"><span class="linenum"> 161</span></a>          if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>/enrol/<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>/lib.php&quot;)) {
<a name="l162"><span class="linenum"> 162</span></a>  <span class="comment">            // broken plugin</span>
<a name="l163"><span class="linenum"> 163</span></a>              unset(<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>]);
<a name="l164"><span class="linenum"> 164</span></a>              continue;
<a name="l165"><span class="linenum"> 165</span></a>          }
<a name="l166"><span class="linenum"> 166</span></a>      }
<a name="l167"><span class="linenum"> 167</span></a>  
<a name="l168"><span class="linenum"> 168</span></a>      return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>;
<a name="l169"><span class="linenum"> 169</span></a>  }
<a name="l170"><span class="linenum"> 170</span></a>  
<a name="l171"><span class="linenum"> 171</span></a>  <span class="comment">/**</span>
<a name="l172"><span class="linenum"> 172</span></a>  <span class="comment"> * Checks if a given plugin is in the list of enabled enrolment plugins.</span>
<a name="l173"><span class="linenum"> 173</span></a>  <span class="comment"> *</span>
<a name="l174"><span class="linenum"> 174</span></a>  <span class="comment"> * @param string $enrol Enrolment plugin name</span>
<a name="l175"><span class="linenum"> 175</span></a>  <span class="comment"> * @return boolean Whether the plugin is enabled</span>
<a name="l176"><span class="linenum"> 176</span></a>  <span class="comment"> */</span>
<a name="l177"><span class="linenum"> 177</span></a>  function <a class="function" onClick="logFunction('enrol_is_enabled')" href="../_functions/enrol_is_enabled.html" onMouseOver="funcPopup(event,'enrol_is_enabled')">enrol_is_enabled</a>(<a class="var it747" onMouseOver="hilite(747)" onMouseOut="lolite()" onClick="logVariable('enrol')" href="../_variables/enrol.html">$enrol</a>) {
<a name="l178"><span class="linenum"> 178</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l179"><span class="linenum"> 179</span></a>  
<a name="l180"><span class="linenum"> 180</span></a>      if (empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enrol_plugins_enabled')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/enrol_plugins_enabled.html">enrol_plugins_enabled</a>)) {
<a name="l181"><span class="linenum"> 181</span></a>          return false;
<a name="l182"><span class="linenum"> 182</span></a>      }
<a name="l183"><span class="linenum"> 183</span></a>      return <a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it747" onMouseOver="hilite(747)" onMouseOut="lolite()" onClick="logVariable('enrol')" href="../_variables/enrol.html">$enrol</a>, <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enrol_plugins_enabled')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/enrol_plugins_enabled.html">enrol_plugins_enabled</a>));
<a name="l184"><span class="linenum"> 184</span></a>  }
<a name="l185"><span class="linenum"> 185</span></a>  
<a name="l186"><span class="linenum"> 186</span></a>  <span class="comment">/**</span>
<a name="l187"><span class="linenum"> 187</span></a>  <span class="comment"> * Check all the login enrolment information for the given user object</span>
<a name="l188"><span class="linenum"> 188</span></a>  <span class="comment"> * by querying the enrolment plugins</span>
<a name="l189"><span class="linenum"> 189</span></a>  <span class="comment"> *</span>
<a name="l190"><span class="linenum"> 190</span></a>  <span class="comment"> * This function may be very slow, use only once after log-in or login-as.</span>
<a name="l191"><span class="linenum"> 191</span></a>  <span class="comment"> *</span>
<a name="l192"><span class="linenum"> 192</span></a>  <span class="comment"> * @param stdClass $user</span>
<a name="l193"><span class="linenum"> 193</span></a>  <span class="comment"> * @return void</span>
<a name="l194"><span class="linenum"> 194</span></a>  <span class="comment"> */</span>
<a name="l195"><span class="linenum"> 195</span></a>  function <a class="function" onClick="logFunction('enrol_check_plugins')" href="../_functions/enrol_check_plugins.html" onMouseOver="funcPopup(event,'enrol_check_plugins')">enrol_check_plugins</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) {
<a name="l196"><span class="linenum"> 196</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l197"><span class="linenum"> 197</span></a>  
<a name="l198"><span class="linenum"> 198</span></a>      if (empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) or <a class="function" onClick="logFunction('isguestuser')" href="../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l199"><span class="linenum"> 199</span></a>  <span class="comment">        // shortcut - there is no enrolment work for guests and not-logged-in users</span>
<a name="l200"><span class="linenum"> 200</span></a>          return;
<a name="l201"><span class="linenum"> 201</span></a>      }
<a name="l202"><span class="linenum"> 202</span></a>  
<a name="l203"><span class="linenum"> 203</span></a>  <span class="comment">    // originally there was a broken admin test, but accidentally it was non-functional in 2.2,</span>
<a name="l204"><span class="linenum"> 204</span></a>  <span class="comment">    // which proved it was actually not necessary.</span>
<a name="l205"><span class="linenum"> 205</span></a>  
<a name="l206"><span class="linenum"> 206</span></a>      static <a class="var it9210" onMouseOver="hilite(9210)" onMouseOut="lolite()" onClick="logVariable('inprogress')" href="../_variables/inprogress.html">$inprogress</a> = array();  <span class="comment">// To prevent this function being called more than once in an invocation</span>
<a name="l207"><span class="linenum"> 207</span></a>  
<a name="l208"><span class="linenum"> 208</span></a>      if (!empty(<a class="var it9210" onMouseOver="hilite(9210)" onMouseOut="lolite()" onClick="logVariable('inprogress')" href="../_variables/inprogress.html">$inprogress</a>[<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>])) {
<a name="l209"><span class="linenum"> 209</span></a>          return;
<a name="l210"><span class="linenum"> 210</span></a>      }
<a name="l211"><span class="linenum"> 211</span></a>  
<a name="l212"><span class="linenum"> 212</span></a>      <a class="var it9210" onMouseOver="hilite(9210)" onMouseOut="lolite()" onClick="logVariable('inprogress')" href="../_variables/inprogress.html">$inprogress</a>[<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = true;  <span class="comment">// Set the flag</span>
<a name="l213"><span class="linenum"> 213</span></a>  
<a name="l214"><span class="linenum"> 214</span></a>      <a class="var it2082" onMouseOver="hilite(2082)" onMouseOut="lolite()" onClick="logVariable('enabled')" href="../_variables/enabled.html">$enabled</a> = <a class="function" onClick="logFunction('enrol_get_plugins')" href="../_functions/enrol_get_plugins.html" onMouseOver="funcPopup(event,'enrol_get_plugins')">enrol_get_plugins</a>(true);
<a name="l215"><span class="linenum"> 215</span></a>  
<a name="l216"><span class="linenum"> 216</span></a>      foreach(<a class="var it2082" onMouseOver="hilite(2082)" onMouseOut="lolite()" onClick="logVariable('enabled')" href="../_variables/enabled.html">$enabled</a> as <a class="var it747" onMouseOver="hilite(747)" onMouseOut="lolite()" onClick="logVariable('enrol')" href="../_variables/enrol.html">$enrol</a>) {
<a name="l217"><span class="linenum"> 217</span></a>          <a class="var it747" onMouseOver="hilite(747)" onMouseOut="lolite()" onClick="logVariable('enrol')" href="../_variables/enrol.html">$enrol</a>-&gt;<a class="function" onClick="logFunction('sync_user_enrolments')" href="../_functions/sync_user_enrolments.html" onMouseOver="funcPopup(event,'sync_user_enrolments')">sync_user_enrolments</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l218"><span class="linenum"> 218</span></a>      }
<a name="l219"><span class="linenum"> 219</span></a>  
<a name="l220"><span class="linenum"> 220</span></a>      unset(<a class="var it9210" onMouseOver="hilite(9210)" onMouseOut="lolite()" onClick="logVariable('inprogress')" href="../_variables/inprogress.html">$inprogress</a>[<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>]);  <span class="comment">// Unset the flag</span>
<a name="l221"><span class="linenum"> 221</span></a>  }
<a name="l222"><span class="linenum"> 222</span></a>  
<a name="l223"><span class="linenum"> 223</span></a>  <span class="comment">/**</span>
<a name="l224"><span class="linenum"> 224</span></a>  <span class="comment"> * Do these two students share any course?</span>
<a name="l225"><span class="linenum"> 225</span></a>  <span class="comment"> *</span>
<a name="l226"><span class="linenum"> 226</span></a>  <span class="comment"> * The courses has to be visible and enrolments has to be active,</span>
<a name="l227"><span class="linenum"> 227</span></a>  <span class="comment"> * timestart and timeend restrictions are ignored.</span>
<a name="l228"><span class="linenum"> 228</span></a>  <span class="comment"> *</span>
<a name="l229"><span class="linenum"> 229</span></a>  <span class="comment"> * This function calls {@see enrol_get_shared_courses()} setting checkexistsonly</span>
<a name="l230"><span class="linenum"> 230</span></a>  <span class="comment"> * to true.</span>
<a name="l231"><span class="linenum"> 231</span></a>  <span class="comment"> *</span>
<a name="l232"><span class="linenum"> 232</span></a>  <span class="comment"> * @param stdClass|int $user1</span>
<a name="l233"><span class="linenum"> 233</span></a>  <span class="comment"> * @param stdClass|int $user2</span>
<a name="l234"><span class="linenum"> 234</span></a>  <span class="comment"> * @return bool</span>
<a name="l235"><span class="linenum"> 235</span></a>  <span class="comment"> */</span>
<a name="l236"><span class="linenum"> 236</span></a>  function <a class="function" onClick="logFunction('enrol_sharing_course')" href="../_functions/enrol_sharing_course.html" onMouseOver="funcPopup(event,'enrol_sharing_course')">enrol_sharing_course</a>(<a class="var it685" onMouseOver="hilite(685)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>, <a class="var it686" onMouseOver="hilite(686)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>) {
<a name="l237"><span class="linenum"> 237</span></a>      return <a class="function" onClick="logFunction('enrol_get_shared_courses')" href="../_functions/enrol_get_shared_courses.html" onMouseOver="funcPopup(event,'enrol_get_shared_courses')">enrol_get_shared_courses</a>(<a class="var it685" onMouseOver="hilite(685)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>, <a class="var it686" onMouseOver="hilite(686)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>, false, true);
<a name="l238"><span class="linenum"> 238</span></a>  }
<a name="l239"><span class="linenum"> 239</span></a>  
<a name="l240"><span class="linenum"> 240</span></a>  <span class="comment">/**</span>
<a name="l241"><span class="linenum"> 241</span></a>  <span class="comment"> * Returns any courses shared by the two users</span>
<a name="l242"><span class="linenum"> 242</span></a>  <span class="comment"> *</span>
<a name="l243"><span class="linenum"> 243</span></a>  <span class="comment"> * The courses has to be visible and enrolments has to be active,</span>
<a name="l244"><span class="linenum"> 244</span></a>  <span class="comment"> * timestart and timeend restrictions are ignored.</span>
<a name="l245"><span class="linenum"> 245</span></a>  <span class="comment"> *</span>
<a name="l246"><span class="linenum"> 246</span></a>  <span class="comment"> * @global moodle_database $DB</span>
<a name="l247"><span class="linenum"> 247</span></a>  <span class="comment"> * @param stdClass|int $user1</span>
<a name="l248"><span class="linenum"> 248</span></a>  <span class="comment"> * @param stdClass|int $user2</span>
<a name="l249"><span class="linenum"> 249</span></a>  <span class="comment"> * @param bool $preloadcontexts If set to true contexts for the returned courses</span>
<a name="l250"><span class="linenum"> 250</span></a>  <span class="comment"> *              will be preloaded.</span>
<a name="l251"><span class="linenum"> 251</span></a>  <span class="comment"> * @param bool $checkexistsonly If set to true then this function will return true</span>
<a name="l252"><span class="linenum"> 252</span></a>  <span class="comment"> *              if the users share any courses and false if not.</span>
<a name="l253"><span class="linenum"> 253</span></a>  <span class="comment"> * @return array|bool An array of courses that both users are enrolled in OR if</span>
<a name="l254"><span class="linenum"> 254</span></a>  <span class="comment"> *              $checkexistsonly set returns true if the users share any courses</span>
<a name="l255"><span class="linenum"> 255</span></a>  <span class="comment"> *              and false if not.</span>
<a name="l256"><span class="linenum"> 256</span></a>  <span class="comment"> */</span>
<a name="l257"><span class="linenum"> 257</span></a>  function <a class="function" onClick="logFunction('enrol_get_shared_courses')" href="../_functions/enrol_get_shared_courses.html" onMouseOver="funcPopup(event,'enrol_get_shared_courses')">enrol_get_shared_courses</a>(<a class="var it685" onMouseOver="hilite(685)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>, <a class="var it686" onMouseOver="hilite(686)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>, <a class="var it19837" onMouseOver="hilite(19837)" onMouseOut="lolite()" onClick="logVariable('preloadcontexts')" href="../_variables/preloadcontexts.html">$preloadcontexts</a> = false, <a class="var it19838" onMouseOver="hilite(19838)" onMouseOut="lolite()" onClick="logVariable('checkexistsonly')" href="../_variables/checkexistsonly.html">$checkexistsonly</a> = false) {
<a name="l258"><span class="linenum"> 258</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l259"><span class="linenum"> 259</span></a>  
<a name="l260"><span class="linenum"> 260</span></a>      <a class="var it685" onMouseOver="hilite(685)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a> = isset(<a class="var it685" onMouseOver="hilite(685)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>-&gt;<a onClick="logVariable('id')" class="var it42951" onMouseOver="hilite(42951)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) ? <a class="var it685" onMouseOver="hilite(685)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>-&gt;<a onClick="logVariable('id')" class="var it42951" onMouseOver="hilite(42951)" onMouseOut="lolite()" href="../_variables/id.html">id</a> : <a class="var it685" onMouseOver="hilite(685)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>;
<a name="l261"><span class="linenum"> 261</span></a>      <a class="var it686" onMouseOver="hilite(686)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a> = isset(<a class="var it686" onMouseOver="hilite(686)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>-&gt;<a onClick="logVariable('id')" class="var it42952" onMouseOver="hilite(42952)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) ? <a class="var it686" onMouseOver="hilite(686)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>-&gt;<a onClick="logVariable('id')" class="var it42952" onMouseOver="hilite(42952)" onMouseOut="lolite()" href="../_variables/id.html">id</a> : <a class="var it686" onMouseOver="hilite(686)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>;
<a name="l262"><span class="linenum"> 262</span></a>  
<a name="l263"><span class="linenum"> 263</span></a>      if (empty(<a class="var it685" onMouseOver="hilite(685)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>) or empty(<a class="var it686" onMouseOver="hilite(686)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>)) {
<a name="l264"><span class="linenum"> 264</span></a>          return false;
<a name="l265"><span class="linenum"> 265</span></a>      }
<a name="l266"><span class="linenum"> 266</span></a>  
<a name="l267"><span class="linenum"> 267</span></a>      if (!<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enrol_plugins_enabled')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/enrol_plugins_enabled.html">enrol_plugins_enabled</a>)) {
<a name="l268"><span class="linenum"> 268</span></a>          return false;
<a name="l269"><span class="linenum"> 269</span></a>      }
<a name="l270"><span class="linenum"> 270</span></a>  
<a name="l271"><span class="linenum"> 271</span></a>      <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'ee');
<a name="l272"><span class="linenum"> 272</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['enabled'] = <a class="constant" onClick="logConstant('ENROL_INSTANCE_ENABLED')" href="../_constants/ENROL_INSTANCE_ENABLED.html" onMouseOver="constPopup(event,'ENROL_INSTANCE_ENABLED')">ENROL_INSTANCE_ENABLED</a>;
<a name="l273"><span class="linenum"> 273</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['active1'] = <a class="constant" onClick="logConstant('ENROL_USER_ACTIVE')" href="../_constants/ENROL_USER_ACTIVE.html" onMouseOver="constPopup(event,'ENROL_USER_ACTIVE')">ENROL_USER_ACTIVE</a>;
<a name="l274"><span class="linenum"> 274</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['active2'] = <a class="constant" onClick="logConstant('ENROL_USER_ACTIVE')" href="../_constants/ENROL_USER_ACTIVE.html" onMouseOver="constPopup(event,'ENROL_USER_ACTIVE')">ENROL_USER_ACTIVE</a>;
<a name="l275"><span class="linenum"> 275</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['user1']   = <a class="var it685" onMouseOver="hilite(685)" onMouseOut="lolite()" onClick="logVariable('user1')" href="../_variables/user1.html">$user1</a>;
<a name="l276"><span class="linenum"> 276</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['user2']   = <a class="var it686" onMouseOver="hilite(686)" onMouseOut="lolite()" onClick="logVariable('user2')" href="../_variables/user2.html">$user2</a>;
<a name="l277"><span class="linenum"> 277</span></a>  
<a name="l278"><span class="linenum"> 278</span></a>      <a class="var it1071" onMouseOver="hilite(1071)" onMouseOut="lolite()" onClick="logVariable('ctxselect')" href="../_variables/ctxselect.html">$ctxselect</a> = '';
<a name="l279"><span class="linenum"> 279</span></a>      <a class="var it18089" onMouseOver="hilite(18089)" onMouseOut="lolite()" onClick="logVariable('ctxjoin')" href="../_variables/ctxjoin.html">$ctxjoin</a> = '';
<a name="l280"><span class="linenum"> 280</span></a>      if (<a class="var it19837" onMouseOver="hilite(19837)" onMouseOut="lolite()" onClick="logVariable('preloadcontexts')" href="../_variables/preloadcontexts.html">$preloadcontexts</a>) {
<a name="l281"><span class="linenum"> 281</span></a>          <a class="var it1071" onMouseOver="hilite(1071)" onMouseOut="lolite()" onClick="logVariable('ctxselect')" href="../_variables/ctxselect.html">$ctxselect</a> = ', ' . <a class="class" onClick="logClass('context_helper')" href="../_classes/context_helper.html" onMouseOver="classPopup(event,'context_helper')">context_helper</a>::<a class="function" onClick="logFunction('get_preload_record_columns_sql')" href="../_functions/get_preload_record_columns_sql.html" onMouseOver="funcPopup(event,'get_preload_record_columns_sql')">get_preload_record_columns_sql</a>('ctx');
<a name="l282"><span class="linenum"> 282</span></a>          <a class="var it18089" onMouseOver="hilite(18089)" onMouseOut="lolite()" onClick="logVariable('ctxjoin')" href="../_variables/ctxjoin.html">$ctxjoin</a> = &quot;LEFT JOIN {context} ctx <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (ctx.instanceid = c.id AND ctx.contextlevel = :contextlevel)&quot;;
<a name="l283"><span class="linenum"> 283</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['contextlevel'] = <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>;
<a name="l284"><span class="linenum"> 284</span></a>      }
<a name="l285"><span class="linenum"> 285</span></a>  
<a name="l286"><span class="linenum"> 286</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT c.* <a class="var it1071" onMouseOver="hilite(1071)" onMouseOut="lolite()" onClick="logVariable('ctxselect')" href="../_variables/ctxselect.html">$ctxselect</a>
<a name="l287"><span class="linenum"> 287</span></a>                FROM {course} c
<a name="l288"><span class="linenum"> 288</span></a>                <a class="function" onClick="logFunction('JOIN')" href="../_functions/join.html" onMouseOver="funcPopup(event,'join')">JOIN</a> (
<a name="l289"><span class="linenum"> 289</span></a>                  SELECT DISTINCT c.id
<a name="l290"><span class="linenum"> 290</span></a>                    FROM {enrol} e
<a name="l291"><span class="linenum"> 291</span></a>                    JOIN {user_enrolments} ue1 <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (ue1.enrolid = e.id AND ue1.status = :active1 AND ue1.userid = :user1)
<a name="l292"><span class="linenum"> 292</span></a>                    JOIN {user_enrolments} ue2 <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (ue2.enrolid = e.id AND ue2.status = :active2 AND ue2.userid = :user2)
<a name="l293"><span class="linenum"> 293</span></a>                    JOIN {course} c <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (c.id = e.courseid AND c.visible = 1)
<a name="l294"><span class="linenum"> 294</span></a>                   WHERE e.status = :enabled AND e.enrol <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>
<a name="l295"><span class="linenum"> 295</span></a>                ) ec ON ec.id = c.id
<a name="l296"><span class="linenum"> 296</span></a>                <a class="var it18089" onMouseOver="hilite(18089)" onMouseOut="lolite()" onClick="logVariable('ctxjoin')" href="../_variables/ctxjoin.html">$ctxjoin</a>&quot;;
<a name="l297"><span class="linenum"> 297</span></a>  
<a name="l298"><span class="linenum"> 298</span></a>      if (<a class="var it19838" onMouseOver="hilite(19838)" onMouseOut="lolite()" onClick="logVariable('checkexistsonly')" href="../_variables/checkexistsonly.html">$checkexistsonly</a>) {
<a name="l299"><span class="linenum"> 299</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists_sql')" href="../_functions/record_exists_sql.html" onMouseOver="funcPopup(event,'record_exists_sql')">record_exists_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l300"><span class="linenum"> 300</span></a>      } else {
<a name="l301"><span class="linenum"> 301</span></a>          <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l302"><span class="linenum"> 302</span></a>          if (<a class="var it19837" onMouseOver="hilite(19837)" onMouseOut="lolite()" onClick="logVariable('preloadcontexts')" href="../_variables/preloadcontexts.html">$preloadcontexts</a>) {
<a name="l303"><span class="linenum"> 303</span></a>              <a class="phpfunction" onClick="logFunction('array_map')" href="../_functions/array_map.html" onMouseOver="phpfuncPopup(event,'array_map')">array_map</a>('<a class="class" onClick="logClass('context_helper')" href="../_classes/context_helper.html" onMouseOver="classPopup(event,'context_helper')">context_helper</a>::preload_from_record', <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a>);
<a name="l304"><span class="linenum"> 304</span></a>          }
<a name="l305"><span class="linenum"> 305</span></a>          return <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a>;
<a name="l306"><span class="linenum"> 306</span></a>      }
<a name="l307"><span class="linenum"> 307</span></a>  }
<a name="l308"><span class="linenum"> 308</span></a>  
<a name="l309"><span class="linenum"> 309</span></a>  <span class="comment">/**</span>
<a name="l310"><span class="linenum"> 310</span></a>  <span class="comment"> * This function adds necessary enrol plugins UI into the course edit form.</span>
<a name="l311"><span class="linenum"> 311</span></a>  <span class="comment"> *</span>
<a name="l312"><span class="linenum"> 312</span></a>  <span class="comment"> * @param MoodleQuickForm $mform</span>
<a name="l313"><span class="linenum"> 313</span></a>  <span class="comment"> * @param object $data course edit form data</span>
<a name="l314"><span class="linenum"> 314</span></a>  <span class="comment"> * @param object $context context of existing course or parent category if course does not exist</span>
<a name="l315"><span class="linenum"> 315</span></a>  <span class="comment"> * @return void</span>
<a name="l316"><span class="linenum"> 316</span></a>  <span class="comment"> */</span>
<a name="l317"><span class="linenum"> 317</span></a>  function <a class="function" onClick="logFunction('enrol_course_edit_form')" href="../_functions/enrol_course_edit_form.html" onMouseOver="funcPopup(event,'enrol_course_edit_form')">enrol_course_edit_form</a>(MoodleQuickForm <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../_variables/mform.html">$mform</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l318"><span class="linenum"> 318</span></a>      <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a> = <a class="function" onClick="logFunction('enrol_get_plugins')" href="../_functions/enrol_get_plugins.html" onMouseOver="funcPopup(event,'enrol_get_plugins')">enrol_get_plugins</a>(true);
<a name="l319"><span class="linenum"> 319</span></a>      if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('id')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../_variables/id.html">id</a>)) {
<a name="l320"><span class="linenum"> 320</span></a>          <a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a> = <a class="function" onClick="logFunction('enrol_get_instances')" href="../_functions/enrol_get_instances.html" onMouseOver="funcPopup(event,'enrol_get_instances')">enrol_get_instances</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('id')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, false);
<a name="l321"><span class="linenum"> 321</span></a>          foreach (<a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a> as <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l322"><span class="linenum"> 322</span></a>              if (!isset(<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>[<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>])) {
<a name="l323"><span class="linenum"> 323</span></a>                  continue;
<a name="l324"><span class="linenum"> 324</span></a>              }
<a name="l325"><span class="linenum"> 325</span></a>              <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a> = <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>[<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>];
<a name="l326"><span class="linenum"> 326</span></a>              <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>-&gt;<a class="function" onClick="logFunction('course_edit_form')" href="../_functions/course_edit_form.html" onMouseOver="funcPopup(event,'course_edit_form')">course_edit_form</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>, <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../_variables/mform.html">$mform</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l327"><span class="linenum"> 327</span></a>          }
<a name="l328"><span class="linenum"> 328</span></a>      } else {
<a name="l329"><span class="linenum"> 329</span></a>          foreach (<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a> as <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>) {
<a name="l330"><span class="linenum"> 330</span></a>              <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>-&gt;<a class="function" onClick="logFunction('course_edit_form')" href="../_functions/course_edit_form.html" onMouseOver="funcPopup(event,'course_edit_form')">course_edit_form</a>(NULL, <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../_variables/mform.html">$mform</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l331"><span class="linenum"> 331</span></a>          }
<a name="l332"><span class="linenum"> 332</span></a>      }
<a name="l333"><span class="linenum"> 333</span></a>  }
<a name="l334"><span class="linenum"> 334</span></a>  
<a name="l335"><span class="linenum"> 335</span></a>  <span class="comment">/**</span>
<a name="l336"><span class="linenum"> 336</span></a>  <span class="comment"> * Validate course edit form data</span>
<a name="l337"><span class="linenum"> 337</span></a>  <span class="comment"> *</span>
<a name="l338"><span class="linenum"> 338</span></a>  <span class="comment"> * @param array $data raw form data</span>
<a name="l339"><span class="linenum"> 339</span></a>  <span class="comment"> * @param object $context context of existing course or parent category if course does not exist</span>
<a name="l340"><span class="linenum"> 340</span></a>  <span class="comment"> * @return array errors array</span>
<a name="l341"><span class="linenum"> 341</span></a>  <span class="comment"> */</span>
<a name="l342"><span class="linenum"> 342</span></a>  function <a class="function" onClick="logFunction('enrol_course_edit_validation')" href="../_functions/enrol_course_edit_validation.html" onMouseOver="funcPopup(event,'enrol_course_edit_validation')">enrol_course_edit_validation</a>(array <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l343"><span class="linenum"> 343</span></a>      <a class="var it224" onMouseOver="hilite(224)" onMouseOut="lolite()" onClick="logVariable('errors')" href="../_variables/errors.html">$errors</a> = array();
<a name="l344"><span class="linenum"> 344</span></a>      <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a> = <a class="function" onClick="logFunction('enrol_get_plugins')" href="../_functions/enrol_get_plugins.html" onMouseOver="funcPopup(event,'enrol_get_plugins')">enrol_get_plugins</a>(true);
<a name="l345"><span class="linenum"> 345</span></a>  
<a name="l346"><span class="linenum"> 346</span></a>      if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>['id'])) {
<a name="l347"><span class="linenum"> 347</span></a>          <a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a> = <a class="function" onClick="logFunction('enrol_get_instances')" href="../_functions/enrol_get_instances.html" onMouseOver="funcPopup(event,'enrol_get_instances')">enrol_get_instances</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>['id'], false);
<a name="l348"><span class="linenum"> 348</span></a>          foreach (<a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a> as <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l349"><span class="linenum"> 349</span></a>              if (!isset(<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>[<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>])) {
<a name="l350"><span class="linenum"> 350</span></a>                  continue;
<a name="l351"><span class="linenum"> 351</span></a>              }
<a name="l352"><span class="linenum"> 352</span></a>              <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a> = <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>[<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>];
<a name="l353"><span class="linenum"> 353</span></a>              <a class="var it224" onMouseOver="hilite(224)" onMouseOut="lolite()" onClick="logVariable('errors')" href="../_variables/errors.html">$errors</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it224" onMouseOver="hilite(224)" onMouseOut="lolite()" onClick="logVariable('errors')" href="../_variables/errors.html">$errors</a>, <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>-&gt;<a class="function" onClick="logFunction('course_edit_validation')" href="../_functions/course_edit_validation.html" onMouseOver="funcPopup(event,'course_edit_validation')">course_edit_validation</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>));
<a name="l354"><span class="linenum"> 354</span></a>          }
<a name="l355"><span class="linenum"> 355</span></a>      } else {
<a name="l356"><span class="linenum"> 356</span></a>          foreach (<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a> as <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>) {
<a name="l357"><span class="linenum"> 357</span></a>              <a class="var it224" onMouseOver="hilite(224)" onMouseOut="lolite()" onClick="logVariable('errors')" href="../_variables/errors.html">$errors</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it224" onMouseOver="hilite(224)" onMouseOut="lolite()" onClick="logVariable('errors')" href="../_variables/errors.html">$errors</a>, <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>-&gt;<a class="function" onClick="logFunction('course_edit_validation')" href="../_functions/course_edit_validation.html" onMouseOver="funcPopup(event,'course_edit_validation')">course_edit_validation</a>(NULL, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>));
<a name="l358"><span class="linenum"> 358</span></a>          }
<a name="l359"><span class="linenum"> 359</span></a>      }
<a name="l360"><span class="linenum"> 360</span></a>  
<a name="l361"><span class="linenum"> 361</span></a>      return <a class="var it224" onMouseOver="hilite(224)" onMouseOut="lolite()" onClick="logVariable('errors')" href="../_variables/errors.html">$errors</a>;
<a name="l362"><span class="linenum"> 362</span></a>  }
<a name="l363"><span class="linenum"> 363</span></a>  
<a name="l364"><span class="linenum"> 364</span></a>  <span class="comment">/**</span>
<a name="l365"><span class="linenum"> 365</span></a>  <span class="comment"> * Update enrol instances after course edit form submission</span>
<a name="l366"><span class="linenum"> 366</span></a>  <span class="comment"> * @param bool $inserted true means new course added, false course already existed</span>
<a name="l367"><span class="linenum"> 367</span></a>  <span class="comment"> * @param object $course</span>
<a name="l368"><span class="linenum"> 368</span></a>  <span class="comment"> * @param object $data form data</span>
<a name="l369"><span class="linenum"> 369</span></a>  <span class="comment"> * @return void</span>
<a name="l370"><span class="linenum"> 370</span></a>  <span class="comment"> */</span>
<a name="l371"><span class="linenum"> 371</span></a>  function <a class="function" onClick="logFunction('enrol_course_updated')" href="../_functions/enrol_course_updated.html" onMouseOver="funcPopup(event,'enrol_course_updated')">enrol_course_updated</a>(<a class="var it4917" onMouseOver="hilite(4917)" onMouseOut="lolite()" onClick="logVariable('inserted')" href="../_variables/inserted.html">$inserted</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>) {
<a name="l372"><span class="linenum"> 372</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l373"><span class="linenum"> 373</span></a>  
<a name="l374"><span class="linenum"> 374</span></a>      <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a> = <a class="function" onClick="logFunction('enrol_get_plugins')" href="../_functions/enrol_get_plugins.html" onMouseOver="funcPopup(event,'enrol_get_plugins')">enrol_get_plugins</a>(true);
<a name="l375"><span class="linenum"> 375</span></a>  
<a name="l376"><span class="linenum"> 376</span></a>      foreach (<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a> as <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>) {
<a name="l377"><span class="linenum"> 377</span></a>          <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>-&gt;<a class="function" onClick="logFunction('course_updated')" href="../_functions/course_updated.html" onMouseOver="funcPopup(event,'course_updated')">course_updated</a>(<a class="var it4917" onMouseOver="hilite(4917)" onMouseOut="lolite()" onClick="logVariable('inserted')" href="../_variables/inserted.html">$inserted</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>);
<a name="l378"><span class="linenum"> 378</span></a>      }
<a name="l379"><span class="linenum"> 379</span></a>  }
<a name="l380"><span class="linenum"> 380</span></a>  
<a name="l381"><span class="linenum"> 381</span></a>  <span class="comment">/**</span>
<a name="l382"><span class="linenum"> 382</span></a>  <span class="comment"> * Add navigation nodes</span>
<a name="l383"><span class="linenum"> 383</span></a>  <span class="comment"> * @param navigation_node $coursenode</span>
<a name="l384"><span class="linenum"> 384</span></a>  <span class="comment"> * @param object $course</span>
<a name="l385"><span class="linenum"> 385</span></a>  <span class="comment"> * @return void</span>
<a name="l386"><span class="linenum"> 386</span></a>  <span class="comment"> */</span>
<a name="l387"><span class="linenum"> 387</span></a>  function <a class="function" onClick="logFunction('enrol_add_course_navigation')" href="../_functions/enrol_add_course_navigation.html" onMouseOver="funcPopup(event,'enrol_add_course_navigation')">enrol_add_course_navigation</a>(navigation_node <a class="var it19839" onMouseOver="hilite(19839)" onMouseOut="lolite()" onClick="logVariable('coursenode')" href="../_variables/coursenode.html">$coursenode</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>) {
<a name="l388"><span class="linenum"> 388</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l389"><span class="linenum"> 389</span></a>  
<a name="l390"><span class="linenum"> 390</span></a>      <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l391"><span class="linenum"> 391</span></a>  
<a name="l392"><span class="linenum"> 392</span></a>      <a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a> = <a class="function" onClick="logFunction('enrol_get_instances')" href="../_functions/enrol_get_instances.html" onMouseOver="funcPopup(event,'enrol_get_instances')">enrol_get_instances</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, true);
<a name="l393"><span class="linenum"> 393</span></a>      <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>   = <a class="function" onClick="logFunction('enrol_get_plugins')" href="../_functions/enrol_get_plugins.html" onMouseOver="funcPopup(event,'enrol_get_plugins')">enrol_get_plugins</a>(true);
<a name="l394"><span class="linenum"> 394</span></a>  
<a name="l395"><span class="linenum"> 395</span></a>  <span class="comment">    // we do not want to break all course pages if there is some borked enrol plugin, right?</span>
<a name="l396"><span class="linenum"> 396</span></a>      foreach (<a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a> as <a class="var it68" onMouseOver="hilite(68)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l397"><span class="linenum"> 397</span></a>          if (!isset(<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>[<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>])) {
<a name="l398"><span class="linenum"> 398</span></a>              unset(<a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a>[<a class="var it68" onMouseOver="hilite(68)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>]);
<a name="l399"><span class="linenum"> 399</span></a>          }
<a name="l400"><span class="linenum"> 400</span></a>      }
<a name="l401"><span class="linenum"> 401</span></a>  
<a name="l402"><span class="linenum"> 402</span></a>      <a class="var it19840" onMouseOver="hilite(19840)" onMouseOut="lolite()" onClick="logVariable('usersnode')" href="../_variables/usersnode.html">$usersnode</a> = <a class="var it19839" onMouseOver="hilite(19839)" onMouseOut="lolite()" onClick="logVariable('coursenode')" href="../_variables/coursenode.html">$coursenode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('users'), null, <a class="class" onClick="logClass('navigation_node')" href="../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_CONTAINER, null, 'users');
<a name="l403"><span class="linenum"> 403</span></a>  
<a name="l404"><span class="linenum"> 404</span></a>      if (<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/id.html">id</a> != <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>) {
<a name="l405"><span class="linenum"> 405</span></a>  <span class="comment">        // list all participants - allows assigning roles, groups, etc.</span>
<a name="l406"><span class="linenum"> 406</span></a>          if (<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:enrolreview', <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>)) {
<a name="l407"><span class="linenum"> 407</span></a>              <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../enrol/users.php.html">/enrol/users.php</a>', array('id'=&gt;<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l408"><span class="linenum"> 408</span></a>              <a class="var it19840" onMouseOver="hilite(19840)" onMouseOut="lolite()" onClick="logVariable('usersnode')" href="../_variables/usersnode.html">$usersnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('enrolledusers', 'enrol'), <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a>, <a class="class" onClick="logClass('navigation_node')" href="../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING, null, 'review', <span class="keyword">new </span><a class="class" onClick="logClass('pix_icon')" href="../_classes/pix_icon.html" onMouseOver="classPopup(event,'pix_icon')">pix_icon</a>('i/enrolusers', ''));
<a name="l409"><span class="linenum"> 409</span></a>          }
<a name="l410"><span class="linenum"> 410</span></a>  
<a name="l411"><span class="linenum"> 411</span></a>  <span class="comment">        // manage enrol plugin instances</span>
<a name="l412"><span class="linenum"> 412</span></a>          if (<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:enrolconfig', <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>) or <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:enrolreview', <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>)) {
<a name="l413"><span class="linenum"> 413</span></a>              <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../enrol/instances.php.html">/enrol/instances.php</a>', array('id'=&gt;<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l414"><span class="linenum"> 414</span></a>          } else {
<a name="l415"><span class="linenum"> 415</span></a>              <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a> = NULL;
<a name="l416"><span class="linenum"> 416</span></a>          }
<a name="l417"><span class="linenum"> 417</span></a>          <a class="var it19841" onMouseOver="hilite(19841)" onMouseOut="lolite()" onClick="logVariable('instancesnode')" href="../_variables/instancesnode.html">$instancesnode</a> = <a class="var it19840" onMouseOver="hilite(19840)" onMouseOut="lolite()" onClick="logVariable('usersnode')" href="../_variables/usersnode.html">$usersnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('enrolmentinstances', 'enrol'), <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a>, <a class="class" onClick="logClass('navigation_node')" href="../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING, null, 'manageinstances');
<a name="l418"><span class="linenum"> 418</span></a>  
<a name="l419"><span class="linenum"> 419</span></a>  <span class="comment">        // each instance decides how to configure itself or how many other nav items are exposed</span>
<a name="l420"><span class="linenum"> 420</span></a>          foreach (<a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a> as <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l421"><span class="linenum"> 421</span></a>              if (!isset(<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>[<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>])) {
<a name="l422"><span class="linenum"> 422</span></a>                  continue;
<a name="l423"><span class="linenum"> 423</span></a>              }
<a name="l424"><span class="linenum"> 424</span></a>              <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>[<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>]-&gt;<a class="function" onClick="logFunction('add_course_navigation')" href="../_functions/add_course_navigation.html" onMouseOver="funcPopup(event,'add_course_navigation')">add_course_navigation</a>(<a class="var it19841" onMouseOver="hilite(19841)" onMouseOut="lolite()" onClick="logVariable('instancesnode')" href="../_variables/instancesnode.html">$instancesnode</a>, <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>);
<a name="l425"><span class="linenum"> 425</span></a>          }
<a name="l426"><span class="linenum"> 426</span></a>  
<a name="l427"><span class="linenum"> 427</span></a>          if (!<a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a>) {
<a name="l428"><span class="linenum"> 428</span></a>              <a class="var it19841" onMouseOver="hilite(19841)" onMouseOut="lolite()" onClick="logVariable('instancesnode')" href="../_variables/instancesnode.html">$instancesnode</a>-&gt;<a class="function" onClick="logFunction('trim_if_empty')" href="../_functions/trim_if_empty.html" onMouseOver="funcPopup(event,'trim_if_empty')">trim_if_empty</a>();
<a name="l429"><span class="linenum"> 429</span></a>          }
<a name="l430"><span class="linenum"> 430</span></a>      }
<a name="l431"><span class="linenum"> 431</span></a>  
<a name="l432"><span class="linenum"> 432</span></a>  <span class="comment">    // Manage groups in this course or even frontpage</span>
<a name="l433"><span class="linenum"> 433</span></a>      if ((<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('groupmode')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/groupmode.html">groupmode</a> || !<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('groupmodeforce')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/groupmodeforce.html">groupmodeforce</a>) &amp;&amp; <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:managegroups', <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>)) {
<a name="l434"><span class="linenum"> 434</span></a>          <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../group/index.php.html">/group/index.php</a>', array('id'=&gt;<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l435"><span class="linenum"> 435</span></a>          <a class="var it19840" onMouseOver="hilite(19840)" onMouseOut="lolite()" onClick="logVariable('usersnode')" href="../_variables/usersnode.html">$usersnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('groups'), <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a>, <a class="class" onClick="logClass('navigation_node')" href="../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING, null, 'groups', <span class="keyword">new </span><a class="class" onClick="logClass('pix_icon')" href="../_classes/pix_icon.html" onMouseOver="classPopup(event,'pix_icon')">pix_icon</a>('i/group', ''));
<a name="l436"><span class="linenum"> 436</span></a>      }
<a name="l437"><span class="linenum"> 437</span></a>  
<a name="l438"><span class="linenum"> 438</span></a>       if (<a class="function" onClick="logFunction('has_any_capability')" href="../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(array( 'moodle/role:assign', 'moodle/role:safeoverride','moodle/role:override', 'moodle/role:review'), <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>)) {
<a name="l439"><span class="linenum"> 439</span></a>  <span class="comment">        // Override roles</span>
<a name="l440"><span class="linenum"> 440</span></a>          if (<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/role:review', <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>)) {
<a name="l441"><span class="linenum"> 441</span></a>              <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../admin/roles/permissions.php.html">/admin/roles/permissions.php</a>', array('contextid'=&gt;<a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('id')" class="var it43118" onMouseOver="hilite(43118)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l442"><span class="linenum"> 442</span></a>          } else {
<a name="l443"><span class="linenum"> 443</span></a>              <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a> = NULL;
<a name="l444"><span class="linenum"> 444</span></a>          }
<a name="l445"><span class="linenum"> 445</span></a>          <a class="var it19842" onMouseOver="hilite(19842)" onMouseOut="lolite()" onClick="logVariable('permissionsnode')" href="../_variables/permissionsnode.html">$permissionsnode</a> = <a class="var it19840" onMouseOver="hilite(19840)" onMouseOut="lolite()" onClick="logVariable('usersnode')" href="../_variables/usersnode.html">$usersnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('permissions', 'role'), <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a>, <a class="class" onClick="logClass('navigation_node')" href="../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING, null, 'override');
<a name="l446"><span class="linenum"> 446</span></a>  
<a name="l447"><span class="linenum"> 447</span></a>  <span class="comment">        // Add assign or override roles if allowed</span>
<a name="l448"><span class="linenum"> 448</span></a>          if (<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/id.html">id</a> == <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a> <a class="function" onClick="logFunction('or')" href="../_functions/or.html" onMouseOver="funcPopup(event,'or')">or</a> (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('adminsassignrolesincourse')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/adminsassignrolesincourse.html">adminsassignrolesincourse</a>) and <a class="function" onClick="logFunction('is_siteadmin')" href="../_functions/is_siteadmin.html" onMouseOver="funcPopup(event,'is_siteadmin')">is_siteadmin</a>())) {
<a name="l449"><span class="linenum"> 449</span></a>              if (<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/role:assign', <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>)) {
<a name="l450"><span class="linenum"> 450</span></a>                  <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../admin/roles/assign.php.html">/admin/roles/assign.php</a>', array('contextid'=&gt;<a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('id')" class="var it43118" onMouseOver="hilite(43118)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l451"><span class="linenum"> 451</span></a>                  <a class="var it19842" onMouseOver="hilite(19842)" onMouseOut="lolite()" onClick="logVariable('permissionsnode')" href="../_variables/permissionsnode.html">$permissionsnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('assignedroles', 'role'), <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a>, <a class="class" onClick="logClass('navigation_node')" href="../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING, null, 'roles', <span class="keyword">new </span><a class="class" onClick="logClass('pix_icon')" href="../_classes/pix_icon.html" onMouseOver="classPopup(event,'pix_icon')">pix_icon</a>('i/assignroles', ''));
<a name="l452"><span class="linenum"> 452</span></a>              }
<a name="l453"><span class="linenum"> 453</span></a>          }
<a name="l454"><span class="linenum"> 454</span></a>  <span class="comment">        // Check role permissions</span>
<a name="l455"><span class="linenum"> 455</span></a>          if (<a class="function" onClick="logFunction('has_any_capability')" href="../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(array('moodle/role:assign', 'moodle/role:safeoverride', 'moodle/role:override'), <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>)) {
<a name="l456"><span class="linenum"> 456</span></a>              <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../admin/roles/check.php.html">/admin/roles/check.php</a>', array('contextid'=&gt;<a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('id')" class="var it43118" onMouseOver="hilite(43118)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l457"><span class="linenum"> 457</span></a>              <a class="var it19842" onMouseOver="hilite(19842)" onMouseOut="lolite()" onClick="logVariable('permissionsnode')" href="../_variables/permissionsnode.html">$permissionsnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('checkpermissions', 'role'), <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a>, <a class="class" onClick="logClass('navigation_node')" href="../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING, null, 'permissions', <span class="keyword">new </span><a class="class" onClick="logClass('pix_icon')" href="../_classes/pix_icon.html" onMouseOver="classPopup(event,'pix_icon')">pix_icon</a>('i/checkpermissions', ''));
<a name="l458"><span class="linenum"> 458</span></a>          }
<a name="l459"><span class="linenum"> 459</span></a>       }
<a name="l460"><span class="linenum"> 460</span></a>  
<a name="l461"><span class="linenum"> 461</span></a>  <span class="comment">     // Deal somehow with users that are not enrolled but still got a role somehow</span>
<a name="l462"><span class="linenum"> 462</span></a>      if (<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/id.html">id</a> != <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>) {
<a name="l463"><span class="linenum"> 463</span></a>  <span class="comment">        //TODO, create some new UI for role assignments at course level</span>
<a name="l464"><span class="linenum"> 464</span></a>          if (<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:reviewotherusers', <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>)) {
<a name="l465"><span class="linenum"> 465</span></a>              <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../enrol/otherusers.php.html">/enrol/otherusers.php</a>', array('id'=&gt;<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l466"><span class="linenum"> 466</span></a>              <a class="var it19840" onMouseOver="hilite(19840)" onMouseOut="lolite()" onClick="logVariable('usersnode')" href="../_variables/usersnode.html">$usersnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('notenrolledusers', 'enrol'), <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a>, <a class="class" onClick="logClass('navigation_node')" href="../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING, null, 'otherusers', <span class="keyword">new </span><a class="class" onClick="logClass('pix_icon')" href="../_classes/pix_icon.html" onMouseOver="classPopup(event,'pix_icon')">pix_icon</a>('i/assignroles', ''));
<a name="l467"><span class="linenum"> 467</span></a>          }
<a name="l468"><span class="linenum"> 468</span></a>      }
<a name="l469"><span class="linenum"> 469</span></a>  
<a name="l470"><span class="linenum"> 470</span></a>  <span class="comment">    // just in case nothing was actually added</span>
<a name="l471"><span class="linenum"> 471</span></a>      <a class="var it19840" onMouseOver="hilite(19840)" onMouseOut="lolite()" onClick="logVariable('usersnode')" href="../_variables/usersnode.html">$usersnode</a>-&gt;<a class="function" onClick="logFunction('trim_if_empty')" href="../_functions/trim_if_empty.html" onMouseOver="funcPopup(event,'trim_if_empty')">trim_if_empty</a>();
<a name="l472"><span class="linenum"> 472</span></a>  
<a name="l473"><span class="linenum"> 473</span></a>      if (<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/id.html">id</a> != <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>) {
<a name="l474"><span class="linenum"> 474</span></a>          if (<a class="function" onClick="logFunction('isguestuser')" href="../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>() or !<a class="function" onClick="logFunction('isloggedin')" href="../_functions/isloggedin.html" onMouseOver="funcPopup(event,'isloggedin')">isloggedin</a>()) {
<a name="l475"><span class="linenum"> 475</span></a>  <span class="comment">            // guest account can not be enrolled - no links for them</span>
<a name="l476"><span class="linenum"> 476</span></a>          } else if (<a class="function" onClick="logFunction('is_enrolled')" href="../_functions/is_enrolled.html" onMouseOver="funcPopup(event,'is_enrolled')">is_enrolled</a>(<a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>)) {
<a name="l477"><span class="linenum"> 477</span></a>  <span class="comment">            // unenrol link if possible</span>
<a name="l478"><span class="linenum"> 478</span></a>              foreach (<a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a> as <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l479"><span class="linenum"> 479</span></a>                  if (!isset(<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>[<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>])) {
<a name="l480"><span class="linenum"> 480</span></a>                      continue;
<a name="l481"><span class="linenum"> 481</span></a>                  }
<a name="l482"><span class="linenum"> 482</span></a>                  <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a> = <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>[<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>];
<a name="l483"><span class="linenum"> 483</span></a>                  if (<a class="var it19844" onMouseOver="hilite(19844)" onMouseOut="lolite()" onClick="logVariable('unenrollink')" href="../_variables/unenrollink.html">$unenrollink</a> = <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>-&gt;<a class="function" onClick="logFunction('get_unenrolself_link')" href="../_functions/get_unenrolself_link.html" onMouseOver="funcPopup(event,'get_unenrolself_link')">get_unenrolself_link</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>)) {
<a name="l484"><span class="linenum"> 484</span></a>                      <a class="var it911" onMouseOver="hilite(911)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../_variables/shortname.html">$shortname</a> = <a class="function" onClick="logFunction('format_string')" href="../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('shortname')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/shortname.html">shortname</a>, true, array('context' =&gt; <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>));
<a name="l485"><span class="linenum"> 485</span></a>                      <a class="var it19839" onMouseOver="hilite(19839)" onMouseOut="lolite()" onClick="logVariable('coursenode')" href="../_variables/coursenode.html">$coursenode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('unenrolme', 'core_enrol', <a class="var it911" onMouseOver="hilite(911)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../_variables/shortname.html">$shortname</a>), <a class="var it19844" onMouseOver="hilite(19844)" onMouseOut="lolite()" onClick="logVariable('unenrollink')" href="../_variables/unenrollink.html">$unenrollink</a>, <a class="class" onClick="logClass('navigation_node')" href="../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING, null, 'unenrolself', <span class="keyword">new </span><a class="class" onClick="logClass('pix_icon')" href="../_classes/pix_icon.html" onMouseOver="classPopup(event,'pix_icon')">pix_icon</a>('i/user', ''));
<a name="l486"><span class="linenum"> 486</span></a>                      break;
<a name="l487"><span class="linenum"> 487</span></a>  <span class="comment">                    //TODO. deal with multiple unenrol links - not likely case, but still...</span>
<a name="l488"><span class="linenum"> 488</span></a>                  }
<a name="l489"><span class="linenum"> 489</span></a>              }
<a name="l490"><span class="linenum"> 490</span></a>          } else {
<a name="l491"><span class="linenum"> 491</span></a>  <span class="comment">            // enrol link if possible</span>
<a name="l492"><span class="linenum"> 492</span></a>              if (<a class="function" onClick="logFunction('is_viewing')" href="../_functions/is_viewing.html" onMouseOver="funcPopup(event,'is_viewing')">is_viewing</a>(<a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>)) {
<a name="l493"><span class="linenum"> 493</span></a>  <span class="comment">                // better not show any enrol link, this is intended for managers and inspectors</span>
<a name="l494"><span class="linenum"> 494</span></a>              } else {
<a name="l495"><span class="linenum"> 495</span></a>                  foreach (<a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a> as <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l496"><span class="linenum"> 496</span></a>                      if (!isset(<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>[<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>])) {
<a name="l497"><span class="linenum"> 497</span></a>                          continue;
<a name="l498"><span class="linenum"> 498</span></a>                      }
<a name="l499"><span class="linenum"> 499</span></a>                      <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a> = <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>[<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>];
<a name="l500"><span class="linenum"> 500</span></a>                      if (<a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>-&gt;<a class="function" onClick="logFunction('show_enrolme_link')" href="../_functions/show_enrolme_link.html" onMouseOver="funcPopup(event,'show_enrolme_link')">show_enrolme_link</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>)) {
<a name="l501"><span class="linenum"> 501</span></a>                          <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../enrol/index.php.html">/enrol/index.php</a>', array('id'=&gt;<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l502"><span class="linenum"> 502</span></a>                          <a class="var it911" onMouseOver="hilite(911)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../_variables/shortname.html">$shortname</a> = <a class="function" onClick="logFunction('format_string')" href="../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('shortname')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/shortname.html">shortname</a>, true, array('context' =&gt; <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>));
<a name="l503"><span class="linenum"> 503</span></a>                          <a class="var it19839" onMouseOver="hilite(19839)" onMouseOut="lolite()" onClick="logVariable('coursenode')" href="../_variables/coursenode.html">$coursenode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('enrolme', 'core_enrol', <a class="var it911" onMouseOver="hilite(911)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../_variables/shortname.html">$shortname</a>), <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a>, <a class="class" onClick="logClass('navigation_node')" href="../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING, null, 'enrolself', <span class="keyword">new </span><a class="class" onClick="logClass('pix_icon')" href="../_classes/pix_icon.html" onMouseOver="classPopup(event,'pix_icon')">pix_icon</a>('i/user', ''));
<a name="l504"><span class="linenum"> 504</span></a>                          break;
<a name="l505"><span class="linenum"> 505</span></a>                      }
<a name="l506"><span class="linenum"> 506</span></a>                  }
<a name="l507"><span class="linenum"> 507</span></a>              }
<a name="l508"><span class="linenum"> 508</span></a>          }
<a name="l509"><span class="linenum"> 509</span></a>      }
<a name="l510"><span class="linenum"> 510</span></a>  }
<a name="l511"><span class="linenum"> 511</span></a>  
<a name="l512"><span class="linenum"> 512</span></a>  <span class="comment">/**</span>
<a name="l513"><span class="linenum"> 513</span></a>  <span class="comment"> * Returns list of courses current $USER is enrolled in and can access</span>
<a name="l514"><span class="linenum"> 514</span></a>  <span class="comment"> *</span>
<a name="l515"><span class="linenum"> 515</span></a>  <span class="comment"> * - $fields is an array of field names to ADD</span>
<a name="l516"><span class="linenum"> 516</span></a>  <span class="comment"> *   so name the fields you really need, which will</span>
<a name="l517"><span class="linenum"> 517</span></a>  <span class="comment"> *   be added and uniq'd</span>
<a name="l518"><span class="linenum"> 518</span></a>  <span class="comment"> *</span>
<a name="l519"><span class="linenum"> 519</span></a>  <span class="comment"> * @param string|array $fields</span>
<a name="l520"><span class="linenum"> 520</span></a>  <span class="comment"> * @param string $sort</span>
<a name="l521"><span class="linenum"> 521</span></a>  <span class="comment"> * @param int $limit max number of courses</span>
<a name="l522"><span class="linenum"> 522</span></a>  <span class="comment"> * @return array</span>
<a name="l523"><span class="linenum"> 523</span></a>  <span class="comment"> */</span>
<a name="l524"><span class="linenum"> 524</span></a>  function <a class="function" onClick="logFunction('enrol_get_my_courses')" href="../_functions/enrol_get_my_courses.html" onMouseOver="funcPopup(event,'enrol_get_my_courses')">enrol_get_my_courses</a>(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = NULL, <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a> = 'visible DESC,sortorder ASC', <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../_variables/limit.html">$limit</a> = 0) {
<a name="l525"><span class="linenum"> 525</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l526"><span class="linenum"> 526</span></a>  
<a name="l527"><span class="linenum"> 527</span></a>  <span class="comment">    // Guest account does not have any courses</span>
<a name="l528"><span class="linenum"> 528</span></a>      if (<a class="function" onClick="logFunction('isguestuser')" href="../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>() or !<a class="function" onClick="logFunction('isloggedin')" href="../_functions/isloggedin.html" onMouseOver="funcPopup(event,'isloggedin')">isloggedin</a>()) {
<a name="l529"><span class="linenum"> 529</span></a>          return(array());
<a name="l530"><span class="linenum"> 530</span></a>      }
<a name="l531"><span class="linenum"> 531</span></a>  
<a name="l532"><span class="linenum"> 532</span></a>      <a class="var it19845" onMouseOver="hilite(19845)" onMouseOut="lolite()" onClick="logVariable('basefields')" href="../_variables/basefields.html">$basefields</a> = array('id', 'category', 'sortorder',
<a name="l533"><span class="linenum"> 533</span></a>                          'shortname', 'fullname', 'idnumber',
<a name="l534"><span class="linenum"> 534</span></a>                          'startdate', 'visible',
<a name="l535"><span class="linenum"> 535</span></a>                          'groupmode', 'groupmodeforce', 'cacherev');
<a name="l536"><span class="linenum"> 536</span></a>  
<a name="l537"><span class="linenum"> 537</span></a>      if (empty(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>)) {
<a name="l538"><span class="linenum"> 538</span></a>          <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = <a class="var it19845" onMouseOver="hilite(19845)" onMouseOut="lolite()" onClick="logVariable('basefields')" href="../_variables/basefields.html">$basefields</a>;
<a name="l539"><span class="linenum"> 539</span></a>      } else if (<a class="phpfunction" onClick="logFunction('is_string')" href="../_functions/is_string.html" onMouseOver="phpfuncPopup(event,'is_string')">is_string</a>(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>)) {
<a name="l540"><span class="linenum"> 540</span></a>  <span class="comment">        // turn the fields from a string to an array</span>
<a name="l541"><span class="linenum"> 541</span></a>          <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>);
<a name="l542"><span class="linenum"> 542</span></a>          <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = <a class="phpfunction" onClick="logFunction('array_map')" href="../_functions/array_map.html" onMouseOver="phpfuncPopup(event,'array_map')">array_map</a>('trim', <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>);
<a name="l543"><span class="linenum"> 543</span></a>          <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = <a class="phpfunction" onClick="logFunction('array_unique')" href="../_functions/array_unique.html" onMouseOver="phpfuncPopup(event,'array_unique')">array_unique</a>(<a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it19845" onMouseOver="hilite(19845)" onMouseOut="lolite()" onClick="logVariable('basefields')" href="../_variables/basefields.html">$basefields</a>, <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>));
<a name="l544"><span class="linenum"> 544</span></a>      } else if (<a class="phpfunction" onClick="logFunction('is_array')" href="../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>)) {
<a name="l545"><span class="linenum"> 545</span></a>          <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = <a class="phpfunction" onClick="logFunction('array_unique')" href="../_functions/array_unique.html" onMouseOver="phpfuncPopup(event,'array_unique')">array_unique</a>(<a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it19845" onMouseOver="hilite(19845)" onMouseOut="lolite()" onClick="logVariable('basefields')" href="../_variables/basefields.html">$basefields</a>, <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>));
<a name="l546"><span class="linenum"> 546</span></a>      } else {
<a name="l547"><span class="linenum"> 547</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid <a class="var it19846" onMouseOver="hilite(19846)" onMouseOut="lolite()" onClick="logVariable('fileds')" href="../_variables/fileds.html">$fileds</a> parameter in <a class="function" onClick="logFunction('enrol_get_my_courses')" href="../_functions/enrol_get_my_courses.html" onMouseOver="funcPopup(event,'enrol_get_my_courses')">enrol_get_my_courses</a>()');
<a name="l548"><span class="linenum"> 548</span></a>      }
<a name="l549"><span class="linenum"> 549</span></a>      if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('*', <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>)) {
<a name="l550"><span class="linenum"> 550</span></a>          <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = array('*');
<a name="l551"><span class="linenum"> 551</span></a>      }
<a name="l552"><span class="linenum"> 552</span></a>  
<a name="l553"><span class="linenum"> 553</span></a>      <a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../_variables/orderby.html">$orderby</a> = &quot;&quot;;
<a name="l554"><span class="linenum"> 554</span></a>      <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>    = <a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>);
<a name="l555"><span class="linenum"> 555</span></a>      if (!empty(<a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>)) {
<a name="l556"><span class="linenum"> 556</span></a>          <a class="var it19847" onMouseOver="hilite(19847)" onMouseOut="lolite()" onClick="logVariable('rawsorts')" href="../_variables/rawsorts.html">$rawsorts</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>);
<a name="l557"><span class="linenum"> 557</span></a>          <a class="var it19848" onMouseOver="hilite(19848)" onMouseOut="lolite()" onClick="logVariable('sorts')" href="../_variables/sorts.html">$sorts</a> = array();
<a name="l558"><span class="linenum"> 558</span></a>          foreach (<a class="var it19847" onMouseOver="hilite(19847)" onMouseOut="lolite()" onClick="logVariable('rawsorts')" href="../_variables/rawsorts.html">$rawsorts</a> as <a class="var it19849" onMouseOver="hilite(19849)" onMouseOut="lolite()" onClick="logVariable('rawsort')" href="../_variables/rawsort.html">$rawsort</a>) {
<a name="l559"><span class="linenum"> 559</span></a>              <a class="var it19849" onMouseOver="hilite(19849)" onMouseOut="lolite()" onClick="logVariable('rawsort')" href="../_variables/rawsort.html">$rawsort</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it19849" onMouseOver="hilite(19849)" onMouseOut="lolite()" onClick="logVariable('rawsort')" href="../_variables/rawsort.html">$rawsort</a>);
<a name="l560"><span class="linenum"> 560</span></a>              if (<a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it19849" onMouseOver="hilite(19849)" onMouseOut="lolite()" onClick="logVariable('rawsort')" href="../_variables/rawsort.html">$rawsort</a>, 'c.') === 0) {
<a name="l561"><span class="linenum"> 561</span></a>                  <a class="var it19849" onMouseOver="hilite(19849)" onMouseOut="lolite()" onClick="logVariable('rawsort')" href="../_variables/rawsort.html">$rawsort</a> = <a class="phpfunction" onClick="logFunction('substr')" href="../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it19849" onMouseOver="hilite(19849)" onMouseOut="lolite()" onClick="logVariable('rawsort')" href="../_variables/rawsort.html">$rawsort</a>, 2);
<a name="l562"><span class="linenum"> 562</span></a>              }
<a name="l563"><span class="linenum"> 563</span></a>              <a class="var it19848" onMouseOver="hilite(19848)" onMouseOut="lolite()" onClick="logVariable('sorts')" href="../_variables/sorts.html">$sorts</a>[] = <a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it19849" onMouseOver="hilite(19849)" onMouseOut="lolite()" onClick="logVariable('rawsort')" href="../_variables/rawsort.html">$rawsort</a>);
<a name="l564"><span class="linenum"> 564</span></a>          }
<a name="l565"><span class="linenum"> 565</span></a>          <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a> = 'c.'.<a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',c.', <a class="var it19848" onMouseOver="hilite(19848)" onMouseOut="lolite()" onClick="logVariable('sorts')" href="../_variables/sorts.html">$sorts</a>);
<a name="l566"><span class="linenum"> 566</span></a>          <a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../_variables/orderby.html">$orderby</a> = &quot;ORDER BY <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>&quot;;
<a name="l567"><span class="linenum"> 567</span></a>      }
<a name="l568"><span class="linenum"> 568</span></a>  
<a name="l569"><span class="linenum"> 569</span></a>      <a class="var it8680" onMouseOver="hilite(8680)" onMouseOut="lolite()" onClick="logVariable('wheres')" href="../_variables/wheres.html">$wheres</a> = array(&quot;c.id &lt;&gt; :siteid&quot;);
<a name="l570"><span class="linenum"> 570</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array('siteid'=&gt;<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>);
<a name="l571"><span class="linenum"> 571</span></a>  
<a name="l572"><span class="linenum"> 572</span></a>      if (isset(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('loginascontext')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/loginascontext.html">loginascontext</a>) and <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('loginascontext')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/loginascontext.html">loginascontext</a>-&gt;contextlevel == <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>) {
<a name="l573"><span class="linenum"> 573</span></a>  <span class="comment">        // list _only_ this course - anything else is asking for trouble...</span>
<a name="l574"><span class="linenum"> 574</span></a>          <a class="var it8680" onMouseOver="hilite(8680)" onMouseOut="lolite()" onClick="logVariable('wheres')" href="../_variables/wheres.html">$wheres</a>[] = &quot;courseid = :loginas&quot;;
<a name="l575"><span class="linenum"> 575</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['loginas'] = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('loginascontext')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/loginascontext.html">loginascontext</a>-&gt;instanceid;
<a name="l576"><span class="linenum"> 576</span></a>      }
<a name="l577"><span class="linenum"> 577</span></a>  
<a name="l578"><span class="linenum"> 578</span></a>      <a class="var it19850" onMouseOver="hilite(19850)" onMouseOut="lolite()" onClick="logVariable('coursefields')" href="../_variables/coursefields.html">$coursefields</a> = 'c.' .<a class="function" onClick="logFunction('join')" href="../_functions/join.html" onMouseOver="funcPopup(event,'join')">join</a>(',c.', <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>);
<a name="l579"><span class="linenum"> 579</span></a>      <a class="var it8683" onMouseOver="hilite(8683)" onMouseOut="lolite()" onClick="logVariable('ccselect')" href="../_variables/ccselect.html">$ccselect</a> = ', ' . <a class="class" onClick="logClass('context_helper')" href="../_classes/context_helper.html" onMouseOver="classPopup(event,'context_helper')">context_helper</a>::<a class="function" onClick="logFunction('get_preload_record_columns_sql')" href="../_functions/get_preload_record_columns_sql.html" onMouseOver="funcPopup(event,'get_preload_record_columns_sql')">get_preload_record_columns_sql</a>('ctx');
<a name="l580"><span class="linenum"> 580</span></a>      <a class="var it8684" onMouseOver="hilite(8684)" onMouseOut="lolite()" onClick="logVariable('ccjoin')" href="../_variables/ccjoin.html">$ccjoin</a> = &quot;LEFT JOIN {context} ctx <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (ctx.instanceid = c.id AND ctx.contextlevel = :contextlevel)&quot;;
<a name="l581"><span class="linenum"> 581</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['contextlevel'] = <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>;
<a name="l582"><span class="linenum"> 582</span></a>      <a class="var it8680" onMouseOver="hilite(8680)" onMouseOut="lolite()" onClick="logVariable('wheres')" href="../_variables/wheres.html">$wheres</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(&quot; AND &quot;, <a class="var it8680" onMouseOver="hilite(8680)" onMouseOut="lolite()" onClick="logVariable('wheres')" href="../_variables/wheres.html">$wheres</a>);
<a name="l583"><span class="linenum"> 583</span></a>  
<a name="l584"><span class="linenum"> 584</span></a>  <span class="comment">    //note: we can not use DISTINCT + text fields due to Oracle and MS limitations, that is why we have the subselect there</span>
<a name="l585"><span class="linenum"> 585</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT <a class="var it19850" onMouseOver="hilite(19850)" onMouseOut="lolite()" onClick="logVariable('coursefields')" href="../_variables/coursefields.html">$coursefields</a> <a class="var it8683" onMouseOver="hilite(8683)" onMouseOut="lolite()" onClick="logVariable('ccselect')" href="../_variables/ccselect.html">$ccselect</a>
<a name="l586"><span class="linenum"> 586</span></a>                FROM {course} c
<a name="l587"><span class="linenum"> 587</span></a>                <a class="function" onClick="logFunction('JOIN')" href="../_functions/join.html" onMouseOver="funcPopup(event,'join')">JOIN</a> (SELECT DISTINCT e.courseid
<a name="l588"><span class="linenum"> 588</span></a>                        FROM {enrol} e
<a name="l589"><span class="linenum"> 589</span></a>                        JOIN {user_enrolments} ue <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (ue.enrolid = e.id AND ue.userid = :userid)
<a name="l590"><span class="linenum"> 590</span></a>                       WHERE ue.status = :active AND e.status = :enabled AND ue.timestart &lt; :now1 AND (ue.timeend = 0 OR ue.timeend &gt; :now2)
<a name="l591"><span class="linenum"> 591</span></a>                     ) en <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (en.courseid = c.id)
<a name="l592"><span class="linenum"> 592</span></a>             <a class="var it8684" onMouseOver="hilite(8684)" onMouseOut="lolite()" onClick="logVariable('ccjoin')" href="../_variables/ccjoin.html">$ccjoin</a>
<a name="l593"><span class="linenum"> 593</span></a>               WHERE <a class="var it8680" onMouseOver="hilite(8680)" onMouseOut="lolite()" onClick="logVariable('wheres')" href="../_variables/wheres.html">$wheres</a>
<a name="l594"><span class="linenum"> 594</span></a>            <a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../_variables/orderby.html">$orderby</a>&quot;;
<a name="l595"><span class="linenum"> 595</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['userid']  = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l596"><span class="linenum"> 596</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['active']  = <a class="constant" onClick="logConstant('ENROL_USER_ACTIVE')" href="../_constants/ENROL_USER_ACTIVE.html" onMouseOver="constPopup(event,'ENROL_USER_ACTIVE')">ENROL_USER_ACTIVE</a>;
<a name="l597"><span class="linenum"> 597</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['enabled'] = <a class="constant" onClick="logConstant('ENROL_INSTANCE_ENABLED')" href="../_constants/ENROL_INSTANCE_ENABLED.html" onMouseOver="constPopup(event,'ENROL_INSTANCE_ENABLED')">ENROL_INSTANCE_ENABLED</a>;
<a name="l598"><span class="linenum"> 598</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['now1']    = <a class="phpfunction" onClick="logFunction('round')" href="../_functions/round.html" onMouseOver="phpfuncPopup(event,'round')">round</a>(<a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>(), -2); <span class="comment">// improves db caching</span>
<a name="l599"><span class="linenum"> 599</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['now2']    = <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['now1'];
<a name="l600"><span class="linenum"> 600</span></a>  
<a name="l601"><span class="linenum"> 601</span></a>      <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, 0, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../_variables/limit.html">$limit</a>);
<a name="l602"><span class="linenum"> 602</span></a>  
<a name="l603"><span class="linenum"> 603</span></a>  <span class="comment">    // preload contexts and check visibility</span>
<a name="l604"><span class="linenum"> 604</span></a>      foreach (<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a> as <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>=&gt;<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>) {
<a name="l605"><span class="linenum"> 605</span></a>          <a class="class" onClick="logClass('context_helper')" href="../_classes/context_helper.html" onMouseOver="classPopup(event,'context_helper')">context_helper</a>::<a class="function" onClick="logFunction('preload_from_record')" href="../_functions/preload_from_record.html" onMouseOver="funcPopup(event,'preload_from_record')">preload_from_record</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>);
<a name="l606"><span class="linenum"> 606</span></a>          if (!<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('visible')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/visible.html">visible</a>) {
<a name="l607"><span class="linenum"> 607</span></a>              if (!<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>, <a class="constant" onClick="logConstant('IGNORE_MISSING')" href="../_constants/IGNORE_MISSING.html" onMouseOver="constPopup(event,'IGNORE_MISSING')">IGNORE_MISSING</a>)) {
<a name="l608"><span class="linenum"> 608</span></a>                  unset(<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a>[<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>]);
<a name="l609"><span class="linenum"> 609</span></a>                  continue;
<a name="l610"><span class="linenum"> 610</span></a>              }
<a name="l611"><span class="linenum"> 611</span></a>              if (!<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:viewhiddencourses', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>)) {
<a name="l612"><span class="linenum"> 612</span></a>                  unset(<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a>[<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>]);
<a name="l613"><span class="linenum"> 613</span></a>                  continue;
<a name="l614"><span class="linenum"> 614</span></a>              }
<a name="l615"><span class="linenum"> 615</span></a>          }
<a name="l616"><span class="linenum"> 616</span></a>          <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a>[<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>] = <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>;
<a name="l617"><span class="linenum"> 617</span></a>      }
<a name="l618"><span class="linenum"> 618</span></a>  
<a name="l619"><span class="linenum"> 619</span></a>  <span class="comment">    //wow! Is that really all? :-D</span>
<a name="l620"><span class="linenum"> 620</span></a>  
<a name="l621"><span class="linenum"> 621</span></a>      return <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a>;
<a name="l622"><span class="linenum"> 622</span></a>  }
<a name="l623"><span class="linenum"> 623</span></a>  
<a name="l624"><span class="linenum"> 624</span></a>  <span class="comment">/**</span>
<a name="l625"><span class="linenum"> 625</span></a>  <span class="comment"> * Returns course enrolment information icons.</span>
<a name="l626"><span class="linenum"> 626</span></a>  <span class="comment"> *</span>
<a name="l627"><span class="linenum"> 627</span></a>  <span class="comment"> * @param object $course</span>
<a name="l628"><span class="linenum"> 628</span></a>  <span class="comment"> * @param array $instances enrol instances of this course, improves performance</span>
<a name="l629"><span class="linenum"> 629</span></a>  <span class="comment"> * @return array of pix_icon</span>
<a name="l630"><span class="linenum"> 630</span></a>  <span class="comment"> */</span>
<a name="l631"><span class="linenum"> 631</span></a>  function <a class="function" onClick="logFunction('enrol_get_course_info_icons')" href="../_functions/enrol_get_course_info_icons.html" onMouseOver="funcPopup(event,'enrol_get_course_info_icons')">enrol_get_course_info_icons</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>, array <a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a> = NULL) {
<a name="l632"><span class="linenum"> 632</span></a>      <a class="var it2569" onMouseOver="hilite(2569)" onMouseOut="lolite()" onClick="logVariable('icons')" href="../_variables/icons.html">$icons</a> = array();
<a name="l633"><span class="linenum"> 633</span></a>      if (<a class="phpfunction" onClick="logFunction('is_null')" href="../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a>)) {
<a name="l634"><span class="linenum"> 634</span></a>          <a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a> = <a class="function" onClick="logFunction('enrol_get_instances')" href="../_functions/enrol_get_instances.html" onMouseOver="funcPopup(event,'enrol_get_instances')">enrol_get_instances</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, true);
<a name="l635"><span class="linenum"> 635</span></a>      }
<a name="l636"><span class="linenum"> 636</span></a>      <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a> = <a class="function" onClick="logFunction('enrol_get_plugins')" href="../_functions/enrol_get_plugins.html" onMouseOver="funcPopup(event,'enrol_get_plugins')">enrol_get_plugins</a>(true);
<a name="l637"><span class="linenum"> 637</span></a>      foreach (<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a> as <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> =&gt; <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>) {
<a name="l638"><span class="linenum"> 638</span></a>          <a class="var it19851" onMouseOver="hilite(19851)" onMouseOut="lolite()" onClick="logVariable('pis')" href="../_variables/pis.html">$pis</a> = array();
<a name="l639"><span class="linenum"> 639</span></a>          foreach (<a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a> as <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l640"><span class="linenum"> 640</span></a>              if (<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('status')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/status.html">status</a> != <a class="constant" onClick="logConstant('ENROL_INSTANCE_ENABLED')" href="../_constants/ENROL_INSTANCE_ENABLED.html" onMouseOver="constPopup(event,'ENROL_INSTANCE_ENABLED')">ENROL_INSTANCE_ENABLED</a> or <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a> != <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) {
<a name="l641"><span class="linenum"> 641</span></a>                  <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Invalid instances parameter submitted in enrol_get_info_icons()');
<a name="l642"><span class="linenum"> 642</span></a>                  continue;
<a name="l643"><span class="linenum"> 643</span></a>              }
<a name="l644"><span class="linenum"> 644</span></a>              if (<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a> == <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>) {
<a name="l645"><span class="linenum"> 645</span></a>                  <a class="var it19851" onMouseOver="hilite(19851)" onMouseOut="lolite()" onClick="logVariable('pis')" href="../_variables/pis.html">$pis</a>[<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>;
<a name="l646"><span class="linenum"> 646</span></a>              }
<a name="l647"><span class="linenum"> 647</span></a>          }
<a name="l648"><span class="linenum"> 648</span></a>          if (<a class="var it19851" onMouseOver="hilite(19851)" onMouseOut="lolite()" onClick="logVariable('pis')" href="../_variables/pis.html">$pis</a>) {
<a name="l649"><span class="linenum"> 649</span></a>              <a class="var it2569" onMouseOver="hilite(2569)" onMouseOut="lolite()" onClick="logVariable('icons')" href="../_variables/icons.html">$icons</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it2569" onMouseOver="hilite(2569)" onMouseOut="lolite()" onClick="logVariable('icons')" href="../_variables/icons.html">$icons</a>, <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>-&gt;<a class="function" onClick="logFunction('get_info_icons')" href="../_functions/get_info_icons.html" onMouseOver="funcPopup(event,'get_info_icons')">get_info_icons</a>(<a class="var it19851" onMouseOver="hilite(19851)" onMouseOut="lolite()" onClick="logVariable('pis')" href="../_variables/pis.html">$pis</a>));
<a name="l650"><span class="linenum"> 650</span></a>          }
<a name="l651"><span class="linenum"> 651</span></a>      }
<a name="l652"><span class="linenum"> 652</span></a>      return <a class="var it2569" onMouseOver="hilite(2569)" onMouseOut="lolite()" onClick="logVariable('icons')" href="../_variables/icons.html">$icons</a>;
<a name="l653"><span class="linenum"> 653</span></a>  }
<a name="l654"><span class="linenum"> 654</span></a>  
<a name="l655"><span class="linenum"> 655</span></a>  <span class="comment">/**</span>
<a name="l656"><span class="linenum"> 656</span></a>  <span class="comment"> * Returns course enrolment detailed information.</span>
<a name="l657"><span class="linenum"> 657</span></a>  <span class="comment"> *</span>
<a name="l658"><span class="linenum"> 658</span></a>  <span class="comment"> * @param object $course</span>
<a name="l659"><span class="linenum"> 659</span></a>  <span class="comment"> * @return array of html fragments - can be used to construct lists</span>
<a name="l660"><span class="linenum"> 660</span></a>  <span class="comment"> */</span>
<a name="l661"><span class="linenum"> 661</span></a>  function <a class="function" onClick="logFunction('enrol_get_course_description_texts')" href="../_functions/enrol_get_course_description_texts.html" onMouseOver="funcPopup(event,'enrol_get_course_description_texts')">enrol_get_course_description_texts</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>) {
<a name="l662"><span class="linenum"> 662</span></a>      <a class="var it255" onMouseOver="hilite(255)" onMouseOut="lolite()" onClick="logVariable('lines')" href="../_variables/lines.html">$lines</a> = array();
<a name="l663"><span class="linenum"> 663</span></a>      <a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a> = <a class="function" onClick="logFunction('enrol_get_instances')" href="../_functions/enrol_get_instances.html" onMouseOver="funcPopup(event,'enrol_get_instances')">enrol_get_instances</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, true);
<a name="l664"><span class="linenum"> 664</span></a>      <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a> = <a class="function" onClick="logFunction('enrol_get_plugins')" href="../_functions/enrol_get_plugins.html" onMouseOver="funcPopup(event,'enrol_get_plugins')">enrol_get_plugins</a>(true);
<a name="l665"><span class="linenum"> 665</span></a>      foreach (<a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a> as <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l666"><span class="linenum"> 666</span></a>          if (!isset(<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>[<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>])) {
<a name="l667"><span class="linenum"> 667</span></a>  <span class="comment">            //weird</span>
<a name="l668"><span class="linenum"> 668</span></a>              continue;
<a name="l669"><span class="linenum"> 669</span></a>          }
<a name="l670"><span class="linenum"> 670</span></a>          <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a> = <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>[<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>];
<a name="l671"><span class="linenum"> 671</span></a>          <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a> = <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>-&gt;<a class="function" onClick="logFunction('get_description_text')" href="../_functions/get_description_text.html" onMouseOver="funcPopup(event,'get_description_text')">get_description_text</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>);
<a name="l672"><span class="linenum"> 672</span></a>          if (<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a> !== NULL) {
<a name="l673"><span class="linenum"> 673</span></a>              <a class="var it255" onMouseOver="hilite(255)" onMouseOut="lolite()" onClick="logVariable('lines')" href="../_variables/lines.html">$lines</a>[] = <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../_variables/text.html">$text</a>;
<a name="l674"><span class="linenum"> 674</span></a>          }
<a name="l675"><span class="linenum"> 675</span></a>      }
<a name="l676"><span class="linenum"> 676</span></a>      return <a class="var it255" onMouseOver="hilite(255)" onMouseOut="lolite()" onClick="logVariable('lines')" href="../_variables/lines.html">$lines</a>;
<a name="l677"><span class="linenum"> 677</span></a>  }
<a name="l678"><span class="linenum"> 678</span></a>  
<a name="l679"><span class="linenum"> 679</span></a>  <span class="comment">/**</span>
<a name="l680"><span class="linenum"> 680</span></a>  <span class="comment"> * Returns list of courses user is enrolled into.</span>
<a name="l681"><span class="linenum"> 681</span></a>  <span class="comment"> * (Note: use enrol_get_all_users_courses if you want to use the list wihtout any cap checks )</span>
<a name="l682"><span class="linenum"> 682</span></a>  <span class="comment"> *</span>
<a name="l683"><span class="linenum"> 683</span></a>  <span class="comment"> * - $fields is an array of fieldnames to ADD</span>
<a name="l684"><span class="linenum"> 684</span></a>  <span class="comment"> *   so name the fields you really need, which will</span>
<a name="l685"><span class="linenum"> 685</span></a>  <span class="comment"> *   be added and uniq'd</span>
<a name="l686"><span class="linenum"> 686</span></a>  <span class="comment"> *</span>
<a name="l687"><span class="linenum"> 687</span></a>  <span class="comment"> * @param int $userid</span>
<a name="l688"><span class="linenum"> 688</span></a>  <span class="comment"> * @param bool $onlyactive return only active enrolments in courses user may see</span>
<a name="l689"><span class="linenum"> 689</span></a>  <span class="comment"> * @param string|array $fields</span>
<a name="l690"><span class="linenum"> 690</span></a>  <span class="comment"> * @param string $sort</span>
<a name="l691"><span class="linenum"> 691</span></a>  <span class="comment"> * @return array</span>
<a name="l692"><span class="linenum"> 692</span></a>  <span class="comment"> */</span>
<a name="l693"><span class="linenum"> 693</span></a>  function <a class="function" onClick="logFunction('enrol_get_users_courses')" href="../_functions/enrol_get_users_courses.html" onMouseOver="funcPopup(event,'enrol_get_users_courses')">enrol_get_users_courses</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it3719" onMouseOver="hilite(3719)" onMouseOut="lolite()" onClick="logVariable('onlyactive')" href="../_variables/onlyactive.html">$onlyactive</a> = false, <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = NULL, <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a> = 'visible DESC,sortorder ASC') {
<a name="l694"><span class="linenum"> 694</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l695"><span class="linenum"> 695</span></a>  
<a name="l696"><span class="linenum"> 696</span></a>      <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a> = <a class="function" onClick="logFunction('enrol_get_all_users_courses')" href="../_functions/enrol_get_all_users_courses.html" onMouseOver="funcPopup(event,'enrol_get_all_users_courses')">enrol_get_all_users_courses</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it3719" onMouseOver="hilite(3719)" onMouseOut="lolite()" onClick="logVariable('onlyactive')" href="../_variables/onlyactive.html">$onlyactive</a>, <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>, <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>);
<a name="l697"><span class="linenum"> 697</span></a>  
<a name="l698"><span class="linenum"> 698</span></a>  <span class="comment">    // preload contexts and check visibility</span>
<a name="l699"><span class="linenum"> 699</span></a>      if (<a class="var it3719" onMouseOver="hilite(3719)" onMouseOut="lolite()" onClick="logVariable('onlyactive')" href="../_variables/onlyactive.html">$onlyactive</a>) {
<a name="l700"><span class="linenum"> 700</span></a>          foreach (<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a> as <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>=&gt;<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>) {
<a name="l701"><span class="linenum"> 701</span></a>              <a class="class" onClick="logClass('context_helper')" href="../_classes/context_helper.html" onMouseOver="classPopup(event,'context_helper')">context_helper</a>::<a class="function" onClick="logFunction('preload_from_record')" href="../_functions/preload_from_record.html" onMouseOver="funcPopup(event,'preload_from_record')">preload_from_record</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>);
<a name="l702"><span class="linenum"> 702</span></a>              if (!<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('visible')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/visible.html">visible</a>) {
<a name="l703"><span class="linenum"> 703</span></a>                  if (!<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>)) {
<a name="l704"><span class="linenum"> 704</span></a>                      unset(<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a>[<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>]);
<a name="l705"><span class="linenum"> 705</span></a>                      continue;
<a name="l706"><span class="linenum"> 706</span></a>                  }
<a name="l707"><span class="linenum"> 707</span></a>                  if (!<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:viewhiddencourses', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>)) {
<a name="l708"><span class="linenum"> 708</span></a>                      unset(<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a>[<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>]);
<a name="l709"><span class="linenum"> 709</span></a>                      continue;
<a name="l710"><span class="linenum"> 710</span></a>                  }
<a name="l711"><span class="linenum"> 711</span></a>              }
<a name="l712"><span class="linenum"> 712</span></a>          }
<a name="l713"><span class="linenum"> 713</span></a>      }
<a name="l714"><span class="linenum"> 714</span></a>  
<a name="l715"><span class="linenum"> 715</span></a>      return <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a>;
<a name="l716"><span class="linenum"> 716</span></a>  
<a name="l717"><span class="linenum"> 717</span></a>  }
<a name="l718"><span class="linenum"> 718</span></a>  
<a name="l719"><span class="linenum"> 719</span></a>  <span class="comment">/**</span>
<a name="l720"><span class="linenum"> 720</span></a>  <span class="comment"> * Can user access at least one enrolled course?</span>
<a name="l721"><span class="linenum"> 721</span></a>  <span class="comment"> *</span>
<a name="l722"><span class="linenum"> 722</span></a>  <span class="comment"> * Cheat if necessary, but find out as fast as possible!</span>
<a name="l723"><span class="linenum"> 723</span></a>  <span class="comment"> *</span>
<a name="l724"><span class="linenum"> 724</span></a>  <span class="comment"> * @param int|stdClass $user null means use current user</span>
<a name="l725"><span class="linenum"> 725</span></a>  <span class="comment"> * @return bool</span>
<a name="l726"><span class="linenum"> 726</span></a>  <span class="comment"> */</span>
<a name="l727"><span class="linenum"> 727</span></a>  function <a class="function" onClick="logFunction('enrol_user_sees_own_courses')" href="../_functions/enrol_user_sees_own_courses.html" onMouseOver="funcPopup(event,'enrol_user_sees_own_courses')">enrol_user_sees_own_courses</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = null) {
<a name="l728"><span class="linenum"> 728</span></a>      global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l729"><span class="linenum"> 729</span></a>  
<a name="l730"><span class="linenum"> 730</span></a>      if (<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> === null) {
<a name="l731"><span class="linenum"> 731</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l732"><span class="linenum"> 732</span></a>      }
<a name="l733"><span class="linenum"> 733</span></a>      <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> = <a class="phpfunction" onClick="logFunction('is_object')" href="../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) ? <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a> : <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>;
<a name="l734"><span class="linenum"> 734</span></a>  
<a name="l735"><span class="linenum"> 735</span></a>  <span class="comment">    // Guest account does not have any courses</span>
<a name="l736"><span class="linenum"> 736</span></a>      if (<a class="function" onClick="logFunction('isguestuser')" href="../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) or empty(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>)) {
<a name="l737"><span class="linenum"> 737</span></a>          return false;
<a name="l738"><span class="linenum"> 738</span></a>      }
<a name="l739"><span class="linenum"> 739</span></a>  
<a name="l740"><span class="linenum"> 740</span></a>  <span class="comment">    // Let's cheat here if this is the current user,</span>
<a name="l741"><span class="linenum"> 741</span></a>  <span class="comment">    // if user accessed any course recently, then most probably</span>
<a name="l742"><span class="linenum"> 742</span></a>  <span class="comment">    // we do not need to query the database at all.</span>
<a name="l743"><span class="linenum"> 743</span></a>      if (<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/id.html">id</a> == <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) {
<a name="l744"><span class="linenum"> 744</span></a>          if (!empty(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('enrol')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>['enrolled'])) {
<a name="l745"><span class="linenum"> 745</span></a>              foreach (<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('enrol')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>['enrolled'] as <a class="var it13825" onMouseOver="hilite(13825)" onMouseOut="lolite()" onClick="logVariable('until')" href="../_variables/until.html">$until</a>) {
<a name="l746"><span class="linenum"> 746</span></a>                  if (<a class="var it13825" onMouseOver="hilite(13825)" onMouseOut="lolite()" onClick="logVariable('until')" href="../_variables/until.html">$until</a> &gt; <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()) {
<a name="l747"><span class="linenum"> 747</span></a>                      return true;
<a name="l748"><span class="linenum"> 748</span></a>                  }
<a name="l749"><span class="linenum"> 749</span></a>              }
<a name="l750"><span class="linenum"> 750</span></a>          }
<a name="l751"><span class="linenum"> 751</span></a>      }
<a name="l752"><span class="linenum"> 752</span></a>  
<a name="l753"><span class="linenum"> 753</span></a>  <span class="comment">    // Now the slow way.</span>
<a name="l754"><span class="linenum"> 754</span></a>      <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a> = <a class="function" onClick="logFunction('enrol_get_all_users_courses')" href="../_functions/enrol_get_all_users_courses.html" onMouseOver="funcPopup(event,'enrol_get_all_users_courses')">enrol_get_all_users_courses</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, true);
<a name="l755"><span class="linenum"> 755</span></a>      foreach(<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a> as <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>) {
<a name="l756"><span class="linenum"> 756</span></a>          if (<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('visible')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/visible.html">visible</a>) {
<a name="l757"><span class="linenum"> 757</span></a>              return true;
<a name="l758"><span class="linenum"> 758</span></a>          }
<a name="l759"><span class="linenum"> 759</span></a>          <a class="class" onClick="logClass('context_helper')" href="../_classes/context_helper.html" onMouseOver="classPopup(event,'context_helper')">context_helper</a>::<a class="function" onClick="logFunction('preload_from_record')" href="../_functions/preload_from_record.html" onMouseOver="funcPopup(event,'preload_from_record')">preload_from_record</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>);
<a name="l760"><span class="linenum"> 760</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l761"><span class="linenum"> 761</span></a>          if (<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:viewhiddencourses', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l762"><span class="linenum"> 762</span></a>              return true;
<a name="l763"><span class="linenum"> 763</span></a>          }
<a name="l764"><span class="linenum"> 764</span></a>      }
<a name="l765"><span class="linenum"> 765</span></a>  
<a name="l766"><span class="linenum"> 766</span></a>      return false;
<a name="l767"><span class="linenum"> 767</span></a>  }
<a name="l768"><span class="linenum"> 768</span></a>  
<a name="l769"><span class="linenum"> 769</span></a>  <span class="comment">/**</span>
<a name="l770"><span class="linenum"> 770</span></a>  <span class="comment"> * Returns list of courses user is enrolled into without any capability checks</span>
<a name="l771"><span class="linenum"> 771</span></a>  <span class="comment"> * - $fields is an array of fieldnames to ADD</span>
<a name="l772"><span class="linenum"> 772</span></a>  <span class="comment"> *   so name the fields you really need, which will</span>
<a name="l773"><span class="linenum"> 773</span></a>  <span class="comment"> *   be added and uniq'd</span>
<a name="l774"><span class="linenum"> 774</span></a>  <span class="comment"> *</span>
<a name="l775"><span class="linenum"> 775</span></a>  <span class="comment"> * @param int $userid</span>
<a name="l776"><span class="linenum"> 776</span></a>  <span class="comment"> * @param bool $onlyactive return only active enrolments in courses user may see</span>
<a name="l777"><span class="linenum"> 777</span></a>  <span class="comment"> * @param string|array $fields</span>
<a name="l778"><span class="linenum"> 778</span></a>  <span class="comment"> * @param string $sort</span>
<a name="l779"><span class="linenum"> 779</span></a>  <span class="comment"> * @return array</span>
<a name="l780"><span class="linenum"> 780</span></a>  <span class="comment"> */</span>
<a name="l781"><span class="linenum"> 781</span></a>  function <a class="function" onClick="logFunction('enrol_get_all_users_courses')" href="../_functions/enrol_get_all_users_courses.html" onMouseOver="funcPopup(event,'enrol_get_all_users_courses')">enrol_get_all_users_courses</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it3719" onMouseOver="hilite(3719)" onMouseOut="lolite()" onClick="logVariable('onlyactive')" href="../_variables/onlyactive.html">$onlyactive</a> = false, <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = NULL, <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a> = 'visible DESC,sortorder ASC') {
<a name="l782"><span class="linenum"> 782</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l783"><span class="linenum"> 783</span></a>  
<a name="l784"><span class="linenum"> 784</span></a>  <span class="comment">    // Guest account does not have any courses</span>
<a name="l785"><span class="linenum"> 785</span></a>      if (<a class="function" onClick="logFunction('isguestuser')" href="../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) or empty(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>)) {
<a name="l786"><span class="linenum"> 786</span></a>          return(array());
<a name="l787"><span class="linenum"> 787</span></a>      }
<a name="l788"><span class="linenum"> 788</span></a>  
<a name="l789"><span class="linenum"> 789</span></a>      <a class="var it19845" onMouseOver="hilite(19845)" onMouseOut="lolite()" onClick="logVariable('basefields')" href="../_variables/basefields.html">$basefields</a> = array('id', 'category', 'sortorder',
<a name="l790"><span class="linenum"> 790</span></a>              'shortname', 'fullname', 'idnumber',
<a name="l791"><span class="linenum"> 791</span></a>              'startdate', 'visible',
<a name="l792"><span class="linenum"> 792</span></a>              'defaultgroupingid',
<a name="l793"><span class="linenum"> 793</span></a>              'groupmode', 'groupmodeforce');
<a name="l794"><span class="linenum"> 794</span></a>  
<a name="l795"><span class="linenum"> 795</span></a>      if (empty(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>)) {
<a name="l796"><span class="linenum"> 796</span></a>          <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = <a class="var it19845" onMouseOver="hilite(19845)" onMouseOut="lolite()" onClick="logVariable('basefields')" href="../_variables/basefields.html">$basefields</a>;
<a name="l797"><span class="linenum"> 797</span></a>      } else if (<a class="phpfunction" onClick="logFunction('is_string')" href="../_functions/is_string.html" onMouseOver="phpfuncPopup(event,'is_string')">is_string</a>(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>)) {
<a name="l798"><span class="linenum"> 798</span></a>  <span class="comment">        // turn the fields from a string to an array</span>
<a name="l799"><span class="linenum"> 799</span></a>          <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>);
<a name="l800"><span class="linenum"> 800</span></a>          <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = <a class="phpfunction" onClick="logFunction('array_map')" href="../_functions/array_map.html" onMouseOver="phpfuncPopup(event,'array_map')">array_map</a>('trim', <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>);
<a name="l801"><span class="linenum"> 801</span></a>          <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = <a class="phpfunction" onClick="logFunction('array_unique')" href="../_functions/array_unique.html" onMouseOver="phpfuncPopup(event,'array_unique')">array_unique</a>(<a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it19845" onMouseOver="hilite(19845)" onMouseOut="lolite()" onClick="logVariable('basefields')" href="../_variables/basefields.html">$basefields</a>, <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>));
<a name="l802"><span class="linenum"> 802</span></a>      } else if (<a class="phpfunction" onClick="logFunction('is_array')" href="../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>)) {
<a name="l803"><span class="linenum"> 803</span></a>          <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = <a class="phpfunction" onClick="logFunction('array_unique')" href="../_functions/array_unique.html" onMouseOver="phpfuncPopup(event,'array_unique')">array_unique</a>(<a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it19845" onMouseOver="hilite(19845)" onMouseOut="lolite()" onClick="logVariable('basefields')" href="../_variables/basefields.html">$basefields</a>, <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>));
<a name="l804"><span class="linenum"> 804</span></a>      } else {
<a name="l805"><span class="linenum"> 805</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid <a class="var it19846" onMouseOver="hilite(19846)" onMouseOut="lolite()" onClick="logVariable('fileds')" href="../_variables/fileds.html">$fileds</a> parameter in <a class="function" onClick="logFunction('enrol_get_my_courses')" href="../_functions/enrol_get_my_courses.html" onMouseOver="funcPopup(event,'enrol_get_my_courses')">enrol_get_my_courses</a>()');
<a name="l806"><span class="linenum"> 806</span></a>      }
<a name="l807"><span class="linenum"> 807</span></a>      if (<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>('*', <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>)) {
<a name="l808"><span class="linenum"> 808</span></a>          <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = array('*');
<a name="l809"><span class="linenum"> 809</span></a>      }
<a name="l810"><span class="linenum"> 810</span></a>  
<a name="l811"><span class="linenum"> 811</span></a>      <a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../_variables/orderby.html">$orderby</a> = &quot;&quot;;
<a name="l812"><span class="linenum"> 812</span></a>      <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>    = <a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>);
<a name="l813"><span class="linenum"> 813</span></a>      if (!empty(<a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>)) {
<a name="l814"><span class="linenum"> 814</span></a>          <a class="var it19847" onMouseOver="hilite(19847)" onMouseOut="lolite()" onClick="logVariable('rawsorts')" href="../_variables/rawsorts.html">$rawsorts</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>);
<a name="l815"><span class="linenum"> 815</span></a>          <a class="var it19848" onMouseOver="hilite(19848)" onMouseOut="lolite()" onClick="logVariable('sorts')" href="../_variables/sorts.html">$sorts</a> = array();
<a name="l816"><span class="linenum"> 816</span></a>          foreach (<a class="var it19847" onMouseOver="hilite(19847)" onMouseOut="lolite()" onClick="logVariable('rawsorts')" href="../_variables/rawsorts.html">$rawsorts</a> as <a class="var it19849" onMouseOver="hilite(19849)" onMouseOut="lolite()" onClick="logVariable('rawsort')" href="../_variables/rawsort.html">$rawsort</a>) {
<a name="l817"><span class="linenum"> 817</span></a>              <a class="var it19849" onMouseOver="hilite(19849)" onMouseOut="lolite()" onClick="logVariable('rawsort')" href="../_variables/rawsort.html">$rawsort</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it19849" onMouseOver="hilite(19849)" onMouseOut="lolite()" onClick="logVariable('rawsort')" href="../_variables/rawsort.html">$rawsort</a>);
<a name="l818"><span class="linenum"> 818</span></a>              if (<a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it19849" onMouseOver="hilite(19849)" onMouseOut="lolite()" onClick="logVariable('rawsort')" href="../_variables/rawsort.html">$rawsort</a>, 'c.') === 0) {
<a name="l819"><span class="linenum"> 819</span></a>                  <a class="var it19849" onMouseOver="hilite(19849)" onMouseOut="lolite()" onClick="logVariable('rawsort')" href="../_variables/rawsort.html">$rawsort</a> = <a class="phpfunction" onClick="logFunction('substr')" href="../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it19849" onMouseOver="hilite(19849)" onMouseOut="lolite()" onClick="logVariable('rawsort')" href="../_variables/rawsort.html">$rawsort</a>, 2);
<a name="l820"><span class="linenum"> 820</span></a>              }
<a name="l821"><span class="linenum"> 821</span></a>              <a class="var it19848" onMouseOver="hilite(19848)" onMouseOut="lolite()" onClick="logVariable('sorts')" href="../_variables/sorts.html">$sorts</a>[] = <a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it19849" onMouseOver="hilite(19849)" onMouseOut="lolite()" onClick="logVariable('rawsort')" href="../_variables/rawsort.html">$rawsort</a>);
<a name="l822"><span class="linenum"> 822</span></a>          }
<a name="l823"><span class="linenum"> 823</span></a>          <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a> = 'c.'.<a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',c.', <a class="var it19848" onMouseOver="hilite(19848)" onMouseOut="lolite()" onClick="logVariable('sorts')" href="../_variables/sorts.html">$sorts</a>);
<a name="l824"><span class="linenum"> 824</span></a>          <a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../_variables/orderby.html">$orderby</a> = &quot;ORDER BY <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>&quot;;
<a name="l825"><span class="linenum"> 825</span></a>      }
<a name="l826"><span class="linenum"> 826</span></a>  
<a name="l827"><span class="linenum"> 827</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array('siteid'=&gt;<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>);
<a name="l828"><span class="linenum"> 828</span></a>  
<a name="l829"><span class="linenum"> 829</span></a>      if (<a class="var it3719" onMouseOver="hilite(3719)" onMouseOut="lolite()" onClick="logVariable('onlyactive')" href="../_variables/onlyactive.html">$onlyactive</a>) {
<a name="l830"><span class="linenum"> 830</span></a>          <a class="var it19852" onMouseOver="hilite(19852)" onMouseOut="lolite()" onClick="logVariable('subwhere')" href="../_variables/subwhere.html">$subwhere</a> = &quot;WHERE ue.status = :active AND e.status = :enabled AND ue.timestart &lt; :now1 AND (ue.timeend = 0 OR ue.timeend &gt; :now2)&quot;;
<a name="l831"><span class="linenum"> 831</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['now1']    = <a class="phpfunction" onClick="logFunction('round')" href="../_functions/round.html" onMouseOver="phpfuncPopup(event,'round')">round</a>(<a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>(), -2); <span class="comment">// improves db caching</span>
<a name="l832"><span class="linenum"> 832</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['now2']    = <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['now1'];
<a name="l833"><span class="linenum"> 833</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['active']  = <a class="constant" onClick="logConstant('ENROL_USER_ACTIVE')" href="../_constants/ENROL_USER_ACTIVE.html" onMouseOver="constPopup(event,'ENROL_USER_ACTIVE')">ENROL_USER_ACTIVE</a>;
<a name="l834"><span class="linenum"> 834</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['enabled'] = <a class="constant" onClick="logConstant('ENROL_INSTANCE_ENABLED')" href="../_constants/ENROL_INSTANCE_ENABLED.html" onMouseOver="constPopup(event,'ENROL_INSTANCE_ENABLED')">ENROL_INSTANCE_ENABLED</a>;
<a name="l835"><span class="linenum"> 835</span></a>      } else {
<a name="l836"><span class="linenum"> 836</span></a>          <a class="var it19852" onMouseOver="hilite(19852)" onMouseOut="lolite()" onClick="logVariable('subwhere')" href="../_variables/subwhere.html">$subwhere</a> = &quot;&quot;;
<a name="l837"><span class="linenum"> 837</span></a>      }
<a name="l838"><span class="linenum"> 838</span></a>  
<a name="l839"><span class="linenum"> 839</span></a>      <a class="var it19850" onMouseOver="hilite(19850)" onMouseOut="lolite()" onClick="logVariable('coursefields')" href="../_variables/coursefields.html">$coursefields</a> = 'c.' .<a class="function" onClick="logFunction('join')" href="../_functions/join.html" onMouseOver="funcPopup(event,'join')">join</a>(',c.', <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>);
<a name="l840"><span class="linenum"> 840</span></a>      <a class="var it8683" onMouseOver="hilite(8683)" onMouseOut="lolite()" onClick="logVariable('ccselect')" href="../_variables/ccselect.html">$ccselect</a> = ', ' . <a class="class" onClick="logClass('context_helper')" href="../_classes/context_helper.html" onMouseOver="classPopup(event,'context_helper')">context_helper</a>::<a class="function" onClick="logFunction('get_preload_record_columns_sql')" href="../_functions/get_preload_record_columns_sql.html" onMouseOver="funcPopup(event,'get_preload_record_columns_sql')">get_preload_record_columns_sql</a>('ctx');
<a name="l841"><span class="linenum"> 841</span></a>      <a class="var it8684" onMouseOver="hilite(8684)" onMouseOut="lolite()" onClick="logVariable('ccjoin')" href="../_variables/ccjoin.html">$ccjoin</a> = &quot;LEFT JOIN {context} ctx <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (ctx.instanceid = c.id AND ctx.contextlevel = :contextlevel)&quot;;
<a name="l842"><span class="linenum"> 842</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['contextlevel'] = <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>;
<a name="l843"><span class="linenum"> 843</span></a>  
<a name="l844"><span class="linenum"> 844</span></a>  <span class="comment">    //note: we can not use DISTINCT + text fields due to Oracle and MS limitations, that is why we have the subselect there</span>
<a name="l845"><span class="linenum"> 845</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT <a class="var it19850" onMouseOver="hilite(19850)" onMouseOut="lolite()" onClick="logVariable('coursefields')" href="../_variables/coursefields.html">$coursefields</a> <a class="var it8683" onMouseOver="hilite(8683)" onMouseOut="lolite()" onClick="logVariable('ccselect')" href="../_variables/ccselect.html">$ccselect</a>
<a name="l846"><span class="linenum"> 846</span></a>                FROM {course} c
<a name="l847"><span class="linenum"> 847</span></a>                <a class="function" onClick="logFunction('JOIN')" href="../_functions/join.html" onMouseOver="funcPopup(event,'join')">JOIN</a> (SELECT DISTINCT e.courseid
<a name="l848"><span class="linenum"> 848</span></a>                        FROM {enrol} e
<a name="l849"><span class="linenum"> 849</span></a>                        JOIN {user_enrolments} ue <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (ue.enrolid = e.id AND ue.userid = :userid)
<a name="l850"><span class="linenum"> 850</span></a>                   <a class="var it19852" onMouseOver="hilite(19852)" onMouseOut="lolite()" onClick="logVariable('subwhere')" href="../_variables/subwhere.html">$subwhere</a>
<a name="l851"><span class="linenum"> 851</span></a>                     ) en <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (en.courseid = c.id)
<a name="l852"><span class="linenum"> 852</span></a>             <a class="var it8684" onMouseOver="hilite(8684)" onMouseOut="lolite()" onClick="logVariable('ccjoin')" href="../_variables/ccjoin.html">$ccjoin</a>
<a name="l853"><span class="linenum"> 853</span></a>               WHERE c.id &lt;&gt; :siteid
<a name="l854"><span class="linenum"> 854</span></a>            <a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../_variables/orderby.html">$orderby</a>&quot;;
<a name="l855"><span class="linenum"> 855</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['userid']  = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>;
<a name="l856"><span class="linenum"> 856</span></a>  
<a name="l857"><span class="linenum"> 857</span></a>      <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l858"><span class="linenum"> 858</span></a>  
<a name="l859"><span class="linenum"> 859</span></a>      return <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a>;
<a name="l860"><span class="linenum"> 860</span></a>  }
<a name="l861"><span class="linenum"> 861</span></a>  
<a name="l862"><span class="linenum"> 862</span></a>  
<a name="l863"><span class="linenum"> 863</span></a>  
<a name="l864"><span class="linenum"> 864</span></a>  <span class="comment">/**</span>
<a name="l865"><span class="linenum"> 865</span></a>  <span class="comment"> * Called when user is about to be deleted.</span>
<a name="l866"><span class="linenum"> 866</span></a>  <span class="comment"> * @param object $user</span>
<a name="l867"><span class="linenum"> 867</span></a>  <span class="comment"> * @return void</span>
<a name="l868"><span class="linenum"> 868</span></a>  <span class="comment"> */</span>
<a name="l869"><span class="linenum"> 869</span></a>  function <a class="function" onClick="logFunction('enrol_user_delete')" href="../_functions/enrol_user_delete.html" onMouseOver="funcPopup(event,'enrol_user_delete')">enrol_user_delete</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) {
<a name="l870"><span class="linenum"> 870</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l871"><span class="linenum"> 871</span></a>  
<a name="l872"><span class="linenum"> 872</span></a>      <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a> = <a class="function" onClick="logFunction('enrol_get_plugins')" href="../_functions/enrol_get_plugins.html" onMouseOver="funcPopup(event,'enrol_get_plugins')">enrol_get_plugins</a>(true);
<a name="l873"><span class="linenum"> 873</span></a>      foreach (<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a> as <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>) {
<a name="l874"><span class="linenum"> 874</span></a>          <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>-&gt;<a class="function" onClick="logFunction('user_delete')" href="../_functions/user_delete.html" onMouseOver="funcPopup(event,'user_delete')">user_delete</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l875"><span class="linenum"> 875</span></a>      }
<a name="l876"><span class="linenum"> 876</span></a>  
<a name="l877"><span class="linenum"> 877</span></a>  <span class="comment">    // force cleanup of all broken enrolments</span>
<a name="l878"><span class="linenum"> 878</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('user_enrolments', array('userid'=&gt;<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l879"><span class="linenum"> 879</span></a>  }
<a name="l880"><span class="linenum"> 880</span></a>  
<a name="l881"><span class="linenum"> 881</span></a>  <span class="comment">/**</span>
<a name="l882"><span class="linenum"> 882</span></a>  <span class="comment"> * Called when course is about to be deleted.</span>
<a name="l883"><span class="linenum"> 883</span></a>  <span class="comment"> * @param stdClass $course</span>
<a name="l884"><span class="linenum"> 884</span></a>  <span class="comment"> * @return void</span>
<a name="l885"><span class="linenum"> 885</span></a>  <span class="comment"> */</span>
<a name="l886"><span class="linenum"> 886</span></a>  function <a class="function" onClick="logFunction('enrol_course_delete')" href="../_functions/enrol_course_delete.html" onMouseOver="funcPopup(event,'enrol_course_delete')">enrol_course_delete</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>) {
<a name="l887"><span class="linenum"> 887</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l888"><span class="linenum"> 888</span></a>  
<a name="l889"><span class="linenum"> 889</span></a>      <a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a> = <a class="function" onClick="logFunction('enrol_get_instances')" href="../_functions/enrol_get_instances.html" onMouseOver="funcPopup(event,'enrol_get_instances')">enrol_get_instances</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, false);
<a name="l890"><span class="linenum"> 890</span></a>      <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a> = <a class="function" onClick="logFunction('enrol_get_plugins')" href="../_functions/enrol_get_plugins.html" onMouseOver="funcPopup(event,'enrol_get_plugins')">enrol_get_plugins</a>(true);
<a name="l891"><span class="linenum"> 891</span></a>      foreach (<a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a> as <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l892"><span class="linenum"> 892</span></a>          if (isset(<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>[<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>])) {
<a name="l893"><span class="linenum"> 893</span></a>              <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>[<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>]-&gt;<a class="function" onClick="logFunction('delete_instance')" href="../_functions/delete_instance.html" onMouseOver="funcPopup(event,'delete_instance')">delete_instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>);
<a name="l894"><span class="linenum"> 894</span></a>          }
<a name="l895"><span class="linenum"> 895</span></a>  <span class="comment">        // low level delete in case plugin did not do it</span>
<a name="l896"><span class="linenum"> 896</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('user_enrolments', array('enrolid'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l897"><span class="linenum"> 897</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('role_assignments', array('itemid'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'component'=&gt;'enrol_'.<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>));
<a name="l898"><span class="linenum"> 898</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('user_enrolments', array('enrolid'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l899"><span class="linenum"> 899</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('enrol', array('id'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l900"><span class="linenum"> 900</span></a>      }
<a name="l901"><span class="linenum"> 901</span></a>  }
<a name="l902"><span class="linenum"> 902</span></a>  
<a name="l903"><span class="linenum"> 903</span></a>  <span class="comment">/**</span>
<a name="l904"><span class="linenum"> 904</span></a>  <span class="comment"> * Try to enrol user via default internal auth plugin.</span>
<a name="l905"><span class="linenum"> 905</span></a>  <span class="comment"> *</span>
<a name="l906"><span class="linenum"> 906</span></a>  <span class="comment"> * For now this is always using the manual enrol plugin...</span>
<a name="l907"><span class="linenum"> 907</span></a>  <span class="comment"> *</span>
<a name="l908"><span class="linenum"> 908</span></a>  <span class="comment"> * @param $courseid</span>
<a name="l909"><span class="linenum"> 909</span></a>  <span class="comment"> * @param $userid</span>
<a name="l910"><span class="linenum"> 910</span></a>  <span class="comment"> * @param $roleid</span>
<a name="l911"><span class="linenum"> 911</span></a>  <span class="comment"> * @param $timestart</span>
<a name="l912"><span class="linenum"> 912</span></a>  <span class="comment"> * @param $timeend</span>
<a name="l913"><span class="linenum"> 913</span></a>  <span class="comment"> * @return bool success</span>
<a name="l914"><span class="linenum"> 914</span></a>  <span class="comment"> */</span>
<a name="l915"><span class="linenum"> 915</span></a>  function <a class="function" onClick="logFunction('enrol_try_internal_enrol')" href="../_functions/enrol_try_internal_enrol.html" onMouseOver="funcPopup(event,'enrol_try_internal_enrol')">enrol_try_internal_enrol</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a> = null, <a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../_variables/timestart.html">$timestart</a> = 0, <a class="var it3001" onMouseOver="hilite(3001)" onMouseOut="lolite()" onClick="logVariable('timeend')" href="../_variables/timeend.html">$timeend</a> = 0) {
<a name="l916"><span class="linenum"> 916</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l917"><span class="linenum"> 917</span></a>  
<a name="l918"><span class="linenum"> 918</span></a>  <span class="comment">    //note: this is hardcoded to manual plugin for now</span>
<a name="l919"><span class="linenum"> 919</span></a>  
<a name="l920"><span class="linenum"> 920</span></a>      if (!<a class="function" onClick="logFunction('enrol_is_enabled')" href="../_functions/enrol_is_enabled.html" onMouseOver="funcPopup(event,'enrol_is_enabled')">enrol_is_enabled</a>('manual')) {
<a name="l921"><span class="linenum"> 921</span></a>          return false;
<a name="l922"><span class="linenum"> 922</span></a>      }
<a name="l923"><span class="linenum"> 923</span></a>  
<a name="l924"><span class="linenum"> 924</span></a>      if (!<a class="var it747" onMouseOver="hilite(747)" onMouseOut="lolite()" onClick="logVariable('enrol')" href="../_variables/enrol.html">$enrol</a> = <a class="function" onClick="logFunction('enrol_get_plugin')" href="../_functions/enrol_get_plugin.html" onMouseOver="funcPopup(event,'enrol_get_plugin')">enrol_get_plugin</a>('manual')) {
<a name="l925"><span class="linenum"> 925</span></a>          return false;
<a name="l926"><span class="linenum"> 926</span></a>      }
<a name="l927"><span class="linenum"> 927</span></a>      if (!<a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('enrol', array('enrol'=&gt;'manual', 'courseid'=&gt;<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>, 'status'=&gt;<a class="constant" onClick="logConstant('ENROL_INSTANCE_ENABLED')" href="../_constants/ENROL_INSTANCE_ENABLED.html" onMouseOver="constPopup(event,'ENROL_INSTANCE_ENABLED')">ENROL_INSTANCE_ENABLED</a>), 'sortorder,id ASC')) {
<a name="l928"><span class="linenum"> 928</span></a>          return false;
<a name="l929"><span class="linenum"> 929</span></a>      }
<a name="l930"><span class="linenum"> 930</span></a>      <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a>);
<a name="l931"><span class="linenum"> 931</span></a>  
<a name="l932"><span class="linenum"> 932</span></a>      <a class="var it747" onMouseOver="hilite(747)" onMouseOut="lolite()" onClick="logVariable('enrol')" href="../_variables/enrol.html">$enrol</a>-&gt;<a class="function" onClick="logFunction('enrol_user')" href="../_functions/enrol_user.html" onMouseOver="funcPopup(event,'enrol_user')">enrol_user</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, <a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../_variables/timestart.html">$timestart</a>, <a class="var it3001" onMouseOver="hilite(3001)" onMouseOut="lolite()" onClick="logVariable('timeend')" href="../_variables/timeend.html">$timeend</a>);
<a name="l933"><span class="linenum"> 933</span></a>  
<a name="l934"><span class="linenum"> 934</span></a>      return true;
<a name="l935"><span class="linenum"> 935</span></a>  }
<a name="l936"><span class="linenum"> 936</span></a>  
<a name="l937"><span class="linenum"> 937</span></a>  <span class="comment">/**</span>
<a name="l938"><span class="linenum"> 938</span></a>  <span class="comment"> * Is there a chance users might self enrol</span>
<a name="l939"><span class="linenum"> 939</span></a>  <span class="comment"> * @param int $courseid</span>
<a name="l940"><span class="linenum"> 940</span></a>  <span class="comment"> * @return bool</span>
<a name="l941"><span class="linenum"> 941</span></a>  <span class="comment"> */</span>
<a name="l942"><span class="linenum"> 942</span></a>  function <a class="function" onClick="logFunction('enrol_selfenrol_available')" href="../_functions/enrol_selfenrol_available.html" onMouseOver="funcPopup(event,'enrol_selfenrol_available')">enrol_selfenrol_available</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>) {
<a name="l943"><span class="linenum"> 943</span></a>      <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a> = false;
<a name="l944"><span class="linenum"> 944</span></a>  
<a name="l945"><span class="linenum"> 945</span></a>      <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a> = <a class="function" onClick="logFunction('enrol_get_plugins')" href="../_functions/enrol_get_plugins.html" onMouseOver="funcPopup(event,'enrol_get_plugins')">enrol_get_plugins</a>(true);
<a name="l946"><span class="linenum"> 946</span></a>      <a class="var it8379" onMouseOver="hilite(8379)" onMouseOut="lolite()" onClick="logVariable('enrolinstances')" href="../_variables/enrolinstances.html">$enrolinstances</a> = <a class="function" onClick="logFunction('enrol_get_instances')" href="../_functions/enrol_get_instances.html" onMouseOver="funcPopup(event,'enrol_get_instances')">enrol_get_instances</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>, true);
<a name="l947"><span class="linenum"> 947</span></a>      foreach(<a class="var it8379" onMouseOver="hilite(8379)" onMouseOut="lolite()" onClick="logVariable('enrolinstances')" href="../_variables/enrolinstances.html">$enrolinstances</a> as <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l948"><span class="linenum"> 948</span></a>          if (!isset(<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>[<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>])) {
<a name="l949"><span class="linenum"> 949</span></a>              continue;
<a name="l950"><span class="linenum"> 950</span></a>          }
<a name="l951"><span class="linenum"> 951</span></a>          if (<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a> === 'guest') {
<a name="l952"><span class="linenum"> 952</span></a>  <span class="comment">            // blacklist known temporary guest plugins</span>
<a name="l953"><span class="linenum"> 953</span></a>              continue;
<a name="l954"><span class="linenum"> 954</span></a>          }
<a name="l955"><span class="linenum"> 955</span></a>          if (<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('plugins')" href="../_variables/plugins.html">$plugins</a>[<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>]-&gt;<a class="function" onClick="logFunction('show_enrolme_link')" href="../_functions/show_enrolme_link.html" onMouseOver="funcPopup(event,'show_enrolme_link')">show_enrolme_link</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>)) {
<a name="l956"><span class="linenum"> 956</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a> = true;
<a name="l957"><span class="linenum"> 957</span></a>              break;
<a name="l958"><span class="linenum"> 958</span></a>          }
<a name="l959"><span class="linenum"> 959</span></a>      }
<a name="l960"><span class="linenum"> 960</span></a>  
<a name="l961"><span class="linenum"> 961</span></a>      return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>;
<a name="l962"><span class="linenum"> 962</span></a>  }
<a name="l963"><span class="linenum"> 963</span></a>  
<a name="l964"><span class="linenum"> 964</span></a>  <span class="comment">/**</span>
<a name="l965"><span class="linenum"> 965</span></a>  <span class="comment"> * This function returns the end of current active user enrolment.</span>
<a name="l966"><span class="linenum"> 966</span></a>  <span class="comment"> *</span>
<a name="l967"><span class="linenum"> 967</span></a>  <span class="comment"> * It deals correctly with multiple overlapping user enrolments.</span>
<a name="l968"><span class="linenum"> 968</span></a>  <span class="comment"> *</span>
<a name="l969"><span class="linenum"> 969</span></a>  <span class="comment"> * @param int $courseid</span>
<a name="l970"><span class="linenum"> 970</span></a>  <span class="comment"> * @param int $userid</span>
<a name="l971"><span class="linenum"> 971</span></a>  <span class="comment"> * @return int|bool timestamp when active enrolment ends, false means no active enrolment now, 0 means never</span>
<a name="l972"><span class="linenum"> 972</span></a>  <span class="comment"> */</span>
<a name="l973"><span class="linenum"> 973</span></a>  function <a class="function" onClick="logFunction('enrol_get_enrolment_end')" href="../_functions/enrol_get_enrolment_end.html" onMouseOver="funcPopup(event,'enrol_get_enrolment_end')">enrol_get_enrolment_end</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) {
<a name="l974"><span class="linenum"> 974</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l975"><span class="linenum"> 975</span></a>  
<a name="l976"><span class="linenum"> 976</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT ue.*
<a name="l977"><span class="linenum"> 977</span></a>                FROM {user_enrolments} ue
<a name="l978"><span class="linenum"> 978</span></a>                JOIN {enrol} e <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (e.id = ue.enrolid AND e.courseid = :courseid)
<a name="l979"><span class="linenum"> 979</span></a>                JOIN {user} u ON u.id = ue.userid
<a name="l980"><span class="linenum"> 980</span></a>               WHERE ue.userid = :userid AND ue.status = :active AND e.status = :enabled AND u.deleted = 0&quot;;
<a name="l981"><span class="linenum"> 981</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array('enabled'=&gt;<a class="constant" onClick="logConstant('ENROL_INSTANCE_ENABLED')" href="../_constants/ENROL_INSTANCE_ENABLED.html" onMouseOver="constPopup(event,'ENROL_INSTANCE_ENABLED')">ENROL_INSTANCE_ENABLED</a>, 'active'=&gt;<a class="constant" onClick="logConstant('ENROL_USER_ACTIVE')" href="../_constants/ENROL_USER_ACTIVE.html" onMouseOver="constPopup(event,'ENROL_USER_ACTIVE')">ENROL_USER_ACTIVE</a>, 'userid'=&gt;<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, 'courseid'=&gt;<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>);
<a name="l982"><span class="linenum"> 982</span></a>  
<a name="l983"><span class="linenum"> 983</span></a>      if (!<a class="var it18211" onMouseOver="hilite(18211)" onMouseOut="lolite()" onClick="logVariable('enrolments')" href="../_variables/enrolments.html">$enrolments</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>)) {
<a name="l984"><span class="linenum"> 984</span></a>          return false;
<a name="l985"><span class="linenum"> 985</span></a>      }
<a name="l986"><span class="linenum"> 986</span></a>  
<a name="l987"><span class="linenum"> 987</span></a>      <a class="var it6559" onMouseOver="hilite(6559)" onMouseOut="lolite()" onClick="logVariable('changes')" href="../_variables/changes.html">$changes</a> = array();
<a name="l988"><span class="linenum"> 988</span></a>  
<a name="l989"><span class="linenum"> 989</span></a>      foreach (<a class="var it18211" onMouseOver="hilite(18211)" onMouseOut="lolite()" onClick="logVariable('enrolments')" href="../_variables/enrolments.html">$enrolments</a> as <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>) {
<a name="l990"><span class="linenum"> 990</span></a>          <a class="var it133" onMouseOver="hilite(133)" onMouseOut="lolite()" onClick="logVariable('start')" href="../_variables/start.html">$start</a> = (int)<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('timestart')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/timestart.html">timestart</a>;
<a name="l991"><span class="linenum"> 991</span></a>          <a class="var it1128" onMouseOver="hilite(1128)" onMouseOut="lolite()" onClick="logVariable('end')" href="../_variables/end.html">$end</a> = (int)<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('timeend')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/timeend.html">timeend</a>;
<a name="l992"><span class="linenum"> 992</span></a>          if (<a class="var it1128" onMouseOver="hilite(1128)" onMouseOut="lolite()" onClick="logVariable('end')" href="../_variables/end.html">$end</a> != 0 and <a class="var it1128" onMouseOver="hilite(1128)" onMouseOut="lolite()" onClick="logVariable('end')" href="../_variables/end.html">$end</a> &lt; <a class="var it133" onMouseOver="hilite(133)" onMouseOut="lolite()" onClick="logVariable('start')" href="../_variables/start.html">$start</a>) {
<a name="l993"><span class="linenum"> 993</span></a>              <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Invalid enrolment start or end in user_enrolment id:'.<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('id')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l994"><span class="linenum"> 994</span></a>              continue;
<a name="l995"><span class="linenum"> 995</span></a>          }
<a name="l996"><span class="linenum"> 996</span></a>          if (isset(<a class="var it6559" onMouseOver="hilite(6559)" onMouseOut="lolite()" onClick="logVariable('changes')" href="../_variables/changes.html">$changes</a>[<a class="var it133" onMouseOver="hilite(133)" onMouseOut="lolite()" onClick="logVariable('start')" href="../_variables/start.html">$start</a>])) {
<a name="l997"><span class="linenum"> 997</span></a>              <a class="var it6559" onMouseOver="hilite(6559)" onMouseOut="lolite()" onClick="logVariable('changes')" href="../_variables/changes.html">$changes</a>[<a class="var it133" onMouseOver="hilite(133)" onMouseOut="lolite()" onClick="logVariable('start')" href="../_variables/start.html">$start</a>] = <a class="var it6559" onMouseOver="hilite(6559)" onMouseOut="lolite()" onClick="logVariable('changes')" href="../_variables/changes.html">$changes</a>[<a class="var it133" onMouseOver="hilite(133)" onMouseOut="lolite()" onClick="logVariable('start')" href="../_variables/start.html">$start</a>] + 1;
<a name="l998"><span class="linenum"> 998</span></a>          } else {
<a name="l999"><span class="linenum"> 999</span></a>              <a class="var it6559" onMouseOver="hilite(6559)" onMouseOut="lolite()" onClick="logVariable('changes')" href="../_variables/changes.html">$changes</a>[<a class="var it133" onMouseOver="hilite(133)" onMouseOut="lolite()" onClick="logVariable('start')" href="../_variables/start.html">$start</a>] = 1;
<a name="l1000"><span class="linenum">1000</span></a>          }
<a name="l1001"><span class="linenum">1001</span></a>          if (<a class="var it1128" onMouseOver="hilite(1128)" onMouseOut="lolite()" onClick="logVariable('end')" href="../_variables/end.html">$end</a> === 0) {
<a name="l1002"><span class="linenum">1002</span></a>  <span class="comment">            // no end</span>
<a name="l1003"><span class="linenum">1003</span></a>          } else if (isset(<a class="var it6559" onMouseOver="hilite(6559)" onMouseOut="lolite()" onClick="logVariable('changes')" href="../_variables/changes.html">$changes</a>[<a class="var it1128" onMouseOver="hilite(1128)" onMouseOut="lolite()" onClick="logVariable('end')" href="../_variables/end.html">$end</a>])) {
<a name="l1004"><span class="linenum">1004</span></a>              <a class="var it6559" onMouseOver="hilite(6559)" onMouseOut="lolite()" onClick="logVariable('changes')" href="../_variables/changes.html">$changes</a>[<a class="var it1128" onMouseOver="hilite(1128)" onMouseOut="lolite()" onClick="logVariable('end')" href="../_variables/end.html">$end</a>] = <a class="var it6559" onMouseOver="hilite(6559)" onMouseOut="lolite()" onClick="logVariable('changes')" href="../_variables/changes.html">$changes</a>[<a class="var it1128" onMouseOver="hilite(1128)" onMouseOut="lolite()" onClick="logVariable('end')" href="../_variables/end.html">$end</a>] - 1;
<a name="l1005"><span class="linenum">1005</span></a>          } else {
<a name="l1006"><span class="linenum">1006</span></a>              <a class="var it6559" onMouseOver="hilite(6559)" onMouseOut="lolite()" onClick="logVariable('changes')" href="../_variables/changes.html">$changes</a>[<a class="var it1128" onMouseOver="hilite(1128)" onMouseOut="lolite()" onClick="logVariable('end')" href="../_variables/end.html">$end</a>] = -1;
<a name="l1007"><span class="linenum">1007</span></a>          }
<a name="l1008"><span class="linenum">1008</span></a>      }
<a name="l1009"><span class="linenum">1009</span></a>  
<a name="l1010"><span class="linenum">1010</span></a>  <span class="comment">    // let's sort then enrolment starts&amp;ends and go through them chronologically,</span>
<a name="l1011"><span class="linenum">1011</span></a>  <span class="comment">    // looking for current status and the next future end of enrolment</span>
<a name="l1012"><span class="linenum">1012</span></a>      <a class="phpfunction" onClick="logFunction('ksort')" href="../_functions/ksort.html" onMouseOver="phpfuncPopup(event,'ksort')">ksort</a>(<a class="var it6559" onMouseOver="hilite(6559)" onMouseOut="lolite()" onClick="logVariable('changes')" href="../_variables/changes.html">$changes</a>);
<a name="l1013"><span class="linenum">1013</span></a>  
<a name="l1014"><span class="linenum">1014</span></a>      <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1015"><span class="linenum">1015</span></a>      <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../_variables/current.html">$current</a> = 0;
<a name="l1016"><span class="linenum">1016</span></a>      <a class="var it8460" onMouseOver="hilite(8460)" onMouseOut="lolite()" onClick="logVariable('present')" href="../_variables/present.html">$present</a> = null;
<a name="l1017"><span class="linenum">1017</span></a>  
<a name="l1018"><span class="linenum">1018</span></a>      foreach (<a class="var it6559" onMouseOver="hilite(6559)" onMouseOut="lolite()" onClick="logVariable('changes')" href="../_variables/changes.html">$changes</a> as <a class="var it14" onMouseOver="hilite(14)" onMouseOut="lolite()" onClick="logVariable('time')" href="../_variables/time.html">$time</a> =&gt; <a class="var it19853" onMouseOver="hilite(19853)" onMouseOut="lolite()" onClick="logVariable('change')" href="../_variables/change.html">$change</a>) {
<a name="l1019"><span class="linenum">1019</span></a>          if (<a class="var it14" onMouseOver="hilite(14)" onMouseOut="lolite()" onClick="logVariable('time')" href="../_variables/time.html">$time</a> &gt; <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../_variables/now.html">$now</a>) {
<a name="l1020"><span class="linenum">1020</span></a>              if (<a class="var it8460" onMouseOver="hilite(8460)" onMouseOut="lolite()" onClick="logVariable('present')" href="../_variables/present.html">$present</a> === null) {
<a name="l1021"><span class="linenum">1021</span></a>  <span class="comment">                // we have just went past current time</span>
<a name="l1022"><span class="linenum">1022</span></a>                  <a class="var it8460" onMouseOver="hilite(8460)" onMouseOut="lolite()" onClick="logVariable('present')" href="../_variables/present.html">$present</a> = <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../_variables/current.html">$current</a>;
<a name="l1023"><span class="linenum">1023</span></a>                  if (<a class="var it8460" onMouseOver="hilite(8460)" onMouseOut="lolite()" onClick="logVariable('present')" href="../_variables/present.html">$present</a> &lt; 1) {
<a name="l1024"><span class="linenum">1024</span></a>  <span class="comment">                    // no enrolment active</span>
<a name="l1025"><span class="linenum">1025</span></a>                      return false;
<a name="l1026"><span class="linenum">1026</span></a>                  }
<a name="l1027"><span class="linenum">1027</span></a>              }
<a name="l1028"><span class="linenum">1028</span></a>              if (<a class="var it8460" onMouseOver="hilite(8460)" onMouseOut="lolite()" onClick="logVariable('present')" href="../_variables/present.html">$present</a> !== null) {
<a name="l1029"><span class="linenum">1029</span></a>  <span class="comment">                // we are already in the future - look for possible end</span>
<a name="l1030"><span class="linenum">1030</span></a>                  if (<a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../_variables/current.html">$current</a> + <a class="var it19853" onMouseOver="hilite(19853)" onMouseOut="lolite()" onClick="logVariable('change')" href="../_variables/change.html">$change</a> &lt; 1) {
<a name="l1031"><span class="linenum">1031</span></a>                      return <a class="var it14" onMouseOver="hilite(14)" onMouseOut="lolite()" onClick="logVariable('time')" href="../_variables/time.html">$time</a>;
<a name="l1032"><span class="linenum">1032</span></a>                  }
<a name="l1033"><span class="linenum">1033</span></a>              }
<a name="l1034"><span class="linenum">1034</span></a>          }
<a name="l1035"><span class="linenum">1035</span></a>          <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../_variables/current.html">$current</a> += <a class="var it19853" onMouseOver="hilite(19853)" onMouseOut="lolite()" onClick="logVariable('change')" href="../_variables/change.html">$change</a>;
<a name="l1036"><span class="linenum">1036</span></a>      }
<a name="l1037"><span class="linenum">1037</span></a>  
<a name="l1038"><span class="linenum">1038</span></a>      if (<a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../_variables/current.html">$current</a> &gt; 0) {
<a name="l1039"><span class="linenum">1039</span></a>          return 0;
<a name="l1040"><span class="linenum">1040</span></a>      } else {
<a name="l1041"><span class="linenum">1041</span></a>          return false;
<a name="l1042"><span class="linenum">1042</span></a>      }
<a name="l1043"><span class="linenum">1043</span></a>  }
<a name="l1044"><span class="linenum">1044</span></a>  
<a name="l1045"><span class="linenum">1045</span></a>  <span class="comment">/**</span>
<a name="l1046"><span class="linenum">1046</span></a>  <span class="comment"> * Is current user accessing course via this enrolment method?</span>
<a name="l1047"><span class="linenum">1047</span></a>  <span class="comment"> *</span>
<a name="l1048"><span class="linenum">1048</span></a>  <span class="comment"> * This is intended for operations that are going to affect enrol instances.</span>
<a name="l1049"><span class="linenum">1049</span></a>  <span class="comment"> *</span>
<a name="l1050"><span class="linenum">1050</span></a>  <span class="comment"> * @param stdClass $instance enrol instance</span>
<a name="l1051"><span class="linenum">1051</span></a>  <span class="comment"> * @return bool</span>
<a name="l1052"><span class="linenum">1052</span></a>  <span class="comment"> */</span>
<a name="l1053"><span class="linenum">1053</span></a>  function <a class="function" onClick="logFunction('enrol_accessing_via_instance')" href="../_functions/enrol_accessing_via_instance.html" onMouseOver="funcPopup(event,'enrol_accessing_via_instance')">enrol_accessing_via_instance</a>(stdClass <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l1054"><span class="linenum">1054</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l1055"><span class="linenum">1055</span></a>  
<a name="l1056"><span class="linenum">1056</span></a>      if (empty(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>)) {
<a name="l1057"><span class="linenum">1057</span></a>          return false;
<a name="l1058"><span class="linenum">1058</span></a>      }
<a name="l1059"><span class="linenum">1059</span></a>  
<a name="l1060"><span class="linenum">1060</span></a>      if (<a class="function" onClick="logFunction('is_siteadmin')" href="../_functions/is_siteadmin.html" onMouseOver="funcPopup(event,'is_siteadmin')">is_siteadmin</a>()) {
<a name="l1061"><span class="linenum">1061</span></a>  <span class="comment">        // Admins may go anywhere.</span>
<a name="l1062"><span class="linenum">1062</span></a>          return false;
<a name="l1063"><span class="linenum">1063</span></a>      }
<a name="l1064"><span class="linenum">1064</span></a>  
<a name="l1065"><span class="linenum">1065</span></a>      return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('user_enrolments', array('userid'=&gt;<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'enrolid'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l1066"><span class="linenum">1066</span></a>  }
<a name="l1067"><span class="linenum">1067</span></a>  
<a name="l1068"><span class="linenum">1068</span></a>  
<a name="l1069"><span class="linenum">1069</span></a>  <span class="comment">/**</span>
<a name="l1070"><span class="linenum">1070</span></a>  <span class="comment"> * All enrol plugins should be based on this class,</span>
<a name="l1071"><span class="linenum">1071</span></a>  <span class="comment"> * this is also the main source of documentation.</span>
<a name="l1072"><span class="linenum">1072</span></a>  <span class="comment"> */</span>
<a name="l1073"><span class="linenum">1073</span></a>  abstract class enrol_plugin {
<a name="l1074"><span class="linenum">1074</span></a>      protected <a class="var it199" onMouseOver="hilite(199)" onMouseOut="lolite()" onClick="logVariable('config')" href="../_variables/config.html">$config</a> = null;
<a name="l1075"><span class="linenum">1075</span></a>  
<a name="l1076"><span class="linenum">1076</span></a>      <span class="comment">/**</span>
<a name="l1077"><span class="linenum">1077</span></a>  <span class="comment">     * Returns name of this enrol plugin</span>
<a name="l1078"><span class="linenum">1078</span></a>  <span class="comment">     * @return string</span>
<a name="l1079"><span class="linenum">1079</span></a>  <span class="comment">     */</span>
<a name="l1080"><span class="linenum">1080</span></a>      public function <a class="function" onClick="logFunction('get_name')" href="../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>() {
<a name="l1081"><span class="linenum">1081</span></a>  <span class="comment">        // second word in class is always enrol name, sorry, no fancy plugin names with _</span>
<a name="l1082"><span class="linenum">1082</span></a>          <a class="var it131" onMouseOver="hilite(131)" onMouseOut="lolite()" onClick="logVariable('words')" href="../_variables/words.html">$words</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>('_', <a class="phpfunction" onClick="logFunction('get_class')" href="../_functions/get_class.html" onMouseOver="phpfuncPopup(event,'get_class')">get_class</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>));
<a name="l1083"><span class="linenum">1083</span></a>          return <a class="var it131" onMouseOver="hilite(131)" onMouseOut="lolite()" onClick="logVariable('words')" href="../_variables/words.html">$words</a>[1];
<a name="l1084"><span class="linenum">1084</span></a>      }
<a name="l1085"><span class="linenum">1085</span></a>  
<a name="l1086"><span class="linenum">1086</span></a>      <span class="comment">/**</span>
<a name="l1087"><span class="linenum">1087</span></a>  <span class="comment">     * Returns localised name of enrol instance</span>
<a name="l1088"><span class="linenum">1088</span></a>  <span class="comment">     *</span>
<a name="l1089"><span class="linenum">1089</span></a>  <span class="comment">     * @param object $instance (null is accepted too)</span>
<a name="l1090"><span class="linenum">1090</span></a>  <span class="comment">     * @return string</span>
<a name="l1091"><span class="linenum">1091</span></a>  <span class="comment">     */</span>
<a name="l1092"><span class="linenum">1092</span></a>      public function <a class="function" onClick="logFunction('get_instance_name')" href="../_functions/get_instance_name.html" onMouseOver="funcPopup(event,'get_instance_name')">get_instance_name</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l1093"><span class="linenum">1093</span></a>          if (empty(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('name')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/name.html">name</a>)) {
<a name="l1094"><span class="linenum">1094</span></a>              <a class="var it747" onMouseOver="hilite(747)" onMouseOut="lolite()" onClick="logVariable('enrol')" href="../_variables/enrol.html">$enrol</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>();
<a name="l1095"><span class="linenum">1095</span></a>              return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('pluginname', 'enrol_'.<a class="var it747" onMouseOver="hilite(747)" onMouseOut="lolite()" onClick="logVariable('enrol')" href="../_variables/enrol.html">$enrol</a>);
<a name="l1096"><span class="linenum">1096</span></a>          } else {
<a name="l1097"><span class="linenum">1097</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>);
<a name="l1098"><span class="linenum">1098</span></a>              return <a class="function" onClick="logFunction('format_string')" href="../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('name')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/name.html">name</a>, true, array('context'=&gt;<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>));
<a name="l1099"><span class="linenum">1099</span></a>          }
<a name="l1100"><span class="linenum">1100</span></a>      }
<a name="l1101"><span class="linenum">1101</span></a>  
<a name="l1102"><span class="linenum">1102</span></a>      <span class="comment">/**</span>
<a name="l1103"><span class="linenum">1103</span></a>  <span class="comment">     * Returns optional enrolment information icons.</span>
<a name="l1104"><span class="linenum">1104</span></a>  <span class="comment">     *</span>
<a name="l1105"><span class="linenum">1105</span></a>  <span class="comment">     * This is used in course list for quick overview of enrolment options.</span>
<a name="l1106"><span class="linenum">1106</span></a>  <span class="comment">     *</span>
<a name="l1107"><span class="linenum">1107</span></a>  <span class="comment">     * We are not using single instance parameter because sometimes</span>
<a name="l1108"><span class="linenum">1108</span></a>  <span class="comment">     * we might want to prevent icon repetition when multiple instances</span>
<a name="l1109"><span class="linenum">1109</span></a>  <span class="comment">     * of one type exist. One instance may also produce several icons.</span>
<a name="l1110"><span class="linenum">1110</span></a>  <span class="comment">     *</span>
<a name="l1111"><span class="linenum">1111</span></a>  <span class="comment">     * @param array $instances all enrol instances of this type in one course</span>
<a name="l1112"><span class="linenum">1112</span></a>  <span class="comment">     * @return array of pix_icon</span>
<a name="l1113"><span class="linenum">1113</span></a>  <span class="comment">     */</span>
<a name="l1114"><span class="linenum">1114</span></a>      public function <a class="function" onClick="logFunction('get_info_icons')" href="../_functions/get_info_icons.html" onMouseOver="funcPopup(event,'get_info_icons')">get_info_icons</a>(array <a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a>) {
<a name="l1115"><span class="linenum">1115</span></a>          return array();
<a name="l1116"><span class="linenum">1116</span></a>      }
<a name="l1117"><span class="linenum">1117</span></a>  
<a name="l1118"><span class="linenum">1118</span></a>      <span class="comment">/**</span>
<a name="l1119"><span class="linenum">1119</span></a>  <span class="comment">     * Returns optional enrolment instance description text.</span>
<a name="l1120"><span class="linenum">1120</span></a>  <span class="comment">     *</span>
<a name="l1121"><span class="linenum">1121</span></a>  <span class="comment">     * This is used in detailed course information.</span>
<a name="l1122"><span class="linenum">1122</span></a>  <span class="comment">     *</span>
<a name="l1123"><span class="linenum">1123</span></a>  <span class="comment">     *</span>
<a name="l1124"><span class="linenum">1124</span></a>  <span class="comment">     * @param object $instance</span>
<a name="l1125"><span class="linenum">1125</span></a>  <span class="comment">     * @return string short html text</span>
<a name="l1126"><span class="linenum">1126</span></a>  <span class="comment">     */</span>
<a name="l1127"><span class="linenum">1127</span></a>      public function <a class="function" onClick="logFunction('get_description_text')" href="../_functions/get_description_text.html" onMouseOver="funcPopup(event,'get_description_text')">get_description_text</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l1128"><span class="linenum">1128</span></a>          return null;
<a name="l1129"><span class="linenum">1129</span></a>      }
<a name="l1130"><span class="linenum">1130</span></a>  
<a name="l1131"><span class="linenum">1131</span></a>      <span class="comment">/**</span>
<a name="l1132"><span class="linenum">1132</span></a>  <span class="comment">     * Makes sure config is loaded and cached.</span>
<a name="l1133"><span class="linenum">1133</span></a>  <span class="comment">     * @return void</span>
<a name="l1134"><span class="linenum">1134</span></a>  <span class="comment">     */</span>
<a name="l1135"><span class="linenum">1135</span></a>      protected function <a class="function" onClick="logFunction('load_config')" href="../_functions/load_config.html" onMouseOver="funcPopup(event,'load_config')">load_config</a>() {
<a name="l1136"><span class="linenum">1136</span></a>          if (!isset(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/config.html">config</a>)) {
<a name="l1137"><span class="linenum">1137</span></a>              <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>();
<a name="l1138"><span class="linenum">1138</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/config.html">config</a> = <a class="function" onClick="logFunction('get_config')" href="../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>(&quot;enrol_<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>&quot;);
<a name="l1139"><span class="linenum">1139</span></a>          }
<a name="l1140"><span class="linenum">1140</span></a>      }
<a name="l1141"><span class="linenum">1141</span></a>  
<a name="l1142"><span class="linenum">1142</span></a>      <span class="comment">/**</span>
<a name="l1143"><span class="linenum">1143</span></a>  <span class="comment">     * Returns plugin config value</span>
<a name="l1144"><span class="linenum">1144</span></a>  <span class="comment">     * @param  string $name</span>
<a name="l1145"><span class="linenum">1145</span></a>  <span class="comment">     * @param  string $default value if config does not exist yet</span>
<a name="l1146"><span class="linenum">1146</span></a>  <span class="comment">     * @return string value or default</span>
<a name="l1147"><span class="linenum">1147</span></a>  <span class="comment">     */</span>
<a name="l1148"><span class="linenum">1148</span></a>      public function <a class="function" onClick="logFunction('get_config')" href="../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>(<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>, <a class="var it777" onMouseOver="hilite(777)" onMouseOut="lolite()" onClick="logVariable('default')" href="../_variables/default.html">$default</a> = NULL) {
<a name="l1149"><span class="linenum">1149</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('load_config')" href="../_functions/load_config.html" onMouseOver="funcPopup(event,'load_config')">load_config</a>();
<a name="l1150"><span class="linenum">1150</span></a>          return isset(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/config.html">config</a>-&gt;<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>) ? <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/config.html">config</a>-&gt;<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> : <a class="var it777" onMouseOver="hilite(777)" onMouseOut="lolite()" onClick="logVariable('default')" href="../_variables/default.html">$default</a>;
<a name="l1151"><span class="linenum">1151</span></a>      }
<a name="l1152"><span class="linenum">1152</span></a>  
<a name="l1153"><span class="linenum">1153</span></a>      <span class="comment">/**</span>
<a name="l1154"><span class="linenum">1154</span></a>  <span class="comment">     * Sets plugin config value</span>
<a name="l1155"><span class="linenum">1155</span></a>  <span class="comment">     * @param  string $name name of config</span>
<a name="l1156"><span class="linenum">1156</span></a>  <span class="comment">     * @param  string $value string config value, null means delete</span>
<a name="l1157"><span class="linenum">1157</span></a>  <span class="comment">     * @return string value</span>
<a name="l1158"><span class="linenum">1158</span></a>  <span class="comment">     */</span>
<a name="l1159"><span class="linenum">1159</span></a>      public function <a class="function" onClick="logFunction('set_config')" href="../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>(<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>, <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../_variables/value.html">$value</a>) {
<a name="l1160"><span class="linenum">1160</span></a>          <a class="var it2767" onMouseOver="hilite(2767)" onMouseOut="lolite()" onClick="logVariable('pluginname')" href="../_variables/pluginname.html">$pluginname</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>();
<a name="l1161"><span class="linenum">1161</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('load_config')" href="../_functions/load_config.html" onMouseOver="funcPopup(event,'load_config')">load_config</a>();
<a name="l1162"><span class="linenum">1162</span></a>          if (<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../_variables/value.html">$value</a> === NULL) {
<a name="l1163"><span class="linenum">1163</span></a>              unset(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/config.html">config</a>-&gt;<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>);
<a name="l1164"><span class="linenum">1164</span></a>          } else {
<a name="l1165"><span class="linenum">1165</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('config')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/config.html">config</a>-&gt;<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../_variables/value.html">$value</a>;
<a name="l1166"><span class="linenum">1166</span></a>          }
<a name="l1167"><span class="linenum">1167</span></a>          <a class="function" onClick="logFunction('set_config')" href="../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>(<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>, <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../_variables/value.html">$value</a>, &quot;enrol_<a class="var it2767" onMouseOver="hilite(2767)" onMouseOut="lolite()" onClick="logVariable('pluginname')" href="../_variables/pluginname.html">$pluginname</a>&quot;);
<a name="l1168"><span class="linenum">1168</span></a>      }
<a name="l1169"><span class="linenum">1169</span></a>  
<a name="l1170"><span class="linenum">1170</span></a>      <span class="comment">/**</span>
<a name="l1171"><span class="linenum">1171</span></a>  <span class="comment">     * Does this plugin assign protected roles are can they be manually removed?</span>
<a name="l1172"><span class="linenum">1172</span></a>  <span class="comment">     * @return bool - false means anybody may tweak roles, it does not use itemid and component when assigning roles</span>
<a name="l1173"><span class="linenum">1173</span></a>  <span class="comment">     */</span>
<a name="l1174"><span class="linenum">1174</span></a>      public function <a class="function" onClick="logFunction('roles_protected')" href="../_functions/roles_protected.html" onMouseOver="funcPopup(event,'roles_protected')">roles_protected</a>() {
<a name="l1175"><span class="linenum">1175</span></a>          return true;
<a name="l1176"><span class="linenum">1176</span></a>      }
<a name="l1177"><span class="linenum">1177</span></a>  
<a name="l1178"><span class="linenum">1178</span></a>      <span class="comment">/**</span>
<a name="l1179"><span class="linenum">1179</span></a>  <span class="comment">     * Does this plugin allow manual enrolments?</span>
<a name="l1180"><span class="linenum">1180</span></a>  <span class="comment">     *</span>
<a name="l1181"><span class="linenum">1181</span></a>  <span class="comment">     * @param stdClass $instance course enrol instance</span>
<a name="l1182"><span class="linenum">1182</span></a>  <span class="comment">     * All plugins allowing this must implement 'enrol/xxx:enrol' capability</span>
<a name="l1183"><span class="linenum">1183</span></a>  <span class="comment">     *</span>
<a name="l1184"><span class="linenum">1184</span></a>  <span class="comment">     * @return bool - true means user with 'enrol/xxx:enrol' may enrol others freely, false means nobody may add more enrolments manually</span>
<a name="l1185"><span class="linenum">1185</span></a>  <span class="comment">     */</span>
<a name="l1186"><span class="linenum">1186</span></a>      public function <a class="function" onClick="logFunction('allow_enrol')" href="../_functions/allow_enrol.html" onMouseOver="funcPopup(event,'allow_enrol')">allow_enrol</a>(stdClass <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l1187"><span class="linenum">1187</span></a>          return false;
<a name="l1188"><span class="linenum">1188</span></a>      }
<a name="l1189"><span class="linenum">1189</span></a>  
<a name="l1190"><span class="linenum">1190</span></a>      <span class="comment">/**</span>
<a name="l1191"><span class="linenum">1191</span></a>  <span class="comment">     * Does this plugin allow manual unenrolment of all users?</span>
<a name="l1192"><span class="linenum">1192</span></a>  <span class="comment">     * All plugins allowing this must implement 'enrol/xxx:unenrol' capability</span>
<a name="l1193"><span class="linenum">1193</span></a>  <span class="comment">     *</span>
<a name="l1194"><span class="linenum">1194</span></a>  <span class="comment">     * @param stdClass $instance course enrol instance</span>
<a name="l1195"><span class="linenum">1195</span></a>  <span class="comment">     * @return bool - true means user with 'enrol/xxx:unenrol' may unenrol others freely, false means nobody may touch user_enrolments</span>
<a name="l1196"><span class="linenum">1196</span></a>  <span class="comment">     */</span>
<a name="l1197"><span class="linenum">1197</span></a>      public function <a class="function" onClick="logFunction('allow_unenrol')" href="../_functions/allow_unenrol.html" onMouseOver="funcPopup(event,'allow_unenrol')">allow_unenrol</a>(stdClass <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l1198"><span class="linenum">1198</span></a>          return false;
<a name="l1199"><span class="linenum">1199</span></a>      }
<a name="l1200"><span class="linenum">1200</span></a>  
<a name="l1201"><span class="linenum">1201</span></a>      <span class="comment">/**</span>
<a name="l1202"><span class="linenum">1202</span></a>  <span class="comment">     * Does this plugin allow manual unenrolment of a specific user?</span>
<a name="l1203"><span class="linenum">1203</span></a>  <span class="comment">     * All plugins allowing this must implement 'enrol/xxx:unenrol' capability</span>
<a name="l1204"><span class="linenum">1204</span></a>  <span class="comment">     *</span>
<a name="l1205"><span class="linenum">1205</span></a>  <span class="comment">     * This is useful especially for synchronisation plugins that</span>
<a name="l1206"><span class="linenum">1206</span></a>  <span class="comment">     * do suspend instead of full unenrolment.</span>
<a name="l1207"><span class="linenum">1207</span></a>  <span class="comment">     *</span>
<a name="l1208"><span class="linenum">1208</span></a>  <span class="comment">     * @param stdClass $instance course enrol instance</span>
<a name="l1209"><span class="linenum">1209</span></a>  <span class="comment">     * @param stdClass $ue record from user_enrolments table, specifies user</span>
<a name="l1210"><span class="linenum">1210</span></a>  <span class="comment">     *</span>
<a name="l1211"><span class="linenum">1211</span></a>  <span class="comment">     * @return bool - true means user with 'enrol/xxx:unenrol' may unenrol this user, false means nobody may touch this user enrolment</span>
<a name="l1212"><span class="linenum">1212</span></a>  <span class="comment">     */</span>
<a name="l1213"><span class="linenum">1213</span></a>      public function <a class="function" onClick="logFunction('allow_unenrol_user')" href="../_functions/allow_unenrol_user.html" onMouseOver="funcPopup(event,'allow_unenrol_user')">allow_unenrol_user</a>(stdClass <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>, stdClass <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>) {
<a name="l1214"><span class="linenum">1214</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('allow_unenrol')" href="../_functions/allow_unenrol.html" onMouseOver="funcPopup(event,'allow_unenrol')">allow_unenrol</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>);
<a name="l1215"><span class="linenum">1215</span></a>      }
<a name="l1216"><span class="linenum">1216</span></a>  
<a name="l1217"><span class="linenum">1217</span></a>      <span class="comment">/**</span>
<a name="l1218"><span class="linenum">1218</span></a>  <span class="comment">     * Does this plugin allow manual changes in user_enrolments table?</span>
<a name="l1219"><span class="linenum">1219</span></a>  <span class="comment">     *</span>
<a name="l1220"><span class="linenum">1220</span></a>  <span class="comment">     * All plugins allowing this must implement 'enrol/xxx:manage' capability</span>
<a name="l1221"><span class="linenum">1221</span></a>  <span class="comment">     *</span>
<a name="l1222"><span class="linenum">1222</span></a>  <span class="comment">     * @param stdClass $instance course enrol instance</span>
<a name="l1223"><span class="linenum">1223</span></a>  <span class="comment">     * @return bool - true means it is possible to change enrol period and status in user_enrolments table</span>
<a name="l1224"><span class="linenum">1224</span></a>  <span class="comment">     */</span>
<a name="l1225"><span class="linenum">1225</span></a>      public function <a class="function" onClick="logFunction('allow_manage')" href="../_functions/allow_manage.html" onMouseOver="funcPopup(event,'allow_manage')">allow_manage</a>(stdClass <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l1226"><span class="linenum">1226</span></a>          return false;
<a name="l1227"><span class="linenum">1227</span></a>      }
<a name="l1228"><span class="linenum">1228</span></a>  
<a name="l1229"><span class="linenum">1229</span></a>      <span class="comment">/**</span>
<a name="l1230"><span class="linenum">1230</span></a>  <span class="comment">     * Does this plugin support some way to user to self enrol?</span>
<a name="l1231"><span class="linenum">1231</span></a>  <span class="comment">     *</span>
<a name="l1232"><span class="linenum">1232</span></a>  <span class="comment">     * @param stdClass $instance course enrol instance</span>
<a name="l1233"><span class="linenum">1233</span></a>  <span class="comment">     *</span>
<a name="l1234"><span class="linenum">1234</span></a>  <span class="comment">     * @return bool - true means show &quot;Enrol me in this course&quot; link in course UI</span>
<a name="l1235"><span class="linenum">1235</span></a>  <span class="comment">     */</span>
<a name="l1236"><span class="linenum">1236</span></a>      public function <a class="function" onClick="logFunction('show_enrolme_link')" href="../_functions/show_enrolme_link.html" onMouseOver="funcPopup(event,'show_enrolme_link')">show_enrolme_link</a>(stdClass <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l1237"><span class="linenum">1237</span></a>          return false;
<a name="l1238"><span class="linenum">1238</span></a>      }
<a name="l1239"><span class="linenum">1239</span></a>  
<a name="l1240"><span class="linenum">1240</span></a>      <span class="comment">/**</span>
<a name="l1241"><span class="linenum">1241</span></a>  <span class="comment">     * Attempt to automatically enrol current user in course without any interaction,</span>
<a name="l1242"><span class="linenum">1242</span></a>  <span class="comment">     * calling code has to make sure the plugin and instance are active.</span>
<a name="l1243"><span class="linenum">1243</span></a>  <span class="comment">     *</span>
<a name="l1244"><span class="linenum">1244</span></a>  <span class="comment">     * This should return either a timestamp in the future or false.</span>
<a name="l1245"><span class="linenum">1245</span></a>  <span class="comment">     *</span>
<a name="l1246"><span class="linenum">1246</span></a>  <span class="comment">     * @param stdClass $instance course enrol instance</span>
<a name="l1247"><span class="linenum">1247</span></a>  <span class="comment">     * @return bool|int false means not enrolled, integer means timeend</span>
<a name="l1248"><span class="linenum">1248</span></a>  <span class="comment">     */</span>
<a name="l1249"><span class="linenum">1249</span></a>      public function <a class="function" onClick="logFunction('try_autoenrol')" href="../_functions/try_autoenrol.html" onMouseOver="funcPopup(event,'try_autoenrol')">try_autoenrol</a>(stdClass <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l1250"><span class="linenum">1250</span></a>          global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l1251"><span class="linenum">1251</span></a>  
<a name="l1252"><span class="linenum">1252</span></a>          return false;
<a name="l1253"><span class="linenum">1253</span></a>      }
<a name="l1254"><span class="linenum">1254</span></a>  
<a name="l1255"><span class="linenum">1255</span></a>      <span class="comment">/**</span>
<a name="l1256"><span class="linenum">1256</span></a>  <span class="comment">     * Attempt to automatically gain temporary guest access to course,</span>
<a name="l1257"><span class="linenum">1257</span></a>  <span class="comment">     * calling code has to make sure the plugin and instance are active.</span>
<a name="l1258"><span class="linenum">1258</span></a>  <span class="comment">     *</span>
<a name="l1259"><span class="linenum">1259</span></a>  <span class="comment">     * This should return either a timestamp in the future or false.</span>
<a name="l1260"><span class="linenum">1260</span></a>  <span class="comment">     *</span>
<a name="l1261"><span class="linenum">1261</span></a>  <span class="comment">     * @param stdClass $instance course enrol instance</span>
<a name="l1262"><span class="linenum">1262</span></a>  <span class="comment">     * @return bool|int false means no guest access, integer means timeend</span>
<a name="l1263"><span class="linenum">1263</span></a>  <span class="comment">     */</span>
<a name="l1264"><span class="linenum">1264</span></a>      public function <a class="function" onClick="logFunction('try_guestaccess')" href="../_functions/try_guestaccess.html" onMouseOver="funcPopup(event,'try_guestaccess')">try_guestaccess</a>(stdClass <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l1265"><span class="linenum">1265</span></a>          global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l1266"><span class="linenum">1266</span></a>  
<a name="l1267"><span class="linenum">1267</span></a>          return false;
<a name="l1268"><span class="linenum">1268</span></a>      }
<a name="l1269"><span class="linenum">1269</span></a>  
<a name="l1270"><span class="linenum">1270</span></a>      <span class="comment">/**</span>
<a name="l1271"><span class="linenum">1271</span></a>  <span class="comment">     * Enrol user into course via enrol instance.</span>
<a name="l1272"><span class="linenum">1272</span></a>  <span class="comment">     *</span>
<a name="l1273"><span class="linenum">1273</span></a>  <span class="comment">     * @param stdClass $instance</span>
<a name="l1274"><span class="linenum">1274</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l1275"><span class="linenum">1275</span></a>  <span class="comment">     * @param int $roleid optional role id</span>
<a name="l1276"><span class="linenum">1276</span></a>  <span class="comment">     * @param int $timestart 0 means unknown</span>
<a name="l1277"><span class="linenum">1277</span></a>  <span class="comment">     * @param int $timeend 0 means forever</span>
<a name="l1278"><span class="linenum">1278</span></a>  <span class="comment">     * @param int $status default to ENROL_USER_ACTIVE for new enrolments, no change by default in updates</span>
<a name="l1279"><span class="linenum">1279</span></a>  <span class="comment">     * @param bool $recovergrades restore grade history</span>
<a name="l1280"><span class="linenum">1280</span></a>  <span class="comment">     * @return void</span>
<a name="l1281"><span class="linenum">1281</span></a>  <span class="comment">     */</span>
<a name="l1282"><span class="linenum">1282</span></a>      public function <a class="function" onClick="logFunction('enrol_user')" href="../_functions/enrol_user.html" onMouseOver="funcPopup(event,'enrol_user')">enrol_user</a>(stdClass <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a> = null, <a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../_variables/timestart.html">$timestart</a> = 0, <a class="var it3001" onMouseOver="hilite(3001)" onMouseOut="lolite()" onClick="logVariable('timeend')" href="../_variables/timeend.html">$timeend</a> = 0, <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../_variables/status.html">$status</a> = null, <a class="var it4198" onMouseOver="hilite(4198)" onMouseOut="lolite()" onClick="logVariable('recovergrades')" href="../_variables/recovergrades.html">$recovergrades</a> = null) {
<a name="l1283"><span class="linenum">1283</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>; <span class="comment">// CFG necessary!!!</span>
<a name="l1284"><span class="linenum">1284</span></a>  
<a name="l1285"><span class="linenum">1285</span></a>          if (<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a> == <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>) {
<a name="l1286"><span class="linenum">1286</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('invalid attempt to enrol into frontpage course!');
<a name="l1287"><span class="linenum">1287</span></a>          }
<a name="l1288"><span class="linenum">1288</span></a>  
<a name="l1289"><span class="linenum">1289</span></a>          <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>();
<a name="l1290"><span class="linenum">1290</span></a>          <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a> = <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>;
<a name="l1291"><span class="linenum">1291</span></a>  
<a name="l1292"><span class="linenum">1292</span></a>          if (<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a> !== <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>) {
<a name="l1293"><span class="linenum">1293</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('invalid enrol instance!');
<a name="l1294"><span class="linenum">1294</span></a>          }
<a name="l1295"><span class="linenum">1295</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l1296"><span class="linenum">1296</span></a>          if (!isset(<a class="var it4198" onMouseOver="hilite(4198)" onMouseOut="lolite()" onClick="logVariable('recovergrades')" href="../_variables/recovergrades.html">$recovergrades</a>)) {
<a name="l1297"><span class="linenum">1297</span></a>              <a class="var it4198" onMouseOver="hilite(4198)" onMouseOut="lolite()" onClick="logVariable('recovergrades')" href="../_variables/recovergrades.html">$recovergrades</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('recovergradesdefault')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/recovergradesdefault.html">recovergradesdefault</a>;
<a name="l1298"><span class="linenum">1298</span></a>          }
<a name="l1299"><span class="linenum">1299</span></a>  
<a name="l1300"><span class="linenum">1300</span></a>          <a class="var it4917" onMouseOver="hilite(4917)" onMouseOut="lolite()" onClick="logVariable('inserted')" href="../_variables/inserted.html">$inserted</a> = false;
<a name="l1301"><span class="linenum">1301</span></a>          <a class="var it5658" onMouseOver="hilite(5658)" onMouseOut="lolite()" onClick="logVariable('updated')" href="../_variables/updated.html">$updated</a>  = false;
<a name="l1302"><span class="linenum">1302</span></a>          if (<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user_enrolments', array('enrolid'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'userid'=&gt;<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>))) {
<a name="l1303"><span class="linenum">1303</span></a>  <span class="comment">            //only update if timestart or timeend or status are different.</span>
<a name="l1304"><span class="linenum">1304</span></a>              if (<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('timestart')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/timestart.html">timestart</a> != <a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../_variables/timestart.html">$timestart</a> or <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('timeend')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/timeend.html">timeend</a> != <a class="var it3001" onMouseOver="hilite(3001)" onMouseOut="lolite()" onClick="logVariable('timeend')" href="../_variables/timeend.html">$timeend</a> <a class="function" onClick="logFunction('or')" href="../_functions/or.html" onMouseOver="funcPopup(event,'or')">or</a> (!<a class="phpfunction" onClick="logFunction('is_null')" href="../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../_variables/status.html">$status</a>) and <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('status')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/status.html">status</a> != <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../_variables/status.html">$status</a>)) {
<a name="l1305"><span class="linenum">1305</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('update_user_enrol')" href="../_functions/update_user_enrol.html" onMouseOver="funcPopup(event,'update_user_enrol')">update_user_enrol</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../_variables/status.html">$status</a>, <a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../_variables/timestart.html">$timestart</a>, <a class="var it3001" onMouseOver="hilite(3001)" onMouseOut="lolite()" onClick="logVariable('timeend')" href="../_variables/timeend.html">$timeend</a>);
<a name="l1306"><span class="linenum">1306</span></a>              }
<a name="l1307"><span class="linenum">1307</span></a>          } else {
<a name="l1308"><span class="linenum">1308</span></a>              <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a> = new stdClass();
<a name="l1309"><span class="linenum">1309</span></a>              <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('enrolid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/enrolid.html">enrolid</a>      = <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l1310"><span class="linenum">1310</span></a>              <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('status')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/status.html">status</a>       = <a class="phpfunction" onClick="logFunction('is_null')" href="../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../_variables/status.html">$status</a>) ? <a class="constant" onClick="logConstant('ENROL_USER_ACTIVE')" href="../_constants/ENROL_USER_ACTIVE.html" onMouseOver="constPopup(event,'ENROL_USER_ACTIVE')">ENROL_USER_ACTIVE</a> : <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../_variables/status.html">$status</a>;
<a name="l1311"><span class="linenum">1311</span></a>              <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('userid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>       = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>;
<a name="l1312"><span class="linenum">1312</span></a>              <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('timestart')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/timestart.html">timestart</a>    = <a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../_variables/timestart.html">$timestart</a>;
<a name="l1313"><span class="linenum">1313</span></a>              <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('timeend')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/timeend.html">timeend</a>      = <a class="var it3001" onMouseOver="hilite(3001)" onMouseOut="lolite()" onClick="logVariable('timeend')" href="../_variables/timeend.html">$timeend</a>;
<a name="l1314"><span class="linenum">1314</span></a>              <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('modifierid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/modifierid.html">modifierid</a>   = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l1315"><span class="linenum">1315</span></a>              <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('timecreated')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a>  = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1316"><span class="linenum">1316</span></a>              <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/timemodified.html">timemodified</a> = <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('timecreated')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a>;
<a name="l1317"><span class="linenum">1317</span></a>              <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('id')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('user_enrolments', <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>);
<a name="l1318"><span class="linenum">1318</span></a>  
<a name="l1319"><span class="linenum">1319</span></a>              <a class="var it4917" onMouseOver="hilite(4917)" onMouseOut="lolite()" onClick="logVariable('inserted')" href="../_variables/inserted.html">$inserted</a> = true;
<a name="l1320"><span class="linenum">1320</span></a>          }
<a name="l1321"><span class="linenum">1321</span></a>  
<a name="l1322"><span class="linenum">1322</span></a>          if (<a class="var it4917" onMouseOver="hilite(4917)" onMouseOut="lolite()" onClick="logVariable('inserted')" href="../_variables/inserted.html">$inserted</a>) {
<a name="l1323"><span class="linenum">1323</span></a>  <span class="comment">            // Trigger event.</span>
<a name="l1324"><span class="linenum">1324</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('user_enrolment_created')" href="../_classes/user_enrolment_created.html" onMouseOver="classPopup(event,'user_enrolment_created')">user_enrolment_created</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(
<a name="l1325"><span class="linenum">1325</span></a>                      array(
<a name="l1326"><span class="linenum">1326</span></a>                          'objectid' =&gt; <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('id')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l1327"><span class="linenum">1327</span></a>                          'courseid' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>,
<a name="l1328"><span class="linenum">1328</span></a>                          'context' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>,
<a name="l1329"><span class="linenum">1329</span></a>                          'relateduserid' =&gt; <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('userid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>,
<a name="l1330"><span class="linenum">1330</span></a>                          'other' =&gt; array('enrol' =&gt; <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>)
<a name="l1331"><span class="linenum">1331</span></a>                          )
<a name="l1332"><span class="linenum">1332</span></a>                      );
<a name="l1333"><span class="linenum">1333</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1334"><span class="linenum">1334</span></a>  <span class="comment">            // Check if course contacts cache needs to be cleared.</span>
<a name="l1335"><span class="linenum">1335</span></a>              require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/libdir.html">libdir</a> . '/coursecatlib.php');
<a name="l1336"><span class="linenum">1336</span></a>              <a class="class" onClick="logClass('coursecat')" href="../_classes/coursecat.html" onMouseOver="classPopup(event,'coursecat')">coursecat</a>::<a class="function" onClick="logFunction('user_enrolment_changed')" href="../_functions/user_enrolment_changed.html" onMouseOver="funcPopup(event,'user_enrolment_changed')">user_enrolment_changed</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>, <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('userid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>,
<a name="l1337"><span class="linenum">1337</span></a>                      <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('status')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/status.html">status</a>, <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('timestart')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/timestart.html">timestart</a>, <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('timeend')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/timeend.html">timeend</a>);
<a name="l1338"><span class="linenum">1338</span></a>          }
<a name="l1339"><span class="linenum">1339</span></a>  
<a name="l1340"><span class="linenum">1340</span></a>          if (<a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>) {
<a name="l1341"><span class="linenum">1341</span></a>  <span class="comment">            // this must be done after the enrolment event so that the role_assigned event is triggered afterwards</span>
<a name="l1342"><span class="linenum">1342</span></a>              if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('roles_protected')" href="../_functions/roles_protected.html" onMouseOver="funcPopup(event,'roles_protected')">roles_protected</a>()) {
<a name="l1343"><span class="linenum">1343</span></a>                  <a class="function" onClick="logFunction('role_assign')" href="../_functions/role_assign.html" onMouseOver="funcPopup(event,'role_assign')">role_assign</a>(<a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'enrol_'.<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>, <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l1344"><span class="linenum">1344</span></a>              } else {
<a name="l1345"><span class="linenum">1345</span></a>                  <a class="function" onClick="logFunction('role_assign')" href="../_functions/role_assign.html" onMouseOver="funcPopup(event,'role_assign')">role_assign</a>(<a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l1346"><span class="linenum">1346</span></a>              }
<a name="l1347"><span class="linenum">1347</span></a>          }
<a name="l1348"><span class="linenum">1348</span></a>  
<a name="l1349"><span class="linenum">1349</span></a>  <span class="comment">        // Recover old grades if present.</span>
<a name="l1350"><span class="linenum">1350</span></a>          if (<a class="var it4198" onMouseOver="hilite(4198)" onMouseOut="lolite()" onClick="logVariable('recovergrades')" href="../_variables/recovergrades.html">$recovergrades</a>) {
<a name="l1351"><span class="linenum">1351</span></a>              require_once(&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/libdir.html">libdir</a>/gradelib.php&quot;);
<a name="l1352"><span class="linenum">1352</span></a>              <a class="function" onClick="logFunction('grade_recover_history_grades')" href="../_functions/grade_recover_history_grades.html" onMouseOver="funcPopup(event,'grade_recover_history_grades')">grade_recover_history_grades</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>);
<a name="l1353"><span class="linenum">1353</span></a>          }
<a name="l1354"><span class="linenum">1354</span></a>  
<a name="l1355"><span class="linenum">1355</span></a>  <span class="comment">        // reset current user enrolment caching</span>
<a name="l1356"><span class="linenum">1356</span></a>          if (<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> == <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) {
<a name="l1357"><span class="linenum">1357</span></a>              if (isset(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('enrol')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>['enrolled'][<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>])) {
<a name="l1358"><span class="linenum">1358</span></a>                  unset(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('enrol')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>['enrolled'][<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>]);
<a name="l1359"><span class="linenum">1359</span></a>              }
<a name="l1360"><span class="linenum">1360</span></a>              if (isset(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('enrol')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>['tempguest'][<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>])) {
<a name="l1361"><span class="linenum">1361</span></a>                  unset(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('enrol')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>['tempguest'][<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>]);
<a name="l1362"><span class="linenum">1362</span></a>                  <a class="function" onClick="logFunction('remove_temp_course_roles')" href="../_functions/remove_temp_course_roles.html" onMouseOver="funcPopup(event,'remove_temp_course_roles')">remove_temp_course_roles</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l1363"><span class="linenum">1363</span></a>              }
<a name="l1364"><span class="linenum">1364</span></a>          }
<a name="l1365"><span class="linenum">1365</span></a>      }
<a name="l1366"><span class="linenum">1366</span></a>  
<a name="l1367"><span class="linenum">1367</span></a>      <span class="comment">/**</span>
<a name="l1368"><span class="linenum">1368</span></a>  <span class="comment">     * Store user_enrolments changes and trigger event.</span>
<a name="l1369"><span class="linenum">1369</span></a>  <span class="comment">     *</span>
<a name="l1370"><span class="linenum">1370</span></a>  <span class="comment">     * @param stdClass $instance</span>
<a name="l1371"><span class="linenum">1371</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l1372"><span class="linenum">1372</span></a>  <span class="comment">     * @param int $status</span>
<a name="l1373"><span class="linenum">1373</span></a>  <span class="comment">     * @param int $timestart</span>
<a name="l1374"><span class="linenum">1374</span></a>  <span class="comment">     * @param int $timeend</span>
<a name="l1375"><span class="linenum">1375</span></a>  <span class="comment">     * @return void</span>
<a name="l1376"><span class="linenum">1376</span></a>  <span class="comment">     */</span>
<a name="l1377"><span class="linenum">1377</span></a>      public function <a class="function" onClick="logFunction('update_user_enrol')" href="../_functions/update_user_enrol.html" onMouseOver="funcPopup(event,'update_user_enrol')">update_user_enrol</a>(stdClass <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../_variables/status.html">$status</a> = NULL, <a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../_variables/timestart.html">$timestart</a> = NULL, <a class="var it3001" onMouseOver="hilite(3001)" onMouseOut="lolite()" onClick="logVariable('timeend')" href="../_variables/timeend.html">$timeend</a> = NULL) {
<a name="l1378"><span class="linenum">1378</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l1379"><span class="linenum">1379</span></a>  
<a name="l1380"><span class="linenum">1380</span></a>          <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>();
<a name="l1381"><span class="linenum">1381</span></a>  
<a name="l1382"><span class="linenum">1382</span></a>          if (<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a> !== <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>) {
<a name="l1383"><span class="linenum">1383</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('invalid enrol instance!');
<a name="l1384"><span class="linenum">1384</span></a>          }
<a name="l1385"><span class="linenum">1385</span></a>  
<a name="l1386"><span class="linenum">1386</span></a>          if (!<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user_enrolments', array('enrolid'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'userid'=&gt;<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>))) {
<a name="l1387"><span class="linenum">1387</span></a>  <span class="comment">            // weird, user not enrolled</span>
<a name="l1388"><span class="linenum">1388</span></a>              return;
<a name="l1389"><span class="linenum">1389</span></a>          }
<a name="l1390"><span class="linenum">1390</span></a>  
<a name="l1391"><span class="linenum">1391</span></a>          <a class="var it793" onMouseOver="hilite(793)" onMouseOut="lolite()" onClick="logVariable('modified')" href="../_variables/modified.html">$modified</a> = false;
<a name="l1392"><span class="linenum">1392</span></a>          if (isset(<a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../_variables/status.html">$status</a>) and <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('status')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/status.html">status</a> != <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../_variables/status.html">$status</a>) {
<a name="l1393"><span class="linenum">1393</span></a>              <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('status')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/status.html">status</a> = <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../_variables/status.html">$status</a>;
<a name="l1394"><span class="linenum">1394</span></a>              <a class="var it793" onMouseOver="hilite(793)" onMouseOut="lolite()" onClick="logVariable('modified')" href="../_variables/modified.html">$modified</a> = true;
<a name="l1395"><span class="linenum">1395</span></a>          }
<a name="l1396"><span class="linenum">1396</span></a>          if (isset(<a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../_variables/timestart.html">$timestart</a>) and <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('timestart')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/timestart.html">timestart</a> != <a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../_variables/timestart.html">$timestart</a>) {
<a name="l1397"><span class="linenum">1397</span></a>              <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('timestart')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/timestart.html">timestart</a> = <a class="var it1937" onMouseOver="hilite(1937)" onMouseOut="lolite()" onClick="logVariable('timestart')" href="../_variables/timestart.html">$timestart</a>;
<a name="l1398"><span class="linenum">1398</span></a>              <a class="var it793" onMouseOver="hilite(793)" onMouseOut="lolite()" onClick="logVariable('modified')" href="../_variables/modified.html">$modified</a> = true;
<a name="l1399"><span class="linenum">1399</span></a>          }
<a name="l1400"><span class="linenum">1400</span></a>          if (isset(<a class="var it3001" onMouseOver="hilite(3001)" onMouseOut="lolite()" onClick="logVariable('timeend')" href="../_variables/timeend.html">$timeend</a>) and <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('timeend')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/timeend.html">timeend</a> != <a class="var it3001" onMouseOver="hilite(3001)" onMouseOut="lolite()" onClick="logVariable('timeend')" href="../_variables/timeend.html">$timeend</a>) {
<a name="l1401"><span class="linenum">1401</span></a>              <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('timeend')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/timeend.html">timeend</a> = <a class="var it3001" onMouseOver="hilite(3001)" onMouseOut="lolite()" onClick="logVariable('timeend')" href="../_variables/timeend.html">$timeend</a>;
<a name="l1402"><span class="linenum">1402</span></a>              <a class="var it793" onMouseOver="hilite(793)" onMouseOut="lolite()" onClick="logVariable('modified')" href="../_variables/modified.html">$modified</a> = true;
<a name="l1403"><span class="linenum">1403</span></a>          }
<a name="l1404"><span class="linenum">1404</span></a>  
<a name="l1405"><span class="linenum">1405</span></a>          if (!<a class="var it793" onMouseOver="hilite(793)" onMouseOut="lolite()" onClick="logVariable('modified')" href="../_variables/modified.html">$modified</a>) {
<a name="l1406"><span class="linenum">1406</span></a>  <span class="comment">            // no change</span>
<a name="l1407"><span class="linenum">1407</span></a>              return;
<a name="l1408"><span class="linenum">1408</span></a>          }
<a name="l1409"><span class="linenum">1409</span></a>  
<a name="l1410"><span class="linenum">1410</span></a>          <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('modifierid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/modifierid.html">modifierid</a> = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l1411"><span class="linenum">1411</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('user_enrolments', <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>);
<a name="l1412"><span class="linenum">1412</span></a>          <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>)-&gt;<a class="function" onClick="logFunction('mark_dirty')" href="../_functions/mark_dirty.html" onMouseOver="funcPopup(event,'mark_dirty')">mark_dirty</a>(); <span class="comment">// reset enrol caches</span>
<a name="l1413"><span class="linenum">1413</span></a>  
<a name="l1414"><span class="linenum">1414</span></a>  <span class="comment">        // Invalidate core_access cache for get_suspended_userids.</span>
<a name="l1415"><span class="linenum">1415</span></a>          <a class="class" onClick="logClass('cache_helper')" href="../_classes/cache_helper.html" onMouseOver="classPopup(event,'cache_helper')">cache_helper</a>::<a class="function" onClick="logFunction('invalidate_by_definition')" href="../_functions/invalidate_by_definition.html" onMouseOver="funcPopup(event,'invalidate_by_definition')">invalidate_by_definition</a>('core', 'suspended_userids', array(), array(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>));
<a name="l1416"><span class="linenum">1416</span></a>  
<a name="l1417"><span class="linenum">1417</span></a>  <span class="comment">        // Trigger event.</span>
<a name="l1418"><span class="linenum">1418</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('user_enrolment_updated')" href="../_classes/user_enrolment_updated.html" onMouseOver="classPopup(event,'user_enrolment_updated')">user_enrolment_updated</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(
<a name="l1419"><span class="linenum">1419</span></a>                  array(
<a name="l1420"><span class="linenum">1420</span></a>                      'objectid' =&gt; <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('id')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l1421"><span class="linenum">1421</span></a>                      'courseid' =&gt; <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>,
<a name="l1422"><span class="linenum">1422</span></a>                      'context' =&gt; <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>),
<a name="l1423"><span class="linenum">1423</span></a>                      'relateduserid' =&gt; <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('userid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>,
<a name="l1424"><span class="linenum">1424</span></a>                      'other' =&gt; array('enrol' =&gt; <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>)
<a name="l1425"><span class="linenum">1425</span></a>                      )
<a name="l1426"><span class="linenum">1426</span></a>                  );
<a name="l1427"><span class="linenum">1427</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1428"><span class="linenum">1428</span></a>  
<a name="l1429"><span class="linenum">1429</span></a>          require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/libdir.html">libdir</a> . '/coursecatlib.php');
<a name="l1430"><span class="linenum">1430</span></a>          <a class="class" onClick="logClass('coursecat')" href="../_classes/coursecat.html" onMouseOver="classPopup(event,'coursecat')">coursecat</a>::<a class="function" onClick="logFunction('user_enrolment_changed')" href="../_functions/user_enrolment_changed.html" onMouseOver="funcPopup(event,'user_enrolment_changed')">user_enrolment_changed</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>, <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('userid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>,
<a name="l1431"><span class="linenum">1431</span></a>                  <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('status')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/status.html">status</a>, <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('timestart')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/timestart.html">timestart</a>, <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('timeend')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/timeend.html">timeend</a>);
<a name="l1432"><span class="linenum">1432</span></a>      }
<a name="l1433"><span class="linenum">1433</span></a>  
<a name="l1434"><span class="linenum">1434</span></a>      <span class="comment">/**</span>
<a name="l1435"><span class="linenum">1435</span></a>  <span class="comment">     * Unenrol user from course,</span>
<a name="l1436"><span class="linenum">1436</span></a>  <span class="comment">     * the last unenrolment removes all remaining roles.</span>
<a name="l1437"><span class="linenum">1437</span></a>  <span class="comment">     *</span>
<a name="l1438"><span class="linenum">1438</span></a>  <span class="comment">     * @param stdClass $instance</span>
<a name="l1439"><span class="linenum">1439</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l1440"><span class="linenum">1440</span></a>  <span class="comment">     * @return void</span>
<a name="l1441"><span class="linenum">1441</span></a>  <span class="comment">     */</span>
<a name="l1442"><span class="linenum">1442</span></a>      public function <a class="function" onClick="logFunction('unenrol_user')" href="../_functions/unenrol_user.html" onMouseOver="funcPopup(event,'unenrol_user')">unenrol_user</a>(stdClass <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) {
<a name="l1443"><span class="linenum">1443</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1444"><span class="linenum">1444</span></a>          require_once(&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>/group/lib.php&quot;);
<a name="l1445"><span class="linenum">1445</span></a>  
<a name="l1446"><span class="linenum">1446</span></a>          <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>();
<a name="l1447"><span class="linenum">1447</span></a>          <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a> = <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>;
<a name="l1448"><span class="linenum">1448</span></a>  
<a name="l1449"><span class="linenum">1449</span></a>          if (<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a> !== <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>) {
<a name="l1450"><span class="linenum">1450</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('invalid enrol instance!');
<a name="l1451"><span class="linenum">1451</span></a>          }
<a name="l1452"><span class="linenum">1452</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l1453"><span class="linenum">1453</span></a>  
<a name="l1454"><span class="linenum">1454</span></a>          if (!<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user_enrolments', array('enrolid'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'userid'=&gt;<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>))) {
<a name="l1455"><span class="linenum">1455</span></a>  <span class="comment">            // weird, user not enrolled</span>
<a name="l1456"><span class="linenum">1456</span></a>              return;
<a name="l1457"><span class="linenum">1457</span></a>          }
<a name="l1458"><span class="linenum">1458</span></a>  
<a name="l1459"><span class="linenum">1459</span></a>  <span class="comment">        // Remove all users groups linked to this enrolment instance.</span>
<a name="l1460"><span class="linenum">1460</span></a>          if (<a class="var it19855" onMouseOver="hilite(19855)" onMouseOut="lolite()" onClick="logVariable('gms')" href="../_variables/gms.html">$gms</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('groups_members', array('userid'=&gt;<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, 'component'=&gt;'enrol_'.<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>, 'itemid'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>))) {
<a name="l1461"><span class="linenum">1461</span></a>              foreach (<a class="var it19855" onMouseOver="hilite(19855)" onMouseOut="lolite()" onClick="logVariable('gms')" href="../_variables/gms.html">$gms</a> as <a class="var it3015" onMouseOver="hilite(3015)" onMouseOut="lolite()" onClick="logVariable('gm')" href="../_variables/gm.html">$gm</a>) {
<a name="l1462"><span class="linenum">1462</span></a>                  <a class="function" onClick="logFunction('groups_remove_member')" href="../_functions/groups_remove_member.html" onMouseOver="funcPopup(event,'groups_remove_member')">groups_remove_member</a>(<a class="var it3015" onMouseOver="hilite(3015)" onMouseOut="lolite()" onClick="logVariable('gm')" href="../_variables/gm.html">$gm</a>-&gt;<a onClick="logVariable('groupid')" class="var it43760" onMouseOver="hilite(43760)" onMouseOut="lolite()" href="../_variables/groupid.html">groupid</a>, <a class="var it3015" onMouseOver="hilite(3015)" onMouseOut="lolite()" onClick="logVariable('gm')" href="../_variables/gm.html">$gm</a>-&gt;<a onClick="logVariable('userid')" class="var it43760" onMouseOver="hilite(43760)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>);
<a name="l1463"><span class="linenum">1463</span></a>              }
<a name="l1464"><span class="linenum">1464</span></a>          }
<a name="l1465"><span class="linenum">1465</span></a>  
<a name="l1466"><span class="linenum">1466</span></a>          <a class="function" onClick="logFunction('role_unassign_all')" href="../_functions/role_unassign_all.html" onMouseOver="funcPopup(event,'role_unassign_all')">role_unassign_all</a>(array('userid'=&gt;<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, 'contextid'=&gt;<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'component'=&gt;'enrol_'.<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>, 'itemid'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l1467"><span class="linenum">1467</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('user_enrolments', array('id'=&gt;<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('id')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l1468"><span class="linenum">1468</span></a>  
<a name="l1469"><span class="linenum">1469</span></a>  <span class="comment">        // add extra info and trigger event</span>
<a name="l1470"><span class="linenum">1470</span></a>          <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('courseid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>  = <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>;
<a name="l1471"><span class="linenum">1471</span></a>          <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('enrol')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>     = <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>;
<a name="l1472"><span class="linenum">1472</span></a>  
<a name="l1473"><span class="linenum">1473</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT 'x'
<a name="l1474"><span class="linenum">1474</span></a>                    FROM {user_enrolments} ue
<a name="l1475"><span class="linenum">1475</span></a>                    JOIN {enrol} e <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (e.id = ue.enrolid)
<a name="l1476"><span class="linenum">1476</span></a>                   WHERE ue.userid = :userid AND e.courseid = :courseid&quot;;
<a name="l1477"><span class="linenum">1477</span></a>          if (<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists_sql')" href="../_functions/record_exists_sql.html" onMouseOver="funcPopup(event,'record_exists_sql')">record_exists_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, array('userid'=&gt;<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, 'courseid'=&gt;<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>))) {
<a name="l1478"><span class="linenum">1478</span></a>              <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('lastenrol')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/lastenrol.html">lastenrol</a> = false;
<a name="l1479"><span class="linenum">1479</span></a>  
<a name="l1480"><span class="linenum">1480</span></a>          } else {
<a name="l1481"><span class="linenum">1481</span></a>  <span class="comment">            // the big cleanup IS necessary!</span>
<a name="l1482"><span class="linenum">1482</span></a>              require_once(&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/libdir.html">libdir</a>/gradelib.php&quot;);
<a name="l1483"><span class="linenum">1483</span></a>  
<a name="l1484"><span class="linenum">1484</span></a>  <span class="comment">            // remove all remaining roles</span>
<a name="l1485"><span class="linenum">1485</span></a>              <a class="function" onClick="logFunction('role_unassign_all')" href="../_functions/role_unassign_all.html" onMouseOver="funcPopup(event,'role_unassign_all')">role_unassign_all</a>(array('userid'=&gt;<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, 'contextid'=&gt;<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../_variables/id.html">id</a>), true, false);
<a name="l1486"><span class="linenum">1486</span></a>  
<a name="l1487"><span class="linenum">1487</span></a>  <span class="comment">            //clean up ALL invisible user data from course if this is the last enrolment - groups, grades, etc.</span>
<a name="l1488"><span class="linenum">1488</span></a>              <a class="function" onClick="logFunction('groups_delete_group_members')" href="../_functions/groups_delete_group_members.html" onMouseOver="funcPopup(event,'groups_delete_group_members')">groups_delete_group_members</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>);
<a name="l1489"><span class="linenum">1489</span></a>  
<a name="l1490"><span class="linenum">1490</span></a>              <a class="function" onClick="logFunction('grade_user_unenrol')" href="../_functions/grade_user_unenrol.html" onMouseOver="funcPopup(event,'grade_user_unenrol')">grade_user_unenrol</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>);
<a name="l1491"><span class="linenum">1491</span></a>  
<a name="l1492"><span class="linenum">1492</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('user_lastaccess', array('userid'=&gt;<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, 'courseid'=&gt;<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>));
<a name="l1493"><span class="linenum">1493</span></a>  
<a name="l1494"><span class="linenum">1494</span></a>              <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('lastenrol')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/lastenrol.html">lastenrol</a> = true; <span class="comment">// means user not enrolled any more</span>
<a name="l1495"><span class="linenum">1495</span></a>          }
<a name="l1496"><span class="linenum">1496</span></a>  <span class="comment">        // Trigger event.</span>
<a name="l1497"><span class="linenum">1497</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('user_enrolment_deleted')" href="../_classes/user_enrolment_deleted.html" onMouseOver="classPopup(event,'user_enrolment_deleted')">user_enrolment_deleted</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(
<a name="l1498"><span class="linenum">1498</span></a>                  array(
<a name="l1499"><span class="linenum">1499</span></a>                      'courseid' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>,
<a name="l1500"><span class="linenum">1500</span></a>                      'context' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>,
<a name="l1501"><span class="linenum">1501</span></a>                      'relateduserid' =&gt; <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('userid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>,
<a name="l1502"><span class="linenum">1502</span></a>                      'objectid' =&gt; <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('id')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l1503"><span class="linenum">1503</span></a>                      'other' =&gt; array(
<a name="l1504"><span class="linenum">1504</span></a>                          'userenrolment' =&gt; (array)<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>,
<a name="l1505"><span class="linenum">1505</span></a>                          'enrol' =&gt; <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>
<a name="l1506"><span class="linenum">1506</span></a>                          )
<a name="l1507"><span class="linenum">1507</span></a>                      )
<a name="l1508"><span class="linenum">1508</span></a>                  );
<a name="l1509"><span class="linenum">1509</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1510"><span class="linenum">1510</span></a>  <span class="comment">        // reset all enrol caches</span>
<a name="l1511"><span class="linenum">1511</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('mark_dirty')" href="../_functions/mark_dirty.html" onMouseOver="funcPopup(event,'mark_dirty')">mark_dirty</a>();
<a name="l1512"><span class="linenum">1512</span></a>  
<a name="l1513"><span class="linenum">1513</span></a>  <span class="comment">        // Check if courrse contacts cache needs to be cleared.</span>
<a name="l1514"><span class="linenum">1514</span></a>          require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/libdir.html">libdir</a> . '/coursecatlib.php');
<a name="l1515"><span class="linenum">1515</span></a>          <a class="class" onClick="logClass('coursecat')" href="../_classes/coursecat.html" onMouseOver="classPopup(event,'coursecat')">coursecat</a>::<a class="function" onClick="logFunction('user_enrolment_changed')" href="../_functions/user_enrolment_changed.html" onMouseOver="funcPopup(event,'user_enrolment_changed')">user_enrolment_changed</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>, <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('userid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>, <a class="constant" onClick="logConstant('ENROL_USER_SUSPENDED')" href="../_constants/ENROL_USER_SUSPENDED.html" onMouseOver="constPopup(event,'ENROL_USER_SUSPENDED')">ENROL_USER_SUSPENDED</a>);
<a name="l1516"><span class="linenum">1516</span></a>  
<a name="l1517"><span class="linenum">1517</span></a>  <span class="comment">        // reset current user enrolment caching</span>
<a name="l1518"><span class="linenum">1518</span></a>          if (<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> == <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) {
<a name="l1519"><span class="linenum">1519</span></a>              if (isset(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('enrol')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>['enrolled'][<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>])) {
<a name="l1520"><span class="linenum">1520</span></a>                  unset(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('enrol')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>['enrolled'][<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>]);
<a name="l1521"><span class="linenum">1521</span></a>              }
<a name="l1522"><span class="linenum">1522</span></a>              if (isset(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('enrol')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>['tempguest'][<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>])) {
<a name="l1523"><span class="linenum">1523</span></a>                  unset(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('enrol')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>['tempguest'][<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>]);
<a name="l1524"><span class="linenum">1524</span></a>                  <a class="function" onClick="logFunction('remove_temp_course_roles')" href="../_functions/remove_temp_course_roles.html" onMouseOver="funcPopup(event,'remove_temp_course_roles')">remove_temp_course_roles</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l1525"><span class="linenum">1525</span></a>              }
<a name="l1526"><span class="linenum">1526</span></a>          }
<a name="l1527"><span class="linenum">1527</span></a>      }
<a name="l1528"><span class="linenum">1528</span></a>  
<a name="l1529"><span class="linenum">1529</span></a>      <span class="comment">/**</span>
<a name="l1530"><span class="linenum">1530</span></a>  <span class="comment">     * Forces synchronisation of user enrolments.</span>
<a name="l1531"><span class="linenum">1531</span></a>  <span class="comment">     *</span>
<a name="l1532"><span class="linenum">1532</span></a>  <span class="comment">     * This is important especially for external enrol plugins,</span>
<a name="l1533"><span class="linenum">1533</span></a>  <span class="comment">     * this function is called for all enabled enrol plugins</span>
<a name="l1534"><span class="linenum">1534</span></a>  <span class="comment">     * right after every user login.</span>
<a name="l1535"><span class="linenum">1535</span></a>  <span class="comment">     *</span>
<a name="l1536"><span class="linenum">1536</span></a>  <span class="comment">     * @param object $user user record</span>
<a name="l1537"><span class="linenum">1537</span></a>  <span class="comment">     * @return void</span>
<a name="l1538"><span class="linenum">1538</span></a>  <span class="comment">     */</span>
<a name="l1539"><span class="linenum">1539</span></a>      public function <a class="function" onClick="logFunction('sync_user_enrolments')" href="../_functions/sync_user_enrolments.html" onMouseOver="funcPopup(event,'sync_user_enrolments')">sync_user_enrolments</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) {
<a name="l1540"><span class="linenum">1540</span></a>  <span class="comment">        // override if necessary</span>
<a name="l1541"><span class="linenum">1541</span></a>      }
<a name="l1542"><span class="linenum">1542</span></a>  
<a name="l1543"><span class="linenum">1543</span></a>      <span class="comment">/**</span>
<a name="l1544"><span class="linenum">1544</span></a>  <span class="comment">     * This returns false for backwards compatibility, but it is really recommended.</span>
<a name="l1545"><span class="linenum">1545</span></a>  <span class="comment">     *</span>
<a name="l1546"><span class="linenum">1546</span></a>  <span class="comment">     * @since Moodle 3.1</span>
<a name="l1547"><span class="linenum">1547</span></a>  <span class="comment">     * @return boolean</span>
<a name="l1548"><span class="linenum">1548</span></a>  <span class="comment">     */</span>
<a name="l1549"><span class="linenum">1549</span></a>      public function <a class="function" onClick="logFunction('use_standard_editing_ui')" href="../_functions/use_standard_editing_ui.html" onMouseOver="funcPopup(event,'use_standard_editing_ui')">use_standard_editing_ui</a>() {
<a name="l1550"><span class="linenum">1550</span></a>          return false;
<a name="l1551"><span class="linenum">1551</span></a>      }
<a name="l1552"><span class="linenum">1552</span></a>  
<a name="l1553"><span class="linenum">1553</span></a>      <span class="comment">/**</span>
<a name="l1554"><span class="linenum">1554</span></a>  <span class="comment">     * Return whether or not, given the current state, it is possible to add a new instance</span>
<a name="l1555"><span class="linenum">1555</span></a>  <span class="comment">     * of this enrolment plugin to the course.</span>
<a name="l1556"><span class="linenum">1556</span></a>  <span class="comment">     *</span>
<a name="l1557"><span class="linenum">1557</span></a>  <span class="comment">     * Default implementation is just for backwards compatibility.</span>
<a name="l1558"><span class="linenum">1558</span></a>  <span class="comment">     *</span>
<a name="l1559"><span class="linenum">1559</span></a>  <span class="comment">     * @param int $courseid</span>
<a name="l1560"><span class="linenum">1560</span></a>  <span class="comment">     * @return boolean</span>
<a name="l1561"><span class="linenum">1561</span></a>  <span class="comment">     */</span>
<a name="l1562"><span class="linenum">1562</span></a>      public function <a class="function" onClick="logFunction('can_add_instance')" href="../_functions/can_add_instance.html" onMouseOver="funcPopup(event,'can_add_instance')">can_add_instance</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>) {
<a name="l1563"><span class="linenum">1563</span></a>          <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../_variables/link.html">$link</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_newinstance_link')" href="../_functions/get_newinstance_link.html" onMouseOver="funcPopup(event,'get_newinstance_link')">get_newinstance_link</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>);
<a name="l1564"><span class="linenum">1564</span></a>          return !empty(<a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../_variables/link.html">$link</a>);
<a name="l1565"><span class="linenum">1565</span></a>      }
<a name="l1566"><span class="linenum">1566</span></a>  
<a name="l1567"><span class="linenum">1567</span></a>      <span class="comment">/**</span>
<a name="l1568"><span class="linenum">1568</span></a>  <span class="comment">     * Return whether or not, given the current state, it is possible to edit an instance</span>
<a name="l1569"><span class="linenum">1569</span></a>  <span class="comment">     * of this enrolment plugin in the course. Used by the standard editing UI</span>
<a name="l1570"><span class="linenum">1570</span></a>  <span class="comment">     * to generate a link to the edit instance form if editing is allowed.</span>
<a name="l1571"><span class="linenum">1571</span></a>  <span class="comment">     *</span>
<a name="l1572"><span class="linenum">1572</span></a>  <span class="comment">     * @param stdClass $instance</span>
<a name="l1573"><span class="linenum">1573</span></a>  <span class="comment">     * @return boolean</span>
<a name="l1574"><span class="linenum">1574</span></a>  <span class="comment">     */</span>
<a name="l1575"><span class="linenum">1575</span></a>      public function <a class="function" onClick="logFunction('can_edit_instance')" href="../_functions/can_edit_instance.html" onMouseOver="funcPopup(event,'can_edit_instance')">can_edit_instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l1576"><span class="linenum">1576</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>);
<a name="l1577"><span class="linenum">1577</span></a>  
<a name="l1578"><span class="linenum">1578</span></a>          return <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('enrol/' . <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a> . ':config', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l1579"><span class="linenum">1579</span></a>      }
<a name="l1580"><span class="linenum">1580</span></a>  
<a name="l1581"><span class="linenum">1581</span></a>      <span class="comment">/**</span>
<a name="l1582"><span class="linenum">1582</span></a>  <span class="comment">     * Returns link to page which may be used to add new instance of enrolment plugin in course.</span>
<a name="l1583"><span class="linenum">1583</span></a>  <span class="comment">     * @param int $courseid</span>
<a name="l1584"><span class="linenum">1584</span></a>  <span class="comment">     * @return moodle_url page url</span>
<a name="l1585"><span class="linenum">1585</span></a>  <span class="comment">     */</span>
<a name="l1586"><span class="linenum">1586</span></a>      public function <a class="function" onClick="logFunction('get_newinstance_link')" href="../_functions/get_newinstance_link.html" onMouseOver="funcPopup(event,'get_newinstance_link')">get_newinstance_link</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>) {
<a name="l1587"><span class="linenum">1587</span></a>  <span class="comment">        // override for most plugins, check if instance already exists in cases only one instance is supported</span>
<a name="l1588"><span class="linenum">1588</span></a>          return NULL;
<a name="l1589"><span class="linenum">1589</span></a>      }
<a name="l1590"><span class="linenum">1590</span></a>  
<a name="l1591"><span class="linenum">1591</span></a>      <span class="comment">/**</span>
<a name="l1592"><span class="linenum">1592</span></a>  <span class="comment">     * @deprecated since Moodle 2.8 MDL-35864 - please use can_delete_instance() instead.</span>
<a name="l1593"><span class="linenum">1593</span></a>  <span class="comment">     */</span>
<a name="l1594"><span class="linenum">1594</span></a>      public function <a class="function" onClick="logFunction('instance_deleteable')" href="../_functions/instance_deleteable.html" onMouseOver="funcPopup(event,'instance_deleteable')">instance_deleteable</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l1595"><span class="linenum">1595</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Function enrol_plugin::<a class="function" onClick="logFunction('instance_deleteable')" href="../_functions/instance_deleteable.html" onMouseOver="funcPopup(event,'instance_deleteable')">instance_deleteable</a>() is deprecated, use
<a name="l1596"><span class="linenum">1596</span></a>                  enrol_plugin::<a class="function" onClick="logFunction('can_delete_instance')" href="../_functions/can_delete_instance.html" onMouseOver="funcPopup(event,'can_delete_instance')">can_delete_instance</a>() instead');
<a name="l1597"><span class="linenum">1597</span></a>      }
<a name="l1598"><span class="linenum">1598</span></a>  
<a name="l1599"><span class="linenum">1599</span></a>      <span class="comment">/**</span>
<a name="l1600"><span class="linenum">1600</span></a>  <span class="comment">     * Is it possible to delete enrol instance via standard UI?</span>
<a name="l1601"><span class="linenum">1601</span></a>  <span class="comment">     *</span>
<a name="l1602"><span class="linenum">1602</span></a>  <span class="comment">     * @param stdClass  $instance</span>
<a name="l1603"><span class="linenum">1603</span></a>  <span class="comment">     * @return bool</span>
<a name="l1604"><span class="linenum">1604</span></a>  <span class="comment">     */</span>
<a name="l1605"><span class="linenum">1605</span></a>      public function <a class="function" onClick="logFunction('can_delete_instance')" href="../_functions/can_delete_instance.html" onMouseOver="funcPopup(event,'can_delete_instance')">can_delete_instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l1606"><span class="linenum">1606</span></a>          return false;
<a name="l1607"><span class="linenum">1607</span></a>      }
<a name="l1608"><span class="linenum">1608</span></a>  
<a name="l1609"><span class="linenum">1609</span></a>      <span class="comment">/**</span>
<a name="l1610"><span class="linenum">1610</span></a>  <span class="comment">     * Is it possible to hide/show enrol instance via standard UI?</span>
<a name="l1611"><span class="linenum">1611</span></a>  <span class="comment">     *</span>
<a name="l1612"><span class="linenum">1612</span></a>  <span class="comment">     * @param stdClass $instance</span>
<a name="l1613"><span class="linenum">1613</span></a>  <span class="comment">     * @return bool</span>
<a name="l1614"><span class="linenum">1614</span></a>  <span class="comment">     */</span>
<a name="l1615"><span class="linenum">1615</span></a>      public function <a class="function" onClick="logFunction('can_hide_show_instance')" href="../_functions/can_hide_show_instance.html" onMouseOver="funcPopup(event,'can_hide_show_instance')">can_hide_show_instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l1616"><span class="linenum">1616</span></a>          <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>(&quot;The enrolment plugin '&quot;.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>().&quot;' should override the function <a class="function" onClick="logFunction('can_hide_show_instance')" href="../_functions/can_hide_show_instance.html" onMouseOver="funcPopup(event,'can_hide_show_instance')">can_hide_show_instance</a>().&quot;, <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l1617"><span class="linenum">1617</span></a>          return true;
<a name="l1618"><span class="linenum">1618</span></a>      }
<a name="l1619"><span class="linenum">1619</span></a>  
<a name="l1620"><span class="linenum">1620</span></a>      <span class="comment">/**</span>
<a name="l1621"><span class="linenum">1621</span></a>  <span class="comment">     * Returns link to manual enrol UI if exists.</span>
<a name="l1622"><span class="linenum">1622</span></a>  <span class="comment">     * Does the access control tests automatically.</span>
<a name="l1623"><span class="linenum">1623</span></a>  <span class="comment">     *</span>
<a name="l1624"><span class="linenum">1624</span></a>  <span class="comment">     * @param object $instance</span>
<a name="l1625"><span class="linenum">1625</span></a>  <span class="comment">     * @return moodle_url</span>
<a name="l1626"><span class="linenum">1626</span></a>  <span class="comment">     */</span>
<a name="l1627"><span class="linenum">1627</span></a>      public function <a class="function" onClick="logFunction('get_manual_enrol_link')" href="../_functions/get_manual_enrol_link.html" onMouseOver="funcPopup(event,'get_manual_enrol_link')">get_manual_enrol_link</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l1628"><span class="linenum">1628</span></a>          return NULL;
<a name="l1629"><span class="linenum">1629</span></a>      }
<a name="l1630"><span class="linenum">1630</span></a>  
<a name="l1631"><span class="linenum">1631</span></a>      <span class="comment">/**</span>
<a name="l1632"><span class="linenum">1632</span></a>  <span class="comment">     * Returns list of unenrol links for all enrol instances in course.</span>
<a name="l1633"><span class="linenum">1633</span></a>  <span class="comment">     *</span>
<a name="l1634"><span class="linenum">1634</span></a>  <span class="comment">     * @param int $instance</span>
<a name="l1635"><span class="linenum">1635</span></a>  <span class="comment">     * @return moodle_url or NULL if self unenrolment not supported</span>
<a name="l1636"><span class="linenum">1636</span></a>  <span class="comment">     */</span>
<a name="l1637"><span class="linenum">1637</span></a>      public function <a class="function" onClick="logFunction('get_unenrolself_link')" href="../_functions/get_unenrolself_link.html" onMouseOver="funcPopup(event,'get_unenrolself_link')">get_unenrolself_link</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l1638"><span class="linenum">1638</span></a>          global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1639"><span class="linenum">1639</span></a>  
<a name="l1640"><span class="linenum">1640</span></a>          <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>();
<a name="l1641"><span class="linenum">1641</span></a>          if (<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a> !== <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>) {
<a name="l1642"><span class="linenum">1642</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('invalid enrol instance!');
<a name="l1643"><span class="linenum">1643</span></a>          }
<a name="l1644"><span class="linenum">1644</span></a>  
<a name="l1645"><span class="linenum">1645</span></a>          if (<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a> == <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>) {
<a name="l1646"><span class="linenum">1646</span></a>              return NULL;
<a name="l1647"><span class="linenum">1647</span></a>          }
<a name="l1648"><span class="linenum">1648</span></a>  
<a name="l1649"><span class="linenum">1649</span></a>          if (!<a class="function" onClick="logFunction('enrol_is_enabled')" href="../_functions/enrol_is_enabled.html" onMouseOver="funcPopup(event,'enrol_is_enabled')">enrol_is_enabled</a>(<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>)) {
<a name="l1650"><span class="linenum">1650</span></a>              return NULL;
<a name="l1651"><span class="linenum">1651</span></a>          }
<a name="l1652"><span class="linenum">1652</span></a>  
<a name="l1653"><span class="linenum">1653</span></a>          if (<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('status')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/status.html">status</a> != <a class="constant" onClick="logConstant('ENROL_INSTANCE_ENABLED')" href="../_constants/ENROL_INSTANCE_ENABLED.html" onMouseOver="constPopup(event,'ENROL_INSTANCE_ENABLED')">ENROL_INSTANCE_ENABLED</a>) {
<a name="l1654"><span class="linenum">1654</span></a>              return NULL;
<a name="l1655"><span class="linenum">1655</span></a>          }
<a name="l1656"><span class="linenum">1656</span></a>  
<a name="l1657"><span class="linenum">1657</span></a>          if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>/enrol/<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>/unenrolself.php&quot;)) {
<a name="l1658"><span class="linenum">1658</span></a>              return NULL;
<a name="l1659"><span class="linenum">1659</span></a>          }
<a name="l1660"><span class="linenum">1660</span></a>  
<a name="l1661"><span class="linenum">1661</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l1662"><span class="linenum">1662</span></a>  
<a name="l1663"><span class="linenum">1663</span></a>          if (!<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(&quot;enrol/<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>:unenrolself&quot;, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>)) {
<a name="l1664"><span class="linenum">1664</span></a>              return NULL;
<a name="l1665"><span class="linenum">1665</span></a>          }
<a name="l1666"><span class="linenum">1666</span></a>  
<a name="l1667"><span class="linenum">1667</span></a>          if (!<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('user_enrolments', array('enrolid'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'userid'=&gt;<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'status'=&gt;<a class="constant" onClick="logConstant('ENROL_USER_ACTIVE')" href="../_constants/ENROL_USER_ACTIVE.html" onMouseOver="constPopup(event,'ENROL_USER_ACTIVE')">ENROL_USER_ACTIVE</a>))) {
<a name="l1668"><span class="linenum">1668</span></a>              return NULL;
<a name="l1669"><span class="linenum">1669</span></a>          }
<a name="l1670"><span class="linenum">1670</span></a>  
<a name="l1671"><span class="linenum">1671</span></a>          return <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>(&quot;/enrol/<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>/unenrolself.php&quot;, array('enrolid'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l1672"><span class="linenum">1672</span></a>      }
<a name="l1673"><span class="linenum">1673</span></a>  
<a name="l1674"><span class="linenum">1674</span></a>      <span class="comment">/**</span>
<a name="l1675"><span class="linenum">1675</span></a>  <span class="comment">     * Adds enrol instance UI to course edit form</span>
<a name="l1676"><span class="linenum">1676</span></a>  <span class="comment">     *</span>
<a name="l1677"><span class="linenum">1677</span></a>  <span class="comment">     * @param object $instance enrol instance or null if does not exist yet</span>
<a name="l1678"><span class="linenum">1678</span></a>  <span class="comment">     * @param MoodleQuickForm $mform</span>
<a name="l1679"><span class="linenum">1679</span></a>  <span class="comment">     * @param object $data</span>
<a name="l1680"><span class="linenum">1680</span></a>  <span class="comment">     * @param object $context context of existing course or parent category if course does not exist</span>
<a name="l1681"><span class="linenum">1681</span></a>  <span class="comment">     * @return void</span>
<a name="l1682"><span class="linenum">1682</span></a>  <span class="comment">     */</span>
<a name="l1683"><span class="linenum">1683</span></a>      public function <a class="function" onClick="logFunction('course_edit_form')" href="../_functions/course_edit_form.html" onMouseOver="funcPopup(event,'course_edit_form')">course_edit_form</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>, MoodleQuickForm <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../_variables/mform.html">$mform</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l1684"><span class="linenum">1684</span></a>  <span class="comment">        // override - usually at least enable/disable switch, has to add own form header</span>
<a name="l1685"><span class="linenum">1685</span></a>      }
<a name="l1686"><span class="linenum">1686</span></a>  
<a name="l1687"><span class="linenum">1687</span></a>      <span class="comment">/**</span>
<a name="l1688"><span class="linenum">1688</span></a>  <span class="comment">     * Adds form elements to add/edit instance form.</span>
<a name="l1689"><span class="linenum">1689</span></a>  <span class="comment">     *</span>
<a name="l1690"><span class="linenum">1690</span></a>  <span class="comment">     * @since Moodle 3.1</span>
<a name="l1691"><span class="linenum">1691</span></a>  <span class="comment">     * @param object $instance enrol instance or null if does not exist yet</span>
<a name="l1692"><span class="linenum">1692</span></a>  <span class="comment">     * @param MoodleQuickForm $mform</span>
<a name="l1693"><span class="linenum">1693</span></a>  <span class="comment">     * @param context $context</span>
<a name="l1694"><span class="linenum">1694</span></a>  <span class="comment">     * @return void</span>
<a name="l1695"><span class="linenum">1695</span></a>  <span class="comment">     */</span>
<a name="l1696"><span class="linenum">1696</span></a>      public function <a class="function" onClick="logFunction('edit_instance_form')" href="../_functions/edit_instance_form.html" onMouseOver="funcPopup(event,'edit_instance_form')">edit_instance_form</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>, MoodleQuickForm <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../_variables/mform.html">$mform</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l1697"><span class="linenum">1697</span></a>  <span class="comment">        // Do nothing by default.</span>
<a name="l1698"><span class="linenum">1698</span></a>      }
<a name="l1699"><span class="linenum">1699</span></a>  
<a name="l1700"><span class="linenum">1700</span></a>      <span class="comment">/**</span>
<a name="l1701"><span class="linenum">1701</span></a>  <span class="comment">     * Perform custom validation of the data used to edit the instance.</span>
<a name="l1702"><span class="linenum">1702</span></a>  <span class="comment">     *</span>
<a name="l1703"><span class="linenum">1703</span></a>  <span class="comment">     * @since Moodle 3.1</span>
<a name="l1704"><span class="linenum">1704</span></a>  <span class="comment">     * @param array $data array of (&quot;fieldname&quot;=&gt;value) of submitted data</span>
<a name="l1705"><span class="linenum">1705</span></a>  <span class="comment">     * @param array $files array of uploaded files &quot;element_name&quot;=&gt;tmp_file_path</span>
<a name="l1706"><span class="linenum">1706</span></a>  <span class="comment">     * @param object $instance The instance data loaded from the DB.</span>
<a name="l1707"><span class="linenum">1707</span></a>  <span class="comment">     * @param context $context The context of the instance we are editing</span>
<a name="l1708"><span class="linenum">1708</span></a>  <span class="comment">     * @return array of &quot;element_name&quot;=&gt;&quot;error_description&quot; if there are errors,</span>
<a name="l1709"><span class="linenum">1709</span></a>  <span class="comment">     *         or an empty array if everything is OK.</span>
<a name="l1710"><span class="linenum">1710</span></a>  <span class="comment">     */</span>
<a name="l1711"><span class="linenum">1711</span></a>      public function <a class="function" onClick="logFunction('edit_instance_validation')" href="../_functions/edit_instance_validation.html" onMouseOver="funcPopup(event,'edit_instance_validation')">edit_instance_validation</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>, <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../_variables/files.html">$files</a>, <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l1712"><span class="linenum">1712</span></a>  <span class="comment">        // No errors by default.</span>
<a name="l1713"><span class="linenum">1713</span></a>          <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('enrol_plugin::<a class="function" onClick="logFunction('edit_instance_validation')" href="../_functions/edit_instance_validation.html" onMouseOver="funcPopup(event,'edit_instance_validation')">edit_instance_validation</a>() is missing. This plugin has no validation!', <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l1714"><span class="linenum">1714</span></a>          return array();
<a name="l1715"><span class="linenum">1715</span></a>      }
<a name="l1716"><span class="linenum">1716</span></a>  
<a name="l1717"><span class="linenum">1717</span></a>      <span class="comment">/**</span>
<a name="l1718"><span class="linenum">1718</span></a>  <span class="comment">     * Validates course edit form data</span>
<a name="l1719"><span class="linenum">1719</span></a>  <span class="comment">     *</span>
<a name="l1720"><span class="linenum">1720</span></a>  <span class="comment">     * @param object $instance enrol instance or null if does not exist yet</span>
<a name="l1721"><span class="linenum">1721</span></a>  <span class="comment">     * @param array $data</span>
<a name="l1722"><span class="linenum">1722</span></a>  <span class="comment">     * @param object $context context of existing course or parent category if course does not exist</span>
<a name="l1723"><span class="linenum">1723</span></a>  <span class="comment">     * @return array errors array</span>
<a name="l1724"><span class="linenum">1724</span></a>  <span class="comment">     */</span>
<a name="l1725"><span class="linenum">1725</span></a>      public function <a class="function" onClick="logFunction('course_edit_validation')" href="../_functions/course_edit_validation.html" onMouseOver="funcPopup(event,'course_edit_validation')">course_edit_validation</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>, array <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l1726"><span class="linenum">1726</span></a>          return array();
<a name="l1727"><span class="linenum">1727</span></a>      }
<a name="l1728"><span class="linenum">1728</span></a>  
<a name="l1729"><span class="linenum">1729</span></a>      <span class="comment">/**</span>
<a name="l1730"><span class="linenum">1730</span></a>  <span class="comment">     * Called after updating/inserting course.</span>
<a name="l1731"><span class="linenum">1731</span></a>  <span class="comment">     *</span>
<a name="l1732"><span class="linenum">1732</span></a>  <span class="comment">     * @param bool $inserted true if course just inserted</span>
<a name="l1733"><span class="linenum">1733</span></a>  <span class="comment">     * @param object $course</span>
<a name="l1734"><span class="linenum">1734</span></a>  <span class="comment">     * @param object $data form data</span>
<a name="l1735"><span class="linenum">1735</span></a>  <span class="comment">     * @return void</span>
<a name="l1736"><span class="linenum">1736</span></a>  <span class="comment">     */</span>
<a name="l1737"><span class="linenum">1737</span></a>      public function <a class="function" onClick="logFunction('course_updated')" href="../_functions/course_updated.html" onMouseOver="funcPopup(event,'course_updated')">course_updated</a>(<a class="var it4917" onMouseOver="hilite(4917)" onMouseOut="lolite()" onClick="logVariable('inserted')" href="../_variables/inserted.html">$inserted</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>) {
<a name="l1738"><span class="linenum">1738</span></a>          if (<a class="var it4917" onMouseOver="hilite(4917)" onMouseOut="lolite()" onClick="logVariable('inserted')" href="../_variables/inserted.html">$inserted</a>) {
<a name="l1739"><span class="linenum">1739</span></a>              if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('defaultenrol')) {
<a name="l1740"><span class="linenum">1740</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_default_instance')" href="../_functions/add_default_instance.html" onMouseOver="funcPopup(event,'add_default_instance')">add_default_instance</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>);
<a name="l1741"><span class="linenum">1741</span></a>              }
<a name="l1742"><span class="linenum">1742</span></a>          }
<a name="l1743"><span class="linenum">1743</span></a>      }
<a name="l1744"><span class="linenum">1744</span></a>  
<a name="l1745"><span class="linenum">1745</span></a>      <span class="comment">/**</span>
<a name="l1746"><span class="linenum">1746</span></a>  <span class="comment">     * Add new instance of enrol plugin.</span>
<a name="l1747"><span class="linenum">1747</span></a>  <span class="comment">     * @param object $course</span>
<a name="l1748"><span class="linenum">1748</span></a>  <span class="comment">     * @param array instance fields</span>
<a name="l1749"><span class="linenum">1749</span></a>  <span class="comment">     * @return int id of new instance, null if can not be created</span>
<a name="l1750"><span class="linenum">1750</span></a>  <span class="comment">     */</span>
<a name="l1751"><span class="linenum">1751</span></a>      public function <a class="function" onClick="logFunction('add_instance')" href="../_functions/add_instance.html" onMouseOver="funcPopup(event,'add_instance')">add_instance</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>, array <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = NULL) {
<a name="l1752"><span class="linenum">1752</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1753"><span class="linenum">1753</span></a>  
<a name="l1754"><span class="linenum">1754</span></a>          if (<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/id.html">id</a> == <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>) {
<a name="l1755"><span class="linenum">1755</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid request to add enrol instance to frontpage.');
<a name="l1756"><span class="linenum">1756</span></a>          }
<a name="l1757"><span class="linenum">1757</span></a>  
<a name="l1758"><span class="linenum">1758</span></a>          <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a> = new stdClass();
<a name="l1759"><span class="linenum">1759</span></a>          <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>          = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>();
<a name="l1760"><span class="linenum">1760</span></a>          <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('status')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/status.html">status</a>         = <a class="constant" onClick="logConstant('ENROL_INSTANCE_ENABLED')" href="../_constants/ENROL_INSTANCE_ENABLED.html" onMouseOver="constPopup(event,'ENROL_INSTANCE_ENABLED')">ENROL_INSTANCE_ENABLED</a>;
<a name="l1761"><span class="linenum">1761</span></a>          <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>       = <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l1762"><span class="linenum">1762</span></a>          <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrolstartdate')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrolstartdate.html">enrolstartdate</a> = 0;
<a name="l1763"><span class="linenum">1763</span></a>          <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrolenddate')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrolenddate.html">enrolenddate</a>   = 0;
<a name="l1764"><span class="linenum">1764</span></a>          <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/timemodified.html">timemodified</a>   = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1765"><span class="linenum">1765</span></a>          <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('timecreated')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a>    = <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/timemodified.html">timemodified</a>;
<a name="l1766"><span class="linenum">1766</span></a>          <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('sortorder')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/sortorder.html">sortorder</a>      = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('enrol', 'COALESCE(<a class="phpfunction" onClick="logFunction('MAX')" href="../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">MAX</a>(sortorder), -1) + 1', array('courseid'=&gt;<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l1767"><span class="linenum">1767</span></a>  
<a name="l1768"><span class="linenum">1768</span></a>          <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = (array)<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>;
<a name="l1769"><span class="linenum">1769</span></a>          unset(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>['enrol']);
<a name="l1770"><span class="linenum">1770</span></a>          unset(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>['courseid']);
<a name="l1771"><span class="linenum">1771</span></a>          unset(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>['sortorder']);
<a name="l1772"><span class="linenum">1772</span></a>          foreach(<a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> as <a class="var it59" onMouseOver="hilite(59)" onMouseOut="lolite()" onClick="logVariable('field')" href="../_variables/field.html">$field</a>=&gt;<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../_variables/value.html">$value</a>) {
<a name="l1773"><span class="linenum">1773</span></a>              <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a class="var it59" onMouseOver="hilite(59)" onMouseOut="lolite()" onClick="logVariable('field')" href="../_variables/field.html">$field</a> = <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../_variables/value.html">$value</a>;
<a name="l1774"><span class="linenum">1774</span></a>          }
<a name="l1775"><span class="linenum">1775</span></a>  
<a name="l1776"><span class="linenum">1776</span></a>          <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('enrol', <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>);
<a name="l1777"><span class="linenum">1777</span></a>  
<a name="l1778"><span class="linenum">1778</span></a>          \core\event\<a class="class" onClick="logClass('enrol_instance_created')" href="../_classes/enrol_instance_created.html" onMouseOver="classPopup(event,'enrol_instance_created')">enrol_instance_created</a>::<a class="function" onClick="logFunction('create_from_record')" href="../_functions/create_from_record.html" onMouseOver="funcPopup(event,'create_from_record')">create_from_record</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1779"><span class="linenum">1779</span></a>  
<a name="l1780"><span class="linenum">1780</span></a>          return <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l1781"><span class="linenum">1781</span></a>      }
<a name="l1782"><span class="linenum">1782</span></a>  
<a name="l1783"><span class="linenum">1783</span></a>      <span class="comment">/**</span>
<a name="l1784"><span class="linenum">1784</span></a>  <span class="comment">     * Update instance of enrol plugin.</span>
<a name="l1785"><span class="linenum">1785</span></a>  <span class="comment">     *</span>
<a name="l1786"><span class="linenum">1786</span></a>  <span class="comment">     * @since Moodle 3.1</span>
<a name="l1787"><span class="linenum">1787</span></a>  <span class="comment">     * @param stdClass $instance</span>
<a name="l1788"><span class="linenum">1788</span></a>  <span class="comment">     * @param stdClass $data modified instance fields</span>
<a name="l1789"><span class="linenum">1789</span></a>  <span class="comment">     * @return boolean</span>
<a name="l1790"><span class="linenum">1790</span></a>  <span class="comment">     */</span>
<a name="l1791"><span class="linenum">1791</span></a>      public function <a class="function" onClick="logFunction('update_instance')" href="../_functions/update_instance.html" onMouseOver="funcPopup(event,'update_instance')">update_instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>) {
<a name="l1792"><span class="linenum">1792</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1793"><span class="linenum">1793</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('properties')" href="../_variables/properties.html">$properties</a> = array('status', 'name', 'password', 'customint1', 'customint2', 'customint3',
<a name="l1794"><span class="linenum">1794</span></a>                              'customint4', 'customint5', 'customint6', 'customint7', 'customint8',
<a name="l1795"><span class="linenum">1795</span></a>                              'customchar1', 'customchar2', 'customchar3', 'customdec1', 'customdec2',
<a name="l1796"><span class="linenum">1796</span></a>                              'customtext1', 'customtext2', 'customtext3', 'customtext4', 'roleid',
<a name="l1797"><span class="linenum">1797</span></a>                              'enrolperiod', 'expirynotify', 'notifyall', 'expirythreshold',
<a name="l1798"><span class="linenum">1798</span></a>                              'enrolstartdate', 'enrolenddate', 'cost', 'currency');
<a name="l1799"><span class="linenum">1799</span></a>  
<a name="l1800"><span class="linenum">1800</span></a>          foreach (<a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('properties')" href="../_variables/properties.html">$properties</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>) {
<a name="l1801"><span class="linenum">1801</span></a>              if (isset(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>-&gt;<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>)) {
<a name="l1802"><span class="linenum">1802</span></a>                  <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>-&gt;<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>;
<a name="l1803"><span class="linenum">1803</span></a>              }
<a name="l1804"><span class="linenum">1804</span></a>          }
<a name="l1805"><span class="linenum">1805</span></a>          <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1806"><span class="linenum">1806</span></a>  
<a name="l1807"><span class="linenum">1807</span></a>          <a class="var it2088" onMouseOver="hilite(2088)" onMouseOut="lolite()" onClick="logVariable('update')" href="../_variables/update.html">$update</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('enrol', <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>);
<a name="l1808"><span class="linenum">1808</span></a>          if (<a class="var it2088" onMouseOver="hilite(2088)" onMouseOut="lolite()" onClick="logVariable('update')" href="../_variables/update.html">$update</a>) {
<a name="l1809"><span class="linenum">1809</span></a>              \core\event\<a class="class" onClick="logClass('enrol_instance_updated')" href="../_classes/enrol_instance_updated.html" onMouseOver="classPopup(event,'enrol_instance_updated')">enrol_instance_updated</a>::<a class="function" onClick="logFunction('create_from_record')" href="../_functions/create_from_record.html" onMouseOver="funcPopup(event,'create_from_record')">create_from_record</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1810"><span class="linenum">1810</span></a>          }
<a name="l1811"><span class="linenum">1811</span></a>          return <a class="var it2088" onMouseOver="hilite(2088)" onMouseOut="lolite()" onClick="logVariable('update')" href="../_variables/update.html">$update</a>;
<a name="l1812"><span class="linenum">1812</span></a>      }
<a name="l1813"><span class="linenum">1813</span></a>  
<a name="l1814"><span class="linenum">1814</span></a>      <span class="comment">/**</span>
<a name="l1815"><span class="linenum">1815</span></a>  <span class="comment">     * Add new instance of enrol plugin with default settings,</span>
<a name="l1816"><span class="linenum">1816</span></a>  <span class="comment">     * called when adding new instance manually or when adding new course.</span>
<a name="l1817"><span class="linenum">1817</span></a>  <span class="comment">     *</span>
<a name="l1818"><span class="linenum">1818</span></a>  <span class="comment">     * Not all plugins support this.</span>
<a name="l1819"><span class="linenum">1819</span></a>  <span class="comment">     *</span>
<a name="l1820"><span class="linenum">1820</span></a>  <span class="comment">     * @param object $course</span>
<a name="l1821"><span class="linenum">1821</span></a>  <span class="comment">     * @return int id of new instance or null if no default supported</span>
<a name="l1822"><span class="linenum">1822</span></a>  <span class="comment">     */</span>
<a name="l1823"><span class="linenum">1823</span></a>      public function <a class="function" onClick="logFunction('add_default_instance')" href="../_functions/add_default_instance.html" onMouseOver="funcPopup(event,'add_default_instance')">add_default_instance</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>) {
<a name="l1824"><span class="linenum">1824</span></a>          return null;
<a name="l1825"><span class="linenum">1825</span></a>      }
<a name="l1826"><span class="linenum">1826</span></a>  
<a name="l1827"><span class="linenum">1827</span></a>      <span class="comment">/**</span>
<a name="l1828"><span class="linenum">1828</span></a>  <span class="comment">     * Update instance status</span>
<a name="l1829"><span class="linenum">1829</span></a>  <span class="comment">     *</span>
<a name="l1830"><span class="linenum">1830</span></a>  <span class="comment">     * Override when plugin needs to do some action when enabled or disabled.</span>
<a name="l1831"><span class="linenum">1831</span></a>  <span class="comment">     *</span>
<a name="l1832"><span class="linenum">1832</span></a>  <span class="comment">     * @param stdClass $instance</span>
<a name="l1833"><span class="linenum">1833</span></a>  <span class="comment">     * @param int $newstatus ENROL_INSTANCE_ENABLED, ENROL_INSTANCE_DISABLED</span>
<a name="l1834"><span class="linenum">1834</span></a>  <span class="comment">     * @return void</span>
<a name="l1835"><span class="linenum">1835</span></a>  <span class="comment">     */</span>
<a name="l1836"><span class="linenum">1836</span></a>      public function <a class="function" onClick="logFunction('update_status')" href="../_functions/update_status.html" onMouseOver="funcPopup(event,'update_status')">update_status</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>, <a class="var it19857" onMouseOver="hilite(19857)" onMouseOut="lolite()" onClick="logVariable('newstatus')" href="../_variables/newstatus.html">$newstatus</a>) {
<a name="l1837"><span class="linenum">1837</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1838"><span class="linenum">1838</span></a>  
<a name="l1839"><span class="linenum">1839</span></a>          <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('status')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/status.html">status</a> = <a class="var it19857" onMouseOver="hilite(19857)" onMouseOut="lolite()" onClick="logVariable('newstatus')" href="../_variables/newstatus.html">$newstatus</a>;
<a name="l1840"><span class="linenum">1840</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('enrol', <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>);
<a name="l1841"><span class="linenum">1841</span></a>  
<a name="l1842"><span class="linenum">1842</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>);
<a name="l1843"><span class="linenum">1843</span></a>          \core\event\<a class="class" onClick="logClass('enrol_instance_updated')" href="../_classes/enrol_instance_updated.html" onMouseOver="classPopup(event,'enrol_instance_updated')">enrol_instance_updated</a>::<a class="function" onClick="logFunction('create_from_record')" href="../_functions/create_from_record.html" onMouseOver="funcPopup(event,'create_from_record')">create_from_record</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1844"><span class="linenum">1844</span></a>  
<a name="l1845"><span class="linenum">1845</span></a>  <span class="comment">        // Invalidate all enrol caches.</span>
<a name="l1846"><span class="linenum">1846</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('mark_dirty')" href="../_functions/mark_dirty.html" onMouseOver="funcPopup(event,'mark_dirty')">mark_dirty</a>();
<a name="l1847"><span class="linenum">1847</span></a>      }
<a name="l1848"><span class="linenum">1848</span></a>  
<a name="l1849"><span class="linenum">1849</span></a>      <span class="comment">/**</span>
<a name="l1850"><span class="linenum">1850</span></a>  <span class="comment">     * Delete course enrol plugin instance, unenrol all users.</span>
<a name="l1851"><span class="linenum">1851</span></a>  <span class="comment">     * @param object $instance</span>
<a name="l1852"><span class="linenum">1852</span></a>  <span class="comment">     * @return void</span>
<a name="l1853"><span class="linenum">1853</span></a>  <span class="comment">     */</span>
<a name="l1854"><span class="linenum">1854</span></a>      public function <a class="function" onClick="logFunction('delete_instance')" href="../_functions/delete_instance.html" onMouseOver="funcPopup(event,'delete_instance')">delete_instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l1855"><span class="linenum">1855</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1856"><span class="linenum">1856</span></a>  
<a name="l1857"><span class="linenum">1857</span></a>          <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>();
<a name="l1858"><span class="linenum">1858</span></a>          if (<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a> !== <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>) {
<a name="l1859"><span class="linenum">1859</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('invalid enrol instance!');
<a name="l1860"><span class="linenum">1860</span></a>          }
<a name="l1861"><span class="linenum">1861</span></a>  
<a name="l1862"><span class="linenum">1862</span></a>  <span class="comment">        //first unenrol all users</span>
<a name="l1863"><span class="linenum">1863</span></a>          <a class="var it19858" onMouseOver="hilite(19858)" onMouseOut="lolite()" onClick="logVariable('participants')" href="../_variables/participants.html">$participants</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset')" href="../_functions/get_recordset.html" onMouseOver="funcPopup(event,'get_recordset')">get_recordset</a>('user_enrolments', array('enrolid'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l1864"><span class="linenum">1864</span></a>          foreach (<a class="var it19858" onMouseOver="hilite(19858)" onMouseOut="lolite()" onClick="logVariable('participants')" href="../_variables/participants.html">$participants</a> as <a class="var it19859" onMouseOver="hilite(19859)" onMouseOut="lolite()" onClick="logVariable('participant')" href="../_variables/participant.html">$participant</a>) {
<a name="l1865"><span class="linenum">1865</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('unenrol_user')" href="../_functions/unenrol_user.html" onMouseOver="funcPopup(event,'unenrol_user')">unenrol_user</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>, <a class="var it19859" onMouseOver="hilite(19859)" onMouseOut="lolite()" onClick="logVariable('participant')" href="../_variables/participant.html">$participant</a>-&gt;<a onClick="logVariable('userid')" class="var it43308" onMouseOver="hilite(43308)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>);
<a name="l1866"><span class="linenum">1866</span></a>          }
<a name="l1867"><span class="linenum">1867</span></a>          <a class="var it19858" onMouseOver="hilite(19858)" onMouseOut="lolite()" onClick="logVariable('participants')" href="../_variables/participants.html">$participants</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l1868"><span class="linenum">1868</span></a>  
<a name="l1869"><span class="linenum">1869</span></a>  <span class="comment">        // now clean up all remainders that were not removed correctly</span>
<a name="l1870"><span class="linenum">1870</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('groups_members', array('itemid'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'component'=&gt;'enrol_'.<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>));
<a name="l1871"><span class="linenum">1871</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('role_assignments', array('itemid'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'component'=&gt;'enrol_'.<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>));
<a name="l1872"><span class="linenum">1872</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('user_enrolments', array('enrolid'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l1873"><span class="linenum">1873</span></a>  
<a name="l1874"><span class="linenum">1874</span></a>  <span class="comment">        // finally drop the enrol row</span>
<a name="l1875"><span class="linenum">1875</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('enrol', array('id'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l1876"><span class="linenum">1876</span></a>  
<a name="l1877"><span class="linenum">1877</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>);
<a name="l1878"><span class="linenum">1878</span></a>          \core\event\<a class="class" onClick="logClass('enrol_instance_deleted')" href="../_classes/enrol_instance_deleted.html" onMouseOver="classPopup(event,'enrol_instance_deleted')">enrol_instance_deleted</a>::<a class="function" onClick="logFunction('create_from_record')" href="../_functions/create_from_record.html" onMouseOver="funcPopup(event,'create_from_record')">create_from_record</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1879"><span class="linenum">1879</span></a>  
<a name="l1880"><span class="linenum">1880</span></a>  <span class="comment">        // Invalidate all enrol caches.</span>
<a name="l1881"><span class="linenum">1881</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('mark_dirty')" href="../_functions/mark_dirty.html" onMouseOver="funcPopup(event,'mark_dirty')">mark_dirty</a>();
<a name="l1882"><span class="linenum">1882</span></a>      }
<a name="l1883"><span class="linenum">1883</span></a>  
<a name="l1884"><span class="linenum">1884</span></a>      <span class="comment">/**</span>
<a name="l1885"><span class="linenum">1885</span></a>  <span class="comment">     * Creates course enrol form, checks if form submitted</span>
<a name="l1886"><span class="linenum">1886</span></a>  <span class="comment">     * and enrols user if necessary. It can also redirect.</span>
<a name="l1887"><span class="linenum">1887</span></a>  <span class="comment">     *</span>
<a name="l1888"><span class="linenum">1888</span></a>  <span class="comment">     * @param stdClass $instance</span>
<a name="l1889"><span class="linenum">1889</span></a>  <span class="comment">     * @return string html text, usually a form in a text box</span>
<a name="l1890"><span class="linenum">1890</span></a>  <span class="comment">     */</span>
<a name="l1891"><span class="linenum">1891</span></a>      public function <a class="function" onClick="logFunction('enrol_page_hook')" href="../_functions/enrol_page_hook.html" onMouseOver="funcPopup(event,'enrol_page_hook')">enrol_page_hook</a>(stdClass <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l1892"><span class="linenum">1892</span></a>          return null;
<a name="l1893"><span class="linenum">1893</span></a>      }
<a name="l1894"><span class="linenum">1894</span></a>  
<a name="l1895"><span class="linenum">1895</span></a>      <span class="comment">/**</span>
<a name="l1896"><span class="linenum">1896</span></a>  <span class="comment">     * Checks if user can self enrol.</span>
<a name="l1897"><span class="linenum">1897</span></a>  <span class="comment">     *</span>
<a name="l1898"><span class="linenum">1898</span></a>  <span class="comment">     * @param stdClass $instance enrolment instance</span>
<a name="l1899"><span class="linenum">1899</span></a>  <span class="comment">     * @param bool $checkuserenrolment if true will check if user enrolment is inactive.</span>
<a name="l1900"><span class="linenum">1900</span></a>  <span class="comment">     *             used by navigation to improve performance.</span>
<a name="l1901"><span class="linenum">1901</span></a>  <span class="comment">     * @return bool|string true if successful, else error message or false</span>
<a name="l1902"><span class="linenum">1902</span></a>  <span class="comment">     */</span>
<a name="l1903"><span class="linenum">1903</span></a>      public function <a class="function" onClick="logFunction('can_self_enrol')" href="../_functions/can_self_enrol.html" onMouseOver="funcPopup(event,'can_self_enrol')">can_self_enrol</a>(stdClass <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>, <a class="var it19860" onMouseOver="hilite(19860)" onMouseOut="lolite()" onClick="logVariable('checkuserenrolment')" href="../_variables/checkuserenrolment.html">$checkuserenrolment</a> = true) {
<a name="l1904"><span class="linenum">1904</span></a>          return false;
<a name="l1905"><span class="linenum">1905</span></a>      }
<a name="l1906"><span class="linenum">1906</span></a>  
<a name="l1907"><span class="linenum">1907</span></a>      <span class="comment">/**</span>
<a name="l1908"><span class="linenum">1908</span></a>  <span class="comment">     * Return information for enrolment instance containing list of parameters required</span>
<a name="l1909"><span class="linenum">1909</span></a>  <span class="comment">     * for enrolment, name of enrolment plugin etc.</span>
<a name="l1910"><span class="linenum">1910</span></a>  <span class="comment">     *</span>
<a name="l1911"><span class="linenum">1911</span></a>  <span class="comment">     * @param stdClass $instance enrolment instance</span>
<a name="l1912"><span class="linenum">1912</span></a>  <span class="comment">     * @return array instance info.</span>
<a name="l1913"><span class="linenum">1913</span></a>  <span class="comment">     */</span>
<a name="l1914"><span class="linenum">1914</span></a>      public function <a class="function" onClick="logFunction('get_enrol_info')" href="../_functions/get_enrol_info.html" onMouseOver="funcPopup(event,'get_enrol_info')">get_enrol_info</a>(stdClass <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l1915"><span class="linenum">1915</span></a>          return null;
<a name="l1916"><span class="linenum">1916</span></a>      }
<a name="l1917"><span class="linenum">1917</span></a>  
<a name="l1918"><span class="linenum">1918</span></a>      <span class="comment">/**</span>
<a name="l1919"><span class="linenum">1919</span></a>  <span class="comment">     * Adds navigation links into course admin block.</span>
<a name="l1920"><span class="linenum">1920</span></a>  <span class="comment">     *</span>
<a name="l1921"><span class="linenum">1921</span></a>  <span class="comment">     * By defaults looks for manage links only.</span>
<a name="l1922"><span class="linenum">1922</span></a>  <span class="comment">     *</span>
<a name="l1923"><span class="linenum">1923</span></a>  <span class="comment">     * @param navigation_node $instancesnode</span>
<a name="l1924"><span class="linenum">1924</span></a>  <span class="comment">     * @param stdClass $instance</span>
<a name="l1925"><span class="linenum">1925</span></a>  <span class="comment">     * @return void</span>
<a name="l1926"><span class="linenum">1926</span></a>  <span class="comment">     */</span>
<a name="l1927"><span class="linenum">1927</span></a>      public function <a class="function" onClick="logFunction('add_course_navigation')" href="../_functions/add_course_navigation.html" onMouseOver="funcPopup(event,'add_course_navigation')">add_course_navigation</a>(<a class="var it19841" onMouseOver="hilite(19841)" onMouseOut="lolite()" onClick="logVariable('instancesnode')" href="../_variables/instancesnode.html">$instancesnode</a>, stdClass <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l1928"><span class="linenum">1928</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('use_standard_editing_ui')" href="../_functions/use_standard_editing_ui.html" onMouseOver="funcPopup(event,'use_standard_editing_ui')">use_standard_editing_ui</a>()) {
<a name="l1929"><span class="linenum">1929</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>);
<a name="l1930"><span class="linenum">1930</span></a>              <a class="var it2620" onMouseOver="hilite(2620)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a> = 'enrol/' . <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a> . ':config';
<a name="l1931"><span class="linenum">1931</span></a>              if (<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(<a class="var it2620" onMouseOver="hilite(2620)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>)) {
<a name="l1932"><span class="linenum">1932</span></a>                  <a class="var it19861" onMouseOver="hilite(19861)" onMouseOut="lolite()" onClick="logVariable('linkparams')" href="../_variables/linkparams.html">$linkparams</a> = array('courseid' =&gt; <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>, 'id' =&gt; <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'type' =&gt; <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>);
<a name="l1933"><span class="linenum">1933</span></a>                  <a class="var it4179" onMouseOver="hilite(4179)" onMouseOut="lolite()" onClick="logVariable('managelink')" href="../_variables/managelink.html">$managelink</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../enrol/editinstance.php.html">/enrol/editinstance.php</a>', <a class="var it19861" onMouseOver="hilite(19861)" onMouseOut="lolite()" onClick="logVariable('linkparams')" href="../_variables/linkparams.html">$linkparams</a>);
<a name="l1934"><span class="linenum">1934</span></a>                  <a class="var it19841" onMouseOver="hilite(19841)" onMouseOut="lolite()" onClick="logVariable('instancesnode')" href="../_variables/instancesnode.html">$instancesnode</a>-&gt;<a class="function" onClick="logFunction('add')" href="../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_instance_name')" href="../_functions/get_instance_name.html" onMouseOver="funcPopup(event,'get_instance_name')">get_instance_name</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>), <a class="var it4179" onMouseOver="hilite(4179)" onMouseOut="lolite()" onClick="logVariable('managelink')" href="../_variables/managelink.html">$managelink</a>, <a class="class" onClick="logClass('navigation_node')" href="../_classes/navigation_node.html" onMouseOver="classPopup(event,'navigation_node')">navigation_node</a>::TYPE_SETTING);
<a name="l1935"><span class="linenum">1935</span></a>              }
<a name="l1936"><span class="linenum">1936</span></a>          }
<a name="l1937"><span class="linenum">1937</span></a>      }
<a name="l1938"><span class="linenum">1938</span></a>  
<a name="l1939"><span class="linenum">1939</span></a>      <span class="comment">/**</span>
<a name="l1940"><span class="linenum">1940</span></a>  <span class="comment">     * Returns edit icons for the page with list of instances</span>
<a name="l1941"><span class="linenum">1941</span></a>  <span class="comment">     * @param stdClass $instance</span>
<a name="l1942"><span class="linenum">1942</span></a>  <span class="comment">     * @return array</span>
<a name="l1943"><span class="linenum">1943</span></a>  <span class="comment">     */</span>
<a name="l1944"><span class="linenum">1944</span></a>      public function <a class="function" onClick="logFunction('get_action_icons')" href="../_functions/get_action_icons.html" onMouseOver="funcPopup(event,'get_action_icons')">get_action_icons</a>(stdClass <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l1945"><span class="linenum">1945</span></a>          global <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l1946"><span class="linenum">1946</span></a>  
<a name="l1947"><span class="linenum">1947</span></a>          <a class="var it2569" onMouseOver="hilite(2569)" onMouseOut="lolite()" onClick="logVariable('icons')" href="../_variables/icons.html">$icons</a> = array();
<a name="l1948"><span class="linenum">1948</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('use_standard_editing_ui')" href="../_functions/use_standard_editing_ui.html" onMouseOver="funcPopup(event,'use_standard_editing_ui')">use_standard_editing_ui</a>()) {
<a name="l1949"><span class="linenum">1949</span></a>              <a class="var it19861" onMouseOver="hilite(19861)" onMouseOut="lolite()" onClick="logVariable('linkparams')" href="../_variables/linkparams.html">$linkparams</a> = array('courseid' =&gt; <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>, 'id' =&gt; <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'type' =&gt; <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>);
<a name="l1950"><span class="linenum">1950</span></a>              <a class="var it1849" onMouseOver="hilite(1849)" onMouseOut="lolite()" onClick="logVariable('editlink')" href="../_variables/editlink.html">$editlink</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>("<a class="filename" href="../enrol/editinstance.php.html">/enrol/editinstance.php</a>", <a class="var it19861" onMouseOver="hilite(19861)" onMouseOut="lolite()" onClick="logVariable('linkparams')" href="../_variables/linkparams.html">$linkparams</a>);
<a name="l1951"><span class="linenum">1951</span></a>              <a class="var it2569" onMouseOver="hilite(2569)" onMouseOut="lolite()" onClick="logVariable('icons')" href="../_variables/icons.html">$icons</a>[] = <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('action_icon')" href="../_functions/action_icon.html" onMouseOver="funcPopup(event,'action_icon')">action_icon</a>(<a class="var it1849" onMouseOver="hilite(1849)" onMouseOut="lolite()" onClick="logVariable('editlink')" href="../_variables/editlink.html">$editlink</a>, <span class="keyword">new </span><a class="class" onClick="logClass('pix_icon')" href="../_classes/pix_icon.html" onMouseOver="classPopup(event,'pix_icon')">pix_icon</a>('t/edit', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('edit'), 'core',
<a name="l1952"><span class="linenum">1952</span></a>                  array('class' =&gt; 'iconsmall')));
<a name="l1953"><span class="linenum">1953</span></a>          }
<a name="l1954"><span class="linenum">1954</span></a>          return <a class="var it2569" onMouseOver="hilite(2569)" onMouseOut="lolite()" onClick="logVariable('icons')" href="../_variables/icons.html">$icons</a>;
<a name="l1955"><span class="linenum">1955</span></a>      }
<a name="l1956"><span class="linenum">1956</span></a>  
<a name="l1957"><span class="linenum">1957</span></a>      <span class="comment">/**</span>
<a name="l1958"><span class="linenum">1958</span></a>  <span class="comment">     * Reads version.php and determines if it is necessary</span>
<a name="l1959"><span class="linenum">1959</span></a>  <span class="comment">     * to execute the cron job now.</span>
<a name="l1960"><span class="linenum">1960</span></a>  <span class="comment">     * @return bool</span>
<a name="l1961"><span class="linenum">1961</span></a>  <span class="comment">     */</span>
<a name="l1962"><span class="linenum">1962</span></a>      public function <a class="function" onClick="logFunction('is_cron_required')" href="../_functions/is_cron_required.html" onMouseOver="funcPopup(event,'is_cron_required')">is_cron_required</a>() {
<a name="l1963"><span class="linenum">1963</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l1964"><span class="linenum">1964</span></a>  
<a name="l1965"><span class="linenum">1965</span></a>          <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>();
<a name="l1966"><span class="linenum">1966</span></a>          <a class="var it19862" onMouseOver="hilite(19862)" onMouseOut="lolite()" onClick="logVariable('versionfile')" href="../_variables/versionfile.html">$versionfile</a> = &quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>/enrol/<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>/version.php&quot;;
<a name="l1967"><span class="linenum">1967</span></a>          <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a> = new stdClass();
<a name="l1968"><span class="linenum">1968</span></a>          include(<a class="var it19862" onMouseOver="hilite(19862)" onMouseOut="lolite()" onClick="logVariable('versionfile')" href="../_variables/versionfile.html">$versionfile</a>);
<a name="l1969"><span class="linenum">1969</span></a>          if (empty(<a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>-&gt;<a onClick="logVariable('cron')" class="var it42911" onMouseOver="hilite(42911)" onMouseOut="lolite()" href="../_variables/cron.html">cron</a>)) {
<a name="l1970"><span class="linenum">1970</span></a>              return false;
<a name="l1971"><span class="linenum">1971</span></a>          }
<a name="l1972"><span class="linenum">1972</span></a>          <a class="var it19863" onMouseOver="hilite(19863)" onMouseOut="lolite()" onClick="logVariable('lastexecuted')" href="../_variables/lastexecuted.html">$lastexecuted</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('lastcron', 0);
<a name="l1973"><span class="linenum">1973</span></a>          if (<a class="var it19863" onMouseOver="hilite(19863)" onMouseOut="lolite()" onClick="logVariable('lastexecuted')" href="../_variables/lastexecuted.html">$lastexecuted</a> + <a class="var it265" onMouseOver="hilite(265)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../_variables/plugin.html">$plugin</a>-&gt;<a onClick="logVariable('cron')" class="var it42911" onMouseOver="hilite(42911)" onMouseOut="lolite()" href="../_variables/cron.html">cron</a> &lt; <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()) {
<a name="l1974"><span class="linenum">1974</span></a>              return true;
<a name="l1975"><span class="linenum">1975</span></a>          } else {
<a name="l1976"><span class="linenum">1976</span></a>              return false;
<a name="l1977"><span class="linenum">1977</span></a>          }
<a name="l1978"><span class="linenum">1978</span></a>      }
<a name="l1979"><span class="linenum">1979</span></a>  
<a name="l1980"><span class="linenum">1980</span></a>      <span class="comment">/**</span>
<a name="l1981"><span class="linenum">1981</span></a>  <span class="comment">     * Called for all enabled enrol plugins that returned true from is_cron_required().</span>
<a name="l1982"><span class="linenum">1982</span></a>  <span class="comment">     * @return void</span>
<a name="l1983"><span class="linenum">1983</span></a>  <span class="comment">     */</span>
<a name="l1984"><span class="linenum">1984</span></a>      public function <a class="function" onClick="logFunction('cron')" href="../_functions/cron.html" onMouseOver="funcPopup(event,'cron')">cron</a>() {
<a name="l1985"><span class="linenum">1985</span></a>      }
<a name="l1986"><span class="linenum">1986</span></a>  
<a name="l1987"><span class="linenum">1987</span></a>      <span class="comment">/**</span>
<a name="l1988"><span class="linenum">1988</span></a>  <span class="comment">     * Called when user is about to be deleted</span>
<a name="l1989"><span class="linenum">1989</span></a>  <span class="comment">     * @param object $user</span>
<a name="l1990"><span class="linenum">1990</span></a>  <span class="comment">     * @return void</span>
<a name="l1991"><span class="linenum">1991</span></a>  <span class="comment">     */</span>
<a name="l1992"><span class="linenum">1992</span></a>      public function <a class="function" onClick="logFunction('user_delete')" href="../_functions/user_delete.html" onMouseOver="funcPopup(event,'user_delete')">user_delete</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) {
<a name="l1993"><span class="linenum">1993</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1994"><span class="linenum">1994</span></a>  
<a name="l1995"><span class="linenum">1995</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT e.*
<a name="l1996"><span class="linenum">1996</span></a>                    FROM {enrol} e
<a name="l1997"><span class="linenum">1997</span></a>                    JOIN {user_enrolments} ue <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (ue.enrolid = e.id)
<a name="l1998"><span class="linenum">1998</span></a>                   WHERE e.enrol = :name AND ue.userid = :userid&quot;;
<a name="l1999"><span class="linenum">1999</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array('name'=&gt;<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>(), 'userid'=&gt;<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l2000"><span class="linenum">2000</span></a>  
<a name="l2001"><span class="linenum">2001</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l2002"><span class="linenum">2002</span></a>          foreach(<a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> as <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l2003"><span class="linenum">2003</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('unenrol_user')" href="../_functions/unenrol_user.html" onMouseOver="funcPopup(event,'unenrol_user')">unenrol_user</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l2004"><span class="linenum">2004</span></a>          }
<a name="l2005"><span class="linenum">2005</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l2006"><span class="linenum">2006</span></a>      }
<a name="l2007"><span class="linenum">2007</span></a>  
<a name="l2008"><span class="linenum">2008</span></a>      <span class="comment">/**</span>
<a name="l2009"><span class="linenum">2009</span></a>  <span class="comment">     * Returns an enrol_user_button that takes the user to a page where they are able to</span>
<a name="l2010"><span class="linenum">2010</span></a>  <span class="comment">     * enrol users into the managers course through this plugin.</span>
<a name="l2011"><span class="linenum">2011</span></a>  <span class="comment">     *</span>
<a name="l2012"><span class="linenum">2012</span></a>  <span class="comment">     * Optional: If the plugin supports manual enrolments it can choose to override this</span>
<a name="l2013"><span class="linenum">2013</span></a>  <span class="comment">     * otherwise it shouldn't</span>
<a name="l2014"><span class="linenum">2014</span></a>  <span class="comment">     *</span>
<a name="l2015"><span class="linenum">2015</span></a>  <span class="comment">     * @param course_enrolment_manager $manager</span>
<a name="l2016"><span class="linenum">2016</span></a>  <span class="comment">     * @return enrol_user_button|false</span>
<a name="l2017"><span class="linenum">2017</span></a>  <span class="comment">     */</span>
<a name="l2018"><span class="linenum">2018</span></a>      public function <a class="function" onClick="logFunction('get_manual_enrol_button')" href="../_functions/get_manual_enrol_button.html" onMouseOver="funcPopup(event,'get_manual_enrol_button')">get_manual_enrol_button</a>(course_enrolment_manager <a class="var it1045" onMouseOver="hilite(1045)" onMouseOut="lolite()" onClick="logVariable('manager')" href="../_variables/manager.html">$manager</a>) {
<a name="l2019"><span class="linenum">2019</span></a>          return false;
<a name="l2020"><span class="linenum">2020</span></a>      }
<a name="l2021"><span class="linenum">2021</span></a>  
<a name="l2022"><span class="linenum">2022</span></a>      <span class="comment">/**</span>
<a name="l2023"><span class="linenum">2023</span></a>  <span class="comment">     * Gets an array of the user enrolment actions</span>
<a name="l2024"><span class="linenum">2024</span></a>  <span class="comment">     *</span>
<a name="l2025"><span class="linenum">2025</span></a>  <span class="comment">     * @param course_enrolment_manager $manager</span>
<a name="l2026"><span class="linenum">2026</span></a>  <span class="comment">     * @param stdClass $ue</span>
<a name="l2027"><span class="linenum">2027</span></a>  <span class="comment">     * @return array An array of user_enrolment_actions</span>
<a name="l2028"><span class="linenum">2028</span></a>  <span class="comment">     */</span>
<a name="l2029"><span class="linenum">2029</span></a>      public function <a class="function" onClick="logFunction('get_user_enrolment_actions')" href="../_functions/get_user_enrolment_actions.html" onMouseOver="funcPopup(event,'get_user_enrolment_actions')">get_user_enrolment_actions</a>(course_enrolment_manager <a class="var it1045" onMouseOver="hilite(1045)" onMouseOut="lolite()" onClick="logVariable('manager')" href="../_variables/manager.html">$manager</a>, <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>) {
<a name="l2030"><span class="linenum">2030</span></a>          return array();
<a name="l2031"><span class="linenum">2031</span></a>      }
<a name="l2032"><span class="linenum">2032</span></a>  
<a name="l2033"><span class="linenum">2033</span></a>      <span class="comment">/**</span>
<a name="l2034"><span class="linenum">2034</span></a>  <span class="comment">     * Returns true if the plugin has one or more bulk operations that can be performed on</span>
<a name="l2035"><span class="linenum">2035</span></a>  <span class="comment">     * user enrolments.</span>
<a name="l2036"><span class="linenum">2036</span></a>  <span class="comment">     *</span>
<a name="l2037"><span class="linenum">2037</span></a>  <span class="comment">     * @param course_enrolment_manager $manager</span>
<a name="l2038"><span class="linenum">2038</span></a>  <span class="comment">     * @return bool</span>
<a name="l2039"><span class="linenum">2039</span></a>  <span class="comment">     */</span>
<a name="l2040"><span class="linenum">2040</span></a>      public function <a class="function" onClick="logFunction('has_bulk_operations')" href="../_functions/has_bulk_operations.html" onMouseOver="funcPopup(event,'has_bulk_operations')">has_bulk_operations</a>(course_enrolment_manager <a class="var it1045" onMouseOver="hilite(1045)" onMouseOut="lolite()" onClick="logVariable('manager')" href="../_variables/manager.html">$manager</a>) {
<a name="l2041"><span class="linenum">2041</span></a>         return false;
<a name="l2042"><span class="linenum">2042</span></a>      }
<a name="l2043"><span class="linenum">2043</span></a>  
<a name="l2044"><span class="linenum">2044</span></a>      <span class="comment">/**</span>
<a name="l2045"><span class="linenum">2045</span></a>  <span class="comment">     * Return an array of enrol_bulk_enrolment_operation objects that define</span>
<a name="l2046"><span class="linenum">2046</span></a>  <span class="comment">     * the bulk actions that can be performed on user enrolments by the plugin.</span>
<a name="l2047"><span class="linenum">2047</span></a>  <span class="comment">     *</span>
<a name="l2048"><span class="linenum">2048</span></a>  <span class="comment">     * @param course_enrolment_manager $manager</span>
<a name="l2049"><span class="linenum">2049</span></a>  <span class="comment">     * @return array</span>
<a name="l2050"><span class="linenum">2050</span></a>  <span class="comment">     */</span>
<a name="l2051"><span class="linenum">2051</span></a>      public function <a class="function" onClick="logFunction('get_bulk_operations')" href="../_functions/get_bulk_operations.html" onMouseOver="funcPopup(event,'get_bulk_operations')">get_bulk_operations</a>(course_enrolment_manager <a class="var it1045" onMouseOver="hilite(1045)" onMouseOut="lolite()" onClick="logVariable('manager')" href="../_variables/manager.html">$manager</a>) {
<a name="l2052"><span class="linenum">2052</span></a>          return array();
<a name="l2053"><span class="linenum">2053</span></a>      }
<a name="l2054"><span class="linenum">2054</span></a>  
<a name="l2055"><span class="linenum">2055</span></a>      <span class="comment">/**</span>
<a name="l2056"><span class="linenum">2056</span></a>  <span class="comment">     * Do any enrolments need expiration processing.</span>
<a name="l2057"><span class="linenum">2057</span></a>  <span class="comment">     *</span>
<a name="l2058"><span class="linenum">2058</span></a>  <span class="comment">     * Plugins that want to call this functionality must implement 'expiredaction' config setting.</span>
<a name="l2059"><span class="linenum">2059</span></a>  <span class="comment">     *</span>
<a name="l2060"><span class="linenum">2060</span></a>  <span class="comment">     * @param progress_trace $trace</span>
<a name="l2061"><span class="linenum">2061</span></a>  <span class="comment">     * @param int $courseid one course, empty mean all</span>
<a name="l2062"><span class="linenum">2062</span></a>  <span class="comment">     * @return bool true if any data processed, false if not</span>
<a name="l2063"><span class="linenum">2063</span></a>  <span class="comment">     */</span>
<a name="l2064"><span class="linenum">2064</span></a>      public function <a class="function" onClick="logFunction('process_expirations')" href="../_functions/process_expirations.html" onMouseOver="funcPopup(event,'process_expirations')">process_expirations</a>(progress_trace <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a> = null) {
<a name="l2065"><span class="linenum">2065</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l2066"><span class="linenum">2066</span></a>  
<a name="l2067"><span class="linenum">2067</span></a>          <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>();
<a name="l2068"><span class="linenum">2068</span></a>          if (!<a class="function" onClick="logFunction('enrol_is_enabled')" href="../_functions/enrol_is_enabled.html" onMouseOver="funcPopup(event,'enrol_is_enabled')">enrol_is_enabled</a>(<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>)) {
<a name="l2069"><span class="linenum">2069</span></a>              <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('finished')" href="../_functions/finished.html" onMouseOver="funcPopup(event,'finished')">finished</a>();
<a name="l2070"><span class="linenum">2070</span></a>              return false;
<a name="l2071"><span class="linenum">2071</span></a>          }
<a name="l2072"><span class="linenum">2072</span></a>  
<a name="l2073"><span class="linenum">2073</span></a>          <a class="var it2705" onMouseOver="hilite(2705)" onMouseOut="lolite()" onClick="logVariable('processed')" href="../_variables/processed.html">$processed</a> = false;
<a name="l2074"><span class="linenum">2074</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array();
<a name="l2075"><span class="linenum">2075</span></a>          <a class="var it4194" onMouseOver="hilite(4194)" onMouseOut="lolite()" onClick="logVariable('coursesql')" href="../_variables/coursesql.html">$coursesql</a> = &quot;&quot;;
<a name="l2076"><span class="linenum">2076</span></a>          if (<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>) {
<a name="l2077"><span class="linenum">2077</span></a>              <a class="var it4194" onMouseOver="hilite(4194)" onMouseOut="lolite()" onClick="logVariable('coursesql')" href="../_variables/coursesql.html">$coursesql</a> = &quot;AND e.courseid = :courseid&quot;;
<a name="l2078"><span class="linenum">2078</span></a>          }
<a name="l2079"><span class="linenum">2079</span></a>  
<a name="l2080"><span class="linenum">2080</span></a>  <span class="comment">        // Deal with expired accounts.</span>
<a name="l2081"><span class="linenum">2081</span></a>          <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../_variables/action.html">$action</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('expiredaction', <a class="constant" onClick="logConstant('ENROL_EXT_REMOVED_KEEP')" href="../_constants/ENROL_EXT_REMOVED_KEEP.html" onMouseOver="constPopup(event,'ENROL_EXT_REMOVED_KEEP')">ENROL_EXT_REMOVED_KEEP</a>);
<a name="l2082"><span class="linenum">2082</span></a>  
<a name="l2083"><span class="linenum">2083</span></a>          if (<a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../_variables/action.html">$action</a> == <a class="constant" onClick="logConstant('ENROL_EXT_REMOVED_UNENROL')" href="../_constants/ENROL_EXT_REMOVED_UNENROL.html" onMouseOver="constPopup(event,'ENROL_EXT_REMOVED_UNENROL')">ENROL_EXT_REMOVED_UNENROL</a>) {
<a name="l2084"><span class="linenum">2084</span></a>              <a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a> = array();
<a name="l2085"><span class="linenum">2085</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT ue.*, e.courseid, c.id AS contextid
<a name="l2086"><span class="linenum">2086</span></a>                        FROM {user_enrolments} ue
<a name="l2087"><span class="linenum">2087</span></a>                        JOIN {enrol} e <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (e.id = ue.enrolid AND e.enrol = :enrol)
<a name="l2088"><span class="linenum">2088</span></a>                        JOIN {context} c <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (c.instanceid = e.courseid AND c.contextlevel = :courselevel)
<a name="l2089"><span class="linenum">2089</span></a>                       WHERE ue.timeend &gt; 0 AND ue.timeend &lt; :now <a class="var it4194" onMouseOver="hilite(4194)" onMouseOut="lolite()" onClick="logVariable('coursesql')" href="../_variables/coursesql.html">$coursesql</a>&quot;;
<a name="l2090"><span class="linenum">2090</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array('now'=&gt;<a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>(), 'courselevel'=&gt;<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>, 'enrol'=&gt;<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>, 'courseid'=&gt;<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>);
<a name="l2091"><span class="linenum">2091</span></a>  
<a name="l2092"><span class="linenum">2092</span></a>              <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l2093"><span class="linenum">2093</span></a>              foreach (<a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> as <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>) {
<a name="l2094"><span class="linenum">2094</span></a>                  if (!<a class="var it2705" onMouseOver="hilite(2705)" onMouseOut="lolite()" onClick="logVariable('processed')" href="../_variables/processed.html">$processed</a>) {
<a name="l2095"><span class="linenum">2095</span></a>                      <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;Starting processing of enrol_<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> expirations...&quot;);
<a name="l2096"><span class="linenum">2096</span></a>                      <a class="var it2705" onMouseOver="hilite(2705)" onMouseOut="lolite()" onClick="logVariable('processed')" href="../_variables/processed.html">$processed</a> = true;
<a name="l2097"><span class="linenum">2097</span></a>                  }
<a name="l2098"><span class="linenum">2098</span></a>                  if (empty(<a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a>[<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('enrolid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/enrolid.html">enrolid</a>])) {
<a name="l2099"><span class="linenum">2099</span></a>                      <a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a>[<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('enrolid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/enrolid.html">enrolid</a>] = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('enrol', array('id'=&gt;<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('enrolid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/enrolid.html">enrolid</a>));
<a name="l2100"><span class="linenum">2100</span></a>                  }
<a name="l2101"><span class="linenum">2101</span></a>                  <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a> = <a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a>[<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('enrolid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/enrolid.html">enrolid</a>];
<a name="l2102"><span class="linenum">2102</span></a>                  if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('roles_protected')" href="../_functions/roles_protected.html" onMouseOver="funcPopup(event,'roles_protected')">roles_protected</a>()) {
<a name="l2103"><span class="linenum">2103</span></a>  <span class="comment">                    // Let's just guess what extra roles are supposed to be removed.</span>
<a name="l2104"><span class="linenum">2104</span></a>                      if (<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('roleid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>) {
<a name="l2105"><span class="linenum">2105</span></a>                          <a class="function" onClick="logFunction('role_unassign')" href="../_functions/role_unassign.html" onMouseOver="funcPopup(event,'role_unassign')">role_unassign</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('roleid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>, <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('userid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>, <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('contextid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/contextid.html">contextid</a>);
<a name="l2106"><span class="linenum">2106</span></a>                      }
<a name="l2107"><span class="linenum">2107</span></a>                  }
<a name="l2108"><span class="linenum">2108</span></a>  <span class="comment">                // The unenrol cleans up all subcontexts if this is the only course enrolment for this user.</span>
<a name="l2109"><span class="linenum">2109</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('unenrol_user')" href="../_functions/unenrol_user.html" onMouseOver="funcPopup(event,'unenrol_user')">unenrol_user</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>, <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('userid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>);
<a name="l2110"><span class="linenum">2110</span></a>                  <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;Unenrolling expired user <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('userid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a> from course <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>&quot;, 1);
<a name="l2111"><span class="linenum">2111</span></a>              }
<a name="l2112"><span class="linenum">2112</span></a>              <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l2113"><span class="linenum">2113</span></a>              unset(<a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a>);
<a name="l2114"><span class="linenum">2114</span></a>  
<a name="l2115"><span class="linenum">2115</span></a>          } else if (<a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../_variables/action.html">$action</a> == <a class="constant" onClick="logConstant('ENROL_EXT_REMOVED_SUSPENDNOROLES')" href="../_constants/ENROL_EXT_REMOVED_SUSPENDNOROLES.html" onMouseOver="constPopup(event,'ENROL_EXT_REMOVED_SUSPENDNOROLES')">ENROL_EXT_REMOVED_SUSPENDNOROLES</a> or <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../_variables/action.html">$action</a> == <a class="constant" onClick="logConstant('ENROL_EXT_REMOVED_SUSPEND')" href="../_constants/ENROL_EXT_REMOVED_SUSPEND.html" onMouseOver="constPopup(event,'ENROL_EXT_REMOVED_SUSPEND')">ENROL_EXT_REMOVED_SUSPEND</a>) {
<a name="l2116"><span class="linenum">2116</span></a>              <a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a> = array();
<a name="l2117"><span class="linenum">2117</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT ue.*, e.courseid, c.id AS contextid
<a name="l2118"><span class="linenum">2118</span></a>                        FROM {user_enrolments} ue
<a name="l2119"><span class="linenum">2119</span></a>                        JOIN {enrol} e <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (e.id = ue.enrolid AND e.enrol = :enrol)
<a name="l2120"><span class="linenum">2120</span></a>                        JOIN {context} c <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (c.instanceid = e.courseid AND c.contextlevel = :courselevel)
<a name="l2121"><span class="linenum">2121</span></a>                       WHERE ue.timeend &gt; 0 AND ue.timeend &lt; :now
<a name="l2122"><span class="linenum">2122</span></a>                             AND ue.status = :useractive <a class="var it4194" onMouseOver="hilite(4194)" onMouseOut="lolite()" onClick="logVariable('coursesql')" href="../_variables/coursesql.html">$coursesql</a>&quot;;
<a name="l2123"><span class="linenum">2123</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array('now'=&gt;<a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>(), 'courselevel'=&gt;<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>, 'useractive'=&gt;<a class="constant" onClick="logConstant('ENROL_USER_ACTIVE')" href="../_constants/ENROL_USER_ACTIVE.html" onMouseOver="constPopup(event,'ENROL_USER_ACTIVE')">ENROL_USER_ACTIVE</a>, 'enrol'=&gt;<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>, 'courseid'=&gt;<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>);
<a name="l2124"><span class="linenum">2124</span></a>              <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l2125"><span class="linenum">2125</span></a>              foreach (<a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> as <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>) {
<a name="l2126"><span class="linenum">2126</span></a>                  if (!<a class="var it2705" onMouseOver="hilite(2705)" onMouseOut="lolite()" onClick="logVariable('processed')" href="../_variables/processed.html">$processed</a>) {
<a name="l2127"><span class="linenum">2127</span></a>                      <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;Starting processing of enrol_<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> expirations...&quot;);
<a name="l2128"><span class="linenum">2128</span></a>                      <a class="var it2705" onMouseOver="hilite(2705)" onMouseOut="lolite()" onClick="logVariable('processed')" href="../_variables/processed.html">$processed</a> = true;
<a name="l2129"><span class="linenum">2129</span></a>                  }
<a name="l2130"><span class="linenum">2130</span></a>                  if (empty(<a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a>[<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('enrolid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/enrolid.html">enrolid</a>])) {
<a name="l2131"><span class="linenum">2131</span></a>                      <a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a>[<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('enrolid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/enrolid.html">enrolid</a>] = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('enrol', array('id'=&gt;<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('enrolid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/enrolid.html">enrolid</a>));
<a name="l2132"><span class="linenum">2132</span></a>                  }
<a name="l2133"><span class="linenum">2133</span></a>                  <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a> = <a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a>[<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('enrolid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/enrolid.html">enrolid</a>];
<a name="l2134"><span class="linenum">2134</span></a>  
<a name="l2135"><span class="linenum">2135</span></a>                  if (<a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../_variables/action.html">$action</a> == <a class="constant" onClick="logConstant('ENROL_EXT_REMOVED_SUSPENDNOROLES')" href="../_constants/ENROL_EXT_REMOVED_SUSPENDNOROLES.html" onMouseOver="constPopup(event,'ENROL_EXT_REMOVED_SUSPENDNOROLES')">ENROL_EXT_REMOVED_SUSPENDNOROLES</a>) {
<a name="l2136"><span class="linenum">2136</span></a>                      if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('roles_protected')" href="../_functions/roles_protected.html" onMouseOver="funcPopup(event,'roles_protected')">roles_protected</a>()) {
<a name="l2137"><span class="linenum">2137</span></a>  <span class="comment">                        // Let's just guess what roles should be removed.</span>
<a name="l2138"><span class="linenum">2138</span></a>                          <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../_variables/count.html">$count</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records')" href="../_functions/count_records.html" onMouseOver="funcPopup(event,'count_records')">count_records</a>('role_assignments', array('userid'=&gt;<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('userid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>, 'contextid'=&gt;<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('contextid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/contextid.html">contextid</a>));
<a name="l2139"><span class="linenum">2139</span></a>                          if (<a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../_variables/count.html">$count</a> == 1) {
<a name="l2140"><span class="linenum">2140</span></a>                              <a class="function" onClick="logFunction('role_unassign_all')" href="../_functions/role_unassign_all.html" onMouseOver="funcPopup(event,'role_unassign_all')">role_unassign_all</a>(array('userid'=&gt;<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('userid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>, 'contextid'=&gt;<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('contextid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/contextid.html">contextid</a>, 'component'=&gt;'', 'itemid'=&gt;0));
<a name="l2141"><span class="linenum">2141</span></a>  
<a name="l2142"><span class="linenum">2142</span></a>                          } else if (<a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../_variables/count.html">$count</a> &gt; 1 and <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('roleid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>) {
<a name="l2143"><span class="linenum">2143</span></a>                              <a class="function" onClick="logFunction('role_unassign')" href="../_functions/role_unassign.html" onMouseOver="funcPopup(event,'role_unassign')">role_unassign</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('roleid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>, <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('userid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>, <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('contextid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/contextid.html">contextid</a>, '', 0);
<a name="l2144"><span class="linenum">2144</span></a>                          }
<a name="l2145"><span class="linenum">2145</span></a>                      }
<a name="l2146"><span class="linenum">2146</span></a>  <span class="comment">                    // In any case remove all roles that belong to this instance and user.</span>
<a name="l2147"><span class="linenum">2147</span></a>                      <a class="function" onClick="logFunction('role_unassign_all')" href="../_functions/role_unassign_all.html" onMouseOver="funcPopup(event,'role_unassign_all')">role_unassign_all</a>(array('userid'=&gt;<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('userid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>, 'contextid'=&gt;<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('contextid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/contextid.html">contextid</a>, 'component'=&gt;'enrol_'.<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>, 'itemid'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>), true);
<a name="l2148"><span class="linenum">2148</span></a>  <span class="comment">                    // Final cleanup of subcontexts if there are no more course roles.</span>
<a name="l2149"><span class="linenum">2149</span></a>                      if (0 == <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records')" href="../_functions/count_records.html" onMouseOver="funcPopup(event,'count_records')">count_records</a>('role_assignments', array('userid'=&gt;<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('userid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>, 'contextid'=&gt;<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('contextid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/contextid.html">contextid</a>))) {
<a name="l2150"><span class="linenum">2150</span></a>                          <a class="function" onClick="logFunction('role_unassign_all')" href="../_functions/role_unassign_all.html" onMouseOver="funcPopup(event,'role_unassign_all')">role_unassign_all</a>(array('userid'=&gt;<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('userid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>, 'contextid'=&gt;<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('contextid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/contextid.html">contextid</a>, 'component'=&gt;'', 'itemid'=&gt;0), true);
<a name="l2151"><span class="linenum">2151</span></a>                      }
<a name="l2152"><span class="linenum">2152</span></a>                  }
<a name="l2153"><span class="linenum">2153</span></a>  
<a name="l2154"><span class="linenum">2154</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('update_user_enrol')" href="../_functions/update_user_enrol.html" onMouseOver="funcPopup(event,'update_user_enrol')">update_user_enrol</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>, <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('userid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>, <a class="constant" onClick="logConstant('ENROL_USER_SUSPENDED')" href="../_constants/ENROL_USER_SUSPENDED.html" onMouseOver="constPopup(event,'ENROL_USER_SUSPENDED')">ENROL_USER_SUSPENDED</a>);
<a name="l2155"><span class="linenum">2155</span></a>                  <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;Suspending expired user <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('userid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a> in course <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>&quot;, 1);
<a name="l2156"><span class="linenum">2156</span></a>              }
<a name="l2157"><span class="linenum">2157</span></a>              <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l2158"><span class="linenum">2158</span></a>              unset(<a class="var it1025" onMouseOver="hilite(1025)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a>);
<a name="l2159"><span class="linenum">2159</span></a>  
<a name="l2160"><span class="linenum">2160</span></a>          } else {
<a name="l2161"><span class="linenum">2161</span></a>  <span class="comment">            // ENROL_EXT_REMOVED_KEEP means no changes.</span>
<a name="l2162"><span class="linenum">2162</span></a>          }
<a name="l2163"><span class="linenum">2163</span></a>  
<a name="l2164"><span class="linenum">2164</span></a>          if (<a class="var it2705" onMouseOver="hilite(2705)" onMouseOut="lolite()" onClick="logVariable('processed')" href="../_variables/processed.html">$processed</a>) {
<a name="l2165"><span class="linenum">2165</span></a>              <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;...finished processing of enrol_<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> expirations&quot;);
<a name="l2166"><span class="linenum">2166</span></a>          } else {
<a name="l2167"><span class="linenum">2167</span></a>              <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;No expired enrol_<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> enrolments detected&quot;);
<a name="l2168"><span class="linenum">2168</span></a>          }
<a name="l2169"><span class="linenum">2169</span></a>          <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('finished')" href="../_functions/finished.html" onMouseOver="funcPopup(event,'finished')">finished</a>();
<a name="l2170"><span class="linenum">2170</span></a>  
<a name="l2171"><span class="linenum">2171</span></a>          return <a class="var it2705" onMouseOver="hilite(2705)" onMouseOut="lolite()" onClick="logVariable('processed')" href="../_variables/processed.html">$processed</a>;
<a name="l2172"><span class="linenum">2172</span></a>      }
<a name="l2173"><span class="linenum">2173</span></a>  
<a name="l2174"><span class="linenum">2174</span></a>      <span class="comment">/**</span>
<a name="l2175"><span class="linenum">2175</span></a>  <span class="comment">     * Send expiry notifications.</span>
<a name="l2176"><span class="linenum">2176</span></a>  <span class="comment">     *</span>
<a name="l2177"><span class="linenum">2177</span></a>  <span class="comment">     * Plugin that wants to have expiry notification MUST implement following:</span>
<a name="l2178"><span class="linenum">2178</span></a>  <span class="comment">     * - expirynotifyhour plugin setting,</span>
<a name="l2179"><span class="linenum">2179</span></a>  <span class="comment">     * - configuration options in instance edit form (expirynotify, notifyall and expirythreshold),</span>
<a name="l2180"><span class="linenum">2180</span></a>  <span class="comment">     * - notification strings (expirymessageenrollersubject, expirymessageenrollerbody,</span>
<a name="l2181"><span class="linenum">2181</span></a>  <span class="comment">     *   expirymessageenrolledsubject and expirymessageenrolledbody),</span>
<a name="l2182"><span class="linenum">2182</span></a>  <span class="comment">     * - expiry_notification provider in db/messages.php,</span>
<a name="l2183"><span class="linenum">2183</span></a>  <span class="comment">     * - upgrade code that sets default thresholds for existing courses (should be 1 day),</span>
<a name="l2184"><span class="linenum">2184</span></a>  <span class="comment">     * - something that calls this method, such as cron.</span>
<a name="l2185"><span class="linenum">2185</span></a>  <span class="comment">     *</span>
<a name="l2186"><span class="linenum">2186</span></a>  <span class="comment">     * @param progress_trace $trace (accepts bool for backwards compatibility only)</span>
<a name="l2187"><span class="linenum">2187</span></a>  <span class="comment">     */</span>
<a name="l2188"><span class="linenum">2188</span></a>      public function <a class="function" onClick="logFunction('send_expiry_notifications')" href="../_functions/send_expiry_notifications.html" onMouseOver="funcPopup(event,'send_expiry_notifications')">send_expiry_notifications</a>(<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>) {
<a name="l2189"><span class="linenum">2189</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l2190"><span class="linenum">2190</span></a>  
<a name="l2191"><span class="linenum">2191</span></a>          <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>();
<a name="l2192"><span class="linenum">2192</span></a>          if (!<a class="function" onClick="logFunction('enrol_is_enabled')" href="../_functions/enrol_is_enabled.html" onMouseOver="funcPopup(event,'enrol_is_enabled')">enrol_is_enabled</a>(<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>)) {
<a name="l2193"><span class="linenum">2193</span></a>              <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('finished')" href="../_functions/finished.html" onMouseOver="funcPopup(event,'finished')">finished</a>();
<a name="l2194"><span class="linenum">2194</span></a>              return;
<a name="l2195"><span class="linenum">2195</span></a>          }
<a name="l2196"><span class="linenum">2196</span></a>  
<a name="l2197"><span class="linenum">2197</span></a>  <span class="comment">        // Unfortunately this may take a long time, it should not be interrupted,</span>
<a name="l2198"><span class="linenum">2198</span></a>  <span class="comment">        // otherwise users get duplicate notification.</span>
<a name="l2199"><span class="linenum">2199</span></a>  
<a name="l2200"><span class="linenum">2200</span></a>          <a class="class" onClick="logClass('core_php_time_limit')" href="../_classes/core_php_time_limit.html" onMouseOver="classPopup(event,'core_php_time_limit')">core_php_time_limit</a>::<a class="function" onClick="logFunction('raise')" href="../_functions/raise.html" onMouseOver="funcPopup(event,'raise')">raise</a>();
<a name="l2201"><span class="linenum">2201</span></a>          <a class="function" onClick="logFunction('raise_memory_limit')" href="../_functions/raise_memory_limit.html" onMouseOver="funcPopup(event,'raise_memory_limit')">raise_memory_limit</a>(<a class="constant" onClick="logConstant('MEMORY_HUGE')" href="../_constants/MEMORY_HUGE.html" onMouseOver="constPopup(event,'MEMORY_HUGE')">MEMORY_HUGE</a>);
<a name="l2202"><span class="linenum">2202</span></a>  
<a name="l2203"><span class="linenum">2203</span></a>  
<a name="l2204"><span class="linenum">2204</span></a>          <a class="var it19864" onMouseOver="hilite(19864)" onMouseOut="lolite()" onClick="logVariable('expirynotifylast')" href="../_variables/expirynotifylast.html">$expirynotifylast</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('expirynotifylast', 0);
<a name="l2205"><span class="linenum">2205</span></a>          <a class="var it19865" onMouseOver="hilite(19865)" onMouseOut="lolite()" onClick="logVariable('expirynotifyhour')" href="../_variables/expirynotifyhour.html">$expirynotifyhour</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_config')" href="../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('expirynotifyhour');
<a name="l2206"><span class="linenum">2206</span></a>          if (<a class="phpfunction" onClick="logFunction('is_null')" href="../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it19865" onMouseOver="hilite(19865)" onMouseOut="lolite()" onClick="logVariable('expirynotifyhour')" href="../_variables/expirynotifyhour.html">$expirynotifyhour</a>)) {
<a name="l2207"><span class="linenum">2207</span></a>              <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>(&quot;<a class="function" onClick="logFunction('send_expiry_notifications')" href="../_functions/send_expiry_notifications.html" onMouseOver="funcPopup(event,'send_expiry_notifications')">send_expiry_notifications</a>() in <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> enrolment plugin needs expirynotifyhour setting&quot;);
<a name="l2208"><span class="linenum">2208</span></a>              <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('finished')" href="../_functions/finished.html" onMouseOver="funcPopup(event,'finished')">finished</a>();
<a name="l2209"><span class="linenum">2209</span></a>              return;
<a name="l2210"><span class="linenum">2210</span></a>          }
<a name="l2211"><span class="linenum">2211</span></a>  
<a name="l2212"><span class="linenum">2212</span></a>          if (!(<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a> instanceof progress_trace)) {
<a name="l2213"><span class="linenum">2213</span></a>              <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a> = <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a> ? <span class="keyword">new </span><a class="class" onClick="logClass('text_progress_trace')" href="../_classes/text_progress_trace.html" onMouseOver="classPopup(event,'text_progress_trace')">text_progress_trace</a>() : <span class="keyword">new </span><a class="class" onClick="logClass('null_progress_trace')" href="../_classes/null_progress_trace.html" onMouseOver="classPopup(event,'null_progress_trace')">null_progress_trace</a>();
<a name="l2214"><span class="linenum">2214</span></a>              <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('enrol_plugin::<a class="function" onClick="logFunction('send_expiry_notifications')" href="../_functions/send_expiry_notifications.html" onMouseOver="funcPopup(event,'send_expiry_notifications')">send_expiry_notifications</a>() now expects progress_trace instance as parameter!', <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l2215"><span class="linenum">2215</span></a>          }
<a name="l2216"><span class="linenum">2216</span></a>  
<a name="l2217"><span class="linenum">2217</span></a>          <a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../_variables/timenow.html">$timenow</a> = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l2218"><span class="linenum">2218</span></a>          <a class="var it19866" onMouseOver="hilite(19866)" onMouseOut="lolite()" onClick="logVariable('notifytime')" href="../_variables/notifytime.html">$notifytime</a> = <a class="function" onClick="logFunction('usergetmidnight')" href="../_functions/usergetmidnight.html" onMouseOver="funcPopup(event,'usergetmidnight')">usergetmidnight</a>(<a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../_variables/timenow.html">$timenow</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('timezone')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/timezone.html">timezone</a>) + (<a class="var it19865" onMouseOver="hilite(19865)" onMouseOut="lolite()" onClick="logVariable('expirynotifyhour')" href="../_variables/expirynotifyhour.html">$expirynotifyhour</a> * 3600);
<a name="l2219"><span class="linenum">2219</span></a>  
<a name="l2220"><span class="linenum">2220</span></a>          if (<a class="var it19864" onMouseOver="hilite(19864)" onMouseOut="lolite()" onClick="logVariable('expirynotifylast')" href="../_variables/expirynotifylast.html">$expirynotifylast</a> &gt; <a class="var it19866" onMouseOver="hilite(19866)" onMouseOut="lolite()" onClick="logVariable('notifytime')" href="../_variables/notifytime.html">$notifytime</a>) {
<a name="l2221"><span class="linenum">2221</span></a>              <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>.' enrolment expiry notifications were already sent today at '.<a class="function" onClick="logFunction('userdate')" href="../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it19864" onMouseOver="hilite(19864)" onMouseOut="lolite()" onClick="logVariable('expirynotifylast')" href="../_variables/expirynotifylast.html">$expirynotifylast</a>, '', <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('timezone')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/timezone.html">timezone</a>).'.');
<a name="l2222"><span class="linenum">2222</span></a>              <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('finished')" href="../_functions/finished.html" onMouseOver="funcPopup(event,'finished')">finished</a>();
<a name="l2223"><span class="linenum">2223</span></a>              return;
<a name="l2224"><span class="linenum">2224</span></a>  
<a name="l2225"><span class="linenum">2225</span></a>          } else if (<a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../_variables/timenow.html">$timenow</a> &lt; <a class="var it19866" onMouseOver="hilite(19866)" onMouseOut="lolite()" onClick="logVariable('notifytime')" href="../_variables/notifytime.html">$notifytime</a>) {
<a name="l2226"><span class="linenum">2226</span></a>              <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>.' enrolment expiry notifications will be sent at '.<a class="function" onClick="logFunction('userdate')" href="../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it19866" onMouseOver="hilite(19866)" onMouseOut="lolite()" onClick="logVariable('notifytime')" href="../_variables/notifytime.html">$notifytime</a>, '', <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('timezone')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/timezone.html">timezone</a>).'.');
<a name="l2227"><span class="linenum">2227</span></a>              <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('finished')" href="../_functions/finished.html" onMouseOver="funcPopup(event,'finished')">finished</a>();
<a name="l2228"><span class="linenum">2228</span></a>              return;
<a name="l2229"><span class="linenum">2229</span></a>          }
<a name="l2230"><span class="linenum">2230</span></a>  
<a name="l2231"><span class="linenum">2231</span></a>          <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>('Processing '.<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>.' enrolment expiration notifications...');
<a name="l2232"><span class="linenum">2232</span></a>  
<a name="l2233"><span class="linenum">2233</span></a>  <span class="comment">        // Notify users responsible for enrolment once every day.</span>
<a name="l2234"><span class="linenum">2234</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT ue.*, e.expirynotify, e.notifyall, e.expirythreshold, e.courseid, c.fullname
<a name="l2235"><span class="linenum">2235</span></a>                    FROM {user_enrolments} ue
<a name="l2236"><span class="linenum">2236</span></a>                    JOIN {enrol} e <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (e.id = ue.enrolid AND e.enrol = :name AND e.expirynotify &gt; 0 AND e.status = :enabled)
<a name="l2237"><span class="linenum">2237</span></a>                    JOIN {course} c <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (c.id = e.courseid)
<a name="l2238"><span class="linenum">2238</span></a>                    JOIN {user} u <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (u.id = ue.userid AND u.deleted = 0 AND u.suspended = 0)
<a name="l2239"><span class="linenum">2239</span></a>                   WHERE ue.status = :active AND ue.timeend &gt; 0 AND ue.timeend &gt; :now1 AND ue.timeend &lt; (e.expirythreshold + :now2)
<a name="l2240"><span class="linenum">2240</span></a>                ORDER BY ue.enrolid ASC, u.lastname ASC, u.firstname ASC, u.id ASC&quot;;
<a name="l2241"><span class="linenum">2241</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array('enabled'=&gt;<a class="constant" onClick="logConstant('ENROL_INSTANCE_ENABLED')" href="../_constants/ENROL_INSTANCE_ENABLED.html" onMouseOver="constPopup(event,'ENROL_INSTANCE_ENABLED')">ENROL_INSTANCE_ENABLED</a>, 'active'=&gt;<a class="constant" onClick="logConstant('ENROL_USER_ACTIVE')" href="../_constants/ENROL_USER_ACTIVE.html" onMouseOver="constPopup(event,'ENROL_USER_ACTIVE')">ENROL_USER_ACTIVE</a>, 'now1'=&gt;<a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../_variables/timenow.html">$timenow</a>, 'now2'=&gt;<a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../_variables/timenow.html">$timenow</a>, 'name'=&gt;<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>);
<a name="l2242"><span class="linenum">2242</span></a>  
<a name="l2243"><span class="linenum">2243</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l2244"><span class="linenum">2244</span></a>  
<a name="l2245"><span class="linenum">2245</span></a>          <a class="var it19867" onMouseOver="hilite(19867)" onMouseOut="lolite()" onClick="logVariable('lastenrollid')" href="../_variables/lastenrollid.html">$lastenrollid</a> = 0;
<a name="l2246"><span class="linenum">2246</span></a>          <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a> = array();
<a name="l2247"><span class="linenum">2247</span></a>  
<a name="l2248"><span class="linenum">2248</span></a>          foreach(<a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> as <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>) {
<a name="l2249"><span class="linenum">2249</span></a>              if (<a class="var it19867" onMouseOver="hilite(19867)" onMouseOut="lolite()" onClick="logVariable('lastenrollid')" href="../_variables/lastenrollid.html">$lastenrollid</a> and <a class="var it19867" onMouseOver="hilite(19867)" onMouseOut="lolite()" onClick="logVariable('lastenrollid')" href="../_variables/lastenrollid.html">$lastenrollid</a> != <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('enrolid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/enrolid.html">enrolid</a>) {
<a name="l2250"><span class="linenum">2250</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('notify_expiry_enroller')" href="../_functions/notify_expiry_enroller.html" onMouseOver="funcPopup(event,'notify_expiry_enroller')">notify_expiry_enroller</a>(<a class="var it19867" onMouseOver="hilite(19867)" onMouseOut="lolite()" onClick="logVariable('lastenrollid')" href="../_variables/lastenrollid.html">$lastenrollid</a>, <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a>, <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>);
<a name="l2251"><span class="linenum">2251</span></a>                  <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a> = array();
<a name="l2252"><span class="linenum">2252</span></a>              }
<a name="l2253"><span class="linenum">2253</span></a>              <a class="var it19867" onMouseOver="hilite(19867)" onMouseOut="lolite()" onClick="logVariable('lastenrollid')" href="../_variables/lastenrollid.html">$lastenrollid</a> = <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('enrolid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/enrolid.html">enrolid</a>;
<a name="l2254"><span class="linenum">2254</span></a>  
<a name="l2255"><span class="linenum">2255</span></a>              <a class="var it14816" onMouseOver="hilite(14816)" onMouseOut="lolite()" onClick="logVariable('enroller')" href="../_variables/enroller.html">$enroller</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_enroller')" href="../_functions/get_enroller.html" onMouseOver="funcPopup(event,'get_enroller')">get_enroller</a>(<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('enrolid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/enrolid.html">enrolid</a>);
<a name="l2256"><span class="linenum">2256</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('courseid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>);
<a name="l2257"><span class="linenum">2257</span></a>  
<a name="l2258"><span class="linenum">2258</span></a>              <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id'=&gt;<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('userid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>));
<a name="l2259"><span class="linenum">2259</span></a>  
<a name="l2260"><span class="linenum">2260</span></a>              <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a>[] = array('fullname'=&gt;<a class="function" onClick="logFunction('fullname')" href="../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:viewfullnames', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it14816" onMouseOver="hilite(14816)" onMouseOut="lolite()" onClick="logVariable('enroller')" href="../_variables/enroller.html">$enroller</a>)), 'timeend'=&gt;<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('timeend')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/timeend.html">timeend</a>);
<a name="l2261"><span class="linenum">2261</span></a>  
<a name="l2262"><span class="linenum">2262</span></a>              if (!<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('notifyall')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/notifyall.html">notifyall</a>) {
<a name="l2263"><span class="linenum">2263</span></a>                  continue;
<a name="l2264"><span class="linenum">2264</span></a>              }
<a name="l2265"><span class="linenum">2265</span></a>  
<a name="l2266"><span class="linenum">2266</span></a>              if (<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('timeend')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/timeend.html">timeend</a> - <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('expirythreshold')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/expirythreshold.html">expirythreshold</a> + 86400 &lt; <a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../_variables/timenow.html">$timenow</a>) {
<a name="l2267"><span class="linenum">2267</span></a>  <span class="comment">                // Notify enrolled users only once at the start of the threshold.</span>
<a name="l2268"><span class="linenum">2268</span></a>                  <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;user <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('userid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a> was already notified that enrolment in course <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('courseid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a> expires on &quot;.<a class="function" onClick="logFunction('userdate')" href="../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('timeend')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/timeend.html">timeend</a>, '', <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('timezone')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/timezone.html">timezone</a>), 1);
<a name="l2269"><span class="linenum">2269</span></a>                  continue;
<a name="l2270"><span class="linenum">2270</span></a>              }
<a name="l2271"><span class="linenum">2271</span></a>  
<a name="l2272"><span class="linenum">2272</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('notify_expiry_enrolled')" href="../_functions/notify_expiry_enrolled.html" onMouseOver="funcPopup(event,'notify_expiry_enrolled')">notify_expiry_enrolled</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>, <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>);
<a name="l2273"><span class="linenum">2273</span></a>          }
<a name="l2274"><span class="linenum">2274</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l2275"><span class="linenum">2275</span></a>  
<a name="l2276"><span class="linenum">2276</span></a>          if (<a class="var it19867" onMouseOver="hilite(19867)" onMouseOut="lolite()" onClick="logVariable('lastenrollid')" href="../_variables/lastenrollid.html">$lastenrollid</a> and <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a>) {
<a name="l2277"><span class="linenum">2277</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('notify_expiry_enroller')" href="../_functions/notify_expiry_enroller.html" onMouseOver="funcPopup(event,'notify_expiry_enroller')">notify_expiry_enroller</a>(<a class="var it19867" onMouseOver="hilite(19867)" onMouseOut="lolite()" onClick="logVariable('lastenrollid')" href="../_variables/lastenrollid.html">$lastenrollid</a>, <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a>, <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>);
<a name="l2278"><span class="linenum">2278</span></a>          }
<a name="l2279"><span class="linenum">2279</span></a>  
<a name="l2280"><span class="linenum">2280</span></a>          <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>('...notification processing finished.');
<a name="l2281"><span class="linenum">2281</span></a>          <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('finished')" href="../_functions/finished.html" onMouseOver="funcPopup(event,'finished')">finished</a>();
<a name="l2282"><span class="linenum">2282</span></a>  
<a name="l2283"><span class="linenum">2283</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_config')" href="../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('expirynotifylast', <a class="var it1858" onMouseOver="hilite(1858)" onMouseOut="lolite()" onClick="logVariable('timenow')" href="../_variables/timenow.html">$timenow</a>);
<a name="l2284"><span class="linenum">2284</span></a>      }
<a name="l2285"><span class="linenum">2285</span></a>  
<a name="l2286"><span class="linenum">2286</span></a>      <span class="comment">/**</span>
<a name="l2287"><span class="linenum">2287</span></a>  <span class="comment">     * Returns the user who is responsible for enrolments for given instance.</span>
<a name="l2288"><span class="linenum">2288</span></a>  <span class="comment">     *</span>
<a name="l2289"><span class="linenum">2289</span></a>  <span class="comment">     * Override if plugin knows anybody better than admin.</span>
<a name="l2290"><span class="linenum">2290</span></a>  <span class="comment">     *</span>
<a name="l2291"><span class="linenum">2291</span></a>  <span class="comment">     * @param int $instanceid enrolment instance id</span>
<a name="l2292"><span class="linenum">2292</span></a>  <span class="comment">     * @return stdClass user record</span>
<a name="l2293"><span class="linenum">2293</span></a>  <span class="comment">     */</span>
<a name="l2294"><span class="linenum">2294</span></a>      protected function <a class="function" onClick="logFunction('get_enroller')" href="../_functions/get_enroller.html" onMouseOver="funcPopup(event,'get_enroller')">get_enroller</a>(<a class="var it1184" onMouseOver="hilite(1184)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>) {
<a name="l2295"><span class="linenum">2295</span></a>          return <a class="function" onClick="logFunction('get_admin')" href="../_functions/get_admin.html" onMouseOver="funcPopup(event,'get_admin')">get_admin</a>();
<a name="l2296"><span class="linenum">2296</span></a>      }
<a name="l2297"><span class="linenum">2297</span></a>  
<a name="l2298"><span class="linenum">2298</span></a>      <span class="comment">/**</span>
<a name="l2299"><span class="linenum">2299</span></a>  <span class="comment">     * Notify user about incoming expiration of their enrolment,</span>
<a name="l2300"><span class="linenum">2300</span></a>  <span class="comment">     * it is called only if notification of enrolled users (aka students) is enabled in course.</span>
<a name="l2301"><span class="linenum">2301</span></a>  <span class="comment">     *</span>
<a name="l2302"><span class="linenum">2302</span></a>  <span class="comment">     * This is executed only once for each expiring enrolment right</span>
<a name="l2303"><span class="linenum">2303</span></a>  <span class="comment">     * at the start of the expiration threshold.</span>
<a name="l2304"><span class="linenum">2304</span></a>  <span class="comment">     *</span>
<a name="l2305"><span class="linenum">2305</span></a>  <span class="comment">     * @param stdClass $user</span>
<a name="l2306"><span class="linenum">2306</span></a>  <span class="comment">     * @param stdClass $ue</span>
<a name="l2307"><span class="linenum">2307</span></a>  <span class="comment">     * @param progress_trace $trace</span>
<a name="l2308"><span class="linenum">2308</span></a>  <span class="comment">     */</span>
<a name="l2309"><span class="linenum">2309</span></a>      protected function <a class="function" onClick="logFunction('notify_expiry_enrolled')" href="../_functions/notify_expiry_enrolled.html" onMouseOver="funcPopup(event,'notify_expiry_enrolled')">notify_expiry_enrolled</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>, progress_trace <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>) {
<a name="l2310"><span class="linenum">2310</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l2311"><span class="linenum">2311</span></a>  
<a name="l2312"><span class="linenum">2312</span></a>          <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>();
<a name="l2313"><span class="linenum">2313</span></a>  
<a name="l2314"><span class="linenum">2314</span></a>          <a class="var it14005" onMouseOver="hilite(14005)" onMouseOut="lolite()" onClick="logVariable('oldforcelang')" href="../_variables/oldforcelang.html">$oldforcelang</a> = <a class="function" onClick="logFunction('force_current_language')" href="../_functions/force_current_language.html" onMouseOver="funcPopup(event,'force_current_language')">force_current_language</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('lang')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/lang.html">lang</a>);
<a name="l2315"><span class="linenum">2315</span></a>  
<a name="l2316"><span class="linenum">2316</span></a>          <a class="var it14816" onMouseOver="hilite(14816)" onMouseOut="lolite()" onClick="logVariable('enroller')" href="../_variables/enroller.html">$enroller</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_enroller')" href="../_functions/get_enroller.html" onMouseOver="funcPopup(event,'get_enroller')">get_enroller</a>(<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('enrolid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/enrolid.html">enrolid</a>);
<a name="l2317"><span class="linenum">2317</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('courseid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>);
<a name="l2318"><span class="linenum">2318</span></a>  
<a name="l2319"><span class="linenum">2319</span></a>          <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a> = new stdClass();
<a name="l2320"><span class="linenum">2320</span></a>          <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('course')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../_variables/course.html">course</a>   = <a class="function" onClick="logFunction('format_string')" href="../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('fullname')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/fullname.html">fullname</a>, true, array('context'=&gt;<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>));
<a name="l2321"><span class="linenum">2321</span></a>          <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('user')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../_variables/user.html">user</a>     = <a class="function" onClick="logFunction('fullname')" href="../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, true);
<a name="l2322"><span class="linenum">2322</span></a>          <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('timeend')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../_variables/timeend.html">timeend</a>  = <a class="function" onClick="logFunction('userdate')" href="../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('timeend')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/timeend.html">timeend</a>, '', <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('timezone')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/timezone.html">timezone</a>);
<a name="l2323"><span class="linenum">2323</span></a>          <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('enroller')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../_variables/enroller.html">enroller</a> = <a class="function" onClick="logFunction('fullname')" href="../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it14816" onMouseOver="hilite(14816)" onMouseOut="lolite()" onClick="logVariable('enroller')" href="../_variables/enroller.html">$enroller</a>, <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:viewfullnames', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>));
<a name="l2324"><span class="linenum">2324</span></a>  
<a name="l2325"><span class="linenum">2325</span></a>          <a class="var it1792" onMouseOver="hilite(1792)" onMouseOut="lolite()" onClick="logVariable('subject')" href="../_variables/subject.html">$subject</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('expirymessageenrolledsubject', 'enrol_'.<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>, <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a>);
<a name="l2326"><span class="linenum">2326</span></a>          <a class="var it1791" onMouseOver="hilite(1791)" onMouseOut="lolite()" onClick="logVariable('body')" href="../_variables/body.html">$body</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('expirymessageenrolledbody', 'enrol_'.<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>, <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a>);
<a name="l2327"><span class="linenum">2327</span></a>  
<a name="l2328"><span class="linenum">2328</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a> = new stdClass();
<a name="l2329"><span class="linenum">2329</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('notification')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/notification.html">notification</a>      = 1;
<a name="l2330"><span class="linenum">2330</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('component')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/component.html">component</a>         = 'enrol_'.<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>;
<a name="l2331"><span class="linenum">2331</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('name')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/name.html">name</a>              = 'expiry_notification';
<a name="l2332"><span class="linenum">2332</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('userfrom')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/userfrom.html">userfrom</a>          = <a class="var it14816" onMouseOver="hilite(14816)" onMouseOut="lolite()" onClick="logVariable('enroller')" href="../_variables/enroller.html">$enroller</a>;
<a name="l2333"><span class="linenum">2333</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('userto')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/userto.html">userto</a>            = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>;
<a name="l2334"><span class="linenum">2334</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('subject')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/subject.html">subject</a>           = <a class="var it1792" onMouseOver="hilite(1792)" onMouseOut="lolite()" onClick="logVariable('subject')" href="../_variables/subject.html">$subject</a>;
<a name="l2335"><span class="linenum">2335</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('fullmessage')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/fullmessage.html">fullmessage</a>       = <a class="var it1791" onMouseOver="hilite(1791)" onMouseOut="lolite()" onClick="logVariable('body')" href="../_variables/body.html">$body</a>;
<a name="l2336"><span class="linenum">2336</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('fullmessageformat')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/fullmessageformat.html">fullmessageformat</a> = <a class="constant" onClick="logConstant('FORMAT_MARKDOWN')" href="../_constants/FORMAT_MARKDOWN.html" onMouseOver="constPopup(event,'FORMAT_MARKDOWN')">FORMAT_MARKDOWN</a>;
<a name="l2337"><span class="linenum">2337</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('fullmessagehtml')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/fullmessagehtml.html">fullmessagehtml</a>   = <a class="function" onClick="logFunction('markdown_to_html')" href="../_functions/markdown_to_html.html" onMouseOver="funcPopup(event,'markdown_to_html')">markdown_to_html</a>(<a class="var it1791" onMouseOver="hilite(1791)" onMouseOut="lolite()" onClick="logVariable('body')" href="../_variables/body.html">$body</a>);
<a name="l2338"><span class="linenum">2338</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('smallmessage')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/smallmessage.html">smallmessage</a>      = <a class="var it1792" onMouseOver="hilite(1792)" onMouseOut="lolite()" onClick="logVariable('subject')" href="../_variables/subject.html">$subject</a>;
<a name="l2339"><span class="linenum">2339</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('contexturlname')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/contexturlname.html">contexturlname</a>    = <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('course')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../_variables/course.html">course</a>;
<a name="l2340"><span class="linenum">2340</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('contexturl')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/contexturl.html">contexturl</a>        = (string)<span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../course/view.php.html">/course/view.php</a>', array('id'=&gt;<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('courseid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>));
<a name="l2341"><span class="linenum">2341</span></a>  
<a name="l2342"><span class="linenum">2342</span></a>          if (<a class="function" onClick="logFunction('message_send')" href="../_functions/message_send.html" onMouseOver="funcPopup(event,'message_send')">message_send</a>(<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>)) {
<a name="l2343"><span class="linenum">2343</span></a>              <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;notifying user <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('userid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a> that enrolment in course <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('courseid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a> expires on &quot;.<a class="function" onClick="logFunction('userdate')" href="../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('timeend')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/timeend.html">timeend</a>, '', <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('timezone')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/timezone.html">timezone</a>), 1);
<a name="l2344"><span class="linenum">2344</span></a>          } else {
<a name="l2345"><span class="linenum">2345</span></a>              <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;error notifying user <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('userid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a> that enrolment in course <a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('courseid')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a> expires on &quot;.<a class="function" onClick="logFunction('userdate')" href="../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it1438" onMouseOver="hilite(1438)" onMouseOut="lolite()" onClick="logVariable('ue')" href="../_variables/ue.html">$ue</a>-&gt;<a onClick="logVariable('timeend')" class="var it43660" onMouseOver="hilite(43660)" onMouseOut="lolite()" href="../_variables/timeend.html">timeend</a>, '', <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('timezone')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/timezone.html">timezone</a>), 1);
<a name="l2346"><span class="linenum">2346</span></a>          }
<a name="l2347"><span class="linenum">2347</span></a>  
<a name="l2348"><span class="linenum">2348</span></a>          <a class="function" onClick="logFunction('force_current_language')" href="../_functions/force_current_language.html" onMouseOver="funcPopup(event,'force_current_language')">force_current_language</a>(<a class="var it14005" onMouseOver="hilite(14005)" onMouseOut="lolite()" onClick="logVariable('oldforcelang')" href="../_variables/oldforcelang.html">$oldforcelang</a>);
<a name="l2349"><span class="linenum">2349</span></a>      }
<a name="l2350"><span class="linenum">2350</span></a>  
<a name="l2351"><span class="linenum">2351</span></a>      <span class="comment">/**</span>
<a name="l2352"><span class="linenum">2352</span></a>  <span class="comment">     * Notify person responsible for enrolments that some user enrolments will be expired soon,</span>
<a name="l2353"><span class="linenum">2353</span></a>  <span class="comment">     * it is called only if notification of enrollers (aka teachers) is enabled in course.</span>
<a name="l2354"><span class="linenum">2354</span></a>  <span class="comment">     *</span>
<a name="l2355"><span class="linenum">2355</span></a>  <span class="comment">     * This is called repeatedly every day for each course if there are any pending expiration</span>
<a name="l2356"><span class="linenum">2356</span></a>  <span class="comment">     * in the expiration threshold.</span>
<a name="l2357"><span class="linenum">2357</span></a>  <span class="comment">     *</span>
<a name="l2358"><span class="linenum">2358</span></a>  <span class="comment">     * @param int $eid</span>
<a name="l2359"><span class="linenum">2359</span></a>  <span class="comment">     * @param array $users</span>
<a name="l2360"><span class="linenum">2360</span></a>  <span class="comment">     * @param progress_trace $trace</span>
<a name="l2361"><span class="linenum">2361</span></a>  <span class="comment">     */</span>
<a name="l2362"><span class="linenum">2362</span></a>      protected function <a class="function" onClick="logFunction('notify_expiry_enroller')" href="../_functions/notify_expiry_enroller.html" onMouseOver="funcPopup(event,'notify_expiry_enroller')">notify_expiry_enroller</a>(<a class="var it4064" onMouseOver="hilite(4064)" onMouseOut="lolite()" onClick="logVariable('eid')" href="../_variables/eid.html">$eid</a>, <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a>, progress_trace <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>) {
<a name="l2363"><span class="linenum">2363</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l2364"><span class="linenum">2364</span></a>  
<a name="l2365"><span class="linenum">2365</span></a>          <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>();
<a name="l2366"><span class="linenum">2366</span></a>  
<a name="l2367"><span class="linenum">2367</span></a>          <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('enrol', array('id'=&gt;<a class="var it4064" onMouseOver="hilite(4064)" onMouseOut="lolite()" onClick="logVariable('eid')" href="../_variables/eid.html">$eid</a>, 'enrol'=&gt;<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>));
<a name="l2368"><span class="linenum">2368</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>);
<a name="l2369"><span class="linenum">2369</span></a>          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>));
<a name="l2370"><span class="linenum">2370</span></a>  
<a name="l2371"><span class="linenum">2371</span></a>          <a class="var it14816" onMouseOver="hilite(14816)" onMouseOut="lolite()" onClick="logVariable('enroller')" href="../_variables/enroller.html">$enroller</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_enroller')" href="../_functions/get_enroller.html" onMouseOver="funcPopup(event,'get_enroller')">get_enroller</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('id')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l2372"><span class="linenum">2372</span></a>          <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('admin')" href="../_variables/admin.html">$admin</a> = <a class="function" onClick="logFunction('get_admin')" href="../_functions/get_admin.html" onMouseOver="funcPopup(event,'get_admin')">get_admin</a>();
<a name="l2373"><span class="linenum">2373</span></a>  
<a name="l2374"><span class="linenum">2374</span></a>          <a class="var it14005" onMouseOver="hilite(14005)" onMouseOut="lolite()" onClick="logVariable('oldforcelang')" href="../_variables/oldforcelang.html">$oldforcelang</a> = <a class="function" onClick="logFunction('force_current_language')" href="../_functions/force_current_language.html" onMouseOver="funcPopup(event,'force_current_language')">force_current_language</a>(<a class="var it14816" onMouseOver="hilite(14816)" onMouseOut="lolite()" onClick="logVariable('enroller')" href="../_variables/enroller.html">$enroller</a>-&gt;<a onClick="logVariable('lang')" class="var it44240" onMouseOver="hilite(44240)" onMouseOut="lolite()" href="../_variables/lang.html">lang</a>);
<a name="l2375"><span class="linenum">2375</span></a>  
<a name="l2376"><span class="linenum">2376</span></a>          foreach(<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>=&gt;<a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../_variables/info.html">$info</a>) {
<a name="l2377"><span class="linenum">2377</span></a>              <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>] = '* '.<a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../_variables/info.html">$info</a>['fullname'].' - '.<a class="function" onClick="logFunction('userdate')" href="../_functions/userdate.html" onMouseOver="funcPopup(event,'userdate')">userdate</a>(<a class="var it506" onMouseOver="hilite(506)" onMouseOut="lolite()" onClick="logVariable('info')" href="../_variables/info.html">$info</a>['timeend'], '', <a class="var it14816" onMouseOver="hilite(14816)" onMouseOut="lolite()" onClick="logVariable('enroller')" href="../_variables/enroller.html">$enroller</a>-&gt;<a onClick="logVariable('timezone')" class="var it44240" onMouseOver="hilite(44240)" onMouseOut="lolite()" href="../_variables/timezone.html">timezone</a>);
<a name="l2378"><span class="linenum">2378</span></a>          }
<a name="l2379"><span class="linenum">2379</span></a>  
<a name="l2380"><span class="linenum">2380</span></a>          <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a> = new stdClass();
<a name="l2381"><span class="linenum">2381</span></a>          <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('course')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../_variables/course.html">course</a>    = <a class="function" onClick="logFunction('format_string')" href="../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('fullname')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../_variables/fullname.html">fullname</a>, true, array('context'=&gt;<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>));
<a name="l2382"><span class="linenum">2382</span></a>          <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('threshold')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../_variables/threshold.html">threshold</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('numdays', '', <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('expirythreshold')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/expirythreshold.html">expirythreshold</a> / (60*60*24));
<a name="l2383"><span class="linenum">2383</span></a>          <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('users')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../_variables/users.html">users</a>     = <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(&quot;\n&quot;, <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a>);
<a name="l2384"><span class="linenum">2384</span></a>          <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('extendurl')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../_variables/extendurl.html">extendurl</a> = (string)<span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../enrol/users.php.html">/enrol/users.php</a>', array('id'=&gt;<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>));
<a name="l2385"><span class="linenum">2385</span></a>  
<a name="l2386"><span class="linenum">2386</span></a>          <a class="var it1792" onMouseOver="hilite(1792)" onMouseOut="lolite()" onClick="logVariable('subject')" href="../_variables/subject.html">$subject</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('expirymessageenrollersubject', 'enrol_'.<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>, <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a>);
<a name="l2387"><span class="linenum">2387</span></a>          <a class="var it1791" onMouseOver="hilite(1791)" onMouseOut="lolite()" onClick="logVariable('body')" href="../_variables/body.html">$body</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('expirymessageenrollerbody', 'enrol_'.<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>, <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a>);
<a name="l2388"><span class="linenum">2388</span></a>  
<a name="l2389"><span class="linenum">2389</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a> = new stdClass();
<a name="l2390"><span class="linenum">2390</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('notification')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/notification.html">notification</a>      = 1;
<a name="l2391"><span class="linenum">2391</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('component')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/component.html">component</a>         = 'enrol_'.<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>;
<a name="l2392"><span class="linenum">2392</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('name')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/name.html">name</a>              = 'expiry_notification';
<a name="l2393"><span class="linenum">2393</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('userfrom')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/userfrom.html">userfrom</a>          = <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('admin')" href="../_variables/admin.html">$admin</a>;
<a name="l2394"><span class="linenum">2394</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('userto')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/userto.html">userto</a>            = <a class="var it14816" onMouseOver="hilite(14816)" onMouseOut="lolite()" onClick="logVariable('enroller')" href="../_variables/enroller.html">$enroller</a>;
<a name="l2395"><span class="linenum">2395</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('subject')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/subject.html">subject</a>           = <a class="var it1792" onMouseOver="hilite(1792)" onMouseOut="lolite()" onClick="logVariable('subject')" href="../_variables/subject.html">$subject</a>;
<a name="l2396"><span class="linenum">2396</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('fullmessage')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/fullmessage.html">fullmessage</a>       = <a class="var it1791" onMouseOver="hilite(1791)" onMouseOut="lolite()" onClick="logVariable('body')" href="../_variables/body.html">$body</a>;
<a name="l2397"><span class="linenum">2397</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('fullmessageformat')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/fullmessageformat.html">fullmessageformat</a> = <a class="constant" onClick="logConstant('FORMAT_MARKDOWN')" href="../_constants/FORMAT_MARKDOWN.html" onMouseOver="constPopup(event,'FORMAT_MARKDOWN')">FORMAT_MARKDOWN</a>;
<a name="l2398"><span class="linenum">2398</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('fullmessagehtml')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/fullmessagehtml.html">fullmessagehtml</a>   = <a class="function" onClick="logFunction('markdown_to_html')" href="../_functions/markdown_to_html.html" onMouseOver="funcPopup(event,'markdown_to_html')">markdown_to_html</a>(<a class="var it1791" onMouseOver="hilite(1791)" onMouseOut="lolite()" onClick="logVariable('body')" href="../_variables/body.html">$body</a>);
<a name="l2399"><span class="linenum">2399</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('smallmessage')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/smallmessage.html">smallmessage</a>      = <a class="var it1792" onMouseOver="hilite(1792)" onMouseOut="lolite()" onClick="logVariable('subject')" href="../_variables/subject.html">$subject</a>;
<a name="l2400"><span class="linenum">2400</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('contexturlname')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/contexturlname.html">contexturlname</a>    = <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('course')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../_variables/course.html">course</a>;
<a name="l2401"><span class="linenum">2401</span></a>          <a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('contexturl')" class="var it42910" onMouseOver="hilite(42910)" onMouseOut="lolite()" href="../_variables/contexturl.html">contexturl</a>        = <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('extendurl')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../_variables/extendurl.html">extendurl</a>;
<a name="l2402"><span class="linenum">2402</span></a>  
<a name="l2403"><span class="linenum">2403</span></a>          if (<a class="function" onClick="logFunction('message_send')" href="../_functions/message_send.html" onMouseOver="funcPopup(event,'message_send')">message_send</a>(<a class="var it276" onMouseOver="hilite(276)" onMouseOut="lolite()" onClick="logVariable('message')" href="../_variables/message.html">$message</a>)) {
<a name="l2404"><span class="linenum">2404</span></a>              <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;notifying user <a class="var it14816" onMouseOver="hilite(14816)" onMouseOut="lolite()" onClick="logVariable('enroller')" href="../_variables/enroller.html">$enroller</a>-&gt;<a onClick="logVariable('id')" class="var it44240" onMouseOver="hilite(44240)" onMouseOut="lolite()" href="../_variables/id.html">id</a> about all expiring <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> enrolments in course <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>&quot;, 1);
<a name="l2405"><span class="linenum">2405</span></a>          } else {
<a name="l2406"><span class="linenum">2406</span></a>              <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('trace')" href="../_variables/trace.html">$trace</a>-&gt;<a class="function" onClick="logFunction('output')" href="../_functions/output.html" onMouseOver="funcPopup(event,'output')">output</a>(&quot;error notifying user <a class="var it14816" onMouseOver="hilite(14816)" onMouseOut="lolite()" onClick="logVariable('enroller')" href="../_variables/enroller.html">$enroller</a>-&gt;<a onClick="logVariable('id')" class="var it44240" onMouseOver="hilite(44240)" onMouseOut="lolite()" href="../_variables/id.html">id</a> about all expiring <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> enrolments in course <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('courseid')" class="var it43004" onMouseOver="hilite(43004)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>&quot;, 1);
<a name="l2407"><span class="linenum">2407</span></a>          }
<a name="l2408"><span class="linenum">2408</span></a>  
<a name="l2409"><span class="linenum">2409</span></a>          <a class="function" onClick="logFunction('force_current_language')" href="../_functions/force_current_language.html" onMouseOver="funcPopup(event,'force_current_language')">force_current_language</a>(<a class="var it14005" onMouseOver="hilite(14005)" onMouseOut="lolite()" onClick="logVariable('oldforcelang')" href="../_variables/oldforcelang.html">$oldforcelang</a>);
<a name="l2410"><span class="linenum">2410</span></a>      }
<a name="l2411"><span class="linenum">2411</span></a>  
<a name="l2412"><span class="linenum">2412</span></a>      <span class="comment">/**</span>
<a name="l2413"><span class="linenum">2413</span></a>  <span class="comment">     * Backup execution step hook to annotate custom fields.</span>
<a name="l2414"><span class="linenum">2414</span></a>  <span class="comment">     *</span>
<a name="l2415"><span class="linenum">2415</span></a>  <span class="comment">     * @param backup_enrolments_execution_step $step</span>
<a name="l2416"><span class="linenum">2416</span></a>  <span class="comment">     * @param stdClass $enrol</span>
<a name="l2417"><span class="linenum">2417</span></a>  <span class="comment">     */</span>
<a name="l2418"><span class="linenum">2418</span></a>      public function <a class="function" onClick="logFunction('backup_annotate_custom_fields')" href="../_functions/backup_annotate_custom_fields.html" onMouseOver="funcPopup(event,'backup_annotate_custom_fields')">backup_annotate_custom_fields</a>(backup_enrolments_execution_step <a class="var it763" onMouseOver="hilite(763)" onMouseOut="lolite()" onClick="logVariable('step')" href="../_variables/step.html">$step</a>, stdClass <a class="var it747" onMouseOver="hilite(747)" onMouseOut="lolite()" onClick="logVariable('enrol')" href="../_variables/enrol.html">$enrol</a>) {
<a name="l2419"><span class="linenum">2419</span></a>  <span class="comment">        // Override as necessary to annotate custom fields in the enrol table.</span>
<a name="l2420"><span class="linenum">2420</span></a>      }
<a name="l2421"><span class="linenum">2421</span></a>  
<a name="l2422"><span class="linenum">2422</span></a>      <span class="comment">/**</span>
<a name="l2423"><span class="linenum">2423</span></a>  <span class="comment">     * Automatic enrol sync executed during restore.</span>
<a name="l2424"><span class="linenum">2424</span></a>  <span class="comment">     * Useful for automatic sync by course-&gt;idnumber or course category.</span>
<a name="l2425"><span class="linenum">2425</span></a>  <span class="comment">     * @param stdClass $course course record</span>
<a name="l2426"><span class="linenum">2426</span></a>  <span class="comment">     */</span>
<a name="l2427"><span class="linenum">2427</span></a>      public function <a class="function" onClick="logFunction('restore_sync_course')" href="../_functions/restore_sync_course.html" onMouseOver="funcPopup(event,'restore_sync_course')">restore_sync_course</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>) {
<a name="l2428"><span class="linenum">2428</span></a>  <span class="comment">        // Override if necessary.</span>
<a name="l2429"><span class="linenum">2429</span></a>      }
<a name="l2430"><span class="linenum">2430</span></a>  
<a name="l2431"><span class="linenum">2431</span></a>      <span class="comment">/**</span>
<a name="l2432"><span class="linenum">2432</span></a>  <span class="comment">     * Restore instance and map settings.</span>
<a name="l2433"><span class="linenum">2433</span></a>  <span class="comment">     *</span>
<a name="l2434"><span class="linenum">2434</span></a>  <span class="comment">     * @param restore_enrolments_structure_step $step</span>
<a name="l2435"><span class="linenum">2435</span></a>  <span class="comment">     * @param stdClass $data</span>
<a name="l2436"><span class="linenum">2436</span></a>  <span class="comment">     * @param stdClass $course</span>
<a name="l2437"><span class="linenum">2437</span></a>  <span class="comment">     * @param int $oldid</span>
<a name="l2438"><span class="linenum">2438</span></a>  <span class="comment">     */</span>
<a name="l2439"><span class="linenum">2439</span></a>      public function <a class="function" onClick="logFunction('restore_instance')" href="../_functions/restore_instance.html" onMouseOver="funcPopup(event,'restore_instance')">restore_instance</a>(restore_enrolments_structure_step <a class="var it763" onMouseOver="hilite(763)" onMouseOut="lolite()" onClick="logVariable('step')" href="../_variables/step.html">$step</a>, stdClass <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>, <a class="var it6" onMouseOver="hilite(6)" onMouseOut="lolite()" onClick="logVariable('oldid')" href="../_variables/oldid.html">$oldid</a>) {
<a name="l2440"><span class="linenum">2440</span></a>  <span class="comment">        // Do not call this from overridden methods, restore and set new id there.</span>
<a name="l2441"><span class="linenum">2441</span></a>          <a class="var it763" onMouseOver="hilite(763)" onMouseOut="lolite()" onClick="logVariable('step')" href="../_variables/step.html">$step</a>-&gt;<a class="function" onClick="logFunction('set_mapping')" href="../_functions/set_mapping.html" onMouseOver="funcPopup(event,'set_mapping')">set_mapping</a>('enrol', <a class="var it6" onMouseOver="hilite(6)" onMouseOut="lolite()" onClick="logVariable('oldid')" href="../_variables/oldid.html">$oldid</a>, 0);
<a name="l2442"><span class="linenum">2442</span></a>      }
<a name="l2443"><span class="linenum">2443</span></a>  
<a name="l2444"><span class="linenum">2444</span></a>      <span class="comment">/**</span>
<a name="l2445"><span class="linenum">2445</span></a>  <span class="comment">     * Restore user enrolment.</span>
<a name="l2446"><span class="linenum">2446</span></a>  <span class="comment">     *</span>
<a name="l2447"><span class="linenum">2447</span></a>  <span class="comment">     * @param restore_enrolments_structure_step $step</span>
<a name="l2448"><span class="linenum">2448</span></a>  <span class="comment">     * @param stdClass $data</span>
<a name="l2449"><span class="linenum">2449</span></a>  <span class="comment">     * @param stdClass $instance</span>
<a name="l2450"><span class="linenum">2450</span></a>  <span class="comment">     * @param int $oldinstancestatus</span>
<a name="l2451"><span class="linenum">2451</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l2452"><span class="linenum">2452</span></a>  <span class="comment">     */</span>
<a name="l2453"><span class="linenum">2453</span></a>      public function <a class="function" onClick="logFunction('restore_user_enrolment')" href="../_functions/restore_user_enrolment.html" onMouseOver="funcPopup(event,'restore_user_enrolment')">restore_user_enrolment</a>(restore_enrolments_structure_step <a class="var it763" onMouseOver="hilite(763)" onMouseOut="lolite()" onClick="logVariable('step')" href="../_variables/step.html">$step</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>, <a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it4197" onMouseOver="hilite(4197)" onMouseOut="lolite()" onClick="logVariable('oldinstancestatus')" href="../_variables/oldinstancestatus.html">$oldinstancestatus</a>) {
<a name="l2454"><span class="linenum">2454</span></a>  <span class="comment">        // Override as necessary if plugin supports restore of enrolments.</span>
<a name="l2455"><span class="linenum">2455</span></a>      }
<a name="l2456"><span class="linenum">2456</span></a>  
<a name="l2457"><span class="linenum">2457</span></a>      <span class="comment">/**</span>
<a name="l2458"><span class="linenum">2458</span></a>  <span class="comment">     * Restore role assignment.</span>
<a name="l2459"><span class="linenum">2459</span></a>  <span class="comment">     *</span>
<a name="l2460"><span class="linenum">2460</span></a>  <span class="comment">     * @param stdClass $instance</span>
<a name="l2461"><span class="linenum">2461</span></a>  <span class="comment">     * @param int $roleid</span>
<a name="l2462"><span class="linenum">2462</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l2463"><span class="linenum">2463</span></a>  <span class="comment">     * @param int $contextid</span>
<a name="l2464"><span class="linenum">2464</span></a>  <span class="comment">     */</span>
<a name="l2465"><span class="linenum">2465</span></a>      public function <a class="function" onClick="logFunction('restore_role_assignment')" href="../_functions/restore_role_assignment.html" onMouseOver="funcPopup(event,'restore_role_assignment')">restore_role_assignment</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>, <a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a>) {
<a name="l2466"><span class="linenum">2466</span></a>  <span class="comment">        // No role assignment by default, override if necessary.</span>
<a name="l2467"><span class="linenum">2467</span></a>      }
<a name="l2468"><span class="linenum">2468</span></a>  
<a name="l2469"><span class="linenum">2469</span></a>      <span class="comment">/**</span>
<a name="l2470"><span class="linenum">2470</span></a>  <span class="comment">     * Restore user group membership.</span>
<a name="l2471"><span class="linenum">2471</span></a>  <span class="comment">     * @param stdClass $instance</span>
<a name="l2472"><span class="linenum">2472</span></a>  <span class="comment">     * @param int $groupid</span>
<a name="l2473"><span class="linenum">2473</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l2474"><span class="linenum">2474</span></a>  <span class="comment">     */</span>
<a name="l2475"><span class="linenum">2475</span></a>      public function <a class="function" onClick="logFunction('restore_group_member')" href="../_functions/restore_group_member.html" onMouseOver="funcPopup(event,'restore_group_member')">restore_group_member</a>(<a class="var it427" onMouseOver="hilite(427)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>, <a class="var it681" onMouseOver="hilite(681)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../_variables/groupid.html">$groupid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) {
<a name="l2476"><span class="linenum">2476</span></a>  <span class="comment">        // Implement if you want to restore protected group memberships,</span>
<a name="l2477"><span class="linenum">2477</span></a>  <span class="comment">        // usually this is not necessary because plugins should be able to recreate the memberships automatically.</span>
<a name="l2478"><span class="linenum">2478</span></a>      }
<a name="l2479"><span class="linenum">2479</span></a>  
<a name="l2480"><span class="linenum">2480</span></a>      <span class="comment">/**</span>
<a name="l2481"><span class="linenum">2481</span></a>  <span class="comment">     * Returns defaults for new instances.</span>
<a name="l2482"><span class="linenum">2482</span></a>  <span class="comment">     * @since Moodle 3.1</span>
<a name="l2483"><span class="linenum">2483</span></a>  <span class="comment">     * @return array</span>
<a name="l2484"><span class="linenum">2484</span></a>  <span class="comment">     */</span>
<a name="l2485"><span class="linenum">2485</span></a>      public function <a class="function" onClick="logFunction('get_instance_defaults')" href="../_functions/get_instance_defaults.html" onMouseOver="funcPopup(event,'get_instance_defaults')">get_instance_defaults</a>() {
<a name="l2486"><span class="linenum">2486</span></a>          return array();
<a name="l2487"><span class="linenum">2487</span></a>      }
<a name="l2488"><span class="linenum">2488</span></a>  
<a name="l2489"><span class="linenum">2489</span></a>      <span class="comment">/**</span>
<a name="l2490"><span class="linenum">2490</span></a>  <span class="comment">     * Validate a list of parameter names and types.</span>
<a name="l2491"><span class="linenum">2491</span></a>  <span class="comment">     * @since Moodle 3.1</span>
<a name="l2492"><span class="linenum">2492</span></a>  <span class="comment">     *</span>
<a name="l2493"><span class="linenum">2493</span></a>  <span class="comment">     * @param array $data array of (&quot;fieldname&quot;=&gt;value) of submitted data</span>
<a name="l2494"><span class="linenum">2494</span></a>  <span class="comment">     * @param array $rules array of (&quot;fieldname&quot;=&gt;PARAM_X types - or &quot;fieldname&quot;=&gt;array( list of valid options )</span>
<a name="l2495"><span class="linenum">2495</span></a>  <span class="comment">     * @return array of &quot;element_name&quot;=&gt;&quot;error_description&quot; if there are errors,</span>
<a name="l2496"><span class="linenum">2496</span></a>  <span class="comment">     *         or an empty array if everything is OK.</span>
<a name="l2497"><span class="linenum">2497</span></a>  <span class="comment">     */</span>
<a name="l2498"><span class="linenum">2498</span></a>      public function <a class="function" onClick="logFunction('validate_param_types')" href="../_functions/validate_param_types.html" onMouseOver="funcPopup(event,'validate_param_types')">validate_param_types</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>, <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('rules')" href="../_variables/rules.html">$rules</a>) {
<a name="l2499"><span class="linenum">2499</span></a>          <a class="var it224" onMouseOver="hilite(224)" onMouseOut="lolite()" onClick="logVariable('errors')" href="../_variables/errors.html">$errors</a> = array();
<a name="l2500"><span class="linenum">2500</span></a>          <a class="var it19869" onMouseOver="hilite(19869)" onMouseOut="lolite()" onClick="logVariable('invalidstr')" href="../_variables/invalidstr.html">$invalidstr</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('invaliddata', 'error');
<a name="l2501"><span class="linenum">2501</span></a>          foreach (<a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('rules')" href="../_variables/rules.html">$rules</a> as <a class="var it2227" onMouseOver="hilite(2227)" onMouseOut="lolite()" onClick="logVariable('fieldname')" href="../_variables/fieldname.html">$fieldname</a> =&gt; <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../_variables/rule.html">$rule</a>) {
<a name="l2502"><span class="linenum">2502</span></a>              if (<a class="phpfunction" onClick="logFunction('is_array')" href="../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../_variables/rule.html">$rule</a>)) {
<a name="l2503"><span class="linenum">2503</span></a>                  if (!<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>[<a class="var it2227" onMouseOver="hilite(2227)" onMouseOut="lolite()" onClick="logVariable('fieldname')" href="../_variables/fieldname.html">$fieldname</a>], <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../_variables/rule.html">$rule</a>)) {
<a name="l2504"><span class="linenum">2504</span></a>                      <a class="var it224" onMouseOver="hilite(224)" onMouseOut="lolite()" onClick="logVariable('errors')" href="../_variables/errors.html">$errors</a>[<a class="var it2227" onMouseOver="hilite(2227)" onMouseOut="lolite()" onClick="logVariable('fieldname')" href="../_variables/fieldname.html">$fieldname</a>] = <a class="var it19869" onMouseOver="hilite(19869)" onMouseOut="lolite()" onClick="logVariable('invalidstr')" href="../_variables/invalidstr.html">$invalidstr</a>;
<a name="l2505"><span class="linenum">2505</span></a>                  }
<a name="l2506"><span class="linenum">2506</span></a>              } else {
<a name="l2507"><span class="linenum">2507</span></a>                  if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>[<a class="var it2227" onMouseOver="hilite(2227)" onMouseOut="lolite()" onClick="logVariable('fieldname')" href="../_variables/fieldname.html">$fieldname</a>] != <a class="function" onClick="logFunction('clean_param')" href="../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>[<a class="var it2227" onMouseOver="hilite(2227)" onMouseOut="lolite()" onClick="logVariable('fieldname')" href="../_variables/fieldname.html">$fieldname</a>], <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../_variables/rule.html">$rule</a>)) {
<a name="l2508"><span class="linenum">2508</span></a>                      <a class="var it224" onMouseOver="hilite(224)" onMouseOut="lolite()" onClick="logVariable('errors')" href="../_variables/errors.html">$errors</a>[<a class="var it2227" onMouseOver="hilite(2227)" onMouseOut="lolite()" onClick="logVariable('fieldname')" href="../_variables/fieldname.html">$fieldname</a>] = <a class="var it19869" onMouseOver="hilite(19869)" onMouseOut="lolite()" onClick="logVariable('invalidstr')" href="../_variables/invalidstr.html">$invalidstr</a>;
<a name="l2509"><span class="linenum">2509</span></a>                  }
<a name="l2510"><span class="linenum">2510</span></a>              }
<a name="l2511"><span class="linenum">2511</span></a>          }
<a name="l2512"><span class="linenum">2512</span></a>          return <a class="var it224" onMouseOver="hilite(224)" onMouseOut="lolite()" onClick="logVariable('errors')" href="../_variables/errors.html">$errors</a>;
<a name="l2513"><span class="linenum">2513</span></a>      }
<a name="l2514"><span class="linenum">2514</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'enrol_sharing_course': ['enrol_sharing_course', 'Do these two students share any course? ', [['lib','enrollib.php',223]], 2],
'remove_temp_course_roles': ['remove_temp_course_roles', 'Removes any extra guest roles from current USER->access array. This is useful for enrol plugins only. ', [['lib','accesslib.php',1303]], 9],
'grade_recover_history_grades': ['grade_recover_history_grades', 'Recover a user\'s grades from grade_grades_history ', [['lib','gradelib.php',1020]], 1],
'invalidate_by_definition': ['invalidate_by_definition', 'Invalidates a given set of keys from a given definition. ', [['cache/classes','helper.php',206]], 35],
'restore_instance': ['restore_instance', 'Restore instance and map settings. ', [['enrol/manual','lib.php',461],['enrol/flatfile','lib.php',673],['lib','enrollib.php',2431],['enrol/self','lib.php',563],['enrol/ldap','lib.php',1109],['enrol/cohort','lib.php',244],['enrol/database','lib.php',941],['enrol/lti','lib.php',388],['enrol/paypal','lib.php',236],['enrol/guest','lib.php',278],['enrol/meta','lib.php',393]], 1],
'set_config': ['set_config', 'Set a key in global configuration ', [['lib','moodlelib.php',1336],['lib','enrollib.php',1153],['lib/editor/tinymce/classes','plugin.php',84],['mod/assign','assignmentplugin.php',314],['lib/portfolio','plugin.php',515]], 1119],
'get_user_enrolment_actions': ['get_user_enrolment_actions', 'Gets an array of the user enrolment actions. ', [['enrol/manual','lib.php',418],['enrol/flatfile','lib.php',120],['lib','enrollib.php',2022],['enrol/self','lib.php',539],['enrol/cohort','lib.php',224],['enrol/database','lib.php',85],['enrol/lti','lib.php',362],['enrol/paypal','lib.php',279],['enrol/meta','lib.php',98]], 1],
'cron': ['cron', 'Find user\'s who have completed this criteria ', [['completion/criteria','completion_criteria_course.php',152],['enrol/manual','lib.php',284],['admin/registration','lib.php',50],['question/engine','bank.php',415],['completion/criteria','completion_criteria_date.php',144],['repository/dropbox','lib.php',704],['lib/classes/update','checker.php',193],['enrol/imsenterprise','lib.php',87],['lib','enrollib.php',1980],['repository','lib.php',2357],['auth/mnet','auth.php',832],['enrol/self','lib.php',423],['cache/classes','helper.php',659],['enrol/cohort','lib.php',164],['lib/filestorage','file_storage.php',2494],['enrol/category','lib.php',77],['mod/assign','assignmentplugin.php',534],['mod/assign','locallib.php',1880],['completion/criteria','completion_criteria_grade.php',185],['blocks/recent_activity','block_recent_activity.php',231],['completion/criteria','completion_criteria_activity.php',198],['enrol/paypal','lib.php',303],['completion/criteria','completion_criteria_duration.php',197],['blocks/rss_client','block_rss_client.php',262],['enrol/meta','lib.php',206]], 71],
'get_records_sql': ['get_records_sql', 'Get a number of records as an array of objects. ', [['lib/dml','pdo_moodle_database.php',309],['lib/dml','oci_native_moodle_database.php',1145],['lib/dml','pgsql_native_moodle_database.php',732],['lib/dml','mssql_native_moodle_database.php',805],['lib/dml','mysqli_native_moodle_database.php',1057],['lib/dml','sqlsrv_native_moodle_database.php',890],['lib/dml/tests','dml_test.php',5545]], 700],
'has_bulk_operations': ['has_bulk_operations', 'Returns true if the plugin has one or more bulk operations that can be performed on user enrolments. ', [['lib','enrollib.php',2033]], 0],
'enrol_accessing_via_instance': ['enrol_accessing_via_instance', 'Is current user accessing course via this enrolment method? ', [['lib','enrollib.php',1045]], 5],
'get_recordset': ['get_recordset', 'Get the recordset. ', [['mod/glossary/classes','entry_query_builder.php',305],['lib/dml','moodle_database.php',1162]], 92],
'roles_protected': ['roles_protected', '', [['enrol/manual','lib.php',32],['enrol/flatfile','lib.php',51],['lib','enrollib.php',1170],['enrol/self','lib.php',96],['enrol/paypal','lib.php',80]], 9],
'instance_deleteable': ['instance_deleteable', '', [['lib','enrollib.php',1594]], 2],
'enrol_try_internal_enrol': ['enrol_try_internal_enrol', 'Try to enrol user via default internal auth plugin. ', [['lib','enrollib.php',903]], 5],
'enrol_course_delete': ['enrol_course_delete', 'Called when course is about to be deleted. ', [['lib','enrollib.php',881]], 1],
'add_default_instance': ['add_default_instance', 'Add new instance of enrol plugin with default settings. ', [['enrol/manual','lib.php',123],['lib','enrollib.php',1814],['enrol/self','lib.php',318],['enrol/guest','lib.php',263]], 7],
'is_cron_required': ['is_cron_required', 'Reads version.php and determines if it is necessary to execute the cron job now. ', [['lib','enrollib.php',1957]], 1],
'get_preload_record_columns_sql': ['get_preload_record_columns_sql', 'Returns all fields necessary for context preloading from user $rec. ', [['lib','accesslib.php',6066]], 56],
'get_plugin_list': ['get_plugin_list', 'Use when listing real plugins of one type. ', [['lib','deprecatedlib.php',150],['lib/classes','component.php',796],['admin/tool/monitor/classes','eventlist.php',176]], 191],
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pdo_moodle_database.php',461],['lib/dml','oci_native_moodle_database.php',1404],['lib/dml','pgsql_native_moodle_database.php',1089],['lib/dml','mssql_native_moodle_database.php',1067],['lib/dml','mysqli_native_moodle_database.php',1405],['lib/dml','sqlsrv_native_moodle_database.php',1148],['lib/dml/tests','dml_test.php',5551]], 650],
'raise': ['raise', 'Sets the PHP time limit to a number of seconds from now. ', [['lib/classes','php_time_limit.php',41]], 90],
'role_unassign_all': ['role_unassign_all', 'Removes multiple role assignments, parameters may contain: \'roleid\', \'userid\', \'contextid\', \'component\', \'enrolid\'. ', [['lib','accesslib.php',1803]], 45],
'edit_instance_form': ['edit_instance_form', 'Add elements to the edit instance form. ', [['enrol/manual','lib.php',657],['lib','enrollib.php',1687],['enrol/self','lib.php',735],['enrol/cohort','lib.php',443],['enrol/lti','lib.php',187],['enrol/mnet','lib.php',144],['enrol/paypal','lib.php',336],['enrol/guest','lib.php',390],['enrol/meta','lib.php',314]], 2],
'clean_param': ['clean_param', 'Used by {@link optional_param()} and {@link required_param()} to clean the variables and/or cast to specific types, based on an options field. <code> $course->format = clean_param($course->format, PARAM_ALPHA); $selectedgradeitem = clean_param($selectedgradeitem, PARAM_INT); </code> ', [['lib','moodlelib.php',769]], 635],
'enrol_course_updated': ['enrol_course_updated', 'Update enrol instances after course edit form submission ', [['lib','enrollib.php',364]], 3],
'restore_role_assignment': ['restore_role_assignment', 'Restore role assignment. ', [['enrol/manual','lib.php',532],['enrol/flatfile','lib.php',705],['lib','enrollib.php',2457],['enrol/self','lib.php',613],['enrol/ldap','lib.php',1156],['enrol/database','lib.php',981]], 1],
'is_siteadmin': ['is_siteadmin', 'Check if the user is an admin at the site level. ', [['lib','accesslib.php',602]], 95],
'role_assign': ['role_assign', 'Assigns the specified role to a user in the context. ', [['lib/testing/generator','data_generator.php',936],['lib','accesslib.php',1661]], 269],
'enrol_get_enrolment_end': ['enrol_get_enrolment_end', 'This function returns the end of current active user enrolment. ', [['lib','enrollib.php',964]], 2],
'can_hide_show_instance': ['can_hide_show_instance', 'Is it possible to hide/show enrol instance via standard UI? ', [['enrol/manual','lib.php',572],['enrol/flatfile','lib.php',109],['enrol/imsenterprise','lib.php',985],['lib','enrollib.php',1609],['enrol/self','lib.php',638],['enrol/ldap','lib.php',127],['enrol/cohort','lib.php',337],['enrol/category','lib.php',56],['enrol/database','lib.php',57],['enrol/lti','lib.php',58],['enrol/mnet','lib.php',103],['enrol/paypal','lib.php',449],['enrol/guest','lib.php',308],['enrol/meta','lib.php',228]], 8],
'enrol_course_edit_validation': ['enrol_course_edit_validation', 'Validate course edit form data ', [['lib','enrollib.php',335]], 1],
'fullname': ['fullname', 'Returns a persons full name ', [['lib','moodlelib.php',3249],['mod/assign','locallib.php',3915]], 546],
'enrol_get_plugin': ['enrol_get_plugin', 'Returns instance of enrol plugin ', [['lib','enrollib.php',111]], 156],
'sync_user_enrolments': ['sync_user_enrolments', 'Forces synchronisation of user enrolments. ', [['lib','enrollib.php',1529],['enrol/ldap','lib.php',138],['enrol/database','lib.php',105]], 26],
'enrol_get_course_info_icons': ['enrol_get_course_info_icons', 'Returns course enrolment information icons. ', [['lib','enrollib.php',624]], 1],
'allow_enrol': ['allow_enrol', '', [['enrol/manual','lib.php',37],['lib','enrollib.php',1178]], 2],
'enrol_is_enabled': ['enrol_is_enabled', 'Checks if a given plugin is in the list of enabled enrolment plugins. ', [['lib','enrollib.php',171]], 60],
'course_edit_form': ['course_edit_form', 'Adds enrol instance UI to course edit form ', [['lib','enrollib.php',1674]], 3],
'delete_records': ['delete_records', 'Delete the records from a table where all the given conditions met. If conditions not specified, table is truncated. ', [['lib/dml','sqlite3_pdo_moodle_database.php',345],['lib/dml','moodle_database.php',1864]], 773],
'set_mapping': ['set_mapping', 'To send ids pairs to backup_ids_table and to store them into paths ', [['backup/moodle2','restore_plugin.class.php',169],['backup/moodle2','restore_subplugin.class.php',101],['backup/util/plan','restore_structure_step.class.php',158]], 131],
'get_name': ['get_name', 'Return localised event name. ', [['lib/classes/event','competency_plan_unlinked.php',72],['admin/tool/langimport/classes/task','update_langpacks_task.php',35],['lib/simplepie/library/SimplePie','Author.php',106],['portfolio/download','lib.php',10],['backup/util/structure','restore_path_element.class.php',98],['lib/classes/message/inbound','private_files_handler.php',56],['lib/classes/event','grouping_group_assigned.php',48],['calendar/tests','calendartype_test_example.php',32],['lib/classes/event','enrol_instance_deleted.php',70],['report/log/classes/event','user_report_viewed.php',54],['lib/classes/task','blog_cron_task.php',31],['mod/quiz/classes/event','attempt_reviewed.php',53],['lib/classes/event','tag_unflagged.php',55],['lib/classes/task','send_new_user_passwords_task.php',31],['lib/classes/event','role_unassigned.php',53],['mod/assign/classes/event','grading_form_viewed.php',82],['question/classes/bank','edit_action_column.php',35],['admin/tool/log/store/standard/classes/task','cleanup_task.php',31],['mod/workshop/classes/event','submission_deleted.php',63],['mod/forum/classes/event','discussion_updated.php',65],['lib/classes/event','course_module_instance_list_viewed.php',75],['lib/classes/event','course_created.php',55],['lib/dml','pdo_moodle_database.php',113],['mod/assign/classes/event','extension_granted.php',77],['lib/classes/task','tag_cron_task.php',33],['enrol/imsenterprise/classes/task','cron_task.php',34],['lib/classes/event','course_deleted.php',56],['lib/classes/task','completion_daily_task.php',33],['mod/forum/classes/event','readtracking_enabled.php',64],['mod/wiki/classes/event','page_created.php',48],['lib/dml','oci_native_moodle_database.php',94],['lib/classes/event','competency_viewed.php',70],['mod/choice/classes/event','answer_updated.php',72],['lib/classes/event','search_indexed.php',47],['lib/classes/event','badge_criteria_updated.php',53],['question/classes/bank','question_type_column.php',26],['mod/wiki/classes/event','page_version_deleted.php',54],['lib/grade','grade_item.php',1384],['lib/classes/event','competency_user_competency_rated_in_plan.php',88],['lib/classes/event','webservice_token_sent.php',56],['mod/glossary/classes/event','entry_deleted.php',54],['admin/tool/messageinbound/classes/message/inbound','invalid_recipient_handler.php',60],['lib/classes/event','competency_template_viewed.php',63],['lib/classes/task','context_cleanup_task.php',32],['mod/assign/tests/fixtures','event_mod_assign_fixtures.php',62],['admin/tool/langimport/classes/event','langpack_removed.php',89],['mod/glossary/classes/event','category_deleted.php',46],['mod/forum/classes/message/inbound','reply_handler.php',51],['competency/classes','competency_rule.php',84],['mod/lti/classes/event','unknown_service_api_called.php',82],['lib/classes/event','badge_deleted.php',49],['mod/quiz/classes/event','user_override_updated.php',54],['lib/classes/event','message_contact_added.php',48],['lib/classes/event','cohort_member_added.php',49],['backup/util/ui','restore_ui.class.php',351],['lib/classes/event','blog_entry_updated.php',74],['mod/assign/classes/event','workflow_state_updated.php',88],['mod/forum/classes/event','assessable_uploaded.php',86],['mod/assign/classes/event','submission_created.php',57],['lib/classes/event','group_deleted.php',65],['lib/classes/event','role_allow_assign_updated.php',47],['mod/lesson/classes/event','highscore_added.php',59],['mod/forum/classes/event','discussion_pinned.php',55],['lib/classes/event','webservice_function_called.php',67],['lib/classes/event','competency_plan_reopened.php',75],['mod/lesson/classes/event','essay_attempt_viewed.php',48],['mod/wiki/classes/event','page_locks_deleted.php',54],['lib/classes/event','webservice_service_deleted.php',59],['mod/forum/classes/event','discussion_subscription_created.php',66],['admin/tool/log/store/database/tests/fixtures','event.php',31],['mod/workshop/classes/event','assessable_uploaded.php',93],['lib','csslib.php',2155],['lib','csslib.php',2283],['lib/classes/event','user_loggedout.php',54],['lib/classes/event','webservice_token_created.php',65],['lib/classes/event','tag_collection_updated.php',65],['competency/classes','competency_rule_all.php',84],['backup/util/settings','base_setting.class.php',145],['mod/data/classes/event','field_deleted.php',57],['mod/book/classes/event','chapter_created.php',79],['lib/classes/event','email_failed.php',56],['lib/classes/task','stats_cron_task.php',31],['mod/survey/classes/event','report_downloaded.php',55],['mod/workshop/classes/event','phase_switched.php',75],['lib/grade','grade_category.php',2300],['lib/grade','grade_scale.php',156],['lib/classes/event','course_reset_started.php',53],['mod/workshop/classes/event','assessment_evaluated.php',66],['lib/classes/event','blog_association_created.php',56],['backup/converter','convertlib.php',109],['report/outline/classes/event','activity_report_viewed.php',48],['lib/classes/task','legacy_plugin_cron_task.php',33],['lib/classes/event','competency_plan_updated.php',75],['mod/choice/classes/event','answer_submitted.php',72],['mod/lesson/classes/event','lesson_ended.php',49],['lib/classes/event','role_allow_switch_updated.php',47],['lib/classes/task','portfolio_cron_task.php',31],['lib/classes/event','competency_user_competency_rated_in_course.php',88],['question/classes/bank','question_text_row.php',35],['lib/classes/event','tag_created.php',75],['report/participation/classes/event','report_viewed.php',58],['lib/classes/event','role_capabilities_updated.php',51],['mod/survey/classes/event','response_submitted.php',53],['lib/classes/event','badge_archived.php',47],['mod/workshop/classes/event','assessment_reevaluated.php',76],['mod/assign/classes/event','submission_locked.php',78],['report/outline/classes/event','report_viewed.php',54],['lib/classes/event','user_deleted.php',57],['lib/classes/event','mnet_access_control_updated.php',57],['mod/lesson/classes/event','essay_assessed.php',78],['mod/book/tool/print/classes/event','book_printed.php',76],['lib/classes/event','grouping_deleted.php',72],['admin/tool/monitor/classes','rule.php',239],['lib/classes/event','course_viewed.php',75],['mod/forum/classes/event','user_report_viewed.php',65],['user/selector','lib.php',309],['mod/quiz/classes/event','attempt_summary_viewed.php',56],['lib/classes/event','webservice_service_user_added.php',59],['mod/forum/classes/event','discussion_unpinned.php',55],['lib/classes/event','grouping_group_unassigned.php',48],['lib/grade','grade_outcome.php',272],['mod/chat/classes/event','message_sent.php',59],['lib/classes/event','role_assigned.php',56],['mod/quiz/classes/question/bank','question_name_text_column.php',37],['question/classes/bank','modifier_name_column.php',27],['mod/glossary/classes/event','entry_viewed.php',48],['mod/data/classes/event','record_created.php',56],['lib/classes/event','course_category_deleted.php',59],['lib/dml','mariadb_native_moodle_database.php',41],['lib/classes/event','role_deleted.php',55],['lib/classes/task','question_cron_task.php',31],['portfolio/flickr','lib.php',41],['lib/classes/task','cache_cron_task.php',31],['mod/wiki/classes/event','page_version_viewed.php',54],['admin/tool/recyclebin/classes/event','category_bin_item_deleted.php',47],['admin/tool/log/store/standard/tests/fixtures','event.php',31],['mod/scorm/classes/event','status_submitted.php',46],['admin/tool/monitor/classes/event','rule_created.php',50],['admin/tool/log/store/legacy/classes/task','cleanup_task.php',31],['question/classes/bank','checkbox_column.php',32],['lib/classes/event','competency_user_competency_plan_viewed.php',81],['mod/assign/feedback/offline','locallib.php',42],['admin/tool/messageinbound/classes/task','cleanup_task.php',38],['mod/workshop/classes/event','submission_updated.php',63],['lib/editor/atto/classes/task','autosave_cleanup_task.php',33],['mod/choice/classes/event','report_viewed.php',53],['mod/lesson/classes/event','group_override_deleted.php',54],['mod/wiki/classes/event','page_map_viewed.php',54],['admin/tool/log/store/legacy/tests/fixtures','event.php',31],['mod/lesson/classes/event','question_answered.php',54],['mod/choice/classes/event','report_downloaded.php',54],['admin/tool/recyclebin/classes/task','cleanup_category_bin.php',36],['backup/util/ui','backup_ui_setting.class.php',86],['lib/classes/event','competency_user_evidence_created.php',64],['lib/classes/event','course_module_completion_updated.php',54],['repository/coursefiles','lib.php',183],['lib/classes/event','note_updated.php',56],['lib/classes/event','note_created.php',56],['lib/classes/event','competency_framework_created.php',63],['lib/classes/event','course_resources_list_viewed.php',60],['lib/classes/event','tag_updated.php',58],['mod/forum/classes/event','subscribers_viewed.php',65],['mod/book/tool/exportimscp/classes/event','book_exported.php',76],['mod/quiz/classes/question/bank','add_action_column.php',45],['lib/classes/task','completion_regular_task.php',33],['lib/classes/event','user_enrolment_deleted.php',54],['grade/report/grader/classes/event','grade_report_viewed.php',39],['lib','enrollib.php',1076],['admin/tool/recyclebin/classes/event','course_bin_item_restored.php',47],['lib/classes/event','webservice_service_updated.php',59],['lib/editor/tinymce/classes','plugin.php',101],['mod/lesson/classes/event','group_override_created.php',55],['mod/scorm/classes/event','attempt_deleted.php',62],['lib/classes/event','competency_user_competency_review_request_cancelled.php',72],['lib/classes/event','webservice_service_created.php',65],['lib/classes/task','events_cron_task.php',31],['mod/wiki/classes/event','page_version_restored.php',54],['mod/forum/classes/event','discussion_deleted.php',66],['lib/classes/event','competency_framework_updated.php',73],['mod/lesson/classes/event','lesson_restarted.php',48],['mod/wiki/classes/event','page_updated.php',54],['mod/assign/classes/event','marker_updated.php',89],['lib','modinfolib.php',1270],['mod/assign/feedback/editpdf/classes/task','convert_submissions.php',38],['lib/classes/event','course_module_updated.php',57],['repository','lib.php',1834],['auth/cas/classes/task','sync_task.php',34],['lib/classes/event','competency_template_deleted.php',73],['mod/assign/classes/event','submission_confirmation_form_viewed.php',79],['lib/bennu','iCalendar_components.php',37],['report/questioninstances/classes/event','report_viewed.php',55],['admin/tool/recyclebin/classes/task','cleanup_course_bin.php',36],['lib/classes/event','message_contact_blocked.php',48],['lib/classes/event','competency_template_updated.php',75],['question/behaviour','behaviourbase.php',83],['grade/report/history/classes/event','grade_report_viewed.php',39],['lib/classes/event','badge_disabled.php',47],['mod/assign/classes/event','grading_table_viewed.php',79],['lib/classes/event','badge_enabled.php',47],['mod/lti','OAuth.php',122],['mod/lti','OAuth.php',149],['mod/lti','OAuth.php',173],['calendar/type/gregorian/classes','structure.php',29],['mod/quiz/classes/event','edit_page_viewed.php',53],['lib/simplepie/library/SimplePie','Credit.php',139],['mod/scorm/classes/event','tracks_viewed.php',64],['mod/wiki/classes/event','page_diff_viewed.php',55],['message/tests/fixtures','inbound_fixtures.php',41],['lib/classes/event','grouping_created.php',65],['lib/classes/event','calendar_event_deleted.php',58],['enrol/flatfile/classes/task','flatfile_sync_task.php',37],['lib/classes/event','group_updated.php',65],['lib/classes/task','registration_cron_task.php',31],['mod/book/classes/event','chapter_updated.php',79],['lib/classes/event','grade_deleted.php',94],['admin/tool/recyclebin/classes/event','course_bin_item_created.php',47],['lib/classes/event','user_loggedin.php',64],['lib/classes/task','check_for_updates_task.php',31],['grade/report/singleview/classes/local/ui','grade_attribute_format.php',56],['mod/assign/submission/file','locallib.php',44],['mod/forum/classes/task','cron_task.php',30],['mod/forum/classes/event','subscription_created.php',65],['lib/classes/event','tag_collection_created.php',65],['grade/report/overview/classes/event','grade_report_viewed.php',48],['mod/assign/classes/event','batch_set_marker_allocation_viewed.php',79],['mod/quiz/classes/event','group_override_updated.php',54],['lib/classes/event','competency_plan_created.php',63],['mod/glossary/classes/event','entry_disapproved.php',46],['lib/classes/task','send_failed_login_notifications_task.php',34],['enrol/lti/classes/task','sync_grades.php',36],['lib/classes/event','message_viewed.php',54],['portfolio/boxnet','lib.php',14],['lib/classes/event','comment_created.php',58],['question/classes/bank','preview_action_column.php',26],['lib/classes/event','course_content_deleted.php',54],['lib/dml','pgsql_native_moodle_database.php',87],['mod/feedback/classes/event','response_deleted.php',83],['lib/classes/event','competency_evidence_created.php',98],['lib/classes/event','comment_deleted.php',58],['lib/classes/event','competency_user_competency_review_requested.php',72],['mod/quiz/classes/event','attempt_abandoned.php',63],['mod/scorm/classes/event','user_report_viewed.php',62],['lib/dml','mssql_native_moodle_database.php',88],['mod/quiz/classes/event','attempt_becameoverdue.php',66],['mod/quiz/classes/event','group_override_created.php',55],['lib/dml','mysqli_native_moodle_database.php',352],['backup/util/ui','backup_ui.class.php',194],['mod/book/tool/print/classes/event','chapter_printed.php',79],['mod/data/classes/event','record_deleted.php',56],['competency/classes','competency_rule_points.php',185],['lib/classes/event','competency_user_competency_viewed.php',81],['lib/classes/event','dashboard_viewed.php',59],['mod/lesson/classes/event','question_viewed.php',54],['lib/classes/event','user_profile_viewed.php',56],['lib','medialib.php',345],['admin/tool/monitor/classes/task','clean_events.php',32],['mod/lesson/classes/event','user_override_deleted.php',53],['lib/classes/event','cohort_member_removed.php',50],['mod/lesson/classes/event','lesson_started.php',48],['mod/lesson/classes/event','page_updated.php',73],['mod/workshop/classes/event','submission_viewed.php',63],['question/classes/bank','question_name_column.php',28],['lib/classes/event','competency_deleted.php',87],['admin/tool/monitor/classes','subscription.php',132],['lib/classes/task','grade_cron_task.php',31],['mod/glossary/classes/event','entry_created.php',52],['lib/classes/task','file_temp_cleanup_task.php',31],['lib/classes/event','dashboard_reset.php',60],['backup/util/structure','base_atom.class.php',71],['portfolio/googledocs','lib.php',54],['mod/assign/feedback/comments','locallib.php',36],['mod/wiki/classes/event','page_history_viewed.php',48],['lib/classes/event','competency_plan_review_request_cancelled.php',75],['lib/classes/event','competency_plan_deleted.php',73],['mod/quiz/classes/event','attempt_viewed.php',54],['mod/data/classes/event','field_updated.php',57],['lib/classes/event','grouping_updated.php',65],['cache/classes','definition.php',621],['lib/classes/task','plagiarism_cron_task.php',31],['backup/converter/moodle1','lib.php',1033],['lib/classes/event','question_category_created.php',48],['grade/report/user/classes/event','grade_report_viewed.php',48],['lib/classes/event','user_login_failed.php',56],['mod/scorm/classes/event','report_viewed.php',63],['mod/chat/classes/event','sessions_viewed.php',65],['admin/tool/recyclebin/classes/event','course_bin_item_deleted.php',47],['mod/quiz/classes/event','user_override_deleted.php',53],['portfolio/mahara','lib.php',61],['mod/quiz/classes/event','attempt_submitted.php',63],['grade/report/outcomes/classes/event','grade_report_viewed.php',39],['mod/lesson/classes/event','group_override_updated.php',54],['mod/workshop/classes/event','submission_created.php',63],['mod/assign/classes/event','submission_updated.php',57],['mod/assign/submission/onlinetext/classes/event','assessable_uploaded.php',83],['lib/classes/event','competency_updated.php',70],['lib/classes/event','note_deleted.php',56],['mod/lesson/classes/event','page_moved.php',56],['lib/classes/event','course_completed.php',73],['lib/classes/event','tag_added.php',58],['lib/classes/event','competency_created.php',70],['mod/lesson/classes/event','highscores_viewed.php',51],['lib/classes/event','message_contact_unblocked.php',48],['lib/classes/event','user_enrolment_created.php',53],['lib/classes/task','search_index_task.php',35],['lib/classes/event','course_module_created.php',86],['lib/classes/event','webservice_service_user_removed.php',59],['report/log/classes/event','report_viewed.php',58],['mod/assign/submission/file/classes/event','assessable_uploaded.php',85],['lib/classes/event','group_member_added.php',78],['mod/forum/classes/event','discussion_viewed.php',60],['mod/assign/classes/event','submission_viewed.php',76],['mod/lti/classes/local/ltiservice','service_base.php',87],['enrol/lti/classes/task','sync_members.php',46],['mod/workshop/classes/event','submission_reassessed.php',77],['lib/classes/task','session_cleanup_task.php',31],['lib/tests','messageinbound_test.php',166],['lib/classes/task','backup_cleanup_task.php',31],['mod/workshop/classes/event','assessment_evaluations_reset.php',75],['mod/scorm/classes/event','scoreraw_submitted.php',46],['mod/assign/classes/event','statement_accepted.php',77],['mod/assign/classes/event','feedback_viewed.php',76],['lib/classes/task','delete_unconfirmed_users_task.php',31],['mod/forum/classes/event','discussion_moved.php',66],['lib/classes/event','competency_user_evidence_deleted.php',64],['mod/assign/classes/event','batch_set_workflow_state_viewed.php',79],['mod/lesson/classes/event','lesson_resumed.php',48],['lib/classes/task','badges_cron_task.php',31],['lib/classes/event','comments_viewed.php',51],['mod/data/classes/event','template_viewed.php',55],['mod/wiki/classes/event','page_deleted.php',54],['mod/quiz/classes/event','report_viewed.php',56],['mod/scorm/classes/event','sco_launched.php',64],['mod/glossary/classes/event','entry_updated.php',52],['mod/lesson/classes/event','user_override_created.php',53],['mod/glossary/classes/event','category_updated.php',46],['lib/classes/event','course_updated.php',58],['grade/report/singleview/classes/event','grade_report_viewed.php',39],['mod/feedback/classes/event','response_submitted.php',83],['lib/classes/event','blog_entry_deleted.php',53],['mod/book/classes/event','chapter_deleted.php',79],['report/completion/classes/event','report_viewed.php',49],['lib/classes/event','recent_activity_viewed.php',49],['mod/quiz/classes/event','question_manually_graded.php',55],['mod/assign/classes/event','submission_status_updated.php',79],['lib/classes/event','user_enrolment_updated.php',53],['lib/classes/event','tag_deleted.php',55],['report/completion/classes/event','user_report_viewed.php',49],['report/stats/classes/event','report_viewed.php',56],['lib/classes/event','calendar_event_created.php',58],['mod/assign/classes/event','submission_duplicated.php',77],['lib/classes/event','competency_framework_deleted.php',73],['lib/classes/event','course_section_updated.php',56],['lib/classes/event','message_sent.php',82],['lib/classes/event','calendar_subscription_deleted.php',56],['lib/classes/event','course_category_updated.php',51],['lib/classes/event','user_password_updated.php',70],['enrol/lti/ims-blti','OAuth.php',65],['enrol/lti/ims-blti','OAuth.php',92],['enrol/lti/ims-blti','OAuth.php',116],['mod/forum/classes/event','subscription_deleted.php',65],['mod/assign/classes/event','reveal_identities_confirmation_page_viewed.php',79],['lib/classes/event','user_loggedinas.php',57],['lib/classes/event','competency_template_created.php',63],['lib/classes/event','user_created.php',48],['admin/tool/recyclebin/classes/event','category_bin_item_restored.php',47],['report/loglive/classes/event','report_viewed.php',48],['admin/tool/monitor/classes/event','subscription_created.php',50],['mod/book/classes/event','chapter_viewed.php',79],['lib/classes/event','badge_awarded.php',54],['lib/classes/event','calendar_subscription_created.php',57],['lib/classes/event','enrol_instance_created.php',69],['lib/classes/event','user_list_viewed.php',56],['lib/classes/task','calendar_cron_task.php',31],['mod/forum/classes/event','post_deleted.php',67],['mod/quiz/classes/event','group_override_deleted.php',54],['lib/classes/event','badge_created.php',47],['backup/util/plan','base_plan.class.php',50],['lib/classes/event','base.php',292],['lib/classes/event','competency_framework_viewed.php',69],['lib/classes/event','tag_collection_deleted.php',65],['lib/classes/event','group_member_removed.php',69],['lib/classes/event','grade_report_viewed.php',54],['lib/classes/event','calendar_event_updated.php',58],['mod/assign/submission/onlinetext','locallib.php',40],['lib/classes/event','user_updated.php',48],['mod/lesson/classes/event','page_created.php',54],['backup/util/ui','base_ui_stage.class.php',110],['mod/assign/classes/event','submission_form_viewed.php',82],['auth/ldap/classes/task','sync_task.php',34],['lib/classes/event','course_completion_updated.php',47],['lib/classes/event','competency_plan_review_started.php',75],['lib/classes/event','course_user_report_viewed.php',66],['mod/folder/classes/event','all_files_downloaded.php',60],['mod/workshop/classes/event','assessments_reset.php',74],['lib/tests/fixtures','task_fixtures.php',35],['lib/tests/fixtures','task_fixtures.php',44],['lib/tests/fixtures','task_fixtures.php',53],['mod/data/classes/event','template_updated.php',56],['mod/assign/classes/event','identities_revealed.php',75],['question/classes/bank','copy_action_column.php',35],['admin/tool/log/store/legacy/classes/event','legacy_logged.php',35],['lib/classes/event','notes_viewed.php',49],['admin/tool/recyclebin/classes/event','category_bin_item_created.php',47],['lib/classes/event','competency_plan_viewed.php',63],['mod/data/classes/event','record_updated.php',56],['mod/assign/feedback/file','locallib.php',45],['lib/classes/event','competency_plan_unapproved.php',75],['mod/lesson/classes/event','content_page_viewed.php',48],['mod/assign/feedback/editpdf','locallib.php',43],['lib/dml','sqlsrv_native_moodle_database.php',108],['admin/tool/monitor/classes/event','subscription_deleted.php',50],['mod/assign/classes/event','assessable_submitted.php',109],['mod/quiz/classes/event','attempt_started.php',62],['lib/classes/task','create_contexts_task.php',31],['lib/classes/task','file_trash_cleanup_task.php',31],['lib/classes/event','competency_user_competency_rated.php',82],['mod/forum/classes/event','post_updated.php',67],['admin/tool/cohortroles/classes/task','cohort_role_sync.php',37],['lib/classes/event','course_module_deleted.php',56],['mod/assign/submission/comments','locallib.php',39],['lib/classes/event','competency_plan_review_requested.php',75],['lib/classes/event','user_graded.php',96],['lib/classes/event','webservice_login_failed.php',71],['mod/forum/classes/event','post_created.php',67],['lib/classes/task','complete_plans_task.php',43],['mod/assign/classes/event','submission_status_viewed.php',81],['lib/classes/event','enrol_instance_updated.php',70],['lib/classes/task','messaging_cleanup_task.php',31],['portfolio/picasa','lib.php',33],['admin/tool/capability/classes/event','report_viewed.php',47],['grade/report/singleview/classes/local/ui','unique_name.php',38],['mod/data/classes/event','field_created.php',58],['mod/folder/classes/event','folder_updated.php',48],['lib/classes/event','badge_updated.php',47],['lib/tests/fixtures','event_fixtures.php',34],['lib/classes/task','cache_cleanup_task.php',31],['mod/survey/classes/event','report_viewed.php',55],['mod/quiz/classes/event','attempt_deleted.php',53],['mod/glossary/classes/event','entry_approved.php',46],['mod/wiki/classes/event','page_viewed.php',57],['lib/classes/log','reader.php',30],['lib/classes/task','password_reset_cleanup_task.php',31],['mod/forum/classes/event','readtracking_disabled.php',64],['admin/tool/langimport/classes/event','langpack_imported.php',80],['lib/classes/event','competency_plan_review_stopped.php',75],['admin/tool/langimport/classes/event','langpack_updated.php',80],['lib/classes/event','unknown_logged.php',43],['lib/classes/event','competency_user_competency_viewed_in_plan.php',85],['lib/classes/event','competency_user_competency_viewed_in_course.php',84],['lib/classes/task','search_optimize_task.php',38],['mod/glossary/classes/event','category_created.php',46],['lib/portfolio','plugin.php',120],['report/stats/classes/event','user_report_viewed.php',48],['lib/classes/event','dashboards_reset.php',59],['lib/classes/event','calendar_subscription_updated.php',57],['lib/classes/event','cohort_updated.php',49],['admin/tool/monitor/classes/event','rule_updated.php',50],['mod/lesson/classes/event','page_deleted.php',54],['lib/classes/event','course_section_deleted.php',57],['lib/classes/task','delete_incomplete_users_task.php',31],['lib/classes/task','automated_backup_task.php',31],['admin/tool/monitor/classes/event','subscription_criteria_met.php',55],['lib/classes/event','mnet_access_control_created.php',57],['admin/tool/messageinbound/classes/task','pickup_task.php',38],['mod/forum/classes/event','discussion_created.php',65],['question/classes/bank','creator_name_column.php',28],['lib/classes/event','blog_entries_viewed.php',62],['lib/classes/task','sync_plans_from_template_cohorts_task.php',41],['mod/quiz/classes/event','attempt_preview_started.php',54],['lib/classes/event','content_viewed.php',80],['lib/classes/event','competency_user_evidence_updated.php',64],['lib/dml/tests','dml_test.php',5530],['mod/assign/classes/event','submission_graded.php',78],['mod/assign/classes/event','all_submissions_downloaded.php',75],['lib/classes/event','course_restored.php',58],['lib/classes/event','group_created.php',65],['lib/classes/event','badge_criteria_deleted.php',52],['lib/classes/event','tag_flagged.php',55],['lib/classes/event','competency_plan_completed.php',75],['mod/lesson/classes/event','user_override_updated.php',54],['lib/classes/event','role_allow_override_updated.php',47],['mod/forum/classes/event','discussion_subscription_deleted.php',66],['lib/classes/event','cohort_deleted.php',49],['lib/classes/event','badge_criteria_created.php',52],['admin/tool/log/classes/helper','reader.php',41],['admin/tool/monitor/classes/task','check_subscriptions.php',50],['lib/classes/event','blog_entry_created.php',76],['mod/scorm/classes/event','interactions_viewed.php',63],['mod/workshop/classes/event','submission_assessed.php',76],['lib/classes/event','badge_duplicated.php',47],['backup/util/plan','base_step.class.php',49],['lib/classes/event','course_category_created.php',48],['lib/classes/event','cohort_created.php',49],['lib/classes/event','tag_removed.php',58],['lib/classes/event','competency_plan_approved.php',75],['mod/choice/classes/event','answer_deleted.php',56],['backup/util/ui','restore_ui_stage.class.php',75],['lib/classes/event','competency_user_competency_review_started.php',72],['lib/classes/event','course_reset_ended.php',53],['mod/quiz/classes/event','user_override_created.php',53],['mod/forum/classes/event','course_searched.php',66],['lib/classes/event','message_contact_removed.php',48],['admin/tool/monitor/classes/event','rule_deleted.php',50],['lib/classes/event','message_deleted.php',91],['mod/assign/classes/event','submission_unlocked.php',78],['lib/classes/event','competency_user_competency_review_stopped.php',72],['lib/classes/event','course_module_viewed.php',62],['backup/util/plan','base_task.class.php',58],['question/classes/bank','delete_action_column.php',36]], 469],
'finished': ['finished', 'Called when the processing is finished. ', [['lib','weblib.php',3353],['lib','weblib.php',3461],['lib','weblib.php',3548],['lib','weblib.php',3614]], 56],
'isguestuser': ['isguestuser', 'Determines if a user is logged in as real guest user with username \'guest\'. ', [['lib','accesslib.php',1923]], 260],
'enrol_user_sees_own_courses': ['enrol_user_sees_own_courses', 'Can user access at least one enrolled course? ', [['lib','enrollib.php',719]], 20],
'isloggedin': ['isloggedin', 'Determines if a user is currently logged in ', [['lib','accesslib.php',1910]], 184],
'list': ['list', '', [['mod/data/preset/imagegallery','jstemplate.js',9]], 2229],
'grade_user_unenrol': ['grade_user_unenrol', 'Purge course data when user unenrolls from a course ', [['lib','gradelib.php',1489]], 1],
'allow_unenrol': ['allow_unenrol', '', [['enrol/manual','lib.php',42],['enrol/flatfile','lib.php',59],['lib','enrollib.php',1190],['enrol/self','lib.php',101],['enrol/lti','lib.php',69],['enrol/paypal','lib.php',85]], 5],
'restore_user_enrolment': ['restore_user_enrolment', 'Restore user enrolment. ', [['enrol/manual','lib.php',481],['enrol/flatfile','lib.php',692],['lib','enrollib.php',2444],['enrol/self','lib.php',600],['enrol/ldap','lib.php',1129],['enrol/cohort','lib.php',301],['enrol/database','lib.php',960],['enrol/paypal','lib.php',266],['enrol/meta','lib.php',432]], 1],
'edit_instance_validation': ['edit_instance_validation', 'Perform custom validation of the data used to edit the instance. ', [['enrol/manual','lib.php',696],['lib','enrollib.php',1700],['enrol/self','lib.php',867],['enrol/cohort','lib.php',476],['enrol/lti','lib.php',325],['enrol/mnet','lib.php',180],['enrol/paypal','lib.php',386],['enrol/guest','lib.php',428],['enrol/meta','lib.php',347]], 3],
'validate_param_types': ['validate_param_types', 'Validate a list of parameter names and types. ', [['lib','enrollib.php',2489]], 7],
'get_manual_enrol_button': ['get_manual_enrol_button', 'Returns a button to manually enrol users through the manual enrolment plugin. ', [['enrol/manual','lib.php',184],['lib','enrollib.php',2008]], 1],
'get_instance_name': ['get_instance_name', 'Returns localised name of enrol instance ', [['lib','enrollib.php',1086],['enrol/self','lib.php',74],['enrol/cohort','lib.php',50],['admin/tool/monitor/classes','subscription.php',78],['enrol/mnet','lib.php',32],['enrol/meta','lib.php',39]], 21],
'user_enrolment_changed': ['user_enrolment_changed', 'Executed when user enrolment was changed to check if course contacts cache needs to be cleared ', [['lib','coursecatlib.php',709]], 3],
'markdown_to_html': ['markdown_to_html', 'Given Markdown formatted text, make it into XHTML using external function ', [['lib','weblib.php',1927]], 21],
'on': ['on', '', [['lib/requirejs','require.js',508],['lib/jquery','jquery-3.1.0.js',4809]], 3823],
'get_bulk_operations': ['get_bulk_operations', 'The manual plugin has several bulk operations that can be performed. ', [['enrol/manual','lib.php',442],['lib','enrollib.php',2044]], 1],
'enrol_course_edit_form': ['enrol_course_edit_form', 'This function adds necessary enrol plugins UI into the course edit form. ', [['lib','enrollib.php',309]], 1],
'enrol_user': ['enrol_user', 'Enrol user into course via enrol instance. ', [['enrol/flatfile','lib.php',144],['lib','enrollib.php',1270],['lib/testing/generator','data_generator.php',891],['enrol/lti/classes','helper.php',233],['enrol/self','externallib.php',122],['enrol/mnet','enrol.php',115],['enrol/guest','lib.php',60]], 745],
'raise_memory_limit': ['raise_memory_limit', 'Function to raise the memory limit to a new value. Will respect the memory limit if it is higher, thus allowing settings in php.ini, apache conf or command line switches to override it. ', [['lib','setuplib.php',1206]], 59],
'userdate': ['userdate', 'Returns a formatted string that represents a date in user time. ', [['lib','moodlelib.php',2155],['lib/adodb','adodb.inc.php',2842],['lib/adodb','adodb.inc.php',3569]], 525],
'format_string': ['format_string', 'Given a simple string, this function returns the string processed by enabled string filters if $CFG->filterall is enabled ', [['lib','weblib.php',1379]], 880],
'enrol_get_course_description_texts': ['enrol_get_course_description_texts', 'Returns course enrolment detailed information. ', [['lib','enrollib.php',655]], 1],
'course_edit_validation': ['course_edit_validation', 'Validates course edit form data ', [['lib','enrollib.php',1717]], 2],
'get_config': ['get_config', 'Config get method. ', [['lib/classes/antivirus','scanner.php',54],['competency/classes','competency_rule.php',59],['question/engine','bank.php',109],['admin/tool/log/classes/helper','store.php',63],['lib','moodlelib.php',1409],['lib','enrollib.php',1142],['lib/editor/tinymce/classes','plugin.php',73],['competency/classes','competency_rule_points.php',43],['search/classes','base.php',169],['mod/assign','assignmentplugin.php',345],['lib/portfolio','plugin.php',546]], 934],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'unenrol_user': ['unenrol_user', 'Unenrol user from course, the last unenrolment removes all remaining roles. ', [['lib','enrollib.php',1434],['enrol','locallib.php',641],['enrol/lti','lib.php',167],['enrol/mnet','enrol.php',198],['enrol/guest','lib.php',76]], 59],
'restore_sync_course': ['restore_sync_course', 'Automatic enrol sync executed during restore. Useful for automatic sync by course->idnumber or course category. ', [['lib','enrollib.php',2422],['enrol/ldap','lib.php',1097],['enrol/category','lib.php',113],['enrol/database','lib.php',932]], 2],
'get_description_text': ['get_description_text', 'Returns optional enrolment instance description text. ', [['lib','enrollib.php',1118]], 1],
'trigger': ['trigger', '', [['lib/evalmath','evalmath.class.php',448],['lib/classes/event','base.php',765]], 964],
'get_instance_defaults': ['get_instance_defaults', 'Returns defaults for new instances. ', [['lib','enrollib.php',2480],['enrol/self','lib.php',333],['enrol/guest','lib.php',340]], 3],
'join': ['join', 'Join a room. For internal use by the Games SDK only. Calling this method directly is unsupported. (rooms.join) ', [['lib/google/src/Google/Service','Games.php',1716],['lib/google/src/Google/Service','Games.php',2100]], 1030],
'notify_expiry_enroller': ['notify_expiry_enroller', 'Notify person responsible for enrolments that some user enrolments will be expired soon, it is called only if notification of enrollers (aka teachers) is enabled in course. ', [['lib','enrollib.php',2351]], 2],
'enrol_get_users_courses': ['enrol_get_users_courses', 'Returns list of courses user is enrolled into. (Note: use enrol_get_all_users_courses if you want to use the list wihtout any cap checks ) ', [['lib','enrollib.php',679]], 17],
'get_manual_enrol_link': ['get_manual_enrol_link', 'Returns link to manual enrol UI if exists. Does the access control tests automatically. ', [['enrol/manual','lib.php',52],['lib','enrollib.php',1620]], 2],
'get_enroller': ['get_enroller', 'Returns the user who is responsible for manual enrolments in given instance. ', [['enrol/manual','lib.php',385],['enrol/flatfile','lib.php',609],['lib','enrollib.php',2286],['enrol/self','lib.php',506]], 7],
'user_delete': ['user_delete', 'Called when user is about to be deleted ', [['lib','enrollib.php',1987],['lib','authlib.php',275]], 2],
'count_records': ['count_records', 'Count a list of records. ', [['competency/classes','persistent.php',815],['mod/glossary/classes','entry_query_builder.php',152],['lib/dml','moodle_database.php',1766]], 1630],
'can_delete_instance': ['can_delete_instance', 'Is it possible to delete enrol instance via standard UI? ', [['enrol/manual','lib.php',561],['enrol/flatfile','lib.php',98],['enrol/imsenterprise','lib.php',974],['lib','enrollib.php',1599],['enrol/self','lib.php',627],['enrol/ldap','lib.php',103],['enrol/cohort','lib.php',39],['enrol/category','lib.php',35],['enrol/database','lib.php',35],['enrol/lti','lib.php',47],['enrol/mnet','lib.php',92],['enrol/paypal','lib.php',438],['enrol/guest','lib.php',297],['enrol/meta','lib.php',217]], 6],
'enrol_add_course_navigation': ['enrol_add_course_navigation', 'Add navigation nodes ', [['lib','enrollib.php',381]], 2],
'groups_delete_group_members': ['groups_delete_group_members', 'Remove all users (or one user) from all groups in course ', [['group','lib.php',563]], 6],
'get_action_icons': ['get_action_icons', 'Returns edit icons for the page with list of instances. ', [['enrol/manual','lib.php',102],['lib','enrollib.php',1939]], 2],
'has_any_capability': ['has_any_capability', 'Check if the user has any one of several capabilities from a list. ', [['lib','accesslib.php',496]], 100],
'enrol_get_my_courses': ['enrol_get_my_courses', 'Returns list of courses current $USER is enrolled in and can access ', [['lib','enrollib.php',512]], 30],
'allow_manage': ['allow_manage', '', [['enrol/manual','lib.php',47],['enrol/flatfile','lib.php',86],['lib','enrollib.php',1217],['enrol/self','lib.php',106],['enrol/paypal','lib.php',90]], 9],
'add_course_navigation': ['add_course_navigation', 'Adds navigation links into course admin block. ', [['lib','enrollib.php',1918]], 1],
'update_user_enrol': ['update_user_enrol', 'Store user_enrolments changes and trigger event. ', [['lib','enrollib.php',1367]], 25],
'groups_remove_member': ['groups_remove_member', 'Deletes the link between the specified user and group. ', [['group','lib.php',173]], 12],
'get_recordset_sql': ['get_recordset_sql', 'Get a number of records as an moodle_recordset.  $sql must be a complete SQL query. Since this method is a little less readable, use of it should be restricted to code where it\'s possible there might be large datasets being returned.  For known small datasets use get_records_sql - it leads to simpler code. ', [['lib/dml','pdo_moodle_database.php',252],['lib/dml','oci_native_moodle_database.php',1106],['lib/dml','pgsql_native_moodle_database.php',688],['lib/dml','mssql_native_moodle_database.php',736],['lib/dml','mysqli_native_moodle_database.php',993],['lib/dml','sqlsrv_native_moodle_database.php',811],['lib/dml/tests','dml_test.php',5544]], 283],
'use_standard_editing_ui': ['use_standard_editing_ui', 'We are a good plugin and don\'t invent our own UI/validation code path. ', [['enrol/manual','lib.php',607],['lib','enrollib.php',1543],['enrol/self','lib.php',858],['enrol/cohort','lib.php',434],['enrol/lti','lib.php',79],['enrol/mnet','lib.php',171],['enrol/paypal','lib.php',115],['enrol/guest','lib.php',419],['enrol/meta','lib.php',239]], 4],
'get_admin': ['get_admin', 'Returns $user object of the main admin user ', [['lib','datalib.php',53]], 61],
'enrol_check_plugins': ['enrol_check_plugins', 'Check all the login enrolment information for the given user object by querying the enrolment plugins ', [['lib','enrollib.php',186]], 8],
'is_viewing': ['is_viewing', 'Returns true if the user has moodle/course:view capability in the course, this is intended for admins, managers (aka small admins), inspectors, etc. ', [['lib','accesslib.php',2005]], 25],
'enrol_get_plugins': ['enrol_get_plugins', 'Returns instances of enrol plugins ', [['lib','enrollib.php',70]], 45],
'enrol_get_all_users_courses': ['enrol_get_all_users_courses', 'Returns list of courses user is enrolled into without any capability checks - $fields is an array of fieldnames to ADD so name the fields you really need, which will be added and uniq\'d ', [['lib','enrollib.php',769]], 18],
'add_instance': ['add_instance', 'Add new instance of enrol plugin. ', [['enrol/manual','lib.php',147],['lib','enrollib.php',1745],['enrol/self','lib.php',958],['enrol/cohort','lib.php',99],['mod/assign','locallib.php',600],['tag/classes','tag.php',543],['enrol/lti','lib.php',88],['enrol/paypal','lib.php',124],['enrol/guest','lib.php',247],['enrol/meta','lib.php',131]], 91],
'usergetmidnight': ['usergetmidnight', 'Given a time, return the GMT timestamp of the most recent midnight for the current user. ', [['lib','moodlelib.php',2252]], 24],
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'mark_dirty': ['mark_dirty', 'Mark a context as dirty (with timestamp) so as to force reloading of the context. ', [['lib','accesslib.php',5843]], 40],
'get_info_icons': ['get_info_icons', 'Returns optional enrolment information icons. ', [['lib','enrollib.php',1102],['enrol/self','lib.php',35],['enrol/paypal','lib.php',50],['enrol/guest','lib.php',38]], 1],
'allow_unenrol_user': ['allow_unenrol_user', 'Does this plugin allow manual unenrolment of a specific user? All plugins allowing this must implement \'enrol/xxx:unenrol\' capability ', [['enrol/flatfile','lib.php',70],['lib','enrollib.php',1201],['enrol/cohort','lib.php',207],['enrol/database','lib.php',68],['enrol/meta','lib.php',81]], 12],
'delete_instance': ['delete_instance', 'Delete all data related to a given workshop module instance ', [['mod/workshop/eval','lib.php',59],['mod/workshop/allocation/scheduled','lib.php',200],['mod/workshop/eval/best','lib.php',125],['mod/workshop/form','lib.php',118],['lib','enrollib.php',1849],['mod/workshop/allocation/random','lib.php',243],['mod/assign/submission/file','locallib.php',447],['mod/workshop/form/rubric','lib.php',405],['mod/assign/feedback/comments','locallib.php',485],['mod/workshop/form/comments','lib.php',360],['mod/workshop/allocation/manual','lib.php',349],['lib','accesslib.php',6111],['mod/assign','assignmentplugin.php',525],['mod/workshop/allocation','lib.php',62],['mod/assign','locallib.php',715],['mod/workshop/form/accumulative','lib.php',375],['mod/workshop/form/numerrors','lib.php',394],['mod/assign/submission/onlinetext','locallib.php',550],['mod/assign/feedback/file','locallib.php',320],['mod/assign/feedback/editpdf','locallib.php',324],['tag/classes','tag.php',473],['enrol/lti','lib.php',145]], 37],
'create': ['create', 'Auto-scan an incoming line to determine the response type. ', [['lib/horde/framework/Horde/Imap/Client/Interaction','Server.php',65],['lib/google/src/Google/Service','Partners.php',492],['lib/simplepie/library/SimplePie','Cache.php',95],['lib/google/src/Google/Service','YouTubeReporting.php',237],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',81],['lib/google/src/Google/Service','MapsEngine.php',1677],['lib/google/src/Google/Service','MapsEngine.php',1977],['lib/google/src/Google/Service','MapsEngine.php',2253],['lib/google/src/Google/Service','MapsEngine.php',2330],['lib/google/src/Google/Service','MapsEngine.php',2898],['lib/spout/src/Spout/Writer','WriterFactory.php',18],['lib/google/src/Google/Service','Dns.php',290],['lib/google/src/Google/Service','Dns.php',363],['lib/google/src/Google/Service','Appengine.php',438],['tag/classes','collection.php',188],['lib/adodb','adodb-xmlschema.inc.php',152],['lib/adodb','adodb-xmlschema.inc.php',473],['lib/adodb','adodb-xmlschema.inc.php',738],['lib/adodb','adodb-xmlschema.inc.php',884],['lib/adodb','adodb-xmlschema.inc.php',1129],['mod/quiz','attemptlib.php',100],['mod/quiz','attemptlib.php',596],['lib','weblib.php',3206],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',58],['lib/google/src/Google/Service','Dataflow.php',273],['lib/simplepie/library/SimplePie','Registry.php',153],['competency/classes','persistent.php',387],['lib/google/src/Google/Service','Cloudresourcemanager.php',373],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',270],['lib/google/src/Google/Service','TagManager.php',1007],['lib/google/src/Google/Service','TagManager.php',1097],['lib/google/src/Google/Service','TagManager.php',1249],['lib/google/src/Google/Service','TagManager.php',1342],['lib/google/src/Google/Service','TagManager.php',1436],['lib/google/src/Google/Service','TagManager.php',1530],['lib/google/src/Google/Service','TagManager.php',1681],['mod/lesson','locallib.php',1011],['mod/lesson','locallib.php',2163],['mod/lesson','locallib.php',3212],['lib','modinfolib.php',1732],['repository','lib.php',206],['repository','lib.php',1910],['lib','navigationlib.php',268],['lib/htmlpurifier/HTMLPurifier','Config.php',114],['lib/google/src/Google/Service','Container.php',284],['lib/google/src/Google/Service','Genomics.php',632],['lib/google/src/Google/Service','Genomics.php',721],['lib/google/src/Google/Service','Genomics.php',1312],['lib/google/src/Google/Service','Genomics.php',1427],['lib/google/src/Google/Service','Games.php',1649],['lib/google/src/Google/Service','Games.php',2013],['lib/google/src/Google/Service','Fitness.php',377],['lib/google/src/Google/Service','Gmail.php',747],['lib/google/src/Google/Service','Gmail.php',905],['mod/quiz/classes','structure.php',65],['lib/htmlpurifier/HTMLPurifier','ElementDef.php',135],['lib/adodb','adodb-xmlschema03.inc.php',170],['lib/adodb','adodb-xmlschema03.inc.php',514],['lib/adodb','adodb-xmlschema03.inc.php',779],['lib/adodb','adodb-xmlschema03.inc.php',930],['lib/adodb','adodb-xmlschema03.inc.php',1228],['lib/google/src/Google/Service','Proximitybeacon.php',500],['tag/classes','area.php',205],['course','lib.php',3003],['question/type/ddmarker','shapes.php',170],['lib/classes/event','base.php',149],['lib','coursecatlib.php',325],['repository/filesystem','lib.php',498],['lib/google/src/Google/Service','Storagetransfer.php',281],['calendar','lib.php',2686],['lib/htmlpurifier/HTMLPurifier','Lexer.php',53],['lib/google/src/Google/Service','Classroom.php',445],['lib/google/src/Google/Service','Classroom.php',596],['lib/google/src/Google/Service','Classroom.php',673],['lib/google/src/Google/Service','Classroom.php',783],['lib/google/src/Google/Service','Classroom.php',912],['lib/spout/src/Spout/Reader','ReaderFactory.php',18],['lib/google/src/Google/Service','Pubsub.php',220],['lib/google/src/Google/Service','Pubsub.php',365],['lib/google/src/Google/Service','CloudMonitoring.php',258]], 3276],
'can_self_enrol': ['can_self_enrol', 'Checks if user can self enrol. ', [['lib','enrollib.php',1895],['enrol/self','lib.php',223]], 9],
'or': ['or', '', [['lib/tcpdf','LICENSE.TXT',69]], 556],
'message_send': ['message_send', 'Called when a message provider wants to send a message. This functions checks the message recipient\'s message processor configuration then sends the message to the configured processors ', [['lib','messagelib.php',29]], 94],
'get_in_or_equal': ['get_in_or_equal', 'Constructs \'IN()\' or \'=\' sql fragment ', [['lib/dml','oci_native_moodle_database.php',1635],['lib/dml','moodle_database.php',711]], 438],
'is_enrolled': ['is_enrolled', 'Returns true if user is enrolled (is participating) in course this is intended for students and teachers. ', [['lib','accesslib.php',2038]], 145],
'trim_if_empty': ['trim_if_empty', 'Removes this node if it is empty ', [['lib','navigationlib.php',639]], 7],
'restore_group_member': ['restore_group_member', 'Restore user group membership. ', [['enrol/manual','lib.php',546],['lib','enrollib.php',2469],['enrol/cohort','lib.php',326],['enrol/meta','lib.php',460]], 1],
'process_expirations': ['process_expirations', 'Do any enrolments need expiration processing. ', [['lib','enrollib.php',2055]], 4],
'enrol_get_instances': ['enrol_get_instances', 'Returns enrolment instances in given course. ', [['lib','enrollib.php',140]], 33],
'notify_expiry_enrolled': ['notify_expiry_enrolled', 'Notify user about incoming expiration of their enrolment, it is called only if notification of enrolled users (aka students) is enabled in course. ', [['lib','enrollib.php',2298]], 1],
'get_enrol_info': ['get_enrol_info', 'Return information for enrolment instance containing list of parameters required for enrolment, name of enrolment plugin etc. ', [['lib','enrollib.php',1907],['enrol/self','lib.php',290],['enrol/guest','lib.php',351]], 4],
'load_config': ['load_config', 'Makes sure config is loaded and cached. ', [['lib','enrollib.php',1131],['lib/editor/tinymce/classes','plugin.php',62],['mod/workshop/form/rubric','lib.php',465]], 7],
'preload_from_record': ['preload_from_record', 'Preloads context information from db record and strips the cached info. ', [['lib','accesslib.php',5250],['lib','accesslib.php',6079]], 61],
'can_add_instance': ['can_add_instance', 'Returns true if the user can add an instance of the store plugin. ', [['cache/stores/static','lib.php',445],['enrol/manual','lib.php',80],['cache/classes','dummystore.php',79],['lib','enrollib.php',1553],['enrol/self','lib.php',120],['enrol/cohort','lib.php',82],['cache/classes','store.php',300],['enrol/lti','lib.php',36],['cache/stores/session','lib.php',490],['enrol/mnet','lib.php',64],['enrol/paypal','lib.php',99],['enrol/guest','lib.php',118],['enrol/meta','lib.php',66]], 4],
'record_exists_sql': ['record_exists_sql', 'Test whether a SQL SELECT statement returns any records. ', [['lib/dml','moodle_database.php',1846]], 52],
'course_updated': ['course_updated', 'Called after updating/inserting course. ', [['lib','enrollib.php',1729],['enrol/cohort','lib.php',177],['enrol/category','lib.php',93],['enrol/guest','lib.php',191],['enrol/meta','lib.php',118]], 1],
'record_exists': ['record_exists', 'Check if a record exists by ID. ', [['competency/classes','persistent.php',842],['lib/dml','moodle_database.php',1817]], 901],
'get_field': ['get_field', 'Gets an instance of the form field. ', [['lib/behat','behat_field_manager.php',248],['mod/quiz/report/statistics/classes','calculated.php',109],['lib/dml','moodle_database.php',1546],['user/filters','lib.php',124]], 536],
'enrol_page_hook': ['enrol_page_hook', 'Creates course enrol form, checks if form submitted and enrols user if necessary. It can also redirect. ', [['lib','enrollib.php',1884],['enrol/self','lib.php',181],['enrol/paypal','lib.php',150],['enrol/guest','lib.php',139]], 1],
'role_unassign': ['role_unassign', 'Removes one role assignment ', [['lib','accesslib.php',1773]], 31],
'create_from_record': ['create_from_record', 'Api to Create new event from enrol object. ', [['lib/classes/event','enrol_instance_deleted.php',44],['lib/classes/event','tag_collection_updated.php',50],['lib/classes/event','tag_collection_created.php',50],['mod/feedback/classes/event','response_deleted.php',57],['mod/feedback/classes/event','course_module_viewed.php',53],['mod/feedback/classes/event','response_submitted.php',60],['lib/classes/event','enrol_instance_created.php',44],['lib/classes/event','tag_collection_deleted.php',50],['lib/classes/event','enrol_instance_updated.php',44]], 11],
'has_capability': ['has_capability', 'Wrapper round the has_capability funciton that automatically passes in the quiz context. ', [['mod/quiz','attemptlib.php',299],['mod/quiz','attemptlib.php',922],['lib','accesslib.php',344]], 2064],
'enrol_selfenrol_available': ['enrol_selfenrol_available', 'Is there a chance users might self enrol ', [['lib','enrollib.php',937]], 3],
'add': ['add', 'Add HashTable item ', [['lib/phpexcel/PHPExcel','HashTable.php',78],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',95],['lib/horde/framework/Horde/Imap/Client','Tokenize.php',109],['lib/google/src/Google/Http','Batch.php',52],['lib/horde/framework/Horde/Imap/Client/Data/Format','List.php',37],['lib','csslib.php',1508],['lib/horde/framework/Horde/Mail/Rfc822','List.php',116],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Memory.php',33],['lib/horde/framework/Horde/Support','ConsistentHash.php',148],['lib/horde/framework/Horde','Variables.php',297],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Template.php.in',29],['lib','outputcomponents.php',2705],['lib','outputcomponents.php',3380],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',436],['lib','adminlib.php',735],['lib','adminlib.php',894],['lib','adminlib.php',1446],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Cleanup.php',27],['lib/xhprof/xhprof_html/jquery','jquery-1.2.6.js',3450],['lib/horde/framework/Horde/Imap/Client/Interaction','Pipeline.php',80],['lib/google/src/Google/Service','Webmasters.php',436],['lib','navigationlib.php',304],['lib','navigationlib.php',761],['lib','navigationlib.php',3305],['lib','navigationlib.php',3583],['lib/horde/framework/Horde/Imap/Client','Ids.php',155],['backup/cc/cc_lib/gral_lib','cssparser.php',121],['lib/xhprof/xhprof_html/jquery','jquery.autocomplete.js',428],['lib/horde/framework/Horde','Stream.php',116],['comment','lib.php',679],['lib/mustache/src/Mustache','HelperCollection.php',56],['lib/htmlpurifier/HTMLPurifier','UnitConverter.php',207],['backup/cc/cc_lib','cc_utils.php',395],['backup/cc/cc_lib','cc_utils.php',454],['lib/lessphp/Output','Mapped.php',50],['lib','licenselib.php',32],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Decorator.php',50],['lib/phpexcel/PHPExcel/Reader/Excel5','MD5.php',74],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Null.php',14],['lib/horde/framework/Horde/Mail/Rfc822','GroupList.php',25],['lib/htmlpurifier/HTMLPurifier','IDAccumulator.php',31],['tag/classes','tag.php',152],['blog','locallib.php',242],['lib/classes','notification.php',50],['lib/lessphp','Output.php',18],['tag/classes/output','tagfeed.php',61],['backup/cc','validator.php',51],['lib/horde/framework/Horde/Stream','TempString.php',118],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Serializer.php',11]], 6188],
'backup_annotate_custom_fields': ['backup_annotate_custom_fields', 'Backup execution step hook to annotate custom fields. ', [['lib','enrollib.php',2412]], 1],
'get_string': ['get_string', 'Get String returns a requested string ', [['lib/classes','string_manager_install.php',95],['lib','moodlelib.php',6735],['lib','moodlelib.php',9695],['lib/external','externallib.php',102],['question/behaviour','behaviourbase.php',770],['lib/classes','string_manager_standard.php',280],['lib/classes','string_manager.php',38]], 20134],
'send_expiry_notifications': ['send_expiry_notifications', 'Send expiry notifications. ', [['lib','enrollib.php',2174]], 15],
'update_instance': ['update_instance', 'Update instance of enrol plugin. ', [['enrol/manual','lib.php',164],['lib','enrollib.php',1783],['enrol/self','lib.php',978],['enrol/cohort','lib.php',126],['mod/assign','locallib.php',990],['enrol/lti','lib.php',114],['enrol/paypal','lib.php',137],['enrol/meta','lib.php',165]], 16],
'close': ['close', 'Close archive, write changes to disk. ', [['lib/filestorage','zip_archive.php',183],['lib/dml','mssql_native_moodle_recordset.php',87],['auth/fc','fcFPP.php',78],['lib/dml','mysqli_native_moodle_recordset.php',86],['lib/spout/src/Spout/Reader','ReaderInterface.php',30],['lib/spout/src/Spout/Writer/ODS/Internal','Workbook.php',81],['lib/dml','pdo_moodle_recordset.php',79],['lib','csvlib.class.php',256],['lib/horde/framework/Horde/Socket','Client.php',135],['backup/util/helper','backup_null_iterator.class.php',53],['admin/tool/uploaduser','locallib.php',149],['lib/tcpdf','tcpdf.php',2943],['lib/phpunit/classes','phpmailer_sink.php',41],['lib/phpmailer','class.smtp.php',582],['lib/dml','sqlsrv_native_moodle_recordset.php',133],['lib/classes/dml','recordset_walk.php',153],['lib/spout/src/Spout/Writer/XLSX/Helper','SharedStringsHelper.php',84],['grade/export','lib.php',689],['lib','excellib.class.php',93],['backup/util/loggers','file_logger.class.php',69],['grade','lib.php',324],['backup/util/helper','backup_array_iterator.class.php',63],['lib/horde/framework/Horde/Imap/Client','Base.php',1846],['mod/assign/feedback/offline','importgradeslib.php',204],['lib/dml','oci_native_moodle_recordset.php',80],['lib/adodb','adodb.inc.php',2361],['lib/adodb','adodb.inc.php',3090],['lib/adodb','adodb.inc.php',3870],['lib/google/src/Google/Logger','File.php',132],['lib/phpunit/classes','event_sink.php',39],['lib/horde/framework/Horde','Stream.php',585],['backup/util/loggers','base_logger.class.php',89],['lib/phpexcel/PHPExcel/Shared','ZipArchive.php',71],['question/engine/tests','helpers.php',1241],['lib/spout/src/Spout/Writer','AbstractWriter.php',312],['lib','odslib.class.php',71],['lib/spout/src/Spout/Writer/Common/Internal','WorksheetInterface.php',34],['lib/spout/src/Spout/Writer/ODS/Internal','Worksheet.php',214],['lib/spout/src/Spout/Writer','WriterInterface.php',84],['lib/spout/src/Spout/Writer/XLSX/Internal','Worksheet.php',174],['lib/spout/src/Spout/Reader','AbstractReader.php',183],['lib/phpunit/classes','message_sink.php',39],['lib/spout/src/Spout/Writer/Common/Internal','WorkbookInterface.php',65],['lib/spout/src/Spout/Writer/XLSX/Internal','Workbook.php',95],['lib/pear/Net','GeoIP.php',556],['lib/tests','completionlib_test.php',907],['lib/pear/Auth','RADIUS.php',550],['lib/pear/Auth','RADIUS.php',710],['lib/pear/Auth','RADIUS.php',829],['lib','webdavlib.php',176],['lib/dml','pgsql_native_moodle_recordset.php',107]], 1128],
'enrol_user_delete': ['enrol_user_delete', 'Called when user is about to be deleted. ', [['lib','enrollib.php',864]], 1],
'get_newinstance_link': ['get_newinstance_link', 'Returns link to page which may be used to add new instance of enrolment plugin in course. ', [['lib','enrollib.php',1581],['enrol/category','lib.php',67]], 2],
'enrol_get_shared_courses': ['enrol_get_shared_courses', 'Returns any courses shared by the two users ', [['lib','enrollib.php',240]], 6],
'try_guestaccess': ['try_guestaccess', 'Attempt to automatically gain temporary guest access to course, calling code has to make sure the plugin and instance are active. ', [['lib','enrollib.php',1255],['enrol/guest','lib.php',87]], 2],
'instance': ['instance', 'Returns an instance of the cache_factor method. ', [['cache','disabledlib.php',171],['cache','disabledlib.php',296],['lib/classes','useragent.php',101],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['search/classes','manager.php',109],['cache','locallib.php',52],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['lib/classes','plugin_manager.php',103],['lib/htmlpurifier','HTMLPurifier.php',251],['course/format','lib.php',156],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['admin/tool/installaddon/classes','installer.php',40],['lib','modinfolib.php',373],['cache/classes','helper.php',76],['lib/tests','string_manager_standard_test.php',124],['lib/portfolio','exporter.php',251],['lib/classes/update','validator.php',88],['search/classes','document_factory.php',49],['lib','accesslib.php',6235],['lib','accesslib.php',6487],['lib','accesslib.php',6665],['lib','accesslib.php',6919],['lib','accesslib.php',7180],['lib','accesslib.php',7392],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443],['lib','filterlib.php',80],['search/tests/fixtures','testable_core_search.php',43],['lib/tests/fixtures','testable_update_checker.php',45],['backup/cc','validator.php',35],['cache/classes','config.php',87],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29]], 4647],
'try_autoenrol': ['try_autoenrol', 'Attempt to automatically enrol current user in course without any interaction, calling code has to make sure the plugin and instance are active. ', [['lib','enrollib.php',1240]], 1],
'get_records': ['get_records', 'Load a list of records. ', [['competency/classes','persistent.php',709],['mod/glossary/classes','entry_query_builder.php',295],['lib/dml','moodle_database.php',1285],['lib','coursecatlib.php',651],['question','category_class.php',63]], 965],
'show_enrolme_link': ['show_enrolme_link', 'Does this plugin support some way to user to self enrol? ', [['lib','enrollib.php',1229],['enrol/self','lib.php',111],['enrol/paypal','lib.php',95]], 14],
'output': ['output', 'Specific output method for the memory XML sink. ', [['lib/dtl','string_xml_database_exporter.php',34],['lib/tcpdf','tcpdf.php',7537],['lib','weblib.php',3368],['lib','weblib.php',3387],['lib','weblib.php',3408],['lib','weblib.php',3432],['lib','weblib.php',3491],['lib','weblib.php',3530],['lib','weblib.php',3602],['backup/util/output','output_controller.class.php',67],['lib','pdflib.php',178],['lib/amd/src','chart_output_chartjs.js',46],['comment','lib.php',420],['lib/amd/src','chart_output_htmltable.js',29],['lib/minify/lib/HTTP','Encoder.php',285],['lib/dtl','file_xml_database_exporter.php',51],['lib','graphlib.php',1485],['grade/report/singleview','lib.php',104],['admin/tool/uploadcourse/classes','tracker.php',135]], 218],
'force_current_language': ['force_current_language', 'Force the current language to get strings and dates localised in the given language. ', [['lib','moodlelib.php',6656]], 12],
'update_status': ['update_status', 'Update instance status ', [['lib','enrollib.php',1827],['enrol/cohort','lib.php',189],['plagiarism','lib.php',92],['enrol/meta','lib.php',190]], 33],
'can_edit_instance': ['can_edit_instance', 'Return whether or not, given the current state, it is possible to edit an instance of this enrolment plugin in the course. Used by the standard editing UI to generate a link to the edit instance form if editing is allowed. ', [['lib','enrollib.php',1567]], 0],
'action_icon': ['action_icon', 'Renders an action_icon. ', [['course/classes','management_renderer.php',987],['lib','outputrenderers.php',1694]], 113],
'get_unenrolself_link': ['get_unenrolself_link', 'Returns list of unenrol links for all enrol instances in course. ', [['lib','enrollib.php',1631]], 4],
'debugging': ['debugging', 'Standard Debugging Function ', [['lib','weblib.php',3012]], 1007],
'is_null': ['is_null', '', [], 2003],
'round': ['round', '', [], 1002],
'array_map': ['array_map', '', [], 169],
'strpos': ['strpos', '', [], 1604],
'is_array': ['is_array', '', [], 1608],
'defined': ['defined', '', [], 4731],
'implode': ['implode', '', [], 1281],
'trim': ['trim', '', [], 1948],
'array_merge': ['array_merge', '', [], 2944],
'file_exists': ['file_exists', '', [], 867],
'define': ['define', '', [], 2373],
'class_exists': ['class_exists', '', [], 279],
'time': ['time', '', [], 1959],
'max': ['max', '', [], 1266],
'reset': ['reset', '', [], 1213],
'get_class': ['get_class', '', [], 305],
'is_string': ['is_string', '', [], 536],
'explode': ['explode', '', [], 1572],
'ksort': ['ksort', '', [], 153],
'substr': ['substr', '', [], 2823],
'in_array': ['in_array', '', [], 1234],
'is_object': ['is_object', '', [], 544],
'array_unique': ['array_unique', '', [], 171]};
CLASS_DATA={
'text_progress_trace': ['text_progress_trace', 'This subclass of progress_trace outputs to plain text. ', [['lib','weblib.php',3379]], 21],
'enrol_instance_updated': ['enrol_instance_updated', 'Enrol instance updated event class. ', [['lib/classes/event','enrol_instance_updated.php',28]], 3],
'core_component': ['core_component', 'Collection of components related methods. ', [['lib/classes','component.php',41]], 511],
'pix_icon': ['pix_icon', 'Data structure representing an icon. ', [['lib','outputcomponents.php',497]], 275],
'user_enrolment_updated': ['user_enrolment_updated', 'Event class for when user enrolment is updated. ', [['lib/classes/event','user_enrolment_updated.php',28]], 2],
'user_enrolment_deleted': ['user_enrolment_deleted', 'Event class for when user is unenrolled from a course. ', [['lib/classes/event','user_enrolment_deleted.php',28]], 1],
'context_course': ['context_course', 'Course context class ', [['lib','accesslib.php',6817]], 1323],
'coding_exception': ['coding_exception', 'Exception indicating programming error, must be fixed by a programer. For example a core API might throw this type of exception if a plugin calls it incorrectly. ', [['lib','setuplib.php',239]], 1200],
'enrol_instance_deleted': ['enrol_instance_deleted', 'Enrol instance deleted event class. ', [['lib/classes/event','enrol_instance_deleted.php',28]], 1],
'null_progress_trace': ['null_progress_trace', 'This subclass of progress_trace does not ouput anything. ', [['lib','weblib.php',3360]], 49],
'moodle_url': ['moodle_url', 'Class for creating and manipulating urls. ', [['lib','weblib.php',238]], 3088],
'core_php_time_limit': ['core_php_time_limit', 'Utility class to manage PHP time limit. ', [['lib/classes','php_time_limit.php',27]], 92],
'coursecat': ['coursecat', 'Class to store, cache, render and manage course category ', [['lib','coursecatlib.php',28]], 276],
'enrol_instance_created': ['enrol_instance_created', 'Enrol instance created event class. ', [['lib/classes/event','enrol_instance_created.php',28]], 1],
'cache_helper': ['cache_helper', 'The cache helper class. ', [['cache/classes','helper.php',31]], 139],
'user_enrolment_created': ['user_enrolment_created', 'Event class for when user is enrolled in a course. ', [['lib/classes/event','user_enrolment_created.php',28]], 1],
'context_helper': ['context_helper', 'Context maintenance and helper methods. ', [['lib','accesslib.php',5875]], 203],
'navigation_node': ['navigation_node', 'This class is used to represent a node in a navigation tree ', [['lib','navigationlib.php',34]], 348]};
CONST_DATA={
'PARAM_PLUGIN': ['PARAM_PLUGIN', '', [['lib','moodlelib.php',324]], 104],
'ENROL_EXT_REMOVED_SUSPENDNOROLES': ['ENROL_EXT_REMOVED_SUSPENDNOROLES', '', [['lib','enrollib.php',68]], 62],
'ENROL_EXT_REMOVED_UNENROL': ['ENROL_EXT_REMOVED_UNENROL', '', [['lib','enrollib.php',49]], 57],
'ENROL_EXT_REMOVED_KEEP': ['ENROL_EXT_REMOVED_KEEP', '', [['lib','enrollib.php',52]], 29],
'DEBUG_DEVELOPER': ['DEBUG_DEVELOPER', '', [['lib','setuplib.php',40]], 736],
'ENROL_RESTORE_TYPE': ['ENROL_RESTORE_TYPE', '', [['lib','enrollib.php',55]], 1],
'ENROL_USER_SUSPENDED': ['ENROL_USER_SUSPENDED', '', [['lib','enrollib.php',40]], 105],
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',140],['','install.php',93],['lib','setup.php',391]], 4153],
'ENROL_INSTANCE_DISABLED': ['ENROL_INSTANCE_DISABLED', '', [['lib','enrollib.php',34]], 56],
'MEMORY_HUGE': ['MEMORY_HUGE', '', [['lib','setuplib.php',52]], 20],
'ENROL_REQUIRE_LOGIN_CACHE_PERIOD': ['ENROL_REQUIRE_LOGIN_CACHE_PERIOD', '', [['lib','enrollib.php',43]], 1],
'ENROL_MAX_TIMESTAMP': ['ENROL_MAX_TIMESTAMP', '', [['lib','enrollib.php',46]], 6],
'IGNORE_MISSING': ['IGNORE_MISSING', '', [['lib','dmllib.php',48]], 215],
'ENROL_INSTANCE_ENABLED': ['ENROL_INSTANCE_ENABLED', '', [['lib','enrollib.php',31]], 115],
'FORMAT_MARKDOWN': ['FORMAT_MARKDOWN', '', [['lib','weblib.php',65]], 78],
'SITEID': ['SITEID', '', [['admin/cli','install.php',219],['lib/db','install.php',87],['','install.php',242],['lib','setup.php',755]], 608],
'CONTEXT_COURSE': ['CONTEXT_COURSE', '', [['lib','accesslib.php',148]], 441],
'ENROL_EXT_REMOVED_SUSPEND': ['ENROL_EXT_REMOVED_SUSPEND', '', [['lib','enrollib.php',62]], 24],
'MUST_EXIST': ['MUST_EXIST', '', [['lib','dmllib.php',52]], 1384],
'ENROL_USER_ACTIVE': ['ENROL_USER_ACTIVE', '', [['lib','enrollib.php',37]], 210],
'SQL_PARAMS_NAMED': ['SQL_PARAMS_NAMED', '', [['lib/dml','moodle_database.php',32]], 315]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
