<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : Detail view of datalib.php</title>
    <link rel="stylesheet" href="../sample.css" type="text/css">
    <link rel="stylesheet" href="../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../';
subdir='lib';
filename='datalib.php.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="details-heading"><a href="./index.html">/lib/</a> -> <a href="datalib.php.source.html">datalib.php</a> (summary)</h2>
<div class="details-summary">
<p class="viewlinks">[<a href="datalib.php.source.html">Source view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="../_stats.html">Project Stats</a>]</p>
<p><b>Library of functions for database manipulation. Other main libraries: - weblib.php - functions that produce web output - moodlelib.php - general-purpose Moodle functions</b></p>
<table>
<tr><td align="right">Copyright: </td><td>1999 onwards Martin Dougiamas  {@link http://moodle.com}</td></tr>
<tr><td align="right">License: </td><td><a href="http://www.gnu.org/copyleft/gpl.html" target="_blank">http://www.gnu.org/copyleft/gpl.html</a> GNU GPL v3 or later</td></tr>
<tr><td align="right">File Size: </td><td>1964 lines (71 kb)</td></tr>
<tr><td align="right">Included or required:</td><td>0 times</td></tr>
<tr><td align="right" valign="top">Referenced: </td><td>0 times</td></tr>
<tr><td align="right" valign="top">Includes or requires: </td><td>0 files</td></tr>
</table>
<h3>Defines 37 functions</h3>
<div class="inset">
&nbsp;&nbsp;<a href="#get_admin">get_admin</a>()<br>
&nbsp;&nbsp;<a href="#get_admins">get_admins</a>()<br>
&nbsp;&nbsp;<a href="#search_users">search_users</a>()<br>
&nbsp;&nbsp;<a href="#users_search_sql">users_search_sql</a>()<br>
&nbsp;&nbsp;<a href="#users_order_by_sql">users_order_by_sql</a>()<br>
&nbsp;&nbsp;<a href="#get_users">get_users</a>()<br>
&nbsp;&nbsp;<a href="#get_users_listing">get_users_listing</a>()<br>
&nbsp;&nbsp;<a href="#get_users_confirmed">get_users_confirmed</a>()<br>
&nbsp;&nbsp;<a href="#get_site">get_site</a>()<br>
&nbsp;&nbsp;<a href="#get_course">get_course</a>()<br>
&nbsp;&nbsp;<a href="#get_courses">get_courses</a>()<br>
&nbsp;&nbsp;<a href="#get_courses_page">get_courses_page</a>()<br>
&nbsp;&nbsp;<a href="#get_courses_search">get_courses_search</a>()<br>
&nbsp;&nbsp;<a href="#fix_course_sortorder">fix_course_sortorder</a>()<br>
&nbsp;&nbsp;<a href="#_fix_course_cats">_fix_course_cats</a>()<br>
&nbsp;&nbsp;<a href="#get_my_remotecourses">get_my_remotecourses</a>()<br>
&nbsp;&nbsp;<a href="#get_my_remotehosts">get_my_remotehosts</a>()<br>
&nbsp;&nbsp;<a href="#get_scales_menu">get_scales_menu</a>()<br>
&nbsp;&nbsp;<a href="#increment_revision_number">increment_revision_number</a>()<br>
&nbsp;&nbsp;<a href="#get_course_mods">get_course_mods</a>()<br>
&nbsp;&nbsp;<a href="#get_coursemodule_from_id">get_coursemodule_from_id</a>()<br>
&nbsp;&nbsp;<a href="#get_coursemodule_from_instance">get_coursemodule_from_instance</a>()<br>
&nbsp;&nbsp;<a href="#get_coursemodules_in_course">get_coursemodules_in_course</a>()<br>
&nbsp;&nbsp;<a href="#get_all_instances_in_courses">get_all_instances_in_courses</a>()<br>
&nbsp;&nbsp;<a href="#get_all_instances_in_course">get_all_instances_in_course</a>()<br>
&nbsp;&nbsp;<a href="#instance_is_visible">instance_is_visible</a>()<br>
&nbsp;&nbsp;<a href="#get_log_manager">get_log_manager</a>()<br>
&nbsp;&nbsp;<a href="#add_to_config_log">add_to_config_log</a>()<br>
&nbsp;&nbsp;<a href="#user_accesstime_log">user_accesstime_log</a>()<br>
&nbsp;&nbsp;<a href="#get_logs">get_logs</a>()<br>
&nbsp;&nbsp;<a href="#get_logs_usercourse">get_logs_usercourse</a>()<br>
&nbsp;&nbsp;<a href="#get_logs_userday">get_logs_userday</a>()<br>
&nbsp;&nbsp;<a href="#print_object">print_object</a>()<br>
&nbsp;&nbsp;<a href="#xmldb_debug">xmldb_debug</a>()<br>
&nbsp;&nbsp;<a href="#user_can_create_courses">user_can_create_courses</a>()<br>
&nbsp;&nbsp;<a href="#update_field_with_unique_index">update_field_with_unique_index</a>()<br>
&nbsp;&nbsp;<a href="#decompose_update_into_safe_changes">decompose_update_into_safe_changes</a>()<br>
</div>
</div>
<br><div class="details-funclist">
<div class="details-classtitle"><a name="functions"><b>Functions</b></a></div>
<div class="details-classinfo">
Functions that are not part of a class:<br><br>
<div class="inset"><table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_admin" onClick="logFunction('get_admin', 'datalib.php.source.html#l53')" href="datalib.php.source.html#l53">get_admin</a>()&nbsp;&nbsp;
<a href="../_functions/get_admin.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns $user object of the main admin user<BR>
</b><BR><b>return:</b> stdClass {@link $USER} record from DB, false if not found<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_admins" onClick="logFunction('get_admins', 'datalib.php.source.html#l93')" href="datalib.php.source.html#l93">get_admins</a>()&nbsp;&nbsp;
<a href="../_functions/get_admins.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns list of all admins, using 1 DB query<BR>
</b><BR><b>return:</b> array<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="search_users" onClick="logFunction('search_users', 'datalib.php.source.html#l124')" href="datalib.php.source.html#l124">search_users</a>(<a href="../_variables/courseid.html">$courseid</a>, <a href="../_variables/groupid.html">$groupid</a>, <a href="../_variables/searchtext.html">$searchtext</a>, <a href="../_variables/sort.html">$sort</a>='', array <a href="../_variables/exceptions.html">$exceptions</a>=null)&nbsp;&nbsp;
<a href="../_functions/search_users.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Search through course users<BR>
</b><BR>If $coursid specifies the site course then this function searches<BR>
through all undeleted and confirmed users<BR>
<BR>
<b>param:</b> int $courseid The course in question.<br>
<b>param:</b> int $groupid The group in question.<br>
<b>param:</b> string $searchtext The string to search for<br>
<b>param:</b> string $sort A field to sort by<br>
<b>param:</b> array $exceptions A list of IDs to ignore, eg 2,4,5,8,9,10<br>
<b>return:</b> array<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="users_search_sql" onClick="logFunction('users_search_sql', 'datalib.php.source.html#l201')" href="datalib.php.source.html#l201">users_search_sql</a>(<a href="../_variables/search.html">$search</a>, <a href="../_variables/u.html">$u</a> = 'u', <a href="../_variables/searchanywhere.html">$searchanywhere</a> = true, array <a href="../_variables/extrafields.html">$extrafields</a> = array()&nbsp;&nbsp;
<a href="../_functions/users_search_sql.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns SQL used to search through user table to find users (in a query<BR>
which may also join and apply other conditions).<BR>
</b><BR>You can combine this SQL with an existing query by adding 'AND $sql' to the<BR>
WHERE clause of your query (where $sql is the first element in the array<BR>
returned by this function), and merging in the $params array to the parameters<BR>
of your query (where $params is the second element). Your query should use<BR>
named parameters such as :param, rather than the question mark style.<BR>
<BR>
There are examples of basic usage in the unit test for this function.<BR>
<BR>
<b>param:</b> string $search the text to search for (empty string = find all)<br>
<b>param:</b> string $u the table alias for the user table in the query being<br>
<b>param:</b> bool $searchanywhere If true (default), searches in the middle of<br>
<b>param:</b> array $extrafields Array of extra user fields to include in search<br>
<b>param:</b> array $exclude Array of user ids to exclude (empty = don't exclude)<br>
<b>param:</b> array $includeonly If specified, only returns users that have ids<br>
<b>return:</b> array an array with two elements, a fragment of SQL to go in the<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="users_order_by_sql" onClick="logFunction('users_order_by_sql', 'datalib.php.source.html#l290')" href="datalib.php.source.html#l290">users_order_by_sql</a>(<a href="../_variables/usertablealias.html">$usertablealias</a> = '', <a href="../_variables/search.html">$search</a> = null, context <a href="../_variables/context.html">$context</a> = null)&nbsp;&nbsp;
<a href="../_functions/users_order_by_sql.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>This function generates the standard ORDER BY clause for use when generating<BR>
lists of users. If you don't have a reason to use a different order, then<BR>
you should use this method to generate the order when displaying lists of users.<BR>
</b><BR>If the optional $search parameter is passed, then exact matches to the search<BR>
will be sorted first. For example, suppose you have two users 'Al Zebra' and<BR>
'Alan Aardvark'. The default sort is Alan, then Al. If, however, you search for<BR>
'Al', then Al will be listed first. (With two users, this is not a big deal,<BR>
but with thousands of users, it is essential.)<BR>
<BR>
The list of fields scanned for exact matches are:<BR>
- firstname<BR>
- lastname<BR>
- $DB-&gt;sql_fullname<BR>
- those returned by get_extra_user_fields<BR>
<BR>
If named parameters are used (which is the default, and highly recommended),<BR>
then the parameter names are like :usersortexactN, where N is an int.<BR>
<BR>
The simplest possible example use is:<BR>
list($sort, $params) = users_order_by_sql();<BR>
$sql = 'SELECT * FROM {users} ORDER BY ' . $sort;<BR>
<BR>
A more complex example, showing that this sort can be combined with other sorts:<BR>
list($sort, $sortparams) = users_order_by_sql('u');<BR>
$sql = &quot;SELECT g.id AS groupid, gg.groupingid, u.id AS userid, u.firstname, u.lastname, u.idnumber, u.username<BR>
FROM {groups} g<BR>
LEFT JOIN {groupings_groups} gg ON g.id = gg.groupid<BR>
LEFT JOIN {groups_members} gm ON g.id = gm.groupid<BR>
LEFT JOIN {user} u ON gm.userid = u.id<BR>
WHERE g.courseid = :courseid $groupwhere $groupingwhere<BR>
ORDER BY g.name, $sort&quot;;<BR>
$params += $sortparams;<BR>
<BR>
An example showing the use of $search:<BR>
list($sort, $sortparams) = users_order_by_sql('u', $search, $this-&gt;get_context());<BR>
$order = ' ORDER BY ' . $sort;<BR>
$params += $sortparams;<BR>
$availableusers = $DB-&gt;get_records_sql($fields . $sql . $order, $params, $page*$perpage, $perpage);<BR>
<BR>
<b>param:</b> string $usertablealias (optional) any table prefix for the {users} table. E.g. 'u'.<br>
<b>param:</b> string $search (optional) a current search string. If given,<br>
<b>param:</b> context $context the context we are in. Use by get_extra_user_fields.<br>
<b>return:</b> array with two elements:<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_users" onClick="logFunction('get_users', 'datalib.php.source.html#l381')" href="datalib.php.source.html#l381">get_users</a>(<a href="../_variables/get.html">$get</a>=true, <a href="../_variables/search.html">$search</a>='', <a href="../_variables/confirmed.html">$confirmed</a>=false, array <a href="../_variables/exceptions.html">$exceptions</a>=null, <a href="../_variables/sort.html">$sort</a>='firstname ASC',<a href="../_variables/firstinitial.html">$firstinitial</a>='', <a href="../_variables/lastinitial.html">$lastinitial</a>='', <a href="../_variables/page.html">$page</a>='', <a href="../_variables/recordsperpage.html">$recordsperpage</a>='', <a href="../_variables/fields.html">$fields</a>='*', <a href="../_variables/extraselect.html">$extraselect</a>='', array <a href="../_variables/extraparams.html">$extraparams</a>=null)&nbsp;&nbsp;
<a href="../_functions/get_users.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns a subset of users<BR>
</b><BR><b>param:</b> bool $get If false then only a count of the records is returned<br>
<b>param:</b> string $search A simple string to search for<br>
<b>param:</b> bool $confirmed A switch to allow/disallow unconfirmed users<br>
<b>param:</b> array $exceptions A list of IDs to ignore, eg 2,4,5,8,9,10<br>
<b>param:</b> string $sort A SQL snippet for the sorting criteria to use<br>
<b>param:</b> string $firstinitial Users whose first name starts with $firstinitial<br>
<b>param:</b> string $lastinitial Users whose last name starts with $lastinitial<br>
<b>param:</b> string $page The page or records to return<br>
<b>param:</b> string $recordsperpage The number of records to return per page<br>
<b>param:</b> string $fields A comma separated list of fields to be returned from the chosen table.<br>
<b>return:</b> array|int|bool&nbsp;&nbsp;{@link $USER} records unless get is false in which case the integer count of the records found is returned.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_users_listing" onClick="logFunction('get_users_listing', 'datalib.php.source.html#l456')" href="datalib.php.source.html#l456">get_users_listing</a>(<a href="../_variables/sort.html">$sort</a>='lastaccess', <a href="../_variables/dir.html">$dir</a>='ASC', <a href="../_variables/page.html">$page</a>=0, <a href="../_variables/recordsperpage.html">$recordsperpage</a>=0,<a href="../_variables/search.html">$search</a>='', <a href="../_variables/firstinitial.html">$firstinitial</a>='', <a href="../_variables/lastinitial.html">$lastinitial</a>='', <a href="../_variables/extraselect.html">$extraselect</a>='',array <a href="../_variables/extraparams.html">$extraparams</a>=null, <a href="../_variables/extracontext.html">$extracontext</a> = null)&nbsp;&nbsp;
<a href="../_functions/get_users_listing.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Return filtered (if provided) list of users in site, except guest and deleted users.<BR>
</b><BR><b>param:</b> string $sort An SQL field to sort by<br>
<b>param:</b> string $dir The sort direction ASC|DESC<br>
<b>param:</b> int $page The page or records to return<br>
<b>param:</b> int $recordsperpage The number of records to return per page<br>
<b>param:</b> string $search A simple string to search for<br>
<b>param:</b> string $firstinitial Users whose first name starts with $firstinitial<br>
<b>param:</b> string $lastinitial Users whose last name starts with $lastinitial<br>
<b>param:</b> string $extraselect An additional SQL select statement to append to the query<br>
<b>param:</b> array $extraparams Additional parameters to use for the above $extraselect<br>
<b>param:</b> stdClass $extracontext If specified, will include user 'extra fields'<br>
<b>return:</b> array Array of {@link $USER} records<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_users_confirmed" onClick="logFunction('get_users_confirmed', 'datalib.php.source.html#l530')" href="datalib.php.source.html#l530">get_users_confirmed</a>()&nbsp;&nbsp;
<a href="../_functions/get_users_confirmed.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Full list of users that have confirmed their accounts.<BR>
</b><BR><b>return:</b> array of unconfirmed users<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_site" onClick="logFunction('get_site', 'datalib.php.source.html#l547')" href="datalib.php.source.html#l547">get_site</a>()&nbsp;&nbsp;
<a href="../_functions/get_site.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns $course object of the top-level site.<BR>
</b><BR><b>return:</b> object A {@link $COURSE} object for the site, exception if not found<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_course" onClick="logFunction('get_course', 'datalib.php.source.html#l568')" href="datalib.php.source.html#l568">get_course</a>(<a href="../_variables/courseid.html">$courseid</a>, <a href="../_variables/clone.html">$clone</a> = true)&nbsp;&nbsp;
<a href="../_functions/get_course.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Gets a course object from database. If the course id corresponds to an<BR>
already-loaded $COURSE or $SITE object, then the loaded object will be used,<BR>
saving a database query.<BR>
</b><BR>If it reuses an existing object, by default the object will be cloned. This<BR>
means you can modify the object safely without affecting other code.<BR>
<BR>
<b>param:</b> int $courseid Course id<br>
<b>param:</b> bool $clone If true (default), makes a clone of the record<br>
<b>return:</b> stdClass A course object<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_courses" onClick="logFunction('get_courses', 'datalib.php.source.html#l592')" href="datalib.php.source.html#l592">get_courses</a>(<a href="../_variables/categoryid.html">$categoryid</a>=&quot;all&quot;, <a href="../_variables/sort.html">$sort</a>=&quot;c.sortorder ASC&quot;, <a href="../_variables/fields.html">$fields</a>=&quot;c.*&quot;)&nbsp;&nbsp;
<a href="../_functions/get_courses.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns list of courses, for whole site, or category<BR>
</b><BR>Returns list of courses, for whole site, or category<BR>
Important: Using c.* for fields is extremely expensive because<BR>
we are using distinct. You almost _NEVER_ need all the fields<BR>
in such a large SELECT<BR>
<BR>
<b>param:</b> string|int $categoryid Either a category id or 'all' for everything<br>
<b>param:</b> string $sort A field and direction to sort by<br>
<b>param:</b> string $fields The additional fields to return<br>
<b>return:</b> array Array of courses<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_courses_page" onClick="logFunction('get_courses_page', 'datalib.php.source.html#l660')" href="datalib.php.source.html#l660">get_courses_page</a>(<a href="../_variables/categoryid.html">$categoryid</a>=&quot;all&quot;, <a href="../_variables/sort.html">$sort</a>=&quot;c.sortorder ASC&quot;, <a href="../_variables/fields.html">$fields</a>=&quot;c.*&quot;,&amp;<a href="../_variables/totalcount.html">$totalcount</a>, <a href="../_variables/limitfrom.html">$limitfrom</a>=&quot;&quot;, <a href="../_variables/limitnum.html">$limitnum</a>=&quot;&quot;)&nbsp;&nbsp;
<a href="../_functions/get_courses_page.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns list of courses, for whole site, or category<BR>
</b><BR>Similar to get_courses, but allows paging<BR>
Important: Using c.* for fields is extremely expensive because<BR>
we are using distinct. You almost _NEVER_ need all the fields<BR>
in such a large SELECT<BR>
<BR>
<b>param:</b> string|int $categoryid Either a category id or 'all' for everything<br>
<b>param:</b> string $sort A field and direction to sort by<br>
<b>param:</b> string $fields The additional fields to return<br>
<b>param:</b> int $totalcount Reference for the number of courses<br>
<b>param:</b> string $limitfrom The course to start from<br>
<b>param:</b> string $limitnum The number of courses to limit to<br>
<b>return:</b> array Array of courses<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_courses_search" onClick="logFunction('get_courses_search', 'datalib.php.source.html#l734')" href="datalib.php.source.html#l734">get_courses_search</a>(<a href="../_variables/searchterms.html">$searchterms</a>, <a href="../_variables/sort.html">$sort</a>, <a href="../_variables/page.html">$page</a>, <a href="../_variables/recordsperpage.html">$recordsperpage</a>, &amp;<a href="../_variables/totalcount.html">$totalcount</a>,<a href="../_variables/requiredcapabilities.html">$requiredcapabilities</a> = array()&nbsp;&nbsp;
<a href="../_functions/get_courses_search.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>A list of courses that match a search<BR>
</b><BR><b>param:</b> array $searchterms An array of search criteria<br>
<b>param:</b> string $sort A field and direction to sort by<br>
<b>param:</b> int $page The page number to get<br>
<b>param:</b> int $recordsperpage The number of records per page<br>
<b>param:</b> int $totalcount Passed in by reference.<br>
<b>param:</b> array $requiredcapabilities Extra list of capabilities used to filter courses<br>
<b>return:</b> object {@link $COURSE} records<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="fix_course_sortorder" onClick="logFunction('fix_course_sortorder', 'datalib.php.source.html#l854')" href="datalib.php.source.html#l854">fix_course_sortorder</a>()&nbsp;&nbsp;
<a href="../_functions/fix_course_sortorder.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Fixes course category and course sortorder, also verifies category and course parents and paths.<BR>
(circular references are not fixed)<BR>
</b><BR><b>return:</b> void<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="_fix_course_cats" onClick="logFunction('_fix_course_cats', 'datalib.php.source.html#l1062')" href="datalib.php.source.html#l1062">_fix_course_cats</a>(<a href="../_variables/children.html">$children</a>, &amp;<a href="../_variables/sortorder.html">$sortorder</a>, <a href="../_variables/parent.html">$parent</a>, <a href="../_variables/depth.html">$depth</a>, <a href="../_variables/path.html">$path</a>, &amp;<a href="../_variables/fixcontexts.html">$fixcontexts</a>)&nbsp;&nbsp;
<a href="../_functions/_fix_course_cats.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Internal recursive category verification function, do not use directly!<BR>
</b><BR><b>param:</b> array $children<br>
<b>param:</b> int $sortorder<br>
<b>param:</b> string $parent<br>
<b>param:</b> int $depth<br>
<b>param:</b> string $path<br>
<b>param:</b> array $fixcontexts<br>
<b>return:</b> bool if changes were made<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_my_remotecourses" onClick="logFunction('get_my_remotecourses', 'datalib.php.source.html#l1114')" href="datalib.php.source.html#l1114">get_my_remotecourses</a>(<a href="../_variables/userid.html">$userid</a>=0)&nbsp;&nbsp;
<a href="../_functions/get_my_remotecourses.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>List of remote courses that a user has access to via MNET.<BR>
Works only on the IDP<BR>
</b><BR><b>param:</b> int @userid The user id to get remote courses for<br>
<b>return:</b> array Array of {@link $COURSE} of course objects<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_my_remotehosts" onClick="logFunction('get_my_remotehosts', 'datalib.php.source.html#l1144')" href="datalib.php.source.html#l1144">get_my_remotehosts</a>()&nbsp;&nbsp;
<a href="../_functions/get_my_remotehosts.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>List of remote hosts that a user has access to via MNET.<BR>
Works on the SP<BR>
</b><BR><b>return:</b> array|bool Array of host objects or false<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_scales_menu" onClick="logFunction('get_scales_menu', 'datalib.php.source.html#l1165')" href="datalib.php.source.html#l1165">get_scales_menu</a>(<a href="../_variables/courseid.html">$courseid</a>=0)&nbsp;&nbsp;
<a href="../_functions/get_scales_menu.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns a menu of all available scales from the site as well as the given course<BR>
</b><BR><b>param:</b> int $courseid The id of the course as found in the 'course' table.<br>
<b>return:</b> array<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="increment_revision_number" onClick="logFunction('increment_revision_number', 'datalib.php.source.html#l1184')" href="datalib.php.source.html#l1184">increment_revision_number</a>(<a href="../_variables/table.html">$table</a>, <a href="../_variables/field.html">$field</a>, <a href="../_variables/select.html">$select</a>, array <a href="../_variables/params.html">$params</a> = null)&nbsp;&nbsp;
<a href="../_functions/increment_revision_number.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Increment standard revision field.<BR>
</b><BR>The revision are based on current time and are incrementing.<BR>
There is a protection for runaway revisions, it may not go further than<BR>
one hour into future.<BR>
<BR>
The field has to be XMLDB_TYPE_INTEGER with size 10.<BR>
<BR>
<b>param:</b> string $table<br>
<b>param:</b> string $field name of the field containing revision<br>
<b>param:</b> string $select use empty string when updating all records<br>
<b>param:</b> array $params optional select parameters<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_course_mods" onClick="logFunction('get_course_mods', 'datalib.php.source.html#l1217')" href="datalib.php.source.html#l1217">get_course_mods</a>(<a href="../_variables/courseid.html">$courseid</a>)&nbsp;&nbsp;
<a href="../_functions/get_course_mods.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Just gets a raw list of all modules in a course<BR>
</b><BR><b>param:</b> int $courseid The id of the course as found in the 'course' table.<br>
<b>return:</b> array<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_coursemodule_from_id" onClick="logFunction('get_coursemodule_from_id', 'datalib.php.source.html#l1238')" href="datalib.php.source.html#l1238">get_coursemodule_from_id</a>(<a href="../_variables/modulename.html">$modulename</a>, <a href="../_variables/cmid.html">$cmid</a>, <a href="../_variables/courseid.html">$courseid</a>=0, <a href="../_variables/sectionnum.html">$sectionnum</a>=false, <a href="../_variables/strictness.html">$strictness</a>=IGNORE_MISSING)&nbsp;&nbsp;
<a href="../_functions/get_coursemodule_from_id.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Given an id of a course module, finds the coursemodule description<BR>
</b><BR>Please note that this function performs 1-2 DB queries. When possible use cached<BR>
course modinfo. For example get_fast_modinfo($courseorid)-&gt;get_cm($cmid)<BR>
See also {@link cm_info::get_course_module_record()}<BR>
<BR>
<b>param:</b> string $modulename name of module type, eg. resource, assignment,... (optional, slower and less safe if not specified)<br>
<b>param:</b> int $cmid course module id (id in course_modules table)<br>
<b>param:</b> int $courseid optional course id for extra validation<br>
<b>param:</b> bool $sectionnum include relative section number (0,1,2 ...)<br>
<b>param:</b> int $strictness IGNORE_MISSING means compatible mode, false returned if record not found, debug message if more found;<br>
<b>return:</b> stdClass<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_coursemodule_from_instance" onClick="logFunction('get_coursemodule_from_instance', 'datalib.php.source.html#l1300')" href="datalib.php.source.html#l1300">get_coursemodule_from_instance</a>(<a href="../_variables/modulename.html">$modulename</a>, <a href="../_variables/instance.html">$instance</a>, <a href="../_variables/courseid.html">$courseid</a>=0, <a href="../_variables/sectionnum.html">$sectionnum</a>=false, <a href="../_variables/strictness.html">$strictness</a>=IGNORE_MISSING)&nbsp;&nbsp;
<a href="../_functions/get_coursemodule_from_instance.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Given an instance number of a module, finds the coursemodule description<BR>
</b><BR>Please note that this function performs DB query. When possible use cached course<BR>
modinfo. For example get_fast_modinfo($courseorid)-&gt;instances[$modulename][$instance]<BR>
See also {@link cm_info::get_course_module_record()}<BR>
<BR>
<b>param:</b> string $modulename name of module type, eg. resource, assignment,...<br>
<b>param:</b> int $instance module instance number (id in resource, assignment etc. table)<br>
<b>param:</b> int $courseid optional course id for extra validation<br>
<b>param:</b> bool $sectionnum include relative section number (0,1,2 ...)<br>
<b>param:</b> int $strictness IGNORE_MISSING means compatible mode, false returned if record not found, debug message if more found;<br>
<b>return:</b> stdClass<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_coursemodules_in_course" onClick="logFunction('get_coursemodules_in_course', 'datalib.php.source.html#l1351')" href="datalib.php.source.html#l1351">get_coursemodules_in_course</a>(<a href="../_variables/modulename.html">$modulename</a>, <a href="../_variables/courseid.html">$courseid</a>, <a href="../_variables/extrafields.html">$extrafields</a>='')&nbsp;&nbsp;
<a href="../_functions/get_coursemodules_in_course.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns all course modules of given activity in course<BR>
</b><BR><b>param:</b> string $modulename The module name (forum, quiz, etc.)<br>
<b>param:</b> int $courseid The course id to get modules for<br>
<b>param:</b> string $extrafields extra fields starting with m.<br>
<b>return:</b> array Array of results<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_all_instances_in_courses" onClick="logFunction('get_all_instances_in_courses', 'datalib.php.source.html#l1382')" href="datalib.php.source.html#l1382">get_all_instances_in_courses</a>(<a href="../_variables/modulename.html">$modulename</a>, <a href="../_variables/courses.html">$courses</a>, <a href="../_variables/userid.html">$userid</a>=NULL, <a href="../_variables/includeinvisible.html">$includeinvisible</a>=false)&nbsp;&nbsp;
<a href="../_functions/get_all_instances_in_courses.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns an array of all the active instances of a particular module in given courses, sorted in the order they are defined<BR>
</b><BR>Returns an array of all the active instances of a particular<BR>
module in given courses, sorted in the order they are defined<BR>
in the course. Returns an empty array on any errors.<BR>
<BR>
The returned objects includle the columns cw.section, cm.visible,<BR>
cm.groupmode, and cm.groupingid, and are indexed by cm.id.<BR>
<BR>
<b>param:</b> string $modulename The name of the module to get instances for<br>
<b>param:</b> array $courses an array of course objects.<br>
<b>param:</b> int $userid<br>
<b>param:</b> int $includeinvisible<br>
<b>return:</b> array of module instance objects, including some extra fields from the course_modules<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_all_instances_in_course" onClick="logFunction('get_all_instances_in_course', 'datalib.php.source.html#l1454')" href="datalib.php.source.html#l1454">get_all_instances_in_course</a>(<a href="../_variables/modulename.html">$modulename</a>, <a href="../_variables/course.html">$course</a>, <a href="../_variables/userid.html">$userid</a>=NULL, <a href="../_variables/includeinvisible.html">$includeinvisible</a>=false)&nbsp;&nbsp;
<a href="../_functions/get_all_instances_in_course.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Returns an array of all the active instances of a particular module in a given course,<BR>
sorted in the order they are defined.<BR>
</b><BR>Returns an array of all the active instances of a particular<BR>
module in a given course, sorted in the order they are defined<BR>
in the course. Returns an empty array on any errors.<BR>
<BR>
The returned objects includle the columns cw.section, cm.visible,<BR>
cm.groupmode, and cm.groupingid, and are indexed by cm.id.<BR>
<BR>
Simply calls {@link all_instances_in_courses()} with a single provided course<BR>
<BR>
<b>param:</b> string $modulename The name of the module to get instances for<br>
<b>param:</b> object $course The course obect.<br>
<b>param:</b> int $userid<br>
<b>param:</b> int $includeinvisible<br>
<b>return:</b> array of module instance objects, including some extra fields from the course_modules<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="instance_is_visible" onClick="logFunction('instance_is_visible', 'datalib.php.source.html#l1479')" href="datalib.php.source.html#l1479">instance_is_visible</a>(<a href="../_variables/moduletype.html">$moduletype</a>, <a href="../_variables/module.html">$module</a>)&nbsp;&nbsp;
<a href="../_functions/instance_is_visible.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Determine whether a module instance is visible within a course<BR>
</b><BR>Given a valid module object with info about the id and course,<BR>
and the module's type (eg &quot;forum&quot;) returns whether the object<BR>
is visible or not according to the 'eye' icon only.<BR>
<BR>
NOTE: This does NOT take into account visibility to a particular user.<BR>
To get visibility access for a specific user, use get_fast_modinfo, get a<BR>
cm_info object from this, and check the -&gt;uservisible property; or use<BR>
the \core_availability\info_module::is_user_visible() static function.<BR>
<BR>
<b>param:</b> $moduletype Name of the module eg 'forum'<br>
<b>param:</b> $module Object which is the instance of the module<br>
<b>return:</b> bool Success<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_log_manager" onClick="logFunction('get_log_manager', 'datalib.php.source.html#l1520')" href="datalib.php.source.html#l1520">get_log_manager</a>(<a href="../_variables/forcereload.html">$forcereload</a> = false)&nbsp;&nbsp;
<a href="../_functions/get_log_manager.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Get instance of log manager.<BR>
</b><BR><b>param:</b> bool $forcereload<br>
<b>return:</b> \core\log\manager<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="add_to_config_log" onClick="logFunction('add_to_config_log', 'datalib.php.source.html#l1555')" href="datalib.php.source.html#l1555">add_to_config_log</a>(<a href="../_variables/name.html">$name</a>, <a href="../_variables/oldvalue.html">$oldvalue</a>, <a href="../_variables/value.html">$value</a>, <a href="../_variables/plugin.html">$plugin</a>)&nbsp;&nbsp;
<a href="../_functions/add_to_config_log.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Add an entry to the config log table.<BR>
</b><BR>These are &quot;action&quot; focussed rather than web server hits,<BR>
and provide a way to easily reconstruct changes to Moodle configuration.<BR>
<BR>
<b>param:</b> string&nbsp;&nbsp;$name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The name of the configuration change action<br>
<b>param:</b> string&nbsp;&nbsp;$oldvalue The config setting's previous value<br>
<b>param:</b> string&nbsp;&nbsp;$value&nbsp;&nbsp;&nbsp;&nbsp;The config setting's new value<br>
<b>param:</b> string&nbsp;&nbsp;$plugin&nbsp;&nbsp;&nbsp;Plugin name, for example a filter name when changing filter configuration<br>
<b>return:</b> void<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="user_accesstime_log" onClick="logFunction('user_accesstime_log', 'datalib.php.source.html#l1585')" href="datalib.php.source.html#l1585">user_accesstime_log</a>(<a href="../_variables/courseid.html">$courseid</a>=0)&nbsp;&nbsp;
<a href="../_functions/user_accesstime_log.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Store user last access times - called when use enters a course or site<BR>
</b><BR><b>param:</b> int $courseid&nbsp;&nbsp;empty courseid means site<br>
<b>return:</b> void<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_logs" onClick="logFunction('get_logs', 'datalib.php.source.html#l1674')" href="datalib.php.source.html#l1674">get_logs</a>(<a href="../_variables/select.html">$select</a>, array <a href="../_variables/params.html">$params</a>=null, <a href="../_variables/order.html">$order</a>='l.time DESC', <a href="../_variables/limitfrom.html">$limitfrom</a>='', <a href="../_variables/limitnum.html">$limitnum</a>='', &amp;<a href="../_variables/totalcount.html">$totalcount</a>)&nbsp;&nbsp;
<a href="../_functions/get_logs.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Select all log records based on SQL criteria<BR>
</b><BR><b>param:</b> string $select SQL select criteria<br>
<b>param:</b> array $params named sql type params<br>
<b>param:</b> string $order SQL order by clause to sort the records returned<br>
<b>param:</b> string $limitfrom return a subset of records, starting at this point (optional, required if $limitnum is set)<br>
<b>param:</b> int $limitnum return a subset comprising this many records (optional, required if $limitfrom is set)<br>
<b>param:</b> int $totalcount Passed in by reference.<br>
<b>return:</b> array<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_logs_usercourse" onClick="logFunction('get_logs_usercourse', 'datalib.php.source.html#l1718')" href="datalib.php.source.html#l1718">get_logs_usercourse</a>(<a href="../_variables/userid.html">$userid</a>, <a href="../_variables/courseid.html">$courseid</a>, <a href="../_variables/coursestart.html">$coursestart</a>)&nbsp;&nbsp;
<a href="../_functions/get_logs_usercourse.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Select all log records for a given course and user<BR>
</b><BR><b>param:</b> int $userid The id of the user as found in the 'user' table.<br>
<b>param:</b> int $courseid The id of the course as found in the 'course' table.<br>
<b>param:</b> string $coursestart unix timestamp representing course start date and time.<br>
<b>return:</b> array<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_logs_userday" onClick="logFunction('get_logs_userday', 'datalib.php.source.html#l1753')" href="datalib.php.source.html#l1753">get_logs_userday</a>(<a href="../_variables/userid.html">$userid</a>, <a href="../_variables/courseid.html">$courseid</a>, <a href="../_variables/daystart.html">$daystart</a>)&nbsp;&nbsp;
<a href="../_functions/get_logs_userday.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Select all log records for a given course, user, and day<BR>
</b><BR><b>param:</b> int $userid The id of the user as found in the 'user' table.<br>
<b>param:</b> int $courseid The id of the course as found in the 'course' table.<br>
<b>param:</b> string $daystart unix timestamp of the start of the day for which the logs needs to be retrived<br>
<b>return:</b> array<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="print_object" onClick="logFunction('print_object', 'datalib.php.source.html#l1786')" href="datalib.php.source.html#l1786">print_object</a>(<a href="../_variables/object.html">$object</a>)&nbsp;&nbsp;
<a href="../_functions/print_object.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Dumps a given object's information for debugging purposes<BR>
</b><BR>When used in a CLI script, the object's information is written to the standard<BR>
error output stream. When used in a web script, the object is dumped to a<BR>
pre-formatted block with the &quot;notifytiny&quot; CSS class.<BR>
<BR>
<b>param:</b> mixed $object The data to be printed<br>
<b>return:</b> void output is echo'd<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="xmldb_debug" onClick="logFunction('xmldb_debug', 'datalib.php.source.html#l1809')" href="datalib.php.source.html#l1809">xmldb_debug</a>(<a href="../_variables/message.html">$message</a>, <a href="../_variables/object.html">$object</a>)&nbsp;&nbsp;
<a href="../_functions/xmldb_debug.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>This function is the official hook inside XMLDB stuff to delegate its debug to one<BR>
external function.<BR>
</b><BR>Any script can avoid calls to this function by defining XMLDB_SKIP_DEBUG_HOOK before<BR>
using XMLDB classes. Obviously, also, if this function doesn't exist, it isn't invoked ;-)<BR>
<BR>
<b>param:</b> string $message string contains the error message<br>
<b>param:</b> object $object object XMLDB object that fired the debug<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="user_can_create_courses" onClick="logFunction('user_can_create_courses', 'datalib.php.source.html#l1830')" href="datalib.php.source.html#l1830">user_can_create_courses</a>()&nbsp;&nbsp;
<a href="../_functions/user_can_create_courses.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b></b><BR><b>return:</b> boolean Whether the user can create courses in any category in the system.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="update_field_with_unique_index" onClick="logFunction('update_field_with_unique_index', 'datalib.php.source.html#l1843')" href="datalib.php.source.html#l1843">update_field_with_unique_index</a>(<a href="../_variables/table.html">$table</a>, <a href="../_variables/field.html">$field</a>, array <a href="../_variables/newvalues.html">$newvalues</a>,array <a href="../_variables/otherconditions.html">$otherconditions</a>, <a href="../_variables/unusedvalue.html">$unusedvalue</a> = -1)&nbsp;&nbsp;
<a href="../_functions/update_field_with_unique_index.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>This method can update the values in mulitple database rows for a colum with<BR>
a unique index, without violating that constraint.<BR>
</b><BR>Suppose we have a table with a unique index on (otherid, sortorder), and<BR>
for a particular value of otherid, we want to change all the sort orders.<BR>
You have to do this carefully or you will violate the unique index at some time.<BR>
This method takes care of the details for you.<BR>
<BR>
Note that, it is the responsibility of the caller to make sure that the<BR>
requested rename is legal. For example, if you ask for [1 =&gt; 2, 2 =&gt; 2]<BR>
then you will get a unique key violation error from the database.<BR>
<BR>
<b>param:</b> string $table The database table to modify.<br>
<b>param:</b> string $field the field that contains the values we are going to change.<br>
<b>param:</b> array $newvalues oldvalue =&gt; newvalue how to change the values.<br>
<b>param:</b> array $otherconditions array fieldname =&gt; requestedvalue extra WHERE clause<br>
<b>param:</b> int $unusedvalue (defaults to -1) a value that is never used in $ordercol.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="decompose_update_into_safe_changes" onClick="logFunction('decompose_update_into_safe_changes', 'datalib.php.source.html#l1878')" href="datalib.php.source.html#l1878">decompose_update_into_safe_changes</a>(array <a href="../_variables/newvalues.html">$newvalues</a>, <a href="../_variables/unusedvalue.html">$unusedvalue</a>)&nbsp;&nbsp;
<a href="../_functions/decompose_update_into_safe_changes.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Helper used by {@link update_field_with_unique_index()}. Given a desired<BR>
set of changes, break them down into single udpates that can be done one at<BR>
a time without breaking any unique index constraints.<BR>
</b><BR>Suppose the input is array(1 =&gt; 2, 2 =&gt; 1) and -1. Then the output will be<BR>
array (array(1, -1), array(2, 1), array(-1, 2)). This function solves this<BR>
problem in the general case, not just for simple swaps. The unit tests give<BR>
more examples.<BR>
<BR>
Note that, it is the responsibility of the caller to make sure that the<BR>
requested rename is legal. For example, if you ask for something impossible<BR>
like array(1 =&gt; 2, 2 =&gt; 2) then the results are undefined. (You will probably<BR>
get a unique key violation error from the database later.)<BR>
<BR>
<b>param:</b> array $newvalues The desired re-ordering.<br>
<b>param:</b> int $unusedvalue A value that is not currently used.<br>
<b>return:</b> array A safe way to perform the re-order. An array of two-element<br>
</td></tr></table>

<br>
</div></div>

</div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
