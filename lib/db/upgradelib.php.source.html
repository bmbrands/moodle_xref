<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /lib/db/upgradelib.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu May 28 19:17:31 2015 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='lib/db';
filename='upgradelib.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/lib/db/</a> -> <a href="upgradelib.php.html">upgradelib.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="upgradelib.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="upgradelib.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * Upgrade helper functions</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * This file is used for special upgrade functions - for example groups and gradebook.</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * These functions must use SQL and database related functions only- no other Moodle API,</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * because it might depend on db structures that are not yet present during upgrade.</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * (Do not use functions from accesslib.php, grades classes or group functions at all!)</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> *</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> * @package   core_install</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment"> * @category  upgrade</span>
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment"> * @copyright 2007 Petr Skoda (http://skodak.org)</span>
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment"> */</span>
<a name="l30"><span class="linenum">  30</span></a>  
<a name="l31"><span class="linenum">  31</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l32"><span class="linenum">  32</span></a>  
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment">/**</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment"> * Returns all non-view and non-temp tables with sane names.</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment"> * Prints list of non-supported tables using $OUTPUT-&gt;notification()</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment"> *</span>
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment"> * @return array</span>
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment"> */</span>
<a name="l39"><span class="linenum">  39</span></a>  function <a class="function" onClick="logFunction('upgrade_mysql_get_supported_tables')" href="../../_functions/upgrade_mysql_get_supported_tables.html" onMouseOver="funcPopup(event,'upgrade_mysql_get_supported_tables')">upgrade_mysql_get_supported_tables</a>() {
<a name="l40"><span class="linenum">  40</span></a>      global <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l41"><span class="linenum">  41</span></a>  
<a name="l42"><span class="linenum">  42</span></a>      <a class="var it448" onMouseOver="hilite(448)" onMouseOut="lolite()" onClick="logVariable('tables')" href="../../_variables/tables.html">$tables</a> = array();
<a name="l43"><span class="linenum">  43</span></a>      <a class="var it21046" onMouseOver="hilite(21046)" onMouseOut="lolite()" onClick="logVariable('patprefix')" href="../../_variables/patprefix.html">$patprefix</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('_', '\\_', <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_prefix')" href="../../_functions/get_prefix.html" onMouseOver="funcPopup(event,'get_prefix')">get_prefix</a>());
<a name="l44"><span class="linenum">  44</span></a>      <a class="var it21047" onMouseOver="hilite(21047)" onMouseOut="lolite()" onClick="logVariable('pregprefix')" href="../../_variables/pregprefix.html">$pregprefix</a> = <a class="phpfunction" onClick="logFunction('preg_quote')" href="../../_functions/preg_quote.html" onMouseOver="phpfuncPopup(event,'preg_quote')">preg_quote</a>(<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_prefix')" href="../../_functions/get_prefix.html" onMouseOver="funcPopup(event,'get_prefix')">get_prefix</a>(), '/');
<a name="l45"><span class="linenum">  45</span></a>  
<a name="l46"><span class="linenum">  46</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SHOW FULL TABLES LIKE '<a class="var it21046" onMouseOver="hilite(21046)" onMouseOut="lolite()" onClick="logVariable('patprefix')" href="../../_variables/patprefix.html">$patprefix</a>%'&quot;;
<a name="l47"><span class="linenum">  47</span></a>      <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l48"><span class="linenum">  48</span></a>      foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>) {
<a name="l49"><span class="linenum">  49</span></a>          <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a> = <a class="phpfunction" onClick="logFunction('array_change_key_case')" href="../../_functions/array_change_key_case.html" onMouseOver="phpfuncPopup(event,'array_change_key_case')">array_change_key_case</a>((array)<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>, CASE_LOWER);
<a name="l50"><span class="linenum">  50</span></a>          <a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a> = <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>['table_type'];
<a name="l51"><span class="linenum">  51</span></a>          unset(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>['table_type']);
<a name="l52"><span class="linenum">  52</span></a>          <a class="var it104" onMouseOver="hilite(104)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../../_variables/fullname.html">$fullname</a> = <a class="phpfunction" onClick="logFunction('array_shift')" href="../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>);
<a name="l53"><span class="linenum">  53</span></a>  
<a name="l54"><span class="linenum">  54</span></a>          if (<a class="var it21047" onMouseOver="hilite(21047)" onMouseOut="lolite()" onClick="logVariable('pregprefix')" href="../../_variables/pregprefix.html">$pregprefix</a> === '') {
<a name="l55"><span class="linenum">  55</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a> = <a class="var it104" onMouseOver="hilite(104)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../../_variables/fullname.html">$fullname</a>;
<a name="l56"><span class="linenum">  56</span></a>          } else {
<a name="l57"><span class="linenum">  57</span></a>              <a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> = null;
<a name="l58"><span class="linenum">  58</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a> = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>(&quot;/^<a class="var it21047" onMouseOver="hilite(21047)" onMouseOut="lolite()" onClick="logVariable('pregprefix')" href="../../_variables/pregprefix.html">$pregprefix</a>/&quot;, '', <a class="var it104" onMouseOver="hilite(104)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../../_variables/fullname.html">$fullname</a>, -1, <a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a>);
<a name="l59"><span class="linenum">  59</span></a>              if (<a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> !== 1) {
<a name="l60"><span class="linenum">  60</span></a>                  continue;
<a name="l61"><span class="linenum">  61</span></a>              }
<a name="l62"><span class="linenum">  62</span></a>          }
<a name="l63"><span class="linenum">  63</span></a>  
<a name="l64"><span class="linenum">  64</span></a>          if (!<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>(&quot;/^[a-z][a-z0-9_]*$/&quot;, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a>)) {
<a name="l65"><span class="linenum">  65</span></a>              echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('notification')" href="../../_functions/notification.html" onMouseOver="funcPopup(event,'notification')">notification</a>(&quot;Database table with invalid name '<a class="var it104" onMouseOver="hilite(104)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../../_variables/fullname.html">$fullname</a>' detected, skipping.&quot;, 'notifyproblem');
<a name="l66"><span class="linenum">  66</span></a>              continue;
<a name="l67"><span class="linenum">  67</span></a>          }
<a name="l68"><span class="linenum">  68</span></a>          if (<a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a> === 'VIEW') {
<a name="l69"><span class="linenum">  69</span></a>              echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('notification')" href="../../_functions/notification.html" onMouseOver="funcPopup(event,'notification')">notification</a>(&quot;Unsupported database table view '<a class="var it104" onMouseOver="hilite(104)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../../_variables/fullname.html">$fullname</a>' detected, skipping.&quot;, 'notifyproblem');
<a name="l70"><span class="linenum">  70</span></a>              continue;
<a name="l71"><span class="linenum">  71</span></a>          }
<a name="l72"><span class="linenum">  72</span></a>          <a class="var it448" onMouseOver="hilite(448)" onMouseOut="lolite()" onClick="logVariable('tables')" href="../../_variables/tables.html">$tables</a>[<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a>] = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a>;
<a name="l73"><span class="linenum">  73</span></a>      }
<a name="l74"><span class="linenum">  74</span></a>      <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l75"><span class="linenum">  75</span></a>  
<a name="l76"><span class="linenum">  76</span></a>      return <a class="var it448" onMouseOver="hilite(448)" onMouseOut="lolite()" onClick="logVariable('tables')" href="../../_variables/tables.html">$tables</a>;
<a name="l77"><span class="linenum">  77</span></a>  }
<a name="l78"><span class="linenum">  78</span></a>  
<a name="l79"><span class="linenum">  79</span></a>  <span class="comment">/**</span>
<a name="l80"><span class="linenum">  80</span></a>  <span class="comment"> * Remove all signed numbers from current database and change</span>
<a name="l81"><span class="linenum">  81</span></a>  <span class="comment"> * text fields to long texts - mysql only.</span>
<a name="l82"><span class="linenum">  82</span></a>  <span class="comment"> */</span>
<a name="l83"><span class="linenum">  83</span></a>  function <a class="function" onClick="logFunction('upgrade_mysql_fix_unsigned_and_lob_columns')" href="../../_functions/upgrade_mysql_fix_unsigned_and_lob_columns.html" onMouseOver="funcPopup(event,'upgrade_mysql_fix_unsigned_and_lob_columns')">upgrade_mysql_fix_unsigned_and_lob_columns</a>() {
<a name="l84"><span class="linenum">  84</span></a>  <span class="comment">    // We are not using standard API for changes of column</span>
<a name="l85"><span class="linenum">  85</span></a>  <span class="comment">    // because everything 'signed'-related will be removed soon.</span>
<a name="l86"><span class="linenum">  86</span></a>  
<a name="l87"><span class="linenum">  87</span></a>  <span class="comment">    // If anybody already has numbers higher than signed limit the execution stops</span>
<a name="l88"><span class="linenum">  88</span></a>  <span class="comment">    // and tables must be fixed manually before continuing upgrade.</span>
<a name="l89"><span class="linenum">  89</span></a>  
<a name="l90"><span class="linenum">  90</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l91"><span class="linenum">  91</span></a>  
<a name="l92"><span class="linenum">  92</span></a>      if (<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_dbfamily')" href="../../_functions/get_dbfamily.html" onMouseOver="funcPopup(event,'get_dbfamily')">get_dbfamily</a>() !== 'mysql') {
<a name="l93"><span class="linenum">  93</span></a>          return;
<a name="l94"><span class="linenum">  94</span></a>      }
<a name="l95"><span class="linenum">  95</span></a>  
<a name="l96"><span class="linenum">  96</span></a>      <a class="var it8016" onMouseOver="hilite(8016)" onMouseOut="lolite()" onClick="logVariable('pbar')" href="../../_variables/pbar.html">$pbar</a> = <span class="keyword">new </span><a class="class" onClick="logClass('progress_bar')" href="../../_classes/progress_bar.html" onMouseOver="classPopup(event,'progress_bar')">progress_bar</a>('mysqlconvertunsignedlobs', 500, true);
<a name="l97"><span class="linenum">  97</span></a>  
<a name="l98"><span class="linenum">  98</span></a>      <a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../_variables/prefix.html">$prefix</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_prefix')" href="../../_functions/get_prefix.html" onMouseOver="funcPopup(event,'get_prefix')">get_prefix</a>();
<a name="l99"><span class="linenum">  99</span></a>      <a class="var it448" onMouseOver="hilite(448)" onMouseOut="lolite()" onClick="logVariable('tables')" href="../../_variables/tables.html">$tables</a> = <a class="function" onClick="logFunction('upgrade_mysql_get_supported_tables')" href="../../_functions/upgrade_mysql_get_supported_tables.html" onMouseOver="funcPopup(event,'upgrade_mysql_get_supported_tables')">upgrade_mysql_get_supported_tables</a>();
<a name="l100"><span class="linenum"> 100</span></a>  
<a name="l101"><span class="linenum"> 101</span></a>      <a class="var it21048" onMouseOver="hilite(21048)" onMouseOut="lolite()" onClick="logVariable('tablecount')" href="../../_variables/tablecount.html">$tablecount</a> = <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it448" onMouseOver="hilite(448)" onMouseOut="lolite()" onClick="logVariable('tables')" href="../../_variables/tables.html">$tables</a>);
<a name="l102"><span class="linenum"> 102</span></a>      <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> = 0;
<a name="l103"><span class="linenum"> 103</span></a>      foreach (<a class="var it448" onMouseOver="hilite(448)" onMouseOut="lolite()" onClick="logVariable('tables')" href="../../_variables/tables.html">$tables</a> as <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>) {
<a name="l104"><span class="linenum"> 104</span></a>          <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>++;
<a name="l105"><span class="linenum"> 105</span></a>  
<a name="l106"><span class="linenum"> 106</span></a>          <a class="var it1822" onMouseOver="hilite(1822)" onMouseOut="lolite()" onClick="logVariable('changes')" href="../../_variables/changes.html">$changes</a> = array();
<a name="l107"><span class="linenum"> 107</span></a>  
<a name="l108"><span class="linenum"> 108</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SHOW COLUMNS FROM `{{<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>}}`&quot;;
<a name="l109"><span class="linenum"> 109</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l110"><span class="linenum"> 110</span></a>          foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>) {
<a name="l111"><span class="linenum"> 111</span></a>              <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a> = (object)<a class="phpfunction" onClick="logFunction('array_change_key_case')" href="../../_functions/array_change_key_case.html" onMouseOver="phpfuncPopup(event,'array_change_key_case')">array_change_key_case</a>((array)<a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>, CASE_LOWER);
<a name="l112"><span class="linenum"> 112</span></a>              if (<a class="phpfunction" onClick="logFunction('stripos')" href="../../_functions/stripos.html" onMouseOver="phpfuncPopup(event,'stripos')">stripos</a>(<a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('type')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/type.html">type</a>, 'unsigned') !== false) {
<a name="l113"><span class="linenum"> 113</span></a>                  <a class="var it21049" onMouseOver="hilite(21049)" onMouseOut="lolite()" onClick="logVariable('maxvalue')" href="../../_variables/maxvalue.html">$maxvalue</a> = 0;
<a name="l114"><span class="linenum"> 114</span></a>                  if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('/^int/i', <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('type')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/type.html">type</a>)) {
<a name="l115"><span class="linenum"> 115</span></a>                      <a class="var it21049" onMouseOver="hilite(21049)" onMouseOut="lolite()" onClick="logVariable('maxvalue')" href="../../_variables/maxvalue.html">$maxvalue</a> = 2147483647;
<a name="l116"><span class="linenum"> 116</span></a>                  } else if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('/^medium/i', <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('type')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/type.html">type</a>)) {
<a name="l117"><span class="linenum"> 117</span></a>                      <a class="var it21049" onMouseOver="hilite(21049)" onMouseOut="lolite()" onClick="logVariable('maxvalue')" href="../../_variables/maxvalue.html">$maxvalue</a> = 8388607;
<a name="l118"><span class="linenum"> 118</span></a>                  } else if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('/^smallint/i', <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('type')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/type.html">type</a>)) {
<a name="l119"><span class="linenum"> 119</span></a>                      <a class="var it21049" onMouseOver="hilite(21049)" onMouseOut="lolite()" onClick="logVariable('maxvalue')" href="../../_variables/maxvalue.html">$maxvalue</a> = 32767;
<a name="l120"><span class="linenum"> 120</span></a>                  } else if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('/^tinyint/i', <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('type')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/type.html">type</a>)) {
<a name="l121"><span class="linenum"> 121</span></a>                      <a class="var it21049" onMouseOver="hilite(21049)" onMouseOut="lolite()" onClick="logVariable('maxvalue')" href="../../_variables/maxvalue.html">$maxvalue</a> = 127;
<a name="l122"><span class="linenum"> 122</span></a>                  }
<a name="l123"><span class="linenum"> 123</span></a>                  if (<a class="var it21049" onMouseOver="hilite(21049)" onMouseOut="lolite()" onClick="logVariable('maxvalue')" href="../../_variables/maxvalue.html">$maxvalue</a>) {
<a name="l124"><span class="linenum"> 124</span></a>  <span class="comment">                    // Make sure nobody is abusing our integer ranges - moodle int sizes are in digits, not bytes!!!</span>
<a name="l125"><span class="linenum"> 125</span></a>                      <a class="var it21050" onMouseOver="hilite(21050)" onMouseOut="lolite()" onClick="logVariable('invalidcount')" href="../../_variables/invalidcount.html">$invalidcount</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field_sql')" href="../../_functions/get_field_sql.html" onMouseOver="funcPopup(event,'get_field_sql')">get_field_sql</a>(&quot;SELECT <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>('x') FROM `{{<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>}}` WHERE `<a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('field')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/field.html">field</a>` &gt; :maxnumber&quot;, array('maxnumber'=&gt;<a class="var it21049" onMouseOver="hilite(21049)" onMouseOut="lolite()" onClick="logVariable('maxvalue')" href="../../_variables/maxvalue.html">$maxvalue</a>));
<a name="l126"><span class="linenum"> 126</span></a>                      if (<a class="var it21050" onMouseOver="hilite(21050)" onMouseOut="lolite()" onClick="logVariable('invalidcount')" href="../../_variables/invalidcount.html">$invalidcount</a>) {
<a name="l127"><span class="linenum"> 127</span></a>                          throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('notlocalisederrormessage', 'error', <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('/admin/'), &quot;Database table '{<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>}'' contains unsigned column '{<a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('field')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/field.html">field</a>}' with <a class="var it21050" onMouseOver="hilite(21050)" onMouseOut="lolite()" onClick="logVariable('invalidcount')" href="../../_variables/invalidcount.html">$invalidcount</a> values that are out of allowed range, upgrade can not continue.&quot;);
<a name="l128"><span class="linenum"> 128</span></a>                      }
<a name="l129"><span class="linenum"> 129</span></a>                  }
<a name="l130"><span class="linenum"> 130</span></a>                  <a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a> = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>('/unsigned/i', 'signed', <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('type')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/type.html">type</a>);
<a name="l131"><span class="linenum"> 131</span></a>                  <a class="var it7879" onMouseOver="hilite(7879)" onMouseOut="lolite()" onClick="logVariable('notnull')" href="../../_variables/notnull.html">$notnull</a> = (<a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('null')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/null.html">null</a> === 'NO') ? 'NOT NULL' : 'NULL';
<a name="l132"><span class="linenum"> 132</span></a>                  <a class="var it1163" onMouseOver="hilite(1163)" onMouseOut="lolite()" onClick="logVariable('default')" href="../../_variables/default.html">$default</a> = (!<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('default')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/default.html">default</a>) and <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('default')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/default.html">default</a> !== '') ? &quot;DEFAULT '<a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('default')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/default.html">default</a>'&quot; : '';
<a name="l133"><span class="linenum"> 133</span></a>                  <a class="var it2016" onMouseOver="hilite(2016)" onMouseOut="lolite()" onClick="logVariable('autoinc')" href="../../_variables/autoinc.html">$autoinc</a> = (<a class="phpfunction" onClick="logFunction('stripos')" href="../../_functions/stripos.html" onMouseOver="phpfuncPopup(event,'stripos')">stripos</a>(<a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('extra')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/extra.html">extra</a>, 'auto_increment') !== false) ? 'AUTO_INCREMENT' : '';
<a name="l134"><span class="linenum"> 134</span></a>  <span class="comment">                // Primary and unique not necessary here, change_database_structure does not add prefix.</span>
<a name="l135"><span class="linenum"> 135</span></a>                  <a class="var it1822" onMouseOver="hilite(1822)" onMouseOut="lolite()" onClick="logVariable('changes')" href="../../_variables/changes.html">$changes</a>[] = &quot;MODIFY COLUMN `<a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('field')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/field.html">field</a>` <a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a> <a class="var it7879" onMouseOver="hilite(7879)" onMouseOut="lolite()" onClick="logVariable('notnull')" href="../../_variables/notnull.html">$notnull</a> <a class="var it1163" onMouseOver="hilite(1163)" onMouseOut="lolite()" onClick="logVariable('default')" href="../../_variables/default.html">$default</a> <a class="var it2016" onMouseOver="hilite(2016)" onMouseOut="lolite()" onClick="logVariable('autoinc')" href="../../_variables/autoinc.html">$autoinc</a>&quot;;
<a name="l136"><span class="linenum"> 136</span></a>  
<a name="l137"><span class="linenum"> 137</span></a>              } else if (<a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('type')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> === 'tinytext' or <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('type')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> === 'mediumtext' or <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('type')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> === 'text') {
<a name="l138"><span class="linenum"> 138</span></a>                  <a class="var it7879" onMouseOver="hilite(7879)" onMouseOut="lolite()" onClick="logVariable('notnull')" href="../../_variables/notnull.html">$notnull</a> = (<a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('null')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/null.html">null</a> === 'NO') ? 'NOT NULL' : 'NULL';
<a name="l139"><span class="linenum"> 139</span></a>                  <a class="var it1163" onMouseOver="hilite(1163)" onMouseOut="lolite()" onClick="logVariable('default')" href="../../_variables/default.html">$default</a> = (!<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('default')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/default.html">default</a>) and <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('default')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/default.html">default</a> !== '') ? &quot;DEFAULT '<a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('default')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/default.html">default</a>'&quot; : '';
<a name="l140"><span class="linenum"> 140</span></a>  <span class="comment">                // Primary, unique and inc are not supported for texts.</span>
<a name="l141"><span class="linenum"> 141</span></a>                  <a class="var it1822" onMouseOver="hilite(1822)" onMouseOut="lolite()" onClick="logVariable('changes')" href="../../_variables/changes.html">$changes</a>[] = &quot;MODIFY COLUMN `<a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('field')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/field.html">field</a>` LONGTEXT <a class="var it7879" onMouseOver="hilite(7879)" onMouseOut="lolite()" onClick="logVariable('notnull')" href="../../_variables/notnull.html">$notnull</a> <a class="var it1163" onMouseOver="hilite(1163)" onMouseOut="lolite()" onClick="logVariable('default')" href="../../_variables/default.html">$default</a>&quot;;
<a name="l142"><span class="linenum"> 142</span></a>  
<a name="l143"><span class="linenum"> 143</span></a>              } else if (<a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('type')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> === 'tinyblob' or <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('type')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> === 'mediumblob' or <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('type')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/type.html">type</a> === 'blob') {
<a name="l144"><span class="linenum"> 144</span></a>                  <a class="var it7879" onMouseOver="hilite(7879)" onMouseOut="lolite()" onClick="logVariable('notnull')" href="../../_variables/notnull.html">$notnull</a> = (<a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('null')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/null.html">null</a> === 'NO') ? 'NOT NULL' : 'NULL';
<a name="l145"><span class="linenum"> 145</span></a>                  <a class="var it1163" onMouseOver="hilite(1163)" onMouseOut="lolite()" onClick="logVariable('default')" href="../../_variables/default.html">$default</a> = (!<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('default')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/default.html">default</a>) and <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('default')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/default.html">default</a> !== '') ? &quot;DEFAULT '<a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('default')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/default.html">default</a>'&quot; : '';
<a name="l146"><span class="linenum"> 146</span></a>  <span class="comment">                // Primary, unique and inc are not supported for blobs.</span>
<a name="l147"><span class="linenum"> 147</span></a>                  <a class="var it1822" onMouseOver="hilite(1822)" onMouseOut="lolite()" onClick="logVariable('changes')" href="../../_variables/changes.html">$changes</a>[] = &quot;MODIFY COLUMN `<a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('field')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/field.html">field</a>` LONGBLOB <a class="var it7879" onMouseOver="hilite(7879)" onMouseOut="lolite()" onClick="logVariable('notnull')" href="../../_variables/notnull.html">$notnull</a> <a class="var it1163" onMouseOver="hilite(1163)" onMouseOut="lolite()" onClick="logVariable('default')" href="../../_variables/default.html">$default</a>&quot;;
<a name="l148"><span class="linenum"> 148</span></a>              }
<a name="l149"><span class="linenum"> 149</span></a>  
<a name="l150"><span class="linenum"> 150</span></a>          }
<a name="l151"><span class="linenum"> 151</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l152"><span class="linenum"> 152</span></a>  
<a name="l153"><span class="linenum"> 153</span></a>          if (<a class="var it1822" onMouseOver="hilite(1822)" onMouseOut="lolite()" onClick="logVariable('changes')" href="../../_variables/changes.html">$changes</a>) {
<a name="l154"><span class="linenum"> 154</span></a>  <span class="comment">            // Set appropriate timeout - 1 minute per thousand of records should be enough, min 60 minutes just in case.</span>
<a name="l155"><span class="linenum"> 155</span></a>              <a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records')" href="../../_functions/count_records.html" onMouseOver="funcPopup(event,'count_records')">count_records</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, array());
<a name="l156"><span class="linenum"> 156</span></a>              <a class="var it353" onMouseOver="hilite(353)" onMouseOut="lolite()" onClick="logVariable('timeout')" href="../../_variables/timeout.html">$timeout</a> = (<a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a>/1000)*60;
<a name="l157"><span class="linenum"> 157</span></a>              <a class="var it353" onMouseOver="hilite(353)" onMouseOut="lolite()" onClick="logVariable('timeout')" href="../../_variables/timeout.html">$timeout</a> = (<a class="var it353" onMouseOver="hilite(353)" onMouseOut="lolite()" onClick="logVariable('timeout')" href="../../_variables/timeout.html">$timeout</a> &lt; 60*60) ? 60*60 : (int)<a class="var it353" onMouseOver="hilite(353)" onMouseOut="lolite()" onClick="logVariable('timeout')" href="../../_variables/timeout.html">$timeout</a>;
<a name="l158"><span class="linenum"> 158</span></a>              <a class="function" onClick="logFunction('upgrade_set_timeout')" href="../../_functions/upgrade_set_timeout.html" onMouseOver="funcPopup(event,'upgrade_set_timeout')">upgrade_set_timeout</a>(<a class="var it353" onMouseOver="hilite(353)" onMouseOut="lolite()" onClick="logVariable('timeout')" href="../../_variables/timeout.html">$timeout</a>);
<a name="l159"><span class="linenum"> 159</span></a>  
<a name="l160"><span class="linenum"> 160</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;ALTER TABLE `{<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../_variables/prefix.html">$prefix</a>}<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>` &quot;.<a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(', ', <a class="var it1822" onMouseOver="hilite(1822)" onMouseOut="lolite()" onClick="logVariable('changes')" href="../../_variables/changes.html">$changes</a>);
<a name="l161"><span class="linenum"> 161</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('change_database_structure')" href="../../_functions/change_database_structure.html" onMouseOver="funcPopup(event,'change_database_structure')">change_database_structure</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l162"><span class="linenum"> 162</span></a>          }
<a name="l163"><span class="linenum"> 163</span></a>  
<a name="l164"><span class="linenum"> 164</span></a>          <a class="var it8016" onMouseOver="hilite(8016)" onMouseOut="lolite()" onClick="logVariable('pbar')" href="../../_variables/pbar.html">$pbar</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>(<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>, <a class="var it21048" onMouseOver="hilite(21048)" onMouseOut="lolite()" onClick="logVariable('tablecount')" href="../../_variables/tablecount.html">$tablecount</a>, &quot;Converted unsigned/lob columns in MySQL database - <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>/<a class="var it21048" onMouseOver="hilite(21048)" onMouseOut="lolite()" onClick="logVariable('tablecount')" href="../../_variables/tablecount.html">$tablecount</a>.&quot;);
<a name="l165"><span class="linenum"> 165</span></a>      }
<a name="l166"><span class="linenum"> 166</span></a>  }
<a name="l167"><span class="linenum"> 167</span></a>  
<a name="l168"><span class="linenum"> 168</span></a>  <span class="comment">/**</span>
<a name="l169"><span class="linenum"> 169</span></a>  <span class="comment"> * Migrate NTEXT to NVARCHAR(MAX).</span>
<a name="l170"><span class="linenum"> 170</span></a>  <span class="comment"> */</span>
<a name="l171"><span class="linenum"> 171</span></a>  function <a class="function" onClick="logFunction('upgrade_mssql_nvarcharmax')" href="../../_functions/upgrade_mssql_nvarcharmax.html" onMouseOver="funcPopup(event,'upgrade_mssql_nvarcharmax')">upgrade_mssql_nvarcharmax</a>() {
<a name="l172"><span class="linenum"> 172</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l173"><span class="linenum"> 173</span></a>  
<a name="l174"><span class="linenum"> 174</span></a>      if (<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_dbfamily')" href="../../_functions/get_dbfamily.html" onMouseOver="funcPopup(event,'get_dbfamily')">get_dbfamily</a>() !== 'mssql') {
<a name="l175"><span class="linenum"> 175</span></a>          return;
<a name="l176"><span class="linenum"> 176</span></a>      }
<a name="l177"><span class="linenum"> 177</span></a>  
<a name="l178"><span class="linenum"> 178</span></a>      <a class="var it8016" onMouseOver="hilite(8016)" onMouseOut="lolite()" onClick="logVariable('pbar')" href="../../_variables/pbar.html">$pbar</a> = <span class="keyword">new </span><a class="class" onClick="logClass('progress_bar')" href="../../_classes/progress_bar.html" onMouseOver="classPopup(event,'progress_bar')">progress_bar</a>('mssqlconvertntext', 500, true);
<a name="l179"><span class="linenum"> 179</span></a>  
<a name="l180"><span class="linenum"> 180</span></a>      <a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../_variables/prefix.html">$prefix</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_prefix')" href="../../_functions/get_prefix.html" onMouseOver="funcPopup(event,'get_prefix')">get_prefix</a>();
<a name="l181"><span class="linenum"> 181</span></a>      <a class="var it448" onMouseOver="hilite(448)" onMouseOut="lolite()" onClick="logVariable('tables')" href="../../_variables/tables.html">$tables</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_tables')" href="../../_functions/get_tables.html" onMouseOver="funcPopup(event,'get_tables')">get_tables</a>(false);
<a name="l182"><span class="linenum"> 182</span></a>  
<a name="l183"><span class="linenum"> 183</span></a>      <a class="var it21048" onMouseOver="hilite(21048)" onMouseOut="lolite()" onClick="logVariable('tablecount')" href="../../_variables/tablecount.html">$tablecount</a> = <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it448" onMouseOver="hilite(448)" onMouseOut="lolite()" onClick="logVariable('tables')" href="../../_variables/tables.html">$tables</a>);
<a name="l184"><span class="linenum"> 184</span></a>      <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> = 0;
<a name="l185"><span class="linenum"> 185</span></a>      foreach (<a class="var it448" onMouseOver="hilite(448)" onMouseOut="lolite()" onClick="logVariable('tables')" href="../../_variables/tables.html">$tables</a> as <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>) {
<a name="l186"><span class="linenum"> 186</span></a>          <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>++;
<a name="l187"><span class="linenum"> 187</span></a>  
<a name="l188"><span class="linenum"> 188</span></a>          <a class="var it1020" onMouseOver="hilite(1020)" onMouseOut="lolite()" onClick="logVariable('columns')" href="../../_variables/columns.html">$columns</a> = array();
<a name="l189"><span class="linenum"> 189</span></a>  
<a name="l190"><span class="linenum"> 190</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT column_name
<a name="l191"><span class="linenum"> 191</span></a>                    FROM INFORMATION_SCHEMA.COLUMNS
<a name="l192"><span class="linenum"> 192</span></a>                   WHERE table_name = '{{<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>}}' AND <a class="function" onClick="logFunction('UPPER')" href="../../_functions/upper.html" onMouseOver="funcPopup(event,'upper')">UPPER</a>(data_type) = 'NTEXT'&quot;;
<a name="l193"><span class="linenum"> 193</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l194"><span class="linenum"> 194</span></a>          foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>) {
<a name="l195"><span class="linenum"> 195</span></a>              <a class="var it1020" onMouseOver="hilite(1020)" onMouseOut="lolite()" onClick="logVariable('columns')" href="../../_variables/columns.html">$columns</a>[] = <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('column_name')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/column_name.html">column_name</a>;
<a name="l196"><span class="linenum"> 196</span></a>          }
<a name="l197"><span class="linenum"> 197</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l198"><span class="linenum"> 198</span></a>  
<a name="l199"><span class="linenum"> 199</span></a>          if (<a class="var it1020" onMouseOver="hilite(1020)" onMouseOut="lolite()" onClick="logVariable('columns')" href="../../_variables/columns.html">$columns</a>) {
<a name="l200"><span class="linenum"> 200</span></a>  <span class="comment">            // Set appropriate timeout - 1 minute per thousand of records should be enough, min 60 minutes just in case.</span>
<a name="l201"><span class="linenum"> 201</span></a>              <a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records')" href="../../_functions/count_records.html" onMouseOver="funcPopup(event,'count_records')">count_records</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, array());
<a name="l202"><span class="linenum"> 202</span></a>              <a class="var it353" onMouseOver="hilite(353)" onMouseOut="lolite()" onClick="logVariable('timeout')" href="../../_variables/timeout.html">$timeout</a> = (<a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a>/1000)*60;
<a name="l203"><span class="linenum"> 203</span></a>              <a class="var it353" onMouseOver="hilite(353)" onMouseOut="lolite()" onClick="logVariable('timeout')" href="../../_variables/timeout.html">$timeout</a> = (<a class="var it353" onMouseOver="hilite(353)" onMouseOut="lolite()" onClick="logVariable('timeout')" href="../../_variables/timeout.html">$timeout</a> &lt; 60*60) ? 60*60 : (int)<a class="var it353" onMouseOver="hilite(353)" onMouseOut="lolite()" onClick="logVariable('timeout')" href="../../_variables/timeout.html">$timeout</a>;
<a name="l204"><span class="linenum"> 204</span></a>              <a class="function" onClick="logFunction('upgrade_set_timeout')" href="../../_functions/upgrade_set_timeout.html" onMouseOver="funcPopup(event,'upgrade_set_timeout')">upgrade_set_timeout</a>(<a class="var it353" onMouseOver="hilite(353)" onMouseOut="lolite()" onClick="logVariable('timeout')" href="../../_variables/timeout.html">$timeout</a>);
<a name="l205"><span class="linenum"> 205</span></a>  
<a name="l206"><span class="linenum"> 206</span></a>              <a class="var it1814" onMouseOver="hilite(1814)" onMouseOut="lolite()" onClick="logVariable('updates')" href="../../_variables/updates.html">$updates</a> = array();
<a name="l207"><span class="linenum"> 207</span></a>              foreach (<a class="var it1020" onMouseOver="hilite(1020)" onMouseOut="lolite()" onClick="logVariable('columns')" href="../../_variables/columns.html">$columns</a> as <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>) {
<a name="l208"><span class="linenum"> 208</span></a>  <span class="comment">                // Change the definition.</span>
<a name="l209"><span class="linenum"> 209</span></a>                  <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;ALTER TABLE {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../_variables/prefix.html">$prefix</a>}<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> ALTER COLUMN <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a> NVARCHAR(MAX)&quot;;
<a name="l210"><span class="linenum"> 210</span></a>                  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('change_database_structure')" href="../../_functions/change_database_structure.html" onMouseOver="funcPopup(event,'change_database_structure')">change_database_structure</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l211"><span class="linenum"> 211</span></a>                  <a class="var it1814" onMouseOver="hilite(1814)" onMouseOut="lolite()" onClick="logVariable('updates')" href="../../_variables/updates.html">$updates</a>[] = &quot;<a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a> = <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>&quot;;
<a name="l212"><span class="linenum"> 212</span></a>              }
<a name="l213"><span class="linenum"> 213</span></a>  
<a name="l214"><span class="linenum"> 214</span></a>  <span class="comment">            // Now force the migration of text data to new optimised storage.</span>
<a name="l215"><span class="linenum"> 215</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;UPDATE {{<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>}} SET &quot;.<a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(', ', <a class="var it1814" onMouseOver="hilite(1814)" onMouseOut="lolite()" onClick="logVariable('updates')" href="../../_variables/updates.html">$updates</a>);
<a name="l216"><span class="linenum"> 216</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l217"><span class="linenum"> 217</span></a>          }
<a name="l218"><span class="linenum"> 218</span></a>  
<a name="l219"><span class="linenum"> 219</span></a>          <a class="var it8016" onMouseOver="hilite(8016)" onMouseOut="lolite()" onClick="logVariable('pbar')" href="../../_variables/pbar.html">$pbar</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>(<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>, <a class="var it21048" onMouseOver="hilite(21048)" onMouseOut="lolite()" onClick="logVariable('tablecount')" href="../../_variables/tablecount.html">$tablecount</a>, &quot;Converted NTEXT to NVARCHAR(MAX) columns in MS SQL Server database - <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>/<a class="var it21048" onMouseOver="hilite(21048)" onMouseOut="lolite()" onClick="logVariable('tablecount')" href="../../_variables/tablecount.html">$tablecount</a>.&quot;);
<a name="l220"><span class="linenum"> 220</span></a>      }
<a name="l221"><span class="linenum"> 221</span></a>  }
<a name="l222"><span class="linenum"> 222</span></a>  
<a name="l223"><span class="linenum"> 223</span></a>  <span class="comment">/**</span>
<a name="l224"><span class="linenum"> 224</span></a>  <span class="comment"> * Migrate IMAGE to VARBINARY(MAX).</span>
<a name="l225"><span class="linenum"> 225</span></a>  <span class="comment"> */</span>
<a name="l226"><span class="linenum"> 226</span></a>  function <a class="function" onClick="logFunction('upgrade_mssql_varbinarymax')" href="../../_functions/upgrade_mssql_varbinarymax.html" onMouseOver="funcPopup(event,'upgrade_mssql_varbinarymax')">upgrade_mssql_varbinarymax</a>() {
<a name="l227"><span class="linenum"> 227</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l228"><span class="linenum"> 228</span></a>  
<a name="l229"><span class="linenum"> 229</span></a>      if (<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_dbfamily')" href="../../_functions/get_dbfamily.html" onMouseOver="funcPopup(event,'get_dbfamily')">get_dbfamily</a>() !== 'mssql') {
<a name="l230"><span class="linenum"> 230</span></a>          return;
<a name="l231"><span class="linenum"> 231</span></a>      }
<a name="l232"><span class="linenum"> 232</span></a>  
<a name="l233"><span class="linenum"> 233</span></a>      <a class="var it8016" onMouseOver="hilite(8016)" onMouseOut="lolite()" onClick="logVariable('pbar')" href="../../_variables/pbar.html">$pbar</a> = <span class="keyword">new </span><a class="class" onClick="logClass('progress_bar')" href="../../_classes/progress_bar.html" onMouseOver="classPopup(event,'progress_bar')">progress_bar</a>('mssqlconvertimage', 500, true);
<a name="l234"><span class="linenum"> 234</span></a>  
<a name="l235"><span class="linenum"> 235</span></a>      <a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../_variables/prefix.html">$prefix</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_prefix')" href="../../_functions/get_prefix.html" onMouseOver="funcPopup(event,'get_prefix')">get_prefix</a>();
<a name="l236"><span class="linenum"> 236</span></a>      <a class="var it448" onMouseOver="hilite(448)" onMouseOut="lolite()" onClick="logVariable('tables')" href="../../_variables/tables.html">$tables</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_tables')" href="../../_functions/get_tables.html" onMouseOver="funcPopup(event,'get_tables')">get_tables</a>(false);
<a name="l237"><span class="linenum"> 237</span></a>  
<a name="l238"><span class="linenum"> 238</span></a>      <a class="var it21048" onMouseOver="hilite(21048)" onMouseOut="lolite()" onClick="logVariable('tablecount')" href="../../_variables/tablecount.html">$tablecount</a> = <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it448" onMouseOver="hilite(448)" onMouseOut="lolite()" onClick="logVariable('tables')" href="../../_variables/tables.html">$tables</a>);
<a name="l239"><span class="linenum"> 239</span></a>      <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> = 0;
<a name="l240"><span class="linenum"> 240</span></a>      foreach (<a class="var it448" onMouseOver="hilite(448)" onMouseOut="lolite()" onClick="logVariable('tables')" href="../../_variables/tables.html">$tables</a> as <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>) {
<a name="l241"><span class="linenum"> 241</span></a>          <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>++;
<a name="l242"><span class="linenum"> 242</span></a>  
<a name="l243"><span class="linenum"> 243</span></a>          <a class="var it1020" onMouseOver="hilite(1020)" onMouseOut="lolite()" onClick="logVariable('columns')" href="../../_variables/columns.html">$columns</a> = array();
<a name="l244"><span class="linenum"> 244</span></a>  
<a name="l245"><span class="linenum"> 245</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT column_name
<a name="l246"><span class="linenum"> 246</span></a>                    FROM INFORMATION_SCHEMA.COLUMNS
<a name="l247"><span class="linenum"> 247</span></a>                   WHERE table_name = '{{<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>}}' AND <a class="function" onClick="logFunction('UPPER')" href="../../_functions/upper.html" onMouseOver="funcPopup(event,'upper')">UPPER</a>(data_type) = 'IMAGE'&quot;;
<a name="l248"><span class="linenum"> 248</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l249"><span class="linenum"> 249</span></a>          foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>) {
<a name="l250"><span class="linenum"> 250</span></a>              <a class="var it1020" onMouseOver="hilite(1020)" onMouseOut="lolite()" onClick="logVariable('columns')" href="../../_variables/columns.html">$columns</a>[] = <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>-&gt;<a onClick="logVariable('column_name')" class="var it40145" onMouseOver="hilite(40145)" onMouseOut="lolite()" href="../../_variables/column_name.html">column_name</a>;
<a name="l251"><span class="linenum"> 251</span></a>          }
<a name="l252"><span class="linenum"> 252</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l253"><span class="linenum"> 253</span></a>  
<a name="l254"><span class="linenum"> 254</span></a>          if (<a class="var it1020" onMouseOver="hilite(1020)" onMouseOut="lolite()" onClick="logVariable('columns')" href="../../_variables/columns.html">$columns</a>) {
<a name="l255"><span class="linenum"> 255</span></a>  <span class="comment">            // Set appropriate timeout - 1 minute per thousand of records should be enough, min 60 minutes just in case.</span>
<a name="l256"><span class="linenum"> 256</span></a>              <a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records')" href="../../_functions/count_records.html" onMouseOver="funcPopup(event,'count_records')">count_records</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, array());
<a name="l257"><span class="linenum"> 257</span></a>              <a class="var it353" onMouseOver="hilite(353)" onMouseOut="lolite()" onClick="logVariable('timeout')" href="../../_variables/timeout.html">$timeout</a> = (<a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a>/1000)*60;
<a name="l258"><span class="linenum"> 258</span></a>              <a class="var it353" onMouseOver="hilite(353)" onMouseOut="lolite()" onClick="logVariable('timeout')" href="../../_variables/timeout.html">$timeout</a> = (<a class="var it353" onMouseOver="hilite(353)" onMouseOut="lolite()" onClick="logVariable('timeout')" href="../../_variables/timeout.html">$timeout</a> &lt; 60*60) ? 60*60 : (int)<a class="var it353" onMouseOver="hilite(353)" onMouseOut="lolite()" onClick="logVariable('timeout')" href="../../_variables/timeout.html">$timeout</a>;
<a name="l259"><span class="linenum"> 259</span></a>              <a class="function" onClick="logFunction('upgrade_set_timeout')" href="../../_functions/upgrade_set_timeout.html" onMouseOver="funcPopup(event,'upgrade_set_timeout')">upgrade_set_timeout</a>(<a class="var it353" onMouseOver="hilite(353)" onMouseOut="lolite()" onClick="logVariable('timeout')" href="../../_variables/timeout.html">$timeout</a>);
<a name="l260"><span class="linenum"> 260</span></a>  
<a name="l261"><span class="linenum"> 261</span></a>              foreach (<a class="var it1020" onMouseOver="hilite(1020)" onMouseOut="lolite()" onClick="logVariable('columns')" href="../../_variables/columns.html">$columns</a> as <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a>) {
<a name="l262"><span class="linenum"> 262</span></a>  <span class="comment">                // Change the definition.</span>
<a name="l263"><span class="linenum"> 263</span></a>                  <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;ALTER TABLE {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../_variables/prefix.html">$prefix</a>}<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> ALTER COLUMN <a class="var it1466" onMouseOver="hilite(1466)" onMouseOut="lolite()" onClick="logVariable('column')" href="../../_variables/column.html">$column</a> VARBINARY(MAX)&quot;;
<a name="l264"><span class="linenum"> 264</span></a>                  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('change_database_structure')" href="../../_functions/change_database_structure.html" onMouseOver="funcPopup(event,'change_database_structure')">change_database_structure</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l265"><span class="linenum"> 265</span></a>              }
<a name="l266"><span class="linenum"> 266</span></a>  
<a name="l267"><span class="linenum"> 267</span></a>  <span class="comment">            // Binary columns should not be used, do not waste time optimising the storage.</span>
<a name="l268"><span class="linenum"> 268</span></a>          }
<a name="l269"><span class="linenum"> 269</span></a>  
<a name="l270"><span class="linenum"> 270</span></a>          <a class="var it8016" onMouseOver="hilite(8016)" onMouseOut="lolite()" onClick="logVariable('pbar')" href="../../_variables/pbar.html">$pbar</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>(<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>, <a class="var it21048" onMouseOver="hilite(21048)" onMouseOut="lolite()" onClick="logVariable('tablecount')" href="../../_variables/tablecount.html">$tablecount</a>, &quot;Converted IMAGE to VARBINARY(MAX) columns in MS SQL Server database - <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>/<a class="var it21048" onMouseOver="hilite(21048)" onMouseOut="lolite()" onClick="logVariable('tablecount')" href="../../_variables/tablecount.html">$tablecount</a>.&quot;);
<a name="l271"><span class="linenum"> 271</span></a>      }
<a name="l272"><span class="linenum"> 272</span></a>  }
<a name="l273"><span class="linenum"> 273</span></a>  
<a name="l274"><span class="linenum"> 274</span></a>  <span class="comment">/**</span>
<a name="l275"><span class="linenum"> 275</span></a>  <span class="comment"> * This upgrade script fixes the mismatches between DB fields course_modules.section</span>
<a name="l276"><span class="linenum"> 276</span></a>  <span class="comment"> * and course_sections.sequence. It makes sure that each module is included</span>
<a name="l277"><span class="linenum"> 277</span></a>  <span class="comment"> * in the sequence of at least one section.</span>
<a name="l278"><span class="linenum"> 278</span></a>  <span class="comment"> * Note that this script is different from admin/cli/fix_course_sortorder.php</span>
<a name="l279"><span class="linenum"> 279</span></a>  <span class="comment"> * in the following ways:</span>
<a name="l280"><span class="linenum"> 280</span></a>  <span class="comment"> * 1. It does not fix the cases when module appears several times in section(s) sequence(s) -</span>
<a name="l281"><span class="linenum"> 281</span></a>  <span class="comment"> *    it will be done automatically on the next viewing of the course.</span>
<a name="l282"><span class="linenum"> 282</span></a>  <span class="comment"> * 2. It does not remove non-existing modules from section sequences - administrator</span>
<a name="l283"><span class="linenum"> 283</span></a>  <span class="comment"> *    has to run the CLI script to do it.</span>
<a name="l284"><span class="linenum"> 284</span></a>  <span class="comment"> * 3. When this script finds an orphaned module it adds it to the section but makes hidden</span>
<a name="l285"><span class="linenum"> 285</span></a>  <span class="comment"> *    where CLI script does not change the visiblity specified in the course_modules table.</span>
<a name="l286"><span class="linenum"> 286</span></a>  <span class="comment"> */</span>
<a name="l287"><span class="linenum"> 287</span></a>  function <a class="function" onClick="logFunction('upgrade_course_modules_sequences')" href="../../_functions/upgrade_course_modules_sequences.html" onMouseOver="funcPopup(event,'upgrade_course_modules_sequences')">upgrade_course_modules_sequences</a>() {
<a name="l288"><span class="linenum"> 288</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l289"><span class="linenum"> 289</span></a>  
<a name="l290"><span class="linenum"> 290</span></a>  <span class="comment">    // Find all modules that point to the section which does not point back to this module.</span>
<a name="l291"><span class="linenum"> 291</span></a>      <a class="var it21051" onMouseOver="hilite(21051)" onMouseOut="lolite()" onClick="logVariable('sequenceconcat')" href="../../_variables/sequenceconcat.html">$sequenceconcat</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_concat')" href="../../_functions/sql_concat.html" onMouseOver="funcPopup(event,'sql_concat')">sql_concat</a>(&quot;','&quot;, &quot;s.sequence&quot;, &quot;','&quot;);
<a name="l292"><span class="linenum"> 292</span></a>      <a class="var it21052" onMouseOver="hilite(21052)" onMouseOut="lolite()" onClick="logVariable('moduleconcat')" href="../../_variables/moduleconcat.html">$moduleconcat</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_concat')" href="../../_functions/sql_concat.html" onMouseOver="funcPopup(event,'sql_concat')">sql_concat</a>(&quot;'%,'&quot;, &quot;m.id&quot;, &quot;',%'&quot;);
<a name="l293"><span class="linenum"> 293</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT m.id, m.course, m.section, s.sequence
<a name="l294"><span class="linenum"> 294</span></a>          FROM {course_modules} m LEFT OUTER JOIN {course_sections} s
<a name="l295"><span class="linenum"> 295</span></a>          ON m.course = s.course and m.section = s.id
<a name="l296"><span class="linenum"> 296</span></a>          WHERE s.sequence IS NULL <a class="function" onClick="logFunction('OR')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (<a class="var it21051" onMouseOver="hilite(21051)" onMouseOut="lolite()" onClick="logVariable('sequenceconcat')" href="../../_variables/sequenceconcat.html">$sequenceconcat</a> NOT LIKE <a class="var it21052" onMouseOver="hilite(21052)" onMouseOut="lolite()" onClick="logVariable('moduleconcat')" href="../../_variables/moduleconcat.html">$moduleconcat</a>)
<a name="l297"><span class="linenum"> 297</span></a>          ORDER BY m.course&quot;;
<a name="l298"><span class="linenum"> 298</span></a>      <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l299"><span class="linenum"> 299</span></a>      <a class="var it5171" onMouseOver="hilite(5171)" onMouseOut="lolite()" onClick="logVariable('sections')" href="../../_variables/sections.html">$sections</a> = null;
<a name="l300"><span class="linenum"> 300</span></a>      foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>) {
<a name="l301"><span class="linenum"> 301</span></a>          if (!isset(<a class="var it5171" onMouseOver="hilite(5171)" onMouseOut="lolite()" onClick="logVariable('sections')" href="../../_variables/sections.html">$sections</a>[<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('course')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>])) {
<a name="l302"><span class="linenum"> 302</span></a>  <span class="comment">            // Retrieve all sections for the course (only once for each corrupt course).</span>
<a name="l303"><span class="linenum"> 303</span></a>              <a class="var it5171" onMouseOver="hilite(5171)" onMouseOut="lolite()" onClick="logVariable('sections')" href="../../_variables/sections.html">$sections</a> = array(<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('course')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/course.html">course</a> =&gt;
<a name="l304"><span class="linenum"> 304</span></a>                      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('course_sections', array('course' =&gt; <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('course')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>),
<a name="l305"><span class="linenum"> 305</span></a>                              'section', 'id, section, sequence, visible'));
<a name="l306"><span class="linenum"> 306</span></a>              if (empty(<a class="var it5171" onMouseOver="hilite(5171)" onMouseOut="lolite()" onClick="logVariable('sections')" href="../../_variables/sections.html">$sections</a>[<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('course')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>])) {
<a name="l307"><span class="linenum"> 307</span></a>  <span class="comment">                // Very odd - the course has a module in it but has no sections. Create 0-section.</span>
<a name="l308"><span class="linenum"> 308</span></a>                  <a class="var it8343" onMouseOver="hilite(8343)" onMouseOut="lolite()" onClick="logVariable('newsection')" href="../../_variables/newsection.html">$newsection</a> = array('sequence' =&gt; '', 'section' =&gt; 0, 'visible' =&gt; 1);
<a name="l309"><span class="linenum"> 309</span></a>                  <a class="var it8343" onMouseOver="hilite(8343)" onMouseOut="lolite()" onClick="logVariable('newsection')" href="../../_variables/newsection.html">$newsection</a>['id'] = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('course_sections',
<a name="l310"><span class="linenum"> 310</span></a>                          <a class="var it8343" onMouseOver="hilite(8343)" onMouseOut="lolite()" onClick="logVariable('newsection')" href="../../_variables/newsection.html">$newsection</a> + array('course' =&gt; <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('course')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>, 'summary' =&gt; '', 'summaryformat' =&gt; <a class="constant" onClick="logConstant('FORMAT_HTML')" href="../../_constants/FORMAT_HTML.html" onMouseOver="constPopup(event,'FORMAT_HTML')">FORMAT_HTML</a>));
<a name="l311"><span class="linenum"> 311</span></a>                  <a class="var it5171" onMouseOver="hilite(5171)" onMouseOut="lolite()" onClick="logVariable('sections')" href="../../_variables/sections.html">$sections</a>[<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('course')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>] = array(<a class="var it8343" onMouseOver="hilite(8343)" onMouseOut="lolite()" onClick="logVariable('newsection')" href="../../_variables/newsection.html">$newsection</a>['id'] =&gt; (object)<a class="var it8343" onMouseOver="hilite(8343)" onMouseOut="lolite()" onClick="logVariable('newsection')" href="../../_variables/newsection.html">$newsection</a>);
<a name="l312"><span class="linenum"> 312</span></a>              }
<a name="l313"><span class="linenum"> 313</span></a>          }
<a name="l314"><span class="linenum"> 314</span></a>  <span class="comment">        // Attempt to find the section that has this module in it's sequence.</span>
<a name="l315"><span class="linenum"> 315</span></a>  <span class="comment">        // If there are several of them, pick the last because this is what get_fast_modinfo() does.</span>
<a name="l316"><span class="linenum"> 316</span></a>          <a class="var it556" onMouseOver="hilite(556)" onMouseOut="lolite()" onClick="logVariable('sectionid')" href="../../_variables/sectionid.html">$sectionid</a> = null;
<a name="l317"><span class="linenum"> 317</span></a>          foreach (<a class="var it5171" onMouseOver="hilite(5171)" onMouseOut="lolite()" onClick="logVariable('sections')" href="../../_variables/sections.html">$sections</a>[<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('course')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>] as <a class="var it15" onMouseOver="hilite(15)" onMouseOut="lolite()" onClick="logVariable('section')" href="../../_variables/section.html">$section</a>) {
<a name="l318"><span class="linenum"> 318</span></a>              if (!empty(<a class="var it15" onMouseOver="hilite(15)" onMouseOut="lolite()" onClick="logVariable('section')" href="../../_variables/section.html">$section</a>-&gt;<a onClick="logVariable('sequence')" class="var it39560" onMouseOver="hilite(39560)" onMouseOut="lolite()" href="../../_variables/sequence.html">sequence</a>) &amp;&amp; <a class="phpfunction" onClick="logFunction('in_array')" href="../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="phpfunction" onClick="logFunction('preg_split')" href="../../_functions/preg_split.html" onMouseOver="phpfuncPopup(event,'preg_split')">preg_split</a>('/,/', <a class="var it15" onMouseOver="hilite(15)" onMouseOut="lolite()" onClick="logVariable('section')" href="../../_variables/section.html">$section</a>-&gt;<a onClick="logVariable('sequence')" class="var it39560" onMouseOver="hilite(39560)" onMouseOut="lolite()" href="../../_variables/sequence.html">sequence</a>))) {
<a name="l319"><span class="linenum"> 319</span></a>                  <a class="var it556" onMouseOver="hilite(556)" onMouseOut="lolite()" onClick="logVariable('sectionid')" href="../../_variables/sectionid.html">$sectionid</a> = <a class="var it15" onMouseOver="hilite(15)" onMouseOut="lolite()" onClick="logVariable('section')" href="../../_variables/section.html">$section</a>-&gt;<a onClick="logVariable('id')" class="var it39560" onMouseOver="hilite(39560)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l320"><span class="linenum"> 320</span></a>              }
<a name="l321"><span class="linenum"> 321</span></a>          }
<a name="l322"><span class="linenum"> 322</span></a>          if (<a class="var it556" onMouseOver="hilite(556)" onMouseOut="lolite()" onClick="logVariable('sectionid')" href="../../_variables/sectionid.html">$sectionid</a>) {
<a name="l323"><span class="linenum"> 323</span></a>  <span class="comment">            // Found the section. Update course_module to point to the correct section.</span>
<a name="l324"><span class="linenum"> 324</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('id' =&gt; <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'section' =&gt; <a class="var it556" onMouseOver="hilite(556)" onMouseOut="lolite()" onClick="logVariable('sectionid')" href="../../_variables/sectionid.html">$sectionid</a>);
<a name="l325"><span class="linenum"> 325</span></a>              if (!<a class="var it5171" onMouseOver="hilite(5171)" onMouseOut="lolite()" onClick="logVariable('sections')" href="../../_variables/sections.html">$sections</a>[<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('course')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>][<a class="var it556" onMouseOver="hilite(556)" onMouseOut="lolite()" onClick="logVariable('sectionid')" href="../../_variables/sectionid.html">$sectionid</a>]-&gt;visible) {
<a name="l326"><span class="linenum"> 326</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['visible'] = 0;
<a name="l327"><span class="linenum"> 327</span></a>              }
<a name="l328"><span class="linenum"> 328</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('course_modules', <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l329"><span class="linenum"> 329</span></a>          } else {
<a name="l330"><span class="linenum"> 330</span></a>  <span class="comment">            // No section in the course has this module in it's sequence.</span>
<a name="l331"><span class="linenum"> 331</span></a>              if (isset(<a class="var it5171" onMouseOver="hilite(5171)" onMouseOut="lolite()" onClick="logVariable('sections')" href="../../_variables/sections.html">$sections</a>[<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('course')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>][<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('section')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/section.html">section</a>])) {
<a name="l332"><span class="linenum"> 332</span></a>  <span class="comment">                // Try to add module to the section it points to (if it is valid).</span>
<a name="l333"><span class="linenum"> 333</span></a>                  <a class="var it556" onMouseOver="hilite(556)" onMouseOut="lolite()" onClick="logVariable('sectionid')" href="../../_variables/sectionid.html">$sectionid</a> = <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('section')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/section.html">section</a>;
<a name="l334"><span class="linenum"> 334</span></a>              } else {
<a name="l335"><span class="linenum"> 335</span></a>  <span class="comment">                // Section not found. Just add to the first available section.</span>
<a name="l336"><span class="linenum"> 336</span></a>                  <a class="phpfunction" onClick="logFunction('reset')" href="../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it5171" onMouseOver="hilite(5171)" onMouseOut="lolite()" onClick="logVariable('sections')" href="../../_variables/sections.html">$sections</a>[<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('course')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>]);
<a name="l337"><span class="linenum"> 337</span></a>                  <a class="var it556" onMouseOver="hilite(556)" onMouseOut="lolite()" onClick="logVariable('sectionid')" href="../../_variables/sectionid.html">$sectionid</a> = <a class="phpfunction" onClick="logFunction('key')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">key</a>(<a class="var it5171" onMouseOver="hilite(5171)" onMouseOut="lolite()" onClick="logVariable('sections')" href="../../_variables/sections.html">$sections</a>[<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('course')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>]);
<a name="l338"><span class="linenum"> 338</span></a>              }
<a name="l339"><span class="linenum"> 339</span></a>              <a class="var it5022" onMouseOver="hilite(5022)" onMouseOut="lolite()" onClick="logVariable('newsequence')" href="../../_variables/newsequence.html">$newsequence</a> = <a class="phpfunction" onClick="logFunction('ltrim')" href="../../_functions/ltrim.html" onMouseOver="phpfuncPopup(event,'ltrim')">ltrim</a>(<a class="var it5171" onMouseOver="hilite(5171)" onMouseOut="lolite()" onClick="logVariable('sections')" href="../../_variables/sections.html">$sections</a>[<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('course')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>][<a class="var it556" onMouseOver="hilite(556)" onMouseOut="lolite()" onClick="logVariable('sectionid')" href="../../_variables/sectionid.html">$sectionid</a>]-&gt;sequence . ',' . <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, ',');
<a name="l340"><span class="linenum"> 340</span></a>              <a class="var it5171" onMouseOver="hilite(5171)" onMouseOut="lolite()" onClick="logVariable('sections')" href="../../_variables/sections.html">$sections</a>[<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('course')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>][<a class="var it556" onMouseOver="hilite(556)" onMouseOut="lolite()" onClick="logVariable('sectionid')" href="../../_variables/sectionid.html">$sectionid</a>]-&gt;sequence = <a class="var it5022" onMouseOver="hilite(5022)" onMouseOut="lolite()" onClick="logVariable('newsequence')" href="../../_variables/newsequence.html">$newsequence</a>;
<a name="l341"><span class="linenum"> 341</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('course_sections', array('id' =&gt; <a class="var it556" onMouseOver="hilite(556)" onMouseOut="lolite()" onClick="logVariable('sectionid')" href="../../_variables/sectionid.html">$sectionid</a>, 'sequence' =&gt; <a class="var it5022" onMouseOver="hilite(5022)" onMouseOut="lolite()" onClick="logVariable('newsequence')" href="../../_variables/newsequence.html">$newsequence</a>));
<a name="l342"><span class="linenum"> 342</span></a>  <span class="comment">            // Make module invisible because it was not displayed at all before this upgrade script.</span>
<a name="l343"><span class="linenum"> 343</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('course_modules', array('id' =&gt; <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'section' =&gt; <a class="var it556" onMouseOver="hilite(556)" onMouseOut="lolite()" onClick="logVariable('sectionid')" href="../../_variables/sectionid.html">$sectionid</a>, 'visible' =&gt; 0, 'visibleold' =&gt; 0));
<a name="l344"><span class="linenum"> 344</span></a>          }
<a name="l345"><span class="linenum"> 345</span></a>      }
<a name="l346"><span class="linenum"> 346</span></a>      <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l347"><span class="linenum"> 347</span></a>      unset(<a class="var it5171" onMouseOver="hilite(5171)" onMouseOut="lolite()" onClick="logVariable('sections')" href="../../_variables/sections.html">$sections</a>);
<a name="l348"><span class="linenum"> 348</span></a>  
<a name="l349"><span class="linenum"> 349</span></a>  <span class="comment">    // Note that we don't need to reset course cache here because it is reset automatically after upgrade.</span>
<a name="l350"><span class="linenum"> 350</span></a>  }
<a name="l351"><span class="linenum"> 351</span></a>  
<a name="l352"><span class="linenum"> 352</span></a>  <span class="comment">/**</span>
<a name="l353"><span class="linenum"> 353</span></a>  <span class="comment"> * Updates a single item (course module or course section) to transfer the</span>
<a name="l354"><span class="linenum"> 354</span></a>  <span class="comment"> * availability settings from the old to the new format.</span>
<a name="l355"><span class="linenum"> 355</span></a>  <span class="comment"> *</span>
<a name="l356"><span class="linenum"> 356</span></a>  <span class="comment"> * Note: We do not convert groupmembersonly for modules at present. If we did,</span>
<a name="l357"><span class="linenum"> 357</span></a>  <span class="comment"> * $groupmembersonly would be set to the groupmembersonly option for the</span>
<a name="l358"><span class="linenum"> 358</span></a>  <span class="comment"> * module. Since we don't, it will be set to 0 for modules, and 1 for sections</span>
<a name="l359"><span class="linenum"> 359</span></a>  <span class="comment"> * if they have a grouping.</span>
<a name="l360"><span class="linenum"> 360</span></a>  <span class="comment"> *</span>
<a name="l361"><span class="linenum"> 361</span></a>  <span class="comment"> * @param int $groupmembersonly 1 if activity has groupmembersonly option</span>
<a name="l362"><span class="linenum"> 362</span></a>  <span class="comment"> * @param int $groupingid Grouping id (0 = none)</span>
<a name="l363"><span class="linenum"> 363</span></a>  <span class="comment"> * @param int $availablefrom Available from time (0 = none)</span>
<a name="l364"><span class="linenum"> 364</span></a>  <span class="comment"> * @param int $availableuntil Available until time (0 = none)</span>
<a name="l365"><span class="linenum"> 365</span></a>  <span class="comment"> * @param int $showavailability Show availability (1) or hide activity entirely</span>
<a name="l366"><span class="linenum"> 366</span></a>  <span class="comment"> * @param array $availrecs Records from course_modules/sections_availability</span>
<a name="l367"><span class="linenum"> 367</span></a>  <span class="comment"> * @param array $fieldrecs Records from course_modules/sections_avail_fields</span>
<a name="l368"><span class="linenum"> 368</span></a>  <span class="comment"> */</span>
<a name="l369"><span class="linenum"> 369</span></a>  function <a class="function" onClick="logFunction('upgrade_availability_item')" href="../../_functions/upgrade_availability_item.html" onMouseOver="funcPopup(event,'upgrade_availability_item')">upgrade_availability_item</a>(<a class="var it6613" onMouseOver="hilite(6613)" onMouseOut="lolite()" onClick="logVariable('groupmembersonly')" href="../../_variables/groupmembersonly.html">$groupmembersonly</a>, <a class="var it4042" onMouseOver="hilite(4042)" onMouseOut="lolite()" onClick="logVariable('groupingid')" href="../../_variables/groupingid.html">$groupingid</a>,
<a name="l370"><span class="linenum"> 370</span></a>          <a class="var it19696" onMouseOver="hilite(19696)" onMouseOut="lolite()" onClick="logVariable('availablefrom')" href="../../_variables/availablefrom.html">$availablefrom</a>, <a class="var it19697" onMouseOver="hilite(19697)" onMouseOut="lolite()" onClick="logVariable('availableuntil')" href="../../_variables/availableuntil.html">$availableuntil</a>, <a class="var it17269" onMouseOver="hilite(17269)" onMouseOut="lolite()" onClick="logVariable('showavailability')" href="../../_variables/showavailability.html">$showavailability</a>,
<a name="l371"><span class="linenum"> 371</span></a>          array <a class="var it21053" onMouseOver="hilite(21053)" onMouseOut="lolite()" onClick="logVariable('availrecs')" href="../../_variables/availrecs.html">$availrecs</a>, array <a class="var it21054" onMouseOver="hilite(21054)" onMouseOut="lolite()" onClick="logVariable('fieldrecs')" href="../../_variables/fieldrecs.html">$fieldrecs</a>) {
<a name="l372"><span class="linenum"> 372</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l373"><span class="linenum"> 373</span></a>      <a class="var it3183" onMouseOver="hilite(3183)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a> = array();
<a name="l374"><span class="linenum"> 374</span></a>      <a class="var it19698" onMouseOver="hilite(19698)" onMouseOut="lolite()" onClick="logVariable('shows')" href="../../_variables/shows.html">$shows</a> = array();
<a name="l375"><span class="linenum"> 375</span></a>  
<a name="l376"><span class="linenum"> 376</span></a>  <span class="comment">    // Group members only condition (if enabled).</span>
<a name="l377"><span class="linenum"> 377</span></a>      if (<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enablegroupmembersonly')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/enablegroupmembersonly.html">enablegroupmembersonly</a> &amp;&amp; <a class="var it6613" onMouseOver="hilite(6613)" onMouseOut="lolite()" onClick="logVariable('groupmembersonly')" href="../../_variables/groupmembersonly.html">$groupmembersonly</a>) {
<a name="l378"><span class="linenum"> 378</span></a>          if (<a class="var it4042" onMouseOver="hilite(4042)" onMouseOut="lolite()" onClick="logVariable('groupingid')" href="../../_variables/groupingid.html">$groupingid</a>) {
<a name="l379"><span class="linenum"> 379</span></a>              <a class="var it3183" onMouseOver="hilite(3183)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a>[] = '{&quot;type&quot;:&quot;grouping&quot;' .
<a name="l380"><span class="linenum"> 380</span></a>                      (<a class="var it4042" onMouseOver="hilite(4042)" onMouseOut="lolite()" onClick="logVariable('groupingid')" href="../../_variables/groupingid.html">$groupingid</a> ? ',&quot;id&quot;:' . <a class="var it4042" onMouseOver="hilite(4042)" onMouseOut="lolite()" onClick="logVariable('groupingid')" href="../../_variables/groupingid.html">$groupingid</a> : '') . '}';
<a name="l381"><span class="linenum"> 381</span></a>          } else {
<a name="l382"><span class="linenum"> 382</span></a>  <span class="comment">            // No grouping specified, so allow any group.</span>
<a name="l383"><span class="linenum"> 383</span></a>              <a class="var it3183" onMouseOver="hilite(3183)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a>[] = '{&quot;type&quot;:&quot;group&quot;}';
<a name="l384"><span class="linenum"> 384</span></a>          }
<a name="l385"><span class="linenum"> 385</span></a>  <span class="comment">        // Group members only condition was not displayed to students.</span>
<a name="l386"><span class="linenum"> 386</span></a>          <a class="var it19698" onMouseOver="hilite(19698)" onMouseOut="lolite()" onClick="logVariable('shows')" href="../../_variables/shows.html">$shows</a>[] = 'false';
<a name="l387"><span class="linenum"> 387</span></a>  
<a name="l388"><span class="linenum"> 388</span></a>  <span class="comment">        // In the unlikely event that the site had enablegroupmembers only</span>
<a name="l389"><span class="linenum"> 389</span></a>  <span class="comment">        // but NOT enableavailability, we need to turn this on now.</span>
<a name="l390"><span class="linenum"> 390</span></a>          if (!<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enableavailability')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/enableavailability.html">enableavailability</a>) {
<a name="l391"><span class="linenum"> 391</span></a>              <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('enableavailability', 1);
<a name="l392"><span class="linenum"> 392</span></a>          }
<a name="l393"><span class="linenum"> 393</span></a>      }
<a name="l394"><span class="linenum"> 394</span></a>  
<a name="l395"><span class="linenum"> 395</span></a>  <span class="comment">    // Date conditions.</span>
<a name="l396"><span class="linenum"> 396</span></a>      if (<a class="var it19696" onMouseOver="hilite(19696)" onMouseOut="lolite()" onClick="logVariable('availablefrom')" href="../../_variables/availablefrom.html">$availablefrom</a>) {
<a name="l397"><span class="linenum"> 397</span></a>          <a class="var it3183" onMouseOver="hilite(3183)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a>[] = '{&quot;type&quot;:&quot;date&quot;,&quot;d&quot;:&quot;&gt;=&quot;,&quot;t&quot;:' . <a class="var it19696" onMouseOver="hilite(19696)" onMouseOut="lolite()" onClick="logVariable('availablefrom')" href="../../_variables/availablefrom.html">$availablefrom</a> . '}';
<a name="l398"><span class="linenum"> 398</span></a>          <a class="var it19698" onMouseOver="hilite(19698)" onMouseOut="lolite()" onClick="logVariable('shows')" href="../../_variables/shows.html">$shows</a>[] = <a class="var it17269" onMouseOver="hilite(17269)" onMouseOut="lolite()" onClick="logVariable('showavailability')" href="../../_variables/showavailability.html">$showavailability</a> ? 'true' : 'false';
<a name="l399"><span class="linenum"> 399</span></a>      }
<a name="l400"><span class="linenum"> 400</span></a>      if (<a class="var it19697" onMouseOver="hilite(19697)" onMouseOut="lolite()" onClick="logVariable('availableuntil')" href="../../_variables/availableuntil.html">$availableuntil</a>) {
<a name="l401"><span class="linenum"> 401</span></a>          <a class="var it3183" onMouseOver="hilite(3183)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a>[] = '{&quot;type&quot;:&quot;date&quot;,&quot;d&quot;:&quot;&lt;&quot;,&quot;t&quot;:' . <a class="var it19697" onMouseOver="hilite(19697)" onMouseOut="lolite()" onClick="logVariable('availableuntil')" href="../../_variables/availableuntil.html">$availableuntil</a> . '}';
<a name="l402"><span class="linenum"> 402</span></a>  <span class="comment">        // Until dates never showed to students.</span>
<a name="l403"><span class="linenum"> 403</span></a>          <a class="var it19698" onMouseOver="hilite(19698)" onMouseOut="lolite()" onClick="logVariable('shows')" href="../../_variables/shows.html">$shows</a>[] = 'false';
<a name="l404"><span class="linenum"> 404</span></a>      }
<a name="l405"><span class="linenum"> 405</span></a>  
<a name="l406"><span class="linenum"> 406</span></a>  <span class="comment">    // Conditions from _availability table.</span>
<a name="l407"><span class="linenum"> 407</span></a>      foreach (<a class="var it21053" onMouseOver="hilite(21053)" onMouseOut="lolite()" onClick="logVariable('availrecs')" href="../../_variables/availrecs.html">$availrecs</a> as <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>) {
<a name="l408"><span class="linenum"> 408</span></a>          if (!empty(<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('sourcecmid')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/sourcecmid.html">sourcecmid</a>)) {
<a name="l409"><span class="linenum"> 409</span></a>  <span class="comment">            // Completion condition.</span>
<a name="l410"><span class="linenum"> 410</span></a>              <a class="var it3183" onMouseOver="hilite(3183)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a>[] = '{&quot;type&quot;:&quot;completion&quot;,&quot;cm&quot;:' . <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('sourcecmid')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/sourcecmid.html">sourcecmid</a> .
<a name="l411"><span class="linenum"> 411</span></a>                      ',&quot;e&quot;:' . <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('requiredcompletion')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/requiredcompletion.html">requiredcompletion</a> . '}';
<a name="l412"><span class="linenum"> 412</span></a>          } else {
<a name="l413"><span class="linenum"> 413</span></a>  <span class="comment">            // Grade condition.</span>
<a name="l414"><span class="linenum"> 414</span></a>              <a class="var it19699" onMouseOver="hilite(19699)" onMouseOut="lolite()" onClick="logVariable('minmax')" href="../../_variables/minmax.html">$minmax</a> = '';
<a name="l415"><span class="linenum"> 415</span></a>              if (!empty(<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('grademin')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/grademin.html">grademin</a>)) {
<a name="l416"><span class="linenum"> 416</span></a>                  <a class="var it19699" onMouseOver="hilite(19699)" onMouseOut="lolite()" onClick="logVariable('minmax')" href="../../_variables/minmax.html">$minmax</a> .= ',&quot;min&quot;:' . sprintf('%.5f', <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('grademin')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/grademin.html">grademin</a>);
<a name="l417"><span class="linenum"> 417</span></a>              }
<a name="l418"><span class="linenum"> 418</span></a>              if (!empty(<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('grademax')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/grademax.html">grademax</a>)) {
<a name="l419"><span class="linenum"> 419</span></a>                  <a class="var it19699" onMouseOver="hilite(19699)" onMouseOut="lolite()" onClick="logVariable('minmax')" href="../../_variables/minmax.html">$minmax</a> .= ',&quot;max&quot;:' . sprintf('%.5f', <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('grademax')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/grademax.html">grademax</a>);
<a name="l420"><span class="linenum"> 420</span></a>              }
<a name="l421"><span class="linenum"> 421</span></a>              <a class="var it3183" onMouseOver="hilite(3183)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a>[] = '{&quot;type&quot;:&quot;grade&quot;,&quot;id&quot;:' . <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('gradeitemid')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/gradeitemid.html">gradeitemid</a> . <a class="var it19699" onMouseOver="hilite(19699)" onMouseOut="lolite()" onClick="logVariable('minmax')" href="../../_variables/minmax.html">$minmax</a> . '}';
<a name="l422"><span class="linenum"> 422</span></a>          }
<a name="l423"><span class="linenum"> 423</span></a>          <a class="var it19698" onMouseOver="hilite(19698)" onMouseOut="lolite()" onClick="logVariable('shows')" href="../../_variables/shows.html">$shows</a>[] = <a class="var it17269" onMouseOver="hilite(17269)" onMouseOut="lolite()" onClick="logVariable('showavailability')" href="../../_variables/showavailability.html">$showavailability</a> ? 'true' : 'false';
<a name="l424"><span class="linenum"> 424</span></a>      }
<a name="l425"><span class="linenum"> 425</span></a>  
<a name="l426"><span class="linenum"> 426</span></a>  <span class="comment">    // Conditions from _fields table.</span>
<a name="l427"><span class="linenum"> 427</span></a>      foreach (<a class="var it21054" onMouseOver="hilite(21054)" onMouseOut="lolite()" onClick="logVariable('fieldrecs')" href="../../_variables/fieldrecs.html">$fieldrecs</a> as <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>) {
<a name="l428"><span class="linenum"> 428</span></a>          if (isset(<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('userfield')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/userfield.html">userfield</a>)) {
<a name="l429"><span class="linenum"> 429</span></a>  <span class="comment">            // Standard field.</span>
<a name="l430"><span class="linenum"> 430</span></a>              <a class="var it19700" onMouseOver="hilite(19700)" onMouseOut="lolite()" onClick="logVariable('fieldbit')" href="../../_variables/fieldbit.html">$fieldbit</a> = ',&quot;sf&quot;:' . <a class="function" onClick="logFunction('json_encode')" href="../../_functions/json_encode.html" onMouseOver="funcPopup(event,'json_encode')">json_encode</a>(<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('userfield')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/userfield.html">userfield</a>);
<a name="l431"><span class="linenum"> 431</span></a>          } else {
<a name="l432"><span class="linenum"> 432</span></a>  <span class="comment">            // Custom field.</span>
<a name="l433"><span class="linenum"> 433</span></a>              <a class="var it19700" onMouseOver="hilite(19700)" onMouseOut="lolite()" onClick="logVariable('fieldbit')" href="../../_variables/fieldbit.html">$fieldbit</a> = ',&quot;cf&quot;:' . <a class="function" onClick="logFunction('json_encode')" href="../../_functions/json_encode.html" onMouseOver="funcPopup(event,'json_encode')">json_encode</a>(<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('shortname')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/shortname.html">shortname</a>);
<a name="l434"><span class="linenum"> 434</span></a>          }
<a name="l435"><span class="linenum"> 435</span></a>  <span class="comment">        // Value is not included for certain operators.</span>
<a name="l436"><span class="linenum"> 436</span></a>          switch(<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('operator')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/operator.html">operator</a>) {
<a name="l437"><span class="linenum"> 437</span></a>              case 'isempty':
<a name="l438"><span class="linenum"> 438</span></a>              case 'isnotempty':
<a name="l439"><span class="linenum"> 439</span></a>                  <a class="var it19701" onMouseOver="hilite(19701)" onMouseOut="lolite()" onClick="logVariable('valuebit')" href="../../_variables/valuebit.html">$valuebit</a> = '';
<a name="l440"><span class="linenum"> 440</span></a>                  break;
<a name="l441"><span class="linenum"> 441</span></a>  
<a name="l442"><span class="linenum"> 442</span></a>              default:
<a name="l443"><span class="linenum"> 443</span></a>                  <a class="var it19701" onMouseOver="hilite(19701)" onMouseOut="lolite()" onClick="logVariable('valuebit')" href="../../_variables/valuebit.html">$valuebit</a> = ',&quot;v&quot;:' . <a class="function" onClick="logFunction('json_encode')" href="../../_functions/json_encode.html" onMouseOver="funcPopup(event,'json_encode')">json_encode</a>(<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('value')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/value.html">value</a>);
<a name="l444"><span class="linenum"> 444</span></a>                  break;
<a name="l445"><span class="linenum"> 445</span></a>          }
<a name="l446"><span class="linenum"> 446</span></a>          <a class="var it3183" onMouseOver="hilite(3183)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a>[] = '{&quot;type&quot;:&quot;profile&quot;,&quot;op&quot;:&quot;' . <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('operator')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/operator.html">operator</a> . '&quot;' .
<a name="l447"><span class="linenum"> 447</span></a>                  <a class="var it19700" onMouseOver="hilite(19700)" onMouseOut="lolite()" onClick="logVariable('fieldbit')" href="../../_variables/fieldbit.html">$fieldbit</a> . <a class="var it19701" onMouseOver="hilite(19701)" onMouseOut="lolite()" onClick="logVariable('valuebit')" href="../../_variables/valuebit.html">$valuebit</a> . '}';
<a name="l448"><span class="linenum"> 448</span></a>          <a class="var it19698" onMouseOver="hilite(19698)" onMouseOut="lolite()" onClick="logVariable('shows')" href="../../_variables/shows.html">$shows</a>[] = <a class="var it17269" onMouseOver="hilite(17269)" onMouseOut="lolite()" onClick="logVariable('showavailability')" href="../../_variables/showavailability.html">$showavailability</a> ? 'true' : 'false';
<a name="l449"><span class="linenum"> 449</span></a>      }
<a name="l450"><span class="linenum"> 450</span></a>  
<a name="l451"><span class="linenum"> 451</span></a>  <span class="comment">    // If there are some conditions, set them into database.</span>
<a name="l452"><span class="linenum"> 452</span></a>      if (<a class="var it3183" onMouseOver="hilite(3183)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a>) {
<a name="l453"><span class="linenum"> 453</span></a>          return '{&quot;op&quot;:&quot;&amp;&quot;,&quot;showc&quot;:[' . <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',', <a class="var it19698" onMouseOver="hilite(19698)" onMouseOut="lolite()" onClick="logVariable('shows')" href="../../_variables/shows.html">$shows</a>) . '],' .
<a name="l454"><span class="linenum"> 454</span></a>                  '&quot;c&quot;:[' . <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',', <a class="var it3183" onMouseOver="hilite(3183)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a>) . ']}';
<a name="l455"><span class="linenum"> 455</span></a>      } else {
<a name="l456"><span class="linenum"> 456</span></a>          return null;
<a name="l457"><span class="linenum"> 457</span></a>      }
<a name="l458"><span class="linenum"> 458</span></a>  }
<a name="l459"><span class="linenum"> 459</span></a>  
<a name="l460"><span class="linenum"> 460</span></a>  <span class="comment">/**</span>
<a name="l461"><span class="linenum"> 461</span></a>  <span class="comment"> * Using data for a single course-module that has groupmembersonly enabled,</span>
<a name="l462"><span class="linenum"> 462</span></a>  <span class="comment"> * returns the new availability value that incorporates the correct</span>
<a name="l463"><span class="linenum"> 463</span></a>  <span class="comment"> * groupmembersonly option.</span>
<a name="l464"><span class="linenum"> 464</span></a>  <span class="comment"> *</span>
<a name="l465"><span class="linenum"> 465</span></a>  <span class="comment"> * Included as a function so that it can be shared between upgrade and restore,</span>
<a name="l466"><span class="linenum"> 466</span></a>  <span class="comment"> * and unit-tested.</span>
<a name="l467"><span class="linenum"> 467</span></a>  <span class="comment"> *</span>
<a name="l468"><span class="linenum"> 468</span></a>  <span class="comment"> * @param int $groupingid Grouping id for the course-module (0 if none)</span>
<a name="l469"><span class="linenum"> 469</span></a>  <span class="comment"> * @param string $availability Availability JSON data for the module (null if none)</span>
<a name="l470"><span class="linenum"> 470</span></a>  <span class="comment"> * @return string New value for availability for the module</span>
<a name="l471"><span class="linenum"> 471</span></a>  <span class="comment"> */</span>
<a name="l472"><span class="linenum"> 472</span></a>  function <a class="function" onClick="logFunction('upgrade_group_members_only')" href="../../_functions/upgrade_group_members_only.html" onMouseOver="funcPopup(event,'upgrade_group_members_only')">upgrade_group_members_only</a>(<a class="var it4042" onMouseOver="hilite(4042)" onMouseOut="lolite()" onClick="logVariable('groupingid')" href="../../_variables/groupingid.html">$groupingid</a>, <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('availability')" href="../../_variables/availability.html">$availability</a>) {
<a name="l473"><span class="linenum"> 473</span></a>  <span class="comment">    // Work out the new JSON object representing this option.</span>
<a name="l474"><span class="linenum"> 474</span></a>      if (<a class="var it4042" onMouseOver="hilite(4042)" onMouseOut="lolite()" onClick="logVariable('groupingid')" href="../../_variables/groupingid.html">$groupingid</a>) {
<a name="l475"><span class="linenum"> 475</span></a>  <span class="comment">        // Require specific grouping.</span>
<a name="l476"><span class="linenum"> 476</span></a>          <a class="var it5142" onMouseOver="hilite(5142)" onMouseOut="lolite()" onClick="logVariable('condition')" href="../../_variables/condition.html">$condition</a> = (object)array('type' =&gt; 'grouping', 'id' =&gt; (int)<a class="var it4042" onMouseOver="hilite(4042)" onMouseOut="lolite()" onClick="logVariable('groupingid')" href="../../_variables/groupingid.html">$groupingid</a>);
<a name="l477"><span class="linenum"> 477</span></a>      } else {
<a name="l478"><span class="linenum"> 478</span></a>  <span class="comment">        // No grouping specified, so require membership of any group.</span>
<a name="l479"><span class="linenum"> 479</span></a>          <a class="var it5142" onMouseOver="hilite(5142)" onMouseOut="lolite()" onClick="logVariable('condition')" href="../../_variables/condition.html">$condition</a> = (object)array('type' =&gt; 'group');
<a name="l480"><span class="linenum"> 480</span></a>      }
<a name="l481"><span class="linenum"> 481</span></a>  
<a name="l482"><span class="linenum"> 482</span></a>      if (<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('availability')" href="../../_variables/availability.html">$availability</a>)) {
<a name="l483"><span class="linenum"> 483</span></a>  <span class="comment">        // If there are no conditions using the new API then just set it.</span>
<a name="l484"><span class="linenum"> 484</span></a>          <a class="var it4476" onMouseOver="hilite(4476)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a> = (object)array('op' =&gt; '&amp;', 'c' =&gt; array(<a class="var it5142" onMouseOver="hilite(5142)" onMouseOut="lolite()" onClick="logVariable('condition')" href="../../_variables/condition.html">$condition</a>), 'showc' =&gt; array(false));
<a name="l485"><span class="linenum"> 485</span></a>      } else {
<a name="l486"><span class="linenum"> 486</span></a>  <span class="comment">        // There are existing conditions.</span>
<a name="l487"><span class="linenum"> 487</span></a>          <a class="var it4476" onMouseOver="hilite(4476)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a> = json_decode(<a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('availability')" href="../../_variables/availability.html">$availability</a>);
<a name="l488"><span class="linenum"> 488</span></a>          switch (<a class="var it4476" onMouseOver="hilite(4476)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>-&gt;<a onClick="logVariable('op')" class="var it39686" onMouseOver="hilite(39686)" onMouseOut="lolite()" href="../../_variables/op.html">op</a>) {
<a name="l489"><span class="linenum"> 489</span></a>              case '&amp;' :
<a name="l490"><span class="linenum"> 490</span></a>  <span class="comment">                // For &amp; conditions we can just add this one.</span>
<a name="l491"><span class="linenum"> 491</span></a>                  <a class="var it4476" onMouseOver="hilite(4476)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>-&gt;<a onClick="logVariable('c')" class="var it39686" onMouseOver="hilite(39686)" onMouseOut="lolite()" href="../../_variables/c.html">c</a>[] = <a class="var it5142" onMouseOver="hilite(5142)" onMouseOut="lolite()" onClick="logVariable('condition')" href="../../_variables/condition.html">$condition</a>;
<a name="l492"><span class="linenum"> 492</span></a>                  <a class="var it4476" onMouseOver="hilite(4476)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>-&gt;<a onClick="logVariable('showc')" class="var it39686" onMouseOver="hilite(39686)" onMouseOut="lolite()" href="../../_variables/showc.html">showc</a>[] = false;
<a name="l493"><span class="linenum"> 493</span></a>                  break;
<a name="l494"><span class="linenum"> 494</span></a>              case '!|' :
<a name="l495"><span class="linenum"> 495</span></a>  <span class="comment">                // For 'not or' conditions we can add this one</span>
<a name="l496"><span class="linenum"> 496</span></a>  <span class="comment">                // but negated.</span>
<a name="l497"><span class="linenum"> 497</span></a>                  <a class="var it4476" onMouseOver="hilite(4476)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>-&gt;<a onClick="logVariable('c')" class="var it39686" onMouseOver="hilite(39686)" onMouseOut="lolite()" href="../../_variables/c.html">c</a>[] = (object)array('op' =&gt; '!&amp;', 'c' =&gt; array(<a class="var it5142" onMouseOver="hilite(5142)" onMouseOut="lolite()" onClick="logVariable('condition')" href="../../_variables/condition.html">$condition</a>));
<a name="l498"><span class="linenum"> 498</span></a>                  <a class="var it4476" onMouseOver="hilite(4476)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>-&gt;<a onClick="logVariable('showc')" class="var it39686" onMouseOver="hilite(39686)" onMouseOut="lolite()" href="../../_variables/showc.html">showc</a>[] = false;
<a name="l499"><span class="linenum"> 499</span></a>                  break;
<a name="l500"><span class="linenum"> 500</span></a>              default:
<a name="l501"><span class="linenum"> 501</span></a>  <span class="comment">                // For the other two (OR and NOT AND) we have to add</span>
<a name="l502"><span class="linenum"> 502</span></a>  <span class="comment">                // an extra level to the tree.</span>
<a name="l503"><span class="linenum"> 503</span></a>                  <a class="var it4476" onMouseOver="hilite(4476)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a> = (object)array('op' =&gt; '&amp;', 'c' =&gt; array(<a class="var it4476" onMouseOver="hilite(4476)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>, <a class="var it5142" onMouseOver="hilite(5142)" onMouseOut="lolite()" onClick="logVariable('condition')" href="../../_variables/condition.html">$condition</a>),
<a name="l504"><span class="linenum"> 504</span></a>                          'showc' =&gt; array(<a class="var it4476" onMouseOver="hilite(4476)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>-&gt;<a onClick="logVariable('show')" class="var it39686" onMouseOver="hilite(39686)" onMouseOut="lolite()" href="../../_variables/show.html">show</a>, false));
<a name="l505"><span class="linenum"> 505</span></a>  <span class="comment">                // Inner trees do not have a show option, so remove it.</span>
<a name="l506"><span class="linenum"> 506</span></a>                  unset(<a class="var it4476" onMouseOver="hilite(4476)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>-&gt;<a onClick="logVariable('c')" class="var it39686" onMouseOver="hilite(39686)" onMouseOut="lolite()" href="../../_variables/c.html">c</a>[0]-&gt;show);
<a name="l507"><span class="linenum"> 507</span></a>                  break;
<a name="l508"><span class="linenum"> 508</span></a>          }
<a name="l509"><span class="linenum"> 509</span></a>      }
<a name="l510"><span class="linenum"> 510</span></a>  
<a name="l511"><span class="linenum"> 511</span></a>      return <a class="function" onClick="logFunction('json_encode')" href="../../_functions/json_encode.html" onMouseOver="funcPopup(event,'json_encode')">json_encode</a>(<a class="var it4476" onMouseOver="hilite(4476)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>);
<a name="l512"><span class="linenum"> 512</span></a>  }
<a name="l513"><span class="linenum"> 513</span></a>  
<a name="l514"><span class="linenum"> 514</span></a>  <span class="comment">/**</span>
<a name="l515"><span class="linenum"> 515</span></a>  <span class="comment"> * Updates the mime-types for files that exist in the database, based on their</span>
<a name="l516"><span class="linenum"> 516</span></a>  <span class="comment"> * file extension.</span>
<a name="l517"><span class="linenum"> 517</span></a>  <span class="comment"> *</span>
<a name="l518"><span class="linenum"> 518</span></a>  <span class="comment"> * @param array $filetypes Array with file extension as the key, and mimetype as the value</span>
<a name="l519"><span class="linenum"> 519</span></a>  <span class="comment"> */</span>
<a name="l520"><span class="linenum"> 520</span></a>  function <a class="function" onClick="logFunction('upgrade_mimetypes')" href="../../_functions/upgrade_mimetypes.html" onMouseOver="funcPopup(event,'upgrade_mimetypes')">upgrade_mimetypes</a>(<a class="var it5181" onMouseOver="hilite(5181)" onMouseOut="lolite()" onClick="logVariable('filetypes')" href="../../_variables/filetypes.html">$filetypes</a>) {
<a name="l521"><span class="linenum"> 521</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l522"><span class="linenum"> 522</span></a>      <a class="var it2282" onMouseOver="hilite(2282)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_like')" href="../../_functions/sql_like.html" onMouseOver="funcPopup(event,'sql_like')">sql_like</a>('filename', '?', false);
<a name="l523"><span class="linenum"> 523</span></a>      foreach (<a class="var it5181" onMouseOver="hilite(5181)" onMouseOut="lolite()" onClick="logVariable('filetypes')" href="../../_variables/filetypes.html">$filetypes</a> as <a class="var it473" onMouseOver="hilite(473)" onMouseOut="lolite()" onClick="logVariable('extension')" href="../../_variables/extension.html">$extension</a>=&gt;<a class="var it2542" onMouseOver="hilite(2542)" onMouseOut="lolite()" onClick="logVariable('mimetype')" href="../../_variables/mimetype.html">$mimetype</a>) {
<a name="l524"><span class="linenum"> 524</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field_select')" href="../../_functions/set_field_select.html" onMouseOver="funcPopup(event,'set_field_select')">set_field_select</a>(
<a name="l525"><span class="linenum"> 525</span></a>              'files',
<a name="l526"><span class="linenum"> 526</span></a>              'mimetype',
<a name="l527"><span class="linenum"> 527</span></a>              <a class="var it2542" onMouseOver="hilite(2542)" onMouseOut="lolite()" onClick="logVariable('mimetype')" href="../../_variables/mimetype.html">$mimetype</a>,
<a name="l528"><span class="linenum"> 528</span></a>              <a class="var it2282" onMouseOver="hilite(2282)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a>,
<a name="l529"><span class="linenum"> 529</span></a>              array(<a class="var it473" onMouseOver="hilite(473)" onMouseOut="lolite()" onClick="logVariable('extension')" href="../../_variables/extension.html">$extension</a>)
<a name="l530"><span class="linenum"> 530</span></a>          );
<a name="l531"><span class="linenum"> 531</span></a>      }
<a name="l532"><span class="linenum"> 532</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'set_config': ['set_config', 'Set a configuration value for this plugin ', [['mod/assign','assignmentplugin.php',314],['lib/portfolio','plugin.php',515],['lib','moodlelib.php',1331],['lib','enrollib.php',1152],['lib/editor/tinymce/classes','plugin.php',84]], 985],
'notification': ['notification', 'Output a notification (that is, a status message about something that has just happened). ', [['lib','outputrenderers.php',2762],['lib','outputrenderers.php',4128],['lib','outputrenderers.php',4201]], 495],
'count_records': ['count_records', 'Count the records in a table where all the given conditions met. ', [['lib/dml','moodle_database.php',1717]], 1399],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required. ', [['lib/dml','pgsql_native_moodle_database.php',883],['lib/dml','oci_native_moodle_database.php',1249],['lib/dml','sqlsrv_native_moodle_database.php',978],['lib/dml','mssql_native_moodle_database.php',898],['lib/dml','mysqli_native_moodle_database.php',1177],['lib/dml/tests','dml_test.php',5427],['lib/dml','pdo_moodle_database.php',386],['question/engine/upgrade','upgradelib.php',121]], 1512],
'sql_like': ['sql_like', 'Returns \'LIKE\' part of a query. ', [['lib/dml','pgsql_native_moodle_database.php',1273],['lib/dml','oci_native_moodle_database.php',1523],['lib/dml','sqlsrv_native_moodle_database.php',1224],['lib/dml','moodle_database.php',2004],['lib/dml','mssql_native_moodle_database.php',1160],['lib/dml','mysqli_native_moodle_database.php',1502]], 158],
'upgrade_availability_item': ['upgrade_availability_item', 'Updates a single item (course module or course section) to transfer the availability settings from the old to the new format. ', [['lib/db','upgradelib.php',352]], 20],
'get_recordset_sql': ['get_recordset_sql', 'Get a number of records as a moodle_recordset using a SQL statement. ', [['lib/dml','pgsql_native_moodle_database.php',688],['lib/dml','oci_native_moodle_database.php',1065],['lib/dml','sqlsrv_native_moodle_database.php',761],['lib/dml','mssql_native_moodle_database.php',687],['lib/dml','mysqli_native_moodle_database.php',985],['lib/dml/tests','dml_test.php',5423],['lib/dml','pdo_moodle_database.php',251]], 279],
'set_field_select': ['set_field_select', 'Set a single field in every table record which match a particular WHERE clause. ', [['lib/dml','pgsql_native_moodle_database.php',1192],['lib/dml','oci_native_moodle_database.php',1387],['lib/dml','sqlsrv_native_moodle_database.php',1111],['lib/dml','mssql_native_moodle_database.php',1033],['lib/dml','mysqli_native_moodle_database.php',1427],['lib/dml/tests','dml_test.php',5431],['lib/dml','pdo_moodle_database.php',491]], 78],
'get_records': ['get_records', 'Get a number of records as an array of objects where all the given conditions met. ', [['lib/dml','moodle_database.php',1236],['lib','coursecatlib.php',654],['question','category_class.php',63]], 860],
'update': ['update', 'Update a customer resource if one it exists and is owned by the reseller. (customers.update) ', [['lib/google/src/Google/Service','Reseller.php',343],['mod/lesson/pagetypes','matching.php',308],['lib/adodb','adodb-active-recordx.inc.php',1047],['lib/grade','grade_object.php',238],['lib/google/src/Google/Service','Fusiontables.php',726],['lib/google/src/Google/Service','Fusiontables.php',889],['lib/google/src/Google/Service','Fusiontables.php',1095],['lib/google/src/Google/Service','Fusiontables.php',1269],['grade/grading/form','lib.php',905],['lib/google/src/Google/Service','Blogger.php',1332],['lib/google/src/Google/Service','Blogger.php',1630],['lib/google/src/Google/Service','Doubleclicksearch.php',325],['lib/google/src/Google/Service','AdExchangeBuyer.php',392],['lib/google/src/Google/Service','AdExchangeBuyer.php',684],['lib/grade','grade_item.php',260],['lib/google/src/Google/Service','Gmail.php',756],['lib/google/src/Google/Service','Gmail.php',908],['lib/google/src/Google/Service','Mirror.php',495],['lib/google/src/Google/Service','Mirror.php',633],['lib/google/src/Google/Service','Mirror.php',744],['lib/google/src/Google/Service','Genomics.php',690],['lib/google/src/Google/Service','Genomics.php',811],['lib/google/src/Google/Service','Genomics.php',1064],['lib/google/src/Google/Service','Genomics.php',1370],['lib/google/src/Google/Service','Genomics.php',1521],['lib/google/src/Google/Service','Dfareporting.php',570],['lib/google/src/Google/Service','PlusDomains.php',691],['lib/google/src/Google/Service','Licensing.php',332],['lib/google/src/Google/Service','Drive.php',1624],['lib/google/src/Google/Service','Drive.php',1859],['lib/google/src/Google/Service','Drive.php',2100],['lib/google/src/Google/Service','Drive.php',2211],['lib/google/src/Google/Service','Drive.php',2261],['lib/google/src/Google/Service','Drive.php',2385],['lib/google/src/Google/Service','Drive.php',2473],['completion','data_object.php',251],['lib/google/src/Google/Service','Books.php',1901],['lib/google/src/Google/Service','Bigquery.php',603],['lib/google/src/Google/Service','Bigquery.php',911],['lib/google/src/Google/Service','Groupssettings.php',137],['lib/google/src/Google/Service','YouTube.php',1596],['lib/google/src/Google/Service','YouTube.php',1697],['lib/google/src/Google/Service','YouTube.php',2201],['lib/google/src/Google/Service','YouTube.php',2439],['lib/google/src/Google/Service','YouTube.php',2613],['lib/google/src/Google/Service','YouTube.php',2809],['lib/google/src/Google/Service','YouTube.php',3419],['lib/google/src/Google/Service','Coordinate.php',568],['lib/google/src/Google/Service','Coordinate.php',680],['lib/google/src/Google/Service','Autoscaler.php',399],['calendar','lib.php',2171],['lib/google/src/Google/Service','ShoppingContent.php',633],['lib/google/src/Google/Service','ShoppingContent.php',815],['lib','weblib.php',3154],['mod/lesson','locallib.php',2682],['lib/google/src/Google/Service','SQLAdmin.php',843],['lib/google/src/Google/Service','Fitness.php',424],['lib/google/src/Google/Service','Fitness.php',607],['lib/google/src/Google/Service','TagManager.php',1004],['lib/google/src/Google/Service','TagManager.php',1093],['lib/google/src/Google/Service','TagManager.php',1186],['lib/google/src/Google/Service','TagManager.php',1279],['lib/google/src/Google/Service','TagManager.php',1372],['lib/google/src/Google/Service','TagManager.php',1466],['lib/google/src/Google/Service','TagManager.php',1560],['lib/google/src/Google/Service','TagManager.php',1711],['lib/google/src/Google/Service','TagManager.php',1804],['mod/lesson/pagetypes','truefalse.php',163],['lib/google/src/Google/Service','Directory.php',1446],['lib/google/src/Google/Service','Directory.php',1559],['lib/google/src/Google/Service','Directory.php',1724],['lib/google/src/Google/Service','Directory.php',1907],['lib/google/src/Google/Service','Directory.php',2014],['lib/google/src/Google/Service','Directory.php',2116],['lib/google/src/Google/Service','Directory.php',2337],['lib/google/src/Google/Service','Directory.php',2523],['lib/xhprof/xhprof_html/jquery','jquery.tooltip.js',200],['lib/google/src/Google/Service','AppState.php',201],['lib/google/src/Google/Service','Taskqueue.php',397],['lib/google/src/Google/Service','AndroidPublisher.php',1360],['lib/google/src/Google/Service','AndroidPublisher.php',1472],['lib/google/src/Google/Service','AndroidPublisher.php',1542],['lib/google/src/Google/Service','AndroidPublisher.php',1780],['lib/google/src/Google/Service','AndroidPublisher.php',1846],['lib/google/src/Google/Service','AndroidPublisher.php',1928],['lib/google/src/Google/Service','AndroidPublisher.php',2066],['mod/lesson/pagetypes','essay.php',158],['lib/google/src/Google/Service','AdSenseHost.php',845],['lib/google/src/Google/Service','AdSenseHost.php',1096],['lib/google/src/Google/Service','Games.php',1507],['lib/grade','grade_grade.php',940],['lib/google/src/Google/Service','SiteVerification.php',226],['lib/horde/framework/Horde/Support','Array.php',70],['lib/google/src/Google/Service','Prediction.php',338],['lib/google/src/Google/Service','Compute.php',2999],['lib/google/src/Google/Service','Compute.php',3310],['lib/google/src/Google/Service','Compute.php',3814],['lib/google/src/Google/Service','Compute.php',5314],['lib/google/src/Google/Service','Calendar.php',979],['lib/google/src/Google/Service','Calendar.php',1144],['lib/google/src/Google/Service','Calendar.php',1285],['lib/google/src/Google/Service','Calendar.php',1633],['lib/google/src/Google/Service','Analytics.php',2118],['lib/google/src/Google/Service','Analytics.php',2385],['lib/google/src/Google/Service','Analytics.php',2495],['lib/google/src/Google/Service','Analytics.php',2602],['lib/google/src/Google/Service','Analytics.php',2730],['lib/google/src/Google/Service','Analytics.php',2821],['lib/google/src/Google/Service','Analytics.php',2944],['lib/google/src/Google/Service','Analytics.php',3277],['lib/google/src/Google/Service','Analytics.php',3379],['lib/google/src/Google/Service','Analytics.php',3461],['lib/google/src/Google/Service','Tasks.php',385],['lib/google/src/Google/Service','Tasks.php',555],['lib/horde/framework/Horde/Imap/Client/Ids','Map.php',72],['grade/grading/form/guide','lib.php',826],['lib/grade','grade_category.php',204],['lib/google/src/Google/Service','Storage.php',1030],['lib/google/src/Google/Service','Storage.php',1165],['lib/google/src/Google/Service','Storage.php',1318],['lib/google/src/Google/Service','Storage.php',1454],['lib/google/src/Google/Service','Storage.php',1718],['lib/filestorage','stored_file.php',103],['grade/grading/form/rubric','lib.php',828],['lib/grade','grade_scale.php',125],['lib','coursecatlib.php',441],['lib/adodb','adodb-active-record.inc.php',878],['lib/grade','grade_outcome.php',144],['mod/lesson/pagetypes','branchtable.php',262]], 290],
'upgrade_mssql_varbinarymax': ['upgrade_mssql_varbinarymax', 'Migrate IMAGE to VARBINARY(MAX). ', [['lib/db','upgradelib.php',223]], 1],
'upgrade_mysql_get_supported_tables': ['upgrade_mysql_get_supported_tables', 'Returns all non-view and non-temp tables with sane names. Prints list of non-supported tables using $OUTPUT->notification() ', [['lib/db','upgradelib.php',33]], 1],
'upgrade_mssql_nvarcharmax': ['upgrade_mssql_nvarcharmax', 'Migrate NTEXT to NVARCHAR(MAX). ', [['lib/db','upgradelib.php',168]], 1],
'upgrade_mysql_fix_unsigned_and_lob_columns': ['upgrade_mysql_fix_unsigned_and_lob_columns', 'Remove all signed numbers from current database and change text fields to long texts - mysql only. ', [['lib/db','upgradelib.php',79]], 1],
'sql_concat': ['sql_concat', '', [['lib/dml','pgsql_native_moodle_database.php',1315],['lib/dml','oci_native_moodle_database.php',1550],['lib/dml','sqlsrv_native_moodle_database.php',1257],['lib/dml','sqlite3_pdo_moodle_database.php',353],['lib/dml','mssql_native_moodle_database.php',1194],['lib/dml','mysqli_native_moodle_database.php',1531],['lib/dml/tests','dml_test.php',5433],['lib/dml','pdo_moodle_database.php',536]], 73],
'get_field_sql': ['get_field_sql', 'Get a single field value (first field) using a SQL statement. ', [['lib/dml','moodle_database.php',1539]], 135],
'upgrade_set_timeout': ['upgrade_set_timeout', 'Sets maximum expected time needed for upgrade task. Please always make sure that upgrade will not run longer! ', [['lib','upgradelib.php',140]], 19],
'get_tables': ['get_tables', 'Return tables in database WITHOUT current prefix. ', [['lib/dml','pgsql_native_moodle_database.php',304],['lib/dml','oci_native_moodle_database.php',384],['lib/dml','sqlsrv_native_moodle_database.php',366],['lib/dml','sqlite3_pdo_moodle_database.php',137],['lib/dml','mssql_native_moodle_database.php',309],['lib/dml','mysqli_native_moodle_database.php',512],['lib/dml/tests','dml_test.php',5415]], 38],
'or': ['or', '', [['lib/tcpdf','LICENSE.TXT',69]], 552],
'get_dbfamily': ['get_dbfamily', 'Returns database family type - describes SQL dialect Note: can be used before connect() ', [['lib/dml','pgsql_native_moodle_database.php',61],['lib/dml','oci_native_moodle_database.php',67],['lib/dml','sqlsrv_native_moodle_database.php',75],['lib/dml','sqlite3_pdo_moodle_database.php',50],['lib/dml','mssql_native_moodle_database.php',56],['lib/dml','mysqli_native_moodle_database.php',117],['lib/dml/tests','dml_test.php',5406]], 59],
'upgrade_group_members_only': ['upgrade_group_members_only', 'Using data for a single course-module that has groupmembersonly enabled, returns the new availability value that incorporates the correct groupmembersonly option. ', [['lib/db','upgradelib.php',460]], 2],
'get_prefix': ['get_prefix', 'Returns database table prefix Note: can be used before connect() ', [['lib/dml','moodle_database.php',162],['backup/util/loggers','base_logger.class.php',146]], 29],
'upper': ['upper', 'Makes a string uppercase. ', [['lib/horde/framework/Horde','String.php',203]], 36],
'upgrade_mimetypes': ['upgrade_mimetypes', 'Updates the mime-types for files that exist in the database, based on their file extension. ', [['lib/db','upgradelib.php',514]], 2],
'change_database_structure': ['change_database_structure', 'Do NOT use in code, to be used by database_manager only! ', [['lib/dml','pgsql_native_moodle_database.php',631],['lib/dml','oci_native_moodle_database.php',889],['lib/dml','sqlsrv_native_moodle_database.php',675],['lib/dml','mssql_native_moodle_database.php',596],['lib/dml','mysqli_native_moodle_database.php',889],['lib/dml/tests','dml_test.php',5421],['lib/dml','pdo_moodle_database.php',175]], 19],
'execute': ['execute', 'Exceptionally override the execute method, so, based in the activity_included setting, we are able to skip the execution of one task completely ', [['backup/moodle2','backup_activity_task.class.php',205],['backup/converter/moodle1','backuplib.php',10],['filter/tex','latex.php',60],['backup/util/plan','base_plan.class.php',158],['mod/lti/service/toolsettings/classes/local/resource','systemsettings.php',61],['mod/lti/service/toolsettings/classes/local/resource','linksettings.php',63],['mod/lti/service/profile/classes/local/resource','profile.php',76],['webservice','lib.php',1772],['lib/classes/task','context_cleanup_task.php',41],['lib/adodb','adodb.inc.php',967],['enrol/imsenterprise/classes/task','cron_task.php',43],['admin/tool/messageinbound/classes/task','cleanup_task.php',47],['lib/classes/task','calendar_cron_task.php',40],['mod/workshop/allocation/random','lib.php',83],['lib/classes/task','registration_cron_task.php',40],['lib/classes/task','portfolio_cron_task.php',40],['lib/htmlpurifier/HTMLPurifier/Strategy','Composite.php',21],['lib/google/src/Google/Http','Batch.php',56],['backup/converter/imscc11','lib.php',85],['lib/classes/task','file_temp_cleanup_task.php',40],['filter/tex','texdebug.php',287],['admin/tool/monitor/classes','notification_task.php',39],['lib/classes/task','stats_cron_task.php',40],['lib/classes/task','backup_cleanup_task.php',40],['admin/tool/log/store/legacy/classes/task','cleanup_task.php',40],['backup/util/ui','backup_ui.class.php',122],['lib/dml','pgsql_native_moodle_database.php',665],['lib/classes/task','messaging_cleanup_task.php',40],['lib/zend/Zend/Service/WindowsAzure/RetryPolicy','RetryN.php',68],['lib/classes/task','session_cleanup_task.php',40],['lib/classes/task','completion_cron_task.php',40],['lib/dml','oci_native_moodle_database.php',1009],['backup/util/plan','base_task.class.php',162],['lib/adodb/drivers','adodb-pdo.inc.php',464],['backup/util/plan','backup_plan.class.php',112],['backup/util/ui','restore_ui.class.php',206],['backup/converter/imscc11','backuplib.php',42],['backup/moodle2','restore_activity_task.class.php',183],['','mdeploy.php',743],['lib/dml','sqlsrv_native_moodle_database.php',745],['lib/htmlpurifier/HTMLPurifier/Strategy','MakeWellFormed.php',66],['lib/google/src/Google/Http','REST.php',28],['admin/tool/langimport/classes/task','update_langpacks_task.php',44],['mod/lti/service/toolproxy/classes/local/resource','toolproxy.php',62],['lib/classes/task','plagiarism_cron_task.php',40],['admin/tool/messageinbound/classes/task','pickup_task.php',47],['backup/util/plan','backup_structure_step.class.php',50],['mod/forum/classes/task','cron_task.php',39],['mod/workshop/allocation/scheduled','lib.php',128],['lib/classes/task','file_trash_cleanup_task.php',40],['backup/util/plan','restore_execution_step.class.php',25],['lib/tests/fixtures','task_fixtures.php',30],['lib/tests/fixtures','task_fixtures.php',39],['lib/tests/fixtures','task_fixtures.php',48],['lib/tests/fixtures','task_fixtures.php',57],['admin/tool/installaddon/classes','validator.php',114],['backup/util/plan','backup_execution_step.class.php',25],['lib/classes/task','password_reset_cleanup_task.php',40],['lib/classes/task','automated_backup_task.php',40],['backup/converter/moodle1','lib.php',142],['lib/htmlpurifier/HTMLPurifier/Strategy','ValidateAttributes.php',16],['lib/classes/task','create_contexts_task.php',40],['backup/util/plan','restore_plan.class.php',159],['backup/converter/imscc1','lib.php',84],['lib/dml','mssql_native_moodle_database.php',662],['admin/tool/log/store/standard/classes/task','cleanup_task.php',40],['lib/classes/task','cache_cleanup_task.php',40],['lib/classes/task','badges_cron_task.php',40],['lib/classes/task','cache_cron_task.php',40],['backup/util/interfaces','executable.class.php',32],['lib/htmlpurifier/HTMLPurifier/Strategy','FixNesting.php',41],['lib/adodb/drivers','adodb-oci8po.inc.php',52],['lib/classes/task','question_cron_task.php',40],['lib/zend/Zend/Service/WindowsAzure/RetryPolicy','NoRetry.php',37],['lib/dml','mysqli_native_moodle_database.php',955],['lib/htmlpurifier/HTMLPurifier/Strategy','RemoveForeignElements.php',20],['backup/util/plan/tests/fixtures','plan_fixtures.php',47],['backup/util/plan/tests/fixtures','plan_fixtures.php',55],['lib/classes/task','events_cron_task.php',40],['lib/classes/task','delete_unconfirmed_users_task.php',40],['lib/adodb/drivers','adodb-oci8.inc.php',786],['backup/converter/imscc1','backuplib.php',10],['lib/classes/task','tag_cron_task.php',40],['lib/classes/task','blog_cron_task.php',40],['lib/classes/task','send_failed_login_notifications_task.php',43],['lib/classes/task','grade_cron_task.php',40],['lib/dml/tests','dml_test.php',5422],['admin/tool/uploadcourse/classes','processor.php',174],['backup/moodle2','restore_section_task.class.php',87],['mod/lti/service/toolsettings/classes/local/resource','contextsettings.php',62],['lib/google/src/Google','Client.php',545],['backup/util/plan','restore_structure_step.class.php',62],['lib/classes/task','legacy_plugin_cron_task.php',42],['lib/dml','pdo_moodle_database.php',226],['lib/classes/task','check_for_updates_task.php',40],['backup/util/helper','restore_decode_processor.class.php',73],['backup/moodle2','backup_section_task.class.php',97],['webservice/amf/testclient','AMFTester.mxml',282],['lib/classes/task','delete_incomplete_users_task.php',40],['mod/assign','adminlib.php',342],['lib/classes/task','send_new_user_passwords_task.php',40],['admin/tool/monitor/classes/task','clean_events.php',41]], 733],
'upgrade_course_modules_sequences': ['upgrade_course_modules_sequences', 'This upgrade script fixes the mismatches between DB fields course_modules.section and course_sections.sequence. It makes sure that each module is included in the sequence of at least one section. Note that this script is different from admin/cli/fix_course_sortorder.php in the following ways: 1. It does not fix the cases when module appears several times in section(s) sequence(s) - it will be done automatically on the next viewing of the course. 2. It does not remove non-existing modules from section sequences - administrator has to run the CLI script to do it. 3. When this script finds an orphaned module it adds it to the section but makes hidden where CLI script does not change the visiblity specified in the course_modules table. ', [['lib/db','upgradelib.php',274]], 1],
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pgsql_native_moodle_database.php',1137],['lib/dml','oci_native_moodle_database.php',1355],['lib/dml','sqlsrv_native_moodle_database.php',1081],['lib/dml','mssql_native_moodle_database.php',1003],['lib/dml','mysqli_native_moodle_database.php',1397],['lib/dml/tests','dml_test.php',5430],['lib/dml','pdo_moodle_database.php',460]], 565],
'close': ['close', 'Close the connection to the server ', [['lib/zend/Zend/Http/Client/Adapter','Socket.php',486],['lib/tests','completionlib_test.php',888],['lib/adodb','adodb.inc.php',2164],['lib/adodb','adodb.inc.php',2844],['lib/adodb','adodb.inc.php',3536],['lib','webdavlib.php',176],['admin/tool/uploaduser','locallib.php',149],['lib/dml','oci_native_moodle_recordset.php',80],['lib/tcpdf','tcpdf.php',2943],['lib/horde/framework/Horde/Imap/Client','Base.php',1846],['lib','excellib.class.php',93],['lib/zend/Zend/Http/Client/Adapter','Test.php',187],['lib/classes/dml','recordset_walk.php',153],['mod/assign/feedback/offline','importgradeslib.php',178],['lib/pear/Net','GeoIP.php',556],['backup/util/helper','backup_array_iterator.class.php',63],['lib/zend/Zend/Gdata/App','LoggingHttpClientAdapterSocket.php',109],['lib/zend/Zend/Http/Client/Adapter','Proxy.php',266],['lib/dml','mssql_native_moodle_recordset.php',87],['lib/pear/Auth','RADIUS.php',542],['lib/pear/Auth','RADIUS.php',703],['lib/pear/Auth','RADIUS.php',824],['lib/phpmailer','class.smtp.php',507],['lib/phpexcel/PHPExcel/Shared','ZipArchive.php',80],['lib/phpunit/classes','event_sink.php',39],['lib/zend/Zend/Http/Client/Adapter','Interface.php',73],['lib/dml','pgsql_native_moodle_recordset.php',104],['auth/fc','fcFPP.php',72],['lib/filestorage','zip_archive.php',183],['lib','odslib.class.php',71],['lib/horde/framework/Horde/Socket','Client.php',135],['question/engine/tests','helpers.php',1225],['grade','lib.php',323],['lib/dml','mysqli_native_moodle_recordset.php',86],['lib','csvlib.class.php',256],['lib/google/src/Google/Logger','File.php',130],['lib/horde/framework/Horde','Stream.php',585],['lib/phpunit/classes','phpmailer_sink.php',41],['lib/phpunit/classes','message_sink.php',39],['lib/zend/Zend/Http/Client/Adapter','Curl.php',460],['lib/dml','sqlsrv_native_moodle_recordset.php',133],['lib/zend/Zend/Service/WindowsAzure','SessionHandler.php',109],['backup/util/helper','backup_null_iterator.class.php',53],['grade/export','lib.php',662],['lib/dml','pdo_moodle_recordset.php',79]], 1036],
'json_encode': ['json_encode', 'encodes an arbitrary variable into JSON format ', [['lib/minify/lib','FirePHP.php',1124]], 247],
'key': ['key', '', [], 198],
'preg_split': ['preg_split', '', [], 127],
'count': ['count', '', [], 3984],
'in_array': ['in_array', '', [], 1173],
'array_shift': ['array_shift', '', [], 607],
'implode': ['implode', '', [], 1259],
'preg_quote': ['preg_quote', '', [], 207],
'array_change_key_case': ['array_change_key_case', '', [], 32],
'stripos': ['stripos', '', [], 95],
'str_replace': ['str_replace', '', [], 1667],
'is_null': ['is_null', '', [], 1992],
'ltrim': ['ltrim', '', [], 83],
'defined': ['defined', '', [], 4098],
'preg_match': ['preg_match', '', [], 1317],
'reset': ['reset', '', [], 1070],
'preg_replace': ['preg_replace', '', [], 903]};
CLASS_DATA={
'moodle_url': ['moodle_url', 'Class for creating and manipulating urls. ', [['lib','weblib.php',240]], 2887],
'moodle_exception': ['moodle_exception', 'Base Moodle Exception class ', [['lib','setuplib.php',68]], 478],
'progress_bar': ['progress_bar', 'Progress bar class. ', [['lib','weblib.php',2999]], 16]};
CONST_DATA={
'FORMAT_HTML': ['FORMAT_HTML', '', [['lib','weblib.php',47]], 999],
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',138],['','install.php',93],['lib','setup.php',386]], 3532]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu May 28 19:17:31 2015</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
