<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /lib/db/upgradelib.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='lib/db';
filename='upgradelib.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/lib/db/</a> -> <a href="upgradelib.php.html">upgradelib.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="upgradelib.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="upgradelib.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * Upgrade helper functions</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * This file is used for special upgrade functions - for example groups and gradebook.</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * These functions must use SQL and database related functions only- no other Moodle API,</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * because it might depend on db structures that are not yet present during upgrade.</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * (Do not use functions from accesslib.php, grades classes or group functions at all!)</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> *</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> * @package   core_install</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment"> * @category  upgrade</span>
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment"> * @copyright 2007 Petr Skoda (http://skodak.org)</span>
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment"> */</span>
<a name="l30"><span class="linenum">  30</span></a>  
<a name="l31"><span class="linenum">  31</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l32"><span class="linenum">  32</span></a>  
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment">/**</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment"> * Returns all non-view and non-temp tables with sane names.</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment"> * Prints list of non-supported tables using $OUTPUT-&gt;notification()</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment"> *</span>
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment"> * @return array</span>
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment"> */</span>
<a name="l39"><span class="linenum">  39</span></a>  function <a class="function" onClick="logFunction('upgrade_mysql_get_supported_tables')" href="../../_functions/upgrade_mysql_get_supported_tables.html" onMouseOver="funcPopup(event,'upgrade_mysql_get_supported_tables')">upgrade_mysql_get_supported_tables</a>() {
<a name="l40"><span class="linenum">  40</span></a>      global <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l41"><span class="linenum">  41</span></a>  
<a name="l42"><span class="linenum">  42</span></a>      <a class="var it1093" onMouseOver="hilite(1093)" onMouseOut="lolite()" onClick="logVariable('tables')" href="../../_variables/tables.html">$tables</a> = array();
<a name="l43"><span class="linenum">  43</span></a>      <a class="var it29608" onMouseOver="hilite(29608)" onMouseOut="lolite()" onClick="logVariable('patprefix')" href="../../_variables/patprefix.html">$patprefix</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('_', '\\_', <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_prefix')" href="../../_functions/get_prefix.html" onMouseOver="funcPopup(event,'get_prefix')">get_prefix</a>());
<a name="l44"><span class="linenum">  44</span></a>      <a class="var it29609" onMouseOver="hilite(29609)" onMouseOut="lolite()" onClick="logVariable('pregprefix')" href="../../_variables/pregprefix.html">$pregprefix</a> = <a class="phpfunction" onClick="logFunction('preg_quote')" href="../../_functions/preg_quote.html" onMouseOver="phpfuncPopup(event,'preg_quote')">preg_quote</a>(<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_prefix')" href="../../_functions/get_prefix.html" onMouseOver="funcPopup(event,'get_prefix')">get_prefix</a>(), '/');
<a name="l45"><span class="linenum">  45</span></a>  
<a name="l46"><span class="linenum">  46</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SHOW FULL TABLES LIKE '<a class="var it29608" onMouseOver="hilite(29608)" onMouseOut="lolite()" onClick="logVariable('patprefix')" href="../../_variables/patprefix.html">$patprefix</a>%'&quot;;
<a name="l47"><span class="linenum">  47</span></a>      <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l48"><span class="linenum">  48</span></a>      foreach (<a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>) {
<a name="l49"><span class="linenum">  49</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a> = <a class="phpfunction" onClick="logFunction('array_change_key_case')" href="../../_functions/array_change_key_case.html" onMouseOver="phpfuncPopup(event,'array_change_key_case')">array_change_key_case</a>((array)<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>, CASE_LOWER);
<a name="l50"><span class="linenum">  50</span></a>          <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a> = <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>['table_type'];
<a name="l51"><span class="linenum">  51</span></a>          unset(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>['table_type']);
<a name="l52"><span class="linenum">  52</span></a>          <a class="var it370" onMouseOver="hilite(370)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../../_variables/fullname.html">$fullname</a> = <a class="phpfunction" onClick="logFunction('array_shift')" href="../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>);
<a name="l53"><span class="linenum">  53</span></a>  
<a name="l54"><span class="linenum">  54</span></a>          if (<a class="var it29609" onMouseOver="hilite(29609)" onMouseOut="lolite()" onClick="logVariable('pregprefix')" href="../../_variables/pregprefix.html">$pregprefix</a> === '') {
<a name="l55"><span class="linenum">  55</span></a>              <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a> = <a class="var it370" onMouseOver="hilite(370)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../../_variables/fullname.html">$fullname</a>;
<a name="l56"><span class="linenum">  56</span></a>          } else {
<a name="l57"><span class="linenum">  57</span></a>              <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> = null;
<a name="l58"><span class="linenum">  58</span></a>              <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a> = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>(&quot;/^<a class="var it29609" onMouseOver="hilite(29609)" onMouseOut="lolite()" onClick="logVariable('pregprefix')" href="../../_variables/pregprefix.html">$pregprefix</a>/&quot;, '', <a class="var it370" onMouseOver="hilite(370)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../../_variables/fullname.html">$fullname</a>, -1, <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a>);
<a name="l59"><span class="linenum">  59</span></a>              if (<a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> !== 1) {
<a name="l60"><span class="linenum">  60</span></a>                  continue;
<a name="l61"><span class="linenum">  61</span></a>              }
<a name="l62"><span class="linenum">  62</span></a>          }
<a name="l63"><span class="linenum">  63</span></a>  
<a name="l64"><span class="linenum">  64</span></a>          if (!<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>(&quot;/^[a-z][a-z0-9_]*$/&quot;, <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a>)) {
<a name="l65"><span class="linenum">  65</span></a>              echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('notification')" href="../../_functions/notification.html" onMouseOver="funcPopup(event,'notification')">notification</a>(&quot;Database table with invalid name '<a class="var it370" onMouseOver="hilite(370)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../../_variables/fullname.html">$fullname</a>' detected, skipping.&quot;, 'notifyproblem');
<a name="l66"><span class="linenum">  66</span></a>              continue;
<a name="l67"><span class="linenum">  67</span></a>          }
<a name="l68"><span class="linenum">  68</span></a>          if (<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a> === 'VIEW') {
<a name="l69"><span class="linenum">  69</span></a>              echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('notification')" href="../../_functions/notification.html" onMouseOver="funcPopup(event,'notification')">notification</a>(&quot;Unsupported database table view '<a class="var it370" onMouseOver="hilite(370)" onMouseOut="lolite()" onClick="logVariable('fullname')" href="../../_variables/fullname.html">$fullname</a>' detected, skipping.&quot;, 'notifyproblem');
<a name="l70"><span class="linenum">  70</span></a>              continue;
<a name="l71"><span class="linenum">  71</span></a>          }
<a name="l72"><span class="linenum">  72</span></a>          <a class="var it1093" onMouseOver="hilite(1093)" onMouseOut="lolite()" onClick="logVariable('tables')" href="../../_variables/tables.html">$tables</a>[<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a>] = <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a>;
<a name="l73"><span class="linenum">  73</span></a>      }
<a name="l74"><span class="linenum">  74</span></a>      <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l75"><span class="linenum">  75</span></a>  
<a name="l76"><span class="linenum">  76</span></a>      return <a class="var it1093" onMouseOver="hilite(1093)" onMouseOut="lolite()" onClick="logVariable('tables')" href="../../_variables/tables.html">$tables</a>;
<a name="l77"><span class="linenum">  77</span></a>  }
<a name="l78"><span class="linenum">  78</span></a>  
<a name="l79"><span class="linenum">  79</span></a>  <span class="comment">/**</span>
<a name="l80"><span class="linenum">  80</span></a>  <span class="comment"> * Using data for a single course-module that has groupmembersonly enabled,</span>
<a name="l81"><span class="linenum">  81</span></a>  <span class="comment"> * returns the new availability value that incorporates the correct</span>
<a name="l82"><span class="linenum">  82</span></a>  <span class="comment"> * groupmembersonly option.</span>
<a name="l83"><span class="linenum">  83</span></a>  <span class="comment"> *</span>
<a name="l84"><span class="linenum">  84</span></a>  <span class="comment"> * Included as a function so that it can be shared between upgrade and restore,</span>
<a name="l85"><span class="linenum">  85</span></a>  <span class="comment"> * and unit-tested.</span>
<a name="l86"><span class="linenum">  86</span></a>  <span class="comment"> *</span>
<a name="l87"><span class="linenum">  87</span></a>  <span class="comment"> * @param int $groupingid Grouping id for the course-module (0 if none)</span>
<a name="l88"><span class="linenum">  88</span></a>  <span class="comment"> * @param string $availability Availability JSON data for the module (null if none)</span>
<a name="l89"><span class="linenum">  89</span></a>  <span class="comment"> * @return string New value for availability for the module</span>
<a name="l90"><span class="linenum">  90</span></a>  <span class="comment"> */</span>
<a name="l91"><span class="linenum">  91</span></a>  function <a class="function" onClick="logFunction('upgrade_group_members_only')" href="../../_functions/upgrade_group_members_only.html" onMouseOver="funcPopup(event,'upgrade_group_members_only')">upgrade_group_members_only</a>(<a class="var it680" onMouseOver="hilite(680)" onMouseOut="lolite()" onClick="logVariable('groupingid')" href="../../_variables/groupingid.html">$groupingid</a>, <a class="var it8486" onMouseOver="hilite(8486)" onMouseOut="lolite()" onClick="logVariable('availability')" href="../../_variables/availability.html">$availability</a>) {
<a name="l92"><span class="linenum">  92</span></a>  <span class="comment">    // Work out the new JSON object representing this option.</span>
<a name="l93"><span class="linenum">  93</span></a>      if (<a class="var it680" onMouseOver="hilite(680)" onMouseOut="lolite()" onClick="logVariable('groupingid')" href="../../_variables/groupingid.html">$groupingid</a>) {
<a name="l94"><span class="linenum">  94</span></a>  <span class="comment">        // Require specific grouping.</span>
<a name="l95"><span class="linenum">  95</span></a>          <a class="var it323" onMouseOver="hilite(323)" onMouseOut="lolite()" onClick="logVariable('condition')" href="../../_variables/condition.html">$condition</a> = (object)array('type' =&gt; 'grouping', 'id' =&gt; (int)<a class="var it680" onMouseOver="hilite(680)" onMouseOut="lolite()" onClick="logVariable('groupingid')" href="../../_variables/groupingid.html">$groupingid</a>);
<a name="l96"><span class="linenum">  96</span></a>      } else {
<a name="l97"><span class="linenum">  97</span></a>  <span class="comment">        // No grouping specified, so require membership of any group.</span>
<a name="l98"><span class="linenum">  98</span></a>          <a class="var it323" onMouseOver="hilite(323)" onMouseOut="lolite()" onClick="logVariable('condition')" href="../../_variables/condition.html">$condition</a> = (object)array('type' =&gt; 'group');
<a name="l99"><span class="linenum">  99</span></a>      }
<a name="l100"><span class="linenum"> 100</span></a>  
<a name="l101"><span class="linenum"> 101</span></a>      if (<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it8486" onMouseOver="hilite(8486)" onMouseOut="lolite()" onClick="logVariable('availability')" href="../../_variables/availability.html">$availability</a>)) {
<a name="l102"><span class="linenum"> 102</span></a>  <span class="comment">        // If there are no conditions using the new API then just set it.</span>
<a name="l103"><span class="linenum"> 103</span></a>          <a class="var it2105" onMouseOver="hilite(2105)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a> = (object)array('op' =&gt; '&amp;', 'c' =&gt; array(<a class="var it323" onMouseOver="hilite(323)" onMouseOut="lolite()" onClick="logVariable('condition')" href="../../_variables/condition.html">$condition</a>), 'showc' =&gt; array(false));
<a name="l104"><span class="linenum"> 104</span></a>      } else {
<a name="l105"><span class="linenum"> 105</span></a>  <span class="comment">        // There are existing conditions.</span>
<a name="l106"><span class="linenum"> 106</span></a>          <a class="var it2105" onMouseOver="hilite(2105)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a> = json_decode(<a class="var it8486" onMouseOver="hilite(8486)" onMouseOut="lolite()" onClick="logVariable('availability')" href="../../_variables/availability.html">$availability</a>);
<a name="l107"><span class="linenum"> 107</span></a>          switch (<a class="var it2105" onMouseOver="hilite(2105)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>-&gt;<a onClick="logVariable('op')" class="var it43539" onMouseOver="hilite(43539)" onMouseOut="lolite()" href="../../_variables/op.html">op</a>) {
<a name="l108"><span class="linenum"> 108</span></a>              case '&amp;' :
<a name="l109"><span class="linenum"> 109</span></a>  <span class="comment">                // For &amp; conditions we can just add this one.</span>
<a name="l110"><span class="linenum"> 110</span></a>                  <a class="var it2105" onMouseOver="hilite(2105)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>-&gt;<a onClick="logVariable('c')" class="var it43539" onMouseOver="hilite(43539)" onMouseOut="lolite()" href="../../_variables/c.html">c</a>[] = <a class="var it323" onMouseOver="hilite(323)" onMouseOut="lolite()" onClick="logVariable('condition')" href="../../_variables/condition.html">$condition</a>;
<a name="l111"><span class="linenum"> 111</span></a>                  <a class="var it2105" onMouseOver="hilite(2105)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>-&gt;<a onClick="logVariable('showc')" class="var it43539" onMouseOver="hilite(43539)" onMouseOut="lolite()" href="../../_variables/showc.html">showc</a>[] = false;
<a name="l112"><span class="linenum"> 112</span></a>                  break;
<a name="l113"><span class="linenum"> 113</span></a>              case '!|' :
<a name="l114"><span class="linenum"> 114</span></a>  <span class="comment">                // For 'not or' conditions we can add this one</span>
<a name="l115"><span class="linenum"> 115</span></a>  <span class="comment">                // but negated.</span>
<a name="l116"><span class="linenum"> 116</span></a>                  <a class="var it2105" onMouseOver="hilite(2105)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>-&gt;<a onClick="logVariable('c')" class="var it43539" onMouseOver="hilite(43539)" onMouseOut="lolite()" href="../../_variables/c.html">c</a>[] = (object)array('op' =&gt; '!&amp;', 'c' =&gt; array(<a class="var it323" onMouseOver="hilite(323)" onMouseOut="lolite()" onClick="logVariable('condition')" href="../../_variables/condition.html">$condition</a>));
<a name="l117"><span class="linenum"> 117</span></a>                  <a class="var it2105" onMouseOver="hilite(2105)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>-&gt;<a onClick="logVariable('showc')" class="var it43539" onMouseOver="hilite(43539)" onMouseOut="lolite()" href="../../_variables/showc.html">showc</a>[] = false;
<a name="l118"><span class="linenum"> 118</span></a>                  break;
<a name="l119"><span class="linenum"> 119</span></a>              default:
<a name="l120"><span class="linenum"> 120</span></a>  <span class="comment">                // For the other two (OR and NOT AND) we have to add</span>
<a name="l121"><span class="linenum"> 121</span></a>  <span class="comment">                // an extra level to the tree.</span>
<a name="l122"><span class="linenum"> 122</span></a>                  <a class="var it2105" onMouseOver="hilite(2105)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a> = (object)array('op' =&gt; '&amp;', 'c' =&gt; array(<a class="var it2105" onMouseOver="hilite(2105)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>, <a class="var it323" onMouseOver="hilite(323)" onMouseOut="lolite()" onClick="logVariable('condition')" href="../../_variables/condition.html">$condition</a>),
<a name="l123"><span class="linenum"> 123</span></a>                          'showc' =&gt; array(<a class="var it2105" onMouseOver="hilite(2105)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>-&gt;<a onClick="logVariable('show')" class="var it43539" onMouseOver="hilite(43539)" onMouseOut="lolite()" href="../../_variables/show.html">show</a>, false));
<a name="l124"><span class="linenum"> 124</span></a>  <span class="comment">                // Inner trees do not have a show option, so remove it.</span>
<a name="l125"><span class="linenum"> 125</span></a>                  unset(<a class="var it2105" onMouseOver="hilite(2105)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>-&gt;<a onClick="logVariable('c')" class="var it43539" onMouseOver="hilite(43539)" onMouseOut="lolite()" href="../../_variables/c.html">c</a>[0]-&gt;show);
<a name="l126"><span class="linenum"> 126</span></a>                  break;
<a name="l127"><span class="linenum"> 127</span></a>          }
<a name="l128"><span class="linenum"> 128</span></a>      }
<a name="l129"><span class="linenum"> 129</span></a>  
<a name="l130"><span class="linenum"> 130</span></a>      return <a class="function" onClick="logFunction('json_encode')" href="../../_functions/json_encode.html" onMouseOver="funcPopup(event,'json_encode')">json_encode</a>(<a class="var it2105" onMouseOver="hilite(2105)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>);
<a name="l131"><span class="linenum"> 131</span></a>  }
<a name="l132"><span class="linenum"> 132</span></a>  
<a name="l133"><span class="linenum"> 133</span></a>  <span class="comment">/**</span>
<a name="l134"><span class="linenum"> 134</span></a>  <span class="comment"> * Updates the mime-types for files that exist in the database, based on their</span>
<a name="l135"><span class="linenum"> 135</span></a>  <span class="comment"> * file extension.</span>
<a name="l136"><span class="linenum"> 136</span></a>  <span class="comment"> *</span>
<a name="l137"><span class="linenum"> 137</span></a>  <span class="comment"> * @param array $filetypes Array with file extension as the key, and mimetype as the value</span>
<a name="l138"><span class="linenum"> 138</span></a>  <span class="comment"> */</span>
<a name="l139"><span class="linenum"> 139</span></a>  function <a class="function" onClick="logFunction('upgrade_mimetypes')" href="../../_functions/upgrade_mimetypes.html" onMouseOver="funcPopup(event,'upgrade_mimetypes')">upgrade_mimetypes</a>(<a class="var it29610" onMouseOver="hilite(29610)" onMouseOut="lolite()" onClick="logVariable('filetypes')" href="../../_variables/filetypes.html">$filetypes</a>) {
<a name="l140"><span class="linenum"> 140</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l141"><span class="linenum"> 141</span></a>      <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_like')" href="../../_functions/sql_like.html" onMouseOver="funcPopup(event,'sql_like')">sql_like</a>('filename', '?', false);
<a name="l142"><span class="linenum"> 142</span></a>      foreach (<a class="var it29610" onMouseOver="hilite(29610)" onMouseOut="lolite()" onClick="logVariable('filetypes')" href="../../_variables/filetypes.html">$filetypes</a> as <a class="var it2554" onMouseOver="hilite(2554)" onMouseOut="lolite()" onClick="logVariable('extension')" href="../../_variables/extension.html">$extension</a>=&gt;<a class="var it3340" onMouseOver="hilite(3340)" onMouseOut="lolite()" onClick="logVariable('mimetype')" href="../../_variables/mimetype.html">$mimetype</a>) {
<a name="l143"><span class="linenum"> 143</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field_select')" href="../../_functions/set_field_select.html" onMouseOver="funcPopup(event,'set_field_select')">set_field_select</a>(
<a name="l144"><span class="linenum"> 144</span></a>              'files',
<a name="l145"><span class="linenum"> 145</span></a>              'mimetype',
<a name="l146"><span class="linenum"> 146</span></a>              <a class="var it3340" onMouseOver="hilite(3340)" onMouseOut="lolite()" onClick="logVariable('mimetype')" href="../../_variables/mimetype.html">$mimetype</a>,
<a name="l147"><span class="linenum"> 147</span></a>              <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a>,
<a name="l148"><span class="linenum"> 148</span></a>              array(<a class="var it2554" onMouseOver="hilite(2554)" onMouseOut="lolite()" onClick="logVariable('extension')" href="../../_variables/extension.html">$extension</a>)
<a name="l149"><span class="linenum"> 149</span></a>          );
<a name="l150"><span class="linenum"> 150</span></a>      }
<a name="l151"><span class="linenum"> 151</span></a>  }
<a name="l152"><span class="linenum"> 152</span></a>  
<a name="l153"><span class="linenum"> 153</span></a>  <span class="comment">/**</span>
<a name="l154"><span class="linenum"> 154</span></a>  <span class="comment"> * Marks all courses with changes in extra credit weight calculation</span>
<a name="l155"><span class="linenum"> 155</span></a>  <span class="comment"> *</span>
<a name="l156"><span class="linenum"> 156</span></a>  <span class="comment"> * Used during upgrade and in course restore process</span>
<a name="l157"><span class="linenum"> 157</span></a>  <span class="comment"> *</span>
<a name="l158"><span class="linenum"> 158</span></a>  <span class="comment"> * This upgrade script is needed because we changed the algorithm for calculating the automatic weights of extra</span>
<a name="l159"><span class="linenum"> 159</span></a>  <span class="comment"> * credit items and want to prevent changes in the existing student grades.</span>
<a name="l160"><span class="linenum"> 160</span></a>  <span class="comment"> *</span>
<a name="l161"><span class="linenum"> 161</span></a>  <span class="comment"> * @param int $onlycourseid</span>
<a name="l162"><span class="linenum"> 162</span></a>  <span class="comment"> */</span>
<a name="l163"><span class="linenum"> 163</span></a>  function <a class="function" onClick="logFunction('upgrade_extra_credit_weightoverride')" href="../../_functions/upgrade_extra_credit_weightoverride.html" onMouseOver="funcPopup(event,'upgrade_extra_credit_weightoverride')">upgrade_extra_credit_weightoverride</a>(<a class="var it29611" onMouseOver="hilite(29611)" onMouseOut="lolite()" onClick="logVariable('onlycourseid')" href="../../_variables/onlycourseid.html">$onlycourseid</a> = 0) {
<a name="l164"><span class="linenum"> 164</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l165"><span class="linenum"> 165</span></a>  
<a name="l166"><span class="linenum"> 166</span></a>  <span class="comment">    // Find all courses that have categories in Natural aggregation method where there is at least one extra credit</span>
<a name="l167"><span class="linenum"> 167</span></a>  <span class="comment">    // item and at least one item with overridden weight.</span>
<a name="l168"><span class="linenum"> 168</span></a>      <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_fieldset_sql')" href="../../_functions/get_fieldset_sql.html" onMouseOver="funcPopup(event,'get_fieldset_sql')">get_fieldset_sql</a>(
<a name="l169"><span class="linenum"> 169</span></a>          &quot;SELECT DISTINCT gc.courseid
<a name="l170"><span class="linenum"> 170</span></a>            FROM {grade_categories} gc
<a name="l171"><span class="linenum"> 171</span></a>            INNER JOIN {grade_items} gi ON gc.id = gi.categoryid AND gi.weightoverride = :weightoverriden
<a name="l172"><span class="linenum"> 172</span></a>            INNER JOIN {grade_items} gie ON gc.id = gie.categoryid AND gie.aggregationcoef = :extracredit
<a name="l173"><span class="linenum"> 173</span></a>            WHERE gc.aggregation = :naturalaggmethod&quot; . (<a class="var it29611" onMouseOver="hilite(29611)" onMouseOut="lolite()" onClick="logVariable('onlycourseid')" href="../../_variables/onlycourseid.html">$onlycourseid</a> ? &quot; AND gc.courseid = :onlycourseid&quot; : ''),
<a name="l174"><span class="linenum"> 174</span></a>          array('naturalaggmethod' =&gt; 13,
<a name="l175"><span class="linenum"> 175</span></a>              'weightoverriden' =&gt; 1,
<a name="l176"><span class="linenum"> 176</span></a>              'extracredit' =&gt; 1,
<a name="l177"><span class="linenum"> 177</span></a>              'onlycourseid' =&gt; <a class="var it29611" onMouseOver="hilite(29611)" onMouseOut="lolite()" onClick="logVariable('onlycourseid')" href="../../_variables/onlycourseid.html">$onlycourseid</a>,
<a name="l178"><span class="linenum"> 178</span></a>          )
<a name="l179"><span class="linenum"> 179</span></a>      );
<a name="l180"><span class="linenum"> 180</span></a>      foreach (<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> as <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>) {
<a name="l181"><span class="linenum"> 181</span></a>          <a class="var it29612" onMouseOver="hilite(29612)" onMouseOut="lolite()" onClick="logVariable('gradebookfreeze')" href="../../_variables/gradebookfreeze.html">$gradebookfreeze</a> = <a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('core', 'gradebook_calculations_freeze_' . <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l182"><span class="linenum"> 182</span></a>          if (!<a class="var it29612" onMouseOver="hilite(29612)" onMouseOut="lolite()" onClick="logVariable('gradebookfreeze')" href="../../_variables/gradebookfreeze.html">$gradebookfreeze</a>) {
<a name="l183"><span class="linenum"> 183</span></a>              <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('gradebook_calculations_freeze_' . <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, 20150619);
<a name="l184"><span class="linenum"> 184</span></a>          }
<a name="l185"><span class="linenum"> 185</span></a>      }
<a name="l186"><span class="linenum"> 186</span></a>  }
<a name="l187"><span class="linenum"> 187</span></a>  
<a name="l188"><span class="linenum"> 188</span></a>  <span class="comment">/**</span>
<a name="l189"><span class="linenum"> 189</span></a>  <span class="comment"> * Marks all courses that require calculated grade items be updated.</span>
<a name="l190"><span class="linenum"> 190</span></a>  <span class="comment"> *</span>
<a name="l191"><span class="linenum"> 191</span></a>  <span class="comment"> * Used during upgrade and in course restore process.</span>
<a name="l192"><span class="linenum"> 192</span></a>  <span class="comment"> *</span>
<a name="l193"><span class="linenum"> 193</span></a>  <span class="comment"> * This upgrade script is needed because the calculated grade items were stuck with a maximum of 100 and could be changed.</span>
<a name="l194"><span class="linenum"> 194</span></a>  <span class="comment"> * This flags the courses that are affected and the grade book is frozen to retain grade integrity.</span>
<a name="l195"><span class="linenum"> 195</span></a>  <span class="comment"> *</span>
<a name="l196"><span class="linenum"> 196</span></a>  <span class="comment"> * @param int $courseid Specify a course ID to run this script on just one course.</span>
<a name="l197"><span class="linenum"> 197</span></a>  <span class="comment"> */</span>
<a name="l198"><span class="linenum"> 198</span></a>  function <a class="function" onClick="logFunction('upgrade_calculated_grade_items')" href="../../_functions/upgrade_calculated_grade_items.html" onMouseOver="funcPopup(event,'upgrade_calculated_grade_items')">upgrade_calculated_grade_items</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> = null) {
<a name="l199"><span class="linenum"> 199</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l200"><span class="linenum"> 200</span></a>  
<a name="l201"><span class="linenum"> 201</span></a>      <a class="var it8105" onMouseOver="hilite(8105)" onMouseOut="lolite()" onClick="logVariable('affectedcourses')" href="../../_variables/affectedcourses.html">$affectedcourses</a> = array();
<a name="l202"><span class="linenum"> 202</span></a>      <a class="var it29613" onMouseOver="hilite(29613)" onMouseOut="lolite()" onClick="logVariable('possiblecourseids')" href="../../_variables/possiblecourseids.html">$possiblecourseids</a> = array();
<a name="l203"><span class="linenum"> 203</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array();
<a name="l204"><span class="linenum"> 204</span></a>      <a class="var it29614" onMouseOver="hilite(29614)" onMouseOut="lolite()" onClick="logVariable('singlecoursesql')" href="../../_variables/singlecoursesql.html">$singlecoursesql</a> = '';
<a name="l205"><span class="linenum"> 205</span></a>      if (isset(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>)) {
<a name="l206"><span class="linenum"> 206</span></a>          <a class="var it29614" onMouseOver="hilite(29614)" onMouseOut="lolite()" onClick="logVariable('singlecoursesql')" href="../../_variables/singlecoursesql.html">$singlecoursesql</a> = &quot;AND ns.id = :courseid&quot;;
<a name="l207"><span class="linenum"> 207</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['courseid'] = <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>;
<a name="l208"><span class="linenum"> 208</span></a>      }
<a name="l209"><span class="linenum"> 209</span></a>      <a class="var it29615" onMouseOver="hilite(29615)" onMouseOut="lolite()" onClick="logVariable('siteminmaxtouse')" href="../../_variables/siteminmaxtouse.html">$siteminmaxtouse</a> = 1;
<a name="l210"><span class="linenum"> 210</span></a>      if (isset(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('grade_minmaxtouse')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/grade_minmaxtouse.html">grade_minmaxtouse</a>)) {
<a name="l211"><span class="linenum"> 211</span></a>          <a class="var it29615" onMouseOver="hilite(29615)" onMouseOut="lolite()" onClick="logVariable('siteminmaxtouse')" href="../../_variables/siteminmaxtouse.html">$siteminmaxtouse</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('grade_minmaxtouse')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/grade_minmaxtouse.html">grade_minmaxtouse</a>;
<a name="l212"><span class="linenum"> 212</span></a>      }
<a name="l213"><span class="linenum"> 213</span></a>      <a class="var it29616" onMouseOver="hilite(29616)" onMouseOut="lolite()" onClick="logVariable('courseidsql')" href="../../_variables/courseidsql.html">$courseidsql</a> = &quot;SELECT ns.id
<a name="l214"><span class="linenum"> 214</span></a>                        FROM (
<a name="l215"><span class="linenum"> 215</span></a>                          SELECT c.id, coalesce(&quot; . <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_compare_text')" href="../../_functions/sql_compare_text.html" onMouseOver="funcPopup(event,'sql_compare_text')">sql_compare_text</a>('gs.value') . &quot;, :siteminmax) AS gradevalue
<a name="l216"><span class="linenum"> 216</span></a>                            FROM {course} c
<a name="l217"><span class="linenum"> 217</span></a>                            LEFT JOIN {grade_settings} gs
<a name="l218"><span class="linenum"> 218</span></a>                              ON c.id = gs.courseid
<a name="l219"><span class="linenum"> 219</span></a>                             AND ((gs.name = 'minmaxtouse' AND &quot; . <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_compare_text')" href="../../_functions/sql_compare_text.html" onMouseOver="funcPopup(event,'sql_compare_text')">sql_compare_text</a>('gs.value') . &quot; = '2'))
<a name="l220"><span class="linenum"> 220</span></a>                          ) ns
<a name="l221"><span class="linenum"> 221</span></a>                      WHERE &quot; . <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_compare_text')" href="../../_functions/sql_compare_text.html" onMouseOver="funcPopup(event,'sql_compare_text')">sql_compare_text</a>('ns.gradevalue') . &quot; = '2' <a class="var it29614" onMouseOver="hilite(29614)" onMouseOut="lolite()" onClick="logVariable('singlecoursesql')" href="../../_variables/singlecoursesql.html">$singlecoursesql</a>&quot;;
<a name="l222"><span class="linenum"> 222</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['siteminmax'] = <a class="var it29615" onMouseOver="hilite(29615)" onMouseOut="lolite()" onClick="logVariable('siteminmaxtouse')" href="../../_variables/siteminmaxtouse.html">$siteminmaxtouse</a>;
<a name="l223"><span class="linenum"> 223</span></a>      <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it29616" onMouseOver="hilite(29616)" onMouseOut="lolite()" onClick="logVariable('courseidsql')" href="../../_variables/courseidsql.html">$courseidsql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l224"><span class="linenum"> 224</span></a>      foreach (<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> as <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) {
<a name="l225"><span class="linenum"> 225</span></a>          <a class="var it29613" onMouseOver="hilite(29613)" onMouseOut="lolite()" onClick="logVariable('possiblecourseids')" href="../../_variables/possiblecourseids.html">$possiblecourseids</a>[<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l226"><span class="linenum"> 226</span></a>      }
<a name="l227"><span class="linenum"> 227</span></a>  
<a name="l228"><span class="linenum"> 228</span></a>      if (!empty(<a class="var it29613" onMouseOver="hilite(29613)" onMouseOut="lolite()" onClick="logVariable('possiblecourseids')" href="../../_variables/possiblecourseids.html">$possiblecourseids</a>)) {
<a name="l229"><span class="linenum"> 229</span></a>          <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it29613" onMouseOver="hilite(29613)" onMouseOut="lolite()" onClick="logVariable('possiblecourseids')" href="../../_variables/possiblecourseids.html">$possiblecourseids</a>);
<a name="l230"><span class="linenum"> 230</span></a>  <span class="comment">        // A calculated grade item grade min != 0 and grade max != 100 and the course setting is set to</span>
<a name="l231"><span class="linenum"> 231</span></a>  <span class="comment">        // &quot;Initial min and max grades&quot;.</span>
<a name="l232"><span class="linenum"> 232</span></a>          <a class="var it4194" onMouseOver="hilite(4194)" onMouseOut="lolite()" onClick="logVariable('coursesql')" href="../../_variables/coursesql.html">$coursesql</a> = &quot;SELECT DISTINCT courseid
<a name="l233"><span class="linenum"> 233</span></a>                          FROM {grade_items}
<a name="l234"><span class="linenum"> 234</span></a>                         WHERE calculation IS NOT NULL
<a name="l235"><span class="linenum"> 235</span></a>                           AND itemtype = 'manual'
<a name="l236"><span class="linenum"> 236</span></a>                           AND (grademax &lt;&gt; 100 OR grademin &lt;&gt; 0)
<a name="l237"><span class="linenum"> 237</span></a>                           AND courseid <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>&quot;;
<a name="l238"><span class="linenum"> 238</span></a>          <a class="var it8105" onMouseOver="hilite(8105)" onMouseOut="lolite()" onClick="logVariable('affectedcourses')" href="../../_variables/affectedcourses.html">$affectedcourses</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it4194" onMouseOver="hilite(4194)" onMouseOut="lolite()" onClick="logVariable('coursesql')" href="../../_variables/coursesql.html">$coursesql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l239"><span class="linenum"> 239</span></a>      }
<a name="l240"><span class="linenum"> 240</span></a>  
<a name="l241"><span class="linenum"> 241</span></a>  <span class="comment">    // Check for second type of affected courses.</span>
<a name="l242"><span class="linenum"> 242</span></a>  <span class="comment">    // If we already have the courseid parameter set in the affectedcourses then there is no need to run through this section.</span>
<a name="l243"><span class="linenum"> 243</span></a>      if (!isset(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>) || !<a class="phpfunction" onClick="logFunction('in_array')" href="../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it8105" onMouseOver="hilite(8105)" onMouseOut="lolite()" onClick="logVariable('affectedcourses')" href="../../_variables/affectedcourses.html">$affectedcourses</a>)) {
<a name="l244"><span class="linenum"> 244</span></a>          <a class="var it29614" onMouseOver="hilite(29614)" onMouseOut="lolite()" onClick="logVariable('singlecoursesql')" href="../../_variables/singlecoursesql.html">$singlecoursesql</a> = '';
<a name="l245"><span class="linenum"> 245</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array();
<a name="l246"><span class="linenum"> 246</span></a>          if (isset(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>)) {
<a name="l247"><span class="linenum"> 247</span></a>              <a class="var it29614" onMouseOver="hilite(29614)" onMouseOut="lolite()" onClick="logVariable('singlecoursesql')" href="../../_variables/singlecoursesql.html">$singlecoursesql</a> = &quot;AND courseid = :courseid&quot;;
<a name="l248"><span class="linenum"> 248</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['courseid'] = <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>;
<a name="l249"><span class="linenum"> 249</span></a>          }
<a name="l250"><span class="linenum"> 250</span></a>          <a class="var it29617" onMouseOver="hilite(29617)" onMouseOut="lolite()" onClick="logVariable('nestedsql')" href="../../_variables/nestedsql.html">$nestedsql</a> = &quot;SELECT id
<a name="l251"><span class="linenum"> 251</span></a>                          FROM {grade_items}
<a name="l252"><span class="linenum"> 252</span></a>                         WHERE itemtype = 'category'
<a name="l253"><span class="linenum"> 253</span></a>                           AND calculation IS NOT NULL <a class="var it29614" onMouseOver="hilite(29614)" onMouseOut="lolite()" onClick="logVariable('singlecoursesql')" href="../../_variables/singlecoursesql.html">$singlecoursesql</a>&quot;;
<a name="l254"><span class="linenum"> 254</span></a>          <a class="var it29618" onMouseOver="hilite(29618)" onMouseOut="lolite()" onClick="logVariable('calculatedgradecategories')" href="../../_variables/calculatedgradecategories.html">$calculatedgradecategories</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it29617" onMouseOver="hilite(29617)" onMouseOut="lolite()" onClick="logVariable('nestedsql')" href="../../_variables/nestedsql.html">$nestedsql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l255"><span class="linenum"> 255</span></a>          <a class="var it2415" onMouseOver="hilite(2415)" onMouseOut="lolite()" onClick="logVariable('categoryids')" href="../../_variables/categoryids.html">$categoryids</a> = array();
<a name="l256"><span class="linenum"> 256</span></a>          foreach (<a class="var it29618" onMouseOver="hilite(29618)" onMouseOut="lolite()" onClick="logVariable('calculatedgradecategories')" href="../../_variables/calculatedgradecategories.html">$calculatedgradecategories</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> =&gt; <a class="var it2469" onMouseOver="hilite(2469)" onMouseOut="lolite()" onClick="logVariable('gradecategory')" href="../../_variables/gradecategory.html">$gradecategory</a>) {
<a name="l257"><span class="linenum"> 257</span></a>              <a class="var it2415" onMouseOver="hilite(2415)" onMouseOut="lolite()" onClick="logVariable('categoryids')" href="../../_variables/categoryids.html">$categoryids</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>] = <a class="var it2469" onMouseOver="hilite(2469)" onMouseOut="lolite()" onClick="logVariable('gradecategory')" href="../../_variables/gradecategory.html">$gradecategory</a>-&gt;<a onClick="logVariable('id')" class="var it43844" onMouseOver="hilite(43844)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l258"><span class="linenum"> 258</span></a>          }
<a name="l259"><span class="linenum"> 259</span></a>  
<a name="l260"><span class="linenum"> 260</span></a>          if (!empty(<a class="var it2415" onMouseOver="hilite(2415)" onMouseOut="lolite()" onClick="logVariable('categoryids')" href="../../_variables/categoryids.html">$categoryids</a>)) {
<a name="l261"><span class="linenum"> 261</span></a>              <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it2415" onMouseOver="hilite(2415)" onMouseOut="lolite()" onClick="logVariable('categoryids')" href="../../_variables/categoryids.html">$categoryids</a>);
<a name="l262"><span class="linenum"> 262</span></a>  <span class="comment">            // A category with a calculation where the raw grade min and the raw grade max don't match the grade min and grade max</span>
<a name="l263"><span class="linenum"> 263</span></a>  <span class="comment">            // for the category.</span>
<a name="l264"><span class="linenum"> 264</span></a>              <a class="var it4194" onMouseOver="hilite(4194)" onMouseOut="lolite()" onClick="logVariable('coursesql')" href="../../_variables/coursesql.html">$coursesql</a> = &quot;SELECT DISTINCT gi.courseid
<a name="l265"><span class="linenum"> 265</span></a>                              FROM {grade_grades} gg, {grade_items} gi
<a name="l266"><span class="linenum"> 266</span></a>                             WHERE gi.id = gg.itemid
<a name="l267"><span class="linenum"> 267</span></a>                               AND (gg.rawgrademax &lt;&gt; gi.grademax OR gg.rawgrademin &lt;&gt; gi.grademin)
<a name="l268"><span class="linenum"> 268</span></a>                               AND gi.id <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>&quot;;
<a name="l269"><span class="linenum"> 269</span></a>              <a class="var it29619" onMouseOver="hilite(29619)" onMouseOut="lolite()" onClick="logVariable('additionalcourses')" href="../../_variables/additionalcourses.html">$additionalcourses</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it4194" onMouseOver="hilite(4194)" onMouseOut="lolite()" onClick="logVariable('coursesql')" href="../../_variables/coursesql.html">$coursesql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l270"><span class="linenum"> 270</span></a>              foreach (<a class="var it29619" onMouseOver="hilite(29619)" onMouseOut="lolite()" onClick="logVariable('additionalcourses')" href="../../_variables/additionalcourses.html">$additionalcourses</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> =&gt; <a class="var it29620" onMouseOver="hilite(29620)" onMouseOut="lolite()" onClick="logVariable('additionalcourse')" href="../../_variables/additionalcourse.html">$additionalcourse</a>) {
<a name="l271"><span class="linenum"> 271</span></a>                  if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>, <a class="var it8105" onMouseOver="hilite(8105)" onMouseOut="lolite()" onClick="logVariable('affectedcourses')" href="../../_variables/affectedcourses.html">$affectedcourses</a>)) {
<a name="l272"><span class="linenum"> 272</span></a>                      <a class="var it8105" onMouseOver="hilite(8105)" onMouseOut="lolite()" onClick="logVariable('affectedcourses')" href="../../_variables/affectedcourses.html">$affectedcourses</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>] = <a class="var it29620" onMouseOver="hilite(29620)" onMouseOut="lolite()" onClick="logVariable('additionalcourse')" href="../../_variables/additionalcourse.html">$additionalcourse</a>;
<a name="l273"><span class="linenum"> 273</span></a>                  }
<a name="l274"><span class="linenum"> 274</span></a>              }
<a name="l275"><span class="linenum"> 275</span></a>          }
<a name="l276"><span class="linenum"> 276</span></a>      }
<a name="l277"><span class="linenum"> 277</span></a>  
<a name="l278"><span class="linenum"> 278</span></a>      foreach (<a class="var it8105" onMouseOver="hilite(8105)" onMouseOut="lolite()" onClick="logVariable('affectedcourses')" href="../../_variables/affectedcourses.html">$affectedcourses</a> as <a class="var it29621" onMouseOver="hilite(29621)" onMouseOut="lolite()" onClick="logVariable('affectedcourseid')" href="../../_variables/affectedcourseid.html">$affectedcourseid</a>) {
<a name="l279"><span class="linenum"> 279</span></a>          if (isset(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('upgrade_calculatedgradeitemsonlyregrade')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/upgrade_calculatedgradeitemsonlyregrade.html">upgrade_calculatedgradeitemsonlyregrade</a>) &amp;&amp; !(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>)) {
<a name="l280"><span class="linenum"> 280</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('grade_items', 'needsupdate', 1, array('courseid' =&gt; <a class="var it29621" onMouseOver="hilite(29621)" onMouseOut="lolite()" onClick="logVariable('affectedcourseid')" href="../../_variables/affectedcourseid.html">$affectedcourseid</a>-&gt;<a onClick="logVariable('courseid')" class="var it43845" onMouseOver="hilite(43845)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>));
<a name="l281"><span class="linenum"> 281</span></a>          } else {
<a name="l282"><span class="linenum"> 282</span></a>  <span class="comment">            // Check to see if the gradebook freeze is already in affect.</span>
<a name="l283"><span class="linenum"> 283</span></a>              <a class="var it29612" onMouseOver="hilite(29612)" onMouseOut="lolite()" onClick="logVariable('gradebookfreeze')" href="../../_variables/gradebookfreeze.html">$gradebookfreeze</a> = <a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('core', 'gradebook_calculations_freeze_' . <a class="var it29621" onMouseOver="hilite(29621)" onMouseOut="lolite()" onClick="logVariable('affectedcourseid')" href="../../_variables/affectedcourseid.html">$affectedcourseid</a>-&gt;<a onClick="logVariable('courseid')" class="var it43845" onMouseOver="hilite(43845)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l284"><span class="linenum"> 284</span></a>              if (!<a class="var it29612" onMouseOver="hilite(29612)" onMouseOut="lolite()" onClick="logVariable('gradebookfreeze')" href="../../_variables/gradebookfreeze.html">$gradebookfreeze</a>) {
<a name="l285"><span class="linenum"> 285</span></a>                  <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('gradebook_calculations_freeze_' . <a class="var it29621" onMouseOver="hilite(29621)" onMouseOut="lolite()" onClick="logVariable('affectedcourseid')" href="../../_variables/affectedcourseid.html">$affectedcourseid</a>-&gt;<a onClick="logVariable('courseid')" class="var it43845" onMouseOver="hilite(43845)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>, 20150627);
<a name="l286"><span class="linenum"> 286</span></a>              }
<a name="l287"><span class="linenum"> 287</span></a>          }
<a name="l288"><span class="linenum"> 288</span></a>      }
<a name="l289"><span class="linenum"> 289</span></a>  }
<a name="l290"><span class="linenum"> 290</span></a>  
<a name="l291"><span class="linenum"> 291</span></a>  <span class="comment">/**</span>
<a name="l292"><span class="linenum"> 292</span></a>  <span class="comment"> * This upgrade script merges all tag instances pointing to the same course tag</span>
<a name="l293"><span class="linenum"> 293</span></a>  <span class="comment"> *</span>
<a name="l294"><span class="linenum"> 294</span></a>  <span class="comment"> * User id is no longer used for those tag instances</span>
<a name="l295"><span class="linenum"> 295</span></a>  <span class="comment"> */</span>
<a name="l296"><span class="linenum"> 296</span></a>  function <a class="function" onClick="logFunction('upgrade_course_tags')" href="../../_functions/upgrade_course_tags.html" onMouseOver="funcPopup(event,'upgrade_course_tags')">upgrade_course_tags</a>() {
<a name="l297"><span class="linenum"> 297</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l298"><span class="linenum"> 298</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT <a class="phpfunction" onClick="logFunction('min')" href="../../_functions/min.html" onMouseOver="phpfuncPopup(event,'min')">min</a>(ti.id)
<a name="l299"><span class="linenum"> 299</span></a>          FROM {tag_instance} ti
<a name="l300"><span class="linenum"> 300</span></a>          LEFT JOIN {tag_instance} tii on tii.itemtype = ? and tii.itemid = ti.itemid and tii.tiuserid = 0 and tii.tagid = ti.tagid
<a name="l301"><span class="linenum"> 301</span></a>          where ti.itemtype = ? and ti.tiuserid &lt;&gt; 0 AND tii.id is null
<a name="l302"><span class="linenum"> 302</span></a>          group by ti.tagid, ti.itemid&quot;;
<a name="l303"><span class="linenum"> 303</span></a>      <a class="var it400" onMouseOver="hilite(400)" onMouseOut="lolite()" onClick="logVariable('ids')" href="../../_variables/ids.html">$ids</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_fieldset_sql')" href="../../_functions/get_fieldset_sql.html" onMouseOver="funcPopup(event,'get_fieldset_sql')">get_fieldset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array('course', 'course'));
<a name="l304"><span class="linenum"> 304</span></a>      if (<a class="var it400" onMouseOver="hilite(400)" onMouseOut="lolite()" onClick="logVariable('ids')" href="../../_variables/ids.html">$ids</a>) {
<a name="l305"><span class="linenum"> 305</span></a>          <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it9225" onMouseOver="hilite(9225)" onMouseOut="lolite()" onClick="logVariable('idsql')" href="../../_variables/idsql.html">$idsql</a>, <a class="var it9226" onMouseOver="hilite(9226)" onMouseOut="lolite()" onClick="logVariable('idparams')" href="../../_variables/idparams.html">$idparams</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it400" onMouseOver="hilite(400)" onMouseOut="lolite()" onClick="logVariable('ids')" href="../../_variables/ids.html">$ids</a>);
<a name="l306"><span class="linenum"> 306</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>('UPDATE {tag_instance} SET tiuserid = 0 WHERE id ' . <a class="var it9225" onMouseOver="hilite(9225)" onMouseOut="lolite()" onClick="logVariable('idsql')" href="../../_variables/idsql.html">$idsql</a>, <a class="var it9226" onMouseOver="hilite(9226)" onMouseOut="lolite()" onClick="logVariable('idparams')" href="../../_variables/idparams.html">$idparams</a>);
<a name="l307"><span class="linenum"> 307</span></a>      }
<a name="l308"><span class="linenum"> 308</span></a>      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(&quot;DELETE FROM {tag_instance} WHERE itemtype = ? AND tiuserid &lt;&gt; 0&quot;, array('course'));
<a name="l309"><span class="linenum"> 309</span></a>  }
<a name="l310"><span class="linenum"> 310</span></a>  
<a name="l311"><span class="linenum"> 311</span></a>  <span class="comment">/**</span>
<a name="l312"><span class="linenum"> 312</span></a>  <span class="comment"> * This function creates a default separated/connected scale</span>
<a name="l313"><span class="linenum"> 313</span></a>  <span class="comment"> * so there's something in the database.  The locations of</span>
<a name="l314"><span class="linenum"> 314</span></a>  <span class="comment"> * strings and files is a bit odd, but this is because we</span>
<a name="l315"><span class="linenum"> 315</span></a>  <span class="comment"> * need to maintain backward compatibility with many different</span>
<a name="l316"><span class="linenum"> 316</span></a>  <span class="comment"> * existing language translations and older sites.</span>
<a name="l317"><span class="linenum"> 317</span></a>  <span class="comment"> *</span>
<a name="l318"><span class="linenum"> 318</span></a>  <span class="comment"> * @global object</span>
<a name="l319"><span class="linenum"> 319</span></a>  <span class="comment"> * @return void</span>
<a name="l320"><span class="linenum"> 320</span></a>  <span class="comment"> */</span>
<a name="l321"><span class="linenum"> 321</span></a>  function <a class="function" onClick="logFunction('make_default_scale')" href="../../_functions/make_default_scale.html" onMouseOver="funcPopup(event,'make_default_scale')">make_default_scale</a>() {
<a name="l322"><span class="linenum"> 322</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l323"><span class="linenum"> 323</span></a>  
<a name="l324"><span class="linenum"> 324</span></a>      <a class="var it29623" onMouseOver="hilite(29623)" onMouseOut="lolite()" onClick="logVariable('defaultscale')" href="../../_variables/defaultscale.html">$defaultscale</a> = new stdClass();
<a name="l325"><span class="linenum"> 325</span></a>      <a class="var it29623" onMouseOver="hilite(29623)" onMouseOut="lolite()" onClick="logVariable('defaultscale')" href="../../_variables/defaultscale.html">$defaultscale</a>-&gt;<a onClick="logVariable('courseid')" class="var it43846" onMouseOver="hilite(43846)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a> = 0;
<a name="l326"><span class="linenum"> 326</span></a>      <a class="var it29623" onMouseOver="hilite(29623)" onMouseOut="lolite()" onClick="logVariable('defaultscale')" href="../../_variables/defaultscale.html">$defaultscale</a>-&gt;<a onClick="logVariable('userid')" class="var it43846" onMouseOver="hilite(43846)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> = 0;
<a name="l327"><span class="linenum"> 327</span></a>      <a class="var it29623" onMouseOver="hilite(29623)" onMouseOut="lolite()" onClick="logVariable('defaultscale')" href="../../_variables/defaultscale.html">$defaultscale</a>-&gt;<a onClick="logVariable('name')" class="var it43846" onMouseOver="hilite(43846)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>  = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('separateandconnected');
<a name="l328"><span class="linenum"> 328</span></a>      <a class="var it29623" onMouseOver="hilite(29623)" onMouseOut="lolite()" onClick="logVariable('defaultscale')" href="../../_variables/defaultscale.html">$defaultscale</a>-&gt;<a onClick="logVariable('description')" class="var it43846" onMouseOver="hilite(43846)" onMouseOut="lolite()" href="../../_variables/description.html">description</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('separateandconnectedinfo');
<a name="l329"><span class="linenum"> 329</span></a>      <a class="var it29623" onMouseOver="hilite(29623)" onMouseOut="lolite()" onClick="logVariable('defaultscale')" href="../../_variables/defaultscale.html">$defaultscale</a>-&gt;<a onClick="logVariable('scale')" class="var it43846" onMouseOver="hilite(43846)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('postrating1', 'forum').','.
<a name="l330"><span class="linenum"> 330</span></a>                             <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('postrating2', 'forum').','.
<a name="l331"><span class="linenum"> 331</span></a>                             <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('postrating3', 'forum');
<a name="l332"><span class="linenum"> 332</span></a>      <a class="var it29623" onMouseOver="hilite(29623)" onMouseOut="lolite()" onClick="logVariable('defaultscale')" href="../../_variables/defaultscale.html">$defaultscale</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43846" onMouseOver="hilite(43846)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l333"><span class="linenum"> 333</span></a>  
<a name="l334"><span class="linenum"> 334</span></a>      <a class="var it29623" onMouseOver="hilite(29623)" onMouseOut="lolite()" onClick="logVariable('defaultscale')" href="../../_variables/defaultscale.html">$defaultscale</a>-&gt;<a onClick="logVariable('id')" class="var it43846" onMouseOver="hilite(43846)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('scale', <a class="var it29623" onMouseOver="hilite(29623)" onMouseOut="lolite()" onClick="logVariable('defaultscale')" href="../../_variables/defaultscale.html">$defaultscale</a>);
<a name="l335"><span class="linenum"> 335</span></a>      return <a class="var it29623" onMouseOver="hilite(29623)" onMouseOut="lolite()" onClick="logVariable('defaultscale')" href="../../_variables/defaultscale.html">$defaultscale</a>;
<a name="l336"><span class="linenum"> 336</span></a>  }
<a name="l337"><span class="linenum"> 337</span></a>  
<a name="l338"><span class="linenum"> 338</span></a>  
<a name="l339"><span class="linenum"> 339</span></a>  <span class="comment">/**</span>
<a name="l340"><span class="linenum"> 340</span></a>  <span class="comment"> * Create another default scale.</span>
<a name="l341"><span class="linenum"> 341</span></a>  <span class="comment"> *</span>
<a name="l342"><span class="linenum"> 342</span></a>  <span class="comment"> * @param int $oldversion</span>
<a name="l343"><span class="linenum"> 343</span></a>  <span class="comment"> * @return bool always true</span>
<a name="l344"><span class="linenum"> 344</span></a>  <span class="comment"> */</span>
<a name="l345"><span class="linenum"> 345</span></a>  function <a class="function" onClick="logFunction('make_competence_scale')" href="../../_functions/make_competence_scale.html" onMouseOver="funcPopup(event,'make_competence_scale')">make_competence_scale</a>() {
<a name="l346"><span class="linenum"> 346</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l347"><span class="linenum"> 347</span></a>  
<a name="l348"><span class="linenum"> 348</span></a>      <a class="var it29623" onMouseOver="hilite(29623)" onMouseOut="lolite()" onClick="logVariable('defaultscale')" href="../../_variables/defaultscale.html">$defaultscale</a> = new stdClass();
<a name="l349"><span class="linenum"> 349</span></a>      <a class="var it29623" onMouseOver="hilite(29623)" onMouseOut="lolite()" onClick="logVariable('defaultscale')" href="../../_variables/defaultscale.html">$defaultscale</a>-&gt;<a onClick="logVariable('courseid')" class="var it43846" onMouseOver="hilite(43846)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a> = 0;
<a name="l350"><span class="linenum"> 350</span></a>      <a class="var it29623" onMouseOver="hilite(29623)" onMouseOut="lolite()" onClick="logVariable('defaultscale')" href="../../_variables/defaultscale.html">$defaultscale</a>-&gt;<a onClick="logVariable('userid')" class="var it43846" onMouseOver="hilite(43846)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> = 0;
<a name="l351"><span class="linenum"> 351</span></a>      <a class="var it29623" onMouseOver="hilite(29623)" onMouseOut="lolite()" onClick="logVariable('defaultscale')" href="../../_variables/defaultscale.html">$defaultscale</a>-&gt;<a onClick="logVariable('name')" class="var it43846" onMouseOver="hilite(43846)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>  = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('defaultcompetencescale');
<a name="l352"><span class="linenum"> 352</span></a>      <a class="var it29623" onMouseOver="hilite(29623)" onMouseOut="lolite()" onClick="logVariable('defaultscale')" href="../../_variables/defaultscale.html">$defaultscale</a>-&gt;<a onClick="logVariable('description')" class="var it43846" onMouseOver="hilite(43846)" onMouseOut="lolite()" href="../../_variables/description.html">description</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('defaultcompetencescaledesc');
<a name="l353"><span class="linenum"> 353</span></a>      <a class="var it29623" onMouseOver="hilite(29623)" onMouseOut="lolite()" onClick="logVariable('defaultscale')" href="../../_variables/defaultscale.html">$defaultscale</a>-&gt;<a onClick="logVariable('scale')" class="var it43846" onMouseOver="hilite(43846)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a> = <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('defaultcompetencescalenotproficient').','.
<a name="l354"><span class="linenum"> 354</span></a>                             <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('defaultcompetencescaleproficient');
<a name="l355"><span class="linenum"> 355</span></a>      <a class="var it29623" onMouseOver="hilite(29623)" onMouseOut="lolite()" onClick="logVariable('defaultscale')" href="../../_variables/defaultscale.html">$defaultscale</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43846" onMouseOver="hilite(43846)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l356"><span class="linenum"> 356</span></a>  
<a name="l357"><span class="linenum"> 357</span></a>      <a class="var it29623" onMouseOver="hilite(29623)" onMouseOut="lolite()" onClick="logVariable('defaultscale')" href="../../_variables/defaultscale.html">$defaultscale</a>-&gt;<a onClick="logVariable('id')" class="var it43846" onMouseOver="hilite(43846)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('scale', <a class="var it29623" onMouseOver="hilite(29623)" onMouseOut="lolite()" onClick="logVariable('defaultscale')" href="../../_variables/defaultscale.html">$defaultscale</a>);
<a name="l358"><span class="linenum"> 358</span></a>      return <a class="var it29623" onMouseOver="hilite(29623)" onMouseOut="lolite()" onClick="logVariable('defaultscale')" href="../../_variables/defaultscale.html">$defaultscale</a>;
<a name="l359"><span class="linenum"> 359</span></a>  }
<a name="l360"><span class="linenum"> 360</span></a>  
<a name="l361"><span class="linenum"> 361</span></a>  <span class="comment">/**</span>
<a name="l362"><span class="linenum"> 362</span></a>  <span class="comment"> * Marks all courses that require rounded grade items be updated.</span>
<a name="l363"><span class="linenum"> 363</span></a>  <span class="comment"> *</span>
<a name="l364"><span class="linenum"> 364</span></a>  <span class="comment"> * Used during upgrade and in course restore process.</span>
<a name="l365"><span class="linenum"> 365</span></a>  <span class="comment"> *</span>
<a name="l366"><span class="linenum"> 366</span></a>  <span class="comment"> * This upgrade script is needed because it has been decided that if a grade is rounded up, and it will changed a letter</span>
<a name="l367"><span class="linenum"> 367</span></a>  <span class="comment"> * grade or satisfy a course completion grade criteria, then it should be set as so, and the letter will be awarded and or</span>
<a name="l368"><span class="linenum"> 368</span></a>  <span class="comment"> * the course completion grade will be awarded.</span>
<a name="l369"><span class="linenum"> 369</span></a>  <span class="comment"> *</span>
<a name="l370"><span class="linenum"> 370</span></a>  <span class="comment"> * @param int $courseid Specify a course ID to run this script on just one course.</span>
<a name="l371"><span class="linenum"> 371</span></a>  <span class="comment"> */</span>
<a name="l372"><span class="linenum"> 372</span></a>  function <a class="function" onClick="logFunction('upgrade_course_letter_boundary')" href="../../_functions/upgrade_course_letter_boundary.html" onMouseOver="funcPopup(event,'upgrade_course_letter_boundary')">upgrade_course_letter_boundary</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> = null) {
<a name="l373"><span class="linenum"> 373</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l374"><span class="linenum"> 374</span></a>  
<a name="l375"><span class="linenum"> 375</span></a>      <a class="var it4194" onMouseOver="hilite(4194)" onMouseOut="lolite()" onClick="logVariable('coursesql')" href="../../_variables/coursesql.html">$coursesql</a> = '';
<a name="l376"><span class="linenum"> 376</span></a>      <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('contextlevel' =&gt; <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>);
<a name="l377"><span class="linenum"> 377</span></a>      if (!empty(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>)) {
<a name="l378"><span class="linenum"> 378</span></a>          <a class="var it4194" onMouseOver="hilite(4194)" onMouseOut="lolite()" onClick="logVariable('coursesql')" href="../../_variables/coursesql.html">$coursesql</a> = 'AND c.id = :courseid';
<a name="l379"><span class="linenum"> 379</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['courseid'] = <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>;
<a name="l380"><span class="linenum"> 380</span></a>      }
<a name="l381"><span class="linenum"> 381</span></a>  
<a name="l382"><span class="linenum"> 382</span></a>  <span class="comment">    // Check to see if the system letter boundaries are borked.</span>
<a name="l383"><span class="linenum"> 383</span></a>      <a class="var it221" onMouseOver="hilite(221)" onMouseOut="lolite()" onClick="logVariable('systemcontext')" href="../../_variables/systemcontext.html">$systemcontext</a> = <a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l384"><span class="linenum"> 384</span></a>      <a class="var it29624" onMouseOver="hilite(29624)" onMouseOut="lolite()" onClick="logVariable('systemneedsfreeze')" href="../../_variables/systemneedsfreeze.html">$systemneedsfreeze</a> = <a class="function" onClick="logFunction('upgrade_letter_boundary_needs_freeze')" href="../../_functions/upgrade_letter_boundary_needs_freeze.html" onMouseOver="funcPopup(event,'upgrade_letter_boundary_needs_freeze')">upgrade_letter_boundary_needs_freeze</a>(<a class="var it221" onMouseOver="hilite(221)" onMouseOut="lolite()" onClick="logVariable('systemcontext')" href="../../_variables/systemcontext.html">$systemcontext</a>);
<a name="l385"><span class="linenum"> 385</span></a>  
<a name="l386"><span class="linenum"> 386</span></a>  <span class="comment">    // Check the setting for showing the letter grade in a column (default is false).</span>
<a name="l387"><span class="linenum"> 387</span></a>      <a class="var it29625" onMouseOver="hilite(29625)" onMouseOut="lolite()" onClick="logVariable('usergradelettercolumnsetting')" href="../../_variables/usergradelettercolumnsetting.html">$usergradelettercolumnsetting</a> = 0;
<a name="l388"><span class="linenum"> 388</span></a>      if (isset(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('grade_report_user_showlettergrade')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/grade_report_user_showlettergrade.html">grade_report_user_showlettergrade</a>)) {
<a name="l389"><span class="linenum"> 389</span></a>          <a class="var it29625" onMouseOver="hilite(29625)" onMouseOut="lolite()" onClick="logVariable('usergradelettercolumnsetting')" href="../../_variables/usergradelettercolumnsetting.html">$usergradelettercolumnsetting</a> = (int)<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('grade_report_user_showlettergrade')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/grade_report_user_showlettergrade.html">grade_report_user_showlettergrade</a>;
<a name="l390"><span class="linenum"> 390</span></a>      }
<a name="l391"><span class="linenum"> 391</span></a>      <a class="var it29627" onMouseOver="hilite(29627)" onMouseOut="lolite()" onClick="logVariable('lettercolumnsql')" href="../../_variables/lettercolumnsql.html">$lettercolumnsql</a> = '';
<a name="l392"><span class="linenum"> 392</span></a>      if (<a class="var it29625" onMouseOver="hilite(29625)" onMouseOut="lolite()" onClick="logVariable('usergradelettercolumnsetting')" href="../../_variables/usergradelettercolumnsetting.html">$usergradelettercolumnsetting</a>) {
<a name="l393"><span class="linenum"> 393</span></a>  <span class="comment">        // the system default is to show a column with letters (and the course uses the defaults).</span>
<a name="l394"><span class="linenum"> 394</span></a>          <a class="var it29627" onMouseOver="hilite(29627)" onMouseOut="lolite()" onClick="logVariable('lettercolumnsql')" href="../../_variables/lettercolumnsql.html">$lettercolumnsql</a> = '(gss.value is NULL OR ' . <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_compare_text')" href="../../_functions/sql_compare_text.html" onMouseOver="funcPopup(event,'sql_compare_text')">sql_compare_text</a>('gss.value') .  ' &lt;&gt; \'0\')';
<a name="l395"><span class="linenum"> 395</span></a>      } else {
<a name="l396"><span class="linenum"> 396</span></a>  <span class="comment">        // the course displays a column with letters.</span>
<a name="l397"><span class="linenum"> 397</span></a>          <a class="var it29627" onMouseOver="hilite(29627)" onMouseOut="lolite()" onClick="logVariable('lettercolumnsql')" href="../../_variables/lettercolumnsql.html">$lettercolumnsql</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_compare_text')" href="../../_functions/sql_compare_text.html" onMouseOver="funcPopup(event,'sql_compare_text')">sql_compare_text</a>('gss.value') .  ' = \'1\'';
<a name="l398"><span class="linenum"> 398</span></a>      }
<a name="l399"><span class="linenum"> 399</span></a>  
<a name="l400"><span class="linenum"> 400</span></a>  <span class="comment">    // 3, 13, 23, 31, and 32 are the grade display types that incorporate showing letters. See lib/grade/constants/php.</span>
<a name="l401"><span class="linenum"> 401</span></a>      <a class="var it29628" onMouseOver="hilite(29628)" onMouseOut="lolite()" onClick="logVariable('systemusesletters')" href="../../_variables/systemusesletters.html">$systemusesletters</a> = (int) (isset(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('grade_displaytype')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/grade_displaytype.html">grade_displaytype</a>) &amp;&amp; <a class="phpfunction" onClick="logFunction('in_array')" href="../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('grade_displaytype')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/grade_displaytype.html">grade_displaytype</a>, array(3, 13, 23, 31, 32)));
<a name="l402"><span class="linenum"> 402</span></a>      <a class="var it29629" onMouseOver="hilite(29629)" onMouseOut="lolite()" onClick="logVariable('systemletters')" href="../../_variables/systemletters.html">$systemletters</a> = <a class="var it29628" onMouseOver="hilite(29628)" onMouseOut="lolite()" onClick="logVariable('systemusesletters')" href="../../_variables/systemusesletters.html">$systemusesletters</a> || <a class="var it29625" onMouseOver="hilite(29625)" onMouseOut="lolite()" onClick="logVariable('usergradelettercolumnsetting')" href="../../_variables/usergradelettercolumnsetting.html">$usergradelettercolumnsetting</a>;
<a name="l403"><span class="linenum"> 403</span></a>  
<a name="l404"><span class="linenum"> 404</span></a>      <a class="var it29630" onMouseOver="hilite(29630)" onMouseOut="lolite()" onClick="logVariable('contextselect')" href="../../_variables/contextselect.html">$contextselect</a> = <a class="class" onClick="logClass('context_helper')" href="../../_classes/context_helper.html" onMouseOver="classPopup(event,'context_helper')">context_helper</a>::<a class="function" onClick="logFunction('get_preload_record_columns_sql')" href="../../_functions/get_preload_record_columns_sql.html" onMouseOver="funcPopup(event,'get_preload_record_columns_sql')">get_preload_record_columns_sql</a>('ctx');
<a name="l405"><span class="linenum"> 405</span></a>  
<a name="l406"><span class="linenum"> 406</span></a>      if (<a class="var it29629" onMouseOver="hilite(29629)" onMouseOut="lolite()" onClick="logVariable('systemletters')" href="../../_variables/systemletters.html">$systemletters</a> &amp;&amp; <a class="var it29624" onMouseOver="hilite(29624)" onMouseOut="lolite()" onClick="logVariable('systemneedsfreeze')" href="../../_variables/systemneedsfreeze.html">$systemneedsfreeze</a>) {
<a name="l407"><span class="linenum"> 407</span></a>  <span class="comment">        // Select courses with no grade setting for display and a grade item that is using the default display,</span>
<a name="l408"><span class="linenum"> 408</span></a>  <span class="comment">        // but have not altered the course letter boundary configuration. These courses are definitely affected.</span>
<a name="l409"><span class="linenum"> 409</span></a>  
<a name="l410"><span class="linenum"> 410</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT DISTINCT c.id AS courseid
<a name="l411"><span class="linenum"> 411</span></a>                    FROM {course} c
<a name="l412"><span class="linenum"> 412</span></a>                    JOIN {grade_items} gi ON c.id = gi.courseid
<a name="l413"><span class="linenum"> 413</span></a>                    JOIN {context} ctx ON ctx.instanceid = c.id AND ctx.contextlevel = :contextlevel
<a name="l414"><span class="linenum"> 414</span></a>               LEFT JOIN {grade_settings} gs ON gs.courseid = c.id AND gs.name = 'displaytype'
<a name="l415"><span class="linenum"> 415</span></a>               LEFT JOIN {grade_settings} gss ON gss.courseid = c.id AND gss.name = 'report_user_showlettergrade'
<a name="l416"><span class="linenum"> 416</span></a>               LEFT JOIN {grade_letters} gl ON gl.contextid = ctx.id
<a name="l417"><span class="linenum"> 417</span></a>                   WHERE gi.display = 0
<a name="l418"><span class="linenum"> 418</span></a>                   AND ((gs.value is NULL)
<a name="l419"><span class="linenum"> 419</span></a>                        AND (<a class="var it29627" onMouseOver="hilite(29627)" onMouseOut="lolite()" onClick="logVariable('lettercolumnsql')" href="../../_variables/lettercolumnsql.html">$lettercolumnsql</a>))
<a name="l420"><span class="linenum"> 420</span></a>                   AND gl.id is NULL <a class="var it4194" onMouseOver="hilite(4194)" onMouseOut="lolite()" onClick="logVariable('coursesql')" href="../../_variables/coursesql.html">$coursesql</a>&quot;;
<a name="l421"><span class="linenum"> 421</span></a>          <a class="var it29631" onMouseOver="hilite(29631)" onMouseOut="lolite()" onClick="logVariable('affectedcourseids')" href="../../_variables/affectedcourseids.html">$affectedcourseids</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l422"><span class="linenum"> 422</span></a>          foreach (<a class="var it29631" onMouseOver="hilite(29631)" onMouseOut="lolite()" onClick="logVariable('affectedcourseids')" href="../../_variables/affectedcourseids.html">$affectedcourseids</a> as <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>) {
<a name="l423"><span class="linenum"> 423</span></a>              <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('gradebook_calculations_freeze_' . <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>-&gt;<a onClick="logVariable('courseid')" class="var it43847" onMouseOver="hilite(43847)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>, 20160518);
<a name="l424"><span class="linenum"> 424</span></a>          }
<a name="l425"><span class="linenum"> 425</span></a>          <a class="var it29631" onMouseOver="hilite(29631)" onMouseOut="lolite()" onClick="logVariable('affectedcourseids')" href="../../_variables/affectedcourseids.html">$affectedcourseids</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l426"><span class="linenum"> 426</span></a>      }
<a name="l427"><span class="linenum"> 427</span></a>  
<a name="l428"><span class="linenum"> 428</span></a>  <span class="comment">    // If the system letter boundary is okay proceed to check grade item and course grade display settings.</span>
<a name="l429"><span class="linenum"> 429</span></a>      <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT DISTINCT c.id AS courseid, <a class="var it29630" onMouseOver="hilite(29630)" onMouseOut="lolite()" onClick="logVariable('contextselect')" href="../../_variables/contextselect.html">$contextselect</a>
<a name="l430"><span class="linenum"> 430</span></a>                FROM {course} c
<a name="l431"><span class="linenum"> 431</span></a>                JOIN {context} ctx ON ctx.instanceid = c.id AND ctx.contextlevel = :contextlevel
<a name="l432"><span class="linenum"> 432</span></a>                JOIN {grade_items} gi ON c.id = gi.courseid
<a name="l433"><span class="linenum"> 433</span></a>           LEFT JOIN {grade_settings} gs ON c.id = gs.courseid AND gs.name = 'displaytype'
<a name="l434"><span class="linenum"> 434</span></a>           LEFT JOIN {grade_settings} gss ON gss.courseid = c.id AND gss.name = 'report_user_showlettergrade'
<a name="l435"><span class="linenum"> 435</span></a>               WHERE
<a name="l436"><span class="linenum"> 436</span></a>                  (
<a name="l437"><span class="linenum"> 437</span></a>                      -- A grade item is using letters
<a name="l438"><span class="linenum"> 438</span></a>                      (gi.display IN (3, 13, 23, 31, 32))
<a name="l439"><span class="linenum"> 439</span></a>                      -- OR the course is using letters
<a name="l440"><span class="linenum"> 440</span></a>                      <a class="function" onClick="logFunction('OR')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (&quot; . <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_compare_text')" href="../../_functions/sql_compare_text.html" onMouseOver="funcPopup(event,'sql_compare_text')">sql_compare_text</a>('gs.value') . &quot; IN ('3', '13', '23', '31', '32')
<a name="l441"><span class="linenum"> 441</span></a>                          -- OR the course using the system default which is letters
<a name="l442"><span class="linenum"> 442</span></a>                          <a class="function" onClick="logFunction('OR')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (gs.value IS NULL AND <a class="var it29628" onMouseOver="hilite(29628)" onMouseOut="lolite()" onClick="logVariable('systemusesletters')" href="../../_variables/systemusesletters.html">$systemusesletters</a> = 1)
<a name="l443"><span class="linenum"> 443</span></a>                      )
<a name="l444"><span class="linenum"> 444</span></a>                      <a class="function" onClick="logFunction('OR')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (<a class="var it29627" onMouseOver="hilite(29627)" onMouseOut="lolite()" onClick="logVariable('lettercolumnsql')" href="../../_variables/lettercolumnsql.html">$lettercolumnsql</a>)
<a name="l445"><span class="linenum"> 445</span></a>                  )
<a name="l446"><span class="linenum"> 446</span></a>                  -- AND the course matches
<a name="l447"><span class="linenum"> 447</span></a>                  <a class="var it4194" onMouseOver="hilite(4194)" onMouseOut="lolite()" onClick="logVariable('coursesql')" href="../../_variables/coursesql.html">$coursesql</a>&quot;;
<a name="l448"><span class="linenum"> 448</span></a>  
<a name="l449"><span class="linenum"> 449</span></a>      <a class="var it29632" onMouseOver="hilite(29632)" onMouseOut="lolite()" onClick="logVariable('potentialcourses')" href="../../_variables/potentialcourses.html">$potentialcourses</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l450"><span class="linenum"> 450</span></a>  
<a name="l451"><span class="linenum"> 451</span></a>      foreach (<a class="var it29632" onMouseOver="hilite(29632)" onMouseOut="lolite()" onClick="logVariable('potentialcourses')" href="../../_variables/potentialcourses.html">$potentialcourses</a> as <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>) {
<a name="l452"><span class="linenum"> 452</span></a>          <a class="var it29612" onMouseOver="hilite(29612)" onMouseOut="lolite()" onClick="logVariable('gradebookfreeze')" href="../../_variables/gradebookfreeze.html">$gradebookfreeze</a> = 'gradebook_calculations_freeze_' . <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>-&gt;<a onClick="logVariable('courseid')" class="var it43035" onMouseOver="hilite(43035)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>;
<a name="l453"><span class="linenum"> 453</span></a>  
<a name="l454"><span class="linenum"> 454</span></a>  <span class="comment">        // Check also if this course id has already been frozen.</span>
<a name="l455"><span class="linenum"> 455</span></a>  <span class="comment">        // If we already have this course ID then move on to the next record.</span>
<a name="l456"><span class="linenum"> 456</span></a>          if (!property_exists(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it29612" onMouseOver="hilite(29612)" onMouseOut="lolite()" onClick="logVariable('gradebookfreeze')" href="../../_variables/gradebookfreeze.html">$gradebookfreeze</a>)) {
<a name="l457"><span class="linenum"> 457</span></a>  <span class="comment">            // Check for 57 letter grade issue.</span>
<a name="l458"><span class="linenum"> 458</span></a>              <a class="class" onClick="logClass('context_helper')" href="../../_classes/context_helper.html" onMouseOver="classPopup(event,'context_helper')">context_helper</a>::<a class="function" onClick="logFunction('preload_from_record')" href="../../_functions/preload_from_record.html" onMouseOver="funcPopup(event,'preload_from_record')">preload_from_record</a>(<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>);
<a name="l459"><span class="linenum"> 459</span></a>              <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>-&gt;<a onClick="logVariable('courseid')" class="var it43035" onMouseOver="hilite(43035)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l460"><span class="linenum"> 460</span></a>              if (<a class="function" onClick="logFunction('upgrade_letter_boundary_needs_freeze')" href="../../_functions/upgrade_letter_boundary_needs_freeze.html" onMouseOver="funcPopup(event,'upgrade_letter_boundary_needs_freeze')">upgrade_letter_boundary_needs_freeze</a>(<a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a>)) {
<a name="l461"><span class="linenum"> 461</span></a>  <span class="comment">                // We have a course with a possible score standardisation problem. Flag for freeze.</span>
<a name="l462"><span class="linenum"> 462</span></a>  <span class="comment">                // Flag this course as being frozen.</span>
<a name="l463"><span class="linenum"> 463</span></a>                  <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('gradebook_calculations_freeze_' . <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>-&gt;<a onClick="logVariable('courseid')" class="var it43035" onMouseOver="hilite(43035)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>, 20160518);
<a name="l464"><span class="linenum"> 464</span></a>              }
<a name="l465"><span class="linenum"> 465</span></a>          }
<a name="l466"><span class="linenum"> 466</span></a>      }
<a name="l467"><span class="linenum"> 467</span></a>      <a class="var it29632" onMouseOver="hilite(29632)" onMouseOut="lolite()" onClick="logVariable('potentialcourses')" href="../../_variables/potentialcourses.html">$potentialcourses</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l468"><span class="linenum"> 468</span></a>  }
<a name="l469"><span class="linenum"> 469</span></a>  
<a name="l470"><span class="linenum"> 470</span></a>  <span class="comment">/**</span>
<a name="l471"><span class="linenum"> 471</span></a>  <span class="comment"> * Checks the letter boundary of the provided context to see if it needs freezing.</span>
<a name="l472"><span class="linenum"> 472</span></a>  <span class="comment"> * Each letter boundary is tested to see if receiving that boundary number will</span>
<a name="l473"><span class="linenum"> 473</span></a>  <span class="comment"> * result in achieving the cosponsoring letter.</span>
<a name="l474"><span class="linenum"> 474</span></a>  <span class="comment"> *</span>
<a name="l475"><span class="linenum"> 475</span></a>  <span class="comment"> * @param object $context Context object</span>
<a name="l476"><span class="linenum"> 476</span></a>  <span class="comment"> * @return bool if the letter boundary for this context should be frozen.</span>
<a name="l477"><span class="linenum"> 477</span></a>  <span class="comment"> */</span>
<a name="l478"><span class="linenum"> 478</span></a>  function <a class="function" onClick="logFunction('upgrade_letter_boundary_needs_freeze')" href="../../_functions/upgrade_letter_boundary_needs_freeze.html" onMouseOver="funcPopup(event,'upgrade_letter_boundary_needs_freeze')">upgrade_letter_boundary_needs_freeze</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>) {
<a name="l479"><span class="linenum"> 479</span></a>      global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l480"><span class="linenum"> 480</span></a>  
<a name="l481"><span class="linenum"> 481</span></a>      <a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a> = <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_parent_context_ids')" href="../../_functions/get_parent_context_ids.html" onMouseOver="funcPopup(event,'get_parent_context_ids')">get_parent_context_ids</a>();
<a name="l482"><span class="linenum"> 482</span></a>      <a class="phpfunction" onClick="logFunction('array_unshift')" href="../../_functions/array_unshift.html" onMouseOver="phpfuncPopup(event,'array_unshift')">array_unshift</a>(<a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l483"><span class="linenum"> 483</span></a>  
<a name="l484"><span class="linenum"> 484</span></a>      foreach (<a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a> as <a class="var it5403" onMouseOver="hilite(5403)" onMouseOut="lolite()" onClick="logVariable('ctxid')" href="../../_variables/ctxid.html">$ctxid</a>) {
<a name="l485"><span class="linenum"> 485</span></a>  
<a name="l486"><span class="linenum"> 486</span></a>          <a class="var it1843" onMouseOver="hilite(1843)" onMouseOut="lolite()" onClick="logVariable('letters')" href="../../_variables/letters.html">$letters</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_menu')" href="../../_functions/get_records_menu.html" onMouseOver="funcPopup(event,'get_records_menu')">get_records_menu</a>('grade_letters', array('contextid' =&gt; <a class="var it5403" onMouseOver="hilite(5403)" onMouseOut="lolite()" onClick="logVariable('ctxid')" href="../../_variables/ctxid.html">$ctxid</a>), 'lowerboundary DESC',
<a name="l487"><span class="linenum"> 487</span></a>                  'lowerboundary, letter');
<a name="l488"><span class="linenum"> 488</span></a>  
<a name="l489"><span class="linenum"> 489</span></a>          if (!empty(<a class="var it1843" onMouseOver="hilite(1843)" onMouseOut="lolite()" onClick="logVariable('letters')" href="../../_variables/letters.html">$letters</a>)) {
<a name="l490"><span class="linenum"> 490</span></a>              foreach (<a class="var it1843" onMouseOver="hilite(1843)" onMouseOut="lolite()" onClick="logVariable('letters')" href="../../_variables/letters.html">$letters</a> as <a class="var it1846" onMouseOver="hilite(1846)" onMouseOut="lolite()" onClick="logVariable('boundary')" href="../../_variables/boundary.html">$boundary</a> =&gt; <a class="var it2687" onMouseOver="hilite(2687)" onMouseOut="lolite()" onClick="logVariable('notused')" href="../../_variables/notused.html">$notused</a>) {
<a name="l491"><span class="linenum"> 491</span></a>                  <a class="var it29633" onMouseOver="hilite(29633)" onMouseOut="lolite()" onClick="logVariable('standardisedboundary')" href="../../_variables/standardisedboundary.html">$standardisedboundary</a> = <a class="function" onClick="logFunction('upgrade_standardise_score')" href="../../_functions/upgrade_standardise_score.html" onMouseOver="funcPopup(event,'upgrade_standardise_score')">upgrade_standardise_score</a>(<a class="var it1846" onMouseOver="hilite(1846)" onMouseOut="lolite()" onClick="logVariable('boundary')" href="../../_variables/boundary.html">$boundary</a>, 0, 100, 0, 100);
<a name="l492"><span class="linenum"> 492</span></a>                  if (<a class="var it29633" onMouseOver="hilite(29633)" onMouseOut="lolite()" onClick="logVariable('standardisedboundary')" href="../../_variables/standardisedboundary.html">$standardisedboundary</a> &lt; <a class="var it1846" onMouseOver="hilite(1846)" onMouseOut="lolite()" onClick="logVariable('boundary')" href="../../_variables/boundary.html">$boundary</a>) {
<a name="l493"><span class="linenum"> 493</span></a>                      return true;
<a name="l494"><span class="linenum"> 494</span></a>                  }
<a name="l495"><span class="linenum"> 495</span></a>              }
<a name="l496"><span class="linenum"> 496</span></a>  <span class="comment">            // We found letters but we have no boundary problem.</span>
<a name="l497"><span class="linenum"> 497</span></a>              return false;
<a name="l498"><span class="linenum"> 498</span></a>          }
<a name="l499"><span class="linenum"> 499</span></a>      }
<a name="l500"><span class="linenum"> 500</span></a>      return false;
<a name="l501"><span class="linenum"> 501</span></a>  }
<a name="l502"><span class="linenum"> 502</span></a>  
<a name="l503"><span class="linenum"> 503</span></a>  <span class="comment">/**</span>
<a name="l504"><span class="linenum"> 504</span></a>  <span class="comment"> * Given a float value situated between a source minimum and a source maximum, converts it to the</span>
<a name="l505"><span class="linenum"> 505</span></a>  <span class="comment"> * corresponding value situated between a target minimum and a target maximum. Thanks to Darlene</span>
<a name="l506"><span class="linenum"> 506</span></a>  <span class="comment"> * for the formula :-)</span>
<a name="l507"><span class="linenum"> 507</span></a>  <span class="comment"> *</span>
<a name="l508"><span class="linenum"> 508</span></a>  <span class="comment"> * @param float $rawgrade</span>
<a name="l509"><span class="linenum"> 509</span></a>  <span class="comment"> * @param float $sourcemin</span>
<a name="l510"><span class="linenum"> 510</span></a>  <span class="comment"> * @param float $sourcemax</span>
<a name="l511"><span class="linenum"> 511</span></a>  <span class="comment"> * @param float $targetmin</span>
<a name="l512"><span class="linenum"> 512</span></a>  <span class="comment"> * @param float $targetmax</span>
<a name="l513"><span class="linenum"> 513</span></a>  <span class="comment"> * @return float Converted value</span>
<a name="l514"><span class="linenum"> 514</span></a>  <span class="comment"> */</span>
<a name="l515"><span class="linenum"> 515</span></a>  function <a class="function" onClick="logFunction('upgrade_standardise_score')" href="../../_functions/upgrade_standardise_score.html" onMouseOver="funcPopup(event,'upgrade_standardise_score')">upgrade_standardise_score</a>(<a class="var it3411" onMouseOver="hilite(3411)" onMouseOut="lolite()" onClick="logVariable('rawgrade')" href="../../_variables/rawgrade.html">$rawgrade</a>, <a class="var it29634" onMouseOver="hilite(29634)" onMouseOut="lolite()" onClick="logVariable('sourcemin')" href="../../_variables/sourcemin.html">$sourcemin</a>, <a class="var it29635" onMouseOver="hilite(29635)" onMouseOut="lolite()" onClick="logVariable('sourcemax')" href="../../_variables/sourcemax.html">$sourcemax</a>, <a class="var it29636" onMouseOver="hilite(29636)" onMouseOut="lolite()" onClick="logVariable('targetmin')" href="../../_variables/targetmin.html">$targetmin</a>, <a class="var it29637" onMouseOver="hilite(29637)" onMouseOut="lolite()" onClick="logVariable('targetmax')" href="../../_variables/targetmax.html">$targetmax</a>) {
<a name="l516"><span class="linenum"> 516</span></a>      if (<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it3411" onMouseOver="hilite(3411)" onMouseOut="lolite()" onClick="logVariable('rawgrade')" href="../../_variables/rawgrade.html">$rawgrade</a>)) {
<a name="l517"><span class="linenum"> 517</span></a>          return null;
<a name="l518"><span class="linenum"> 518</span></a>      }
<a name="l519"><span class="linenum"> 519</span></a>  
<a name="l520"><span class="linenum"> 520</span></a>      if (<a class="var it29635" onMouseOver="hilite(29635)" onMouseOut="lolite()" onClick="logVariable('sourcemax')" href="../../_variables/sourcemax.html">$sourcemax</a> == <a class="var it29634" onMouseOver="hilite(29634)" onMouseOut="lolite()" onClick="logVariable('sourcemin')" href="../../_variables/sourcemin.html">$sourcemin</a> or <a class="var it29636" onMouseOver="hilite(29636)" onMouseOut="lolite()" onClick="logVariable('targetmin')" href="../../_variables/targetmin.html">$targetmin</a> == <a class="var it29637" onMouseOver="hilite(29637)" onMouseOut="lolite()" onClick="logVariable('targetmax')" href="../../_variables/targetmax.html">$targetmax</a>) {
<a name="l521"><span class="linenum"> 521</span></a>  <span class="comment">        // Prevent division by 0.</span>
<a name="l522"><span class="linenum"> 522</span></a>          return <a class="var it29637" onMouseOver="hilite(29637)" onMouseOut="lolite()" onClick="logVariable('targetmax')" href="../../_variables/targetmax.html">$targetmax</a>;
<a name="l523"><span class="linenum"> 523</span></a>      }
<a name="l524"><span class="linenum"> 524</span></a>  
<a name="l525"><span class="linenum"> 525</span></a>      <a class="var it5041" onMouseOver="hilite(5041)" onMouseOut="lolite()" onClick="logVariable('factor')" href="../../_variables/factor.html">$factor</a> = (<a class="var it3411" onMouseOver="hilite(3411)" onMouseOut="lolite()" onClick="logVariable('rawgrade')" href="../../_variables/rawgrade.html">$rawgrade</a> - <a class="var it29634" onMouseOver="hilite(29634)" onMouseOut="lolite()" onClick="logVariable('sourcemin')" href="../../_variables/sourcemin.html">$sourcemin</a>) / (<a class="var it29635" onMouseOver="hilite(29635)" onMouseOut="lolite()" onClick="logVariable('sourcemax')" href="../../_variables/sourcemax.html">$sourcemax</a> - <a class="var it29634" onMouseOver="hilite(29634)" onMouseOut="lolite()" onClick="logVariable('sourcemin')" href="../../_variables/sourcemin.html">$sourcemin</a>);
<a name="l526"><span class="linenum"> 526</span></a>      <a class="var it414" onMouseOver="hilite(414)" onMouseOut="lolite()" onClick="logVariable('diff')" href="../../_variables/diff.html">$diff</a> = <a class="var it29637" onMouseOver="hilite(29637)" onMouseOut="lolite()" onClick="logVariable('targetmax')" href="../../_variables/targetmax.html">$targetmax</a> - <a class="var it29636" onMouseOver="hilite(29636)" onMouseOut="lolite()" onClick="logVariable('targetmin')" href="../../_variables/targetmin.html">$targetmin</a>;
<a name="l527"><span class="linenum"> 527</span></a>      <a class="var it29638" onMouseOver="hilite(29638)" onMouseOut="lolite()" onClick="logVariable('standardisedvalue')" href="../../_variables/standardisedvalue.html">$standardisedvalue</a> = <a class="var it5041" onMouseOver="hilite(5041)" onMouseOut="lolite()" onClick="logVariable('factor')" href="../../_variables/factor.html">$factor</a> * <a class="var it414" onMouseOver="hilite(414)" onMouseOut="lolite()" onClick="logVariable('diff')" href="../../_variables/diff.html">$diff</a> + <a class="var it29636" onMouseOver="hilite(29636)" onMouseOut="lolite()" onClick="logVariable('targetmin')" href="../../_variables/targetmin.html">$targetmin</a>;
<a name="l528"><span class="linenum"> 528</span></a>      return <a class="var it29638" onMouseOver="hilite(29638)" onMouseOut="lolite()" onClick="logVariable('standardisedvalue')" href="../../_variables/standardisedvalue.html">$standardisedvalue</a>;
<a name="l529"><span class="linenum"> 529</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'upgrade_group_members_only': ['upgrade_group_members_only', 'Using data for a single course-module that has groupmembersonly enabled, returns the new availability value that incorporates the correct groupmembersonly option. ', [['lib/db','upgradelib.php',79]], 2],
'get_parent_context_ids': ['get_parent_context_ids', 'Returns parent contexts of this context in reversed order, i.e. parent first, then grand parent, etc. ', [['lib','accesslib.php',5725]], 55],
'upgrade_course_letter_boundary': ['upgrade_course_letter_boundary', 'Marks all courses that require rounded grade items be updated. ', [['lib/db','upgradelib.php',361]], 8],
'make_default_scale': ['make_default_scale', 'This function creates a default separated/connected scale so there\'s something in the database.  The locations of strings and files is a bit odd, but this is because we need to maintain backward compatibility with many different existing language translations and older sites. ', [['lib/db','upgradelib.php',311]], 1],
'get_recordset_sql': ['get_recordset_sql', 'Get a number of records as an moodle_recordset.  $sql must be a complete SQL query. Since this method is a little less readable, use of it should be restricted to code where it\'s possible there might be large datasets being returned.  For known small datasets use get_records_sql - it leads to simpler code. ', [['lib/dml','pdo_moodle_database.php',252],['lib/dml','oci_native_moodle_database.php',1106],['lib/dml','pgsql_native_moodle_database.php',688],['lib/dml','mssql_native_moodle_database.php',736],['lib/dml','mysqli_native_moodle_database.php',993],['lib/dml','sqlsrv_native_moodle_database.php',811],['lib/dml/tests','dml_test.php',5544]], 283],
'upgrade_mysql_get_supported_tables': ['upgrade_mysql_get_supported_tables', 'Returns all non-view and non-temp tables with sane names. Prints list of non-supported tables using $OUTPUT->notification() ', [['lib/db','upgradelib.php',33]], 0],
'preload_from_record': ['preload_from_record', 'Preloads context information from db record and strips the cached info. ', [['lib','accesslib.php',5250],['lib','accesslib.php',6079]], 61],
'upgrade_course_tags': ['upgrade_course_tags', 'This upgrade script merges all tag instances pointing to the same course tag ', [['lib/db','upgradelib.php',291]], 4],
'or': ['or', '', [['lib/tcpdf','LICENSE.TXT',69]], 556],
'get_in_or_equal': ['get_in_or_equal', 'Constructs \'IN()\' or \'=\' sql fragment ', [['lib/dml','oci_native_moodle_database.php',1635],['lib/dml','moodle_database.php',711]], 438],
'execute': ['execute', 'Run langpack update ', [['admin/tool/langimport/classes/task','update_langpacks_task.php',44],['backup/converter/imscc1','lib.php',84],['lib/classes/task','blog_cron_task.php',40],['mod/workshop/allocation/scheduled','lib.php',128],['lib/classes/task','send_new_user_passwords_task.php',40],['admin/tool/log/store/standard/classes/task','cleanup_task.php',40],['lib/dml','pdo_moodle_database.php',227],['lib/classes/task','tag_cron_task.php',42],['enrol/imsenterprise/classes/task','cron_task.php',43],['lib/classes/task','completion_daily_task.php',42],['lib/google/src/Google/Http','Batch.php',61],['lib/dml','oci_native_moodle_database.php',1048],['lib/classes/task','context_cleanup_task.php',41],['backup/util/plan','backup_structure_step.class.php',50],['backup/util/ui','restore_ui.class.php',206],['webservice','lib.php',1319],['lib/classes/task','stats_cron_task.php',40],['lib/htmlpurifier/HTMLPurifier/Strategy','ValidateAttributes.php',16],['lib/htmlpurifier/HTMLPurifier/Strategy','RemoveForeignElements.php',20],['lib/classes/task','legacy_plugin_cron_task.php',42],['backup/moodle2','restore_activity_task.class.php',189],['lib/classes/task','portfolio_cron_task.php',40],['lib/google/src/Google/Http','REST.php',27],['lib/htmlpurifier/HTMLPurifier/Strategy','MakeWellFormed.php',66],['backup/converter/imscc11','backuplib.php',42],['lib/classes/task','question_cron_task.php',40],['lib/classes/task','cache_cron_task.php',40],['admin/tool/log/store/legacy/classes/task','cleanup_task.php',40],['mod/lti/service/memberships/classes/local/resource','linkmemberships.php',62],['admin/tool/messageinbound/classes/task','cleanup_task.php',47],['lib/adodb/drivers','adodb-pdo.inc.php',559],['lib/editor/atto/classes/task','autosave_cleanup_task.php',42],['admin/tool/recyclebin/classes/task','cleanup_category_bin.php',43],['lib/classes/task','completion_regular_task.php',42],['lib/adodb/drivers','adodb-oci8po.inc.php',54],['lib/classes/task','events_cron_task.php',40],['mod/workshop/allocation/random','lib.php',83],['mod/assign/feedback/editpdf/classes/task','convert_submissions.php',47],['auth/cas/classes/task','sync_task.php',43],['admin/tool/recyclebin/classes/task','cleanup_course_bin.php',43],['mod/lti/service/toolsettings/classes/local/resource','contextsettings.php',62],['backup/util/helper','restore_decode_processor.class.php',73],['lib/behat','behat_base.php',840],['enrol/flatfile/classes/task','flatfile_sync_task.php',46],['lib/classes/task','registration_cron_task.php',40],['backup/moodle2','backup_section_task.class.php',97],['lib/classes/task','check_for_updates_task.php',40],['backup/util/plan/tests/fixtures','plan_fixtures.php',48],['backup/util/plan/tests/fixtures','plan_fixtures.php',56],['mod/forum/classes/task','cron_task.php',39],['lib/classes/task','send_failed_login_notifications_task.php',43],['enrol/lti/classes/task','sync_grades.php',45],['lib/dml','pgsql_native_moodle_database.php',665],['lib/htmlpurifier/HTMLPurifier/Strategy','Composite.php',21],['lib/classes/update','validator.php',117],['lib/google/src/Google','Client.php',574],['lib/dml','mssql_native_moodle_database.php',711],['mod/lti/service/profile/classes/local/resource','profile.php',76],['backup/util/plan','backup_plan.class.php',112],['lib/dml','mysqli_native_moodle_database.php',963],['backup/util/ui','backup_ui.class.php',122],['admin/tool/monitor/classes/task','clean_events.php',41],['backup/converter/moodle1','backuplib.php',10],['backup/converter/imscc11','lib.php',85],['lib/classes/task','grade_cron_task.php',40],['lib/classes/task','file_temp_cleanup_task.php',40],['backup/moodle2','restore_section_task.class.php',87],['mod/lti/service/toolsettings/classes/local/resource','linksettings.php',63],['filter/tex','latex.php',70],['lib/adodb','adodb.inc.php',1088],['lib/classes/task','plagiarism_cron_task.php',40],['mod/lti/service/toolproxy/classes/local/resource','toolproxy.php',62],['backup/converter/moodle1','lib.php',142],['backup/util/plan','restore_structure_step.class.php',62],['lib/classes/task','search_index_task.php',44],['enrol/lti/classes/task','sync_members.php',55],['lib/classes/task','session_cleanup_task.php',40],['mod/lti/service/toolsettings/classes/local/resource','systemsettings.php',61],['lib/classes/task','backup_cleanup_task.php',40],['lib/classes/task','delete_unconfirmed_users_task.php',40],['backup/converter/imscc1','backuplib.php',10],['lib/classes/task','badges_cron_task.php',40],['admin/tool/uploadcourse/classes','processor.php',174],['lib/classes/task','calendar_cron_task.php',40],['backup/util/plan','base_plan.class.php',158],['auth/ldap/classes/task','sync_task.php',43],['lib/adodb/drivers','adodb-oci8.inc.php',920],['backup/util/plan','restore_plan.class.php',159],['lib/tests/fixtures','task_fixtures.php',30],['lib/tests/fixtures','task_fixtures.php',39],['lib/tests/fixtures','task_fixtures.php',48],['lib/tests/fixtures','task_fixtures.php',57],['lib/dml','sqlsrv_native_moodle_database.php',795],['lib/classes/task','create_contexts_task.php',40],['lib/classes/task','file_trash_cleanup_task.php',40],['admin/tool/cohortroles/classes/task','cohort_role_sync.php',46],['lib/classes/task','complete_plans_task.php',52],['lib/classes/task','messaging_cleanup_task.php',40],['backup/util/plan','backup_execution_step.class.php',25],['lib/classes/task','cache_cleanup_task.php',40],['backup/moodle2','backup_activity_task.class.php',211],['filter/tex','texdebug.php',287],['lib/classes/task','password_reset_cleanup_task.php',40],['lib/classes/task','search_optimize_task.php',47],['mod/assign','adminlib.php',342],['lib/classes/task','delete_incomplete_users_task.php',40],['lib/classes/task','automated_backup_task.php',40],['admin/tool/messageinbound/classes/task','pickup_task.php',47],['backup/util/plan','restore_execution_step.class.php',25],['lib/classes/task','sync_plans_from_template_cohorts_task.php',50],['admin/tool/monitor/classes','notification_task.php',39],['lib/dml/tests','dml_test.php',5543],['lib/htmlpurifier/HTMLPurifier/Strategy','FixNesting.php',41],['mod/lti/service/memberships/classes/local/resource','contextmemberships.php',60],['admin/tool/monitor/classes/task','check_subscriptions.php',60],['backup/util/interfaces','executable.class.php',32],['backup/util/plan','base_task.class.php',162]], 1058],
'upgrade_standardise_score': ['upgrade_standardise_score', 'Given a float value situated between a source minimum and a source maximum, converts it to the corresponding value situated between a target minimum and a target maximum. Thanks to Darlene for the formula :-) ', [['lib/db','upgradelib.php',503]], 1],
'upgrade_letter_boundary_needs_freeze': ['upgrade_letter_boundary_needs_freeze', 'Checks the letter boundary of the provided context to see if it needs freezing. Each letter boundary is tested to see if receiving that boundary number will result in achieving the cosponsoring letter. ', [['lib/db','upgradelib.php',470]], 6],
'sql_like': ['sql_like', 'Returns \'LIKE\' part of a query. ', [['lib/dml','oci_native_moodle_database.php',1575],['lib/dml','pgsql_native_moodle_database.php',1188],['lib/dml','mssql_native_moodle_database.php',1224],['lib/dml','mysqli_native_moodle_database.php',1514],['lib/dml','moodle_database.php',2053],['lib/dml','sqlsrv_native_moodle_database.php',1291]], 159],
'close': ['close', 'Close archive, write changes to disk. ', [['lib/filestorage','zip_archive.php',183],['lib/dml','mssql_native_moodle_recordset.php',87],['auth/fc','fcFPP.php',78],['lib/dml','mysqli_native_moodle_recordset.php',86],['lib/spout/src/Spout/Reader','ReaderInterface.php',30],['lib/spout/src/Spout/Writer/ODS/Internal','Workbook.php',81],['lib/dml','pdo_moodle_recordset.php',79],['lib','csvlib.class.php',256],['lib/horde/framework/Horde/Socket','Client.php',135],['backup/util/helper','backup_null_iterator.class.php',53],['admin/tool/uploaduser','locallib.php',149],['lib/tcpdf','tcpdf.php',2943],['lib/phpunit/classes','phpmailer_sink.php',41],['lib/phpmailer','class.smtp.php',582],['lib/dml','sqlsrv_native_moodle_recordset.php',133],['lib/classes/dml','recordset_walk.php',153],['lib/spout/src/Spout/Writer/XLSX/Helper','SharedStringsHelper.php',84],['grade/export','lib.php',689],['lib','excellib.class.php',93],['backup/util/loggers','file_logger.class.php',69],['grade','lib.php',324],['backup/util/helper','backup_array_iterator.class.php',63],['lib/horde/framework/Horde/Imap/Client','Base.php',1846],['mod/assign/feedback/offline','importgradeslib.php',204],['lib/dml','oci_native_moodle_recordset.php',80],['lib/adodb','adodb.inc.php',2361],['lib/adodb','adodb.inc.php',3090],['lib/adodb','adodb.inc.php',3870],['lib/google/src/Google/Logger','File.php',132],['lib/phpunit/classes','event_sink.php',39],['lib/horde/framework/Horde','Stream.php',585],['backup/util/loggers','base_logger.class.php',89],['lib/phpexcel/PHPExcel/Shared','ZipArchive.php',71],['question/engine/tests','helpers.php',1241],['lib/spout/src/Spout/Writer','AbstractWriter.php',312],['lib','odslib.class.php',71],['lib/spout/src/Spout/Writer/Common/Internal','WorksheetInterface.php',34],['lib/spout/src/Spout/Writer/ODS/Internal','Worksheet.php',214],['lib/spout/src/Spout/Writer','WriterInterface.php',84],['lib/spout/src/Spout/Writer/XLSX/Internal','Worksheet.php',174],['lib/spout/src/Spout/Reader','AbstractReader.php',183],['lib/phpunit/classes','message_sink.php',39],['lib/spout/src/Spout/Writer/Common/Internal','WorkbookInterface.php',65],['lib/spout/src/Spout/Writer/XLSX/Internal','Workbook.php',95],['lib/pear/Net','GeoIP.php',556],['lib/tests','completionlib_test.php',907],['lib/pear/Auth','RADIUS.php',550],['lib/pear/Auth','RADIUS.php',710],['lib/pear/Auth','RADIUS.php',829],['lib','webdavlib.php',176],['lib/dml','pgsql_native_moodle_recordset.php',107]], 1128],
'get_string': ['get_string', 'Get String returns a requested string ', [['lib/classes','string_manager_install.php',95],['lib','moodlelib.php',6735],['lib','moodlelib.php',9695],['lib/external','externallib.php',102],['question/behaviour','behaviourbase.php',770],['lib/classes','string_manager_standard.php',280],['lib/classes','string_manager.php',38]], 20134],
'upgrade_extra_credit_weightoverride': ['upgrade_extra_credit_weightoverride', 'Marks all courses with changes in extra credit weight calculation ', [['lib/db','upgradelib.php',153]], 5],
'instance': ['instance', 'Returns an instance of the cache_factor method. ', [['cache','disabledlib.php',171],['cache','disabledlib.php',296],['lib/classes','useragent.php',101],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['search/classes','manager.php',109],['cache','locallib.php',52],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['lib/classes','plugin_manager.php',103],['lib/htmlpurifier','HTMLPurifier.php',251],['course/format','lib.php',156],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['admin/tool/installaddon/classes','installer.php',40],['lib','modinfolib.php',373],['cache/classes','helper.php',76],['lib/tests','string_manager_standard_test.php',124],['lib/portfolio','exporter.php',251],['lib/classes/update','validator.php',88],['search/classes','document_factory.php',49],['lib','accesslib.php',6235],['lib','accesslib.php',6487],['lib','accesslib.php',6665],['lib','accesslib.php',6919],['lib','accesslib.php',7180],['lib','accesslib.php',7392],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443],['lib','filterlib.php',80],['search/tests/fixtures','testable_core_search.php',43],['lib/tests/fixtures','testable_update_checker.php',45],['backup/cc','validator.php',35],['cache/classes','config.php',87],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29]], 4647],
'sql_compare_text': ['sql_compare_text', 'Returns the SQL text to be used to compare one TEXT (clob) column with one varchar column, because some RDBMS doesn\'t support such direct comparisons. ', [['lib/dml','moodle_database.php',2040]], 95],
'get_records_menu': ['get_records_menu', 'Get the first two columns from a number of records as an associative array where all the given conditions met. ', [['lib/dml','moodle_database.php',1375]], 75],
'get_preload_record_columns_sql': ['get_preload_record_columns_sql', 'Returns all fields necessary for context preloading from user $rec. ', [['lib','accesslib.php',6066]], 56],
'make_competence_scale': ['make_competence_scale', 'Create another default scale. ', [['lib/db','upgradelib.php',339]], 2],
'set_config': ['set_config', 'Set a key in global configuration ', [['lib','moodlelib.php',1336],['lib','enrollib.php',1153],['lib/editor/tinymce/classes','plugin.php',84],['mod/assign','assignmentplugin.php',314],['lib/portfolio','plugin.php',515]], 1119],
'upgrade_mimetypes': ['upgrade_mimetypes', 'Updates the mime-types for files that exist in the database, based on their file extension. ', [['lib/db','upgradelib.php',133]], 2],
'get_records_sql': ['get_records_sql', 'Get a number of records as an array of objects. ', [['lib/dml','pdo_moodle_database.php',309],['lib/dml','oci_native_moodle_database.php',1145],['lib/dml','pgsql_native_moodle_database.php',732],['lib/dml','mssql_native_moodle_database.php',805],['lib/dml','mysqli_native_moodle_database.php',1057],['lib/dml','sqlsrv_native_moodle_database.php',890],['lib/dml/tests','dml_test.php',5545]], 700],
'set_field_select': ['set_field_select', 'Set a single field in every table row where the select statement evaluates to true. ', [['lib/dml','pdo_moodle_database.php',492],['lib/dml','oci_native_moodle_database.php',1436],['lib/dml','pgsql_native_moodle_database.php',1121],['lib/dml','mssql_native_moodle_database.php',1097],['lib/dml','mysqli_native_moodle_database.php',1435],['lib/dml','sqlsrv_native_moodle_database.php',1178],['lib/dml/tests','dml_test.php',5552]], 67],
'list': ['list', '', [['mod/data/preset/imagegallery','jstemplate.js',9]], 2229],
'upgrade_calculated_grade_items': ['upgrade_calculated_grade_items', 'Marks all courses that require calculated grade items be updated. ', [['lib/db','upgradelib.php',188]], 5],
'get_prefix': ['get_prefix', 'Returns database table prefix Note: can be used before connect() ', [['lib/dml','moodle_database.php',162],['backup/util/loggers','base_logger.class.php',170]], 28],
'set_field': ['set_field', 'Set a single field in every table record where all the given conditions met. ', [['lib/dml','moodle_database.php',1737],['availability/condition/profile/tests','condition_test.php',349]], 485],
'get_config': ['get_config', 'Config get method. ', [['lib/classes/antivirus','scanner.php',54],['competency/classes','competency_rule.php',59],['question/engine','bank.php',109],['admin/tool/log/classes/helper','store.php',63],['lib','moodlelib.php',1409],['lib','enrollib.php',1142],['lib/editor/tinymce/classes','plugin.php',73],['competency/classes','competency_rule_points.php',43],['search/classes','base.php',169],['mod/assign','assignmentplugin.php',345],['lib/portfolio','plugin.php',546]], 934],
'get_fieldset_sql': ['get_fieldset_sql', 'Selects rows and return values of first column as array. ', [['lib/dml','pdo_moodle_database.php',288],['lib/dml','oci_native_moodle_database.php',1196],['lib/dml','pgsql_native_moodle_database.php',799],['lib/dml','mssql_native_moodle_database.php',839],['lib/dml','mysqli_native_moodle_database.php',1106],['lib/dml','sqlsrv_native_moodle_database.php',925],['lib/dml/tests','dml_test.php',5546]], 58],
'notification': ['notification', 'Output a notification (that is, a status message about something that has just happened). ', [['lib','outputrenderers.php',2849],['lib','outputrenderers.php',4412],['lib','outputrenderers.php',4496]], 540],
'json_encode': ['json_encode', 'encodes an arbitrary variable into JSON format ', [['lib/minify/lib','FirePHP.php',1124]], 307],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'is_null': ['is_null', '', [], 2003],
'preg_replace': ['preg_replace', '', [], 917],
'array_change_key_case': ['array_change_key_case', '', [], 32],
'min': ['min', '', [], 898],
'array_key_exists': ['array_key_exists', '', [], 1445],
'defined': ['defined', '', [], 4731],
'str_replace': ['str_replace', '', [], 1648],
'array_shift': ['array_shift', '', [], 700],
'array_unshift': ['array_unshift', '', [], 115],
'preg_quote': ['preg_quote', '', [], 205],
'in_array': ['in_array', '', [], 1234],
'time': ['time', '', [], 1959],
'preg_match': ['preg_match', '', [], 1286]};
CLASS_DATA={
'context_system': ['context_system', 'System context class ', [['lib','accesslib.php',6157]], 1147],
'context_course': ['context_course', 'Course context class ', [['lib','accesslib.php',6817]], 1323],
'context_helper': ['context_helper', 'Context maintenance and helper methods. ', [['lib','accesslib.php',5875]], 203]};
CONST_DATA={
'CONTEXT_COURSE': ['CONTEXT_COURSE', '', [['lib','accesslib.php',148]], 441],
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',140],['','install.php',93],['lib','setup.php',391]], 4153]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
