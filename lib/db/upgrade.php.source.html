<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /lib/db/upgrade.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu May 28 19:17:31 2015 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='lib/db';
filename='upgrade.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/lib/db/</a> -> <a href="upgrade.php.html">upgrade.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="upgrade.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="upgrade.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * This file keeps track of upgrades to Moodle.</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * Sometimes, changes between versions involve</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * alterations to database structures and other</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * major things that may break installations.</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> *</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> * The upgrade function in this file will attempt</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> * to perform all the necessary actions to upgrade</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment"> * your older installation to the current version.</span>
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment"> *</span>
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment"> * If there's something it cannot do itself, it</span>
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment"> * will tell you what you need to do.</span>
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment"> *</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> * The commands in here will all be database-neutral,</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> * using the methods of database_manager class</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment"> *</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment"> * Please do not forget to use upgrade_set_timeout()</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment"> * before any action that may take longer time to finish.</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment"> *</span>
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment"> * @package   core_install</span>
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment"> * @category  upgrade</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment"> * @copyright 2006 onwards Martin Dougiamas  http://dougiamas.com</span>
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l41"><span class="linenum">  41</span></a>  <span class="comment"> */</span>
<a name="l42"><span class="linenum">  42</span></a>  
<a name="l43"><span class="linenum">  43</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l44"><span class="linenum">  44</span></a>  
<a name="l45"><span class="linenum">  45</span></a>  <span class="comment">/**</span>
<a name="l46"><span class="linenum">  46</span></a>  <span class="comment"> * Main upgrade tasks to be executed on Moodle version bump</span>
<a name="l47"><span class="linenum">  47</span></a>  <span class="comment"> *</span>
<a name="l48"><span class="linenum">  48</span></a>  <span class="comment"> * This function is automatically executed after one bump in the Moodle core</span>
<a name="l49"><span class="linenum">  49</span></a>  <span class="comment"> * version is detected. It's in charge of performing the required tasks</span>
<a name="l50"><span class="linenum">  50</span></a>  <span class="comment"> * to raise core from the previous version to the next one.</span>
<a name="l51"><span class="linenum">  51</span></a>  <span class="comment"> *</span>
<a name="l52"><span class="linenum">  52</span></a>  <span class="comment"> * It's a collection of ordered blocks of code, named &quot;upgrade steps&quot;,</span>
<a name="l53"><span class="linenum">  53</span></a>  <span class="comment"> * each one performing one isolated (from the rest of steps) task. Usually</span>
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment"> * tasks involve creating new DB objects or performing manipulation of the</span>
<a name="l55"><span class="linenum">  55</span></a>  <span class="comment"> * information for cleanup/fixup purposes.</span>
<a name="l56"><span class="linenum">  56</span></a>  <span class="comment"> *</span>
<a name="l57"><span class="linenum">  57</span></a>  <span class="comment"> * Each upgrade step has a fixed structure, that can be summarised as follows:</span>
<a name="l58"><span class="linenum">  58</span></a>  <span class="comment"> *</span>
<a name="l59"><span class="linenum">  59</span></a>  <span class="comment"> * if ($oldversion &lt; XXXXXXXXXX.XX) {</span>
<a name="l60"><span class="linenum">  60</span></a>  <span class="comment"> *     // Explanation of the update step, linking to issue in the Tracker if necessary</span>
<a name="l61"><span class="linenum">  61</span></a>  <span class="comment"> *     upgrade_set_timeout(XX); // Optional for big tasks</span>
<a name="l62"><span class="linenum">  62</span></a>  <span class="comment"> *     // Code to execute goes here, usually the XMLDB Editor will</span>
<a name="l63"><span class="linenum">  63</span></a>  <span class="comment"> *     // help you here. See {@link http://docs.moodle.org/dev/XMLDB_editor}.</span>
<a name="l64"><span class="linenum">  64</span></a>  <span class="comment"> *     upgrade_main_savepoint(true, XXXXXXXXXX.XX);</span>
<a name="l65"><span class="linenum">  65</span></a>  <span class="comment"> * }</span>
<a name="l66"><span class="linenum">  66</span></a>  <span class="comment"> *</span>
<a name="l67"><span class="linenum">  67</span></a>  <span class="comment"> * All plugins within Moodle (modules, blocks, reports...) support the existence of</span>
<a name="l68"><span class="linenum">  68</span></a>  <span class="comment"> * their own upgrade.php file, using the &quot;Frankenstyle&quot; component name as</span>
<a name="l69"><span class="linenum">  69</span></a>  <span class="comment"> * defined at {@link http://docs.moodle.org/dev/Frankenstyle}, for example:</span>
<a name="l70"><span class="linenum">  70</span></a>  <span class="comment"> *     - {@link xmldb_page_upgrade($oldversion)}. (modules don't require the plugintype (&quot;mod_&quot;) to be used.</span>
<a name="l71"><span class="linenum">  71</span></a>  <span class="comment"> *     - {@link xmldb_auth_manual_upgrade($oldversion)}.</span>
<a name="l72"><span class="linenum">  72</span></a>  <span class="comment"> *     - {@link xmldb_workshopform_accumulative_upgrade($oldversion)}.</span>
<a name="l73"><span class="linenum">  73</span></a>  <span class="comment"> *     - ....</span>
<a name="l74"><span class="linenum">  74</span></a>  <span class="comment"> *</span>
<a name="l75"><span class="linenum">  75</span></a>  <span class="comment"> * In order to keep the contents of this file reduced, it's allowed to create some helper</span>
<a name="l76"><span class="linenum">  76</span></a>  <span class="comment"> * functions to be used here in the {@link upgradelib.php} file at the same directory. Note</span>
<a name="l77"><span class="linenum">  77</span></a>  <span class="comment"> * that such a file must be manually included from upgrade.php, and there are some restrictions</span>
<a name="l78"><span class="linenum">  78</span></a>  <span class="comment"> * about what can be used within it.</span>
<a name="l79"><span class="linenum">  79</span></a>  <span class="comment"> *</span>
<a name="l80"><span class="linenum">  80</span></a>  <span class="comment"> * For more information, take a look to the documentation available:</span>
<a name="l81"><span class="linenum">  81</span></a>  <span class="comment"> *     - Data definition API: {@link http://docs.moodle.org/dev/Data_definition_API}</span>
<a name="l82"><span class="linenum">  82</span></a>  <span class="comment"> *     - Upgrade API: {@link http://docs.moodle.org/dev/Upgrade_API}</span>
<a name="l83"><span class="linenum">  83</span></a>  <span class="comment"> *</span>
<a name="l84"><span class="linenum">  84</span></a>  <span class="comment"> * @param int $oldversion</span>
<a name="l85"><span class="linenum">  85</span></a>  <span class="comment"> * @return bool always true</span>
<a name="l86"><span class="linenum">  86</span></a>  <span class="comment"> */</span>
<a name="l87"><span class="linenum">  87</span></a>  function <a class="function" onClick="logFunction('xmldb_main_upgrade')" href="../../_functions/xmldb_main_upgrade.html" onMouseOver="funcPopup(event,'xmldb_main_upgrade')">xmldb_main_upgrade</a>(<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a>) {
<a name="l88"><span class="linenum">  88</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../_variables/OUTPUT.html">$OUTPUT</a>, <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a>, <a class="var it2554" onMouseOver="hilite(2554)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../_variables/COURSE.html">$COURSE</a>;
<a name="l89"><span class="linenum">  89</span></a>  
<a name="l90"><span class="linenum">  90</span></a>      require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/db/upgradelib.php'); <span class="comment">// Core Upgrade-related functions</span>
<a name="l91"><span class="linenum">  91</span></a>  
<a name="l92"><span class="linenum">  92</span></a>      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_manager')" href="../../_functions/get_manager.html" onMouseOver="funcPopup(event,'get_manager')">get_manager</a>(); <span class="comment">// loads ddl manager and xmldb classes</span>
<a name="l93"><span class="linenum">  93</span></a>  
<a name="l94"><span class="linenum">  94</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2011120500) {
<a name="l95"><span class="linenum">  95</span></a>  <span class="comment">        // just in case somebody hacks upgrade scripts or env, we really can not continue</span>
<a name="l96"><span class="linenum">  96</span></a>          echo(&quot;You need to upgrade to 2.2.x first!\n&quot;);
<a name="l97"><span class="linenum">  97</span></a>          exit(1);
<a name="l98"><span class="linenum">  98</span></a>  <span class="comment">        // Note this savepoint is 100% unreachable, but needed to pass the upgrade checks</span>
<a name="l99"><span class="linenum">  99</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2011120500);
<a name="l100"><span class="linenum"> 100</span></a>      }
<a name="l101"><span class="linenum"> 101</span></a>  
<a name="l102"><span class="linenum"> 102</span></a>  <span class="comment">    // Moodle v2.2.0 release upgrade line</span>
<a name="l103"><span class="linenum"> 103</span></a>  <span class="comment">    // Put any upgrade step following this</span>
<a name="l104"><span class="linenum"> 104</span></a>  
<a name="l105"><span class="linenum"> 105</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2011120500.02) {
<a name="l106"><span class="linenum"> 106</span></a>  
<a name="l107"><span class="linenum"> 107</span></a>          <a class="function" onClick="logFunction('upgrade_set_timeout')" href="../../_functions/upgrade_set_timeout.html" onMouseOver="funcPopup(event,'upgrade_set_timeout')">upgrade_set_timeout</a>(60*20); <span class="comment">// This may take a while</span>
<a name="l108"><span class="linenum"> 108</span></a>  <span class="comment">        // MDL-28180. Some missing restrictions in certain backup &amp; restore operations</span>
<a name="l109"><span class="linenum"> 109</span></a>  <span class="comment">        // were causing incorrect duplicates in the course_completion_aggr_methd table.</span>
<a name="l110"><span class="linenum"> 110</span></a>  <span class="comment">        // This upgrade step takes rid of them.</span>
<a name="l111"><span class="linenum"> 111</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'SELECT course, criteriatype, <a class="phpfunction" onClick="logFunction('MIN')" href="../../_functions/min.html" onMouseOver="phpfuncPopup(event,'min')">MIN</a>(id) AS minid
<a name="l112"><span class="linenum"> 112</span></a>                    FROM {course_completion_aggr_methd}
<a name="l113"><span class="linenum"> 113</span></a>                GROUP BY course, criteriatype
<a name="l114"><span class="linenum"> 114</span></a>                  HAVING <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(*) &gt; 1';
<a name="l115"><span class="linenum"> 115</span></a>          <a class="var it37316" onMouseOver="hilite(37316)" onMouseOut="lolite()" onClick="logVariable('duprs')" href="../../_variables/duprs.html">$duprs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l116"><span class="linenum"> 116</span></a>          foreach (<a class="var it37316" onMouseOver="hilite(37316)" onMouseOut="lolite()" onClick="logVariable('duprs')" href="../../_variables/duprs.html">$duprs</a> as <a class="var it37317" onMouseOver="hilite(37317)" onMouseOut="lolite()" onClick="logVariable('duprec')" href="../../_variables/duprec.html">$duprec</a>) {
<a name="l117"><span class="linenum"> 117</span></a>  <span class="comment">            // We need to handle NULLs in criteriatype diferently</span>
<a name="l118"><span class="linenum"> 118</span></a>              if (<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it37317" onMouseOver="hilite(37317)" onMouseOut="lolite()" onClick="logVariable('duprec')" href="../../_variables/duprec.html">$duprec</a>-&gt;<a onClick="logVariable('criteriatype')" class="var it41667" onMouseOver="hilite(41667)" onMouseOut="lolite()" href="../../_variables/criteriatype.html">criteriatype</a>)) {
<a name="l119"><span class="linenum"> 119</span></a>                  <a class="var it1076" onMouseOver="hilite(1076)" onMouseOut="lolite()" onClick="logVariable('where')" href="../../_variables/where.html">$where</a> = 'course = ? AND criteriatype IS NULL AND id &gt; ?';
<a name="l120"><span class="linenum"> 120</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(<a class="var it37317" onMouseOver="hilite(37317)" onMouseOut="lolite()" onClick="logVariable('duprec')" href="../../_variables/duprec.html">$duprec</a>-&gt;<a onClick="logVariable('course')" class="var it41667" onMouseOver="hilite(41667)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>, <a class="var it37317" onMouseOver="hilite(37317)" onMouseOut="lolite()" onClick="logVariable('duprec')" href="../../_variables/duprec.html">$duprec</a>-&gt;<a onClick="logVariable('minid')" class="var it41667" onMouseOver="hilite(41667)" onMouseOut="lolite()" href="../../_variables/minid.html">minid</a>);
<a name="l121"><span class="linenum"> 121</span></a>              } else {
<a name="l122"><span class="linenum"> 122</span></a>                  <a class="var it1076" onMouseOver="hilite(1076)" onMouseOut="lolite()" onClick="logVariable('where')" href="../../_variables/where.html">$where</a> = 'course = ? AND criteriatype = ? AND id &gt; ?';
<a name="l123"><span class="linenum"> 123</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(<a class="var it37317" onMouseOver="hilite(37317)" onMouseOut="lolite()" onClick="logVariable('duprec')" href="../../_variables/duprec.html">$duprec</a>-&gt;<a onClick="logVariable('course')" class="var it41667" onMouseOver="hilite(41667)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>, <a class="var it37317" onMouseOver="hilite(37317)" onMouseOut="lolite()" onClick="logVariable('duprec')" href="../../_variables/duprec.html">$duprec</a>-&gt;<a onClick="logVariable('criteriatype')" class="var it41667" onMouseOver="hilite(41667)" onMouseOut="lolite()" href="../../_variables/criteriatype.html">criteriatype</a>, <a class="var it37317" onMouseOver="hilite(37317)" onMouseOut="lolite()" onClick="logVariable('duprec')" href="../../_variables/duprec.html">$duprec</a>-&gt;<a onClick="logVariable('minid')" class="var it41667" onMouseOver="hilite(41667)" onMouseOut="lolite()" href="../../_variables/minid.html">minid</a>);
<a name="l124"><span class="linenum"> 124</span></a>              }
<a name="l125"><span class="linenum"> 125</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('course_completion_aggr_methd', <a class="var it1076" onMouseOver="hilite(1076)" onMouseOut="lolite()" onClick="logVariable('where')" href="../../_variables/where.html">$where</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l126"><span class="linenum"> 126</span></a>          }
<a name="l127"><span class="linenum"> 127</span></a>          <a class="var it37316" onMouseOver="hilite(37316)" onMouseOut="lolite()" onClick="logVariable('duprs')" href="../../_variables/duprs.html">$duprs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l128"><span class="linenum"> 128</span></a>  
<a name="l129"><span class="linenum"> 129</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l130"><span class="linenum"> 130</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2011120500.02);
<a name="l131"><span class="linenum"> 131</span></a>      }
<a name="l132"><span class="linenum"> 132</span></a>  
<a name="l133"><span class="linenum"> 133</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2011120500.03) {
<a name="l134"><span class="linenum"> 134</span></a>  
<a name="l135"><span class="linenum"> 135</span></a>  <span class="comment">        // Changing precision of field value on table user_preferences to (1333)</span>
<a name="l136"><span class="linenum"> 136</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('user_preferences');
<a name="l137"><span class="linenum"> 137</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('value', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '1333', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'name');
<a name="l138"><span class="linenum"> 138</span></a>  
<a name="l139"><span class="linenum"> 139</span></a>  <span class="comment">        // Launch change of precision for field value</span>
<a name="l140"><span class="linenum"> 140</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('change_field_precision')" href="../../_functions/change_field_precision.html" onMouseOver="funcPopup(event,'change_field_precision')">change_field_precision</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l141"><span class="linenum"> 141</span></a>  
<a name="l142"><span class="linenum"> 142</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l143"><span class="linenum"> 143</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2011120500.03);
<a name="l144"><span class="linenum"> 144</span></a>      }
<a name="l145"><span class="linenum"> 145</span></a>  
<a name="l146"><span class="linenum"> 146</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012020200.03) {
<a name="l147"><span class="linenum"> 147</span></a>  
<a name="l148"><span class="linenum"> 148</span></a>  <span class="comment">        // Define index rolecontext (not unique) to be added to role_assignments</span>
<a name="l149"><span class="linenum"> 149</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('role_assignments');
<a name="l150"><span class="linenum"> 150</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('rolecontext', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('roleid', 'contextid'));
<a name="l151"><span class="linenum"> 151</span></a>  
<a name="l152"><span class="linenum"> 152</span></a>  <span class="comment">        // Conditionally launch add index rolecontext</span>
<a name="l153"><span class="linenum"> 153</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l154"><span class="linenum"> 154</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l155"><span class="linenum"> 155</span></a>          }
<a name="l156"><span class="linenum"> 156</span></a>  
<a name="l157"><span class="linenum"> 157</span></a>  <span class="comment">        // Define index usercontextrole (not unique) to be added to role_assignments</span>
<a name="l158"><span class="linenum"> 158</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('usercontextrole', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('userid', 'contextid', 'roleid'));
<a name="l159"><span class="linenum"> 159</span></a>  
<a name="l160"><span class="linenum"> 160</span></a>  <span class="comment">        // Conditionally launch add index usercontextrole</span>
<a name="l161"><span class="linenum"> 161</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l162"><span class="linenum"> 162</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l163"><span class="linenum"> 163</span></a>          }
<a name="l164"><span class="linenum"> 164</span></a>  
<a name="l165"><span class="linenum"> 165</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l166"><span class="linenum"> 166</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012020200.03);
<a name="l167"><span class="linenum"> 167</span></a>      }
<a name="l168"><span class="linenum"> 168</span></a>  
<a name="l169"><span class="linenum"> 169</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012020200.06) {
<a name="l170"><span class="linenum"> 170</span></a>  <span class="comment">        // Previously we always allowed users to override their email address via the messaging system</span>
<a name="l171"><span class="linenum"> 171</span></a>  <span class="comment">        // We have now added a setting to allow admins to turn this this ability on and off</span>
<a name="l172"><span class="linenum"> 172</span></a>  <span class="comment">        // While this setting defaults to 0 (off) we're setting it to 1 (on) to maintain the behaviour for upgrading sites</span>
<a name="l173"><span class="linenum"> 173</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('messagingallowemailoverride', 1);
<a name="l174"><span class="linenum"> 174</span></a>  
<a name="l175"><span class="linenum"> 175</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l176"><span class="linenum"> 176</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012020200.06);
<a name="l177"><span class="linenum"> 177</span></a>      }
<a name="l178"><span class="linenum"> 178</span></a>  
<a name="l179"><span class="linenum"> 179</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012021700.01) {
<a name="l180"><span class="linenum"> 180</span></a>  <span class="comment">        // Changing precision of field uniquehash on table post to 255</span>
<a name="l181"><span class="linenum"> 181</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('post');
<a name="l182"><span class="linenum"> 182</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('uniquehash', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'content');
<a name="l183"><span class="linenum"> 183</span></a>  
<a name="l184"><span class="linenum"> 184</span></a>  <span class="comment">        // Launch change of precision for field uniquehash</span>
<a name="l185"><span class="linenum"> 185</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('change_field_precision')" href="../../_functions/change_field_precision.html" onMouseOver="funcPopup(event,'change_field_precision')">change_field_precision</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l186"><span class="linenum"> 186</span></a>  
<a name="l187"><span class="linenum"> 187</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l188"><span class="linenum"> 188</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012021700.01);
<a name="l189"><span class="linenum"> 189</span></a>      }
<a name="l190"><span class="linenum"> 190</span></a>  
<a name="l191"><span class="linenum"> 191</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012021700.02) {
<a name="l192"><span class="linenum"> 192</span></a>  <span class="comment">        // Somewhere before 1.9 summary and content column in post table were not null. In 1.9+</span>
<a name="l193"><span class="linenum"> 193</span></a>  <span class="comment">        // not null became false.</span>
<a name="l194"><span class="linenum"> 194</span></a>          <a class="var it1020" onMouseOver="hilite(1020)" onMouseOut="lolite()" onClick="logVariable('columns')" href="../../_variables/columns.html">$columns</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_columns')" href="../../_functions/get_columns.html" onMouseOver="funcPopup(event,'get_columns')">get_columns</a>('post');
<a name="l195"><span class="linenum"> 195</span></a>  
<a name="l196"><span class="linenum"> 196</span></a>  <span class="comment">        // Fix discrepancies in summary field after upgrade from 1.9</span>
<a name="l197"><span class="linenum"> 197</span></a>          if (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>('summary', <a class="var it1020" onMouseOver="hilite(1020)" onMouseOut="lolite()" onClick="logVariable('columns')" href="../../_variables/columns.html">$columns</a>) &amp;&amp; <a class="var it1020" onMouseOver="hilite(1020)" onMouseOut="lolite()" onClick="logVariable('columns')" href="../../_variables/columns.html">$columns</a>['summary']-&gt;not_null != false) {
<a name="l198"><span class="linenum"> 198</span></a>              <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('post');
<a name="l199"><span class="linenum"> 199</span></a>              <a class="var it37319" onMouseOver="hilite(37319)" onMouseOut="lolite()" onClick="logVariable('summaryfield')" href="../../_variables/summaryfield.html">$summaryfield</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('summary', <a class="constant" onClick="logConstant('XMLDB_TYPE_TEXT')" href="../../_constants/XMLDB_TYPE_TEXT.html" onMouseOver="constPopup(event,'XMLDB_TYPE_TEXT')">XMLDB_TYPE_TEXT</a>, 'big', null, null, null, null, 'subject');
<a name="l200"><span class="linenum"> 200</span></a>  
<a name="l201"><span class="linenum"> 201</span></a>              if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it37319" onMouseOver="hilite(37319)" onMouseOut="lolite()" onClick="logVariable('summaryfield')" href="../../_variables/summaryfield.html">$summaryfield</a>)) {
<a name="l202"><span class="linenum"> 202</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('change_field_notnull')" href="../../_functions/change_field_notnull.html" onMouseOver="funcPopup(event,'change_field_notnull')">change_field_notnull</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it37319" onMouseOver="hilite(37319)" onMouseOut="lolite()" onClick="logVariable('summaryfield')" href="../../_variables/summaryfield.html">$summaryfield</a>);
<a name="l203"><span class="linenum"> 203</span></a>              }
<a name="l204"><span class="linenum"> 204</span></a>  
<a name="l205"><span class="linenum"> 205</span></a>          }
<a name="l206"><span class="linenum"> 206</span></a>  
<a name="l207"><span class="linenum"> 207</span></a>  <span class="comment">        // Fix discrepancies in content field after upgrade from 1.9</span>
<a name="l208"><span class="linenum"> 208</span></a>          if (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>('content', <a class="var it1020" onMouseOver="hilite(1020)" onMouseOut="lolite()" onClick="logVariable('columns')" href="../../_variables/columns.html">$columns</a>) &amp;&amp; <a class="var it1020" onMouseOver="hilite(1020)" onMouseOut="lolite()" onClick="logVariable('columns')" href="../../_variables/columns.html">$columns</a>['content']-&gt;not_null != false) {
<a name="l209"><span class="linenum"> 209</span></a>              <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('post');
<a name="l210"><span class="linenum"> 210</span></a>              <a class="var it37320" onMouseOver="hilite(37320)" onMouseOut="lolite()" onClick="logVariable('contentfield')" href="../../_variables/contentfield.html">$contentfield</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('content', <a class="constant" onClick="logConstant('XMLDB_TYPE_TEXT')" href="../../_constants/XMLDB_TYPE_TEXT.html" onMouseOver="constPopup(event,'XMLDB_TYPE_TEXT')">XMLDB_TYPE_TEXT</a>, 'big', null, null, null, null, 'summary');
<a name="l211"><span class="linenum"> 211</span></a>  
<a name="l212"><span class="linenum"> 212</span></a>              if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it37320" onMouseOver="hilite(37320)" onMouseOut="lolite()" onClick="logVariable('contentfield')" href="../../_variables/contentfield.html">$contentfield</a>)) {
<a name="l213"><span class="linenum"> 213</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('change_field_notnull')" href="../../_functions/change_field_notnull.html" onMouseOver="funcPopup(event,'change_field_notnull')">change_field_notnull</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it37320" onMouseOver="hilite(37320)" onMouseOut="lolite()" onClick="logVariable('contentfield')" href="../../_variables/contentfield.html">$contentfield</a>);
<a name="l214"><span class="linenum"> 214</span></a>              }
<a name="l215"><span class="linenum"> 215</span></a>  
<a name="l216"><span class="linenum"> 216</span></a>          }
<a name="l217"><span class="linenum"> 217</span></a>  
<a name="l218"><span class="linenum"> 218</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012021700.02);
<a name="l219"><span class="linenum"> 219</span></a>      }
<a name="l220"><span class="linenum"> 220</span></a>  
<a name="l221"><span class="linenum"> 221</span></a>  <span class="comment">    // The ability to backup user (private) files is out completely - MDL-29248</span>
<a name="l222"><span class="linenum"> 222</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012030100.01) {
<a name="l223"><span class="linenum"> 223</span></a>          <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('backup_general_user_files', 'backup');
<a name="l224"><span class="linenum"> 224</span></a>          <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('backup_general_user_files_locked', 'backup');
<a name="l225"><span class="linenum"> 225</span></a>          <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('backup_auto_user_files', 'backup');
<a name="l226"><span class="linenum"> 226</span></a>  
<a name="l227"><span class="linenum"> 227</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012030100.01);
<a name="l228"><span class="linenum"> 228</span></a>      }
<a name="l229"><span class="linenum"> 229</span></a>  
<a name="l230"><span class="linenum"> 230</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012030900.01) {
<a name="l231"><span class="linenum"> 231</span></a>  <span class="comment">        // Migrate all numbers to signed &amp; all texts and binaries to big size.</span>
<a name="l232"><span class="linenum"> 232</span></a>  <span class="comment">        // It should be safe to interrupt this and continue later.</span>
<a name="l233"><span class="linenum"> 233</span></a>          <a class="function" onClick="logFunction('upgrade_mysql_fix_unsigned_and_lob_columns')" href="../../_functions/upgrade_mysql_fix_unsigned_and_lob_columns.html" onMouseOver="funcPopup(event,'upgrade_mysql_fix_unsigned_and_lob_columns')">upgrade_mysql_fix_unsigned_and_lob_columns</a>();
<a name="l234"><span class="linenum"> 234</span></a>  
<a name="l235"><span class="linenum"> 235</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l236"><span class="linenum"> 236</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012030900.01);
<a name="l237"><span class="linenum"> 237</span></a>      }
<a name="l238"><span class="linenum"> 238</span></a>  
<a name="l239"><span class="linenum"> 239</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012031500.01) {
<a name="l240"><span class="linenum"> 240</span></a>  <span class="comment">        // Upgrade old course_allowed_modules data to be permission overrides.</span>
<a name="l241"><span class="linenum"> 241</span></a>          if (<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('restrictmodulesfor')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/restrictmodulesfor.html">restrictmodulesfor</a> === 'all') {
<a name="l242"><span class="linenum"> 242</span></a>              <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_menu')" href="../../_functions/get_records_menu.html" onMouseOver="funcPopup(event,'get_records_menu')">get_records_menu</a>('course', array(), 'id', 'id, 1');
<a name="l243"><span class="linenum"> 243</span></a>          } else if (<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('restrictmodulesfor')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/restrictmodulesfor.html">restrictmodulesfor</a> === 'requested') {
<a name="l244"><span class="linenum"> 244</span></a>              <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_menu')" href="../../_functions/get_records_menu.html" onMouseOver="funcPopup(event,'get_records_menu')">get_records_menu</a>('course', array('restrictmodules' =&gt; 1), 'id', 'id, 1');
<a name="l245"><span class="linenum"> 245</span></a>          } else {
<a name="l246"><span class="linenum"> 246</span></a>              <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> = array();
<a name="l247"><span class="linenum"> 247</span></a>          }
<a name="l248"><span class="linenum"> 248</span></a>  
<a name="l249"><span class="linenum"> 249</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>('course_allowed_modules')) {
<a name="l250"><span class="linenum"> 250</span></a>  <span class="comment">            // Upgrade must already have been run on this server. This might happen,</span>
<a name="l251"><span class="linenum"> 251</span></a>  <span class="comment">            // for example, during development of these changes.</span>
<a name="l252"><span class="linenum"> 252</span></a>              <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> = array();
<a name="l253"><span class="linenum"> 253</span></a>          }
<a name="l254"><span class="linenum"> 254</span></a>  
<a name="l255"><span class="linenum"> 255</span></a>          <a class="var it37322" onMouseOver="hilite(37322)" onMouseOut="lolite()" onClick="logVariable('modidtoname')" href="../../_variables/modidtoname.html">$modidtoname</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_menu')" href="../../_functions/get_records_menu.html" onMouseOver="funcPopup(event,'get_records_menu')">get_records_menu</a>('modules', array(), 'id', 'id, name');
<a name="l256"><span class="linenum"> 256</span></a>  
<a name="l257"><span class="linenum"> 257</span></a>          <a class="var it3888" onMouseOver="hilite(3888)" onMouseOut="lolite()" onClick="logVariable('coursecount')" href="../../_variables/coursecount.html">$coursecount</a> = <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>);
<a name="l258"><span class="linenum"> 258</span></a>          if (<a class="var it3888" onMouseOver="hilite(3888)" onMouseOut="lolite()" onClick="logVariable('coursecount')" href="../../_variables/coursecount.html">$coursecount</a>) {
<a name="l259"><span class="linenum"> 259</span></a>              <a class="var it8016" onMouseOver="hilite(8016)" onMouseOut="lolite()" onClick="logVariable('pbar')" href="../../_variables/pbar.html">$pbar</a> = <span class="keyword">new </span><a class="class" onClick="logClass('progress_bar')" href="../../_classes/progress_bar.html" onMouseOver="classPopup(event,'progress_bar')">progress_bar</a>('allowedmods', 500, true);
<a name="l260"><span class="linenum"> 260</span></a>              <a class="var it2929" onMouseOver="hilite(2929)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l261"><span class="linenum"> 261</span></a>          }
<a name="l262"><span class="linenum"> 262</span></a>  
<a name="l263"><span class="linenum"> 263</span></a>          <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> = 0;
<a name="l264"><span class="linenum"> 264</span></a>          foreach (<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> as <a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> =&gt; <a class="var it2596" onMouseOver="hilite(2596)" onMouseOut="lolite()" onClick="logVariable('notused')" href="../../_variables/notused.html">$notused</a>) {
<a name="l265"><span class="linenum"> 265</span></a>              <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> += 1;
<a name="l266"><span class="linenum"> 266</span></a>              <a class="function" onClick="logFunction('upgrade_set_timeout')" href="../../_functions/upgrade_set_timeout.html" onMouseOver="funcPopup(event,'upgrade_set_timeout')">upgrade_set_timeout</a>(60); <span class="comment">// 1 minute per course should be fine.</span>
<a name="l267"><span class="linenum"> 267</span></a>  
<a name="l268"><span class="linenum"> 268</span></a>              <a class="var it37323" onMouseOver="hilite(37323)" onMouseOut="lolite()" onClick="logVariable('allowedmoduleids')" href="../../_variables/allowedmoduleids.html">$allowedmoduleids</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_menu')" href="../../_functions/get_records_menu.html" onMouseOver="funcPopup(event,'get_records_menu')">get_records_menu</a>('course_allowed_modules',
<a name="l269"><span class="linenum"> 269</span></a>              array('course' =&gt; <a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>), 'module', 'module, 1');
<a name="l270"><span class="linenum"> 270</span></a>              if (empty(<a class="var it37323" onMouseOver="hilite(37323)" onMouseOut="lolite()" onClick="logVariable('allowedmoduleids')" href="../../_variables/allowedmoduleids.html">$allowedmoduleids</a>)) {
<a name="l271"><span class="linenum"> 271</span></a>  <span class="comment">                // This seems to be the best match for backwards compatibility,</span>
<a name="l272"><span class="linenum"> 272</span></a>  <span class="comment">                // not necessarily with the old code in course_allowed_module function,</span>
<a name="l273"><span class="linenum"> 273</span></a>  <span class="comment">                // but with the code that used to be in the coures settings form.</span>
<a name="l274"><span class="linenum"> 274</span></a>                  <a class="var it37323" onMouseOver="hilite(37323)" onMouseOut="lolite()" onClick="logVariable('allowedmoduleids')" href="../../_variables/allowedmoduleids.html">$allowedmoduleids</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultallowedmodules')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/defaultallowedmodules.html">defaultallowedmodules</a>);
<a name="l275"><span class="linenum"> 275</span></a>                  <a class="var it37323" onMouseOver="hilite(37323)" onMouseOut="lolite()" onClick="logVariable('allowedmoduleids')" href="../../_variables/allowedmoduleids.html">$allowedmoduleids</a> = <a class="phpfunction" onClick="logFunction('array_combine')" href="../../_functions/array_combine.html" onMouseOver="phpfuncPopup(event,'array_combine')">array_combine</a>(<a class="var it37323" onMouseOver="hilite(37323)" onMouseOut="lolite()" onClick="logVariable('allowedmoduleids')" href="../../_variables/allowedmoduleids.html">$allowedmoduleids</a>, <a class="var it37323" onMouseOver="hilite(37323)" onMouseOut="lolite()" onClick="logVariable('allowedmoduleids')" href="../../_variables/allowedmoduleids.html">$allowedmoduleids</a>);
<a name="l276"><span class="linenum"> 276</span></a>              }
<a name="l277"><span class="linenum"> 277</span></a>  
<a name="l278"><span class="linenum"> 278</span></a>              <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l279"><span class="linenum"> 279</span></a>  
<a name="l280"><span class="linenum"> 280</span></a>              <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it3996" onMouseOver="hilite(3996)" onMouseOut="lolite()" onClick="logVariable('roleids')" href="../../_variables/roleids.html">$roleids</a>) = <a class="function" onClick="logFunction('get_roles_with_cap_in_context')" href="../../_functions/get_roles_with_cap_in_context.html" onMouseOver="funcPopup(event,'get_roles_with_cap_in_context')">get_roles_with_cap_in_context</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/course:manageactivities');
<a name="l281"><span class="linenum"> 281</span></a>              <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it37325" onMouseOver="hilite(37325)" onMouseOut="lolite()" onClick="logVariable('managerroleids')" href="../../_variables/managerroleids.html">$managerroleids</a>) = <a class="function" onClick="logFunction('get_roles_with_cap_in_context')" href="../../_functions/get_roles_with_cap_in_context.html" onMouseOver="funcPopup(event,'get_roles_with_cap_in_context')">get_roles_with_cap_in_context</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/site:config');
<a name="l282"><span class="linenum"> 282</span></a>              foreach (<a class="var it37325" onMouseOver="hilite(37325)" onMouseOut="lolite()" onClick="logVariable('managerroleids')" href="../../_variables/managerroleids.html">$managerroleids</a> as <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>) {
<a name="l283"><span class="linenum"> 283</span></a>                  unset(<a class="var it3996" onMouseOver="hilite(3996)" onMouseOut="lolite()" onClick="logVariable('roleids')" href="../../_variables/roleids.html">$roleids</a>[<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>]);
<a name="l284"><span class="linenum"> 284</span></a>              }
<a name="l285"><span class="linenum"> 285</span></a>  
<a name="l286"><span class="linenum"> 286</span></a>              foreach (<a class="var it37322" onMouseOver="hilite(37322)" onMouseOut="lolite()" onClick="logVariable('modidtoname')" href="../../_variables/modidtoname.html">$modidtoname</a> as <a class="var it5866" onMouseOver="hilite(5866)" onMouseOut="lolite()" onClick="logVariable('modid')" href="../../_variables/modid.html">$modid</a> =&gt; <a class="var it561" onMouseOver="hilite(561)" onMouseOut="lolite()" onClick="logVariable('modname')" href="../../_variables/modname.html">$modname</a>) {
<a name="l287"><span class="linenum"> 287</span></a>                  if (isset(<a class="var it37323" onMouseOver="hilite(37323)" onMouseOut="lolite()" onClick="logVariable('allowedmoduleids')" href="../../_variables/allowedmoduleids.html">$allowedmoduleids</a>[<a class="var it5866" onMouseOver="hilite(5866)" onMouseOut="lolite()" onClick="logVariable('modid')" href="../../_variables/modid.html">$modid</a>])) {
<a name="l288"><span class="linenum"> 288</span></a>  <span class="comment">                    // Module is allowed, no worries.</span>
<a name="l289"><span class="linenum"> 289</span></a>                      continue;
<a name="l290"><span class="linenum"> 290</span></a>                  }
<a name="l291"><span class="linenum"> 291</span></a>  
<a name="l292"><span class="linenum"> 292</span></a>                  <a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a> = 'mod/' . <a class="var it561" onMouseOver="hilite(561)" onMouseOut="lolite()" onClick="logVariable('modname')" href="../../_variables/modname.html">$modname</a> . ':addinstance';
<a name="l293"><span class="linenum"> 293</span></a>                  foreach (<a class="var it3996" onMouseOver="hilite(3996)" onMouseOut="lolite()" onClick="logVariable('roleids')" href="../../_variables/roleids.html">$roleids</a> as <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>) {
<a name="l294"><span class="linenum"> 294</span></a>                      <a class="function" onClick="logFunction('assign_capability')" href="../../_functions/assign_capability.html" onMouseOver="funcPopup(event,'assign_capability')">assign_capability</a>(<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>, <a class="constant" onClick="logConstant('CAP_PREVENT')" href="../../_constants/CAP_PREVENT.html" onMouseOver="constPopup(event,'CAP_PREVENT')">CAP_PREVENT</a>, <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l295"><span class="linenum"> 295</span></a>                  }
<a name="l296"><span class="linenum"> 296</span></a>              }
<a name="l297"><span class="linenum"> 297</span></a>  
<a name="l298"><span class="linenum"> 298</span></a>              <a class="var it8016" onMouseOver="hilite(8016)" onMouseOut="lolite()" onClick="logVariable('pbar')" href="../../_variables/pbar.html">$pbar</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>(<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>, <a class="var it3888" onMouseOver="hilite(3888)" onMouseOut="lolite()" onClick="logVariable('coursecount')" href="../../_variables/coursecount.html">$coursecount</a>, &quot;Upgrading legacy course_allowed_modules data - <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>/<a class="var it3888" onMouseOver="hilite(3888)" onMouseOut="lolite()" onClick="logVariable('coursecount')" href="../../_variables/coursecount.html">$coursecount</a>.&quot;);
<a name="l299"><span class="linenum"> 299</span></a>          }
<a name="l300"><span class="linenum"> 300</span></a>  
<a name="l301"><span class="linenum"> 301</span></a>          if (<a class="var it3888" onMouseOver="hilite(3888)" onMouseOut="lolite()" onClick="logVariable('coursecount')" href="../../_variables/coursecount.html">$coursecount</a>) {
<a name="l302"><span class="linenum"> 302</span></a>              <a class="var it2929" onMouseOver="hilite(2929)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l303"><span class="linenum"> 303</span></a>          }
<a name="l304"><span class="linenum"> 304</span></a>  
<a name="l305"><span class="linenum"> 305</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012031500.01);
<a name="l306"><span class="linenum"> 306</span></a>      }
<a name="l307"><span class="linenum"> 307</span></a>  
<a name="l308"><span class="linenum"> 308</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012031500.02) {
<a name="l309"><span class="linenum"> 309</span></a>  
<a name="l310"><span class="linenum"> 310</span></a>  <span class="comment">        // Define field restrictmodules to be dropped from course</span>
<a name="l311"><span class="linenum"> 311</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course');
<a name="l312"><span class="linenum"> 312</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('restrictmodules');
<a name="l313"><span class="linenum"> 313</span></a>  
<a name="l314"><span class="linenum"> 314</span></a>  <span class="comment">        // Conditionally launch drop field requested</span>
<a name="l315"><span class="linenum"> 315</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l316"><span class="linenum"> 316</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l317"><span class="linenum"> 317</span></a>          }
<a name="l318"><span class="linenum"> 318</span></a>  
<a name="l319"><span class="linenum"> 319</span></a>  <span class="comment">        // Since structure of 'course' table has changed we need to re-read $SITE from DB.</span>
<a name="l320"><span class="linenum"> 320</span></a>          <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id' =&gt; <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a>-&gt;<a onClick="logVariable('id')" class="var it39635" onMouseOver="hilite(39635)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l321"><span class="linenum"> 321</span></a>          <a class="var it2554" onMouseOver="hilite(2554)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../_variables/COURSE.html">$COURSE</a> = <a class="function" onClick="logFunction('clone')" href="../../_functions/clone.html" onMouseOver="funcPopup(event,'clone')">clone</a>(<a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a>);
<a name="l322"><span class="linenum"> 322</span></a>  
<a name="l323"><span class="linenum"> 323</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012031500.02);
<a name="l324"><span class="linenum"> 324</span></a>      }
<a name="l325"><span class="linenum"> 325</span></a>  
<a name="l326"><span class="linenum"> 326</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012031500.03) {
<a name="l327"><span class="linenum"> 327</span></a>  
<a name="l328"><span class="linenum"> 328</span></a>  <span class="comment">        // Define table course_allowed_modules to be dropped</span>
<a name="l329"><span class="linenum"> 329</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_allowed_modules');
<a name="l330"><span class="linenum"> 330</span></a>  
<a name="l331"><span class="linenum"> 331</span></a>  <span class="comment">        // Conditionally launch drop table for course_allowed_modules</span>
<a name="l332"><span class="linenum"> 332</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l333"><span class="linenum"> 333</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_table')" href="../../_functions/drop_table.html" onMouseOver="funcPopup(event,'drop_table')">drop_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l334"><span class="linenum"> 334</span></a>          }
<a name="l335"><span class="linenum"> 335</span></a>  
<a name="l336"><span class="linenum"> 336</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012031500.03);
<a name="l337"><span class="linenum"> 337</span></a>      }
<a name="l338"><span class="linenum"> 338</span></a>  
<a name="l339"><span class="linenum"> 339</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012031500.04) {
<a name="l340"><span class="linenum"> 340</span></a>  <span class="comment">        // Clean up the old admin settings.</span>
<a name="l341"><span class="linenum"> 341</span></a>          <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('restrictmodulesfor');
<a name="l342"><span class="linenum"> 342</span></a>          <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('restrictbydefault');
<a name="l343"><span class="linenum"> 343</span></a>          <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('defaultallowedmodules');
<a name="l344"><span class="linenum"> 344</span></a>  
<a name="l345"><span class="linenum"> 345</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012031500.04);
<a name="l346"><span class="linenum"> 346</span></a>      }
<a name="l347"><span class="linenum"> 347</span></a>  
<a name="l348"><span class="linenum"> 348</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012032300.02) {
<a name="l349"><span class="linenum"> 349</span></a>  <span class="comment">        // Migrate the old admin debug setting.</span>
<a name="l350"><span class="linenum"> 350</span></a>          if (<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('debug')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/debug.html">debug</a> == 38911) {
<a name="l351"><span class="linenum"> 351</span></a>              <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('debug', <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l352"><span class="linenum"> 352</span></a>          } else if (<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('debug')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/debug.html">debug</a> == 6143) {
<a name="l353"><span class="linenum"> 353</span></a>              <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('debug', <a class="constant" onClick="logConstant('DEBUG_ALL')" href="../../_constants/DEBUG_ALL.html" onMouseOver="constPopup(event,'DEBUG_ALL')">DEBUG_ALL</a>);
<a name="l354"><span class="linenum"> 354</span></a>          }
<a name="l355"><span class="linenum"> 355</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012032300.02);
<a name="l356"><span class="linenum"> 356</span></a>      }
<a name="l357"><span class="linenum"> 357</span></a>  
<a name="l358"><span class="linenum"> 358</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012042300.00) {
<a name="l359"><span class="linenum"> 359</span></a>  <span class="comment">        // This change makes the course_section index unique.</span>
<a name="l360"><span class="linenum"> 360</span></a>  
<a name="l361"><span class="linenum"> 361</span></a>  <span class="comment">        // Look for any duplicate course_sections entries. There should not be</span>
<a name="l362"><span class="linenum"> 362</span></a>  <span class="comment">        // any but on some busy systems we found a few, maybe due to previous</span>
<a name="l363"><span class="linenum"> 363</span></a>  <span class="comment">        // bugs.</span>
<a name="l364"><span class="linenum"> 364</span></a>          <a class="var it2929" onMouseOver="hilite(2929)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l365"><span class="linenum"> 365</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>('
<a name="l366"><span class="linenum"> 366</span></a>                  SELECT DISTINCT
<a name="l367"><span class="linenum"> 367</span></a>                      cs.id, cs.course
<a name="l368"><span class="linenum"> 368</span></a>                  FROM
<a name="l369"><span class="linenum"> 369</span></a>                      {course_sections} cs
<a name="l370"><span class="linenum"> 370</span></a>                      INNER JOIN {course_sections} older
<a name="l371"><span class="linenum"> 371</span></a>                          ON cs.course = older.course AND cs.section = older.section
<a name="l372"><span class="linenum"> 372</span></a>                          AND older.id &lt; cs.id');
<a name="l373"><span class="linenum"> 373</span></a>          foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>) {
<a name="l374"><span class="linenum"> 374</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('course_sections', array('id' =&gt; <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('id')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l375"><span class="linenum"> 375</span></a>  <span class="comment">            // We can't use rebuild_course_cache() here because introducing sectioncache later</span>
<a name="l376"><span class="linenum"> 376</span></a>  <span class="comment">            // so reset modinfo manually.</span>
<a name="l377"><span class="linenum"> 377</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('course', 'modinfo', null, array('id' =&gt; <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('course')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>));
<a name="l378"><span class="linenum"> 378</span></a>          }
<a name="l379"><span class="linenum"> 379</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l380"><span class="linenum"> 380</span></a>          <a class="var it2929" onMouseOver="hilite(2929)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l381"><span class="linenum"> 381</span></a>  
<a name="l382"><span class="linenum"> 382</span></a>  <span class="comment">        // XMLDB does not allow changing index uniqueness - instead we must drop</span>
<a name="l383"><span class="linenum"> 383</span></a>  <span class="comment">        // index then add it again.</span>
<a name="l384"><span class="linenum"> 384</span></a>  <span class="comment">        // MDL-46182: The query to make the index unique uses the index,</span>
<a name="l385"><span class="linenum"> 385</span></a>  <span class="comment">        // so the removal of the non-unique version needs to happen after any</span>
<a name="l386"><span class="linenum"> 386</span></a>  <span class="comment">        // data changes have been made.</span>
<a name="l387"><span class="linenum"> 387</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_sections');
<a name="l388"><span class="linenum"> 388</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('course_section', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('course', 'section'));
<a name="l389"><span class="linenum"> 389</span></a>  
<a name="l390"><span class="linenum"> 390</span></a>  <span class="comment">        // Conditionally launch drop index course_section.</span>
<a name="l391"><span class="linenum"> 391</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l392"><span class="linenum"> 392</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_index')" href="../../_functions/drop_index.html" onMouseOver="funcPopup(event,'drop_index')">drop_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l393"><span class="linenum"> 393</span></a>          }
<a name="l394"><span class="linenum"> 394</span></a>  
<a name="l395"><span class="linenum"> 395</span></a>  <span class="comment">        // Define index course_section (unique) to be added to course_sections</span>
<a name="l396"><span class="linenum"> 396</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('course_section', <a class="constant" onClick="logConstant('XMLDB_INDEX_UNIQUE')" href="../../_constants/XMLDB_INDEX_UNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_UNIQUE')">XMLDB_INDEX_UNIQUE</a>, array('course', 'section'));
<a name="l397"><span class="linenum"> 397</span></a>  
<a name="l398"><span class="linenum"> 398</span></a>  <span class="comment">        // Conditionally launch add index course_section</span>
<a name="l399"><span class="linenum"> 399</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l400"><span class="linenum"> 400</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l401"><span class="linenum"> 401</span></a>          }
<a name="l402"><span class="linenum"> 402</span></a>  
<a name="l403"><span class="linenum"> 403</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l404"><span class="linenum"> 404</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012042300.00);
<a name="l405"><span class="linenum"> 405</span></a>      }
<a name="l406"><span class="linenum"> 406</span></a>  
<a name="l407"><span class="linenum"> 407</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012042300.02) {
<a name="l408"><span class="linenum"> 408</span></a>          require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../../completion/criteria/completion_criteria.php.html">/completion/criteria/completion_criteria.php</a>');
<a name="l409"><span class="linenum"> 409</span></a>  <span class="comment">        // Delete orphaned criteria which were left when modules were removed</span>
<a name="l410"><span class="linenum"> 410</span></a>          if (<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_dbfamily')" href="../../_functions/get_dbfamily.html" onMouseOver="funcPopup(event,'get_dbfamily')">get_dbfamily</a>() === 'mysql') {
<a name="l411"><span class="linenum"> 411</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;DELETE cc FROM {course_completion_criteria} cc
<a name="l412"><span class="linenum"> 412</span></a>                      LEFT JOIN {course_modules} cm ON cm.id = cc.moduleinstance
<a name="l413"><span class="linenum"> 413</span></a>                      WHERE cm.id IS NULL AND cc.criteriatype = &quot;.<a class="constant" onClick="logConstant('COMPLETION_CRITERIA_TYPE_ACTIVITY')" href="../../_constants/COMPLETION_CRITERIA_TYPE_ACTIVITY.html" onMouseOver="constPopup(event,'COMPLETION_CRITERIA_TYPE_ACTIVITY')">COMPLETION_CRITERIA_TYPE_ACTIVITY</a>;
<a name="l414"><span class="linenum"> 414</span></a>          } else {
<a name="l415"><span class="linenum"> 415</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;DELETE FROM {course_completion_criteria}
<a name="l416"><span class="linenum"> 416</span></a>                      WHERE NOT <a class="function" onClick="logFunction('EXISTS')" href="../../_functions/exists.html" onMouseOver="funcPopup(event,'exists')">EXISTS</a> (
<a name="l417"><span class="linenum"> 417</span></a>                          SELECT 'x' FROM {course_modules}
<a name="l418"><span class="linenum"> 418</span></a>                          WHERE {course_modules}.id = {course_completion_criteria}.moduleinstance)
<a name="l419"><span class="linenum"> 419</span></a>                      AND {course_completion_criteria}.criteriatype = &quot;.<a class="constant" onClick="logConstant('COMPLETION_CRITERIA_TYPE_ACTIVITY')" href="../../_constants/COMPLETION_CRITERIA_TYPE_ACTIVITY.html" onMouseOver="constPopup(event,'COMPLETION_CRITERIA_TYPE_ACTIVITY')">COMPLETION_CRITERIA_TYPE_ACTIVITY</a>;
<a name="l420"><span class="linenum"> 420</span></a>          }
<a name="l421"><span class="linenum"> 421</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l422"><span class="linenum"> 422</span></a>  
<a name="l423"><span class="linenum"> 423</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l424"><span class="linenum"> 424</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012042300.02);
<a name="l425"><span class="linenum"> 425</span></a>      }
<a name="l426"><span class="linenum"> 426</span></a>  
<a name="l427"><span class="linenum"> 427</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012050300.01) {
<a name="l428"><span class="linenum"> 428</span></a>  <span class="comment">        // Make sure deleted users do not have picture flag.</span>
<a name="l429"><span class="linenum"> 429</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('user', 'picture', 0, array('deleted'=&gt;1, 'picture'=&gt;1));
<a name="l430"><span class="linenum"> 430</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012050300.01);
<a name="l431"><span class="linenum"> 431</span></a>      }
<a name="l432"><span class="linenum"> 432</span></a>  
<a name="l433"><span class="linenum"> 433</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012050300.02) {
<a name="l434"><span class="linenum"> 434</span></a>  
<a name="l435"><span class="linenum"> 435</span></a>  <span class="comment">        // Changing precision of field picture on table user to (10)</span>
<a name="l436"><span class="linenum"> 436</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('user');
<a name="l437"><span class="linenum"> 437</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('picture', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'secret');
<a name="l438"><span class="linenum"> 438</span></a>  
<a name="l439"><span class="linenum"> 439</span></a>  <span class="comment">        // Launch change of precision for field picture</span>
<a name="l440"><span class="linenum"> 440</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('change_field_precision')" href="../../_functions/change_field_precision.html" onMouseOver="funcPopup(event,'change_field_precision')">change_field_precision</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l441"><span class="linenum"> 441</span></a>  
<a name="l442"><span class="linenum"> 442</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l443"><span class="linenum"> 443</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012050300.02);
<a name="l444"><span class="linenum"> 444</span></a>      }
<a name="l445"><span class="linenum"> 445</span></a>  
<a name="l446"><span class="linenum"> 446</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012050300.03) {
<a name="l447"><span class="linenum"> 447</span></a>  
<a name="l448"><span class="linenum"> 448</span></a>  <span class="comment">        // Define field coursedisplay to be added to course</span>
<a name="l449"><span class="linenum"> 449</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course');
<a name="l450"><span class="linenum"> 450</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('coursedisplay', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '2', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'completionnotify');
<a name="l451"><span class="linenum"> 451</span></a>  
<a name="l452"><span class="linenum"> 452</span></a>  <span class="comment">        // Conditionally launch add field coursedisplay</span>
<a name="l453"><span class="linenum"> 453</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l454"><span class="linenum"> 454</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l455"><span class="linenum"> 455</span></a>          }
<a name="l456"><span class="linenum"> 456</span></a>  
<a name="l457"><span class="linenum"> 457</span></a>  <span class="comment">        // Since structure of 'course' table has changed we need to re-read $SITE from DB.</span>
<a name="l458"><span class="linenum"> 458</span></a>          <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id' =&gt; <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a>-&gt;<a onClick="logVariable('id')" class="var it39635" onMouseOver="hilite(39635)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l459"><span class="linenum"> 459</span></a>          <a class="var it2554" onMouseOver="hilite(2554)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../_variables/COURSE.html">$COURSE</a> = <a class="function" onClick="logFunction('clone')" href="../../_functions/clone.html" onMouseOver="funcPopup(event,'clone')">clone</a>(<a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a>);
<a name="l460"><span class="linenum"> 460</span></a>  
<a name="l461"><span class="linenum"> 461</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l462"><span class="linenum"> 462</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012050300.03);
<a name="l463"><span class="linenum"> 463</span></a>      }
<a name="l464"><span class="linenum"> 464</span></a>  
<a name="l465"><span class="linenum"> 465</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012050300.04) {
<a name="l466"><span class="linenum"> 466</span></a>  
<a name="l467"><span class="linenum"> 467</span></a>  <span class="comment">        // Define table course_display to be dropped</span>
<a name="l468"><span class="linenum"> 468</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_display');
<a name="l469"><span class="linenum"> 469</span></a>  
<a name="l470"><span class="linenum"> 470</span></a>  <span class="comment">        // Conditionally launch drop table for course_display</span>
<a name="l471"><span class="linenum"> 471</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l472"><span class="linenum"> 472</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_table')" href="../../_functions/drop_table.html" onMouseOver="funcPopup(event,'drop_table')">drop_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l473"><span class="linenum"> 473</span></a>          }
<a name="l474"><span class="linenum"> 474</span></a>  
<a name="l475"><span class="linenum"> 475</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l476"><span class="linenum"> 476</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012050300.04);
<a name="l477"><span class="linenum"> 477</span></a>      }
<a name="l478"><span class="linenum"> 478</span></a>  
<a name="l479"><span class="linenum"> 479</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012050300.05) {
<a name="l480"><span class="linenum"> 480</span></a>  
<a name="l481"><span class="linenum"> 481</span></a>  <span class="comment">        // Clean up removed admin setting.</span>
<a name="l482"><span class="linenum"> 482</span></a>          <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('navlinkcoursesections');
<a name="l483"><span class="linenum"> 483</span></a>  
<a name="l484"><span class="linenum"> 484</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012050300.05);
<a name="l485"><span class="linenum"> 485</span></a>      }
<a name="l486"><span class="linenum"> 486</span></a>  
<a name="l487"><span class="linenum"> 487</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012050400.01) {
<a name="l488"><span class="linenum"> 488</span></a>  
<a name="l489"><span class="linenum"> 489</span></a>  <span class="comment">        // Define index sortorder (not unique) to be added to course</span>
<a name="l490"><span class="linenum"> 490</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course');
<a name="l491"><span class="linenum"> 491</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('sortorder', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('sortorder'));
<a name="l492"><span class="linenum"> 492</span></a>  
<a name="l493"><span class="linenum"> 493</span></a>  <span class="comment">        // Conditionally launch add index sortorder</span>
<a name="l494"><span class="linenum"> 494</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l495"><span class="linenum"> 495</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l496"><span class="linenum"> 496</span></a>          }
<a name="l497"><span class="linenum"> 497</span></a>  
<a name="l498"><span class="linenum"> 498</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l499"><span class="linenum"> 499</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012050400.01);
<a name="l500"><span class="linenum"> 500</span></a>      }
<a name="l501"><span class="linenum"> 501</span></a>  
<a name="l502"><span class="linenum"> 502</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012050400.02) {
<a name="l503"><span class="linenum"> 503</span></a>  
<a name="l504"><span class="linenum"> 504</span></a>  <span class="comment">        // Clean up removed admin setting.</span>
<a name="l505"><span class="linenum"> 505</span></a>          <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('enablecourseajax');
<a name="l506"><span class="linenum"> 506</span></a>  
<a name="l507"><span class="linenum"> 507</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012050400.02);
<a name="l508"><span class="linenum"> 508</span></a>      }
<a name="l509"><span class="linenum"> 509</span></a>  
<a name="l510"><span class="linenum"> 510</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012051100.01) {
<a name="l511"><span class="linenum"> 511</span></a>  
<a name="l512"><span class="linenum"> 512</span></a>  <span class="comment">        // Define field idnumber to be added to groups</span>
<a name="l513"><span class="linenum"> 513</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('groups');
<a name="l514"><span class="linenum"> 514</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('idnumber', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '100', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'courseid');
<a name="l515"><span class="linenum"> 515</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('idnumber', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('idnumber'));
<a name="l516"><span class="linenum"> 516</span></a>  
<a name="l517"><span class="linenum"> 517</span></a>  <span class="comment">        // Conditionally launch add field idnumber</span>
<a name="l518"><span class="linenum"> 518</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l519"><span class="linenum"> 519</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l520"><span class="linenum"> 520</span></a>          }
<a name="l521"><span class="linenum"> 521</span></a>  
<a name="l522"><span class="linenum"> 522</span></a>  <span class="comment">        // Conditionally launch add index idnumber</span>
<a name="l523"><span class="linenum"> 523</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l524"><span class="linenum"> 524</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l525"><span class="linenum"> 525</span></a>          }
<a name="l526"><span class="linenum"> 526</span></a>  
<a name="l527"><span class="linenum"> 527</span></a>  <span class="comment">        // Define field idnumber to be added to groupings</span>
<a name="l528"><span class="linenum"> 528</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('groupings');
<a name="l529"><span class="linenum"> 529</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('idnumber', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '100', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'name');
<a name="l530"><span class="linenum"> 530</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('idnumber', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('idnumber'));
<a name="l531"><span class="linenum"> 531</span></a>  
<a name="l532"><span class="linenum"> 532</span></a>  <span class="comment">        // Conditionally launch add field idnumber</span>
<a name="l533"><span class="linenum"> 533</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l534"><span class="linenum"> 534</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l535"><span class="linenum"> 535</span></a>          }
<a name="l536"><span class="linenum"> 536</span></a>  
<a name="l537"><span class="linenum"> 537</span></a>  <span class="comment">        // Conditionally launch add index idnumber</span>
<a name="l538"><span class="linenum"> 538</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l539"><span class="linenum"> 539</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l540"><span class="linenum"> 540</span></a>          }
<a name="l541"><span class="linenum"> 541</span></a>  
<a name="l542"><span class="linenum"> 542</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l543"><span class="linenum"> 543</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012051100.01);
<a name="l544"><span class="linenum"> 544</span></a>      }
<a name="l545"><span class="linenum"> 545</span></a>  
<a name="l546"><span class="linenum"> 546</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012051100.03) {
<a name="l547"><span class="linenum"> 547</span></a>  
<a name="l548"><span class="linenum"> 548</span></a>  <span class="comment">        // Amend course table to add sectioncache cache</span>
<a name="l549"><span class="linenum"> 549</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course');
<a name="l550"><span class="linenum"> 550</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('sectioncache', <a class="constant" onClick="logConstant('XMLDB_TYPE_TEXT')" href="../../_constants/XMLDB_TYPE_TEXT.html" onMouseOver="constPopup(event,'XMLDB_TYPE_TEXT')">XMLDB_TYPE_TEXT</a>, null, null, null, null, null, 'showgrades');
<a name="l551"><span class="linenum"> 551</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l552"><span class="linenum"> 552</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l553"><span class="linenum"> 553</span></a>          }
<a name="l554"><span class="linenum"> 554</span></a>  
<a name="l555"><span class="linenum"> 555</span></a>  <span class="comment">        // Amend course_sections to add date, time and groupingid availability</span>
<a name="l556"><span class="linenum"> 556</span></a>  <span class="comment">        // conditions and a setting about whether to show them</span>
<a name="l557"><span class="linenum"> 557</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_sections');
<a name="l558"><span class="linenum"> 558</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('availablefrom', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'visible');
<a name="l559"><span class="linenum"> 559</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l560"><span class="linenum"> 560</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l561"><span class="linenum"> 561</span></a>          }
<a name="l562"><span class="linenum"> 562</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('availableuntil', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'availablefrom');
<a name="l563"><span class="linenum"> 563</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l564"><span class="linenum"> 564</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l565"><span class="linenum"> 565</span></a>          }
<a name="l566"><span class="linenum"> 566</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('showavailability', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '1', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'availableuntil');
<a name="l567"><span class="linenum"> 567</span></a>  <span class="comment">        // Conditionally launch add field showavailability</span>
<a name="l568"><span class="linenum"> 568</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l569"><span class="linenum"> 569</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l570"><span class="linenum"> 570</span></a>          }
<a name="l571"><span class="linenum"> 571</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('groupingid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'showavailability');
<a name="l572"><span class="linenum"> 572</span></a>  <span class="comment">        // Conditionally launch add field groupingid</span>
<a name="l573"><span class="linenum"> 573</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l574"><span class="linenum"> 574</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l575"><span class="linenum"> 575</span></a>          }
<a name="l576"><span class="linenum"> 576</span></a>  
<a name="l577"><span class="linenum"> 577</span></a>  <span class="comment">        // Since structure of 'course' table has changed we need to re-read $SITE from DB.</span>
<a name="l578"><span class="linenum"> 578</span></a>          <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id' =&gt; <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a>-&gt;<a onClick="logVariable('id')" class="var it39635" onMouseOver="hilite(39635)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l579"><span class="linenum"> 579</span></a>          <a class="var it2554" onMouseOver="hilite(2554)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../_variables/COURSE.html">$COURSE</a> = <a class="function" onClick="logFunction('clone')" href="../../_functions/clone.html" onMouseOver="funcPopup(event,'clone')">clone</a>(<a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a>);
<a name="l580"><span class="linenum"> 580</span></a>  
<a name="l581"><span class="linenum"> 581</span></a>  <span class="comment">        // Add course_sections_availability to add completion &amp; grade availability conditions</span>
<a name="l582"><span class="linenum"> 582</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_sections_availability');
<a name="l583"><span class="linenum"> 583</span></a>  
<a name="l584"><span class="linenum"> 584</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null);
<a name="l585"><span class="linenum"> 585</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('coursesectionid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l586"><span class="linenum"> 586</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('sourcecmid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null);
<a name="l587"><span class="linenum"> 587</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('requiredcompletion', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '1', null, null, null, null);
<a name="l588"><span class="linenum"> 588</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('gradeitemid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null);
<a name="l589"><span class="linenum"> 589</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('grademin', <a class="constant" onClick="logConstant('XMLDB_TYPE_NUMBER')" href="../../_constants/XMLDB_TYPE_NUMBER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_NUMBER')">XMLDB_TYPE_NUMBER</a>, '10, 5', null, null, null, null);
<a name="l590"><span class="linenum"> 590</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('grademax', <a class="constant" onClick="logConstant('XMLDB_TYPE_NUMBER')" href="../../_constants/XMLDB_TYPE_NUMBER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_NUMBER')">XMLDB_TYPE_NUMBER</a>, '10, 5', null, null, null, null);
<a name="l591"><span class="linenum"> 591</span></a>  
<a name="l592"><span class="linenum"> 592</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l593"><span class="linenum"> 593</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('coursesectionid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('coursesectionid'), 'course_sections', array('id'));
<a name="l594"><span class="linenum"> 594</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('sourcecmid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('sourcecmid'), 'course_modules', array('id'));
<a name="l595"><span class="linenum"> 595</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('gradeitemid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('gradeitemid'), 'grade_items', array('id'));
<a name="l596"><span class="linenum"> 596</span></a>  
<a name="l597"><span class="linenum"> 597</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l598"><span class="linenum"> 598</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l599"><span class="linenum"> 599</span></a>          }
<a name="l600"><span class="linenum"> 600</span></a>  
<a name="l601"><span class="linenum"> 601</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l602"><span class="linenum"> 602</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012051100.03);
<a name="l603"><span class="linenum"> 603</span></a>      }
<a name="l604"><span class="linenum"> 604</span></a>  
<a name="l605"><span class="linenum"> 605</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012052100.00) {
<a name="l606"><span class="linenum"> 606</span></a>  
<a name="l607"><span class="linenum"> 607</span></a>  <span class="comment">        // Define field referencefileid to be added to files.</span>
<a name="l608"><span class="linenum"> 608</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('files');
<a name="l609"><span class="linenum"> 609</span></a>  
<a name="l610"><span class="linenum"> 610</span></a>  <span class="comment">        // Define field referencefileid to be added to files.</span>
<a name="l611"><span class="linenum"> 611</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('referencefileid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null, 'sortorder');
<a name="l612"><span class="linenum"> 612</span></a>  
<a name="l613"><span class="linenum"> 613</span></a>  <span class="comment">        // Conditionally launch add field referencefileid.</span>
<a name="l614"><span class="linenum"> 614</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l615"><span class="linenum"> 615</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l616"><span class="linenum"> 616</span></a>          }
<a name="l617"><span class="linenum"> 617</span></a>  
<a name="l618"><span class="linenum"> 618</span></a>  <span class="comment">        // Define field referencelastsync to be added to files.</span>
<a name="l619"><span class="linenum"> 619</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('referencelastsync', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null, 'referencefileid');
<a name="l620"><span class="linenum"> 620</span></a>  
<a name="l621"><span class="linenum"> 621</span></a>  <span class="comment">        // Conditionally launch add field referencelastsync.</span>
<a name="l622"><span class="linenum"> 622</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l623"><span class="linenum"> 623</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l624"><span class="linenum"> 624</span></a>          }
<a name="l625"><span class="linenum"> 625</span></a>  
<a name="l626"><span class="linenum"> 626</span></a>  <span class="comment">        // Define field referencelifetime to be added to files.</span>
<a name="l627"><span class="linenum"> 627</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('referencelifetime', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null, 'referencelastsync');
<a name="l628"><span class="linenum"> 628</span></a>  
<a name="l629"><span class="linenum"> 629</span></a>  <span class="comment">        // Conditionally launch add field referencelifetime.</span>
<a name="l630"><span class="linenum"> 630</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l631"><span class="linenum"> 631</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l632"><span class="linenum"> 632</span></a>          }
<a name="l633"><span class="linenum"> 633</span></a>  
<a name="l634"><span class="linenum"> 634</span></a>          <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_key')" href="../../_classes/xmldb_key.html" onMouseOver="classPopup(event,'xmldb_key')">xmldb_key</a>('referencefileid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('referencefileid'), 'files_reference', array('id'));
<a name="l635"><span class="linenum"> 635</span></a>  <span class="comment">        // Launch add key referencefileid</span>
<a name="l636"><span class="linenum"> 636</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>);
<a name="l637"><span class="linenum"> 637</span></a>  
<a name="l638"><span class="linenum"> 638</span></a>  <span class="comment">        // Define table files_reference to be created.</span>
<a name="l639"><span class="linenum"> 639</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('files_reference');
<a name="l640"><span class="linenum"> 640</span></a>  
<a name="l641"><span class="linenum"> 641</span></a>  <span class="comment">        // Adding fields to table files_reference.</span>
<a name="l642"><span class="linenum"> 642</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null);
<a name="l643"><span class="linenum"> 643</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('repositoryid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l644"><span class="linenum"> 644</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('lastsync', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null);
<a name="l645"><span class="linenum"> 645</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('lifetime', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null);
<a name="l646"><span class="linenum"> 646</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('reference', <a class="constant" onClick="logConstant('XMLDB_TYPE_TEXT')" href="../../_constants/XMLDB_TYPE_TEXT.html" onMouseOver="constPopup(event,'XMLDB_TYPE_TEXT')">XMLDB_TYPE_TEXT</a>, null, null, null, null, null);
<a name="l647"><span class="linenum"> 647</span></a>  
<a name="l648"><span class="linenum"> 648</span></a>  <span class="comment">        // Adding keys to table files_reference.</span>
<a name="l649"><span class="linenum"> 649</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l650"><span class="linenum"> 650</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('repositoryid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('repositoryid'), 'repository_instances', array('id'));
<a name="l651"><span class="linenum"> 651</span></a>  
<a name="l652"><span class="linenum"> 652</span></a>  <span class="comment">        // Conditionally launch create table for files_reference</span>
<a name="l653"><span class="linenum"> 653</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l654"><span class="linenum"> 654</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l655"><span class="linenum"> 655</span></a>          }
<a name="l656"><span class="linenum"> 656</span></a>  
<a name="l657"><span class="linenum"> 657</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l658"><span class="linenum"> 658</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012052100.00);
<a name="l659"><span class="linenum"> 659</span></a>      }
<a name="l660"><span class="linenum"> 660</span></a>  
<a name="l661"><span class="linenum"> 661</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012052500.03) { // fix invalid course_completion_records MDL-27368
<a name="l662"><span class="linenum"> 662</span></a>  <span class="comment">        //first get all instances of duplicate records</span>
<a name="l663"><span class="linenum"> 663</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'SELECT userid, course FROM {course_completions} <a class="function" onClick="logFunction('WHERE')" href="../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a> (deleted IS NULL OR deleted &lt;&gt; 1) GROUP BY userid, course HAVING (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(id) &gt; 1)';
<a name="l664"><span class="linenum"> 664</span></a>          <a class="var it11353" onMouseOver="hilite(11353)" onMouseOut="lolite()" onClick="logVariable('duplicates')" href="../../_variables/duplicates.html">$duplicates</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array());
<a name="l665"><span class="linenum"> 665</span></a>  
<a name="l666"><span class="linenum"> 666</span></a>          foreach (<a class="var it11353" onMouseOver="hilite(11353)" onMouseOut="lolite()" onClick="logVariable('duplicates')" href="../../_variables/duplicates.html">$duplicates</a> as <a class="var it10012" onMouseOver="hilite(10012)" onMouseOut="lolite()" onClick="logVariable('duplicate')" href="../../_variables/duplicate.html">$duplicate</a>) {
<a name="l667"><span class="linenum"> 667</span></a>              <a class="var it3271" onMouseOver="hilite(3271)" onMouseOut="lolite()" onClick="logVariable('pointer')" href="../../_variables/pointer.html">$pointer</a> = 0;
<a name="l668"><span class="linenum"> 668</span></a>  <span class="comment">            //now get all the records for this user/course</span>
<a name="l669"><span class="linenum"> 669</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'userid = ? AND course = ? AND (deleted IS NULL OR deleted &lt;&gt; 1)';
<a name="l670"><span class="linenum"> 670</span></a>              <a class="var it5900" onMouseOver="hilite(5900)" onMouseOut="lolite()" onClick="logVariable('completions')" href="../../_variables/completions.html">$completions</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_select')" href="../../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>('course_completions', <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>,
<a name="l671"><span class="linenum"> 671</span></a>                  array(<a class="var it10012" onMouseOver="hilite(10012)" onMouseOut="lolite()" onClick="logVariable('duplicate')" href="../../_variables/duplicate.html">$duplicate</a>-&gt;<a onClick="logVariable('userid')" class="var it40068" onMouseOver="hilite(40068)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>, <a class="var it10012" onMouseOver="hilite(10012)" onMouseOut="lolite()" onClick="logVariable('duplicate')" href="../../_variables/duplicate.html">$duplicate</a>-&gt;<a onClick="logVariable('course')" class="var it40068" onMouseOver="hilite(40068)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>), 'timecompleted DESC, timestarted DESC');
<a name="l672"><span class="linenum"> 672</span></a>              <a class="var it6482" onMouseOver="hilite(6482)" onMouseOut="lolite()" onClick="logVariable('needsupdate')" href="../../_variables/needsupdate.html">$needsupdate</a> = false;
<a name="l673"><span class="linenum"> 673</span></a>              <a class="var it37326" onMouseOver="hilite(37326)" onMouseOut="lolite()" onClick="logVariable('origcompletion')" href="../../_variables/origcompletion.html">$origcompletion</a> = null;
<a name="l674"><span class="linenum"> 674</span></a>              foreach (<a class="var it5900" onMouseOver="hilite(5900)" onMouseOut="lolite()" onClick="logVariable('completions')" href="../../_variables/completions.html">$completions</a> as <a class="var it3863" onMouseOver="hilite(3863)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../../_variables/completion.html">$completion</a>) {
<a name="l675"><span class="linenum"> 675</span></a>                  <a class="var it3271" onMouseOver="hilite(3271)" onMouseOut="lolite()" onClick="logVariable('pointer')" href="../../_variables/pointer.html">$pointer</a>++;
<a name="l676"><span class="linenum"> 676</span></a>                  if (<a class="var it3271" onMouseOver="hilite(3271)" onMouseOut="lolite()" onClick="logVariable('pointer')" href="../../_variables/pointer.html">$pointer</a> === 1) { //keep 1st record but delete all others.
<a name="l677"><span class="linenum"> 677</span></a>                      <a class="var it37326" onMouseOver="hilite(37326)" onMouseOut="lolite()" onClick="logVariable('origcompletion')" href="../../_variables/origcompletion.html">$origcompletion</a> = <a class="var it3863" onMouseOver="hilite(3863)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../../_variables/completion.html">$completion</a>;
<a name="l678"><span class="linenum"> 678</span></a>                  } else {
<a name="l679"><span class="linenum"> 679</span></a>  <span class="comment">                    //we need to keep the &quot;oldest&quot; of all these fields as the valid completion record.</span>
<a name="l680"><span class="linenum"> 680</span></a>                      <a class="var it7814" onMouseOver="hilite(7814)" onMouseOut="lolite()" onClick="logVariable('fieldstocheck')" href="../../_variables/fieldstocheck.html">$fieldstocheck</a> = array('timecompleted', 'timestarted', 'timeenrolled');
<a name="l681"><span class="linenum"> 681</span></a>                      foreach (<a class="var it7814" onMouseOver="hilite(7814)" onMouseOut="lolite()" onClick="logVariable('fieldstocheck')" href="../../_variables/fieldstocheck.html">$fieldstocheck</a> as <a class="var it2006" onMouseOver="hilite(2006)" onMouseOut="lolite()" onClick="logVariable('f')" href="../../_variables/f.html">$f</a>) {
<a name="l682"><span class="linenum"> 682</span></a>                          if (<a class="var it37326" onMouseOver="hilite(37326)" onMouseOut="lolite()" onClick="logVariable('origcompletion')" href="../../_variables/origcompletion.html">$origcompletion</a>-&gt;<a class="var it2006" onMouseOver="hilite(2006)" onMouseOut="lolite()" onClick="logVariable('f')" href="../../_variables/f.html">$f</a> &gt; <a class="var it3863" onMouseOver="hilite(3863)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../../_variables/completion.html">$completion</a>-&gt;<a class="var it2006" onMouseOver="hilite(2006)" onMouseOut="lolite()" onClick="logVariable('f')" href="../../_variables/f.html">$f</a>) {
<a name="l683"><span class="linenum"> 683</span></a>                              <a class="var it37326" onMouseOver="hilite(37326)" onMouseOut="lolite()" onClick="logVariable('origcompletion')" href="../../_variables/origcompletion.html">$origcompletion</a>-&gt;<a class="var it2006" onMouseOver="hilite(2006)" onMouseOut="lolite()" onClick="logVariable('f')" href="../../_variables/f.html">$f</a> = <a class="var it3863" onMouseOver="hilite(3863)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../../_variables/completion.html">$completion</a>-&gt;<a class="var it2006" onMouseOver="hilite(2006)" onMouseOut="lolite()" onClick="logVariable('f')" href="../../_variables/f.html">$f</a>;
<a name="l684"><span class="linenum"> 684</span></a>                              <a class="var it6482" onMouseOver="hilite(6482)" onMouseOut="lolite()" onClick="logVariable('needsupdate')" href="../../_variables/needsupdate.html">$needsupdate</a> = true;
<a name="l685"><span class="linenum"> 685</span></a>                          }
<a name="l686"><span class="linenum"> 686</span></a>                      }
<a name="l687"><span class="linenum"> 687</span></a>                      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('course_completions', array('id'=&gt;<a class="var it3863" onMouseOver="hilite(3863)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../../_variables/completion.html">$completion</a>-&gt;<a onClick="logVariable('id')" class="var it40108" onMouseOver="hilite(40108)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l688"><span class="linenum"> 688</span></a>                  }
<a name="l689"><span class="linenum"> 689</span></a>              }
<a name="l690"><span class="linenum"> 690</span></a>              if (<a class="var it6482" onMouseOver="hilite(6482)" onMouseOut="lolite()" onClick="logVariable('needsupdate')" href="../../_variables/needsupdate.html">$needsupdate</a>) {
<a name="l691"><span class="linenum"> 691</span></a>                  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('course_completions', <a class="var it37326" onMouseOver="hilite(37326)" onMouseOut="lolite()" onClick="logVariable('origcompletion')" href="../../_variables/origcompletion.html">$origcompletion</a>);
<a name="l692"><span class="linenum"> 692</span></a>              }
<a name="l693"><span class="linenum"> 693</span></a>          }
<a name="l694"><span class="linenum"> 694</span></a>  
<a name="l695"><span class="linenum"> 695</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l696"><span class="linenum"> 696</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012052500.03);
<a name="l697"><span class="linenum"> 697</span></a>      }
<a name="l698"><span class="linenum"> 698</span></a>  
<a name="l699"><span class="linenum"> 699</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012052900.00) {
<a name="l700"><span class="linenum"> 700</span></a>  <span class="comment">        // Clean up all duplicate records in the course_completions table in preparation</span>
<a name="l701"><span class="linenum"> 701</span></a>  <span class="comment">        // for adding a new index there.</span>
<a name="l702"><span class="linenum"> 702</span></a>          <a class="function" onClick="logFunction('upgrade_course_completion_remove_duplicates')" href="../../_functions/upgrade_course_completion_remove_duplicates.html" onMouseOver="funcPopup(event,'upgrade_course_completion_remove_duplicates')">upgrade_course_completion_remove_duplicates</a>(
<a name="l703"><span class="linenum"> 703</span></a>              'course_completions',
<a name="l704"><span class="linenum"> 704</span></a>              array('userid', 'course'),
<a name="l705"><span class="linenum"> 705</span></a>              array('timecompleted', 'timestarted', 'timeenrolled')
<a name="l706"><span class="linenum"> 706</span></a>          );
<a name="l707"><span class="linenum"> 707</span></a>  
<a name="l708"><span class="linenum"> 708</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l709"><span class="linenum"> 709</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012052900.00);
<a name="l710"><span class="linenum"> 710</span></a>      }
<a name="l711"><span class="linenum"> 711</span></a>  
<a name="l712"><span class="linenum"> 712</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012052900.01) {
<a name="l713"><span class="linenum"> 713</span></a>  <span class="comment">        // Add indexes to prevent new duplicates in the course_completions table.</span>
<a name="l714"><span class="linenum"> 714</span></a>  <span class="comment">        // Define index useridcourse (unique) to be added to course_completions</span>
<a name="l715"><span class="linenum"> 715</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_completions');
<a name="l716"><span class="linenum"> 716</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('useridcourse', <a class="constant" onClick="logConstant('XMLDB_INDEX_UNIQUE')" href="../../_constants/XMLDB_INDEX_UNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_UNIQUE')">XMLDB_INDEX_UNIQUE</a>, array('userid', 'course'));
<a name="l717"><span class="linenum"> 717</span></a>  
<a name="l718"><span class="linenum"> 718</span></a>  <span class="comment">        // Conditionally launch add index useridcourse</span>
<a name="l719"><span class="linenum"> 719</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l720"><span class="linenum"> 720</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l721"><span class="linenum"> 721</span></a>          }
<a name="l722"><span class="linenum"> 722</span></a>  
<a name="l723"><span class="linenum"> 723</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l724"><span class="linenum"> 724</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012052900.01);
<a name="l725"><span class="linenum"> 725</span></a>      }
<a name="l726"><span class="linenum"> 726</span></a>  
<a name="l727"><span class="linenum"> 727</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012052900.02) {
<a name="l728"><span class="linenum"> 728</span></a>  <span class="comment">        // Clean up all duplicate records in the course_completion_crit_compl table in preparation</span>
<a name="l729"><span class="linenum"> 729</span></a>  <span class="comment">        // for adding a new index there.</span>
<a name="l730"><span class="linenum"> 730</span></a>          <a class="function" onClick="logFunction('upgrade_course_completion_remove_duplicates')" href="../../_functions/upgrade_course_completion_remove_duplicates.html" onMouseOver="funcPopup(event,'upgrade_course_completion_remove_duplicates')">upgrade_course_completion_remove_duplicates</a>(
<a name="l731"><span class="linenum"> 731</span></a>              'course_completion_crit_compl',
<a name="l732"><span class="linenum"> 732</span></a>              array('userid', 'course', 'criteriaid'),
<a name="l733"><span class="linenum"> 733</span></a>              array('timecompleted')
<a name="l734"><span class="linenum"> 734</span></a>          );
<a name="l735"><span class="linenum"> 735</span></a>  
<a name="l736"><span class="linenum"> 736</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l737"><span class="linenum"> 737</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012052900.02);
<a name="l738"><span class="linenum"> 738</span></a>      }
<a name="l739"><span class="linenum"> 739</span></a>  
<a name="l740"><span class="linenum"> 740</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012052900.03) {
<a name="l741"><span class="linenum"> 741</span></a>  <span class="comment">        // Add indexes to prevent new duplicates in the course_completion_crit_compl table.</span>
<a name="l742"><span class="linenum"> 742</span></a>  <span class="comment">        // Define index useridcoursecriteraid (unique) to be added to course_completion_crit_compl</span>
<a name="l743"><span class="linenum"> 743</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_completion_crit_compl');
<a name="l744"><span class="linenum"> 744</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('useridcoursecriteraid', <a class="constant" onClick="logConstant('XMLDB_INDEX_UNIQUE')" href="../../_constants/XMLDB_INDEX_UNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_UNIQUE')">XMLDB_INDEX_UNIQUE</a>, array('userid', 'course', 'criteriaid'));
<a name="l745"><span class="linenum"> 745</span></a>  
<a name="l746"><span class="linenum"> 746</span></a>  <span class="comment">        // Conditionally launch add index useridcoursecriteraid</span>
<a name="l747"><span class="linenum"> 747</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l748"><span class="linenum"> 748</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l749"><span class="linenum"> 749</span></a>          }
<a name="l750"><span class="linenum"> 750</span></a>  
<a name="l751"><span class="linenum"> 751</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l752"><span class="linenum"> 752</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012052900.03);
<a name="l753"><span class="linenum"> 753</span></a>      }
<a name="l754"><span class="linenum"> 754</span></a>  
<a name="l755"><span class="linenum"> 755</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012052900.04) {
<a name="l756"><span class="linenum"> 756</span></a>  <span class="comment">        // Clean up all duplicate records in the course_completion_aggr_methd table in preparation</span>
<a name="l757"><span class="linenum"> 757</span></a>  <span class="comment">        // for adding a new index there.</span>
<a name="l758"><span class="linenum"> 758</span></a>          <a class="function" onClick="logFunction('upgrade_course_completion_remove_duplicates')" href="../../_functions/upgrade_course_completion_remove_duplicates.html" onMouseOver="funcPopup(event,'upgrade_course_completion_remove_duplicates')">upgrade_course_completion_remove_duplicates</a>(
<a name="l759"><span class="linenum"> 759</span></a>              'course_completion_aggr_methd',
<a name="l760"><span class="linenum"> 760</span></a>              array('course', 'criteriatype')
<a name="l761"><span class="linenum"> 761</span></a>          );
<a name="l762"><span class="linenum"> 762</span></a>  
<a name="l763"><span class="linenum"> 763</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l764"><span class="linenum"> 764</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012052900.04);
<a name="l765"><span class="linenum"> 765</span></a>      }
<a name="l766"><span class="linenum"> 766</span></a>  
<a name="l767"><span class="linenum"> 767</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012052900.05) {
<a name="l768"><span class="linenum"> 768</span></a>  <span class="comment">        // Add indexes to prevent new duplicates in the course_completion_aggr_methd table.</span>
<a name="l769"><span class="linenum"> 769</span></a>  <span class="comment">        // Define index coursecriteratype (unique) to be added to course_completion_aggr_methd</span>
<a name="l770"><span class="linenum"> 770</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_completion_aggr_methd');
<a name="l771"><span class="linenum"> 771</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('coursecriteriatype', <a class="constant" onClick="logConstant('XMLDB_INDEX_UNIQUE')" href="../../_constants/XMLDB_INDEX_UNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_UNIQUE')">XMLDB_INDEX_UNIQUE</a>, array('course', 'criteriatype'));
<a name="l772"><span class="linenum"> 772</span></a>  
<a name="l773"><span class="linenum"> 773</span></a>  <span class="comment">        // Conditionally launch add index coursecriteratype</span>
<a name="l774"><span class="linenum"> 774</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l775"><span class="linenum"> 775</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l776"><span class="linenum"> 776</span></a>          }
<a name="l777"><span class="linenum"> 777</span></a>  
<a name="l778"><span class="linenum"> 778</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l779"><span class="linenum"> 779</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012052900.05);
<a name="l780"><span class="linenum"> 780</span></a>      }
<a name="l781"><span class="linenum"> 781</span></a>  
<a name="l782"><span class="linenum"> 782</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012060600.01) {
<a name="l783"><span class="linenum"> 783</span></a>  <span class="comment">        // Add field referencehash to files_reference</span>
<a name="l784"><span class="linenum"> 784</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('files_reference');
<a name="l785"><span class="linenum"> 785</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('referencehash', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '40', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'reference');
<a name="l786"><span class="linenum"> 786</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l787"><span class="linenum"> 787</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l788"><span class="linenum"> 788</span></a>          }
<a name="l789"><span class="linenum"> 789</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012060600.01);
<a name="l790"><span class="linenum"> 790</span></a>      }
<a name="l791"><span class="linenum"> 791</span></a>  
<a name="l792"><span class="linenum"> 792</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012060600.02) {
<a name="l793"><span class="linenum"> 793</span></a>  <span class="comment">        // Populate referencehash field with SHA1 hash of the reference - this shoudl affect only 2.3dev sites</span>
<a name="l794"><span class="linenum"> 794</span></a>  <span class="comment">        // that were using the feature for testing. Production sites have the table empty.</span>
<a name="l795"><span class="linenum"> 795</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset')" href="../../_functions/get_recordset.html" onMouseOver="funcPopup(event,'get_recordset')">get_recordset</a>('files_reference', null, '', 'id, reference');
<a name="l796"><span class="linenum"> 796</span></a>          foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>) {
<a name="l797"><span class="linenum"> 797</span></a>              <a class="var it6788" onMouseOver="hilite(6788)" onMouseOut="lolite()" onClick="logVariable('hash')" href="../../_variables/hash.html">$hash</a> = <a class="phpfunction" onClick="logFunction('sha1')" href="../../_functions/sha1.html" onMouseOver="phpfuncPopup(event,'sha1')">sha1</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('reference')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../../_variables/reference.html">reference</a>);
<a name="l798"><span class="linenum"> 798</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('files_reference', 'referencehash', <a class="var it6788" onMouseOver="hilite(6788)" onMouseOut="lolite()" onClick="logVariable('hash')" href="../../_variables/hash.html">$hash</a>, array('id' =&gt; <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l799"><span class="linenum"> 799</span></a>          }
<a name="l800"><span class="linenum"> 800</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l801"><span class="linenum"> 801</span></a>  
<a name="l802"><span class="linenum"> 802</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012060600.02);
<a name="l803"><span class="linenum"> 803</span></a>      }
<a name="l804"><span class="linenum"> 804</span></a>  
<a name="l805"><span class="linenum"> 805</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012060600.03) {
<a name="l806"><span class="linenum"> 806</span></a>  <span class="comment">        // Merge duplicate records in files_reference that were created during the development</span>
<a name="l807"><span class="linenum"> 807</span></a>  <span class="comment">        // phase at 2.3dev sites. This is needed so we can create the unique index over</span>
<a name="l808"><span class="linenum"> 808</span></a>  <span class="comment">        // (repositoryid, referencehash) fields.</span>
<a name="l809"><span class="linenum"> 809</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT repositoryid, referencehash, <a class="phpfunction" onClick="logFunction('MIN')" href="../../_functions/min.html" onMouseOver="phpfuncPopup(event,'min')">MIN</a>(id) AS minid
<a name="l810"><span class="linenum"> 810</span></a>                    FROM {files_reference}
<a name="l811"><span class="linenum"> 811</span></a>                GROUP BY repositoryid, referencehash
<a name="l812"><span class="linenum"> 812</span></a>                  HAVING <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(*) &gt; 1&quot;;
<a name="l813"><span class="linenum"> 813</span></a>          <a class="var it37316" onMouseOver="hilite(37316)" onMouseOut="lolite()" onClick="logVariable('duprs')" href="../../_variables/duprs.html">$duprs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l814"><span class="linenum"> 814</span></a>          foreach (<a class="var it37316" onMouseOver="hilite(37316)" onMouseOut="lolite()" onClick="logVariable('duprs')" href="../../_variables/duprs.html">$duprs</a> as <a class="var it37317" onMouseOver="hilite(37317)" onMouseOut="lolite()" onClick="logVariable('duprec')" href="../../_variables/duprec.html">$duprec</a>) {
<a name="l815"><span class="linenum"> 815</span></a>  <span class="comment">            // get the list of all ids in {files_reference} that need to be remapped</span>
<a name="l816"><span class="linenum"> 816</span></a>              <a class="var it37327" onMouseOver="hilite(37327)" onMouseOut="lolite()" onClick="logVariable('dupids')" href="../../_variables/dupids.html">$dupids</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_select')" href="../../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>('files_reference', &quot;repositoryid = ? AND referencehash = ? AND id &gt; ?&quot;,
<a name="l817"><span class="linenum"> 817</span></a>                  array(<a class="var it37317" onMouseOver="hilite(37317)" onMouseOut="lolite()" onClick="logVariable('duprec')" href="../../_variables/duprec.html">$duprec</a>-&gt;<a onClick="logVariable('repositoryid')" class="var it41667" onMouseOver="hilite(41667)" onMouseOut="lolite()" href="../../_variables/repositoryid.html">repositoryid</a>, <a class="var it37317" onMouseOver="hilite(37317)" onMouseOut="lolite()" onClick="logVariable('duprec')" href="../../_variables/duprec.html">$duprec</a>-&gt;<a onClick="logVariable('referencehash')" class="var it41667" onMouseOver="hilite(41667)" onMouseOut="lolite()" href="../../_variables/referencehash.html">referencehash</a>, <a class="var it37317" onMouseOver="hilite(37317)" onMouseOut="lolite()" onClick="logVariable('duprec')" href="../../_variables/duprec.html">$duprec</a>-&gt;<a onClick="logVariable('minid')" class="var it41667" onMouseOver="hilite(41667)" onMouseOut="lolite()" href="../../_variables/minid.html">minid</a>), '', 'id');
<a name="l818"><span class="linenum"> 818</span></a>              <a class="var it37327" onMouseOver="hilite(37327)" onMouseOut="lolite()" onClick="logVariable('dupids')" href="../../_variables/dupids.html">$dupids</a> = <a class="phpfunction" onClick="logFunction('array_keys')" href="../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it37327" onMouseOver="hilite(37327)" onMouseOut="lolite()" onClick="logVariable('dupids')" href="../../_variables/dupids.html">$dupids</a>);
<a name="l819"><span class="linenum"> 819</span></a>  <span class="comment">            // relink records in {files} that are now referring to a duplicate record</span>
<a name="l820"><span class="linenum"> 820</span></a>  <span class="comment">            // in {files_reference} to refer to the first one</span>
<a name="l821"><span class="linenum"> 821</span></a>              <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it5806" onMouseOver="hilite(5806)" onMouseOut="lolite()" onClick="logVariable('subsql')" href="../../_variables/subsql.html">$subsql</a>, <a class="var it22100" onMouseOver="hilite(22100)" onMouseOut="lolite()" onClick="logVariable('subparams')" href="../../_variables/subparams.html">$subparams</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it37327" onMouseOver="hilite(37327)" onMouseOut="lolite()" onClick="logVariable('dupids')" href="../../_variables/dupids.html">$dupids</a>);
<a name="l822"><span class="linenum"> 822</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field_select')" href="../../_functions/set_field_select.html" onMouseOver="funcPopup(event,'set_field_select')">set_field_select</a>('files', 'referencefileid', <a class="var it37317" onMouseOver="hilite(37317)" onMouseOut="lolite()" onClick="logVariable('duprec')" href="../../_variables/duprec.html">$duprec</a>-&gt;<a onClick="logVariable('minid')" class="var it41667" onMouseOver="hilite(41667)" onMouseOut="lolite()" href="../../_variables/minid.html">minid</a>, &quot;referencefileid <a class="var it5806" onMouseOver="hilite(5806)" onMouseOut="lolite()" onClick="logVariable('subsql')" href="../../_variables/subsql.html">$subsql</a>&quot;, <a class="var it22100" onMouseOver="hilite(22100)" onMouseOut="lolite()" onClick="logVariable('subparams')" href="../../_variables/subparams.html">$subparams</a>);
<a name="l823"><span class="linenum"> 823</span></a>  <span class="comment">            // and finally remove all orphaned records from {files_reference}</span>
<a name="l824"><span class="linenum"> 824</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_list')" href="../../_functions/delete_records_list.html" onMouseOver="funcPopup(event,'delete_records_list')">delete_records_list</a>('files_reference', 'id', <a class="var it37327" onMouseOver="hilite(37327)" onMouseOut="lolite()" onClick="logVariable('dupids')" href="../../_variables/dupids.html">$dupids</a>);
<a name="l825"><span class="linenum"> 825</span></a>          }
<a name="l826"><span class="linenum"> 826</span></a>          <a class="var it37316" onMouseOver="hilite(37316)" onMouseOut="lolite()" onClick="logVariable('duprs')" href="../../_variables/duprs.html">$duprs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l827"><span class="linenum"> 827</span></a>  
<a name="l828"><span class="linenum"> 828</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012060600.03);
<a name="l829"><span class="linenum"> 829</span></a>      }
<a name="l830"><span class="linenum"> 830</span></a>  
<a name="l831"><span class="linenum"> 831</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012060600.04) {
<a name="l832"><span class="linenum"> 832</span></a>  <span class="comment">        // Add a unique index over repositoryid and referencehash fields in files_reference table</span>
<a name="l833"><span class="linenum"> 833</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('files_reference');
<a name="l834"><span class="linenum"> 834</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('uq_external_file', <a class="constant" onClick="logConstant('XMLDB_INDEX_UNIQUE')" href="../../_constants/XMLDB_INDEX_UNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_UNIQUE')">XMLDB_INDEX_UNIQUE</a>, array('repositoryid', 'referencehash'));
<a name="l835"><span class="linenum"> 835</span></a>  
<a name="l836"><span class="linenum"> 836</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l837"><span class="linenum"> 837</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l838"><span class="linenum"> 838</span></a>          }
<a name="l839"><span class="linenum"> 839</span></a>  
<a name="l840"><span class="linenum"> 840</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012060600.04);
<a name="l841"><span class="linenum"> 841</span></a>      }
<a name="l842"><span class="linenum"> 842</span></a>  
<a name="l843"><span class="linenum"> 843</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012061800.01) {
<a name="l844"><span class="linenum"> 844</span></a>  
<a name="l845"><span class="linenum"> 845</span></a>  <span class="comment">        // Define field screenreader to be dropped from user</span>
<a name="l846"><span class="linenum"> 846</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('user');
<a name="l847"><span class="linenum"> 847</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('ajax');
<a name="l848"><span class="linenum"> 848</span></a>  
<a name="l849"><span class="linenum"> 849</span></a>  <span class="comment">        // Conditionally launch drop field screenreader</span>
<a name="l850"><span class="linenum"> 850</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l851"><span class="linenum"> 851</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l852"><span class="linenum"> 852</span></a>          }
<a name="l853"><span class="linenum"> 853</span></a>  
<a name="l854"><span class="linenum"> 854</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l855"><span class="linenum"> 855</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012061800.01);
<a name="l856"><span class="linenum"> 856</span></a>      }
<a name="l857"><span class="linenum"> 857</span></a>  
<a name="l858"><span class="linenum"> 858</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012062000.00) {
<a name="l859"><span class="linenum"> 859</span></a>  <span class="comment">        // Add field newcontextid to backup_files_template</span>
<a name="l860"><span class="linenum"> 860</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('backup_files_template');
<a name="l861"><span class="linenum"> 861</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('newcontextid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null, 'info');
<a name="l862"><span class="linenum"> 862</span></a>  
<a name="l863"><span class="linenum"> 863</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l864"><span class="linenum"> 864</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l865"><span class="linenum"> 865</span></a>          }
<a name="l866"><span class="linenum"> 866</span></a>  
<a name="l867"><span class="linenum"> 867</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012062000.00);
<a name="l868"><span class="linenum"> 868</span></a>      }
<a name="l869"><span class="linenum"> 869</span></a>  
<a name="l870"><span class="linenum"> 870</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012062000.01) {
<a name="l871"><span class="linenum"> 871</span></a>  <span class="comment">        // Add field newitemid to backup_files_template</span>
<a name="l872"><span class="linenum"> 872</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('backup_files_template');
<a name="l873"><span class="linenum"> 873</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('newitemid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null, 'newcontextid');
<a name="l874"><span class="linenum"> 874</span></a>  
<a name="l875"><span class="linenum"> 875</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l876"><span class="linenum"> 876</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l877"><span class="linenum"> 877</span></a>          }
<a name="l878"><span class="linenum"> 878</span></a>  
<a name="l879"><span class="linenum"> 879</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012062000.01);
<a name="l880"><span class="linenum"> 880</span></a>      }
<a name="l881"><span class="linenum"> 881</span></a>  
<a name="l882"><span class="linenum"> 882</span></a>  <span class="comment">    // Moodle v2.3.0 release upgrade line</span>
<a name="l883"><span class="linenum"> 883</span></a>  <span class="comment">    // Put any upgrade step following this</span>
<a name="l884"><span class="linenum"> 884</span></a>  
<a name="l885"><span class="linenum"> 885</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012062500.02) {
<a name="l886"><span class="linenum"> 886</span></a>  <span class="comment">        // Drop some old backup tables, not used anymore</span>
<a name="l887"><span class="linenum"> 887</span></a>  
<a name="l888"><span class="linenum"> 888</span></a>  <span class="comment">        // Define table backup_files to be dropped</span>
<a name="l889"><span class="linenum"> 889</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('backup_files');
<a name="l890"><span class="linenum"> 890</span></a>  
<a name="l891"><span class="linenum"> 891</span></a>  <span class="comment">        // Conditionally launch drop table for backup_files</span>
<a name="l892"><span class="linenum"> 892</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l893"><span class="linenum"> 893</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_table')" href="../../_functions/drop_table.html" onMouseOver="funcPopup(event,'drop_table')">drop_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l894"><span class="linenum"> 894</span></a>          }
<a name="l895"><span class="linenum"> 895</span></a>  
<a name="l896"><span class="linenum"> 896</span></a>  <span class="comment">        // Define table backup_ids to be dropped</span>
<a name="l897"><span class="linenum"> 897</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('backup_ids');
<a name="l898"><span class="linenum"> 898</span></a>  
<a name="l899"><span class="linenum"> 899</span></a>  <span class="comment">        // Conditionally launch drop table for backup_ids</span>
<a name="l900"><span class="linenum"> 900</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l901"><span class="linenum"> 901</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_table')" href="../../_functions/drop_table.html" onMouseOver="funcPopup(event,'drop_table')">drop_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l902"><span class="linenum"> 902</span></a>          }
<a name="l903"><span class="linenum"> 903</span></a>  
<a name="l904"><span class="linenum"> 904</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l905"><span class="linenum"> 905</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012062500.02);
<a name="l906"><span class="linenum"> 906</span></a>      }
<a name="l907"><span class="linenum"> 907</span></a>  
<a name="l908"><span class="linenum"> 908</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012070600.04) {
<a name="l909"><span class="linenum"> 909</span></a>  <span class="comment">        // Define table course_modules_avail_fields to be created</span>
<a name="l910"><span class="linenum"> 910</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_modules_avail_fields');
<a name="l911"><span class="linenum"> 911</span></a>  
<a name="l912"><span class="linenum"> 912</span></a>  <span class="comment">        // Adding fields to table course_modules_avail_fields</span>
<a name="l913"><span class="linenum"> 913</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null);
<a name="l914"><span class="linenum"> 914</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('coursemoduleid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l915"><span class="linenum"> 915</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('userfield', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '50', null, null, null, null);
<a name="l916"><span class="linenum"> 916</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('customfieldid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null);
<a name="l917"><span class="linenum"> 917</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('operator', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '20', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l918"><span class="linenum"> 918</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('value', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l919"><span class="linenum"> 919</span></a>  
<a name="l920"><span class="linenum"> 920</span></a>  <span class="comment">        // Adding keys to table course_modules_avail_fields</span>
<a name="l921"><span class="linenum"> 921</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l922"><span class="linenum"> 922</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('coursemoduleid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('coursemoduleid'), 'course_modules', array('id'));
<a name="l923"><span class="linenum"> 923</span></a>  
<a name="l924"><span class="linenum"> 924</span></a>  <span class="comment">        // Conditionally launch create table for course_modules_avail_fields</span>
<a name="l925"><span class="linenum"> 925</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l926"><span class="linenum"> 926</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l927"><span class="linenum"> 927</span></a>          }
<a name="l928"><span class="linenum"> 928</span></a>  
<a name="l929"><span class="linenum"> 929</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l930"><span class="linenum"> 930</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012070600.04);
<a name="l931"><span class="linenum"> 931</span></a>      }
<a name="l932"><span class="linenum"> 932</span></a>  
<a name="l933"><span class="linenum"> 933</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012070600.05) {
<a name="l934"><span class="linenum"> 934</span></a>  <span class="comment">        // Define table course_sections_avail_fields to be created</span>
<a name="l935"><span class="linenum"> 935</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_sections_avail_fields');
<a name="l936"><span class="linenum"> 936</span></a>  
<a name="l937"><span class="linenum"> 937</span></a>  <span class="comment">        // Adding fields to table course_sections_avail_fields</span>
<a name="l938"><span class="linenum"> 938</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null);
<a name="l939"><span class="linenum"> 939</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('coursesectionid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l940"><span class="linenum"> 940</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('userfield', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '50', null, null, null, null);
<a name="l941"><span class="linenum"> 941</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('customfieldid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null);
<a name="l942"><span class="linenum"> 942</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('operator', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '20', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l943"><span class="linenum"> 943</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('value', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l944"><span class="linenum"> 944</span></a>  
<a name="l945"><span class="linenum"> 945</span></a>  <span class="comment">        // Adding keys to table course_sections_avail_fields</span>
<a name="l946"><span class="linenum"> 946</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l947"><span class="linenum"> 947</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('coursesectionid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('coursesectionid'), 'course_sections', array('id'));
<a name="l948"><span class="linenum"> 948</span></a>  
<a name="l949"><span class="linenum"> 949</span></a>  <span class="comment">        // Conditionally launch create table for course_sections_avail_fields</span>
<a name="l950"><span class="linenum"> 950</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l951"><span class="linenum"> 951</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l952"><span class="linenum"> 952</span></a>          }
<a name="l953"><span class="linenum"> 953</span></a>  
<a name="l954"><span class="linenum"> 954</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l955"><span class="linenum"> 955</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012070600.05);
<a name="l956"><span class="linenum"> 956</span></a>      }
<a name="l957"><span class="linenum"> 957</span></a>  
<a name="l958"><span class="linenum"> 958</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012070600.06) {
<a name="l959"><span class="linenum"> 959</span></a>  
<a name="l960"><span class="linenum"> 960</span></a>  <span class="comment">        // Drop &quot;deleted&quot; fields</span>
<a name="l961"><span class="linenum"> 961</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_completions');
<a name="l962"><span class="linenum"> 962</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('timenotified');
<a name="l963"><span class="linenum"> 963</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('deleted');
<a name="l964"><span class="linenum"> 964</span></a>  
<a name="l965"><span class="linenum"> 965</span></a>  <span class="comment">        // Conditionally launch drop field deleted from course_completions</span>
<a name="l966"><span class="linenum"> 966</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l967"><span class="linenum"> 967</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l968"><span class="linenum"> 968</span></a>          }
<a name="l969"><span class="linenum"> 969</span></a>  
<a name="l970"><span class="linenum"> 970</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('timenotified');
<a name="l971"><span class="linenum"> 971</span></a>  <span class="comment">        // Conditionally launch drop field timenotified from course_completions</span>
<a name="l972"><span class="linenum"> 972</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l973"><span class="linenum"> 973</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l974"><span class="linenum"> 974</span></a>          }
<a name="l975"><span class="linenum"> 975</span></a>  
<a name="l976"><span class="linenum"> 976</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l977"><span class="linenum"> 977</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012070600.06);
<a name="l978"><span class="linenum"> 978</span></a>      }
<a name="l979"><span class="linenum"> 979</span></a>  
<a name="l980"><span class="linenum"> 980</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012070600.07) {
<a name="l981"><span class="linenum"> 981</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_completion_crit_compl');
<a name="l982"><span class="linenum"> 982</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('deleted');
<a name="l983"><span class="linenum"> 983</span></a>  
<a name="l984"><span class="linenum"> 984</span></a>  <span class="comment">        // Conditionally launch drop field deleted from course_completion_crit_compl</span>
<a name="l985"><span class="linenum"> 985</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l986"><span class="linenum"> 986</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l987"><span class="linenum"> 987</span></a>          }
<a name="l988"><span class="linenum"> 988</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l989"><span class="linenum"> 989</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012070600.07);
<a name="l990"><span class="linenum"> 990</span></a>      }
<a name="l991"><span class="linenum"> 991</span></a>  
<a name="l992"><span class="linenum"> 992</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012070600.08) {
<a name="l993"><span class="linenum"> 993</span></a>  
<a name="l994"><span class="linenum"> 994</span></a>  <span class="comment">        // Drop unused table &quot;course_completion_notify&quot;</span>
<a name="l995"><span class="linenum"> 995</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_completion_notify');
<a name="l996"><span class="linenum"> 996</span></a>  
<a name="l997"><span class="linenum"> 997</span></a>  <span class="comment">        // Conditionally launch drop table course_completion_notify</span>
<a name="l998"><span class="linenum"> 998</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l999"><span class="linenum"> 999</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_table')" href="../../_functions/drop_table.html" onMouseOver="funcPopup(event,'drop_table')">drop_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l1000"><span class="linenum">1000</span></a>          }
<a name="l1001"><span class="linenum">1001</span></a>  
<a name="l1002"><span class="linenum">1002</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l1003"><span class="linenum">1003</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012070600.08);
<a name="l1004"><span class="linenum">1004</span></a>       }
<a name="l1005"><span class="linenum">1005</span></a>  
<a name="l1006"><span class="linenum">1006</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012070600.09) {
<a name="l1007"><span class="linenum">1007</span></a>  
<a name="l1008"><span class="linenum">1008</span></a>  <span class="comment">        // Define index path (not unique) to be added to context</span>
<a name="l1009"><span class="linenum">1009</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('context');
<a name="l1010"><span class="linenum">1010</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('path', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('path'), array('varchar_pattern_ops'));
<a name="l1011"><span class="linenum">1011</span></a>  
<a name="l1012"><span class="linenum">1012</span></a>  <span class="comment">        // Recreate index with new pattern hint</span>
<a name="l1013"><span class="linenum">1013</span></a>          if (<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_dbfamily')" href="../../_functions/get_dbfamily.html" onMouseOver="funcPopup(event,'get_dbfamily')">get_dbfamily</a>() === 'postgres') {
<a name="l1014"><span class="linenum">1014</span></a>              if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l1015"><span class="linenum">1015</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_index')" href="../../_functions/drop_index.html" onMouseOver="funcPopup(event,'drop_index')">drop_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l1016"><span class="linenum">1016</span></a>              }
<a name="l1017"><span class="linenum">1017</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l1018"><span class="linenum">1018</span></a>          }
<a name="l1019"><span class="linenum">1019</span></a>  
<a name="l1020"><span class="linenum">1020</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l1021"><span class="linenum">1021</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012070600.09);
<a name="l1022"><span class="linenum">1022</span></a>      }
<a name="l1023"><span class="linenum">1023</span></a>  
<a name="l1024"><span class="linenum">1024</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012070600.10) {
<a name="l1025"><span class="linenum">1025</span></a>  
<a name="l1026"><span class="linenum">1026</span></a>  <span class="comment">        // Define index name (unique) to be dropped form role</span>
<a name="l1027"><span class="linenum">1027</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('role');
<a name="l1028"><span class="linenum">1028</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('name', <a class="constant" onClick="logConstant('XMLDB_INDEX_UNIQUE')" href="../../_constants/XMLDB_INDEX_UNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_UNIQUE')">XMLDB_INDEX_UNIQUE</a>, array('name'));
<a name="l1029"><span class="linenum">1029</span></a>  
<a name="l1030"><span class="linenum">1030</span></a>  <span class="comment">        // Conditionally launch drop index name</span>
<a name="l1031"><span class="linenum">1031</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l1032"><span class="linenum">1032</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_index')" href="../../_functions/drop_index.html" onMouseOver="funcPopup(event,'drop_index')">drop_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l1033"><span class="linenum">1033</span></a>          }
<a name="l1034"><span class="linenum">1034</span></a>  
<a name="l1035"><span class="linenum">1035</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l1036"><span class="linenum">1036</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012070600.10);
<a name="l1037"><span class="linenum">1037</span></a>      }
<a name="l1038"><span class="linenum">1038</span></a>  
<a name="l1039"><span class="linenum">1039</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012070600.11) {
<a name="l1040"><span class="linenum">1040</span></a>  
<a name="l1041"><span class="linenum">1041</span></a>  <span class="comment">        // Define index component-itemid-userid (not unique) to be added to role_assignments</span>
<a name="l1042"><span class="linenum">1042</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('role_assignments');
<a name="l1043"><span class="linenum">1043</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('component-itemid-userid', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('component', 'itemid', 'userid'));
<a name="l1044"><span class="linenum">1044</span></a>  
<a name="l1045"><span class="linenum">1045</span></a>  <span class="comment">        // Conditionally launch add index component-itemid-userid</span>
<a name="l1046"><span class="linenum">1046</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l1047"><span class="linenum">1047</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l1048"><span class="linenum">1048</span></a>          }
<a name="l1049"><span class="linenum">1049</span></a>  
<a name="l1050"><span class="linenum">1050</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l1051"><span class="linenum">1051</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012070600.11);
<a name="l1052"><span class="linenum">1052</span></a>      }
<a name="l1053"><span class="linenum">1053</span></a>  
<a name="l1054"><span class="linenum">1054</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012071900.01) {
<a name="l1055"><span class="linenum">1055</span></a>  <span class="comment">        // Cleanup after simpeltests tool</span>
<a name="l1056"><span class="linenum">1056</span></a>          <a class="function" onClick="logFunction('capabilities_cleanup')" href="../../_functions/capabilities_cleanup.html" onMouseOver="funcPopup(event,'capabilities_cleanup')">capabilities_cleanup</a>('tool_unittest');
<a name="l1057"><span class="linenum">1057</span></a>          <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('tool_unittest');
<a name="l1058"><span class="linenum">1058</span></a>  
<a name="l1059"><span class="linenum">1059</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012071900.01);
<a name="l1060"><span class="linenum">1060</span></a>      }
<a name="l1061"><span class="linenum">1061</span></a>  
<a name="l1062"><span class="linenum">1062</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012072400.00) {
<a name="l1063"><span class="linenum">1063</span></a>  <span class="comment">        // Remove obsolete xhtml strict setting - use THEME-&gt;doctype in theme config if necessary,</span>
<a name="l1064"><span class="linenum">1064</span></a>  <span class="comment">        // see theme_config-&gt;doctype in lib/outputlib.php for more details.</span>
<a name="l1065"><span class="linenum">1065</span></a>          <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('xmlstrictheaders');
<a name="l1066"><span class="linenum">1066</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012072400.00);
<a name="l1067"><span class="linenum">1067</span></a>      }
<a name="l1068"><span class="linenum">1068</span></a>  
<a name="l1069"><span class="linenum">1069</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012072401.00) {
<a name="l1070"><span class="linenum">1070</span></a>  
<a name="l1071"><span class="linenum">1071</span></a>  <span class="comment">        // Saves orphaned questions from the Dark Side</span>
<a name="l1072"><span class="linenum">1072</span></a>          <a class="function" onClick="logFunction('upgrade_save_orphaned_questions')" href="../../_functions/upgrade_save_orphaned_questions.html" onMouseOver="funcPopup(event,'upgrade_save_orphaned_questions')">upgrade_save_orphaned_questions</a>();
<a name="l1073"><span class="linenum">1073</span></a>  
<a name="l1074"><span class="linenum">1074</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l1075"><span class="linenum">1075</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012072401.00);
<a name="l1076"><span class="linenum">1076</span></a>      }
<a name="l1077"><span class="linenum">1077</span></a>  
<a name="l1078"><span class="linenum">1078</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012072600.01) {
<a name="l1079"><span class="linenum">1079</span></a>  <span class="comment">        // Handle events with empty eventtype //MDL-32827</span>
<a name="l1080"><span class="linenum">1080</span></a>  
<a name="l1081"><span class="linenum">1081</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('event', 'eventtype', 'site', array('eventtype' =&gt; '', 'courseid' =&gt; <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a>-&gt;<a onClick="logVariable('id')" class="var it39635" onMouseOver="hilite(39635)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l1082"><span class="linenum">1082</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field_select')" href="../../_functions/set_field_select.html" onMouseOver="funcPopup(event,'set_field_select')">set_field_select</a>('event', 'eventtype', 'due', &quot;eventtype = '' AND courseid != 0 AND groupid = 0 AND (modulename = 'assignment' OR modulename = 'assign')&quot;);
<a name="l1083"><span class="linenum">1083</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field_select')" href="../../_functions/set_field_select.html" onMouseOver="funcPopup(event,'set_field_select')">set_field_select</a>('event', 'eventtype', 'course', &quot;eventtype = '' AND courseid != 0 AND groupid = 0&quot;);
<a name="l1084"><span class="linenum">1084</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field_select')" href="../../_functions/set_field_select.html" onMouseOver="funcPopup(event,'set_field_select')">set_field_select</a>('event', 'eventtype', 'group', &quot;eventtype = '' AND groupid != 0&quot;);
<a name="l1085"><span class="linenum">1085</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field_select')" href="../../_functions/set_field_select.html" onMouseOver="funcPopup(event,'set_field_select')">set_field_select</a>('event', 'eventtype', 'user', &quot;eventtype = '' AND userid != 0&quot;);
<a name="l1086"><span class="linenum">1086</span></a>  
<a name="l1087"><span class="linenum">1087</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l1088"><span class="linenum">1088</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012072600.01);
<a name="l1089"><span class="linenum">1089</span></a>      }
<a name="l1090"><span class="linenum">1090</span></a>  
<a name="l1091"><span class="linenum">1091</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012080200.02) {
<a name="l1092"><span class="linenum">1092</span></a>  <span class="comment">        // Drop obsolete question upgrade field that should have been added to the install.xml.</span>
<a name="l1093"><span class="linenum">1093</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('question');
<a name="l1094"><span class="linenum">1094</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('oldquestiontextformat', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '2', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0');
<a name="l1095"><span class="linenum">1095</span></a>  
<a name="l1096"><span class="linenum">1096</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l1097"><span class="linenum">1097</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l1098"><span class="linenum">1098</span></a>          }
<a name="l1099"><span class="linenum">1099</span></a>  
<a name="l1100"><span class="linenum">1100</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012080200.02);
<a name="l1101"><span class="linenum">1101</span></a>      }
<a name="l1102"><span class="linenum">1102</span></a>  
<a name="l1103"><span class="linenum">1103</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012081400.01) {
<a name="l1104"><span class="linenum">1104</span></a>  <span class="comment">        // Move the ability to disable blogs to its own setting MDL-25012.</span>
<a name="l1105"><span class="linenum">1105</span></a>  
<a name="l1106"><span class="linenum">1106</span></a>          if (isset(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('bloglevel')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/bloglevel.html">bloglevel</a>)) {
<a name="l1107"><span class="linenum">1107</span></a>  <span class="comment">            // Only change settings if existing setting was set.</span>
<a name="l1108"><span class="linenum">1108</span></a>              if (empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('bloglevel')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/bloglevel.html">bloglevel</a>)) {
<a name="l1109"><span class="linenum">1109</span></a>                  <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('enableblogs', 0);
<a name="l1110"><span class="linenum">1110</span></a>  <span class="comment">                // Now set the bloglevel to a valid setting as the disabled setting has been removed.</span>
<a name="l1111"><span class="linenum">1111</span></a>  <span class="comment">                // This prevents confusing results when users enable the blog system in future.</span>
<a name="l1112"><span class="linenum">1112</span></a>                  <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('bloglevel', <a class="constant" onClick="logConstant('BLOG_USER_LEVEL')" href="../../_constants/BLOG_USER_LEVEL.html" onMouseOver="constPopup(event,'BLOG_USER_LEVEL')">BLOG_USER_LEVEL</a>);
<a name="l1113"><span class="linenum">1113</span></a>              } else {
<a name="l1114"><span class="linenum">1114</span></a>                  <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('enableblogs', 1);
<a name="l1115"><span class="linenum">1115</span></a>              }
<a name="l1116"><span class="linenum">1116</span></a>          }
<a name="l1117"><span class="linenum">1117</span></a>  
<a name="l1118"><span class="linenum">1118</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l1119"><span class="linenum">1119</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012081400.01);
<a name="l1120"><span class="linenum">1120</span></a>      }
<a name="l1121"><span class="linenum">1121</span></a>  
<a name="l1122"><span class="linenum">1122</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012081600.01) {
<a name="l1123"><span class="linenum">1123</span></a>  <span class="comment">        // Delete removed setting - Google Maps API V2 will not work in 2013.</span>
<a name="l1124"><span class="linenum">1124</span></a>          <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('googlemapkey');
<a name="l1125"><span class="linenum">1125</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012081600.01);
<a name="l1126"><span class="linenum">1126</span></a>      }
<a name="l1127"><span class="linenum">1127</span></a>  
<a name="l1128"><span class="linenum">1128</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012082300.01) {
<a name="l1129"><span class="linenum">1129</span></a>  <span class="comment">        // Add more custom enrol fields.</span>
<a name="l1130"><span class="linenum">1130</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('enrol');
<a name="l1131"><span class="linenum">1131</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('customint5', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null, 'customint4');
<a name="l1132"><span class="linenum">1132</span></a>  
<a name="l1133"><span class="linenum">1133</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l1134"><span class="linenum">1134</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l1135"><span class="linenum">1135</span></a>          }
<a name="l1136"><span class="linenum">1136</span></a>  
<a name="l1137"><span class="linenum">1137</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('customint6', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null, 'customint5');
<a name="l1138"><span class="linenum">1138</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l1139"><span class="linenum">1139</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l1140"><span class="linenum">1140</span></a>          }
<a name="l1141"><span class="linenum">1141</span></a>  
<a name="l1142"><span class="linenum">1142</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('customint7', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null, 'customint6');
<a name="l1143"><span class="linenum">1143</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l1144"><span class="linenum">1144</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l1145"><span class="linenum">1145</span></a>          }
<a name="l1146"><span class="linenum">1146</span></a>  
<a name="l1147"><span class="linenum">1147</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('customint8', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null, 'customint7');
<a name="l1148"><span class="linenum">1148</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l1149"><span class="linenum">1149</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l1150"><span class="linenum">1150</span></a>          }
<a name="l1151"><span class="linenum">1151</span></a>  
<a name="l1152"><span class="linenum">1152</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('customchar3', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '1333', null, null, null, null, 'customchar2');
<a name="l1153"><span class="linenum">1153</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l1154"><span class="linenum">1154</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l1155"><span class="linenum">1155</span></a>          }
<a name="l1156"><span class="linenum">1156</span></a>  
<a name="l1157"><span class="linenum">1157</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('customtext3', <a class="constant" onClick="logConstant('XMLDB_TYPE_TEXT')" href="../../_constants/XMLDB_TYPE_TEXT.html" onMouseOver="constPopup(event,'XMLDB_TYPE_TEXT')">XMLDB_TYPE_TEXT</a>, null, null, null, null, null, 'customtext2');
<a name="l1158"><span class="linenum">1158</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l1159"><span class="linenum">1159</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l1160"><span class="linenum">1160</span></a>          }
<a name="l1161"><span class="linenum">1161</span></a>  
<a name="l1162"><span class="linenum">1162</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('customtext4', <a class="constant" onClick="logConstant('XMLDB_TYPE_TEXT')" href="../../_constants/XMLDB_TYPE_TEXT.html" onMouseOver="constPopup(event,'XMLDB_TYPE_TEXT')">XMLDB_TYPE_TEXT</a>, null, null, null, null, null, 'customtext3');
<a name="l1163"><span class="linenum">1163</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l1164"><span class="linenum">1164</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l1165"><span class="linenum">1165</span></a>          }
<a name="l1166"><span class="linenum">1166</span></a>  
<a name="l1167"><span class="linenum">1167</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l1168"><span class="linenum">1168</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012082300.01);
<a name="l1169"><span class="linenum">1169</span></a>      }
<a name="l1170"><span class="linenum">1170</span></a>  
<a name="l1171"><span class="linenum">1171</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012082300.02) {
<a name="l1172"><span class="linenum">1172</span></a>  <span class="comment">        // Define field component to be added to groups_members</span>
<a name="l1173"><span class="linenum">1173</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('groups_members');
<a name="l1174"><span class="linenum">1174</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('component', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '100', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'timeadded');
<a name="l1175"><span class="linenum">1175</span></a>  
<a name="l1176"><span class="linenum">1176</span></a>  <span class="comment">        // Conditionally launch add field component</span>
<a name="l1177"><span class="linenum">1177</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l1178"><span class="linenum">1178</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l1179"><span class="linenum">1179</span></a>          }
<a name="l1180"><span class="linenum">1180</span></a>  
<a name="l1181"><span class="linenum">1181</span></a>  <span class="comment">        // Define field itemid to be added to groups_members</span>
<a name="l1182"><span class="linenum">1182</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('itemid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'component');
<a name="l1183"><span class="linenum">1183</span></a>  
<a name="l1184"><span class="linenum">1184</span></a>  <span class="comment">        // Conditionally launch add field itemid</span>
<a name="l1185"><span class="linenum">1185</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l1186"><span class="linenum">1186</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l1187"><span class="linenum">1187</span></a>          }
<a name="l1188"><span class="linenum">1188</span></a>  
<a name="l1189"><span class="linenum">1189</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l1190"><span class="linenum">1190</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012082300.02);
<a name="l1191"><span class="linenum">1191</span></a>      }
<a name="l1192"><span class="linenum">1192</span></a>  
<a name="l1193"><span class="linenum">1193</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012090500.00) {
<a name="l1194"><span class="linenum">1194</span></a>          <a class="var it22099" onMouseOver="hilite(22099)" onMouseOut="lolite()" onClick="logVariable('subquery')" href="../../_variables/subquery.html">$subquery</a> = 'SELECT b.id FROM {blog_external} b where b.id = ' . <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_cast_char2int')" href="../../_functions/sql_cast_char2int.html" onMouseOver="funcPopup(event,'sql_cast_char2int')">sql_cast_char2int</a>('{post}.content', true);
<a name="l1195"><span class="linenum">1195</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'DELETE FROM {post}
<a name="l1196"><span class="linenum">1196</span></a>                        WHERE {post}.module = \'blog_external\'
<a name="l1197"><span class="linenum">1197</span></a>                              AND NOT <a class="function" onClick="logFunction('EXISTS')" href="../../_functions/exists.html" onMouseOver="funcPopup(event,'exists')">EXISTS</a> (' . <a class="var it22099" onMouseOver="hilite(22099)" onMouseOut="lolite()" onClick="logVariable('subquery')" href="../../_variables/subquery.html">$subquery</a> . ')
<a name="l1198"><span class="linenum">1198</span></a>                              AND ' . <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_isnotempty')" href="../../_functions/sql_isnotempty.html" onMouseOver="funcPopup(event,'sql_isnotempty')">sql_isnotempty</a>('post', 'uniquehash', false, false);
<a name="l1199"><span class="linenum">1199</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l1200"><span class="linenum">1200</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012090500.00);
<a name="l1201"><span class="linenum">1201</span></a>      }
<a name="l1202"><span class="linenum">1202</span></a>  
<a name="l1203"><span class="linenum">1203</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012090700.01) {
<a name="l1204"><span class="linenum">1204</span></a>  <span class="comment">        // Add a category field in the course_request table</span>
<a name="l1205"><span class="linenum">1205</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_request');
<a name="l1206"><span class="linenum">1206</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('category', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, 0, 'summaryformat');
<a name="l1207"><span class="linenum">1207</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l1208"><span class="linenum">1208</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l1209"><span class="linenum">1209</span></a>          }
<a name="l1210"><span class="linenum">1210</span></a>  
<a name="l1211"><span class="linenum">1211</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l1212"><span class="linenum">1212</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012090700.01);
<a name="l1213"><span class="linenum">1213</span></a>      }
<a name="l1214"><span class="linenum">1214</span></a>  
<a name="l1215"><span class="linenum">1215</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012091700.00) {
<a name="l1216"><span class="linenum">1216</span></a>  
<a name="l1217"><span class="linenum">1217</span></a>  <span class="comment">        // Dropping screenreader field from user.</span>
<a name="l1218"><span class="linenum">1218</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('user');
<a name="l1219"><span class="linenum">1219</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('screenreader');
<a name="l1220"><span class="linenum">1220</span></a>  
<a name="l1221"><span class="linenum">1221</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l1222"><span class="linenum">1222</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l1223"><span class="linenum">1223</span></a>          }
<a name="l1224"><span class="linenum">1224</span></a>  
<a name="l1225"><span class="linenum">1225</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l1226"><span class="linenum">1226</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012091700.00);
<a name="l1227"><span class="linenum">1227</span></a>      }
<a name="l1228"><span class="linenum">1228</span></a>  
<a name="l1229"><span class="linenum">1229</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012092100.01) {
<a name="l1230"><span class="linenum">1230</span></a>  <span class="comment">        // Some folders still have a sortorder set, which is used for main files but is not</span>
<a name="l1231"><span class="linenum">1231</span></a>  <span class="comment">        // supported by the folder resource. We reset the value here.</span>
<a name="l1232"><span class="linenum">1232</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'UPDATE {files} SET sortorder = ? WHERE component = ? AND filearea = ? AND sortorder &lt;&gt; ?';
<a name="l1233"><span class="linenum">1233</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array(0, 'mod_folder', 'content', 0));
<a name="l1234"><span class="linenum">1234</span></a>  
<a name="l1235"><span class="linenum">1235</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l1236"><span class="linenum">1236</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012092100.01);
<a name="l1237"><span class="linenum">1237</span></a>      }
<a name="l1238"><span class="linenum">1238</span></a>  
<a name="l1239"><span class="linenum">1239</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012092600.00) {
<a name="l1240"><span class="linenum">1240</span></a>  <span class="comment">        // Define index idname (unique) to be added to tag</span>
<a name="l1241"><span class="linenum">1241</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('tag');
<a name="l1242"><span class="linenum">1242</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('idname', <a class="constant" onClick="logConstant('XMLDB_INDEX_UNIQUE')" href="../../_constants/XMLDB_INDEX_UNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_UNIQUE')">XMLDB_INDEX_UNIQUE</a>, array('id', 'name'));
<a name="l1243"><span class="linenum">1243</span></a>  
<a name="l1244"><span class="linenum">1244</span></a>  <span class="comment">        // Conditionally launch add index idname</span>
<a name="l1245"><span class="linenum">1245</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l1246"><span class="linenum">1246</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l1247"><span class="linenum">1247</span></a>          }
<a name="l1248"><span class="linenum">1248</span></a>  
<a name="l1249"><span class="linenum">1249</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l1250"><span class="linenum">1250</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012092600.00);
<a name="l1251"><span class="linenum">1251</span></a>      }
<a name="l1252"><span class="linenum">1252</span></a>  
<a name="l1253"><span class="linenum">1253</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012101500.01) {
<a name="l1254"><span class="linenum">1254</span></a>  <span class="comment">        // Find all orphaned blog associations that might exist.</span>
<a name="l1255"><span class="linenum">1255</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT ba.id
<a name="l1256"><span class="linenum">1256</span></a>                    FROM {blog_association} ba
<a name="l1257"><span class="linenum">1257</span></a>               LEFT JOIN {post} p
<a name="l1258"><span class="linenum">1258</span></a>                      ON p.id = ba.blogid
<a name="l1259"><span class="linenum">1259</span></a>                   WHERE p.id IS NULL&quot;;
<a name="l1260"><span class="linenum">1260</span></a>          <a class="var it37328" onMouseOver="hilite(37328)" onMouseOut="lolite()" onClick="logVariable('orphanedrecordids')" href="../../_variables/orphanedrecordids.html">$orphanedrecordids</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l1261"><span class="linenum">1261</span></a>  <span class="comment">        // Now delete these associations.</span>
<a name="l1262"><span class="linenum">1262</span></a>          foreach (<a class="var it37328" onMouseOver="hilite(37328)" onMouseOut="lolite()" onClick="logVariable('orphanedrecordids')" href="../../_variables/orphanedrecordids.html">$orphanedrecordids</a> as <a class="var it37329" onMouseOver="hilite(37329)" onMouseOut="lolite()" onClick="logVariable('orphanedrecord')" href="../../_variables/orphanedrecord.html">$orphanedrecord</a>) {
<a name="l1263"><span class="linenum">1263</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('blog_association', array('id' =&gt; <a class="var it37329" onMouseOver="hilite(37329)" onMouseOut="lolite()" onClick="logVariable('orphanedrecord')" href="../../_variables/orphanedrecord.html">$orphanedrecord</a>-&gt;<a onClick="logVariable('id')" class="var it41668" onMouseOver="hilite(41668)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l1264"><span class="linenum">1264</span></a>          }
<a name="l1265"><span class="linenum">1265</span></a>  
<a name="l1266"><span class="linenum">1266</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012101500.01);
<a name="l1267"><span class="linenum">1267</span></a>      }
<a name="l1268"><span class="linenum">1268</span></a>  
<a name="l1269"><span class="linenum">1269</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012101800.02) {
<a name="l1270"><span class="linenum">1270</span></a>  <span class="comment">        // Renaming backups using previous file naming convention.</span>
<a name="l1271"><span class="linenum">1271</span></a>          <a class="function" onClick="logFunction('upgrade_rename_old_backup_files_using_shortname')" href="../../_functions/upgrade_rename_old_backup_files_using_shortname.html" onMouseOver="funcPopup(event,'upgrade_rename_old_backup_files_using_shortname')">upgrade_rename_old_backup_files_using_shortname</a>();
<a name="l1272"><span class="linenum">1272</span></a>  
<a name="l1273"><span class="linenum">1273</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l1274"><span class="linenum">1274</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012101800.02);
<a name="l1275"><span class="linenum">1275</span></a>      }
<a name="l1276"><span class="linenum">1276</span></a>  
<a name="l1277"><span class="linenum">1277</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012103001.00) {
<a name="l1278"><span class="linenum">1278</span></a>  <span class="comment">        // create new event_subscriptions table</span>
<a name="l1279"><span class="linenum">1279</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('event_subscriptions');
<a name="l1280"><span class="linenum">1280</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null);
<a name="l1281"><span class="linenum">1281</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('url', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l1282"><span class="linenum">1282</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('courseid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0');
<a name="l1283"><span class="linenum">1283</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('groupid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0');
<a name="l1284"><span class="linenum">1284</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('userid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0');
<a name="l1285"><span class="linenum">1285</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('pollinterval', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0');
<a name="l1286"><span class="linenum">1286</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('lastupdated', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null);
<a name="l1287"><span class="linenum">1287</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('name', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l1288"><span class="linenum">1288</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l1289"><span class="linenum">1289</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l1290"><span class="linenum">1290</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l1291"><span class="linenum">1291</span></a>          }
<a name="l1292"><span class="linenum">1292</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l1293"><span class="linenum">1293</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012103001.00);
<a name="l1294"><span class="linenum">1294</span></a>      }
<a name="l1295"><span class="linenum">1295</span></a>  
<a name="l1296"><span class="linenum">1296</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012103002.00) {
<a name="l1297"><span class="linenum">1297</span></a>  <span class="comment">        // Add subscription field to the event table</span>
<a name="l1298"><span class="linenum">1298</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('event');
<a name="l1299"><span class="linenum">1299</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('subscriptionid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null, 'timemodified');
<a name="l1300"><span class="linenum">1300</span></a>  
<a name="l1301"><span class="linenum">1301</span></a>  <span class="comment">        // Conditionally launch add field subscriptionid</span>
<a name="l1302"><span class="linenum">1302</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l1303"><span class="linenum">1303</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l1304"><span class="linenum">1304</span></a>          }
<a name="l1305"><span class="linenum">1305</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012103002.00);
<a name="l1306"><span class="linenum">1306</span></a>      }
<a name="l1307"><span class="linenum">1307</span></a>  
<a name="l1308"><span class="linenum">1308</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012103003.00) {
<a name="l1309"><span class="linenum">1309</span></a>  <span class="comment">        // Fix uuid field in event table to match RFC-2445 UID property.</span>
<a name="l1310"><span class="linenum">1310</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('event');
<a name="l1311"><span class="linenum">1311</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('uuid', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'visible');
<a name="l1312"><span class="linenum">1312</span></a>  <span class="comment">        // The column already exists, so make sure there are no nulls (crazy mysql).</span>
<a name="l1313"><span class="linenum">1313</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field_select')" href="../../_functions/set_field_select.html" onMouseOver="funcPopup(event,'set_field_select')">set_field_select</a>('event', 'uuid', '', &quot;uuid IS NULL&quot;);
<a name="l1314"><span class="linenum">1314</span></a>  <span class="comment">        // Changing precision of field uuid on table event to (255).</span>
<a name="l1315"><span class="linenum">1315</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('change_field_precision')" href="../../_functions/change_field_precision.html" onMouseOver="funcPopup(event,'change_field_precision')">change_field_precision</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l1316"><span class="linenum">1316</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l1317"><span class="linenum">1317</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012103003.00);
<a name="l1318"><span class="linenum">1318</span></a>      }
<a name="l1319"><span class="linenum">1319</span></a>  
<a name="l1320"><span class="linenum">1320</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012110200.00) {
<a name="l1321"><span class="linenum">1321</span></a>  
<a name="l1322"><span class="linenum">1322</span></a>  <span class="comment">        // Define table course_format_options to be created</span>
<a name="l1323"><span class="linenum">1323</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_format_options');
<a name="l1324"><span class="linenum">1324</span></a>  
<a name="l1325"><span class="linenum">1325</span></a>  <span class="comment">        // Adding fields to table course_format_options</span>
<a name="l1326"><span class="linenum">1326</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null);
<a name="l1327"><span class="linenum">1327</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('courseid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l1328"><span class="linenum">1328</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('format', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '21', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l1329"><span class="linenum">1329</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('sectionid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'format');
<a name="l1330"><span class="linenum">1330</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('name', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '100', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l1331"><span class="linenum">1331</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('value', <a class="constant" onClick="logConstant('XMLDB_TYPE_TEXT')" href="../../_constants/XMLDB_TYPE_TEXT.html" onMouseOver="constPopup(event,'XMLDB_TYPE_TEXT')">XMLDB_TYPE_TEXT</a>, null, null, null, null, null);
<a name="l1332"><span class="linenum">1332</span></a>  
<a name="l1333"><span class="linenum">1333</span></a>  <span class="comment">        // Adding keys to table course_format_options</span>
<a name="l1334"><span class="linenum">1334</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l1335"><span class="linenum">1335</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('courseid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('courseid'), 'course', array('id'));
<a name="l1336"><span class="linenum">1336</span></a>  
<a name="l1337"><span class="linenum">1337</span></a>  <span class="comment">        // Adding indexes to table course_format_options</span>
<a name="l1338"><span class="linenum">1338</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>('formatoption', <a class="constant" onClick="logConstant('XMLDB_INDEX_UNIQUE')" href="../../_constants/XMLDB_INDEX_UNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_UNIQUE')">XMLDB_INDEX_UNIQUE</a>, array('courseid', 'format', 'sectionid', 'name'));
<a name="l1339"><span class="linenum">1339</span></a>  
<a name="l1340"><span class="linenum">1340</span></a>  <span class="comment">        // Conditionally launch create table for course_format_options</span>
<a name="l1341"><span class="linenum">1341</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l1342"><span class="linenum">1342</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l1343"><span class="linenum">1343</span></a>          }
<a name="l1344"><span class="linenum">1344</span></a>  
<a name="l1345"><span class="linenum">1345</span></a>  <span class="comment">        // Changing type of field format on table course to char with length 21</span>
<a name="l1346"><span class="linenum">1346</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course');
<a name="l1347"><span class="linenum">1347</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('format', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '21', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, 'topics', 'summaryformat');
<a name="l1348"><span class="linenum">1348</span></a>  
<a name="l1349"><span class="linenum">1349</span></a>  <span class="comment">        // Launch change of type for field format</span>
<a name="l1350"><span class="linenum">1350</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('change_field_type')" href="../../_functions/change_field_type.html" onMouseOver="funcPopup(event,'change_field_type')">change_field_type</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l1351"><span class="linenum">1351</span></a>  
<a name="l1352"><span class="linenum">1352</span></a>  <span class="comment">        // Since structure of 'course' table has changed we need to re-read $SITE from DB.</span>
<a name="l1353"><span class="linenum">1353</span></a>          <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id' =&gt; <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a>-&gt;<a onClick="logVariable('id')" class="var it39635" onMouseOver="hilite(39635)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l1354"><span class="linenum">1354</span></a>          <a class="var it2554" onMouseOver="hilite(2554)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../_variables/COURSE.html">$COURSE</a> = <a class="function" onClick="logFunction('clone')" href="../../_functions/clone.html" onMouseOver="funcPopup(event,'clone')">clone</a>(<a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a>);
<a name="l1355"><span class="linenum">1355</span></a>  
<a name="l1356"><span class="linenum">1356</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l1357"><span class="linenum">1357</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012110200.00);
<a name="l1358"><span class="linenum">1358</span></a>      }
<a name="l1359"><span class="linenum">1359</span></a>  
<a name="l1360"><span class="linenum">1360</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012110201.00) {
<a name="l1361"><span class="linenum">1361</span></a>  
<a name="l1362"><span class="linenum">1362</span></a>  <span class="comment">        // Copy fields 'coursedisplay', 'numsections', 'hiddensections' from table {course}</span>
<a name="l1363"><span class="linenum">1363</span></a>  <span class="comment">        // to table {course_format_options} as the additional format options</span>
<a name="l1364"><span class="linenum">1364</span></a>          <a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a> = array();
<a name="l1365"><span class="linenum">1365</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course');
<a name="l1366"><span class="linenum">1366</span></a>          foreach (array('coursedisplay', 'numsections', 'hiddensections') as <a class="var it1208" onMouseOver="hilite(1208)" onMouseOut="lolite()" onClick="logVariable('fieldname')" href="../../_variables/fieldname.html">$fieldname</a>) {
<a name="l1367"><span class="linenum">1367</span></a>  <span class="comment">            // first check that fields still exist</span>
<a name="l1368"><span class="linenum">1368</span></a>              <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>(<a class="var it1208" onMouseOver="hilite(1208)" onMouseOut="lolite()" onClick="logVariable('fieldname')" href="../../_variables/fieldname.html">$fieldname</a>);
<a name="l1369"><span class="linenum">1369</span></a>              if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l1370"><span class="linenum">1370</span></a>                  <a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[] = <a class="var it1208" onMouseOver="hilite(1208)" onMouseOut="lolite()" onClick="logVariable('fieldname')" href="../../_variables/fieldname.html">$fieldname</a>;
<a name="l1371"><span class="linenum">1371</span></a>              }
<a name="l1372"><span class="linenum">1372</span></a>          }
<a name="l1373"><span class="linenum">1373</span></a>  
<a name="l1374"><span class="linenum">1374</span></a>          if (!empty(<a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>)) {
<a name="l1375"><span class="linenum">1375</span></a>              <a class="var it2929" onMouseOver="hilite(2929)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l1376"><span class="linenum">1376</span></a>              <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>('SELECT id, format, '. <a class="function" onClick="logFunction('join')" href="../../_functions/join.html" onMouseOver="funcPopup(event,'join')">join</a>(',', <a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>).'
<a name="l1377"><span class="linenum">1377</span></a>                  FROM {course}
<a name="l1378"><span class="linenum">1378</span></a>                  WHERE format &lt;&gt; ? AND format &lt;&gt; ?',
<a name="l1379"><span class="linenum">1379</span></a>                  array('scorm', 'social'));
<a name="l1380"><span class="linenum">1380</span></a>  <span class="comment">            // (do not copy fields from scrom and social formats, we already know that they are not used)</span>
<a name="l1381"><span class="linenum">1381</span></a>              foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>) {
<a name="l1382"><span class="linenum">1382</span></a>                  foreach (<a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a> as <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>) {
<a name="l1383"><span class="linenum">1383</span></a>                      try {
<a name="l1384"><span class="linenum">1384</span></a>                          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('course_format_options',
<a name="l1385"><span class="linenum">1385</span></a>                                  array(
<a name="l1386"><span class="linenum">1386</span></a>                                      'courseid'  =&gt; <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('id')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l1387"><span class="linenum">1387</span></a>                                      'format'    =&gt; <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('format')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/format.html">format</a>,
<a name="l1388"><span class="linenum">1388</span></a>                                      'sectionid' =&gt; 0,
<a name="l1389"><span class="linenum">1389</span></a>                                      'name'      =&gt; <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>,
<a name="l1390"><span class="linenum">1390</span></a>                                      'value'     =&gt; <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>
<a name="l1391"><span class="linenum">1391</span></a>                                  ));
<a name="l1392"><span class="linenum">1392</span></a>                      } catch (dml_exception <a class="var it193" onMouseOver="hilite(193)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>) {
<a name="l1393"><span class="linenum">1393</span></a>  <span class="comment">                        // index 'courseid,format,sectionid,name' violation</span>
<a name="l1394"><span class="linenum">1394</span></a>  <span class="comment">                        // continue; the entry in course_format_options already exists, use it</span>
<a name="l1395"><span class="linenum">1395</span></a>                      }
<a name="l1396"><span class="linenum">1396</span></a>                  }
<a name="l1397"><span class="linenum">1397</span></a>              }
<a name="l1398"><span class="linenum">1398</span></a>              <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l1399"><span class="linenum">1399</span></a>              <a class="var it2929" onMouseOver="hilite(2929)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l1400"><span class="linenum">1400</span></a>  
<a name="l1401"><span class="linenum">1401</span></a>  <span class="comment">            // Drop fields from table course</span>
<a name="l1402"><span class="linenum">1402</span></a>              foreach (<a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a> as <a class="var it1208" onMouseOver="hilite(1208)" onMouseOut="lolite()" onClick="logVariable('fieldname')" href="../../_variables/fieldname.html">$fieldname</a>) {
<a name="l1403"><span class="linenum">1403</span></a>                  <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>(<a class="var it1208" onMouseOver="hilite(1208)" onMouseOut="lolite()" onClick="logVariable('fieldname')" href="../../_variables/fieldname.html">$fieldname</a>);
<a name="l1404"><span class="linenum">1404</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l1405"><span class="linenum">1405</span></a>              }
<a name="l1406"><span class="linenum">1406</span></a>          }
<a name="l1407"><span class="linenum">1407</span></a>  
<a name="l1408"><span class="linenum">1408</span></a>  <span class="comment">        // Since structure of 'course' table has changed we need to re-read $SITE from DB.</span>
<a name="l1409"><span class="linenum">1409</span></a>          <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id' =&gt; <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a>-&gt;<a onClick="logVariable('id')" class="var it39635" onMouseOver="hilite(39635)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l1410"><span class="linenum">1410</span></a>          <a class="var it2554" onMouseOver="hilite(2554)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../_variables/COURSE.html">$COURSE</a> = <a class="function" onClick="logFunction('clone')" href="../../_functions/clone.html" onMouseOver="funcPopup(event,'clone')">clone</a>(<a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a>);
<a name="l1411"><span class="linenum">1411</span></a>  
<a name="l1412"><span class="linenum">1412</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l1413"><span class="linenum">1413</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012110201.00);
<a name="l1414"><span class="linenum">1414</span></a>      }
<a name="l1415"><span class="linenum">1415</span></a>  
<a name="l1416"><span class="linenum">1416</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012110700.01) {
<a name="l1417"><span class="linenum">1417</span></a>  
<a name="l1418"><span class="linenum">1418</span></a>  <span class="comment">        // Define field caller_component to be added to portfolio_log.</span>
<a name="l1419"><span class="linenum">1419</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('portfolio_log');
<a name="l1420"><span class="linenum">1420</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('caller_component', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, null, null, null, 'caller_file');
<a name="l1421"><span class="linenum">1421</span></a>  
<a name="l1422"><span class="linenum">1422</span></a>  <span class="comment">        // Conditionally launch add field caller_component.</span>
<a name="l1423"><span class="linenum">1423</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l1424"><span class="linenum">1424</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l1425"><span class="linenum">1425</span></a>          }
<a name="l1426"><span class="linenum">1426</span></a>  
<a name="l1427"><span class="linenum">1427</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l1428"><span class="linenum">1428</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012110700.01);
<a name="l1429"><span class="linenum">1429</span></a>      }
<a name="l1430"><span class="linenum">1430</span></a>  
<a name="l1431"><span class="linenum">1431</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012111200.00) {
<a name="l1432"><span class="linenum">1432</span></a>  
<a name="l1433"><span class="linenum">1433</span></a>  <span class="comment">        // Define table temp_enroled_template to be created</span>
<a name="l1434"><span class="linenum">1434</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('temp_enroled_template');
<a name="l1435"><span class="linenum">1435</span></a>  
<a name="l1436"><span class="linenum">1436</span></a>  <span class="comment">        // Adding fields to table temp_enroled_template</span>
<a name="l1437"><span class="linenum">1437</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null);
<a name="l1438"><span class="linenum">1438</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('userid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0');
<a name="l1439"><span class="linenum">1439</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('courseid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0');
<a name="l1440"><span class="linenum">1440</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('roleid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l1441"><span class="linenum">1441</span></a>  
<a name="l1442"><span class="linenum">1442</span></a>  <span class="comment">        // Adding keys to table temp_enroled_template</span>
<a name="l1443"><span class="linenum">1443</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l1444"><span class="linenum">1444</span></a>  
<a name="l1445"><span class="linenum">1445</span></a>  <span class="comment">        // Adding indexes to table temp_enroled_template</span>
<a name="l1446"><span class="linenum">1446</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>('userid', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('userid'));
<a name="l1447"><span class="linenum">1447</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>('courseid', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('courseid'));
<a name="l1448"><span class="linenum">1448</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>('roleid', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('roleid'));
<a name="l1449"><span class="linenum">1449</span></a>  
<a name="l1450"><span class="linenum">1450</span></a>  <span class="comment">        // Conditionally launch create table for temp_enroled_template</span>
<a name="l1451"><span class="linenum">1451</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l1452"><span class="linenum">1452</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l1453"><span class="linenum">1453</span></a>          }
<a name="l1454"><span class="linenum">1454</span></a>  
<a name="l1455"><span class="linenum">1455</span></a>  <span class="comment">        // Define table temp_log_template to be created</span>
<a name="l1456"><span class="linenum">1456</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('temp_log_template');
<a name="l1457"><span class="linenum">1457</span></a>  
<a name="l1458"><span class="linenum">1458</span></a>  <span class="comment">        // Adding fields to table temp_log_template</span>
<a name="l1459"><span class="linenum">1459</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null);
<a name="l1460"><span class="linenum">1460</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('userid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0');
<a name="l1461"><span class="linenum">1461</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('course', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0');
<a name="l1462"><span class="linenum">1462</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('action', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '40', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l1463"><span class="linenum">1463</span></a>  
<a name="l1464"><span class="linenum">1464</span></a>  <span class="comment">        // Adding keys to table temp_log_template</span>
<a name="l1465"><span class="linenum">1465</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l1466"><span class="linenum">1466</span></a>  
<a name="l1467"><span class="linenum">1467</span></a>  <span class="comment">        // Adding indexes to table temp_log_template</span>
<a name="l1468"><span class="linenum">1468</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>('action', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('action'));
<a name="l1469"><span class="linenum">1469</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>('course', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('course'));
<a name="l1470"><span class="linenum">1470</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>('user', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('userid'));
<a name="l1471"><span class="linenum">1471</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>('usercourseaction', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('userid', 'course', 'action'));
<a name="l1472"><span class="linenum">1472</span></a>  
<a name="l1473"><span class="linenum">1473</span></a>  <span class="comment">        // Conditionally launch create table for temp_log_template</span>
<a name="l1474"><span class="linenum">1474</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l1475"><span class="linenum">1475</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l1476"><span class="linenum">1476</span></a>          }
<a name="l1477"><span class="linenum">1477</span></a>  
<a name="l1478"><span class="linenum">1478</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l1479"><span class="linenum">1479</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012111200.00);
<a name="l1480"><span class="linenum">1480</span></a>      }
<a name="l1481"><span class="linenum">1481</span></a>  
<a name="l1482"><span class="linenum">1482</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012111200.01) {
<a name="l1483"><span class="linenum">1483</span></a>  <span class="comment">        // Force the rebuild of the cache of every courses, some cached information could contain wrong icon references.</span>
<a name="l1484"><span class="linenum">1484</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>('UPDATE {course} set modinfo = ?, sectioncache = ?', array(null, null));
<a name="l1485"><span class="linenum">1485</span></a>  
<a name="l1486"><span class="linenum">1486</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l1487"><span class="linenum">1487</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012111200.01);
<a name="l1488"><span class="linenum">1488</span></a>      }
<a name="l1489"><span class="linenum">1489</span></a>  
<a name="l1490"><span class="linenum">1490</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012111601.01) {
<a name="l1491"><span class="linenum">1491</span></a>  <span class="comment">        // Clea up after old shared memory caching support.</span>
<a name="l1492"><span class="linenum">1492</span></a>          <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('cachetype');
<a name="l1493"><span class="linenum">1493</span></a>          <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('rcache');
<a name="l1494"><span class="linenum">1494</span></a>          <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('rcachettl');
<a name="l1495"><span class="linenum">1495</span></a>          <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('intcachemax');
<a name="l1496"><span class="linenum">1496</span></a>          <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('memcachedhosts');
<a name="l1497"><span class="linenum">1497</span></a>          <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('memcachedpconn');
<a name="l1498"><span class="linenum">1498</span></a>  
<a name="l1499"><span class="linenum">1499</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l1500"><span class="linenum">1500</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012111601.01);
<a name="l1501"><span class="linenum">1501</span></a>      }
<a name="l1502"><span class="linenum">1502</span></a>  
<a name="l1503"><span class="linenum">1503</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012112100.00) {
<a name="l1504"><span class="linenum">1504</span></a>  
<a name="l1505"><span class="linenum">1505</span></a>  <span class="comment">        // Define field eventtype to be added to event_subscriptions.</span>
<a name="l1506"><span class="linenum">1506</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('event_subscriptions');
<a name="l1507"><span class="linenum">1507</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('eventtype', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '20', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'userid');
<a name="l1508"><span class="linenum">1508</span></a>  
<a name="l1509"><span class="linenum">1509</span></a>  <span class="comment">        // Conditionally launch add field eventtype.</span>
<a name="l1510"><span class="linenum">1510</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l1511"><span class="linenum">1511</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l1512"><span class="linenum">1512</span></a>          }
<a name="l1513"><span class="linenum">1513</span></a>  
<a name="l1514"><span class="linenum">1514</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l1515"><span class="linenum">1515</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012112100.00);
<a name="l1516"><span class="linenum">1516</span></a>      }
<a name="l1517"><span class="linenum">1517</span></a>  
<a name="l1518"><span class="linenum">1518</span></a>  <span class="comment">    // Moodle v2.4.0 release upgrade line</span>
<a name="l1519"><span class="linenum">1519</span></a>  <span class="comment">    // Put any upgrade step following this</span>
<a name="l1520"><span class="linenum">1520</span></a>  
<a name="l1521"><span class="linenum">1521</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012120300.01) {
<a name="l1522"><span class="linenum">1522</span></a>  <span class="comment">        // Make sure site-course has format='site' //MDL-36840</span>
<a name="l1523"><span class="linenum">1523</span></a>  
<a name="l1524"><span class="linenum">1524</span></a>          if (<a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a>-&gt;<a onClick="logVariable('format')" class="var it39635" onMouseOver="hilite(39635)" onMouseOut="lolite()" href="../../_variables/format.html">format</a> !== 'site') {
<a name="l1525"><span class="linenum">1525</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('course', 'format', 'site', array('id' =&gt; <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a>-&gt;<a onClick="logVariable('id')" class="var it39635" onMouseOver="hilite(39635)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l1526"><span class="linenum">1526</span></a>              <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a>-&gt;<a onClick="logVariable('format')" class="var it39635" onMouseOver="hilite(39635)" onMouseOut="lolite()" href="../../_variables/format.html">format</a> = 'site';
<a name="l1527"><span class="linenum">1527</span></a>              <a class="var it2554" onMouseOver="hilite(2554)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../_variables/COURSE.html">$COURSE</a>-&gt;<a onClick="logVariable('format')" class="var it39504" onMouseOver="hilite(39504)" onMouseOut="lolite()" href="../../_variables/format.html">format</a> = 'site';
<a name="l1528"><span class="linenum">1528</span></a>          }
<a name="l1529"><span class="linenum">1529</span></a>  
<a name="l1530"><span class="linenum">1530</span></a>  <span class="comment">        // Main savepoint reached</span>
<a name="l1531"><span class="linenum">1531</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012120300.01);
<a name="l1532"><span class="linenum">1532</span></a>      }
<a name="l1533"><span class="linenum">1533</span></a>  
<a name="l1534"><span class="linenum">1534</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012120300.04) {
<a name="l1535"><span class="linenum">1535</span></a>  <span class="comment">        // Remove &quot;_utf8&quot; suffix from all langs in course table.</span>
<a name="l1536"><span class="linenum">1536</span></a>          <a class="var it4417" onMouseOver="hilite(4417)" onMouseOut="lolite()" onClick="logVariable('langs')" href="../../_variables/langs.html">$langs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT DISTINCT lang FROM {course} WHERE lang LIKE ?&quot;, array('%_utf8'));
<a name="l1537"><span class="linenum">1537</span></a>  
<a name="l1538"><span class="linenum">1538</span></a>          foreach (<a class="var it4417" onMouseOver="hilite(4417)" onMouseOut="lolite()" onClick="logVariable('langs')" href="../../_variables/langs.html">$langs</a> as <a class="var it2703" onMouseOver="hilite(2703)" onMouseOut="lolite()" onClick="logVariable('lang')" href="../../_variables/lang.html">$lang</a>=&gt;<a class="var it1136" onMouseOver="hilite(1136)" onMouseOut="lolite()" onClick="logVariable('unused')" href="../../_variables/unused.html">$unused</a>) {
<a name="l1539"><span class="linenum">1539</span></a>              <a class="var it37330" onMouseOver="hilite(37330)" onMouseOut="lolite()" onClick="logVariable('newlang')" href="../../_variables/newlang.html">$newlang</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('_utf8', '', <a class="var it2703" onMouseOver="hilite(2703)" onMouseOut="lolite()" onClick="logVariable('lang')" href="../../_variables/lang.html">$lang</a>);
<a name="l1540"><span class="linenum">1540</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;UPDATE {course} SET lang = :newlang WHERE lang = :lang&quot;;
<a name="l1541"><span class="linenum">1541</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array('newlang'=&gt;<a class="var it37330" onMouseOver="hilite(37330)" onMouseOut="lolite()" onClick="logVariable('newlang')" href="../../_variables/newlang.html">$newlang</a>, 'lang'=&gt;<a class="var it2703" onMouseOver="hilite(2703)" onMouseOut="lolite()" onClick="logVariable('lang')" href="../../_variables/lang.html">$lang</a>));
<a name="l1542"><span class="linenum">1542</span></a>          }
<a name="l1543"><span class="linenum">1543</span></a>  
<a name="l1544"><span class="linenum">1544</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l1545"><span class="linenum">1545</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012120300.04);
<a name="l1546"><span class="linenum">1546</span></a>      }
<a name="l1547"><span class="linenum">1547</span></a>  
<a name="l1548"><span class="linenum">1548</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012123000.00) {
<a name="l1549"><span class="linenum">1549</span></a>  <span class="comment">        // Purge removed module filters and all their settings.</span>
<a name="l1550"><span class="linenum">1550</span></a>  
<a name="l1551"><span class="linenum">1551</span></a>          <a class="var it448" onMouseOver="hilite(448)" onMouseOut="lolite()" onClick="logVariable('tables')" href="../../_variables/tables.html">$tables</a> = array('filter_active', 'filter_config');
<a name="l1552"><span class="linenum">1552</span></a>          foreach (<a class="var it448" onMouseOver="hilite(448)" onMouseOut="lolite()" onClick="logVariable('tables')" href="../../_variables/tables.html">$tables</a> as <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>) {
<a name="l1553"><span class="linenum">1553</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, &quot;filter LIKE 'mod/%'&quot;);
<a name="l1554"><span class="linenum">1554</span></a>              <a class="var it5855" onMouseOver="hilite(5855)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT DISTINCT filter FROM {{<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>}} WHERE filter LIKE 'filter/%'&quot;);
<a name="l1555"><span class="linenum">1555</span></a>              foreach (<a class="var it5855" onMouseOver="hilite(5855)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a> as <a class="var it87" onMouseOver="hilite(87)" onMouseOut="lolite()" onClick="logVariable('filter')" href="../../_variables/filter.html">$filter</a>) {
<a name="l1556"><span class="linenum">1556</span></a>                  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, 'filter', <a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it87" onMouseOver="hilite(87)" onMouseOut="lolite()" onClick="logVariable('filter')" href="../../_variables/filter.html">$filter</a>-&gt;<a onClick="logVariable('filter')" class="var it39485" onMouseOver="hilite(39485)" onMouseOut="lolite()" href="../../_variables/filter.html">filter</a>, 7), array('filter'=&gt;<a class="var it87" onMouseOver="hilite(87)" onMouseOut="lolite()" onClick="logVariable('filter')" href="../../_variables/filter.html">$filter</a>-&gt;<a onClick="logVariable('filter')" class="var it39485" onMouseOver="hilite(39485)" onMouseOut="lolite()" href="../../_variables/filter.html">filter</a>));
<a name="l1557"><span class="linenum">1557</span></a>              }
<a name="l1558"><span class="linenum">1558</span></a>          }
<a name="l1559"><span class="linenum">1559</span></a>  
<a name="l1560"><span class="linenum">1560</span></a>          <a class="var it6035" onMouseOver="hilite(6035)" onMouseOut="lolite()" onClick="logVariable('configs')" href="../../_variables/configs.html">$configs</a> = array('stringfilters', 'filterall');
<a name="l1561"><span class="linenum">1561</span></a>          foreach (<a class="var it6035" onMouseOver="hilite(6035)" onMouseOut="lolite()" onClick="logVariable('configs')" href="../../_variables/configs.html">$configs</a> as <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>) {
<a name="l1562"><span class="linenum">1562</span></a>              if (<a class="var it5855" onMouseOver="hilite(5855)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a> = <a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>(null, <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>)) {
<a name="l1563"><span class="linenum">1563</span></a>                  <a class="var it5855" onMouseOver="hilite(5855)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it5855" onMouseOver="hilite(5855)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a>);
<a name="l1564"><span class="linenum">1564</span></a>                  <a class="var it37331" onMouseOver="hilite(37331)" onMouseOut="lolite()" onClick="logVariable('newfilters')" href="../../_variables/newfilters.html">$newfilters</a> = array();
<a name="l1565"><span class="linenum">1565</span></a>                  foreach(<a class="var it5855" onMouseOver="hilite(5855)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a> as <a class="var it87" onMouseOver="hilite(87)" onMouseOut="lolite()" onClick="logVariable('filter')" href="../../_variables/filter.html">$filter</a>) {
<a name="l1566"><span class="linenum">1566</span></a>                      if (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it87" onMouseOver="hilite(87)" onMouseOut="lolite()" onClick="logVariable('filter')" href="../../_variables/filter.html">$filter</a>, '/') === false) {
<a name="l1567"><span class="linenum">1567</span></a>                          <a class="var it37331" onMouseOver="hilite(37331)" onMouseOut="lolite()" onClick="logVariable('newfilters')" href="../../_variables/newfilters.html">$newfilters</a>[] = <a class="var it87" onMouseOver="hilite(87)" onMouseOut="lolite()" onClick="logVariable('filter')" href="../../_variables/filter.html">$filter</a>;
<a name="l1568"><span class="linenum">1568</span></a>                      } else if (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it87" onMouseOver="hilite(87)" onMouseOut="lolite()" onClick="logVariable('filter')" href="../../_variables/filter.html">$filter</a>, 'filter/') === 0) {
<a name="l1569"><span class="linenum">1569</span></a>                          <a class="var it37331" onMouseOver="hilite(37331)" onMouseOut="lolite()" onClick="logVariable('newfilters')" href="../../_variables/newfilters.html">$newfilters</a>[] = <a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it87" onMouseOver="hilite(87)" onMouseOut="lolite()" onClick="logVariable('filter')" href="../../_variables/filter.html">$filter</a>, 7);
<a name="l1570"><span class="linenum">1570</span></a>                      }
<a name="l1571"><span class="linenum">1571</span></a>                  }
<a name="l1572"><span class="linenum">1572</span></a>                  <a class="var it5855" onMouseOver="hilite(5855)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',', <a class="var it37331" onMouseOver="hilite(37331)" onMouseOut="lolite()" onClick="logVariable('newfilters')" href="../../_variables/newfilters.html">$newfilters</a>);
<a name="l1573"><span class="linenum">1573</span></a>                  <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>(<a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>, <a class="var it5855" onMouseOver="hilite(5855)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a>);
<a name="l1574"><span class="linenum">1574</span></a>              }
<a name="l1575"><span class="linenum">1575</span></a>          }
<a name="l1576"><span class="linenum">1576</span></a>  
<a name="l1577"><span class="linenum">1577</span></a>          unset(<a class="var it448" onMouseOver="hilite(448)" onMouseOut="lolite()" onClick="logVariable('tables')" href="../../_variables/tables.html">$tables</a>);
<a name="l1578"><span class="linenum">1578</span></a>          unset(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l1579"><span class="linenum">1579</span></a>          unset(<a class="var it6035" onMouseOver="hilite(6035)" onMouseOut="lolite()" onClick="logVariable('configs')" href="../../_variables/configs.html">$configs</a>);
<a name="l1580"><span class="linenum">1580</span></a>          unset(<a class="var it37331" onMouseOver="hilite(37331)" onMouseOut="lolite()" onClick="logVariable('newfilters')" href="../../_variables/newfilters.html">$newfilters</a>);
<a name="l1581"><span class="linenum">1581</span></a>          unset(<a class="var it5855" onMouseOver="hilite(5855)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a>);
<a name="l1582"><span class="linenum">1582</span></a>          unset(<a class="var it87" onMouseOver="hilite(87)" onMouseOut="lolite()" onClick="logVariable('filter')" href="../../_variables/filter.html">$filter</a>);
<a name="l1583"><span class="linenum">1583</span></a>  
<a name="l1584"><span class="linenum">1584</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l1585"><span class="linenum">1585</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2012123000.00);
<a name="l1586"><span class="linenum">1586</span></a>      }
<a name="l1587"><span class="linenum">1587</span></a>  
<a name="l1588"><span class="linenum">1588</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013021100.01) {
<a name="l1589"><span class="linenum">1589</span></a>  <span class="comment">        // Make sure there are no bogus nulls in old MySQL tables.</span>
<a name="l1590"><span class="linenum">1590</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field_select')" href="../../_functions/set_field_select.html" onMouseOver="funcPopup(event,'set_field_select')">set_field_select</a>('user', 'password', '', &quot;password IS NULL&quot;);
<a name="l1591"><span class="linenum">1591</span></a>  
<a name="l1592"><span class="linenum">1592</span></a>  <span class="comment">        // Changing precision of field password on table user to (255).</span>
<a name="l1593"><span class="linenum">1593</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('user');
<a name="l1594"><span class="linenum">1594</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('password', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'username');
<a name="l1595"><span class="linenum">1595</span></a>  
<a name="l1596"><span class="linenum">1596</span></a>  <span class="comment">        // Launch change of precision for field password.</span>
<a name="l1597"><span class="linenum">1597</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('change_field_precision')" href="../../_functions/change_field_precision.html" onMouseOver="funcPopup(event,'change_field_precision')">change_field_precision</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l1598"><span class="linenum">1598</span></a>  
<a name="l1599"><span class="linenum">1599</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l1600"><span class="linenum">1600</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013021100.01);
<a name="l1601"><span class="linenum">1601</span></a>      }
<a name="l1602"><span class="linenum">1602</span></a>  
<a name="l1603"><span class="linenum">1603</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013021800.00) {
<a name="l1604"><span class="linenum">1604</span></a>  <span class="comment">        // Add the site identifier to the cache config's file.</span>
<a name="l1605"><span class="linenum">1605</span></a>          <a class="var it12904" onMouseOver="hilite(12904)" onMouseOut="lolite()" onClick="logVariable('siteidentifier')" href="../../_variables/siteidentifier.html">$siteidentifier</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('config', 'value', array('name' =&gt; 'siteidentifier'));
<a name="l1606"><span class="linenum">1606</span></a>          <a class="class" onClick="logClass('cache_helper')" href="../../_classes/cache_helper.html" onMouseOver="classPopup(event,'cache_helper')">cache_helper</a>::<a class="function" onClick="logFunction('update_site_identifier')" href="../../_functions/update_site_identifier.html" onMouseOver="funcPopup(event,'update_site_identifier')">update_site_identifier</a>(<a class="var it12904" onMouseOver="hilite(12904)" onMouseOut="lolite()" onClick="logVariable('siteidentifier')" href="../../_variables/siteidentifier.html">$siteidentifier</a>);
<a name="l1607"><span class="linenum">1607</span></a>  
<a name="l1608"><span class="linenum">1608</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l1609"><span class="linenum">1609</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013021800.00);
<a name="l1610"><span class="linenum">1610</span></a>      }
<a name="l1611"><span class="linenum">1611</span></a>  
<a name="l1612"><span class="linenum">1612</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013021801.00) {
<a name="l1613"><span class="linenum">1613</span></a>  <span class="comment">        // Fixing possible wrong MIME types for SMART Notebook files.</span>
<a name="l1614"><span class="linenum">1614</span></a>          <a class="var it576" onMouseOver="hilite(576)" onMouseOut="lolite()" onClick="logVariable('extensions')" href="../../_variables/extensions.html">$extensions</a> = array('%.gallery', '%.galleryitem', '%.gallerycollection', '%.nbk', '%.notebook', '%.xbk');
<a name="l1615"><span class="linenum">1615</span></a>          <a class="var it2282" onMouseOver="hilite(2282)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_like')" href="../../_functions/sql_like.html" onMouseOver="funcPopup(event,'sql_like')">sql_like</a>('filename', '?', false);
<a name="l1616"><span class="linenum">1616</span></a>          foreach (<a class="var it576" onMouseOver="hilite(576)" onMouseOut="lolite()" onClick="logVariable('extensions')" href="../../_variables/extensions.html">$extensions</a> as <a class="var it473" onMouseOver="hilite(473)" onMouseOut="lolite()" onClick="logVariable('extension')" href="../../_variables/extension.html">$extension</a>) {
<a name="l1617"><span class="linenum">1617</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field_select')" href="../../_functions/set_field_select.html" onMouseOver="funcPopup(event,'set_field_select')">set_field_select</a>(
<a name="l1618"><span class="linenum">1618</span></a>                  'files',
<a name="l1619"><span class="linenum">1619</span></a>                  'mimetype',
<a name="l1620"><span class="linenum">1620</span></a>                  'application/x-smarttech-notebook',
<a name="l1621"><span class="linenum">1621</span></a>                  <a class="var it2282" onMouseOver="hilite(2282)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a>,
<a name="l1622"><span class="linenum">1622</span></a>                  array(<a class="var it473" onMouseOver="hilite(473)" onMouseOut="lolite()" onClick="logVariable('extension')" href="../../_variables/extension.html">$extension</a>)
<a name="l1623"><span class="linenum">1623</span></a>              );
<a name="l1624"><span class="linenum">1624</span></a>          }
<a name="l1625"><span class="linenum">1625</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013021801.00);
<a name="l1626"><span class="linenum">1626</span></a>      }
<a name="l1627"><span class="linenum">1627</span></a>  
<a name="l1628"><span class="linenum">1628</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013021801.01) {
<a name="l1629"><span class="linenum">1629</span></a>  <span class="comment">        // This upgrade step is re-written under MDL-38228 (see below).</span>
<a name="l1630"><span class="linenum">1630</span></a>          <span class="comment">/*</span>
<a name="l1631"><span class="linenum">1631</span></a>  <span class="comment">        // Retrieve the list of course_sections as a recordset to save memory</span>
<a name="l1632"><span class="linenum">1632</span></a>  <span class="comment">        $coursesections = $DB-&gt;get_recordset('course_sections', null, 'course, id', 'id, course, sequence');</span>
<a name="l1633"><span class="linenum">1633</span></a>  <span class="comment">        foreach ($coursesections as $coursesection) {</span>
<a name="l1634"><span class="linenum">1634</span></a>  <span class="comment">            // Retrieve all of the actual modules in this course and section combination to reduce DB calls</span>
<a name="l1635"><span class="linenum">1635</span></a>  <span class="comment">            $actualsectionmodules = $DB-&gt;get_records('course_modules',</span>
<a name="l1636"><span class="linenum">1636</span></a>  <span class="comment">                    array('course' =&gt; $coursesection-&gt;course, 'section' =&gt; $coursesection-&gt;id), '', 'id, section');</span>
<a name="l1637"><span class="linenum">1637</span></a>  <span class="comment"></span>
<a name="l1638"><span class="linenum">1638</span></a>  <span class="comment">            // Break out the current sequence so that we can compare it</span>
<a name="l1639"><span class="linenum">1639</span></a>  <span class="comment">            $currentsequence = explode(',', $coursesection-&gt;sequence);</span>
<a name="l1640"><span class="linenum">1640</span></a>  <span class="comment">            $newsequence = array();</span>
<a name="l1641"><span class="linenum">1641</span></a>  <span class="comment"></span>
<a name="l1642"><span class="linenum">1642</span></a>  <span class="comment">            // Check each of the modules in the current sequence</span>
<a name="l1643"><span class="linenum">1643</span></a>  <span class="comment">            foreach ($currentsequence as $module) {</span>
<a name="l1644"><span class="linenum">1644</span></a>  <span class="comment">                if (isset($actualsectionmodules[$module])) {</span>
<a name="l1645"><span class="linenum">1645</span></a>  <span class="comment">                    $newsequence[] = $module;</span>
<a name="l1646"><span class="linenum">1646</span></a>  <span class="comment">                    // We unset the actualsectionmodules so that we don't get duplicates and that we can add orphaned</span>
<a name="l1647"><span class="linenum">1647</span></a>  <span class="comment">                    // modules later</span>
<a name="l1648"><span class="linenum">1648</span></a>  <span class="comment">                    unset($actualsectionmodules[$module]);</span>
<a name="l1649"><span class="linenum">1649</span></a>  <span class="comment">                }</span>
<a name="l1650"><span class="linenum">1650</span></a>  <span class="comment">            }</span>
<a name="l1651"><span class="linenum">1651</span></a>  <span class="comment"></span>
<a name="l1652"><span class="linenum">1652</span></a>  <span class="comment">            // Append any modules which have somehow been orphaned</span>
<a name="l1653"><span class="linenum">1653</span></a>  <span class="comment">            foreach ($actualsectionmodules as $module) {</span>
<a name="l1654"><span class="linenum">1654</span></a>  <span class="comment">                $newsequence[] = $module-&gt;id;</span>
<a name="l1655"><span class="linenum">1655</span></a>  <span class="comment">            }</span>
<a name="l1656"><span class="linenum">1656</span></a>  <span class="comment"></span>
<a name="l1657"><span class="linenum">1657</span></a>  <span class="comment">            // Piece it all back together</span>
<a name="l1658"><span class="linenum">1658</span></a>  <span class="comment">            $sequence = implode(',', $newsequence);</span>
<a name="l1659"><span class="linenum">1659</span></a>  <span class="comment"></span>
<a name="l1660"><span class="linenum">1660</span></a>  <span class="comment">            // Only update if there have been changes</span>
<a name="l1661"><span class="linenum">1661</span></a>  <span class="comment">            if ($sequence !== $coursesection-&gt;sequence) {</span>
<a name="l1662"><span class="linenum">1662</span></a>  <span class="comment">                $coursesection-&gt;sequence = $sequence;</span>
<a name="l1663"><span class="linenum">1663</span></a>  <span class="comment">                $DB-&gt;update_record('course_sections', $coursesection);</span>
<a name="l1664"><span class="linenum">1664</span></a>  <span class="comment"></span>
<a name="l1665"><span class="linenum">1665</span></a>  <span class="comment">                // And clear the sectioncache and modinfo cache - they'll be regenerated on next use</span>
<a name="l1666"><span class="linenum">1666</span></a>  <span class="comment">                $course = new stdClass();</span>
<a name="l1667"><span class="linenum">1667</span></a>  <span class="comment">                $course-&gt;id = $coursesection-&gt;course;</span>
<a name="l1668"><span class="linenum">1668</span></a>  <span class="comment">                $course-&gt;sectioncache = null;</span>
<a name="l1669"><span class="linenum">1669</span></a>  <span class="comment">                $course-&gt;modinfo = null;</span>
<a name="l1670"><span class="linenum">1670</span></a>  <span class="comment">                $DB-&gt;update_record('course', $course);</span>
<a name="l1671"><span class="linenum">1671</span></a>  <span class="comment">            }</span>
<a name="l1672"><span class="linenum">1672</span></a>  <span class="comment">        }</span>
<a name="l1673"><span class="linenum">1673</span></a>  <span class="comment">        $coursesections-&gt;close();</span>
<a name="l1674"><span class="linenum">1674</span></a>  <span class="comment">        */</span>
<a name="l1675"><span class="linenum">1675</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l1676"><span class="linenum">1676</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013021801.01);
<a name="l1677"><span class="linenum">1677</span></a>      }
<a name="l1678"><span class="linenum">1678</span></a>  
<a name="l1679"><span class="linenum">1679</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013021902.00) {
<a name="l1680"><span class="linenum">1680</span></a>  <span class="comment">        // ISO country change: Netherlands Antilles is split into BQ, CW &amp; SX</span>
<a name="l1681"><span class="linenum">1681</span></a>  <span class="comment">        // http://www.iso.org/iso/iso_3166-1_newsletter_vi-8_split_of_the_dutch_antilles_final-en.pdf</span>
<a name="l1682"><span class="linenum">1682</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;UPDATE {user} SET country = '' WHERE country = ?&quot;;
<a name="l1683"><span class="linenum">1683</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array('AN'));
<a name="l1684"><span class="linenum">1684</span></a>  
<a name="l1685"><span class="linenum">1685</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013021902.00);
<a name="l1686"><span class="linenum">1686</span></a>      }
<a name="l1687"><span class="linenum">1687</span></a>  
<a name="l1688"><span class="linenum">1688</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013022600.00) {
<a name="l1689"><span class="linenum">1689</span></a>  <span class="comment">        // Delete entries regarding invalid 'interests' option which breaks course.</span>
<a name="l1690"><span class="linenum">1690</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('course_sections_avail_fields', array('userfield' =&gt; 'interests'));
<a name="l1691"><span class="linenum">1691</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('course_modules_avail_fields', array('userfield' =&gt; 'interests'));
<a name="l1692"><span class="linenum">1692</span></a>  <span class="comment">        // Clear course cache (will be rebuilt on first visit) in case of changes to these.</span>
<a name="l1693"><span class="linenum">1693</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>('UPDATE {course} set modinfo = ?, sectioncache = ?', array(null, null));
<a name="l1694"><span class="linenum">1694</span></a>  
<a name="l1695"><span class="linenum">1695</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013022600.00);
<a name="l1696"><span class="linenum">1696</span></a>      }
<a name="l1697"><span class="linenum">1697</span></a>  
<a name="l1698"><span class="linenum">1698</span></a>  <span class="comment">    // Add index to field &quot;timemodified&quot; for grade_grades_history table.</span>
<a name="l1699"><span class="linenum">1699</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013030400.00) {
<a name="l1700"><span class="linenum">1700</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('grade_grades_history');
<a name="l1701"><span class="linenum">1701</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('timemodified');
<a name="l1702"><span class="linenum">1702</span></a>  
<a name="l1703"><span class="linenum">1703</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l1704"><span class="linenum">1704</span></a>              <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('timemodified', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('timemodified'));
<a name="l1705"><span class="linenum">1705</span></a>              if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l1706"><span class="linenum">1706</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l1707"><span class="linenum">1707</span></a>              }
<a name="l1708"><span class="linenum">1708</span></a>          }
<a name="l1709"><span class="linenum">1709</span></a>  
<a name="l1710"><span class="linenum">1710</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l1711"><span class="linenum">1711</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013030400.00);
<a name="l1712"><span class="linenum">1712</span></a>      }
<a name="l1713"><span class="linenum">1713</span></a>  
<a name="l1714"><span class="linenum">1714</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013030400.02) {
<a name="l1715"><span class="linenum">1715</span></a>  <span class="comment">        // Cleanup qformat blackboard settings.</span>
<a name="l1716"><span class="linenum">1716</span></a>          <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('qformat_blackboard');
<a name="l1717"><span class="linenum">1717</span></a>  
<a name="l1718"><span class="linenum">1718</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013030400.02);
<a name="l1719"><span class="linenum">1719</span></a>      }
<a name="l1720"><span class="linenum">1720</span></a>  
<a name="l1721"><span class="linenum">1721</span></a>  <span class="comment">    // This is checking to see if the site has been running a specific version with a bug in it</span>
<a name="l1722"><span class="linenum">1722</span></a>  <span class="comment">    // because this upgrade step is slow and is only needed if the site has been running with the affected versions.</span>
<a name="l1723"><span class="linenum">1723</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &gt;= 2012062504.08 &amp;&amp; <a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2012062504.13) {
<a name="l1724"><span class="linenum">1724</span></a>  <span class="comment">        // This upgrade step is re-written under MDL-38228 (see below).</span>
<a name="l1725"><span class="linenum">1725</span></a>  
<a name="l1726"><span class="linenum">1726</span></a>          <span class="comment">/*</span>
<a name="l1727"><span class="linenum">1727</span></a>  <span class="comment">        // Retrieve the list of course_sections as a recordset to save memory.</span>
<a name="l1728"><span class="linenum">1728</span></a>  <span class="comment">        // This is to fix a regression caused by MDL-37939.</span>
<a name="l1729"><span class="linenum">1729</span></a>  <span class="comment">        // In this case the upgrade step is fixing records where:</span>
<a name="l1730"><span class="linenum">1730</span></a>  <span class="comment">        // The data in course_sections.sequence contains the correct module id</span>
<a name="l1731"><span class="linenum">1731</span></a>  <span class="comment">        // The section field for on the course modules table may have been updated to point to the incorrect id.</span>
<a name="l1732"><span class="linenum">1732</span></a>  <span class="comment"></span>
<a name="l1733"><span class="linenum">1733</span></a>  <span class="comment">        // This query is looking for sections where the sequence is not in sync with the course_modules table.</span>
<a name="l1734"><span class="linenum">1734</span></a>  <span class="comment">        // The syntax for the like query is looking for a value in a comma separated list.</span>
<a name="l1735"><span class="linenum">1735</span></a>  <span class="comment">        // It adds a comma to either site of the list and then searches for LIKE '%,id,%'.</span>
<a name="l1736"><span class="linenum">1736</span></a>  <span class="comment">        $sequenceconcat = $DB-&gt;sql_concat(&quot;','&quot;, 's.sequence', &quot;','&quot;);</span>
<a name="l1737"><span class="linenum">1737</span></a>  <span class="comment">        $moduleconcat = $DB-&gt;sql_concat(&quot;'%,'&quot;, 'cm.id', &quot;',%'&quot;);</span>
<a name="l1738"><span class="linenum">1738</span></a>  <span class="comment">        $sql = 'SELECT s2.id, s2.course, s2.sequence</span>
<a name="l1739"><span class="linenum">1739</span></a>  <span class="comment">                FROM {course_sections} s2</span>
<a name="l1740"><span class="linenum">1740</span></a>  <span class="comment">                JOIN(</span>
<a name="l1741"><span class="linenum">1741</span></a>  <span class="comment">                    SELECT DISTINCT s.id</span>
<a name="l1742"><span class="linenum">1742</span></a>  <span class="comment">                    FROM</span>
<a name="l1743"><span class="linenum">1743</span></a>  <span class="comment">                    {course_modules} cm</span>
<a name="l1744"><span class="linenum">1744</span></a>  <span class="comment">                    JOIN {course_sections} s</span>
<a name="l1745"><span class="linenum">1745</span></a>  <span class="comment">                    ON</span>
<a name="l1746"><span class="linenum">1746</span></a>  <span class="comment">                        cm.course = s.course</span>
<a name="l1747"><span class="linenum">1747</span></a>  <span class="comment">                    WHERE cm.section != s.id AND ' . $sequenceconcat . ' LIKE ' . $moduleconcat . '</span>
<a name="l1748"><span class="linenum">1748</span></a>  <span class="comment">                ) d</span>
<a name="l1749"><span class="linenum">1749</span></a>  <span class="comment">                ON s2.id = d.id';</span>
<a name="l1750"><span class="linenum">1750</span></a>  <span class="comment">        $coursesections = $DB-&gt;get_recordset_sql($sql);</span>
<a name="l1751"><span class="linenum">1751</span></a>  <span class="comment"></span>
<a name="l1752"><span class="linenum">1752</span></a>  <span class="comment">        foreach ($coursesections as $coursesection) {</span>
<a name="l1753"><span class="linenum">1753</span></a>  <span class="comment">            // Retrieve all of the actual modules in this course and section combination to reduce DB calls.</span>
<a name="l1754"><span class="linenum">1754</span></a>  <span class="comment">            $actualsectionmodules = $DB-&gt;get_records('course_modules',</span>
<a name="l1755"><span class="linenum">1755</span></a>  <span class="comment">                    array('course' =&gt; $coursesection-&gt;course, 'section' =&gt; $coursesection-&gt;id), '', 'id, section');</span>
<a name="l1756"><span class="linenum">1756</span></a>  <span class="comment"></span>
<a name="l1757"><span class="linenum">1757</span></a>  <span class="comment">            // Break out the current sequence so that we can compare it.</span>
<a name="l1758"><span class="linenum">1758</span></a>  <span class="comment">            $currentsequence = explode(',', $coursesection-&gt;sequence);</span>
<a name="l1759"><span class="linenum">1759</span></a>  <span class="comment">            $orphanlist = array();</span>
<a name="l1760"><span class="linenum">1760</span></a>  <span class="comment"></span>
<a name="l1761"><span class="linenum">1761</span></a>  <span class="comment">            // Check each of the modules in the current sequence.</span>
<a name="l1762"><span class="linenum">1762</span></a>  <span class="comment">            foreach ($currentsequence as $cmid) {</span>
<a name="l1763"><span class="linenum">1763</span></a>  <span class="comment">                if (!empty($cmid) &amp;&amp; !isset($actualsectionmodules[$cmid])) {</span>
<a name="l1764"><span class="linenum">1764</span></a>  <span class="comment">                    $orphanlist[] = $cmid;</span>
<a name="l1765"><span class="linenum">1765</span></a>  <span class="comment">                }</span>
<a name="l1766"><span class="linenum">1766</span></a>  <span class="comment">            }</span>
<a name="l1767"><span class="linenum">1767</span></a>  <span class="comment"></span>
<a name="l1768"><span class="linenum">1768</span></a>  <span class="comment">            if (!empty($orphanlist)) {</span>
<a name="l1769"><span class="linenum">1769</span></a>  <span class="comment">                list($sql, $params) = $DB-&gt;get_in_or_equal($orphanlist, SQL_PARAMS_NAMED);</span>
<a name="l1770"><span class="linenum">1770</span></a>  <span class="comment">                $sql = &quot;id $sql&quot;;</span>
<a name="l1771"><span class="linenum">1771</span></a>  <span class="comment"></span>
<a name="l1772"><span class="linenum">1772</span></a>  <span class="comment">                $DB-&gt;set_field_select('course_modules', 'section', $coursesection-&gt;id, $sql, $params);</span>
<a name="l1773"><span class="linenum">1773</span></a>  <span class="comment"></span>
<a name="l1774"><span class="linenum">1774</span></a>  <span class="comment">                // And clear the sectioncache and modinfo cache - they'll be regenerated on next use.</span>
<a name="l1775"><span class="linenum">1775</span></a>  <span class="comment">                $course = new stdClass();</span>
<a name="l1776"><span class="linenum">1776</span></a>  <span class="comment">                $course-&gt;id = $coursesection-&gt;course;</span>
<a name="l1777"><span class="linenum">1777</span></a>  <span class="comment">                $course-&gt;sectioncache = null;</span>
<a name="l1778"><span class="linenum">1778</span></a>  <span class="comment">                $course-&gt;modinfo = null;</span>
<a name="l1779"><span class="linenum">1779</span></a>  <span class="comment">                $DB-&gt;update_record('course', $course);</span>
<a name="l1780"><span class="linenum">1780</span></a>  <span class="comment">            }</span>
<a name="l1781"><span class="linenum">1781</span></a>  <span class="comment">        }</span>
<a name="l1782"><span class="linenum">1782</span></a>  <span class="comment">        $coursesections-&gt;close();</span>
<a name="l1783"><span class="linenum">1783</span></a>  <span class="comment"></span>
<a name="l1784"><span class="linenum">1784</span></a>  <span class="comment">        // No savepoint needed for this change.</span>
<a name="l1785"><span class="linenum">1785</span></a>  <span class="comment">         */</span>
<a name="l1786"><span class="linenum">1786</span></a>      }
<a name="l1787"><span class="linenum">1787</span></a>  
<a name="l1788"><span class="linenum">1788</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013032200.01) {
<a name="l1789"><span class="linenum">1789</span></a>  <span class="comment">        // GD is now always available</span>
<a name="l1790"><span class="linenum">1790</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('gdversion', 2);
<a name="l1791"><span class="linenum">1791</span></a>  
<a name="l1792"><span class="linenum">1792</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013032200.01);
<a name="l1793"><span class="linenum">1793</span></a>      }
<a name="l1794"><span class="linenum">1794</span></a>  
<a name="l1795"><span class="linenum">1795</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013032600.03) {
<a name="l1796"><span class="linenum">1796</span></a>  <span class="comment">        // Fixing possible wrong MIME type for MIME HTML (MHTML) files.</span>
<a name="l1797"><span class="linenum">1797</span></a>          <a class="var it576" onMouseOver="hilite(576)" onMouseOut="lolite()" onClick="logVariable('extensions')" href="../../_variables/extensions.html">$extensions</a> = array('%.mht', '%.mhtml');
<a name="l1798"><span class="linenum">1798</span></a>          <a class="var it2282" onMouseOver="hilite(2282)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_like')" href="../../_functions/sql_like.html" onMouseOver="funcPopup(event,'sql_like')">sql_like</a>('filename', '?', false);
<a name="l1799"><span class="linenum">1799</span></a>          foreach (<a class="var it576" onMouseOver="hilite(576)" onMouseOut="lolite()" onClick="logVariable('extensions')" href="../../_variables/extensions.html">$extensions</a> as <a class="var it473" onMouseOver="hilite(473)" onMouseOut="lolite()" onClick="logVariable('extension')" href="../../_variables/extension.html">$extension</a>) {
<a name="l1800"><span class="linenum">1800</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field_select')" href="../../_functions/set_field_select.html" onMouseOver="funcPopup(event,'set_field_select')">set_field_select</a>(
<a name="l1801"><span class="linenum">1801</span></a>                  'files',
<a name="l1802"><span class="linenum">1802</span></a>                  'mimetype',
<a name="l1803"><span class="linenum">1803</span></a>                  'message/rfc822',
<a name="l1804"><span class="linenum">1804</span></a>                  <a class="var it2282" onMouseOver="hilite(2282)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a>,
<a name="l1805"><span class="linenum">1805</span></a>                  array(<a class="var it473" onMouseOver="hilite(473)" onMouseOut="lolite()" onClick="logVariable('extension')" href="../../_variables/extension.html">$extension</a>)
<a name="l1806"><span class="linenum">1806</span></a>              );
<a name="l1807"><span class="linenum">1807</span></a>          }
<a name="l1808"><span class="linenum">1808</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013032600.03);
<a name="l1809"><span class="linenum">1809</span></a>      }
<a name="l1810"><span class="linenum">1810</span></a>  
<a name="l1811"><span class="linenum">1811</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013032600.04) {
<a name="l1812"><span class="linenum">1812</span></a>  <span class="comment">        // MDL-31983 broke the quiz version number. Fix it.</span>
<a name="l1813"><span class="linenum">1813</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('modules', 'version', '2013021500',
<a name="l1814"><span class="linenum">1814</span></a>                  array('name' =&gt; 'quiz', 'version' =&gt; '2013310100'));
<a name="l1815"><span class="linenum">1815</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013032600.04);
<a name="l1816"><span class="linenum">1816</span></a>      }
<a name="l1817"><span class="linenum">1817</span></a>  
<a name="l1818"><span class="linenum">1818</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013040200.00) {
<a name="l1819"><span class="linenum">1819</span></a>  <span class="comment">        // Add openbadges tables.</span>
<a name="l1820"><span class="linenum">1820</span></a>  
<a name="l1821"><span class="linenum">1821</span></a>  <span class="comment">        // Define table 'badge' to be created.</span>
<a name="l1822"><span class="linenum">1822</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('badge');
<a name="l1823"><span class="linenum">1823</span></a>  
<a name="l1824"><span class="linenum">1824</span></a>  <span class="comment">        // Adding fields to table 'badge'.</span>
<a name="l1825"><span class="linenum">1825</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null, null);
<a name="l1826"><span class="linenum">1826</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('name', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'id');
<a name="l1827"><span class="linenum">1827</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('description', <a class="constant" onClick="logConstant('XMLDB_TYPE_TEXT')" href="../../_constants/XMLDB_TYPE_TEXT.html" onMouseOver="constPopup(event,'XMLDB_TYPE_TEXT')">XMLDB_TYPE_TEXT</a>, null, null, null, null, null, 'name');
<a name="l1828"><span class="linenum">1828</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('image', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'description');
<a name="l1829"><span class="linenum">1829</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('timecreated', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'image');
<a name="l1830"><span class="linenum">1830</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('timemodified', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'timecreated');
<a name="l1831"><span class="linenum">1831</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('usercreated', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'timemodified');
<a name="l1832"><span class="linenum">1832</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('usermodified', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'usercreated');
<a name="l1833"><span class="linenum">1833</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('issuername', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'usermodified');
<a name="l1834"><span class="linenum">1834</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('issuerurl', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'issuername');
<a name="l1835"><span class="linenum">1835</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('issuercontact', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, null, null, null, 'issuerurl');
<a name="l1836"><span class="linenum">1836</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('expiredate', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null, 'issuercontact');
<a name="l1837"><span class="linenum">1837</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('expireperiod', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null, 'expiredate');
<a name="l1838"><span class="linenum">1838</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('type', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '1', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '1', 'expireperiod');
<a name="l1839"><span class="linenum">1839</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('courseid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null, 'type');
<a name="l1840"><span class="linenum">1840</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('message', <a class="constant" onClick="logConstant('XMLDB_TYPE_TEXT')" href="../../_constants/XMLDB_TYPE_TEXT.html" onMouseOver="constPopup(event,'XMLDB_TYPE_TEXT')">XMLDB_TYPE_TEXT</a>, null, null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'courseid');
<a name="l1841"><span class="linenum">1841</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('messagesubject', <a class="constant" onClick="logConstant('XMLDB_TYPE_TEXT')" href="../../_constants/XMLDB_TYPE_TEXT.html" onMouseOver="constPopup(event,'XMLDB_TYPE_TEXT')">XMLDB_TYPE_TEXT</a>, null, null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'message');
<a name="l1842"><span class="linenum">1842</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('attachment', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '1', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '1', 'messagesubject');
<a name="l1843"><span class="linenum">1843</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('notification', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '1', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '1', 'attachment');
<a name="l1844"><span class="linenum">1844</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('status', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '1', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'notification');
<a name="l1845"><span class="linenum">1845</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('nextcron', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null, 'status');
<a name="l1846"><span class="linenum">1846</span></a>  
<a name="l1847"><span class="linenum">1847</span></a>  <span class="comment">        // Adding keys to table 'badge'.</span>
<a name="l1848"><span class="linenum">1848</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l1849"><span class="linenum">1849</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('fk_courseid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('courseid'), 'course', array('id'));
<a name="l1850"><span class="linenum">1850</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('fk_usermodified', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('usermodified'), 'user', array('id'));
<a name="l1851"><span class="linenum">1851</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('fk_usercreated', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('usercreated'), 'user', array('id'));
<a name="l1852"><span class="linenum">1852</span></a>  
<a name="l1853"><span class="linenum">1853</span></a>  <span class="comment">        // Adding indexes to table 'badge'.</span>
<a name="l1854"><span class="linenum">1854</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>('type', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('type'));
<a name="l1855"><span class="linenum">1855</span></a>  
<a name="l1856"><span class="linenum">1856</span></a>  <span class="comment">        // Conditionally launch create table for 'badge'.</span>
<a name="l1857"><span class="linenum">1857</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l1858"><span class="linenum">1858</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l1859"><span class="linenum">1859</span></a>          }
<a name="l1860"><span class="linenum">1860</span></a>  
<a name="l1861"><span class="linenum">1861</span></a>  <span class="comment">        // Define table 'badge_criteria' to be created.</span>
<a name="l1862"><span class="linenum">1862</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('badge_criteria');
<a name="l1863"><span class="linenum">1863</span></a>  
<a name="l1864"><span class="linenum">1864</span></a>  <span class="comment">        // Adding fields to table 'badge_criteria'.</span>
<a name="l1865"><span class="linenum">1865</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null, null);
<a name="l1866"><span class="linenum">1866</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('badgeid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'id');
<a name="l1867"><span class="linenum">1867</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('criteriatype', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null, 'badgeid');
<a name="l1868"><span class="linenum">1868</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('method', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '1', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '1', 'criteriatype');
<a name="l1869"><span class="linenum">1869</span></a>  
<a name="l1870"><span class="linenum">1870</span></a>  <span class="comment">        // Adding keys to table 'badge_criteria'.</span>
<a name="l1871"><span class="linenum">1871</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l1872"><span class="linenum">1872</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('fk_badgeid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('badgeid'), 'badge', array('id'));
<a name="l1873"><span class="linenum">1873</span></a>  
<a name="l1874"><span class="linenum">1874</span></a>  <span class="comment">        // Adding indexes to table 'badge_criteria'.</span>
<a name="l1875"><span class="linenum">1875</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>('criteriatype', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('criteriatype'));
<a name="l1876"><span class="linenum">1876</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>('badgecriteriatype', <a class="constant" onClick="logConstant('XMLDB_INDEX_UNIQUE')" href="../../_constants/XMLDB_INDEX_UNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_UNIQUE')">XMLDB_INDEX_UNIQUE</a>, array('badgeid', 'criteriatype'));
<a name="l1877"><span class="linenum">1877</span></a>  
<a name="l1878"><span class="linenum">1878</span></a>  <span class="comment">        // Conditionally launch create table for 'badge_criteria'.</span>
<a name="l1879"><span class="linenum">1879</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l1880"><span class="linenum">1880</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l1881"><span class="linenum">1881</span></a>          }
<a name="l1882"><span class="linenum">1882</span></a>  
<a name="l1883"><span class="linenum">1883</span></a>  <span class="comment">        // Define table 'badge_criteria_param' to be created.</span>
<a name="l1884"><span class="linenum">1884</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('badge_criteria_param');
<a name="l1885"><span class="linenum">1885</span></a>  
<a name="l1886"><span class="linenum">1886</span></a>  <span class="comment">        // Adding fields to table 'badge_criteria_param'.</span>
<a name="l1887"><span class="linenum">1887</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null, null);
<a name="l1888"><span class="linenum">1888</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('critid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'id');
<a name="l1889"><span class="linenum">1889</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('name', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'critid');
<a name="l1890"><span class="linenum">1890</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('value', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, null, null, null, 'name');
<a name="l1891"><span class="linenum">1891</span></a>  
<a name="l1892"><span class="linenum">1892</span></a>  <span class="comment">        // Adding keys to table 'badge_criteria_param'.</span>
<a name="l1893"><span class="linenum">1893</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l1894"><span class="linenum">1894</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('fk_critid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('critid'), 'badge_criteria', array('id'));
<a name="l1895"><span class="linenum">1895</span></a>  
<a name="l1896"><span class="linenum">1896</span></a>  <span class="comment">        // Conditionally launch create table for 'badge_criteria_param'.</span>
<a name="l1897"><span class="linenum">1897</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l1898"><span class="linenum">1898</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l1899"><span class="linenum">1899</span></a>          }
<a name="l1900"><span class="linenum">1900</span></a>  
<a name="l1901"><span class="linenum">1901</span></a>  <span class="comment">        // Define table 'badge_issued' to be created.</span>
<a name="l1902"><span class="linenum">1902</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('badge_issued');
<a name="l1903"><span class="linenum">1903</span></a>  
<a name="l1904"><span class="linenum">1904</span></a>  <span class="comment">        // Adding fields to table 'badge_issued'.</span>
<a name="l1905"><span class="linenum">1905</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null, null);
<a name="l1906"><span class="linenum">1906</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('badgeid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'id');
<a name="l1907"><span class="linenum">1907</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('userid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'badgeid');
<a name="l1908"><span class="linenum">1908</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('uniquehash', <a class="constant" onClick="logConstant('XMLDB_TYPE_TEXT')" href="../../_constants/XMLDB_TYPE_TEXT.html" onMouseOver="constPopup(event,'XMLDB_TYPE_TEXT')">XMLDB_TYPE_TEXT</a>, null, null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'userid');
<a name="l1909"><span class="linenum">1909</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('dateissued', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'uniquehash');
<a name="l1910"><span class="linenum">1910</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('dateexpire', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null, 'dateissued');
<a name="l1911"><span class="linenum">1911</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('visible', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '1', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'dateexpire');
<a name="l1912"><span class="linenum">1912</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('issuernotified', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null, 'visible');
<a name="l1913"><span class="linenum">1913</span></a>  
<a name="l1914"><span class="linenum">1914</span></a>  <span class="comment">        // Adding keys to table 'badge_issued'.</span>
<a name="l1915"><span class="linenum">1915</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l1916"><span class="linenum">1916</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('fk_badgeid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('badgeid'), 'badge', array('id'));
<a name="l1917"><span class="linenum">1917</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('fk_userid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('userid'), 'user', array('id'));
<a name="l1918"><span class="linenum">1918</span></a>  
<a name="l1919"><span class="linenum">1919</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>('badgeuser', <a class="constant" onClick="logConstant('XMLDB_INDEX_UNIQUE')" href="../../_constants/XMLDB_INDEX_UNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_UNIQUE')">XMLDB_INDEX_UNIQUE</a>, array('badgeid', 'userid'));
<a name="l1920"><span class="linenum">1920</span></a>  
<a name="l1921"><span class="linenum">1921</span></a>  <span class="comment">        // Conditionally launch create table for 'badge_issued'.</span>
<a name="l1922"><span class="linenum">1922</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l1923"><span class="linenum">1923</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l1924"><span class="linenum">1924</span></a>          }
<a name="l1925"><span class="linenum">1925</span></a>  
<a name="l1926"><span class="linenum">1926</span></a>  <span class="comment">        // Define table 'badge_criteria_met' to be created.</span>
<a name="l1927"><span class="linenum">1927</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('badge_criteria_met');
<a name="l1928"><span class="linenum">1928</span></a>  
<a name="l1929"><span class="linenum">1929</span></a>  <span class="comment">        // Adding fields to table 'badge_criteria_met'.</span>
<a name="l1930"><span class="linenum">1930</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null, null);
<a name="l1931"><span class="linenum">1931</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('issuedid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null, 'id');
<a name="l1932"><span class="linenum">1932</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('critid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'issuedid');
<a name="l1933"><span class="linenum">1933</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('userid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'critid');
<a name="l1934"><span class="linenum">1934</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('datemet', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'userid');
<a name="l1935"><span class="linenum">1935</span></a>  
<a name="l1936"><span class="linenum">1936</span></a>  <span class="comment">        // Adding keys to table 'badge_criteria_met'</span>
<a name="l1937"><span class="linenum">1937</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l1938"><span class="linenum">1938</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('fk_critid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('critid'), 'badge_criteria', array('id'));
<a name="l1939"><span class="linenum">1939</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('fk_userid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('userid'), 'user', array('id'));
<a name="l1940"><span class="linenum">1940</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('fk_issuedid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('issuedid'), 'badge_issued', array('id'));
<a name="l1941"><span class="linenum">1941</span></a>  
<a name="l1942"><span class="linenum">1942</span></a>  <span class="comment">        // Conditionally launch create table for 'badge_criteria_met'.</span>
<a name="l1943"><span class="linenum">1943</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l1944"><span class="linenum">1944</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l1945"><span class="linenum">1945</span></a>          }
<a name="l1946"><span class="linenum">1946</span></a>  
<a name="l1947"><span class="linenum">1947</span></a>  <span class="comment">        // Define table 'badge_manual_award' to be created.</span>
<a name="l1948"><span class="linenum">1948</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('badge_manual_award');
<a name="l1949"><span class="linenum">1949</span></a>  
<a name="l1950"><span class="linenum">1950</span></a>  <span class="comment">        // Adding fields to table 'badge_manual_award'.</span>
<a name="l1951"><span class="linenum">1951</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null, null);
<a name="l1952"><span class="linenum">1952</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('badgeid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'id');
<a name="l1953"><span class="linenum">1953</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('recipientid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'badgeid');
<a name="l1954"><span class="linenum">1954</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('issuerid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'recipientid');
<a name="l1955"><span class="linenum">1955</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('issuerrole', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'issuerid');
<a name="l1956"><span class="linenum">1956</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('datemet', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'issuerrole');
<a name="l1957"><span class="linenum">1957</span></a>  
<a name="l1958"><span class="linenum">1958</span></a>  <span class="comment">        // Adding keys to table 'badge_manual_award'.</span>
<a name="l1959"><span class="linenum">1959</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l1960"><span class="linenum">1960</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('fk_badgeid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('badgeid'), 'badge', array('id'));
<a name="l1961"><span class="linenum">1961</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('fk_recipientid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('recipientid'), 'user', array('id'));
<a name="l1962"><span class="linenum">1962</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('fk_issuerid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('issuerid'), 'user', array('id'));
<a name="l1963"><span class="linenum">1963</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('fk_issuerrole', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('issuerrole'), 'role', array('id'));
<a name="l1964"><span class="linenum">1964</span></a>  
<a name="l1965"><span class="linenum">1965</span></a>  <span class="comment">        // Conditionally launch create table for 'badge_manual_award'.</span>
<a name="l1966"><span class="linenum">1966</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l1967"><span class="linenum">1967</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l1968"><span class="linenum">1968</span></a>          }
<a name="l1969"><span class="linenum">1969</span></a>  
<a name="l1970"><span class="linenum">1970</span></a>  <span class="comment">        // Define table 'badge_backpack' to be created.</span>
<a name="l1971"><span class="linenum">1971</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('badge_backpack');
<a name="l1972"><span class="linenum">1972</span></a>  
<a name="l1973"><span class="linenum">1973</span></a>  <span class="comment">        // Adding fields to table 'badge_backpack'.</span>
<a name="l1974"><span class="linenum">1974</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null, null);
<a name="l1975"><span class="linenum">1975</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('userid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'id');
<a name="l1976"><span class="linenum">1976</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('email', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '100', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'userid');
<a name="l1977"><span class="linenum">1977</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('backpackurl', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'email');
<a name="l1978"><span class="linenum">1978</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('backpackuid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'backpackurl');
<a name="l1979"><span class="linenum">1979</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('backpackgid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'backpackuid');
<a name="l1980"><span class="linenum">1980</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('autosync', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '1', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'backpackgid');
<a name="l1981"><span class="linenum">1981</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('password', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '50', null, null, null, null, 'autosync');
<a name="l1982"><span class="linenum">1982</span></a>  
<a name="l1983"><span class="linenum">1983</span></a>  <span class="comment">        // Adding keys to table 'badge_backpack'.</span>
<a name="l1984"><span class="linenum">1984</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l1985"><span class="linenum">1985</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('fk_userid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('userid'), 'user', array('id'));
<a name="l1986"><span class="linenum">1986</span></a>  
<a name="l1987"><span class="linenum">1987</span></a>  <span class="comment">        // Conditionally launch create table for 'badge_backpack'.</span>
<a name="l1988"><span class="linenum">1988</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l1989"><span class="linenum">1989</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l1990"><span class="linenum">1990</span></a>          }
<a name="l1991"><span class="linenum">1991</span></a>  
<a name="l1992"><span class="linenum">1992</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l1993"><span class="linenum">1993</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013040200.00);
<a name="l1994"><span class="linenum">1994</span></a>      }
<a name="l1995"><span class="linenum">1995</span></a>  
<a name="l1996"><span class="linenum">1996</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013040201.00) {
<a name="l1997"><span class="linenum">1997</span></a>  <span class="comment">        // Convert name field in event table to text type as RFC-2445 doesn't have any limitation on it.</span>
<a name="l1998"><span class="linenum">1998</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('event');
<a name="l1999"><span class="linenum">1999</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('name', <a class="constant" onClick="logConstant('XMLDB_TYPE_TEXT')" href="../../_constants/XMLDB_TYPE_TEXT.html" onMouseOver="constPopup(event,'XMLDB_TYPE_TEXT')">XMLDB_TYPE_TEXT</a>, null, null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l2000"><span class="linenum">2000</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l2001"><span class="linenum">2001</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('change_field_type')" href="../../_functions/change_field_type.html" onMouseOver="funcPopup(event,'change_field_type')">change_field_type</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2002"><span class="linenum">2002</span></a>          }
<a name="l2003"><span class="linenum">2003</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2004"><span class="linenum">2004</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013040201.00);
<a name="l2005"><span class="linenum">2005</span></a>      }
<a name="l2006"><span class="linenum">2006</span></a>  
<a name="l2007"><span class="linenum">2007</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013040300.01) {
<a name="l2008"><span class="linenum">2008</span></a>  
<a name="l2009"><span class="linenum">2009</span></a>  <span class="comment">        // Define field completionstartonenrol to be dropped from course.</span>
<a name="l2010"><span class="linenum">2010</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course');
<a name="l2011"><span class="linenum">2011</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('completionstartonenrol');
<a name="l2012"><span class="linenum">2012</span></a>  
<a name="l2013"><span class="linenum">2013</span></a>  <span class="comment">        // Conditionally launch drop field completionstartonenrol.</span>
<a name="l2014"><span class="linenum">2014</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l2015"><span class="linenum">2015</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2016"><span class="linenum">2016</span></a>          }
<a name="l2017"><span class="linenum">2017</span></a>  
<a name="l2018"><span class="linenum">2018</span></a>  <span class="comment">        // Since structure of 'course' table has changed we need to re-read $SITE from DB.</span>
<a name="l2019"><span class="linenum">2019</span></a>          <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id' =&gt; <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a>-&gt;<a onClick="logVariable('id')" class="var it39635" onMouseOver="hilite(39635)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l2020"><span class="linenum">2020</span></a>          <a class="var it2554" onMouseOver="hilite(2554)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../_variables/COURSE.html">$COURSE</a> = <a class="function" onClick="logFunction('clone')" href="../../_functions/clone.html" onMouseOver="funcPopup(event,'clone')">clone</a>(<a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a>);
<a name="l2021"><span class="linenum">2021</span></a>  
<a name="l2022"><span class="linenum">2022</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2023"><span class="linenum">2023</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013040300.01);
<a name="l2024"><span class="linenum">2024</span></a>      }
<a name="l2025"><span class="linenum">2025</span></a>  
<a name="l2026"><span class="linenum">2026</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013041200.00) {
<a name="l2027"><span class="linenum">2027</span></a>  <span class="comment">        // MDL-29877 Some bad restores created grade items with no category information.</span>
<a name="l2028"><span class="linenum">2028</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;UPDATE {grade_items}
<a name="l2029"><span class="linenum">2029</span></a>                     SET categoryid = courseid
<a name="l2030"><span class="linenum">2030</span></a>                   WHERE itemtype &lt;&gt; 'course' and itemtype &lt;&gt; 'category'
<a name="l2031"><span class="linenum">2031</span></a>                         AND categoryid IS NULL&quot;;
<a name="l2032"><span class="linenum">2032</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l2033"><span class="linenum">2033</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013041200.00);
<a name="l2034"><span class="linenum">2034</span></a>      }
<a name="l2035"><span class="linenum">2035</span></a>  
<a name="l2036"><span class="linenum">2036</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013041600.00) {
<a name="l2037"><span class="linenum">2037</span></a>  <span class="comment">        // Copy constants from /course/lib.php instead of including the whole library:</span>
<a name="l2038"><span class="linenum">2038</span></a>          <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('c')" href="../../_variables/c.html">$c</a> = array( '<a class="constant" onClick="logConstant('FRONTPAGENEWS')" href="../../_constants/FRONTPAGENEWS.html" onMouseOver="constPopup(event,'FRONTPAGENEWS')">FRONTPAGENEWS</a>'                 =&gt; 0,
<a name="l2039"><span class="linenum">2039</span></a>                      'FRONTPAGECOURSELIST'           =&gt; 1,
<a name="l2040"><span class="linenum">2040</span></a>                      '<a class="constant" onClick="logConstant('FRONTPAGECATEGORYNAMES')" href="../../_constants/FRONTPAGECATEGORYNAMES.html" onMouseOver="constPopup(event,'FRONTPAGECATEGORYNAMES')">FRONTPAGECATEGORYNAMES</a>'        =&gt; 2,
<a name="l2041"><span class="linenum">2041</span></a>                      'FRONTPAGETOPICONLY'            =&gt; 3,
<a name="l2042"><span class="linenum">2042</span></a>                      '<a class="constant" onClick="logConstant('FRONTPAGECATEGORYCOMBO')" href="../../_constants/FRONTPAGECATEGORYCOMBO.html" onMouseOver="constPopup(event,'FRONTPAGECATEGORYCOMBO')">FRONTPAGECATEGORYCOMBO</a>'        =&gt; 4,
<a name="l2043"><span class="linenum">2043</span></a>                      '<a class="constant" onClick="logConstant('FRONTPAGEENROLLEDCOURSELIST')" href="../../_constants/FRONTPAGEENROLLEDCOURSELIST.html" onMouseOver="constPopup(event,'FRONTPAGEENROLLEDCOURSELIST')">FRONTPAGEENROLLEDCOURSELIST</a>'   =&gt; 5,
<a name="l2044"><span class="linenum">2044</span></a>                      '<a class="constant" onClick="logConstant('FRONTPAGEALLCOURSELIST')" href="../../_constants/FRONTPAGEALLCOURSELIST.html" onMouseOver="constPopup(event,'FRONTPAGEALLCOURSELIST')">FRONTPAGEALLCOURSELIST</a>'        =&gt; 6,
<a name="l2045"><span class="linenum">2045</span></a>                      '<a class="constant" onClick="logConstant('FRONTPAGECOURSESEARCH')" href="../../_constants/FRONTPAGECOURSESEARCH.html" onMouseOver="constPopup(event,'FRONTPAGECOURSESEARCH')">FRONTPAGECOURSESEARCH</a>'         =&gt; 7);
<a name="l2046"><span class="linenum">2046</span></a>  <span class="comment">        // Update frontpage settings $CFG-&gt;frontpage and $CFG-&gt;frontpageloggedin. In 2.4 there was too much of hidden logic about them.</span>
<a name="l2047"><span class="linenum">2047</span></a>  <span class="comment">        // This script tries to make sure that with the new (more user-friendly) frontpage settings the frontpage looks as similar as possible to what it was before upgrade.</span>
<a name="l2048"><span class="linenum">2048</span></a>          <a class="var it4336" onMouseOver="hilite(4336)" onMouseOut="lolite()" onClick="logVariable('ncourses')" href="../../_variables/ncourses.html">$ncourses</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records')" href="../../_functions/count_records.html" onMouseOver="funcPopup(event,'count_records')">count_records</a>('course');
<a name="l2049"><span class="linenum">2049</span></a>          foreach (array('frontpage', 'frontpageloggedin') as <a class="var it37332" onMouseOver="hilite(37332)" onMouseOut="lolite()" onClick="logVariable('configkey')" href="../../_variables/configkey.html">$configkey</a>) {
<a name="l2050"><span class="linenum">2050</span></a>              if (<a class="var it6473" onMouseOver="hilite(6473)" onMouseOut="lolite()" onClick="logVariable('frontpage')" href="../../_variables/frontpage.html">$frontpage</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;{<a class="var it37332" onMouseOver="hilite(37332)" onMouseOut="lolite()" onClick="logVariable('configkey')" href="../../_variables/configkey.html">$configkey</a>})) {
<a name="l2051"><span class="linenum">2051</span></a>                  <a class="var it37333" onMouseOver="hilite(37333)" onMouseOut="lolite()" onClick="logVariable('newfrontpage')" href="../../_variables/newfrontpage.html">$newfrontpage</a> = array();
<a name="l2052"><span class="linenum">2052</span></a>                  foreach (<a class="var it6473" onMouseOver="hilite(6473)" onMouseOut="lolite()" onClick="logVariable('frontpage')" href="../../_variables/frontpage.html">$frontpage</a> as <a class="var it44" onMouseOver="hilite(44)" onMouseOut="lolite()" onClick="logVariable('v')" href="../../_variables/v.html">$v</a>) {
<a name="l2053"><span class="linenum">2053</span></a>                      switch (<a class="var it44" onMouseOver="hilite(44)" onMouseOut="lolite()" onClick="logVariable('v')" href="../../_variables/v.html">$v</a>) {
<a name="l2054"><span class="linenum">2054</span></a>                          case <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('c')" href="../../_variables/c.html">$c</a>['<a class="constant" onClick="logConstant('FRONTPAGENEWS')" href="../../_constants/FRONTPAGENEWS.html" onMouseOver="constPopup(event,'FRONTPAGENEWS')">FRONTPAGENEWS</a>']:
<a name="l2055"><span class="linenum">2055</span></a>  <span class="comment">                            // Not related to course listings, leave as it is.</span>
<a name="l2056"><span class="linenum">2056</span></a>                              <a class="var it37333" onMouseOver="hilite(37333)" onMouseOut="lolite()" onClick="logVariable('newfrontpage')" href="../../_variables/newfrontpage.html">$newfrontpage</a>[] = <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('c')" href="../../_variables/c.html">$c</a>['<a class="constant" onClick="logConstant('FRONTPAGENEWS')" href="../../_constants/FRONTPAGENEWS.html" onMouseOver="constPopup(event,'FRONTPAGENEWS')">FRONTPAGENEWS</a>'];
<a name="l2057"><span class="linenum">2057</span></a>                              break;
<a name="l2058"><span class="linenum">2058</span></a>                          case <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('c')" href="../../_variables/c.html">$c</a>['FRONTPAGECOURSELIST']:
<a name="l2059"><span class="linenum">2059</span></a>                              if (<a class="var it37332" onMouseOver="hilite(37332)" onMouseOut="lolite()" onClick="logVariable('configkey')" href="../../_variables/configkey.html">$configkey</a> === 'frontpageloggedin' &amp;&amp; empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('disablemycourses')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/disablemycourses.html">disablemycourses</a>)) {
<a name="l2060"><span class="linenum">2060</span></a>  <span class="comment">                                // In 2.4 unless prohibited in config, the &quot;list of courses&quot; was considered &quot;list of enrolled courses&quot; plus course search box.</span>
<a name="l2061"><span class="linenum">2061</span></a>                                  <a class="var it37333" onMouseOver="hilite(37333)" onMouseOut="lolite()" onClick="logVariable('newfrontpage')" href="../../_variables/newfrontpage.html">$newfrontpage</a>[] = <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('c')" href="../../_variables/c.html">$c</a>['<a class="constant" onClick="logConstant('FRONTPAGEENROLLEDCOURSELIST')" href="../../_constants/FRONTPAGEENROLLEDCOURSELIST.html" onMouseOver="constPopup(event,'FRONTPAGEENROLLEDCOURSELIST')">FRONTPAGEENROLLEDCOURSELIST</a>'];
<a name="l2062"><span class="linenum">2062</span></a>                              } else if (<a class="var it4336" onMouseOver="hilite(4336)" onMouseOut="lolite()" onClick="logVariable('ncourses')" href="../../_variables/ncourses.html">$ncourses</a> &lt;= 200) {
<a name="l2063"><span class="linenum">2063</span></a>  <span class="comment">                                // Still list of courses was only displayed in there were less than 200 courses in system. Otherwise - search box only.</span>
<a name="l2064"><span class="linenum">2064</span></a>                                  <a class="var it37333" onMouseOver="hilite(37333)" onMouseOut="lolite()" onClick="logVariable('newfrontpage')" href="../../_variables/newfrontpage.html">$newfrontpage</a>[] = <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('c')" href="../../_variables/c.html">$c</a>['<a class="constant" onClick="logConstant('FRONTPAGEALLCOURSELIST')" href="../../_constants/FRONTPAGEALLCOURSELIST.html" onMouseOver="constPopup(event,'FRONTPAGEALLCOURSELIST')">FRONTPAGEALLCOURSELIST</a>'];
<a name="l2065"><span class="linenum">2065</span></a>                                  break; <span class="comment">// skip adding search box</span>
<a name="l2066"><span class="linenum">2066</span></a>                              }
<a name="l2067"><span class="linenum">2067</span></a>                              if (!<a class="phpfunction" onClick="logFunction('in_array')" href="../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('c')" href="../../_variables/c.html">$c</a>['<a class="constant" onClick="logConstant('FRONTPAGECOURSESEARCH')" href="../../_constants/FRONTPAGECOURSESEARCH.html" onMouseOver="constPopup(event,'FRONTPAGECOURSESEARCH')">FRONTPAGECOURSESEARCH</a>'], <a class="var it37333" onMouseOver="hilite(37333)" onMouseOut="lolite()" onClick="logVariable('newfrontpage')" href="../../_variables/newfrontpage.html">$newfrontpage</a>)) {
<a name="l2068"><span class="linenum">2068</span></a>                                  <a class="var it37333" onMouseOver="hilite(37333)" onMouseOut="lolite()" onClick="logVariable('newfrontpage')" href="../../_variables/newfrontpage.html">$newfrontpage</a>[] = <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('c')" href="../../_variables/c.html">$c</a>['<a class="constant" onClick="logConstant('FRONTPAGECOURSESEARCH')" href="../../_constants/FRONTPAGECOURSESEARCH.html" onMouseOver="constPopup(event,'FRONTPAGECOURSESEARCH')">FRONTPAGECOURSESEARCH</a>'];
<a name="l2069"><span class="linenum">2069</span></a>                              }
<a name="l2070"><span class="linenum">2070</span></a>                              break;
<a name="l2071"><span class="linenum">2071</span></a>                          case <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('c')" href="../../_variables/c.html">$c</a>['<a class="constant" onClick="logConstant('FRONTPAGECATEGORYNAMES')" href="../../_constants/FRONTPAGECATEGORYNAMES.html" onMouseOver="constPopup(event,'FRONTPAGECATEGORYNAMES')">FRONTPAGECATEGORYNAMES</a>']:
<a name="l2072"><span class="linenum">2072</span></a>  <span class="comment">                            // In 2.4 search box was displayed automatically after categories list. In 2.5 it is displayed as a separate setting.</span>
<a name="l2073"><span class="linenum">2073</span></a>                              <a class="var it37333" onMouseOver="hilite(37333)" onMouseOut="lolite()" onClick="logVariable('newfrontpage')" href="../../_variables/newfrontpage.html">$newfrontpage</a>[] = <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('c')" href="../../_variables/c.html">$c</a>['<a class="constant" onClick="logConstant('FRONTPAGECATEGORYNAMES')" href="../../_constants/FRONTPAGECATEGORYNAMES.html" onMouseOver="constPopup(event,'FRONTPAGECATEGORYNAMES')">FRONTPAGECATEGORYNAMES</a>'];
<a name="l2074"><span class="linenum">2074</span></a>                              if (!<a class="phpfunction" onClick="logFunction('in_array')" href="../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('c')" href="../../_variables/c.html">$c</a>['<a class="constant" onClick="logConstant('FRONTPAGECOURSESEARCH')" href="../../_constants/FRONTPAGECOURSESEARCH.html" onMouseOver="constPopup(event,'FRONTPAGECOURSESEARCH')">FRONTPAGECOURSESEARCH</a>'], <a class="var it37333" onMouseOver="hilite(37333)" onMouseOut="lolite()" onClick="logVariable('newfrontpage')" href="../../_variables/newfrontpage.html">$newfrontpage</a>)) {
<a name="l2075"><span class="linenum">2075</span></a>                                  <a class="var it37333" onMouseOver="hilite(37333)" onMouseOut="lolite()" onClick="logVariable('newfrontpage')" href="../../_variables/newfrontpage.html">$newfrontpage</a>[] = <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('c')" href="../../_variables/c.html">$c</a>['<a class="constant" onClick="logConstant('FRONTPAGECOURSESEARCH')" href="../../_constants/FRONTPAGECOURSESEARCH.html" onMouseOver="constPopup(event,'FRONTPAGECOURSESEARCH')">FRONTPAGECOURSESEARCH</a>'];
<a name="l2076"><span class="linenum">2076</span></a>                              }
<a name="l2077"><span class="linenum">2077</span></a>                              break;
<a name="l2078"><span class="linenum">2078</span></a>                          case <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('c')" href="../../_variables/c.html">$c</a>['<a class="constant" onClick="logConstant('FRONTPAGECATEGORYCOMBO')" href="../../_constants/FRONTPAGECATEGORYCOMBO.html" onMouseOver="constPopup(event,'FRONTPAGECATEGORYCOMBO')">FRONTPAGECATEGORYCOMBO</a>']:
<a name="l2079"><span class="linenum">2079</span></a>                              <a class="var it37334" onMouseOver="hilite(37334)" onMouseOut="lolite()" onClick="logVariable('maxcourses')" href="../../_variables/maxcourses.html">$maxcourses</a> = empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('numcoursesincombo')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/numcoursesincombo.html">numcoursesincombo</a>) ? 500 : <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('numcoursesincombo')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/numcoursesincombo.html">numcoursesincombo</a>;
<a name="l2080"><span class="linenum">2080</span></a>  <span class="comment">                            // In 2.4 combo list was not displayed if there are more than $CFG-&gt;numcoursesincombo courses in the system.</span>
<a name="l2081"><span class="linenum">2081</span></a>                              if (<a class="var it4336" onMouseOver="hilite(4336)" onMouseOut="lolite()" onClick="logVariable('ncourses')" href="../../_variables/ncourses.html">$ncourses</a> &lt; <a class="var it37334" onMouseOver="hilite(37334)" onMouseOut="lolite()" onClick="logVariable('maxcourses')" href="../../_variables/maxcourses.html">$maxcourses</a>) {
<a name="l2082"><span class="linenum">2082</span></a>                                  <a class="var it37333" onMouseOver="hilite(37333)" onMouseOut="lolite()" onClick="logVariable('newfrontpage')" href="../../_variables/newfrontpage.html">$newfrontpage</a>[] = <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('c')" href="../../_variables/c.html">$c</a>['<a class="constant" onClick="logConstant('FRONTPAGECATEGORYCOMBO')" href="../../_constants/FRONTPAGECATEGORYCOMBO.html" onMouseOver="constPopup(event,'FRONTPAGECATEGORYCOMBO')">FRONTPAGECATEGORYCOMBO</a>'];
<a name="l2083"><span class="linenum">2083</span></a>                              }
<a name="l2084"><span class="linenum">2084</span></a>                              if (!<a class="phpfunction" onClick="logFunction('in_array')" href="../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('c')" href="../../_variables/c.html">$c</a>['<a class="constant" onClick="logConstant('FRONTPAGECOURSESEARCH')" href="../../_constants/FRONTPAGECOURSESEARCH.html" onMouseOver="constPopup(event,'FRONTPAGECOURSESEARCH')">FRONTPAGECOURSESEARCH</a>'], <a class="var it37333" onMouseOver="hilite(37333)" onMouseOut="lolite()" onClick="logVariable('newfrontpage')" href="../../_variables/newfrontpage.html">$newfrontpage</a>)) {
<a name="l2085"><span class="linenum">2085</span></a>                                  <a class="var it37333" onMouseOver="hilite(37333)" onMouseOut="lolite()" onClick="logVariable('newfrontpage')" href="../../_variables/newfrontpage.html">$newfrontpage</a>[] = <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('c')" href="../../_variables/c.html">$c</a>['<a class="constant" onClick="logConstant('FRONTPAGECOURSESEARCH')" href="../../_constants/FRONTPAGECOURSESEARCH.html" onMouseOver="constPopup(event,'FRONTPAGECOURSESEARCH')">FRONTPAGECOURSESEARCH</a>'];
<a name="l2086"><span class="linenum">2086</span></a>                              }
<a name="l2087"><span class="linenum">2087</span></a>                              break;
<a name="l2088"><span class="linenum">2088</span></a>                      }
<a name="l2089"><span class="linenum">2089</span></a>                  }
<a name="l2090"><span class="linenum">2090</span></a>                  <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>(<a class="var it37332" onMouseOver="hilite(37332)" onMouseOut="lolite()" onClick="logVariable('configkey')" href="../../_variables/configkey.html">$configkey</a>, <a class="function" onClick="logFunction('join')" href="../../_functions/join.html" onMouseOver="funcPopup(event,'join')">join</a>(',', <a class="var it37333" onMouseOver="hilite(37333)" onMouseOut="lolite()" onClick="logVariable('newfrontpage')" href="../../_variables/newfrontpage.html">$newfrontpage</a>));
<a name="l2091"><span class="linenum">2091</span></a>              }
<a name="l2092"><span class="linenum">2092</span></a>          }
<a name="l2093"><span class="linenum">2093</span></a>  <span class="comment">        // $CFG-&gt;numcoursesincombo no longer affects whether the combo list is displayed. Setting is deprecated.</span>
<a name="l2094"><span class="linenum">2094</span></a>          <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('numcoursesincombo');
<a name="l2095"><span class="linenum">2095</span></a>  
<a name="l2096"><span class="linenum">2096</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013041600.00);
<a name="l2097"><span class="linenum">2097</span></a>      }
<a name="l2098"><span class="linenum">2098</span></a>  
<a name="l2099"><span class="linenum">2099</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013041601.00) {
<a name="l2100"><span class="linenum">2100</span></a>  <span class="comment">        // Create a new 'badge_external' table first.</span>
<a name="l2101"><span class="linenum">2101</span></a>  <span class="comment">        // Define table 'badge_external' to be created.</span>
<a name="l2102"><span class="linenum">2102</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('badge_external');
<a name="l2103"><span class="linenum">2103</span></a>  
<a name="l2104"><span class="linenum">2104</span></a>  <span class="comment">        // Adding fields to table 'badge_external'.</span>
<a name="l2105"><span class="linenum">2105</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null, null);
<a name="l2106"><span class="linenum">2106</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('backpackid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'id');
<a name="l2107"><span class="linenum">2107</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('collectionid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'backpackid');
<a name="l2108"><span class="linenum">2108</span></a>  
<a name="l2109"><span class="linenum">2109</span></a>  <span class="comment">        // Adding keys to table 'badge_external'.</span>
<a name="l2110"><span class="linenum">2110</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l2111"><span class="linenum">2111</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('fk_backpackid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('backpackid'), 'badge_backpack', array('id'));
<a name="l2112"><span class="linenum">2112</span></a>  
<a name="l2113"><span class="linenum">2113</span></a>  <span class="comment">        // Conditionally launch create table for 'badge_external'.</span>
<a name="l2114"><span class="linenum">2114</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l2115"><span class="linenum">2115</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l2116"><span class="linenum">2116</span></a>          }
<a name="l2117"><span class="linenum">2117</span></a>  
<a name="l2118"><span class="linenum">2118</span></a>  <span class="comment">        // Perform user data migration.</span>
<a name="l2119"><span class="linenum">2119</span></a>          <a class="var it37336" onMouseOver="hilite(37336)" onMouseOut="lolite()" onClick="logVariable('usercollections')" href="../../_variables/usercollections.html">$usercollections</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('badge_backpack');
<a name="l2120"><span class="linenum">2120</span></a>          foreach (<a class="var it37336" onMouseOver="hilite(37336)" onMouseOut="lolite()" onClick="logVariable('usercollections')" href="../../_variables/usercollections.html">$usercollections</a> as <a class="var it37337" onMouseOver="hilite(37337)" onMouseOut="lolite()" onClick="logVariable('usercollection')" href="../../_variables/usercollection.html">$usercollection</a>) {
<a name="l2121"><span class="linenum">2121</span></a>              <a class="var it6413" onMouseOver="hilite(6413)" onMouseOut="lolite()" onClick="logVariable('collection')" href="../../_variables/collection.html">$collection</a> = new stdClass();
<a name="l2122"><span class="linenum">2122</span></a>              <a class="var it6413" onMouseOver="hilite(6413)" onMouseOut="lolite()" onClick="logVariable('collection')" href="../../_variables/collection.html">$collection</a>-&gt;<a onClick="logVariable('backpackid')" class="var it41003" onMouseOver="hilite(41003)" onMouseOut="lolite()" href="../../_variables/backpackid.html">backpackid</a> = <a class="var it37337" onMouseOver="hilite(37337)" onMouseOut="lolite()" onClick="logVariable('usercollection')" href="../../_variables/usercollection.html">$usercollection</a>-&gt;<a onClick="logVariable('id')" class="var it41669" onMouseOver="hilite(41669)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l2123"><span class="linenum">2123</span></a>              <a class="var it6413" onMouseOver="hilite(6413)" onMouseOut="lolite()" onClick="logVariable('collection')" href="../../_variables/collection.html">$collection</a>-&gt;<a onClick="logVariable('collectionid')" class="var it41003" onMouseOver="hilite(41003)" onMouseOut="lolite()" href="../../_variables/collectionid.html">collectionid</a> = <a class="var it37337" onMouseOver="hilite(37337)" onMouseOut="lolite()" onClick="logVariable('usercollection')" href="../../_variables/usercollection.html">$usercollection</a>-&gt;<a onClick="logVariable('backpackgid')" class="var it41669" onMouseOver="hilite(41669)" onMouseOut="lolite()" href="../../_variables/backpackgid.html">backpackgid</a>;
<a name="l2124"><span class="linenum">2124</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('badge_external', <a class="var it6413" onMouseOver="hilite(6413)" onMouseOut="lolite()" onClick="logVariable('collection')" href="../../_variables/collection.html">$collection</a>);
<a name="l2125"><span class="linenum">2125</span></a>          }
<a name="l2126"><span class="linenum">2126</span></a>  
<a name="l2127"><span class="linenum">2127</span></a>  <span class="comment">        // Finally, drop the column.</span>
<a name="l2128"><span class="linenum">2128</span></a>  <span class="comment">        // Define field backpackgid to be dropped from 'badge_backpack'.</span>
<a name="l2129"><span class="linenum">2129</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('badge_backpack');
<a name="l2130"><span class="linenum">2130</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('backpackgid');
<a name="l2131"><span class="linenum">2131</span></a>  
<a name="l2132"><span class="linenum">2132</span></a>  <span class="comment">        // Conditionally launch drop field backpackgid.</span>
<a name="l2133"><span class="linenum">2133</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l2134"><span class="linenum">2134</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2135"><span class="linenum">2135</span></a>          }
<a name="l2136"><span class="linenum">2136</span></a>  
<a name="l2137"><span class="linenum">2137</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2138"><span class="linenum">2138</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013041601.00);
<a name="l2139"><span class="linenum">2139</span></a>      }
<a name="l2140"><span class="linenum">2140</span></a>  
<a name="l2141"><span class="linenum">2141</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013041601.01) {
<a name="l2142"><span class="linenum">2142</span></a>  <span class="comment">        // Changing the default of field descriptionformat on table user to 1.</span>
<a name="l2143"><span class="linenum">2143</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('user');
<a name="l2144"><span class="linenum">2144</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('descriptionformat', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '2', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '1', 'description');
<a name="l2145"><span class="linenum">2145</span></a>  
<a name="l2146"><span class="linenum">2146</span></a>  <span class="comment">        // Launch change of default for field descriptionformat.</span>
<a name="l2147"><span class="linenum">2147</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('change_field_default')" href="../../_functions/change_field_default.html" onMouseOver="funcPopup(event,'change_field_default')">change_field_default</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2148"><span class="linenum">2148</span></a>  
<a name="l2149"><span class="linenum">2149</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2150"><span class="linenum">2150</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013041601.01);
<a name="l2151"><span class="linenum">2151</span></a>      }
<a name="l2152"><span class="linenum">2152</span></a>  
<a name="l2153"><span class="linenum">2153</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013041900.00) {
<a name="l2154"><span class="linenum">2154</span></a>          require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a> . '<a class="filename" href="../../cache/locallib.php.html">/cache/locallib.php</a>');
<a name="l2155"><span class="linenum">2155</span></a>  <span class="comment">        // The features bin needs updating.</span>
<a name="l2156"><span class="linenum">2156</span></a>          <a class="class" onClick="logClass('cache_config_writer')" href="../../_classes/cache_config_writer.html" onMouseOver="classPopup(event,'cache_config_writer')">cache_config_writer</a>::<a class="function" onClick="logFunction('update_default_config_stores')" href="../../_functions/update_default_config_stores.html" onMouseOver="funcPopup(event,'update_default_config_stores')">update_default_config_stores</a>();
<a name="l2157"><span class="linenum">2157</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2158"><span class="linenum">2158</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013041900.00);
<a name="l2159"><span class="linenum">2159</span></a>      }
<a name="l2160"><span class="linenum">2160</span></a>  
<a name="l2161"><span class="linenum">2161</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013042300.00) {
<a name="l2162"><span class="linenum">2162</span></a>  <span class="comment">        // Adding index to unreadmessageid field of message_working table (MDL-34933)</span>
<a name="l2163"><span class="linenum">2163</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('message_working');
<a name="l2164"><span class="linenum">2164</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('unreadmessageid_idx', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('unreadmessageid'));
<a name="l2165"><span class="linenum">2165</span></a>  
<a name="l2166"><span class="linenum">2166</span></a>  <span class="comment">        // Conditionally launch add index unreadmessageid</span>
<a name="l2167"><span class="linenum">2167</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l2168"><span class="linenum">2168</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l2169"><span class="linenum">2169</span></a>          }
<a name="l2170"><span class="linenum">2170</span></a>  
<a name="l2171"><span class="linenum">2171</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2172"><span class="linenum">2172</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013042300.00);
<a name="l2173"><span class="linenum">2173</span></a>      }
<a name="l2174"><span class="linenum">2174</span></a>  
<a name="l2175"><span class="linenum">2175</span></a>  <span class="comment">    // Moodle v2.5.0 release upgrade line.</span>
<a name="l2176"><span class="linenum">2176</span></a>  <span class="comment">    // Put any upgrade step following this.</span>
<a name="l2177"><span class="linenum">2177</span></a>  
<a name="l2178"><span class="linenum">2178</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013051400.01) {
<a name="l2179"><span class="linenum">2179</span></a>  <span class="comment">        // Fix incorrect cc-nc url. Unfortunately the license 'plugins' do</span>
<a name="l2180"><span class="linenum">2180</span></a>  <span class="comment">        // not give a mechanism to do this.</span>
<a name="l2181"><span class="linenum">2181</span></a>  
<a name="l2182"><span class="linenum">2182</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;UPDATE {license}
<a name="l2183"><span class="linenum">2183</span></a>                     SET source = :url, version = :newversion
<a name="l2184"><span class="linenum">2184</span></a>                   WHERE shortname = :shortname AND version = :oldversion&quot;;
<a name="l2185"><span class="linenum">2185</span></a>  
<a name="l2186"><span class="linenum">2186</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(
<a name="l2187"><span class="linenum">2187</span></a>              'url' =&gt; 'http://creativecommons.org/licenses/by-nc/3.0/',
<a name="l2188"><span class="linenum">2188</span></a>              'shortname' =&gt; 'cc-nc',
<a name="l2189"><span class="linenum">2189</span></a>              'newversion' =&gt; '2013051500',
<a name="l2190"><span class="linenum">2190</span></a>              'oldversion' =&gt; '2010033100'
<a name="l2191"><span class="linenum">2191</span></a>          );
<a name="l2192"><span class="linenum">2192</span></a>  
<a name="l2193"><span class="linenum">2193</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l2194"><span class="linenum">2194</span></a>  
<a name="l2195"><span class="linenum">2195</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2196"><span class="linenum">2196</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013051400.01);
<a name="l2197"><span class="linenum">2197</span></a>      }
<a name="l2198"><span class="linenum">2198</span></a>  
<a name="l2199"><span class="linenum">2199</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013061400.01) {
<a name="l2200"><span class="linenum">2200</span></a>  <span class="comment">        // Clean up old tokens which haven't been deleted.</span>
<a name="l2201"><span class="linenum">2201</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(&quot;DELETE FROM {user_private_key} WHERE NOT EXISTS
<a name="l2202"><span class="linenum">2202</span></a>                           (SELECT 'x' FROM {user} WHERE deleted = 0 AND id = userid)&quot;);
<a name="l2203"><span class="linenum">2203</span></a>  
<a name="l2204"><span class="linenum">2204</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2205"><span class="linenum">2205</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013061400.01);
<a name="l2206"><span class="linenum">2206</span></a>      }
<a name="l2207"><span class="linenum">2207</span></a>  
<a name="l2208"><span class="linenum">2208</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013061700.00) {
<a name="l2209"><span class="linenum">2209</span></a>  <span class="comment">        // MDL-40103: Remove unused template tables from the database.</span>
<a name="l2210"><span class="linenum">2210</span></a>  <span class="comment">        // These are now created inline with xmldb_table.</span>
<a name="l2211"><span class="linenum">2211</span></a>  
<a name="l2212"><span class="linenum">2212</span></a>          <a class="var it37339" onMouseOver="hilite(37339)" onMouseOut="lolite()" onClick="logVariable('tablestocleanup')" href="../../_variables/tablestocleanup.html">$tablestocleanup</a> = array('temp_enroled_template','temp_log_template','backup_files_template','backup_ids_template');
<a name="l2213"><span class="linenum">2213</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_manager')" href="../../_functions/get_manager.html" onMouseOver="funcPopup(event,'get_manager')">get_manager</a>();
<a name="l2214"><span class="linenum">2214</span></a>  
<a name="l2215"><span class="linenum">2215</span></a>          foreach (<a class="var it37339" onMouseOver="hilite(37339)" onMouseOut="lolite()" onClick="logVariable('tablestocleanup')" href="../../_variables/tablestocleanup.html">$tablestocleanup</a> as <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>) {
<a name="l2216"><span class="linenum">2216</span></a>              <a class="var it14806" onMouseOver="hilite(14806)" onMouseOut="lolite()" onClick="logVariable('xmltable')" href="../../_variables/xmltable.html">$xmltable</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l2217"><span class="linenum">2217</span></a>              if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it14806" onMouseOver="hilite(14806)" onMouseOut="lolite()" onClick="logVariable('xmltable')" href="../../_variables/xmltable.html">$xmltable</a>)) {
<a name="l2218"><span class="linenum">2218</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_table')" href="../../_functions/drop_table.html" onMouseOver="funcPopup(event,'drop_table')">drop_table</a>(<a class="var it14806" onMouseOver="hilite(14806)" onMouseOut="lolite()" onClick="logVariable('xmltable')" href="../../_variables/xmltable.html">$xmltable</a>);
<a name="l2219"><span class="linenum">2219</span></a>              }
<a name="l2220"><span class="linenum">2220</span></a>          }
<a name="l2221"><span class="linenum">2221</span></a>  
<a name="l2222"><span class="linenum">2222</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2223"><span class="linenum">2223</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013061700.00);
<a name="l2224"><span class="linenum">2224</span></a>      }
<a name="l2225"><span class="linenum">2225</span></a>  
<a name="l2226"><span class="linenum">2226</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013070800.00) {
<a name="l2227"><span class="linenum">2227</span></a>  
<a name="l2228"><span class="linenum">2228</span></a>  <span class="comment">        // Remove orphan repository instances.</span>
<a name="l2229"><span class="linenum">2229</span></a>          if (<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_dbfamily')" href="../../_functions/get_dbfamily.html" onMouseOver="funcPopup(event,'get_dbfamily')">get_dbfamily</a>() === 'mysql') {
<a name="l2230"><span class="linenum">2230</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;DELETE {repository_instances} FROM {repository_instances}
<a name="l2231"><span class="linenum">2231</span></a>                      LEFT JOIN {context} ON {context}.id = {repository_instances}.contextid
<a name="l2232"><span class="linenum">2232</span></a>                      WHERE {context}.id IS NULL&quot;;
<a name="l2233"><span class="linenum">2233</span></a>          } else {
<a name="l2234"><span class="linenum">2234</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;DELETE FROM {repository_instances}
<a name="l2235"><span class="linenum">2235</span></a>                      WHERE NOT <a class="function" onClick="logFunction('EXISTS')" href="../../_functions/exists.html" onMouseOver="funcPopup(event,'exists')">EXISTS</a> (
<a name="l2236"><span class="linenum">2236</span></a>                          SELECT 'x' FROM {context}
<a name="l2237"><span class="linenum">2237</span></a>                          WHERE {context}.id = {repository_instances}.contextid)&quot;;
<a name="l2238"><span class="linenum">2238</span></a>          }
<a name="l2239"><span class="linenum">2239</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l2240"><span class="linenum">2240</span></a>  
<a name="l2241"><span class="linenum">2241</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2242"><span class="linenum">2242</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013070800.00);
<a name="l2243"><span class="linenum">2243</span></a>      }
<a name="l2244"><span class="linenum">2244</span></a>  
<a name="l2245"><span class="linenum">2245</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013070800.01) {
<a name="l2246"><span class="linenum">2246</span></a>  
<a name="l2247"><span class="linenum">2247</span></a>  <span class="comment">        // Define field lastnamephonetic to be added to user.</span>
<a name="l2248"><span class="linenum">2248</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('user');
<a name="l2249"><span class="linenum">2249</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('lastnamephonetic', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, null, null, null, 'imagealt');
<a name="l2250"><span class="linenum">2250</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('lastnamephonetic', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('lastnamephonetic'));
<a name="l2251"><span class="linenum">2251</span></a>  
<a name="l2252"><span class="linenum">2252</span></a>  <span class="comment">        // Conditionally launch add field lastnamephonetic.</span>
<a name="l2253"><span class="linenum">2253</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l2254"><span class="linenum">2254</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2255"><span class="linenum">2255</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l2256"><span class="linenum">2256</span></a>          }
<a name="l2257"><span class="linenum">2257</span></a>  
<a name="l2258"><span class="linenum">2258</span></a>  <span class="comment">        // Define field firstnamephonetic to be added to user.</span>
<a name="l2259"><span class="linenum">2259</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('user');
<a name="l2260"><span class="linenum">2260</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('firstnamephonetic', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, null, null, null, 'lastnamephonetic');
<a name="l2261"><span class="linenum">2261</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('firstnamephonetic', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('firstnamephonetic'));
<a name="l2262"><span class="linenum">2262</span></a>  
<a name="l2263"><span class="linenum">2263</span></a>  <span class="comment">        // Conditionally launch add field firstnamephonetic.</span>
<a name="l2264"><span class="linenum">2264</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l2265"><span class="linenum">2265</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2266"><span class="linenum">2266</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l2267"><span class="linenum">2267</span></a>          }
<a name="l2268"><span class="linenum">2268</span></a>  
<a name="l2269"><span class="linenum">2269</span></a>  <span class="comment">        // Define field alternatename to be added to user.</span>
<a name="l2270"><span class="linenum">2270</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('user');
<a name="l2271"><span class="linenum">2271</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('middlename', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, null, null, null, 'firstnamephonetic');
<a name="l2272"><span class="linenum">2272</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('middlename', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('middlename'));
<a name="l2273"><span class="linenum">2273</span></a>  
<a name="l2274"><span class="linenum">2274</span></a>  <span class="comment">        // Conditionally launch add field firstnamephonetic.</span>
<a name="l2275"><span class="linenum">2275</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l2276"><span class="linenum">2276</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2277"><span class="linenum">2277</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l2278"><span class="linenum">2278</span></a>          }
<a name="l2279"><span class="linenum">2279</span></a>  
<a name="l2280"><span class="linenum">2280</span></a>  <span class="comment">        // Define field alternatename to be added to user.</span>
<a name="l2281"><span class="linenum">2281</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('user');
<a name="l2282"><span class="linenum">2282</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('alternatename', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, null, null, null, 'middlename');
<a name="l2283"><span class="linenum">2283</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('alternatename', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('alternatename'));
<a name="l2284"><span class="linenum">2284</span></a>  
<a name="l2285"><span class="linenum">2285</span></a>  <span class="comment">        // Conditionally launch add field alternatename.</span>
<a name="l2286"><span class="linenum">2286</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l2287"><span class="linenum">2287</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2288"><span class="linenum">2288</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l2289"><span class="linenum">2289</span></a>          }
<a name="l2290"><span class="linenum">2290</span></a>  
<a name="l2291"><span class="linenum">2291</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2292"><span class="linenum">2292</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013070800.01);
<a name="l2293"><span class="linenum">2293</span></a>      }
<a name="l2294"><span class="linenum">2294</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013071500.01) {
<a name="l2295"><span class="linenum">2295</span></a>  <span class="comment">        // The enrol_authorize plugin has been removed, if there are no records</span>
<a name="l2296"><span class="linenum">2296</span></a>  <span class="comment">        // and no plugin files then remove the plugin data.</span>
<a name="l2297"><span class="linenum">2297</span></a>          <a class="var it37340" onMouseOver="hilite(37340)" onMouseOut="lolite()" onClick="logVariable('enrolauthorize')" href="../../_variables/enrolauthorize.html">$enrolauthorize</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('enrol_authorize');
<a name="l2298"><span class="linenum">2298</span></a>          <a class="var it37341" onMouseOver="hilite(37341)" onMouseOut="lolite()" onClick="logVariable('enrolauthorizerefunds')" href="../../_variables/enrolauthorizerefunds.html">$enrolauthorizerefunds</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('enrol_authorize_refunds');
<a name="l2299"><span class="linenum">2299</span></a>  
<a name="l2300"><span class="linenum">2300</span></a>          if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>.'/enrol/authorize/version.php') &amp;&amp;
<a name="l2301"><span class="linenum">2301</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it37340" onMouseOver="hilite(37340)" onMouseOut="lolite()" onClick="logVariable('enrolauthorize')" href="../../_variables/enrolauthorize.html">$enrolauthorize</a>) &amp;&amp;
<a name="l2302"><span class="linenum">2302</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it37341" onMouseOver="hilite(37341)" onMouseOut="lolite()" onClick="logVariable('enrolauthorizerefunds')" href="../../_variables/enrolauthorizerefunds.html">$enrolauthorizerefunds</a>)) {
<a name="l2303"><span class="linenum">2303</span></a>  
<a name="l2304"><span class="linenum">2304</span></a>              <a class="var it37342" onMouseOver="hilite(37342)" onMouseOut="lolite()" onClick="logVariable('enrolauthorizecount')" href="../../_variables/enrolauthorizecount.html">$enrolauthorizecount</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records')" href="../../_functions/count_records.html" onMouseOver="funcPopup(event,'count_records')">count_records</a>('enrol_authorize');
<a name="l2305"><span class="linenum">2305</span></a>              <a class="var it37343" onMouseOver="hilite(37343)" onMouseOut="lolite()" onClick="logVariable('enrolauthorizerefundcount')" href="../../_variables/enrolauthorizerefundcount.html">$enrolauthorizerefundcount</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records')" href="../../_functions/count_records.html" onMouseOver="funcPopup(event,'count_records')">count_records</a>('enrol_authorize_refunds');
<a name="l2306"><span class="linenum">2306</span></a>  
<a name="l2307"><span class="linenum">2307</span></a>              if (empty(<a class="var it37342" onMouseOver="hilite(37342)" onMouseOut="lolite()" onClick="logVariable('enrolauthorizecount')" href="../../_variables/enrolauthorizecount.html">$enrolauthorizecount</a>) &amp;&amp; empty(<a class="var it37343" onMouseOver="hilite(37343)" onMouseOut="lolite()" onClick="logVariable('enrolauthorizerefundcount')" href="../../_variables/enrolauthorizerefundcount.html">$enrolauthorizerefundcount</a>)) {
<a name="l2308"><span class="linenum">2308</span></a>  
<a name="l2309"><span class="linenum">2309</span></a>  <span class="comment">                // Drop the database tables.</span>
<a name="l2310"><span class="linenum">2310</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_table')" href="../../_functions/drop_table.html" onMouseOver="funcPopup(event,'drop_table')">drop_table</a>(<a class="var it37340" onMouseOver="hilite(37340)" onMouseOut="lolite()" onClick="logVariable('enrolauthorize')" href="../../_variables/enrolauthorize.html">$enrolauthorize</a>);
<a name="l2311"><span class="linenum">2311</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_table')" href="../../_functions/drop_table.html" onMouseOver="funcPopup(event,'drop_table')">drop_table</a>(<a class="var it37341" onMouseOver="hilite(37341)" onMouseOut="lolite()" onClick="logVariable('enrolauthorizerefunds')" href="../../_variables/enrolauthorizerefunds.html">$enrolauthorizerefunds</a>);
<a name="l2312"><span class="linenum">2312</span></a>  
<a name="l2313"><span class="linenum">2313</span></a>  <span class="comment">                // Drop the message provider and associated data manually.</span>
<a name="l2314"><span class="linenum">2314</span></a>                  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('message_providers', array('component' =&gt; 'enrol_authorize'));
<a name="l2315"><span class="linenum">2315</span></a>                  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('config_plugins', &quot;plugin = 'message' AND &quot;.<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_like')" href="../../_functions/sql_like.html" onMouseOver="funcPopup(event,'sql_like')">sql_like</a>('name', '?', false), array(&quot;%_provider_enrol_authorize_%&quot;));
<a name="l2316"><span class="linenum">2316</span></a>                  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records_select')" href="../../_functions/delete_records_select.html" onMouseOver="funcPopup(event,'delete_records_select')">delete_records_select</a>('user_preferences', <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_like')" href="../../_functions/sql_like.html" onMouseOver="funcPopup(event,'sql_like')">sql_like</a>('name', '?', false), array(&quot;message_provider_enrol_authorize_%&quot;));
<a name="l2317"><span class="linenum">2317</span></a>  
<a name="l2318"><span class="linenum">2318</span></a>  <span class="comment">                // Remove capabilities.</span>
<a name="l2319"><span class="linenum">2319</span></a>                  <a class="function" onClick="logFunction('capabilities_cleanup')" href="../../_functions/capabilities_cleanup.html" onMouseOver="funcPopup(event,'capabilities_cleanup')">capabilities_cleanup</a>('enrol_authorize');
<a name="l2320"><span class="linenum">2320</span></a>  
<a name="l2321"><span class="linenum">2321</span></a>  <span class="comment">                // Remove all other associated config.</span>
<a name="l2322"><span class="linenum">2322</span></a>                  <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('enrol_authorize');
<a name="l2323"><span class="linenum">2323</span></a>              }
<a name="l2324"><span class="linenum">2324</span></a>          }
<a name="l2325"><span class="linenum">2325</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013071500.01);
<a name="l2326"><span class="linenum">2326</span></a>      }
<a name="l2327"><span class="linenum">2327</span></a>  
<a name="l2328"><span class="linenum">2328</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013071500.02) {
<a name="l2329"><span class="linenum">2329</span></a>  <span class="comment">        // Define field attachment to be dropped from badge.</span>
<a name="l2330"><span class="linenum">2330</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('badge');
<a name="l2331"><span class="linenum">2331</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('image');
<a name="l2332"><span class="linenum">2332</span></a>  
<a name="l2333"><span class="linenum">2333</span></a>  <span class="comment">        // Conditionally launch drop field eventtype.</span>
<a name="l2334"><span class="linenum">2334</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l2335"><span class="linenum">2335</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2336"><span class="linenum">2336</span></a>          }
<a name="l2337"><span class="linenum">2337</span></a>  
<a name="l2338"><span class="linenum">2338</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013071500.02);
<a name="l2339"><span class="linenum">2339</span></a>      }
<a name="l2340"><span class="linenum">2340</span></a>  
<a name="l2341"><span class="linenum">2341</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013072600.01) {
<a name="l2342"><span class="linenum">2342</span></a>          <a class="function" onClick="logFunction('upgrade_mssql_nvarcharmax')" href="../../_functions/upgrade_mssql_nvarcharmax.html" onMouseOver="funcPopup(event,'upgrade_mssql_nvarcharmax')">upgrade_mssql_nvarcharmax</a>();
<a name="l2343"><span class="linenum">2343</span></a>          <a class="function" onClick="logFunction('upgrade_mssql_varbinarymax')" href="../../_functions/upgrade_mssql_varbinarymax.html" onMouseOver="funcPopup(event,'upgrade_mssql_varbinarymax')">upgrade_mssql_varbinarymax</a>();
<a name="l2344"><span class="linenum">2344</span></a>  
<a name="l2345"><span class="linenum">2345</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013072600.01);
<a name="l2346"><span class="linenum">2346</span></a>      }
<a name="l2347"><span class="linenum">2347</span></a>  
<a name="l2348"><span class="linenum">2348</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013081200.00) {
<a name="l2349"><span class="linenum">2349</span></a>  <span class="comment">        // Define field uploadfiles to be added to external_services.</span>
<a name="l2350"><span class="linenum">2350</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('external_services');
<a name="l2351"><span class="linenum">2351</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('uploadfiles', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '1', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'downloadfiles');
<a name="l2352"><span class="linenum">2352</span></a>  
<a name="l2353"><span class="linenum">2353</span></a>  <span class="comment">        // Conditionally launch add field uploadfiles.</span>
<a name="l2354"><span class="linenum">2354</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l2355"><span class="linenum">2355</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2356"><span class="linenum">2356</span></a>          }
<a name="l2357"><span class="linenum">2357</span></a>  
<a name="l2358"><span class="linenum">2358</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2359"><span class="linenum">2359</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013081200.00);
<a name="l2360"><span class="linenum">2360</span></a>      }
<a name="l2361"><span class="linenum">2361</span></a>  
<a name="l2362"><span class="linenum">2362</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013082300.01) {
<a name="l2363"><span class="linenum">2363</span></a>  <span class="comment">        // Define the table 'backup_logs' and the field 'message' which we will be changing from a char to a text field.</span>
<a name="l2364"><span class="linenum">2364</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('backup_logs');
<a name="l2365"><span class="linenum">2365</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('message', <a class="constant" onClick="logConstant('XMLDB_TYPE_TEXT')" href="../../_constants/XMLDB_TYPE_TEXT.html" onMouseOver="constPopup(event,'XMLDB_TYPE_TEXT')">XMLDB_TYPE_TEXT</a>, null, null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'loglevel');
<a name="l2366"><span class="linenum">2366</span></a>  
<a name="l2367"><span class="linenum">2367</span></a>  <span class="comment">        // Perform the change.</span>
<a name="l2368"><span class="linenum">2368</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('change_field_type')" href="../../_functions/change_field_type.html" onMouseOver="funcPopup(event,'change_field_type')">change_field_type</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2369"><span class="linenum">2369</span></a>  
<a name="l2370"><span class="linenum">2370</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2371"><span class="linenum">2371</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013082300.01);
<a name="l2372"><span class="linenum">2372</span></a>      }
<a name="l2373"><span class="linenum">2373</span></a>  
<a name="l2374"><span class="linenum">2374</span></a>  <span class="comment">    // Convert SCORM course format courses to singleactivity.</span>
<a name="l2375"><span class="linenum">2375</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013082700.00) {
<a name="l2376"><span class="linenum">2376</span></a>  <span class="comment">        // First set relevant singleactivity settings.</span>
<a name="l2377"><span class="linenum">2377</span></a>          <a class="var it6026" onMouseOver="hilite(6026)" onMouseOut="lolite()" onClick="logVariable('formatoptions')" href="../../_variables/formatoptions.html">$formatoptions</a> = new stdClass();
<a name="l2378"><span class="linenum">2378</span></a>          <a class="var it6026" onMouseOver="hilite(6026)" onMouseOut="lolite()" onClick="logVariable('formatoptions')" href="../../_variables/formatoptions.html">$formatoptions</a>-&gt;<a onClick="logVariable('format')" class="var it39710" onMouseOver="hilite(39710)" onMouseOut="lolite()" href="../../_variables/format.html">format</a> = 'singleactivity';
<a name="l2379"><span class="linenum">2379</span></a>          <a class="var it6026" onMouseOver="hilite(6026)" onMouseOut="lolite()" onClick="logVariable('formatoptions')" href="../../_variables/formatoptions.html">$formatoptions</a>-&gt;<a onClick="logVariable('sectionid')" class="var it39710" onMouseOver="hilite(39710)" onMouseOut="lolite()" href="../../_variables/sectionid.html">sectionid</a> = 0;
<a name="l2380"><span class="linenum">2380</span></a>          <a class="var it6026" onMouseOver="hilite(6026)" onMouseOut="lolite()" onClick="logVariable('formatoptions')" href="../../_variables/formatoptions.html">$formatoptions</a>-&gt;<a onClick="logVariable('name')" class="var it39710" onMouseOver="hilite(39710)" onMouseOut="lolite()" href="../../_variables/name.html">name</a> = 'activitytype';
<a name="l2381"><span class="linenum">2381</span></a>          <a class="var it6026" onMouseOver="hilite(6026)" onMouseOut="lolite()" onClick="logVariable('formatoptions')" href="../../_variables/formatoptions.html">$formatoptions</a>-&gt;<a onClick="logVariable('value')" class="var it39710" onMouseOver="hilite(39710)" onMouseOut="lolite()" href="../../_variables/value.html">value</a> = 'scorm';
<a name="l2382"><span class="linenum">2382</span></a>  
<a name="l2383"><span class="linenum">2383</span></a>          <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset')" href="../../_functions/get_recordset.html" onMouseOver="funcPopup(event,'get_recordset')">get_recordset</a>('course', array('format' =&gt; 'scorm'), 'id');
<a name="l2384"><span class="linenum">2384</span></a>          foreach (<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> as <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) {
<a name="l2385"><span class="linenum">2385</span></a>              <a class="var it6026" onMouseOver="hilite(6026)" onMouseOut="lolite()" onClick="logVariable('formatoptions')" href="../../_variables/formatoptions.html">$formatoptions</a>-&gt;<a onClick="logVariable('courseid')" class="var it39710" onMouseOver="hilite(39710)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a> = <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l2386"><span class="linenum">2386</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('course_format_options', <a class="var it6026" onMouseOver="hilite(6026)" onMouseOut="lolite()" onClick="logVariable('formatoptions')" href="../../_variables/formatoptions.html">$formatoptions</a>);
<a name="l2387"><span class="linenum">2387</span></a>          }
<a name="l2388"><span class="linenum">2388</span></a>          <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l2389"><span class="linenum">2389</span></a>  
<a name="l2390"><span class="linenum">2390</span></a>  <span class="comment">        // Now update course format for these courses.</span>
<a name="l2391"><span class="linenum">2391</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;UPDATE {course}
<a name="l2392"><span class="linenum">2392</span></a>                     SET format = 'singleactivity', modinfo = '', sectioncache = ''
<a name="l2393"><span class="linenum">2393</span></a>                   WHERE format = 'scorm'&quot;;
<a name="l2394"><span class="linenum">2394</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l2395"><span class="linenum">2395</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013082700.00);
<a name="l2396"><span class="linenum">2396</span></a>      }
<a name="l2397"><span class="linenum">2397</span></a>  
<a name="l2398"><span class="linenum">2398</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013090500.01) {
<a name="l2399"><span class="linenum">2399</span></a>  <span class="comment">        // Define field calendartype to be added to course.</span>
<a name="l2400"><span class="linenum">2400</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course');
<a name="l2401"><span class="linenum">2401</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('calendartype', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '30', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l2402"><span class="linenum">2402</span></a>  
<a name="l2403"><span class="linenum">2403</span></a>  <span class="comment">        // Conditionally launch add field calendartype.</span>
<a name="l2404"><span class="linenum">2404</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l2405"><span class="linenum">2405</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2406"><span class="linenum">2406</span></a>          }
<a name="l2407"><span class="linenum">2407</span></a>  
<a name="l2408"><span class="linenum">2408</span></a>  <span class="comment">        // Since structure of 'course' table has changed we need to re-read $SITE from DB.</span>
<a name="l2409"><span class="linenum">2409</span></a>          <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id' =&gt; <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a>-&gt;<a onClick="logVariable('id')" class="var it39635" onMouseOver="hilite(39635)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l2410"><span class="linenum">2410</span></a>          <a class="var it2554" onMouseOver="hilite(2554)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../_variables/COURSE.html">$COURSE</a> = <a class="function" onClick="logFunction('clone')" href="../../_functions/clone.html" onMouseOver="funcPopup(event,'clone')">clone</a>(<a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a>);
<a name="l2411"><span class="linenum">2411</span></a>  
<a name="l2412"><span class="linenum">2412</span></a>  <span class="comment">        // Define field calendartype to be added to user.</span>
<a name="l2413"><span class="linenum">2413</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('user');
<a name="l2414"><span class="linenum">2414</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('calendartype', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '30', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, 'gregorian');
<a name="l2415"><span class="linenum">2415</span></a>  
<a name="l2416"><span class="linenum">2416</span></a>  <span class="comment">        // Conditionally launch add field calendartype.</span>
<a name="l2417"><span class="linenum">2417</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l2418"><span class="linenum">2418</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2419"><span class="linenum">2419</span></a>          }
<a name="l2420"><span class="linenum">2420</span></a>  
<a name="l2421"><span class="linenum">2421</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2422"><span class="linenum">2422</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013090500.01);
<a name="l2423"><span class="linenum">2423</span></a>      }
<a name="l2424"><span class="linenum">2424</span></a>  
<a name="l2425"><span class="linenum">2425</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013091000.02) {
<a name="l2426"><span class="linenum">2426</span></a>  
<a name="l2427"><span class="linenum">2427</span></a>  <span class="comment">        // Define field cacherev to be added to course.</span>
<a name="l2428"><span class="linenum">2428</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course');
<a name="l2429"><span class="linenum">2429</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('cacherev', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'completionnotify');
<a name="l2430"><span class="linenum">2430</span></a>  
<a name="l2431"><span class="linenum">2431</span></a>  <span class="comment">        // Conditionally launch add field cacherev.</span>
<a name="l2432"><span class="linenum">2432</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l2433"><span class="linenum">2433</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2434"><span class="linenum">2434</span></a>          }
<a name="l2435"><span class="linenum">2435</span></a>  
<a name="l2436"><span class="linenum">2436</span></a>  <span class="comment">        // Since structure of 'course' table has changed we need to re-read $SITE from DB.</span>
<a name="l2437"><span class="linenum">2437</span></a>          <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id' =&gt; <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a>-&gt;<a onClick="logVariable('id')" class="var it39635" onMouseOver="hilite(39635)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l2438"><span class="linenum">2438</span></a>          <a class="var it2554" onMouseOver="hilite(2554)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../_variables/COURSE.html">$COURSE</a> = <a class="function" onClick="logFunction('clone')" href="../../_functions/clone.html" onMouseOver="funcPopup(event,'clone')">clone</a>(<a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a>);
<a name="l2439"><span class="linenum">2439</span></a>  
<a name="l2440"><span class="linenum">2440</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2441"><span class="linenum">2441</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013091000.02);
<a name="l2442"><span class="linenum">2442</span></a>      }
<a name="l2443"><span class="linenum">2443</span></a>  
<a name="l2444"><span class="linenum">2444</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013091000.03) {
<a name="l2445"><span class="linenum">2445</span></a>  
<a name="l2446"><span class="linenum">2446</span></a>  <span class="comment">        // Define field modinfo to be dropped from course.</span>
<a name="l2447"><span class="linenum">2447</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course');
<a name="l2448"><span class="linenum">2448</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('modinfo');
<a name="l2449"><span class="linenum">2449</span></a>  
<a name="l2450"><span class="linenum">2450</span></a>  <span class="comment">        // Conditionally launch drop field modinfo.</span>
<a name="l2451"><span class="linenum">2451</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l2452"><span class="linenum">2452</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2453"><span class="linenum">2453</span></a>          }
<a name="l2454"><span class="linenum">2454</span></a>  
<a name="l2455"><span class="linenum">2455</span></a>  <span class="comment">        // Define field sectioncache to be dropped from course.</span>
<a name="l2456"><span class="linenum">2456</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('sectioncache');
<a name="l2457"><span class="linenum">2457</span></a>  
<a name="l2458"><span class="linenum">2458</span></a>  <span class="comment">        // Conditionally launch drop field sectioncache.</span>
<a name="l2459"><span class="linenum">2459</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l2460"><span class="linenum">2460</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2461"><span class="linenum">2461</span></a>          }
<a name="l2462"><span class="linenum">2462</span></a>  
<a name="l2463"><span class="linenum">2463</span></a>  <span class="comment">        // Since structure of 'course' table has changed we need to re-read $SITE from DB.</span>
<a name="l2464"><span class="linenum">2464</span></a>          <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id' =&gt; <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a>-&gt;<a onClick="logVariable('id')" class="var it39635" onMouseOver="hilite(39635)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l2465"><span class="linenum">2465</span></a>          <a class="var it2554" onMouseOver="hilite(2554)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../_variables/COURSE.html">$COURSE</a> = <a class="function" onClick="logFunction('clone')" href="../../_functions/clone.html" onMouseOver="funcPopup(event,'clone')">clone</a>(<a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../../_variables/SITE.html">$SITE</a>);
<a name="l2466"><span class="linenum">2466</span></a>  
<a name="l2467"><span class="linenum">2467</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2468"><span class="linenum">2468</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013091000.03);
<a name="l2469"><span class="linenum">2469</span></a>      }
<a name="l2470"><span class="linenum">2470</span></a>  
<a name="l2471"><span class="linenum">2471</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013091300.01) {
<a name="l2472"><span class="linenum">2472</span></a>  
<a name="l2473"><span class="linenum">2473</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('user');
<a name="l2474"><span class="linenum">2474</span></a>  
<a name="l2475"><span class="linenum">2475</span></a>  <span class="comment">        // Changing precision of field institution on table user to (255).</span>
<a name="l2476"><span class="linenum">2476</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('institution', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'phone2');
<a name="l2477"><span class="linenum">2477</span></a>  
<a name="l2478"><span class="linenum">2478</span></a>  <span class="comment">        // Launch change of precision for field institution.</span>
<a name="l2479"><span class="linenum">2479</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('change_field_precision')" href="../../_functions/change_field_precision.html" onMouseOver="funcPopup(event,'change_field_precision')">change_field_precision</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2480"><span class="linenum">2480</span></a>  
<a name="l2481"><span class="linenum">2481</span></a>  <span class="comment">        // Changing precision of field department on table user to (255).</span>
<a name="l2482"><span class="linenum">2482</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('department', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'institution');
<a name="l2483"><span class="linenum">2483</span></a>  
<a name="l2484"><span class="linenum">2484</span></a>  <span class="comment">        // Launch change of precision for field department.</span>
<a name="l2485"><span class="linenum">2485</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('change_field_precision')" href="../../_functions/change_field_precision.html" onMouseOver="funcPopup(event,'change_field_precision')">change_field_precision</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2486"><span class="linenum">2486</span></a>  
<a name="l2487"><span class="linenum">2487</span></a>  <span class="comment">        // Changing precision of field address on table user to (255).</span>
<a name="l2488"><span class="linenum">2488</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('address', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'department');
<a name="l2489"><span class="linenum">2489</span></a>  
<a name="l2490"><span class="linenum">2490</span></a>  <span class="comment">        // Launch change of precision for field address.</span>
<a name="l2491"><span class="linenum">2491</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('change_field_precision')" href="../../_functions/change_field_precision.html" onMouseOver="funcPopup(event,'change_field_precision')">change_field_precision</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2492"><span class="linenum">2492</span></a>  
<a name="l2493"><span class="linenum">2493</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2494"><span class="linenum">2494</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013091300.01);
<a name="l2495"><span class="linenum">2495</span></a>      }
<a name="l2496"><span class="linenum">2496</span></a>  
<a name="l2497"><span class="linenum">2497</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013092000.01) {
<a name="l2498"><span class="linenum">2498</span></a>  
<a name="l2499"><span class="linenum">2499</span></a>  <span class="comment">        // Define table question_statistics to be created.</span>
<a name="l2500"><span class="linenum">2500</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('question_statistics');
<a name="l2501"><span class="linenum">2501</span></a>  
<a name="l2502"><span class="linenum">2502</span></a>  <span class="comment">        // Adding fields to table question_statistics.</span>
<a name="l2503"><span class="linenum">2503</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null);
<a name="l2504"><span class="linenum">2504</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('hashcode', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '40', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l2505"><span class="linenum">2505</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('timemodified', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l2506"><span class="linenum">2506</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('questionid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l2507"><span class="linenum">2507</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('slot', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null);
<a name="l2508"><span class="linenum">2508</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('subquestion', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '4', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l2509"><span class="linenum">2509</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('s', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0');
<a name="l2510"><span class="linenum">2510</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('effectiveweight', <a class="constant" onClick="logConstant('XMLDB_TYPE_NUMBER')" href="../../_constants/XMLDB_TYPE_NUMBER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_NUMBER')">XMLDB_TYPE_NUMBER</a>, '15, 5', null, null, null, null);
<a name="l2511"><span class="linenum">2511</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('negcovar', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '2', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0');
<a name="l2512"><span class="linenum">2512</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('discriminationindex', <a class="constant" onClick="logConstant('XMLDB_TYPE_NUMBER')" href="../../_constants/XMLDB_TYPE_NUMBER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_NUMBER')">XMLDB_TYPE_NUMBER</a>, '15, 5', null, null, null, null);
<a name="l2513"><span class="linenum">2513</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('discriminativeefficiency', <a class="constant" onClick="logConstant('XMLDB_TYPE_NUMBER')" href="../../_constants/XMLDB_TYPE_NUMBER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_NUMBER')">XMLDB_TYPE_NUMBER</a>, '15, 5', null, null, null, null);
<a name="l2514"><span class="linenum">2514</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('sd', <a class="constant" onClick="logConstant('XMLDB_TYPE_NUMBER')" href="../../_constants/XMLDB_TYPE_NUMBER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_NUMBER')">XMLDB_TYPE_NUMBER</a>, '15, 10', null, null, null, null);
<a name="l2515"><span class="linenum">2515</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('facility', <a class="constant" onClick="logConstant('XMLDB_TYPE_NUMBER')" href="../../_constants/XMLDB_TYPE_NUMBER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_NUMBER')">XMLDB_TYPE_NUMBER</a>, '15, 10', null, null, null, null);
<a name="l2516"><span class="linenum">2516</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('subquestions', <a class="constant" onClick="logConstant('XMLDB_TYPE_TEXT')" href="../../_constants/XMLDB_TYPE_TEXT.html" onMouseOver="constPopup(event,'XMLDB_TYPE_TEXT')">XMLDB_TYPE_TEXT</a>, null, null, null, null, null);
<a name="l2517"><span class="linenum">2517</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('maxmark', <a class="constant" onClick="logConstant('XMLDB_TYPE_NUMBER')" href="../../_constants/XMLDB_TYPE_NUMBER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_NUMBER')">XMLDB_TYPE_NUMBER</a>, '12, 7', null, null, null, null);
<a name="l2518"><span class="linenum">2518</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('positions', <a class="constant" onClick="logConstant('XMLDB_TYPE_TEXT')" href="../../_constants/XMLDB_TYPE_TEXT.html" onMouseOver="constPopup(event,'XMLDB_TYPE_TEXT')">XMLDB_TYPE_TEXT</a>, null, null, null, null, null);
<a name="l2519"><span class="linenum">2519</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('randomguessscore', <a class="constant" onClick="logConstant('XMLDB_TYPE_NUMBER')" href="../../_constants/XMLDB_TYPE_NUMBER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_NUMBER')">XMLDB_TYPE_NUMBER</a>, '12, 7', null, null, null, null);
<a name="l2520"><span class="linenum">2520</span></a>  
<a name="l2521"><span class="linenum">2521</span></a>  <span class="comment">        // Adding keys to table question_statistics.</span>
<a name="l2522"><span class="linenum">2522</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l2523"><span class="linenum">2523</span></a>  
<a name="l2524"><span class="linenum">2524</span></a>  <span class="comment">        // Conditionally launch create table for question_statistics.</span>
<a name="l2525"><span class="linenum">2525</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l2526"><span class="linenum">2526</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l2527"><span class="linenum">2527</span></a>          }
<a name="l2528"><span class="linenum">2528</span></a>  
<a name="l2529"><span class="linenum">2529</span></a>  <span class="comment">        // Define table question_response_analysis to be created.</span>
<a name="l2530"><span class="linenum">2530</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('question_response_analysis');
<a name="l2531"><span class="linenum">2531</span></a>  
<a name="l2532"><span class="linenum">2532</span></a>  <span class="comment">        // Adding fields to table question_response_analysis.</span>
<a name="l2533"><span class="linenum">2533</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null);
<a name="l2534"><span class="linenum">2534</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('hashcode', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '40', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l2535"><span class="linenum">2535</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('timemodified', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l2536"><span class="linenum">2536</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('questionid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l2537"><span class="linenum">2537</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('subqid', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '100', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l2538"><span class="linenum">2538</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('aid', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '100', null, null, null, null);
<a name="l2539"><span class="linenum">2539</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('response', <a class="constant" onClick="logConstant('XMLDB_TYPE_TEXT')" href="../../_constants/XMLDB_TYPE_TEXT.html" onMouseOver="constPopup(event,'XMLDB_TYPE_TEXT')">XMLDB_TYPE_TEXT</a>, null, null, null, null, null);
<a name="l2540"><span class="linenum">2540</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('rcount', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null);
<a name="l2541"><span class="linenum">2541</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('credit', <a class="constant" onClick="logConstant('XMLDB_TYPE_NUMBER')" href="../../_constants/XMLDB_TYPE_NUMBER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_NUMBER')">XMLDB_TYPE_NUMBER</a>, '15, 5', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l2542"><span class="linenum">2542</span></a>  
<a name="l2543"><span class="linenum">2543</span></a>  <span class="comment">        // Adding keys to table question_response_analysis.</span>
<a name="l2544"><span class="linenum">2544</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l2545"><span class="linenum">2545</span></a>  
<a name="l2546"><span class="linenum">2546</span></a>  <span class="comment">        // Conditionally launch create table for question_response_analysis.</span>
<a name="l2547"><span class="linenum">2547</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l2548"><span class="linenum">2548</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l2549"><span class="linenum">2549</span></a>          }
<a name="l2550"><span class="linenum">2550</span></a>  
<a name="l2551"><span class="linenum">2551</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2552"><span class="linenum">2552</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013092000.01);
<a name="l2553"><span class="linenum">2553</span></a>      }
<a name="l2554"><span class="linenum">2554</span></a>  
<a name="l2555"><span class="linenum">2555</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013092001.01) {
<a name="l2556"><span class="linenum">2556</span></a>  <span class="comment">        // Force uninstall of deleted tool.</span>
<a name="l2557"><span class="linenum">2557</span></a>          if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(&quot;<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>/<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('admin')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/admin.html">admin</a>/tool/bloglevelupgrade&quot;)) {
<a name="l2558"><span class="linenum">2558</span></a>  <span class="comment">            // Remove capabilities.</span>
<a name="l2559"><span class="linenum">2559</span></a>              <a class="function" onClick="logFunction('capabilities_cleanup')" href="../../_functions/capabilities_cleanup.html" onMouseOver="funcPopup(event,'capabilities_cleanup')">capabilities_cleanup</a>('tool_bloglevelupgrade');
<a name="l2560"><span class="linenum">2560</span></a>  <span class="comment">            // Remove all other associated config.</span>
<a name="l2561"><span class="linenum">2561</span></a>              <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('tool_bloglevelupgrade');
<a name="l2562"><span class="linenum">2562</span></a>          }
<a name="l2563"><span class="linenum">2563</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013092001.01);
<a name="l2564"><span class="linenum">2564</span></a>      }
<a name="l2565"><span class="linenum">2565</span></a>  
<a name="l2566"><span class="linenum">2566</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013092001.02) {
<a name="l2567"><span class="linenum">2567</span></a>  <span class="comment">        // Define field version to be dropped from modules.</span>
<a name="l2568"><span class="linenum">2568</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('modules');
<a name="l2569"><span class="linenum">2569</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('version');
<a name="l2570"><span class="linenum">2570</span></a>  
<a name="l2571"><span class="linenum">2571</span></a>  <span class="comment">        // Conditionally launch drop field version.</span>
<a name="l2572"><span class="linenum">2572</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l2573"><span class="linenum">2573</span></a>  <span class="comment">            // Migrate all plugin version info to config_plugins table.</span>
<a name="l2574"><span class="linenum">2574</span></a>              <a class="var it610" onMouseOver="hilite(610)" onMouseOut="lolite()" onClick="logVariable('modules')" href="../../_variables/modules.html">$modules</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('modules');
<a name="l2575"><span class="linenum">2575</span></a>              foreach (<a class="var it610" onMouseOver="hilite(610)" onMouseOut="lolite()" onClick="logVariable('modules')" href="../../_variables/modules.html">$modules</a> as <a class="var it611" onMouseOver="hilite(611)" onMouseOut="lolite()" onClick="logVariable('module')" href="../../_variables/module.html">$module</a>) {
<a name="l2576"><span class="linenum">2576</span></a>                  <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('version', <a class="var it611" onMouseOver="hilite(611)" onMouseOut="lolite()" onClick="logVariable('module')" href="../../_variables/module.html">$module</a>-&gt;<a onClick="logVariable('version')" class="var it39455" onMouseOver="hilite(39455)" onMouseOut="lolite()" href="../../_variables/version.html">version</a>, 'mod_'.<a class="var it611" onMouseOver="hilite(611)" onMouseOut="lolite()" onClick="logVariable('module')" href="../../_variables/module.html">$module</a>-&gt;<a onClick="logVariable('name')" class="var it39455" onMouseOver="hilite(39455)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>);
<a name="l2577"><span class="linenum">2577</span></a>              }
<a name="l2578"><span class="linenum">2578</span></a>              unset(<a class="var it610" onMouseOver="hilite(610)" onMouseOut="lolite()" onClick="logVariable('modules')" href="../../_variables/modules.html">$modules</a>);
<a name="l2579"><span class="linenum">2579</span></a>  
<a name="l2580"><span class="linenum">2580</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2581"><span class="linenum">2581</span></a>          }
<a name="l2582"><span class="linenum">2582</span></a>  
<a name="l2583"><span class="linenum">2583</span></a>  <span class="comment">        // Define field version to be dropped from block.</span>
<a name="l2584"><span class="linenum">2584</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('block');
<a name="l2585"><span class="linenum">2585</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('version');
<a name="l2586"><span class="linenum">2586</span></a>  
<a name="l2587"><span class="linenum">2587</span></a>  <span class="comment">        // Conditionally launch drop field version.</span>
<a name="l2588"><span class="linenum">2588</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l2589"><span class="linenum">2589</span></a>              <a class="var it1264" onMouseOver="hilite(1264)" onMouseOut="lolite()" onClick="logVariable('blocks')" href="../../_variables/blocks.html">$blocks</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('block');
<a name="l2590"><span class="linenum">2590</span></a>              foreach (<a class="var it1264" onMouseOver="hilite(1264)" onMouseOut="lolite()" onClick="logVariable('blocks')" href="../../_variables/blocks.html">$blocks</a> as <a class="var it286" onMouseOver="hilite(286)" onMouseOut="lolite()" onClick="logVariable('block')" href="../../_variables/block.html">$block</a>) {
<a name="l2591"><span class="linenum">2591</span></a>                  <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('version', <a class="var it286" onMouseOver="hilite(286)" onMouseOut="lolite()" onClick="logVariable('block')" href="../../_variables/block.html">$block</a>-&gt;<a onClick="logVariable('version')" class="var it39742" onMouseOver="hilite(39742)" onMouseOut="lolite()" href="../../_variables/version.html">version</a>, 'block_'.<a class="var it286" onMouseOver="hilite(286)" onMouseOut="lolite()" onClick="logVariable('block')" href="../../_variables/block.html">$block</a>-&gt;<a onClick="logVariable('name')" class="var it39742" onMouseOver="hilite(39742)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>);
<a name="l2592"><span class="linenum">2592</span></a>              }
<a name="l2593"><span class="linenum">2593</span></a>              unset(<a class="var it1264" onMouseOver="hilite(1264)" onMouseOut="lolite()" onClick="logVariable('blocks')" href="../../_variables/blocks.html">$blocks</a>);
<a name="l2594"><span class="linenum">2594</span></a>  
<a name="l2595"><span class="linenum">2595</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2596"><span class="linenum">2596</span></a>          }
<a name="l2597"><span class="linenum">2597</span></a>  
<a name="l2598"><span class="linenum">2598</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2599"><span class="linenum">2599</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013092001.02);
<a name="l2600"><span class="linenum">2600</span></a>      }
<a name="l2601"><span class="linenum">2601</span></a>  
<a name="l2602"><span class="linenum">2602</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013092700.01) {
<a name="l2603"><span class="linenum">2603</span></a>  
<a name="l2604"><span class="linenum">2604</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('files');
<a name="l2605"><span class="linenum">2605</span></a>  
<a name="l2606"><span class="linenum">2606</span></a>  <span class="comment">        // Define field referencelastsync to be dropped from files.</span>
<a name="l2607"><span class="linenum">2607</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('referencelastsync');
<a name="l2608"><span class="linenum">2608</span></a>  
<a name="l2609"><span class="linenum">2609</span></a>  <span class="comment">        // Conditionally launch drop field referencelastsync.</span>
<a name="l2610"><span class="linenum">2610</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l2611"><span class="linenum">2611</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2612"><span class="linenum">2612</span></a>          }
<a name="l2613"><span class="linenum">2613</span></a>  
<a name="l2614"><span class="linenum">2614</span></a>  <span class="comment">        // Define field referencelifetime to be dropped from files.</span>
<a name="l2615"><span class="linenum">2615</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('referencelifetime');
<a name="l2616"><span class="linenum">2616</span></a>  
<a name="l2617"><span class="linenum">2617</span></a>  <span class="comment">        // Conditionally launch drop field referencelifetime.</span>
<a name="l2618"><span class="linenum">2618</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l2619"><span class="linenum">2619</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2620"><span class="linenum">2620</span></a>          }
<a name="l2621"><span class="linenum">2621</span></a>  
<a name="l2622"><span class="linenum">2622</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2623"><span class="linenum">2623</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013092700.01);
<a name="l2624"><span class="linenum">2624</span></a>      }
<a name="l2625"><span class="linenum">2625</span></a>  
<a name="l2626"><span class="linenum">2626</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013100400.01) {
<a name="l2627"><span class="linenum">2627</span></a>  <span class="comment">        // Add user_devices core table.</span>
<a name="l2628"><span class="linenum">2628</span></a>  
<a name="l2629"><span class="linenum">2629</span></a>  <span class="comment">        // Define field id to be added to user_devices.</span>
<a name="l2630"><span class="linenum">2630</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('user_devices');
<a name="l2631"><span class="linenum">2631</span></a>  
<a name="l2632"><span class="linenum">2632</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null, null);
<a name="l2633"><span class="linenum">2633</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('userid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'id');
<a name="l2634"><span class="linenum">2634</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('appid', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '128', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'userid');
<a name="l2635"><span class="linenum">2635</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('name', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '32', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'appid');
<a name="l2636"><span class="linenum">2636</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('model', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '32', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'name');
<a name="l2637"><span class="linenum">2637</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('platform', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '32', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'model');
<a name="l2638"><span class="linenum">2638</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('version', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '32', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'platform');
<a name="l2639"><span class="linenum">2639</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('pushid', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'version');
<a name="l2640"><span class="linenum">2640</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('uuid', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'pushid');
<a name="l2641"><span class="linenum">2641</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('timecreated', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'uuid');
<a name="l2642"><span class="linenum">2642</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('timemodified', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'timecreated');
<a name="l2643"><span class="linenum">2643</span></a>  
<a name="l2644"><span class="linenum">2644</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l2645"><span class="linenum">2645</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('pushid-userid', <a class="constant" onClick="logConstant('XMLDB_KEY_UNIQUE')" href="../../_constants/XMLDB_KEY_UNIQUE.html" onMouseOver="constPopup(event,'XMLDB_KEY_UNIQUE')">XMLDB_KEY_UNIQUE</a>, array('pushid', 'userid'));
<a name="l2646"><span class="linenum">2646</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('pushid-platform', <a class="constant" onClick="logConstant('XMLDB_KEY_UNIQUE')" href="../../_constants/XMLDB_KEY_UNIQUE.html" onMouseOver="constPopup(event,'XMLDB_KEY_UNIQUE')">XMLDB_KEY_UNIQUE</a>, array('pushid', 'platform'));
<a name="l2647"><span class="linenum">2647</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('userid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('userid'), 'user', array('id'));
<a name="l2648"><span class="linenum">2648</span></a>  
<a name="l2649"><span class="linenum">2649</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l2650"><span class="linenum">2650</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l2651"><span class="linenum">2651</span></a>          }
<a name="l2652"><span class="linenum">2652</span></a>  
<a name="l2653"><span class="linenum">2653</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2654"><span class="linenum">2654</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013100400.01);
<a name="l2655"><span class="linenum">2655</span></a>      }
<a name="l2656"><span class="linenum">2656</span></a>  
<a name="l2657"><span class="linenum">2657</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013100800.00) {
<a name="l2658"><span class="linenum">2658</span></a>  
<a name="l2659"><span class="linenum">2659</span></a>  <span class="comment">        // Define field maxfraction to be added to question_attempts.</span>
<a name="l2660"><span class="linenum">2660</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('question_attempts');
<a name="l2661"><span class="linenum">2661</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('maxfraction', <a class="constant" onClick="logConstant('XMLDB_TYPE_NUMBER')" href="../../_constants/XMLDB_TYPE_NUMBER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_NUMBER')">XMLDB_TYPE_NUMBER</a>, '12, 7', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '1', 'minfraction');
<a name="l2662"><span class="linenum">2662</span></a>  
<a name="l2663"><span class="linenum">2663</span></a>  <span class="comment">        // Conditionally launch add field maxfraction.</span>
<a name="l2664"><span class="linenum">2664</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l2665"><span class="linenum">2665</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2666"><span class="linenum">2666</span></a>          }
<a name="l2667"><span class="linenum">2667</span></a>  
<a name="l2668"><span class="linenum">2668</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2669"><span class="linenum">2669</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013100800.00);
<a name="l2670"><span class="linenum">2670</span></a>      }
<a name="l2671"><span class="linenum">2671</span></a>  
<a name="l2672"><span class="linenum">2672</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013100800.01) {
<a name="l2673"><span class="linenum">2673</span></a>  <span class="comment">        // Create a new 'user_password_resets' table.</span>
<a name="l2674"><span class="linenum">2674</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('user_password_resets');
<a name="l2675"><span class="linenum">2675</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null, null);
<a name="l2676"><span class="linenum">2676</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('userid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, null);
<a name="l2677"><span class="linenum">2677</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('timerequested', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, null);
<a name="l2678"><span class="linenum">2678</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('timererequested', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, 0, null);
<a name="l2679"><span class="linenum">2679</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('token', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '32', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, null);
<a name="l2680"><span class="linenum">2680</span></a>  
<a name="l2681"><span class="linenum">2681</span></a>  <span class="comment">        // Adding keys to table.</span>
<a name="l2682"><span class="linenum">2682</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l2683"><span class="linenum">2683</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('fk_userid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('userid'), 'user', array('id'));
<a name="l2684"><span class="linenum">2684</span></a>  
<a name="l2685"><span class="linenum">2685</span></a>  <span class="comment">        // Conditionally launch create table.</span>
<a name="l2686"><span class="linenum">2686</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l2687"><span class="linenum">2687</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l2688"><span class="linenum">2688</span></a>          }
<a name="l2689"><span class="linenum">2689</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013100800.01);
<a name="l2690"><span class="linenum">2690</span></a>      }
<a name="l2691"><span class="linenum">2691</span></a>  
<a name="l2692"><span class="linenum">2692</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013100800.02) {
<a name="l2693"><span class="linenum">2693</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;INSERT INTO {user_preferences}(userid, name, value)
<a name="l2694"><span class="linenum">2694</span></a>                  SELECT id, 'htmleditor', 'textarea' FROM {user} u where u.htmleditor = 0&quot;;
<a name="l2695"><span class="linenum">2695</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l2696"><span class="linenum">2696</span></a>  
<a name="l2697"><span class="linenum">2697</span></a>  <span class="comment">        // Define field htmleditor to be dropped from user</span>
<a name="l2698"><span class="linenum">2698</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('user');
<a name="l2699"><span class="linenum">2699</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('htmleditor');
<a name="l2700"><span class="linenum">2700</span></a>  
<a name="l2701"><span class="linenum">2701</span></a>  <span class="comment">        // Conditionally launch drop field requested</span>
<a name="l2702"><span class="linenum">2702</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l2703"><span class="linenum">2703</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2704"><span class="linenum">2704</span></a>          }
<a name="l2705"><span class="linenum">2705</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2706"><span class="linenum">2706</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013100800.02);
<a name="l2707"><span class="linenum">2707</span></a>      }
<a name="l2708"><span class="linenum">2708</span></a>  
<a name="l2709"><span class="linenum">2709</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013100900.00) {
<a name="l2710"><span class="linenum">2710</span></a>  
<a name="l2711"><span class="linenum">2711</span></a>  <span class="comment">        // Define field lifetime to be dropped from files_reference.</span>
<a name="l2712"><span class="linenum">2712</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('files_reference');
<a name="l2713"><span class="linenum">2713</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('lifetime');
<a name="l2714"><span class="linenum">2714</span></a>  
<a name="l2715"><span class="linenum">2715</span></a>  <span class="comment">        // Conditionally launch drop field lifetime.</span>
<a name="l2716"><span class="linenum">2716</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l2717"><span class="linenum">2717</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2718"><span class="linenum">2718</span></a>          }
<a name="l2719"><span class="linenum">2719</span></a>  
<a name="l2720"><span class="linenum">2720</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2721"><span class="linenum">2721</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013100900.00);
<a name="l2722"><span class="linenum">2722</span></a>      }
<a name="l2723"><span class="linenum">2723</span></a>  
<a name="l2724"><span class="linenum">2724</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013100901.00) {
<a name="l2725"><span class="linenum">2725</span></a>  <span class="comment">        // Fixing possible wrong MIME type for Java Network Launch Protocol (JNLP) files.</span>
<a name="l2726"><span class="linenum">2726</span></a>          <a class="var it2282" onMouseOver="hilite(2282)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_like')" href="../../_functions/sql_like.html" onMouseOver="funcPopup(event,'sql_like')">sql_like</a>('filename', '?', false);
<a name="l2727"><span class="linenum">2727</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field_select')" href="../../_functions/set_field_select.html" onMouseOver="funcPopup(event,'set_field_select')">set_field_select</a>(
<a name="l2728"><span class="linenum">2728</span></a>              'files',
<a name="l2729"><span class="linenum">2729</span></a>              'mimetype',
<a name="l2730"><span class="linenum">2730</span></a>              'application/x-java-jnlp-file',
<a name="l2731"><span class="linenum">2731</span></a>              <a class="var it2282" onMouseOver="hilite(2282)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a>,
<a name="l2732"><span class="linenum">2732</span></a>              array('%.jnlp')
<a name="l2733"><span class="linenum">2733</span></a>          );
<a name="l2734"><span class="linenum">2734</span></a>  
<a name="l2735"><span class="linenum">2735</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2736"><span class="linenum">2736</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013100901.00);
<a name="l2737"><span class="linenum">2737</span></a>      }
<a name="l2738"><span class="linenum">2738</span></a>  
<a name="l2739"><span class="linenum">2739</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013102100.00) {
<a name="l2740"><span class="linenum">2740</span></a>  <span class="comment">        // Changing default value for the status of a course backup.</span>
<a name="l2741"><span class="linenum">2741</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('backup_courses');
<a name="l2742"><span class="linenum">2742</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('laststatus', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '1', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '5', 'lastendtime');
<a name="l2743"><span class="linenum">2743</span></a>  
<a name="l2744"><span class="linenum">2744</span></a>  <span class="comment">        // Launch change of precision for field value</span>
<a name="l2745"><span class="linenum">2745</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('change_field_precision')" href="../../_functions/change_field_precision.html" onMouseOver="funcPopup(event,'change_field_precision')">change_field_precision</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l2746"><span class="linenum">2746</span></a>  
<a name="l2747"><span class="linenum">2747</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2748"><span class="linenum">2748</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013102100.00);
<a name="l2749"><span class="linenum">2749</span></a>      }
<a name="l2750"><span class="linenum">2750</span></a>  
<a name="l2751"><span class="linenum">2751</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013102201.00) {
<a name="l2752"><span class="linenum">2752</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('plugin' =&gt; 'editor_atto', 'name' =&gt; 'version');
<a name="l2753"><span class="linenum">2753</span></a>          <a class="var it37344" onMouseOver="hilite(37344)" onMouseOut="lolite()" onClick="logVariable('attoversion')" href="../../_variables/attoversion.html">$attoversion</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('config_plugins',
<a name="l2754"><span class="linenum">2754</span></a>                                         <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>,
<a name="l2755"><span class="linenum">2755</span></a>                                         'value',
<a name="l2756"><span class="linenum">2756</span></a>                                         <a class="constant" onClick="logConstant('IGNORE_MISSING')" href="../../_constants/IGNORE_MISSING.html" onMouseOver="constPopup(event,'IGNORE_MISSING')">IGNORE_MISSING</a>);
<a name="l2757"><span class="linenum">2757</span></a>  
<a name="l2758"><span class="linenum">2758</span></a>          if (<a class="var it37344" onMouseOver="hilite(37344)" onMouseOut="lolite()" onClick="logVariable('attoversion')" href="../../_variables/attoversion.html">$attoversion</a>) {
<a name="l2759"><span class="linenum">2759</span></a>              <a class="var it37344" onMouseOver="hilite(37344)" onMouseOut="lolite()" onClick="logVariable('attoversion')" href="../../_variables/attoversion.html">$attoversion</a> = <a class="phpfunction" onClick="logFunction('floatval')" href="../../_functions/floatval.html" onMouseOver="phpfuncPopup(event,'floatval')">floatval</a>(<a class="var it37344" onMouseOver="hilite(37344)" onMouseOut="lolite()" onClick="logVariable('attoversion')" href="../../_variables/attoversion.html">$attoversion</a>-&gt;<a onClick="logVariable('value')" class="var it41670" onMouseOver="hilite(41670)" onMouseOut="lolite()" href="../../_variables/value.html">value</a>);
<a name="l2760"><span class="linenum">2760</span></a>          }
<a name="l2761"><span class="linenum">2761</span></a>  <span class="comment">        // Only these versions that were part of 2.6 beta should be removed.</span>
<a name="l2762"><span class="linenum">2762</span></a>  <span class="comment">        // Manually installed versions of 2.5 - or later releases for 2.6 installed</span>
<a name="l2763"><span class="linenum">2763</span></a>  <span class="comment">        // via the plugins DB should not be uninstalled.</span>
<a name="l2764"><span class="linenum">2764</span></a>          if (<a class="var it37344" onMouseOver="hilite(37344)" onMouseOut="lolite()" onClick="logVariable('attoversion')" href="../../_variables/attoversion.html">$attoversion</a> &amp;&amp; <a class="var it37344" onMouseOver="hilite(37344)" onMouseOut="lolite()" onClick="logVariable('attoversion')" href="../../_variables/attoversion.html">$attoversion</a> &gt; 2013051500.00 &amp;&amp; <a class="var it37344" onMouseOver="hilite(37344)" onMouseOut="lolite()" onClick="logVariable('attoversion')" href="../../_variables/attoversion.html">$attoversion</a> &lt; 2013102201.00) {
<a name="l2765"><span class="linenum">2765</span></a>  <span class="comment">            // Remove all other associated config.</span>
<a name="l2766"><span class="linenum">2766</span></a>              <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('editor_atto');
<a name="l2767"><span class="linenum">2767</span></a>              <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('atto_bold');
<a name="l2768"><span class="linenum">2768</span></a>              <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('atto_clear');
<a name="l2769"><span class="linenum">2769</span></a>              <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('atto_html');
<a name="l2770"><span class="linenum">2770</span></a>              <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('atto_image');
<a name="l2771"><span class="linenum">2771</span></a>              <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('atto_indent');
<a name="l2772"><span class="linenum">2772</span></a>              <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('atto_italic');
<a name="l2773"><span class="linenum">2773</span></a>              <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('atto_link');
<a name="l2774"><span class="linenum">2774</span></a>              <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('atto_media');
<a name="l2775"><span class="linenum">2775</span></a>              <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('atto_orderedlist');
<a name="l2776"><span class="linenum">2776</span></a>              <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('atto_outdent');
<a name="l2777"><span class="linenum">2777</span></a>              <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('atto_strike');
<a name="l2778"><span class="linenum">2778</span></a>              <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('atto_title');
<a name="l2779"><span class="linenum">2779</span></a>              <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('atto_underline');
<a name="l2780"><span class="linenum">2780</span></a>              <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('atto_unlink');
<a name="l2781"><span class="linenum">2781</span></a>              <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('atto_unorderedlist');
<a name="l2782"><span class="linenum">2782</span></a>  
<a name="l2783"><span class="linenum">2783</span></a>          }
<a name="l2784"><span class="linenum">2784</span></a>  
<a name="l2785"><span class="linenum">2785</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2786"><span class="linenum">2786</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013102201.00);
<a name="l2787"><span class="linenum">2787</span></a>      }
<a name="l2788"><span class="linenum">2788</span></a>  
<a name="l2789"><span class="linenum">2789</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013102500.01) {
<a name="l2790"><span class="linenum">2790</span></a>  <span class="comment">        // Find all fileareas that have missing root folder entry and add the root folder entry.</span>
<a name="l2791"><span class="linenum">2791</span></a>          if (empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('filesrootrecordsfixed')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/filesrootrecordsfixed.html">filesrootrecordsfixed</a>)) {
<a name="l2792"><span class="linenum">2792</span></a>              <a class="function" onClick="logFunction('upgrade_fix_missing_root_folders')" href="../../_functions/upgrade_fix_missing_root_folders.html" onMouseOver="funcPopup(event,'upgrade_fix_missing_root_folders')">upgrade_fix_missing_root_folders</a>();
<a name="l2793"><span class="linenum">2793</span></a>  <span class="comment">            // To skip running the same script on the upgrade to the next major release.</span>
<a name="l2794"><span class="linenum">2794</span></a>              <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('filesrootrecordsfixed', 1);
<a name="l2795"><span class="linenum">2795</span></a>          }
<a name="l2796"><span class="linenum">2796</span></a>  
<a name="l2797"><span class="linenum">2797</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2798"><span class="linenum">2798</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013102500.01);
<a name="l2799"><span class="linenum">2799</span></a>      }
<a name="l2800"><span class="linenum">2800</span></a>  
<a name="l2801"><span class="linenum">2801</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013110500.01) {
<a name="l2802"><span class="linenum">2802</span></a>  <span class="comment">        // MDL-38228. Corrected course_modules upgrade script instead of 2013021801.01.</span>
<a name="l2803"><span class="linenum">2803</span></a>  
<a name="l2804"><span class="linenum">2804</span></a>  <span class="comment">        // This upgrade script fixes the mismatches between DB fields course_modules.section</span>
<a name="l2805"><span class="linenum">2805</span></a>  <span class="comment">        // and course_sections.sequence. It makes sure that each module is included</span>
<a name="l2806"><span class="linenum">2806</span></a>  <span class="comment">        // in the sequence of at least one section.</span>
<a name="l2807"><span class="linenum">2807</span></a>  <span class="comment">        // There is also a separate script for admins: admin/cli/fix_course_sortorder.php</span>
<a name="l2808"><span class="linenum">2808</span></a>  
<a name="l2809"><span class="linenum">2809</span></a>  <span class="comment">        // This script in included in each major version upgrade process so make sure we don't run it twice.</span>
<a name="l2810"><span class="linenum">2810</span></a>          if (empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('movingmoduleupgradescriptwasrun')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/movingmoduleupgradescriptwasrun.html">movingmoduleupgradescriptwasrun</a>)) {
<a name="l2811"><span class="linenum">2811</span></a>              <a class="function" onClick="logFunction('upgrade_course_modules_sequences')" href="../../_functions/upgrade_course_modules_sequences.html" onMouseOver="funcPopup(event,'upgrade_course_modules_sequences')">upgrade_course_modules_sequences</a>();
<a name="l2812"><span class="linenum">2812</span></a>  
<a name="l2813"><span class="linenum">2813</span></a>  <span class="comment">            // To skip running the same script on the upgrade to the next major release.</span>
<a name="l2814"><span class="linenum">2814</span></a>              <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('movingmoduleupgradescriptwasrun', 1);
<a name="l2815"><span class="linenum">2815</span></a>          }
<a name="l2816"><span class="linenum">2816</span></a>  
<a name="l2817"><span class="linenum">2817</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2818"><span class="linenum">2818</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013110500.01);
<a name="l2819"><span class="linenum">2819</span></a>      }
<a name="l2820"><span class="linenum">2820</span></a>  
<a name="l2821"><span class="linenum">2821</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013110600.01) {
<a name="l2822"><span class="linenum">2822</span></a>  
<a name="l2823"><span class="linenum">2823</span></a>          if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a> . '/theme/mymobile')) {
<a name="l2824"><span class="linenum">2824</span></a>  <span class="comment">            // Replace the mymobile settings.</span>
<a name="l2825"><span class="linenum">2825</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('course', 'theme', 'clean', array('theme' =&gt; 'mymobile'));
<a name="l2826"><span class="linenum">2826</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('course_categories', 'theme', 'clean', array('theme' =&gt; 'mymobile'));
<a name="l2827"><span class="linenum">2827</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('user', 'theme', 'clean', array('theme' =&gt; 'mymobile'));
<a name="l2828"><span class="linenum">2828</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('mnet_host', 'theme', 'clean', array('theme' =&gt; 'mymobile'));
<a name="l2829"><span class="linenum">2829</span></a>  
<a name="l2830"><span class="linenum">2830</span></a>  <span class="comment">            // Replace the theme configs.</span>
<a name="l2831"><span class="linenum">2831</span></a>              if (<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('core', 'theme') === 'mymobile') {
<a name="l2832"><span class="linenum">2832</span></a>                  <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('theme', 'clean');
<a name="l2833"><span class="linenum">2833</span></a>              }
<a name="l2834"><span class="linenum">2834</span></a>              if (<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('core', 'thememobile') === 'mymobile') {
<a name="l2835"><span class="linenum">2835</span></a>                  <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('thememobile', 'clean');
<a name="l2836"><span class="linenum">2836</span></a>              }
<a name="l2837"><span class="linenum">2837</span></a>              if (<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('core', 'themelegacy') === 'mymobile') {
<a name="l2838"><span class="linenum">2838</span></a>                  <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('themelegacy', 'clean');
<a name="l2839"><span class="linenum">2839</span></a>              }
<a name="l2840"><span class="linenum">2840</span></a>              if (<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('core', 'themetablet') === 'mymobile') {
<a name="l2841"><span class="linenum">2841</span></a>                  <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('themetablet', 'clean');
<a name="l2842"><span class="linenum">2842</span></a>              }
<a name="l2843"><span class="linenum">2843</span></a>  
<a name="l2844"><span class="linenum">2844</span></a>  <span class="comment">            // Hacky emulation of plugin uninstallation.</span>
<a name="l2845"><span class="linenum">2845</span></a>              <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('theme_mymobile');
<a name="l2846"><span class="linenum">2846</span></a>          }
<a name="l2847"><span class="linenum">2847</span></a>  
<a name="l2848"><span class="linenum">2848</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2849"><span class="linenum">2849</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013110600.01);
<a name="l2850"><span class="linenum">2850</span></a>      }
<a name="l2851"><span class="linenum">2851</span></a>  
<a name="l2852"><span class="linenum">2852</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013110600.02) {
<a name="l2853"><span class="linenum">2853</span></a>  
<a name="l2854"><span class="linenum">2854</span></a>  <span class="comment">        // If the user is logged in, we ensure that the alternate name fields are present</span>
<a name="l2855"><span class="linenum">2855</span></a>  <span class="comment">        // in the session. It will not be the case when upgrading from 2.5 downwards.</span>
<a name="l2856"><span class="linenum">2856</span></a>          if (!empty(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l2857"><span class="linenum">2857</span></a>              <a class="var it37347" onMouseOver="hilite(37347)" onMouseOut="lolite()" onClick="logVariable('refreshuser')" href="../../_variables/refreshuser.html">$refreshuser</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id' =&gt; <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l2858"><span class="linenum">2858</span></a>              <a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a> = array('firstnamephonetic', 'lastnamephonetic', 'middlename', 'alternatename', 'firstname', 'lastname');
<a name="l2859"><span class="linenum">2859</span></a>              foreach (<a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a> as <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>) {
<a name="l2860"><span class="linenum">2860</span></a>                  <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;{<a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>} = <a class="var it37347" onMouseOver="hilite(37347)" onMouseOut="lolite()" onClick="logVariable('refreshuser')" href="../../_variables/refreshuser.html">$refreshuser</a>-&gt;{<a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>};
<a name="l2861"><span class="linenum">2861</span></a>              }
<a name="l2862"><span class="linenum">2862</span></a>          }
<a name="l2863"><span class="linenum">2863</span></a>  
<a name="l2864"><span class="linenum">2864</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2865"><span class="linenum">2865</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013110600.02);
<a name="l2866"><span class="linenum">2866</span></a>      }
<a name="l2867"><span class="linenum">2867</span></a>  
<a name="l2868"><span class="linenum">2868</span></a>  <span class="comment">    // Moodle v2.6.0 release upgrade line.</span>
<a name="l2869"><span class="linenum">2869</span></a>  <span class="comment">    // Put any upgrade step following this.</span>
<a name="l2870"><span class="linenum">2870</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013111800.01) {
<a name="l2871"><span class="linenum">2871</span></a>  
<a name="l2872"><span class="linenum">2872</span></a>  <span class="comment">        // Delete notes of deleted courses.</span>
<a name="l2873"><span class="linenum">2873</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;DELETE FROM {post}
<a name="l2874"><span class="linenum">2874</span></a>                   WHERE NOT <a class="function" onClick="logFunction('EXISTS')" href="../../_functions/exists.html" onMouseOver="funcPopup(event,'exists')">EXISTS</a> (SELECT {course}.id FROM {course}
<a name="l2875"><span class="linenum">2875</span></a>                                      WHERE {course}.id = {post}.courseid)
<a name="l2876"><span class="linenum">2876</span></a>                         AND {post}.module = ?&quot;;
<a name="l2877"><span class="linenum">2877</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array('notes'));
<a name="l2878"><span class="linenum">2878</span></a>  
<a name="l2879"><span class="linenum">2879</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2880"><span class="linenum">2880</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013111800.01);
<a name="l2881"><span class="linenum">2881</span></a>      }
<a name="l2882"><span class="linenum">2882</span></a>  
<a name="l2883"><span class="linenum">2883</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2013122400.01) {
<a name="l2884"><span class="linenum">2884</span></a>  <span class="comment">        // Purge stored passwords from config_log table, ideally this should be in each plugin</span>
<a name="l2885"><span class="linenum">2885</span></a>  <span class="comment">        // but that would complicate backporting...</span>
<a name="l2886"><span class="linenum">2886</span></a>          <a class="var it135" onMouseOver="hilite(135)" onMouseOut="lolite()" onClick="logVariable('items')" href="../../_variables/items.html">$items</a> = array(
<a name="l2887"><span class="linenum">2887</span></a>              'core/cronremotepassword', 'core/proxypassword', 'core/smtppass', 'core/jabberpassword',
<a name="l2888"><span class="linenum">2888</span></a>              'enrol_database/dbpass', 'enrol_ldap/bind_pw', 'url/secretphrase');
<a name="l2889"><span class="linenum">2889</span></a>          foreach (<a class="var it135" onMouseOver="hilite(135)" onMouseOut="lolite()" onClick="logVariable('items')" href="../../_variables/items.html">$items</a> as <a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('item')" href="../../_variables/item.html">$item</a>) {
<a name="l2890"><span class="linenum">2890</span></a>              <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it130" onMouseOver="hilite(130)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../_variables/plugin.html">$plugin</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a>) = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>('/', <a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('item')" href="../../_variables/item.html">$item</a>);
<a name="l2891"><span class="linenum">2891</span></a>              <a class="var it37348" onMouseOver="hilite(37348)" onMouseOut="lolite()" onClick="logVariable('sqlcomparevalue')" href="../../_variables/sqlcomparevalue.html">$sqlcomparevalue</a> =  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_compare_text')" href="../../_functions/sql_compare_text.html" onMouseOver="funcPopup(event,'sql_compare_text')">sql_compare_text</a>('value');
<a name="l2892"><span class="linenum">2892</span></a>              <a class="var it37349" onMouseOver="hilite(37349)" onMouseOut="lolite()" onClick="logVariable('sqlcompareoldvalue')" href="../../_variables/sqlcompareoldvalue.html">$sqlcompareoldvalue</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_compare_text')" href="../../_functions/sql_compare_text.html" onMouseOver="funcPopup(event,'sql_compare_text')">sql_compare_text</a>('oldvalue');
<a name="l2893"><span class="linenum">2893</span></a>              if (<a class="var it130" onMouseOver="hilite(130)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../_variables/plugin.html">$plugin</a> === 'core') {
<a name="l2894"><span class="linenum">2894</span></a>                  <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;UPDATE {config_log}
<a name="l2895"><span class="linenum">2895</span></a>                             SET value = :value
<a name="l2896"><span class="linenum">2896</span></a>                           WHERE name = :name AND plugin IS NULL AND <a class="var it37348" onMouseOver="hilite(37348)" onMouseOut="lolite()" onClick="logVariable('sqlcomparevalue')" href="../../_variables/sqlcomparevalue.html">$sqlcomparevalue</a> &lt;&gt; :empty&quot;;
<a name="l2897"><span class="linenum">2897</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('value' =&gt; '********', 'name' =&gt; <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a>, 'empty' =&gt; '');
<a name="l2898"><span class="linenum">2898</span></a>                  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l2899"><span class="linenum">2899</span></a>  
<a name="l2900"><span class="linenum">2900</span></a>                  <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;UPDATE {config_log}
<a name="l2901"><span class="linenum">2901</span></a>                             SET oldvalue = :value
<a name="l2902"><span class="linenum">2902</span></a>                           WHERE name = :name AND plugin IS NULL AND <a class="var it37349" onMouseOver="hilite(37349)" onMouseOut="lolite()" onClick="logVariable('sqlcompareoldvalue')" href="../../_variables/sqlcompareoldvalue.html">$sqlcompareoldvalue</a> &lt;&gt; :empty&quot;;
<a name="l2903"><span class="linenum">2903</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('value' =&gt; '********', 'name' =&gt; <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a>, 'empty' =&gt; '');
<a name="l2904"><span class="linenum">2904</span></a>                  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l2905"><span class="linenum">2905</span></a>  
<a name="l2906"><span class="linenum">2906</span></a>              } else {
<a name="l2907"><span class="linenum">2907</span></a>                  <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;UPDATE {config_log}
<a name="l2908"><span class="linenum">2908</span></a>                             SET value = :value
<a name="l2909"><span class="linenum">2909</span></a>                           WHERE name = :name AND plugin = :plugin AND <a class="var it37348" onMouseOver="hilite(37348)" onMouseOut="lolite()" onClick="logVariable('sqlcomparevalue')" href="../../_variables/sqlcomparevalue.html">$sqlcomparevalue</a> &lt;&gt; :empty&quot;;
<a name="l2910"><span class="linenum">2910</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('value' =&gt; '********', 'name' =&gt; <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a>, 'plugin' =&gt; <a class="var it130" onMouseOver="hilite(130)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../_variables/plugin.html">$plugin</a>, 'empty' =&gt; '');
<a name="l2911"><span class="linenum">2911</span></a>                  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l2912"><span class="linenum">2912</span></a>  
<a name="l2913"><span class="linenum">2913</span></a>                  <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;UPDATE {config_log}
<a name="l2914"><span class="linenum">2914</span></a>                             SET oldvalue = :value
<a name="l2915"><span class="linenum">2915</span></a>                           WHERE name = :name AND plugin = :plugin AND  <a class="var it37349" onMouseOver="hilite(37349)" onMouseOut="lolite()" onClick="logVariable('sqlcompareoldvalue')" href="../../_variables/sqlcompareoldvalue.html">$sqlcompareoldvalue</a> &lt;&gt; :empty&quot;;
<a name="l2916"><span class="linenum">2916</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('value' =&gt; '********', 'name' =&gt; <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a>, 'plugin' =&gt; <a class="var it130" onMouseOver="hilite(130)" onMouseOut="lolite()" onClick="logVariable('plugin')" href="../../_variables/plugin.html">$plugin</a>, 'empty' =&gt; '');
<a name="l2917"><span class="linenum">2917</span></a>                  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l2918"><span class="linenum">2918</span></a>              }
<a name="l2919"><span class="linenum">2919</span></a>          }
<a name="l2920"><span class="linenum">2920</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2921"><span class="linenum">2921</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2013122400.01);
<a name="l2922"><span class="linenum">2922</span></a>      }
<a name="l2923"><span class="linenum">2923</span></a>  
<a name="l2924"><span class="linenum">2924</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014011000.01) {
<a name="l2925"><span class="linenum">2925</span></a>  
<a name="l2926"><span class="linenum">2926</span></a>  <span class="comment">        // Define table cache_text to be dropped.</span>
<a name="l2927"><span class="linenum">2927</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('cache_text');
<a name="l2928"><span class="linenum">2928</span></a>  
<a name="l2929"><span class="linenum">2929</span></a>  <span class="comment">        // Conditionally launch drop table for cache_text.</span>
<a name="l2930"><span class="linenum">2930</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l2931"><span class="linenum">2931</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_table')" href="../../_functions/drop_table.html" onMouseOver="funcPopup(event,'drop_table')">drop_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l2932"><span class="linenum">2932</span></a>          }
<a name="l2933"><span class="linenum">2933</span></a>  
<a name="l2934"><span class="linenum">2934</span></a>          <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('cachetext');
<a name="l2935"><span class="linenum">2935</span></a>  
<a name="l2936"><span class="linenum">2936</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2937"><span class="linenum">2937</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014011000.01);
<a name="l2938"><span class="linenum">2938</span></a>      }
<a name="l2939"><span class="linenum">2939</span></a>  
<a name="l2940"><span class="linenum">2940</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014011701.00) {
<a name="l2941"><span class="linenum">2941</span></a>  <span class="comment">        // Fix gradebook sortorder duplicates.</span>
<a name="l2942"><span class="linenum">2942</span></a>          <a class="function" onClick="logFunction('upgrade_grade_item_fix_sortorder')" href="../../_functions/upgrade_grade_item_fix_sortorder.html" onMouseOver="funcPopup(event,'upgrade_grade_item_fix_sortorder')">upgrade_grade_item_fix_sortorder</a>();
<a name="l2943"><span class="linenum">2943</span></a>  
<a name="l2944"><span class="linenum">2944</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2945"><span class="linenum">2945</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014011701.00);
<a name="l2946"><span class="linenum">2946</span></a>      }
<a name="l2947"><span class="linenum">2947</span></a>  
<a name="l2948"><span class="linenum">2948</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014012300.01) {
<a name="l2949"><span class="linenum">2949</span></a>  <span class="comment">        // Remove deleted users home pages.</span>
<a name="l2950"><span class="linenum">2950</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;DELETE FROM {my_pages}
<a name="l2951"><span class="linenum">2951</span></a>                  WHERE <a class="function" onClick="logFunction('EXISTS')" href="../../_functions/exists.html" onMouseOver="funcPopup(event,'exists')">EXISTS</a> (SELECT {user}.id
<a name="l2952"><span class="linenum">2952</span></a>                                    FROM {user}
<a name="l2953"><span class="linenum">2953</span></a>                                    WHERE {user}.id = {my_pages}.userid
<a name="l2954"><span class="linenum">2954</span></a>                                    AND {user}.deleted = 1)
<a name="l2955"><span class="linenum">2955</span></a>                  AND {my_pages}.private = 1&quot;;
<a name="l2956"><span class="linenum">2956</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l2957"><span class="linenum">2957</span></a>  
<a name="l2958"><span class="linenum">2958</span></a>  <span class="comment">        // Reached main savepoint.</span>
<a name="l2959"><span class="linenum">2959</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014012300.01);
<a name="l2960"><span class="linenum">2960</span></a>      }
<a name="l2961"><span class="linenum">2961</span></a>  
<a name="l2962"><span class="linenum">2962</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014012400.00) {
<a name="l2963"><span class="linenum">2963</span></a>  <span class="comment">        // Define table lock_db to be created.</span>
<a name="l2964"><span class="linenum">2964</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('lock_db');
<a name="l2965"><span class="linenum">2965</span></a>  
<a name="l2966"><span class="linenum">2966</span></a>  <span class="comment">        // Adding fields to table lock_db.</span>
<a name="l2967"><span class="linenum">2967</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null);
<a name="l2968"><span class="linenum">2968</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('resourcekey', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l2969"><span class="linenum">2969</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('expires', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null);
<a name="l2970"><span class="linenum">2970</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('owner', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '36', null, null, null, null);
<a name="l2971"><span class="linenum">2971</span></a>  
<a name="l2972"><span class="linenum">2972</span></a>  <span class="comment">        // Adding keys to table lock_db.</span>
<a name="l2973"><span class="linenum">2973</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l2974"><span class="linenum">2974</span></a>  
<a name="l2975"><span class="linenum">2975</span></a>  <span class="comment">        // Adding indexes to table lock_db.</span>
<a name="l2976"><span class="linenum">2976</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>('resourcekey_uniq', <a class="constant" onClick="logConstant('XMLDB_INDEX_UNIQUE')" href="../../_constants/XMLDB_INDEX_UNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_UNIQUE')">XMLDB_INDEX_UNIQUE</a>, array('resourcekey'));
<a name="l2977"><span class="linenum">2977</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>('expires_idx', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('expires'));
<a name="l2978"><span class="linenum">2978</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>('owner_idx', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('owner'));
<a name="l2979"><span class="linenum">2979</span></a>  
<a name="l2980"><span class="linenum">2980</span></a>  <span class="comment">        // Conditionally launch create table for lock_db.</span>
<a name="l2981"><span class="linenum">2981</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l2982"><span class="linenum">2982</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l2983"><span class="linenum">2983</span></a>          }
<a name="l2984"><span class="linenum">2984</span></a>  
<a name="l2985"><span class="linenum">2985</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l2986"><span class="linenum">2986</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014012400.00);
<a name="l2987"><span class="linenum">2987</span></a>      }
<a name="l2988"><span class="linenum">2988</span></a>  
<a name="l2989"><span class="linenum">2989</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014021300.01) {
<a name="l2990"><span class="linenum">2990</span></a>  <span class="comment">        // Delete any cached stats to force recalculation later, then we can be sure that cached records will have the correct</span>
<a name="l2991"><span class="linenum">2991</span></a>  <span class="comment">        // field.</span>
<a name="l2992"><span class="linenum">2992</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('question_response_analysis');
<a name="l2993"><span class="linenum">2993</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('question_statistics');
<a name="l2994"><span class="linenum">2994</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('quiz_statistics');
<a name="l2995"><span class="linenum">2995</span></a>  
<a name="l2996"><span class="linenum">2996</span></a>  <span class="comment">        // Define field variant to be added to question_statistics.</span>
<a name="l2997"><span class="linenum">2997</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('question_statistics');
<a name="l2998"><span class="linenum">2998</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('variant', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null, 'subquestion');
<a name="l2999"><span class="linenum">2999</span></a>  
<a name="l3000"><span class="linenum">3000</span></a>  <span class="comment">        // Conditionally launch add field variant.</span>
<a name="l3001"><span class="linenum">3001</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3002"><span class="linenum">3002</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3003"><span class="linenum">3003</span></a>          }
<a name="l3004"><span class="linenum">3004</span></a>  
<a name="l3005"><span class="linenum">3005</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3006"><span class="linenum">3006</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014021300.01);
<a name="l3007"><span class="linenum">3007</span></a>      }
<a name="l3008"><span class="linenum">3008</span></a>  
<a name="l3009"><span class="linenum">3009</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014021300.02) {
<a name="l3010"><span class="linenum">3010</span></a>  
<a name="l3011"><span class="linenum">3011</span></a>  <span class="comment">        // Define field variant to be added to question_response_analysis.</span>
<a name="l3012"><span class="linenum">3012</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('question_response_analysis');
<a name="l3013"><span class="linenum">3013</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('variant', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null, 'questionid');
<a name="l3014"><span class="linenum">3014</span></a>  
<a name="l3015"><span class="linenum">3015</span></a>  <span class="comment">        // Conditionally launch add field variant.</span>
<a name="l3016"><span class="linenum">3016</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3017"><span class="linenum">3017</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3018"><span class="linenum">3018</span></a>          }
<a name="l3019"><span class="linenum">3019</span></a>  
<a name="l3020"><span class="linenum">3020</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3021"><span class="linenum">3021</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014021300.02);
<a name="l3022"><span class="linenum">3022</span></a>      }
<a name="l3023"><span class="linenum">3023</span></a>  
<a name="l3024"><span class="linenum">3024</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014021800.00) {
<a name="l3025"><span class="linenum">3025</span></a>  
<a name="l3026"><span class="linenum">3026</span></a>  <span class="comment">        // Define field queued to be added to portfolio_tempdata.</span>
<a name="l3027"><span class="linenum">3027</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('portfolio_tempdata');
<a name="l3028"><span class="linenum">3028</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('queued', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '1', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'instance');
<a name="l3029"><span class="linenum">3029</span></a>  
<a name="l3030"><span class="linenum">3030</span></a>  <span class="comment">        // Conditionally launch add field queued.</span>
<a name="l3031"><span class="linenum">3031</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3032"><span class="linenum">3032</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3033"><span class="linenum">3033</span></a>          }
<a name="l3034"><span class="linenum">3034</span></a>  
<a name="l3035"><span class="linenum">3035</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3036"><span class="linenum">3036</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014021800.00);
<a name="l3037"><span class="linenum">3037</span></a>      }
<a name="l3038"><span class="linenum">3038</span></a>  
<a name="l3039"><span class="linenum">3039</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014021900.01) {
<a name="l3040"><span class="linenum">3040</span></a>  <span class="comment">        // Force uninstall of deleted tool.</span>
<a name="l3041"><span class="linenum">3041</span></a>  
<a name="l3042"><span class="linenum">3042</span></a>  <span class="comment">        // Normally, in this sort of situation, we would do a file_exists check,</span>
<a name="l3043"><span class="linenum">3043</span></a>  <span class="comment">        // in case the plugin had been added back as an add-on. However, this</span>
<a name="l3044"><span class="linenum">3044</span></a>  <span class="comment">        // plugin is completely useless after Moodle 2.6, so we check that the</span>
<a name="l3045"><span class="linenum">3045</span></a>  <span class="comment">        // files have been removed in upgrade_stale_php_files_present, and we</span>
<a name="l3046"><span class="linenum">3046</span></a>  <span class="comment">        // uninstall it unconditionally here.</span>
<a name="l3047"><span class="linenum">3047</span></a>  
<a name="l3048"><span class="linenum">3048</span></a>  <span class="comment">        // Remove all associated config.</span>
<a name="l3049"><span class="linenum">3049</span></a>          <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('tool_qeupgradehelper');
<a name="l3050"><span class="linenum">3050</span></a>  
<a name="l3051"><span class="linenum">3051</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014021900.01);
<a name="l3052"><span class="linenum">3052</span></a>      }
<a name="l3053"><span class="linenum">3053</span></a>  
<a name="l3054"><span class="linenum">3054</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014021900.02) {
<a name="l3055"><span class="linenum">3055</span></a>  
<a name="l3056"><span class="linenum">3056</span></a>  <span class="comment">        // Define table question_states to be dropped.</span>
<a name="l3057"><span class="linenum">3057</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('question_states');
<a name="l3058"><span class="linenum">3058</span></a>  
<a name="l3059"><span class="linenum">3059</span></a>  <span class="comment">        // Conditionally launch drop table for question_states.</span>
<a name="l3060"><span class="linenum">3060</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l3061"><span class="linenum">3061</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_table')" href="../../_functions/drop_table.html" onMouseOver="funcPopup(event,'drop_table')">drop_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l3062"><span class="linenum">3062</span></a>          }
<a name="l3063"><span class="linenum">3063</span></a>  
<a name="l3064"><span class="linenum">3064</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3065"><span class="linenum">3065</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014021900.02);
<a name="l3066"><span class="linenum">3066</span></a>      }
<a name="l3067"><span class="linenum">3067</span></a>  
<a name="l3068"><span class="linenum">3068</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014021900.03) {
<a name="l3069"><span class="linenum">3069</span></a>  
<a name="l3070"><span class="linenum">3070</span></a>  <span class="comment">        // Define table question_sessions to be dropped.</span>
<a name="l3071"><span class="linenum">3071</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('question_sessions');
<a name="l3072"><span class="linenum">3072</span></a>  
<a name="l3073"><span class="linenum">3073</span></a>  <span class="comment">        // Conditionally launch drop table for question_sessions.</span>
<a name="l3074"><span class="linenum">3074</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l3075"><span class="linenum">3075</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_table')" href="../../_functions/drop_table.html" onMouseOver="funcPopup(event,'drop_table')">drop_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l3076"><span class="linenum">3076</span></a>          }
<a name="l3077"><span class="linenum">3077</span></a>  
<a name="l3078"><span class="linenum">3078</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3079"><span class="linenum">3079</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014021900.03);
<a name="l3080"><span class="linenum">3080</span></a>      }
<a name="l3081"><span class="linenum">3081</span></a>  
<a name="l3082"><span class="linenum">3082</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014022600.00) {
<a name="l3083"><span class="linenum">3083</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('task_scheduled');
<a name="l3084"><span class="linenum">3084</span></a>  
<a name="l3085"><span class="linenum">3085</span></a>  <span class="comment">        // Adding fields to table task_scheduled.</span>
<a name="l3086"><span class="linenum">3086</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null);
<a name="l3087"><span class="linenum">3087</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('component', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l3088"><span class="linenum">3088</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('classname', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l3089"><span class="linenum">3089</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('lastruntime', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null);
<a name="l3090"><span class="linenum">3090</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('nextruntime', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null);
<a name="l3091"><span class="linenum">3091</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('blocking', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '2', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0');
<a name="l3092"><span class="linenum">3092</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('minute', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '25', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l3093"><span class="linenum">3093</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('hour', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '25', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l3094"><span class="linenum">3094</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('day', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '25', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l3095"><span class="linenum">3095</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('month', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '25', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l3096"><span class="linenum">3096</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('dayofweek', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '25', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l3097"><span class="linenum">3097</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('faildelay', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null);
<a name="l3098"><span class="linenum">3098</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('customised', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '2', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0');
<a name="l3099"><span class="linenum">3099</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('disabled', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '1', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0');
<a name="l3100"><span class="linenum">3100</span></a>  
<a name="l3101"><span class="linenum">3101</span></a>  <span class="comment">        // Adding keys to table task_scheduled.</span>
<a name="l3102"><span class="linenum">3102</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l3103"><span class="linenum">3103</span></a>  
<a name="l3104"><span class="linenum">3104</span></a>  <span class="comment">        // Adding indexes to table task_scheduled.</span>
<a name="l3105"><span class="linenum">3105</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>('classname_uniq', <a class="constant" onClick="logConstant('XMLDB_INDEX_UNIQUE')" href="../../_constants/XMLDB_INDEX_UNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_UNIQUE')">XMLDB_INDEX_UNIQUE</a>, array('classname'));
<a name="l3106"><span class="linenum">3106</span></a>  
<a name="l3107"><span class="linenum">3107</span></a>  <span class="comment">        // Conditionally launch create table for task_scheduled.</span>
<a name="l3108"><span class="linenum">3108</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l3109"><span class="linenum">3109</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l3110"><span class="linenum">3110</span></a>          }
<a name="l3111"><span class="linenum">3111</span></a>  
<a name="l3112"><span class="linenum">3112</span></a>  <span class="comment">        // Define table task_adhoc to be created.</span>
<a name="l3113"><span class="linenum">3113</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('task_adhoc');
<a name="l3114"><span class="linenum">3114</span></a>  
<a name="l3115"><span class="linenum">3115</span></a>  <span class="comment">        // Adding fields to table task_adhoc.</span>
<a name="l3116"><span class="linenum">3116</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null);
<a name="l3117"><span class="linenum">3117</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('component', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l3118"><span class="linenum">3118</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('classname', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l3119"><span class="linenum">3119</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('nextruntime', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l3120"><span class="linenum">3120</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('faildelay', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null);
<a name="l3121"><span class="linenum">3121</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('customdata', <a class="constant" onClick="logConstant('XMLDB_TYPE_TEXT')" href="../../_constants/XMLDB_TYPE_TEXT.html" onMouseOver="constPopup(event,'XMLDB_TYPE_TEXT')">XMLDB_TYPE_TEXT</a>, null, null, null, null, null);
<a name="l3122"><span class="linenum">3122</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('blocking', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '2', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0');
<a name="l3123"><span class="linenum">3123</span></a>  
<a name="l3124"><span class="linenum">3124</span></a>  <span class="comment">        // Adding keys to table task_adhoc.</span>
<a name="l3125"><span class="linenum">3125</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l3126"><span class="linenum">3126</span></a>  
<a name="l3127"><span class="linenum">3127</span></a>  <span class="comment">        // Adding indexes to table task_adhoc.</span>
<a name="l3128"><span class="linenum">3128</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>('nextruntime_idx', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('nextruntime'));
<a name="l3129"><span class="linenum">3129</span></a>  
<a name="l3130"><span class="linenum">3130</span></a>  <span class="comment">        // Conditionally launch create table for task_adhoc.</span>
<a name="l3131"><span class="linenum">3131</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l3132"><span class="linenum">3132</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l3133"><span class="linenum">3133</span></a>          }
<a name="l3134"><span class="linenum">3134</span></a>  
<a name="l3135"><span class="linenum">3135</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3136"><span class="linenum">3136</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014022600.00);
<a name="l3137"><span class="linenum">3137</span></a>      }
<a name="l3138"><span class="linenum">3138</span></a>  
<a name="l3139"><span class="linenum">3139</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014031400.02) {
<a name="l3140"><span class="linenum">3140</span></a>  <span class="comment">        // Delete any cached stats to force recalculation later, then we can be sure that cached records will have the correct</span>
<a name="l3141"><span class="linenum">3141</span></a>  <span class="comment">        // field.</span>
<a name="l3142"><span class="linenum">3142</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('question_response_analysis');
<a name="l3143"><span class="linenum">3143</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('question_statistics');
<a name="l3144"><span class="linenum">3144</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('quiz_statistics');
<a name="l3145"><span class="linenum">3145</span></a>  
<a name="l3146"><span class="linenum">3146</span></a>  <span class="comment">        // Define field response to be dropped from question_response_analysis.</span>
<a name="l3147"><span class="linenum">3147</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('question_response_analysis');
<a name="l3148"><span class="linenum">3148</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('rcount');
<a name="l3149"><span class="linenum">3149</span></a>  
<a name="l3150"><span class="linenum">3150</span></a>  <span class="comment">        // Conditionally launch drop field response.</span>
<a name="l3151"><span class="linenum">3151</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3152"><span class="linenum">3152</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3153"><span class="linenum">3153</span></a>          }
<a name="l3154"><span class="linenum">3154</span></a>  
<a name="l3155"><span class="linenum">3155</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3156"><span class="linenum">3156</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014031400.02);
<a name="l3157"><span class="linenum">3157</span></a>      }
<a name="l3158"><span class="linenum">3158</span></a>  
<a name="l3159"><span class="linenum">3159</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014031400.03) {
<a name="l3160"><span class="linenum">3160</span></a>  
<a name="l3161"><span class="linenum">3161</span></a>  <span class="comment">        // Define table question_response_count to be created.</span>
<a name="l3162"><span class="linenum">3162</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('question_response_count');
<a name="l3163"><span class="linenum">3163</span></a>  
<a name="l3164"><span class="linenum">3164</span></a>  <span class="comment">        // Adding fields to table question_response_count.</span>
<a name="l3165"><span class="linenum">3165</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null);
<a name="l3166"><span class="linenum">3166</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('analysisid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l3167"><span class="linenum">3167</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('try', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l3168"><span class="linenum">3168</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('rcount', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l3169"><span class="linenum">3169</span></a>  
<a name="l3170"><span class="linenum">3170</span></a>  <span class="comment">        // Adding keys to table question_response_count.</span>
<a name="l3171"><span class="linenum">3171</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l3172"><span class="linenum">3172</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('analysisid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('analysisid'), 'question_response_analysis', array('id'));
<a name="l3173"><span class="linenum">3173</span></a>  
<a name="l3174"><span class="linenum">3174</span></a>  <span class="comment">        // Conditionally launch create table for question_response_count.</span>
<a name="l3175"><span class="linenum">3175</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l3176"><span class="linenum">3176</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l3177"><span class="linenum">3177</span></a>          }
<a name="l3178"><span class="linenum">3178</span></a>  
<a name="l3179"><span class="linenum">3179</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3180"><span class="linenum">3180</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014031400.03);
<a name="l3181"><span class="linenum">3181</span></a>      }
<a name="l3182"><span class="linenum">3182</span></a>  
<a name="l3183"><span class="linenum">3183</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014031400.04) {
<a name="l3184"><span class="linenum">3184</span></a>  
<a name="l3185"><span class="linenum">3185</span></a>  <span class="comment">        // Define field whichtries to be added to question_response_analysis.</span>
<a name="l3186"><span class="linenum">3186</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('question_response_analysis');
<a name="l3187"><span class="linenum">3187</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('whichtries', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'hashcode');
<a name="l3188"><span class="linenum">3188</span></a>  
<a name="l3189"><span class="linenum">3189</span></a>  <span class="comment">        // Conditionally launch add field whichtries.</span>
<a name="l3190"><span class="linenum">3190</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3191"><span class="linenum">3191</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3192"><span class="linenum">3192</span></a>          }
<a name="l3193"><span class="linenum">3193</span></a>  
<a name="l3194"><span class="linenum">3194</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3195"><span class="linenum">3195</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014031400.04);
<a name="l3196"><span class="linenum">3196</span></a>      }
<a name="l3197"><span class="linenum">3197</span></a>  
<a name="l3198"><span class="linenum">3198</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014032600.00) {
<a name="l3199"><span class="linenum">3199</span></a>  <span class="comment">        // Removing the themes from core.</span>
<a name="l3200"><span class="linenum">3200</span></a>          <a class="var it1187" onMouseOver="hilite(1187)" onMouseOut="lolite()" onClick="logVariable('themes')" href="../../_variables/themes.html">$themes</a> = array('afterburner', 'anomaly', 'arialist', 'binarius', 'boxxie', 'brick', 'formal_white', 'formfactor',
<a name="l3201"><span class="linenum">3201</span></a>              'fusion', 'leatherbound', 'magazine', 'nimble', 'nonzero', 'overlay', 'serenity', 'sky_high', 'splash',
<a name="l3202"><span class="linenum">3202</span></a>              'standard', 'standardold');
<a name="l3203"><span class="linenum">3203</span></a>  
<a name="l3204"><span class="linenum">3204</span></a>          foreach (<a class="var it1187" onMouseOver="hilite(1187)" onMouseOut="lolite()" onClick="logVariable('themes')" href="../../_variables/themes.html">$themes</a> as <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> =&gt; <a class="var it1114" onMouseOver="hilite(1114)" onMouseOut="lolite()" onClick="logVariable('theme')" href="../../_variables/theme.html">$theme</a>) {
<a name="l3205"><span class="linenum">3205</span></a>              if (<a class="function" onClick="logFunction('check_dir_exists')" href="../../_functions/check_dir_exists.html" onMouseOver="funcPopup(event,'check_dir_exists')">check_dir_exists</a>(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a> . '/theme/' . <a class="var it1114" onMouseOver="hilite(1114)" onMouseOut="lolite()" onClick="logVariable('theme')" href="../../_variables/theme.html">$theme</a>, false)) {
<a name="l3206"><span class="linenum">3206</span></a>  <span class="comment">                // Ignore the themes that have been re-downloaded.</span>
<a name="l3207"><span class="linenum">3207</span></a>                  unset(<a class="var it1187" onMouseOver="hilite(1187)" onMouseOut="lolite()" onClick="logVariable('themes')" href="../../_variables/themes.html">$themes</a>[<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>]);
<a name="l3208"><span class="linenum">3208</span></a>              }
<a name="l3209"><span class="linenum">3209</span></a>          }
<a name="l3210"><span class="linenum">3210</span></a>  
<a name="l3211"><span class="linenum">3211</span></a>  <span class="comment">        // Check we actually have themes to remove.</span>
<a name="l3212"><span class="linenum">3212</span></a>          if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it1187" onMouseOver="hilite(1187)" onMouseOut="lolite()" onClick="logVariable('themes')" href="../../_variables/themes.html">$themes</a>) &gt; 0) {
<a name="l3213"><span class="linenum">3213</span></a>  
<a name="l3214"><span class="linenum">3214</span></a>  <span class="comment">            // Replace the theme configs.</span>
<a name="l3215"><span class="linenum">3215</span></a>              if (<a class="phpfunction" onClick="logFunction('in_array')" href="../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('core', 'theme'), <a class="var it1187" onMouseOver="hilite(1187)" onMouseOut="lolite()" onClick="logVariable('themes')" href="../../_variables/themes.html">$themes</a>)) {
<a name="l3216"><span class="linenum">3216</span></a>                  <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('theme', 'clean');
<a name="l3217"><span class="linenum">3217</span></a>              }
<a name="l3218"><span class="linenum">3218</span></a>              if (<a class="phpfunction" onClick="logFunction('in_array')" href="../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('core', 'thememobile'), <a class="var it1187" onMouseOver="hilite(1187)" onMouseOut="lolite()" onClick="logVariable('themes')" href="../../_variables/themes.html">$themes</a>)) {
<a name="l3219"><span class="linenum">3219</span></a>                  <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('thememobile', 'clean');
<a name="l3220"><span class="linenum">3220</span></a>              }
<a name="l3221"><span class="linenum">3221</span></a>              if (<a class="phpfunction" onClick="logFunction('in_array')" href="../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('core', 'themelegacy'), <a class="var it1187" onMouseOver="hilite(1187)" onMouseOut="lolite()" onClick="logVariable('themes')" href="../../_variables/themes.html">$themes</a>)) {
<a name="l3222"><span class="linenum">3222</span></a>                  <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('themelegacy', 'clean');
<a name="l3223"><span class="linenum">3223</span></a>              }
<a name="l3224"><span class="linenum">3224</span></a>              if (<a class="phpfunction" onClick="logFunction('in_array')" href="../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('core', 'themetablet'), <a class="var it1187" onMouseOver="hilite(1187)" onMouseOut="lolite()" onClick="logVariable('themes')" href="../../_variables/themes.html">$themes</a>)) {
<a name="l3225"><span class="linenum">3225</span></a>                  <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('themetablet', 'clean');
<a name="l3226"><span class="linenum">3226</span></a>              }
<a name="l3227"><span class="linenum">3227</span></a>          }
<a name="l3228"><span class="linenum">3228</span></a>  
<a name="l3229"><span class="linenum">3229</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3230"><span class="linenum">3230</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014032600.00);
<a name="l3231"><span class="linenum">3231</span></a>      }
<a name="l3232"><span class="linenum">3232</span></a>  
<a name="l3233"><span class="linenum">3233</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014032600.02) {
<a name="l3234"><span class="linenum">3234</span></a>  <span class="comment">        // Add new fields to the 'tag_instance' table.</span>
<a name="l3235"><span class="linenum">3235</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('tag_instance');
<a name="l3236"><span class="linenum">3236</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('component', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '100', null, false, null, null, 'tagid');
<a name="l3237"><span class="linenum">3237</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3238"><span class="linenum">3238</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3239"><span class="linenum">3239</span></a>          }
<a name="l3240"><span class="linenum">3240</span></a>  
<a name="l3241"><span class="linenum">3241</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('contextid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, false, null, null, 'itemid');
<a name="l3242"><span class="linenum">3242</span></a>  <span class="comment">        // Define the 'contextid' foreign key to be added to the tag_instance table.</span>
<a name="l3243"><span class="linenum">3243</span></a>          <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_key')" href="../../_classes/xmldb_key.html" onMouseOver="classPopup(event,'xmldb_key')">xmldb_key</a>('contextid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('contextid'), 'context', array('id'));
<a name="l3244"><span class="linenum">3244</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3245"><span class="linenum">3245</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_key')" href="../../_functions/drop_key.html" onMouseOver="funcPopup(event,'drop_key')">drop_key</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>);
<a name="l3246"><span class="linenum">3246</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('tag_instance', 'contextid', null, array('contextid' =&gt; 0));
<a name="l3247"><span class="linenum">3247</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('change_field_default')" href="../../_functions/change_field_default.html" onMouseOver="funcPopup(event,'change_field_default')">change_field_default</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3248"><span class="linenum">3248</span></a>          } else {
<a name="l3249"><span class="linenum">3249</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3250"><span class="linenum">3250</span></a>          }
<a name="l3251"><span class="linenum">3251</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>);
<a name="l3252"><span class="linenum">3252</span></a>  
<a name="l3253"><span class="linenum">3253</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('timecreated', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'ordering');
<a name="l3254"><span class="linenum">3254</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3255"><span class="linenum">3255</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3256"><span class="linenum">3256</span></a>          }
<a name="l3257"><span class="linenum">3257</span></a>  
<a name="l3258"><span class="linenum">3258</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;UPDATE {tag_instance}
<a name="l3259"><span class="linenum">3259</span></a>                     SET timecreated = timemodified&quot;;
<a name="l3260"><span class="linenum">3260</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l3261"><span class="linenum">3261</span></a>  
<a name="l3262"><span class="linenum">3262</span></a>  <span class="comment">        // Update all the course tags.</span>
<a name="l3263"><span class="linenum">3263</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;UPDATE {tag_instance}
<a name="l3264"><span class="linenum">3264</span></a>                     SET component = 'core',
<a name="l3265"><span class="linenum">3265</span></a>                         contextid = (SELECT ctx.id
<a name="l3266"><span class="linenum">3266</span></a>                                        FROM {context} ctx
<a name="l3267"><span class="linenum">3267</span></a>                                       WHERE ctx.contextlevel = :contextlevel
<a name="l3268"><span class="linenum">3268</span></a>                                         AND ctx.instanceid = {tag_instance}.itemid)
<a name="l3269"><span class="linenum">3269</span></a>                   WHERE itemtype = 'course' AND contextid IS NULL&quot;;
<a name="l3270"><span class="linenum">3270</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array('contextlevel' =&gt; <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>));
<a name="l3271"><span class="linenum">3271</span></a>  
<a name="l3272"><span class="linenum">3272</span></a>  <span class="comment">        // Update all the user tags.</span>
<a name="l3273"><span class="linenum">3273</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;UPDATE {tag_instance}
<a name="l3274"><span class="linenum">3274</span></a>                     SET component = 'core',
<a name="l3275"><span class="linenum">3275</span></a>                         contextid = (SELECT ctx.id
<a name="l3276"><span class="linenum">3276</span></a>                                        FROM {context} ctx
<a name="l3277"><span class="linenum">3277</span></a>                                       WHERE ctx.contextlevel = :contextlevel
<a name="l3278"><span class="linenum">3278</span></a>                                         AND ctx.instanceid = {tag_instance}.itemid)
<a name="l3279"><span class="linenum">3279</span></a>                   WHERE itemtype = 'user' AND contextid IS NULL&quot;;
<a name="l3280"><span class="linenum">3280</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array('contextlevel' =&gt; <a class="constant" onClick="logConstant('CONTEXT_USER')" href="../../_constants/CONTEXT_USER.html" onMouseOver="constPopup(event,'CONTEXT_USER')">CONTEXT_USER</a>));
<a name="l3281"><span class="linenum">3281</span></a>  
<a name="l3282"><span class="linenum">3282</span></a>  <span class="comment">        // Update all the blog post tags.</span>
<a name="l3283"><span class="linenum">3283</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;UPDATE {tag_instance}
<a name="l3284"><span class="linenum">3284</span></a>                     SET component = 'core',
<a name="l3285"><span class="linenum">3285</span></a>                         contextid = (SELECT ctx.id
<a name="l3286"><span class="linenum">3286</span></a>                                        FROM {context} ctx
<a name="l3287"><span class="linenum">3287</span></a>                                        JOIN {post} p
<a name="l3288"><span class="linenum">3288</span></a>                                          ON p.userid = ctx.instanceid
<a name="l3289"><span class="linenum">3289</span></a>                                       WHERE ctx.contextlevel = :contextlevel
<a name="l3290"><span class="linenum">3290</span></a>                                         AND p.id = {tag_instance}.itemid)
<a name="l3291"><span class="linenum">3291</span></a>                   WHERE itemtype = 'post' AND contextid IS NULL&quot;;
<a name="l3292"><span class="linenum">3292</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array('contextlevel' =&gt; <a class="constant" onClick="logConstant('CONTEXT_USER')" href="../../_constants/CONTEXT_USER.html" onMouseOver="constPopup(event,'CONTEXT_USER')">CONTEXT_USER</a>));
<a name="l3293"><span class="linenum">3293</span></a>  
<a name="l3294"><span class="linenum">3294</span></a>  <span class="comment">        // Update all the wiki page tags.</span>
<a name="l3295"><span class="linenum">3295</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;UPDATE {tag_instance}
<a name="l3296"><span class="linenum">3296</span></a>                     SET component = 'mod_wiki',
<a name="l3297"><span class="linenum">3297</span></a>                         contextid = (SELECT ctx.id
<a name="l3298"><span class="linenum">3298</span></a>                                        FROM {context} ctx
<a name="l3299"><span class="linenum">3299</span></a>                                        JOIN {course_modules} cm
<a name="l3300"><span class="linenum">3300</span></a>                                          ON cm.id = ctx.instanceid
<a name="l3301"><span class="linenum">3301</span></a>                                        JOIN {modules} m
<a name="l3302"><span class="linenum">3302</span></a>                                          ON m.id = cm.module
<a name="l3303"><span class="linenum">3303</span></a>                                        JOIN {wiki} w
<a name="l3304"><span class="linenum">3304</span></a>                                          ON w.id = cm.instance
<a name="l3305"><span class="linenum">3305</span></a>                                        JOIN {wiki_subwikis} sw
<a name="l3306"><span class="linenum">3306</span></a>                                          ON sw.wikiid = w.id
<a name="l3307"><span class="linenum">3307</span></a>                                        JOIN {wiki_pages} wp
<a name="l3308"><span class="linenum">3308</span></a>                                          ON wp.subwikiid = sw.id
<a name="l3309"><span class="linenum">3309</span></a>                                       WHERE m.name = 'wiki'
<a name="l3310"><span class="linenum">3310</span></a>                                         AND ctx.contextlevel = :contextlevel
<a name="l3311"><span class="linenum">3311</span></a>                                         AND wp.id = {tag_instance}.itemid)
<a name="l3312"><span class="linenum">3312</span></a>                   WHERE itemtype = 'wiki_pages' AND contextid IS NULL&quot;;
<a name="l3313"><span class="linenum">3313</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array('contextlevel' =&gt; <a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>));
<a name="l3314"><span class="linenum">3314</span></a>  
<a name="l3315"><span class="linenum">3315</span></a>  <span class="comment">        // Update all the question tags.</span>
<a name="l3316"><span class="linenum">3316</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;UPDATE {tag_instance}
<a name="l3317"><span class="linenum">3317</span></a>                     SET component = 'core_question',
<a name="l3318"><span class="linenum">3318</span></a>                         contextid = (SELECT qc.contextid
<a name="l3319"><span class="linenum">3319</span></a>                                        FROM {question} q
<a name="l3320"><span class="linenum">3320</span></a>                                        JOIN {question_categories} qc
<a name="l3321"><span class="linenum">3321</span></a>                                          ON q.category = qc.id
<a name="l3322"><span class="linenum">3322</span></a>                                       WHERE q.id = {tag_instance}.itemid)
<a name="l3323"><span class="linenum">3323</span></a>                   WHERE itemtype = 'question' AND contextid IS NULL&quot;;
<a name="l3324"><span class="linenum">3324</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l3325"><span class="linenum">3325</span></a>  
<a name="l3326"><span class="linenum">3326</span></a>  <span class="comment">        // Update all the tag tags.</span>
<a name="l3327"><span class="linenum">3327</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;UPDATE {tag_instance}
<a name="l3328"><span class="linenum">3328</span></a>                     SET component = 'core',
<a name="l3329"><span class="linenum">3329</span></a>                         contextid = :systemcontext
<a name="l3330"><span class="linenum">3330</span></a>                   WHERE itemtype = 'tag' AND contextid IS NULL&quot;;
<a name="l3331"><span class="linenum">3331</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array('systemcontext' =&gt; <a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>()-&gt;id));
<a name="l3332"><span class="linenum">3332</span></a>  
<a name="l3333"><span class="linenum">3333</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3334"><span class="linenum">3334</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014032600.02);
<a name="l3335"><span class="linenum">3335</span></a>      }
<a name="l3336"><span class="linenum">3336</span></a>  
<a name="l3337"><span class="linenum">3337</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014032700.01) {
<a name="l3338"><span class="linenum">3338</span></a>  
<a name="l3339"><span class="linenum">3339</span></a>  <span class="comment">        // Define field disabled to be added to task_scheduled.</span>
<a name="l3340"><span class="linenum">3340</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('task_scheduled');
<a name="l3341"><span class="linenum">3341</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('disabled', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '1', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'customised');
<a name="l3342"><span class="linenum">3342</span></a>  
<a name="l3343"><span class="linenum">3343</span></a>  <span class="comment">        // Conditionally launch add field disabled.</span>
<a name="l3344"><span class="linenum">3344</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3345"><span class="linenum">3345</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3346"><span class="linenum">3346</span></a>          }
<a name="l3347"><span class="linenum">3347</span></a>  
<a name="l3348"><span class="linenum">3348</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3349"><span class="linenum">3349</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014032700.01);
<a name="l3350"><span class="linenum">3350</span></a>      }
<a name="l3351"><span class="linenum">3351</span></a>  
<a name="l3352"><span class="linenum">3352</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014032700.02) {
<a name="l3353"><span class="linenum">3353</span></a>  
<a name="l3354"><span class="linenum">3354</span></a>  <span class="comment">        // Update displayloginfailures setting.</span>
<a name="l3355"><span class="linenum">3355</span></a>          if (empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('displayloginfailures')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/displayloginfailures.html">displayloginfailures</a>)) {
<a name="l3356"><span class="linenum">3356</span></a>              <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('displayloginfailures', 0);
<a name="l3357"><span class="linenum">3357</span></a>          } else {
<a name="l3358"><span class="linenum">3358</span></a>              <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('displayloginfailures', 1);
<a name="l3359"><span class="linenum">3359</span></a>          }
<a name="l3360"><span class="linenum">3360</span></a>  
<a name="l3361"><span class="linenum">3361</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3362"><span class="linenum">3362</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014032700.02);
<a name="l3363"><span class="linenum">3363</span></a>      }
<a name="l3364"><span class="linenum">3364</span></a>  
<a name="l3365"><span class="linenum">3365</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014040800.00) {
<a name="l3366"><span class="linenum">3366</span></a>  
<a name="l3367"><span class="linenum">3367</span></a>  <span class="comment">        // Define field availability to be added to course_modules.</span>
<a name="l3368"><span class="linenum">3368</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_modules');
<a name="l3369"><span class="linenum">3369</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('availability', <a class="constant" onClick="logConstant('XMLDB_TYPE_TEXT')" href="../../_constants/XMLDB_TYPE_TEXT.html" onMouseOver="constPopup(event,'XMLDB_TYPE_TEXT')">XMLDB_TYPE_TEXT</a>, null, null, null, null, null, 'showdescription');
<a name="l3370"><span class="linenum">3370</span></a>  
<a name="l3371"><span class="linenum">3371</span></a>  <span class="comment">        // Conditionally launch add field availability.</span>
<a name="l3372"><span class="linenum">3372</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3373"><span class="linenum">3373</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3374"><span class="linenum">3374</span></a>          }
<a name="l3375"><span class="linenum">3375</span></a>  
<a name="l3376"><span class="linenum">3376</span></a>  <span class="comment">        // Define field availability to be added to course_sections.</span>
<a name="l3377"><span class="linenum">3377</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_sections');
<a name="l3378"><span class="linenum">3378</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('availability', <a class="constant" onClick="logConstant('XMLDB_TYPE_TEXT')" href="../../_constants/XMLDB_TYPE_TEXT.html" onMouseOver="constPopup(event,'XMLDB_TYPE_TEXT')">XMLDB_TYPE_TEXT</a>, null, null, null, null, null, 'groupingid');
<a name="l3379"><span class="linenum">3379</span></a>  
<a name="l3380"><span class="linenum">3380</span></a>  <span class="comment">        // Conditionally launch add field availability.</span>
<a name="l3381"><span class="linenum">3381</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3382"><span class="linenum">3382</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3383"><span class="linenum">3383</span></a>          }
<a name="l3384"><span class="linenum">3384</span></a>  
<a name="l3385"><span class="linenum">3385</span></a>  <span class="comment">        // Update existing conditions to new format. This could be a slow</span>
<a name="l3386"><span class="linenum">3386</span></a>  <span class="comment">        // process, so begin by counting the number of affected modules/sections.</span>
<a name="l3387"><span class="linenum">3387</span></a>  <span class="comment">        // (Performance: On the OU system, these took ~0.3 seconds, with about</span>
<a name="l3388"><span class="linenum">3388</span></a>  <span class="comment">        // 20,000 results out of about 400,000 total rows in those tables.)</span>
<a name="l3389"><span class="linenum">3389</span></a>          <a class="var it8364" onMouseOver="hilite(8364)" onMouseOut="lolite()" onClick="logVariable('cmcount')" href="../../_variables/cmcount.html">$cmcount</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records_sql')" href="../../_functions/count_records_sql.html" onMouseOver="funcPopup(event,'count_records_sql')">count_records_sql</a>(&quot;
<a name="l3390"><span class="linenum">3390</span></a>                  SELECT <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(1)
<a name="l3391"><span class="linenum">3391</span></a>                    FROM {course_modules} cm
<a name="l3392"><span class="linenum">3392</span></a>                   WHERE cm.availablefrom != 0 OR
<a name="l3393"><span class="linenum">3393</span></a>                         cm.availableuntil != 0 OR
<a name="l3394"><span class="linenum">3394</span></a>                         <a class="function" onClick="logFunction('EXISTS')" href="../../_functions/exists.html" onMouseOver="funcPopup(event,'exists')">EXISTS</a> (SELECT 1 FROM {course_modules_availability} WHERE coursemoduleid = cm.id) OR
<a name="l3395"><span class="linenum">3395</span></a>                         <a class="function" onClick="logFunction('EXISTS')" href="../../_functions/exists.html" onMouseOver="funcPopup(event,'exists')">EXISTS</a> (SELECT 1 FROM {course_modules_avail_fields} WHERE coursemoduleid = cm.id)&quot;);
<a name="l3396"><span class="linenum">3396</span></a>          <a class="var it37350" onMouseOver="hilite(37350)" onMouseOut="lolite()" onClick="logVariable('sectcount')" href="../../_variables/sectcount.html">$sectcount</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records_sql')" href="../../_functions/count_records_sql.html" onMouseOver="funcPopup(event,'count_records_sql')">count_records_sql</a>(&quot;
<a name="l3397"><span class="linenum">3397</span></a>                  SELECT <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(1)
<a name="l3398"><span class="linenum">3398</span></a>                    FROM {course_sections} cs
<a name="l3399"><span class="linenum">3399</span></a>                   WHERE cs.groupingid != 0 OR
<a name="l3400"><span class="linenum">3400</span></a>                         cs.availablefrom != 0 OR
<a name="l3401"><span class="linenum">3401</span></a>                         cs.availableuntil != 0 OR
<a name="l3402"><span class="linenum">3402</span></a>                         <a class="function" onClick="logFunction('EXISTS')" href="../../_functions/exists.html" onMouseOver="funcPopup(event,'exists')">EXISTS</a> (SELECT 1 FROM {course_sections_availability} WHERE coursesectionid = cs.id) OR
<a name="l3403"><span class="linenum">3403</span></a>                         <a class="function" onClick="logFunction('EXISTS')" href="../../_functions/exists.html" onMouseOver="funcPopup(event,'exists')">EXISTS</a> (SELECT 1 FROM {course_sections_avail_fields} WHERE coursesectionid = cs.id)&quot;);
<a name="l3404"><span class="linenum">3404</span></a>  
<a name="l3405"><span class="linenum">3405</span></a>          if (<a class="var it8364" onMouseOver="hilite(8364)" onMouseOut="lolite()" onClick="logVariable('cmcount')" href="../../_variables/cmcount.html">$cmcount</a> + <a class="var it37350" onMouseOver="hilite(37350)" onMouseOut="lolite()" onClick="logVariable('sectcount')" href="../../_variables/sectcount.html">$sectcount</a> &gt; 0) {
<a name="l3406"><span class="linenum">3406</span></a>  <span class="comment">            // Show progress bar and start db transaction.</span>
<a name="l3407"><span class="linenum">3407</span></a>              <a class="var it2929" onMouseOver="hilite(2929)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l3408"><span class="linenum">3408</span></a>              <a class="var it8016" onMouseOver="hilite(8016)" onMouseOut="lolite()" onClick="logVariable('pbar')" href="../../_variables/pbar.html">$pbar</a> = <span class="keyword">new </span><a class="class" onClick="logClass('progress_bar')" href="../../_classes/progress_bar.html" onMouseOver="classPopup(event,'progress_bar')">progress_bar</a>('availupdate', 500, true);
<a name="l3409"><span class="linenum">3409</span></a>  
<a name="l3410"><span class="linenum">3410</span></a>  <span class="comment">            // Loop through all course-modules.</span>
<a name="l3411"><span class="linenum">3411</span></a>  <span class="comment">            // (Performance: On the OU system, the query took &lt;1 second for ~20k</span>
<a name="l3412"><span class="linenum">3412</span></a>  <span class="comment">            // results; updating all those entries took ~3 minutes.)</span>
<a name="l3413"><span class="linenum">3413</span></a>              <a class="var it6074" onMouseOver="hilite(6074)" onMouseOut="lolite()" onClick="logVariable('done')" href="../../_variables/done.html">$done</a> = 0;
<a name="l3414"><span class="linenum">3414</span></a>              <a class="var it23865" onMouseOver="hilite(23865)" onMouseOut="lolite()" onClick="logVariable('lastupdate')" href="../../_variables/lastupdate.html">$lastupdate</a> = 0;
<a name="l3415"><span class="linenum">3415</span></a>              <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(&quot;
<a name="l3416"><span class="linenum">3416</span></a>                      SELECT cm.id, cm.availablefrom, cm.availableuntil, cm.showavailability,
<a name="l3417"><span class="linenum">3417</span></a>                             <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(DISTINCT cma.id) AS availcount,
<a name="l3418"><span class="linenum">3418</span></a>                             <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(DISTINCT cmf.id) AS fieldcount
<a name="l3419"><span class="linenum">3419</span></a>                        FROM {course_modules} cm
<a name="l3420"><span class="linenum">3420</span></a>                             LEFT JOIN {course_modules_availability} cma ON cma.coursemoduleid = cm.id
<a name="l3421"><span class="linenum">3421</span></a>                             LEFT JOIN {course_modules_avail_fields} cmf ON cmf.coursemoduleid = cm.id
<a name="l3422"><span class="linenum">3422</span></a>                       WHERE cm.availablefrom != 0 OR
<a name="l3423"><span class="linenum">3423</span></a>                             cm.availableuntil != 0 OR
<a name="l3424"><span class="linenum">3424</span></a>                             cma.id IS NOT NULL OR
<a name="l3425"><span class="linenum">3425</span></a>                             cmf.id IS NOT NULL
<a name="l3426"><span class="linenum">3426</span></a>                    GROUP BY cm.id, cm.availablefrom, cm.availableuntil, cm.showavailability&quot;);
<a name="l3427"><span class="linenum">3427</span></a>              foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>) {
<a name="l3428"><span class="linenum">3428</span></a>  <span class="comment">                // Update progress initially and then once per second.</span>
<a name="l3429"><span class="linenum">3429</span></a>                  if (<a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() != <a class="var it23865" onMouseOver="hilite(23865)" onMouseOut="lolite()" onClick="logVariable('lastupdate')" href="../../_variables/lastupdate.html">$lastupdate</a>) {
<a name="l3430"><span class="linenum">3430</span></a>                      <a class="var it23865" onMouseOver="hilite(23865)" onMouseOut="lolite()" onClick="logVariable('lastupdate')" href="../../_variables/lastupdate.html">$lastupdate</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l3431"><span class="linenum">3431</span></a>                      <a class="var it8016" onMouseOver="hilite(8016)" onMouseOut="lolite()" onClick="logVariable('pbar')" href="../../_variables/pbar.html">$pbar</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>(<a class="var it6074" onMouseOver="hilite(6074)" onMouseOut="lolite()" onClick="logVariable('done')" href="../../_variables/done.html">$done</a>, <a class="var it8364" onMouseOver="hilite(8364)" onMouseOut="lolite()" onClick="logVariable('cmcount')" href="../../_variables/cmcount.html">$cmcount</a> + <a class="var it37350" onMouseOver="hilite(37350)" onMouseOut="lolite()" onClick="logVariable('sectcount')" href="../../_variables/sectcount.html">$sectcount</a>,
<a name="l3432"><span class="linenum">3432</span></a>                              &quot;Updating activity availability <a class="function" onClick="logFunction('settings')" href="../../_functions/settings.html" onMouseOver="funcPopup(event,'settings')">settings</a> (<a class="var it6074" onMouseOver="hilite(6074)" onMouseOut="lolite()" onClick="logVariable('done')" href="../../_variables/done.html">$done</a>/<a class="var it8364" onMouseOver="hilite(8364)" onMouseOut="lolite()" onClick="logVariable('cmcount')" href="../../_variables/cmcount.html">$cmcount</a>)&quot;);
<a name="l3433"><span class="linenum">3433</span></a>                  }
<a name="l3434"><span class="linenum">3434</span></a>  
<a name="l3435"><span class="linenum">3435</span></a>  <span class="comment">                // Get supporting records - only if there are any (to reduce the</span>
<a name="l3436"><span class="linenum">3436</span></a>  <span class="comment">                // number of queries where just date/group is used).</span>
<a name="l3437"><span class="linenum">3437</span></a>                  if (<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('availcount')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/availcount.html">availcount</a>) {
<a name="l3438"><span class="linenum">3438</span></a>                      <a class="var it21053" onMouseOver="hilite(21053)" onMouseOut="lolite()" onClick="logVariable('availrecs')" href="../../_variables/availrecs.html">$availrecs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('course_modules_availability',
<a name="l3439"><span class="linenum">3439</span></a>                              array('coursemoduleid' =&gt; <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('id')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l3440"><span class="linenum">3440</span></a>                  } else {
<a name="l3441"><span class="linenum">3441</span></a>                      <a class="var it21053" onMouseOver="hilite(21053)" onMouseOut="lolite()" onClick="logVariable('availrecs')" href="../../_variables/availrecs.html">$availrecs</a> = array();
<a name="l3442"><span class="linenum">3442</span></a>                  }
<a name="l3443"><span class="linenum">3443</span></a>                  if (<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('fieldcount')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/fieldcount.html">fieldcount</a>) {
<a name="l3444"><span class="linenum">3444</span></a>                      <a class="var it21054" onMouseOver="hilite(21054)" onMouseOut="lolite()" onClick="logVariable('fieldrecs')" href="../../_variables/fieldrecs.html">$fieldrecs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;
<a name="l3445"><span class="linenum">3445</span></a>                              SELECT cmaf.userfield, cmaf.operator, cmaf.value, uif.shortname
<a name="l3446"><span class="linenum">3446</span></a>                                FROM {course_modules_avail_fields} cmaf
<a name="l3447"><span class="linenum">3447</span></a>                           LEFT JOIN {user_info_field} uif ON uif.id = cmaf.customfieldid
<a name="l3448"><span class="linenum">3448</span></a>                               WHERE cmaf.coursemoduleid = ?&quot;, array(<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('id')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l3449"><span class="linenum">3449</span></a>                  } else {
<a name="l3450"><span class="linenum">3450</span></a>                      <a class="var it21054" onMouseOver="hilite(21054)" onMouseOut="lolite()" onClick="logVariable('fieldrecs')" href="../../_variables/fieldrecs.html">$fieldrecs</a> = array();
<a name="l3451"><span class="linenum">3451</span></a>                  }
<a name="l3452"><span class="linenum">3452</span></a>  
<a name="l3453"><span class="linenum">3453</span></a>  <span class="comment">                // Update item.</span>
<a name="l3454"><span class="linenum">3454</span></a>                  <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('availability')" href="../../_variables/availability.html">$availability</a> = <a class="function" onClick="logFunction('upgrade_availability_item')" href="../../_functions/upgrade_availability_item.html" onMouseOver="funcPopup(event,'upgrade_availability_item')">upgrade_availability_item</a>(0, 0,
<a name="l3455"><span class="linenum">3455</span></a>                          <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('availablefrom')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/availablefrom.html">availablefrom</a>, <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('availableuntil')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/availableuntil.html">availableuntil</a>,
<a name="l3456"><span class="linenum">3456</span></a>                          <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('showavailability')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/showavailability.html">showavailability</a>, <a class="var it21053" onMouseOver="hilite(21053)" onMouseOut="lolite()" onClick="logVariable('availrecs')" href="../../_variables/availrecs.html">$availrecs</a>, <a class="var it21054" onMouseOver="hilite(21054)" onMouseOut="lolite()" onClick="logVariable('fieldrecs')" href="../../_variables/fieldrecs.html">$fieldrecs</a>);
<a name="l3457"><span class="linenum">3457</span></a>                  if (<a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('availability')" href="../../_variables/availability.html">$availability</a>) {
<a name="l3458"><span class="linenum">3458</span></a>                      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('course_modules', 'availability', <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('availability')" href="../../_variables/availability.html">$availability</a>, array('id' =&gt; <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('id')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l3459"><span class="linenum">3459</span></a>                  }
<a name="l3460"><span class="linenum">3460</span></a>  
<a name="l3461"><span class="linenum">3461</span></a>  <span class="comment">                // Update progress.</span>
<a name="l3462"><span class="linenum">3462</span></a>                  <a class="var it6074" onMouseOver="hilite(6074)" onMouseOut="lolite()" onClick="logVariable('done')" href="../../_variables/done.html">$done</a>++;
<a name="l3463"><span class="linenum">3463</span></a>              }
<a name="l3464"><span class="linenum">3464</span></a>              <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l3465"><span class="linenum">3465</span></a>  
<a name="l3466"><span class="linenum">3466</span></a>  <span class="comment">            // Loop through all course-sections.</span>
<a name="l3467"><span class="linenum">3467</span></a>  <span class="comment">            // (Performance: On the OU system, this took &lt;1 second for, er, 150 results.)</span>
<a name="l3468"><span class="linenum">3468</span></a>              <a class="var it6074" onMouseOver="hilite(6074)" onMouseOut="lolite()" onClick="logVariable('done')" href="../../_variables/done.html">$done</a> = 0;
<a name="l3469"><span class="linenum">3469</span></a>              <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(&quot;
<a name="l3470"><span class="linenum">3470</span></a>                      SELECT cs.id, cs.groupingid, cs.availablefrom,
<a name="l3471"><span class="linenum">3471</span></a>                             cs.availableuntil, cs.showavailability,
<a name="l3472"><span class="linenum">3472</span></a>                             <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(DISTINCT csa.id) AS availcount,
<a name="l3473"><span class="linenum">3473</span></a>                             <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(DISTINCT csf.id) AS fieldcount
<a name="l3474"><span class="linenum">3474</span></a>                        FROM {course_sections} cs
<a name="l3475"><span class="linenum">3475</span></a>                             LEFT JOIN {course_sections_availability} csa ON csa.coursesectionid = cs.id
<a name="l3476"><span class="linenum">3476</span></a>                             LEFT JOIN {course_sections_avail_fields} csf ON csf.coursesectionid = cs.id
<a name="l3477"><span class="linenum">3477</span></a>                       WHERE cs.groupingid != 0 OR
<a name="l3478"><span class="linenum">3478</span></a>                             cs.availablefrom != 0 OR
<a name="l3479"><span class="linenum">3479</span></a>                             cs.availableuntil != 0 OR
<a name="l3480"><span class="linenum">3480</span></a>                             csa.id IS NOT NULL OR
<a name="l3481"><span class="linenum">3481</span></a>                             csf.id IS NOT NULL
<a name="l3482"><span class="linenum">3482</span></a>                    GROUP BY cs.id, cs.groupingid, cs.availablefrom,
<a name="l3483"><span class="linenum">3483</span></a>                             cs.availableuntil, cs.showavailability&quot;);
<a name="l3484"><span class="linenum">3484</span></a>              foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>) {
<a name="l3485"><span class="linenum">3485</span></a>  <span class="comment">                // Update progress once per second.</span>
<a name="l3486"><span class="linenum">3486</span></a>                  if (<a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() != <a class="var it23865" onMouseOver="hilite(23865)" onMouseOut="lolite()" onClick="logVariable('lastupdate')" href="../../_variables/lastupdate.html">$lastupdate</a>) {
<a name="l3487"><span class="linenum">3487</span></a>                      <a class="var it23865" onMouseOver="hilite(23865)" onMouseOut="lolite()" onClick="logVariable('lastupdate')" href="../../_variables/lastupdate.html">$lastupdate</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l3488"><span class="linenum">3488</span></a>                      <a class="var it8016" onMouseOver="hilite(8016)" onMouseOut="lolite()" onClick="logVariable('pbar')" href="../../_variables/pbar.html">$pbar</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>(<a class="var it6074" onMouseOver="hilite(6074)" onMouseOut="lolite()" onClick="logVariable('done')" href="../../_variables/done.html">$done</a> + <a class="var it8364" onMouseOver="hilite(8364)" onMouseOut="lolite()" onClick="logVariable('cmcount')" href="../../_variables/cmcount.html">$cmcount</a>, <a class="var it8364" onMouseOver="hilite(8364)" onMouseOut="lolite()" onClick="logVariable('cmcount')" href="../../_variables/cmcount.html">$cmcount</a> + <a class="var it37350" onMouseOver="hilite(37350)" onMouseOut="lolite()" onClick="logVariable('sectcount')" href="../../_variables/sectcount.html">$sectcount</a>,
<a name="l3489"><span class="linenum">3489</span></a>                              &quot;Updating section availability <a class="function" onClick="logFunction('settings')" href="../../_functions/settings.html" onMouseOver="funcPopup(event,'settings')">settings</a> (<a class="var it6074" onMouseOver="hilite(6074)" onMouseOut="lolite()" onClick="logVariable('done')" href="../../_variables/done.html">$done</a>/<a class="var it37350" onMouseOver="hilite(37350)" onMouseOut="lolite()" onClick="logVariable('sectcount')" href="../../_variables/sectcount.html">$sectcount</a>)&quot;);
<a name="l3490"><span class="linenum">3490</span></a>                  }
<a name="l3491"><span class="linenum">3491</span></a>  
<a name="l3492"><span class="linenum">3492</span></a>  <span class="comment">                // Get supporting records - only if there are any (to reduce the</span>
<a name="l3493"><span class="linenum">3493</span></a>  <span class="comment">                // number of queries where just date/group is used).</span>
<a name="l3494"><span class="linenum">3494</span></a>                  if (<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('availcount')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/availcount.html">availcount</a>) {
<a name="l3495"><span class="linenum">3495</span></a>                      <a class="var it21053" onMouseOver="hilite(21053)" onMouseOut="lolite()" onClick="logVariable('availrecs')" href="../../_variables/availrecs.html">$availrecs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('course_sections_availability',
<a name="l3496"><span class="linenum">3496</span></a>                              array('coursesectionid' =&gt; <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('id')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l3497"><span class="linenum">3497</span></a>                  } else {
<a name="l3498"><span class="linenum">3498</span></a>                      <a class="var it21053" onMouseOver="hilite(21053)" onMouseOut="lolite()" onClick="logVariable('availrecs')" href="../../_variables/availrecs.html">$availrecs</a> = array();
<a name="l3499"><span class="linenum">3499</span></a>                  }
<a name="l3500"><span class="linenum">3500</span></a>                  if (<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('fieldcount')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/fieldcount.html">fieldcount</a>) {
<a name="l3501"><span class="linenum">3501</span></a>                      <a class="var it21054" onMouseOver="hilite(21054)" onMouseOut="lolite()" onClick="logVariable('fieldrecs')" href="../../_variables/fieldrecs.html">$fieldrecs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;
<a name="l3502"><span class="linenum">3502</span></a>                              SELECT csaf.userfield, csaf.operator, csaf.value, uif.shortname
<a name="l3503"><span class="linenum">3503</span></a>                                FROM {course_sections_avail_fields} csaf
<a name="l3504"><span class="linenum">3504</span></a>                           LEFT JOIN {user_info_field} uif ON uif.id = csaf.customfieldid
<a name="l3505"><span class="linenum">3505</span></a>                               WHERE csaf.coursesectionid = ?&quot;, array(<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('id')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l3506"><span class="linenum">3506</span></a>                  } else {
<a name="l3507"><span class="linenum">3507</span></a>                      <a class="var it21054" onMouseOver="hilite(21054)" onMouseOut="lolite()" onClick="logVariable('fieldrecs')" href="../../_variables/fieldrecs.html">$fieldrecs</a> = array();
<a name="l3508"><span class="linenum">3508</span></a>                  }
<a name="l3509"><span class="linenum">3509</span></a>  
<a name="l3510"><span class="linenum">3510</span></a>  <span class="comment">                // Update item.</span>
<a name="l3511"><span class="linenum">3511</span></a>                  <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('availability')" href="../../_variables/availability.html">$availability</a> = <a class="function" onClick="logFunction('upgrade_availability_item')" href="../../_functions/upgrade_availability_item.html" onMouseOver="funcPopup(event,'upgrade_availability_item')">upgrade_availability_item</a>(<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('groupingid')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/groupingid.html">groupingid</a> ? 1 : 0,
<a name="l3512"><span class="linenum">3512</span></a>                          <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('groupingid')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/groupingid.html">groupingid</a>, <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('availablefrom')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/availablefrom.html">availablefrom</a>, <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('availableuntil')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/availableuntil.html">availableuntil</a>,
<a name="l3513"><span class="linenum">3513</span></a>                          <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('showavailability')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/showavailability.html">showavailability</a>, <a class="var it21053" onMouseOver="hilite(21053)" onMouseOut="lolite()" onClick="logVariable('availrecs')" href="../../_variables/availrecs.html">$availrecs</a>, <a class="var it21054" onMouseOver="hilite(21054)" onMouseOut="lolite()" onClick="logVariable('fieldrecs')" href="../../_variables/fieldrecs.html">$fieldrecs</a>);
<a name="l3514"><span class="linenum">3514</span></a>                  if (<a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('availability')" href="../../_variables/availability.html">$availability</a>) {
<a name="l3515"><span class="linenum">3515</span></a>                      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('course_sections', 'availability', <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('availability')" href="../../_variables/availability.html">$availability</a>, array('id' =&gt; <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('id')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l3516"><span class="linenum">3516</span></a>                  }
<a name="l3517"><span class="linenum">3517</span></a>  
<a name="l3518"><span class="linenum">3518</span></a>  <span class="comment">                // Update progress.</span>
<a name="l3519"><span class="linenum">3519</span></a>                  <a class="var it6074" onMouseOver="hilite(6074)" onMouseOut="lolite()" onClick="logVariable('done')" href="../../_variables/done.html">$done</a>++;
<a name="l3520"><span class="linenum">3520</span></a>              }
<a name="l3521"><span class="linenum">3521</span></a>              <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l3522"><span class="linenum">3522</span></a>  
<a name="l3523"><span class="linenum">3523</span></a>  <span class="comment">            // Final progress update for 100%.</span>
<a name="l3524"><span class="linenum">3524</span></a>              <a class="var it8016" onMouseOver="hilite(8016)" onMouseOut="lolite()" onClick="logVariable('pbar')" href="../../_variables/pbar.html">$pbar</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>(<a class="var it6074" onMouseOver="hilite(6074)" onMouseOut="lolite()" onClick="logVariable('done')" href="../../_variables/done.html">$done</a> + <a class="var it8364" onMouseOver="hilite(8364)" onMouseOut="lolite()" onClick="logVariable('cmcount')" href="../../_variables/cmcount.html">$cmcount</a>, <a class="var it8364" onMouseOver="hilite(8364)" onMouseOut="lolite()" onClick="logVariable('cmcount')" href="../../_variables/cmcount.html">$cmcount</a> + <a class="var it37350" onMouseOver="hilite(37350)" onMouseOut="lolite()" onClick="logVariable('sectcount')" href="../../_variables/sectcount.html">$sectcount</a>,
<a name="l3525"><span class="linenum">3525</span></a>                      'Availability settings updated for ' . (<a class="var it8364" onMouseOver="hilite(8364)" onMouseOut="lolite()" onClick="logVariable('cmcount')" href="../../_variables/cmcount.html">$cmcount</a> + <a class="var it37350" onMouseOver="hilite(37350)" onMouseOut="lolite()" onClick="logVariable('sectcount')" href="../../_variables/sectcount.html">$sectcount</a>) .
<a name="l3526"><span class="linenum">3526</span></a>                      ' activities and sections');
<a name="l3527"><span class="linenum">3527</span></a>  
<a name="l3528"><span class="linenum">3528</span></a>              <a class="var it2929" onMouseOver="hilite(2929)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l3529"><span class="linenum">3529</span></a>          }
<a name="l3530"><span class="linenum">3530</span></a>  
<a name="l3531"><span class="linenum">3531</span></a>  <span class="comment">        // Drop tables which are not necessary because they are covered by the</span>
<a name="l3532"><span class="linenum">3532</span></a>  <span class="comment">        // new availability fields.</span>
<a name="l3533"><span class="linenum">3533</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_modules_availability');
<a name="l3534"><span class="linenum">3534</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l3535"><span class="linenum">3535</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_table')" href="../../_functions/drop_table.html" onMouseOver="funcPopup(event,'drop_table')">drop_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l3536"><span class="linenum">3536</span></a>          }
<a name="l3537"><span class="linenum">3537</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_modules_avail_fields');
<a name="l3538"><span class="linenum">3538</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l3539"><span class="linenum">3539</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_table')" href="../../_functions/drop_table.html" onMouseOver="funcPopup(event,'drop_table')">drop_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l3540"><span class="linenum">3540</span></a>          }
<a name="l3541"><span class="linenum">3541</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_sections_availability');
<a name="l3542"><span class="linenum">3542</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l3543"><span class="linenum">3543</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_table')" href="../../_functions/drop_table.html" onMouseOver="funcPopup(event,'drop_table')">drop_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l3544"><span class="linenum">3544</span></a>          }
<a name="l3545"><span class="linenum">3545</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_sections_avail_fields');
<a name="l3546"><span class="linenum">3546</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l3547"><span class="linenum">3547</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_table')" href="../../_functions/drop_table.html" onMouseOver="funcPopup(event,'drop_table')">drop_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l3548"><span class="linenum">3548</span></a>          }
<a name="l3549"><span class="linenum">3549</span></a>  
<a name="l3550"><span class="linenum">3550</span></a>  <span class="comment">        // Drop unnnecessary fields from course_modules.</span>
<a name="l3551"><span class="linenum">3551</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_modules');
<a name="l3552"><span class="linenum">3552</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('availablefrom');
<a name="l3553"><span class="linenum">3553</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3554"><span class="linenum">3554</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3555"><span class="linenum">3555</span></a>          }
<a name="l3556"><span class="linenum">3556</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('availableuntil');
<a name="l3557"><span class="linenum">3557</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3558"><span class="linenum">3558</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3559"><span class="linenum">3559</span></a>          }
<a name="l3560"><span class="linenum">3560</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('showavailability');
<a name="l3561"><span class="linenum">3561</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3562"><span class="linenum">3562</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3563"><span class="linenum">3563</span></a>          }
<a name="l3564"><span class="linenum">3564</span></a>  
<a name="l3565"><span class="linenum">3565</span></a>  <span class="comment">        // Drop unnnecessary fields from course_sections.</span>
<a name="l3566"><span class="linenum">3566</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_sections');
<a name="l3567"><span class="linenum">3567</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('availablefrom');
<a name="l3568"><span class="linenum">3568</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3569"><span class="linenum">3569</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3570"><span class="linenum">3570</span></a>          }
<a name="l3571"><span class="linenum">3571</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('availableuntil');
<a name="l3572"><span class="linenum">3572</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3573"><span class="linenum">3573</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3574"><span class="linenum">3574</span></a>          }
<a name="l3575"><span class="linenum">3575</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('showavailability');
<a name="l3576"><span class="linenum">3576</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3577"><span class="linenum">3577</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3578"><span class="linenum">3578</span></a>          }
<a name="l3579"><span class="linenum">3579</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('groupingid');
<a name="l3580"><span class="linenum">3580</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3581"><span class="linenum">3581</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3582"><span class="linenum">3582</span></a>          }
<a name="l3583"><span class="linenum">3583</span></a>  
<a name="l3584"><span class="linenum">3584</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3585"><span class="linenum">3585</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014040800.00);
<a name="l3586"><span class="linenum">3586</span></a>      }
<a name="l3587"><span class="linenum">3587</span></a>  
<a name="l3588"><span class="linenum">3588</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014041500.01) {
<a name="l3589"><span class="linenum">3589</span></a>  
<a name="l3590"><span class="linenum">3590</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('user_info_data');
<a name="l3591"><span class="linenum">3591</span></a>  
<a name="l3592"><span class="linenum">3592</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'SELECT DISTINCT info.id
<a name="l3593"><span class="linenum">3593</span></a>                    FROM {user_info_data} info
<a name="l3594"><span class="linenum">3594</span></a>              INNER JOIN {user_info_data} older
<a name="l3595"><span class="linenum">3595</span></a>                      ON info.fieldid = older.fieldid
<a name="l3596"><span class="linenum">3596</span></a>                     AND info.userid = older.userid
<a name="l3597"><span class="linenum">3597</span></a>                     AND older.id &lt; info.id';
<a name="l3598"><span class="linenum">3598</span></a>          <a class="var it2929" onMouseOver="hilite(2929)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l3599"><span class="linenum">3599</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l3600"><span class="linenum">3600</span></a>          foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>) {
<a name="l3601"><span class="linenum">3601</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('user_info_data', array('id' =&gt; <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('id')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l3602"><span class="linenum">3602</span></a>          }
<a name="l3603"><span class="linenum">3603</span></a>          <a class="var it2929" onMouseOver="hilite(2929)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l3604"><span class="linenum">3604</span></a>  
<a name="l3605"><span class="linenum">3605</span></a>          <a class="var it37352" onMouseOver="hilite(37352)" onMouseOut="lolite()" onClick="logVariable('oldindex')" href="../../_variables/oldindex.html">$oldindex</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('userid_fieldid', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('userid', 'fieldid'));
<a name="l3606"><span class="linenum">3606</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it37352" onMouseOver="hilite(37352)" onMouseOut="lolite()" onClick="logVariable('oldindex')" href="../../_variables/oldindex.html">$oldindex</a>)) {
<a name="l3607"><span class="linenum">3607</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_index')" href="../../_functions/drop_index.html" onMouseOver="funcPopup(event,'drop_index')">drop_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it37352" onMouseOver="hilite(37352)" onMouseOut="lolite()" onClick="logVariable('oldindex')" href="../../_variables/oldindex.html">$oldindex</a>);
<a name="l3608"><span class="linenum">3608</span></a>          }
<a name="l3609"><span class="linenum">3609</span></a>  
<a name="l3610"><span class="linenum">3610</span></a>          <a class="var it30629" onMouseOver="hilite(30629)" onMouseOut="lolite()" onClick="logVariable('newindex')" href="../../_variables/newindex.html">$newindex</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('userid_fieldid', <a class="constant" onClick="logConstant('XMLDB_INDEX_UNIQUE')" href="../../_constants/XMLDB_INDEX_UNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_UNIQUE')">XMLDB_INDEX_UNIQUE</a>, array('userid', 'fieldid'));
<a name="l3611"><span class="linenum">3611</span></a>  
<a name="l3612"><span class="linenum">3612</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it30629" onMouseOver="hilite(30629)" onMouseOut="lolite()" onClick="logVariable('newindex')" href="../../_variables/newindex.html">$newindex</a>)) {
<a name="l3613"><span class="linenum">3613</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it30629" onMouseOver="hilite(30629)" onMouseOut="lolite()" onClick="logVariable('newindex')" href="../../_variables/newindex.html">$newindex</a>);
<a name="l3614"><span class="linenum">3614</span></a>          }
<a name="l3615"><span class="linenum">3615</span></a>  
<a name="l3616"><span class="linenum">3616</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3617"><span class="linenum">3617</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014041500.01);
<a name="l3618"><span class="linenum">3618</span></a>      }
<a name="l3619"><span class="linenum">3619</span></a>  
<a name="l3620"><span class="linenum">3620</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014050100.00) {
<a name="l3621"><span class="linenum">3621</span></a>  <span class="comment">        // Fixing possible wrong MIME type for DigiDoc files.</span>
<a name="l3622"><span class="linenum">3622</span></a>          <a class="var it576" onMouseOver="hilite(576)" onMouseOut="lolite()" onClick="logVariable('extensions')" href="../../_variables/extensions.html">$extensions</a> = array('%.bdoc', '%.cdoc', '%.ddoc');
<a name="l3623"><span class="linenum">3623</span></a>          <a class="var it2282" onMouseOver="hilite(2282)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_like')" href="../../_functions/sql_like.html" onMouseOver="funcPopup(event,'sql_like')">sql_like</a>('filename', '?', false);
<a name="l3624"><span class="linenum">3624</span></a>          foreach (<a class="var it576" onMouseOver="hilite(576)" onMouseOut="lolite()" onClick="logVariable('extensions')" href="../../_variables/extensions.html">$extensions</a> as <a class="var it473" onMouseOver="hilite(473)" onMouseOut="lolite()" onClick="logVariable('extension')" href="../../_variables/extension.html">$extension</a>) {
<a name="l3625"><span class="linenum">3625</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field_select')" href="../../_functions/set_field_select.html" onMouseOver="funcPopup(event,'set_field_select')">set_field_select</a>(
<a name="l3626"><span class="linenum">3626</span></a>                  'files',
<a name="l3627"><span class="linenum">3627</span></a>                  'mimetype',
<a name="l3628"><span class="linenum">3628</span></a>                  'application/x-digidoc',
<a name="l3629"><span class="linenum">3629</span></a>                  <a class="var it2282" onMouseOver="hilite(2282)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a>,
<a name="l3630"><span class="linenum">3630</span></a>                  array(<a class="var it473" onMouseOver="hilite(473)" onMouseOut="lolite()" onClick="logVariable('extension')" href="../../_variables/extension.html">$extension</a>)
<a name="l3631"><span class="linenum">3631</span></a>              );
<a name="l3632"><span class="linenum">3632</span></a>          }
<a name="l3633"><span class="linenum">3633</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014050100.00);
<a name="l3634"><span class="linenum">3634</span></a>      }
<a name="l3635"><span class="linenum">3635</span></a>  
<a name="l3636"><span class="linenum">3636</span></a>  <span class="comment">    // Moodle v2.7.0 release upgrade line.</span>
<a name="l3637"><span class="linenum">3637</span></a>  <span class="comment">    // Put any upgrade step following this.</span>
<a name="l3638"><span class="linenum">3638</span></a>  
<a name="l3639"><span class="linenum">3639</span></a>  <span class="comment">    // MDL-32543 Make sure that the log table has correct length for action and url fields.</span>
<a name="l3640"><span class="linenum">3640</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014051200.02) {
<a name="l3641"><span class="linenum">3641</span></a>  
<a name="l3642"><span class="linenum">3642</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('log');
<a name="l3643"><span class="linenum">3643</span></a>  
<a name="l3644"><span class="linenum">3644</span></a>          <a class="var it1020" onMouseOver="hilite(1020)" onMouseOut="lolite()" onClick="logVariable('columns')" href="../../_variables/columns.html">$columns</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_columns')" href="../../_functions/get_columns.html" onMouseOver="funcPopup(event,'get_columns')">get_columns</a>('log');
<a name="l3645"><span class="linenum">3645</span></a>          if (<a class="var it1020" onMouseOver="hilite(1020)" onMouseOut="lolite()" onClick="logVariable('columns')" href="../../_variables/columns.html">$columns</a>['action']-&gt;max_length &lt; 40) {
<a name="l3646"><span class="linenum">3646</span></a>              <a class="var it27694" onMouseOver="hilite(27694)" onMouseOut="lolite()" onClick="logVariable('index1')" href="../../_variables/index1.html">$index1</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('course-module-action', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('course', 'module', 'action'));
<a name="l3647"><span class="linenum">3647</span></a>              if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it27694" onMouseOver="hilite(27694)" onMouseOut="lolite()" onClick="logVariable('index1')" href="../../_variables/index1.html">$index1</a>)) {
<a name="l3648"><span class="linenum">3648</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_index')" href="../../_functions/drop_index.html" onMouseOver="funcPopup(event,'drop_index')">drop_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it27694" onMouseOver="hilite(27694)" onMouseOut="lolite()" onClick="logVariable('index1')" href="../../_variables/index1.html">$index1</a>);
<a name="l3649"><span class="linenum">3649</span></a>              }
<a name="l3650"><span class="linenum">3650</span></a>              <a class="var it27695" onMouseOver="hilite(27695)" onMouseOut="lolite()" onClick="logVariable('index2')" href="../../_variables/index2.html">$index2</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('action', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('action'));
<a name="l3651"><span class="linenum">3651</span></a>              if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it27695" onMouseOver="hilite(27695)" onMouseOut="lolite()" onClick="logVariable('index2')" href="../../_variables/index2.html">$index2</a>)) {
<a name="l3652"><span class="linenum">3652</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_index')" href="../../_functions/drop_index.html" onMouseOver="funcPopup(event,'drop_index')">drop_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it27695" onMouseOver="hilite(27695)" onMouseOut="lolite()" onClick="logVariable('index2')" href="../../_variables/index2.html">$index2</a>);
<a name="l3653"><span class="linenum">3653</span></a>              }
<a name="l3654"><span class="linenum">3654</span></a>              <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('action', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '40', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'cmid');
<a name="l3655"><span class="linenum">3655</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('change_field_precision')" href="../../_functions/change_field_precision.html" onMouseOver="funcPopup(event,'change_field_precision')">change_field_precision</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3656"><span class="linenum">3656</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it27694" onMouseOver="hilite(27694)" onMouseOut="lolite()" onClick="logVariable('index1')" href="../../_variables/index1.html">$index1</a>);
<a name="l3657"><span class="linenum">3657</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it27695" onMouseOver="hilite(27695)" onMouseOut="lolite()" onClick="logVariable('index2')" href="../../_variables/index2.html">$index2</a>);
<a name="l3658"><span class="linenum">3658</span></a>          }
<a name="l3659"><span class="linenum">3659</span></a>  
<a name="l3660"><span class="linenum">3660</span></a>          if (<a class="var it1020" onMouseOver="hilite(1020)" onMouseOut="lolite()" onClick="logVariable('columns')" href="../../_variables/columns.html">$columns</a>['url']-&gt;max_length &lt; 100) {
<a name="l3661"><span class="linenum">3661</span></a>              <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('url', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '100', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null, 'action');
<a name="l3662"><span class="linenum">3662</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('change_field_precision')" href="../../_functions/change_field_precision.html" onMouseOver="funcPopup(event,'change_field_precision')">change_field_precision</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3663"><span class="linenum">3663</span></a>          }
<a name="l3664"><span class="linenum">3664</span></a>  
<a name="l3665"><span class="linenum">3665</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014051200.02);
<a name="l3666"><span class="linenum">3666</span></a>      }
<a name="l3667"><span class="linenum">3667</span></a>  
<a name="l3668"><span class="linenum">3668</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014060300.00) {
<a name="l3669"><span class="linenum">3669</span></a>          <a class="var it36953" onMouseOver="hilite(36953)" onMouseOut="lolite()" onClick="logVariable('gspath')" href="../../_variables/gspath.html">$gspath</a> = <a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('assignfeedback_editpdf', 'gspath');
<a name="l3670"><span class="linenum">3670</span></a>          if (<a class="var it36953" onMouseOver="hilite(36953)" onMouseOut="lolite()" onClick="logVariable('gspath')" href="../../_variables/gspath.html">$gspath</a> !== false) {
<a name="l3671"><span class="linenum">3671</span></a>              <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('pathtogs', <a class="var it36953" onMouseOver="hilite(36953)" onMouseOut="lolite()" onClick="logVariable('gspath')" href="../../_variables/gspath.html">$gspath</a>);
<a name="l3672"><span class="linenum">3672</span></a>              <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('gspath', 'assignfeedback_editpdf');
<a name="l3673"><span class="linenum">3673</span></a>          }
<a name="l3674"><span class="linenum">3674</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014060300.00);
<a name="l3675"><span class="linenum">3675</span></a>      }
<a name="l3676"><span class="linenum">3676</span></a>  
<a name="l3677"><span class="linenum">3677</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014061000.00) {
<a name="l3678"><span class="linenum">3678</span></a>  <span class="comment">        // Fixing possible wrong MIME type for Publisher files.</span>
<a name="l3679"><span class="linenum">3679</span></a>          <a class="var it5181" onMouseOver="hilite(5181)" onMouseOut="lolite()" onClick="logVariable('filetypes')" href="../../_variables/filetypes.html">$filetypes</a> = array('%.pub'=&gt;'application/x-mspublisher');
<a name="l3680"><span class="linenum">3680</span></a>          <a class="function" onClick="logFunction('upgrade_mimetypes')" href="../../_functions/upgrade_mimetypes.html" onMouseOver="funcPopup(event,'upgrade_mimetypes')">upgrade_mimetypes</a>(<a class="var it5181" onMouseOver="hilite(5181)" onMouseOut="lolite()" onClick="logVariable('filetypes')" href="../../_variables/filetypes.html">$filetypes</a>);
<a name="l3681"><span class="linenum">3681</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014061000.00);
<a name="l3682"><span class="linenum">3682</span></a>      }
<a name="l3683"><span class="linenum">3683</span></a>  
<a name="l3684"><span class="linenum">3684</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014062600.01) {
<a name="l3685"><span class="linenum">3685</span></a>  <span class="comment">        // We only want to delete DragMath if the directory no longer exists. If the directory</span>
<a name="l3686"><span class="linenum">3686</span></a>  <span class="comment">        // is present then it means it has been restored, so do not perform the uninstall.</span>
<a name="l3687"><span class="linenum">3687</span></a>          if (!<a class="function" onClick="logFunction('check_dir_exists')" href="../../_functions/check_dir_exists.html" onMouseOver="funcPopup(event,'check_dir_exists')">check_dir_exists</a>(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a> . '/editor/tinymce/plugins/dragmath', false)) {
<a name="l3688"><span class="linenum">3688</span></a>  <span class="comment">            // Purge DragMath plugin which is incompatible with GNU GPL license.</span>
<a name="l3689"><span class="linenum">3689</span></a>              <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('tinymce_dragmath');
<a name="l3690"><span class="linenum">3690</span></a>          }
<a name="l3691"><span class="linenum">3691</span></a>  
<a name="l3692"><span class="linenum">3692</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3693"><span class="linenum">3693</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014062600.01);
<a name="l3694"><span class="linenum">3694</span></a>      }
<a name="l3695"><span class="linenum">3695</span></a>  
<a name="l3696"><span class="linenum">3696</span></a>  <span class="comment">    // Switch the order of the fields in the files_reference index, to improve the performance of search_references.</span>
<a name="l3697"><span class="linenum">3697</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014070100.00) {
<a name="l3698"><span class="linenum">3698</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('files_reference');
<a name="l3699"><span class="linenum">3699</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('uq_external_file', <a class="constant" onClick="logConstant('XMLDB_INDEX_UNIQUE')" href="../../_constants/XMLDB_INDEX_UNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_UNIQUE')">XMLDB_INDEX_UNIQUE</a>, array('repositoryid', 'referencehash'));
<a name="l3700"><span class="linenum">3700</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l3701"><span class="linenum">3701</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_index')" href="../../_functions/drop_index.html" onMouseOver="funcPopup(event,'drop_index')">drop_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l3702"><span class="linenum">3702</span></a>          }
<a name="l3703"><span class="linenum">3703</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014070100.00);
<a name="l3704"><span class="linenum">3704</span></a>      }
<a name="l3705"><span class="linenum">3705</span></a>  
<a name="l3706"><span class="linenum">3706</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014070101.00) {
<a name="l3707"><span class="linenum">3707</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('files_reference');
<a name="l3708"><span class="linenum">3708</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('uq_external_file', <a class="constant" onClick="logConstant('XMLDB_INDEX_UNIQUE')" href="../../_constants/XMLDB_INDEX_UNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_UNIQUE')">XMLDB_INDEX_UNIQUE</a>, array('referencehash', 'repositoryid'));
<a name="l3709"><span class="linenum">3709</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l3710"><span class="linenum">3710</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l3711"><span class="linenum">3711</span></a>          }
<a name="l3712"><span class="linenum">3712</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014070101.00);
<a name="l3713"><span class="linenum">3713</span></a>      }
<a name="l3714"><span class="linenum">3714</span></a>  
<a name="l3715"><span class="linenum">3715</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014072400.01) {
<a name="l3716"><span class="linenum">3716</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('user_devices');
<a name="l3717"><span class="linenum">3717</span></a>          <a class="var it37352" onMouseOver="hilite(37352)" onMouseOut="lolite()" onClick="logVariable('oldindex')" href="../../_variables/oldindex.html">$oldindex</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('pushid-platform', <a class="constant" onClick="logConstant('XMLDB_KEY_UNIQUE')" href="../../_constants/XMLDB_KEY_UNIQUE.html" onMouseOver="constPopup(event,'XMLDB_KEY_UNIQUE')">XMLDB_KEY_UNIQUE</a>, array('pushid', 'platform'));
<a name="l3718"><span class="linenum">3718</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it37352" onMouseOver="hilite(37352)" onMouseOut="lolite()" onClick="logVariable('oldindex')" href="../../_variables/oldindex.html">$oldindex</a>)) {
<a name="l3719"><span class="linenum">3719</span></a>              <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_key')" href="../../_classes/xmldb_key.html" onMouseOver="classPopup(event,'xmldb_key')">xmldb_key</a>('pushid-platform', <a class="constant" onClick="logConstant('XMLDB_KEY_UNIQUE')" href="../../_constants/XMLDB_KEY_UNIQUE.html" onMouseOver="constPopup(event,'XMLDB_KEY_UNIQUE')">XMLDB_KEY_UNIQUE</a>, array('pushid', 'platform'));
<a name="l3720"><span class="linenum">3720</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_key')" href="../../_functions/drop_key.html" onMouseOver="funcPopup(event,'drop_key')">drop_key</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>);
<a name="l3721"><span class="linenum">3721</span></a>          }
<a name="l3722"><span class="linenum">3722</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014072400.01);
<a name="l3723"><span class="linenum">3723</span></a>      }
<a name="l3724"><span class="linenum">3724</span></a>  
<a name="l3725"><span class="linenum">3725</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014080801.00) {
<a name="l3726"><span class="linenum">3726</span></a>  
<a name="l3727"><span class="linenum">3727</span></a>  <span class="comment">        // Define index behaviour (not unique) to be added to question_attempts.</span>
<a name="l3728"><span class="linenum">3728</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('question_attempts');
<a name="l3729"><span class="linenum">3729</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('behaviour', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('behaviour'));
<a name="l3730"><span class="linenum">3730</span></a>  
<a name="l3731"><span class="linenum">3731</span></a>  <span class="comment">        // Conditionally launch add index behaviour.</span>
<a name="l3732"><span class="linenum">3732</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l3733"><span class="linenum">3733</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l3734"><span class="linenum">3734</span></a>          }
<a name="l3735"><span class="linenum">3735</span></a>  
<a name="l3736"><span class="linenum">3736</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3737"><span class="linenum">3737</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014080801.00);
<a name="l3738"><span class="linenum">3738</span></a>      }
<a name="l3739"><span class="linenum">3739</span></a>  
<a name="l3740"><span class="linenum">3740</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014082900.01) {
<a name="l3741"><span class="linenum">3741</span></a>  <span class="comment">        // Fixing possible wrong MIME type for 7-zip and Rar files.</span>
<a name="l3742"><span class="linenum">3742</span></a>          <a class="var it5181" onMouseOver="hilite(5181)" onMouseOut="lolite()" onClick="logVariable('filetypes')" href="../../_variables/filetypes.html">$filetypes</a> = array(
<a name="l3743"><span class="linenum">3743</span></a>                  '%.7z' =&gt; 'application/x-7z-compressed',
<a name="l3744"><span class="linenum">3744</span></a>                  '%.rar' =&gt; 'application/x-rar-compressed');
<a name="l3745"><span class="linenum">3745</span></a>          <a class="function" onClick="logFunction('upgrade_mimetypes')" href="../../_functions/upgrade_mimetypes.html" onMouseOver="funcPopup(event,'upgrade_mimetypes')">upgrade_mimetypes</a>(<a class="var it5181" onMouseOver="hilite(5181)" onMouseOut="lolite()" onClick="logVariable('filetypes')" href="../../_variables/filetypes.html">$filetypes</a>);
<a name="l3746"><span class="linenum">3746</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014082900.01);
<a name="l3747"><span class="linenum">3747</span></a>      }
<a name="l3748"><span class="linenum">3748</span></a>  
<a name="l3749"><span class="linenum">3749</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014082900.02) {
<a name="l3750"><span class="linenum">3750</span></a>  <span class="comment">        // Replace groupmembersonly usage with new availability system.</span>
<a name="l3751"><span class="linenum">3751</span></a>          <a class="var it2929" onMouseOver="hilite(2929)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l3752"><span class="linenum">3752</span></a>          if (<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enablegroupmembersonly')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/enablegroupmembersonly.html">enablegroupmembersonly</a>) {
<a name="l3753"><span class="linenum">3753</span></a>  <span class="comment">            // If it isn't already enabled, we need to enable availability.</span>
<a name="l3754"><span class="linenum">3754</span></a>              if (!<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enableavailability')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/enableavailability.html">enableavailability</a>) {
<a name="l3755"><span class="linenum">3755</span></a>                  <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('enableavailability', 1);
<a name="l3756"><span class="linenum">3756</span></a>              }
<a name="l3757"><span class="linenum">3757</span></a>  
<a name="l3758"><span class="linenum">3758</span></a>  <span class="comment">            // Count all course-modules with groupmembersonly set (for progress</span>
<a name="l3759"><span class="linenum">3759</span></a>  <span class="comment">            // bar).</span>
<a name="l3760"><span class="linenum">3760</span></a>              <a class="var it364" onMouseOver="hilite(364)" onMouseOut="lolite()" onClick="logVariable('total')" href="../../_variables/total.html">$total</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records')" href="../../_functions/count_records.html" onMouseOver="funcPopup(event,'count_records')">count_records</a>('course_modules', array('groupmembersonly' =&gt; 1));
<a name="l3761"><span class="linenum">3761</span></a>              <a class="var it8016" onMouseOver="hilite(8016)" onMouseOut="lolite()" onClick="logVariable('pbar')" href="../../_variables/pbar.html">$pbar</a> = <span class="keyword">new </span><a class="class" onClick="logClass('progress_bar')" href="../../_classes/progress_bar.html" onMouseOver="classPopup(event,'progress_bar')">progress_bar</a>('upgradegroupmembersonly', 500, true);
<a name="l3762"><span class="linenum">3762</span></a>  
<a name="l3763"><span class="linenum">3763</span></a>  <span class="comment">            // Get all these course-modules, one at a time.</span>
<a name="l3764"><span class="linenum">3764</span></a>              <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset')" href="../../_functions/get_recordset.html" onMouseOver="funcPopup(event,'get_recordset')">get_recordset</a>('course_modules', array('groupmembersonly' =&gt; 1),
<a name="l3765"><span class="linenum">3765</span></a>                      'course, id');
<a name="l3766"><span class="linenum">3766</span></a>              <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> = 0;
<a name="l3767"><span class="linenum">3767</span></a>              foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>) {
<a name="l3768"><span class="linenum">3768</span></a>  <span class="comment">                // Calculate and set new availability value.</span>
<a name="l3769"><span class="linenum">3769</span></a>                  <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('availability')" href="../../_variables/availability.html">$availability</a> = <a class="function" onClick="logFunction('upgrade_group_members_only')" href="../../_functions/upgrade_group_members_only.html" onMouseOver="funcPopup(event,'upgrade_group_members_only')">upgrade_group_members_only</a>(<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('groupingid')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/groupingid.html">groupingid</a>, <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('availability')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/availability.html">availability</a>);
<a name="l3770"><span class="linenum">3770</span></a>                  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('course_modules', 'availability', <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('availability')" href="../../_variables/availability.html">$availability</a>,
<a name="l3771"><span class="linenum">3771</span></a>                          array('id' =&gt; <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l3772"><span class="linenum">3772</span></a>  
<a name="l3773"><span class="linenum">3773</span></a>  <span class="comment">                // Update progress.</span>
<a name="l3774"><span class="linenum">3774</span></a>                  <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>++;
<a name="l3775"><span class="linenum">3775</span></a>                  <a class="var it8016" onMouseOver="hilite(8016)" onMouseOut="lolite()" onClick="logVariable('pbar')" href="../../_variables/pbar.html">$pbar</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>(<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>, <a class="var it364" onMouseOver="hilite(364)" onMouseOut="lolite()" onClick="logVariable('total')" href="../../_variables/total.html">$total</a>, &quot;Upgrading groupmembersonly settings - <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>/<a class="var it364" onMouseOver="hilite(364)" onMouseOut="lolite()" onClick="logVariable('total')" href="../../_variables/total.html">$total</a>.&quot;);
<a name="l3776"><span class="linenum">3776</span></a>              }
<a name="l3777"><span class="linenum">3777</span></a>              <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l3778"><span class="linenum">3778</span></a>          }
<a name="l3779"><span class="linenum">3779</span></a>  
<a name="l3780"><span class="linenum">3780</span></a>  <span class="comment">        // Define field groupmembersonly to be dropped from course_modules.</span>
<a name="l3781"><span class="linenum">3781</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('course_modules');
<a name="l3782"><span class="linenum">3782</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('groupmembersonly');
<a name="l3783"><span class="linenum">3783</span></a>  
<a name="l3784"><span class="linenum">3784</span></a>  <span class="comment">        // Conditionally launch drop field groupmembersonly.</span>
<a name="l3785"><span class="linenum">3785</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3786"><span class="linenum">3786</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3787"><span class="linenum">3787</span></a>          }
<a name="l3788"><span class="linenum">3788</span></a>  
<a name="l3789"><span class="linenum">3789</span></a>  <span class="comment">        // Unset old config variable.</span>
<a name="l3790"><span class="linenum">3790</span></a>          <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('enablegroupmembersonly');
<a name="l3791"><span class="linenum">3791</span></a>          <a class="var it2929" onMouseOver="hilite(2929)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l3792"><span class="linenum">3792</span></a>  
<a name="l3793"><span class="linenum">3793</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014082900.02);
<a name="l3794"><span class="linenum">3794</span></a>      }
<a name="l3795"><span class="linenum">3795</span></a>  
<a name="l3796"><span class="linenum">3796</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014100100.00) {
<a name="l3797"><span class="linenum">3797</span></a>  
<a name="l3798"><span class="linenum">3798</span></a>  <span class="comment">        // Define table messageinbound_handlers to be created.</span>
<a name="l3799"><span class="linenum">3799</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('messageinbound_handlers');
<a name="l3800"><span class="linenum">3800</span></a>  
<a name="l3801"><span class="linenum">3801</span></a>  <span class="comment">        // Adding fields to table messageinbound_handlers.</span>
<a name="l3802"><span class="linenum">3802</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null);
<a name="l3803"><span class="linenum">3803</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('component', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '100', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l3804"><span class="linenum">3804</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('classname', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l3805"><span class="linenum">3805</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('defaultexpiration', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '86400');
<a name="l3806"><span class="linenum">3806</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('validateaddress', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '1', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '1');
<a name="l3807"><span class="linenum">3807</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('enabled', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '1', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0');
<a name="l3808"><span class="linenum">3808</span></a>  
<a name="l3809"><span class="linenum">3809</span></a>  <span class="comment">        // Adding keys to table messageinbound_handlers.</span>
<a name="l3810"><span class="linenum">3810</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l3811"><span class="linenum">3811</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('classname', <a class="constant" onClick="logConstant('XMLDB_KEY_UNIQUE')" href="../../_constants/XMLDB_KEY_UNIQUE.html" onMouseOver="constPopup(event,'XMLDB_KEY_UNIQUE')">XMLDB_KEY_UNIQUE</a>, array('classname'));
<a name="l3812"><span class="linenum">3812</span></a>  
<a name="l3813"><span class="linenum">3813</span></a>  <span class="comment">        // Conditionally launch create table for messageinbound_handlers.</span>
<a name="l3814"><span class="linenum">3814</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l3815"><span class="linenum">3815</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l3816"><span class="linenum">3816</span></a>          }
<a name="l3817"><span class="linenum">3817</span></a>  
<a name="l3818"><span class="linenum">3818</span></a>  <span class="comment">        // Define table messageinbound_datakeys to be created.</span>
<a name="l3819"><span class="linenum">3819</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('messageinbound_datakeys');
<a name="l3820"><span class="linenum">3820</span></a>  
<a name="l3821"><span class="linenum">3821</span></a>  <span class="comment">        // Adding fields to table messageinbound_datakeys.</span>
<a name="l3822"><span class="linenum">3822</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null);
<a name="l3823"><span class="linenum">3823</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('handler', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l3824"><span class="linenum">3824</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('datavalue', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l3825"><span class="linenum">3825</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('datakey', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '64', null, null, null, null);
<a name="l3826"><span class="linenum">3826</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('timecreated', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l3827"><span class="linenum">3827</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('expires', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, null, null, null);
<a name="l3828"><span class="linenum">3828</span></a>  
<a name="l3829"><span class="linenum">3829</span></a>  <span class="comment">        // Adding keys to table messageinbound_datakeys.</span>
<a name="l3830"><span class="linenum">3830</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l3831"><span class="linenum">3831</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('handler_datavalue', <a class="constant" onClick="logConstant('XMLDB_KEY_UNIQUE')" href="../../_constants/XMLDB_KEY_UNIQUE.html" onMouseOver="constPopup(event,'XMLDB_KEY_UNIQUE')">XMLDB_KEY_UNIQUE</a>, array('handler', 'datavalue'));
<a name="l3832"><span class="linenum">3832</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('handler', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('handler'), 'messageinbound_handlers', array('id'));
<a name="l3833"><span class="linenum">3833</span></a>  
<a name="l3834"><span class="linenum">3834</span></a>  <span class="comment">        // Conditionally launch create table for messageinbound_datakeys.</span>
<a name="l3835"><span class="linenum">3835</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l3836"><span class="linenum">3836</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l3837"><span class="linenum">3837</span></a>          }
<a name="l3838"><span class="linenum">3838</span></a>  
<a name="l3839"><span class="linenum">3839</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3840"><span class="linenum">3840</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014100100.00);
<a name="l3841"><span class="linenum">3841</span></a>      }
<a name="l3842"><span class="linenum">3842</span></a>  
<a name="l3843"><span class="linenum">3843</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014100600.01) {
<a name="l3844"><span class="linenum">3844</span></a>  <span class="comment">        // Define field aggregationstatus to be added to grade_grades.</span>
<a name="l3845"><span class="linenum">3845</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('grade_grades');
<a name="l3846"><span class="linenum">3846</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('aggregationstatus', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, 'unknown', 'timemodified');
<a name="l3847"><span class="linenum">3847</span></a>  
<a name="l3848"><span class="linenum">3848</span></a>  <span class="comment">        // Conditionally launch add field aggregationstatus.</span>
<a name="l3849"><span class="linenum">3849</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3850"><span class="linenum">3850</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3851"><span class="linenum">3851</span></a>          }
<a name="l3852"><span class="linenum">3852</span></a>  
<a name="l3853"><span class="linenum">3853</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('aggregationweight', <a class="constant" onClick="logConstant('XMLDB_TYPE_NUMBER')" href="../../_constants/XMLDB_TYPE_NUMBER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_NUMBER')">XMLDB_TYPE_NUMBER</a>, '10, 5', null, null, null, null, 'aggregationstatus');
<a name="l3854"><span class="linenum">3854</span></a>  
<a name="l3855"><span class="linenum">3855</span></a>  <span class="comment">        // Conditionally launch add field aggregationweight.</span>
<a name="l3856"><span class="linenum">3856</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3857"><span class="linenum">3857</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3858"><span class="linenum">3858</span></a>          }
<a name="l3859"><span class="linenum">3859</span></a>  
<a name="l3860"><span class="linenum">3860</span></a>  <span class="comment">        // Define field aggregationcoef2 to be added to grade_items.</span>
<a name="l3861"><span class="linenum">3861</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('grade_items');
<a name="l3862"><span class="linenum">3862</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('aggregationcoef2', <a class="constant" onClick="logConstant('XMLDB_TYPE_NUMBER')" href="../../_constants/XMLDB_TYPE_NUMBER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_NUMBER')">XMLDB_TYPE_NUMBER</a>, '10, 5', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'aggregationcoef');
<a name="l3863"><span class="linenum">3863</span></a>  
<a name="l3864"><span class="linenum">3864</span></a>  <span class="comment">        // Conditionally launch add field aggregationcoef2.</span>
<a name="l3865"><span class="linenum">3865</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3866"><span class="linenum">3866</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3867"><span class="linenum">3867</span></a>          }
<a name="l3868"><span class="linenum">3868</span></a>  
<a name="l3869"><span class="linenum">3869</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('weightoverride', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '1', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'needsupdate');
<a name="l3870"><span class="linenum">3870</span></a>  
<a name="l3871"><span class="linenum">3871</span></a>  <span class="comment">        // Conditionally launch add field weightoverride.</span>
<a name="l3872"><span class="linenum">3872</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3873"><span class="linenum">3873</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3874"><span class="linenum">3874</span></a>          }
<a name="l3875"><span class="linenum">3875</span></a>  
<a name="l3876"><span class="linenum">3876</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3877"><span class="linenum">3877</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014100600.01);
<a name="l3878"><span class="linenum">3878</span></a>      }
<a name="l3879"><span class="linenum">3879</span></a>  
<a name="l3880"><span class="linenum">3880</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014100600.02) {
<a name="l3881"><span class="linenum">3881</span></a>  
<a name="l3882"><span class="linenum">3882</span></a>  <span class="comment">        // Define field aggregationcoef2 to be added to grade_items_history.</span>
<a name="l3883"><span class="linenum">3883</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('grade_items_history');
<a name="l3884"><span class="linenum">3884</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('aggregationcoef2', <a class="constant" onClick="logConstant('XMLDB_TYPE_NUMBER')" href="../../_constants/XMLDB_TYPE_NUMBER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_NUMBER')">XMLDB_TYPE_NUMBER</a>, '10, 5', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'aggregationcoef');
<a name="l3885"><span class="linenum">3885</span></a>  
<a name="l3886"><span class="linenum">3886</span></a>  <span class="comment">        // Conditionally launch add field aggregationcoef2.</span>
<a name="l3887"><span class="linenum">3887</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3888"><span class="linenum">3888</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3889"><span class="linenum">3889</span></a>          }
<a name="l3890"><span class="linenum">3890</span></a>  
<a name="l3891"><span class="linenum">3891</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3892"><span class="linenum">3892</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014100600.02);
<a name="l3893"><span class="linenum">3893</span></a>      }
<a name="l3894"><span class="linenum">3894</span></a>  
<a name="l3895"><span class="linenum">3895</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014100600.03) {
<a name="l3896"><span class="linenum">3896</span></a>  
<a name="l3897"><span class="linenum">3897</span></a>  <span class="comment">        // Define field weightoverride to be added to grade_items_history.</span>
<a name="l3898"><span class="linenum">3898</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('grade_items_history');
<a name="l3899"><span class="linenum">3899</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('weightoverride', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '1', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'decimals');
<a name="l3900"><span class="linenum">3900</span></a>  
<a name="l3901"><span class="linenum">3901</span></a>  <span class="comment">        // Conditionally launch add field weightoverride.</span>
<a name="l3902"><span class="linenum">3902</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3903"><span class="linenum">3903</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3904"><span class="linenum">3904</span></a>          }
<a name="l3905"><span class="linenum">3905</span></a>  
<a name="l3906"><span class="linenum">3906</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3907"><span class="linenum">3907</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014100600.03);
<a name="l3908"><span class="linenum">3908</span></a>      }
<a name="l3909"><span class="linenum">3909</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014100600.04) {
<a name="l3910"><span class="linenum">3910</span></a>  <span class="comment">        // Set flags so we can display a notice on all courses that might</span>
<a name="l3911"><span class="linenum">3911</span></a>  <span class="comment">        // be affected by the uprade to natural aggregation.</span>
<a name="l3912"><span class="linenum">3912</span></a>          if (!<a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('grades_sumofgrades_upgrade_flagged', 'core')) {
<a name="l3913"><span class="linenum">3913</span></a>  <span class="comment">            // 13 == SUM_OF_GRADES.</span>
<a name="l3914"><span class="linenum">3914</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'SELECT DISTINCT courseid
<a name="l3915"><span class="linenum">3915</span></a>                        FROM {grade_categories}
<a name="l3916"><span class="linenum">3916</span></a>                       WHERE aggregation = ?';
<a name="l3917"><span class="linenum">3917</span></a>              <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array(13));
<a name="l3918"><span class="linenum">3918</span></a>  
<a name="l3919"><span class="linenum">3919</span></a>              foreach (<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> as <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) {
<a name="l3920"><span class="linenum">3920</span></a>                  <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('show_sumofgrades_upgrade_' . <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('courseid')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>, 1);
<a name="l3921"><span class="linenum">3921</span></a>  <span class="comment">                // Set each of the grade items to needing an update so that when the user visits the grade reports the</span>
<a name="l3922"><span class="linenum">3922</span></a>  <span class="comment">                // figures will be updated.</span>
<a name="l3923"><span class="linenum">3923</span></a>                  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('grade_items', 'needsupdate', 1, array('courseid' =&gt; <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('courseid')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>));
<a name="l3924"><span class="linenum">3924</span></a>              }
<a name="l3925"><span class="linenum">3925</span></a>  
<a name="l3926"><span class="linenum">3926</span></a>              <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('grades_sumofgrades_upgrade_flagged', 1);
<a name="l3927"><span class="linenum">3927</span></a>          }
<a name="l3928"><span class="linenum">3928</span></a>  
<a name="l3929"><span class="linenum">3929</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3930"><span class="linenum">3930</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014100600.04);
<a name="l3931"><span class="linenum">3931</span></a>      }
<a name="l3932"><span class="linenum">3932</span></a>  
<a name="l3933"><span class="linenum">3933</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014100700.00) {
<a name="l3934"><span class="linenum">3934</span></a>  
<a name="l3935"><span class="linenum">3935</span></a>  <span class="comment">        // Define table messageinbound_messagelist to be created.</span>
<a name="l3936"><span class="linenum">3936</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('messageinbound_messagelist');
<a name="l3937"><span class="linenum">3937</span></a>  
<a name="l3938"><span class="linenum">3938</span></a>  <span class="comment">        // Adding fields to table messageinbound_messagelist.</span>
<a name="l3939"><span class="linenum">3939</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null);
<a name="l3940"><span class="linenum">3940</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('messageid', <a class="constant" onClick="logConstant('XMLDB_TYPE_TEXT')" href="../../_constants/XMLDB_TYPE_TEXT.html" onMouseOver="constPopup(event,'XMLDB_TYPE_TEXT')">XMLDB_TYPE_TEXT</a>, null, null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l3941"><span class="linenum">3941</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('userid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l3942"><span class="linenum">3942</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('address', <a class="constant" onClick="logConstant('XMLDB_TYPE_TEXT')" href="../../_constants/XMLDB_TYPE_TEXT.html" onMouseOver="constPopup(event,'XMLDB_TYPE_TEXT')">XMLDB_TYPE_TEXT</a>, null, null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l3943"><span class="linenum">3943</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('timecreated', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l3944"><span class="linenum">3944</span></a>  
<a name="l3945"><span class="linenum">3945</span></a>  <span class="comment">        // Adding keys to table messageinbound_messagelist.</span>
<a name="l3946"><span class="linenum">3946</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l3947"><span class="linenum">3947</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('userid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('userid'), 'user', array('id'));
<a name="l3948"><span class="linenum">3948</span></a>  
<a name="l3949"><span class="linenum">3949</span></a>  <span class="comment">        // Conditionally launch create table for messageinbound_messagelist.</span>
<a name="l3950"><span class="linenum">3950</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l3951"><span class="linenum">3951</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l3952"><span class="linenum">3952</span></a>          }
<a name="l3953"><span class="linenum">3953</span></a>  
<a name="l3954"><span class="linenum">3954</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3955"><span class="linenum">3955</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014100700.00);
<a name="l3956"><span class="linenum">3956</span></a>      }
<a name="l3957"><span class="linenum">3957</span></a>  
<a name="l3958"><span class="linenum">3958</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014100700.01) {
<a name="l3959"><span class="linenum">3959</span></a>  
<a name="l3960"><span class="linenum">3960</span></a>  <span class="comment">        // Define field visible to be added to cohort.</span>
<a name="l3961"><span class="linenum">3961</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('cohort');
<a name="l3962"><span class="linenum">3962</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('visible', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '1', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '1', 'descriptionformat');
<a name="l3963"><span class="linenum">3963</span></a>  
<a name="l3964"><span class="linenum">3964</span></a>  <span class="comment">        // Conditionally launch add field visible.</span>
<a name="l3965"><span class="linenum">3965</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l3966"><span class="linenum">3966</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l3967"><span class="linenum">3967</span></a>          }
<a name="l3968"><span class="linenum">3968</span></a>  
<a name="l3969"><span class="linenum">3969</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3970"><span class="linenum">3970</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014100700.01);
<a name="l3971"><span class="linenum">3971</span></a>      }
<a name="l3972"><span class="linenum">3972</span></a>  
<a name="l3973"><span class="linenum">3973</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014100800.00) {
<a name="l3974"><span class="linenum">3974</span></a>  <span class="comment">        // Remove qformat_learnwise (unless it has manually been added back).</span>
<a name="l3975"><span class="linenum">3975</span></a>          if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a> . '/question/format/learnwise/format.php')) {
<a name="l3976"><span class="linenum">3976</span></a>              <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('qformat_learnwise');
<a name="l3977"><span class="linenum">3977</span></a>          }
<a name="l3978"><span class="linenum">3978</span></a>  
<a name="l3979"><span class="linenum">3979</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l3980"><span class="linenum">3980</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014100800.00);
<a name="l3981"><span class="linenum">3981</span></a>      }
<a name="l3982"><span class="linenum">3982</span></a>  
<a name="l3983"><span class="linenum">3983</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014101001.00) {
<a name="l3984"><span class="linenum">3984</span></a>  <span class="comment">        // Some blocks added themselves to the my/ home page, but they did not declare the</span>
<a name="l3985"><span class="linenum">3985</span></a>  <span class="comment">        // subpage of the default my home page. While the upgrade script has been fixed, this</span>
<a name="l3986"><span class="linenum">3986</span></a>  <span class="comment">        // upgrade script will fix the data that was wrongly added.</span>
<a name="l3987"><span class="linenum">3987</span></a>  
<a name="l3988"><span class="linenum">3988</span></a>  <span class="comment">        // We only proceed if we can find the right entry from my_pages. Private =&gt; 1 refers to</span>
<a name="l3989"><span class="linenum">3989</span></a>  <span class="comment">        // the constant value MY_PAGE_PRIVATE.</span>
<a name="l3990"><span class="linenum">3990</span></a>          if (<a class="var it5569" onMouseOver="hilite(5569)" onMouseOut="lolite()" onClick="logVariable('systempage')" href="../../_variables/systempage.html">$systempage</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('my_pages', array('userid' =&gt; null, 'private' =&gt; 1))) {
<a name="l3991"><span class="linenum">3991</span></a>  
<a name="l3992"><span class="linenum">3992</span></a>  <span class="comment">            // Select the blocks there could have been automatically added. showinsubcontexts is hardcoded to 0</span>
<a name="l3993"><span class="linenum">3993</span></a>  <span class="comment">            // because it is possible for administrators to have forced it on the my/ page by adding it to the</span>
<a name="l3994"><span class="linenum">3994</span></a>  <span class="comment">            // system directly rather than updating the default my/ page.</span>
<a name="l3995"><span class="linenum">3995</span></a>              <a class="var it1264" onMouseOver="hilite(1264)" onMouseOut="lolite()" onClick="logVariable('blocks')" href="../../_variables/blocks.html">$blocks</a> = array('course_overview', 'private_files', 'online_users', 'badges', 'calendar_month', 'calendar_upcoming');
<a name="l3996"><span class="linenum">3996</span></a>              <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it37353" onMouseOver="hilite(37353)" onMouseOut="lolite()" onClick="logVariable('blocksql')" href="../../_variables/blocksql.html">$blocksql</a>, <a class="var it37354" onMouseOver="hilite(37354)" onMouseOut="lolite()" onClick="logVariable('blockparams')" href="../../_variables/blockparams.html">$blockparams</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it1264" onMouseOver="hilite(1264)" onMouseOut="lolite()" onClick="logVariable('blocks')" href="../../_variables/blocks.html">$blocks</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>);
<a name="l3997"><span class="linenum">3997</span></a>              <a class="var it2282" onMouseOver="hilite(2282)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> = &quot;parentcontextid = :contextid
<a name="l3998"><span class="linenum">3998</span></a>                      AND pagetypepattern = :page
<a name="l3999"><span class="linenum">3999</span></a>                      AND showinsubcontexts = 0
<a name="l4000"><span class="linenum">4000</span></a>                      AND subpagepattern IS NULL
<a name="l4001"><span class="linenum">4001</span></a>                      AND blockname <a class="var it37353" onMouseOver="hilite(37353)" onMouseOut="lolite()" onClick="logVariable('blocksql')" href="../../_variables/blocksql.html">$blocksql</a>&quot;;
<a name="l4002"><span class="linenum">4002</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(
<a name="l4003"><span class="linenum">4003</span></a>                  'contextid' =&gt; <a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>()-&gt;id,
<a name="l4004"><span class="linenum">4004</span></a>                  'page' =&gt; 'my-index'
<a name="l4005"><span class="linenum">4005</span></a>              );
<a name="l4006"><span class="linenum">4006</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, <a class="var it37354" onMouseOver="hilite(37354)" onMouseOut="lolite()" onClick="logVariable('blockparams')" href="../../_variables/blockparams.html">$blockparams</a>);
<a name="l4007"><span class="linenum">4007</span></a>  
<a name="l4008"><span class="linenum">4008</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field_select')" href="../../_functions/set_field_select.html" onMouseOver="funcPopup(event,'set_field_select')">set_field_select</a>(
<a name="l4009"><span class="linenum">4009</span></a>                  'block_instances',
<a name="l4010"><span class="linenum">4010</span></a>                  'subpagepattern',
<a name="l4011"><span class="linenum">4011</span></a>                  <a class="var it5569" onMouseOver="hilite(5569)" onMouseOut="lolite()" onClick="logVariable('systempage')" href="../../_variables/systempage.html">$systempage</a>-&gt;<a onClick="logVariable('id')" class="var it39606" onMouseOver="hilite(39606)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l4012"><span class="linenum">4012</span></a>                  <a class="var it2282" onMouseOver="hilite(2282)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a>,
<a name="l4013"><span class="linenum">4013</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>
<a name="l4014"><span class="linenum">4014</span></a>              );
<a name="l4015"><span class="linenum">4015</span></a>          }
<a name="l4016"><span class="linenum">4016</span></a>  
<a name="l4017"><span class="linenum">4017</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l4018"><span class="linenum">4018</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014101001.00);
<a name="l4019"><span class="linenum">4019</span></a>      }
<a name="l4020"><span class="linenum">4020</span></a>  
<a name="l4021"><span class="linenum">4021</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014102000.00) {
<a name="l4022"><span class="linenum">4022</span></a>  
<a name="l4023"><span class="linenum">4023</span></a>  <span class="comment">        // Define field aggregatesubcats to be dropped from grade_categories.</span>
<a name="l4024"><span class="linenum">4024</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('grade_categories');
<a name="l4025"><span class="linenum">4025</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('aggregatesubcats');
<a name="l4026"><span class="linenum">4026</span></a>  
<a name="l4027"><span class="linenum">4027</span></a>  <span class="comment">        // Conditionally launch drop field aggregatesubcats.</span>
<a name="l4028"><span class="linenum">4028</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l4029"><span class="linenum">4029</span></a>  
<a name="l4030"><span class="linenum">4030</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'SELECT DISTINCT courseid
<a name="l4031"><span class="linenum">4031</span></a>                        FROM {grade_categories}
<a name="l4032"><span class="linenum">4032</span></a>                       WHERE aggregatesubcats = ?';
<a name="l4033"><span class="linenum">4033</span></a>              <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array(1));
<a name="l4034"><span class="linenum">4034</span></a>  
<a name="l4035"><span class="linenum">4035</span></a>              foreach (<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> as <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) {
<a name="l4036"><span class="linenum">4036</span></a>                  <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('show_aggregatesubcats_upgrade_' . <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('courseid')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>, 1);
<a name="l4037"><span class="linenum">4037</span></a>  <span class="comment">                // Set each of the grade items to needing an update so that when the user visits the grade reports the</span>
<a name="l4038"><span class="linenum">4038</span></a>  <span class="comment">                // figures will be updated.</span>
<a name="l4039"><span class="linenum">4039</span></a>                  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('grade_items', 'needsupdate', 1, array('courseid' =&gt; <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('courseid')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>));
<a name="l4040"><span class="linenum">4040</span></a>              }
<a name="l4041"><span class="linenum">4041</span></a>  
<a name="l4042"><span class="linenum">4042</span></a>  
<a name="l4043"><span class="linenum">4043</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_field')" href="../../_functions/drop_field.html" onMouseOver="funcPopup(event,'drop_field')">drop_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l4044"><span class="linenum">4044</span></a>          }
<a name="l4045"><span class="linenum">4045</span></a>  
<a name="l4046"><span class="linenum">4046</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l4047"><span class="linenum">4047</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014102000.00);
<a name="l4048"><span class="linenum">4048</span></a>      }
<a name="l4049"><span class="linenum">4049</span></a>  
<a name="l4050"><span class="linenum">4050</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014110300.00) {
<a name="l4051"><span class="linenum">4051</span></a>  <span class="comment">        // Run script restoring missing folder records for draft file areas.</span>
<a name="l4052"><span class="linenum">4052</span></a>          <a class="function" onClick="logFunction('upgrade_fix_missing_root_folders_draft')" href="../../_functions/upgrade_fix_missing_root_folders_draft.html" onMouseOver="funcPopup(event,'upgrade_fix_missing_root_folders_draft')">upgrade_fix_missing_root_folders_draft</a>();
<a name="l4053"><span class="linenum">4053</span></a>  
<a name="l4054"><span class="linenum">4054</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l4055"><span class="linenum">4055</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014110300.00);
<a name="l4056"><span class="linenum">4056</span></a>      }
<a name="l4057"><span class="linenum">4057</span></a>  
<a name="l4058"><span class="linenum">4058</span></a>  <span class="comment">    // Moodle v2.8.0 release upgrade line.</span>
<a name="l4059"><span class="linenum">4059</span></a>  <span class="comment">    // Put any upgrade step following this.</span>
<a name="l4060"><span class="linenum">4060</span></a>  
<a name="l4061"><span class="linenum">4061</span></a>  
<a name="l4062"><span class="linenum">4062</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014120100.00) {
<a name="l4063"><span class="linenum">4063</span></a>  
<a name="l4064"><span class="linenum">4064</span></a>  <span class="comment">        // Define field sslverification to be added to mnet_host.</span>
<a name="l4065"><span class="linenum">4065</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('mnet_host');
<a name="l4066"><span class="linenum">4066</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('sslverification', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '1', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'applicationid');
<a name="l4067"><span class="linenum">4067</span></a>  
<a name="l4068"><span class="linenum">4068</span></a>  <span class="comment">        // Conditionally launch add field sslverification.</span>
<a name="l4069"><span class="linenum">4069</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l4070"><span class="linenum">4070</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l4071"><span class="linenum">4071</span></a>          }
<a name="l4072"><span class="linenum">4072</span></a>  
<a name="l4073"><span class="linenum">4073</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l4074"><span class="linenum">4074</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014120100.00);
<a name="l4075"><span class="linenum">4075</span></a>      }
<a name="l4076"><span class="linenum">4076</span></a>  
<a name="l4077"><span class="linenum">4077</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014120101.00) {
<a name="l4078"><span class="linenum">4078</span></a>  
<a name="l4079"><span class="linenum">4079</span></a>  <span class="comment">        // Define field component to be added to comments.</span>
<a name="l4080"><span class="linenum">4080</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('comments');
<a name="l4081"><span class="linenum">4081</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('component', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, null, null, null, 'contextid');
<a name="l4082"><span class="linenum">4082</span></a>  
<a name="l4083"><span class="linenum">4083</span></a>  <span class="comment">        // Conditionally launch add field component.</span>
<a name="l4084"><span class="linenum">4084</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l4085"><span class="linenum">4085</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l4086"><span class="linenum">4086</span></a>          }
<a name="l4087"><span class="linenum">4087</span></a>  
<a name="l4088"><span class="linenum">4088</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l4089"><span class="linenum">4089</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014120101.00);
<a name="l4090"><span class="linenum">4090</span></a>      }
<a name="l4091"><span class="linenum">4091</span></a>  
<a name="l4092"><span class="linenum">4092</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2014120102.00) {
<a name="l4093"><span class="linenum">4093</span></a>  
<a name="l4094"><span class="linenum">4094</span></a>  <span class="comment">        // Define table user_password_history to be created.</span>
<a name="l4095"><span class="linenum">4095</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('user_password_history');
<a name="l4096"><span class="linenum">4096</span></a>  
<a name="l4097"><span class="linenum">4097</span></a>  <span class="comment">        // Adding fields to table user_password_history.</span>
<a name="l4098"><span class="linenum">4098</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('id', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, <a class="constant" onClick="logConstant('XMLDB_SEQUENCE')" href="../../_constants/XMLDB_SEQUENCE.html" onMouseOver="constPopup(event,'XMLDB_SEQUENCE')">XMLDB_SEQUENCE</a>, null);
<a name="l4099"><span class="linenum">4099</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('userid', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l4100"><span class="linenum">4100</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('hash', <a class="constant" onClick="logConstant('XMLDB_TYPE_CHAR')" href="../../_constants/XMLDB_TYPE_CHAR.html" onMouseOver="constPopup(event,'XMLDB_TYPE_CHAR')">XMLDB_TYPE_CHAR</a>, '255', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l4101"><span class="linenum">4101</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>('timecreated', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, null);
<a name="l4102"><span class="linenum">4102</span></a>  
<a name="l4103"><span class="linenum">4103</span></a>  <span class="comment">        // Adding keys to table user_password_history.</span>
<a name="l4104"><span class="linenum">4104</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('primary', <a class="constant" onClick="logConstant('XMLDB_KEY_PRIMARY')" href="../../_constants/XMLDB_KEY_PRIMARY.html" onMouseOver="constPopup(event,'XMLDB_KEY_PRIMARY')">XMLDB_KEY_PRIMARY</a>, array('id'));
<a name="l4105"><span class="linenum">4105</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>-&gt;<a class="function" onClick="logFunction('add_key')" href="../../_functions/add_key.html" onMouseOver="funcPopup(event,'add_key')">add_key</a>('userid', <a class="constant" onClick="logConstant('XMLDB_KEY_FOREIGN')" href="../../_constants/XMLDB_KEY_FOREIGN.html" onMouseOver="constPopup(event,'XMLDB_KEY_FOREIGN')">XMLDB_KEY_FOREIGN</a>, array('userid'), 'user', array('id'));
<a name="l4106"><span class="linenum">4106</span></a>  
<a name="l4107"><span class="linenum">4107</span></a>  <span class="comment">        // Conditionally launch create table for user_password_history.</span>
<a name="l4108"><span class="linenum">4108</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l4109"><span class="linenum">4109</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('create_table')" href="../../_functions/create_table.html" onMouseOver="funcPopup(event,'create_table')">create_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l4110"><span class="linenum">4110</span></a>          }
<a name="l4111"><span class="linenum">4111</span></a>  
<a name="l4112"><span class="linenum">4112</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l4113"><span class="linenum">4113</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2014120102.00);
<a name="l4114"><span class="linenum">4114</span></a>      }
<a name="l4115"><span class="linenum">4115</span></a>  
<a name="l4116"><span class="linenum">4116</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2015010800.01) {
<a name="l4117"><span class="linenum">4117</span></a>  
<a name="l4118"><span class="linenum">4118</span></a>  <span class="comment">        // Make sure the private files handler is not set to expire.</span>
<a name="l4119"><span class="linenum">4119</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('messageinbound_handlers', 'defaultexpiration', 0,
<a name="l4120"><span class="linenum">4120</span></a>                  array('classname' =&gt; '\core\message\inbound\private_files_handler'));
<a name="l4121"><span class="linenum">4121</span></a>  
<a name="l4122"><span class="linenum">4122</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l4123"><span class="linenum">4123</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2015010800.01);
<a name="l4124"><span class="linenum">4124</span></a>  
<a name="l4125"><span class="linenum">4125</span></a>      }
<a name="l4126"><span class="linenum">4126</span></a>  
<a name="l4127"><span class="linenum">4127</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2015012600.00) {
<a name="l4128"><span class="linenum">4128</span></a>  
<a name="l4129"><span class="linenum">4129</span></a>  <span class="comment">        // If the site is using internal and external storage, or just external</span>
<a name="l4130"><span class="linenum">4130</span></a>  <span class="comment">        // storage, and the external path specified is empty we change the setting</span>
<a name="l4131"><span class="linenum">4131</span></a>  <span class="comment">        // to internal only. That is how the backup code is handling this</span>
<a name="l4132"><span class="linenum">4132</span></a>  <span class="comment">        // misconfiguration.</span>
<a name="l4133"><span class="linenum">4133</span></a>          <a class="var it2781" onMouseOver="hilite(2781)" onMouseOut="lolite()" onClick="logVariable('storage')" href="../../_variables/storage.html">$storage</a> = (int) <a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('backup', 'backup_auto_storage');
<a name="l4134"><span class="linenum">4134</span></a>          <a class="var it4320" onMouseOver="hilite(4320)" onMouseOut="lolite()" onClick="logVariable('folder')" href="../../_variables/folder.html">$folder</a> = <a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('backup', 'backup_auto_destination');
<a name="l4135"><span class="linenum">4135</span></a>          if (<a class="var it2781" onMouseOver="hilite(2781)" onMouseOut="lolite()" onClick="logVariable('storage')" href="../../_variables/storage.html">$storage</a> !== 0 &amp;&amp; empty(<a class="var it4320" onMouseOver="hilite(4320)" onMouseOut="lolite()" onClick="logVariable('folder')" href="../../_variables/folder.html">$folder</a>)) {
<a name="l4136"><span class="linenum">4136</span></a>              <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('backup_auto_storage', 0, 'backup');
<a name="l4137"><span class="linenum">4137</span></a>          }
<a name="l4138"><span class="linenum">4138</span></a>  
<a name="l4139"><span class="linenum">4139</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l4140"><span class="linenum">4140</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2015012600.00);
<a name="l4141"><span class="linenum">4141</span></a>      }
<a name="l4142"><span class="linenum">4142</span></a>  
<a name="l4143"><span class="linenum">4143</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2015012600.01) {
<a name="l4144"><span class="linenum">4144</span></a>  
<a name="l4145"><span class="linenum">4145</span></a>  <span class="comment">        // Convert calendar_lookahead to nearest new value.</span>
<a name="l4146"><span class="linenum">4146</span></a>          <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('config', 'value', array('name' =&gt; 'calendar_lookahead'));
<a name="l4147"><span class="linenum">4147</span></a>          if (<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> &gt; 90) {
<a name="l4148"><span class="linenum">4148</span></a>              <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('calendar_lookahead', '120');
<a name="l4149"><span class="linenum">4149</span></a>          } else if (<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> &gt; 60 and <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> &lt; 90) {
<a name="l4150"><span class="linenum">4150</span></a>              <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('calendar_lookahead', '90');
<a name="l4151"><span class="linenum">4151</span></a>          } else if (<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> &gt; 30 and <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> &lt; 60) {
<a name="l4152"><span class="linenum">4152</span></a>              <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('calendar_lookahead', '60');
<a name="l4153"><span class="linenum">4153</span></a>          } else if (<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> &gt; 21 and <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> &lt; 30) {
<a name="l4154"><span class="linenum">4154</span></a>              <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('calendar_lookahead', '30');
<a name="l4155"><span class="linenum">4155</span></a>          } else if (<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> &gt; 14 and <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> &lt; 21) {
<a name="l4156"><span class="linenum">4156</span></a>              <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('calendar_lookahead', '21');
<a name="l4157"><span class="linenum">4157</span></a>          } else if (<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> &gt; 7 and <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> &lt; 14) {
<a name="l4158"><span class="linenum">4158</span></a>              <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('calendar_lookahead', '14');
<a name="l4159"><span class="linenum">4159</span></a>          }
<a name="l4160"><span class="linenum">4160</span></a>  
<a name="l4161"><span class="linenum">4161</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l4162"><span class="linenum">4162</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2015012600.01);
<a name="l4163"><span class="linenum">4163</span></a>      }
<a name="l4164"><span class="linenum">4164</span></a>  
<a name="l4165"><span class="linenum">4165</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2015021100.00) {
<a name="l4166"><span class="linenum">4166</span></a>  
<a name="l4167"><span class="linenum">4167</span></a>  <span class="comment">        // Define field timemodified to be added to registration_hubs.</span>
<a name="l4168"><span class="linenum">4168</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('registration_hubs');
<a name="l4169"><span class="linenum">4169</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('timemodified', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, '10', null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, '0', 'secret');
<a name="l4170"><span class="linenum">4170</span></a>  
<a name="l4171"><span class="linenum">4171</span></a>  <span class="comment">        // Conditionally launch add field timemodified.</span>
<a name="l4172"><span class="linenum">4172</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l4173"><span class="linenum">4173</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l4174"><span class="linenum">4174</span></a>          }
<a name="l4175"><span class="linenum">4175</span></a>  
<a name="l4176"><span class="linenum">4176</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l4177"><span class="linenum">4177</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2015021100.00);
<a name="l4178"><span class="linenum">4178</span></a>      }
<a name="l4179"><span class="linenum">4179</span></a>  
<a name="l4180"><span class="linenum">4180</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2015022401.00) {
<a name="l4181"><span class="linenum">4181</span></a>  
<a name="l4182"><span class="linenum">4182</span></a>  <span class="comment">        // Define index useridfromto (not unique) to be added to message.</span>
<a name="l4183"><span class="linenum">4183</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('message');
<a name="l4184"><span class="linenum">4184</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('useridfromto', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('useridfrom', 'useridto'));
<a name="l4185"><span class="linenum">4185</span></a>  
<a name="l4186"><span class="linenum">4186</span></a>  <span class="comment">        // Conditionally launch add index useridfromto.</span>
<a name="l4187"><span class="linenum">4187</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l4188"><span class="linenum">4188</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l4189"><span class="linenum">4189</span></a>          }
<a name="l4190"><span class="linenum">4190</span></a>  
<a name="l4191"><span class="linenum">4191</span></a>  <span class="comment">        // Define index useridfromto (not unique) to be added to message_read.</span>
<a name="l4192"><span class="linenum">4192</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('message_read');
<a name="l4193"><span class="linenum">4193</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('useridfromto', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('useridfrom', 'useridto'));
<a name="l4194"><span class="linenum">4194</span></a>  
<a name="l4195"><span class="linenum">4195</span></a>  <span class="comment">        // Conditionally launch add index useridfromto.</span>
<a name="l4196"><span class="linenum">4196</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l4197"><span class="linenum">4197</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l4198"><span class="linenum">4198</span></a>          }
<a name="l4199"><span class="linenum">4199</span></a>  
<a name="l4200"><span class="linenum">4200</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l4201"><span class="linenum">4201</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2015022401.00);
<a name="l4202"><span class="linenum">4202</span></a>      }
<a name="l4203"><span class="linenum">4203</span></a>  
<a name="l4204"><span class="linenum">4204</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2015022500.00) {
<a name="l4205"><span class="linenum">4205</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('user_devices');
<a name="l4206"><span class="linenum">4206</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('uuid-userid', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('uuid', 'userid'));
<a name="l4207"><span class="linenum">4207</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l4208"><span class="linenum">4208</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_index')" href="../../_functions/add_index.html" onMouseOver="funcPopup(event,'add_index')">add_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l4209"><span class="linenum">4209</span></a>          }
<a name="l4210"><span class="linenum">4210</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2015022500.00);
<a name="l4211"><span class="linenum">4211</span></a>      }
<a name="l4212"><span class="linenum">4212</span></a>  
<a name="l4213"><span class="linenum">4213</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2015030400.00) {
<a name="l4214"><span class="linenum">4214</span></a>  <span class="comment">        // We have long since switched to storing timemodified per hub rather than a single 'registered' timestamp.</span>
<a name="l4215"><span class="linenum">4215</span></a>          <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('registered');
<a name="l4216"><span class="linenum">4216</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2015030400.00);
<a name="l4217"><span class="linenum">4217</span></a>      }
<a name="l4218"><span class="linenum">4218</span></a>  
<a name="l4219"><span class="linenum">4219</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2015031100.00) {
<a name="l4220"><span class="linenum">4220</span></a>  <span class="comment">        // Unset old config variable.</span>
<a name="l4221"><span class="linenum">4221</span></a>          <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('enabletgzbackups');
<a name="l4222"><span class="linenum">4222</span></a>  
<a name="l4223"><span class="linenum">4223</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2015031100.00);
<a name="l4224"><span class="linenum">4224</span></a>      }
<a name="l4225"><span class="linenum">4225</span></a>  
<a name="l4226"><span class="linenum">4226</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2015031400.00) {
<a name="l4227"><span class="linenum">4227</span></a>  
<a name="l4228"><span class="linenum">4228</span></a>  <span class="comment">        // Define index useridfrom (not unique) to be dropped form message.</span>
<a name="l4229"><span class="linenum">4229</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('message');
<a name="l4230"><span class="linenum">4230</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('useridfrom', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('useridfrom'));
<a name="l4231"><span class="linenum">4231</span></a>  
<a name="l4232"><span class="linenum">4232</span></a>  <span class="comment">        // Conditionally launch drop index useridfrom.</span>
<a name="l4233"><span class="linenum">4233</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l4234"><span class="linenum">4234</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_index')" href="../../_functions/drop_index.html" onMouseOver="funcPopup(event,'drop_index')">drop_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l4235"><span class="linenum">4235</span></a>          }
<a name="l4236"><span class="linenum">4236</span></a>  
<a name="l4237"><span class="linenum">4237</span></a>  <span class="comment">        // Define index useridfrom (not unique) to be dropped form message_read.</span>
<a name="l4238"><span class="linenum">4238</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('message_read');
<a name="l4239"><span class="linenum">4239</span></a>          <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_index')" href="../../_classes/xmldb_index.html" onMouseOver="classPopup(event,'xmldb_index')">xmldb_index</a>('useridfrom', <a class="constant" onClick="logConstant('XMLDB_INDEX_NOTUNIQUE')" href="../../_constants/XMLDB_INDEX_NOTUNIQUE.html" onMouseOver="constPopup(event,'XMLDB_INDEX_NOTUNIQUE')">XMLDB_INDEX_NOTUNIQUE</a>, array('useridfrom'));
<a name="l4240"><span class="linenum">4240</span></a>  
<a name="l4241"><span class="linenum">4241</span></a>  <span class="comment">        // Conditionally launch drop index useridfrom.</span>
<a name="l4242"><span class="linenum">4242</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('index_exists')" href="../../_functions/index_exists.html" onMouseOver="funcPopup(event,'index_exists')">index_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>)) {
<a name="l4243"><span class="linenum">4243</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_index')" href="../../_functions/drop_index.html" onMouseOver="funcPopup(event,'drop_index')">drop_index</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1494" onMouseOver="hilite(1494)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>);
<a name="l4244"><span class="linenum">4244</span></a>          }
<a name="l4245"><span class="linenum">4245</span></a>  
<a name="l4246"><span class="linenum">4246</span></a>  <span class="comment">        // Main savepoint reached.</span>
<a name="l4247"><span class="linenum">4247</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2015031400.00);
<a name="l4248"><span class="linenum">4248</span></a>      }
<a name="l4249"><span class="linenum">4249</span></a>  
<a name="l4250"><span class="linenum">4250</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2015031900.01) {
<a name="l4251"><span class="linenum">4251</span></a>          <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('crontime', 'registration');
<a name="l4252"><span class="linenum">4252</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2015031900.01);
<a name="l4253"><span class="linenum">4253</span></a>      }
<a name="l4254"><span class="linenum">4254</span></a>  
<a name="l4255"><span class="linenum">4255</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2015032000.00) {
<a name="l4256"><span class="linenum">4256</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('badge_criteria');
<a name="l4257"><span class="linenum">4257</span></a>  
<a name="l4258"><span class="linenum">4258</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('description', <a class="constant" onClick="logConstant('XMLDB_TYPE_TEXT')" href="../../_constants/XMLDB_TYPE_TEXT.html" onMouseOver="constPopup(event,'XMLDB_TYPE_TEXT')">XMLDB_TYPE_TEXT</a>, null, null, null, null, null);
<a name="l4259"><span class="linenum">4259</span></a>  <span class="comment">        // Conditionally add description field to the badge_criteria table.</span>
<a name="l4260"><span class="linenum">4260</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l4261"><span class="linenum">4261</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l4262"><span class="linenum">4262</span></a>          }
<a name="l4263"><span class="linenum">4263</span></a>  
<a name="l4264"><span class="linenum">4264</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_field')" href="../../_classes/xmldb_field.html" onMouseOver="classPopup(event,'xmldb_field')">xmldb_field</a>('descriptionformat', <a class="constant" onClick="logConstant('XMLDB_TYPE_INTEGER')" href="../../_constants/XMLDB_TYPE_INTEGER.html" onMouseOver="constPopup(event,'XMLDB_TYPE_INTEGER')">XMLDB_TYPE_INTEGER</a>, 2, null, <a class="constant" onClick="logConstant('XMLDB_NOTNULL')" href="../../_constants/XMLDB_NOTNULL.html" onMouseOver="constPopup(event,'XMLDB_NOTNULL')">XMLDB_NOTNULL</a>, null, 0);
<a name="l4265"><span class="linenum">4265</span></a>  <span class="comment">        // Conditionally add description format field to the badge_criteria table.</span>
<a name="l4266"><span class="linenum">4266</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('field_exists')" href="../../_functions/field_exists.html" onMouseOver="funcPopup(event,'field_exists')">field_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>)) {
<a name="l4267"><span class="linenum">4267</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('add_field')" href="../../_functions/add_field.html" onMouseOver="funcPopup(event,'add_field')">add_field</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>);
<a name="l4268"><span class="linenum">4268</span></a>          }
<a name="l4269"><span class="linenum">4269</span></a>  
<a name="l4270"><span class="linenum">4270</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2015032000.00);
<a name="l4271"><span class="linenum">4271</span></a>      }
<a name="l4272"><span class="linenum">4272</span></a>  
<a name="l4273"><span class="linenum">4273</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2015040200.01) {
<a name="l4274"><span class="linenum">4274</span></a>  <span class="comment">        // Force uninstall of deleted tool.</span>
<a name="l4275"><span class="linenum">4275</span></a>          if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(&quot;<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a>/<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('admin')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/admin.html">admin</a>/tool/timezoneimport&quot;)) {
<a name="l4276"><span class="linenum">4276</span></a>  <span class="comment">            // Remove capabilities.</span>
<a name="l4277"><span class="linenum">4277</span></a>              <a class="function" onClick="logFunction('capabilities_cleanup')" href="../../_functions/capabilities_cleanup.html" onMouseOver="funcPopup(event,'capabilities_cleanup')">capabilities_cleanup</a>('tool_timezoneimport');
<a name="l4278"><span class="linenum">4278</span></a>  <span class="comment">            // Remove all other associated config.</span>
<a name="l4279"><span class="linenum">4279</span></a>              <a class="function" onClick="logFunction('unset_all_config_for_plugin')" href="../../_functions/unset_all_config_for_plugin.html" onMouseOver="funcPopup(event,'unset_all_config_for_plugin')">unset_all_config_for_plugin</a>('tool_timezoneimport');
<a name="l4280"><span class="linenum">4280</span></a>          }
<a name="l4281"><span class="linenum">4281</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2015040200.01);
<a name="l4282"><span class="linenum">4282</span></a>      }
<a name="l4283"><span class="linenum">4283</span></a>  
<a name="l4284"><span class="linenum">4284</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2015040200.02) {
<a name="l4285"><span class="linenum">4285</span></a>  <span class="comment">        // Define table timezone to be dropped.</span>
<a name="l4286"><span class="linenum">4286</span></a>          <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('xmldb_table')" href="../../_classes/xmldb_table.html" onMouseOver="classPopup(event,'xmldb_table')">xmldb_table</a>('timezone');
<a name="l4287"><span class="linenum">4287</span></a>  <span class="comment">        // Conditionally launch drop table for timezone.</span>
<a name="l4288"><span class="linenum">4288</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>)) {
<a name="l4289"><span class="linenum">4289</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('drop_table')" href="../../_functions/drop_table.html" onMouseOver="funcPopup(event,'drop_table')">drop_table</a>(<a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l4290"><span class="linenum">4290</span></a>          }
<a name="l4291"><span class="linenum">4291</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2015040200.02);
<a name="l4292"><span class="linenum">4292</span></a>      }
<a name="l4293"><span class="linenum">4293</span></a>  
<a name="l4294"><span class="linenum">4294</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2015040200.03) {
<a name="l4295"><span class="linenum">4295</span></a>          if (isset(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('timezone')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/timezone.html">timezone</a>) and <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('timezone')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/timezone.html">timezone</a> == 99) {
<a name="l4296"><span class="linenum">4296</span></a>  <span class="comment">            // Migrate to real server timezone.</span>
<a name="l4297"><span class="linenum">4297</span></a>              <a class="function" onClick="logFunction('unset_config')" href="../../_functions/unset_config.html" onMouseOver="funcPopup(event,'unset_config')">unset_config</a>('timezone');
<a name="l4298"><span class="linenum">4298</span></a>          }
<a name="l4299"><span class="linenum">4299</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2015040200.03);
<a name="l4300"><span class="linenum">4300</span></a>      }
<a name="l4301"><span class="linenum">4301</span></a>  
<a name="l4302"><span class="linenum">4302</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2015040700.01) {
<a name="l4303"><span class="linenum">4303</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('config_plugins', array('name' =&gt; 'requiremodintro'));
<a name="l4304"><span class="linenum">4304</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2015040700.01);
<a name="l4305"><span class="linenum">4305</span></a>      }
<a name="l4306"><span class="linenum">4306</span></a>  
<a name="l4307"><span class="linenum">4307</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2015040900.01) {
<a name="l4308"><span class="linenum">4308</span></a>  <span class="comment">        // Add &quot;My grades&quot; to the user menu.</span>
<a name="l4309"><span class="linenum">4309</span></a>          <a class="var it15098" onMouseOver="hilite(15098)" onMouseOut="lolite()" onClick="logVariable('oldconfig')" href="../../_variables/oldconfig.html">$oldconfig</a> = <a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('core', 'customusermenuitems');
<a name="l4310"><span class="linenum">4310</span></a>          if (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(&quot;mygrades,grades|/grade/report/mygrades.php|grades&quot;, <a class="var it15098" onMouseOver="hilite(15098)" onMouseOut="lolite()" onClick="logVariable('oldconfig')" href="../../_variables/oldconfig.html">$oldconfig</a>) === false) {
<a name="l4311"><span class="linenum">4311</span></a>              <a class="var it12974" onMouseOver="hilite(12974)" onMouseOut="lolite()" onClick="logVariable('newconfig')" href="../../_variables/newconfig.html">$newconfig</a> = &quot;mygrades,grades|/grade/report/mygrades.php|grades\n&quot; . <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('customusermenuitems')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/customusermenuitems.html">customusermenuitems</a>;
<a name="l4312"><span class="linenum">4312</span></a>              <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('customusermenuitems', <a class="var it12974" onMouseOver="hilite(12974)" onMouseOut="lolite()" onClick="logVariable('newconfig')" href="../../_variables/newconfig.html">$newconfig</a>);
<a name="l4313"><span class="linenum">4313</span></a>          }
<a name="l4314"><span class="linenum">4314</span></a>  
<a name="l4315"><span class="linenum">4315</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2015040900.01);
<a name="l4316"><span class="linenum">4316</span></a>      }
<a name="l4317"><span class="linenum">4317</span></a>  
<a name="l4318"><span class="linenum">4318</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2015040900.02) {
<a name="l4319"><span class="linenum">4319</span></a>  <span class="comment">        // Update the default user menu (add preferences, remove my files and my badges).</span>
<a name="l4320"><span class="linenum">4320</span></a>          <a class="var it15098" onMouseOver="hilite(15098)" onMouseOut="lolite()" onClick="logVariable('oldconfig')" href="../../_variables/oldconfig.html">$oldconfig</a> = <a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('core', 'customusermenuitems');
<a name="l4321"><span class="linenum">4321</span></a>  
<a name="l4322"><span class="linenum">4322</span></a>  <span class="comment">        // Add &quot;My preferences&quot; at the end.</span>
<a name="l4323"><span class="linenum">4323</span></a>          if (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it15098" onMouseOver="hilite(15098)" onMouseOut="lolite()" onClick="logVariable('oldconfig')" href="../../_variables/oldconfig.html">$oldconfig</a>, &quot;mypreferences,moodle|/user/preference.php|preferences&quot;) === false) {
<a name="l4324"><span class="linenum">4324</span></a>              <a class="var it12974" onMouseOver="hilite(12974)" onMouseOut="lolite()" onClick="logVariable('newconfig')" href="../../_variables/newconfig.html">$newconfig</a> = <a class="var it15098" onMouseOver="hilite(15098)" onMouseOut="lolite()" onClick="logVariable('oldconfig')" href="../../_variables/oldconfig.html">$oldconfig</a> . &quot;\nmypreferences,moodle|/user/preferences.php|preferences&quot;;
<a name="l4325"><span class="linenum">4325</span></a>          } else {
<a name="l4326"><span class="linenum">4326</span></a>              <a class="var it12974" onMouseOver="hilite(12974)" onMouseOut="lolite()" onClick="logVariable('newconfig')" href="../../_variables/newconfig.html">$newconfig</a> = <a class="var it15098" onMouseOver="hilite(15098)" onMouseOut="lolite()" onClick="logVariable('oldconfig')" href="../../_variables/oldconfig.html">$oldconfig</a>;
<a name="l4327"><span class="linenum">4327</span></a>          }
<a name="l4328"><span class="linenum">4328</span></a>  <span class="comment">        // Remove my files.</span>
<a name="l4329"><span class="linenum">4329</span></a>          <a class="var it12974" onMouseOver="hilite(12974)" onMouseOut="lolite()" onClick="logVariable('newconfig')" href="../../_variables/newconfig.html">$newconfig</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>(&quot;myfiles,moodle|/user/files.php|download&quot;, &quot;&quot;, <a class="var it12974" onMouseOver="hilite(12974)" onMouseOut="lolite()" onClick="logVariable('newconfig')" href="../../_variables/newconfig.html">$newconfig</a>);
<a name="l4330"><span class="linenum">4330</span></a>  <span class="comment">        // Remove my badges.</span>
<a name="l4331"><span class="linenum">4331</span></a>          <a class="var it12974" onMouseOver="hilite(12974)" onMouseOut="lolite()" onClick="logVariable('newconfig')" href="../../_variables/newconfig.html">$newconfig</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>(&quot;mybadges,badges|/badges/mybadges.php|award&quot;, &quot;&quot;, <a class="var it12974" onMouseOver="hilite(12974)" onMouseOut="lolite()" onClick="logVariable('newconfig')" href="../../_variables/newconfig.html">$newconfig</a>);
<a name="l4332"><span class="linenum">4332</span></a>  <span class="comment">        // Remove holes.</span>
<a name="l4333"><span class="linenum">4333</span></a>          <a class="var it12974" onMouseOver="hilite(12974)" onMouseOut="lolite()" onClick="logVariable('newconfig')" href="../../_variables/newconfig.html">$newconfig</a> = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>('/\n+/', &quot;\n&quot;, <a class="var it12974" onMouseOver="hilite(12974)" onMouseOut="lolite()" onClick="logVariable('newconfig')" href="../../_variables/newconfig.html">$newconfig</a>);
<a name="l4334"><span class="linenum">4334</span></a>          <a class="var it12974" onMouseOver="hilite(12974)" onMouseOut="lolite()" onClick="logVariable('newconfig')" href="../../_variables/newconfig.html">$newconfig</a> = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>('/(\r\n)+/', &quot;\n&quot;, <a class="var it12974" onMouseOver="hilite(12974)" onMouseOut="lolite()" onClick="logVariable('newconfig')" href="../../_variables/newconfig.html">$newconfig</a>);
<a name="l4335"><span class="linenum">4335</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('customusermenuitems', <a class="var it12974" onMouseOver="hilite(12974)" onMouseOut="lolite()" onClick="logVariable('newconfig')" href="../../_variables/newconfig.html">$newconfig</a>);
<a name="l4336"><span class="linenum">4336</span></a>  
<a name="l4337"><span class="linenum">4337</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2015040900.02);
<a name="l4338"><span class="linenum">4338</span></a>      }
<a name="l4339"><span class="linenum">4339</span></a>  
<a name="l4340"><span class="linenum">4340</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2015050400.00) {
<a name="l4341"><span class="linenum">4341</span></a>          <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a> = <a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('core', 'customusermenuitems');
<a name="l4342"><span class="linenum">4342</span></a>  
<a name="l4343"><span class="linenum">4343</span></a>  <span class="comment">        // Change &quot;My preferences&quot; in the user menu to &quot;Preferences&quot;.</span>
<a name="l4344"><span class="linenum">4344</span></a>          <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>(&quot;mypreferences,moodle|/user/preferences.php|preferences&quot;,
<a name="l4345"><span class="linenum">4345</span></a>              &quot;preferences,moodle|/user/preferences.php|preferences&quot;, <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>);
<a name="l4346"><span class="linenum">4346</span></a>  
<a name="l4347"><span class="linenum">4347</span></a>  <span class="comment">        // Change &quot;My grades&quot; in the user menu to &quot;Grades&quot;.</span>
<a name="l4348"><span class="linenum">4348</span></a>          <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>(&quot;mygrades,grades|/grade/report/mygrades.php|grades&quot;,
<a name="l4349"><span class="linenum">4349</span></a>              &quot;grades,grades|/grade/report/mygrades.php|grades&quot;, <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>);
<a name="l4350"><span class="linenum">4350</span></a>  
<a name="l4351"><span class="linenum">4351</span></a>          <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('customusermenuitems', <a class="var it1113" onMouseOver="hilite(1113)" onMouseOut="lolite()" onClick="logVariable('config')" href="../../_variables/config.html">$config</a>);
<a name="l4352"><span class="linenum">4352</span></a>  
<a name="l4353"><span class="linenum">4353</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2015050400.00);
<a name="l4354"><span class="linenum">4354</span></a>      }
<a name="l4355"><span class="linenum">4355</span></a>  
<a name="l4356"><span class="linenum">4356</span></a>      if (<a class="var it671" onMouseOver="hilite(671)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../_variables/oldversion.html">$oldversion</a> &lt; 2015050401.00) {
<a name="l4357"><span class="linenum">4357</span></a>  <span class="comment">        // Make sure we have messages in the user menu because it's no longer in the nav tree.</span>
<a name="l4358"><span class="linenum">4358</span></a>          <a class="var it15098" onMouseOver="hilite(15098)" onMouseOut="lolite()" onClick="logVariable('oldconfig')" href="../../_variables/oldconfig.html">$oldconfig</a> = <a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('core', 'customusermenuitems');
<a name="l4359"><span class="linenum">4359</span></a>          <a class="var it37355" onMouseOver="hilite(37355)" onMouseOut="lolite()" onClick="logVariable('messagesconfig')" href="../../_variables/messagesconfig.html">$messagesconfig</a> = &quot;messages,message|/message/index.php|message&quot;;
<a name="l4360"><span class="linenum">4360</span></a>          <a class="var it37356" onMouseOver="hilite(37356)" onMouseOut="lolite()" onClick="logVariable('preferencesconfig')" href="../../_variables/preferencesconfig.html">$preferencesconfig</a> = &quot;preferences,moodle|/user/preferences.php|preferences&quot;;
<a name="l4361"><span class="linenum">4361</span></a>  
<a name="l4362"><span class="linenum">4362</span></a>  <span class="comment">        // See if it exists.</span>
<a name="l4363"><span class="linenum">4363</span></a>          if (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it15098" onMouseOver="hilite(15098)" onMouseOut="lolite()" onClick="logVariable('oldconfig')" href="../../_variables/oldconfig.html">$oldconfig</a>, <a class="var it37355" onMouseOver="hilite(37355)" onMouseOut="lolite()" onClick="logVariable('messagesconfig')" href="../../_variables/messagesconfig.html">$messagesconfig</a>) === false) {
<a name="l4364"><span class="linenum">4364</span></a>  <span class="comment">            // See if preferences exists.</span>
<a name="l4365"><span class="linenum">4365</span></a>              if (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it15098" onMouseOver="hilite(15098)" onMouseOut="lolite()" onClick="logVariable('oldconfig')" href="../../_variables/oldconfig.html">$oldconfig</a>, &quot;preferences,moodle|/user/preferences.php|preferences&quot;) !== false) {
<a name="l4366"><span class="linenum">4366</span></a>  <span class="comment">                // Insert it before preferences.</span>
<a name="l4367"><span class="linenum">4367</span></a>                  <a class="var it12974" onMouseOver="hilite(12974)" onMouseOut="lolite()" onClick="logVariable('newconfig')" href="../../_variables/newconfig.html">$newconfig</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>(<a class="var it37356" onMouseOver="hilite(37356)" onMouseOut="lolite()" onClick="logVariable('preferencesconfig')" href="../../_variables/preferencesconfig.html">$preferencesconfig</a>, <a class="var it37355" onMouseOver="hilite(37355)" onMouseOut="lolite()" onClick="logVariable('messagesconfig')" href="../../_variables/messagesconfig.html">$messagesconfig</a> . &quot;\n&quot; . <a class="var it37356" onMouseOver="hilite(37356)" onMouseOut="lolite()" onClick="logVariable('preferencesconfig')" href="../../_variables/preferencesconfig.html">$preferencesconfig</a>, <a class="var it15098" onMouseOver="hilite(15098)" onMouseOut="lolite()" onClick="logVariable('oldconfig')" href="../../_variables/oldconfig.html">$oldconfig</a>);
<a name="l4368"><span class="linenum">4368</span></a>              } else {
<a name="l4369"><span class="linenum">4369</span></a>  <span class="comment">                // Custom config - we can only insert it at the end.</span>
<a name="l4370"><span class="linenum">4370</span></a>                  <a class="var it12974" onMouseOver="hilite(12974)" onMouseOut="lolite()" onClick="logVariable('newconfig')" href="../../_variables/newconfig.html">$newconfig</a> = <a class="var it15098" onMouseOver="hilite(15098)" onMouseOut="lolite()" onClick="logVariable('oldconfig')" href="../../_variables/oldconfig.html">$oldconfig</a> . &quot;\n&quot; . <a class="var it37355" onMouseOver="hilite(37355)" onMouseOut="lolite()" onClick="logVariable('messagesconfig')" href="../../_variables/messagesconfig.html">$messagesconfig</a>;
<a name="l4371"><span class="linenum">4371</span></a>              }
<a name="l4372"><span class="linenum">4372</span></a>              <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('customusermenuitems', <a class="var it12974" onMouseOver="hilite(12974)" onMouseOut="lolite()" onClick="logVariable('newconfig')" href="../../_variables/newconfig.html">$newconfig</a>);
<a name="l4373"><span class="linenum">4373</span></a>          }
<a name="l4374"><span class="linenum">4374</span></a>  
<a name="l4375"><span class="linenum">4375</span></a>          <a class="function" onClick="logFunction('upgrade_main_savepoint')" href="../../_functions/upgrade_main_savepoint.html" onMouseOver="funcPopup(event,'upgrade_main_savepoint')">upgrade_main_savepoint</a>(true, 2015050401.00);
<a name="l4376"><span class="linenum">4376</span></a>      }
<a name="l4377"><span class="linenum">4377</span></a>  
<a name="l4378"><span class="linenum">4378</span></a>  <span class="comment">    // Moodle v2.9.0 release upgrade line.</span>
<a name="l4379"><span class="linenum">4379</span></a>  <span class="comment">    // Put any upgrade step following this.</span>
<a name="l4380"><span class="linenum">4380</span></a>  
<a name="l4381"><span class="linenum">4381</span></a>      return true;
<a name="l4382"><span class="linenum">4382</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'set_config': ['set_config', 'Set a configuration value for this plugin ', [['mod/assign','assignmentplugin.php',314],['lib/portfolio','plugin.php',515],['lib','moodlelib.php',1331],['lib','enrollib.php',1152],['lib/editor/tinymce/classes','plugin.php',84]], 985],
'unset_all_config_for_plugin': ['unset_all_config_for_plugin', 'Remove all the config variables for a given plugin. ', [['lib','moodlelib.php',1523]], 28],
'get_config': ['get_config', 'Get a configuration value for this plugin ', [['mod/assign','assignmentplugin.php',345],['lib/portfolio','plugin.php',546],['question/engine','bank.php',109],['lib','moodlelib.php',1404],['lib','enrollib.php',1141],['lib/editor/tinymce/classes','plugin.php',73],['admin/tool/log/classes/helper','store.php',63]], 847],
'upgrade_grade_item_fix_sortorder': ['upgrade_grade_item_fix_sortorder', 'Detect duplicate grade item sortorders and resort the items to remove them. ', [['lib','upgradelib.php',2103]], 2],
'check_dir_exists': ['check_dir_exists', 'Function to check if a directory exists and by default create it if not exists. ', [['lib','setuplib.php',1366]], 46],
'where': ['where', 'Add where clause ', [['lib/zend/Zend/Service/WindowsAzure/Storage','TableEntityQuery.php',120],['question/classes/bank/search','category_condition.php',96],['question/classes/bank/search','hidden_condition.php',53],['question/engine','datalib.php',1882],['question/engine','datalib.php',1964]], 61],
'exists': ['exists', 'Checks whether or not the variable exists. ', [['lib/htmlpurifier/HTMLPurifier','Context.php',73],['lib/horde/framework/Horde','Variables.php',101],['admin/tool/health','index.php',139],['admin/tool/health','index.php',160],['admin/tool/health','index.php',184],['admin/tool/health','index.php',208],['admin/tool/health','index.php',229],['admin/tool/health','index.php',248],['admin/tool/health','index.php',267],['admin/tool/health','index.php',313],['admin/tool/health','index.php',334],['admin/tool/health','index.php',420],['admin/tool/health','index.php',444],['admin/tool/health','index.php',481],['admin/tool/health','index.php',506],['admin/tool/health','index.php',554],['admin/tool/health','index.php',617],['admin/tool/health','index.php',707],['admin/tool/health','index.php',777],['lib/horde/framework/Horde/Imap/Client/Data','Fetch.php',468],['admin/tool/uploadcourse/classes','course.php',252]], 56],
'get_roles_with_cap_in_context': ['get_roles_with_cap_in_context', 'Returns two lists, this can be used to find out if user has capability. Having any needed role and no forbidden role in this context means user has this capability in this context. Use get_role_names_with_cap_in_context() if you need role names to display in the UI ', [['lib','accesslib.php',4790]], 10],
'delete_records_list': ['delete_records_list', 'Delete the records from a table where one field match one list of values. ', [['lib/dml','moodle_database.php',1834]], 36],
'capabilities_cleanup': ['capabilities_cleanup', 'Deletes cached capabilities that are no longer needed by the component. Also unassigns these capabilities from any roles that have them. NOTE: this function is called from lib/db/upgrade.php ', [['lib','accesslib.php',2794]], 6],
'count_records': ['count_records', 'Count the records in a table where all the given conditions met. ', [['lib/dml','moodle_database.php',1717]], 1399],
'clone': ['clone', '', [['lib/editor/tinymce/tiny_mce/3.5.11/plugins/media/js','media.js',11]], 315],
'start_delegated_transaction': ['start_delegated_transaction', 'On DBs that support it, switch to transaction mode and begin a transaction you\'ll need to ensure you call allow_commit() on the returned object or your changes *will* be lost. ', [['lib/dml','moodle_database.php',2344]], 137],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required. ', [['lib/dml','pgsql_native_moodle_database.php',883],['lib/dml','oci_native_moodle_database.php',1249],['lib/dml','sqlsrv_native_moodle_database.php',978],['lib/dml','mssql_native_moodle_database.php',898],['lib/dml','mysqli_native_moodle_database.php',1177],['lib/dml/tests','dml_test.php',5427],['lib/dml','pdo_moodle_database.php',386],['question/engine/upgrade','upgradelib.php',121]], 1512],
'allow_commit': ['allow_commit', 'Commit delegated transaction. The real database commit SQL is executed only after committing all delegated transactions. ', [['lib/dml','moodle_transaction.php',78]], 127],
'sql_like': ['sql_like', 'Returns \'LIKE\' part of a query. ', [['lib/dml','pgsql_native_moodle_database.php',1273],['lib/dml','oci_native_moodle_database.php',1523],['lib/dml','sqlsrv_native_moodle_database.php',1224],['lib/dml','moodle_database.php',2004],['lib/dml','mssql_native_moodle_database.php',1160],['lib/dml','mysqli_native_moodle_database.php',1502]], 158],
'change_field_notnull': ['change_field_notnull', 'This function will change the nullability of the field in the table passed as arguments ', [['lib/ddl','database_manager.php',611]], 10],
'get_recordset': ['get_recordset', 'Get a number of records as a moodle_recordset where all the given conditions met. ', [['lib/dml','moodle_database.php',1113]], 95],
'upgrade_availability_item': ['upgrade_availability_item', 'Updates a single item (course module or course section) to transfer the availability settings from the old to the new format. ', [['lib/db','upgradelib.php',352]], 20],
'get_recordset_sql': ['get_recordset_sql', 'Get a number of records as a moodle_recordset using a SQL statement. ', [['lib/dml','pgsql_native_moodle_database.php',688],['lib/dml','oci_native_moodle_database.php',1065],['lib/dml','sqlsrv_native_moodle_database.php',761],['lib/dml','mssql_native_moodle_database.php',687],['lib/dml','mysqli_native_moodle_database.php',985],['lib/dml/tests','dml_test.php',5423],['lib/dml','pdo_moodle_database.php',251]], 279],
'get_records_select': ['get_records_select', 'Get a number of records as an array of objects which match a particular WHERE clause. ', [['lib/dml','moodle_database.php',1283]], 163],
'drop_table': ['drop_table', 'This function will drop the table passed as argument and all the associated objects (keys, indexes, constraints, sequences, triggers) will be dropped too. ', [['lib/ddl','database_manager.php',308]], 77],
'set_field_select': ['set_field_select', 'Set a single field in every table record which match a particular WHERE clause. ', [['lib/dml','pgsql_native_moodle_database.php',1192],['lib/dml','oci_native_moodle_database.php',1387],['lib/dml','sqlsrv_native_moodle_database.php',1111],['lib/dml','mssql_native_moodle_database.php',1033],['lib/dml','mysqli_native_moodle_database.php',1427],['lib/dml/tests','dml_test.php',5431],['lib/dml','pdo_moodle_database.php',491]], 78],
'get_records': ['get_records', 'Get a number of records as an array of objects where all the given conditions met. ', [['lib/dml','moodle_database.php',1236],['lib','coursecatlib.php',654],['question','category_class.php',63]], 860],
'get_records_menu': ['get_records_menu', 'Get the first two columns from a number of records as an associative array where all the given conditions met. ', [['lib/dml','moodle_database.php',1326]], 69],
'update': ['update', 'Update a customer resource if one it exists and is owned by the reseller. (customers.update) ', [['lib/google/src/Google/Service','Reseller.php',343],['mod/lesson/pagetypes','matching.php',308],['lib/adodb','adodb-active-recordx.inc.php',1047],['lib/grade','grade_object.php',238],['lib/google/src/Google/Service','Fusiontables.php',726],['lib/google/src/Google/Service','Fusiontables.php',889],['lib/google/src/Google/Service','Fusiontables.php',1095],['lib/google/src/Google/Service','Fusiontables.php',1269],['grade/grading/form','lib.php',905],['lib/google/src/Google/Service','Blogger.php',1332],['lib/google/src/Google/Service','Blogger.php',1630],['lib/google/src/Google/Service','Doubleclicksearch.php',325],['lib/google/src/Google/Service','AdExchangeBuyer.php',392],['lib/google/src/Google/Service','AdExchangeBuyer.php',684],['lib/grade','grade_item.php',260],['lib/google/src/Google/Service','Gmail.php',756],['lib/google/src/Google/Service','Gmail.php',908],['lib/google/src/Google/Service','Mirror.php',495],['lib/google/src/Google/Service','Mirror.php',633],['lib/google/src/Google/Service','Mirror.php',744],['lib/google/src/Google/Service','Genomics.php',690],['lib/google/src/Google/Service','Genomics.php',811],['lib/google/src/Google/Service','Genomics.php',1064],['lib/google/src/Google/Service','Genomics.php',1370],['lib/google/src/Google/Service','Genomics.php',1521],['lib/google/src/Google/Service','Dfareporting.php',570],['lib/google/src/Google/Service','PlusDomains.php',691],['lib/google/src/Google/Service','Licensing.php',332],['lib/google/src/Google/Service','Drive.php',1624],['lib/google/src/Google/Service','Drive.php',1859],['lib/google/src/Google/Service','Drive.php',2100],['lib/google/src/Google/Service','Drive.php',2211],['lib/google/src/Google/Service','Drive.php',2261],['lib/google/src/Google/Service','Drive.php',2385],['lib/google/src/Google/Service','Drive.php',2473],['completion','data_object.php',251],['lib/google/src/Google/Service','Books.php',1901],['lib/google/src/Google/Service','Bigquery.php',603],['lib/google/src/Google/Service','Bigquery.php',911],['lib/google/src/Google/Service','Groupssettings.php',137],['lib/google/src/Google/Service','YouTube.php',1596],['lib/google/src/Google/Service','YouTube.php',1697],['lib/google/src/Google/Service','YouTube.php',2201],['lib/google/src/Google/Service','YouTube.php',2439],['lib/google/src/Google/Service','YouTube.php',2613],['lib/google/src/Google/Service','YouTube.php',2809],['lib/google/src/Google/Service','YouTube.php',3419],['lib/google/src/Google/Service','Coordinate.php',568],['lib/google/src/Google/Service','Coordinate.php',680],['lib/google/src/Google/Service','Autoscaler.php',399],['calendar','lib.php',2171],['lib/google/src/Google/Service','ShoppingContent.php',633],['lib/google/src/Google/Service','ShoppingContent.php',815],['lib','weblib.php',3154],['mod/lesson','locallib.php',2682],['lib/google/src/Google/Service','SQLAdmin.php',843],['lib/google/src/Google/Service','Fitness.php',424],['lib/google/src/Google/Service','Fitness.php',607],['lib/google/src/Google/Service','TagManager.php',1004],['lib/google/src/Google/Service','TagManager.php',1093],['lib/google/src/Google/Service','TagManager.php',1186],['lib/google/src/Google/Service','TagManager.php',1279],['lib/google/src/Google/Service','TagManager.php',1372],['lib/google/src/Google/Service','TagManager.php',1466],['lib/google/src/Google/Service','TagManager.php',1560],['lib/google/src/Google/Service','TagManager.php',1711],['lib/google/src/Google/Service','TagManager.php',1804],['mod/lesson/pagetypes','truefalse.php',163],['lib/google/src/Google/Service','Directory.php',1446],['lib/google/src/Google/Service','Directory.php',1559],['lib/google/src/Google/Service','Directory.php',1724],['lib/google/src/Google/Service','Directory.php',1907],['lib/google/src/Google/Service','Directory.php',2014],['lib/google/src/Google/Service','Directory.php',2116],['lib/google/src/Google/Service','Directory.php',2337],['lib/google/src/Google/Service','Directory.php',2523],['lib/xhprof/xhprof_html/jquery','jquery.tooltip.js',200],['lib/google/src/Google/Service','AppState.php',201],['lib/google/src/Google/Service','Taskqueue.php',397],['lib/google/src/Google/Service','AndroidPublisher.php',1360],['lib/google/src/Google/Service','AndroidPublisher.php',1472],['lib/google/src/Google/Service','AndroidPublisher.php',1542],['lib/google/src/Google/Service','AndroidPublisher.php',1780],['lib/google/src/Google/Service','AndroidPublisher.php',1846],['lib/google/src/Google/Service','AndroidPublisher.php',1928],['lib/google/src/Google/Service','AndroidPublisher.php',2066],['mod/lesson/pagetypes','essay.php',158],['lib/google/src/Google/Service','AdSenseHost.php',845],['lib/google/src/Google/Service','AdSenseHost.php',1096],['lib/google/src/Google/Service','Games.php',1507],['lib/grade','grade_grade.php',940],['lib/google/src/Google/Service','SiteVerification.php',226],['lib/horde/framework/Horde/Support','Array.php',70],['lib/google/src/Google/Service','Prediction.php',338],['lib/google/src/Google/Service','Compute.php',2999],['lib/google/src/Google/Service','Compute.php',3310],['lib/google/src/Google/Service','Compute.php',3814],['lib/google/src/Google/Service','Compute.php',5314],['lib/google/src/Google/Service','Calendar.php',979],['lib/google/src/Google/Service','Calendar.php',1144],['lib/google/src/Google/Service','Calendar.php',1285],['lib/google/src/Google/Service','Calendar.php',1633],['lib/google/src/Google/Service','Analytics.php',2118],['lib/google/src/Google/Service','Analytics.php',2385],['lib/google/src/Google/Service','Analytics.php',2495],['lib/google/src/Google/Service','Analytics.php',2602],['lib/google/src/Google/Service','Analytics.php',2730],['lib/google/src/Google/Service','Analytics.php',2821],['lib/google/src/Google/Service','Analytics.php',2944],['lib/google/src/Google/Service','Analytics.php',3277],['lib/google/src/Google/Service','Analytics.php',3379],['lib/google/src/Google/Service','Analytics.php',3461],['lib/google/src/Google/Service','Tasks.php',385],['lib/google/src/Google/Service','Tasks.php',555],['lib/horde/framework/Horde/Imap/Client/Ids','Map.php',72],['grade/grading/form/guide','lib.php',826],['lib/grade','grade_category.php',204],['lib/google/src/Google/Service','Storage.php',1030],['lib/google/src/Google/Service','Storage.php',1165],['lib/google/src/Google/Service','Storage.php',1318],['lib/google/src/Google/Service','Storage.php',1454],['lib/google/src/Google/Service','Storage.php',1718],['lib/filestorage','stored_file.php',103],['grade/grading/form/rubric','lib.php',828],['lib/grade','grade_scale.php',125],['lib','coursecatlib.php',441],['lib/adodb','adodb-active-record.inc.php',878],['lib/grade','grade_outcome.php',144],['mod/lesson/pagetypes','branchtable.php',262]], 290],
'upgrade_mssql_varbinarymax': ['upgrade_mssql_varbinarymax', 'Migrate IMAGE to VARBINARY(MAX). ', [['lib/db','upgradelib.php',223]], 1],
'upgrade_mssql_nvarcharmax': ['upgrade_mssql_nvarcharmax', 'Migrate NTEXT to NVARCHAR(MAX). ', [['lib/db','upgradelib.php',168]], 1],
'set_field': ['set_field', 'Sets the custom profile field used for testing. ', [['availability/condition/profile/tests','condition_test.php',349],['lib/dml','moodle_database.php',1688]], 462],
'upgrade_save_orphaned_questions': ['upgrade_save_orphaned_questions', 'Find questions missing an existing category and associate them with a category which purpose is to gather them. ', [['lib','upgradelib.php',1962]], 1],
'sql_isnotempty': ['sql_isnotempty', 'Returns the proper SQL to know if one field is not empty. ', [['lib/dml','moodle_database.php',2179]], 27],
'upgrade_mysql_fix_unsigned_and_lob_columns': ['upgrade_mysql_fix_unsigned_and_lob_columns', 'Remove all signed numbers from current database and change text fields to long texts - mysql only. ', [['lib/db','upgradelib.php',79]], 1],
'xmldb_main_upgrade': ['xmldb_main_upgrade', 'Main upgrade tasks to be executed on Moodle version bump ', [['lib/db','upgrade.php',45]], 1],
'join': ['join', 'Join a room. For internal use by the Games SDK only. Calling this method directly is unsupported. (rooms.join) ', [['lib/google/src/Google/Service','Games.php',1715],['lib/google/src/Google/Service','Games.php',2099]], 949],
'table_exists': ['table_exists', 'Given one xmldb_table, check if it exists in DB (true/false). ', [['lib/ddl','database_manager.php',89],['lib/ddl','sql_generator.php',215]], 156],
'get_record': ['get_record', 'Get a single database record as an object where all the given conditions met. ', [['lib/dml','moodle_database.php',1413]], 2960],
'change_field_type': ['change_field_type', 'This function will change the type of the field in the table passed as arguments ', [['lib/ddl','database_manager.php',561]], 21],
'upgrade_set_timeout': ['upgrade_set_timeout', 'Sets maximum expected time needed for upgrade task. Please always make sure that upgrade will not run longer! ', [['lib','upgradelib.php',140]], 19],
'upgrade_course_completion_remove_duplicates': ['upgrade_course_completion_remove_duplicates', 'This function finds duplicate records (based on combinations of fields that should be unique) and then progamatically generated a "most correct" version of the data, update and removing records as appropriate ', [['lib','upgradelib.php',1888]], 3],
'upgrade_rename_old_backup_files_using_shortname': ['upgrade_rename_old_backup_files_using_shortname', 'Rename old backup files to current backup files. ', [['lib','upgradelib.php',2002]], 1],
'upgrade_fix_missing_root_folders_draft': ['upgrade_fix_missing_root_folders_draft', 'Detect draft file areas with missing root directory records and add them. ', [['lib','upgradelib.php',2181]], 2],
'change_field_default': ['change_field_default', 'This function will change the default of the field in the table passed as arguments One null value in the default field means delete the default ', [['lib/ddl','database_manager.php',623]], 6],
'drop_key': ['drop_key', 'This function will drop the key in the table passed as arguments ', [['lib/ddl','database_manager.php',747]], 12],
'count_records_sql': ['count_records_sql', 'Get the result of a SQL SELECT COUNT(...) query. ', [['lib/dml','moodle_database.php',1747]], 132],
'assign_capability': ['assign_capability', '', [['lib/tests','coursecatlib_test.php',66],['lib','accesslib.php',1543]], 118],
'get_dbfamily': ['get_dbfamily', 'Returns database family type - describes SQL dialect Note: can be used before connect() ', [['lib/dml','pgsql_native_moodle_database.php',61],['lib/dml','oci_native_moodle_database.php',67],['lib/dml','sqlsrv_native_moodle_database.php',75],['lib/dml','sqlite3_pdo_moodle_database.php',50],['lib/dml','mssql_native_moodle_database.php',56],['lib/dml','mysqli_native_moodle_database.php',117],['lib/dml/tests','dml_test.php',5406]], 59],
'upgrade_group_members_only': ['upgrade_group_members_only', 'Using data for a single course-module that has groupmembersonly enabled, returns the new availability value that incorporates the correct groupmembersonly option. ', [['lib/db','upgradelib.php',460]], 2],
'change_field_precision': ['change_field_precision', 'This function will change the precision of the field in the table passed as arguments ', [['lib/ddl','database_manager.php',586]], 22],
'field_exists': ['field_exists', 'Given one xmldb_field, check if it exists in DB (true/false). ', [['lib/ddl','database_manager.php',121]], 244],
'add_key': ['add_key', 'This function will create the key in the table passed as arguments ', [['lib/ddl','database_manager.php',727],['lib/xmldb','xmldb_table.php',787]], 251],
'add_field': ['add_field', 'This function will add the field to the table passed as arguments ', [['lib/ddl','database_manager.php',510],['lib/xmldb','xmldb_table.php',766]], 888],
'list': ['list', '', [['mod/data/preset/imagegallery','jstemplate.js',9]], 1891],
'get_manager': ['get_manager', 'Returns the sql generator used for db manipulation. Used mostly in upgrade.php scripts. ', [['lib/dml','moodle_database.php',1030]], 273],
'unset_config': ['unset_config', 'Removes a key from global configuration. ', [['lib','moodlelib.php',1499]], 89],
'upgrade_fix_missing_root_folders': ['upgrade_fix_missing_root_folders', 'Detect file areas with missing root directory records and add them. ', [['lib','upgradelib.php',2150]], 2],
'update_default_config_stores': ['update_default_config_stores', 'Updates the default stores within the MUC config file. ', [['cache','locallib.php',482]], 1],
'settings': ['settings', '', [['lib/xhprof/xhprof_html/jquery','jquery.tooltip.js',116]], 28],
'upgrade_main_savepoint': ['upgrade_main_savepoint', 'Upgrade savepoint, marks end of each upgrade block. It stores new main version, resets upgrade timeout and abort upgrade if user cancels page loading. ', [['lib','upgradelib.php',189]], 199],
'upgrade_mimetypes': ['upgrade_mimetypes', 'Updates the mime-types for files that exist in the database, based on their file extension. ', [['lib/db','upgradelib.php',514]], 2],
'delete_records_select': ['delete_records_select', 'Delete one or more records from a table which match a particular WHERE clause. ', [['lib/dml','pgsql_native_moodle_database.php',1247],['lib/dml','oci_native_moodle_database.php',1445],['lib/dml','sqlsrv_native_moodle_database.php',1153],['lib/dml','mssql_native_moodle_database.php',1082],['lib/dml','mysqli_native_moodle_database.php',1469],['lib/dml/tests','dml_test.php',5432],['lib/dml','pdo_moodle_database.php',207]], 166],
'instance': ['instance', 'Retrieve sole instance of the registry. ', [['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29],['lib/classes','useragent.php',101],['backup/cc','validator.php',35],['lib/portfolio','exporter.php',251],['lib/tests','update_deployer_test.php',69],['lib/tests','string_manager_standard_test.php',124],['lib','modinfolib.php',373],['','mdeploy.php',96],['cache','disabledlib.php',171],['cache','disabledlib.php',296],['admin/tool/installaddon/classes','validator.php',85],['cache/classes','config.php',87],['course/format','lib.php',156],['lib','accesslib.php',6184],['lib','accesslib.php',6436],['lib','accesslib.php',6614],['lib','accesslib.php',6868],['lib','accesslib.php',7129],['lib','accesslib.php',7341],['cache','locallib.php',52],['lib/htmlpurifier','HTMLPurifier.php',251],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['cache/classes','helper.php',76],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['lib/classes','plugin_manager.php',83],['lib','filterlib.php',81],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/classes/update','deployer.php',54],['admin/tool/installaddon/classes','pluginfo_client.php',37],['admin/tool/installaddon/classes','installer.php',40],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443]], 3942],
'drop_field': ['drop_field', 'This function will drop the field from the table passed as arguments ', [['lib/ddl','database_manager.php',536]], 54],
'get_records_sql': ['get_records_sql', 'Get a number of records as an array of objects using a SQL statement. ', [['lib/dml','pgsql_native_moodle_database.php',732],['lib/dml','oci_native_moodle_database.php',1102],['lib/dml','sqlsrv_native_moodle_database.php',823],['lib/dml','mssql_native_moodle_database.php',741],['lib/dml','mysqli_native_moodle_database.php',1049],['lib/dml/tests','dml_test.php',5424],['lib/dml','pdo_moodle_database.php',308]], 678],
'execute': ['execute', 'Exceptionally override the execute method, so, based in the activity_included setting, we are able to skip the execution of one task completely ', [['backup/moodle2','backup_activity_task.class.php',205],['backup/converter/moodle1','backuplib.php',10],['filter/tex','latex.php',60],['backup/util/plan','base_plan.class.php',158],['mod/lti/service/toolsettings/classes/local/resource','systemsettings.php',61],['mod/lti/service/toolsettings/classes/local/resource','linksettings.php',63],['mod/lti/service/profile/classes/local/resource','profile.php',76],['webservice','lib.php',1772],['lib/classes/task','context_cleanup_task.php',41],['lib/adodb','adodb.inc.php',967],['enrol/imsenterprise/classes/task','cron_task.php',43],['admin/tool/messageinbound/classes/task','cleanup_task.php',47],['lib/classes/task','calendar_cron_task.php',40],['mod/workshop/allocation/random','lib.php',83],['lib/classes/task','registration_cron_task.php',40],['lib/classes/task','portfolio_cron_task.php',40],['lib/htmlpurifier/HTMLPurifier/Strategy','Composite.php',21],['lib/google/src/Google/Http','Batch.php',56],['backup/converter/imscc11','lib.php',85],['lib/classes/task','file_temp_cleanup_task.php',40],['filter/tex','texdebug.php',287],['admin/tool/monitor/classes','notification_task.php',39],['lib/classes/task','stats_cron_task.php',40],['lib/classes/task','backup_cleanup_task.php',40],['admin/tool/log/store/legacy/classes/task','cleanup_task.php',40],['backup/util/ui','backup_ui.class.php',122],['lib/dml','pgsql_native_moodle_database.php',665],['lib/classes/task','messaging_cleanup_task.php',40],['lib/zend/Zend/Service/WindowsAzure/RetryPolicy','RetryN.php',68],['lib/classes/task','session_cleanup_task.php',40],['lib/classes/task','completion_cron_task.php',40],['lib/dml','oci_native_moodle_database.php',1009],['backup/util/plan','base_task.class.php',162],['lib/adodb/drivers','adodb-pdo.inc.php',464],['backup/util/plan','backup_plan.class.php',112],['backup/util/ui','restore_ui.class.php',206],['backup/converter/imscc11','backuplib.php',42],['backup/moodle2','restore_activity_task.class.php',183],['','mdeploy.php',743],['lib/dml','sqlsrv_native_moodle_database.php',745],['lib/htmlpurifier/HTMLPurifier/Strategy','MakeWellFormed.php',66],['lib/google/src/Google/Http','REST.php',28],['admin/tool/langimport/classes/task','update_langpacks_task.php',44],['mod/lti/service/toolproxy/classes/local/resource','toolproxy.php',62],['lib/classes/task','plagiarism_cron_task.php',40],['admin/tool/messageinbound/classes/task','pickup_task.php',47],['backup/util/plan','backup_structure_step.class.php',50],['mod/forum/classes/task','cron_task.php',39],['mod/workshop/allocation/scheduled','lib.php',128],['lib/classes/task','file_trash_cleanup_task.php',40],['backup/util/plan','restore_execution_step.class.php',25],['lib/tests/fixtures','task_fixtures.php',30],['lib/tests/fixtures','task_fixtures.php',39],['lib/tests/fixtures','task_fixtures.php',48],['lib/tests/fixtures','task_fixtures.php',57],['admin/tool/installaddon/classes','validator.php',114],['backup/util/plan','backup_execution_step.class.php',25],['lib/classes/task','password_reset_cleanup_task.php',40],['lib/classes/task','automated_backup_task.php',40],['backup/converter/moodle1','lib.php',142],['lib/htmlpurifier/HTMLPurifier/Strategy','ValidateAttributes.php',16],['lib/classes/task','create_contexts_task.php',40],['backup/util/plan','restore_plan.class.php',159],['backup/converter/imscc1','lib.php',84],['lib/dml','mssql_native_moodle_database.php',662],['admin/tool/log/store/standard/classes/task','cleanup_task.php',40],['lib/classes/task','cache_cleanup_task.php',40],['lib/classes/task','badges_cron_task.php',40],['lib/classes/task','cache_cron_task.php',40],['backup/util/interfaces','executable.class.php',32],['lib/htmlpurifier/HTMLPurifier/Strategy','FixNesting.php',41],['lib/adodb/drivers','adodb-oci8po.inc.php',52],['lib/classes/task','question_cron_task.php',40],['lib/zend/Zend/Service/WindowsAzure/RetryPolicy','NoRetry.php',37],['lib/dml','mysqli_native_moodle_database.php',955],['lib/htmlpurifier/HTMLPurifier/Strategy','RemoveForeignElements.php',20],['backup/util/plan/tests/fixtures','plan_fixtures.php',47],['backup/util/plan/tests/fixtures','plan_fixtures.php',55],['lib/classes/task','events_cron_task.php',40],['lib/classes/task','delete_unconfirmed_users_task.php',40],['lib/adodb/drivers','adodb-oci8.inc.php',786],['backup/converter/imscc1','backuplib.php',10],['lib/classes/task','tag_cron_task.php',40],['lib/classes/task','blog_cron_task.php',40],['lib/classes/task','send_failed_login_notifications_task.php',43],['lib/classes/task','grade_cron_task.php',40],['lib/dml/tests','dml_test.php',5422],['admin/tool/uploadcourse/classes','processor.php',174],['backup/moodle2','restore_section_task.class.php',87],['mod/lti/service/toolsettings/classes/local/resource','contextsettings.php',62],['lib/google/src/Google','Client.php',545],['backup/util/plan','restore_structure_step.class.php',62],['lib/classes/task','legacy_plugin_cron_task.php',42],['lib/dml','pdo_moodle_database.php',226],['lib/classes/task','check_for_updates_task.php',40],['backup/util/helper','restore_decode_processor.class.php',73],['backup/moodle2','backup_section_task.class.php',97],['webservice/amf/testclient','AMFTester.mxml',282],['lib/classes/task','delete_incomplete_users_task.php',40],['mod/assign','adminlib.php',342],['lib/classes/task','send_new_user_passwords_task.php',40],['admin/tool/monitor/classes/task','clean_events.php',41]], 733],
'upgrade_course_modules_sequences': ['upgrade_course_modules_sequences', 'This upgrade script fixes the mismatches between DB fields course_modules.section and course_sections.sequence. It makes sure that each module is included in the sequence of at least one section. Note that this script is different from admin/cli/fix_course_sortorder.php in the following ways: 1. It does not fix the cases when module appears several times in section(s) sequence(s) - it will be done automatically on the next viewing of the course. 2. It does not remove non-existing modules from section sequences - administrator has to run the CLI script to do it. 3. When this script finds an orphaned module it adds it to the section but makes hidden where CLI script does not change the visiblity specified in the course_modules table. ', [['lib/db','upgradelib.php',274]], 1],
'drop_index': ['drop_index', 'This function will drop the index in the table passed as arguments Before dropping the index, the function will check it exists ', [['lib/ddl','database_manager.php',817]], 20],
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pgsql_native_moodle_database.php',1137],['lib/dml','oci_native_moodle_database.php',1355],['lib/dml','sqlsrv_native_moodle_database.php',1081],['lib/dml','mssql_native_moodle_database.php',1003],['lib/dml','mysqli_native_moodle_database.php',1397],['lib/dml/tests','dml_test.php',5430],['lib/dml','pdo_moodle_database.php',460]], 565],
'sql_cast_char2int': ['sql_cast_char2int', '', [['lib/dml','pgsql_native_moodle_database.php',1307],['lib/dml','oci_native_moodle_database.php',1507],['lib/dml','sqlsrv_native_moodle_database.php',1176],['lib/dml','moodle_database.php',1949],['lib/dml','mssql_native_moodle_database.php',1111],['lib/dml','mysqli_native_moodle_database.php',1494]], 14],
'add_index': ['add_index', 'This function will create the index in the table passed as arguments Before creating the index, the function will check it doesn\'t exists ', [['lib/ddl','database_manager.php',790],['lib/xmldb','xmldb_table.php',802]], 109],
'close': ['close', 'Close the connection to the server ', [['lib/zend/Zend/Http/Client/Adapter','Socket.php',486],['lib/tests','completionlib_test.php',888],['lib/adodb','adodb.inc.php',2164],['lib/adodb','adodb.inc.php',2844],['lib/adodb','adodb.inc.php',3536],['lib','webdavlib.php',176],['admin/tool/uploaduser','locallib.php',149],['lib/dml','oci_native_moodle_recordset.php',80],['lib/tcpdf','tcpdf.php',2943],['lib/horde/framework/Horde/Imap/Client','Base.php',1846],['lib','excellib.class.php',93],['lib/zend/Zend/Http/Client/Adapter','Test.php',187],['lib/classes/dml','recordset_walk.php',153],['mod/assign/feedback/offline','importgradeslib.php',178],['lib/pear/Net','GeoIP.php',556],['backup/util/helper','backup_array_iterator.class.php',63],['lib/zend/Zend/Gdata/App','LoggingHttpClientAdapterSocket.php',109],['lib/zend/Zend/Http/Client/Adapter','Proxy.php',266],['lib/dml','mssql_native_moodle_recordset.php',87],['lib/pear/Auth','RADIUS.php',542],['lib/pear/Auth','RADIUS.php',703],['lib/pear/Auth','RADIUS.php',824],['lib/phpmailer','class.smtp.php',507],['lib/phpexcel/PHPExcel/Shared','ZipArchive.php',80],['lib/phpunit/classes','event_sink.php',39],['lib/zend/Zend/Http/Client/Adapter','Interface.php',73],['lib/dml','pgsql_native_moodle_recordset.php',104],['auth/fc','fcFPP.php',72],['lib/filestorage','zip_archive.php',183],['lib','odslib.class.php',71],['lib/horde/framework/Horde/Socket','Client.php',135],['question/engine/tests','helpers.php',1225],['grade','lib.php',323],['lib/dml','mysqli_native_moodle_recordset.php',86],['lib','csvlib.class.php',256],['lib/google/src/Google/Logger','File.php',130],['lib/horde/framework/Horde','Stream.php',585],['lib/phpunit/classes','phpmailer_sink.php',41],['lib/phpunit/classes','message_sink.php',39],['lib/zend/Zend/Http/Client/Adapter','Curl.php',460],['lib/dml','sqlsrv_native_moodle_recordset.php',133],['lib/zend/Zend/Service/WindowsAzure','SessionHandler.php',109],['backup/util/helper','backup_null_iterator.class.php',53],['grade/export','lib.php',662],['lib/dml','pdo_moodle_recordset.php',79]], 1036],
'sql_compare_text': ['sql_compare_text', 'Returns the SQL text to be used to compare one TEXT (clob) column with one varchar column, because some RDBMS doesn\'t support such direct comparisons. ', [['lib/dml','moodle_database.php',1991]], 83],
'get_in_or_equal': ['get_in_or_equal', 'Constructs \'IN()\' or \'=\' sql fragment ', [['lib/dml','oci_native_moodle_database.php',1583],['lib/dml','moodle_database.php',678]], 375],
'get_columns': ['get_columns', 'Returns detailed information about columns in table. This information is cached internally. ', [['lib/dml','pgsql_native_moodle_database.php',385],['lib/dml','oci_native_moodle_database.php',464],['lib/dml','sqlsrv_native_moodle_database.php',462],['lib/dml','sqlite3_pdo_moodle_database.php',195],['lib/dml','mssql_native_moodle_database.php',392],['lib','csvlib.class.php',190],['lib/dml','mysqli_native_moodle_database.php',572],['lib/dml/tests','dml_test.php',5417]], 108],
'create_table': ['create_table', 'This function will create the table passed as argument with all its fields/keys/indexes/sequences, everything based in the XMLDB object ', [['lib/ddl','database_manager.php',415]], 168],
'index_exists': ['index_exists', 'Given one xmldb_index, check if it exists in DB (true/false). ', [['lib/ddl','database_manager.php',207]], 64],
'delete_records': ['delete_records', 'Delete the records from a table where all the given conditions met. If conditions not specified, table is truncated. ', [['lib/dml','moodle_database.php',1815],['lib/dml','sqlite3_pdo_moodle_database.php',337]], 778],
'get_field': ['get_field', 'Get the right field name to fetch a stat for these attempts that is calculated for more than one $whichattempts (count or avg). ', [['mod/quiz/report/statistics/classes','calculated.php',109],['lib/dml','moodle_database.php',1497],['user/filters','lib.php',124],['lib/behat','behat_field_manager.php',243]], 485],
'update_site_identifier': ['update_site_identifier', 'Update the site identifier stored by the cache API. ', [['cache','locallib.php',629],['cache/classes','helper.php',597]], 4],
'explode': ['explode', '', [], 1599],
'count': ['count', '', [], 3984],
'in_array': ['in_array', '', [], 1173],
'time': ['time', '', [], 1768],
'floatval': ['floatval', '', [], 110],
'implode': ['implode', '', [], 1259],
'array_key_exists': ['array_key_exists', '', [], 1539],
'substr': ['substr', '', [], 2883],
'str_replace': ['str_replace', '', [], 1667],
'array_combine': ['array_combine', '', [], 134],
'is_null': ['is_null', '', [], 1992],
'sha1': ['sha1', '', [], 188],
'file_exists': ['file_exists', '', [], 873],
'array_keys': ['array_keys', '', [], 1152],
'array_merge': ['array_merge', '', [], 2320],
'strpos': ['strpos', '', [], 1623],
'defined': ['defined', '', [], 4098],
'preg_replace': ['preg_replace', '', [], 903],
'min': ['min', '', [], 754]};
CLASS_DATA={
'context_system': ['context_system', 'System context class ', [['lib','accesslib.php',6106]], 929],
'cache_helper': ['cache_helper', 'The cache helper class. ', [['cache/classes','helper.php',31]], 131],
'xmldb_table': ['xmldb_table', '', [['lib/xmldb','xmldb_table.php',29]], 397],
'xmldb_index': ['xmldb_index', '', [['lib/xmldb','xmldb_index.php',29]], 78],
'context_course': ['context_course', 'Course context class ', [['lib','accesslib.php',6766]], 1197],
'xmldb_key': ['xmldb_key', '', [['lib/xmldb','xmldb_key.php',29]], 33],
'cache_config_writer': ['cache_config_writer', 'Cache configuration writer. ', [['cache','locallib.php',32]], 23],
'progress_bar': ['progress_bar', 'Progress bar class. ', [['lib','weblib.php',2999]], 16],
'xmldb_field': ['xmldb_field', '', [['lib/xmldb','xmldb_field.php',29]], 306]};
CONST_DATA={
'DEBUG_DEVELOPER': ['DEBUG_DEVELOPER', '', [['lib','setuplib.php',40]], 554],
'XMLDB_KEY_UNIQUE': ['XMLDB_KEY_UNIQUE', '', [['lib/xmldb','xmldb_constants.php',66]], 34],
'XMLDB_KEY_PRIMARY': ['XMLDB_KEY_PRIMARY', '', [['lib/xmldb','xmldb_constants.php',64]], 198],
'CONTEXT_MODULE': ['CONTEXT_MODULE', '', [['lib','accesslib.php',150]], 462],
'IGNORE_MISSING': ['IGNORE_MISSING', '', [['lib','dmllib.php',48]], 204],
'XMLDB_INDEX_NOTUNIQUE': ['XMLDB_INDEX_NOTUNIQUE', '', [['lib/xmldb','xmldb_constants.php',84]], 99],
'BLOG_USER_LEVEL': ['BLOG_USER_LEVEL', '', [['lib','moodlelib.php',367]], 13],
'XMLDB_TYPE_NUMBER': ['XMLDB_TYPE_NUMBER', '', [['lib/xmldb','xmldb_constants.php',46]], 89],
'XMLDB_TYPE_INTEGER': ['XMLDB_TYPE_INTEGER', '', [['lib/xmldb','xmldb_constants.php',44]], 652],
'XMLDB_SEQUENCE': ['XMLDB_SEQUENCE', '', [['lib/xmldb','xmldb_constants.php',80]], 176],
'SQL_PARAMS_NAMED': ['SQL_PARAMS_NAMED', '', [['lib/dml','moodle_database.php',32]], 271],
'FRONTPAGEENROLLEDCOURSELIST': ['FRONTPAGEENROLLEDCOURSELIST', '', [['course','lib.php',48]], 6],
'XMLDB_NOTNULL': ['XMLDB_NOTNULL', '', [['lib/xmldb','xmldb_constants.php',78]], 683],
'FRONTPAGECATEGORYNAMES': ['FRONTPAGECATEGORYNAMES', '', [['course','lib.php',46]], 6],
'FRONTPAGECOURSESEARCH': ['FRONTPAGECOURSESEARCH', '', [['course','lib.php',50]], 10],
'XMLDB_INDEX_UNIQUE': ['XMLDB_INDEX_UNIQUE', '', [['lib/xmldb','xmldb_constants.php',82]], 33],
'XMLDB_KEY_FOREIGN': ['XMLDB_KEY_FOREIGN', '', [['lib/xmldb','xmldb_constants.php',68]], 100],
'FRONTPAGECATEGORYCOMBO': ['FRONTPAGECATEGORYCOMBO', '', [['course','lib.php',47]], 6],
'FRONTPAGENEWS': ['FRONTPAGENEWS', '', [['course','lib.php',45]], 6],
'XMLDB_TYPE_CHAR': ['XMLDB_TYPE_CHAR', '', [['lib/xmldb','xmldb_constants.php',50]], 231],
'CONTEXT_COURSE': ['CONTEXT_COURSE', '', [['lib','accesslib.php',148]], 422],
'CAP_PREVENT': ['CAP_PREVENT', '', [['lib','accesslib.php',137]], 40],
'XMLDB_TYPE_TEXT': ['XMLDB_TYPE_TEXT', '', [['lib/xmldb','xmldb_constants.php',52]], 121],
'DEBUG_ALL': ['DEBUG_ALL', '', [['lib','setuplib.php',38]], 17],
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',138],['','install.php',93],['lib','setup.php',386]], 3532],
'FRONTPAGEALLCOURSELIST': ['FRONTPAGEALLCOURSELIST', '', [['course','lib.php',49]], 6],
'CONTEXT_USER': ['CONTEXT_USER', '', [['lib','accesslib.php',144]], 95],
'COMPLETION_CRITERIA_TYPE_ACTIVITY': ['COMPLETION_CRITERIA_TYPE_ACTIVITY', '', [['completion/criteria','completion_criteria.php',53]], 24]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu May 28 19:17:31 2015</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
