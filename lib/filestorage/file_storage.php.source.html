<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /lib/filestorage/file_storage.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='lib/filestorage';
filename='file_storage.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/lib/filestorage/</a> -> <a href="file_storage.php.html">file_storage.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="file_storage.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="file_storage.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment">/**</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> * Core file storage class definition.</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> *</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @package   core_files</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @copyright 2008 Petr Skoda {@link http://skodak.org}</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> */</span>
<a name="l25"><span class="linenum">  25</span></a>  
<a name="l26"><span class="linenum">  26</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l27"><span class="linenum">  27</span></a>  
<a name="l28"><span class="linenum">  28</span></a>  require_once(&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>/filestorage/stored_file.php&quot;);
<a name="l29"><span class="linenum">  29</span></a>  
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment">/**</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> * File storage class used for low level access to stored files.</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> *</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment"> * Only owner of file area may use this class to access own files,</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment"> * for example only code in mod/assignment/* may access assignment</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment"> * attachments. When some other part of moodle needs to access</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment"> * files of modules it has to use file_browser class instead or there</span>
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment"> * has to be some callback API.</span>
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment"> *</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment"> * @package   core_files</span>
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment"> * @category  files</span>
<a name="l41"><span class="linenum">  41</span></a>  <span class="comment"> * @copyright 2008 Petr Skoda {@link http://skodak.org}</span>
<a name="l42"><span class="linenum">  42</span></a>  <span class="comment"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l43"><span class="linenum">  43</span></a>  <span class="comment"> * @since     Moodle 2.0</span>
<a name="l44"><span class="linenum">  44</span></a>  <span class="comment"> */</span>
<a name="l45"><span class="linenum">  45</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('file_storage')" href="../../_classes/file_storage.html" onMouseOver="classPopup(event,'file_storage')">file_storage</a> {
<a name="l46"><span class="linenum">  46</span></a>  <span class="comment">    /** @var string Directory with file contents */</span>
<a name="l47"><span class="linenum">  47</span></a>      private <a class="var it13984" onMouseOver="hilite(13984)" onMouseOut="lolite()" onClick="logVariable('filedir')" href="../../_variables/filedir.html">$filedir</a>;
<a name="l48"><span class="linenum">  48</span></a>  <span class="comment">    /** @var string Contents of deleted files not needed any more */</span>
<a name="l49"><span class="linenum">  49</span></a>      private <a class="var it13985" onMouseOver="hilite(13985)" onMouseOut="lolite()" onClick="logVariable('trashdir')" href="../../_variables/trashdir.html">$trashdir</a>;
<a name="l50"><span class="linenum">  50</span></a>  <span class="comment">    /** @var string tempdir */</span>
<a name="l51"><span class="linenum">  51</span></a>      private <a class="var it242" onMouseOver="hilite(242)" onMouseOut="lolite()" onClick="logVariable('tempdir')" href="../../_variables/tempdir.html">$tempdir</a>;
<a name="l52"><span class="linenum">  52</span></a>  <span class="comment">    /** @var int Permissions for new directories */</span>
<a name="l53"><span class="linenum">  53</span></a>      private <a class="var it19890" onMouseOver="hilite(19890)" onMouseOut="lolite()" onClick="logVariable('dirpermissions')" href="../../_variables/dirpermissions.html">$dirpermissions</a>;
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment">    /** @var int Permissions for new files */</span>
<a name="l55"><span class="linenum">  55</span></a>      private <a class="var it2723" onMouseOver="hilite(2723)" onMouseOut="lolite()" onClick="logVariable('filepermissions')" href="../../_variables/filepermissions.html">$filepermissions</a>;
<a name="l56"><span class="linenum">  56</span></a>  <span class="comment">    /** @var array List of formats supported by unoconv */</span>
<a name="l57"><span class="linenum">  57</span></a>      private <a class="var it27094" onMouseOver="hilite(27094)" onMouseOut="lolite()" onClick="logVariable('unoconvformats')" href="../../_variables/unoconvformats.html">$unoconvformats</a>;
<a name="l58"><span class="linenum">  58</span></a>  
<a name="l59"><span class="linenum">  59</span></a>  <span class="comment">    // Unoconv constants.</span>
<a name="l60"><span class="linenum">  60</span></a>  <span class="comment">    /** No errors */</span>
<a name="l61"><span class="linenum">  61</span></a>      const UNOCONVPATH_OK = 'ok';
<a name="l62"><span class="linenum">  62</span></a>  <span class="comment">    /** Not set */</span>
<a name="l63"><span class="linenum">  63</span></a>      const UNOCONVPATH_EMPTY = 'empty';
<a name="l64"><span class="linenum">  64</span></a>  <span class="comment">    /** Does not exist */</span>
<a name="l65"><span class="linenum">  65</span></a>      const UNOCONVPATH_DOESNOTEXIST = 'doesnotexist';
<a name="l66"><span class="linenum">  66</span></a>  <span class="comment">    /** Is a dir */</span>
<a name="l67"><span class="linenum">  67</span></a>      const UNOCONVPATH_ISDIR = 'isdir';
<a name="l68"><span class="linenum">  68</span></a>  <span class="comment">    /** Not executable */</span>
<a name="l69"><span class="linenum">  69</span></a>      const UNOCONVPATH_NOTEXECUTABLE = 'notexecutable';
<a name="l70"><span class="linenum">  70</span></a>  <span class="comment">    /** Test file missing */</span>
<a name="l71"><span class="linenum">  71</span></a>      const UNOCONVPATH_NOTESTFILE = 'notestfile';
<a name="l72"><span class="linenum">  72</span></a>  <span class="comment">    /** Version not supported */</span>
<a name="l73"><span class="linenum">  73</span></a>      const UNOCONVPATH_VERSIONNOTSUPPORTED = 'versionnotsupported';
<a name="l74"><span class="linenum">  74</span></a>  <span class="comment">    /** Any other error */</span>
<a name="l75"><span class="linenum">  75</span></a>      const UNOCONVPATH_ERROR = 'error';
<a name="l76"><span class="linenum">  76</span></a>  
<a name="l77"><span class="linenum">  77</span></a>  
<a name="l78"><span class="linenum">  78</span></a>      <span class="comment">/**</span>
<a name="l79"><span class="linenum">  79</span></a>  <span class="comment">     * Constructor - do not use directly use {@link get_file_storage()} call instead.</span>
<a name="l80"><span class="linenum">  80</span></a>  <span class="comment">     *</span>
<a name="l81"><span class="linenum">  81</span></a>  <span class="comment">     * @param string $filedir full path to pool directory</span>
<a name="l82"><span class="linenum">  82</span></a>  <span class="comment">     * @param string $trashdir temporary storage of deleted area</span>
<a name="l83"><span class="linenum">  83</span></a>  <span class="comment">     * @param string $tempdir temporary storage of various files</span>
<a name="l84"><span class="linenum">  84</span></a>  <span class="comment">     * @param int $dirpermissions new directory permissions</span>
<a name="l85"><span class="linenum">  85</span></a>  <span class="comment">     * @param int $filepermissions new file permissions</span>
<a name="l86"><span class="linenum">  86</span></a>  <span class="comment">     */</span>
<a name="l87"><span class="linenum">  87</span></a>      public function <a class="function" onClick="logFunction('__construct')" href="../../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>(<a class="var it13984" onMouseOver="hilite(13984)" onMouseOut="lolite()" onClick="logVariable('filedir')" href="../../_variables/filedir.html">$filedir</a>, <a class="var it13985" onMouseOver="hilite(13985)" onMouseOut="lolite()" onClick="logVariable('trashdir')" href="../../_variables/trashdir.html">$trashdir</a>, <a class="var it242" onMouseOver="hilite(242)" onMouseOut="lolite()" onClick="logVariable('tempdir')" href="../../_variables/tempdir.html">$tempdir</a>, <a class="var it19890" onMouseOver="hilite(19890)" onMouseOut="lolite()" onClick="logVariable('dirpermissions')" href="../../_variables/dirpermissions.html">$dirpermissions</a>, <a class="var it2723" onMouseOver="hilite(2723)" onMouseOut="lolite()" onClick="logVariable('filepermissions')" href="../../_variables/filepermissions.html">$filepermissions</a>) {
<a name="l88"><span class="linenum">  88</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l89"><span class="linenum">  89</span></a>  
<a name="l90"><span class="linenum">  90</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('filedir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/filedir.html">filedir</a>         = <a class="var it13984" onMouseOver="hilite(13984)" onMouseOut="lolite()" onClick="logVariable('filedir')" href="../../_variables/filedir.html">$filedir</a>;
<a name="l91"><span class="linenum">  91</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('trashdir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/trashdir.html">trashdir</a>        = <a class="var it13985" onMouseOver="hilite(13985)" onMouseOut="lolite()" onClick="logVariable('trashdir')" href="../../_variables/trashdir.html">$trashdir</a>;
<a name="l92"><span class="linenum">  92</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('tempdir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/tempdir.html">tempdir</a>         = <a class="var it242" onMouseOver="hilite(242)" onMouseOut="lolite()" onClick="logVariable('tempdir')" href="../../_variables/tempdir.html">$tempdir</a>;
<a name="l93"><span class="linenum">  93</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dirpermissions')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/dirpermissions.html">dirpermissions</a>  = <a class="var it19890" onMouseOver="hilite(19890)" onMouseOut="lolite()" onClick="logVariable('dirpermissions')" href="../../_variables/dirpermissions.html">$dirpermissions</a>;
<a name="l94"><span class="linenum">  94</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('filepermissions')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/filepermissions.html">filepermissions</a> = <a class="var it2723" onMouseOver="hilite(2723)" onMouseOut="lolite()" onClick="logVariable('filepermissions')" href="../../_variables/filepermissions.html">$filepermissions</a>;
<a name="l95"><span class="linenum">  95</span></a>  
<a name="l96"><span class="linenum">  96</span></a>  <span class="comment">        // make sure the file pool directory exists</span>
<a name="l97"><span class="linenum">  97</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_dir')" href="../../_functions/is_dir.html" onMouseOver="phpfuncPopup(event,'is_dir')">is_dir</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('filedir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/filedir.html">filedir</a>)) {
<a name="l98"><span class="linenum">  98</span></a>              if (!<a class="phpfunction" onClick="logFunction('mkdir')" href="../../_functions/mkdir.html" onMouseOver="phpfuncPopup(event,'mkdir')">mkdir</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('filedir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/filedir.html">filedir</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dirpermissions')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/dirpermissions.html">dirpermissions</a>, true)) {
<a name="l99"><span class="linenum">  99</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfilecannotcreatefiledirs'); <span class="comment">// permission trouble</span>
<a name="l100"><span class="linenum"> 100</span></a>              }
<a name="l101"><span class="linenum"> 101</span></a>  <span class="comment">            // place warning file in file pool root</span>
<a name="l102"><span class="linenum"> 102</span></a>              if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('filedir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/filedir.html">filedir</a>.'/warning.txt')) {
<a name="l103"><span class="linenum"> 103</span></a>                  <a class="phpfunction" onClick="logFunction('file_put_contents')" href="../../_functions/file_put_contents.html" onMouseOver="phpfuncPopup(event,'file_put_contents')">file_put_contents</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('filedir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/filedir.html">filedir</a>.'/warning.txt',
<a name="l104"><span class="linenum"> 104</span></a>                                    'This directory contains the content of uploaded files and is controlled by Moodle code. Do not manually move, change or rename any of the files and subdirectories here.');
<a name="l105"><span class="linenum"> 105</span></a>                  <a class="phpfunction" onClick="logFunction('chmod')" href="../../_functions/chmod.html" onMouseOver="phpfuncPopup(event,'chmod')">chmod</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('filedir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/filedir.html">filedir</a>.'/warning.txt', <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('filepermissions')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/filepermissions.html">filepermissions</a>);
<a name="l106"><span class="linenum"> 106</span></a>              }
<a name="l107"><span class="linenum"> 107</span></a>          }
<a name="l108"><span class="linenum"> 108</span></a>  <span class="comment">        // make sure the file pool directory exists</span>
<a name="l109"><span class="linenum"> 109</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_dir')" href="../../_functions/is_dir.html" onMouseOver="phpfuncPopup(event,'is_dir')">is_dir</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('trashdir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/trashdir.html">trashdir</a>)) {
<a name="l110"><span class="linenum"> 110</span></a>              if (!<a class="phpfunction" onClick="logFunction('mkdir')" href="../../_functions/mkdir.html" onMouseOver="phpfuncPopup(event,'mkdir')">mkdir</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('trashdir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/trashdir.html">trashdir</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dirpermissions')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/dirpermissions.html">dirpermissions</a>, true)) {
<a name="l111"><span class="linenum"> 111</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfilecannotcreatefiledirs'); <span class="comment">// permission trouble</span>
<a name="l112"><span class="linenum"> 112</span></a>              }
<a name="l113"><span class="linenum"> 113</span></a>          }
<a name="l114"><span class="linenum"> 114</span></a>      }
<a name="l115"><span class="linenum"> 115</span></a>  
<a name="l116"><span class="linenum"> 116</span></a>      <span class="comment">/**</span>
<a name="l117"><span class="linenum"> 117</span></a>  <span class="comment">     * Calculates sha1 hash of unique full path name information.</span>
<a name="l118"><span class="linenum"> 118</span></a>  <span class="comment">     *</span>
<a name="l119"><span class="linenum"> 119</span></a>  <span class="comment">     * This hash is a unique file identifier - it is used to improve</span>
<a name="l120"><span class="linenum"> 120</span></a>  <span class="comment">     * performance and overcome db index size limits.</span>
<a name="l121"><span class="linenum"> 121</span></a>  <span class="comment">     *</span>
<a name="l122"><span class="linenum"> 122</span></a>  <span class="comment">     * @param int $contextid context ID</span>
<a name="l123"><span class="linenum"> 123</span></a>  <span class="comment">     * @param string $component component</span>
<a name="l124"><span class="linenum"> 124</span></a>  <span class="comment">     * @param string $filearea file area</span>
<a name="l125"><span class="linenum"> 125</span></a>  <span class="comment">     * @param int $itemid item ID</span>
<a name="l126"><span class="linenum"> 126</span></a>  <span class="comment">     * @param string $filepath file path</span>
<a name="l127"><span class="linenum"> 127</span></a>  <span class="comment">     * @param string $filename file name</span>
<a name="l128"><span class="linenum"> 128</span></a>  <span class="comment">     * @return string sha1 hash</span>
<a name="l129"><span class="linenum"> 129</span></a>  <span class="comment">     */</span>
<a name="l130"><span class="linenum"> 130</span></a>      public static function <a class="function" onClick="logFunction('get_pathname_hash')" href="../../_functions/get_pathname_hash.html" onMouseOver="funcPopup(event,'get_pathname_hash')">get_pathname_hash</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>) {
<a name="l131"><span class="linenum"> 131</span></a>          return <a class="phpfunction" onClick="logFunction('sha1')" href="../../_functions/sha1.html" onMouseOver="phpfuncPopup(event,'sha1')">sha1</a>(&quot;/<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>/<a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>/<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>/<a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>&quot;.<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>.<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>);
<a name="l132"><span class="linenum"> 132</span></a>      }
<a name="l133"><span class="linenum"> 133</span></a>  
<a name="l134"><span class="linenum"> 134</span></a>      <span class="comment">/**</span>
<a name="l135"><span class="linenum"> 135</span></a>  <span class="comment">     * Does this file exist?</span>
<a name="l136"><span class="linenum"> 136</span></a>  <span class="comment">     *</span>
<a name="l137"><span class="linenum"> 137</span></a>  <span class="comment">     * @param int $contextid context ID</span>
<a name="l138"><span class="linenum"> 138</span></a>  <span class="comment">     * @param string $component component</span>
<a name="l139"><span class="linenum"> 139</span></a>  <span class="comment">     * @param string $filearea file area</span>
<a name="l140"><span class="linenum"> 140</span></a>  <span class="comment">     * @param int $itemid item ID</span>
<a name="l141"><span class="linenum"> 141</span></a>  <span class="comment">     * @param string $filepath file path</span>
<a name="l142"><span class="linenum"> 142</span></a>  <span class="comment">     * @param string $filename file name</span>
<a name="l143"><span class="linenum"> 143</span></a>  <span class="comment">     * @return bool</span>
<a name="l144"><span class="linenum"> 144</span></a>  <span class="comment">     */</span>
<a name="l145"><span class="linenum"> 145</span></a>      public function <a class="function" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="funcPopup(event,'file_exists')">file_exists</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>) {
<a name="l146"><span class="linenum"> 146</span></a>          <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="constant" onClick="logConstant('PARAM_PATH')" href="../../_constants/PARAM_PATH.html" onMouseOver="constPopup(event,'PARAM_PATH')">PARAM_PATH</a>);
<a name="l147"><span class="linenum"> 147</span></a>          <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>, <a class="constant" onClick="logConstant('PARAM_FILE')" href="../../_constants/PARAM_FILE.html" onMouseOver="constPopup(event,'PARAM_FILE')">PARAM_FILE</a>);
<a name="l148"><span class="linenum"> 148</span></a>  
<a name="l149"><span class="linenum"> 149</span></a>          if (<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a> === '') {
<a name="l150"><span class="linenum"> 150</span></a>              <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a> = '.';
<a name="l151"><span class="linenum"> 151</span></a>          }
<a name="l152"><span class="linenum"> 152</span></a>  
<a name="l153"><span class="linenum"> 153</span></a>          <a class="var it14667" onMouseOver="hilite(14667)" onMouseOut="lolite()" onClick="logVariable('pathnamehash')" href="../../_variables/pathnamehash.html">$pathnamehash</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_pathname_hash')" href="../../_functions/get_pathname_hash.html" onMouseOver="funcPopup(event,'get_pathname_hash')">get_pathname_hash</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>);
<a name="l154"><span class="linenum"> 154</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('file_exists_by_hash')" href="../../_functions/file_exists_by_hash.html" onMouseOver="funcPopup(event,'file_exists_by_hash')">file_exists_by_hash</a>(<a class="var it14667" onMouseOver="hilite(14667)" onMouseOut="lolite()" onClick="logVariable('pathnamehash')" href="../../_variables/pathnamehash.html">$pathnamehash</a>);
<a name="l155"><span class="linenum"> 155</span></a>      }
<a name="l156"><span class="linenum"> 156</span></a>  
<a name="l157"><span class="linenum"> 157</span></a>      <span class="comment">/**</span>
<a name="l158"><span class="linenum"> 158</span></a>  <span class="comment">     * Whether or not the file exist</span>
<a name="l159"><span class="linenum"> 159</span></a>  <span class="comment">     *</span>
<a name="l160"><span class="linenum"> 160</span></a>  <span class="comment">     * @param string $pathnamehash path name hash</span>
<a name="l161"><span class="linenum"> 161</span></a>  <span class="comment">     * @return bool</span>
<a name="l162"><span class="linenum"> 162</span></a>  <span class="comment">     */</span>
<a name="l163"><span class="linenum"> 163</span></a>      public function <a class="function" onClick="logFunction('file_exists_by_hash')" href="../../_functions/file_exists_by_hash.html" onMouseOver="funcPopup(event,'file_exists_by_hash')">file_exists_by_hash</a>(<a class="var it14667" onMouseOver="hilite(14667)" onMouseOut="lolite()" onClick="logVariable('pathnamehash')" href="../../_variables/pathnamehash.html">$pathnamehash</a>) {
<a name="l164"><span class="linenum"> 164</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l165"><span class="linenum"> 165</span></a>  
<a name="l166"><span class="linenum"> 166</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('files', array('pathnamehash'=&gt;<a class="var it14667" onMouseOver="hilite(14667)" onMouseOut="lolite()" onClick="logVariable('pathnamehash')" href="../../_variables/pathnamehash.html">$pathnamehash</a>));
<a name="l167"><span class="linenum"> 167</span></a>      }
<a name="l168"><span class="linenum"> 168</span></a>  
<a name="l169"><span class="linenum"> 169</span></a>      <span class="comment">/**</span>
<a name="l170"><span class="linenum"> 170</span></a>  <span class="comment">     * Create instance of file class from database record.</span>
<a name="l171"><span class="linenum"> 171</span></a>  <span class="comment">     *</span>
<a name="l172"><span class="linenum"> 172</span></a>  <span class="comment">     * @param stdClass $filerecord record from the files table left join files_reference table</span>
<a name="l173"><span class="linenum"> 173</span></a>  <span class="comment">     * @return stored_file instance of file abstraction class</span>
<a name="l174"><span class="linenum"> 174</span></a>  <span class="comment">     */</span>
<a name="l175"><span class="linenum"> 175</span></a>      public function <a class="function" onClick="logFunction('get_file_instance')" href="../../_functions/get_file_instance.html" onMouseOver="funcPopup(event,'get_file_instance')">get_file_instance</a>(stdClass <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>) {
<a name="l176"><span class="linenum"> 176</span></a>          <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a> = <span class="keyword">new </span><a class="class" onClick="logClass('stored_file')" href="../../_classes/stored_file.html" onMouseOver="classPopup(event,'stored_file')">stored_file</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>, <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('filedir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/filedir.html">filedir</a>);
<a name="l177"><span class="linenum"> 177</span></a>          return <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>;
<a name="l178"><span class="linenum"> 178</span></a>      }
<a name="l179"><span class="linenum"> 179</span></a>  
<a name="l180"><span class="linenum"> 180</span></a>      <span class="comment">/**</span>
<a name="l181"><span class="linenum"> 181</span></a>  <span class="comment">     * Get converted document.</span>
<a name="l182"><span class="linenum"> 182</span></a>  <span class="comment">     *</span>
<a name="l183"><span class="linenum"> 183</span></a>  <span class="comment">     * Get an alternate version of the specified document, if it is possible to convert.</span>
<a name="l184"><span class="linenum"> 184</span></a>  <span class="comment">     *</span>
<a name="l185"><span class="linenum"> 185</span></a>  <span class="comment">     * @param stored_file $file the file we want to preview</span>
<a name="l186"><span class="linenum"> 186</span></a>  <span class="comment">     * @param string $format The desired format - e.g. 'pdf'. Formats are specified by file extension.</span>
<a name="l187"><span class="linenum"> 187</span></a>  <span class="comment">     * @return stored_file|bool false if unable to create the conversion, stored file otherwise</span>
<a name="l188"><span class="linenum"> 188</span></a>  <span class="comment">     */</span>
<a name="l189"><span class="linenum"> 189</span></a>      public function <a class="function" onClick="logFunction('get_converted_document')" href="../../_functions/get_converted_document.html" onMouseOver="funcPopup(event,'get_converted_document')">get_converted_document</a>(stored_file <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>, <a class="var it606" onMouseOver="hilite(606)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../_variables/format.html">$format</a>) {
<a name="l190"><span class="linenum"> 190</span></a>  
<a name="l191"><span class="linenum"> 191</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l192"><span class="linenum"> 192</span></a>          <a class="var it240" onMouseOver="hilite(240)" onMouseOut="lolite()" onClick="logVariable('path')" href="../../_variables/path.html">$path</a> = '/' . <a class="var it606" onMouseOver="hilite(606)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../_variables/format.html">$format</a> . '/';
<a name="l193"><span class="linenum"> 193</span></a>          <a class="var it25078" onMouseOver="hilite(25078)" onMouseOut="lolite()" onClick="logVariable('conversion')" href="../../_variables/conversion.html">$conversion</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file')" href="../../_functions/get_file.html" onMouseOver="funcPopup(event,'get_file')">get_file</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'core', 'documentconversion', 0, <a class="var it240" onMouseOver="hilite(240)" onMouseOut="lolite()" onClick="logVariable('path')" href="../../_variables/path.html">$path</a>, <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_contenthash')" href="../../_functions/get_contenthash.html" onMouseOver="funcPopup(event,'get_contenthash')">get_contenthash</a>());
<a name="l194"><span class="linenum"> 194</span></a>  
<a name="l195"><span class="linenum"> 195</span></a>          if (!<a class="var it25078" onMouseOver="hilite(25078)" onMouseOut="lolite()" onClick="logVariable('conversion')" href="../../_variables/conversion.html">$conversion</a>) {
<a name="l196"><span class="linenum"> 196</span></a>              <a class="var it25078" onMouseOver="hilite(25078)" onMouseOut="lolite()" onClick="logVariable('conversion')" href="../../_variables/conversion.html">$conversion</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('create_converted_document')" href="../../_functions/create_converted_document.html" onMouseOver="funcPopup(event,'create_converted_document')">create_converted_document</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>, <a class="var it606" onMouseOver="hilite(606)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../_variables/format.html">$format</a>);
<a name="l197"><span class="linenum"> 197</span></a>              if (!<a class="var it25078" onMouseOver="hilite(25078)" onMouseOut="lolite()" onClick="logVariable('conversion')" href="../../_variables/conversion.html">$conversion</a>) {
<a name="l198"><span class="linenum"> 198</span></a>                  return false;
<a name="l199"><span class="linenum"> 199</span></a>              }
<a name="l200"><span class="linenum"> 200</span></a>          }
<a name="l201"><span class="linenum"> 201</span></a>  
<a name="l202"><span class="linenum"> 202</span></a>          return <a class="var it25078" onMouseOver="hilite(25078)" onMouseOut="lolite()" onClick="logVariable('conversion')" href="../../_variables/conversion.html">$conversion</a>;
<a name="l203"><span class="linenum"> 203</span></a>      }
<a name="l204"><span class="linenum"> 204</span></a>  
<a name="l205"><span class="linenum"> 205</span></a>      <span class="comment">/**</span>
<a name="l206"><span class="linenum"> 206</span></a>  <span class="comment">     * Verify the format is supported.</span>
<a name="l207"><span class="linenum"> 207</span></a>  <span class="comment">     *</span>
<a name="l208"><span class="linenum"> 208</span></a>  <span class="comment">     * @param string $format The desired format - e.g. 'pdf'. Formats are specified by file extension.</span>
<a name="l209"><span class="linenum"> 209</span></a>  <span class="comment">     * @return bool - True if the format is supported for input.</span>
<a name="l210"><span class="linenum"> 210</span></a>  <span class="comment">     */</span>
<a name="l211"><span class="linenum"> 211</span></a>      protected function <a class="function" onClick="logFunction('is_format_supported_by_unoconv')" href="../../_functions/is_format_supported_by_unoconv.html" onMouseOver="funcPopup(event,'is_format_supported_by_unoconv')">is_format_supported_by_unoconv</a>(<a class="var it606" onMouseOver="hilite(606)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../_variables/format.html">$format</a>) {
<a name="l212"><span class="linenum"> 212</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l213"><span class="linenum"> 213</span></a>  
<a name="l214"><span class="linenum"> 214</span></a>          if (!isset(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('unoconvformats')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/unoconvformats.html">unoconvformats</a>)) {
<a name="l215"><span class="linenum"> 215</span></a>  <span class="comment">            // Ask unoconv for it's list of supported document formats.</span>
<a name="l216"><span class="linenum"> 216</span></a>              <a class="var it4480" onMouseOver="hilite(4480)" onMouseOut="lolite()" onClick="logVariable('cmd')" href="../../_variables/cmd.html">$cmd</a> = <a class="phpfunction" onClick="logFunction('escapeshellcmd')" href="../../_functions/escapeshellcmd.html" onMouseOver="phpfuncPopup(event,'escapeshellcmd')">escapeshellcmd</a>(<a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('pathtounoconv')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/pathtounoconv.html">pathtounoconv</a>)) . ' --show';
<a name="l217"><span class="linenum"> 217</span></a>              <a class="var it27095" onMouseOver="hilite(27095)" onMouseOut="lolite()" onClick="logVariable('pipes')" href="../../_variables/pipes.html">$pipes</a> = array();
<a name="l218"><span class="linenum"> 218</span></a>              <a class="var it27096" onMouseOver="hilite(27096)" onMouseOut="lolite()" onClick="logVariable('pipesspec')" href="../../_variables/pipesspec.html">$pipesspec</a> = array(2 =&gt; array('pipe', 'w'));
<a name="l219"><span class="linenum"> 219</span></a>              <a class="var it27097" onMouseOver="hilite(27097)" onMouseOut="lolite()" onClick="logVariable('proc')" href="../../_variables/proc.html">$proc</a> = <a class="phpfunction" onClick="logFunction('proc_open')" href="../../_functions/proc_open.html" onMouseOver="phpfuncPopup(event,'proc_open')">proc_open</a>(<a class="var it4480" onMouseOver="hilite(4480)" onMouseOut="lolite()" onClick="logVariable('cmd')" href="../../_variables/cmd.html">$cmd</a>, <a class="var it27096" onMouseOver="hilite(27096)" onMouseOut="lolite()" onClick="logVariable('pipesspec')" href="../../_variables/pipesspec.html">$pipesspec</a>, <a class="var it27095" onMouseOver="hilite(27095)" onMouseOut="lolite()" onClick="logVariable('pipes')" href="../../_variables/pipes.html">$pipes</a>);
<a name="l220"><span class="linenum"> 220</span></a>              <a class="var it27098" onMouseOver="hilite(27098)" onMouseOut="lolite()" onClick="logVariable('programoutput')" href="../../_variables/programoutput.html">$programoutput</a> = <a class="phpfunction" onClick="logFunction('stream_get_contents')" href="../../_functions/stream_get_contents.html" onMouseOver="phpfuncPopup(event,'stream_get_contents')">stream_get_contents</a>(<a class="var it27095" onMouseOver="hilite(27095)" onMouseOut="lolite()" onClick="logVariable('pipes')" href="../../_variables/pipes.html">$pipes</a>[2]);
<a name="l221"><span class="linenum"> 221</span></a>              <a class="phpfunction" onClick="logFunction('fclose')" href="../../_functions/fclose.html" onMouseOver="phpfuncPopup(event,'fclose')">fclose</a>(<a class="var it27095" onMouseOver="hilite(27095)" onMouseOut="lolite()" onClick="logVariable('pipes')" href="../../_variables/pipes.html">$pipes</a>[2]);
<a name="l222"><span class="linenum"> 222</span></a>              <a class="phpfunction" onClick="logFunction('proc_close')" href="../../_functions/proc_close.html" onMouseOver="phpfuncPopup(event,'proc_close')">proc_close</a>(<a class="var it27097" onMouseOver="hilite(27097)" onMouseOut="lolite()" onClick="logVariable('proc')" href="../../_variables/proc.html">$proc</a>);
<a name="l223"><span class="linenum"> 223</span></a>              <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = array();
<a name="l224"><span class="linenum"> 224</span></a>              <a class="phpfunction" onClick="logFunction('preg_match_all')" href="../../_functions/preg_match_all.html" onMouseOver="phpfuncPopup(event,'preg_match_all')">preg_match_all</a>('/\[\.(.*)\]/', <a class="var it27098" onMouseOver="hilite(27098)" onMouseOut="lolite()" onClick="logVariable('programoutput')" href="../../_variables/programoutput.html">$programoutput</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>);
<a name="l225"><span class="linenum"> 225</span></a>  
<a name="l226"><span class="linenum"> 226</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('unoconvformats')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/unoconvformats.html">unoconvformats</a> = <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1];
<a name="l227"><span class="linenum"> 227</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('unoconvformats')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/unoconvformats.html">unoconvformats</a> = <a class="phpfunction" onClick="logFunction('array_unique')" href="../../_functions/array_unique.html" onMouseOver="phpfuncPopup(event,'array_unique')">array_unique</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('unoconvformats')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/unoconvformats.html">unoconvformats</a>);
<a name="l228"><span class="linenum"> 228</span></a>          }
<a name="l229"><span class="linenum"> 229</span></a>  
<a name="l230"><span class="linenum"> 230</span></a>          <a class="var it27099" onMouseOver="hilite(27099)" onMouseOut="lolite()" onClick="logVariable('sanitized')" href="../../_variables/sanitized.html">$sanitized</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it606" onMouseOver="hilite(606)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../_variables/format.html">$format</a>));
<a name="l231"><span class="linenum"> 231</span></a>          return <a class="phpfunction" onClick="logFunction('in_array')" href="../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it27099" onMouseOver="hilite(27099)" onMouseOut="lolite()" onClick="logVariable('sanitized')" href="../../_variables/sanitized.html">$sanitized</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('unoconvformats')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/unoconvformats.html">unoconvformats</a>);
<a name="l232"><span class="linenum"> 232</span></a>      }
<a name="l233"><span class="linenum"> 233</span></a>  
<a name="l234"><span class="linenum"> 234</span></a>      <span class="comment">/**</span>
<a name="l235"><span class="linenum"> 235</span></a>  <span class="comment">     * Check if the installed version of unoconv is supported.</span>
<a name="l236"><span class="linenum"> 236</span></a>  <span class="comment">     *</span>
<a name="l237"><span class="linenum"> 237</span></a>  <span class="comment">     * @return bool true if the present version is supported, false otherwise.</span>
<a name="l238"><span class="linenum"> 238</span></a>  <span class="comment">     */</span>
<a name="l239"><span class="linenum"> 239</span></a>      public static function <a class="function" onClick="logFunction('can_convert_documents')" href="../../_functions/can_convert_documents.html" onMouseOver="funcPopup(event,'can_convert_documents')">can_convert_documents</a>() {
<a name="l240"><span class="linenum"> 240</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l241"><span class="linenum"> 241</span></a>          <a class="var it6067" onMouseOver="hilite(6067)" onMouseOut="lolite()" onClick="logVariable('currentversion')" href="../../_variables/currentversion.html">$currentversion</a> = 0;
<a name="l242"><span class="linenum"> 242</span></a>          <a class="var it25523" onMouseOver="hilite(25523)" onMouseOut="lolite()" onClick="logVariable('supportedversion')" href="../../_variables/supportedversion.html">$supportedversion</a> = 0.7;
<a name="l243"><span class="linenum"> 243</span></a>          <a class="var it25524" onMouseOver="hilite(25524)" onMouseOut="lolite()" onClick="logVariable('unoconvbin')" href="../../_variables/unoconvbin.html">$unoconvbin</a> = \<a class="phpfunction" onClick="logFunction('escapeshellarg')" href="../../_functions/escapeshellarg.html" onMouseOver="phpfuncPopup(event,'escapeshellarg')">escapeshellarg</a>(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('pathtounoconv')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/pathtounoconv.html">pathtounoconv</a>);
<a name="l244"><span class="linenum"> 244</span></a>          <a class="var it2979" onMouseOver="hilite(2979)" onMouseOut="lolite()" onClick="logVariable('command')" href="../../_variables/command.html">$command</a> = &quot;<a class="var it25524" onMouseOver="hilite(25524)" onMouseOut="lolite()" onClick="logVariable('unoconvbin')" href="../../_variables/unoconvbin.html">$unoconvbin</a> --version&quot;;
<a name="l245"><span class="linenum"> 245</span></a>          <a class="phpfunction" onClick="logFunction('exec')" href="../../_functions/exec.html" onMouseOver="phpfuncPopup(event,'exec')">exec</a>(<a class="var it2979" onMouseOver="hilite(2979)" onMouseOut="lolite()" onClick="logVariable('command')" href="../../_variables/command.html">$command</a>, <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>);
<a name="l246"><span class="linenum"> 246</span></a>  <span class="comment">        // If the command execution returned some output, then get the unoconv version.</span>
<a name="l247"><span class="linenum"> 247</span></a>          if (<a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>) {
<a name="l248"><span class="linenum"> 248</span></a>              foreach (<a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> as <a class="var it187" onMouseOver="hilite(187)" onMouseOut="lolite()" onClick="logVariable('response')" href="../../_variables/response.html">$response</a>) {
<a name="l249"><span class="linenum"> 249</span></a>                  if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('/unoconv (\\d+\\.\\d+)/', <a class="var it187" onMouseOver="hilite(187)" onMouseOut="lolite()" onClick="logVariable('response')" href="../../_variables/response.html">$response</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l250"><span class="linenum"> 250</span></a>                      <a class="var it6067" onMouseOver="hilite(6067)" onMouseOut="lolite()" onClick="logVariable('currentversion')" href="../../_variables/currentversion.html">$currentversion</a> = (float)<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1];
<a name="l251"><span class="linenum"> 251</span></a>                  }
<a name="l252"><span class="linenum"> 252</span></a>              }
<a name="l253"><span class="linenum"> 253</span></a>              if (<a class="var it6067" onMouseOver="hilite(6067)" onMouseOut="lolite()" onClick="logVariable('currentversion')" href="../../_variables/currentversion.html">$currentversion</a> &lt; <a class="var it25523" onMouseOver="hilite(25523)" onMouseOut="lolite()" onClick="logVariable('supportedversion')" href="../../_variables/supportedversion.html">$supportedversion</a>) {
<a name="l254"><span class="linenum"> 254</span></a>                  return false;
<a name="l255"><span class="linenum"> 255</span></a>              }
<a name="l256"><span class="linenum"> 256</span></a>              return true;
<a name="l257"><span class="linenum"> 257</span></a>          }
<a name="l258"><span class="linenum"> 258</span></a>          return false;
<a name="l259"><span class="linenum"> 259</span></a>      }
<a name="l260"><span class="linenum"> 260</span></a>  
<a name="l261"><span class="linenum"> 261</span></a>      <span class="comment">/**</span>
<a name="l262"><span class="linenum"> 262</span></a>  <span class="comment">     * If the test pdf has been generated correctly and send it direct to the browser.</span>
<a name="l263"><span class="linenum"> 263</span></a>  <span class="comment">     */</span>
<a name="l264"><span class="linenum"> 264</span></a>      public static function <a class="function" onClick="logFunction('send_test_pdf')" href="../../_functions/send_test_pdf.html" onMouseOver="funcPopup(event,'send_test_pdf')">send_test_pdf</a>() {
<a name="l265"><span class="linenum"> 265</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l266"><span class="linenum"> 266</span></a>          require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a> . '/filelib.php');
<a name="l267"><span class="linenum"> 267</span></a>  
<a name="l268"><span class="linenum"> 268</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a> = array(
<a name="l269"><span class="linenum"> 269</span></a>              'contextid' =&gt; \<a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>()-&gt;id,
<a name="l270"><span class="linenum"> 270</span></a>              'component' =&gt; 'test',
<a name="l271"><span class="linenum"> 271</span></a>              'filearea' =&gt; 'assignfeedback_editpdf',
<a name="l272"><span class="linenum"> 272</span></a>              'itemid' =&gt; 0,
<a name="l273"><span class="linenum"> 273</span></a>              'filepath' =&gt; '/',
<a name="l274"><span class="linenum"> 274</span></a>              'filename' =&gt; 'unoconv_test.docx'
<a name="l275"><span class="linenum"> 275</span></a>          );
<a name="l276"><span class="linenum"> 276</span></a>  
<a name="l277"><span class="linenum"> 277</span></a>  <span class="comment">        // Get the fixture doc file content and generate and stored_file object.</span>
<a name="l278"><span class="linenum"> 278</span></a>          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l279"><span class="linenum"> 279</span></a>          <a class="var it27100" onMouseOver="hilite(27100)" onMouseOut="lolite()" onClick="logVariable('fixturefile')" href="../../_variables/fixturefile.html">$fixturefile</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a> . '/tests/fixtures/unoconv-source.docx';
<a name="l280"><span class="linenum"> 280</span></a>          <a class="var it27101" onMouseOver="hilite(27101)" onMouseOut="lolite()" onClick="logVariable('fixturedata')" href="../../_variables/fixturedata.html">$fixturedata</a> = <a class="phpfunction" onClick="logFunction('file_get_contents')" href="../../_functions/file_get_contents.html" onMouseOver="phpfuncPopup(event,'file_get_contents')">file_get_contents</a>(<a class="var it27100" onMouseOver="hilite(27100)" onMouseOut="lolite()" onClick="logVariable('fixturefile')" href="../../_variables/fixturefile.html">$fixturefile</a>);
<a name="l281"><span class="linenum"> 281</span></a>          <a class="var it27102" onMouseOver="hilite(27102)" onMouseOut="lolite()" onClick="logVariable('testdocx')" href="../../_variables/testdocx.html">$testdocx</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_file')" href="../../_functions/get_file.html" onMouseOver="funcPopup(event,'get_file')">get_file</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>['contextid'], <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>['component'], <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>['filearea'],
<a name="l282"><span class="linenum"> 282</span></a>                  <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>['itemid'], <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>['filepath'], <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>['filename']);
<a name="l283"><span class="linenum"> 283</span></a>          if (!<a class="var it27102" onMouseOver="hilite(27102)" onMouseOut="lolite()" onClick="logVariable('testdocx')" href="../../_variables/testdocx.html">$testdocx</a>) {
<a name="l284"><span class="linenum"> 284</span></a>              <a class="var it27102" onMouseOver="hilite(27102)" onMouseOut="lolite()" onClick="logVariable('testdocx')" href="../../_variables/testdocx.html">$testdocx</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('create_file_from_string')" href="../../_functions/create_file_from_string.html" onMouseOver="funcPopup(event,'create_file_from_string')">create_file_from_string</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>, <a class="var it27101" onMouseOver="hilite(27101)" onMouseOut="lolite()" onClick="logVariable('fixturedata')" href="../../_variables/fixturedata.html">$fixturedata</a>);
<a name="l285"><span class="linenum"> 285</span></a>  
<a name="l286"><span class="linenum"> 286</span></a>          }
<a name="l287"><span class="linenum"> 287</span></a>  
<a name="l288"><span class="linenum"> 288</span></a>  <span class="comment">        // Convert the doc file to pdf and send it direct to the browser.</span>
<a name="l289"><span class="linenum"> 289</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('get_converted_document')" href="../../_functions/get_converted_document.html" onMouseOver="funcPopup(event,'get_converted_document')">get_converted_document</a>(<a class="var it27102" onMouseOver="hilite(27102)" onMouseOut="lolite()" onClick="logVariable('testdocx')" href="../../_variables/testdocx.html">$testdocx</a>, 'pdf');
<a name="l290"><span class="linenum"> 290</span></a>          <a class="function" onClick="logFunction('readfile_accel')" href="../../_functions/readfile_accel.html" onMouseOver="funcPopup(event,'readfile_accel')">readfile_accel</a>(<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>, 'application/pdf', true);
<a name="l291"><span class="linenum"> 291</span></a>      }
<a name="l292"><span class="linenum"> 292</span></a>  
<a name="l293"><span class="linenum"> 293</span></a>      <span class="comment">/**</span>
<a name="l294"><span class="linenum"> 294</span></a>  <span class="comment">     * Check if unoconv configured path is correct and working.</span>
<a name="l295"><span class="linenum"> 295</span></a>  <span class="comment">     *</span>
<a name="l296"><span class="linenum"> 296</span></a>  <span class="comment">     * @return \stdClass an object with the test status and the UNOCONVPATH_ constant message.</span>
<a name="l297"><span class="linenum"> 297</span></a>  <span class="comment">     */</span>
<a name="l298"><span class="linenum"> 298</span></a>      public static function <a class="function" onClick="logFunction('test_unoconv_path')" href="../../_functions/test_unoconv_path.html" onMouseOver="funcPopup(event,'test_unoconv_path')">test_unoconv_path</a>() {
<a name="l299"><span class="linenum"> 299</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l300"><span class="linenum"> 300</span></a>          <a class="var it27103" onMouseOver="hilite(27103)" onMouseOut="lolite()" onClick="logVariable('unoconvpath')" href="../../_variables/unoconvpath.html">$unoconvpath</a> = <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('pathtounoconv')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/pathtounoconv.html">pathtounoconv</a>;
<a name="l301"><span class="linenum"> 301</span></a>  
<a name="l302"><span class="linenum"> 302</span></a>          <a class="var it76" onMouseOver="hilite(76)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../_variables/ret.html">$ret</a> = new \stdClass();
<a name="l303"><span class="linenum"> 303</span></a>          <a class="var it76" onMouseOver="hilite(76)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../_variables/ret.html">$ret</a>-&gt;<a onClick="logVariable('status')" class="var it43883" onMouseOver="hilite(43883)" onMouseOut="lolite()" href="../../_variables/status.html">status</a> = self::UNOCONVPATH_OK;
<a name="l304"><span class="linenum"> 304</span></a>          <a class="var it76" onMouseOver="hilite(76)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../_variables/ret.html">$ret</a>-&gt;<a onClick="logVariable('message')" class="var it43883" onMouseOver="hilite(43883)" onMouseOut="lolite()" href="../../_variables/message.html">message</a> = null;
<a name="l305"><span class="linenum"> 305</span></a>  
<a name="l306"><span class="linenum"> 306</span></a>          if (empty(<a class="var it27103" onMouseOver="hilite(27103)" onMouseOut="lolite()" onClick="logVariable('unoconvpath')" href="../../_variables/unoconvpath.html">$unoconvpath</a>)) {
<a name="l307"><span class="linenum"> 307</span></a>              <a class="var it76" onMouseOver="hilite(76)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../_variables/ret.html">$ret</a>-&gt;<a onClick="logVariable('status')" class="var it43883" onMouseOver="hilite(43883)" onMouseOut="lolite()" href="../../_variables/status.html">status</a> = self::UNOCONVPATH_EMPTY;
<a name="l308"><span class="linenum"> 308</span></a>              return <a class="var it76" onMouseOver="hilite(76)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../_variables/ret.html">$ret</a>;
<a name="l309"><span class="linenum"> 309</span></a>          }
<a name="l310"><span class="linenum"> 310</span></a>          if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it27103" onMouseOver="hilite(27103)" onMouseOut="lolite()" onClick="logVariable('unoconvpath')" href="../../_variables/unoconvpath.html">$unoconvpath</a>)) {
<a name="l311"><span class="linenum"> 311</span></a>              <a class="var it76" onMouseOver="hilite(76)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../_variables/ret.html">$ret</a>-&gt;<a onClick="logVariable('status')" class="var it43883" onMouseOver="hilite(43883)" onMouseOut="lolite()" href="../../_variables/status.html">status</a> = self::UNOCONVPATH_DOESNOTEXIST;
<a name="l312"><span class="linenum"> 312</span></a>              return <a class="var it76" onMouseOver="hilite(76)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../_variables/ret.html">$ret</a>;
<a name="l313"><span class="linenum"> 313</span></a>          }
<a name="l314"><span class="linenum"> 314</span></a>          if (<a class="phpfunction" onClick="logFunction('is_dir')" href="../../_functions/is_dir.html" onMouseOver="phpfuncPopup(event,'is_dir')">is_dir</a>(<a class="var it27103" onMouseOver="hilite(27103)" onMouseOut="lolite()" onClick="logVariable('unoconvpath')" href="../../_variables/unoconvpath.html">$unoconvpath</a>)) {
<a name="l315"><span class="linenum"> 315</span></a>              <a class="var it76" onMouseOver="hilite(76)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../_variables/ret.html">$ret</a>-&gt;<a onClick="logVariable('status')" class="var it43883" onMouseOver="hilite(43883)" onMouseOut="lolite()" href="../../_variables/status.html">status</a> = self::UNOCONVPATH_ISDIR;
<a name="l316"><span class="linenum"> 316</span></a>              return <a class="var it76" onMouseOver="hilite(76)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../_variables/ret.html">$ret</a>;
<a name="l317"><span class="linenum"> 317</span></a>          }
<a name="l318"><span class="linenum"> 318</span></a>          if (!<a class="function" onClick="logFunction('file_is_executable')" href="../../_functions/file_is_executable.html" onMouseOver="funcPopup(event,'file_is_executable')">file_is_executable</a>(<a class="var it27103" onMouseOver="hilite(27103)" onMouseOut="lolite()" onClick="logVariable('unoconvpath')" href="../../_variables/unoconvpath.html">$unoconvpath</a>)) {
<a name="l319"><span class="linenum"> 319</span></a>              <a class="var it76" onMouseOver="hilite(76)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../_variables/ret.html">$ret</a>-&gt;<a onClick="logVariable('status')" class="var it43883" onMouseOver="hilite(43883)" onMouseOut="lolite()" href="../../_variables/status.html">status</a> = self::UNOCONVPATH_NOTEXECUTABLE;
<a name="l320"><span class="linenum"> 320</span></a>              return <a class="var it76" onMouseOver="hilite(76)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../_variables/ret.html">$ret</a>;
<a name="l321"><span class="linenum"> 321</span></a>          }
<a name="l322"><span class="linenum"> 322</span></a>          if (!\<a class="class" onClick="logClass('file_storage')" href="../../_classes/file_storage.html" onMouseOver="classPopup(event,'file_storage')">file_storage</a>::<a class="function" onClick="logFunction('can_convert_documents')" href="../../_functions/can_convert_documents.html" onMouseOver="funcPopup(event,'can_convert_documents')">can_convert_documents</a>()) {
<a name="l323"><span class="linenum"> 323</span></a>              <a class="var it76" onMouseOver="hilite(76)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../_variables/ret.html">$ret</a>-&gt;<a onClick="logVariable('status')" class="var it43883" onMouseOver="hilite(43883)" onMouseOut="lolite()" href="../../_variables/status.html">status</a> = self::UNOCONVPATH_VERSIONNOTSUPPORTED;
<a name="l324"><span class="linenum"> 324</span></a>              return <a class="var it76" onMouseOver="hilite(76)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../_variables/ret.html">$ret</a>;
<a name="l325"><span class="linenum"> 325</span></a>          }
<a name="l326"><span class="linenum"> 326</span></a>  
<a name="l327"><span class="linenum"> 327</span></a>          return <a class="var it76" onMouseOver="hilite(76)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../_variables/ret.html">$ret</a>;
<a name="l328"><span class="linenum"> 328</span></a>      }
<a name="l329"><span class="linenum"> 329</span></a>  
<a name="l330"><span class="linenum"> 330</span></a>      <span class="comment">/**</span>
<a name="l331"><span class="linenum"> 331</span></a>  <span class="comment">     * Perform a file format conversion on the specified document.</span>
<a name="l332"><span class="linenum"> 332</span></a>  <span class="comment">     *</span>
<a name="l333"><span class="linenum"> 333</span></a>  <span class="comment">     * @param stored_file $file the file we want to preview</span>
<a name="l334"><span class="linenum"> 334</span></a>  <span class="comment">     * @param string $format The desired format - e.g. 'pdf'. Formats are specified by file extension.</span>
<a name="l335"><span class="linenum"> 335</span></a>  <span class="comment">     * @return stored_file|bool false if unable to create the conversion, stored file otherwise</span>
<a name="l336"><span class="linenum"> 336</span></a>  <span class="comment">     */</span>
<a name="l337"><span class="linenum"> 337</span></a>      protected function <a class="function" onClick="logFunction('create_converted_document')" href="../../_functions/create_converted_document.html" onMouseOver="funcPopup(event,'create_converted_document')">create_converted_document</a>(stored_file <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>, <a class="var it606" onMouseOver="hilite(606)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../_variables/format.html">$format</a>) {
<a name="l338"><span class="linenum"> 338</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l339"><span class="linenum"> 339</span></a>  
<a name="l340"><span class="linenum"> 340</span></a>          if (empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('pathtounoconv')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/pathtounoconv.html">pathtounoconv</a>) || !<a class="function" onClick="logFunction('file_is_executable')" href="../../_functions/file_is_executable.html" onMouseOver="funcPopup(event,'file_is_executable')">file_is_executable</a>(<a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('pathtounoconv')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/pathtounoconv.html">pathtounoconv</a>))) {
<a name="l341"><span class="linenum"> 341</span></a>  <span class="comment">            // No conversions are possible, sorry.</span>
<a name="l342"><span class="linenum"> 342</span></a>              return false;
<a name="l343"><span class="linenum"> 343</span></a>          }
<a name="l344"><span class="linenum"> 344</span></a>  
<a name="l345"><span class="linenum"> 345</span></a>          <a class="var it27104" onMouseOver="hilite(27104)" onMouseOut="lolite()" onClick="logVariable('fileextension')" href="../../_variables/fileextension.html">$fileextension</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="phpfunction" onClick="logFunction('pathinfo')" href="../../_functions/pathinfo.html" onMouseOver="phpfuncPopup(event,'pathinfo')">pathinfo</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_filename')" href="../../_functions/get_filename.html" onMouseOver="funcPopup(event,'get_filename')">get_filename</a>(), PATHINFO_EXTENSION));
<a name="l346"><span class="linenum"> 346</span></a>          if (!self::<a class="function" onClick="logFunction('is_format_supported_by_unoconv')" href="../../_functions/is_format_supported_by_unoconv.html" onMouseOver="funcPopup(event,'is_format_supported_by_unoconv')">is_format_supported_by_unoconv</a>(<a class="var it27104" onMouseOver="hilite(27104)" onMouseOut="lolite()" onClick="logVariable('fileextension')" href="../../_variables/fileextension.html">$fileextension</a>)) {
<a name="l347"><span class="linenum"> 347</span></a>              return false;
<a name="l348"><span class="linenum"> 348</span></a>          }
<a name="l349"><span class="linenum"> 349</span></a>  
<a name="l350"><span class="linenum"> 350</span></a>          if (!self::<a class="function" onClick="logFunction('is_format_supported_by_unoconv')" href="../../_functions/is_format_supported_by_unoconv.html" onMouseOver="funcPopup(event,'is_format_supported_by_unoconv')">is_format_supported_by_unoconv</a>(<a class="var it606" onMouseOver="hilite(606)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../_variables/format.html">$format</a>)) {
<a name="l351"><span class="linenum"> 351</span></a>              return false;
<a name="l352"><span class="linenum"> 352</span></a>          }
<a name="l353"><span class="linenum"> 353</span></a>  
<a name="l354"><span class="linenum"> 354</span></a>  <span class="comment">        // Copy the file to the tmp dir.</span>
<a name="l355"><span class="linenum"> 355</span></a>          <a class="var it27105" onMouseOver="hilite(27105)" onMouseOut="lolite()" onClick="logVariable('uniqdir')" href="../../_variables/uniqdir.html">$uniqdir</a> = &quot;core_file/conversions/&quot; . <a class="phpfunction" onClick="logFunction('uniqid')" href="../../_functions/uniqid.html" onMouseOver="phpfuncPopup(event,'uniqid')">uniqid</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>() . &quot;-&quot;, true);
<a name="l356"><span class="linenum"> 356</span></a>          <a class="var it117" onMouseOver="hilite(117)" onMouseOut="lolite()" onClick="logVariable('tmp')" href="../../_variables/tmp.html">$tmp</a> = <a class="function" onClick="logFunction('make_temp_directory')" href="../../_functions/make_temp_directory.html" onMouseOver="funcPopup(event,'make_temp_directory')">make_temp_directory</a>(<a class="var it27105" onMouseOver="hilite(27105)" onMouseOut="lolite()" onClick="logVariable('uniqdir')" href="../../_variables/uniqdir.html">$uniqdir</a>);
<a name="l357"><span class="linenum"> 357</span></a>          <a class="var it27106" onMouseOver="hilite(27106)" onMouseOut="lolite()" onClick="logVariable('localfilename')" href="../../_variables/localfilename.html">$localfilename</a> = <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_filename')" href="../../_functions/get_filename.html" onMouseOver="funcPopup(event,'get_filename')">get_filename</a>();
<a name="l358"><span class="linenum"> 358</span></a>  <span class="comment">        // Safety.</span>
<a name="l359"><span class="linenum"> 359</span></a>          <a class="var it27106" onMouseOver="hilite(27106)" onMouseOut="lolite()" onClick="logVariable('localfilename')" href="../../_variables/localfilename.html">$localfilename</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it27106" onMouseOver="hilite(27106)" onMouseOut="lolite()" onClick="logVariable('localfilename')" href="../../_variables/localfilename.html">$localfilename</a>, <a class="constant" onClick="logConstant('PARAM_FILE')" href="../../_constants/PARAM_FILE.html" onMouseOver="constPopup(event,'PARAM_FILE')">PARAM_FILE</a>);
<a name="l360"><span class="linenum"> 360</span></a>  
<a name="l361"><span class="linenum"> 361</span></a>          <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a> = <a class="var it117" onMouseOver="hilite(117)" onMouseOut="lolite()" onClick="logVariable('tmp')" href="../../_variables/tmp.html">$tmp</a> . '/' . <a class="var it27106" onMouseOver="hilite(27106)" onMouseOut="lolite()" onClick="logVariable('localfilename')" href="../../_variables/localfilename.html">$localfilename</a>;
<a name="l362"><span class="linenum"> 362</span></a>          try {
<a name="l363"><span class="linenum"> 363</span></a>  <span class="comment">            // This function can either return false, or throw an exception so we need to handle both.</span>
<a name="l364"><span class="linenum"> 364</span></a>              if (<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('copy_content_to')" href="../../_functions/copy_content_to.html" onMouseOver="funcPopup(event,'copy_content_to')">copy_content_to</a>(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>) === false) {
<a name="l365"><span class="linenum"> 365</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Could not copy file contents to temp file.');
<a name="l366"><span class="linenum"> 366</span></a>              }
<a name="l367"><span class="linenum"> 367</span></a>          } catch (file_exception <a class="var it15971" onMouseOver="hilite(15971)" onMouseOut="lolite()" onClick="logVariable('fe')" href="../../_variables/fe.html">$fe</a>) {
<a name="l368"><span class="linenum"> 368</span></a>              <a class="function" onClick="logFunction('remove_dir')" href="../../_functions/remove_dir.html" onMouseOver="funcPopup(event,'remove_dir')">remove_dir</a>(<a class="var it27105" onMouseOver="hilite(27105)" onMouseOut="lolite()" onClick="logVariable('uniqdir')" href="../../_variables/uniqdir.html">$uniqdir</a>);
<a name="l369"><span class="linenum"> 369</span></a>              throw <a class="var it15971" onMouseOver="hilite(15971)" onMouseOut="lolite()" onClick="logVariable('fe')" href="../../_variables/fe.html">$fe</a>;
<a name="l370"><span class="linenum"> 370</span></a>          }
<a name="l371"><span class="linenum"> 371</span></a>  
<a name="l372"><span class="linenum"> 372</span></a>          <a class="var it27107" onMouseOver="hilite(27107)" onMouseOut="lolite()" onClick="logVariable('newtmpfile')" href="../../_variables/newtmpfile.html">$newtmpfile</a> = <a class="phpfunction" onClick="logFunction('pathinfo')" href="../../_functions/pathinfo.html" onMouseOver="phpfuncPopup(event,'pathinfo')">pathinfo</a>(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>, PATHINFO_FILENAME) . '.' . <a class="var it606" onMouseOver="hilite(606)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../_variables/format.html">$format</a>;
<a name="l373"><span class="linenum"> 373</span></a>  
<a name="l374"><span class="linenum"> 374</span></a>  <span class="comment">        // Safety.</span>
<a name="l375"><span class="linenum"> 375</span></a>          <a class="var it27107" onMouseOver="hilite(27107)" onMouseOut="lolite()" onClick="logVariable('newtmpfile')" href="../../_variables/newtmpfile.html">$newtmpfile</a> = <a class="var it117" onMouseOver="hilite(117)" onMouseOut="lolite()" onClick="logVariable('tmp')" href="../../_variables/tmp.html">$tmp</a> . '/' . <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it27107" onMouseOver="hilite(27107)" onMouseOut="lolite()" onClick="logVariable('newtmpfile')" href="../../_variables/newtmpfile.html">$newtmpfile</a>, <a class="constant" onClick="logConstant('PARAM_FILE')" href="../../_constants/PARAM_FILE.html" onMouseOver="constPopup(event,'PARAM_FILE')">PARAM_FILE</a>);
<a name="l376"><span class="linenum"> 376</span></a>  
<a name="l377"><span class="linenum"> 377</span></a>          <a class="var it4480" onMouseOver="hilite(4480)" onMouseOut="lolite()" onClick="logVariable('cmd')" href="../../_variables/cmd.html">$cmd</a> = <a class="phpfunction" onClick="logFunction('escapeshellcmd')" href="../../_functions/escapeshellcmd.html" onMouseOver="phpfuncPopup(event,'escapeshellcmd')">escapeshellcmd</a>(<a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('pathtounoconv')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/pathtounoconv.html">pathtounoconv</a>)) . ' ' .
<a name="l378"><span class="linenum"> 378</span></a>                 <a class="phpfunction" onClick="logFunction('escapeshellarg')" href="../../_functions/escapeshellarg.html" onMouseOver="phpfuncPopup(event,'escapeshellarg')">escapeshellarg</a>('-f') . ' ' .
<a name="l379"><span class="linenum"> 379</span></a>                 <a class="phpfunction" onClick="logFunction('escapeshellarg')" href="../../_functions/escapeshellarg.html" onMouseOver="phpfuncPopup(event,'escapeshellarg')">escapeshellarg</a>(<a class="var it606" onMouseOver="hilite(606)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../_variables/format.html">$format</a>) . ' ' .
<a name="l380"><span class="linenum"> 380</span></a>                 <a class="phpfunction" onClick="logFunction('escapeshellarg')" href="../../_functions/escapeshellarg.html" onMouseOver="phpfuncPopup(event,'escapeshellarg')">escapeshellarg</a>('-o') . ' ' .
<a name="l381"><span class="linenum"> 381</span></a>                 <a class="phpfunction" onClick="logFunction('escapeshellarg')" href="../../_functions/escapeshellarg.html" onMouseOver="phpfuncPopup(event,'escapeshellarg')">escapeshellarg</a>(<a class="var it27107" onMouseOver="hilite(27107)" onMouseOut="lolite()" onClick="logVariable('newtmpfile')" href="../../_variables/newtmpfile.html">$newtmpfile</a>) . ' ' .
<a name="l382"><span class="linenum"> 382</span></a>                 <a class="phpfunction" onClick="logFunction('escapeshellarg')" href="../../_functions/escapeshellarg.html" onMouseOver="phpfuncPopup(event,'escapeshellarg')">escapeshellarg</a>(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>);
<a name="l383"><span class="linenum"> 383</span></a>  
<a name="l384"><span class="linenum"> 384</span></a>          <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a> = null;
<a name="l385"><span class="linenum"> 385</span></a>          <a class="var it27108" onMouseOver="hilite(27108)" onMouseOut="lolite()" onClick="logVariable('currentdir')" href="../../_variables/currentdir.html">$currentdir</a> = <a class="phpfunction" onClick="logFunction('getcwd')" href="../../_functions/getcwd.html" onMouseOver="phpfuncPopup(event,'getcwd')">getcwd</a>();
<a name="l386"><span class="linenum"> 386</span></a>          <a class="phpfunction" onClick="logFunction('chdir')" href="../../_functions/chdir.html" onMouseOver="phpfuncPopup(event,'chdir')">chdir</a>(<a class="var it117" onMouseOver="hilite(117)" onMouseOut="lolite()" onClick="logVariable('tmp')" href="../../_variables/tmp.html">$tmp</a>);
<a name="l387"><span class="linenum"> 387</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="phpfunction" onClick="logFunction('exec')" href="../../_functions/exec.html" onMouseOver="phpfuncPopup(event,'exec')">exec</a>(<a class="var it4480" onMouseOver="hilite(4480)" onMouseOut="lolite()" onClick="logVariable('cmd')" href="../../_variables/cmd.html">$cmd</a>, <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('output')" href="../../_variables/output.html">$output</a>);
<a name="l388"><span class="linenum"> 388</span></a>          <a class="phpfunction" onClick="logFunction('chdir')" href="../../_functions/chdir.html" onMouseOver="phpfuncPopup(event,'chdir')">chdir</a>(<a class="var it27108" onMouseOver="hilite(27108)" onMouseOut="lolite()" onClick="logVariable('currentdir')" href="../../_variables/currentdir.html">$currentdir</a>);
<a name="l389"><span class="linenum"> 389</span></a>          if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it27107" onMouseOver="hilite(27107)" onMouseOut="lolite()" onClick="logVariable('newtmpfile')" href="../../_variables/newtmpfile.html">$newtmpfile</a>)) {
<a name="l390"><span class="linenum"> 390</span></a>              <a class="function" onClick="logFunction('remove_dir')" href="../../_functions/remove_dir.html" onMouseOver="funcPopup(event,'remove_dir')">remove_dir</a>(<a class="var it27105" onMouseOver="hilite(27105)" onMouseOut="lolite()" onClick="logVariable('uniqdir')" href="../../_variables/uniqdir.html">$uniqdir</a>);
<a name="l391"><span class="linenum"> 391</span></a>  <span class="comment">            // Cleanup.</span>
<a name="l392"><span class="linenum"> 392</span></a>              return false;
<a name="l393"><span class="linenum"> 393</span></a>          }
<a name="l394"><span class="linenum"> 394</span></a>  
<a name="l395"><span class="linenum"> 395</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l396"><span class="linenum"> 396</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a> = array(
<a name="l397"><span class="linenum"> 397</span></a>              'contextid' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l398"><span class="linenum"> 398</span></a>              'component' =&gt; 'core',
<a name="l399"><span class="linenum"> 399</span></a>              'filearea'  =&gt; 'documentconversion',
<a name="l400"><span class="linenum"> 400</span></a>              'itemid'    =&gt; 0,
<a name="l401"><span class="linenum"> 401</span></a>              'filepath'  =&gt; '/' . <a class="var it606" onMouseOver="hilite(606)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../_variables/format.html">$format</a> . '/',
<a name="l402"><span class="linenum"> 402</span></a>              'filename'  =&gt; <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_contenthash')" href="../../_functions/get_contenthash.html" onMouseOver="funcPopup(event,'get_contenthash')">get_contenthash</a>(),
<a name="l403"><span class="linenum"> 403</span></a>          );
<a name="l404"><span class="linenum"> 404</span></a>  
<a name="l405"><span class="linenum"> 405</span></a>          <a class="var it23125" onMouseOver="hilite(23125)" onMouseOut="lolite()" onClick="logVariable('convertedfile')" href="../../_variables/convertedfile.html">$convertedfile</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('create_file_from_pathname')" href="../../_functions/create_file_from_pathname.html" onMouseOver="funcPopup(event,'create_file_from_pathname')">create_file_from_pathname</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>, <a class="var it27107" onMouseOver="hilite(27107)" onMouseOut="lolite()" onClick="logVariable('newtmpfile')" href="../../_variables/newtmpfile.html">$newtmpfile</a>);
<a name="l406"><span class="linenum"> 406</span></a>  <span class="comment">        // Cleanup.</span>
<a name="l407"><span class="linenum"> 407</span></a>          <a class="function" onClick="logFunction('remove_dir')" href="../../_functions/remove_dir.html" onMouseOver="funcPopup(event,'remove_dir')">remove_dir</a>(<a class="var it27105" onMouseOver="hilite(27105)" onMouseOut="lolite()" onClick="logVariable('uniqdir')" href="../../_variables/uniqdir.html">$uniqdir</a>);
<a name="l408"><span class="linenum"> 408</span></a>          return <a class="var it23125" onMouseOver="hilite(23125)" onMouseOut="lolite()" onClick="logVariable('convertedfile')" href="../../_variables/convertedfile.html">$convertedfile</a>;
<a name="l409"><span class="linenum"> 409</span></a>      }
<a name="l410"><span class="linenum"> 410</span></a>  
<a name="l411"><span class="linenum"> 411</span></a>      <span class="comment">/**</span>
<a name="l412"><span class="linenum"> 412</span></a>  <span class="comment">     * Returns an image file that represent the given stored file as a preview</span>
<a name="l413"><span class="linenum"> 413</span></a>  <span class="comment">     *</span>
<a name="l414"><span class="linenum"> 414</span></a>  <span class="comment">     * At the moment, only GIF, JPEG and PNG files are supported to have previews. In the</span>
<a name="l415"><span class="linenum"> 415</span></a>  <span class="comment">     * future, the support for other mimetypes can be added, too (eg. generate an image</span>
<a name="l416"><span class="linenum"> 416</span></a>  <span class="comment">     * preview of PDF, text documents etc).</span>
<a name="l417"><span class="linenum"> 417</span></a>  <span class="comment">     *</span>
<a name="l418"><span class="linenum"> 418</span></a>  <span class="comment">     * @param stored_file $file the file we want to preview</span>
<a name="l419"><span class="linenum"> 419</span></a>  <span class="comment">     * @param string $mode preview mode, eg. 'thumb'</span>
<a name="l420"><span class="linenum"> 420</span></a>  <span class="comment">     * @return stored_file|bool false if unable to create the preview, stored file otherwise</span>
<a name="l421"><span class="linenum"> 421</span></a>  <span class="comment">     */</span>
<a name="l422"><span class="linenum"> 422</span></a>      public function <a class="function" onClick="logFunction('get_file_preview')" href="../../_functions/get_file_preview.html" onMouseOver="funcPopup(event,'get_file_preview')">get_file_preview</a>(stored_file <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>, <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../../_variables/mode.html">$mode</a>) {
<a name="l423"><span class="linenum"> 423</span></a>  
<a name="l424"><span class="linenum"> 424</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l425"><span class="linenum"> 425</span></a>          <a class="var it240" onMouseOver="hilite(240)" onMouseOut="lolite()" onClick="logVariable('path')" href="../../_variables/path.html">$path</a> = '/' . <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../../_variables/mode.html">$mode</a>, '/') . '/';
<a name="l426"><span class="linenum"> 426</span></a>          <a class="var it9514" onMouseOver="hilite(9514)" onMouseOut="lolite()" onClick="logVariable('preview')" href="../../_variables/preview.html">$preview</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file')" href="../../_functions/get_file.html" onMouseOver="funcPopup(event,'get_file')">get_file</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'core', 'preview', 0, <a class="var it240" onMouseOver="hilite(240)" onMouseOut="lolite()" onClick="logVariable('path')" href="../../_variables/path.html">$path</a>, <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_contenthash')" href="../../_functions/get_contenthash.html" onMouseOver="funcPopup(event,'get_contenthash')">get_contenthash</a>());
<a name="l427"><span class="linenum"> 427</span></a>  
<a name="l428"><span class="linenum"> 428</span></a>          if (!<a class="var it9514" onMouseOver="hilite(9514)" onMouseOut="lolite()" onClick="logVariable('preview')" href="../../_variables/preview.html">$preview</a>) {
<a name="l429"><span class="linenum"> 429</span></a>              <a class="var it9514" onMouseOver="hilite(9514)" onMouseOut="lolite()" onClick="logVariable('preview')" href="../../_variables/preview.html">$preview</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('create_file_preview')" href="../../_functions/create_file_preview.html" onMouseOver="funcPopup(event,'create_file_preview')">create_file_preview</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>, <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../../_variables/mode.html">$mode</a>);
<a name="l430"><span class="linenum"> 430</span></a>              if (!<a class="var it9514" onMouseOver="hilite(9514)" onMouseOut="lolite()" onClick="logVariable('preview')" href="../../_variables/preview.html">$preview</a>) {
<a name="l431"><span class="linenum"> 431</span></a>                  return false;
<a name="l432"><span class="linenum"> 432</span></a>              }
<a name="l433"><span class="linenum"> 433</span></a>          }
<a name="l434"><span class="linenum"> 434</span></a>  
<a name="l435"><span class="linenum"> 435</span></a>          return <a class="var it9514" onMouseOver="hilite(9514)" onMouseOut="lolite()" onClick="logVariable('preview')" href="../../_variables/preview.html">$preview</a>;
<a name="l436"><span class="linenum"> 436</span></a>      }
<a name="l437"><span class="linenum"> 437</span></a>  
<a name="l438"><span class="linenum"> 438</span></a>      <span class="comment">/**</span>
<a name="l439"><span class="linenum"> 439</span></a>  <span class="comment">     * Return an available file name.</span>
<a name="l440"><span class="linenum"> 440</span></a>  <span class="comment">     *</span>
<a name="l441"><span class="linenum"> 441</span></a>  <span class="comment">     * This will return the next available file name in the area, adding/incrementing a suffix</span>
<a name="l442"><span class="linenum"> 442</span></a>  <span class="comment">     * of the file, ie: file.txt &gt; file (1).txt &gt; file (2).txt &gt; etc...</span>
<a name="l443"><span class="linenum"> 443</span></a>  <span class="comment">     *</span>
<a name="l444"><span class="linenum"> 444</span></a>  <span class="comment">     * If the file name passed is available without modification, it is returned as is.</span>
<a name="l445"><span class="linenum"> 445</span></a>  <span class="comment">     *</span>
<a name="l446"><span class="linenum"> 446</span></a>  <span class="comment">     * @param int $contextid context ID.</span>
<a name="l447"><span class="linenum"> 447</span></a>  <span class="comment">     * @param string $component component.</span>
<a name="l448"><span class="linenum"> 448</span></a>  <span class="comment">     * @param string $filearea file area.</span>
<a name="l449"><span class="linenum"> 449</span></a>  <span class="comment">     * @param int $itemid area item ID.</span>
<a name="l450"><span class="linenum"> 450</span></a>  <span class="comment">     * @param string $filepath the file path.</span>
<a name="l451"><span class="linenum"> 451</span></a>  <span class="comment">     * @param string $filename the file name.</span>
<a name="l452"><span class="linenum"> 452</span></a>  <span class="comment">     * @return string available file name.</span>
<a name="l453"><span class="linenum"> 453</span></a>  <span class="comment">     * @throws coding_exception if the file name is invalid.</span>
<a name="l454"><span class="linenum"> 454</span></a>  <span class="comment">     * @since Moodle 2.5</span>
<a name="l455"><span class="linenum"> 455</span></a>  <span class="comment">     */</span>
<a name="l456"><span class="linenum"> 456</span></a>      public function <a class="function" onClick="logFunction('get_unused_filename')" href="../../_functions/get_unused_filename.html" onMouseOver="funcPopup(event,'get_unused_filename')">get_unused_filename</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>) {
<a name="l457"><span class="linenum"> 457</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l458"><span class="linenum"> 458</span></a>  
<a name="l459"><span class="linenum"> 459</span></a>  <span class="comment">        // Do not accept '.' or an empty file name (zero is acceptable).</span>
<a name="l460"><span class="linenum"> 460</span></a>          if (<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a> == '.' || (empty(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>) &amp;&amp; !<a class="phpfunction" onClick="logFunction('is_numeric')" href="../../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>))) {
<a name="l461"><span class="linenum"> 461</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid file name passed', <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>);
<a name="l462"><span class="linenum"> 462</span></a>          }
<a name="l463"><span class="linenum"> 463</span></a>  
<a name="l464"><span class="linenum"> 464</span></a>  <span class="comment">        // The file does not exist, we return the same file name.</span>
<a name="l465"><span class="linenum"> 465</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>)) {
<a name="l466"><span class="linenum"> 466</span></a>              return <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>;
<a name="l467"><span class="linenum"> 467</span></a>          }
<a name="l468"><span class="linenum"> 468</span></a>  
<a name="l469"><span class="linenum"> 469</span></a>  <span class="comment">        // Trying to locate a file name using the used pattern. We remove the used pattern from the file name first.</span>
<a name="l470"><span class="linenum"> 470</span></a>          <a class="var it19902" onMouseOver="hilite(19902)" onMouseOut="lolite()" onClick="logVariable('pathinfo')" href="../../_variables/pathinfo.html">$pathinfo</a> = <a class="phpfunction" onClick="logFunction('pathinfo')" href="../../_functions/pathinfo.html" onMouseOver="phpfuncPopup(event,'pathinfo')">pathinfo</a>(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>);
<a name="l471"><span class="linenum"> 471</span></a>          <a class="var it6008" onMouseOver="hilite(6008)" onMouseOut="lolite()" onClick="logVariable('basename')" href="../../_variables/basename.html">$basename</a> = <a class="var it19902" onMouseOver="hilite(19902)" onMouseOut="lolite()" onClick="logVariable('pathinfo')" href="../../_variables/pathinfo.html">$pathinfo</a>['filename'];
<a name="l472"><span class="linenum"> 472</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = array();
<a name="l473"><span class="linenum"> 473</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('~^(.+) \(([0-9]+)\)$~', <a class="var it6008" onMouseOver="hilite(6008)" onMouseOut="lolite()" onClick="logVariable('basename')" href="../../_variables/basename.html">$basename</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l474"><span class="linenum"> 474</span></a>              <a class="var it6008" onMouseOver="hilite(6008)" onMouseOut="lolite()" onClick="logVariable('basename')" href="../../_variables/basename.html">$basename</a> = <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1];
<a name="l475"><span class="linenum"> 475</span></a>          }
<a name="l476"><span class="linenum"> 476</span></a>  
<a name="l477"><span class="linenum"> 477</span></a>          <a class="var it27109" onMouseOver="hilite(27109)" onMouseOut="lolite()" onClick="logVariable('filenamelike')" href="../../_variables/filenamelike.html">$filenamelike</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_like_escape')" href="../../_functions/sql_like_escape.html" onMouseOver="funcPopup(event,'sql_like_escape')">sql_like_escape</a>(<a class="var it6008" onMouseOver="hilite(6008)" onMouseOut="lolite()" onClick="logVariable('basename')" href="../../_variables/basename.html">$basename</a>) . ' (%)';
<a name="l478"><span class="linenum"> 478</span></a>          if (isset(<a class="var it19902" onMouseOver="hilite(19902)" onMouseOut="lolite()" onClick="logVariable('pathinfo')" href="../../_variables/pathinfo.html">$pathinfo</a>['extension'])) {
<a name="l479"><span class="linenum"> 479</span></a>              <a class="var it27109" onMouseOver="hilite(27109)" onMouseOut="lolite()" onClick="logVariable('filenamelike')" href="../../_variables/filenamelike.html">$filenamelike</a> .= '.' . <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_like_escape')" href="../../_functions/sql_like_escape.html" onMouseOver="funcPopup(event,'sql_like_escape')">sql_like_escape</a>(<a class="var it19902" onMouseOver="hilite(19902)" onMouseOut="lolite()" onClick="logVariable('pathinfo')" href="../../_variables/pathinfo.html">$pathinfo</a>['extension']);
<a name="l480"><span class="linenum"> 480</span></a>          }
<a name="l481"><span class="linenum"> 481</span></a>  
<a name="l482"><span class="linenum"> 482</span></a>          <a class="var it27110" onMouseOver="hilite(27110)" onMouseOut="lolite()" onClick="logVariable('filenamelikesql')" href="../../_variables/filenamelikesql.html">$filenamelikesql</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_like')" href="../../_functions/sql_like.html" onMouseOver="funcPopup(event,'sql_like')">sql_like</a>('f.filename', ':filenamelike');
<a name="l483"><span class="linenum"> 483</span></a>          <a class="var it27111" onMouseOver="hilite(27111)" onMouseOut="lolite()" onClick="logVariable('filenamelen')" href="../../_variables/filenamelen.html">$filenamelen</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_length')" href="../../_functions/sql_length.html" onMouseOver="funcPopup(event,'sql_length')">sql_length</a>('f.filename');
<a name="l484"><span class="linenum"> 484</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT filename
<a name="l485"><span class="linenum"> 485</span></a>                  FROM {files} f
<a name="l486"><span class="linenum"> 486</span></a>                  WHERE
<a name="l487"><span class="linenum"> 487</span></a>                      f.contextid = :contextid AND
<a name="l488"><span class="linenum"> 488</span></a>                      f.component = :component AND
<a name="l489"><span class="linenum"> 489</span></a>                      f.filearea = :filearea AND
<a name="l490"><span class="linenum"> 490</span></a>                      f.itemid = :itemid AND
<a name="l491"><span class="linenum"> 491</span></a>                      f.filepath = :filepath AND
<a name="l492"><span class="linenum"> 492</span></a>                      <a class="var it27110" onMouseOver="hilite(27110)" onMouseOut="lolite()" onClick="logVariable('filenamelikesql')" href="../../_variables/filenamelikesql.html">$filenamelikesql</a>
<a name="l493"><span class="linenum"> 493</span></a>                  ORDER BY
<a name="l494"><span class="linenum"> 494</span></a>                      <a class="var it27111" onMouseOver="hilite(27111)" onMouseOut="lolite()" onClick="logVariable('filenamelen')" href="../../_variables/filenamelen.html">$filenamelen</a> DESC,
<a name="l495"><span class="linenum"> 495</span></a>                      f.filename DESC&quot;;
<a name="l496"><span class="linenum"> 496</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('contextid' =&gt; <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, 'component' =&gt; <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, 'filearea' =&gt; <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, 'itemid' =&gt; <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>,
<a name="l497"><span class="linenum"> 497</span></a>                  'filepath' =&gt; <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, 'filenamelike' =&gt; <a class="var it27109" onMouseOver="hilite(27109)" onMouseOut="lolite()" onClick="logVariable('filenamelike')" href="../../_variables/filenamelike.html">$filenamelike</a>);
<a name="l498"><span class="linenum"> 498</span></a>          <a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../_variables/results.html">$results</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_fieldset_sql')" href="../../_functions/get_fieldset_sql.html" onMouseOver="funcPopup(event,'get_fieldset_sql')">get_fieldset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, <a class="constant" onClick="logConstant('IGNORE_MULTIPLE')" href="../../_constants/IGNORE_MULTIPLE.html" onMouseOver="constPopup(event,'IGNORE_MULTIPLE')">IGNORE_MULTIPLE</a>);
<a name="l499"><span class="linenum"> 499</span></a>  
<a name="l500"><span class="linenum"> 500</span></a>  <span class="comment">        // Loop over the results to make sure we are working on a valid file name. Because 'file (1).txt' and 'file (copy).txt'</span>
<a name="l501"><span class="linenum"> 501</span></a>  <span class="comment">        // would both be returned, but only the one only containing digits should be used.</span>
<a name="l502"><span class="linenum"> 502</span></a>          <a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('number')" href="../../_variables/number.html">$number</a> = 1;
<a name="l503"><span class="linenum"> 503</span></a>          foreach (<a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../_variables/results.html">$results</a> as <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>) {
<a name="l504"><span class="linenum"> 504</span></a>              <a class="var it27112" onMouseOver="hilite(27112)" onMouseOut="lolite()" onClick="logVariable('resultbasename')" href="../../_variables/resultbasename.html">$resultbasename</a> = <a class="phpfunction" onClick="logFunction('pathinfo')" href="../../_functions/pathinfo.html" onMouseOver="phpfuncPopup(event,'pathinfo')">pathinfo</a>(<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>, PATHINFO_FILENAME);
<a name="l505"><span class="linenum"> 505</span></a>              <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = array();
<a name="l506"><span class="linenum"> 506</span></a>              if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('~^(.+) \(([0-9]+)\)$~', <a class="var it27112" onMouseOver="hilite(27112)" onMouseOut="lolite()" onClick="logVariable('resultbasename')" href="../../_variables/resultbasename.html">$resultbasename</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l507"><span class="linenum"> 507</span></a>                  <a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('number')" href="../../_variables/number.html">$number</a> = <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[2] + 1;
<a name="l508"><span class="linenum"> 508</span></a>                  break;
<a name="l509"><span class="linenum"> 509</span></a>              }
<a name="l510"><span class="linenum"> 510</span></a>          }
<a name="l511"><span class="linenum"> 511</span></a>  
<a name="l512"><span class="linenum"> 512</span></a>  <span class="comment">        // Constructing the new filename.</span>
<a name="l513"><span class="linenum"> 513</span></a>          <a class="var it7436" onMouseOver="hilite(7436)" onMouseOut="lolite()" onClick="logVariable('newfilename')" href="../../_variables/newfilename.html">$newfilename</a> = <a class="var it6008" onMouseOver="hilite(6008)" onMouseOut="lolite()" onClick="logVariable('basename')" href="../../_variables/basename.html">$basename</a> . ' (' . <a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('number')" href="../../_variables/number.html">$number</a> . ')';
<a name="l514"><span class="linenum"> 514</span></a>          if (isset(<a class="var it19902" onMouseOver="hilite(19902)" onMouseOut="lolite()" onClick="logVariable('pathinfo')" href="../../_variables/pathinfo.html">$pathinfo</a>['extension'])) {
<a name="l515"><span class="linenum"> 515</span></a>              <a class="var it7436" onMouseOver="hilite(7436)" onMouseOut="lolite()" onClick="logVariable('newfilename')" href="../../_variables/newfilename.html">$newfilename</a> .= '.' . <a class="var it19902" onMouseOver="hilite(19902)" onMouseOut="lolite()" onClick="logVariable('pathinfo')" href="../../_variables/pathinfo.html">$pathinfo</a>['extension'];
<a name="l516"><span class="linenum"> 516</span></a>          }
<a name="l517"><span class="linenum"> 517</span></a>  
<a name="l518"><span class="linenum"> 518</span></a>          return <a class="var it7436" onMouseOver="hilite(7436)" onMouseOut="lolite()" onClick="logVariable('newfilename')" href="../../_variables/newfilename.html">$newfilename</a>;
<a name="l519"><span class="linenum"> 519</span></a>      }
<a name="l520"><span class="linenum"> 520</span></a>  
<a name="l521"><span class="linenum"> 521</span></a>      <span class="comment">/**</span>
<a name="l522"><span class="linenum"> 522</span></a>  <span class="comment">     * Return an available directory name.</span>
<a name="l523"><span class="linenum"> 523</span></a>  <span class="comment">     *</span>
<a name="l524"><span class="linenum"> 524</span></a>  <span class="comment">     * This will return the next available directory name in the area, adding/incrementing a suffix</span>
<a name="l525"><span class="linenum"> 525</span></a>  <span class="comment">     * of the last portion of path, ie: /path/ &gt; /path (1)/ &gt; /path (2)/ &gt; etc...</span>
<a name="l526"><span class="linenum"> 526</span></a>  <span class="comment">     *</span>
<a name="l527"><span class="linenum"> 527</span></a>  <span class="comment">     * If the file path passed is available without modification, it is returned as is.</span>
<a name="l528"><span class="linenum"> 528</span></a>  <span class="comment">     *</span>
<a name="l529"><span class="linenum"> 529</span></a>  <span class="comment">     * @param int $contextid context ID.</span>
<a name="l530"><span class="linenum"> 530</span></a>  <span class="comment">     * @param string $component component.</span>
<a name="l531"><span class="linenum"> 531</span></a>  <span class="comment">     * @param string $filearea file area.</span>
<a name="l532"><span class="linenum"> 532</span></a>  <span class="comment">     * @param int $itemid area item ID.</span>
<a name="l533"><span class="linenum"> 533</span></a>  <span class="comment">     * @param string $suggestedpath the suggested file path.</span>
<a name="l534"><span class="linenum"> 534</span></a>  <span class="comment">     * @return string available file path</span>
<a name="l535"><span class="linenum"> 535</span></a>  <span class="comment">     * @since Moodle 2.5</span>
<a name="l536"><span class="linenum"> 536</span></a>  <span class="comment">     */</span>
<a name="l537"><span class="linenum"> 537</span></a>      public function <a class="function" onClick="logFunction('get_unused_dirname')" href="../../_functions/get_unused_dirname.html" onMouseOver="funcPopup(event,'get_unused_dirname')">get_unused_dirname</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it27113" onMouseOver="hilite(27113)" onMouseOut="lolite()" onClick="logVariable('suggestedpath')" href="../../_variables/suggestedpath.html">$suggestedpath</a>) {
<a name="l538"><span class="linenum"> 538</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l539"><span class="linenum"> 539</span></a>  
<a name="l540"><span class="linenum"> 540</span></a>  <span class="comment">        // Ensure suggestedpath has trailing '/'</span>
<a name="l541"><span class="linenum"> 541</span></a>          <a class="var it27113" onMouseOver="hilite(27113)" onMouseOut="lolite()" onClick="logVariable('suggestedpath')" href="../../_variables/suggestedpath.html">$suggestedpath</a> = <a class="phpfunction" onClick="logFunction('rtrim')" href="../../_functions/rtrim.html" onMouseOver="phpfuncPopup(event,'rtrim')">rtrim</a>(<a class="var it27113" onMouseOver="hilite(27113)" onMouseOut="lolite()" onClick="logVariable('suggestedpath')" href="../../_variables/suggestedpath.html">$suggestedpath</a>, '/'). '/';
<a name="l542"><span class="linenum"> 542</span></a>  
<a name="l543"><span class="linenum"> 543</span></a>  <span class="comment">        // The directory does not exist, we return the same file path.</span>
<a name="l544"><span class="linenum"> 544</span></a>          if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it27113" onMouseOver="hilite(27113)" onMouseOut="lolite()" onClick="logVariable('suggestedpath')" href="../../_variables/suggestedpath.html">$suggestedpath</a>, '.')) {
<a name="l545"><span class="linenum"> 545</span></a>              return <a class="var it27113" onMouseOver="hilite(27113)" onMouseOut="lolite()" onClick="logVariable('suggestedpath')" href="../../_variables/suggestedpath.html">$suggestedpath</a>;
<a name="l546"><span class="linenum"> 546</span></a>          }
<a name="l547"><span class="linenum"> 547</span></a>  
<a name="l548"><span class="linenum"> 548</span></a>  <span class="comment">        // Trying to locate a file path using the used pattern. We remove the used pattern from the path first.</span>
<a name="l549"><span class="linenum"> 549</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('~^(/.+) \(([0-9]+)\)/$~', <a class="var it27113" onMouseOver="hilite(27113)" onMouseOut="lolite()" onClick="logVariable('suggestedpath')" href="../../_variables/suggestedpath.html">$suggestedpath</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l550"><span class="linenum"> 550</span></a>              <a class="var it27113" onMouseOver="hilite(27113)" onMouseOut="lolite()" onClick="logVariable('suggestedpath')" href="../../_variables/suggestedpath.html">$suggestedpath</a> = <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]. '/';
<a name="l551"><span class="linenum"> 551</span></a>          }
<a name="l552"><span class="linenum"> 552</span></a>  
<a name="l553"><span class="linenum"> 553</span></a>          <a class="var it27114" onMouseOver="hilite(27114)" onMouseOut="lolite()" onClick="logVariable('filepathlike')" href="../../_variables/filepathlike.html">$filepathlike</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_like_escape')" href="../../_functions/sql_like_escape.html" onMouseOver="funcPopup(event,'sql_like_escape')">sql_like_escape</a>(<a class="phpfunction" onClick="logFunction('rtrim')" href="../../_functions/rtrim.html" onMouseOver="phpfuncPopup(event,'rtrim')">rtrim</a>(<a class="var it27113" onMouseOver="hilite(27113)" onMouseOut="lolite()" onClick="logVariable('suggestedpath')" href="../../_variables/suggestedpath.html">$suggestedpath</a>, '/')) . ' (%)/';
<a name="l554"><span class="linenum"> 554</span></a>  
<a name="l555"><span class="linenum"> 555</span></a>          <a class="var it27115" onMouseOver="hilite(27115)" onMouseOut="lolite()" onClick="logVariable('filepathlikesql')" href="../../_variables/filepathlikesql.html">$filepathlikesql</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_like')" href="../../_functions/sql_like.html" onMouseOver="funcPopup(event,'sql_like')">sql_like</a>('f.filepath', ':filepathlike');
<a name="l556"><span class="linenum"> 556</span></a>          <a class="var it27116" onMouseOver="hilite(27116)" onMouseOut="lolite()" onClick="logVariable('filepathlen')" href="../../_variables/filepathlen.html">$filepathlen</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_length')" href="../../_functions/sql_length.html" onMouseOver="funcPopup(event,'sql_length')">sql_length</a>('f.filepath');
<a name="l557"><span class="linenum"> 557</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT filepath
<a name="l558"><span class="linenum"> 558</span></a>                  FROM {files} f
<a name="l559"><span class="linenum"> 559</span></a>                  WHERE
<a name="l560"><span class="linenum"> 560</span></a>                      f.contextid = :contextid AND
<a name="l561"><span class="linenum"> 561</span></a>                      f.component = :component AND
<a name="l562"><span class="linenum"> 562</span></a>                      f.filearea = :filearea AND
<a name="l563"><span class="linenum"> 563</span></a>                      f.itemid = :itemid AND
<a name="l564"><span class="linenum"> 564</span></a>                      f.filename = :filename AND
<a name="l565"><span class="linenum"> 565</span></a>                      <a class="var it27115" onMouseOver="hilite(27115)" onMouseOut="lolite()" onClick="logVariable('filepathlikesql')" href="../../_variables/filepathlikesql.html">$filepathlikesql</a>
<a name="l566"><span class="linenum"> 566</span></a>                  ORDER BY
<a name="l567"><span class="linenum"> 567</span></a>                      <a class="var it27116" onMouseOver="hilite(27116)" onMouseOut="lolite()" onClick="logVariable('filepathlen')" href="../../_variables/filepathlen.html">$filepathlen</a> DESC,
<a name="l568"><span class="linenum"> 568</span></a>                      f.filepath DESC&quot;;
<a name="l569"><span class="linenum"> 569</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('contextid' =&gt; <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, 'component' =&gt; <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, 'filearea' =&gt; <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, 'itemid' =&gt; <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>,
<a name="l570"><span class="linenum"> 570</span></a>                  'filename' =&gt; '.', 'filepathlike' =&gt; <a class="var it27114" onMouseOver="hilite(27114)" onMouseOut="lolite()" onClick="logVariable('filepathlike')" href="../../_variables/filepathlike.html">$filepathlike</a>);
<a name="l571"><span class="linenum"> 571</span></a>          <a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../_variables/results.html">$results</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_fieldset_sql')" href="../../_functions/get_fieldset_sql.html" onMouseOver="funcPopup(event,'get_fieldset_sql')">get_fieldset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, <a class="constant" onClick="logConstant('IGNORE_MULTIPLE')" href="../../_constants/IGNORE_MULTIPLE.html" onMouseOver="constPopup(event,'IGNORE_MULTIPLE')">IGNORE_MULTIPLE</a>);
<a name="l572"><span class="linenum"> 572</span></a>  
<a name="l573"><span class="linenum"> 573</span></a>  <span class="comment">        // Loop over the results to make sure we are working on a valid file path. Because '/path (1)/' and '/path (copy)/'</span>
<a name="l574"><span class="linenum"> 574</span></a>  <span class="comment">        // would both be returned, but only the one only containing digits should be used.</span>
<a name="l575"><span class="linenum"> 575</span></a>          <a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('number')" href="../../_variables/number.html">$number</a> = 1;
<a name="l576"><span class="linenum"> 576</span></a>          foreach (<a class="var it4821" onMouseOver="hilite(4821)" onMouseOut="lolite()" onClick="logVariable('results')" href="../../_variables/results.html">$results</a> as <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>) {
<a name="l577"><span class="linenum"> 577</span></a>              if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('~ \(([0-9]+)\)/$~', <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l578"><span class="linenum"> 578</span></a>                  <a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('number')" href="../../_variables/number.html">$number</a> = (int)(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]) + 1;
<a name="l579"><span class="linenum"> 579</span></a>                  break;
<a name="l580"><span class="linenum"> 580</span></a>              }
<a name="l581"><span class="linenum"> 581</span></a>          }
<a name="l582"><span class="linenum"> 582</span></a>  
<a name="l583"><span class="linenum"> 583</span></a>          return <a class="phpfunction" onClick="logFunction('rtrim')" href="../../_functions/rtrim.html" onMouseOver="phpfuncPopup(event,'rtrim')">rtrim</a>(<a class="var it27113" onMouseOver="hilite(27113)" onMouseOut="lolite()" onClick="logVariable('suggestedpath')" href="../../_variables/suggestedpath.html">$suggestedpath</a>, '/'). ' (' . <a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('number')" href="../../_variables/number.html">$number</a> . ')/';
<a name="l584"><span class="linenum"> 584</span></a>      }
<a name="l585"><span class="linenum"> 585</span></a>  
<a name="l586"><span class="linenum"> 586</span></a>      <span class="comment">/**</span>
<a name="l587"><span class="linenum"> 587</span></a>  <span class="comment">     * Generates a preview image for the stored file</span>
<a name="l588"><span class="linenum"> 588</span></a>  <span class="comment">     *</span>
<a name="l589"><span class="linenum"> 589</span></a>  <span class="comment">     * @param stored_file $file the file we want to preview</span>
<a name="l590"><span class="linenum"> 590</span></a>  <span class="comment">     * @param string $mode preview mode, eg. 'thumb'</span>
<a name="l591"><span class="linenum"> 591</span></a>  <span class="comment">     * @return stored_file|bool the newly created preview file or false</span>
<a name="l592"><span class="linenum"> 592</span></a>  <span class="comment">     */</span>
<a name="l593"><span class="linenum"> 593</span></a>      protected function <a class="function" onClick="logFunction('create_file_preview')" href="../../_functions/create_file_preview.html" onMouseOver="funcPopup(event,'create_file_preview')">create_file_preview</a>(stored_file <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>, <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../../_variables/mode.html">$mode</a>) {
<a name="l594"><span class="linenum"> 594</span></a>  
<a name="l595"><span class="linenum"> 595</span></a>          <a class="var it3340" onMouseOver="hilite(3340)" onMouseOut="lolite()" onClick="logVariable('mimetype')" href="../../_variables/mimetype.html">$mimetype</a> = <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_mimetype')" href="../../_functions/get_mimetype.html" onMouseOver="funcPopup(event,'get_mimetype')">get_mimetype</a>();
<a name="l596"><span class="linenum"> 596</span></a>  
<a name="l597"><span class="linenum"> 597</span></a>          if (<a class="var it3340" onMouseOver="hilite(3340)" onMouseOut="lolite()" onClick="logVariable('mimetype')" href="../../_variables/mimetype.html">$mimetype</a> === 'image/gif' or <a class="var it3340" onMouseOver="hilite(3340)" onMouseOut="lolite()" onClick="logVariable('mimetype')" href="../../_variables/mimetype.html">$mimetype</a> === 'image/jpeg' or <a class="var it3340" onMouseOver="hilite(3340)" onMouseOut="lolite()" onClick="logVariable('mimetype')" href="../../_variables/mimetype.html">$mimetype</a> === 'image/png') {
<a name="l598"><span class="linenum"> 598</span></a>  <span class="comment">            // make a preview of the image</span>
<a name="l599"><span class="linenum"> 599</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('create_imagefile_preview')" href="../../_functions/create_imagefile_preview.html" onMouseOver="funcPopup(event,'create_imagefile_preview')">create_imagefile_preview</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>, <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../../_variables/mode.html">$mode</a>);
<a name="l600"><span class="linenum"> 600</span></a>  
<a name="l601"><span class="linenum"> 601</span></a>          } else {
<a name="l602"><span class="linenum"> 602</span></a>  <span class="comment">            // unable to create the preview of this mimetype yet</span>
<a name="l603"><span class="linenum"> 603</span></a>              return false;
<a name="l604"><span class="linenum"> 604</span></a>          }
<a name="l605"><span class="linenum"> 605</span></a>  
<a name="l606"><span class="linenum"> 606</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>)) {
<a name="l607"><span class="linenum"> 607</span></a>              return false;
<a name="l608"><span class="linenum"> 608</span></a>          }
<a name="l609"><span class="linenum"> 609</span></a>  
<a name="l610"><span class="linenum"> 610</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l611"><span class="linenum"> 611</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a> = array(
<a name="l612"><span class="linenum"> 612</span></a>              'contextid' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l613"><span class="linenum"> 613</span></a>              'component' =&gt; 'core',
<a name="l614"><span class="linenum"> 614</span></a>              'filearea'  =&gt; 'preview',
<a name="l615"><span class="linenum"> 615</span></a>              'itemid'    =&gt; 0,
<a name="l616"><span class="linenum"> 616</span></a>              'filepath'  =&gt; '/' . <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../../_variables/mode.html">$mode</a>, '/') . '/',
<a name="l617"><span class="linenum"> 617</span></a>              'filename'  =&gt; <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_contenthash')" href="../../_functions/get_contenthash.html" onMouseOver="funcPopup(event,'get_contenthash')">get_contenthash</a>(),
<a name="l618"><span class="linenum"> 618</span></a>          );
<a name="l619"><span class="linenum"> 619</span></a>  
<a name="l620"><span class="linenum"> 620</span></a>          <a class="var it292" onMouseOver="hilite(292)" onMouseOut="lolite()" onClick="logVariable('imageinfo')" href="../../_variables/imageinfo.html">$imageinfo</a> = getimagesizefromstring(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l621"><span class="linenum"> 621</span></a>          if (<a class="var it292" onMouseOver="hilite(292)" onMouseOut="lolite()" onClick="logVariable('imageinfo')" href="../../_variables/imageinfo.html">$imageinfo</a>) {
<a name="l622"><span class="linenum"> 622</span></a>              <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>['mimetype'] = <a class="var it292" onMouseOver="hilite(292)" onMouseOut="lolite()" onClick="logVariable('imageinfo')" href="../../_variables/imageinfo.html">$imageinfo</a>['mime'];
<a name="l623"><span class="linenum"> 623</span></a>          }
<a name="l624"><span class="linenum"> 624</span></a>  
<a name="l625"><span class="linenum"> 625</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('create_file_from_string')" href="../../_functions/create_file_from_string.html" onMouseOver="funcPopup(event,'create_file_from_string')">create_file_from_string</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l626"><span class="linenum"> 626</span></a>      }
<a name="l627"><span class="linenum"> 627</span></a>  
<a name="l628"><span class="linenum"> 628</span></a>      <span class="comment">/**</span>
<a name="l629"><span class="linenum"> 629</span></a>  <span class="comment">     * Generates a preview for the stored image file</span>
<a name="l630"><span class="linenum"> 630</span></a>  <span class="comment">     *</span>
<a name="l631"><span class="linenum"> 631</span></a>  <span class="comment">     * @param stored_file $file the image we want to preview</span>
<a name="l632"><span class="linenum"> 632</span></a>  <span class="comment">     * @param string $mode preview mode, eg. 'thumb'</span>
<a name="l633"><span class="linenum"> 633</span></a>  <span class="comment">     * @return string|bool false if a problem occurs, the thumbnail image data otherwise</span>
<a name="l634"><span class="linenum"> 634</span></a>  <span class="comment">     */</span>
<a name="l635"><span class="linenum"> 635</span></a>      protected function <a class="function" onClick="logFunction('create_imagefile_preview')" href="../../_functions/create_imagefile_preview.html" onMouseOver="funcPopup(event,'create_imagefile_preview')">create_imagefile_preview</a>(stored_file <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>, <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../../_variables/mode.html">$mode</a>) {
<a name="l636"><span class="linenum"> 636</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l637"><span class="linenum"> 637</span></a>          require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/gdlib.php');
<a name="l638"><span class="linenum"> 638</span></a>  
<a name="l639"><span class="linenum"> 639</span></a>          if (<a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../../_variables/mode.html">$mode</a> === 'tinyicon') {
<a name="l640"><span class="linenum"> 640</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a> = <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('generate_image_thumbnail')" href="../../_functions/generate_image_thumbnail.html" onMouseOver="funcPopup(event,'generate_image_thumbnail')">generate_image_thumbnail</a>(24, 24);
<a name="l641"><span class="linenum"> 641</span></a>  
<a name="l642"><span class="linenum"> 642</span></a>          } else if (<a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../../_variables/mode.html">$mode</a> === 'thumb') {
<a name="l643"><span class="linenum"> 643</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a> = <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('generate_image_thumbnail')" href="../../_functions/generate_image_thumbnail.html" onMouseOver="funcPopup(event,'generate_image_thumbnail')">generate_image_thumbnail</a>(90, 90);
<a name="l644"><span class="linenum"> 644</span></a>  
<a name="l645"><span class="linenum"> 645</span></a>          } else if (<a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('mode')" href="../../_variables/mode.html">$mode</a> === 'bigthumb') {
<a name="l646"><span class="linenum"> 646</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a> = <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('generate_image_thumbnail')" href="../../_functions/generate_image_thumbnail.html" onMouseOver="funcPopup(event,'generate_image_thumbnail')">generate_image_thumbnail</a>(250, 250);
<a name="l647"><span class="linenum"> 647</span></a>  
<a name="l648"><span class="linenum"> 648</span></a>          } else {
<a name="l649"><span class="linenum"> 649</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid preview mode requested');
<a name="l650"><span class="linenum"> 650</span></a>          }
<a name="l651"><span class="linenum"> 651</span></a>  
<a name="l652"><span class="linenum"> 652</span></a>          return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>;
<a name="l653"><span class="linenum"> 653</span></a>      }
<a name="l654"><span class="linenum"> 654</span></a>  
<a name="l655"><span class="linenum"> 655</span></a>      <span class="comment">/**</span>
<a name="l656"><span class="linenum"> 656</span></a>  <span class="comment">     * Fetch file using local file id.</span>
<a name="l657"><span class="linenum"> 657</span></a>  <span class="comment">     *</span>
<a name="l658"><span class="linenum"> 658</span></a>  <span class="comment">     * Please do not rely on file ids, it is usually easier to use</span>
<a name="l659"><span class="linenum"> 659</span></a>  <span class="comment">     * pathname hashes instead.</span>
<a name="l660"><span class="linenum"> 660</span></a>  <span class="comment">     *</span>
<a name="l661"><span class="linenum"> 661</span></a>  <span class="comment">     * @param int $fileid file ID</span>
<a name="l662"><span class="linenum"> 662</span></a>  <span class="comment">     * @return stored_file|bool stored_file instance if exists, false if not</span>
<a name="l663"><span class="linenum"> 663</span></a>  <span class="comment">     */</span>
<a name="l664"><span class="linenum"> 664</span></a>      public function <a class="function" onClick="logFunction('get_file_by_id')" href="../../_functions/get_file_by_id.html" onMouseOver="funcPopup(event,'get_file_by_id')">get_file_by_id</a>(<a class="var it5429" onMouseOver="hilite(5429)" onMouseOut="lolite()" onClick="logVariable('fileid')" href="../../_variables/fileid.html">$fileid</a>) {
<a name="l665"><span class="linenum"> 665</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l666"><span class="linenum"> 666</span></a>  
<a name="l667"><span class="linenum"> 667</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT &quot;.self::<a class="function" onClick="logFunction('instance_sql_fields')" href="../../_functions/instance_sql_fields.html" onMouseOver="funcPopup(event,'instance_sql_fields')">instance_sql_fields</a>('f', 'r').&quot;
<a name="l668"><span class="linenum"> 668</span></a>                    FROM {files} f
<a name="l669"><span class="linenum"> 669</span></a>               LEFT JOIN {files_reference} r
<a name="l670"><span class="linenum"> 670</span></a>                         ON f.referencefileid = r.id
<a name="l671"><span class="linenum"> 671</span></a>                   WHERE f.id = ?&quot;;
<a name="l672"><span class="linenum"> 672</span></a>          if (<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array(<a class="var it5429" onMouseOver="hilite(5429)" onMouseOut="lolite()" onClick="logVariable('fileid')" href="../../_variables/fileid.html">$fileid</a>))) {
<a name="l673"><span class="linenum"> 673</span></a>              return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_instance')" href="../../_functions/get_file_instance.html" onMouseOver="funcPopup(event,'get_file_instance')">get_file_instance</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>);
<a name="l674"><span class="linenum"> 674</span></a>          } else {
<a name="l675"><span class="linenum"> 675</span></a>              return false;
<a name="l676"><span class="linenum"> 676</span></a>          }
<a name="l677"><span class="linenum"> 677</span></a>      }
<a name="l678"><span class="linenum"> 678</span></a>  
<a name="l679"><span class="linenum"> 679</span></a>      <span class="comment">/**</span>
<a name="l680"><span class="linenum"> 680</span></a>  <span class="comment">     * Fetch file using local file full pathname hash</span>
<a name="l681"><span class="linenum"> 681</span></a>  <span class="comment">     *</span>
<a name="l682"><span class="linenum"> 682</span></a>  <span class="comment">     * @param string $pathnamehash path name hash</span>
<a name="l683"><span class="linenum"> 683</span></a>  <span class="comment">     * @return stored_file|bool stored_file instance if exists, false if not</span>
<a name="l684"><span class="linenum"> 684</span></a>  <span class="comment">     */</span>
<a name="l685"><span class="linenum"> 685</span></a>      public function <a class="function" onClick="logFunction('get_file_by_hash')" href="../../_functions/get_file_by_hash.html" onMouseOver="funcPopup(event,'get_file_by_hash')">get_file_by_hash</a>(<a class="var it14667" onMouseOver="hilite(14667)" onMouseOut="lolite()" onClick="logVariable('pathnamehash')" href="../../_variables/pathnamehash.html">$pathnamehash</a>) {
<a name="l686"><span class="linenum"> 686</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l687"><span class="linenum"> 687</span></a>  
<a name="l688"><span class="linenum"> 688</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT &quot;.self::<a class="function" onClick="logFunction('instance_sql_fields')" href="../../_functions/instance_sql_fields.html" onMouseOver="funcPopup(event,'instance_sql_fields')">instance_sql_fields</a>('f', 'r').&quot;
<a name="l689"><span class="linenum"> 689</span></a>                    FROM {files} f
<a name="l690"><span class="linenum"> 690</span></a>               LEFT JOIN {files_reference} r
<a name="l691"><span class="linenum"> 691</span></a>                         ON f.referencefileid = r.id
<a name="l692"><span class="linenum"> 692</span></a>                   WHERE f.pathnamehash = ?&quot;;
<a name="l693"><span class="linenum"> 693</span></a>          if (<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array(<a class="var it14667" onMouseOver="hilite(14667)" onMouseOut="lolite()" onClick="logVariable('pathnamehash')" href="../../_variables/pathnamehash.html">$pathnamehash</a>))) {
<a name="l694"><span class="linenum"> 694</span></a>              return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_instance')" href="../../_functions/get_file_instance.html" onMouseOver="funcPopup(event,'get_file_instance')">get_file_instance</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>);
<a name="l695"><span class="linenum"> 695</span></a>          } else {
<a name="l696"><span class="linenum"> 696</span></a>              return false;
<a name="l697"><span class="linenum"> 697</span></a>          }
<a name="l698"><span class="linenum"> 698</span></a>      }
<a name="l699"><span class="linenum"> 699</span></a>  
<a name="l700"><span class="linenum"> 700</span></a>      <span class="comment">/**</span>
<a name="l701"><span class="linenum"> 701</span></a>  <span class="comment">     * Fetch locally stored file.</span>
<a name="l702"><span class="linenum"> 702</span></a>  <span class="comment">     *</span>
<a name="l703"><span class="linenum"> 703</span></a>  <span class="comment">     * @param int $contextid context ID</span>
<a name="l704"><span class="linenum"> 704</span></a>  <span class="comment">     * @param string $component component</span>
<a name="l705"><span class="linenum"> 705</span></a>  <span class="comment">     * @param string $filearea file area</span>
<a name="l706"><span class="linenum"> 706</span></a>  <span class="comment">     * @param int $itemid item ID</span>
<a name="l707"><span class="linenum"> 707</span></a>  <span class="comment">     * @param string $filepath file path</span>
<a name="l708"><span class="linenum"> 708</span></a>  <span class="comment">     * @param string $filename file name</span>
<a name="l709"><span class="linenum"> 709</span></a>  <span class="comment">     * @return stored_file|bool stored_file instance if exists, false if not</span>
<a name="l710"><span class="linenum"> 710</span></a>  <span class="comment">     */</span>
<a name="l711"><span class="linenum"> 711</span></a>      public function <a class="function" onClick="logFunction('get_file')" href="../../_functions/get_file.html" onMouseOver="funcPopup(event,'get_file')">get_file</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>) {
<a name="l712"><span class="linenum"> 712</span></a>          <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="constant" onClick="logConstant('PARAM_PATH')" href="../../_constants/PARAM_PATH.html" onMouseOver="constPopup(event,'PARAM_PATH')">PARAM_PATH</a>);
<a name="l713"><span class="linenum"> 713</span></a>          <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>, <a class="constant" onClick="logConstant('PARAM_FILE')" href="../../_constants/PARAM_FILE.html" onMouseOver="constPopup(event,'PARAM_FILE')">PARAM_FILE</a>);
<a name="l714"><span class="linenum"> 714</span></a>  
<a name="l715"><span class="linenum"> 715</span></a>          if (<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a> === '') {
<a name="l716"><span class="linenum"> 716</span></a>              <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a> = '.';
<a name="l717"><span class="linenum"> 717</span></a>          }
<a name="l718"><span class="linenum"> 718</span></a>  
<a name="l719"><span class="linenum"> 719</span></a>          <a class="var it14667" onMouseOver="hilite(14667)" onMouseOut="lolite()" onClick="logVariable('pathnamehash')" href="../../_variables/pathnamehash.html">$pathnamehash</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_pathname_hash')" href="../../_functions/get_pathname_hash.html" onMouseOver="funcPopup(event,'get_pathname_hash')">get_pathname_hash</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>);
<a name="l720"><span class="linenum"> 720</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_by_hash')" href="../../_functions/get_file_by_hash.html" onMouseOver="funcPopup(event,'get_file_by_hash')">get_file_by_hash</a>(<a class="var it14667" onMouseOver="hilite(14667)" onMouseOut="lolite()" onClick="logVariable('pathnamehash')" href="../../_variables/pathnamehash.html">$pathnamehash</a>);
<a name="l721"><span class="linenum"> 721</span></a>      }
<a name="l722"><span class="linenum"> 722</span></a>  
<a name="l723"><span class="linenum"> 723</span></a>      <span class="comment">/**</span>
<a name="l724"><span class="linenum"> 724</span></a>  <span class="comment">     * Are there any files (or directories)</span>
<a name="l725"><span class="linenum"> 725</span></a>  <span class="comment">     *</span>
<a name="l726"><span class="linenum"> 726</span></a>  <span class="comment">     * @param int $contextid context ID</span>
<a name="l727"><span class="linenum"> 727</span></a>  <span class="comment">     * @param string $component component</span>
<a name="l728"><span class="linenum"> 728</span></a>  <span class="comment">     * @param string $filearea file area</span>
<a name="l729"><span class="linenum"> 729</span></a>  <span class="comment">     * @param bool|int $itemid item id or false if all items</span>
<a name="l730"><span class="linenum"> 730</span></a>  <span class="comment">     * @param bool $ignoredirs whether or not ignore directories</span>
<a name="l731"><span class="linenum"> 731</span></a>  <span class="comment">     * @return bool empty</span>
<a name="l732"><span class="linenum"> 732</span></a>  <span class="comment">     */</span>
<a name="l733"><span class="linenum"> 733</span></a>      public function <a class="function" onClick="logFunction('is_area_empty')" href="../../_functions/is_area_empty.html" onMouseOver="funcPopup(event,'is_area_empty')">is_area_empty</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a> = false, <a class="var it27117" onMouseOver="hilite(27117)" onMouseOut="lolite()" onClick="logVariable('ignoredirs')" href="../../_variables/ignoredirs.html">$ignoredirs</a> = true) {
<a name="l734"><span class="linenum"> 734</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l735"><span class="linenum"> 735</span></a>  
<a name="l736"><span class="linenum"> 736</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('contextid'=&gt;<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, 'component'=&gt;<a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, 'filearea'=&gt;<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>);
<a name="l737"><span class="linenum"> 737</span></a>          <a class="var it3091" onMouseOver="hilite(3091)" onMouseOut="lolite()" onClick="logVariable('where')" href="../../_variables/where.html">$where</a> = &quot;contextid = :contextid AND component = :component AND filearea = :filearea&quot;;
<a name="l738"><span class="linenum"> 738</span></a>  
<a name="l739"><span class="linenum"> 739</span></a>          if (<a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a> !== false) {
<a name="l740"><span class="linenum"> 740</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['itemid'] = <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>;
<a name="l741"><span class="linenum"> 741</span></a>              <a class="var it3091" onMouseOver="hilite(3091)" onMouseOut="lolite()" onClick="logVariable('where')" href="../../_variables/where.html">$where</a> .= &quot; AND itemid = :itemid&quot;;
<a name="l742"><span class="linenum"> 742</span></a>          }
<a name="l743"><span class="linenum"> 743</span></a>  
<a name="l744"><span class="linenum"> 744</span></a>          if (<a class="var it27117" onMouseOver="hilite(27117)" onMouseOut="lolite()" onClick="logVariable('ignoredirs')" href="../../_variables/ignoredirs.html">$ignoredirs</a>) {
<a name="l745"><span class="linenum"> 745</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT 'x'
<a name="l746"><span class="linenum"> 746</span></a>                        FROM {files}
<a name="l747"><span class="linenum"> 747</span></a>                       WHERE <a class="var it3091" onMouseOver="hilite(3091)" onMouseOut="lolite()" onClick="logVariable('where')" href="../../_variables/where.html">$where</a> AND filename &lt;&gt; '.'&quot;;
<a name="l748"><span class="linenum"> 748</span></a>          } else {
<a name="l749"><span class="linenum"> 749</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT 'x'
<a name="l750"><span class="linenum"> 750</span></a>                        FROM {files}
<a name="l751"><span class="linenum"> 751</span></a>                       WHERE <a class="var it3091" onMouseOver="hilite(3091)" onMouseOut="lolite()" onClick="logVariable('where')" href="../../_variables/where.html">$where</a> AND (filename &lt;&gt; '.' OR filepath &lt;&gt; '/')&quot;;
<a name="l752"><span class="linenum"> 752</span></a>          }
<a name="l753"><span class="linenum"> 753</span></a>  
<a name="l754"><span class="linenum"> 754</span></a>          return !<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists_sql')" href="../../_functions/record_exists_sql.html" onMouseOver="funcPopup(event,'record_exists_sql')">record_exists_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l755"><span class="linenum"> 755</span></a>      }
<a name="l756"><span class="linenum"> 756</span></a>  
<a name="l757"><span class="linenum"> 757</span></a>      <span class="comment">/**</span>
<a name="l758"><span class="linenum"> 758</span></a>  <span class="comment">     * Returns all files belonging to given repository</span>
<a name="l759"><span class="linenum"> 759</span></a>  <span class="comment">     *</span>
<a name="l760"><span class="linenum"> 760</span></a>  <span class="comment">     * @param int $repositoryid</span>
<a name="l761"><span class="linenum"> 761</span></a>  <span class="comment">     * @param string $sort A fragment of SQL to use for sorting</span>
<a name="l762"><span class="linenum"> 762</span></a>  <span class="comment">     */</span>
<a name="l763"><span class="linenum"> 763</span></a>      public function <a class="function" onClick="logFunction('get_external_files')" href="../../_functions/get_external_files.html" onMouseOver="funcPopup(event,'get_external_files')">get_external_files</a>(<a class="var it5419" onMouseOver="hilite(5419)" onMouseOut="lolite()" onClick="logVariable('repositoryid')" href="../../_variables/repositoryid.html">$repositoryid</a>, <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> = '') {
<a name="l764"><span class="linenum"> 764</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l765"><span class="linenum"> 765</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT &quot;.self::<a class="function" onClick="logFunction('instance_sql_fields')" href="../../_functions/instance_sql_fields.html" onMouseOver="funcPopup(event,'instance_sql_fields')">instance_sql_fields</a>('f', 'r').&quot;
<a name="l766"><span class="linenum"> 766</span></a>                    FROM {files} f
<a name="l767"><span class="linenum"> 767</span></a>               LEFT JOIN {files_reference} r
<a name="l768"><span class="linenum"> 768</span></a>                         ON f.referencefileid = r.id
<a name="l769"><span class="linenum"> 769</span></a>                   WHERE r.repositoryid = ?&quot;;
<a name="l770"><span class="linenum"> 770</span></a>          if (!empty(<a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a>)) {
<a name="l771"><span class="linenum"> 771</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> .= &quot; ORDER BY {<a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a>}&quot;;
<a name="l772"><span class="linenum"> 772</span></a>          }
<a name="l773"><span class="linenum"> 773</span></a>  
<a name="l774"><span class="linenum"> 774</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = array();
<a name="l775"><span class="linenum"> 775</span></a>          <a class="var it27118" onMouseOver="hilite(27118)" onMouseOut="lolite()" onClick="logVariable('filerecords')" href="../../_variables/filerecords.html">$filerecords</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array(<a class="var it5419" onMouseOver="hilite(5419)" onMouseOut="lolite()" onClick="logVariable('repositoryid')" href="../../_variables/repositoryid.html">$repositoryid</a>));
<a name="l776"><span class="linenum"> 776</span></a>          foreach (<a class="var it27118" onMouseOver="hilite(27118)" onMouseOut="lolite()" onClick="logVariable('filerecords')" href="../../_variables/filerecords.html">$filerecords</a> as <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>) {
<a name="l777"><span class="linenum"> 777</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>[<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('pathnamehash')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/pathnamehash.html">pathnamehash</a>] = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_instance')" href="../../_functions/get_file_instance.html" onMouseOver="funcPopup(event,'get_file_instance')">get_file_instance</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>);
<a name="l778"><span class="linenum"> 778</span></a>          }
<a name="l779"><span class="linenum"> 779</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l780"><span class="linenum"> 780</span></a>      }
<a name="l781"><span class="linenum"> 781</span></a>  
<a name="l782"><span class="linenum"> 782</span></a>      <span class="comment">/**</span>
<a name="l783"><span class="linenum"> 783</span></a>  <span class="comment">     * Returns all area files (optionally limited by itemid)</span>
<a name="l784"><span class="linenum"> 784</span></a>  <span class="comment">     *</span>
<a name="l785"><span class="linenum"> 785</span></a>  <span class="comment">     * @param int $contextid context ID</span>
<a name="l786"><span class="linenum"> 786</span></a>  <span class="comment">     * @param string $component component</span>
<a name="l787"><span class="linenum"> 787</span></a>  <span class="comment">     * @param string $filearea file area</span>
<a name="l788"><span class="linenum"> 788</span></a>  <span class="comment">     * @param int $itemid item ID or all files if not specified</span>
<a name="l789"><span class="linenum"> 789</span></a>  <span class="comment">     * @param string $sort A fragment of SQL to use for sorting</span>
<a name="l790"><span class="linenum"> 790</span></a>  <span class="comment">     * @param bool $includedirs whether or not include directories</span>
<a name="l791"><span class="linenum"> 791</span></a>  <span class="comment">     * @return stored_file[] array of stored_files indexed by pathanmehash</span>
<a name="l792"><span class="linenum"> 792</span></a>  <span class="comment">     */</span>
<a name="l793"><span class="linenum"> 793</span></a>      public function <a class="function" onClick="logFunction('get_area_files')" href="../../_functions/get_area_files.html" onMouseOver="funcPopup(event,'get_area_files')">get_area_files</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a> = false, <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> = &quot;itemid, filepath, filename&quot;, <a class="var it27119" onMouseOver="hilite(27119)" onMouseOut="lolite()" onClick="logVariable('includedirs')" href="../../_variables/includedirs.html">$includedirs</a> = true) {
<a name="l794"><span class="linenum"> 794</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l795"><span class="linenum"> 795</span></a>  
<a name="l796"><span class="linenum"> 796</span></a>          <a class="var it1217" onMouseOver="hilite(1217)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a> = array('contextid'=&gt;<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, 'component'=&gt;<a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, 'filearea'=&gt;<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>);
<a name="l797"><span class="linenum"> 797</span></a>          if (<a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a> !== false) {
<a name="l798"><span class="linenum"> 798</span></a>              <a class="var it25615" onMouseOver="hilite(25615)" onMouseOut="lolite()" onClick="logVariable('itemidsql')" href="../../_variables/itemidsql.html">$itemidsql</a> = ' AND f.itemid = :itemid ';
<a name="l799"><span class="linenum"> 799</span></a>              <a class="var it1217" onMouseOver="hilite(1217)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a>['itemid'] = <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>;
<a name="l800"><span class="linenum"> 800</span></a>          } else {
<a name="l801"><span class="linenum"> 801</span></a>              <a class="var it25615" onMouseOver="hilite(25615)" onMouseOut="lolite()" onClick="logVariable('itemidsql')" href="../../_variables/itemidsql.html">$itemidsql</a> = '';
<a name="l802"><span class="linenum"> 802</span></a>          }
<a name="l803"><span class="linenum"> 803</span></a>  
<a name="l804"><span class="linenum"> 804</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT &quot;.self::<a class="function" onClick="logFunction('instance_sql_fields')" href="../../_functions/instance_sql_fields.html" onMouseOver="funcPopup(event,'instance_sql_fields')">instance_sql_fields</a>('f', 'r').&quot;
<a name="l805"><span class="linenum"> 805</span></a>                    FROM {files} f
<a name="l806"><span class="linenum"> 806</span></a>               LEFT JOIN {files_reference} r
<a name="l807"><span class="linenum"> 807</span></a>                         ON f.referencefileid = r.id
<a name="l808"><span class="linenum"> 808</span></a>                   WHERE f.contextid = :contextid
<a name="l809"><span class="linenum"> 809</span></a>                         AND f.component = :component
<a name="l810"><span class="linenum"> 810</span></a>                         AND f.filearea = :filearea
<a name="l811"><span class="linenum"> 811</span></a>                         <a class="var it25615" onMouseOver="hilite(25615)" onMouseOut="lolite()" onClick="logVariable('itemidsql')" href="../../_variables/itemidsql.html">$itemidsql</a>&quot;;
<a name="l812"><span class="linenum"> 812</span></a>          if (!empty(<a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a>)) {
<a name="l813"><span class="linenum"> 813</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> .= &quot; ORDER BY {<a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a>}&quot;;
<a name="l814"><span class="linenum"> 814</span></a>          }
<a name="l815"><span class="linenum"> 815</span></a>  
<a name="l816"><span class="linenum"> 816</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = array();
<a name="l817"><span class="linenum"> 817</span></a>          <a class="var it27118" onMouseOver="hilite(27118)" onMouseOut="lolite()" onClick="logVariable('filerecords')" href="../../_variables/filerecords.html">$filerecords</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it1217" onMouseOver="hilite(1217)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a>);
<a name="l818"><span class="linenum"> 818</span></a>          foreach (<a class="var it27118" onMouseOver="hilite(27118)" onMouseOut="lolite()" onClick="logVariable('filerecords')" href="../../_variables/filerecords.html">$filerecords</a> as <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>) {
<a name="l819"><span class="linenum"> 819</span></a>              if (!<a class="var it27119" onMouseOver="hilite(27119)" onMouseOut="lolite()" onClick="logVariable('includedirs')" href="../../_variables/includedirs.html">$includedirs</a> and <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filename')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a> === '.') {
<a name="l820"><span class="linenum"> 820</span></a>                  continue;
<a name="l821"><span class="linenum"> 821</span></a>              }
<a name="l822"><span class="linenum"> 822</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>[<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('pathnamehash')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/pathnamehash.html">pathnamehash</a>] = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_instance')" href="../../_functions/get_file_instance.html" onMouseOver="funcPopup(event,'get_file_instance')">get_file_instance</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>);
<a name="l823"><span class="linenum"> 823</span></a>          }
<a name="l824"><span class="linenum"> 824</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l825"><span class="linenum"> 825</span></a>      }
<a name="l826"><span class="linenum"> 826</span></a>  
<a name="l827"><span class="linenum"> 827</span></a>      <span class="comment">/**</span>
<a name="l828"><span class="linenum"> 828</span></a>  <span class="comment">     * Returns array based tree structure of area files</span>
<a name="l829"><span class="linenum"> 829</span></a>  <span class="comment">     *</span>
<a name="l830"><span class="linenum"> 830</span></a>  <span class="comment">     * @param int $contextid context ID</span>
<a name="l831"><span class="linenum"> 831</span></a>  <span class="comment">     * @param string $component component</span>
<a name="l832"><span class="linenum"> 832</span></a>  <span class="comment">     * @param string $filearea file area</span>
<a name="l833"><span class="linenum"> 833</span></a>  <span class="comment">     * @param int $itemid item ID</span>
<a name="l834"><span class="linenum"> 834</span></a>  <span class="comment">     * @return array each dir represented by dirname, subdirs, files and dirfile array elements</span>
<a name="l835"><span class="linenum"> 835</span></a>  <span class="comment">     */</span>
<a name="l836"><span class="linenum"> 836</span></a>      public function <a class="function" onClick="logFunction('get_area_tree')" href="../../_functions/get_area_tree.html" onMouseOver="funcPopup(event,'get_area_tree')">get_area_tree</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>) {
<a name="l837"><span class="linenum"> 837</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = array('dirname'=&gt;'', 'dirfile'=&gt;null, 'subdirs'=&gt;array(), 'files'=&gt;array());
<a name="l838"><span class="linenum"> 838</span></a>          <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_area_files')" href="../../_functions/get_area_files.html" onMouseOver="funcPopup(event,'get_area_files')">get_area_files</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, '', true);
<a name="l839"><span class="linenum"> 839</span></a>  <span class="comment">        // first create directory structure</span>
<a name="l840"><span class="linenum"> 840</span></a>          foreach (<a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a> as <a class="var it928" onMouseOver="hilite(928)" onMouseOut="lolite()" onClick="logVariable('hash')" href="../../_variables/hash.html">$hash</a>=&gt;<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a>) {
<a name="l841"><span class="linenum"> 841</span></a>              if (!<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a>-&gt;<a class="function" onClick="logFunction('is_directory')" href="../../_functions/is_directory.html" onMouseOver="funcPopup(event,'is_directory')">is_directory</a>()) {
<a name="l842"><span class="linenum"> 842</span></a>                  continue;
<a name="l843"><span class="linenum"> 843</span></a>              }
<a name="l844"><span class="linenum"> 844</span></a>              unset(<a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a>[<a class="var it928" onMouseOver="hilite(928)" onMouseOut="lolite()" onClick="logVariable('hash')" href="../../_variables/hash.html">$hash</a>]);
<a name="l845"><span class="linenum"> 845</span></a>              if (<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a>-&gt;<a class="function" onClick="logFunction('get_filepath')" href="../../_functions/get_filepath.html" onMouseOver="funcPopup(event,'get_filepath')">get_filepath</a>() === '/') {
<a name="l846"><span class="linenum"> 846</span></a>                  <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>['dirfile'] = <a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a>;
<a name="l847"><span class="linenum"> 847</span></a>                  continue;
<a name="l848"><span class="linenum"> 848</span></a>              }
<a name="l849"><span class="linenum"> 849</span></a>              <a class="var it1412" onMouseOver="hilite(1412)" onMouseOut="lolite()" onClick="logVariable('parts')" href="../../_variables/parts.html">$parts</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>('/', <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a>-&gt;<a class="function" onClick="logFunction('get_filepath')" href="../../_functions/get_filepath.html" onMouseOver="funcPopup(event,'get_filepath')">get_filepath</a>(),'/'));
<a name="l850"><span class="linenum"> 850</span></a>              <a class="var it22207" onMouseOver="hilite(22207)" onMouseOut="lolite()" onClick="logVariable('pointer')" href="../../_variables/pointer.html">$pointer</a> =&amp; <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l851"><span class="linenum"> 851</span></a>              foreach (<a class="var it1412" onMouseOver="hilite(1412)" onMouseOut="lolite()" onClick="logVariable('parts')" href="../../_variables/parts.html">$parts</a> as <a class="var it2545" onMouseOver="hilite(2545)" onMouseOut="lolite()" onClick="logVariable('part')" href="../../_variables/part.html">$part</a>) {
<a name="l852"><span class="linenum"> 852</span></a>                  if (<a class="var it2545" onMouseOver="hilite(2545)" onMouseOut="lolite()" onClick="logVariable('part')" href="../../_variables/part.html">$part</a> === '') {
<a name="l853"><span class="linenum"> 853</span></a>                      continue;
<a name="l854"><span class="linenum"> 854</span></a>                  }
<a name="l855"><span class="linenum"> 855</span></a>                  if (!isset(<a class="var it22207" onMouseOver="hilite(22207)" onMouseOut="lolite()" onClick="logVariable('pointer')" href="../../_variables/pointer.html">$pointer</a>['subdirs'][<a class="var it2545" onMouseOver="hilite(2545)" onMouseOut="lolite()" onClick="logVariable('part')" href="../../_variables/part.html">$part</a>])) {
<a name="l856"><span class="linenum"> 856</span></a>                      <a class="var it22207" onMouseOver="hilite(22207)" onMouseOut="lolite()" onClick="logVariable('pointer')" href="../../_variables/pointer.html">$pointer</a>['subdirs'][<a class="var it2545" onMouseOver="hilite(2545)" onMouseOut="lolite()" onClick="logVariable('part')" href="../../_variables/part.html">$part</a>] = array('dirname'=&gt;<a class="var it2545" onMouseOver="hilite(2545)" onMouseOut="lolite()" onClick="logVariable('part')" href="../../_variables/part.html">$part</a>, 'dirfile'=&gt;null, 'subdirs'=&gt;array(), 'files'=&gt;array());
<a name="l857"><span class="linenum"> 857</span></a>                  }
<a name="l858"><span class="linenum"> 858</span></a>                  <a class="var it22207" onMouseOver="hilite(22207)" onMouseOut="lolite()" onClick="logVariable('pointer')" href="../../_variables/pointer.html">$pointer</a> =&amp; <a class="var it22207" onMouseOver="hilite(22207)" onMouseOut="lolite()" onClick="logVariable('pointer')" href="../../_variables/pointer.html">$pointer</a>['subdirs'][<a class="var it2545" onMouseOver="hilite(2545)" onMouseOut="lolite()" onClick="logVariable('part')" href="../../_variables/part.html">$part</a>];
<a name="l859"><span class="linenum"> 859</span></a>              }
<a name="l860"><span class="linenum"> 860</span></a>              <a class="var it22207" onMouseOver="hilite(22207)" onMouseOut="lolite()" onClick="logVariable('pointer')" href="../../_variables/pointer.html">$pointer</a>['dirfile'] = <a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a>;
<a name="l861"><span class="linenum"> 861</span></a>              unset(<a class="var it22207" onMouseOver="hilite(22207)" onMouseOut="lolite()" onClick="logVariable('pointer')" href="../../_variables/pointer.html">$pointer</a>);
<a name="l862"><span class="linenum"> 862</span></a>          }
<a name="l863"><span class="linenum"> 863</span></a>          foreach (<a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a> as <a class="var it928" onMouseOver="hilite(928)" onMouseOut="lolite()" onClick="logVariable('hash')" href="../../_variables/hash.html">$hash</a>=&gt;<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>) {
<a name="l864"><span class="linenum"> 864</span></a>              <a class="var it1412" onMouseOver="hilite(1412)" onMouseOut="lolite()" onClick="logVariable('parts')" href="../../_variables/parts.html">$parts</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>('/', <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_filepath')" href="../../_functions/get_filepath.html" onMouseOver="funcPopup(event,'get_filepath')">get_filepath</a>(),'/'));
<a name="l865"><span class="linenum"> 865</span></a>              <a class="var it22207" onMouseOver="hilite(22207)" onMouseOut="lolite()" onClick="logVariable('pointer')" href="../../_variables/pointer.html">$pointer</a> =&amp; <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l866"><span class="linenum"> 866</span></a>              foreach (<a class="var it1412" onMouseOver="hilite(1412)" onMouseOut="lolite()" onClick="logVariable('parts')" href="../../_variables/parts.html">$parts</a> as <a class="var it2545" onMouseOver="hilite(2545)" onMouseOut="lolite()" onClick="logVariable('part')" href="../../_variables/part.html">$part</a>) {
<a name="l867"><span class="linenum"> 867</span></a>                  if (<a class="var it2545" onMouseOver="hilite(2545)" onMouseOut="lolite()" onClick="logVariable('part')" href="../../_variables/part.html">$part</a> === '') {
<a name="l868"><span class="linenum"> 868</span></a>                      continue;
<a name="l869"><span class="linenum"> 869</span></a>                  }
<a name="l870"><span class="linenum"> 870</span></a>                  <a class="var it22207" onMouseOver="hilite(22207)" onMouseOut="lolite()" onClick="logVariable('pointer')" href="../../_variables/pointer.html">$pointer</a> =&amp; <a class="var it22207" onMouseOver="hilite(22207)" onMouseOut="lolite()" onClick="logVariable('pointer')" href="../../_variables/pointer.html">$pointer</a>['subdirs'][<a class="var it2545" onMouseOver="hilite(2545)" onMouseOut="lolite()" onClick="logVariable('part')" href="../../_variables/part.html">$part</a>];
<a name="l871"><span class="linenum"> 871</span></a>              }
<a name="l872"><span class="linenum"> 872</span></a>              <a class="var it22207" onMouseOver="hilite(22207)" onMouseOut="lolite()" onClick="logVariable('pointer')" href="../../_variables/pointer.html">$pointer</a>['files'][<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_filename')" href="../../_functions/get_filename.html" onMouseOver="funcPopup(event,'get_filename')">get_filename</a>()] = <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>;
<a name="l873"><span class="linenum"> 873</span></a>              unset(<a class="var it22207" onMouseOver="hilite(22207)" onMouseOut="lolite()" onClick="logVariable('pointer')" href="../../_variables/pointer.html">$pointer</a>);
<a name="l874"><span class="linenum"> 874</span></a>          }
<a name="l875"><span class="linenum"> 875</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('sort_area_tree')" href="../../_functions/sort_area_tree.html" onMouseOver="funcPopup(event,'sort_area_tree')">sort_area_tree</a>(<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>);
<a name="l876"><span class="linenum"> 876</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l877"><span class="linenum"> 877</span></a>      }
<a name="l878"><span class="linenum"> 878</span></a>  
<a name="l879"><span class="linenum"> 879</span></a>      <span class="comment">/**</span>
<a name="l880"><span class="linenum"> 880</span></a>  <span class="comment">     * Sorts the result of {@link file_storage::get_area_tree()}.</span>
<a name="l881"><span class="linenum"> 881</span></a>  <span class="comment">     *</span>
<a name="l882"><span class="linenum"> 882</span></a>  <span class="comment">     * @param array $tree Array of results provided by {@link file_storage::get_area_tree()}</span>
<a name="l883"><span class="linenum"> 883</span></a>  <span class="comment">     * @return array of sorted results</span>
<a name="l884"><span class="linenum"> 884</span></a>  <span class="comment">     */</span>
<a name="l885"><span class="linenum"> 885</span></a>      protected function <a class="function" onClick="logFunction('sort_area_tree')" href="../../_functions/sort_area_tree.html" onMouseOver="funcPopup(event,'sort_area_tree')">sort_area_tree</a>(<a class="var it2105" onMouseOver="hilite(2105)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>) {
<a name="l886"><span class="linenum"> 886</span></a>          foreach (<a class="var it2105" onMouseOver="hilite(2105)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> =&gt; &amp;<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>) {
<a name="l887"><span class="linenum"> 887</span></a>              if (<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> == 'subdirs') {
<a name="l888"><span class="linenum"> 888</span></a>                  <a class="class" onClick="logClass('core_collator')" href="../../_classes/core_collator.html" onMouseOver="classPopup(event,'core_collator')">core_collator</a>::<a class="phpfunction" onClick="logFunction('ksort')" href="../../_functions/ksort.html" onMouseOver="phpfuncPopup(event,'ksort')">ksort</a>(<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>, <a class="class" onClick="logClass('core_collator')" href="../../_classes/core_collator.html" onMouseOver="classPopup(event,'core_collator')">core_collator</a>::SORT_NATURAL);
<a name="l889"><span class="linenum"> 889</span></a>                  foreach (<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> as <a class="var it27120" onMouseOver="hilite(27120)" onMouseOut="lolite()" onClick="logVariable('subdirname')" href="../../_variables/subdirname.html">$subdirname</a> =&gt; &amp;<a class="var it18406" onMouseOver="hilite(18406)" onMouseOut="lolite()" onClick="logVariable('subtree')" href="../../_variables/subtree.html">$subtree</a>) {
<a name="l890"><span class="linenum"> 890</span></a>                      <a class="var it18406" onMouseOver="hilite(18406)" onMouseOut="lolite()" onClick="logVariable('subtree')" href="../../_variables/subtree.html">$subtree</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('sort_area_tree')" href="../../_functions/sort_area_tree.html" onMouseOver="funcPopup(event,'sort_area_tree')">sort_area_tree</a>(<a class="var it18406" onMouseOver="hilite(18406)" onMouseOut="lolite()" onClick="logVariable('subtree')" href="../../_variables/subtree.html">$subtree</a>);
<a name="l891"><span class="linenum"> 891</span></a>                  }
<a name="l892"><span class="linenum"> 892</span></a>              } else if (<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> == 'files') {
<a name="l893"><span class="linenum"> 893</span></a>                  <a class="class" onClick="logClass('core_collator')" href="../../_classes/core_collator.html" onMouseOver="classPopup(event,'core_collator')">core_collator</a>::<a class="phpfunction" onClick="logFunction('ksort')" href="../../_functions/ksort.html" onMouseOver="phpfuncPopup(event,'ksort')">ksort</a>(<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>, <a class="class" onClick="logClass('core_collator')" href="../../_classes/core_collator.html" onMouseOver="classPopup(event,'core_collator')">core_collator</a>::SORT_NATURAL);
<a name="l894"><span class="linenum"> 894</span></a>              }
<a name="l895"><span class="linenum"> 895</span></a>          }
<a name="l896"><span class="linenum"> 896</span></a>          return <a class="var it2105" onMouseOver="hilite(2105)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>;
<a name="l897"><span class="linenum"> 897</span></a>      }
<a name="l898"><span class="linenum"> 898</span></a>  
<a name="l899"><span class="linenum"> 899</span></a>      <span class="comment">/**</span>
<a name="l900"><span class="linenum"> 900</span></a>  <span class="comment">     * Returns all files and optionally directories</span>
<a name="l901"><span class="linenum"> 901</span></a>  <span class="comment">     *</span>
<a name="l902"><span class="linenum"> 902</span></a>  <span class="comment">     * @param int $contextid context ID</span>
<a name="l903"><span class="linenum"> 903</span></a>  <span class="comment">     * @param string $component component</span>
<a name="l904"><span class="linenum"> 904</span></a>  <span class="comment">     * @param string $filearea file area</span>
<a name="l905"><span class="linenum"> 905</span></a>  <span class="comment">     * @param int $itemid item ID</span>
<a name="l906"><span class="linenum"> 906</span></a>  <span class="comment">     * @param int $filepath directory path</span>
<a name="l907"><span class="linenum"> 907</span></a>  <span class="comment">     * @param bool $recursive include all subdirectories</span>
<a name="l908"><span class="linenum"> 908</span></a>  <span class="comment">     * @param bool $includedirs include files and directories</span>
<a name="l909"><span class="linenum"> 909</span></a>  <span class="comment">     * @param string $sort A fragment of SQL to use for sorting</span>
<a name="l910"><span class="linenum"> 910</span></a>  <span class="comment">     * @return array of stored_files indexed by pathanmehash</span>
<a name="l911"><span class="linenum"> 911</span></a>  <span class="comment">     */</span>
<a name="l912"><span class="linenum"> 912</span></a>      public function <a class="function" onClick="logFunction('get_directory_files')" href="../../_functions/get_directory_files.html" onMouseOver="funcPopup(event,'get_directory_files')">get_directory_files</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="var it316" onMouseOver="hilite(316)" onMouseOut="lolite()" onClick="logVariable('recursive')" href="../../_variables/recursive.html">$recursive</a> = false, <a class="var it27119" onMouseOver="hilite(27119)" onMouseOut="lolite()" onClick="logVariable('includedirs')" href="../../_variables/includedirs.html">$includedirs</a> = true, <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> = &quot;filepath, filename&quot;) {
<a name="l913"><span class="linenum"> 913</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l914"><span class="linenum"> 914</span></a>  
<a name="l915"><span class="linenum"> 915</span></a>          if (!<a class="var it6532" onMouseOver="hilite(6532)" onMouseOut="lolite()" onClick="logVariable('directory')" href="../../_variables/directory.html">$directory</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file')" href="../../_functions/get_file.html" onMouseOver="funcPopup(event,'get_file')">get_file</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, '.')) {
<a name="l916"><span class="linenum"> 916</span></a>              return array();
<a name="l917"><span class="linenum"> 917</span></a>          }
<a name="l918"><span class="linenum"> 918</span></a>  
<a name="l919"><span class="linenum"> 919</span></a>          <a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../../_variables/orderby.html">$orderby</a> = (!empty(<a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a>)) ? &quot; ORDER BY {<a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a>}&quot; : '';
<a name="l920"><span class="linenum"> 920</span></a>  
<a name="l921"><span class="linenum"> 921</span></a>          if (<a class="var it316" onMouseOver="hilite(316)" onMouseOut="lolite()" onClick="logVariable('recursive')" href="../../_variables/recursive.html">$recursive</a>) {
<a name="l922"><span class="linenum"> 922</span></a>  
<a name="l923"><span class="linenum"> 923</span></a>              <a class="var it8618" onMouseOver="hilite(8618)" onMouseOut="lolite()" onClick="logVariable('dirs')" href="../../_variables/dirs.html">$dirs</a> = <a class="var it27119" onMouseOver="hilite(27119)" onMouseOut="lolite()" onClick="logVariable('includedirs')" href="../../_variables/includedirs.html">$includedirs</a> ? &quot;&quot; : &quot;AND filename &lt;&gt; '.'&quot;;
<a name="l924"><span class="linenum"> 924</span></a>              <a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('length')" href="../../_variables/length.html">$length</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('strlen')" href="../../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>);
<a name="l925"><span class="linenum"> 925</span></a>  
<a name="l926"><span class="linenum"> 926</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT &quot;.self::<a class="function" onClick="logFunction('instance_sql_fields')" href="../../_functions/instance_sql_fields.html" onMouseOver="funcPopup(event,'instance_sql_fields')">instance_sql_fields</a>('f', 'r').&quot;
<a name="l927"><span class="linenum"> 927</span></a>                        FROM {files} f
<a name="l928"><span class="linenum"> 928</span></a>                   LEFT JOIN {files_reference} r
<a name="l929"><span class="linenum"> 929</span></a>                             ON f.referencefileid = r.id
<a name="l930"><span class="linenum"> 930</span></a>                       WHERE f.contextid = :contextid AND f.component = :component AND f.filearea = :filearea AND f.itemid = :itemid
<a name="l931"><span class="linenum"> 931</span></a>                             AND &quot;.<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_substr')" href="../../_functions/sql_substr.html" onMouseOver="funcPopup(event,'sql_substr')">sql_substr</a>(&quot;f.filepath&quot;, 1, <a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('length')" href="../../_variables/length.html">$length</a>).&quot; = :filepath
<a name="l932"><span class="linenum"> 932</span></a>                             AND f.id &lt;&gt; :dirid
<a name="l933"><span class="linenum"> 933</span></a>                             <a class="var it8618" onMouseOver="hilite(8618)" onMouseOut="lolite()" onClick="logVariable('dirs')" href="../../_variables/dirs.html">$dirs</a>
<a name="l934"><span class="linenum"> 934</span></a>                             <a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../../_variables/orderby.html">$orderby</a>&quot;;
<a name="l935"><span class="linenum"> 935</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('contextid'=&gt;<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, 'component'=&gt;<a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, 'filearea'=&gt;<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, 'itemid'=&gt;<a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, 'filepath'=&gt;<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, 'dirid'=&gt;<a class="var it6532" onMouseOver="hilite(6532)" onMouseOut="lolite()" onClick="logVariable('directory')" href="../../_variables/directory.html">$directory</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>());
<a name="l936"><span class="linenum"> 936</span></a>  
<a name="l937"><span class="linenum"> 937</span></a>              <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a> = array();
<a name="l938"><span class="linenum"> 938</span></a>              <a class="var it8618" onMouseOver="hilite(8618)" onMouseOut="lolite()" onClick="logVariable('dirs')" href="../../_variables/dirs.html">$dirs</a>  = array();
<a name="l939"><span class="linenum"> 939</span></a>              <a class="var it27118" onMouseOver="hilite(27118)" onMouseOut="lolite()" onClick="logVariable('filerecords')" href="../../_variables/filerecords.html">$filerecords</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l940"><span class="linenum"> 940</span></a>              foreach (<a class="var it27118" onMouseOver="hilite(27118)" onMouseOut="lolite()" onClick="logVariable('filerecords')" href="../../_variables/filerecords.html">$filerecords</a> as <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>) {
<a name="l941"><span class="linenum"> 941</span></a>                  if (<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filename')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a> == '.') {
<a name="l942"><span class="linenum"> 942</span></a>                      <a class="var it8618" onMouseOver="hilite(8618)" onMouseOut="lolite()" onClick="logVariable('dirs')" href="../../_variables/dirs.html">$dirs</a>[<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('pathnamehash')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/pathnamehash.html">pathnamehash</a>] = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_instance')" href="../../_functions/get_file_instance.html" onMouseOver="funcPopup(event,'get_file_instance')">get_file_instance</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>);
<a name="l943"><span class="linenum"> 943</span></a>                  } else {
<a name="l944"><span class="linenum"> 944</span></a>                      <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a>[<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('pathnamehash')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/pathnamehash.html">pathnamehash</a>] = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_instance')" href="../../_functions/get_file_instance.html" onMouseOver="funcPopup(event,'get_file_instance')">get_file_instance</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>);
<a name="l945"><span class="linenum"> 945</span></a>                  }
<a name="l946"><span class="linenum"> 946</span></a>              }
<a name="l947"><span class="linenum"> 947</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it8618" onMouseOver="hilite(8618)" onMouseOut="lolite()" onClick="logVariable('dirs')" href="../../_variables/dirs.html">$dirs</a>, <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a>);
<a name="l948"><span class="linenum"> 948</span></a>  
<a name="l949"><span class="linenum"> 949</span></a>          } else {
<a name="l950"><span class="linenum"> 950</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = array();
<a name="l951"><span class="linenum"> 951</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('contextid'=&gt;<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, 'component'=&gt;<a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, 'filearea'=&gt;<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, 'itemid'=&gt;<a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, 'filepath'=&gt;<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, 'dirid'=&gt;<a class="var it6532" onMouseOver="hilite(6532)" onMouseOut="lolite()" onClick="logVariable('directory')" href="../../_variables/directory.html">$directory</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>());
<a name="l952"><span class="linenum"> 952</span></a>  
<a name="l953"><span class="linenum"> 953</span></a>              <a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('length')" href="../../_variables/length.html">$length</a> = <a class="class" onClick="logClass('core_text')" href="../../_classes/core_text.html" onMouseOver="classPopup(event,'core_text')">core_text</a>::<a class="function" onClick="logFunction('strlen')" href="../../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>);
<a name="l954"><span class="linenum"> 954</span></a>  
<a name="l955"><span class="linenum"> 955</span></a>              if (<a class="var it27119" onMouseOver="hilite(27119)" onMouseOut="lolite()" onClick="logVariable('includedirs')" href="../../_variables/includedirs.html">$includedirs</a>) {
<a name="l956"><span class="linenum"> 956</span></a>                  <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT &quot;.self::<a class="function" onClick="logFunction('instance_sql_fields')" href="../../_functions/instance_sql_fields.html" onMouseOver="funcPopup(event,'instance_sql_fields')">instance_sql_fields</a>('f', 'r').&quot;
<a name="l957"><span class="linenum"> 957</span></a>                            FROM {files} f
<a name="l958"><span class="linenum"> 958</span></a>                       LEFT JOIN {files_reference} r
<a name="l959"><span class="linenum"> 959</span></a>                                 ON f.referencefileid = r.id
<a name="l960"><span class="linenum"> 960</span></a>                           WHERE f.contextid = :contextid AND f.component = :component AND f.filearea = :filearea
<a name="l961"><span class="linenum"> 961</span></a>                                 AND f.itemid = :itemid AND f.filename = '.'
<a name="l962"><span class="linenum"> 962</span></a>                                 AND &quot;.<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_substr')" href="../../_functions/sql_substr.html" onMouseOver="funcPopup(event,'sql_substr')">sql_substr</a>(&quot;f.filepath&quot;, 1, <a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('length')" href="../../_variables/length.html">$length</a>).&quot; = :filepath
<a name="l963"><span class="linenum"> 963</span></a>                                 AND f.id &lt;&gt; :dirid
<a name="l964"><span class="linenum"> 964</span></a>                                 <a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../../_variables/orderby.html">$orderby</a>&quot;;
<a name="l965"><span class="linenum"> 965</span></a>                  <a class="var it27121" onMouseOver="hilite(27121)" onMouseOut="lolite()" onClick="logVariable('reqlevel')" href="../../_variables/reqlevel.html">$reqlevel</a> = <a class="phpfunction" onClick="logFunction('substr_count')" href="../../_functions/substr_count.html" onMouseOver="phpfuncPopup(event,'substr_count')">substr_count</a>(<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, '/') + 1;
<a name="l966"><span class="linenum"> 966</span></a>                  <a class="var it27118" onMouseOver="hilite(27118)" onMouseOut="lolite()" onClick="logVariable('filerecords')" href="../../_variables/filerecords.html">$filerecords</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l967"><span class="linenum"> 967</span></a>                  foreach (<a class="var it27118" onMouseOver="hilite(27118)" onMouseOut="lolite()" onClick="logVariable('filerecords')" href="../../_variables/filerecords.html">$filerecords</a> as <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>) {
<a name="l968"><span class="linenum"> 968</span></a>                      if (<a class="phpfunction" onClick="logFunction('substr_count')" href="../../_functions/substr_count.html" onMouseOver="phpfuncPopup(event,'substr_count')">substr_count</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>, '/') !== <a class="var it27121" onMouseOver="hilite(27121)" onMouseOut="lolite()" onClick="logVariable('reqlevel')" href="../../_variables/reqlevel.html">$reqlevel</a>) {
<a name="l969"><span class="linenum"> 969</span></a>                          continue;
<a name="l970"><span class="linenum"> 970</span></a>                      }
<a name="l971"><span class="linenum"> 971</span></a>                      <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>[<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('pathnamehash')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/pathnamehash.html">pathnamehash</a>] = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_instance')" href="../../_functions/get_file_instance.html" onMouseOver="funcPopup(event,'get_file_instance')">get_file_instance</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>);
<a name="l972"><span class="linenum"> 972</span></a>                  }
<a name="l973"><span class="linenum"> 973</span></a>              }
<a name="l974"><span class="linenum"> 974</span></a>  
<a name="l975"><span class="linenum"> 975</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT &quot;.self::<a class="function" onClick="logFunction('instance_sql_fields')" href="../../_functions/instance_sql_fields.html" onMouseOver="funcPopup(event,'instance_sql_fields')">instance_sql_fields</a>('f', 'r').&quot;
<a name="l976"><span class="linenum"> 976</span></a>                        FROM {files} f
<a name="l977"><span class="linenum"> 977</span></a>                   LEFT JOIN {files_reference} r
<a name="l978"><span class="linenum"> 978</span></a>                             ON f.referencefileid = r.id
<a name="l979"><span class="linenum"> 979</span></a>                       WHERE f.contextid = :contextid AND f.component = :component AND f.filearea = :filearea AND f.itemid = :itemid
<a name="l980"><span class="linenum"> 980</span></a>                             AND f.filepath = :filepath AND f.filename &lt;&gt; '.'
<a name="l981"><span class="linenum"> 981</span></a>                             <a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../../_variables/orderby.html">$orderby</a>&quot;;
<a name="l982"><span class="linenum"> 982</span></a>  
<a name="l983"><span class="linenum"> 983</span></a>              <a class="var it27118" onMouseOver="hilite(27118)" onMouseOut="lolite()" onClick="logVariable('filerecords')" href="../../_variables/filerecords.html">$filerecords</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l984"><span class="linenum"> 984</span></a>              foreach (<a class="var it27118" onMouseOver="hilite(27118)" onMouseOut="lolite()" onClick="logVariable('filerecords')" href="../../_variables/filerecords.html">$filerecords</a> as <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>) {
<a name="l985"><span class="linenum"> 985</span></a>                  <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>[<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('pathnamehash')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/pathnamehash.html">pathnamehash</a>] = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_instance')" href="../../_functions/get_file_instance.html" onMouseOver="funcPopup(event,'get_file_instance')">get_file_instance</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>);
<a name="l986"><span class="linenum"> 986</span></a>              }
<a name="l987"><span class="linenum"> 987</span></a>          }
<a name="l988"><span class="linenum"> 988</span></a>  
<a name="l989"><span class="linenum"> 989</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l990"><span class="linenum"> 990</span></a>      }
<a name="l991"><span class="linenum"> 991</span></a>  
<a name="l992"><span class="linenum"> 992</span></a>      <span class="comment">/**</span>
<a name="l993"><span class="linenum"> 993</span></a>  <span class="comment">     * Delete all area files (optionally limited by itemid).</span>
<a name="l994"><span class="linenum"> 994</span></a>  <span class="comment">     *</span>
<a name="l995"><span class="linenum"> 995</span></a>  <span class="comment">     * @param int $contextid context ID</span>
<a name="l996"><span class="linenum"> 996</span></a>  <span class="comment">     * @param string $component component</span>
<a name="l997"><span class="linenum"> 997</span></a>  <span class="comment">     * @param string $filearea file area or all areas in context if not specified</span>
<a name="l998"><span class="linenum"> 998</span></a>  <span class="comment">     * @param int $itemid item ID or all files if not specified</span>
<a name="l999"><span class="linenum"> 999</span></a>  <span class="comment">     * @return bool success</span>
<a name="l1000"><span class="linenum">1000</span></a>  <span class="comment">     */</span>
<a name="l1001"><span class="linenum">1001</span></a>      public function <a class="function" onClick="logFunction('delete_area_files')" href="../../_functions/delete_area_files.html" onMouseOver="funcPopup(event,'delete_area_files')">delete_area_files</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a> = false, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a> = false, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a> = false) {
<a name="l1002"><span class="linenum">1002</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1003"><span class="linenum">1003</span></a>  
<a name="l1004"><span class="linenum">1004</span></a>          <a class="var it1217" onMouseOver="hilite(1217)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a> = array('contextid'=&gt;<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>);
<a name="l1005"><span class="linenum">1005</span></a>          if (<a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a> !== false) {
<a name="l1006"><span class="linenum">1006</span></a>              <a class="var it1217" onMouseOver="hilite(1217)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a>['component'] = <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>;
<a name="l1007"><span class="linenum">1007</span></a>          }
<a name="l1008"><span class="linenum">1008</span></a>          if (<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a> !== false) {
<a name="l1009"><span class="linenum">1009</span></a>              <a class="var it1217" onMouseOver="hilite(1217)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a>['filearea'] = <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>;
<a name="l1010"><span class="linenum">1010</span></a>          }
<a name="l1011"><span class="linenum">1011</span></a>          if (<a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a> !== false) {
<a name="l1012"><span class="linenum">1012</span></a>              <a class="var it1217" onMouseOver="hilite(1217)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a>['itemid'] = <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>;
<a name="l1013"><span class="linenum">1013</span></a>          }
<a name="l1014"><span class="linenum">1014</span></a>  
<a name="l1015"><span class="linenum">1015</span></a>          <a class="var it27118" onMouseOver="hilite(27118)" onMouseOut="lolite()" onClick="logVariable('filerecords')" href="../../_variables/filerecords.html">$filerecords</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('files', <a class="var it1217" onMouseOver="hilite(1217)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../_variables/conditions.html">$conditions</a>);
<a name="l1016"><span class="linenum">1016</span></a>          foreach (<a class="var it27118" onMouseOver="hilite(27118)" onMouseOut="lolite()" onClick="logVariable('filerecords')" href="../../_variables/filerecords.html">$filerecords</a> as <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>) {
<a name="l1017"><span class="linenum">1017</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_instance')" href="../../_functions/get_file_instance.html" onMouseOver="funcPopup(event,'get_file_instance')">get_file_instance</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>)-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l1018"><span class="linenum">1018</span></a>          }
<a name="l1019"><span class="linenum">1019</span></a>  
<a name="l1020"><span class="linenum">1020</span></a>          return true; <span class="comment">// BC only</span>
<a name="l1021"><span class="linenum">1021</span></a>      }
<a name="l1022"><span class="linenum">1022</span></a>  
<a name="l1023"><span class="linenum">1023</span></a>      <span class="comment">/**</span>
<a name="l1024"><span class="linenum">1024</span></a>  <span class="comment">     * Delete all the files from certain areas where itemid is limited by an</span>
<a name="l1025"><span class="linenum">1025</span></a>  <span class="comment">     * arbitrary bit of SQL.</span>
<a name="l1026"><span class="linenum">1026</span></a>  <span class="comment">     *</span>
<a name="l1027"><span class="linenum">1027</span></a>  <span class="comment">     * @param int $contextid the id of the context the files belong to. Must be given.</span>
<a name="l1028"><span class="linenum">1028</span></a>  <span class="comment">     * @param string $component the owning component. Must be given.</span>
<a name="l1029"><span class="linenum">1029</span></a>  <span class="comment">     * @param string $filearea the file area name. Must be given.</span>
<a name="l1030"><span class="linenum">1030</span></a>  <span class="comment">     * @param string $itemidstest an SQL fragment that the itemid must match. Used</span>
<a name="l1031"><span class="linenum">1031</span></a>  <span class="comment">     *      in the query like WHERE itemid $itemidstest. Must used named parameters,</span>
<a name="l1032"><span class="linenum">1032</span></a>  <span class="comment">     *      and may not used named parameters called contextid, component or filearea.</span>
<a name="l1033"><span class="linenum">1033</span></a>  <span class="comment">     * @param array $params any query params used by $itemidstest.</span>
<a name="l1034"><span class="linenum">1034</span></a>  <span class="comment">     */</span>
<a name="l1035"><span class="linenum">1035</span></a>      public function <a class="function" onClick="logFunction('delete_area_files_select')" href="../../_functions/delete_area_files_select.html" onMouseOver="funcPopup(event,'delete_area_files_select')">delete_area_files_select</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>,
<a name="l1036"><span class="linenum">1036</span></a>              <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it9228" onMouseOver="hilite(9228)" onMouseOut="lolite()" onClick="logVariable('itemidstest')" href="../../_variables/itemidstest.html">$itemidstest</a>, array <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = null) {
<a name="l1037"><span class="linenum">1037</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1038"><span class="linenum">1038</span></a>  
<a name="l1039"><span class="linenum">1039</span></a>          <a class="var it3091" onMouseOver="hilite(3091)" onMouseOut="lolite()" onClick="logVariable('where')" href="../../_variables/where.html">$where</a> = &quot;contextid = :contextid
<a name="l1040"><span class="linenum">1040</span></a>                  AND component = :component
<a name="l1041"><span class="linenum">1041</span></a>                  AND filearea = :filearea
<a name="l1042"><span class="linenum">1042</span></a>                  AND itemid <a class="var it9228" onMouseOver="hilite(9228)" onMouseOut="lolite()" onClick="logVariable('itemidstest')" href="../../_variables/itemidstest.html">$itemidstest</a>&quot;;
<a name="l1043"><span class="linenum">1043</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['contextid'] = <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>;
<a name="l1044"><span class="linenum">1044</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['component'] = <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>;
<a name="l1045"><span class="linenum">1045</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['filearea'] = <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>;
<a name="l1046"><span class="linenum">1046</span></a>  
<a name="l1047"><span class="linenum">1047</span></a>          <a class="var it27118" onMouseOver="hilite(27118)" onMouseOut="lolite()" onClick="logVariable('filerecords')" href="../../_variables/filerecords.html">$filerecords</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_select')" href="../../_functions/get_recordset_select.html" onMouseOver="funcPopup(event,'get_recordset_select')">get_recordset_select</a>('files', <a class="var it3091" onMouseOver="hilite(3091)" onMouseOut="lolite()" onClick="logVariable('where')" href="../../_variables/where.html">$where</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l1048"><span class="linenum">1048</span></a>          foreach (<a class="var it27118" onMouseOver="hilite(27118)" onMouseOut="lolite()" onClick="logVariable('filerecords')" href="../../_variables/filerecords.html">$filerecords</a> as <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>) {
<a name="l1049"><span class="linenum">1049</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_instance')" href="../../_functions/get_file_instance.html" onMouseOver="funcPopup(event,'get_file_instance')">get_file_instance</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>)-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l1050"><span class="linenum">1050</span></a>          }
<a name="l1051"><span class="linenum">1051</span></a>          <a class="var it27118" onMouseOver="hilite(27118)" onMouseOut="lolite()" onClick="logVariable('filerecords')" href="../../_variables/filerecords.html">$filerecords</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l1052"><span class="linenum">1052</span></a>      }
<a name="l1053"><span class="linenum">1053</span></a>  
<a name="l1054"><span class="linenum">1054</span></a>      <span class="comment">/**</span>
<a name="l1055"><span class="linenum">1055</span></a>  <span class="comment">     * Delete all files associated with the given component.</span>
<a name="l1056"><span class="linenum">1056</span></a>  <span class="comment">     *</span>
<a name="l1057"><span class="linenum">1057</span></a>  <span class="comment">     * @param string $component the component owning the file</span>
<a name="l1058"><span class="linenum">1058</span></a>  <span class="comment">     */</span>
<a name="l1059"><span class="linenum">1059</span></a>      public function <a class="function" onClick="logFunction('delete_component_files')" href="../../_functions/delete_component_files.html" onMouseOver="funcPopup(event,'delete_component_files')">delete_component_files</a>(<a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>) {
<a name="l1060"><span class="linenum">1060</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1061"><span class="linenum">1061</span></a>  
<a name="l1062"><span class="linenum">1062</span></a>          <a class="var it27118" onMouseOver="hilite(27118)" onMouseOut="lolite()" onClick="logVariable('filerecords')" href="../../_variables/filerecords.html">$filerecords</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset')" href="../../_functions/get_recordset.html" onMouseOver="funcPopup(event,'get_recordset')">get_recordset</a>('files', array('component' =&gt; <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>));
<a name="l1063"><span class="linenum">1063</span></a>          foreach (<a class="var it27118" onMouseOver="hilite(27118)" onMouseOut="lolite()" onClick="logVariable('filerecords')" href="../../_variables/filerecords.html">$filerecords</a> as <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>) {
<a name="l1064"><span class="linenum">1064</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_instance')" href="../../_functions/get_file_instance.html" onMouseOver="funcPopup(event,'get_file_instance')">get_file_instance</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>)-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l1065"><span class="linenum">1065</span></a>          }
<a name="l1066"><span class="linenum">1066</span></a>          <a class="var it27118" onMouseOver="hilite(27118)" onMouseOut="lolite()" onClick="logVariable('filerecords')" href="../../_variables/filerecords.html">$filerecords</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l1067"><span class="linenum">1067</span></a>      }
<a name="l1068"><span class="linenum">1068</span></a>  
<a name="l1069"><span class="linenum">1069</span></a>      <span class="comment">/**</span>
<a name="l1070"><span class="linenum">1070</span></a>  <span class="comment">     * Move all the files in a file area from one context to another.</span>
<a name="l1071"><span class="linenum">1071</span></a>  <span class="comment">     *</span>
<a name="l1072"><span class="linenum">1072</span></a>  <span class="comment">     * @param int $oldcontextid the context the files are being moved from.</span>
<a name="l1073"><span class="linenum">1073</span></a>  <span class="comment">     * @param int $newcontextid the context the files are being moved to.</span>
<a name="l1074"><span class="linenum">1074</span></a>  <span class="comment">     * @param string $component the plugin that these files belong to.</span>
<a name="l1075"><span class="linenum">1075</span></a>  <span class="comment">     * @param string $filearea the name of the file area.</span>
<a name="l1076"><span class="linenum">1076</span></a>  <span class="comment">     * @param int $itemid file item ID</span>
<a name="l1077"><span class="linenum">1077</span></a>  <span class="comment">     * @return int the number of files moved, for information.</span>
<a name="l1078"><span class="linenum">1078</span></a>  <span class="comment">     */</span>
<a name="l1079"><span class="linenum">1079</span></a>      public function <a class="function" onClick="logFunction('move_area_files_to_new_context')" href="../../_functions/move_area_files_to_new_context.html" onMouseOver="funcPopup(event,'move_area_files_to_new_context')">move_area_files_to_new_context</a>(<a class="var it5968" onMouseOver="hilite(5968)" onMouseOut="lolite()" onClick="logVariable('oldcontextid')" href="../../_variables/oldcontextid.html">$oldcontextid</a>, <a class="var it5969" onMouseOver="hilite(5969)" onMouseOut="lolite()" onClick="logVariable('newcontextid')" href="../../_variables/newcontextid.html">$newcontextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a> = false) {
<a name="l1080"><span class="linenum">1080</span></a>  <span class="comment">        // Note, this code is based on some code that Petr wrote in</span>
<a name="l1081"><span class="linenum">1081</span></a>  <span class="comment">        // forum_move_attachments in mod/forum/lib.php. I moved it here because</span>
<a name="l1082"><span class="linenum">1082</span></a>  <span class="comment">        // I needed it in the question code too.</span>
<a name="l1083"><span class="linenum">1083</span></a>          <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> = 0;
<a name="l1084"><span class="linenum">1084</span></a>  
<a name="l1085"><span class="linenum">1085</span></a>          <a class="var it9431" onMouseOver="hilite(9431)" onMouseOut="lolite()" onClick="logVariable('oldfiles')" href="../../_variables/oldfiles.html">$oldfiles</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_area_files')" href="../../_functions/get_area_files.html" onMouseOver="funcPopup(event,'get_area_files')">get_area_files</a>(<a class="var it5968" onMouseOver="hilite(5968)" onMouseOut="lolite()" onClick="logVariable('oldcontextid')" href="../../_variables/oldcontextid.html">$oldcontextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, 'id', false);
<a name="l1086"><span class="linenum">1086</span></a>          foreach (<a class="var it9431" onMouseOver="hilite(9431)" onMouseOut="lolite()" onClick="logVariable('oldfiles')" href="../../_variables/oldfiles.html">$oldfiles</a> as <a class="var it9434" onMouseOver="hilite(9434)" onMouseOut="lolite()" onClick="logVariable('oldfile')" href="../../_variables/oldfile.html">$oldfile</a>) {
<a name="l1087"><span class="linenum">1087</span></a>              <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a> = new stdClass();
<a name="l1088"><span class="linenum">1088</span></a>              <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a> = <a class="var it5969" onMouseOver="hilite(5969)" onMouseOut="lolite()" onClick="logVariable('newcontextid')" href="../../_variables/newcontextid.html">$newcontextid</a>;
<a name="l1089"><span class="linenum">1089</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('create_file_from_storedfile')" href="../../_functions/create_file_from_storedfile.html" onMouseOver="funcPopup(event,'create_file_from_storedfile')">create_file_from_storedfile</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>, <a class="var it9434" onMouseOver="hilite(9434)" onMouseOut="lolite()" onClick="logVariable('oldfile')" href="../../_variables/oldfile.html">$oldfile</a>);
<a name="l1090"><span class="linenum">1090</span></a>              <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> += 1;
<a name="l1091"><span class="linenum">1091</span></a>          }
<a name="l1092"><span class="linenum">1092</span></a>  
<a name="l1093"><span class="linenum">1093</span></a>          if (<a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a>) {
<a name="l1094"><span class="linenum">1094</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('delete_area_files')" href="../../_functions/delete_area_files.html" onMouseOver="funcPopup(event,'delete_area_files')">delete_area_files</a>(<a class="var it5968" onMouseOver="hilite(5968)" onMouseOut="lolite()" onClick="logVariable('oldcontextid')" href="../../_variables/oldcontextid.html">$oldcontextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>);
<a name="l1095"><span class="linenum">1095</span></a>          }
<a name="l1096"><span class="linenum">1096</span></a>  
<a name="l1097"><span class="linenum">1097</span></a>          return <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a>;
<a name="l1098"><span class="linenum">1098</span></a>      }
<a name="l1099"><span class="linenum">1099</span></a>  
<a name="l1100"><span class="linenum">1100</span></a>      <span class="comment">/**</span>
<a name="l1101"><span class="linenum">1101</span></a>  <span class="comment">     * Recursively creates directory.</span>
<a name="l1102"><span class="linenum">1102</span></a>  <span class="comment">     *</span>
<a name="l1103"><span class="linenum">1103</span></a>  <span class="comment">     * @param int $contextid context ID</span>
<a name="l1104"><span class="linenum">1104</span></a>  <span class="comment">     * @param string $component component</span>
<a name="l1105"><span class="linenum">1105</span></a>  <span class="comment">     * @param string $filearea file area</span>
<a name="l1106"><span class="linenum">1106</span></a>  <span class="comment">     * @param int $itemid item ID</span>
<a name="l1107"><span class="linenum">1107</span></a>  <span class="comment">     * @param string $filepath file path</span>
<a name="l1108"><span class="linenum">1108</span></a>  <span class="comment">     * @param int $userid the user ID</span>
<a name="l1109"><span class="linenum">1109</span></a>  <span class="comment">     * @return bool success</span>
<a name="l1110"><span class="linenum">1110</span></a>  <span class="comment">     */</span>
<a name="l1111"><span class="linenum">1111</span></a>      public function <a class="function" onClick="logFunction('create_directory')" href="../../_functions/create_directory.html" onMouseOver="funcPopup(event,'create_directory')">create_directory</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> = null) {
<a name="l1112"><span class="linenum">1112</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1113"><span class="linenum">1113</span></a>  
<a name="l1114"><span class="linenum">1114</span></a>  <span class="comment">        // validate all parameters, we do not want any rubbish stored in database, right?</span>
<a name="l1115"><span class="linenum">1115</span></a>          if (!<a class="function" onClick="logFunction('is_number')" href="../../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>) or <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a> &lt; 1) {
<a name="l1116"><span class="linenum">1116</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid contextid');
<a name="l1117"><span class="linenum">1117</span></a>          }
<a name="l1118"><span class="linenum">1118</span></a>  
<a name="l1119"><span class="linenum">1119</span></a>          <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, <a class="constant" onClick="logConstant('PARAM_COMPONENT')" href="../../_constants/PARAM_COMPONENT.html" onMouseOver="constPopup(event,'PARAM_COMPONENT')">PARAM_COMPONENT</a>);
<a name="l1120"><span class="linenum">1120</span></a>          if (empty(<a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>)) {
<a name="l1121"><span class="linenum">1121</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid component');
<a name="l1122"><span class="linenum">1122</span></a>          }
<a name="l1123"><span class="linenum">1123</span></a>  
<a name="l1124"><span class="linenum">1124</span></a>          <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="constant" onClick="logConstant('PARAM_AREA')" href="../../_constants/PARAM_AREA.html" onMouseOver="constPopup(event,'PARAM_AREA')">PARAM_AREA</a>);
<a name="l1125"><span class="linenum">1125</span></a>          if (empty(<a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>)) {
<a name="l1126"><span class="linenum">1126</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid filearea');
<a name="l1127"><span class="linenum">1127</span></a>          }
<a name="l1128"><span class="linenum">1128</span></a>  
<a name="l1129"><span class="linenum">1129</span></a>          if (!<a class="function" onClick="logFunction('is_number')" href="../../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>(<a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>) or <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a> &lt; 0) {
<a name="l1130"><span class="linenum">1130</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid itemid');
<a name="l1131"><span class="linenum">1131</span></a>          }
<a name="l1132"><span class="linenum">1132</span></a>  
<a name="l1133"><span class="linenum">1133</span></a>          <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="constant" onClick="logConstant('PARAM_PATH')" href="../../_constants/PARAM_PATH.html" onMouseOver="constPopup(event,'PARAM_PATH')">PARAM_PATH</a>);
<a name="l1134"><span class="linenum">1134</span></a>          if (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, '/') !== 0 or <a class="phpfunction" onClick="logFunction('strrpos')" href="../../_functions/strrpos.html" onMouseOver="phpfuncPopup(event,'strrpos')">strrpos</a>(<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, '/') !== <a class="function" onClick="logFunction('strlen')" href="../../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>)-1) {
<a name="l1135"><span class="linenum">1135</span></a>  <span class="comment">            // path must start and end with '/'</span>
<a name="l1136"><span class="linenum">1136</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid file path');
<a name="l1137"><span class="linenum">1137</span></a>          }
<a name="l1138"><span class="linenum">1138</span></a>  
<a name="l1139"><span class="linenum">1139</span></a>          <a class="var it14667" onMouseOver="hilite(14667)" onMouseOut="lolite()" onClick="logVariable('pathnamehash')" href="../../_variables/pathnamehash.html">$pathnamehash</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_pathname_hash')" href="../../_functions/get_pathname_hash.html" onMouseOver="funcPopup(event,'get_pathname_hash')">get_pathname_hash</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, '.');
<a name="l1140"><span class="linenum">1140</span></a>  
<a name="l1141"><span class="linenum">1141</span></a>          if (<a class="var it27122" onMouseOver="hilite(27122)" onMouseOut="lolite()" onClick="logVariable('dir_info')" href="../../_variables/dir_info.html">$dir_info</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_by_hash')" href="../../_functions/get_file_by_hash.html" onMouseOver="funcPopup(event,'get_file_by_hash')">get_file_by_hash</a>(<a class="var it14667" onMouseOver="hilite(14667)" onMouseOut="lolite()" onClick="logVariable('pathnamehash')" href="../../_variables/pathnamehash.html">$pathnamehash</a>)) {
<a name="l1142"><span class="linenum">1142</span></a>              return <a class="var it27122" onMouseOver="hilite(27122)" onMouseOut="lolite()" onClick="logVariable('dir_info')" href="../../_variables/dir_info.html">$dir_info</a>;
<a name="l1143"><span class="linenum">1143</span></a>          }
<a name="l1144"><span class="linenum">1144</span></a>  
<a name="l1145"><span class="linenum">1145</span></a>          static <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a> = null;
<a name="l1146"><span class="linenum">1146</span></a>          if (!<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>) {
<a name="l1147"><span class="linenum">1147</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_string_to_pool')" href="../../_functions/add_string_to_pool.html" onMouseOver="funcPopup(event,'add_string_to_pool')">add_string_to_pool</a>('');
<a name="l1148"><span class="linenum">1148</span></a>              <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a> = <a class="phpfunction" onClick="logFunction('sha1')" href="../../_functions/sha1.html" onMouseOver="phpfuncPopup(event,'sha1')">sha1</a>('');
<a name="l1149"><span class="linenum">1149</span></a>          }
<a name="l1150"><span class="linenum">1150</span></a>  
<a name="l1151"><span class="linenum">1151</span></a>          <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1152"><span class="linenum">1152</span></a>  
<a name="l1153"><span class="linenum">1153</span></a>          <a class="var it27123" onMouseOver="hilite(27123)" onMouseOut="lolite()" onClick="logVariable('dir_record')" href="../../_variables/dir_record.html">$dir_record</a> = new stdClass();
<a name="l1154"><span class="linenum">1154</span></a>          <a class="var it27123" onMouseOver="hilite(27123)" onMouseOut="lolite()" onClick="logVariable('dir_record')" href="../../_variables/dir_record.html">$dir_record</a>-&gt;<a onClick="logVariable('contextid')" class="var it45212" onMouseOver="hilite(45212)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a> = <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>;
<a name="l1155"><span class="linenum">1155</span></a>          <a class="var it27123" onMouseOver="hilite(27123)" onMouseOut="lolite()" onClick="logVariable('dir_record')" href="../../_variables/dir_record.html">$dir_record</a>-&gt;<a onClick="logVariable('component')" class="var it45212" onMouseOver="hilite(45212)" onMouseOut="lolite()" href="../../_variables/component.html">component</a> = <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>;
<a name="l1156"><span class="linenum">1156</span></a>          <a class="var it27123" onMouseOver="hilite(27123)" onMouseOut="lolite()" onClick="logVariable('dir_record')" href="../../_variables/dir_record.html">$dir_record</a>-&gt;<a onClick="logVariable('filearea')" class="var it45212" onMouseOver="hilite(45212)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>  = <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>;
<a name="l1157"><span class="linenum">1157</span></a>          <a class="var it27123" onMouseOver="hilite(27123)" onMouseOut="lolite()" onClick="logVariable('dir_record')" href="../../_variables/dir_record.html">$dir_record</a>-&gt;<a onClick="logVariable('itemid')" class="var it45212" onMouseOver="hilite(45212)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>    = <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>;
<a name="l1158"><span class="linenum">1158</span></a>          <a class="var it27123" onMouseOver="hilite(27123)" onMouseOut="lolite()" onClick="logVariable('dir_record')" href="../../_variables/dir_record.html">$dir_record</a>-&gt;<a onClick="logVariable('filepath')" class="var it45212" onMouseOver="hilite(45212)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>  = <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>;
<a name="l1159"><span class="linenum">1159</span></a>          <a class="var it27123" onMouseOver="hilite(27123)" onMouseOut="lolite()" onClick="logVariable('dir_record')" href="../../_variables/dir_record.html">$dir_record</a>-&gt;<a onClick="logVariable('filename')" class="var it45212" onMouseOver="hilite(45212)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a>  = '.';
<a name="l1160"><span class="linenum">1160</span></a>          <a class="var it27123" onMouseOver="hilite(27123)" onMouseOut="lolite()" onClick="logVariable('dir_record')" href="../../_variables/dir_record.html">$dir_record</a>-&gt;<a onClick="logVariable('contenthash')" class="var it45212" onMouseOver="hilite(45212)" onMouseOut="lolite()" href="../../_variables/contenthash.html">contenthash</a>  = <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>;
<a name="l1161"><span class="linenum">1161</span></a>          <a class="var it27123" onMouseOver="hilite(27123)" onMouseOut="lolite()" onClick="logVariable('dir_record')" href="../../_variables/dir_record.html">$dir_record</a>-&gt;<a onClick="logVariable('filesize')" class="var it45212" onMouseOver="hilite(45212)" onMouseOut="lolite()" href="../../_variables/filesize.html">filesize</a>  = 0;
<a name="l1162"><span class="linenum">1162</span></a>  
<a name="l1163"><span class="linenum">1163</span></a>          <a class="var it27123" onMouseOver="hilite(27123)" onMouseOut="lolite()" onClick="logVariable('dir_record')" href="../../_variables/dir_record.html">$dir_record</a>-&gt;<a onClick="logVariable('timecreated')" class="var it45212" onMouseOver="hilite(45212)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a>  = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l1164"><span class="linenum">1164</span></a>          <a class="var it27123" onMouseOver="hilite(27123)" onMouseOut="lolite()" onClick="logVariable('dir_record')" href="../../_variables/dir_record.html">$dir_record</a>-&gt;<a onClick="logVariable('timemodified')" class="var it45212" onMouseOver="hilite(45212)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l1165"><span class="linenum">1165</span></a>          <a class="var it27123" onMouseOver="hilite(27123)" onMouseOut="lolite()" onClick="logVariable('dir_record')" href="../../_variables/dir_record.html">$dir_record</a>-&gt;<a onClick="logVariable('mimetype')" class="var it45212" onMouseOver="hilite(45212)" onMouseOut="lolite()" href="../../_variables/mimetype.html">mimetype</a>     = null;
<a name="l1166"><span class="linenum">1166</span></a>          <a class="var it27123" onMouseOver="hilite(27123)" onMouseOut="lolite()" onClick="logVariable('dir_record')" href="../../_variables/dir_record.html">$dir_record</a>-&gt;<a onClick="logVariable('userid')" class="var it45212" onMouseOver="hilite(45212)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>       = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>;
<a name="l1167"><span class="linenum">1167</span></a>  
<a name="l1168"><span class="linenum">1168</span></a>          <a class="var it27123" onMouseOver="hilite(27123)" onMouseOut="lolite()" onClick="logVariable('dir_record')" href="../../_variables/dir_record.html">$dir_record</a>-&gt;<a onClick="logVariable('pathnamehash')" class="var it45212" onMouseOver="hilite(45212)" onMouseOut="lolite()" href="../../_variables/pathnamehash.html">pathnamehash</a> = <a class="var it14667" onMouseOver="hilite(14667)" onMouseOut="lolite()" onClick="logVariable('pathnamehash')" href="../../_variables/pathnamehash.html">$pathnamehash</a>;
<a name="l1169"><span class="linenum">1169</span></a>  
<a name="l1170"><span class="linenum">1170</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('files', <a class="var it27123" onMouseOver="hilite(27123)" onMouseOut="lolite()" onClick="logVariable('dir_record')" href="../../_variables/dir_record.html">$dir_record</a>);
<a name="l1171"><span class="linenum">1171</span></a>          <a class="var it27122" onMouseOver="hilite(27122)" onMouseOut="lolite()" onClick="logVariable('dir_info')" href="../../_variables/dir_info.html">$dir_info</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_by_hash')" href="../../_functions/get_file_by_hash.html" onMouseOver="funcPopup(event,'get_file_by_hash')">get_file_by_hash</a>(<a class="var it14667" onMouseOver="hilite(14667)" onMouseOut="lolite()" onClick="logVariable('pathnamehash')" href="../../_variables/pathnamehash.html">$pathnamehash</a>);
<a name="l1172"><span class="linenum">1172</span></a>  
<a name="l1173"><span class="linenum">1173</span></a>          if (<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a> !== '/') {
<a name="l1174"><span class="linenum">1174</span></a>  <span class="comment">            //recurse to parent dirs</span>
<a name="l1175"><span class="linenum">1175</span></a>              <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, '/');
<a name="l1176"><span class="linenum">1176</span></a>              <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>('/', <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>);
<a name="l1177"><span class="linenum">1177</span></a>              <a class="phpfunction" onClick="logFunction('array_pop')" href="../../_functions/array_pop.html" onMouseOver="phpfuncPopup(event,'array_pop')">array_pop</a>(<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>);
<a name="l1178"><span class="linenum">1178</span></a>              <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>('/', <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>);
<a name="l1179"><span class="linenum">1179</span></a>              <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a> = (<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a> === '') ? '/' : &quot;/<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>/&quot;;
<a name="l1180"><span class="linenum">1180</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('create_directory')" href="../../_functions/create_directory.html" onMouseOver="funcPopup(event,'create_directory')">create_directory</a>(<a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>, <a class="var it227" onMouseOver="hilite(227)" onMouseOut="lolite()" onClick="logVariable('component')" href="../../_variables/component.html">$component</a>, <a class="var it24" onMouseOver="hilite(24)" onMouseOut="lolite()" onClick="logVariable('filearea')" href="../../_variables/filearea.html">$filearea</a>, <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>);
<a name="l1181"><span class="linenum">1181</span></a>          }
<a name="l1182"><span class="linenum">1182</span></a>  
<a name="l1183"><span class="linenum">1183</span></a>          return <a class="var it27122" onMouseOver="hilite(27122)" onMouseOut="lolite()" onClick="logVariable('dir_info')" href="../../_variables/dir_info.html">$dir_info</a>;
<a name="l1184"><span class="linenum">1184</span></a>      }
<a name="l1185"><span class="linenum">1185</span></a>  
<a name="l1186"><span class="linenum">1186</span></a>      <span class="comment">/**</span>
<a name="l1187"><span class="linenum">1187</span></a>  <span class="comment">     * Add new local file based on existing local file.</span>
<a name="l1188"><span class="linenum">1188</span></a>  <span class="comment">     *</span>
<a name="l1189"><span class="linenum">1189</span></a>  <span class="comment">     * @param stdClass|array $filerecord object or array describing changes</span>
<a name="l1190"><span class="linenum">1190</span></a>  <span class="comment">     * @param stored_file|int $fileorid id or stored_file instance of the existing local file</span>
<a name="l1191"><span class="linenum">1191</span></a>  <span class="comment">     * @return stored_file instance of newly created file</span>
<a name="l1192"><span class="linenum">1192</span></a>  <span class="comment">     */</span>
<a name="l1193"><span class="linenum">1193</span></a>      public function <a class="function" onClick="logFunction('create_file_from_storedfile')" href="../../_functions/create_file_from_storedfile.html" onMouseOver="funcPopup(event,'create_file_from_storedfile')">create_file_from_storedfile</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>, <a class="var it27124" onMouseOver="hilite(27124)" onMouseOut="lolite()" onClick="logVariable('fileorid')" href="../../_variables/fileorid.html">$fileorid</a>) {
<a name="l1194"><span class="linenum">1194</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1195"><span class="linenum">1195</span></a>  
<a name="l1196"><span class="linenum">1196</span></a>          if (<a class="var it27124" onMouseOver="hilite(27124)" onMouseOut="lolite()" onClick="logVariable('fileorid')" href="../../_variables/fileorid.html">$fileorid</a> instanceof stored_file) {
<a name="l1197"><span class="linenum">1197</span></a>              <a class="var it10017" onMouseOver="hilite(10017)" onMouseOut="lolite()" onClick="logVariable('fid')" href="../../_variables/fid.html">$fid</a> = <a class="var it27124" onMouseOver="hilite(27124)" onMouseOut="lolite()" onClick="logVariable('fileorid')" href="../../_variables/fileorid.html">$fileorid</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>();
<a name="l1198"><span class="linenum">1198</span></a>          } else {
<a name="l1199"><span class="linenum">1199</span></a>              <a class="var it10017" onMouseOver="hilite(10017)" onMouseOut="lolite()" onClick="logVariable('fid')" href="../../_variables/fid.html">$fid</a> = <a class="var it27124" onMouseOver="hilite(27124)" onMouseOut="lolite()" onClick="logVariable('fileorid')" href="../../_variables/fileorid.html">$fileorid</a>;
<a name="l1200"><span class="linenum">1200</span></a>          }
<a name="l1201"><span class="linenum">1201</span></a>  
<a name="l1202"><span class="linenum">1202</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a> = (array)<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>; <span class="comment">// We support arrays too, do not modify the submitted record!</span>
<a name="l1203"><span class="linenum">1203</span></a>  
<a name="l1204"><span class="linenum">1204</span></a>          unset(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>['id']);
<a name="l1205"><span class="linenum">1205</span></a>          unset(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>['filesize']);
<a name="l1206"><span class="linenum">1206</span></a>          unset(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>['contenthash']);
<a name="l1207"><span class="linenum">1207</span></a>          unset(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>['pathnamehash']);
<a name="l1208"><span class="linenum">1208</span></a>  
<a name="l1209"><span class="linenum">1209</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT &quot;.self::<a class="function" onClick="logFunction('instance_sql_fields')" href="../../_functions/instance_sql_fields.html" onMouseOver="funcPopup(event,'instance_sql_fields')">instance_sql_fields</a>('f', 'r').&quot;
<a name="l1210"><span class="linenum">1210</span></a>                    FROM {files} f
<a name="l1211"><span class="linenum">1211</span></a>               LEFT JOIN {files_reference} r
<a name="l1212"><span class="linenum">1212</span></a>                         ON f.referencefileid = r.id
<a name="l1213"><span class="linenum">1213</span></a>                   WHERE f.id = ?&quot;;
<a name="l1214"><span class="linenum">1214</span></a>  
<a name="l1215"><span class="linenum">1215</span></a>          if (!<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array(<a class="var it10017" onMouseOver="hilite(10017)" onMouseOut="lolite()" onClick="logVariable('fid')" href="../../_variables/fid.html">$fid</a>))) {
<a name="l1216"><span class="linenum">1216</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'File does not exist');
<a name="l1217"><span class="linenum">1217</span></a>          }
<a name="l1218"><span class="linenum">1218</span></a>  
<a name="l1219"><span class="linenum">1219</span></a>          unset(<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('id')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1220"><span class="linenum">1220</span></a>  
<a name="l1221"><span class="linenum">1221</span></a>          foreach (<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> =&gt; <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>) {
<a name="l1222"><span class="linenum">1222</span></a>  <span class="comment">            // validate all parameters, we do not want any rubbish stored in database, right?</span>
<a name="l1223"><span class="linenum">1223</span></a>              if (<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> == 'contextid' and (!<a class="function" onClick="logFunction('is_number')" href="../../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>(<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>) or <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> &lt; 1)) {
<a name="l1224"><span class="linenum">1224</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid contextid');
<a name="l1225"><span class="linenum">1225</span></a>              }
<a name="l1226"><span class="linenum">1226</span></a>  
<a name="l1227"><span class="linenum">1227</span></a>              if (<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> == 'component') {
<a name="l1228"><span class="linenum">1228</span></a>                  <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>, <a class="constant" onClick="logConstant('PARAM_COMPONENT')" href="../../_constants/PARAM_COMPONENT.html" onMouseOver="constPopup(event,'PARAM_COMPONENT')">PARAM_COMPONENT</a>);
<a name="l1229"><span class="linenum">1229</span></a>                  if (empty(<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>)) {
<a name="l1230"><span class="linenum">1230</span></a>                      throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid component');
<a name="l1231"><span class="linenum">1231</span></a>                  }
<a name="l1232"><span class="linenum">1232</span></a>              }
<a name="l1233"><span class="linenum">1233</span></a>  
<a name="l1234"><span class="linenum">1234</span></a>              if (<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> == 'filearea') {
<a name="l1235"><span class="linenum">1235</span></a>                  <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>, <a class="constant" onClick="logConstant('PARAM_AREA')" href="../../_constants/PARAM_AREA.html" onMouseOver="constPopup(event,'PARAM_AREA')">PARAM_AREA</a>);
<a name="l1236"><span class="linenum">1236</span></a>                  if (empty(<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>)) {
<a name="l1237"><span class="linenum">1237</span></a>                      throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid filearea');
<a name="l1238"><span class="linenum">1238</span></a>                  }
<a name="l1239"><span class="linenum">1239</span></a>              }
<a name="l1240"><span class="linenum">1240</span></a>  
<a name="l1241"><span class="linenum">1241</span></a>              if (<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> == 'itemid' and (!<a class="function" onClick="logFunction('is_number')" href="../../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>(<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>) or <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> &lt; 0)) {
<a name="l1242"><span class="linenum">1242</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid itemid');
<a name="l1243"><span class="linenum">1243</span></a>              }
<a name="l1244"><span class="linenum">1244</span></a>  
<a name="l1245"><span class="linenum">1245</span></a>  
<a name="l1246"><span class="linenum">1246</span></a>              if (<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> == 'filepath') {
<a name="l1247"><span class="linenum">1247</span></a>                  <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>, <a class="constant" onClick="logConstant('PARAM_PATH')" href="../../_constants/PARAM_PATH.html" onMouseOver="constPopup(event,'PARAM_PATH')">PARAM_PATH</a>);
<a name="l1248"><span class="linenum">1248</span></a>                  if (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>, '/') !== 0 or <a class="phpfunction" onClick="logFunction('strrpos')" href="../../_functions/strrpos.html" onMouseOver="phpfuncPopup(event,'strrpos')">strrpos</a>(<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>, '/') !== <a class="function" onClick="logFunction('strlen')" href="../../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>)-1) {
<a name="l1249"><span class="linenum">1249</span></a>  <span class="comment">                    // path must start and end with '/'</span>
<a name="l1250"><span class="linenum">1250</span></a>                      throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid file path');
<a name="l1251"><span class="linenum">1251</span></a>                  }
<a name="l1252"><span class="linenum">1252</span></a>              }
<a name="l1253"><span class="linenum">1253</span></a>  
<a name="l1254"><span class="linenum">1254</span></a>              if (<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> == 'filename') {
<a name="l1255"><span class="linenum">1255</span></a>                  <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>, <a class="constant" onClick="logConstant('PARAM_FILE')" href="../../_constants/PARAM_FILE.html" onMouseOver="constPopup(event,'PARAM_FILE')">PARAM_FILE</a>);
<a name="l1256"><span class="linenum">1256</span></a>                  if (<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> === '') {
<a name="l1257"><span class="linenum">1257</span></a>  <span class="comment">                    // path must start and end with '/'</span>
<a name="l1258"><span class="linenum">1258</span></a>                      throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid file name');
<a name="l1259"><span class="linenum">1259</span></a>                  }
<a name="l1260"><span class="linenum">1260</span></a>              }
<a name="l1261"><span class="linenum">1261</span></a>  
<a name="l1262"><span class="linenum">1262</span></a>              if (<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> === 'timecreated' or <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> === 'timemodified') {
<a name="l1263"><span class="linenum">1263</span></a>                  if (!<a class="function" onClick="logFunction('is_number')" href="../../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>(<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>)) {
<a name="l1264"><span class="linenum">1264</span></a>                      throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid file '.<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>);
<a name="l1265"><span class="linenum">1265</span></a>                  }
<a name="l1266"><span class="linenum">1266</span></a>                  if (<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> &lt; 0) {
<a name="l1267"><span class="linenum">1267</span></a>  <span class="comment">                    //NOTE: unfortunately I make a mistake when creating the &quot;files&quot; table, we can not have negative numbers there, on the other hand no file should be older than 1970, right? (skodak)</span>
<a name="l1268"><span class="linenum">1268</span></a>                      <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> = 0;
<a name="l1269"><span class="linenum">1269</span></a>                  }
<a name="l1270"><span class="linenum">1270</span></a>              }
<a name="l1271"><span class="linenum">1271</span></a>  
<a name="l1272"><span class="linenum">1272</span></a>              if (<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> == 'referencefileid' or <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> == 'referencelastsync') {
<a name="l1273"><span class="linenum">1273</span></a>                  <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>, <a class="constant" onClick="logConstant('PARAM_INT')" href="../../_constants/PARAM_INT.html" onMouseOver="constPopup(event,'PARAM_INT')">PARAM_INT</a>);
<a name="l1274"><span class="linenum">1274</span></a>              }
<a name="l1275"><span class="linenum">1275</span></a>  
<a name="l1276"><span class="linenum">1276</span></a>              <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> = <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>;
<a name="l1277"><span class="linenum">1277</span></a>          }
<a name="l1278"><span class="linenum">1278</span></a>  
<a name="l1279"><span class="linenum">1279</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('pathnamehash')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/pathnamehash.html">pathnamehash</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_pathname_hash')" href="../../_functions/get_pathname_hash.html" onMouseOver="funcPopup(event,'get_pathname_hash')">get_pathname_hash</a>(<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('component')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('itemid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filename')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a>);
<a name="l1280"><span class="linenum">1280</span></a>  
<a name="l1281"><span class="linenum">1281</span></a>          if (<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filename')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a> === '.') {
<a name="l1282"><span class="linenum">1282</span></a>  <span class="comment">            // special case - only this function supports directories ;-)</span>
<a name="l1283"><span class="linenum">1283</span></a>              <a class="var it6532" onMouseOver="hilite(6532)" onMouseOut="lolite()" onClick="logVariable('directory')" href="../../_variables/directory.html">$directory</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('create_directory')" href="../../_functions/create_directory.html" onMouseOver="funcPopup(event,'create_directory')">create_directory</a>(<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('component')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('itemid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('userid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>);
<a name="l1284"><span class="linenum">1284</span></a>  <span class="comment">            // update the existing directory with the new data</span>
<a name="l1285"><span class="linenum">1285</span></a>              <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('id')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it6532" onMouseOver="hilite(6532)" onMouseOut="lolite()" onClick="logVariable('directory')" href="../../_variables/directory.html">$directory</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>();
<a name="l1286"><span class="linenum">1286</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('files', <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>);
<a name="l1287"><span class="linenum">1287</span></a>              return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_instance')" href="../../_functions/get_file_instance.html" onMouseOver="funcPopup(event,'get_file_instance')">get_file_instance</a>(<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>);
<a name="l1288"><span class="linenum">1288</span></a>          }
<a name="l1289"><span class="linenum">1289</span></a>  
<a name="l1290"><span class="linenum">1290</span></a>  <span class="comment">        // note: referencefileid is copied from the original file so that</span>
<a name="l1291"><span class="linenum">1291</span></a>  <span class="comment">        // creating a new file from an existing alias creates new alias implicitly.</span>
<a name="l1292"><span class="linenum">1292</span></a>  <span class="comment">        // here we just check the database consistency.</span>
<a name="l1293"><span class="linenum">1293</span></a>          if (!empty(<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('repositoryid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/repositoryid.html">repositoryid</a>)) {
<a name="l1294"><span class="linenum">1294</span></a>              if (<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('referencefileid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/referencefileid.html">referencefileid</a> != <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_referencefileid')" href="../../_functions/get_referencefileid.html" onMouseOver="funcPopup(event,'get_referencefileid')">get_referencefileid</a>(<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('repositoryid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/repositoryid.html">repositoryid</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('reference')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/reference.html">reference</a>, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>)) {
<a name="l1295"><span class="linenum">1295</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_reference_exception')" href="../../_classes/file_reference_exception.html" onMouseOver="classPopup(event,'file_reference_exception')">file_reference_exception</a>(<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('repositoryid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/repositoryid.html">repositoryid</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('reference')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/reference.html">reference</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('referencefileid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/referencefileid.html">referencefileid</a>);
<a name="l1296"><span class="linenum">1296</span></a>              }
<a name="l1297"><span class="linenum">1297</span></a>          }
<a name="l1298"><span class="linenum">1298</span></a>  
<a name="l1299"><span class="linenum">1299</span></a>          try {
<a name="l1300"><span class="linenum">1300</span></a>              <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('id')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('files', <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>);
<a name="l1301"><span class="linenum">1301</span></a>          } catch (dml_exception <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>) {
<a name="l1302"><span class="linenum">1302</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('stored_file_creation_exception')" href="../../_classes/stored_file_creation_exception.html" onMouseOver="classPopup(event,'stored_file_creation_exception')">stored_file_creation_exception</a>(<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('component')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('itemid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>,
<a name="l1303"><span class="linenum">1303</span></a>                                                       <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filename')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a>, <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>-&gt;<a onClick="logVariable('debuginfo')" class="var it42938" onMouseOver="hilite(42938)" onMouseOut="lolite()" href="../../_variables/debuginfo.html">debuginfo</a>);
<a name="l1304"><span class="linenum">1304</span></a>          }
<a name="l1305"><span class="linenum">1305</span></a>  
<a name="l1306"><span class="linenum">1306</span></a>  
<a name="l1307"><span class="linenum">1307</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('create_directory')" href="../../_functions/create_directory.html" onMouseOver="funcPopup(event,'create_directory')">create_directory</a>(<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('component')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('itemid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('userid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>);
<a name="l1308"><span class="linenum">1308</span></a>  
<a name="l1309"><span class="linenum">1309</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_instance')" href="../../_functions/get_file_instance.html" onMouseOver="funcPopup(event,'get_file_instance')">get_file_instance</a>(<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>);
<a name="l1310"><span class="linenum">1310</span></a>      }
<a name="l1311"><span class="linenum">1311</span></a>  
<a name="l1312"><span class="linenum">1312</span></a>      <span class="comment">/**</span>
<a name="l1313"><span class="linenum">1313</span></a>  <span class="comment">     * Add new local file.</span>
<a name="l1314"><span class="linenum">1314</span></a>  <span class="comment">     *</span>
<a name="l1315"><span class="linenum">1315</span></a>  <span class="comment">     * @param stdClass|array $filerecord object or array describing file</span>
<a name="l1316"><span class="linenum">1316</span></a>  <span class="comment">     * @param string $url the URL to the file</span>
<a name="l1317"><span class="linenum">1317</span></a>  <span class="comment">     * @param array $options {@link download_file_content()} options</span>
<a name="l1318"><span class="linenum">1318</span></a>  <span class="comment">     * @param bool $usetempfile use temporary file for download, may prevent out of memory problems</span>
<a name="l1319"><span class="linenum">1319</span></a>  <span class="comment">     * @return stored_file</span>
<a name="l1320"><span class="linenum">1320</span></a>  <span class="comment">     */</span>
<a name="l1321"><span class="linenum">1321</span></a>      public function <a class="function" onClick="logFunction('create_file_from_url')" href="../../_functions/create_file_from_url.html" onMouseOver="funcPopup(event,'create_file_from_url')">create_file_from_url</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>, <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, array <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a> = null, <a class="var it27125" onMouseOver="hilite(27125)" onMouseOut="lolite()" onClick="logVariable('usetempfile')" href="../../_variables/usetempfile.html">$usetempfile</a> = false) {
<a name="l1322"><span class="linenum">1322</span></a>  
<a name="l1323"><span class="linenum">1323</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a> = (array)<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>;  <span class="comment">// Do not modify the submitted record, this cast unlinks objects.</span>
<a name="l1324"><span class="linenum">1324</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a> = (object)<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>; <span class="comment">// We support arrays too.</span>
<a name="l1325"><span class="linenum">1325</span></a>  
<a name="l1326"><span class="linenum">1326</span></a>          <a class="var it1021" onMouseOver="hilite(1021)" onMouseOut="lolite()" onClick="logVariable('headers')" href="../../_variables/headers.html">$headers</a>        = isset(<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>['headers'])        ? <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>['headers'] : null;
<a name="l1327"><span class="linenum">1327</span></a>          <a class="var it8925" onMouseOver="hilite(8925)" onMouseOut="lolite()" onClick="logVariable('postdata')" href="../../_variables/postdata.html">$postdata</a>       = isset(<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>['postdata'])       ? <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>['postdata'] : null;
<a name="l1328"><span class="linenum">1328</span></a>          <a class="var it9443" onMouseOver="hilite(9443)" onMouseOut="lolite()" onClick="logVariable('fullresponse')" href="../../_variables/fullresponse.html">$fullresponse</a>   = isset(<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>['fullresponse'])   ? <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>['fullresponse'] : false;
<a name="l1329"><span class="linenum">1329</span></a>          <a class="var it1356" onMouseOver="hilite(1356)" onMouseOut="lolite()" onClick="logVariable('timeout')" href="../../_variables/timeout.html">$timeout</a>        = isset(<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>['timeout'])        ? <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>['timeout'] : 300;
<a name="l1330"><span class="linenum">1330</span></a>          <a class="var it9444" onMouseOver="hilite(9444)" onMouseOut="lolite()" onClick="logVariable('connecttimeout')" href="../../_variables/connecttimeout.html">$connecttimeout</a> = isset(<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>['connecttimeout']) ? <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>['connecttimeout'] : 20;
<a name="l1331"><span class="linenum">1331</span></a>          <a class="var it9445" onMouseOver="hilite(9445)" onMouseOut="lolite()" onClick="logVariable('skipcertverify')" href="../../_variables/skipcertverify.html">$skipcertverify</a> = isset(<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>['skipcertverify']) ? <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>['skipcertverify'] : false;
<a name="l1332"><span class="linenum">1332</span></a>          <a class="var it9447" onMouseOver="hilite(9447)" onMouseOut="lolite()" onClick="logVariable('calctimeout')" href="../../_variables/calctimeout.html">$calctimeout</a>    = isset(<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>['calctimeout'])    ? <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a>['calctimeout'] : false;
<a name="l1333"><span class="linenum">1333</span></a>  
<a name="l1334"><span class="linenum">1334</span></a>          if (!isset(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filename')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a>)) {
<a name="l1335"><span class="linenum">1335</span></a>              <a class="var it1412" onMouseOver="hilite(1412)" onMouseOut="lolite()" onClick="logVariable('parts')" href="../../_variables/parts.html">$parts</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>('/', <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>);
<a name="l1336"><span class="linenum">1336</span></a>              <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a> = <a class="phpfunction" onClick="logFunction('array_pop')" href="../../_functions/array_pop.html" onMouseOver="phpfuncPopup(event,'array_pop')">array_pop</a>(<a class="var it1412" onMouseOver="hilite(1412)" onMouseOut="lolite()" onClick="logVariable('parts')" href="../../_variables/parts.html">$parts</a>);
<a name="l1337"><span class="linenum">1337</span></a>              <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filename')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>, <a class="constant" onClick="logConstant('PARAM_FILE')" href="../../_constants/PARAM_FILE.html" onMouseOver="constPopup(event,'PARAM_FILE')">PARAM_FILE</a>);
<a name="l1338"><span class="linenum">1338</span></a>          }
<a name="l1339"><span class="linenum">1339</span></a>          <a class="var it1771" onMouseOver="hilite(1771)" onMouseOut="lolite()" onClick="logVariable('source')" href="../../_variables/source.html">$source</a> = !empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('source')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/source.html">source</a>) ? <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('source')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/source.html">source</a> : <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>;
<a name="l1340"><span class="linenum">1340</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('source')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/source.html">source</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it1771" onMouseOver="hilite(1771)" onMouseOut="lolite()" onClick="logVariable('source')" href="../../_variables/source.html">$source</a>, <a class="constant" onClick="logConstant('PARAM_URL')" href="../../_constants/PARAM_URL.html" onMouseOver="constPopup(event,'PARAM_URL')">PARAM_URL</a>);
<a name="l1341"><span class="linenum">1341</span></a>  
<a name="l1342"><span class="linenum">1342</span></a>          if (<a class="var it27125" onMouseOver="hilite(27125)" onMouseOut="lolite()" onClick="logVariable('usetempfile')" href="../../_variables/usetempfile.html">$usetempfile</a>) {
<a name="l1343"><span class="linenum">1343</span></a>              <a class="function" onClick="logFunction('check_dir_exists')" href="../../_functions/check_dir_exists.html" onMouseOver="funcPopup(event,'check_dir_exists')">check_dir_exists</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('tempdir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/tempdir.html">tempdir</a>);
<a name="l1344"><span class="linenum">1344</span></a>              <a class="var it11143" onMouseOver="hilite(11143)" onMouseOut="lolite()" onClick="logVariable('tmpfile')" href="../../_variables/tmpfile.html">$tmpfile</a> = <a class="phpfunction" onClick="logFunction('tempnam')" href="../../_functions/tempnam.html" onMouseOver="phpfuncPopup(event,'tempnam')">tempnam</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('tempdir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/tempdir.html">tempdir</a>, 'newfromurl');
<a name="l1345"><span class="linenum">1345</span></a>              <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a> = <a class="function" onClick="logFunction('download_file_content')" href="../../_functions/download_file_content.html" onMouseOver="funcPopup(event,'download_file_content')">download_file_content</a>(<a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, <a class="var it1021" onMouseOver="hilite(1021)" onMouseOut="lolite()" onClick="logVariable('headers')" href="../../_variables/headers.html">$headers</a>, <a class="var it8925" onMouseOver="hilite(8925)" onMouseOut="lolite()" onClick="logVariable('postdata')" href="../../_variables/postdata.html">$postdata</a>, <a class="var it9443" onMouseOver="hilite(9443)" onMouseOut="lolite()" onClick="logVariable('fullresponse')" href="../../_variables/fullresponse.html">$fullresponse</a>, <a class="var it1356" onMouseOver="hilite(1356)" onMouseOut="lolite()" onClick="logVariable('timeout')" href="../../_variables/timeout.html">$timeout</a>, <a class="var it9444" onMouseOver="hilite(9444)" onMouseOut="lolite()" onClick="logVariable('connecttimeout')" href="../../_variables/connecttimeout.html">$connecttimeout</a>, <a class="var it9445" onMouseOver="hilite(9445)" onMouseOut="lolite()" onClick="logVariable('skipcertverify')" href="../../_variables/skipcertverify.html">$skipcertverify</a>, <a class="var it11143" onMouseOver="hilite(11143)" onMouseOut="lolite()" onClick="logVariable('tmpfile')" href="../../_variables/tmpfile.html">$tmpfile</a>, <a class="var it9447" onMouseOver="hilite(9447)" onMouseOut="lolite()" onClick="logVariable('calctimeout')" href="../../_variables/calctimeout.html">$calctimeout</a>);
<a name="l1346"><span class="linenum">1346</span></a>              if (<a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a> === false) {
<a name="l1347"><span class="linenum">1347</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Can not fetch file form URL');
<a name="l1348"><span class="linenum">1348</span></a>              }
<a name="l1349"><span class="linenum">1349</span></a>              try {
<a name="l1350"><span class="linenum">1350</span></a>                  <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('newfile')" href="../../_variables/newfile.html">$newfile</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('create_file_from_pathname')" href="../../_functions/create_file_from_pathname.html" onMouseOver="funcPopup(event,'create_file_from_pathname')">create_file_from_pathname</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>, <a class="var it11143" onMouseOver="hilite(11143)" onMouseOut="lolite()" onClick="logVariable('tmpfile')" href="../../_variables/tmpfile.html">$tmpfile</a>);
<a name="l1351"><span class="linenum">1351</span></a>                  @<a class="phpfunction" onClick="logFunction('unlink')" href="../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>(<a class="var it11143" onMouseOver="hilite(11143)" onMouseOut="lolite()" onClick="logVariable('tmpfile')" href="../../_variables/tmpfile.html">$tmpfile</a>);
<a name="l1352"><span class="linenum">1352</span></a>                  return <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('newfile')" href="../../_variables/newfile.html">$newfile</a>;
<a name="l1353"><span class="linenum">1353</span></a>              } catch (Exception <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>) {
<a name="l1354"><span class="linenum">1354</span></a>                  @<a class="phpfunction" onClick="logFunction('unlink')" href="../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>(<a class="var it11143" onMouseOver="hilite(11143)" onMouseOut="lolite()" onClick="logVariable('tmpfile')" href="../../_variables/tmpfile.html">$tmpfile</a>);
<a name="l1355"><span class="linenum">1355</span></a>                  throw <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>;
<a name="l1356"><span class="linenum">1356</span></a>              }
<a name="l1357"><span class="linenum">1357</span></a>  
<a name="l1358"><span class="linenum">1358</span></a>          } else {
<a name="l1359"><span class="linenum">1359</span></a>              <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a> = <a class="function" onClick="logFunction('download_file_content')" href="../../_functions/download_file_content.html" onMouseOver="funcPopup(event,'download_file_content')">download_file_content</a>(<a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>, <a class="var it1021" onMouseOver="hilite(1021)" onMouseOut="lolite()" onClick="logVariable('headers')" href="../../_variables/headers.html">$headers</a>, <a class="var it8925" onMouseOver="hilite(8925)" onMouseOut="lolite()" onClick="logVariable('postdata')" href="../../_variables/postdata.html">$postdata</a>, <a class="var it9443" onMouseOver="hilite(9443)" onMouseOut="lolite()" onClick="logVariable('fullresponse')" href="../../_variables/fullresponse.html">$fullresponse</a>, <a class="var it1356" onMouseOver="hilite(1356)" onMouseOut="lolite()" onClick="logVariable('timeout')" href="../../_variables/timeout.html">$timeout</a>, <a class="var it9444" onMouseOver="hilite(9444)" onMouseOut="lolite()" onClick="logVariable('connecttimeout')" href="../../_variables/connecttimeout.html">$connecttimeout</a>, <a class="var it9445" onMouseOver="hilite(9445)" onMouseOut="lolite()" onClick="logVariable('skipcertverify')" href="../../_variables/skipcertverify.html">$skipcertverify</a>, NULL, <a class="var it9447" onMouseOver="hilite(9447)" onMouseOut="lolite()" onClick="logVariable('calctimeout')" href="../../_variables/calctimeout.html">$calctimeout</a>);
<a name="l1360"><span class="linenum">1360</span></a>              if (<a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a> === false) {
<a name="l1361"><span class="linenum">1361</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Can not fetch file form URL');
<a name="l1362"><span class="linenum">1362</span></a>              }
<a name="l1363"><span class="linenum">1363</span></a>              return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('create_file_from_string')" href="../../_functions/create_file_from_string.html" onMouseOver="funcPopup(event,'create_file_from_string')">create_file_from_string</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>, <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>);
<a name="l1364"><span class="linenum">1364</span></a>          }
<a name="l1365"><span class="linenum">1365</span></a>      }
<a name="l1366"><span class="linenum">1366</span></a>  
<a name="l1367"><span class="linenum">1367</span></a>      <span class="comment">/**</span>
<a name="l1368"><span class="linenum">1368</span></a>  <span class="comment">     * Add new local file.</span>
<a name="l1369"><span class="linenum">1369</span></a>  <span class="comment">     *</span>
<a name="l1370"><span class="linenum">1370</span></a>  <span class="comment">     * @param stdClass|array $filerecord object or array describing file</span>
<a name="l1371"><span class="linenum">1371</span></a>  <span class="comment">     * @param string $pathname path to file or content of file</span>
<a name="l1372"><span class="linenum">1372</span></a>  <span class="comment">     * @return stored_file</span>
<a name="l1373"><span class="linenum">1373</span></a>  <span class="comment">     */</span>
<a name="l1374"><span class="linenum">1374</span></a>      public function <a class="function" onClick="logFunction('create_file_from_pathname')" href="../../_functions/create_file_from_pathname.html" onMouseOver="funcPopup(event,'create_file_from_pathname')">create_file_from_pathname</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>, <a class="var it801" onMouseOver="hilite(801)" onMouseOut="lolite()" onClick="logVariable('pathname')" href="../../_variables/pathname.html">$pathname</a>) {
<a name="l1375"><span class="linenum">1375</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1376"><span class="linenum">1376</span></a>  
<a name="l1377"><span class="linenum">1377</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a> = (array)<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>;  <span class="comment">// Do not modify the submitted record, this cast unlinks objects.</span>
<a name="l1378"><span class="linenum">1378</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a> = (object)<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>; <span class="comment">// We support arrays too.</span>
<a name="l1379"><span class="linenum">1379</span></a>  
<a name="l1380"><span class="linenum">1380</span></a>  <span class="comment">        // validate all parameters, we do not want any rubbish stored in database, right?</span>
<a name="l1381"><span class="linenum">1381</span></a>          if (!<a class="function" onClick="logFunction('is_number')" href="../../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>) or <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a> &lt; 1) {
<a name="l1382"><span class="linenum">1382</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid contextid');
<a name="l1383"><span class="linenum">1383</span></a>          }
<a name="l1384"><span class="linenum">1384</span></a>  
<a name="l1385"><span class="linenum">1385</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('component')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/component.html">component</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('component')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>, <a class="constant" onClick="logConstant('PARAM_COMPONENT')" href="../../_constants/PARAM_COMPONENT.html" onMouseOver="constPopup(event,'PARAM_COMPONENT')">PARAM_COMPONENT</a>);
<a name="l1386"><span class="linenum">1386</span></a>          if (empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('component')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>)) {
<a name="l1387"><span class="linenum">1387</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid component');
<a name="l1388"><span class="linenum">1388</span></a>          }
<a name="l1389"><span class="linenum">1389</span></a>  
<a name="l1390"><span class="linenum">1390</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>, <a class="constant" onClick="logConstant('PARAM_AREA')" href="../../_constants/PARAM_AREA.html" onMouseOver="constPopup(event,'PARAM_AREA')">PARAM_AREA</a>);
<a name="l1391"><span class="linenum">1391</span></a>          if (empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>)) {
<a name="l1392"><span class="linenum">1392</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid filearea');
<a name="l1393"><span class="linenum">1393</span></a>          }
<a name="l1394"><span class="linenum">1394</span></a>  
<a name="l1395"><span class="linenum">1395</span></a>          if (!<a class="function" onClick="logFunction('is_number')" href="../../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('itemid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>) or <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('itemid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a> &lt; 0) {
<a name="l1396"><span class="linenum">1396</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid itemid');
<a name="l1397"><span class="linenum">1397</span></a>          }
<a name="l1398"><span class="linenum">1398</span></a>  
<a name="l1399"><span class="linenum">1399</span></a>          if (!empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('sortorder')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a>)) {
<a name="l1400"><span class="linenum">1400</span></a>              if (!<a class="function" onClick="logFunction('is_number')" href="../../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('sortorder')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a>) or <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('sortorder')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a> &lt; 0) {
<a name="l1401"><span class="linenum">1401</span></a>                  <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('sortorder')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a> = 0;
<a name="l1402"><span class="linenum">1402</span></a>              }
<a name="l1403"><span class="linenum">1403</span></a>          } else {
<a name="l1404"><span class="linenum">1404</span></a>              <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('sortorder')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a> = 0;
<a name="l1405"><span class="linenum">1405</span></a>          }
<a name="l1406"><span class="linenum">1406</span></a>  
<a name="l1407"><span class="linenum">1407</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>, <a class="constant" onClick="logConstant('PARAM_PATH')" href="../../_constants/PARAM_PATH.html" onMouseOver="constPopup(event,'PARAM_PATH')">PARAM_PATH</a>);
<a name="l1408"><span class="linenum">1408</span></a>          if (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>, '/') !== 0 or <a class="phpfunction" onClick="logFunction('strrpos')" href="../../_functions/strrpos.html" onMouseOver="phpfuncPopup(event,'strrpos')">strrpos</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>, '/') !== <a class="function" onClick="logFunction('strlen')" href="../../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>)-1) {
<a name="l1409"><span class="linenum">1409</span></a>  <span class="comment">            // path must start and end with '/'</span>
<a name="l1410"><span class="linenum">1410</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid file path');
<a name="l1411"><span class="linenum">1411</span></a>          }
<a name="l1412"><span class="linenum">1412</span></a>  
<a name="l1413"><span class="linenum">1413</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filename')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filename')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a>, <a class="constant" onClick="logConstant('PARAM_FILE')" href="../../_constants/PARAM_FILE.html" onMouseOver="constPopup(event,'PARAM_FILE')">PARAM_FILE</a>);
<a name="l1414"><span class="linenum">1414</span></a>          if (<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filename')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a> === '') {
<a name="l1415"><span class="linenum">1415</span></a>  <span class="comment">            // filename must not be empty</span>
<a name="l1416"><span class="linenum">1416</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid file name');
<a name="l1417"><span class="linenum">1417</span></a>          }
<a name="l1418"><span class="linenum">1418</span></a>  
<a name="l1419"><span class="linenum">1419</span></a>          <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1420"><span class="linenum">1420</span></a>          if (isset(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a>)) {
<a name="l1421"><span class="linenum">1421</span></a>              if (!<a class="function" onClick="logFunction('is_number')" href="../../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a>)) {
<a name="l1422"><span class="linenum">1422</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid file timecreated');
<a name="l1423"><span class="linenum">1423</span></a>              }
<a name="l1424"><span class="linenum">1424</span></a>              if (<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a> &lt; 0) {
<a name="l1425"><span class="linenum">1425</span></a>  <span class="comment">                //NOTE: unfortunately I make a mistake when creating the &quot;files&quot; table, we can not have negative numbers there, on the other hand no file should be older than 1970, right? (skodak)</span>
<a name="l1426"><span class="linenum">1426</span></a>                  <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a> = 0;
<a name="l1427"><span class="linenum">1427</span></a>              }
<a name="l1428"><span class="linenum">1428</span></a>          } else {
<a name="l1429"><span class="linenum">1429</span></a>              <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a> = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l1430"><span class="linenum">1430</span></a>          }
<a name="l1431"><span class="linenum">1431</span></a>  
<a name="l1432"><span class="linenum">1432</span></a>          if (isset(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a>)) {
<a name="l1433"><span class="linenum">1433</span></a>              if (!<a class="function" onClick="logFunction('is_number')" href="../../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a>)) {
<a name="l1434"><span class="linenum">1434</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid file timemodified');
<a name="l1435"><span class="linenum">1435</span></a>              }
<a name="l1436"><span class="linenum">1436</span></a>              if (<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> &lt; 0) {
<a name="l1437"><span class="linenum">1437</span></a>  <span class="comment">                //NOTE: unfortunately I make a mistake when creating the &quot;files&quot; table, we can not have negative numbers there, on the other hand no file should be older than 1970, right? (skodak)</span>
<a name="l1438"><span class="linenum">1438</span></a>                  <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = 0;
<a name="l1439"><span class="linenum">1439</span></a>              }
<a name="l1440"><span class="linenum">1440</span></a>          } else {
<a name="l1441"><span class="linenum">1441</span></a>              <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l1442"><span class="linenum">1442</span></a>          }
<a name="l1443"><span class="linenum">1443</span></a>  
<a name="l1444"><span class="linenum">1444</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a> = new stdClass();
<a name="l1445"><span class="linenum">1445</span></a>  
<a name="l1446"><span class="linenum">1446</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a> = <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>;
<a name="l1447"><span class="linenum">1447</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('component')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/component.html">component</a> = <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('component')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>;
<a name="l1448"><span class="linenum">1448</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>  = <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>;
<a name="l1449"><span class="linenum">1449</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('itemid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>    = <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('itemid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>;
<a name="l1450"><span class="linenum">1450</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>  = <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>;
<a name="l1451"><span class="linenum">1451</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filename')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a>  = <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filename')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a>;
<a name="l1452"><span class="linenum">1452</span></a>  
<a name="l1453"><span class="linenum">1453</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('timecreated')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a>  = <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a>;
<a name="l1454"><span class="linenum">1454</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a>;
<a name="l1455"><span class="linenum">1455</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('mimetype')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/mimetype.html">mimetype</a>     = empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('mimetype')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/mimetype.html">mimetype</a>) ? <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('mimetype')" href="../../_functions/mimetype.html" onMouseOver="funcPopup(event,'mimetype')">mimetype</a>(<a class="var it801" onMouseOver="hilite(801)" onMouseOut="lolite()" onClick="logVariable('pathname')" href="../../_variables/pathname.html">$pathname</a>, <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filename')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a>) : <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('mimetype')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/mimetype.html">mimetype</a>;
<a name="l1456"><span class="linenum">1456</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('userid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>       = empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('userid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>) ? null : <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('userid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>;
<a name="l1457"><span class="linenum">1457</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('source')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/source.html">source</a>       = empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('source')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/source.html">source</a>) ? null : <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('source')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/source.html">source</a>;
<a name="l1458"><span class="linenum">1458</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('author')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/author.html">author</a>       = empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('author')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/author.html">author</a>) ? null : <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('author')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/author.html">author</a>;
<a name="l1459"><span class="linenum">1459</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('license')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/license.html">license</a>      = empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('license')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/license.html">license</a>) ? null : <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('license')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/license.html">license</a>;
<a name="l1460"><span class="linenum">1460</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('status')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/status.html">status</a>       = empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('status')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/status.html">status</a>) ? 0 : <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('status')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/status.html">status</a>;
<a name="l1461"><span class="linenum">1461</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('sortorder')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a>    = <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('sortorder')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a>;
<a name="l1462"><span class="linenum">1462</span></a>  
<a name="l1463"><span class="linenum">1463</span></a>          <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('contenthash')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/contenthash.html">contenthash</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filesize')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filesize.html">filesize</a>, <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('newfile')" href="../../_variables/newfile.html">$newfile</a>) = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_file_to_pool')" href="../../_functions/add_file_to_pool.html" onMouseOver="funcPopup(event,'add_file_to_pool')">add_file_to_pool</a>(<a class="var it801" onMouseOver="hilite(801)" onMouseOut="lolite()" onClick="logVariable('pathname')" href="../../_variables/pathname.html">$pathname</a>);
<a name="l1464"><span class="linenum">1464</span></a>  
<a name="l1465"><span class="linenum">1465</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('pathnamehash')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/pathnamehash.html">pathnamehash</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_pathname_hash')" href="../../_functions/get_pathname_hash.html" onMouseOver="funcPopup(event,'get_pathname_hash')">get_pathname_hash</a>(<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('component')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('itemid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filename')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a>);
<a name="l1466"><span class="linenum">1466</span></a>  
<a name="l1467"><span class="linenum">1467</span></a>          try {
<a name="l1468"><span class="linenum">1468</span></a>              <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('id')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('files', <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>);
<a name="l1469"><span class="linenum">1469</span></a>          } catch (dml_exception <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>) {
<a name="l1470"><span class="linenum">1470</span></a>              if (<a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('newfile')" href="../../_variables/newfile.html">$newfile</a>) {
<a name="l1471"><span class="linenum">1471</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('deleted_file_cleanup')" href="../../_functions/deleted_file_cleanup.html" onMouseOver="funcPopup(event,'deleted_file_cleanup')">deleted_file_cleanup</a>(<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('contenthash')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/contenthash.html">contenthash</a>);
<a name="l1472"><span class="linenum">1472</span></a>              }
<a name="l1473"><span class="linenum">1473</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('stored_file_creation_exception')" href="../../_classes/stored_file_creation_exception.html" onMouseOver="classPopup(event,'stored_file_creation_exception')">stored_file_creation_exception</a>(<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('component')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('itemid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>,
<a name="l1474"><span class="linenum">1474</span></a>                                                      <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filename')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a>, <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>-&gt;<a onClick="logVariable('debuginfo')" class="var it42938" onMouseOver="hilite(42938)" onMouseOut="lolite()" href="../../_variables/debuginfo.html">debuginfo</a>);
<a name="l1475"><span class="linenum">1475</span></a>          }
<a name="l1476"><span class="linenum">1476</span></a>  
<a name="l1477"><span class="linenum">1477</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('create_directory')" href="../../_functions/create_directory.html" onMouseOver="funcPopup(event,'create_directory')">create_directory</a>(<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('component')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('itemid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('userid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>);
<a name="l1478"><span class="linenum">1478</span></a>  
<a name="l1479"><span class="linenum">1479</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_instance')" href="../../_functions/get_file_instance.html" onMouseOver="funcPopup(event,'get_file_instance')">get_file_instance</a>(<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>);
<a name="l1480"><span class="linenum">1480</span></a>      }
<a name="l1481"><span class="linenum">1481</span></a>  
<a name="l1482"><span class="linenum">1482</span></a>      <span class="comment">/**</span>
<a name="l1483"><span class="linenum">1483</span></a>  <span class="comment">     * Add new local file.</span>
<a name="l1484"><span class="linenum">1484</span></a>  <span class="comment">     *</span>
<a name="l1485"><span class="linenum">1485</span></a>  <span class="comment">     * @param stdClass|array $filerecord object or array describing file</span>
<a name="l1486"><span class="linenum">1486</span></a>  <span class="comment">     * @param string $content content of file</span>
<a name="l1487"><span class="linenum">1487</span></a>  <span class="comment">     * @return stored_file</span>
<a name="l1488"><span class="linenum">1488</span></a>  <span class="comment">     */</span>
<a name="l1489"><span class="linenum">1489</span></a>      public function <a class="function" onClick="logFunction('create_file_from_string')" href="../../_functions/create_file_from_string.html" onMouseOver="funcPopup(event,'create_file_from_string')">create_file_from_string</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>, <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>) {
<a name="l1490"><span class="linenum">1490</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1491"><span class="linenum">1491</span></a>  
<a name="l1492"><span class="linenum">1492</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a> = (array)<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>;  <span class="comment">// Do not modify the submitted record, this cast unlinks objects.</span>
<a name="l1493"><span class="linenum">1493</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a> = (object)<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>; <span class="comment">// We support arrays too.</span>
<a name="l1494"><span class="linenum">1494</span></a>  
<a name="l1495"><span class="linenum">1495</span></a>  <span class="comment">        // validate all parameters, we do not want any rubbish stored in database, right?</span>
<a name="l1496"><span class="linenum">1496</span></a>          if (!<a class="function" onClick="logFunction('is_number')" href="../../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>) or <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a> &lt; 1) {
<a name="l1497"><span class="linenum">1497</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid contextid');
<a name="l1498"><span class="linenum">1498</span></a>          }
<a name="l1499"><span class="linenum">1499</span></a>  
<a name="l1500"><span class="linenum">1500</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('component')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/component.html">component</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('component')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>, <a class="constant" onClick="logConstant('PARAM_COMPONENT')" href="../../_constants/PARAM_COMPONENT.html" onMouseOver="constPopup(event,'PARAM_COMPONENT')">PARAM_COMPONENT</a>);
<a name="l1501"><span class="linenum">1501</span></a>          if (empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('component')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>)) {
<a name="l1502"><span class="linenum">1502</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid component');
<a name="l1503"><span class="linenum">1503</span></a>          }
<a name="l1504"><span class="linenum">1504</span></a>  
<a name="l1505"><span class="linenum">1505</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>, <a class="constant" onClick="logConstant('PARAM_AREA')" href="../../_constants/PARAM_AREA.html" onMouseOver="constPopup(event,'PARAM_AREA')">PARAM_AREA</a>);
<a name="l1506"><span class="linenum">1506</span></a>          if (empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>)) {
<a name="l1507"><span class="linenum">1507</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid filearea');
<a name="l1508"><span class="linenum">1508</span></a>          }
<a name="l1509"><span class="linenum">1509</span></a>  
<a name="l1510"><span class="linenum">1510</span></a>          if (!<a class="function" onClick="logFunction('is_number')" href="../../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('itemid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>) or <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('itemid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a> &lt; 0) {
<a name="l1511"><span class="linenum">1511</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid itemid');
<a name="l1512"><span class="linenum">1512</span></a>          }
<a name="l1513"><span class="linenum">1513</span></a>  
<a name="l1514"><span class="linenum">1514</span></a>          if (!empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('sortorder')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a>)) {
<a name="l1515"><span class="linenum">1515</span></a>              if (!<a class="function" onClick="logFunction('is_number')" href="../../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('sortorder')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a>) or <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('sortorder')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a> &lt; 0) {
<a name="l1516"><span class="linenum">1516</span></a>                  <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('sortorder')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a> = 0;
<a name="l1517"><span class="linenum">1517</span></a>              }
<a name="l1518"><span class="linenum">1518</span></a>          } else {
<a name="l1519"><span class="linenum">1519</span></a>              <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('sortorder')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a> = 0;
<a name="l1520"><span class="linenum">1520</span></a>          }
<a name="l1521"><span class="linenum">1521</span></a>  
<a name="l1522"><span class="linenum">1522</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>, <a class="constant" onClick="logConstant('PARAM_PATH')" href="../../_constants/PARAM_PATH.html" onMouseOver="constPopup(event,'PARAM_PATH')">PARAM_PATH</a>);
<a name="l1523"><span class="linenum">1523</span></a>          if (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>, '/') !== 0 or <a class="phpfunction" onClick="logFunction('strrpos')" href="../../_functions/strrpos.html" onMouseOver="phpfuncPopup(event,'strrpos')">strrpos</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>, '/') !== <a class="function" onClick="logFunction('strlen')" href="../../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>)-1) {
<a name="l1524"><span class="linenum">1524</span></a>  <span class="comment">            // path must start and end with '/'</span>
<a name="l1525"><span class="linenum">1525</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid file path');
<a name="l1526"><span class="linenum">1526</span></a>          }
<a name="l1527"><span class="linenum">1527</span></a>  
<a name="l1528"><span class="linenum">1528</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filename')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filename')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a>, <a class="constant" onClick="logConstant('PARAM_FILE')" href="../../_constants/PARAM_FILE.html" onMouseOver="constPopup(event,'PARAM_FILE')">PARAM_FILE</a>);
<a name="l1529"><span class="linenum">1529</span></a>          if (<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filename')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a> === '') {
<a name="l1530"><span class="linenum">1530</span></a>  <span class="comment">            // path must start and end with '/'</span>
<a name="l1531"><span class="linenum">1531</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid file name');
<a name="l1532"><span class="linenum">1532</span></a>          }
<a name="l1533"><span class="linenum">1533</span></a>  
<a name="l1534"><span class="linenum">1534</span></a>          <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1535"><span class="linenum">1535</span></a>          if (isset(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a>)) {
<a name="l1536"><span class="linenum">1536</span></a>              if (!<a class="function" onClick="logFunction('is_number')" href="../../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a>)) {
<a name="l1537"><span class="linenum">1537</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid file timecreated');
<a name="l1538"><span class="linenum">1538</span></a>              }
<a name="l1539"><span class="linenum">1539</span></a>              if (<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a> &lt; 0) {
<a name="l1540"><span class="linenum">1540</span></a>  <span class="comment">                //NOTE: unfortunately I make a mistake when creating the &quot;files&quot; table, we can not have negative numbers there, on the other hand no file should be older than 1970, right? (skodak)</span>
<a name="l1541"><span class="linenum">1541</span></a>                  <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a> = 0;
<a name="l1542"><span class="linenum">1542</span></a>              }
<a name="l1543"><span class="linenum">1543</span></a>          } else {
<a name="l1544"><span class="linenum">1544</span></a>              <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a> = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l1545"><span class="linenum">1545</span></a>          }
<a name="l1546"><span class="linenum">1546</span></a>  
<a name="l1547"><span class="linenum">1547</span></a>          if (isset(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a>)) {
<a name="l1548"><span class="linenum">1548</span></a>              if (!<a class="function" onClick="logFunction('is_number')" href="../../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a>)) {
<a name="l1549"><span class="linenum">1549</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid file timemodified');
<a name="l1550"><span class="linenum">1550</span></a>              }
<a name="l1551"><span class="linenum">1551</span></a>              if (<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> &lt; 0) {
<a name="l1552"><span class="linenum">1552</span></a>  <span class="comment">                //NOTE: unfortunately I make a mistake when creating the &quot;files&quot; table, we can not have negative numbers there, on the other hand no file should be older than 1970, right? (skodak)</span>
<a name="l1553"><span class="linenum">1553</span></a>                  <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = 0;
<a name="l1554"><span class="linenum">1554</span></a>              }
<a name="l1555"><span class="linenum">1555</span></a>          } else {
<a name="l1556"><span class="linenum">1556</span></a>              <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l1557"><span class="linenum">1557</span></a>          }
<a name="l1558"><span class="linenum">1558</span></a>  
<a name="l1559"><span class="linenum">1559</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a> = new stdClass();
<a name="l1560"><span class="linenum">1560</span></a>  
<a name="l1561"><span class="linenum">1561</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a> = <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>;
<a name="l1562"><span class="linenum">1562</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('component')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/component.html">component</a> = <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('component')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>;
<a name="l1563"><span class="linenum">1563</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>  = <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>;
<a name="l1564"><span class="linenum">1564</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('itemid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>    = <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('itemid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>;
<a name="l1565"><span class="linenum">1565</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>  = <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>;
<a name="l1566"><span class="linenum">1566</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filename')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a>  = <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filename')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a>;
<a name="l1567"><span class="linenum">1567</span></a>  
<a name="l1568"><span class="linenum">1568</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('timecreated')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a>  = <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a>;
<a name="l1569"><span class="linenum">1569</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a>;
<a name="l1570"><span class="linenum">1570</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('userid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>       = empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('userid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>) ? null : <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('userid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>;
<a name="l1571"><span class="linenum">1571</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('source')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/source.html">source</a>       = empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('source')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/source.html">source</a>) ? null : <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('source')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/source.html">source</a>;
<a name="l1572"><span class="linenum">1572</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('author')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/author.html">author</a>       = empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('author')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/author.html">author</a>) ? null : <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('author')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/author.html">author</a>;
<a name="l1573"><span class="linenum">1573</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('license')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/license.html">license</a>      = empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('license')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/license.html">license</a>) ? null : <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('license')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/license.html">license</a>;
<a name="l1574"><span class="linenum">1574</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('status')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/status.html">status</a>       = empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('status')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/status.html">status</a>) ? 0 : <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('status')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/status.html">status</a>;
<a name="l1575"><span class="linenum">1575</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('sortorder')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a>    = <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('sortorder')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a>;
<a name="l1576"><span class="linenum">1576</span></a>  
<a name="l1577"><span class="linenum">1577</span></a>          <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('contenthash')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/contenthash.html">contenthash</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filesize')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filesize.html">filesize</a>, <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('newfile')" href="../../_variables/newfile.html">$newfile</a>) = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_string_to_pool')" href="../../_functions/add_string_to_pool.html" onMouseOver="funcPopup(event,'add_string_to_pool')">add_string_to_pool</a>(<a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>);
<a name="l1578"><span class="linenum">1578</span></a>          <a class="var it27126" onMouseOver="hilite(27126)" onMouseOut="lolite()" onClick="logVariable('filepathname')" href="../../_variables/filepathname.html">$filepathname</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('path_from_hash')" href="../../_functions/path_from_hash.html" onMouseOver="funcPopup(event,'path_from_hash')">path_from_hash</a>(<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('contenthash')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/contenthash.html">contenthash</a>) . '/' . <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('contenthash')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/contenthash.html">contenthash</a>;
<a name="l1579"><span class="linenum">1579</span></a>  <span class="comment">        // get mimetype by magic bytes</span>
<a name="l1580"><span class="linenum">1580</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('mimetype')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/mimetype.html">mimetype</a> = empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('mimetype')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/mimetype.html">mimetype</a>) ? <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('mimetype')" href="../../_functions/mimetype.html" onMouseOver="funcPopup(event,'mimetype')">mimetype</a>(<a class="var it27126" onMouseOver="hilite(27126)" onMouseOut="lolite()" onClick="logVariable('filepathname')" href="../../_variables/filepathname.html">$filepathname</a>, <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filename')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a>) : <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('mimetype')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/mimetype.html">mimetype</a>;
<a name="l1581"><span class="linenum">1581</span></a>  
<a name="l1582"><span class="linenum">1582</span></a>          <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('pathnamehash')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/pathnamehash.html">pathnamehash</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_pathname_hash')" href="../../_functions/get_pathname_hash.html" onMouseOver="funcPopup(event,'get_pathname_hash')">get_pathname_hash</a>(<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('component')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('itemid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filename')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a>);
<a name="l1583"><span class="linenum">1583</span></a>  
<a name="l1584"><span class="linenum">1584</span></a>          try {
<a name="l1585"><span class="linenum">1585</span></a>              <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('id')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('files', <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>);
<a name="l1586"><span class="linenum">1586</span></a>          } catch (dml_exception <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>) {
<a name="l1587"><span class="linenum">1587</span></a>              if (<a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('newfile')" href="../../_variables/newfile.html">$newfile</a>) {
<a name="l1588"><span class="linenum">1588</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('deleted_file_cleanup')" href="../../_functions/deleted_file_cleanup.html" onMouseOver="funcPopup(event,'deleted_file_cleanup')">deleted_file_cleanup</a>(<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('contenthash')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/contenthash.html">contenthash</a>);
<a name="l1589"><span class="linenum">1589</span></a>              }
<a name="l1590"><span class="linenum">1590</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('stored_file_creation_exception')" href="../../_classes/stored_file_creation_exception.html" onMouseOver="classPopup(event,'stored_file_creation_exception')">stored_file_creation_exception</a>(<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('component')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('itemid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>,
<a name="l1591"><span class="linenum">1591</span></a>                                                      <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filename')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a>, <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>-&gt;<a onClick="logVariable('debuginfo')" class="var it42938" onMouseOver="hilite(42938)" onMouseOut="lolite()" href="../../_variables/debuginfo.html">debuginfo</a>);
<a name="l1592"><span class="linenum">1592</span></a>          }
<a name="l1593"><span class="linenum">1593</span></a>  
<a name="l1594"><span class="linenum">1594</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('create_directory')" href="../../_functions/create_directory.html" onMouseOver="funcPopup(event,'create_directory')">create_directory</a>(<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('component')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('itemid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('userid')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>);
<a name="l1595"><span class="linenum">1595</span></a>  
<a name="l1596"><span class="linenum">1596</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_instance')" href="../../_functions/get_file_instance.html" onMouseOver="funcPopup(event,'get_file_instance')">get_file_instance</a>(<a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../_variables/newrecord.html">$newrecord</a>);
<a name="l1597"><span class="linenum">1597</span></a>      }
<a name="l1598"><span class="linenum">1598</span></a>  
<a name="l1599"><span class="linenum">1599</span></a>      <span class="comment">/**</span>
<a name="l1600"><span class="linenum">1600</span></a>  <span class="comment">     * Create a new alias/shortcut file from file reference information</span>
<a name="l1601"><span class="linenum">1601</span></a>  <span class="comment">     *</span>
<a name="l1602"><span class="linenum">1602</span></a>  <span class="comment">     * @param stdClass|array $filerecord object or array describing the new file</span>
<a name="l1603"><span class="linenum">1603</span></a>  <span class="comment">     * @param int $repositoryid the id of the repository that provides the original file</span>
<a name="l1604"><span class="linenum">1604</span></a>  <span class="comment">     * @param string $reference the information required by the repository to locate the original file</span>
<a name="l1605"><span class="linenum">1605</span></a>  <span class="comment">     * @param array $options options for creating the new file</span>
<a name="l1606"><span class="linenum">1606</span></a>  <span class="comment">     * @return stored_file</span>
<a name="l1607"><span class="linenum">1607</span></a>  <span class="comment">     */</span>
<a name="l1608"><span class="linenum">1608</span></a>      public function <a class="function" onClick="logFunction('create_file_from_reference')" href="../../_functions/create_file_from_reference.html" onMouseOver="funcPopup(event,'create_file_from_reference')">create_file_from_reference</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>, <a class="var it5419" onMouseOver="hilite(5419)" onMouseOut="lolite()" onClick="logVariable('repositoryid')" href="../../_variables/repositoryid.html">$repositoryid</a>, <a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>, <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../_variables/options.html">$options</a> = array()) {
<a name="l1609"><span class="linenum">1609</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1610"><span class="linenum">1610</span></a>  
<a name="l1611"><span class="linenum">1611</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a> = (array)<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>;  <span class="comment">// Do not modify the submitted record, this cast unlinks objects.</span>
<a name="l1612"><span class="linenum">1612</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a> = (object)<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>; <span class="comment">// We support arrays too.</span>
<a name="l1613"><span class="linenum">1613</span></a>  
<a name="l1614"><span class="linenum">1614</span></a>  <span class="comment">        // validate all parameters, we do not want any rubbish stored in database, right?</span>
<a name="l1615"><span class="linenum">1615</span></a>          if (!<a class="function" onClick="logFunction('is_number')" href="../../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>) or <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a> &lt; 1) {
<a name="l1616"><span class="linenum">1616</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid contextid');
<a name="l1617"><span class="linenum">1617</span></a>          }
<a name="l1618"><span class="linenum">1618</span></a>  
<a name="l1619"><span class="linenum">1619</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('component')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/component.html">component</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('component')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>, <a class="constant" onClick="logConstant('PARAM_COMPONENT')" href="../../_constants/PARAM_COMPONENT.html" onMouseOver="constPopup(event,'PARAM_COMPONENT')">PARAM_COMPONENT</a>);
<a name="l1620"><span class="linenum">1620</span></a>          if (empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('component')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>)) {
<a name="l1621"><span class="linenum">1621</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid component');
<a name="l1622"><span class="linenum">1622</span></a>          }
<a name="l1623"><span class="linenum">1623</span></a>  
<a name="l1624"><span class="linenum">1624</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>, <a class="constant" onClick="logConstant('PARAM_AREA')" href="../../_constants/PARAM_AREA.html" onMouseOver="constPopup(event,'PARAM_AREA')">PARAM_AREA</a>);
<a name="l1625"><span class="linenum">1625</span></a>          if (empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>)) {
<a name="l1626"><span class="linenum">1626</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid filearea');
<a name="l1627"><span class="linenum">1627</span></a>          }
<a name="l1628"><span class="linenum">1628</span></a>  
<a name="l1629"><span class="linenum">1629</span></a>          if (!<a class="function" onClick="logFunction('is_number')" href="../../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('itemid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>) or <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('itemid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a> &lt; 0) {
<a name="l1630"><span class="linenum">1630</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid itemid');
<a name="l1631"><span class="linenum">1631</span></a>          }
<a name="l1632"><span class="linenum">1632</span></a>  
<a name="l1633"><span class="linenum">1633</span></a>          if (!empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('sortorder')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a>)) {
<a name="l1634"><span class="linenum">1634</span></a>              if (!<a class="function" onClick="logFunction('is_number')" href="../../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('sortorder')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a>) or <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('sortorder')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a> &lt; 0) {
<a name="l1635"><span class="linenum">1635</span></a>                  <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('sortorder')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a> = 0;
<a name="l1636"><span class="linenum">1636</span></a>              }
<a name="l1637"><span class="linenum">1637</span></a>          } else {
<a name="l1638"><span class="linenum">1638</span></a>              <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('sortorder')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a> = 0;
<a name="l1639"><span class="linenum">1639</span></a>          }
<a name="l1640"><span class="linenum">1640</span></a>  
<a name="l1641"><span class="linenum">1641</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('mimetype')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/mimetype.html">mimetype</a>          = empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('mimetype')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/mimetype.html">mimetype</a>) ? <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('mimetype')" href="../../_functions/mimetype.html" onMouseOver="funcPopup(event,'mimetype')">mimetype</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filename')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a>) : <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('mimetype')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/mimetype.html">mimetype</a>;
<a name="l1642"><span class="linenum">1642</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('userid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>            = empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('userid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>) ? null : <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('userid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>;
<a name="l1643"><span class="linenum">1643</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('source')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/source.html">source</a>            = empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('source')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/source.html">source</a>) ? null : <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('source')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/source.html">source</a>;
<a name="l1644"><span class="linenum">1644</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('author')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/author.html">author</a>            = empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('author')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/author.html">author</a>) ? null : <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('author')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/author.html">author</a>;
<a name="l1645"><span class="linenum">1645</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('license')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/license.html">license</a>           = empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('license')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/license.html">license</a>) ? null : <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('license')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/license.html">license</a>;
<a name="l1646"><span class="linenum">1646</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('status')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/status.html">status</a>            = empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('status')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/status.html">status</a>) ? 0 : <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('status')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/status.html">status</a>;
<a name="l1647"><span class="linenum">1647</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>          = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>, <a class="constant" onClick="logConstant('PARAM_PATH')" href="../../_constants/PARAM_PATH.html" onMouseOver="constPopup(event,'PARAM_PATH')">PARAM_PATH</a>);
<a name="l1648"><span class="linenum">1648</span></a>          if (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>, '/') !== 0 or <a class="phpfunction" onClick="logFunction('strrpos')" href="../../_functions/strrpos.html" onMouseOver="phpfuncPopup(event,'strrpos')">strrpos</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>, '/') !== <a class="function" onClick="logFunction('strlen')" href="../../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>)-1) {
<a name="l1649"><span class="linenum">1649</span></a>  <span class="comment">            // Path must start and end with '/'.</span>
<a name="l1650"><span class="linenum">1650</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid file path');
<a name="l1651"><span class="linenum">1651</span></a>          }
<a name="l1652"><span class="linenum">1652</span></a>  
<a name="l1653"><span class="linenum">1653</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filename')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filename')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a>, <a class="constant" onClick="logConstant('PARAM_FILE')" href="../../_constants/PARAM_FILE.html" onMouseOver="constPopup(event,'PARAM_FILE')">PARAM_FILE</a>);
<a name="l1654"><span class="linenum">1654</span></a>          if (<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filename')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a> === '') {
<a name="l1655"><span class="linenum">1655</span></a>  <span class="comment">            // Path must start and end with '/'.</span>
<a name="l1656"><span class="linenum">1656</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid file name');
<a name="l1657"><span class="linenum">1657</span></a>          }
<a name="l1658"><span class="linenum">1658</span></a>  
<a name="l1659"><span class="linenum">1659</span></a>          <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1660"><span class="linenum">1660</span></a>          if (isset(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a>)) {
<a name="l1661"><span class="linenum">1661</span></a>              if (!<a class="function" onClick="logFunction('is_number')" href="../../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a>)) {
<a name="l1662"><span class="linenum">1662</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid file timecreated');
<a name="l1663"><span class="linenum">1663</span></a>              }
<a name="l1664"><span class="linenum">1664</span></a>              if (<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a> &lt; 0) {
<a name="l1665"><span class="linenum">1665</span></a>  <span class="comment">                // NOTE: unfortunately I make a mistake when creating the &quot;files&quot; table, we can not have negative numbers there, on the other hand no file should be older than 1970, right? (skodak)</span>
<a name="l1666"><span class="linenum">1666</span></a>                  <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a> = 0;
<a name="l1667"><span class="linenum">1667</span></a>              }
<a name="l1668"><span class="linenum">1668</span></a>          } else {
<a name="l1669"><span class="linenum">1669</span></a>              <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a> = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l1670"><span class="linenum">1670</span></a>          }
<a name="l1671"><span class="linenum">1671</span></a>  
<a name="l1672"><span class="linenum">1672</span></a>          if (isset(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a>)) {
<a name="l1673"><span class="linenum">1673</span></a>              if (!<a class="function" onClick="logFunction('is_number')" href="../../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a>)) {
<a name="l1674"><span class="linenum">1674</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Invalid file timemodified');
<a name="l1675"><span class="linenum">1675</span></a>              }
<a name="l1676"><span class="linenum">1676</span></a>              if (<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> &lt; 0) {
<a name="l1677"><span class="linenum">1677</span></a>  <span class="comment">                // NOTE: unfortunately I make a mistake when creating the &quot;files&quot; table, we can not have negative numbers there, on the other hand no file should be older than 1970, right? (skodak)</span>
<a name="l1678"><span class="linenum">1678</span></a>                  <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = 0;
<a name="l1679"><span class="linenum">1679</span></a>              }
<a name="l1680"><span class="linenum">1680</span></a>          } else {
<a name="l1681"><span class="linenum">1681</span></a>              <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>;
<a name="l1682"><span class="linenum">1682</span></a>          }
<a name="l1683"><span class="linenum">1683</span></a>  
<a name="l1684"><span class="linenum">1684</span></a>          <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l1685"><span class="linenum">1685</span></a>  
<a name="l1686"><span class="linenum">1686</span></a>          try {
<a name="l1687"><span class="linenum">1687</span></a>              <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('referencefileid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/referencefileid.html">referencefileid</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_or_create_referencefileid')" href="../../_functions/get_or_create_referencefileid.html" onMouseOver="funcPopup(event,'get_or_create_referencefileid')">get_or_create_referencefileid</a>(<a class="var it5419" onMouseOver="hilite(5419)" onMouseOut="lolite()" onClick="logVariable('repositoryid')" href="../../_variables/repositoryid.html">$repositoryid</a>, <a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>);
<a name="l1688"><span class="linenum">1688</span></a>          } catch (Exception <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>) {
<a name="l1689"><span class="linenum">1689</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_reference_exception')" href="../../_classes/file_reference_exception.html" onMouseOver="classPopup(event,'file_reference_exception')">file_reference_exception</a>(<a class="var it5419" onMouseOver="hilite(5419)" onMouseOut="lolite()" onClick="logVariable('repositoryid')" href="../../_variables/repositoryid.html">$repositoryid</a>, <a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>, null, null, <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>-&gt;<a class="function" onClick="logFunction('getMessage')" href="../../_functions/getmessage.html" onMouseOver="funcPopup(event,'getmessage')">getMessage</a>());
<a name="l1690"><span class="linenum">1690</span></a>          }
<a name="l1691"><span class="linenum">1691</span></a>  
<a name="l1692"><span class="linenum">1692</span></a>          if (isset(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('contenthash')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/contenthash.html">contenthash</a>) &amp;&amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('content_exists')" href="../../_functions/content_exists.html" onMouseOver="funcPopup(event,'content_exists')">content_exists</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('contenthash')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/contenthash.html">contenthash</a>)) {
<a name="l1693"><span class="linenum">1693</span></a>  <span class="comment">            // there was specified the contenthash for a file already stored in moodle filepool</span>
<a name="l1694"><span class="linenum">1694</span></a>              if (empty(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filesize')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filesize.html">filesize</a>)) {
<a name="l1695"><span class="linenum">1695</span></a>                  <a class="var it27126" onMouseOver="hilite(27126)" onMouseOut="lolite()" onClick="logVariable('filepathname')" href="../../_variables/filepathname.html">$filepathname</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('path_from_hash')" href="../../_functions/path_from_hash.html" onMouseOver="funcPopup(event,'path_from_hash')">path_from_hash</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('contenthash')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/contenthash.html">contenthash</a>) . '/' . <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('contenthash')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/contenthash.html">contenthash</a>;
<a name="l1696"><span class="linenum">1696</span></a>                  <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filesize')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filesize.html">filesize</a> = <a class="phpfunction" onClick="logFunction('filesize')" href="../../_functions/filesize.html" onMouseOver="phpfuncPopup(event,'filesize')">filesize</a>(<a class="var it27126" onMouseOver="hilite(27126)" onMouseOut="lolite()" onClick="logVariable('filepathname')" href="../../_variables/filepathname.html">$filepathname</a>);
<a name="l1697"><span class="linenum">1697</span></a>              } else {
<a name="l1698"><span class="linenum">1698</span></a>                  <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filesize')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filesize.html">filesize</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filesize')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filesize.html">filesize</a>, <a class="constant" onClick="logConstant('PARAM_INT')" href="../../_constants/PARAM_INT.html" onMouseOver="constPopup(event,'PARAM_INT')">PARAM_INT</a>);
<a name="l1699"><span class="linenum">1699</span></a>              }
<a name="l1700"><span class="linenum">1700</span></a>          } else {
<a name="l1701"><span class="linenum">1701</span></a>  <span class="comment">            // atempt to get the result of last synchronisation for this reference</span>
<a name="l1702"><span class="linenum">1702</span></a>              <a class="var it27127" onMouseOver="hilite(27127)" onMouseOut="lolite()" onClick="logVariable('lastcontent')" href="../../_variables/lastcontent.html">$lastcontent</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('files', array('referencefileid' =&gt; <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('referencefileid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/referencefileid.html">referencefileid</a>),
<a name="l1703"><span class="linenum">1703</span></a>                      'id, contenthash, filesize', <a class="constant" onClick="logConstant('IGNORE_MULTIPLE')" href="../../_constants/IGNORE_MULTIPLE.html" onMouseOver="constPopup(event,'IGNORE_MULTIPLE')">IGNORE_MULTIPLE</a>);
<a name="l1704"><span class="linenum">1704</span></a>              if (<a class="var it27127" onMouseOver="hilite(27127)" onMouseOut="lolite()" onClick="logVariable('lastcontent')" href="../../_variables/lastcontent.html">$lastcontent</a>) {
<a name="l1705"><span class="linenum">1705</span></a>                  <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('contenthash')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/contenthash.html">contenthash</a> = <a class="var it27127" onMouseOver="hilite(27127)" onMouseOut="lolite()" onClick="logVariable('lastcontent')" href="../../_variables/lastcontent.html">$lastcontent</a>-&gt;<a onClick="logVariable('contenthash')" class="var it45213" onMouseOver="hilite(45213)" onMouseOut="lolite()" href="../../_variables/contenthash.html">contenthash</a>;
<a name="l1706"><span class="linenum">1706</span></a>                  <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filesize')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filesize.html">filesize</a> = <a class="var it27127" onMouseOver="hilite(27127)" onMouseOut="lolite()" onClick="logVariable('lastcontent')" href="../../_variables/lastcontent.html">$lastcontent</a>-&gt;<a onClick="logVariable('filesize')" class="var it45213" onMouseOver="hilite(45213)" onMouseOut="lolite()" href="../../_variables/filesize.html">filesize</a>;
<a name="l1707"><span class="linenum">1707</span></a>              } else {
<a name="l1708"><span class="linenum">1708</span></a>  <span class="comment">                // External file doesn't have content in moodle.</span>
<a name="l1709"><span class="linenum">1709</span></a>  <span class="comment">                // So we create an empty file for it.</span>
<a name="l1710"><span class="linenum">1710</span></a>                  <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('contenthash')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/contenthash.html">contenthash</a>, <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filesize')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filesize.html">filesize</a>, <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('newfile')" href="../../_variables/newfile.html">$newfile</a>) = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('add_string_to_pool')" href="../../_functions/add_string_to_pool.html" onMouseOver="funcPopup(event,'add_string_to_pool')">add_string_to_pool</a>(null);
<a name="l1711"><span class="linenum">1711</span></a>              }
<a name="l1712"><span class="linenum">1712</span></a>          }
<a name="l1713"><span class="linenum">1713</span></a>  
<a name="l1714"><span class="linenum">1714</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('pathnamehash')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/pathnamehash.html">pathnamehash</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_pathname_hash')" href="../../_functions/get_pathname_hash.html" onMouseOver="funcPopup(event,'get_pathname_hash')">get_pathname_hash</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>, <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('component')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>, <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>, <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('itemid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>, <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>, <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filename')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a>);
<a name="l1715"><span class="linenum">1715</span></a>  
<a name="l1716"><span class="linenum">1716</span></a>          try {
<a name="l1717"><span class="linenum">1717</span></a>              <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('id')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('files', <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>);
<a name="l1718"><span class="linenum">1718</span></a>          } catch (dml_exception <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>) {
<a name="l1719"><span class="linenum">1719</span></a>              if (!empty(<a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('newfile')" href="../../_variables/newfile.html">$newfile</a>)) {
<a name="l1720"><span class="linenum">1720</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('deleted_file_cleanup')" href="../../_functions/deleted_file_cleanup.html" onMouseOver="funcPopup(event,'deleted_file_cleanup')">deleted_file_cleanup</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('contenthash')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/contenthash.html">contenthash</a>);
<a name="l1721"><span class="linenum">1721</span></a>              }
<a name="l1722"><span class="linenum">1722</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('stored_file_creation_exception')" href="../../_classes/stored_file_creation_exception.html" onMouseOver="classPopup(event,'stored_file_creation_exception')">stored_file_creation_exception</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>, <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('component')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>, <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>, <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('itemid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>,
<a name="l1723"><span class="linenum">1723</span></a>                                                      <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>, <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filename')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filename.html">filename</a>, <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>-&gt;<a onClick="logVariable('debuginfo')" class="var it42938" onMouseOver="hilite(42938)" onMouseOut="lolite()" href="../../_variables/debuginfo.html">debuginfo</a>);
<a name="l1724"><span class="linenum">1724</span></a>          }
<a name="l1725"><span class="linenum">1725</span></a>  
<a name="l1726"><span class="linenum">1726</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('create_directory')" href="../../_functions/create_directory.html" onMouseOver="funcPopup(event,'create_directory')">create_directory</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('contextid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>, <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('component')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>, <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filearea')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>, <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('itemid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>, <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('filepath')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/filepath.html">filepath</a>, <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('userid')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>);
<a name="l1727"><span class="linenum">1727</span></a>  
<a name="l1728"><span class="linenum">1728</span></a>          <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l1729"><span class="linenum">1729</span></a>  
<a name="l1730"><span class="linenum">1730</span></a>  <span class="comment">        // this will retrieve all reference information from DB as well</span>
<a name="l1731"><span class="linenum">1731</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_by_id')" href="../../_functions/get_file_by_id.html" onMouseOver="funcPopup(event,'get_file_by_id')">get_file_by_id</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('id')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1732"><span class="linenum">1732</span></a>      }
<a name="l1733"><span class="linenum">1733</span></a>  
<a name="l1734"><span class="linenum">1734</span></a>      <span class="comment">/**</span>
<a name="l1735"><span class="linenum">1735</span></a>  <span class="comment">     * Creates new image file from existing.</span>
<a name="l1736"><span class="linenum">1736</span></a>  <span class="comment">     *</span>
<a name="l1737"><span class="linenum">1737</span></a>  <span class="comment">     * @param stdClass|array $filerecord object or array describing new file</span>
<a name="l1738"><span class="linenum">1738</span></a>  <span class="comment">     * @param int|stored_file $fid file id or stored file object</span>
<a name="l1739"><span class="linenum">1739</span></a>  <span class="comment">     * @param int $newwidth in pixels</span>
<a name="l1740"><span class="linenum">1740</span></a>  <span class="comment">     * @param int $newheight in pixels</span>
<a name="l1741"><span class="linenum">1741</span></a>  <span class="comment">     * @param bool $keepaspectratio whether or not keep aspect ratio</span>
<a name="l1742"><span class="linenum">1742</span></a>  <span class="comment">     * @param int $quality depending on image type 0-100 for jpeg, 0-9 (0 means no compression) for png</span>
<a name="l1743"><span class="linenum">1743</span></a>  <span class="comment">     * @return stored_file</span>
<a name="l1744"><span class="linenum">1744</span></a>  <span class="comment">     */</span>
<a name="l1745"><span class="linenum">1745</span></a>      public function <a class="function" onClick="logFunction('convert_image')" href="../../_functions/convert_image.html" onMouseOver="funcPopup(event,'convert_image')">convert_image</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>, <a class="var it10017" onMouseOver="hilite(10017)" onMouseOut="lolite()" onClick="logVariable('fid')" href="../../_variables/fid.html">$fid</a>, <a class="var it24666" onMouseOver="hilite(24666)" onMouseOut="lolite()" onClick="logVariable('newwidth')" href="../../_variables/newwidth.html">$newwidth</a> = null, <a class="var it24667" onMouseOver="hilite(24667)" onMouseOut="lolite()" onClick="logVariable('newheight')" href="../../_variables/newheight.html">$newheight</a> = null, <a class="var it27128" onMouseOver="hilite(27128)" onMouseOut="lolite()" onClick="logVariable('keepaspectratio')" href="../../_variables/keepaspectratio.html">$keepaspectratio</a> = true, <a class="var it877" onMouseOver="hilite(877)" onMouseOut="lolite()" onClick="logVariable('quality')" href="../../_variables/quality.html">$quality</a> = null) {
<a name="l1746"><span class="linenum">1746</span></a>          if (!<a class="phpfunction" onClick="logFunction('function_exists')" href="../../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>('imagecreatefromstring')) {
<a name="l1747"><span class="linenum">1747</span></a>  <span class="comment">            //Most likely the GD php extension isn't installed</span>
<a name="l1748"><span class="linenum">1748</span></a>  <span class="comment">            //image conversion cannot succeed</span>
<a name="l1749"><span class="linenum">1749</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', '<a class="phpfunction" onClick="logFunction('imagecreatefromstring')" href="../../_functions/imagecreatefromstring.html" onMouseOver="phpfuncPopup(event,'imagecreatefromstring')">imagecreatefromstring</a>() doesnt exist. The PHP extension &quot;GD&quot; must be installed for image conversion.');
<a name="l1750"><span class="linenum">1750</span></a>          }
<a name="l1751"><span class="linenum">1751</span></a>  
<a name="l1752"><span class="linenum">1752</span></a>          if (<a class="var it10017" onMouseOver="hilite(10017)" onMouseOut="lolite()" onClick="logVariable('fid')" href="../../_variables/fid.html">$fid</a> instanceof stored_file) {
<a name="l1753"><span class="linenum">1753</span></a>              <a class="var it10017" onMouseOver="hilite(10017)" onMouseOut="lolite()" onClick="logVariable('fid')" href="../../_variables/fid.html">$fid</a> = <a class="var it10017" onMouseOver="hilite(10017)" onMouseOut="lolite()" onClick="logVariable('fid')" href="../../_variables/fid.html">$fid</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>();
<a name="l1754"><span class="linenum">1754</span></a>          }
<a name="l1755"><span class="linenum">1755</span></a>  
<a name="l1756"><span class="linenum">1756</span></a>          <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a> = (array)<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>; <span class="comment">// We support arrays too, do not modify the submitted record!</span>
<a name="l1757"><span class="linenum">1757</span></a>  
<a name="l1758"><span class="linenum">1758</span></a>          if (!<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_by_id')" href="../../_functions/get_file_by_id.html" onMouseOver="funcPopup(event,'get_file_by_id')">get_file_by_id</a>(<a class="var it10017" onMouseOver="hilite(10017)" onMouseOut="lolite()" onClick="logVariable('fid')" href="../../_variables/fid.html">$fid</a>)) { // Make sure file really exists and we we correct data.
<a name="l1759"><span class="linenum">1759</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'File does not exist');
<a name="l1760"><span class="linenum">1760</span></a>          }
<a name="l1761"><span class="linenum">1761</span></a>  
<a name="l1762"><span class="linenum">1762</span></a>          if (!<a class="var it292" onMouseOver="hilite(292)" onMouseOut="lolite()" onClick="logVariable('imageinfo')" href="../../_variables/imageinfo.html">$imageinfo</a> = <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_imageinfo')" href="../../_functions/get_imageinfo.html" onMouseOver="funcPopup(event,'get_imageinfo')">get_imageinfo</a>()) {
<a name="l1763"><span class="linenum">1763</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'File is not an image');
<a name="l1764"><span class="linenum">1764</span></a>          }
<a name="l1765"><span class="linenum">1765</span></a>  
<a name="l1766"><span class="linenum">1766</span></a>          if (!isset(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>['filename'])) {
<a name="l1767"><span class="linenum">1767</span></a>              <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>['filename'] = <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_filename')" href="../../_functions/get_filename.html" onMouseOver="funcPopup(event,'get_filename')">get_filename</a>();
<a name="l1768"><span class="linenum">1768</span></a>          }
<a name="l1769"><span class="linenum">1769</span></a>  
<a name="l1770"><span class="linenum">1770</span></a>          if (!isset(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>['mimetype'])) {
<a name="l1771"><span class="linenum">1771</span></a>              <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>['mimetype'] = <a class="var it292" onMouseOver="hilite(292)" onMouseOut="lolite()" onClick="logVariable('imageinfo')" href="../../_variables/imageinfo.html">$imageinfo</a>['mimetype'];
<a name="l1772"><span class="linenum">1772</span></a>          }
<a name="l1773"><span class="linenum">1773</span></a>  
<a name="l1774"><span class="linenum">1774</span></a>          <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('width')" href="../../_variables/width.html">$width</a>    = <a class="var it292" onMouseOver="hilite(292)" onMouseOut="lolite()" onClick="logVariable('imageinfo')" href="../../_variables/imageinfo.html">$imageinfo</a>['width'];
<a name="l1775"><span class="linenum">1775</span></a>          <a class="var it293" onMouseOver="hilite(293)" onMouseOut="lolite()" onClick="logVariable('height')" href="../../_variables/height.html">$height</a>   = <a class="var it292" onMouseOver="hilite(292)" onMouseOut="lolite()" onClick="logVariable('imageinfo')" href="../../_variables/imageinfo.html">$imageinfo</a>['height'];
<a name="l1776"><span class="linenum">1776</span></a>  
<a name="l1777"><span class="linenum">1777</span></a>          if (<a class="var it27128" onMouseOver="hilite(27128)" onMouseOut="lolite()" onClick="logVariable('keepaspectratio')" href="../../_variables/keepaspectratio.html">$keepaspectratio</a>) {
<a name="l1778"><span class="linenum">1778</span></a>              if (0 &gt;= <a class="var it24666" onMouseOver="hilite(24666)" onMouseOut="lolite()" onClick="logVariable('newwidth')" href="../../_variables/newwidth.html">$newwidth</a> and 0 &gt;= <a class="var it24667" onMouseOver="hilite(24667)" onMouseOut="lolite()" onClick="logVariable('newheight')" href="../../_variables/newheight.html">$newheight</a>) {
<a name="l1779"><span class="linenum">1779</span></a>  <span class="comment">                // no sizes specified</span>
<a name="l1780"><span class="linenum">1780</span></a>                  <a class="var it24666" onMouseOver="hilite(24666)" onMouseOut="lolite()" onClick="logVariable('newwidth')" href="../../_variables/newwidth.html">$newwidth</a>  = <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('width')" href="../../_variables/width.html">$width</a>;
<a name="l1781"><span class="linenum">1781</span></a>                  <a class="var it24667" onMouseOver="hilite(24667)" onMouseOut="lolite()" onClick="logVariable('newheight')" href="../../_variables/newheight.html">$newheight</a> = <a class="var it293" onMouseOver="hilite(293)" onMouseOut="lolite()" onClick="logVariable('height')" href="../../_variables/height.html">$height</a>;
<a name="l1782"><span class="linenum">1782</span></a>  
<a name="l1783"><span class="linenum">1783</span></a>              } else if (0 &lt; <a class="var it24666" onMouseOver="hilite(24666)" onMouseOut="lolite()" onClick="logVariable('newwidth')" href="../../_variables/newwidth.html">$newwidth</a> and 0 &lt; <a class="var it24667" onMouseOver="hilite(24667)" onMouseOut="lolite()" onClick="logVariable('newheight')" href="../../_variables/newheight.html">$newheight</a>) {
<a name="l1784"><span class="linenum">1784</span></a>                  <a class="var it27129" onMouseOver="hilite(27129)" onMouseOut="lolite()" onClick="logVariable('xheight')" href="../../_variables/xheight.html">$xheight</a> = (<a class="var it24666" onMouseOver="hilite(24666)" onMouseOut="lolite()" onClick="logVariable('newwidth')" href="../../_variables/newwidth.html">$newwidth</a>*(<a class="var it293" onMouseOver="hilite(293)" onMouseOut="lolite()" onClick="logVariable('height')" href="../../_variables/height.html">$height</a>/<a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('width')" href="../../_variables/width.html">$width</a>));
<a name="l1785"><span class="linenum">1785</span></a>                  if (<a class="var it27129" onMouseOver="hilite(27129)" onMouseOut="lolite()" onClick="logVariable('xheight')" href="../../_variables/xheight.html">$xheight</a> &lt; <a class="var it24667" onMouseOver="hilite(24667)" onMouseOut="lolite()" onClick="logVariable('newheight')" href="../../_variables/newheight.html">$newheight</a>) {
<a name="l1786"><span class="linenum">1786</span></a>                      <a class="var it24667" onMouseOver="hilite(24667)" onMouseOut="lolite()" onClick="logVariable('newheight')" href="../../_variables/newheight.html">$newheight</a> = (int)<a class="var it27129" onMouseOver="hilite(27129)" onMouseOut="lolite()" onClick="logVariable('xheight')" href="../../_variables/xheight.html">$xheight</a>;
<a name="l1787"><span class="linenum">1787</span></a>                  } else {
<a name="l1788"><span class="linenum">1788</span></a>                      <a class="var it24666" onMouseOver="hilite(24666)" onMouseOut="lolite()" onClick="logVariable('newwidth')" href="../../_variables/newwidth.html">$newwidth</a> = (int)(<a class="var it24667" onMouseOver="hilite(24667)" onMouseOut="lolite()" onClick="logVariable('newheight')" href="../../_variables/newheight.html">$newheight</a>*(<a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('width')" href="../../_variables/width.html">$width</a>/<a class="var it293" onMouseOver="hilite(293)" onMouseOut="lolite()" onClick="logVariable('height')" href="../../_variables/height.html">$height</a>));
<a name="l1789"><span class="linenum">1789</span></a>                  }
<a name="l1790"><span class="linenum">1790</span></a>  
<a name="l1791"><span class="linenum">1791</span></a>              } else if (0 &lt; <a class="var it24666" onMouseOver="hilite(24666)" onMouseOut="lolite()" onClick="logVariable('newwidth')" href="../../_variables/newwidth.html">$newwidth</a>) {
<a name="l1792"><span class="linenum">1792</span></a>                  <a class="var it24667" onMouseOver="hilite(24667)" onMouseOut="lolite()" onClick="logVariable('newheight')" href="../../_variables/newheight.html">$newheight</a> = (int)(<a class="var it24666" onMouseOver="hilite(24666)" onMouseOut="lolite()" onClick="logVariable('newwidth')" href="../../_variables/newwidth.html">$newwidth</a>*(<a class="var it293" onMouseOver="hilite(293)" onMouseOut="lolite()" onClick="logVariable('height')" href="../../_variables/height.html">$height</a>/<a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('width')" href="../../_variables/width.html">$width</a>));
<a name="l1793"><span class="linenum">1793</span></a>  
<a name="l1794"><span class="linenum">1794</span></a>              } else { //0 &lt; <a class="var it24667" onMouseOver="hilite(24667)" onMouseOut="lolite()" onClick="logVariable('newheight')" href="../../_variables/newheight.html">$newheight</a>
<a name="l1795"><span class="linenum">1795</span></a>                  <a class="var it24666" onMouseOver="hilite(24666)" onMouseOut="lolite()" onClick="logVariable('newwidth')" href="../../_variables/newwidth.html">$newwidth</a> = (int)(<a class="var it24667" onMouseOver="hilite(24667)" onMouseOut="lolite()" onClick="logVariable('newheight')" href="../../_variables/newheight.html">$newheight</a>*(<a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('width')" href="../../_variables/width.html">$width</a>/<a class="var it293" onMouseOver="hilite(293)" onMouseOut="lolite()" onClick="logVariable('height')" href="../../_variables/height.html">$height</a>));
<a name="l1796"><span class="linenum">1796</span></a>              }
<a name="l1797"><span class="linenum">1797</span></a>  
<a name="l1798"><span class="linenum">1798</span></a>          } else {
<a name="l1799"><span class="linenum">1799</span></a>              if (0 &gt;= <a class="var it24666" onMouseOver="hilite(24666)" onMouseOut="lolite()" onClick="logVariable('newwidth')" href="../../_variables/newwidth.html">$newwidth</a>) {
<a name="l1800"><span class="linenum">1800</span></a>                  <a class="var it24666" onMouseOver="hilite(24666)" onMouseOut="lolite()" onClick="logVariable('newwidth')" href="../../_variables/newwidth.html">$newwidth</a> = <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('width')" href="../../_variables/width.html">$width</a>;
<a name="l1801"><span class="linenum">1801</span></a>              }
<a name="l1802"><span class="linenum">1802</span></a>              if (0 &gt;= <a class="var it24667" onMouseOver="hilite(24667)" onMouseOut="lolite()" onClick="logVariable('newheight')" href="../../_variables/newheight.html">$newheight</a>) {
<a name="l1803"><span class="linenum">1803</span></a>                  <a class="var it24667" onMouseOver="hilite(24667)" onMouseOut="lolite()" onClick="logVariable('newheight')" href="../../_variables/newheight.html">$newheight</a> = <a class="var it293" onMouseOver="hilite(293)" onMouseOut="lolite()" onClick="logVariable('height')" href="../../_variables/height.html">$height</a>;
<a name="l1804"><span class="linenum">1804</span></a>              }
<a name="l1805"><span class="linenum">1805</span></a>          }
<a name="l1806"><span class="linenum">1806</span></a>  
<a name="l1807"><span class="linenum">1807</span></a>  <span class="comment">        // The original image.</span>
<a name="l1808"><span class="linenum">1808</span></a>          <a class="var it8104" onMouseOver="hilite(8104)" onMouseOut="lolite()" onClick="logVariable('img')" href="../../_variables/img.html">$img</a> = <a class="phpfunction" onClick="logFunction('imagecreatefromstring')" href="../../_functions/imagecreatefromstring.html" onMouseOver="phpfuncPopup(event,'imagecreatefromstring')">imagecreatefromstring</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_content')" href="../../_functions/get_content.html" onMouseOver="funcPopup(event,'get_content')">get_content</a>());
<a name="l1809"><span class="linenum">1809</span></a>  
<a name="l1810"><span class="linenum">1810</span></a>  <span class="comment">        // A new true color image where we will copy our original image.</span>
<a name="l1811"><span class="linenum">1811</span></a>          <a class="var it27130" onMouseOver="hilite(27130)" onMouseOut="lolite()" onClick="logVariable('newimg')" href="../../_variables/newimg.html">$newimg</a> = <a class="phpfunction" onClick="logFunction('imagecreatetruecolor')" href="../../_functions/imagecreatetruecolor.html" onMouseOver="phpfuncPopup(event,'imagecreatetruecolor')">imagecreatetruecolor</a>(<a class="var it24666" onMouseOver="hilite(24666)" onMouseOut="lolite()" onClick="logVariable('newwidth')" href="../../_variables/newwidth.html">$newwidth</a>, <a class="var it24667" onMouseOver="hilite(24667)" onMouseOut="lolite()" onClick="logVariable('newheight')" href="../../_variables/newheight.html">$newheight</a>);
<a name="l1812"><span class="linenum">1812</span></a>  
<a name="l1813"><span class="linenum">1813</span></a>  <span class="comment">        // Determine if the file supports transparency.</span>
<a name="l1814"><span class="linenum">1814</span></a>          <a class="var it27131" onMouseOver="hilite(27131)" onMouseOut="lolite()" onClick="logVariable('hasalpha')" href="../../_variables/hasalpha.html">$hasalpha</a> = <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>['mimetype'] == 'image/png' || <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>['mimetype'] == 'image/gif';
<a name="l1815"><span class="linenum">1815</span></a>  
<a name="l1816"><span class="linenum">1816</span></a>  <span class="comment">        // Maintain transparency.</span>
<a name="l1817"><span class="linenum">1817</span></a>          if (<a class="var it27131" onMouseOver="hilite(27131)" onMouseOut="lolite()" onClick="logVariable('hasalpha')" href="../../_variables/hasalpha.html">$hasalpha</a>) {
<a name="l1818"><span class="linenum">1818</span></a>              <a class="phpfunction" onClick="logFunction('imagealphablending')" href="../../_functions/imagealphablending.html" onMouseOver="phpfuncPopup(event,'imagealphablending')">imagealphablending</a>(<a class="var it27130" onMouseOver="hilite(27130)" onMouseOut="lolite()" onClick="logVariable('newimg')" href="../../_variables/newimg.html">$newimg</a>, true);
<a name="l1819"><span class="linenum">1819</span></a>  
<a name="l1820"><span class="linenum">1820</span></a>  <span class="comment">            // Get the current transparent index for the original image.</span>
<a name="l1821"><span class="linenum">1821</span></a>              <a class="var it299" onMouseOver="hilite(299)" onMouseOut="lolite()" onClick="logVariable('colour')" href="../../_variables/colour.html">$colour</a> = <a class="phpfunction" onClick="logFunction('imagecolortransparent')" href="../../_functions/imagecolortransparent.html" onMouseOver="phpfuncPopup(event,'imagecolortransparent')">imagecolortransparent</a>(<a class="var it8104" onMouseOver="hilite(8104)" onMouseOut="lolite()" onClick="logVariable('img')" href="../../_variables/img.html">$img</a>);
<a name="l1822"><span class="linenum">1822</span></a>              if (<a class="var it299" onMouseOver="hilite(299)" onMouseOut="lolite()" onClick="logVariable('colour')" href="../../_variables/colour.html">$colour</a> == -1) {
<a name="l1823"><span class="linenum">1823</span></a>  <span class="comment">                // Set a transparent colour index if there's none.</span>
<a name="l1824"><span class="linenum">1824</span></a>                  <a class="var it299" onMouseOver="hilite(299)" onMouseOut="lolite()" onClick="logVariable('colour')" href="../../_variables/colour.html">$colour</a> = <a class="phpfunction" onClick="logFunction('imagecolorallocatealpha')" href="../../_functions/imagecolorallocatealpha.html" onMouseOver="phpfuncPopup(event,'imagecolorallocatealpha')">imagecolorallocatealpha</a>(<a class="var it27130" onMouseOver="hilite(27130)" onMouseOut="lolite()" onClick="logVariable('newimg')" href="../../_variables/newimg.html">$newimg</a>, 255, 255, 255, 127);
<a name="l1825"><span class="linenum">1825</span></a>  <span class="comment">                // Save full alpha channel.</span>
<a name="l1826"><span class="linenum">1826</span></a>                  <a class="phpfunction" onClick="logFunction('imagesavealpha')" href="../../_functions/imagesavealpha.html" onMouseOver="phpfuncPopup(event,'imagesavealpha')">imagesavealpha</a>(<a class="var it27130" onMouseOver="hilite(27130)" onMouseOut="lolite()" onClick="logVariable('newimg')" href="../../_variables/newimg.html">$newimg</a>, true);
<a name="l1827"><span class="linenum">1827</span></a>              }
<a name="l1828"><span class="linenum">1828</span></a>              <a class="phpfunction" onClick="logFunction('imagecolortransparent')" href="../../_functions/imagecolortransparent.html" onMouseOver="phpfuncPopup(event,'imagecolortransparent')">imagecolortransparent</a>(<a class="var it27130" onMouseOver="hilite(27130)" onMouseOut="lolite()" onClick="logVariable('newimg')" href="../../_variables/newimg.html">$newimg</a>, <a class="var it299" onMouseOver="hilite(299)" onMouseOut="lolite()" onClick="logVariable('colour')" href="../../_variables/colour.html">$colour</a>);
<a name="l1829"><span class="linenum">1829</span></a>              <a class="phpfunction" onClick="logFunction('imagefill')" href="../../_functions/imagefill.html" onMouseOver="phpfuncPopup(event,'imagefill')">imagefill</a>(<a class="var it27130" onMouseOver="hilite(27130)" onMouseOut="lolite()" onClick="logVariable('newimg')" href="../../_variables/newimg.html">$newimg</a>, 0, 0, <a class="var it299" onMouseOver="hilite(299)" onMouseOut="lolite()" onClick="logVariable('colour')" href="../../_variables/colour.html">$colour</a>);
<a name="l1830"><span class="linenum">1830</span></a>          }
<a name="l1831"><span class="linenum">1831</span></a>  
<a name="l1832"><span class="linenum">1832</span></a>  <span class="comment">        // Process the image to be output.</span>
<a name="l1833"><span class="linenum">1833</span></a>          if (<a class="var it293" onMouseOver="hilite(293)" onMouseOut="lolite()" onClick="logVariable('height')" href="../../_variables/height.html">$height</a> != <a class="var it24667" onMouseOver="hilite(24667)" onMouseOut="lolite()" onClick="logVariable('newheight')" href="../../_variables/newheight.html">$newheight</a> or <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('width')" href="../../_variables/width.html">$width</a> != <a class="var it24666" onMouseOver="hilite(24666)" onMouseOut="lolite()" onClick="logVariable('newwidth')" href="../../_variables/newwidth.html">$newwidth</a>) {
<a name="l1834"><span class="linenum">1834</span></a>  <span class="comment">            // Resample if the dimensions differ from the original.</span>
<a name="l1835"><span class="linenum">1835</span></a>              if (!<a class="phpfunction" onClick="logFunction('imagecopyresampled')" href="../../_functions/imagecopyresampled.html" onMouseOver="phpfuncPopup(event,'imagecopyresampled')">imagecopyresampled</a>(<a class="var it27130" onMouseOver="hilite(27130)" onMouseOut="lolite()" onClick="logVariable('newimg')" href="../../_variables/newimg.html">$newimg</a>, <a class="var it8104" onMouseOver="hilite(8104)" onMouseOut="lolite()" onClick="logVariable('img')" href="../../_variables/img.html">$img</a>, 0, 0, 0, 0, <a class="var it24666" onMouseOver="hilite(24666)" onMouseOut="lolite()" onClick="logVariable('newwidth')" href="../../_variables/newwidth.html">$newwidth</a>, <a class="var it24667" onMouseOver="hilite(24667)" onMouseOut="lolite()" onClick="logVariable('newheight')" href="../../_variables/newheight.html">$newheight</a>, <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('width')" href="../../_variables/width.html">$width</a>, <a class="var it293" onMouseOver="hilite(293)" onMouseOut="lolite()" onClick="logVariable('height')" href="../../_variables/height.html">$height</a>)) {
<a name="l1836"><span class="linenum">1836</span></a>  <span class="comment">                // weird</span>
<a name="l1837"><span class="linenum">1837</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Can not resize image');
<a name="l1838"><span class="linenum">1838</span></a>              }
<a name="l1839"><span class="linenum">1839</span></a>              <a class="phpfunction" onClick="logFunction('imagedestroy')" href="../../_functions/imagedestroy.html" onMouseOver="phpfuncPopup(event,'imagedestroy')">imagedestroy</a>(<a class="var it8104" onMouseOver="hilite(8104)" onMouseOut="lolite()" onClick="logVariable('img')" href="../../_variables/img.html">$img</a>);
<a name="l1840"><span class="linenum">1840</span></a>              <a class="var it8104" onMouseOver="hilite(8104)" onMouseOut="lolite()" onClick="logVariable('img')" href="../../_variables/img.html">$img</a> = <a class="var it27130" onMouseOver="hilite(27130)" onMouseOut="lolite()" onClick="logVariable('newimg')" href="../../_variables/newimg.html">$newimg</a>;
<a name="l1841"><span class="linenum">1841</span></a>  
<a name="l1842"><span class="linenum">1842</span></a>          } else if (<a class="var it27131" onMouseOver="hilite(27131)" onMouseOut="lolite()" onClick="logVariable('hasalpha')" href="../../_variables/hasalpha.html">$hasalpha</a>) {
<a name="l1843"><span class="linenum">1843</span></a>  <span class="comment">            // Just copy to the new image with the alpha channel.</span>
<a name="l1844"><span class="linenum">1844</span></a>              if (!<a class="phpfunction" onClick="logFunction('imagecopy')" href="../../_functions/imagecopy.html" onMouseOver="phpfuncPopup(event,'imagecopy')">imagecopy</a>(<a class="var it27130" onMouseOver="hilite(27130)" onMouseOut="lolite()" onClick="logVariable('newimg')" href="../../_variables/newimg.html">$newimg</a>, <a class="var it8104" onMouseOver="hilite(8104)" onMouseOut="lolite()" onClick="logVariable('img')" href="../../_variables/img.html">$img</a>, 0, 0, 0, 0, <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('width')" href="../../_variables/width.html">$width</a>, <a class="var it293" onMouseOver="hilite(293)" onMouseOut="lolite()" onClick="logVariable('height')" href="../../_variables/height.html">$height</a>)) {
<a name="l1845"><span class="linenum">1845</span></a>  <span class="comment">                // Weird.</span>
<a name="l1846"><span class="linenum">1846</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Can not copy image');
<a name="l1847"><span class="linenum">1847</span></a>              }
<a name="l1848"><span class="linenum">1848</span></a>              <a class="phpfunction" onClick="logFunction('imagedestroy')" href="../../_functions/imagedestroy.html" onMouseOver="phpfuncPopup(event,'imagedestroy')">imagedestroy</a>(<a class="var it8104" onMouseOver="hilite(8104)" onMouseOut="lolite()" onClick="logVariable('img')" href="../../_variables/img.html">$img</a>);
<a name="l1849"><span class="linenum">1849</span></a>              <a class="var it8104" onMouseOver="hilite(8104)" onMouseOut="lolite()" onClick="logVariable('img')" href="../../_variables/img.html">$img</a> = <a class="var it27130" onMouseOver="hilite(27130)" onMouseOut="lolite()" onClick="logVariable('newimg')" href="../../_variables/newimg.html">$newimg</a>;
<a name="l1850"><span class="linenum">1850</span></a>  
<a name="l1851"><span class="linenum">1851</span></a>          } else {
<a name="l1852"><span class="linenum">1852</span></a>  <span class="comment">            // No particular processing needed for the original image.</span>
<a name="l1853"><span class="linenum">1853</span></a>              <a class="phpfunction" onClick="logFunction('imagedestroy')" href="../../_functions/imagedestroy.html" onMouseOver="phpfuncPopup(event,'imagedestroy')">imagedestroy</a>(<a class="var it27130" onMouseOver="hilite(27130)" onMouseOut="lolite()" onClick="logVariable('newimg')" href="../../_variables/newimg.html">$newimg</a>);
<a name="l1854"><span class="linenum">1854</span></a>          }
<a name="l1855"><span class="linenum">1855</span></a>  
<a name="l1856"><span class="linenum">1856</span></a>          <a class="phpfunction" onClick="logFunction('ob_start')" href="../../_functions/ob_start.html" onMouseOver="phpfuncPopup(event,'ob_start')">ob_start</a>();
<a name="l1857"><span class="linenum">1857</span></a>          switch (<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>['mimetype']) {
<a name="l1858"><span class="linenum">1858</span></a>              case 'image/gif':
<a name="l1859"><span class="linenum">1859</span></a>                  <a class="phpfunction" onClick="logFunction('imagegif')" href="../../_functions/imagegif.html" onMouseOver="phpfuncPopup(event,'imagegif')">imagegif</a>(<a class="var it8104" onMouseOver="hilite(8104)" onMouseOut="lolite()" onClick="logVariable('img')" href="../../_variables/img.html">$img</a>);
<a name="l1860"><span class="linenum">1860</span></a>                  break;
<a name="l1861"><span class="linenum">1861</span></a>  
<a name="l1862"><span class="linenum">1862</span></a>              case 'image/jpeg':
<a name="l1863"><span class="linenum">1863</span></a>                  if (<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it877" onMouseOver="hilite(877)" onMouseOut="lolite()" onClick="logVariable('quality')" href="../../_variables/quality.html">$quality</a>)) {
<a name="l1864"><span class="linenum">1864</span></a>                      <a class="phpfunction" onClick="logFunction('imagejpeg')" href="../../_functions/imagejpeg.html" onMouseOver="phpfuncPopup(event,'imagejpeg')">imagejpeg</a>(<a class="var it8104" onMouseOver="hilite(8104)" onMouseOut="lolite()" onClick="logVariable('img')" href="../../_variables/img.html">$img</a>);
<a name="l1865"><span class="linenum">1865</span></a>                  } else {
<a name="l1866"><span class="linenum">1866</span></a>                      <a class="phpfunction" onClick="logFunction('imagejpeg')" href="../../_functions/imagejpeg.html" onMouseOver="phpfuncPopup(event,'imagejpeg')">imagejpeg</a>(<a class="var it8104" onMouseOver="hilite(8104)" onMouseOut="lolite()" onClick="logVariable('img')" href="../../_variables/img.html">$img</a>, NULL, <a class="var it877" onMouseOver="hilite(877)" onMouseOut="lolite()" onClick="logVariable('quality')" href="../../_variables/quality.html">$quality</a>);
<a name="l1867"><span class="linenum">1867</span></a>                  }
<a name="l1868"><span class="linenum">1868</span></a>                  break;
<a name="l1869"><span class="linenum">1869</span></a>  
<a name="l1870"><span class="linenum">1870</span></a>              case 'image/png':
<a name="l1871"><span class="linenum">1871</span></a>                  <a class="var it877" onMouseOver="hilite(877)" onMouseOut="lolite()" onClick="logVariable('quality')" href="../../_variables/quality.html">$quality</a> = (int)<a class="var it877" onMouseOver="hilite(877)" onMouseOut="lolite()" onClick="logVariable('quality')" href="../../_variables/quality.html">$quality</a>;
<a name="l1872"><span class="linenum">1872</span></a>  
<a name="l1873"><span class="linenum">1873</span></a>  <span class="comment">                // Woah nelly! Because PNG quality is in the range 0 - 9 compared to JPEG quality,</span>
<a name="l1874"><span class="linenum">1874</span></a>  <span class="comment">                // the latter of which can go to 100, we need to make sure that quality here is</span>
<a name="l1875"><span class="linenum">1875</span></a>  <span class="comment">                // in a safe range or PHP WILL CRASH AND DIE. You have been warned.</span>
<a name="l1876"><span class="linenum">1876</span></a>                  <a class="var it877" onMouseOver="hilite(877)" onMouseOut="lolite()" onClick="logVariable('quality')" href="../../_variables/quality.html">$quality</a> = <a class="var it877" onMouseOver="hilite(877)" onMouseOut="lolite()" onClick="logVariable('quality')" href="../../_variables/quality.html">$quality</a> &gt; 9 ? (int)(<a class="phpfunction" onClick="logFunction('max')" href="../../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">max</a>(1.0, (float)<a class="var it877" onMouseOver="hilite(877)" onMouseOut="lolite()" onClick="logVariable('quality')" href="../../_variables/quality.html">$quality</a> / 100.0) * 9.0) : <a class="var it877" onMouseOver="hilite(877)" onMouseOut="lolite()" onClick="logVariable('quality')" href="../../_variables/quality.html">$quality</a>;
<a name="l1877"><span class="linenum">1877</span></a>                  <a class="phpfunction" onClick="logFunction('imagepng')" href="../../_functions/imagepng.html" onMouseOver="phpfuncPopup(event,'imagepng')">imagepng</a>(<a class="var it8104" onMouseOver="hilite(8104)" onMouseOut="lolite()" onClick="logVariable('img')" href="../../_variables/img.html">$img</a>, NULL, <a class="var it877" onMouseOver="hilite(877)" onMouseOut="lolite()" onClick="logVariable('quality')" href="../../_variables/quality.html">$quality</a>, NULL);
<a name="l1878"><span class="linenum">1878</span></a>                  break;
<a name="l1879"><span class="linenum">1879</span></a>  
<a name="l1880"><span class="linenum">1880</span></a>              default:
<a name="l1881"><span class="linenum">1881</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Unsupported mime type');
<a name="l1882"><span class="linenum">1882</span></a>          }
<a name="l1883"><span class="linenum">1883</span></a>  
<a name="l1884"><span class="linenum">1884</span></a>          <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a> = <a class="phpfunction" onClick="logFunction('ob_get_contents')" href="../../_functions/ob_get_contents.html" onMouseOver="phpfuncPopup(event,'ob_get_contents')">ob_get_contents</a>();
<a name="l1885"><span class="linenum">1885</span></a>          <a class="phpfunction" onClick="logFunction('ob_end_clean')" href="../../_functions/ob_end_clean.html" onMouseOver="phpfuncPopup(event,'ob_end_clean')">ob_end_clean</a>();
<a name="l1886"><span class="linenum">1886</span></a>          <a class="phpfunction" onClick="logFunction('imagedestroy')" href="../../_functions/imagedestroy.html" onMouseOver="phpfuncPopup(event,'imagedestroy')">imagedestroy</a>(<a class="var it8104" onMouseOver="hilite(8104)" onMouseOut="lolite()" onClick="logVariable('img')" href="../../_variables/img.html">$img</a>);
<a name="l1887"><span class="linenum">1887</span></a>  
<a name="l1888"><span class="linenum">1888</span></a>          if (!<a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>) {
<a name="l1889"><span class="linenum">1889</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfileproblem', 'Can not convert image');
<a name="l1890"><span class="linenum">1890</span></a>          }
<a name="l1891"><span class="linenum">1891</span></a>  
<a name="l1892"><span class="linenum">1892</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('create_file_from_string')" href="../../_functions/create_file_from_string.html" onMouseOver="funcPopup(event,'create_file_from_string')">create_file_from_string</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>, <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>);
<a name="l1893"><span class="linenum">1893</span></a>      }
<a name="l1894"><span class="linenum">1894</span></a>  
<a name="l1895"><span class="linenum">1895</span></a>      <span class="comment">/**</span>
<a name="l1896"><span class="linenum">1896</span></a>  <span class="comment">     * Add file content to sha1 pool.</span>
<a name="l1897"><span class="linenum">1897</span></a>  <span class="comment">     *</span>
<a name="l1898"><span class="linenum">1898</span></a>  <span class="comment">     * @param string $pathname path to file</span>
<a name="l1899"><span class="linenum">1899</span></a>  <span class="comment">     * @param string $contenthash sha1 hash of content if known (performance only)</span>
<a name="l1900"><span class="linenum">1900</span></a>  <span class="comment">     * @return array (contenthash, filesize, newfile)</span>
<a name="l1901"><span class="linenum">1901</span></a>  <span class="comment">     */</span>
<a name="l1902"><span class="linenum">1902</span></a>      public function <a class="function" onClick="logFunction('add_file_to_pool')" href="../../_functions/add_file_to_pool.html" onMouseOver="funcPopup(event,'add_file_to_pool')">add_file_to_pool</a>(<a class="var it801" onMouseOver="hilite(801)" onMouseOut="lolite()" onClick="logVariable('pathname')" href="../../_variables/pathname.html">$pathname</a>, <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a> = NULL) {
<a name="l1903"><span class="linenum">1903</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l1904"><span class="linenum">1904</span></a>  
<a name="l1905"><span class="linenum">1905</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_readable')" href="../../_functions/is_readable.html" onMouseOver="phpfuncPopup(event,'is_readable')">is_readable</a>(<a class="var it801" onMouseOver="hilite(801)" onMouseOut="lolite()" onClick="logVariable('pathname')" href="../../_variables/pathname.html">$pathname</a>)) {
<a name="l1906"><span class="linenum">1906</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfilecannotread', '', <a class="var it801" onMouseOver="hilite(801)" onMouseOut="lolite()" onClick="logVariable('pathname')" href="../../_variables/pathname.html">$pathname</a>);
<a name="l1907"><span class="linenum">1907</span></a>          }
<a name="l1908"><span class="linenum">1908</span></a>  
<a name="l1909"><span class="linenum">1909</span></a>          <a class="var it809" onMouseOver="hilite(809)" onMouseOut="lolite()" onClick="logVariable('filesize')" href="../../_variables/filesize.html">$filesize</a> = <a class="phpfunction" onClick="logFunction('filesize')" href="../../_functions/filesize.html" onMouseOver="phpfuncPopup(event,'filesize')">filesize</a>(<a class="var it801" onMouseOver="hilite(801)" onMouseOut="lolite()" onClick="logVariable('pathname')" href="../../_variables/pathname.html">$pathname</a>);
<a name="l1910"><span class="linenum">1910</span></a>          if (<a class="var it809" onMouseOver="hilite(809)" onMouseOut="lolite()" onClick="logVariable('filesize')" href="../../_variables/filesize.html">$filesize</a> === false) {
<a name="l1911"><span class="linenum">1911</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfilecannotread', '', <a class="var it801" onMouseOver="hilite(801)" onMouseOut="lolite()" onClick="logVariable('pathname')" href="../../_variables/pathname.html">$pathname</a>);
<a name="l1912"><span class="linenum">1912</span></a>          }
<a name="l1913"><span class="linenum">1913</span></a>  
<a name="l1914"><span class="linenum">1914</span></a>          if (<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>)) {
<a name="l1915"><span class="linenum">1915</span></a>              <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a> = <a class="phpfunction" onClick="logFunction('sha1_file')" href="../../_functions/sha1_file.html" onMouseOver="phpfuncPopup(event,'sha1_file')">sha1_file</a>(<a class="var it801" onMouseOver="hilite(801)" onMouseOut="lolite()" onClick="logVariable('pathname')" href="../../_variables/pathname.html">$pathname</a>);
<a name="l1916"><span class="linenum">1916</span></a>          } else if (<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('debugdeveloper')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/debugdeveloper.html">debugdeveloper</a>) {
<a name="l1917"><span class="linenum">1917</span></a>              <a class="var it2754" onMouseOver="hilite(2754)" onMouseOut="lolite()" onClick="logVariable('filehash')" href="../../_variables/filehash.html">$filehash</a> = <a class="phpfunction" onClick="logFunction('sha1_file')" href="../../_functions/sha1_file.html" onMouseOver="phpfuncPopup(event,'sha1_file')">sha1_file</a>(<a class="var it801" onMouseOver="hilite(801)" onMouseOut="lolite()" onClick="logVariable('pathname')" href="../../_variables/pathname.html">$pathname</a>);
<a name="l1918"><span class="linenum">1918</span></a>              if (<a class="var it2754" onMouseOver="hilite(2754)" onMouseOut="lolite()" onClick="logVariable('filehash')" href="../../_variables/filehash.html">$filehash</a> === false) {
<a name="l1919"><span class="linenum">1919</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfilecannotread', '', <a class="var it801" onMouseOver="hilite(801)" onMouseOut="lolite()" onClick="logVariable('pathname')" href="../../_variables/pathname.html">$pathname</a>);
<a name="l1920"><span class="linenum">1920</span></a>              }
<a name="l1921"><span class="linenum">1921</span></a>              if (<a class="var it2754" onMouseOver="hilite(2754)" onMouseOut="lolite()" onClick="logVariable('filehash')" href="../../_variables/filehash.html">$filehash</a> !== <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>) {
<a name="l1922"><span class="linenum">1922</span></a>  <span class="comment">                // Hopefully this never happens, if yes we need to fix calling code.</span>
<a name="l1923"><span class="linenum">1923</span></a>                  <a class="function" onClick="logFunction('debugging')" href="../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>(&quot;Invalid contenthash submitted for file <a class="var it801" onMouseOver="hilite(801)" onMouseOut="lolite()" onClick="logVariable('pathname')" href="../../_variables/pathname.html">$pathname</a>&quot;, <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l1924"><span class="linenum">1924</span></a>                  <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a> = <a class="var it2754" onMouseOver="hilite(2754)" onMouseOut="lolite()" onClick="logVariable('filehash')" href="../../_variables/filehash.html">$filehash</a>;
<a name="l1925"><span class="linenum">1925</span></a>              }
<a name="l1926"><span class="linenum">1926</span></a>          }
<a name="l1927"><span class="linenum">1927</span></a>          if (<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a> === false) {
<a name="l1928"><span class="linenum">1928</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfilecannotread', '', <a class="var it801" onMouseOver="hilite(801)" onMouseOut="lolite()" onClick="logVariable('pathname')" href="../../_variables/pathname.html">$pathname</a>);
<a name="l1929"><span class="linenum">1929</span></a>          }
<a name="l1930"><span class="linenum">1930</span></a>  
<a name="l1931"><span class="linenum">1931</span></a>          if (<a class="var it809" onMouseOver="hilite(809)" onMouseOut="lolite()" onClick="logVariable('filesize')" href="../../_variables/filesize.html">$filesize</a> &gt; 0 and <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a> === <a class="phpfunction" onClick="logFunction('sha1')" href="../../_functions/sha1.html" onMouseOver="phpfuncPopup(event,'sha1')">sha1</a>('')) {
<a name="l1932"><span class="linenum">1932</span></a>  <span class="comment">            // Did the file change or is sha1_file() borked for this file?</span>
<a name="l1933"><span class="linenum">1933</span></a>              <a class="phpfunction" onClick="logFunction('clearstatcache')" href="../../_functions/clearstatcache.html" onMouseOver="phpfuncPopup(event,'clearstatcache')">clearstatcache</a>();
<a name="l1934"><span class="linenum">1934</span></a>              <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a> = <a class="phpfunction" onClick="logFunction('sha1_file')" href="../../_functions/sha1_file.html" onMouseOver="phpfuncPopup(event,'sha1_file')">sha1_file</a>(<a class="var it801" onMouseOver="hilite(801)" onMouseOut="lolite()" onClick="logVariable('pathname')" href="../../_variables/pathname.html">$pathname</a>);
<a name="l1935"><span class="linenum">1935</span></a>              <a class="var it809" onMouseOver="hilite(809)" onMouseOut="lolite()" onClick="logVariable('filesize')" href="../../_variables/filesize.html">$filesize</a> = <a class="phpfunction" onClick="logFunction('filesize')" href="../../_functions/filesize.html" onMouseOver="phpfuncPopup(event,'filesize')">filesize</a>(<a class="var it801" onMouseOver="hilite(801)" onMouseOut="lolite()" onClick="logVariable('pathname')" href="../../_variables/pathname.html">$pathname</a>);
<a name="l1936"><span class="linenum">1936</span></a>  
<a name="l1937"><span class="linenum">1937</span></a>              if (<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a> === false or <a class="var it809" onMouseOver="hilite(809)" onMouseOut="lolite()" onClick="logVariable('filesize')" href="../../_variables/filesize.html">$filesize</a> === false) {
<a name="l1938"><span class="linenum">1938</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfilecannotread', '', <a class="var it801" onMouseOver="hilite(801)" onMouseOut="lolite()" onClick="logVariable('pathname')" href="../../_variables/pathname.html">$pathname</a>);
<a name="l1939"><span class="linenum">1939</span></a>              }
<a name="l1940"><span class="linenum">1940</span></a>              if (<a class="var it809" onMouseOver="hilite(809)" onMouseOut="lolite()" onClick="logVariable('filesize')" href="../../_variables/filesize.html">$filesize</a> &gt; 0 and <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a> === <a class="phpfunction" onClick="logFunction('sha1')" href="../../_functions/sha1.html" onMouseOver="phpfuncPopup(event,'sha1')">sha1</a>('')) {
<a name="l1941"><span class="linenum">1941</span></a>  <span class="comment">                // This is very weird...</span>
<a name="l1942"><span class="linenum">1942</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfilecannotread', '', <a class="var it801" onMouseOver="hilite(801)" onMouseOut="lolite()" onClick="logVariable('pathname')" href="../../_variables/pathname.html">$pathname</a>);
<a name="l1943"><span class="linenum">1943</span></a>              }
<a name="l1944"><span class="linenum">1944</span></a>          }
<a name="l1945"><span class="linenum">1945</span></a>  
<a name="l1946"><span class="linenum">1946</span></a>          <a class="var it27132" onMouseOver="hilite(27132)" onMouseOut="lolite()" onClick="logVariable('hashpath')" href="../../_variables/hashpath.html">$hashpath</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('path_from_hash')" href="../../_functions/path_from_hash.html" onMouseOver="funcPopup(event,'path_from_hash')">path_from_hash</a>(<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>);
<a name="l1947"><span class="linenum">1947</span></a>          <a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a> = &quot;<a class="var it27132" onMouseOver="hilite(27132)" onMouseOut="lolite()" onClick="logVariable('hashpath')" href="../../_variables/hashpath.html">$hashpath</a>/<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>&quot;;
<a name="l1948"><span class="linenum">1948</span></a>  
<a name="l1949"><span class="linenum">1949</span></a>          <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('newfile')" href="../../_variables/newfile.html">$newfile</a> = true;
<a name="l1950"><span class="linenum">1950</span></a>  
<a name="l1951"><span class="linenum">1951</span></a>          if (<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>)) {
<a name="l1952"><span class="linenum">1952</span></a>              if (<a class="phpfunction" onClick="logFunction('filesize')" href="../../_functions/filesize.html" onMouseOver="phpfuncPopup(event,'filesize')">filesize</a>(<a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>) === <a class="var it809" onMouseOver="hilite(809)" onMouseOut="lolite()" onClick="logVariable('filesize')" href="../../_variables/filesize.html">$filesize</a>) {
<a name="l1953"><span class="linenum">1953</span></a>                  return array(<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>, <a class="var it809" onMouseOver="hilite(809)" onMouseOut="lolite()" onClick="logVariable('filesize')" href="../../_variables/filesize.html">$filesize</a>, false);
<a name="l1954"><span class="linenum">1954</span></a>              }
<a name="l1955"><span class="linenum">1955</span></a>              if (<a class="phpfunction" onClick="logFunction('sha1_file')" href="../../_functions/sha1_file.html" onMouseOver="phpfuncPopup(event,'sha1_file')">sha1_file</a>(<a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>) === <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>) {
<a name="l1956"><span class="linenum">1956</span></a>  <span class="comment">                // Jackpot! We have a sha1 collision.</span>
<a name="l1957"><span class="linenum">1957</span></a>                  <a class="phpfunction" onClick="logFunction('mkdir')" href="../../_functions/mkdir.html" onMouseOver="phpfuncPopup(event,'mkdir')">mkdir</a>(&quot;<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('filedir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/filedir.html">filedir</a>/jackpot/&quot;, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dirpermissions')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/dirpermissions.html">dirpermissions</a>, true);
<a name="l1958"><span class="linenum">1958</span></a>                  <a class="phpfunction" onClick="logFunction('copy')" href="../../_functions/copy.html" onMouseOver="phpfuncPopup(event,'copy')">copy</a>(<a class="var it801" onMouseOver="hilite(801)" onMouseOut="lolite()" onClick="logVariable('pathname')" href="../../_variables/pathname.html">$pathname</a>, &quot;<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('filedir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/filedir.html">filedir</a>/jackpot/{<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>}_1&quot;);
<a name="l1959"><span class="linenum">1959</span></a>                  <a class="phpfunction" onClick="logFunction('copy')" href="../../_functions/copy.html" onMouseOver="phpfuncPopup(event,'copy')">copy</a>(<a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>, &quot;<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('filedir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/filedir.html">filedir</a>/jackpot/{<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>}_2&quot;);
<a name="l1960"><span class="linenum">1960</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_pool_content_exception')" href="../../_classes/file_pool_content_exception.html" onMouseOver="classPopup(event,'file_pool_content_exception')">file_pool_content_exception</a>(<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>);
<a name="l1961"><span class="linenum">1961</span></a>              }
<a name="l1962"><span class="linenum">1962</span></a>              <a class="function" onClick="logFunction('debugging')" href="../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>(&quot;Replacing invalid content file <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>&quot;);
<a name="l1963"><span class="linenum">1963</span></a>              <a class="phpfunction" onClick="logFunction('unlink')" href="../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>(<a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>);
<a name="l1964"><span class="linenum">1964</span></a>              <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('newfile')" href="../../_variables/newfile.html">$newfile</a> = false;
<a name="l1965"><span class="linenum">1965</span></a>          }
<a name="l1966"><span class="linenum">1966</span></a>  
<a name="l1967"><span class="linenum">1967</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_dir')" href="../../_functions/is_dir.html" onMouseOver="phpfuncPopup(event,'is_dir')">is_dir</a>(<a class="var it27132" onMouseOver="hilite(27132)" onMouseOut="lolite()" onClick="logVariable('hashpath')" href="../../_variables/hashpath.html">$hashpath</a>)) {
<a name="l1968"><span class="linenum">1968</span></a>              if (!<a class="phpfunction" onClick="logFunction('mkdir')" href="../../_functions/mkdir.html" onMouseOver="phpfuncPopup(event,'mkdir')">mkdir</a>(<a class="var it27132" onMouseOver="hilite(27132)" onMouseOut="lolite()" onClick="logVariable('hashpath')" href="../../_variables/hashpath.html">$hashpath</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dirpermissions')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/dirpermissions.html">dirpermissions</a>, true)) {
<a name="l1969"><span class="linenum">1969</span></a>  <span class="comment">                // Permission trouble.</span>
<a name="l1970"><span class="linenum">1970</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfilecannotcreatefiledirs');
<a name="l1971"><span class="linenum">1971</span></a>              }
<a name="l1972"><span class="linenum">1972</span></a>          }
<a name="l1973"><span class="linenum">1973</span></a>  
<a name="l1974"><span class="linenum">1974</span></a>  <span class="comment">        // Let's try to prevent some race conditions.</span>
<a name="l1975"><span class="linenum">1975</span></a>  
<a name="l1976"><span class="linenum">1976</span></a>          <a class="var it3959" onMouseOver="hilite(3959)" onMouseOut="lolite()" onClick="logVariable('prev')" href="../../_variables/prev.html">$prev</a> = <a class="phpfunction" onClick="logFunction('ignore_user_abort')" href="../../_functions/ignore_user_abort.html" onMouseOver="phpfuncPopup(event,'ignore_user_abort')">ignore_user_abort</a>(true);
<a name="l1977"><span class="linenum">1977</span></a>          @<a class="phpfunction" onClick="logFunction('unlink')" href="../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>(<a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>.'.tmp');
<a name="l1978"><span class="linenum">1978</span></a>          if (!<a class="phpfunction" onClick="logFunction('copy')" href="../../_functions/copy.html" onMouseOver="phpfuncPopup(event,'copy')">copy</a>(<a class="var it801" onMouseOver="hilite(801)" onMouseOut="lolite()" onClick="logVariable('pathname')" href="../../_variables/pathname.html">$pathname</a>, <a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>.'.tmp')) {
<a name="l1979"><span class="linenum">1979</span></a>  <span class="comment">            // Borked permissions or out of disk space.</span>
<a name="l1980"><span class="linenum">1980</span></a>              <a class="phpfunction" onClick="logFunction('ignore_user_abort')" href="../../_functions/ignore_user_abort.html" onMouseOver="phpfuncPopup(event,'ignore_user_abort')">ignore_user_abort</a>(<a class="var it3959" onMouseOver="hilite(3959)" onMouseOut="lolite()" onClick="logVariable('prev')" href="../../_variables/prev.html">$prev</a>);
<a name="l1981"><span class="linenum">1981</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfilecannotcreatefile');
<a name="l1982"><span class="linenum">1982</span></a>          }
<a name="l1983"><span class="linenum">1983</span></a>          if (<a class="phpfunction" onClick="logFunction('filesize')" href="../../_functions/filesize.html" onMouseOver="phpfuncPopup(event,'filesize')">filesize</a>(<a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>.'.tmp') !== <a class="var it809" onMouseOver="hilite(809)" onMouseOut="lolite()" onClick="logVariable('filesize')" href="../../_variables/filesize.html">$filesize</a>) {
<a name="l1984"><span class="linenum">1984</span></a>  <span class="comment">            // This should not happen.</span>
<a name="l1985"><span class="linenum">1985</span></a>              <a class="phpfunction" onClick="logFunction('unlink')" href="../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>(<a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>.'.tmp');
<a name="l1986"><span class="linenum">1986</span></a>              <a class="phpfunction" onClick="logFunction('ignore_user_abort')" href="../../_functions/ignore_user_abort.html" onMouseOver="phpfuncPopup(event,'ignore_user_abort')">ignore_user_abort</a>(<a class="var it3959" onMouseOver="hilite(3959)" onMouseOut="lolite()" onClick="logVariable('prev')" href="../../_variables/prev.html">$prev</a>);
<a name="l1987"><span class="linenum">1987</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfilecannotcreatefile');
<a name="l1988"><span class="linenum">1988</span></a>          }
<a name="l1989"><span class="linenum">1989</span></a>          <a class="phpfunction" onClick="logFunction('rename')" href="../../_functions/rename.html" onMouseOver="phpfuncPopup(event,'rename')">rename</a>(<a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>.'.tmp', <a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>);
<a name="l1990"><span class="linenum">1990</span></a>          <a class="phpfunction" onClick="logFunction('chmod')" href="../../_functions/chmod.html" onMouseOver="phpfuncPopup(event,'chmod')">chmod</a>(<a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('filepermissions')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/filepermissions.html">filepermissions</a>); <span class="comment">// Fix permissions if needed.</span>
<a name="l1991"><span class="linenum">1991</span></a>          @<a class="phpfunction" onClick="logFunction('unlink')" href="../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>(<a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>.'.tmp'); <span class="comment">// Just in case anything fails in a weird way.</span>
<a name="l1992"><span class="linenum">1992</span></a>          <a class="phpfunction" onClick="logFunction('ignore_user_abort')" href="../../_functions/ignore_user_abort.html" onMouseOver="phpfuncPopup(event,'ignore_user_abort')">ignore_user_abort</a>(<a class="var it3959" onMouseOver="hilite(3959)" onMouseOut="lolite()" onClick="logVariable('prev')" href="../../_variables/prev.html">$prev</a>);
<a name="l1993"><span class="linenum">1993</span></a>  
<a name="l1994"><span class="linenum">1994</span></a>          return array(<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>, <a class="var it809" onMouseOver="hilite(809)" onMouseOut="lolite()" onClick="logVariable('filesize')" href="../../_variables/filesize.html">$filesize</a>, <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('newfile')" href="../../_variables/newfile.html">$newfile</a>);
<a name="l1995"><span class="linenum">1995</span></a>      }
<a name="l1996"><span class="linenum">1996</span></a>  
<a name="l1997"><span class="linenum">1997</span></a>      <span class="comment">/**</span>
<a name="l1998"><span class="linenum">1998</span></a>  <span class="comment">     * Add string content to sha1 pool.</span>
<a name="l1999"><span class="linenum">1999</span></a>  <span class="comment">     *</span>
<a name="l2000"><span class="linenum">2000</span></a>  <span class="comment">     * @param string $content file content - binary string</span>
<a name="l2001"><span class="linenum">2001</span></a>  <span class="comment">     * @return array (contenthash, filesize, newfile)</span>
<a name="l2002"><span class="linenum">2002</span></a>  <span class="comment">     */</span>
<a name="l2003"><span class="linenum">2003</span></a>      public function <a class="function" onClick="logFunction('add_string_to_pool')" href="../../_functions/add_string_to_pool.html" onMouseOver="funcPopup(event,'add_string_to_pool')">add_string_to_pool</a>(<a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>) {
<a name="l2004"><span class="linenum">2004</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l2005"><span class="linenum">2005</span></a>  
<a name="l2006"><span class="linenum">2006</span></a>          <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a> = <a class="phpfunction" onClick="logFunction('sha1')" href="../../_functions/sha1.html" onMouseOver="phpfuncPopup(event,'sha1')">sha1</a>(<a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>);
<a name="l2007"><span class="linenum">2007</span></a>          <a class="var it809" onMouseOver="hilite(809)" onMouseOut="lolite()" onClick="logVariable('filesize')" href="../../_variables/filesize.html">$filesize</a> = <a class="function" onClick="logFunction('strlen')" href="../../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>); <span class="comment">// binary length</span>
<a name="l2008"><span class="linenum">2008</span></a>  
<a name="l2009"><span class="linenum">2009</span></a>          <a class="var it27132" onMouseOver="hilite(27132)" onMouseOut="lolite()" onClick="logVariable('hashpath')" href="../../_variables/hashpath.html">$hashpath</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('path_from_hash')" href="../../_functions/path_from_hash.html" onMouseOver="funcPopup(event,'path_from_hash')">path_from_hash</a>(<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>);
<a name="l2010"><span class="linenum">2010</span></a>          <a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a> = &quot;<a class="var it27132" onMouseOver="hilite(27132)" onMouseOut="lolite()" onClick="logVariable('hashpath')" href="../../_variables/hashpath.html">$hashpath</a>/<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>&quot;;
<a name="l2011"><span class="linenum">2011</span></a>  
<a name="l2012"><span class="linenum">2012</span></a>          <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('newfile')" href="../../_variables/newfile.html">$newfile</a> = true;
<a name="l2013"><span class="linenum">2013</span></a>  
<a name="l2014"><span class="linenum">2014</span></a>          if (<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>)) {
<a name="l2015"><span class="linenum">2015</span></a>              if (<a class="phpfunction" onClick="logFunction('filesize')" href="../../_functions/filesize.html" onMouseOver="phpfuncPopup(event,'filesize')">filesize</a>(<a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>) === <a class="var it809" onMouseOver="hilite(809)" onMouseOut="lolite()" onClick="logVariable('filesize')" href="../../_variables/filesize.html">$filesize</a>) {
<a name="l2016"><span class="linenum">2016</span></a>                  return array(<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>, <a class="var it809" onMouseOver="hilite(809)" onMouseOut="lolite()" onClick="logVariable('filesize')" href="../../_variables/filesize.html">$filesize</a>, false);
<a name="l2017"><span class="linenum">2017</span></a>              }
<a name="l2018"><span class="linenum">2018</span></a>              if (<a class="phpfunction" onClick="logFunction('sha1_file')" href="../../_functions/sha1_file.html" onMouseOver="phpfuncPopup(event,'sha1_file')">sha1_file</a>(<a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>) === <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>) {
<a name="l2019"><span class="linenum">2019</span></a>  <span class="comment">                // Jackpot! We have a sha1 collision.</span>
<a name="l2020"><span class="linenum">2020</span></a>                  <a class="phpfunction" onClick="logFunction('mkdir')" href="../../_functions/mkdir.html" onMouseOver="phpfuncPopup(event,'mkdir')">mkdir</a>(&quot;<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('filedir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/filedir.html">filedir</a>/jackpot/&quot;, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dirpermissions')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/dirpermissions.html">dirpermissions</a>, true);
<a name="l2021"><span class="linenum">2021</span></a>                  <a class="phpfunction" onClick="logFunction('copy')" href="../../_functions/copy.html" onMouseOver="phpfuncPopup(event,'copy')">copy</a>(<a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>, &quot;<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('filedir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/filedir.html">filedir</a>/jackpot/{<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>}_1&quot;);
<a name="l2022"><span class="linenum">2022</span></a>                  <a class="phpfunction" onClick="logFunction('file_put_contents')" href="../../_functions/file_put_contents.html" onMouseOver="phpfuncPopup(event,'file_put_contents')">file_put_contents</a>(&quot;<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('filedir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/filedir.html">filedir</a>/jackpot/{<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>}_2&quot;, <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>);
<a name="l2023"><span class="linenum">2023</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_pool_content_exception')" href="../../_classes/file_pool_content_exception.html" onMouseOver="classPopup(event,'file_pool_content_exception')">file_pool_content_exception</a>(<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>);
<a name="l2024"><span class="linenum">2024</span></a>              }
<a name="l2025"><span class="linenum">2025</span></a>              <a class="function" onClick="logFunction('debugging')" href="../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>(&quot;Replacing invalid content file <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>&quot;);
<a name="l2026"><span class="linenum">2026</span></a>              <a class="phpfunction" onClick="logFunction('unlink')" href="../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>(<a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>);
<a name="l2027"><span class="linenum">2027</span></a>              <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('newfile')" href="../../_variables/newfile.html">$newfile</a> = false;
<a name="l2028"><span class="linenum">2028</span></a>          }
<a name="l2029"><span class="linenum">2029</span></a>  
<a name="l2030"><span class="linenum">2030</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_dir')" href="../../_functions/is_dir.html" onMouseOver="phpfuncPopup(event,'is_dir')">is_dir</a>(<a class="var it27132" onMouseOver="hilite(27132)" onMouseOut="lolite()" onClick="logVariable('hashpath')" href="../../_variables/hashpath.html">$hashpath</a>)) {
<a name="l2031"><span class="linenum">2031</span></a>              if (!<a class="phpfunction" onClick="logFunction('mkdir')" href="../../_functions/mkdir.html" onMouseOver="phpfuncPopup(event,'mkdir')">mkdir</a>(<a class="var it27132" onMouseOver="hilite(27132)" onMouseOut="lolite()" onClick="logVariable('hashpath')" href="../../_variables/hashpath.html">$hashpath</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dirpermissions')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/dirpermissions.html">dirpermissions</a>, true)) {
<a name="l2032"><span class="linenum">2032</span></a>  <span class="comment">                // Permission trouble.</span>
<a name="l2033"><span class="linenum">2033</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfilecannotcreatefiledirs');
<a name="l2034"><span class="linenum">2034</span></a>              }
<a name="l2035"><span class="linenum">2035</span></a>          }
<a name="l2036"><span class="linenum">2036</span></a>  
<a name="l2037"><span class="linenum">2037</span></a>  <span class="comment">        // Hopefully this works around most potential race conditions.</span>
<a name="l2038"><span class="linenum">2038</span></a>  
<a name="l2039"><span class="linenum">2039</span></a>          <a class="var it3959" onMouseOver="hilite(3959)" onMouseOut="lolite()" onClick="logVariable('prev')" href="../../_variables/prev.html">$prev</a> = <a class="phpfunction" onClick="logFunction('ignore_user_abort')" href="../../_functions/ignore_user_abort.html" onMouseOver="phpfuncPopup(event,'ignore_user_abort')">ignore_user_abort</a>(true);
<a name="l2040"><span class="linenum">2040</span></a>  
<a name="l2041"><span class="linenum">2041</span></a>          if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('preventfilelocking')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/preventfilelocking.html">preventfilelocking</a>)) {
<a name="l2042"><span class="linenum">2042</span></a>              <a class="var it17115" onMouseOver="hilite(17115)" onMouseOut="lolite()" onClick="logVariable('newsize')" href="../../_variables/newsize.html">$newsize</a> = <a class="phpfunction" onClick="logFunction('file_put_contents')" href="../../_functions/file_put_contents.html" onMouseOver="phpfuncPopup(event,'file_put_contents')">file_put_contents</a>(<a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>.'.tmp', <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>);
<a name="l2043"><span class="linenum">2043</span></a>          } else {
<a name="l2044"><span class="linenum">2044</span></a>              <a class="var it17115" onMouseOver="hilite(17115)" onMouseOut="lolite()" onClick="logVariable('newsize')" href="../../_variables/newsize.html">$newsize</a> = <a class="phpfunction" onClick="logFunction('file_put_contents')" href="../../_functions/file_put_contents.html" onMouseOver="phpfuncPopup(event,'file_put_contents')">file_put_contents</a>(<a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>.'.tmp', <a class="var it253" onMouseOver="hilite(253)" onMouseOut="lolite()" onClick="logVariable('content')" href="../../_variables/content.html">$content</a>, LOCK_EX);
<a name="l2045"><span class="linenum">2045</span></a>          }
<a name="l2046"><span class="linenum">2046</span></a>  
<a name="l2047"><span class="linenum">2047</span></a>          if (<a class="var it17115" onMouseOver="hilite(17115)" onMouseOut="lolite()" onClick="logVariable('newsize')" href="../../_variables/newsize.html">$newsize</a> === false) {
<a name="l2048"><span class="linenum">2048</span></a>  <span class="comment">            // Borked permissions most likely.</span>
<a name="l2049"><span class="linenum">2049</span></a>              <a class="phpfunction" onClick="logFunction('ignore_user_abort')" href="../../_functions/ignore_user_abort.html" onMouseOver="phpfuncPopup(event,'ignore_user_abort')">ignore_user_abort</a>(<a class="var it3959" onMouseOver="hilite(3959)" onMouseOut="lolite()" onClick="logVariable('prev')" href="../../_variables/prev.html">$prev</a>);
<a name="l2050"><span class="linenum">2050</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfilecannotcreatefile');
<a name="l2051"><span class="linenum">2051</span></a>          }
<a name="l2052"><span class="linenum">2052</span></a>          if (<a class="phpfunction" onClick="logFunction('filesize')" href="../../_functions/filesize.html" onMouseOver="phpfuncPopup(event,'filesize')">filesize</a>(<a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>.'.tmp') !== <a class="var it809" onMouseOver="hilite(809)" onMouseOut="lolite()" onClick="logVariable('filesize')" href="../../_variables/filesize.html">$filesize</a>) {
<a name="l2053"><span class="linenum">2053</span></a>  <span class="comment">            // Out of disk space?</span>
<a name="l2054"><span class="linenum">2054</span></a>              <a class="phpfunction" onClick="logFunction('unlink')" href="../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>(<a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>.'.tmp');
<a name="l2055"><span class="linenum">2055</span></a>              <a class="phpfunction" onClick="logFunction('ignore_user_abort')" href="../../_functions/ignore_user_abort.html" onMouseOver="phpfuncPopup(event,'ignore_user_abort')">ignore_user_abort</a>(<a class="var it3959" onMouseOver="hilite(3959)" onMouseOut="lolite()" onClick="logVariable('prev')" href="../../_variables/prev.html">$prev</a>);
<a name="l2056"><span class="linenum">2056</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_exception')" href="../../_classes/file_exception.html" onMouseOver="classPopup(event,'file_exception')">file_exception</a>('storedfilecannotcreatefile');
<a name="l2057"><span class="linenum">2057</span></a>          }
<a name="l2058"><span class="linenum">2058</span></a>          <a class="phpfunction" onClick="logFunction('rename')" href="../../_functions/rename.html" onMouseOver="phpfuncPopup(event,'rename')">rename</a>(<a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>.'.tmp', <a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>);
<a name="l2059"><span class="linenum">2059</span></a>          <a class="phpfunction" onClick="logFunction('chmod')" href="../../_functions/chmod.html" onMouseOver="phpfuncPopup(event,'chmod')">chmod</a>(<a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('filepermissions')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/filepermissions.html">filepermissions</a>); <span class="comment">// Fix permissions if needed.</span>
<a name="l2060"><span class="linenum">2060</span></a>          @<a class="phpfunction" onClick="logFunction('unlink')" href="../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>(<a class="var it27133" onMouseOver="hilite(27133)" onMouseOut="lolite()" onClick="logVariable('hashfile')" href="../../_variables/hashfile.html">$hashfile</a>.'.tmp'); <span class="comment">// Just in case anything fails in a weird way.</span>
<a name="l2061"><span class="linenum">2061</span></a>          <a class="phpfunction" onClick="logFunction('ignore_user_abort')" href="../../_functions/ignore_user_abort.html" onMouseOver="phpfuncPopup(event,'ignore_user_abort')">ignore_user_abort</a>(<a class="var it3959" onMouseOver="hilite(3959)" onMouseOut="lolite()" onClick="logVariable('prev')" href="../../_variables/prev.html">$prev</a>);
<a name="l2062"><span class="linenum">2062</span></a>  
<a name="l2063"><span class="linenum">2063</span></a>          return array(<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>, <a class="var it809" onMouseOver="hilite(809)" onMouseOut="lolite()" onClick="logVariable('filesize')" href="../../_variables/filesize.html">$filesize</a>, <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('newfile')" href="../../_variables/newfile.html">$newfile</a>);
<a name="l2064"><span class="linenum">2064</span></a>      }
<a name="l2065"><span class="linenum">2065</span></a>  
<a name="l2066"><span class="linenum">2066</span></a>      <span class="comment">/**</span>
<a name="l2067"><span class="linenum">2067</span></a>  <span class="comment">     * Serve file content using X-Sendfile header.</span>
<a name="l2068"><span class="linenum">2068</span></a>  <span class="comment">     * Please make sure that all headers are already sent</span>
<a name="l2069"><span class="linenum">2069</span></a>  <span class="comment">     * and the all access control checks passed.</span>
<a name="l2070"><span class="linenum">2070</span></a>  <span class="comment">     *</span>
<a name="l2071"><span class="linenum">2071</span></a>  <span class="comment">     * @param string $contenthash sah1 hash of the file content to be served</span>
<a name="l2072"><span class="linenum">2072</span></a>  <span class="comment">     * @return bool success</span>
<a name="l2073"><span class="linenum">2073</span></a>  <span class="comment">     */</span>
<a name="l2074"><span class="linenum">2074</span></a>      public function <a class="function" onClick="logFunction('xsendfile')" href="../../_functions/xsendfile.html" onMouseOver="funcPopup(event,'xsendfile')">xsendfile</a>(<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>) {
<a name="l2075"><span class="linenum">2075</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l2076"><span class="linenum">2076</span></a>          require_once(&quot;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>/xsendfilelib.php&quot;);
<a name="l2077"><span class="linenum">2077</span></a>  
<a name="l2078"><span class="linenum">2078</span></a>          <a class="var it27132" onMouseOver="hilite(27132)" onMouseOut="lolite()" onClick="logVariable('hashpath')" href="../../_variables/hashpath.html">$hashpath</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('path_from_hash')" href="../../_functions/path_from_hash.html" onMouseOver="funcPopup(event,'path_from_hash')">path_from_hash</a>(<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>);
<a name="l2079"><span class="linenum">2079</span></a>          return <a class="function" onClick="logFunction('xsendfile')" href="../../_functions/xsendfile.html" onMouseOver="funcPopup(event,'xsendfile')">xsendfile</a>(&quot;<a class="var it27132" onMouseOver="hilite(27132)" onMouseOut="lolite()" onClick="logVariable('hashpath')" href="../../_variables/hashpath.html">$hashpath</a>/<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>&quot;);
<a name="l2080"><span class="linenum">2080</span></a>      }
<a name="l2081"><span class="linenum">2081</span></a>  
<a name="l2082"><span class="linenum">2082</span></a>      <span class="comment">/**</span>
<a name="l2083"><span class="linenum">2083</span></a>  <span class="comment">     * Content exists</span>
<a name="l2084"><span class="linenum">2084</span></a>  <span class="comment">     *</span>
<a name="l2085"><span class="linenum">2085</span></a>  <span class="comment">     * @param string $contenthash</span>
<a name="l2086"><span class="linenum">2086</span></a>  <span class="comment">     * @return bool</span>
<a name="l2087"><span class="linenum">2087</span></a>  <span class="comment">     */</span>
<a name="l2088"><span class="linenum">2088</span></a>      public function <a class="function" onClick="logFunction('content_exists')" href="../../_functions/content_exists.html" onMouseOver="funcPopup(event,'content_exists')">content_exists</a>(<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>) {
<a name="l2089"><span class="linenum">2089</span></a>          <a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('path_from_hash')" href="../../_functions/path_from_hash.html" onMouseOver="funcPopup(event,'path_from_hash')">path_from_hash</a>(<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>);
<a name="l2090"><span class="linenum">2090</span></a>          <a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a> = <a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a> . '/' . <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>;
<a name="l2091"><span class="linenum">2091</span></a>          return <a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it886" onMouseOver="hilite(886)" onMouseOut="lolite()" onClick="logVariable('filepath')" href="../../_variables/filepath.html">$filepath</a>);
<a name="l2092"><span class="linenum">2092</span></a>      }
<a name="l2093"><span class="linenum">2093</span></a>  
<a name="l2094"><span class="linenum">2094</span></a>      <span class="comment">/**</span>
<a name="l2095"><span class="linenum">2095</span></a>  <span class="comment">     * Return path to file with given hash.</span>
<a name="l2096"><span class="linenum">2096</span></a>  <span class="comment">     *</span>
<a name="l2097"><span class="linenum">2097</span></a>  <span class="comment">     * NOTE: must not be public, files in pool must not be modified</span>
<a name="l2098"><span class="linenum">2098</span></a>  <span class="comment">     *</span>
<a name="l2099"><span class="linenum">2099</span></a>  <span class="comment">     * @param string $contenthash content hash</span>
<a name="l2100"><span class="linenum">2100</span></a>  <span class="comment">     * @return string expected file location</span>
<a name="l2101"><span class="linenum">2101</span></a>  <span class="comment">     */</span>
<a name="l2102"><span class="linenum">2102</span></a>      protected function <a class="function" onClick="logFunction('path_from_hash')" href="../../_functions/path_from_hash.html" onMouseOver="funcPopup(event,'path_from_hash')">path_from_hash</a>(<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>) {
<a name="l2103"><span class="linenum">2103</span></a>          <a class="var it24030" onMouseOver="hilite(24030)" onMouseOut="lolite()" onClick="logVariable('l1')" href="../../_variables/l1.html">$l1</a> = <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>[0].<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>[1];
<a name="l2104"><span class="linenum">2104</span></a>          <a class="var it24031" onMouseOver="hilite(24031)" onMouseOut="lolite()" onClick="logVariable('l2')" href="../../_variables/l2.html">$l2</a> = <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>[2].<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>[3];
<a name="l2105"><span class="linenum">2105</span></a>          return &quot;<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('filedir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/filedir.html">filedir</a>/<a class="var it24030" onMouseOver="hilite(24030)" onMouseOut="lolite()" onClick="logVariable('l1')" href="../../_variables/l1.html">$l1</a>/<a class="var it24031" onMouseOver="hilite(24031)" onMouseOut="lolite()" onClick="logVariable('l2')" href="../../_variables/l2.html">$l2</a>&quot;;
<a name="l2106"><span class="linenum">2106</span></a>      }
<a name="l2107"><span class="linenum">2107</span></a>  
<a name="l2108"><span class="linenum">2108</span></a>      <span class="comment">/**</span>
<a name="l2109"><span class="linenum">2109</span></a>  <span class="comment">     * Return path to file with given hash.</span>
<a name="l2110"><span class="linenum">2110</span></a>  <span class="comment">     *</span>
<a name="l2111"><span class="linenum">2111</span></a>  <span class="comment">     * NOTE: must not be public, files in pool must not be modified</span>
<a name="l2112"><span class="linenum">2112</span></a>  <span class="comment">     *</span>
<a name="l2113"><span class="linenum">2113</span></a>  <span class="comment">     * @param string $contenthash content hash</span>
<a name="l2114"><span class="linenum">2114</span></a>  <span class="comment">     * @return string expected file location</span>
<a name="l2115"><span class="linenum">2115</span></a>  <span class="comment">     */</span>
<a name="l2116"><span class="linenum">2116</span></a>      protected function <a class="function" onClick="logFunction('trash_path_from_hash')" href="../../_functions/trash_path_from_hash.html" onMouseOver="funcPopup(event,'trash_path_from_hash')">trash_path_from_hash</a>(<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>) {
<a name="l2117"><span class="linenum">2117</span></a>          <a class="var it24030" onMouseOver="hilite(24030)" onMouseOut="lolite()" onClick="logVariable('l1')" href="../../_variables/l1.html">$l1</a> = <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>[0].<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>[1];
<a name="l2118"><span class="linenum">2118</span></a>          <a class="var it24031" onMouseOver="hilite(24031)" onMouseOut="lolite()" onClick="logVariable('l2')" href="../../_variables/l2.html">$l2</a> = <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>[2].<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>[3];
<a name="l2119"><span class="linenum">2119</span></a>          return &quot;<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('trashdir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/trashdir.html">trashdir</a>/<a class="var it24030" onMouseOver="hilite(24030)" onMouseOut="lolite()" onClick="logVariable('l1')" href="../../_variables/l1.html">$l1</a>/<a class="var it24031" onMouseOver="hilite(24031)" onMouseOut="lolite()" onClick="logVariable('l2')" href="../../_variables/l2.html">$l2</a>&quot;;
<a name="l2120"><span class="linenum">2120</span></a>      }
<a name="l2121"><span class="linenum">2121</span></a>  
<a name="l2122"><span class="linenum">2122</span></a>      <span class="comment">/**</span>
<a name="l2123"><span class="linenum">2123</span></a>  <span class="comment">     * Tries to recover missing content of file from trash.</span>
<a name="l2124"><span class="linenum">2124</span></a>  <span class="comment">     *</span>
<a name="l2125"><span class="linenum">2125</span></a>  <span class="comment">     * @param stored_file $file stored_file instance</span>
<a name="l2126"><span class="linenum">2126</span></a>  <span class="comment">     * @return bool success</span>
<a name="l2127"><span class="linenum">2127</span></a>  <span class="comment">     */</span>
<a name="l2128"><span class="linenum">2128</span></a>      public function <a class="function" onClick="logFunction('try_content_recovery')" href="../../_functions/try_content_recovery.html" onMouseOver="funcPopup(event,'try_content_recovery')">try_content_recovery</a>(<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>) {
<a name="l2129"><span class="linenum">2129</span></a>          <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a> = <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_contenthash')" href="../../_functions/get_contenthash.html" onMouseOver="funcPopup(event,'get_contenthash')">get_contenthash</a>();
<a name="l2130"><span class="linenum">2130</span></a>          <a class="var it27134" onMouseOver="hilite(27134)" onMouseOut="lolite()" onClick="logVariable('trashfile')" href="../../_variables/trashfile.html">$trashfile</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('trash_path_from_hash')" href="../../_functions/trash_path_from_hash.html" onMouseOver="funcPopup(event,'trash_path_from_hash')">trash_path_from_hash</a>(<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>).'/'.<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>;
<a name="l2131"><span class="linenum">2131</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_readable')" href="../../_functions/is_readable.html" onMouseOver="phpfuncPopup(event,'is_readable')">is_readable</a>(<a class="var it27134" onMouseOver="hilite(27134)" onMouseOut="lolite()" onClick="logVariable('trashfile')" href="../../_variables/trashfile.html">$trashfile</a>)) {
<a name="l2132"><span class="linenum">2132</span></a>              if (!<a class="phpfunction" onClick="logFunction('is_readable')" href="../../_functions/is_readable.html" onMouseOver="phpfuncPopup(event,'is_readable')">is_readable</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('trashdir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/trashdir.html">trashdir</a>.'/'.<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>)) {
<a name="l2133"><span class="linenum">2133</span></a>                  return false;
<a name="l2134"><span class="linenum">2134</span></a>              }
<a name="l2135"><span class="linenum">2135</span></a>  <span class="comment">            // nice, at least alternative trash file in trash root exists</span>
<a name="l2136"><span class="linenum">2136</span></a>              <a class="var it27134" onMouseOver="hilite(27134)" onMouseOut="lolite()" onClick="logVariable('trashfile')" href="../../_variables/trashfile.html">$trashfile</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('trashdir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/trashdir.html">trashdir</a>.'/'.<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>;
<a name="l2137"><span class="linenum">2137</span></a>          }
<a name="l2138"><span class="linenum">2138</span></a>          if (<a class="phpfunction" onClick="logFunction('filesize')" href="../../_functions/filesize.html" onMouseOver="phpfuncPopup(event,'filesize')">filesize</a>(<a class="var it27134" onMouseOver="hilite(27134)" onMouseOut="lolite()" onClick="logVariable('trashfile')" href="../../_variables/trashfile.html">$trashfile</a>) != <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('get_filesize')" href="../../_functions/get_filesize.html" onMouseOver="funcPopup(event,'get_filesize')">get_filesize</a>() or <a class="phpfunction" onClick="logFunction('sha1_file')" href="../../_functions/sha1_file.html" onMouseOver="phpfuncPopup(event,'sha1_file')">sha1_file</a>(<a class="var it27134" onMouseOver="hilite(27134)" onMouseOut="lolite()" onClick="logVariable('trashfile')" href="../../_variables/trashfile.html">$trashfile</a>) != <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>) {
<a name="l2139"><span class="linenum">2139</span></a>  <span class="comment">            //weird, better fail early</span>
<a name="l2140"><span class="linenum">2140</span></a>              return false;
<a name="l2141"><span class="linenum">2141</span></a>          }
<a name="l2142"><span class="linenum">2142</span></a>          <a class="var it27135" onMouseOver="hilite(27135)" onMouseOut="lolite()" onClick="logVariable('contentdir')" href="../../_variables/contentdir.html">$contentdir</a>  = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('path_from_hash')" href="../../_functions/path_from_hash.html" onMouseOver="funcPopup(event,'path_from_hash')">path_from_hash</a>(<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>);
<a name="l2143"><span class="linenum">2143</span></a>          <a class="var it3353" onMouseOver="hilite(3353)" onMouseOut="lolite()" onClick="logVariable('contentfile')" href="../../_variables/contentfile.html">$contentfile</a> = <a class="var it27135" onMouseOver="hilite(27135)" onMouseOut="lolite()" onClick="logVariable('contentdir')" href="../../_variables/contentdir.html">$contentdir</a>.'/'.<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>;
<a name="l2144"><span class="linenum">2144</span></a>          if (<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it3353" onMouseOver="hilite(3353)" onMouseOut="lolite()" onClick="logVariable('contentfile')" href="../../_variables/contentfile.html">$contentfile</a>)) {
<a name="l2145"><span class="linenum">2145</span></a>  <span class="comment">            //strange, no need to recover anything</span>
<a name="l2146"><span class="linenum">2146</span></a>              return true;
<a name="l2147"><span class="linenum">2147</span></a>          }
<a name="l2148"><span class="linenum">2148</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_dir')" href="../../_functions/is_dir.html" onMouseOver="phpfuncPopup(event,'is_dir')">is_dir</a>(<a class="var it27135" onMouseOver="hilite(27135)" onMouseOut="lolite()" onClick="logVariable('contentdir')" href="../../_variables/contentdir.html">$contentdir</a>)) {
<a name="l2149"><span class="linenum">2149</span></a>              if (!<a class="phpfunction" onClick="logFunction('mkdir')" href="../../_functions/mkdir.html" onMouseOver="phpfuncPopup(event,'mkdir')">mkdir</a>(<a class="var it27135" onMouseOver="hilite(27135)" onMouseOut="lolite()" onClick="logVariable('contentdir')" href="../../_variables/contentdir.html">$contentdir</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dirpermissions')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/dirpermissions.html">dirpermissions</a>, true)) {
<a name="l2150"><span class="linenum">2150</span></a>                  return false;
<a name="l2151"><span class="linenum">2151</span></a>              }
<a name="l2152"><span class="linenum">2152</span></a>          }
<a name="l2153"><span class="linenum">2153</span></a>          return <a class="phpfunction" onClick="logFunction('rename')" href="../../_functions/rename.html" onMouseOver="phpfuncPopup(event,'rename')">rename</a>(<a class="var it27134" onMouseOver="hilite(27134)" onMouseOut="lolite()" onClick="logVariable('trashfile')" href="../../_variables/trashfile.html">$trashfile</a>, <a class="var it3353" onMouseOver="hilite(3353)" onMouseOut="lolite()" onClick="logVariable('contentfile')" href="../../_variables/contentfile.html">$contentfile</a>);
<a name="l2154"><span class="linenum">2154</span></a>      }
<a name="l2155"><span class="linenum">2155</span></a>  
<a name="l2156"><span class="linenum">2156</span></a>      <span class="comment">/**</span>
<a name="l2157"><span class="linenum">2157</span></a>  <span class="comment">     * Marks pool file as candidate for deleting.</span>
<a name="l2158"><span class="linenum">2158</span></a>  <span class="comment">     *</span>
<a name="l2159"><span class="linenum">2159</span></a>  <span class="comment">     * DO NOT call directly - reserved for core!!</span>
<a name="l2160"><span class="linenum">2160</span></a>  <span class="comment">     *</span>
<a name="l2161"><span class="linenum">2161</span></a>  <span class="comment">     * @param string $contenthash</span>
<a name="l2162"><span class="linenum">2162</span></a>  <span class="comment">     */</span>
<a name="l2163"><span class="linenum">2163</span></a>      public function <a class="function" onClick="logFunction('deleted_file_cleanup')" href="../../_functions/deleted_file_cleanup.html" onMouseOver="funcPopup(event,'deleted_file_cleanup')">deleted_file_cleanup</a>(<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>) {
<a name="l2164"><span class="linenum">2164</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2165"><span class="linenum">2165</span></a>  
<a name="l2166"><span class="linenum">2166</span></a>          if (<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a> === <a class="phpfunction" onClick="logFunction('sha1')" href="../../_functions/sha1.html" onMouseOver="phpfuncPopup(event,'sha1')">sha1</a>('')) {
<a name="l2167"><span class="linenum">2167</span></a>  <span class="comment">            // No need to delete empty content file with sha1('') content hash.</span>
<a name="l2168"><span class="linenum">2168</span></a>              return;
<a name="l2169"><span class="linenum">2169</span></a>          }
<a name="l2170"><span class="linenum">2170</span></a>  
<a name="l2171"><span class="linenum">2171</span></a>  <span class="comment">        //Note: this section is critical - in theory file could be reused at the same</span>
<a name="l2172"><span class="linenum">2172</span></a>  <span class="comment">        //      time, if this happens we can still recover the file from trash</span>
<a name="l2173"><span class="linenum">2173</span></a>          if (<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('files', array('contenthash'=&gt;<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>))) {
<a name="l2174"><span class="linenum">2174</span></a>  <span class="comment">            // file content is still used</span>
<a name="l2175"><span class="linenum">2175</span></a>              return;
<a name="l2176"><span class="linenum">2176</span></a>          }
<a name="l2177"><span class="linenum">2177</span></a>  <span class="comment">        //move content file to trash</span>
<a name="l2178"><span class="linenum">2178</span></a>          <a class="var it3353" onMouseOver="hilite(3353)" onMouseOut="lolite()" onClick="logVariable('contentfile')" href="../../_variables/contentfile.html">$contentfile</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('path_from_hash')" href="../../_functions/path_from_hash.html" onMouseOver="funcPopup(event,'path_from_hash')">path_from_hash</a>(<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>).'/'.<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>;
<a name="l2179"><span class="linenum">2179</span></a>          if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it3353" onMouseOver="hilite(3353)" onMouseOut="lolite()" onClick="logVariable('contentfile')" href="../../_variables/contentfile.html">$contentfile</a>)) {
<a name="l2180"><span class="linenum">2180</span></a>  <span class="comment">            //weird, but no problem</span>
<a name="l2181"><span class="linenum">2181</span></a>              return;
<a name="l2182"><span class="linenum">2182</span></a>          }
<a name="l2183"><span class="linenum">2183</span></a>          <a class="var it27136" onMouseOver="hilite(27136)" onMouseOut="lolite()" onClick="logVariable('trashpath')" href="../../_variables/trashpath.html">$trashpath</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('trash_path_from_hash')" href="../../_functions/trash_path_from_hash.html" onMouseOver="funcPopup(event,'trash_path_from_hash')">trash_path_from_hash</a>(<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>);
<a name="l2184"><span class="linenum">2184</span></a>          <a class="var it27134" onMouseOver="hilite(27134)" onMouseOut="lolite()" onClick="logVariable('trashfile')" href="../../_variables/trashfile.html">$trashfile</a> = <a class="var it27136" onMouseOver="hilite(27136)" onMouseOut="lolite()" onClick="logVariable('trashpath')" href="../../_variables/trashpath.html">$trashpath</a>.'/'.<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>;
<a name="l2185"><span class="linenum">2185</span></a>          if (<a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it27134" onMouseOver="hilite(27134)" onMouseOut="lolite()" onClick="logVariable('trashfile')" href="../../_variables/trashfile.html">$trashfile</a>)) {
<a name="l2186"><span class="linenum">2186</span></a>  <span class="comment">            // we already have this content in trash, no need to move it there</span>
<a name="l2187"><span class="linenum">2187</span></a>              <a class="phpfunction" onClick="logFunction('unlink')" href="../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>(<a class="var it3353" onMouseOver="hilite(3353)" onMouseOut="lolite()" onClick="logVariable('contentfile')" href="../../_variables/contentfile.html">$contentfile</a>);
<a name="l2188"><span class="linenum">2188</span></a>              return;
<a name="l2189"><span class="linenum">2189</span></a>          }
<a name="l2190"><span class="linenum">2190</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_dir')" href="../../_functions/is_dir.html" onMouseOver="phpfuncPopup(event,'is_dir')">is_dir</a>(<a class="var it27136" onMouseOver="hilite(27136)" onMouseOut="lolite()" onClick="logVariable('trashpath')" href="../../_variables/trashpath.html">$trashpath</a>)) {
<a name="l2191"><span class="linenum">2191</span></a>              <a class="phpfunction" onClick="logFunction('mkdir')" href="../../_functions/mkdir.html" onMouseOver="phpfuncPopup(event,'mkdir')">mkdir</a>(<a class="var it27136" onMouseOver="hilite(27136)" onMouseOut="lolite()" onClick="logVariable('trashpath')" href="../../_variables/trashpath.html">$trashpath</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dirpermissions')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/dirpermissions.html">dirpermissions</a>, true);
<a name="l2192"><span class="linenum">2192</span></a>          }
<a name="l2193"><span class="linenum">2193</span></a>          <a class="phpfunction" onClick="logFunction('rename')" href="../../_functions/rename.html" onMouseOver="phpfuncPopup(event,'rename')">rename</a>(<a class="var it3353" onMouseOver="hilite(3353)" onMouseOut="lolite()" onClick="logVariable('contentfile')" href="../../_variables/contentfile.html">$contentfile</a>, <a class="var it27134" onMouseOver="hilite(27134)" onMouseOut="lolite()" onClick="logVariable('trashfile')" href="../../_variables/trashfile.html">$trashfile</a>);
<a name="l2194"><span class="linenum">2194</span></a>          <a class="phpfunction" onClick="logFunction('chmod')" href="../../_functions/chmod.html" onMouseOver="phpfuncPopup(event,'chmod')">chmod</a>(<a class="var it27134" onMouseOver="hilite(27134)" onMouseOut="lolite()" onClick="logVariable('trashfile')" href="../../_variables/trashfile.html">$trashfile</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('filepermissions')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/filepermissions.html">filepermissions</a>); <span class="comment">// fix permissions if needed</span>
<a name="l2195"><span class="linenum">2195</span></a>      }
<a name="l2196"><span class="linenum">2196</span></a>  
<a name="l2197"><span class="linenum">2197</span></a>      <span class="comment">/**</span>
<a name="l2198"><span class="linenum">2198</span></a>  <span class="comment">     * When user referring to a moodle file, we build the reference field</span>
<a name="l2199"><span class="linenum">2199</span></a>  <span class="comment">     *</span>
<a name="l2200"><span class="linenum">2200</span></a>  <span class="comment">     * @param array $params</span>
<a name="l2201"><span class="linenum">2201</span></a>  <span class="comment">     * @return string</span>
<a name="l2202"><span class="linenum">2202</span></a>  <span class="comment">     */</span>
<a name="l2203"><span class="linenum">2203</span></a>      public static function <a class="function" onClick="logFunction('pack_reference')" href="../../_functions/pack_reference.html" onMouseOver="funcPopup(event,'pack_reference')">pack_reference</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>) {
<a name="l2204"><span class="linenum">2204</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = (array)<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>;
<a name="l2205"><span class="linenum">2205</span></a>          <a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a> = array();
<a name="l2206"><span class="linenum">2206</span></a>          <a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>['contextid'] = <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['contextid']) ? null : <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['contextid'], <a class="constant" onClick="logConstant('PARAM_INT')" href="../../_constants/PARAM_INT.html" onMouseOver="constPopup(event,'PARAM_INT')">PARAM_INT</a>);
<a name="l2207"><span class="linenum">2207</span></a>          <a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>['component'] = <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['component']) ? null : <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['component'], <a class="constant" onClick="logConstant('PARAM_COMPONENT')" href="../../_constants/PARAM_COMPONENT.html" onMouseOver="constPopup(event,'PARAM_COMPONENT')">PARAM_COMPONENT</a>);
<a name="l2208"><span class="linenum">2208</span></a>          <a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>['itemid']    = <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['itemid'])    ? null : <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['itemid'],    <a class="constant" onClick="logConstant('PARAM_INT')" href="../../_constants/PARAM_INT.html" onMouseOver="constPopup(event,'PARAM_INT')">PARAM_INT</a>);
<a name="l2209"><span class="linenum">2209</span></a>          <a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>['filearea']  = <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['filearea'])  ? null : <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['filearea'],  <a class="constant" onClick="logConstant('PARAM_AREA')" href="../../_constants/PARAM_AREA.html" onMouseOver="constPopup(event,'PARAM_AREA')">PARAM_AREA</a>);
<a name="l2210"><span class="linenum">2210</span></a>          <a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>['filepath']  = <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['filepath'])  ? null : <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['filepath'],  <a class="constant" onClick="logConstant('PARAM_PATH')" href="../../_constants/PARAM_PATH.html" onMouseOver="constPopup(event,'PARAM_PATH')">PARAM_PATH</a>);
<a name="l2211"><span class="linenum">2211</span></a>          <a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>['filename']  = <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['filename'])  ? null : <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['filename'],  <a class="constant" onClick="logConstant('PARAM_FILE')" href="../../_constants/PARAM_FILE.html" onMouseOver="constPopup(event,'PARAM_FILE')">PARAM_FILE</a>);
<a name="l2212"><span class="linenum">2212</span></a>          return <a class="phpfunction" onClick="logFunction('base64_encode')" href="../../_functions/base64_encode.html" onMouseOver="phpfuncPopup(event,'base64_encode')">base64_encode</a>(<a class="phpfunction" onClick="logFunction('serialize')" href="../../_functions/serialize.html" onMouseOver="phpfuncPopup(event,'serialize')">serialize</a>(<a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>));
<a name="l2213"><span class="linenum">2213</span></a>      }
<a name="l2214"><span class="linenum">2214</span></a>  
<a name="l2215"><span class="linenum">2215</span></a>      <span class="comment">/**</span>
<a name="l2216"><span class="linenum">2216</span></a>  <span class="comment">     * Unpack reference field</span>
<a name="l2217"><span class="linenum">2217</span></a>  <span class="comment">     *</span>
<a name="l2218"><span class="linenum">2218</span></a>  <span class="comment">     * @param string $str</span>
<a name="l2219"><span class="linenum">2219</span></a>  <span class="comment">     * @param bool $cleanparams if set to true, array elements will be passed through {@link clean_param()}</span>
<a name="l2220"><span class="linenum">2220</span></a>  <span class="comment">     * @throws file_reference_exception if the $str does not have the expected format</span>
<a name="l2221"><span class="linenum">2221</span></a>  <span class="comment">     * @return array</span>
<a name="l2222"><span class="linenum">2222</span></a>  <span class="comment">     */</span>
<a name="l2223"><span class="linenum">2223</span></a>      public static function <a class="function" onClick="logFunction('unpack_reference')" href="../../_functions/unpack_reference.html" onMouseOver="funcPopup(event,'unpack_reference')">unpack_reference</a>(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>, <a class="var it27137" onMouseOver="hilite(27137)" onMouseOut="lolite()" onClick="logVariable('cleanparams')" href="../../_variables/cleanparams.html">$cleanparams</a> = false) {
<a name="l2224"><span class="linenum">2224</span></a>          <a class="var it5914" onMouseOver="hilite(5914)" onMouseOut="lolite()" onClick="logVariable('decoded')" href="../../_variables/decoded.html">$decoded</a> = <a class="phpfunction" onClick="logFunction('base64_decode')" href="../../_functions/base64_decode.html" onMouseOver="phpfuncPopup(event,'base64_decode')">base64_decode</a>(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>, true);
<a name="l2225"><span class="linenum">2225</span></a>          if (<a class="var it5914" onMouseOver="hilite(5914)" onMouseOut="lolite()" onClick="logVariable('decoded')" href="../../_variables/decoded.html">$decoded</a> === false) {
<a name="l2226"><span class="linenum">2226</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_reference_exception')" href="../../_classes/file_reference_exception.html" onMouseOver="classPopup(event,'file_reference_exception')">file_reference_exception</a>(null, <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../_variables/str.html">$str</a>, null, null, 'Invalid base64 format');
<a name="l2227"><span class="linenum">2227</span></a>          }
<a name="l2228"><span class="linenum">2228</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = @<a class="phpfunction" onClick="logFunction('unserialize')" href="../../_functions/unserialize.html" onMouseOver="phpfuncPopup(event,'unserialize')">unserialize</a>(<a class="var it5914" onMouseOver="hilite(5914)" onMouseOut="lolite()" onClick="logVariable('decoded')" href="../../_variables/decoded.html">$decoded</a>); <span class="comment">// hide E_NOTICE</span>
<a name="l2229"><span class="linenum">2229</span></a>          if (<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> === false) {
<a name="l2230"><span class="linenum">2230</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('file_reference_exception')" href="../../_classes/file_reference_exception.html" onMouseOver="classPopup(event,'file_reference_exception')">file_reference_exception</a>(null, <a class="var it5914" onMouseOver="hilite(5914)" onMouseOut="lolite()" onClick="logVariable('decoded')" href="../../_variables/decoded.html">$decoded</a>, null, null, 'Not an unserializeable value');
<a name="l2231"><span class="linenum">2231</span></a>          }
<a name="l2232"><span class="linenum">2232</span></a>          if (<a class="phpfunction" onClick="logFunction('is_array')" href="../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>) &amp;&amp; <a class="var it27137" onMouseOver="hilite(27137)" onMouseOut="lolite()" onClick="logVariable('cleanparams')" href="../../_variables/cleanparams.html">$cleanparams</a>) {
<a name="l2233"><span class="linenum">2233</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(
<a name="l2234"><span class="linenum">2234</span></a>                  'component' =&gt; <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['component']) ? ''   : <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['component'], <a class="constant" onClick="logConstant('PARAM_COMPONENT')" href="../../_constants/PARAM_COMPONENT.html" onMouseOver="constPopup(event,'PARAM_COMPONENT')">PARAM_COMPONENT</a>),
<a name="l2235"><span class="linenum">2235</span></a>                  'filearea'  =&gt; <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['filearea'])  ? ''   : <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['filearea'], <a class="constant" onClick="logConstant('PARAM_AREA')" href="../../_constants/PARAM_AREA.html" onMouseOver="constPopup(event,'PARAM_AREA')">PARAM_AREA</a>),
<a name="l2236"><span class="linenum">2236</span></a>                  'itemid'    =&gt; <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['itemid'])    ? 0    : <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['itemid'], <a class="constant" onClick="logConstant('PARAM_INT')" href="../../_constants/PARAM_INT.html" onMouseOver="constPopup(event,'PARAM_INT')">PARAM_INT</a>),
<a name="l2237"><span class="linenum">2237</span></a>                  'filename'  =&gt; <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['filename'])  ? null : <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['filename'], <a class="constant" onClick="logConstant('PARAM_FILE')" href="../../_constants/PARAM_FILE.html" onMouseOver="constPopup(event,'PARAM_FILE')">PARAM_FILE</a>),
<a name="l2238"><span class="linenum">2238</span></a>                  'filepath'  =&gt; <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['filepath'])  ? null : <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['filepath'], <a class="constant" onClick="logConstant('PARAM_PATH')" href="../../_constants/PARAM_PATH.html" onMouseOver="constPopup(event,'PARAM_PATH')">PARAM_PATH</a>),
<a name="l2239"><span class="linenum">2239</span></a>                  'contextid' =&gt; <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['contextid']) ? null : <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['contextid'], <a class="constant" onClick="logConstant('PARAM_INT')" href="../../_constants/PARAM_INT.html" onMouseOver="constPopup(event,'PARAM_INT')">PARAM_INT</a>)
<a name="l2240"><span class="linenum">2240</span></a>              );
<a name="l2241"><span class="linenum">2241</span></a>          }
<a name="l2242"><span class="linenum">2242</span></a>          return <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>;
<a name="l2243"><span class="linenum">2243</span></a>      }
<a name="l2244"><span class="linenum">2244</span></a>  
<a name="l2245"><span class="linenum">2245</span></a>      <span class="comment">/**</span>
<a name="l2246"><span class="linenum">2246</span></a>  <span class="comment">     * Search through the server files.</span>
<a name="l2247"><span class="linenum">2247</span></a>  <span class="comment">     *</span>
<a name="l2248"><span class="linenum">2248</span></a>  <span class="comment">     * The query parameter will be used in conjuction with the SQL directive</span>
<a name="l2249"><span class="linenum">2249</span></a>  <span class="comment">     * LIKE, so include '%' in it if you need to. This search will always ignore</span>
<a name="l2250"><span class="linenum">2250</span></a>  <span class="comment">     * user files and directories. Note that the search is case insensitive.</span>
<a name="l2251"><span class="linenum">2251</span></a>  <span class="comment">     *</span>
<a name="l2252"><span class="linenum">2252</span></a>  <span class="comment">     * This query can quickly become inefficient so use it sparignly.</span>
<a name="l2253"><span class="linenum">2253</span></a>  <span class="comment">     *</span>
<a name="l2254"><span class="linenum">2254</span></a>  <span class="comment">     * @param  string  $query The string used with SQL LIKE.</span>
<a name="l2255"><span class="linenum">2255</span></a>  <span class="comment">     * @param  integer $from  The offset to start the search at.</span>
<a name="l2256"><span class="linenum">2256</span></a>  <span class="comment">     * @param  integer $limit The maximum number of results.</span>
<a name="l2257"><span class="linenum">2257</span></a>  <span class="comment">     * @param  boolean $count When true this methods returns the number of results availabe,</span>
<a name="l2258"><span class="linenum">2258</span></a>  <span class="comment">     *                        disregarding the parameters $from and $limit.</span>
<a name="l2259"><span class="linenum">2259</span></a>  <span class="comment">     * @return int|array      Integer when count, otherwise array of stored_file objects.</span>
<a name="l2260"><span class="linenum">2260</span></a>  <span class="comment">     */</span>
<a name="l2261"><span class="linenum">2261</span></a>      public function <a class="function" onClick="logFunction('search_server_files')" href="../../_functions/search_server_files.html" onMouseOver="funcPopup(event,'search_server_files')">search_server_files</a>(<a class="var it249" onMouseOver="hilite(249)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a>, <a class="var it114" onMouseOver="hilite(114)" onMouseOut="lolite()" onClick="logVariable('from')" href="../../_variables/from.html">$from</a> = 0, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a> = 20, <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> = false) {
<a name="l2262"><span class="linenum">2262</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2263"><span class="linenum">2263</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(
<a name="l2264"><span class="linenum">2264</span></a>              'contextlevel' =&gt; <a class="constant" onClick="logConstant('CONTEXT_USER')" href="../../_constants/CONTEXT_USER.html" onMouseOver="constPopup(event,'CONTEXT_USER')">CONTEXT_USER</a>,
<a name="l2265"><span class="linenum">2265</span></a>              'directory' =&gt; '.',
<a name="l2266"><span class="linenum">2266</span></a>              'query' =&gt; <a class="var it249" onMouseOver="hilite(249)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a>
<a name="l2267"><span class="linenum">2267</span></a>          );
<a name="l2268"><span class="linenum">2268</span></a>  
<a name="l2269"><span class="linenum">2269</span></a>          if (<a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a>) {
<a name="l2270"><span class="linenum">2270</span></a>              <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> = '<a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(1)';
<a name="l2271"><span class="linenum">2271</span></a>          } else {
<a name="l2272"><span class="linenum">2272</span></a>              <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> = self::<a class="function" onClick="logFunction('instance_sql_fields')" href="../../_functions/instance_sql_fields.html" onMouseOver="funcPopup(event,'instance_sql_fields')">instance_sql_fields</a>('f', 'r');
<a name="l2273"><span class="linenum">2273</span></a>          }
<a name="l2274"><span class="linenum">2274</span></a>          <a class="var it12990" onMouseOver="hilite(12990)" onMouseOut="lolite()" onClick="logVariable('like')" href="../../_variables/like.html">$like</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_like')" href="../../_functions/sql_like.html" onMouseOver="funcPopup(event,'sql_like')">sql_like</a>('f.filename', ':query', false);
<a name="l2275"><span class="linenum">2275</span></a>  
<a name="l2276"><span class="linenum">2276</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a>
<a name="l2277"><span class="linenum">2277</span></a>                    FROM {files} f
<a name="l2278"><span class="linenum">2278</span></a>               LEFT JOIN {files_reference} r
<a name="l2279"><span class="linenum">2279</span></a>                      ON f.referencefileid = r.id
<a name="l2280"><span class="linenum">2280</span></a>                    JOIN {context} c
<a name="l2281"><span class="linenum">2281</span></a>                      ON f.contextid = c.id
<a name="l2282"><span class="linenum">2282</span></a>                   WHERE c.contextlevel &lt;&gt; :contextlevel
<a name="l2283"><span class="linenum">2283</span></a>                     AND f.filename &lt;&gt; :directory
<a name="l2284"><span class="linenum">2284</span></a>                     AND &quot; . <a class="var it12990" onMouseOver="hilite(12990)" onMouseOut="lolite()" onClick="logVariable('like')" href="../../_variables/like.html">$like</a> . &quot;&quot;;
<a name="l2285"><span class="linenum">2285</span></a>  
<a name="l2286"><span class="linenum">2286</span></a>          if (<a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a>) {
<a name="l2287"><span class="linenum">2287</span></a>              return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records_sql')" href="../../_functions/count_records_sql.html" onMouseOver="funcPopup(event,'count_records_sql')">count_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l2288"><span class="linenum">2288</span></a>          }
<a name="l2289"><span class="linenum">2289</span></a>  
<a name="l2290"><span class="linenum">2290</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> .= &quot; ORDER BY f.filename&quot;;
<a name="l2291"><span class="linenum">2291</span></a>  
<a name="l2292"><span class="linenum">2292</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = array();
<a name="l2293"><span class="linenum">2293</span></a>          <a class="var it27118" onMouseOver="hilite(27118)" onMouseOut="lolite()" onClick="logVariable('filerecords')" href="../../_variables/filerecords.html">$filerecords</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, <a class="var it114" onMouseOver="hilite(114)" onMouseOut="lolite()" onClick="logVariable('from')" href="../../_variables/from.html">$from</a>, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a>);
<a name="l2294"><span class="linenum">2294</span></a>          foreach (<a class="var it27118" onMouseOver="hilite(27118)" onMouseOut="lolite()" onClick="logVariable('filerecords')" href="../../_variables/filerecords.html">$filerecords</a> as <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>) {
<a name="l2295"><span class="linenum">2295</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>[<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('pathnamehash')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/pathnamehash.html">pathnamehash</a>] = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_instance')" href="../../_functions/get_file_instance.html" onMouseOver="funcPopup(event,'get_file_instance')">get_file_instance</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>);
<a name="l2296"><span class="linenum">2296</span></a>          }
<a name="l2297"><span class="linenum">2297</span></a>          <a class="var it27118" onMouseOver="hilite(27118)" onMouseOut="lolite()" onClick="logVariable('filerecords')" href="../../_variables/filerecords.html">$filerecords</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l2298"><span class="linenum">2298</span></a>  
<a name="l2299"><span class="linenum">2299</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l2300"><span class="linenum">2300</span></a>      }
<a name="l2301"><span class="linenum">2301</span></a>  
<a name="l2302"><span class="linenum">2302</span></a>      <span class="comment">/**</span>
<a name="l2303"><span class="linenum">2303</span></a>  <span class="comment">     * Returns all aliases that refer to some stored_file via the given reference</span>
<a name="l2304"><span class="linenum">2304</span></a>  <span class="comment">     *</span>
<a name="l2305"><span class="linenum">2305</span></a>  <span class="comment">     * All repositories that provide access to a stored_file are expected to use</span>
<a name="l2306"><span class="linenum">2306</span></a>  <span class="comment">     * {@link self::pack_reference()}. This method can't be used if the given reference</span>
<a name="l2307"><span class="linenum">2307</span></a>  <span class="comment">     * does not use this format or if you are looking for references to an external file</span>
<a name="l2308"><span class="linenum">2308</span></a>  <span class="comment">     * (for example it can't be used to search for all aliases that refer to a given</span>
<a name="l2309"><span class="linenum">2309</span></a>  <span class="comment">     * Dropbox or Box.net file).</span>
<a name="l2310"><span class="linenum">2310</span></a>  <span class="comment">     *</span>
<a name="l2311"><span class="linenum">2311</span></a>  <span class="comment">     * Aliases in user draft areas are excluded from the returned list.</span>
<a name="l2312"><span class="linenum">2312</span></a>  <span class="comment">     *</span>
<a name="l2313"><span class="linenum">2313</span></a>  <span class="comment">     * @param string $reference identification of the referenced file</span>
<a name="l2314"><span class="linenum">2314</span></a>  <span class="comment">     * @return array of stored_file indexed by its pathnamehash</span>
<a name="l2315"><span class="linenum">2315</span></a>  <span class="comment">     */</span>
<a name="l2316"><span class="linenum">2316</span></a>      public function <a class="function" onClick="logFunction('search_references')" href="../../_functions/search_references.html" onMouseOver="funcPopup(event,'search_references')">search_references</a>(<a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>) {
<a name="l2317"><span class="linenum">2317</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2318"><span class="linenum">2318</span></a>  
<a name="l2319"><span class="linenum">2319</span></a>          if (<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>)) {
<a name="l2320"><span class="linenum">2320</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('NULL is not a valid reference to an external file');
<a name="l2321"><span class="linenum">2321</span></a>          }
<a name="l2322"><span class="linenum">2322</span></a>  
<a name="l2323"><span class="linenum">2323</span></a>  <span class="comment">        // Give {@link self::unpack_reference()} a chance to throw exception if the</span>
<a name="l2324"><span class="linenum">2324</span></a>  <span class="comment">        // reference is not in a valid format.</span>
<a name="l2325"><span class="linenum">2325</span></a>          self::<a class="function" onClick="logFunction('unpack_reference')" href="../../_functions/unpack_reference.html" onMouseOver="funcPopup(event,'unpack_reference')">unpack_reference</a>(<a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>);
<a name="l2326"><span class="linenum">2326</span></a>  
<a name="l2327"><span class="linenum">2327</span></a>          <a class="var it27138" onMouseOver="hilite(27138)" onMouseOut="lolite()" onClick="logVariable('referencehash')" href="../../_variables/referencehash.html">$referencehash</a> = <a class="phpfunction" onClick="logFunction('sha1')" href="../../_functions/sha1.html" onMouseOver="phpfuncPopup(event,'sha1')">sha1</a>(<a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>);
<a name="l2328"><span class="linenum">2328</span></a>  
<a name="l2329"><span class="linenum">2329</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT &quot;.self::<a class="function" onClick="logFunction('instance_sql_fields')" href="../../_functions/instance_sql_fields.html" onMouseOver="funcPopup(event,'instance_sql_fields')">instance_sql_fields</a>('f', 'r').&quot;
<a name="l2330"><span class="linenum">2330</span></a>                    FROM {files} f
<a name="l2331"><span class="linenum">2331</span></a>                    JOIN {files_reference} r ON f.referencefileid = r.id
<a name="l2332"><span class="linenum">2332</span></a>                    JOIN {repository_instances} ri ON r.repositoryid = ri.id
<a name="l2333"><span class="linenum">2333</span></a>                   WHERE r.referencehash = ?
<a name="l2334"><span class="linenum">2334</span></a>                         AND (f.component &lt;&gt; ? OR f.filearea &lt;&gt; ?)&quot;;
<a name="l2335"><span class="linenum">2335</span></a>  
<a name="l2336"><span class="linenum">2336</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array(<a class="var it27138" onMouseOver="hilite(27138)" onMouseOut="lolite()" onClick="logVariable('referencehash')" href="../../_variables/referencehash.html">$referencehash</a>, 'user', 'draft'));
<a name="l2337"><span class="linenum">2337</span></a>          <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a> = array();
<a name="l2338"><span class="linenum">2338</span></a>          foreach (<a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>) {
<a name="l2339"><span class="linenum">2339</span></a>              <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a>[<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>-&gt;<a onClick="logVariable('pathnamehash')" class="var it42901" onMouseOver="hilite(42901)" onMouseOut="lolite()" href="../../_variables/pathnamehash.html">pathnamehash</a>] = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_instance')" href="../../_functions/get_file_instance.html" onMouseOver="funcPopup(event,'get_file_instance')">get_file_instance</a>(<a class="var it833" onMouseOver="hilite(833)" onMouseOut="lolite()" onClick="logVariable('filerecord')" href="../../_variables/filerecord.html">$filerecord</a>);
<a name="l2340"><span class="linenum">2340</span></a>          }
<a name="l2341"><span class="linenum">2341</span></a>  
<a name="l2342"><span class="linenum">2342</span></a>          return <a class="var it223" onMouseOver="hilite(223)" onMouseOut="lolite()" onClick="logVariable('files')" href="../../_variables/files.html">$files</a>;
<a name="l2343"><span class="linenum">2343</span></a>      }
<a name="l2344"><span class="linenum">2344</span></a>  
<a name="l2345"><span class="linenum">2345</span></a>      <span class="comment">/**</span>
<a name="l2346"><span class="linenum">2346</span></a>  <span class="comment">     * Returns the number of aliases that refer to some stored_file via the given reference</span>
<a name="l2347"><span class="linenum">2347</span></a>  <span class="comment">     *</span>
<a name="l2348"><span class="linenum">2348</span></a>  <span class="comment">     * All repositories that provide access to a stored_file are expected to use</span>
<a name="l2349"><span class="linenum">2349</span></a>  <span class="comment">     * {@link self::pack_reference()}. This method can't be used if the given reference</span>
<a name="l2350"><span class="linenum">2350</span></a>  <span class="comment">     * does not use this format or if you are looking for references to an external file</span>
<a name="l2351"><span class="linenum">2351</span></a>  <span class="comment">     * (for example it can't be used to count aliases that refer to a given Dropbox or</span>
<a name="l2352"><span class="linenum">2352</span></a>  <span class="comment">     * Box.net file).</span>
<a name="l2353"><span class="linenum">2353</span></a>  <span class="comment">     *</span>
<a name="l2354"><span class="linenum">2354</span></a>  <span class="comment">     * Aliases in user draft areas are not counted.</span>
<a name="l2355"><span class="linenum">2355</span></a>  <span class="comment">     *</span>
<a name="l2356"><span class="linenum">2356</span></a>  <span class="comment">     * @param string $reference identification of the referenced file</span>
<a name="l2357"><span class="linenum">2357</span></a>  <span class="comment">     * @return int</span>
<a name="l2358"><span class="linenum">2358</span></a>  <span class="comment">     */</span>
<a name="l2359"><span class="linenum">2359</span></a>      public function <a class="function" onClick="logFunction('search_references_count')" href="../../_functions/search_references_count.html" onMouseOver="funcPopup(event,'search_references_count')">search_references_count</a>(<a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>) {
<a name="l2360"><span class="linenum">2360</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2361"><span class="linenum">2361</span></a>  
<a name="l2362"><span class="linenum">2362</span></a>          if (<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>)) {
<a name="l2363"><span class="linenum">2363</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('NULL is not a valid reference to an external file');
<a name="l2364"><span class="linenum">2364</span></a>          }
<a name="l2365"><span class="linenum">2365</span></a>  
<a name="l2366"><span class="linenum">2366</span></a>  <span class="comment">        // Give {@link self::unpack_reference()} a chance to throw exception if the</span>
<a name="l2367"><span class="linenum">2367</span></a>  <span class="comment">        // reference is not in a valid format.</span>
<a name="l2368"><span class="linenum">2368</span></a>          self::<a class="function" onClick="logFunction('unpack_reference')" href="../../_functions/unpack_reference.html" onMouseOver="funcPopup(event,'unpack_reference')">unpack_reference</a>(<a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>);
<a name="l2369"><span class="linenum">2369</span></a>  
<a name="l2370"><span class="linenum">2370</span></a>          <a class="var it27138" onMouseOver="hilite(27138)" onMouseOut="lolite()" onClick="logVariable('referencehash')" href="../../_variables/referencehash.html">$referencehash</a> = <a class="phpfunction" onClick="logFunction('sha1')" href="../../_functions/sha1.html" onMouseOver="phpfuncPopup(event,'sha1')">sha1</a>(<a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>);
<a name="l2371"><span class="linenum">2371</span></a>  
<a name="l2372"><span class="linenum">2372</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(f.id)
<a name="l2373"><span class="linenum">2373</span></a>                    FROM {files} f
<a name="l2374"><span class="linenum">2374</span></a>                    JOIN {files_reference} r ON f.referencefileid = r.id
<a name="l2375"><span class="linenum">2375</span></a>                    JOIN {repository_instances} ri ON r.repositoryid = ri.id
<a name="l2376"><span class="linenum">2376</span></a>                   WHERE r.referencehash = ?
<a name="l2377"><span class="linenum">2377</span></a>                         AND (f.component &lt;&gt; ? OR f.filearea &lt;&gt; ?)&quot;;
<a name="l2378"><span class="linenum">2378</span></a>  
<a name="l2379"><span class="linenum">2379</span></a>          return (int)<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records_sql')" href="../../_functions/count_records_sql.html" onMouseOver="funcPopup(event,'count_records_sql')">count_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array(<a class="var it27138" onMouseOver="hilite(27138)" onMouseOut="lolite()" onClick="logVariable('referencehash')" href="../../_variables/referencehash.html">$referencehash</a>, 'user', 'draft'));
<a name="l2380"><span class="linenum">2380</span></a>      }
<a name="l2381"><span class="linenum">2381</span></a>  
<a name="l2382"><span class="linenum">2382</span></a>      <span class="comment">/**</span>
<a name="l2383"><span class="linenum">2383</span></a>  <span class="comment">     * Returns all aliases that link to the given stored_file</span>
<a name="l2384"><span class="linenum">2384</span></a>  <span class="comment">     *</span>
<a name="l2385"><span class="linenum">2385</span></a>  <span class="comment">     * Aliases in user draft areas are excluded from the returned list.</span>
<a name="l2386"><span class="linenum">2386</span></a>  <span class="comment">     *</span>
<a name="l2387"><span class="linenum">2387</span></a>  <span class="comment">     * @param stored_file $storedfile</span>
<a name="l2388"><span class="linenum">2388</span></a>  <span class="comment">     * @return array of stored_file</span>
<a name="l2389"><span class="linenum">2389</span></a>  <span class="comment">     */</span>
<a name="l2390"><span class="linenum">2390</span></a>      public function <a class="function" onClick="logFunction('get_references_by_storedfile')" href="../../_functions/get_references_by_storedfile.html" onMouseOver="funcPopup(event,'get_references_by_storedfile')">get_references_by_storedfile</a>(stored_file <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>) {
<a name="l2391"><span class="linenum">2391</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2392"><span class="linenum">2392</span></a>  
<a name="l2393"><span class="linenum">2393</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array();
<a name="l2394"><span class="linenum">2394</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['contextid'] = <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('get_contextid')" href="../../_functions/get_contextid.html" onMouseOver="funcPopup(event,'get_contextid')">get_contextid</a>();
<a name="l2395"><span class="linenum">2395</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['component'] = <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('get_component')" href="../../_functions/get_component.html" onMouseOver="funcPopup(event,'get_component')">get_component</a>();
<a name="l2396"><span class="linenum">2396</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['filearea']  = <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('get_filearea')" href="../../_functions/get_filearea.html" onMouseOver="funcPopup(event,'get_filearea')">get_filearea</a>();
<a name="l2397"><span class="linenum">2397</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['itemid']    = <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('get_itemid')" href="../../_functions/get_itemid.html" onMouseOver="funcPopup(event,'get_itemid')">get_itemid</a>();
<a name="l2398"><span class="linenum">2398</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['filename']  = <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('get_filename')" href="../../_functions/get_filename.html" onMouseOver="funcPopup(event,'get_filename')">get_filename</a>();
<a name="l2399"><span class="linenum">2399</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['filepath']  = <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('get_filepath')" href="../../_functions/get_filepath.html" onMouseOver="funcPopup(event,'get_filepath')">get_filepath</a>();
<a name="l2400"><span class="linenum">2400</span></a>  
<a name="l2401"><span class="linenum">2401</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('search_references')" href="../../_functions/search_references.html" onMouseOver="funcPopup(event,'search_references')">search_references</a>(self::<a class="function" onClick="logFunction('pack_reference')" href="../../_functions/pack_reference.html" onMouseOver="funcPopup(event,'pack_reference')">pack_reference</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>));
<a name="l2402"><span class="linenum">2402</span></a>      }
<a name="l2403"><span class="linenum">2403</span></a>  
<a name="l2404"><span class="linenum">2404</span></a>      <span class="comment">/**</span>
<a name="l2405"><span class="linenum">2405</span></a>  <span class="comment">     * Returns the number of aliases that link to the given stored_file</span>
<a name="l2406"><span class="linenum">2406</span></a>  <span class="comment">     *</span>
<a name="l2407"><span class="linenum">2407</span></a>  <span class="comment">     * Aliases in user draft areas are not counted.</span>
<a name="l2408"><span class="linenum">2408</span></a>  <span class="comment">     *</span>
<a name="l2409"><span class="linenum">2409</span></a>  <span class="comment">     * @param stored_file $storedfile</span>
<a name="l2410"><span class="linenum">2410</span></a>  <span class="comment">     * @return int</span>
<a name="l2411"><span class="linenum">2411</span></a>  <span class="comment">     */</span>
<a name="l2412"><span class="linenum">2412</span></a>      public function <a class="function" onClick="logFunction('get_references_count_by_storedfile')" href="../../_functions/get_references_count_by_storedfile.html" onMouseOver="funcPopup(event,'get_references_count_by_storedfile')">get_references_count_by_storedfile</a>(stored_file <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>) {
<a name="l2413"><span class="linenum">2413</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2414"><span class="linenum">2414</span></a>  
<a name="l2415"><span class="linenum">2415</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array();
<a name="l2416"><span class="linenum">2416</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['contextid'] = <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('get_contextid')" href="../../_functions/get_contextid.html" onMouseOver="funcPopup(event,'get_contextid')">get_contextid</a>();
<a name="l2417"><span class="linenum">2417</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['component'] = <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('get_component')" href="../../_functions/get_component.html" onMouseOver="funcPopup(event,'get_component')">get_component</a>();
<a name="l2418"><span class="linenum">2418</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['filearea']  = <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('get_filearea')" href="../../_functions/get_filearea.html" onMouseOver="funcPopup(event,'get_filearea')">get_filearea</a>();
<a name="l2419"><span class="linenum">2419</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['itemid']    = <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('get_itemid')" href="../../_functions/get_itemid.html" onMouseOver="funcPopup(event,'get_itemid')">get_itemid</a>();
<a name="l2420"><span class="linenum">2420</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['filename']  = <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('get_filename')" href="../../_functions/get_filename.html" onMouseOver="funcPopup(event,'get_filename')">get_filename</a>();
<a name="l2421"><span class="linenum">2421</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['filepath']  = <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('get_filepath')" href="../../_functions/get_filepath.html" onMouseOver="funcPopup(event,'get_filepath')">get_filepath</a>();
<a name="l2422"><span class="linenum">2422</span></a>  
<a name="l2423"><span class="linenum">2423</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('search_references_count')" href="../../_functions/search_references_count.html" onMouseOver="funcPopup(event,'search_references_count')">search_references_count</a>(self::<a class="function" onClick="logFunction('pack_reference')" href="../../_functions/pack_reference.html" onMouseOver="funcPopup(event,'pack_reference')">pack_reference</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>));
<a name="l2424"><span class="linenum">2424</span></a>      }
<a name="l2425"><span class="linenum">2425</span></a>  
<a name="l2426"><span class="linenum">2426</span></a>      <span class="comment">/**</span>
<a name="l2427"><span class="linenum">2427</span></a>  <span class="comment">     * Updates all files that are referencing this file with the new contenthash</span>
<a name="l2428"><span class="linenum">2428</span></a>  <span class="comment">     * and filesize</span>
<a name="l2429"><span class="linenum">2429</span></a>  <span class="comment">     *</span>
<a name="l2430"><span class="linenum">2430</span></a>  <span class="comment">     * @param stored_file $storedfile</span>
<a name="l2431"><span class="linenum">2431</span></a>  <span class="comment">     */</span>
<a name="l2432"><span class="linenum">2432</span></a>      public function <a class="function" onClick="logFunction('update_references_to_storedfile')" href="../../_functions/update_references_to_storedfile.html" onMouseOver="funcPopup(event,'update_references_to_storedfile')">update_references_to_storedfile</a>(stored_file <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>) {
<a name="l2433"><span class="linenum">2433</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2434"><span class="linenum">2434</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array();
<a name="l2435"><span class="linenum">2435</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['contextid'] = <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('get_contextid')" href="../../_functions/get_contextid.html" onMouseOver="funcPopup(event,'get_contextid')">get_contextid</a>();
<a name="l2436"><span class="linenum">2436</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['component'] = <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('get_component')" href="../../_functions/get_component.html" onMouseOver="funcPopup(event,'get_component')">get_component</a>();
<a name="l2437"><span class="linenum">2437</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['filearea']  = <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('get_filearea')" href="../../_functions/get_filearea.html" onMouseOver="funcPopup(event,'get_filearea')">get_filearea</a>();
<a name="l2438"><span class="linenum">2438</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['itemid']    = <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('get_itemid')" href="../../_functions/get_itemid.html" onMouseOver="funcPopup(event,'get_itemid')">get_itemid</a>();
<a name="l2439"><span class="linenum">2439</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['filename']  = <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('get_filename')" href="../../_functions/get_filename.html" onMouseOver="funcPopup(event,'get_filename')">get_filename</a>();
<a name="l2440"><span class="linenum">2440</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['filepath']  = <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('get_filepath')" href="../../_functions/get_filepath.html" onMouseOver="funcPopup(event,'get_filepath')">get_filepath</a>();
<a name="l2441"><span class="linenum">2441</span></a>          <a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a> = self::<a class="function" onClick="logFunction('pack_reference')" href="../../_functions/pack_reference.html" onMouseOver="funcPopup(event,'pack_reference')">pack_reference</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l2442"><span class="linenum">2442</span></a>          <a class="var it27138" onMouseOver="hilite(27138)" onMouseOut="lolite()" onClick="logVariable('referencehash')" href="../../_variables/referencehash.html">$referencehash</a> = <a class="phpfunction" onClick="logFunction('sha1')" href="../../_functions/sha1.html" onMouseOver="phpfuncPopup(event,'sha1')">sha1</a>(<a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>);
<a name="l2443"><span class="linenum">2443</span></a>  
<a name="l2444"><span class="linenum">2444</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT repositoryid, id FROM {files_reference}
<a name="l2445"><span class="linenum">2445</span></a>                   WHERE referencehash = ?&quot;;
<a name="l2446"><span class="linenum">2446</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array(<a class="var it27138" onMouseOver="hilite(27138)" onMouseOut="lolite()" onClick="logVariable('referencehash')" href="../../_variables/referencehash.html">$referencehash</a>));
<a name="l2447"><span class="linenum">2447</span></a>  
<a name="l2448"><span class="linenum">2448</span></a>          <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l2449"><span class="linenum">2449</span></a>          foreach (<a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>) {
<a name="l2450"><span class="linenum">2450</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('update_references')" href="../../_functions/update_references.html" onMouseOver="funcPopup(event,'update_references')">update_references</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it3027" onMouseOver="hilite(3027)" onMouseOut="lolite()" onClick="logVariable('now')" href="../../_variables/now.html">$now</a>, null,
<a name="l2451"><span class="linenum">2451</span></a>                      <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('get_contenthash')" href="../../_functions/get_contenthash.html" onMouseOver="funcPopup(event,'get_contenthash')">get_contenthash</a>(), <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('get_filesize')" href="../../_functions/get_filesize.html" onMouseOver="funcPopup(event,'get_filesize')">get_filesize</a>(), 0, <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('get_timemodified')" href="../../_functions/get_timemodified.html" onMouseOver="funcPopup(event,'get_timemodified')">get_timemodified</a>());
<a name="l2452"><span class="linenum">2452</span></a>          }
<a name="l2453"><span class="linenum">2453</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l2454"><span class="linenum">2454</span></a>      }
<a name="l2455"><span class="linenum">2455</span></a>  
<a name="l2456"><span class="linenum">2456</span></a>      <span class="comment">/**</span>
<a name="l2457"><span class="linenum">2457</span></a>  <span class="comment">     * Convert file alias to local file</span>
<a name="l2458"><span class="linenum">2458</span></a>  <span class="comment">     *</span>
<a name="l2459"><span class="linenum">2459</span></a>  <span class="comment">     * @throws moodle_exception if file could not be downloaded</span>
<a name="l2460"><span class="linenum">2460</span></a>  <span class="comment">     *</span>
<a name="l2461"><span class="linenum">2461</span></a>  <span class="comment">     * @param stored_file $storedfile a stored_file instances</span>
<a name="l2462"><span class="linenum">2462</span></a>  <span class="comment">     * @param int $maxbytes throw an exception if file size is bigger than $maxbytes (0 means no limit)</span>
<a name="l2463"><span class="linenum">2463</span></a>  <span class="comment">     * @return stored_file stored_file</span>
<a name="l2464"><span class="linenum">2464</span></a>  <span class="comment">     */</span>
<a name="l2465"><span class="linenum">2465</span></a>      public function <a class="function" onClick="logFunction('import_external_file')" href="../../_functions/import_external_file.html" onMouseOver="funcPopup(event,'import_external_file')">import_external_file</a>(stored_file <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>, <a class="var it1055" onMouseOver="hilite(1055)" onMouseOut="lolite()" onClick="logVariable('maxbytes')" href="../../_variables/maxbytes.html">$maxbytes</a> = 0) {
<a name="l2466"><span class="linenum">2466</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l2467"><span class="linenum">2467</span></a>          <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('import_external_file_contents')" href="../../_functions/import_external_file_contents.html" onMouseOver="funcPopup(event,'import_external_file_contents')">import_external_file_contents</a>(<a class="var it1055" onMouseOver="hilite(1055)" onMouseOut="lolite()" onClick="logVariable('maxbytes')" href="../../_variables/maxbytes.html">$maxbytes</a>);
<a name="l2468"><span class="linenum">2468</span></a>          <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>-&gt;<a class="function" onClick="logFunction('delete_reference')" href="../../_functions/delete_reference.html" onMouseOver="funcPopup(event,'delete_reference')">delete_reference</a>();
<a name="l2469"><span class="linenum">2469</span></a>          return <a class="var it2275" onMouseOver="hilite(2275)" onMouseOut="lolite()" onClick="logVariable('storedfile')" href="../../_variables/storedfile.html">$storedfile</a>;
<a name="l2470"><span class="linenum">2470</span></a>      }
<a name="l2471"><span class="linenum">2471</span></a>  
<a name="l2472"><span class="linenum">2472</span></a>      <span class="comment">/**</span>
<a name="l2473"><span class="linenum">2473</span></a>  <span class="comment">     * Return mimetype by given file pathname</span>
<a name="l2474"><span class="linenum">2474</span></a>  <span class="comment">     *</span>
<a name="l2475"><span class="linenum">2475</span></a>  <span class="comment">     * If file has a known extension, we return the mimetype based on extension.</span>
<a name="l2476"><span class="linenum">2476</span></a>  <span class="comment">     * Otherwise (when possible) we try to get the mimetype from file contents.</span>
<a name="l2477"><span class="linenum">2477</span></a>  <span class="comment">     *</span>
<a name="l2478"><span class="linenum">2478</span></a>  <span class="comment">     * @param string $pathname full path to the file</span>
<a name="l2479"><span class="linenum">2479</span></a>  <span class="comment">     * @param string $filename correct file name with extension, if omitted will be taken from $path</span>
<a name="l2480"><span class="linenum">2480</span></a>  <span class="comment">     * @return string</span>
<a name="l2481"><span class="linenum">2481</span></a>  <span class="comment">     */</span>
<a name="l2482"><span class="linenum">2482</span></a>      public static function <a class="function" onClick="logFunction('mimetype')" href="../../_functions/mimetype.html" onMouseOver="funcPopup(event,'mimetype')">mimetype</a>(<a class="var it801" onMouseOver="hilite(801)" onMouseOut="lolite()" onClick="logVariable('pathname')" href="../../_variables/pathname.html">$pathname</a>, <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a> = null) {
<a name="l2483"><span class="linenum">2483</span></a>          if (empty(<a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>)) {
<a name="l2484"><span class="linenum">2484</span></a>              <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a> = <a class="var it801" onMouseOver="hilite(801)" onMouseOut="lolite()" onClick="logVariable('pathname')" href="../../_variables/pathname.html">$pathname</a>;
<a name="l2485"><span class="linenum">2485</span></a>          }
<a name="l2486"><span class="linenum">2486</span></a>          <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a> = <a class="function" onClick="logFunction('mimeinfo')" href="../../_functions/mimeinfo.html" onMouseOver="funcPopup(event,'mimeinfo')">mimeinfo</a>('type', <a class="var it243" onMouseOver="hilite(243)" onMouseOut="lolite()" onClick="logVariable('filename')" href="../../_variables/filename.html">$filename</a>);
<a name="l2487"><span class="linenum">2487</span></a>          if (<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a> === 'document/unknown' &amp;&amp; <a class="phpfunction" onClick="logFunction('class_exists')" href="../../_functions/class_exists.html" onMouseOver="phpfuncPopup(event,'class_exists')">class_exists</a>('finfo') &amp;&amp; <a class="phpfunction" onClick="logFunction('file_exists')" href="../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it801" onMouseOver="hilite(801)" onMouseOut="lolite()" onClick="logVariable('pathname')" href="../../_variables/pathname.html">$pathname</a>)) {
<a name="l2488"><span class="linenum">2488</span></a>              <a class="var it18169" onMouseOver="hilite(18169)" onMouseOut="lolite()" onClick="logVariable('finfo')" href="../../_variables/finfo.html">$finfo</a> = new finfo(FILEINFO_MIME_TYPE);
<a name="l2489"><span class="linenum">2489</span></a>              <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a> = <a class="function" onClick="logFunction('mimeinfo_from_type')" href="../../_functions/mimeinfo_from_type.html" onMouseOver="funcPopup(event,'mimeinfo_from_type')">mimeinfo_from_type</a>('type', <a class="var it18169" onMouseOver="hilite(18169)" onMouseOut="lolite()" onClick="logVariable('finfo')" href="../../_variables/finfo.html">$finfo</a>-&gt;<a class="phpfunction" onClick="logFunction('file')" href="../../_functions/file.html" onMouseOver="phpfuncPopup(event,'file')">file</a>(<a class="var it801" onMouseOver="hilite(801)" onMouseOut="lolite()" onClick="logVariable('pathname')" href="../../_variables/pathname.html">$pathname</a>));
<a name="l2490"><span class="linenum">2490</span></a>          }
<a name="l2491"><span class="linenum">2491</span></a>          return <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>;
<a name="l2492"><span class="linenum">2492</span></a>      }
<a name="l2493"><span class="linenum">2493</span></a>  
<a name="l2494"><span class="linenum">2494</span></a>      <span class="comment">/**</span>
<a name="l2495"><span class="linenum">2495</span></a>  <span class="comment">     * Cron cleanup job.</span>
<a name="l2496"><span class="linenum">2496</span></a>  <span class="comment">     */</span>
<a name="l2497"><span class="linenum">2497</span></a>      public function <a class="function" onClick="logFunction('cron')" href="../../_functions/cron.html" onMouseOver="funcPopup(event,'cron')">cron</a>() {
<a name="l2498"><span class="linenum">2498</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2499"><span class="linenum">2499</span></a>          require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/cronlib.php');
<a name="l2500"><span class="linenum">2500</span></a>  
<a name="l2501"><span class="linenum">2501</span></a>  <span class="comment">        // find out all stale draft areas (older than 4 days) and purge them</span>
<a name="l2502"><span class="linenum">2502</span></a>  <span class="comment">        // those are identified by time stamp of the /. root dir</span>
<a name="l2503"><span class="linenum">2503</span></a>          <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Deleting old draft files... ', '');
<a name="l2504"><span class="linenum">2504</span></a>          <a class="function" onClick="logFunction('cron_trace_time_and_memory')" href="../../_functions/cron_trace_time_and_memory.html" onMouseOver="funcPopup(event,'cron_trace_time_and_memory')">cron_trace_time_and_memory</a>();
<a name="l2505"><span class="linenum">2505</span></a>          <a class="var it477" onMouseOver="hilite(477)" onMouseOut="lolite()" onClick="logVariable('old')" href="../../_variables/old.html">$old</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() - 60*60*24*4;
<a name="l2506"><span class="linenum">2506</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT *
<a name="l2507"><span class="linenum">2507</span></a>                    FROM {files}
<a name="l2508"><span class="linenum">2508</span></a>                   WHERE component = 'user' AND filearea = 'draft' AND filepath = '/' AND filename = '.'
<a name="l2509"><span class="linenum">2509</span></a>                         AND timecreated &lt; :old&quot;;
<a name="l2510"><span class="linenum">2510</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array('old'=&gt;<a class="var it477" onMouseOver="hilite(477)" onMouseOut="lolite()" onClick="logVariable('old')" href="../../_variables/old.html">$old</a>));
<a name="l2511"><span class="linenum">2511</span></a>          foreach (<a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a>) {
<a name="l2512"><span class="linenum">2512</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('delete_area_files')" href="../../_functions/delete_area_files.html" onMouseOver="funcPopup(event,'delete_area_files')">delete_area_files</a>(<a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a>-&gt;<a onClick="logVariable('contextid')" class="var it45214" onMouseOver="hilite(45214)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>, <a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a>-&gt;<a onClick="logVariable('component')" class="var it45214" onMouseOver="hilite(45214)" onMouseOut="lolite()" href="../../_variables/component.html">component</a>, <a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a>-&gt;<a onClick="logVariable('filearea')" class="var it45214" onMouseOver="hilite(45214)" onMouseOut="lolite()" href="../../_variables/filearea.html">filearea</a>, <a class="var it1519" onMouseOver="hilite(1519)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../_variables/dir.html">$dir</a>-&gt;<a onClick="logVariable('itemid')" class="var it45214" onMouseOver="hilite(45214)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>);
<a name="l2513"><span class="linenum">2513</span></a>          }
<a name="l2514"><span class="linenum">2514</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l2515"><span class="linenum">2515</span></a>          <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('done.');
<a name="l2516"><span class="linenum">2516</span></a>  
<a name="l2517"><span class="linenum">2517</span></a>  <span class="comment">        // remove orphaned preview files (that is files in the core preview filearea without</span>
<a name="l2518"><span class="linenum">2518</span></a>  <span class="comment">        // the existing original file)</span>
<a name="l2519"><span class="linenum">2519</span></a>          <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Deleting orphaned preview files... ', '');
<a name="l2520"><span class="linenum">2520</span></a>          <a class="function" onClick="logFunction('cron_trace_time_and_memory')" href="../../_functions/cron_trace_time_and_memory.html" onMouseOver="funcPopup(event,'cron_trace_time_and_memory')">cron_trace_time_and_memory</a>();
<a name="l2521"><span class="linenum">2521</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT p.*
<a name="l2522"><span class="linenum">2522</span></a>                    FROM {files} p
<a name="l2523"><span class="linenum">2523</span></a>               LEFT JOIN {files} o <a class="function" onClick="logFunction('ON')" href="../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (p.filename = o.contenthash)
<a name="l2524"><span class="linenum">2524</span></a>                   WHERE p.contextid = ? AND p.component = 'core' AND p.filearea = 'preview' AND p.itemid = 0
<a name="l2525"><span class="linenum">2525</span></a>                         AND o.id IS NULL&quot;;
<a name="l2526"><span class="linenum">2526</span></a>          <a class="var it832" onMouseOver="hilite(832)" onMouseOut="lolite()" onClick="logVariable('syscontext')" href="../../_variables/syscontext.html">$syscontext</a> = <a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l2527"><span class="linenum">2527</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array(<a class="var it832" onMouseOver="hilite(832)" onMouseOut="lolite()" onClick="logVariable('syscontext')" href="../../_variables/syscontext.html">$syscontext</a>-&gt;<a onClick="logVariable('id')" class="var it43085" onMouseOver="hilite(43085)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l2528"><span class="linenum">2528</span></a>          foreach (<a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it27139" onMouseOver="hilite(27139)" onMouseOut="lolite()" onClick="logVariable('orphan')" href="../../_variables/orphan.html">$orphan</a>) {
<a name="l2529"><span class="linenum">2529</span></a>              <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_instance')" href="../../_functions/get_file_instance.html" onMouseOver="funcPopup(event,'get_file_instance')">get_file_instance</a>(<a class="var it27139" onMouseOver="hilite(27139)" onMouseOut="lolite()" onClick="logVariable('orphan')" href="../../_variables/orphan.html">$orphan</a>);
<a name="l2530"><span class="linenum">2530</span></a>              if (!<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('is_directory')" href="../../_functions/is_directory.html" onMouseOver="funcPopup(event,'is_directory')">is_directory</a>()) {
<a name="l2531"><span class="linenum">2531</span></a>                  <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l2532"><span class="linenum">2532</span></a>              }
<a name="l2533"><span class="linenum">2533</span></a>          }
<a name="l2534"><span class="linenum">2534</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l2535"><span class="linenum">2535</span></a>          <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('done.');
<a name="l2536"><span class="linenum">2536</span></a>  
<a name="l2537"><span class="linenum">2537</span></a>  <span class="comment">        // Remove orphaned converted files (that is files in the core documentconversion filearea without</span>
<a name="l2538"><span class="linenum">2538</span></a>  <span class="comment">        // the existing original file).</span>
<a name="l2539"><span class="linenum">2539</span></a>          <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Deleting orphaned document conversion files... ', '');
<a name="l2540"><span class="linenum">2540</span></a>          <a class="function" onClick="logFunction('cron_trace_time_and_memory')" href="../../_functions/cron_trace_time_and_memory.html" onMouseOver="funcPopup(event,'cron_trace_time_and_memory')">cron_trace_time_and_memory</a>();
<a name="l2541"><span class="linenum">2541</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT p.*
<a name="l2542"><span class="linenum">2542</span></a>                    FROM {files} p
<a name="l2543"><span class="linenum">2543</span></a>               LEFT JOIN {files} o <a class="function" onClick="logFunction('ON')" href="../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (p.filename = o.contenthash)
<a name="l2544"><span class="linenum">2544</span></a>                   WHERE p.contextid = ? AND p.component = 'core' AND p.filearea = 'documentconversion' AND p.itemid = 0
<a name="l2545"><span class="linenum">2545</span></a>                         AND o.id IS NULL&quot;;
<a name="l2546"><span class="linenum">2546</span></a>          <a class="var it832" onMouseOver="hilite(832)" onMouseOut="lolite()" onClick="logVariable('syscontext')" href="../../_variables/syscontext.html">$syscontext</a> = <a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l2547"><span class="linenum">2547</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array(<a class="var it832" onMouseOver="hilite(832)" onMouseOut="lolite()" onClick="logVariable('syscontext')" href="../../_variables/syscontext.html">$syscontext</a>-&gt;<a onClick="logVariable('id')" class="var it43085" onMouseOver="hilite(43085)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l2548"><span class="linenum">2548</span></a>          foreach (<a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it27139" onMouseOver="hilite(27139)" onMouseOut="lolite()" onClick="logVariable('orphan')" href="../../_variables/orphan.html">$orphan</a>) {
<a name="l2549"><span class="linenum">2549</span></a>              <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_file_instance')" href="../../_functions/get_file_instance.html" onMouseOver="funcPopup(event,'get_file_instance')">get_file_instance</a>(<a class="var it27139" onMouseOver="hilite(27139)" onMouseOut="lolite()" onClick="logVariable('orphan')" href="../../_variables/orphan.html">$orphan</a>);
<a name="l2550"><span class="linenum">2550</span></a>              if (!<a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('is_directory')" href="../../_functions/is_directory.html" onMouseOver="funcPopup(event,'is_directory')">is_directory</a>()) {
<a name="l2551"><span class="linenum">2551</span></a>                  <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../_variables/file.html">$file</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l2552"><span class="linenum">2552</span></a>              }
<a name="l2553"><span class="linenum">2553</span></a>          }
<a name="l2554"><span class="linenum">2554</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l2555"><span class="linenum">2555</span></a>          <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('done.');
<a name="l2556"><span class="linenum">2556</span></a>  
<a name="l2557"><span class="linenum">2557</span></a>  <span class="comment">        // remove trash pool files once a day</span>
<a name="l2558"><span class="linenum">2558</span></a>  <span class="comment">        // if you want to disable purging of trash put $CFG-&gt;fileslastcleanup=time(); into config.php</span>
<a name="l2559"><span class="linenum">2559</span></a>          if (empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('fileslastcleanup')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/fileslastcleanup.html">fileslastcleanup</a>) or <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('fileslastcleanup')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/fileslastcleanup.html">fileslastcleanup</a> &lt; <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() - 60*60*24) {
<a name="l2560"><span class="linenum">2560</span></a>              require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/filelib.php');
<a name="l2561"><span class="linenum">2561</span></a>  <span class="comment">            // Delete files that are associated with a context that no longer exists.</span>
<a name="l2562"><span class="linenum">2562</span></a>              <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Cleaning up files from deleted contexts... ', '');
<a name="l2563"><span class="linenum">2563</span></a>              <a class="function" onClick="logFunction('cron_trace_time_and_memory')" href="../../_functions/cron_trace_time_and_memory.html" onMouseOver="funcPopup(event,'cron_trace_time_and_memory')">cron_trace_time_and_memory</a>();
<a name="l2564"><span class="linenum">2564</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT DISTINCT f.contextid
<a name="l2565"><span class="linenum">2565</span></a>                      FROM {files} f
<a name="l2566"><span class="linenum">2566</span></a>                      LEFT OUTER JOIN {context} c ON f.contextid = c.id
<a name="l2567"><span class="linenum">2567</span></a>                      WHERE c.id IS NULL&quot;;
<a name="l2568"><span class="linenum">2568</span></a>              <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>);
<a name="l2569"><span class="linenum">2569</span></a>              if (<a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('valid')" href="../../_functions/valid.html" onMouseOver="funcPopup(event,'valid')">valid</a>()) {
<a name="l2570"><span class="linenum">2570</span></a>                  <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l2571"><span class="linenum">2571</span></a>                  foreach (<a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it1068" onMouseOver="hilite(1068)" onMouseOut="lolite()" onClick="logVariable('ctx')" href="../../_variables/ctx.html">$ctx</a>) {
<a name="l2572"><span class="linenum">2572</span></a>                      <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('delete_area_files')" href="../../_functions/delete_area_files.html" onMouseOver="funcPopup(event,'delete_area_files')">delete_area_files</a>(<a class="var it1068" onMouseOver="hilite(1068)" onMouseOut="lolite()" onClick="logVariable('ctx')" href="../../_variables/ctx.html">$ctx</a>-&gt;<a onClick="logVariable('contextid')" class="var it43401" onMouseOver="hilite(43401)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>);
<a name="l2573"><span class="linenum">2573</span></a>                  }
<a name="l2574"><span class="linenum">2574</span></a>              }
<a name="l2575"><span class="linenum">2575</span></a>              <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l2576"><span class="linenum">2576</span></a>              <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('done.');
<a name="l2577"><span class="linenum">2577</span></a>  
<a name="l2578"><span class="linenum">2578</span></a>              <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('Deleting trash files... ', '');
<a name="l2579"><span class="linenum">2579</span></a>              <a class="function" onClick="logFunction('cron_trace_time_and_memory')" href="../../_functions/cron_trace_time_and_memory.html" onMouseOver="funcPopup(event,'cron_trace_time_and_memory')">cron_trace_time_and_memory</a>();
<a name="l2580"><span class="linenum">2580</span></a>              <a class="function" onClick="logFunction('fulldelete')" href="../../_functions/fulldelete.html" onMouseOver="funcPopup(event,'fulldelete')">fulldelete</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('trashdir')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../../_variables/trashdir.html">trashdir</a>);
<a name="l2581"><span class="linenum">2581</span></a>              <a class="function" onClick="logFunction('set_config')" href="../../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('fileslastcleanup', <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>());
<a name="l2582"><span class="linenum">2582</span></a>              <a class="function" onClick="logFunction('mtrace')" href="../../_functions/mtrace.html" onMouseOver="funcPopup(event,'mtrace')">mtrace</a>('done.');
<a name="l2583"><span class="linenum">2583</span></a>          }
<a name="l2584"><span class="linenum">2584</span></a>      }
<a name="l2585"><span class="linenum">2585</span></a>  
<a name="l2586"><span class="linenum">2586</span></a>      <span class="comment">/**</span>
<a name="l2587"><span class="linenum">2587</span></a>  <span class="comment">     * Get the sql formated fields for a file instance to be created from a</span>
<a name="l2588"><span class="linenum">2588</span></a>  <span class="comment">     * {files} and {files_refernece} join.</span>
<a name="l2589"><span class="linenum">2589</span></a>  <span class="comment">     *</span>
<a name="l2590"><span class="linenum">2590</span></a>  <span class="comment">     * @param string $filesprefix the table prefix for the {files} table</span>
<a name="l2591"><span class="linenum">2591</span></a>  <span class="comment">     * @param string $filesreferenceprefix the table prefix for the {files_reference} table</span>
<a name="l2592"><span class="linenum">2592</span></a>  <span class="comment">     * @return string the sql to go after a SELECT</span>
<a name="l2593"><span class="linenum">2593</span></a>  <span class="comment">     */</span>
<a name="l2594"><span class="linenum">2594</span></a>      private static function <a class="function" onClick="logFunction('instance_sql_fields')" href="../../_functions/instance_sql_fields.html" onMouseOver="funcPopup(event,'instance_sql_fields')">instance_sql_fields</a>(<a class="var it27141" onMouseOver="hilite(27141)" onMouseOut="lolite()" onClick="logVariable('filesprefix')" href="../../_variables/filesprefix.html">$filesprefix</a>, <a class="var it27142" onMouseOver="hilite(27142)" onMouseOut="lolite()" onClick="logVariable('filesreferenceprefix')" href="../../_variables/filesreferenceprefix.html">$filesreferenceprefix</a>) {
<a name="l2595"><span class="linenum">2595</span></a>  <span class="comment">        // Note, these fieldnames MUST NOT overlap between the two tables,</span>
<a name="l2596"><span class="linenum">2596</span></a>  <span class="comment">        // else problems like MDL-33172 occur.</span>
<a name="l2597"><span class="linenum">2597</span></a>          <a class="var it27143" onMouseOver="hilite(27143)" onMouseOut="lolite()" onClick="logVariable('filefields')" href="../../_variables/filefields.html">$filefields</a> = array('contenthash', 'pathnamehash', 'contextid', 'component', 'filearea',
<a name="l2598"><span class="linenum">2598</span></a>              'itemid', 'filepath', 'filename', 'userid', 'filesize', 'mimetype', 'status', 'source',
<a name="l2599"><span class="linenum">2599</span></a>              'author', 'license', 'timecreated', 'timemodified', 'sortorder', 'referencefileid');
<a name="l2600"><span class="linenum">2600</span></a>  
<a name="l2601"><span class="linenum">2601</span></a>          <a class="var it27144" onMouseOver="hilite(27144)" onMouseOut="lolite()" onClick="logVariable('referencefields')" href="../../_variables/referencefields.html">$referencefields</a> = array('repositoryid' =&gt; 'repositoryid',
<a name="l2602"><span class="linenum">2602</span></a>              'reference' =&gt; 'reference',
<a name="l2603"><span class="linenum">2603</span></a>              'lastsync' =&gt; 'referencelastsync');
<a name="l2604"><span class="linenum">2604</span></a>  
<a name="l2605"><span class="linenum">2605</span></a>  <span class="comment">        // id is specifically named to prevent overlaping between the two tables.</span>
<a name="l2606"><span class="linenum">2606</span></a>          <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a> = array();
<a name="l2607"><span class="linenum">2607</span></a>          <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[] = <a class="var it27141" onMouseOver="hilite(27141)" onMouseOut="lolite()" onClick="logVariable('filesprefix')" href="../../_variables/filesprefix.html">$filesprefix</a>.'.id AS id';
<a name="l2608"><span class="linenum">2608</span></a>          foreach (<a class="var it27143" onMouseOver="hilite(27143)" onMouseOut="lolite()" onClick="logVariable('filefields')" href="../../_variables/filefields.html">$filefields</a> as <a class="var it59" onMouseOver="hilite(59)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>) {
<a name="l2609"><span class="linenum">2609</span></a>              <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[] = &quot;{<a class="var it27141" onMouseOver="hilite(27141)" onMouseOut="lolite()" onClick="logVariable('filesprefix')" href="../../_variables/filesprefix.html">$filesprefix</a>}.{<a class="var it59" onMouseOver="hilite(59)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>}&quot;;
<a name="l2610"><span class="linenum">2610</span></a>          }
<a name="l2611"><span class="linenum">2611</span></a>  
<a name="l2612"><span class="linenum">2612</span></a>          foreach (<a class="var it27144" onMouseOver="hilite(27144)" onMouseOut="lolite()" onClick="logVariable('referencefields')" href="../../_variables/referencefields.html">$referencefields</a> as <a class="var it59" onMouseOver="hilite(59)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> =&gt; <a class="var it779" onMouseOver="hilite(779)" onMouseOut="lolite()" onClick="logVariable('alias')" href="../../_variables/alias.html">$alias</a>) {
<a name="l2613"><span class="linenum">2613</span></a>              <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>[] = &quot;{<a class="var it27142" onMouseOver="hilite(27142)" onMouseOut="lolite()" onClick="logVariable('filesreferenceprefix')" href="../../_variables/filesreferenceprefix.html">$filesreferenceprefix</a>}.{<a class="var it59" onMouseOver="hilite(59)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>} AS {<a class="var it779" onMouseOver="hilite(779)" onMouseOut="lolite()" onClick="logVariable('alias')" href="../../_variables/alias.html">$alias</a>}&quot;;
<a name="l2614"><span class="linenum">2614</span></a>          }
<a name="l2615"><span class="linenum">2615</span></a>  
<a name="l2616"><span class="linenum">2616</span></a>          return <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(', ', <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>);
<a name="l2617"><span class="linenum">2617</span></a>      }
<a name="l2618"><span class="linenum">2618</span></a>  
<a name="l2619"><span class="linenum">2619</span></a>      <span class="comment">/**</span>
<a name="l2620"><span class="linenum">2620</span></a>  <span class="comment">     * Returns the id of the record in {files_reference} that matches the passed repositoryid and reference</span>
<a name="l2621"><span class="linenum">2621</span></a>  <span class="comment">     *</span>
<a name="l2622"><span class="linenum">2622</span></a>  <span class="comment">     * If the record already exists, its id is returned. If there is no such record yet,</span>
<a name="l2623"><span class="linenum">2623</span></a>  <span class="comment">     * new one is created (using the lastsync provided, too) and its id is returned.</span>
<a name="l2624"><span class="linenum">2624</span></a>  <span class="comment">     *</span>
<a name="l2625"><span class="linenum">2625</span></a>  <span class="comment">     * @param int $repositoryid</span>
<a name="l2626"><span class="linenum">2626</span></a>  <span class="comment">     * @param string $reference</span>
<a name="l2627"><span class="linenum">2627</span></a>  <span class="comment">     * @param int $lastsync</span>
<a name="l2628"><span class="linenum">2628</span></a>  <span class="comment">     * @param int $lifetime argument not used any more</span>
<a name="l2629"><span class="linenum">2629</span></a>  <span class="comment">     * @return int</span>
<a name="l2630"><span class="linenum">2630</span></a>  <span class="comment">     */</span>
<a name="l2631"><span class="linenum">2631</span></a>      private function <a class="function" onClick="logFunction('get_or_create_referencefileid')" href="../../_functions/get_or_create_referencefileid.html" onMouseOver="funcPopup(event,'get_or_create_referencefileid')">get_or_create_referencefileid</a>(<a class="var it5419" onMouseOver="hilite(5419)" onMouseOut="lolite()" onClick="logVariable('repositoryid')" href="../../_variables/repositoryid.html">$repositoryid</a>, <a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>, <a class="var it27145" onMouseOver="hilite(27145)" onMouseOut="lolite()" onClick="logVariable('lastsync')" href="../../_variables/lastsync.html">$lastsync</a> = null, <a class="var it3341" onMouseOver="hilite(3341)" onMouseOut="lolite()" onClick="logVariable('lifetime')" href="../../_variables/lifetime.html">$lifetime</a> = null) {
<a name="l2632"><span class="linenum">2632</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2633"><span class="linenum">2633</span></a>  
<a name="l2634"><span class="linenum">2634</span></a>          <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_referencefileid')" href="../../_functions/get_referencefileid.html" onMouseOver="funcPopup(event,'get_referencefileid')">get_referencefileid</a>(<a class="var it5419" onMouseOver="hilite(5419)" onMouseOut="lolite()" onClick="logVariable('repositoryid')" href="../../_variables/repositoryid.html">$repositoryid</a>, <a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>, <a class="constant" onClick="logConstant('IGNORE_MISSING')" href="../../_constants/IGNORE_MISSING.html" onMouseOver="constPopup(event,'IGNORE_MISSING')">IGNORE_MISSING</a>);
<a name="l2635"><span class="linenum">2635</span></a>  
<a name="l2636"><span class="linenum">2636</span></a>          if (<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a> !== false) {
<a name="l2637"><span class="linenum">2637</span></a>  <span class="comment">            // bah, that was easy</span>
<a name="l2638"><span class="linenum">2638</span></a>              return <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>;
<a name="l2639"><span class="linenum">2639</span></a>          }
<a name="l2640"><span class="linenum">2640</span></a>  
<a name="l2641"><span class="linenum">2641</span></a>  <span class="comment">        // no such record yet, create one</span>
<a name="l2642"><span class="linenum">2642</span></a>          try {
<a name="l2643"><span class="linenum">2643</span></a>              <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('files_reference', array(
<a name="l2644"><span class="linenum">2644</span></a>                  'repositoryid'  =&gt; <a class="var it5419" onMouseOver="hilite(5419)" onMouseOut="lolite()" onClick="logVariable('repositoryid')" href="../../_variables/repositoryid.html">$repositoryid</a>,
<a name="l2645"><span class="linenum">2645</span></a>                  'reference'     =&gt; <a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>,
<a name="l2646"><span class="linenum">2646</span></a>                  'referencehash' =&gt; <a class="phpfunction" onClick="logFunction('sha1')" href="../../_functions/sha1.html" onMouseOver="phpfuncPopup(event,'sha1')">sha1</a>(<a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>),
<a name="l2647"><span class="linenum">2647</span></a>                  'lastsync'      =&gt; <a class="var it27145" onMouseOver="hilite(27145)" onMouseOut="lolite()" onClick="logVariable('lastsync')" href="../../_variables/lastsync.html">$lastsync</a>));
<a name="l2648"><span class="linenum">2648</span></a>          } catch (dml_exception <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>) {
<a name="l2649"><span class="linenum">2649</span></a>  <span class="comment">            // if inserting the new record failed, chances are that the race condition has just</span>
<a name="l2650"><span class="linenum">2650</span></a>  <span class="comment">            // occured and the unique index did not allow to create the second record with the same</span>
<a name="l2651"><span class="linenum">2651</span></a>  <span class="comment">            // repositoryid + reference combo</span>
<a name="l2652"><span class="linenum">2652</span></a>              <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_referencefileid')" href="../../_functions/get_referencefileid.html" onMouseOver="funcPopup(event,'get_referencefileid')">get_referencefileid</a>(<a class="var it5419" onMouseOver="hilite(5419)" onMouseOut="lolite()" onClick="logVariable('repositoryid')" href="../../_variables/repositoryid.html">$repositoryid</a>, <a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l2653"><span class="linenum">2653</span></a>          }
<a name="l2654"><span class="linenum">2654</span></a>  
<a name="l2655"><span class="linenum">2655</span></a>          return <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>;
<a name="l2656"><span class="linenum">2656</span></a>      }
<a name="l2657"><span class="linenum">2657</span></a>  
<a name="l2658"><span class="linenum">2658</span></a>      <span class="comment">/**</span>
<a name="l2659"><span class="linenum">2659</span></a>  <span class="comment">     * Returns the id of the record in {files_reference} that matches the passed parameters</span>
<a name="l2660"><span class="linenum">2660</span></a>  <span class="comment">     *</span>
<a name="l2661"><span class="linenum">2661</span></a>  <span class="comment">     * Depending on the required strictness, false can be returned. The behaviour is consistent</span>
<a name="l2662"><span class="linenum">2662</span></a>  <span class="comment">     * with standard DML methods.</span>
<a name="l2663"><span class="linenum">2663</span></a>  <span class="comment">     *</span>
<a name="l2664"><span class="linenum">2664</span></a>  <span class="comment">     * @param int $repositoryid</span>
<a name="l2665"><span class="linenum">2665</span></a>  <span class="comment">     * @param string $reference</span>
<a name="l2666"><span class="linenum">2666</span></a>  <span class="comment">     * @param int $strictness either {@link IGNORE_MISSING}, {@link IGNORE_MULTIPLE} or {@link MUST_EXIST}</span>
<a name="l2667"><span class="linenum">2667</span></a>  <span class="comment">     * @return int|bool</span>
<a name="l2668"><span class="linenum">2668</span></a>  <span class="comment">     */</span>
<a name="l2669"><span class="linenum">2669</span></a>      private function <a class="function" onClick="logFunction('get_referencefileid')" href="../../_functions/get_referencefileid.html" onMouseOver="funcPopup(event,'get_referencefileid')">get_referencefileid</a>(<a class="var it5419" onMouseOver="hilite(5419)" onMouseOut="lolite()" onClick="logVariable('repositoryid')" href="../../_variables/repositoryid.html">$repositoryid</a>, <a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>, <a class="var it1289" onMouseOver="hilite(1289)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../../_variables/strictness.html">$strictness</a>) {
<a name="l2670"><span class="linenum">2670</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2671"><span class="linenum">2671</span></a>  
<a name="l2672"><span class="linenum">2672</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('files_reference', 'id',
<a name="l2673"><span class="linenum">2673</span></a>              array('repositoryid' =&gt; <a class="var it5419" onMouseOver="hilite(5419)" onMouseOut="lolite()" onClick="logVariable('repositoryid')" href="../../_variables/repositoryid.html">$repositoryid</a>, 'referencehash' =&gt; <a class="phpfunction" onClick="logFunction('sha1')" href="../../_functions/sha1.html" onMouseOver="phpfuncPopup(event,'sha1')">sha1</a>(<a class="var it642" onMouseOver="hilite(642)" onMouseOut="lolite()" onClick="logVariable('reference')" href="../../_variables/reference.html">$reference</a>)), <a class="var it1289" onMouseOver="hilite(1289)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../../_variables/strictness.html">$strictness</a>);
<a name="l2674"><span class="linenum">2674</span></a>      }
<a name="l2675"><span class="linenum">2675</span></a>  
<a name="l2676"><span class="linenum">2676</span></a>      <span class="comment">/**</span>
<a name="l2677"><span class="linenum">2677</span></a>  <span class="comment">     * Updates a reference to the external resource and all files that use it</span>
<a name="l2678"><span class="linenum">2678</span></a>  <span class="comment">     *</span>
<a name="l2679"><span class="linenum">2679</span></a>  <span class="comment">     * This function is called after synchronisation of an external file and updates the</span>
<a name="l2680"><span class="linenum">2680</span></a>  <span class="comment">     * contenthash, filesize and status of all files that reference this external file</span>
<a name="l2681"><span class="linenum">2681</span></a>  <span class="comment">     * as well as time last synchronised.</span>
<a name="l2682"><span class="linenum">2682</span></a>  <span class="comment">     *</span>
<a name="l2683"><span class="linenum">2683</span></a>  <span class="comment">     * @param int $referencefileid</span>
<a name="l2684"><span class="linenum">2684</span></a>  <span class="comment">     * @param int $lastsync</span>
<a name="l2685"><span class="linenum">2685</span></a>  <span class="comment">     * @param int $lifetime argument not used any more, liefetime is returned by repository</span>
<a name="l2686"><span class="linenum">2686</span></a>  <span class="comment">     * @param string $contenthash</span>
<a name="l2687"><span class="linenum">2687</span></a>  <span class="comment">     * @param int $filesize</span>
<a name="l2688"><span class="linenum">2688</span></a>  <span class="comment">     * @param int $status 0 if ok or 666 if source is missing</span>
<a name="l2689"><span class="linenum">2689</span></a>  <span class="comment">     * @param int $timemodified last time modified of the source, if known</span>
<a name="l2690"><span class="linenum">2690</span></a>  <span class="comment">     */</span>
<a name="l2691"><span class="linenum">2691</span></a>      public function <a class="function" onClick="logFunction('update_references')" href="../../_functions/update_references.html" onMouseOver="funcPopup(event,'update_references')">update_references</a>(<a class="var it24028" onMouseOver="hilite(24028)" onMouseOut="lolite()" onClick="logVariable('referencefileid')" href="../../_variables/referencefileid.html">$referencefileid</a>, <a class="var it27145" onMouseOver="hilite(27145)" onMouseOut="lolite()" onClick="logVariable('lastsync')" href="../../_variables/lastsync.html">$lastsync</a>, <a class="var it3341" onMouseOver="hilite(3341)" onMouseOut="lolite()" onClick="logVariable('lifetime')" href="../../_variables/lifetime.html">$lifetime</a>, <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>, <a class="var it809" onMouseOver="hilite(809)" onMouseOut="lolite()" onClick="logVariable('filesize')" href="../../_variables/filesize.html">$filesize</a>, <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('timemodified')" href="../../_variables/timemodified.html">$timemodified</a> = null) {
<a name="l2692"><span class="linenum">2692</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2693"><span class="linenum">2693</span></a>          <a class="var it24028" onMouseOver="hilite(24028)" onMouseOut="lolite()" onClick="logVariable('referencefileid')" href="../../_variables/referencefileid.html">$referencefileid</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it24028" onMouseOver="hilite(24028)" onMouseOut="lolite()" onClick="logVariable('referencefileid')" href="../../_variables/referencefileid.html">$referencefileid</a>, <a class="constant" onClick="logConstant('PARAM_INT')" href="../../_constants/PARAM_INT.html" onMouseOver="constPopup(event,'PARAM_INT')">PARAM_INT</a>);
<a name="l2694"><span class="linenum">2694</span></a>          <a class="var it27145" onMouseOver="hilite(27145)" onMouseOut="lolite()" onClick="logVariable('lastsync')" href="../../_variables/lastsync.html">$lastsync</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it27145" onMouseOver="hilite(27145)" onMouseOut="lolite()" onClick="logVariable('lastsync')" href="../../_variables/lastsync.html">$lastsync</a>, <a class="constant" onClick="logConstant('PARAM_INT')" href="../../_constants/PARAM_INT.html" onMouseOver="constPopup(event,'PARAM_INT')">PARAM_INT</a>);
<a name="l2695"><span class="linenum">2695</span></a>          <a class="function" onClick="logFunction('validate_param')" href="../../_functions/validate_param.html" onMouseOver="funcPopup(event,'validate_param')">validate_param</a>(<a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>, <a class="constant" onClick="logConstant('PARAM_TEXT')" href="../../_constants/PARAM_TEXT.html" onMouseOver="constPopup(event,'PARAM_TEXT')">PARAM_TEXT</a>, <a class="constant" onClick="logConstant('NULL_NOT_ALLOWED')" href="../../_constants/NULL_NOT_ALLOWED.html" onMouseOver="constPopup(event,'NULL_NOT_ALLOWED')">NULL_NOT_ALLOWED</a>);
<a name="l2696"><span class="linenum">2696</span></a>          <a class="var it809" onMouseOver="hilite(809)" onMouseOut="lolite()" onClick="logVariable('filesize')" href="../../_variables/filesize.html">$filesize</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it809" onMouseOver="hilite(809)" onMouseOut="lolite()" onClick="logVariable('filesize')" href="../../_variables/filesize.html">$filesize</a>, <a class="constant" onClick="logConstant('PARAM_INT')" href="../../_constants/PARAM_INT.html" onMouseOver="constPopup(event,'PARAM_INT')">PARAM_INT</a>);
<a name="l2697"><span class="linenum">2697</span></a>          <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a> = <a class="function" onClick="logFunction('clean_param')" href="../../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>, <a class="constant" onClick="logConstant('PARAM_INT')" href="../../_constants/PARAM_INT.html" onMouseOver="constPopup(event,'PARAM_INT')">PARAM_INT</a>);
<a name="l2698"><span class="linenum">2698</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('contenthash' =&gt; <a class="var it5439" onMouseOver="hilite(5439)" onMouseOut="lolite()" onClick="logVariable('contenthash')" href="../../_variables/contenthash.html">$contenthash</a>,
<a name="l2699"><span class="linenum">2699</span></a>                      'filesize' =&gt; <a class="var it809" onMouseOver="hilite(809)" onMouseOut="lolite()" onClick="logVariable('filesize')" href="../../_variables/filesize.html">$filesize</a>,
<a name="l2700"><span class="linenum">2700</span></a>                      'status' =&gt; <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>,
<a name="l2701"><span class="linenum">2701</span></a>                      'referencefileid' =&gt; <a class="var it24028" onMouseOver="hilite(24028)" onMouseOut="lolite()" onClick="logVariable('referencefileid')" href="../../_variables/referencefileid.html">$referencefileid</a>,
<a name="l2702"><span class="linenum">2702</span></a>                      'timemodified' =&gt; <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('timemodified')" href="../../_variables/timemodified.html">$timemodified</a>);
<a name="l2703"><span class="linenum">2703</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>('UPDATE {files} SET contenthash = :contenthash, filesize = :filesize,
<a name="l2704"><span class="linenum">2704</span></a>              status = :status ' . (<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('timemodified')" href="../../_variables/timemodified.html">$timemodified</a> ? ', timemodified = :timemodified' : '') . '
<a name="l2705"><span class="linenum">2705</span></a>              WHERE referencefileid = :referencefileid', <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l2706"><span class="linenum">2706</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a> = array('id' =&gt; <a class="var it24028" onMouseOver="hilite(24028)" onMouseOut="lolite()" onClick="logVariable('referencefileid')" href="../../_variables/referencefileid.html">$referencefileid</a>, 'lastsync' =&gt; <a class="var it27145" onMouseOver="hilite(27145)" onMouseOut="lolite()" onClick="logVariable('lastsync')" href="../../_variables/lastsync.html">$lastsync</a>);
<a name="l2707"><span class="linenum">2707</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('files_reference', (object)<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l2708"><span class="linenum">2708</span></a>      }
<a name="l2709"><span class="linenum">2709</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'get_records': ['get_records', 'Load a list of records. ', [['competency/classes','persistent.php',709],['mod/glossary/classes','entry_query_builder.php',295],['lib/dml','moodle_database.php',1285],['lib','coursecatlib.php',651],['question','category_class.php',63]], 965],
'is_area_empty': ['is_area_empty', 'Are there any files (or directories) ', [['lib/filestorage','file_storage.php',723]], 13],
'create_file_from_string': ['create_file_from_string', 'Create new file from string - make sure params are valid. ', [['lib/filebrowser','file_info.php',379],['lib/filebrowser','file_info_stored.php',490],['lib/filestorage','file_storage.php',1482]], 132],
'record_exists_sql': ['record_exists_sql', 'Test whether a SQL SELECT statement returns any records. ', [['lib/dml','moodle_database.php',1846]], 52],
'get_file': ['get_file', 'Downloads a repository file and saves to a path. ', [['repository/boxnet','lib.php',179],['repository/flickr_public','lib.php',453],['repository/dropbox','lib.php',410],['repository/skydrive','lib.php',130],['repository','lib.php',1647],['repository/s3','lib.php',227],['repository/equella','lib.php',166],['mod/data/field/picture','field.class.php',126],['mod/data/field/file','field.class.php',123],['repository/googledocs','lib.php',408],['lib/filestorage','file_storage.php',700],['repository/webdav','lib.php',73],['repository/filesystem','lib.php',398],['repository/flickr','lib.php',277],['lib','externallib.php',1076],['repository/dropbox','locallib.php',114],['lib','webdavlib.php',391]], 169],
'is_format_supported_by_unoconv': ['is_format_supported_by_unoconv', 'Verify the format is supported. ', [['lib/filestorage','file_storage.php',205]], 2],
'execute': ['execute', 'Run langpack update ', [['admin/tool/langimport/classes/task','update_langpacks_task.php',44],['backup/converter/imscc1','lib.php',84],['lib/classes/task','blog_cron_task.php',40],['mod/workshop/allocation/scheduled','lib.php',128],['lib/classes/task','send_new_user_passwords_task.php',40],['admin/tool/log/store/standard/classes/task','cleanup_task.php',40],['lib/dml','pdo_moodle_database.php',227],['lib/classes/task','tag_cron_task.php',42],['enrol/imsenterprise/classes/task','cron_task.php',43],['lib/classes/task','completion_daily_task.php',42],['lib/google/src/Google/Http','Batch.php',61],['lib/dml','oci_native_moodle_database.php',1048],['lib/classes/task','context_cleanup_task.php',41],['backup/util/plan','backup_structure_step.class.php',50],['backup/util/ui','restore_ui.class.php',206],['webservice','lib.php',1319],['lib/classes/task','stats_cron_task.php',40],['lib/htmlpurifier/HTMLPurifier/Strategy','ValidateAttributes.php',16],['lib/htmlpurifier/HTMLPurifier/Strategy','RemoveForeignElements.php',20],['lib/classes/task','legacy_plugin_cron_task.php',42],['backup/moodle2','restore_activity_task.class.php',189],['lib/classes/task','portfolio_cron_task.php',40],['lib/google/src/Google/Http','REST.php',27],['lib/htmlpurifier/HTMLPurifier/Strategy','MakeWellFormed.php',66],['backup/converter/imscc11','backuplib.php',42],['lib/classes/task','question_cron_task.php',40],['lib/classes/task','cache_cron_task.php',40],['admin/tool/log/store/legacy/classes/task','cleanup_task.php',40],['mod/lti/service/memberships/classes/local/resource','linkmemberships.php',62],['admin/tool/messageinbound/classes/task','cleanup_task.php',47],['lib/adodb/drivers','adodb-pdo.inc.php',559],['lib/editor/atto/classes/task','autosave_cleanup_task.php',42],['admin/tool/recyclebin/classes/task','cleanup_category_bin.php',43],['lib/classes/task','completion_regular_task.php',42],['lib/adodb/drivers','adodb-oci8po.inc.php',54],['lib/classes/task','events_cron_task.php',40],['mod/workshop/allocation/random','lib.php',83],['mod/assign/feedback/editpdf/classes/task','convert_submissions.php',47],['auth/cas/classes/task','sync_task.php',43],['admin/tool/recyclebin/classes/task','cleanup_course_bin.php',43],['mod/lti/service/toolsettings/classes/local/resource','contextsettings.php',62],['backup/util/helper','restore_decode_processor.class.php',73],['lib/behat','behat_base.php',840],['enrol/flatfile/classes/task','flatfile_sync_task.php',46],['lib/classes/task','registration_cron_task.php',40],['backup/moodle2','backup_section_task.class.php',97],['lib/classes/task','check_for_updates_task.php',40],['backup/util/plan/tests/fixtures','plan_fixtures.php',48],['backup/util/plan/tests/fixtures','plan_fixtures.php',56],['mod/forum/classes/task','cron_task.php',39],['lib/classes/task','send_failed_login_notifications_task.php',43],['enrol/lti/classes/task','sync_grades.php',45],['lib/dml','pgsql_native_moodle_database.php',665],['lib/htmlpurifier/HTMLPurifier/Strategy','Composite.php',21],['lib/classes/update','validator.php',117],['lib/google/src/Google','Client.php',574],['lib/dml','mssql_native_moodle_database.php',711],['mod/lti/service/profile/classes/local/resource','profile.php',76],['backup/util/plan','backup_plan.class.php',112],['lib/dml','mysqli_native_moodle_database.php',963],['backup/util/ui','backup_ui.class.php',122],['admin/tool/monitor/classes/task','clean_events.php',41],['backup/converter/moodle1','backuplib.php',10],['backup/converter/imscc11','lib.php',85],['lib/classes/task','grade_cron_task.php',40],['lib/classes/task','file_temp_cleanup_task.php',40],['backup/moodle2','restore_section_task.class.php',87],['mod/lti/service/toolsettings/classes/local/resource','linksettings.php',63],['filter/tex','latex.php',70],['lib/adodb','adodb.inc.php',1088],['lib/classes/task','plagiarism_cron_task.php',40],['mod/lti/service/toolproxy/classes/local/resource','toolproxy.php',62],['backup/converter/moodle1','lib.php',142],['backup/util/plan','restore_structure_step.class.php',62],['lib/classes/task','search_index_task.php',44],['enrol/lti/classes/task','sync_members.php',55],['lib/classes/task','session_cleanup_task.php',40],['mod/lti/service/toolsettings/classes/local/resource','systemsettings.php',61],['lib/classes/task','backup_cleanup_task.php',40],['lib/classes/task','delete_unconfirmed_users_task.php',40],['backup/converter/imscc1','backuplib.php',10],['lib/classes/task','badges_cron_task.php',40],['admin/tool/uploadcourse/classes','processor.php',174],['lib/classes/task','calendar_cron_task.php',40],['backup/util/plan','base_plan.class.php',158],['auth/ldap/classes/task','sync_task.php',43],['lib/adodb/drivers','adodb-oci8.inc.php',920],['backup/util/plan','restore_plan.class.php',159],['lib/tests/fixtures','task_fixtures.php',30],['lib/tests/fixtures','task_fixtures.php',39],['lib/tests/fixtures','task_fixtures.php',48],['lib/tests/fixtures','task_fixtures.php',57],['lib/dml','sqlsrv_native_moodle_database.php',795],['lib/classes/task','create_contexts_task.php',40],['lib/classes/task','file_trash_cleanup_task.php',40],['admin/tool/cohortroles/classes/task','cohort_role_sync.php',46],['lib/classes/task','complete_plans_task.php',52],['lib/classes/task','messaging_cleanup_task.php',40],['backup/util/plan','backup_execution_step.class.php',25],['lib/classes/task','cache_cleanup_task.php',40],['backup/moodle2','backup_activity_task.class.php',211],['filter/tex','texdebug.php',287],['lib/classes/task','password_reset_cleanup_task.php',40],['lib/classes/task','search_optimize_task.php',47],['mod/assign','adminlib.php',342],['lib/classes/task','delete_incomplete_users_task.php',40],['lib/classes/task','automated_backup_task.php',40],['admin/tool/messageinbound/classes/task','pickup_task.php',47],['backup/util/plan','restore_execution_step.class.php',25],['lib/classes/task','sync_plans_from_template_cohorts_task.php',50],['admin/tool/monitor/classes','notification_task.php',39],['lib/dml/tests','dml_test.php',5543],['lib/htmlpurifier/HTMLPurifier/Strategy','FixNesting.php',41],['mod/lti/service/memberships/classes/local/resource','contextmemberships.php',60],['admin/tool/monitor/classes/task','check_subscriptions.php',60],['backup/util/interfaces','executable.class.php',32],['backup/util/plan','base_task.class.php',162]], 1058],
'get_recordset_sql': ['get_recordset_sql', 'Get a number of records as an moodle_recordset.  $sql must be a complete SQL query. Since this method is a little less readable, use of it should be restricted to code where it\'s possible there might be large datasets being returned.  For known small datasets use get_records_sql - it leads to simpler code. ', [['lib/dml','pdo_moodle_database.php',252],['lib/dml','oci_native_moodle_database.php',1106],['lib/dml','pgsql_native_moodle_database.php',688],['lib/dml','mssql_native_moodle_database.php',736],['lib/dml','mysqli_native_moodle_database.php',993],['lib/dml','sqlsrv_native_moodle_database.php',811],['lib/dml/tests','dml_test.php',5544]], 283],
'readfile_accel': ['readfile_accel', 'Enhanced readfile() with optional acceleration. ', [['lib','filelib.php',1853]], 6],
'delete_area_files': ['delete_area_files', 'Delete all area files (optionally limited by itemid). ', [['lib/filestorage','file_storage.php',992]], 123],
'get_converted_document': ['get_converted_document', 'Get converted document. ', [['lib/filestorage','file_storage.php',180]], 7],
'get_filepath': ['get_filepath', 'Returns file path ', [['lib/filebrowser','virtual_root_file.php',218],['lib/filestorage','stored_file.php',690],['backup/util/ui','restore_ui_stage.class.php',547]], 147],
'get_filesize': ['get_filesize', 'Returns file size in bytes, null for directories ', [['lib/filebrowser','file_info.php',268],['lib/filebrowser','virtual_root_file.php',245],['lib/filebrowser','file_info_stored.php',221],['lib/filestorage','stored_file.php',717]], 83],
'get_or_create_referencefileid': ['get_or_create_referencefileid', 'Returns the id of the record in {files_reference} that matches the passed repositoryid and reference ', [['lib/filestorage','file_storage.php',2619]], 1],
'move_area_files_to_new_context': ['move_area_files_to_new_context', 'Move all the files in a file area from one context to another. ', [['lib/filestorage','file_storage.php',1069]], 21],
'create_imagefile_preview': ['create_imagefile_preview', 'Generates a preview for the stored image file ', [['lib/filestorage','file_storage.php',628]], 1],
'create_file_from_pathname': ['create_file_from_pathname', 'Create new file from pathname - make sure params are valid. ', [['lib/filebrowser','file_info.php',392],['lib/filebrowser','file_info_stored.php',537],['lib/filestorage','file_storage.php',1367]], 54],
'get_recordset_select': ['get_recordset_select', 'Get a number of records as a moodle_recordset which match a particular WHERE clause. ', [['lib/dml','moodle_database.php',1224]], 45],
'get_contextid': ['get_contextid', '', [['backup/moodle2','backup_block_task.class.php',96],['backup/moodle2','restore_activity_task.class.php',115],['backup/moodle2','restore_block_task.class.php',133],['lib/filebrowser','virtual_root_file.php',182],['lib/filestorage','stored_file.php',652],['backup/moodle2','restore_section_task.class.php',63],['backup/moodle2','backup_course_task.class.php',50],['backup/converter/moodle1','lib.php',524],['backup/moodle2','restore_course_task.class.php',57],['backup/moodle2','backup_activity_task.class.php',103]], 154],
'list': ['list', '', [['mod/data/preset/imagegallery','jstemplate.js',9]], 2229],
'file_exists': ['file_exists', 'Wrapper around global function file_exists() ', [['lib/spout/src/Spout/Common/Helper','GlobalFunctionsHelper.php',146],['lib/filestorage','file_storage.php',134],['lib/phpexcel/PHPExcel/Shared','File.php',61]], 867],
'download_file_content': ['download_file_content', 'Fetches content of file from Internet (using proxy if defined). Uses cURL extension if present. Due to security concerns only downloads from http(s) sources are supported. ', [['lib','filelib.php',1154],['lib/tests/fixtures','testable_update_code_manager.php',44],['lib/classes/update','code_manager.php',427]], 32],
'can_convert_documents': ['can_convert_documents', 'Check if the installed version of unoconv is supported. ', [['lib/filestorage','file_storage.php',234]], 1],
'create_file_from_storedfile': ['create_file_from_storedfile', 'Create new file from stored file - make sure params are valid. ', [['lib/filebrowser','file_info.php',405],['lib/filebrowser','file_info_stored.php',584],['lib/filestorage','file_storage.php',1186]], 47],
'get_references_by_storedfile': ['get_references_by_storedfile', 'Returns all aliases that link to the given stored_file ', [['lib/filestorage','file_storage.php',2382]], 2],
'remove_dir': ['remove_dir', 'Delete directory or only its content ', [['lib','moodlelib.php',9041]], 47],
'create_directory': ['create_directory', 'Create new directory, may throw exception - make sure params are valid. ', [['lib/filebrowser','file_info.php',367],['lib/filebrowser','file_info_stored.php',461],['lib/filestorage','file_storage.php',1100]], 23],
'mimeinfo': ['mimeinfo', 'Obtains information about a filetype based on its extension. Will use a default if no information is present about that particular extension. ', [['lib','filelib.php',1422]], 33],
'get_file_instance': ['get_file_instance', 'Create instance of file class from database record. ', [['lib/filestorage','file_storage.php',169]], 20],
'get_pathname_hash': ['get_pathname_hash', 'Calculates sha1 hash of unique full path name information. ', [['lib/filestorage','file_storage.php',116]], 12],
'content_exists': ['content_exists', 'Content exists ', [['lib/filestorage','file_storage.php',2082]], 3],
'get_file_by_id': ['get_file_by_id', 'Fetch file using local file id. ', [['lib/filestorage','file_storage.php',655]], 6],
'get_filename': ['get_filename', 'Returns file name ', [['lib/filebrowser','virtual_root_file.php',227],['lib/filestorage','stored_file.php',699],['lib','medialib.php',169]], 248],
'record_exists': ['record_exists', 'Check if a record exists by ID. ', [['competency/classes','persistent.php',842],['lib/dml','moodle_database.php',1817]], 901],
'import_external_file': ['import_external_file', 'Convert file alias to local file ', [['lib/filestorage','file_storage.php',2456]], 3],
'strlen': ['strlen', 'Counts the number of characters. Unit-tested by Kasper (single byte charsets only) ', [['lib/typo3','class.t3lib_cs.php',1520],['lib/classes','text.php',305]], 1649],
'path_from_hash': ['path_from_hash', 'Return path to file with given hash. ', [['lib/filestorage','file_storage.php',2094]], 8],
'get_contenthash': ['get_contenthash', 'Returns sha1 hash code ', [['lib/filebrowser','virtual_root_file.php',299],['lib/filestorage','stored_file.php',795]], 78],
'copy_content_to': ['copy_content_to', 'Copy content of file to given pathname ', [['lib/filebrowser','virtual_root_file.php',115],['lib/filestorage','stored_file.php',466]], 13],
'get_file_storage': ['get_file_storage', 'Returns local file storage instance ', [['lib','moodlelib.php',6144]], 546],
'check_dir_exists': ['check_dir_exists', 'Function to check if a directory exists and by default create it if not exists. ', [['lib','setuplib.php',1430]], 46],
'get_id': ['get_id', 'Getter for $id. ', [['lib/classes/task','adhoc_task.php',51],['backup/converter','convertlib.php',100],['lib/filebrowser','virtual_root_file.php',290],['lib','adminlib.php',1719],['admin/tool/uploadcourse/classes','course.php',335],['lib/simplepie/library/SimplePie','Item.php',199],['lib/filestorage','stored_file.php',786],['cache/classes','definition.php',613],['grade/grading/form','lib.php',854],['question/engine','questionusage.php',120],['mod/lti/classes/local/ltiservice','service_base.php',76],['blocks/rss_client/classes/output','item.php',152],['backup/controller','backup_controller.class.php',263],['question/engine','questionattemptstep.php',136],['mod/lti/classes/local/ltiservice','resource_base.php',81]], 2250],
'make_temp_directory': ['make_temp_directory', 'Create a directory under tempdir and make sure it is writable. ', [['lib','setuplib.php',1642]], 50],
'add_string_to_pool': ['add_string_to_pool', 'Add string content to sha1 pool. ', [['lib/filestorage','file_storage.php',1997]], 3],
'get_area_tree': ['get_area_tree', 'Returns array based tree structure of area files ', [['lib/filestorage','file_storage.php',827]], 10],
'get_file_preview': ['get_file_preview', 'Returns an image file that represent the given stored file as a preview ', [['lib/filestorage','file_storage.php',411]], 5],
'start_delegated_transaction': ['start_delegated_transaction', 'On DBs that support it, switch to transaction mode and begin a transaction you\'ll need to ensure you call allow_commit() on the returned object or your changes *will* be lost. ', [['lib/dml','moodle_database.php',2393]], 145],
'on': ['on', '', [['lib/requirejs','require.js',508],['lib/jquery','jquery-3.1.0.js',4809]], 3823],
'get_referencefileid': ['get_referencefileid', 'get reference file id ', [['lib/filestorage','stored_file.php',909],['lib/filestorage','file_storage.php',2658]], 18],
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pdo_moodle_database.php',461],['lib/dml','oci_native_moodle_database.php',1404],['lib/dml','pgsql_native_moodle_database.php',1089],['lib/dml','mssql_native_moodle_database.php',1067],['lib/dml','mysqli_native_moodle_database.php',1405],['lib/dml','sqlsrv_native_moodle_database.php',1148],['lib/dml/tests','dml_test.php',5551]], 650],
'get_directory_files': ['get_directory_files', 'Returns all files and optionally directories ', [['lib/filestorage','file_storage.php',899]], 25],
'convert_image': ['convert_image', 'Creates new image file from existing. ', [['lib/filestorage','file_storage.php',1734]], 7],
'delete_component_files': ['delete_component_files', 'Delete all files associated with the given component. ', [['lib/filestorage','file_storage.php',1054]], 2],
'set_config': ['set_config', 'Set a key in global configuration ', [['lib','moodlelib.php',1336],['lib','enrollib.php',1153],['lib/editor/tinymce/classes','plugin.php',84],['mod/assign','assignmentplugin.php',314],['lib/portfolio','plugin.php',515]], 1119],
'cron': ['cron', 'Find user\'s who have completed this criteria ', [['completion/criteria','completion_criteria_course.php',152],['enrol/manual','lib.php',284],['admin/registration','lib.php',50],['question/engine','bank.php',415],['completion/criteria','completion_criteria_date.php',144],['repository/dropbox','lib.php',704],['lib/classes/update','checker.php',193],['enrol/imsenterprise','lib.php',87],['lib','enrollib.php',1980],['repository','lib.php',2357],['auth/mnet','auth.php',832],['enrol/self','lib.php',423],['cache/classes','helper.php',659],['enrol/cohort','lib.php',164],['lib/filestorage','file_storage.php',2494],['enrol/category','lib.php',77],['mod/assign','assignmentplugin.php',534],['mod/assign','locallib.php',1880],['completion/criteria','completion_criteria_grade.php',185],['blocks/recent_activity','block_recent_activity.php',231],['completion/criteria','completion_criteria_activity.php',198],['enrol/paypal','lib.php',303],['completion/criteria','completion_criteria_duration.php',197],['blocks/rss_client','block_rss_client.php',262],['enrol/meta','lib.php',206]], 71],
'get_recordset': ['get_recordset', 'Get the recordset. ', [['mod/glossary/classes','entry_query_builder.php',305],['lib/dml','moodle_database.php',1162]], 92],
'instance_sql_fields': ['instance_sql_fields', 'Get the sql formated fields for a file instance to be created from a {files} and {files_refernece} join. ', [['lib/filestorage','file_storage.php',2586]], 10],
'debugging': ['debugging', 'Standard Debugging Function ', [['lib','weblib.php',3012]], 1007],
'get_record_sql': ['get_record_sql', 'Get a single database record as an object using a SQL statement. ', [['lib/dml','oci_native_moodle_database.php',1076],['lib/dml','moodle_database.php',1506]], 157],
'trash_path_from_hash': ['trash_path_from_hash', 'Return path to file with given hash. ', [['lib/filestorage','file_storage.php',2108]], 2],
'fulldelete': ['fulldelete', 'Recursively delete the file or folder with path $location. That is, if it is a file delete it. If it is a folder, delete all its content then delete it. If $location does not exist to start, that is not considered an error. ', [['lib','filelib.php',2370]], 39],
'sort_area_tree': ['sort_area_tree', 'Sorts the result of {@link file_storage::get_area_tree()}. ', [['lib/filestorage','file_storage.php',879]], 2],
'get_field': ['get_field', 'Gets an instance of the form field. ', [['lib/behat','behat_field_manager.php',248],['mod/quiz/report/statistics/classes','calculated.php',109],['lib/dml','moodle_database.php',1546],['user/filters','lib.php',124]], 536],
'get_timemodified': ['get_timemodified', 'Returns time modified unix timestamp if known ', [['lib/filebrowser','file_info.php',295],['lib/filebrowser','virtual_root_file.php',272],['lib/filebrowser','file_info_stored.php',258],['lib/filestorage','stored_file.php',756]], 63],
'delete_area_files_select': ['delete_area_files_select', 'Delete all the files from certain areas where itemid is limited by an arbitrary bit of SQL. ', [['lib/filestorage','file_storage.php',1023]], 2],
'deleted_file_cleanup': ['deleted_file_cleanup', 'Marks pool file as candidate for deleting. ', [['lib/filestorage','file_storage.php',2156]], 5],
'valid': ['valid', 'Did we reach the end? ', [['lib/filestorage','zip_archive.php',514],['lib/spout/src/Spout/Reader/XLSX','SheetIterator.php',51],['lib/dml','mssql_native_moodle_recordset.php',83],['lib/phpexcel/PHPExcel/Worksheet','RowCellIterator.php',191],['lib/phpexcel/PHPExcel/Worksheet','ColumnIterator.php',184],['lib/horde/framework/Horde/Imap/Client','Tokenize.php',329],['lib/dml','mysqli_native_moodle_recordset.php',82],['lib/phpexcel/PHPExcel/Worksheet','RowIterator.php',175],['lib/horde/framework/Horde/Mail/Rfc822','List.php',439],['lib/dml','pdo_moodle_recordset.php',75],['lib/spout/src/Spout/Reader/CSV','RowIterator.php',104],['lib/phpexcel/PHPExcel','WorksheetIterator.php',99],['backup/util/helper','backup_null_iterator.class.php',49],['lib/horde/framework/Horde','Domhtml.php',331],['lib/dml','sqlsrv_native_moodle_recordset.php',129],['lib/classes/dml','recordset_walk.php',127],['lib/horde/framework/Horde/Imap/Client','Ids.php',419],['backup/util/helper','backup_array_iterator.class.php',59],['lib/spout/src/Spout/Reader/CSV','SheetIterator.php',44],['lib/dml','oci_native_moodle_recordset.php',76],['lib/adodb','adodb.inc.php',3041],['lib/adodb','adodb.inc.php',3168],['lib/phpexcel/PHPExcel/Worksheet','ColumnCellIterator.php',182],['lib/spout/src/Spout/Reader/XLSX','RowIterator.php',110],['question/engine','questionusage.php',999],['question/engine/tests','helpers.php',1237],['backup/cc/cc_lib','cc_version11.php',47],['lib/spout/src/Spout/Reader/ODS','SheetIterator.php',75],['backup/cc/cc_lib','cc_version1.php',47],['backup/cc/cc_lib','cc_asssesment.php',58],['lib/spout/src/Spout/Reader/ODS','RowIterator.php',80],['lib/google/src/Google','Collection.php',45],['lib/horde/framework/Horde/Imap/Client/Data','AclRights.php',182],['lib/horde/framework/Horde/Imap/Client/Fetch','Query.php',378],['question/engine','questionattempt.php',1643],['question/engine','questionattempt.php',1762],['lib/tests','completionlib_test.php',903],['lib/dml','pgsql_native_moodle_recordset.php',103]], 81],
'__construct': ['__construct', '', [['lib/adodb/drivers','adodb-odbc_mssql.inc.php',50],['lib/adodb/drivers','adodb-odbc_mssql.inc.php',359],['question/classes/statistics/responses','analyser.php',69],['auth/radius','auth.php',38],['lib/xmldb','xmldb_file.php',43],['lib/lessphp/Tree/Mixin','Definition.php',18],['cache/stores/static','lib.php',127],['lib/classes/session','file.php',40],['lib/htmlpurifier/HTMLPurifier/Lexer','DOMLex.php',35],['backup/util/ui','base_moodleform.class.php',68],['lib/simplepie/library/SimplePie','Author.php',81],['lib/filestorage','zip_archive.php',66],['backup/util/structure','restore_path_element.class.php',47],['backup/util/structure','restore_path_element.class.php',128],['lib/htmlpurifier/HTMLPurifier/ChildDef','Chameleon.php',36],['lib/phpexcel/PHPExcel','HashTable.php',44],['mod/quiz/tests','repaginate_test.php',39],['lib/form','modvisible.php',43],['lib/phpexcel/PHPExcel/Worksheet','Row.php',44],['cache','disabledlib.php',44],['lib/phpexcel/PHPExcel/Worksheet','Dimension.php',58],['lib/mustache/src/Mustache/Cache','FilesystemCache.php',27],['question/type/ddwtos','question.php',61],['mnet/xmlrpc','client.php',25],['lib/horde/framework/Horde/Imap/Client','Url.php',112],['lib/classes','useragent.php',115],['lib/pear/HTML/QuickForm','advcheckbox.php',66],['lib/classes/update','checker_exception.php',37],['lib/phpexcel/PHPExcel/Reader','Excel2007.php',53],['lib/jabber/XMPP','XMPP.php',101],['lib/form','radio.php',44],['lib/spout/src/Spout/Reader/XLSX/Helper','StyleHelper.php',45],['auth/cas/CAS/CAS/ProxiedService/Http','Abstract.php',58],['lib/phpexcel/PHPExcel/Style','Border.php',67],['lib/htmlpurifier/HTMLPurifier','HTMLDefinition.php',182],['lib/adodb/drivers','adodb-oci8quercus.inc.php',31],['lib/adodb/drivers','adodb-oci8quercus.inc.php',45],['lib/spout/src/Spout/Reader/XLSX','SheetIterator.php',29],['lib/horde/framework/Horde/Imap/Client/Interaction','Server.php',91],['lib/phpexcel/PHPExcel','DocumentProperties.php',123],['lib/typo3','class.t3lib_cs.php',509],['mod/workshop/allocation/scheduled','lib.php',48],['lib/adodb/drivers','adodb-netezza.inc.php',53],['lib/adodb/drivers','adodb-netezza.inc.php',144],['mod/feedback/classes','complete_form.php',58],['search/classes','document.php',188],['webservice/rest','locallib.php',40],['lib/dml','mssql_native_moodle_recordset.php',34],['mod/assign/feedback/editpdf/fpdi','fpdi_pdf_parser.php',57],['lib/htmlpurifier/HTMLPurifier','TokenFactory.php',43],['backup/moodle2','backup_block_task.class.php',43],['lib/lessphp/Tree','Negative.php',14],['lib/minify/lib/Minify/Cache','APC.php',19],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',54],['lib/pear/HTML/QuickForm','header.php',33],['lib/spout/src/Spout/Reader/XLSX/Helper/SharedStringsCaching','InMemoryStrategy.php',26],['lib/phpexcel/PHPExcel/Worksheet','RowCellIterator.php',51],['lib/simplepie/library/SimplePie/XML/Declaration','Parser.php',110],['lib/phpexcel/PHPExcel/Worksheet','ColumnIterator.php',60],['lib/spout/src/Spout/Reader/ODS','Sheet.php',33],['question/type/calculated/tests','helper.php',205],['lib/adodb/drivers','adodb-odbtp.inc.php',38],['lib/adodb/drivers','adodb-odbtp.inc.php',673],['lib/adodb/drivers','adodb-odbtp.inc.php',796],['lib/adodb/drivers','adodb-odbtp.inc.php',806],['lib/adodb/drivers','adodb-odbtp.inc.php',816],['lib/adodb/drivers','adodb-odbtp.inc.php',826],['lib/adodb/drivers','adodb-odbtp.inc.php',836],['enrol/lti/ims-blti','blti.php',28],['backup/cc','cc2moodle.php',105],['mod/chat','locallib.php',181],['mod/chat','locallib.php',229],['user/filters','simpleselect.php',45],['lib/phpexcel/PHPExcel/CachedObjectStorage','Memcache.php',244],['lib/dml','pdo_moodle_database.php',42],['lib/adodb/drivers','adodb-sqlite3.inc.php',36],['lib/adodb/drivers','adodb-sqlite3.inc.php',350],['lib/pear/HTML/QuickForm','static.php',44],['competency/classes/external','comment_area_exporter.php',48],['lib/lessphp/Tree','Selector.php',31],['auth/cas/CAS/CAS','TypeMismatchException.php',43],['auth/fc','fcFPP.php',33],['lib/xmldb','xmldb_key.php',43],['grade/grading/form/rubric','rubriceditor.php',56],['lib/google/src/Google/Service','Cloudlatencytest.php',40],['course','moodleform_mod.php',69],['auth/nntp','auth.php',35],['grade/report/grader','lib.php',111],['admin/tool/generator/classes','course_backend.php',116],['lib/minify/lib','FirePHP.php',189],['lib/adodb/drivers','adodb-sqlitepo.inc.php',38],['lib/horde/framework/Horde/Imap/Client','Tokenize.php',67],['lib/phpexcel/PHPExcel/CachedObjectStorage','CacheBase.php',66],['lib/lessphp/Tree','Rule.php',24],['lib/behat/features/bootstrap','behat_init_context.php',45],['lib','dmllib.php',69],['lib','dmllib.php',84],['lib','dmllib.php',104],['lib','dmllib.php',129],['lib','dmllib.php',159],['lib','dmllib.php',187],['lib','dmllib.php',240],['lib','dmllib.php',270],['lib/google/src/Google/Service','DataTransfer.php',44],['lib/google/src/Google/Http','Batch.php',42],['backup/util/structure','base_processor.class.php',49],['admin/tool/lpmigrate/classes','framework_mapper.php',50],['lib/phpexcel/PHPExcel/Reader','OOCalc.php',46],['lib/lessphp/Tree','NameValue.php',22],['mod/quiz/classes','admin_review_setting.php',82],['lib/htmlpurifier/HTMLPurifier','Generator.php',67],['mod/quiz/report','attemptsreport_table.php',76],['blocks/lp/classes/output','summary.php',59],['lib/google/src/Google/IO','Stream.php',45],['lib/google/src/Google/Service','Freebase.php',38],['grade/tests','reportlib_test.php',36],['search/classes','manager.php',100],['question/behaviour/adaptive','behaviour.php',310],['admin/tool/lp/classes/form','framework_autocomplete.php',48],['lib/minify/lib','JSMinPlus.php',193],['lib/minify/lib','JSMinPlus.php',726],['lib/minify/lib','JSMinPlus.php',1638],['lib/minify/lib','JSMinPlus.php',1656],['lib/minify/lib','JSMinPlus.php',1748],['lib/simplepie/library/SimplePie','Copyright.php',73],['lib/phpexcel/PHPExcel/Style','Conditional.php',93],['lib/google/src/Google/Task','Runner.php',76],['backup/util/settings/root','root_backup_setting.class.php',34],['lib','componentlib.class.php',179],['lib','componentlib.class.php',610],['lib','componentlib.class.php',834],['lib/google/src/Google/Service','AdSense.php',68],['lib/htmlpurifier/HTMLPurifier/AttrDef','Clone.php',18],['lib/spout/src/Spout/Reader/CSV','Sheet.php',24],['lib/filebrowser','file_info_context_system.php',37],['lib/grade','grade_item.php',260],['lib/horde/framework/Horde/Imap/Client/Data/Format','Nstring.php',27],['repository/boxnet','lib.php',56],['auth/email','auth.php',34],['mod/wiki/editors','wikifiletable.php',40],['lib/google/src/Google/Service','Replicapool.php',51],['lib/dtl','database_exporter.php',55],['lib/horde/framework/Horde/Imap/Client/Namespace','List.php',34],['lib/phpexcel/PHPExcel/Writer','CSV.php',79],['lib/google/src/Google/Service','Tasks.php',44],['lib/dml','mysqli_native_moodle_recordset.php',42],['lib/google/src/Google/Service','GamesManagement.php',50],['lib/minify/lib/Minify','Source.php',43],['lib/jabber/XMPP','Roster.php',48],['lib/lessphp/Tree','Element.php',19],['lib/classes','string_manager_install.php',43],['question/type','questiontypebase.php',55],['question/type','questiontypebase.php',1442],['lib/form','filemanager.php',54],['lib/form','filemanager.php',316],['lib/htmlpurifier/HTMLPurifier/ChildDef','Custom.php',36],['backup/util/ui','renderer.php',813],['lib/simplepie/library/SimplePie','Rating.php',73],['lib/phpexcel/PHPExcel/Cell','Hyperlink.php',44],['question/classes/statistics/questions','calculator.php',66],['backup/moodle2','backup_xml_transformer.class.php',50],['lib/google/src/Google/Service','Resource.php',62],['lib/form','autocomplete.php',56],['lib/phpexcel/PHPExcel/Worksheet','RowIterator.php',60],['mod/lesson/classes','file_info.php',45],['question/type/tests','question_first_matching_answer_grading_strategy_test.php',40],['lib/google/src/Google/Service','Partners.php',43],['cache','lib.php',66],['cache','lib.php',109],['cache','lib.php',138],['cache','lib.php',183],['grade/edit/tree','lib.php',57],['grade/edit/tree','lib.php',635],['grade/edit/tree','lib.php',668],['grade/edit/tree','lib.php',834],['lib/simplepie/library/SimplePie','Cache.php',69],['mod/wiki/diff','difflib.php',277],['mod/wiki/diff','difflib.php',381],['mod/wiki/diff','difflib.php',478],['lib/pear/HTML/QuickForm','select.php',58],['lib/classes/output','mustache_javascript_helper.php',40],['lib/phpexcel/PHPExcel/Reader/Excel2007','Theme.php',68],['mod/data','export_form.php',16],['lib/pear/HTML/QuickForm','autocomplete.php',67],['question/type/shortanswer','question.php',44],['lib/google/src/Google/Service','AndroidPublisher.php',52],['lib/google/src/Google/Verifier','Pem.php',31],['lib/classes/antivirus','scanner.php',41],['lib/phpexcel/PHPExcel/Reader','Excel5.php',414],['lib/horde/framework/Horde/Imap/Client/Auth','DigestMD5.php',69],['lib/classes/output','mustache_filesystem_loader.php',39],['lib/classes/output','inplace_editable.php',107],['lib/adodb/drivers','adodb-informix.inc.php',37],['competency/classes','competency_rule.php',45],['lib/phpexcel/PHPExcel','RichText.php',37],['lib/phpexcel/PHPExcel/Shared/JAMA','Matrix.php',59],['lib/pear/HTML/QuickForm','input.php',38],['repository/picasa','lib.php',41],['mod/feedback/classes','structure.php',48],['backup/util/plan','backup_structure_step.class.php',38],['question/classes/bank','random_question_loader.php',61],['mod/quiz/report/statistics/classes','calculated.php',43],['lib/horde/framework/Horde/Stream','String.php',27],['backup/util/helper','restore_decode_content.class.php',50],['backup/util/helper','restore_decode_content.class.php',125],['mod/workshop/backup/moodle1','lib.php',308],['lib/google/src/Google/Service','YouTubeReporting.php',47],['grade/export/txt','grade_export_txt.php',27],['lib/mustache/src/Mustache/Exception','SyntaxException.php',23],['lib/tcpdf','tcpdf_barcodes_2d.php',58],['mod/imscp','locallib.php',289],['lib/form','selectyesno.php',42],['lib/horde/framework/Horde/Mail/Transport','Smtphorde.php',62],['mod/lti/service/toolsettings/classes/local/service','toolsettings.php',41],['mod/lti/service/profile/classes/local/service','profile.php',41],['repository/flickr_public','lib.php',49],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','BackgroundPosition.php',57],['admin/tool/lp/classes/output','template_cohorts_table.php',53],['lib/simplepie/library','SimplePie.php',611],['lib/horde/framework/Horde/Imap/Client/Base','Debug.php',55],['lib/google/src/Google/Service','Reseller.php',44],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Border.php',18],['lib/testing/generator','component_generator_base.php',45],['lib/horde/framework/Horde/Translation/Handler','Gettext.php',34],['lib/phpexcel/PHPExcel/Worksheet','HeaderFooter.php',175],['lib/classes','plugin_manager.php',91],['lib/horde/framework/Horde/Imap/Client/Data/Format','List.php',28],['lib/horde/framework/Horde/Support','CombineStream.php',29],['lib/xmldb','xmldb_field.php',84],['lib/adodb/drivers','adodb-ibase.inc.php',59],['lib/adodb/drivers','adodb-ibase.inc.php',764],['lib/htmlpurifier/HTMLPurifier/AttrDef','URI.php',23],['admin/roles/classes','view_role_definition_table.php',28],['lib/google/src/Google/Cache','Memcache.php',44],['lib/pear/HTML/QuickForm','radio.php',48],['lib/filebrowser','file_info_context_coursecat.php',39],['lib/spout/src/Spout/Writer/ODS/Internal','Workbook.php',37],['mod/workshop/eval/best','lib.php',44],['lib/phpexcel/PHPExcel/Writer/PDF','DomPDF.php',38],['grade/report','lib.php',156],['lib','csslib.php',1501],['lib','csslib.php',1587],['lib','csslib.php',2068],['lib','csslib.php',2136],['lib','csslib.php',2242],['availability/classes','info_module.php',40],['mod/book','locallib.php',414],['question/engine','datalib.php',68],['question/engine','datalib.php',1331],['question/engine','datalib.php',1632],['question/engine','datalib.php',1740],['question/engine','datalib.php',1870],['question/engine','datalib.php',1941],['webservice','lib.php',745],['webservice','lib.php',841],['lib/adodb/drivers','adodb-informix72.inc.php',59],['lib/adodb/drivers','adodb-informix72.inc.php',399],['lib/adodb','adodb-pager.inc.php',60],['user/classes/output/myprofile','category.php',68],['lib/lessphp/Visitor','extendFinder.php',15],['backup/util/settings','base_setting.class.php',89],['backup/util/settings','base_setting.class.php',556],['lib','filelib.php',2720],['lib','filelib.php',3601],['lib/phpunit/classes','database_driver_testcase.php',55],['lib/phpexcel/PHPExcel/Shared/OLE/PPS','File.php',32],['report/competency/classes/output','report.php',56],['lib/google/src/Google/Service','Computeaccounts.php',49],['question/type','edit_question_form.php',96],['lib/filebrowser','file_info_context_user.php',39],['admin/tool/lp/classes/output','template_plans_page.php',37],['lib/phpexcel/PHPExcel','Style.php',93],['lib/minify/lib/Minify','HTML.php',49],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','ListStyle.php',20],['lib/form','password.php',44],['backup','backup.class.php',146],['mod/feedback/classes','course_select_form.php',39],['lib/google/src/Google/Auth','AppIdentity.php',39],['lib/adodb','adodb-active-record.inc.php',121],['lib/phpexcel/PHPExcel','Chart.php',169],['lib/horde/framework/Horde/Mail/Rfc822','List.php',61],['admin/roles/classes','allow_switch_page.php',33],['lib/grade','grade_object.php',80],['lib/google/src/Google/IO','Exception.php',29],['auth/lti','auth.php',38],['mod/quiz/report/statistics/classes','calculator.php',39],['lib/htmlpurifier','HTMLPurifier.php',104],['admin/tool/lp/classes/output','user_competency_summary_in_plan.php',47],['mod/assign/feedback/editpdf/classes','widget.php',53],['lib/evalmath','evalmath.class.php',120],['lib/form','url.php',46],['lib/dml','pdo_moodle_recordset.php',41],['lib/htmlpurifier/HTMLPurifier/TagTransform','Simple.php',19],['backup/cc/cc_lib','xmlbase.php',52],['badges/lib','bakerlib.php',52],['lib/google/src/Google/Signer','P12.php',35],['availability/classes','info_section.php',40],['lib/form','static.php',47],['backup/converter','convertlib.php',52],['backup/converter','convertlib.php',277],['lib/google/src/Google/Service','YouTubeAnalytics.php',56],['admin/roles/classes','check_capability_table.php',40],['lib/htmlpurifier/HTMLPurifier','AttrTypes.php',14],['lib/adodb/drivers','adodb-postgres64.inc.php',127],['lib/adodb/drivers','adodb-postgres64.inc.php',919],['backup/util/helper','restore_prechecks_helper.class.php',213],['user/profile','lib.php',59],['lib/google/src/Google/Service','Admin.php',40],['lib/spout/src/Spout/Reader/CSV','RowIterator.php',62],['lib/google/src/Google/Service','MapsEngine.php',66],['lib','listlib.php',82],['lib','listlib.php',485],['lib/phpexcel/PHPExcel/Writer','HTML.php',128],['backup/moodle2','restore_activity_task.class.php',48],['lib/htmlpurifier/HTMLPurifier','HTMLModuleManager.php',68],['lib/simplepie/library/SimplePie','Source.php',61],['completion','data_object.php',68],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','ID.php',28],['grade/report/singleview/classes/local/ui','dropdown_attribute.php',49],['lib/horde/framework/Horde/Support','Stack.php',18],['lib/google/src/Google/Cache','File.php',41],['lib/horde/framework/Horde/Mail/Transport','Mock.php',76],['backup/util/ui','backup_moodleform.class.php',41],['availability/condition/grouping/classes','condition.php',46],['lib/classes/session','memcache.php',50],['cache/classes','dummystore.php',62],['badges/classes','assertion.php',49],['lib/xhprof/xhprof_lib/utils','xhprof_runs.php',87],['availability/tests/fixtures','mock_condition.php',52],['lib/mustache/src/Mustache/Loader','FilesystemLoader.php',33],['mod/quiz/report','attemptsreport_options.php',95],['lib/phpexcel/PHPExcel/Writer/PDF','tcPDF.php',39],['lib/minify/lib/Minify/CSS','Compressor.php',51],['lib/google/src/Google/Service','Dns.php',53],['question/type/calculatedmulti','edit_calculatedmulti_form.php',47],['backup/moodle2','restore_block_task.class.php',45],['lib/phpexcel/PHPExcel/Worksheet','AutoFilter.php',54],['lib/form','recaptcha.php',48],['lib','csvlib.class.php',64],['lib','csvlib.class.php',398],['lib/simplepie/library/SimplePie/Cache','File.php',82],['lib/phpexcel/PHPExcel/Chart','Legend.php',75],['lib/phpexcel/PHPExcel','WorksheetIterator.php',44],['cache/classes','loaders.php',196],['cache/classes','loaders.php',1189],['cache/classes','loaders.php',1586],['lib/google/src/Google/Service','Appengine.php',44],['admin/tool/lp/classes/output','template_cohorts_page.php',37],['search/classes','engine.php',77],['backup/cc/cc_lib','cc_assesment_essay.php',25],['lib/classes/progress','display.php',48],['lib/lessphp/Tree','Call.php',19],['course/format','lib.php',78],['question/type/calculated','datasetdefinitions_form.php',53],['lib/google/src/Google/Service','Translate.php',40],['enrol/database','settingslib.php',34],['lib/lessphp/Tree/Mixin','Call.php',14],['admin/tool/log/store/standard/classes/log','store.php',37],['lib/google/src/Google/Service','Urlshortener.php',40],['lib/horde/framework/Horde/Imap/Client','Socket.php',168],['lib/tests','collator_test.php',310],['lib/google/src/Google/Auth','Simple.php',31],['backup/cc/cc_lib','cc_manifest.php',45],['lib/bennu','iCalendar_properties.php',28],['lib/bennu','iCalendar_properties.php',220],['lib/bennu','iCalendar_properties.php',238],['lib/bennu','iCalendar_properties.php',259],['lib/bennu','iCalendar_properties.php',275],['lib/bennu','iCalendar_properties.php',296],['lib/bennu','iCalendar_properties.php',343],['lib/bennu','iCalendar_properties.php',358],['lib/bennu','iCalendar_properties.php',376],['lib/bennu','iCalendar_properties.php',391],['lib/bennu','iCalendar_properties.php',406],['lib/bennu','iCalendar_properties.php',447],['lib/bennu','iCalendar_properties.php',462],['lib/bennu','iCalendar_properties.php',485],['lib/bennu','iCalendar_properties.php',509],['lib/bennu','iCalendar_properties.php',524],['lib/bennu','iCalendar_properties.php',555],['lib/bennu','iCalendar_properties.php',573],['lib/bennu','iCalendar_properties.php',594],['lib/bennu','iCalendar_properties.php',637],['lib/bennu','iCalendar_properties.php',680],['lib/bennu','iCalendar_properties.php',724],['lib/bennu','iCalendar_properties.php',747],['lib/bennu','iCalendar_properties.php',782],['lib/bennu','iCalendar_properties.php',808],['lib/bennu','iCalendar_properties.php',849],['lib/bennu','iCalendar_properties.php',864],['lib/bennu','iCalendar_properties.php',905],['lib/bennu','iCalendar_properties.php',938],['lib/bennu','iCalendar_properties.php',952],['lib/bennu','iCalendar_properties.php',965],['lib/bennu','iCalendar_properties.php',987],['lib/bennu','iCalendar_properties.php',1017],['lib/bennu','iCalendar_properties.php',1031],['lib/bennu','iCalendar_properties.php',1061],['lib/bennu','iCalendar_properties.php',1075],['lib/bennu','iCalendar_properties.php',1098],['lib/bennu','iCalendar_properties.php',1110],['lib/bennu','iCalendar_properties.php',1139],['lib/bennu','iCalendar_properties.php',1160],['lib/bennu','iCalendar_properties.php',1181],['lib/bennu','iCalendar_properties.php',1203],['lib/bennu','iCalendar_properties.php',1227],['lib/bennu','iCalendar_properties.php',1260],['lib/bennu','iCalendar_properties.php',1386],['lib/bennu','iCalendar_properties.php',1407],['lib/bennu','iCalendar_properties.php',1429],['lib/bennu','iCalendar_properties.php',1450],['lib/mustache/src/Mustache/Exception','UnknownTemplateException.php',22],['lib/phpmailer','moodle_phpmailer.php',47],['availability/tests/fixtures','mock_info.php',40],['lib/horde/framework/Horde/Mail/Transport','Smtpmx.php',138],['admin/tool/lp/classes/form','persistent.php',68],['lib/adodb/drivers','adodb-mysqlt.inc.php',32],['lib/adodb/drivers','adodb-mysqlt.inc.php',96],['webservice/tests','lib_test.php',213],['lib/horde/framework/Horde/Imap/Client/Data/Format','Mailbox.php',35],['filter','local_settings_form.php',33],['mod/quiz/accessrule','accessrulebase.php',52],['lib/horde/framework/Horde/Exception','Wrapped.php',16],['mod/assign/feedback/editpdf/fpdi','pdf_parser.php',170],['lib/lessphp/Tree','Dimension.php',15],['lib/minify/lib/HTTP','ConditionalGet.php',109],['lib/adodb/perf','perf-oci8.inc.php',203],['lib/phpexcel','PHPExcel.php',361],['backup/util/helper','restore_questions_parser_processor.class.php',42],['backup/moodle2','backup_plugin.class.php',44],['lib/classes/antivirus','scanner_exception.php',38],['webservice/xmlrpc','lib.php',43],['report/loglive/classes','renderable.php',73],['course','dnduploadlib.php',109],['course','dnduploadlib.php',407],['lib/filebrowser','file_info.php',43],['lib/adodb/drivers','adodb-access.inc.php',34],['lib/adodb/drivers','adodb-access.inc.php',83],['mod/feedback/classes','responses_table.php',54],['lib/editor/tinymce','adminlib.php',36],['admin/tool/monitor/classes','rule.php',44],['lib/google/src/Google/Service','AdExchangeBuyer.php',55],['lib/filebrowser','virtual_root_file.php',45],['lib/phpexcel/PHPExcel/RichText','Run.php',35],['admin/tool/monitor/classes/output/managesubs','subs.php',51],['auth/cas/CAS/CAS','ProxyChain.php',48],['lib/htmlpurifier/HTMLPurifier','DefinitionCache.php',22],['lib/google/src/Google/Service','CivicInfo.php',40],['mod/feedback/classes/output','summary.php',52],['lib/minify/lib/Minify','Build.php',77],['lib/adodb/drivers','adodb-ado_mssql.inc.php',146],['lib/adodb/drivers','adodb-odbc.inc.php',44],['lib/adodb/drivers','adodb-odbc.inc.php',611],['lib','moodlelib.php',9421],['lib','moodlelib.php',9632],['user/selector','lib.php',85],['user/selector','lib.php',674],['admin/tool/lp/classes/output','plan_page.php',49],['repository/dropbox','lib.php',49],['lib/horde/framework/Horde/Mime','Part.php',261],['lib/spout/src/Spout/Reader/XLSX/Helper/SharedStringsCaching','CachingStrategyFactory.php',56],['lib/phpexcel/PHPExcel/Chart','Layout.php',143],['lib/mustache/src/Mustache/Loader','CascadingLoader.php',20],['lib/phpexcel/PHPExcel/Shared/JAMA','EigenvalueDecomposition.php',777],['lib/google/src/Google/Service','Books.php',60],['lib/google/src/Google/Service','Oauth2.php',50],['admin/tool/log/classes/log','store.php',30],['admin/tool/recyclebin/classes','category_bin.php',45],['lib/phpexcel/PHPExcel/Style','Color.php',64],['lib/phpexcel/PHPExcel/Worksheet','SheetView.php',69],['lib/htmlpurifier/HTMLPurifier/Token','Text.php',34],['lib/classes/update','checker.php',50],['lib/horde/framework/Horde/Socket','Client.php',52],['lib/phpexcel/PHPExcel/CachedObjectStorage','APC.php',243],['lib/horde/framework/Horde/Imap/Client/Cache','Backend.php',33],['lib/phpexcel/PHPExcel/Chart','Title.php',45],['lib/horde/framework/Horde/Imap/Client/Data','Format.php',32],['lib/adodb/drivers','adodb-text.inc.php',93],['lib/adodb/drivers','adodb-text.inc.php',379],['lib/phpexcel/PHPExcel','Calculation.php',2071],['lib/adodb/drivers','adodb-sqlite.inc.php',36],['lib/adodb/drivers','adodb-sqlite.inc.php',367],['lib/google/src/Google/Service','Analytics.php',77],['blocks/lp/classes/output','plans_to_review_page.php',48],['lib/google/src/Google/Service','Coordinate.php',48],['availability/condition/group/classes','condition.php',43],['lib/lessphp/Exception','Chunk.php',19],['lib/htmlpurifier/HTMLPurifier','PropertyListIterator.php',22],['backup/cc/cc_lib','cc_resources.php',102],['lib/horde/framework/Horde/Mail/Rfc822','Group.php',45],['backup/util/structure','base_optigroup.class.php',35],['backup/util/structure','base_optigroup.class.php',169],['question/classes/statistics/questions','calculated.php',181],['lib/horde/framework/Horde/Imap/Client/Interaction','Command.php',72],['lib/htmlpurifier/HTMLPurifier/Strategy','Core.php',8],['lib/htmlpurifier/HTMLPurifier/Filter','ExtractStyleBlocks.php',57],['backup/cc/cc_lib','cc_converter_url.php',29],['lib/xmldb','xmldb_structure.php',40],['lib/ddl','sqlite_sql_generator.php',73],['lib/pear/HTML/QuickForm','Renderer.php',31],['backup/util/helper','restore_moodlexml_parser_processor.class.php',38],['lib/pear/HTML/QuickForm','file.php',54],['lib/minify/lib/Minify/Cache','File.php',9],['lib/pear/HTML/QuickForm','xbutton.php',39],['lib/htmlpurifier','locallib.php',134],['admin/tool/recyclebin/classes','course_bin.php',45],['backup/util/plan','backup_task.class.php',32],['backup/util/plan','backup_task.class.php',56],['lib/phpexcel/PHPExcel/CachedObjectStorage','PHPTemp.php',174],['backup/util/helper','backup_helper.class.php',381],['lib/form','htmleditor.php',48],['lib','oauthlib.php',65],['lib','oauthlib.php',409],['auth/cas/CAS/CAS/PGTStorage','File.php',105],['auth/cas/CAS/CAS/ProxiedService','Imap.php',51],['repository/skydrive','lib.php',42],['lib/htmlpurifier/HTMLPurifier','ErrorCollector.php',57],['lib/classes/lock','postgres_lock_factory.php',81],['lib/phpexcel/PHPExcel/CachedObjectStorage','SQLite.php',260],['lib/horde/framework/Horde/Support','ConsistentHash.php',56],['lib/horde/framework/Horde/Exception','Pear.php',22],['lib/portfolio','exceptions.php',50],['backup/moodle2','restore_plugin.class.php',43],['lib/phpexcel/PHPExcel/CachedObjectStorage','DiscISAM.php',177],['lib/google/src/Google/Service','DoubleClickBidManager.php',40],['lib/minify/lib/Minify/JS','ClosureCompiler.php',101],['lib/horde/framework/Horde/Imap/Client/Data/Format','String.php',38],['lib/form','dateselector.php',70],['lib/spout/src/Spout/Common/Helper','EncodingHelper.php',38],['report/competency/classes/output','user_course_navigation.php',51],['lib/adodb/drivers','adodb-postgres7.inc.php',98],['lib/adodb/drivers','adodb-postgres7.inc.php',311],['lib/adodb/drivers','adodb-postgres7.inc.php',342],['lib/lessphp/Tree','Alpha.php',13],['mod/lti/service/memberships/classes/local/resource','linkmemberships.php',46],['lib/tcpdf','tcpdf.php',1822],['lib/adodb/drivers','adodb-sybase.inc.php',47],['lib/adodb/drivers','adodb-sybase.inc.php',313],['lib/adodb/drivers','adodb-sybase.inc.php',394],['lib/phpexcel/PHPExcel/Chart','PlotArea.php',44],['lib/phpexcel/PHPExcel/Chart','DataSeries.php',136],['mod/lesson','editpage_form.php',41],['question/classes/statistics/responses','analysis_for_question.php',58],['lib/horde/framework/Horde','Domhtml.php',53],['lib','formslib.php',142],['lib','formslib.php',1442],['lib','formslib.php',2653],['rating','lib.php',114],['rating','lib.php',1070],['lib/phpexcel/PHPExcel/Worksheet','Column.php',44],['lib/google/src/Google/Service','Script.php',67],['lib/adodb','adodb-xmlschema.inc.php',118],['lib/adodb','adodb-xmlschema.inc.php',245],['lib/adodb','adodb-xmlschema.inc.php',637],['lib/adodb','adodb-xmlschema.inc.php',781],['lib/adodb','adodb-xmlschema.inc.php',982],['lib/adodb','adodb-xmlschema.inc.php',1295],['lib/google/src/Google/Service','DeploymentManager.php',54],['mod/quiz','attemptlib.php',41],['mod/quiz','attemptlib.php',82],['mod/quiz','attemptlib.php',546],['mod/quiz','attemptlib.php',2337],['mod/quiz','attemptlib.php',2392],['backup/cc/cc_lib','cc_converter_forum.php',29],['lib','boxlib.php',264],['lib/simplepie/library/SimplePie','Restriction.php',81],['admin/roles/classes','allow_assign_page.php',31],['lib/adodb/drivers','adodb-pdo.inc.php',90],['lib/adodb/drivers','adodb-pdo.inc.php',553],['lib/adodb/drivers','adodb-pdo.inc.php',630],['tag/classes/output','tagareacollection.php',40],['admin/tool/lp/classes','template_statistics.php',62],['lib','weblib.php',313],['lib','weblib.php',3183],['lib','weblib.php',3483],['lib','weblib.php',3518],['lib','weblib.php',3593],['backup/cc/cc_lib','cc_converter_basiclti.php',29],['lib/html2text','Html2Text.php',232],['mod/assign/feedback/editpdf/classes','annotation.php',66],['lib/pear/HTML/QuickForm/Renderer','Array.php',143],['question/engine','lib.php',774],['question/engine','lib.php',1011],['question/engine','lib.php',1059],['lib/jabber/XMPP','XMLObj.php',76],['lib/horde/framework/Horde/Exception','PermissionDenied.php',15],['lib/editor/atto','adminlib.php',109],['lib/pear/HTML/QuickForm/Renderer','Tableless.php',116],['grade/report/history/classes/output','tablelog.php',72],['lib/google/src/Google/IO','Curl.php',38],['lib/editor/tinymce/plugins/spellchecker/classes/utils','Logger.php',31],['lib/pear/HTML/QuickForm','hiddenselect.php',41],['backup/util/ui','backup_ui_setting.class.php',70],['backup/util/ui','backup_ui_setting.class.php',200],['backup/util/ui','backup_ui_setting.class.php',398],['backup/util/ui','backup_ui_setting.class.php',504],['backup/util/ui','backup_ui_setting.class.php',583],['lib/adodb/drivers','adodb-mysqlpo.inc.php',35],['lib/adodb/drivers','adodb-mysqlpo.inc.php',82],['lib/adodb/drivers','adodb-mysqlpo.inc.php',119],['lib/google/src/Google/Service','Blogger.php',50],['backup/util/xml/output','file_xml_output.class.php',37],['lib/form','tags.php',75],['admin/tool/installaddon/classes','installer.php',219],['lib/htmlpurifier/HTMLPurifier/AttrDef','Enum.php',30],['lib/simplepie/library/SimplePie','IRI.php',252],['comment','locallib.php',39],['question/engine','states.php',61],['lib/spout/src/Spout/Reader/XLSX/Helper','CellValueFormatter.php',52],['lib/google/src/Google/Service','Dataflow.php',45],['mod/data','locallib.php',66],['mod/data','locallib.php',433],['lib/horde/framework/Horde','Variables.php',60],['backup/util/ui','base_ui.class.php',84],['lib/simplepie/library/SimplePie','Registry.php',99],['cache/locks/file','lib.php',66],['question/classes/statistics/responses','analysis_for_class.php',68],['lib/filebrowser','file_info_stored.php',51],['tag/classes/output','tagcollname.php',42],['competency/classes','persistent.php',54],['admin/tool/lp/classes/output','competency_plan_navigation.php',54],['lib/phpexcel/PHPExcel/Cell','DataValidation.php',146],['lib/pear/HTML/QuickForm','textarea.php',48],['lib/lessphp','Visitor.php',14],['lib/google/src/Google/Service','CloudUserAccounts.php',52],['question/classes/bank','column_base.php',44],['lib/minify/lib/MrClay','Cli.php',74],['lib','outputcomponents.php',80],['lib','outputcomponents.php',204],['lib','outputcomponents.php',469],['lib','outputcomponents.php',523],['lib','outputcomponents.php',589],['lib','outputcomponents.php',665],['lib','outputcomponents.php',783],['lib','outputcomponents.php',925],['lib','outputcomponents.php',1009],['lib','outputcomponents.php',2183],['lib','outputcomponents.php',2222],['lib','outputcomponents.php',2295],['lib','outputcomponents.php',2376],['lib','outputcomponents.php',2579],['lib','outputcomponents.php',2627],['lib','outputcomponents.php',2687],['lib','outputcomponents.php',2860],['lib','outputcomponents.php',3030],['lib','outputcomponents.php',3134],['lib','outputcomponents.php',3201],['lib','outputcomponents.php',3329],['lib','outputcomponents.php',3613],['lib','outputcomponents.php',3642],['lib','outputcomponents.php',3668],['lib','outputcomponents.php',3690],['lib','outputcomponents.php',3719],['lib','outputcomponents.php',3751],['lib/google/src/Google/Service','Pagespeedonline.php',39],['lib/phpexcel/PHPExcel','Cell.php',114],['lib/dml','sqlsrv_native_moodle_recordset.php',40],['repository/wikimedia','wikimedia.php',35],['lib/phpexcel/PHPExcel/Style','Fill.php',81],['lib/google/src/Google/Service','Cloudresourcemanager.php',42],['lib/editor/tinymce/classes','plugin.php',49],['mod/wiki/parser/markups','html.php',21],['lib/simplepie/library/SimplePie/Parse','Date.php',536],['lib/horde/framework/Horde/Support','Inflector.php',115],['question/type/gapselect','question.php',55],['lib/google/src/Google','Config.php',33],['badges/criteria','award_criteria_activity.php',45],['backup/util/xml/output','xml_output.class.php',52],['backup/util/xml/output','xml_output.class.php',158],['course/format/topics','renderer.php',38],['lib/adodb/drivers','adodb-oci8po.inc.php',33],['lib/adodb/drivers','adodb-oci8po.inc.php',99],['mod/workshop/allocation/random','lib.php',52],['mod/workshop/allocation/random','lib.php',727],['backup/util/structure','base_final_element.class.php',38],['backup/util/structure','base_final_element.class.php',239],['backup/util/structure','base_final_element.class.php',256],['lib/htmlpurifier/HTMLPurifier','Zipper.php',25],['lib/horde/framework/Horde/Imap/Client/Data','Thread.php',41],['lib/mustache/src/Mustache/Exception','UnknownHelperException.php',22],['backup/util/settings/activity','activity_backup_setting.class.php',25],['lib/filestorage','tgz_packer.php',749],['lib/filestorage','tgz_packer.php',831],['tag/classes','index_builder.php',96],['lib/pear/HTML/QuickForm','reset.php',37],['lib/classes/lock','lock.php',55],['admin/roles/classes','assign_user_selector_base.php',40],['backup/util/output','output_controller.class.php',44],['question/type/randomsamatch','question.php',114],['lib/google/src/Google/Service','Customsearch.php',38],['lib/lessphp/Tree','Extend.php',28],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',215],['lib/google/src/Google/Service','TagManager.php',67],['question/type/gapselect/tests','edit_form_test.php',41],['mod/lesson','locallib.php',2004],['mod/lesson','locallib.php',2611],['backup/util/helper','restore_structure_parser_processor.class.php',41],['course','renderer.php',52],['backup/util/xml/parser/processors','selective_exact_parser_processor.class.php',35],['lib','modinfolib.php',429],['lib','modinfolib.php',1665],['lib','modinfolib.php',2492],['lib','tablelib.php',128],['lib','tablelib.php',1468],['lib','tablelib.php',1633],['lib','tablelib.php',1698],['user/filters','cohort.php',36],['user/filters','text.php',37],['lib','outputrenderers.php',120],['lib','outputrenderers.php',285],['lib','outputrenderers.php',408],['lib','outputrenderers.php',4578],['lib','outputrenderers.php',4831],['repository','lib.php',116],['repository','lib.php',533],['lib','adminlib.php',791],['lib','adminlib.php',1138],['lib','adminlib.php',1212],['lib','adminlib.php',1355],['lib','adminlib.php',1556],['lib','adminlib.php',1928],['lib','adminlib.php',2040],['lib','adminlib.php',2106],['lib','adminlib.php',2199],['lib','adminlib.php',2260],['lib','adminlib.php',2302],['lib','adminlib.php',2341],['lib','adminlib.php',2429],['lib','adminlib.php',2463],['lib','adminlib.php',2621],['lib','adminlib.php',2706],['lib','adminlib.php',2935],['lib','adminlib.php',3091],['lib','adminlib.php',3233],['lib','adminlib.php',3324],['lib','adminlib.php',3488],['lib','adminlib.php',3571],['lib','adminlib.php',3682],['lib','adminlib.php',3833],['lib','adminlib.php',4067],['lib','adminlib.php',4134],['lib','adminlib.php',4352],['lib','adminlib.php',4381],['lib','adminlib.php',4410],['lib','adminlib.php',4434],['lib','adminlib.php',4464],['lib','adminlib.php',4500],['lib','adminlib.php',4535],['lib','adminlib.php',4567],['lib','adminlib.php',4657],['lib','adminlib.php',4690],['lib','adminlib.php',4748],['lib','adminlib.php',4790],['lib','adminlib.php',4814],['lib','adminlib.php',4840],['lib','adminlib.php',4863],['lib','adminlib.php',4880],['lib','adminlib.php',4925],['lib','adminlib.php',4943],['lib','adminlib.php',5002],['lib','adminlib.php',5045],['lib','adminlib.php',5080],['lib','adminlib.php',5123],['lib','adminlib.php',5206],['lib','adminlib.php',5336],['lib','adminlib.php',5378],['lib','adminlib.php',5423],['lib','adminlib.php',5480],['lib','adminlib.php',5496],['lib','adminlib.php',5552],['lib','adminlib.php',5777],['lib','adminlib.php',5831],['lib','adminlib.php',5885],['lib','adminlib.php',5902],['lib','adminlib.php',5950],['lib','adminlib.php',5992],['lib','adminlib.php',6043],['lib','adminlib.php',6099],['lib','adminlib.php',6328],['lib','adminlib.php',6508],['lib','adminlib.php',6688],['lib','adminlib.php',6782],['lib','adminlib.php',6931],['lib','adminlib.php',7088],['lib','adminlib.php',7712],['lib','adminlib.php',8147],['lib','adminlib.php',8330],['lib','adminlib.php',8617],['lib','adminlib.php',8764],['lib','adminlib.php',8924],['lib','adminlib.php',9071],['lib','adminlib.php',9235],['lib','adminlib.php',9428],['lib','adminlib.php',9482],['lib','adminlib.php',9544],['lib','adminlib.php',9589],['lib','adminlib.php',9626],['backup/cc/cc_lib','cc_organization.php',47],['backup/cc/cc_lib','cc_organization.php',145],['lib/phpexcel/PHPExcel/Chart','DataSeriesValues.php',81],['lib/horde/framework/Horde/Mail/Rfc822','Identification.php',34],['question/type/numerical','questiontype.php',507],['auth/mnet','auth.php',35],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Cache.php',68],['lib/htmlpurifier/HTMLPurifier','PropertyList.php',29],['auth/imap','auth.php',35],['tag/classes/output','taglist.php',54],['lib','pdflib.php',161],['lib/phpexcel/PHPExcel/RichText','TextElement.php',35],['lib/dml','database_column_info.php',112],['lib/horde/framework/Horde/Imap/Client/Exception','NoSupportExtension.php',33],['mod/wiki/editors','wikieditor.php',36],['lib/lessphp/SourceMap','Base64VLQ.php',67],['repository/s3','lib.php',44],['admin/tool/uploadcourse/classes','course.php',111],['lib/google/src/Google/Service','Replicapoolupdater.php',51],['lib/horde/framework/Horde/Imap/Client/Data/Format','Date.php',25],['lib/bennu','iCalendar_components.php',21],['lib/bennu','iCalendar_components.php',333],['lib/bennu','iCalendar_components.php',355],['lib/bennu','iCalendar_components.php',433],['lib/bennu','iCalendar_components.php',513],['lib/bennu','iCalendar_components.php',551],['lib/bennu','iCalendar_components.php',602],['lib/bennu','iCalendar_components.php',659],['lib/bennu','iCalendar_components.php',679],['lib/phpexcel/PHPExcel/Calculation','FormulaToken.php',102],['mod/feedback/item','feedback_item_class.php',28],['lib/adodb/drivers','adodb-mssql_n.inc.php',245],['lib','badgeslib.php',133],['lib/pear/HTML/QuickForm','text.php',38],['lib/simplepie/library/SimplePie','Enclosure.php',219],['calendar/classes','rrule_manager.php',182],['auth/webservice','auth.php',35],['lib','outputrequirementslib.php',171],['mod/lti/service/toolsettings/classes/local/resource','contextsettings.php',44],['lib','questionlib.php',1261],['lib','questionlib.php',1505],['lib','uploadlib.php',40],['lib/spout/src/Spout/Writer/Common/Helper','ZipHelper.php',28],['lib/google/src/Google/Service','Cloudsearch.php',40],['backup/util/structure','backup_nested_element.class.php',44],['lib/spout/src/Spout/Writer/Common','Sheet.php',39],['question/behaviour','behaviourbase.php',50],['blocks/rss_client/classes/output','footer.php',47],['lib/dtl','file_xml_database_importer.php',34],['admin/roles/classes','capability_table_with_risks.php',45],['lib/adodb/drivers','adodb-mssql.inc.php',110],['lib/adodb/drivers','adodb-mssql.inc.php',870],['lib/adodb/drivers','adodb-mssql.inc.php',1077],['lib/google/src/Google/Service','Bigquery.php',62],['lib/google/src/Google/Service','ShoppingContent.php',50],['mod/lti','OAuth.php',73],['mod/lti','OAuth.php',89],['mod/lti','OAuth.php',244],['mod/lti','OAuth.php',499],['repository/equella','lib.php',42],['lib/phpexcel/PHPExcel/Worksheet','PageMargins.php',80],['backup/cc/cc_lib','cc_converter_quiz.php',33],['lib/horde/framework/Horde/Imap/Client/Interaction','Pipeline.php',60],['lib/phpexcel/PHPExcel/Shared/trend','polynomialBestFitClass.php',199],['backup/util/helper','restore_decode_processor.class.php',47],['backup/util/helper','restore_decode_processor.class.php',182],['cache/classes','helper.php',90],['lib/simplepie/library/SimplePie','Credit.php',81],['lib/classes','chart_series.php',62],['lib/classes/dml','recordset_walk.php',64],['lib/google/src/Google/Service','Webmasters.php',47],['lib/tcpdf/include/barcodes','qrcode.php',631],['backup/moodle2','backup_settingslib.php',42],['backup/moodle2','backup_settingslib.php',138],['lib/spout/src/Spout/Writer/XLSX/Helper','SharedStringsHelper.php',40],['course/tests/fixtures','course_capability_assignment.php',60],['mod/forum/classes','subscriber_selector_base.php',53],['lib','blocklib.php',54],['lib','blocklib.php',152],['report/loglive/classes','table_log.php',50],['lib','navigationlib.php',147],['lib','navigationlib.php',1015],['lib','navigationlib.php',2825],['lib','navigationlib.php',3086],['lib','navigationlib.php',3412],['lib','navigationlib.php',3459],['lib','navigationlib.php',4888],['lib','navigationlib.php',5070],['lib/phpexcel/PHPExcel/Shared/JAMA','CholeskyDecomposition.php',41],['grade/report/history/classes/output','user_button.php',40],['user/filters','courserole.php',34],['lib/phpexcel/PHPExcel','IOFactory.php',69],['lib/lessphp/Tree','Color.php',15],['lib/phpexcel/PHPExcel/Worksheet','MemoryDrawing.php',70],['lib/adodb/drivers','adodb-vfp.inc.php',72],['lib/horde/framework/Horde/Support','Backtrace.php',20],['lib/google/src/Google/Service','Clouddebugger.php',50],['lib/horde/framework/Horde/Exception','NotFound.php',15],['admin/tool/lp/classes/output','user_competency_course_navigation.php',55],['lib/lessphp/Tree','UnicodeDescriptor.php',14],['lib/phpexcel/PHPExcel/Worksheet','PageSetup.php',277],['grade/report/singleview/classes/local/ui','bulk_insert.php',40],['lib','mathslib.php',45],['lib/filestorage','tgz_extractor.php',119],['lib/horde/framework/Horde/Imap/Client/Interaction/Command','Continuation.php',42],['lib/horde/framework/Horde/Imap/Client','Exception.php',247],['filter/emoticon/tests','filter_test.php',68],['mnet/xmlrpc','xmlparser.php',15],['lib/spout/src/Spout/Reader/XLSX','Sheet.php',31],['admin/roles/classes','capability_table_base.php',51],['lib/simplepie/library/SimplePie','Item.php',82],['lib/form','selectgroups.php',57],['auth/shibboleth','auth.php',38],['admin/tool/langimport/classes','controller.php',48],['lib/form','warning.php',49],['lib/filestorage','stored_file.php',63],['grade/grading/form/guide','guideeditor.php',49],['lib/pear/HTML/QuickForm','group.php',80],['backup/moodle2','restore_subplugin.class.php',45],['grade/export','lib.php',60],['grade/export','lib.php',625],['lib/phpexcel/PHPExcel/Style','NumberFormat.php',98],['backup/moodle2','backup_section_task.class.php',40],['lib/htmlpurifier/HTMLPurifier','Config.php',100],['lib','flickrlib.php',53],['mod/assign/classes/output','grading_app.php',59],['grade/report/singleview/classes/local/ui','grade_attribute_format.php',47],['user/profile/field/menu','field.class.php',39],['lib/spout/src/Spout/Writer/Common/Internal','AbstractWorkbook.php',30],['lib/portfolio','exporter.php',113],['lib','ddllib.php',80],['lib','ddllib.php',93],['lib','ddllib.php',107],['lib','ddllib.php',126],['lib','ddllib.php',140],['lib/horde/framework/Horde/Crypt','Blowfish.php',54],['lib/horde/framework/Horde','Secret.php',48],['lib/htmlpurifier/HTMLPurifier/AttrDef','Integer.php',36],['lib/classes/update','info.php',48],['lib/htmlpurifier/HTMLPurifier/ConfigSchema','ValidatorAtom.php',31],['lib/lessphp/Tree','Anonymous.php',21],['admin/tool/lp/classes','course_competencies_form_element.php',43],['lib/lessphp/Tree','Comment.php',17],['auth/cas/CAS/CAS','OutOfSequenceBeforeAuthenticationCallException.php',47],['question/type/calculatedsimple','edit_calculatedsimple_form.php',72],['lib/adodb/drivers','adodb-mysql.inc.php',54],['lib/adodb/drivers','adodb-mysql.inc.php',717],['lib/adodb/drivers','adodb-mysql.inc.php',880],['enrol/ldap','lib.php',43],['mod/quiz/report/statistics','statistics_table.php',45],['lib/form','listing.php',68],['lib/google/src/Google/Service','Container.php',43],['mod/quiz','accessmanager.php',45],['lib/classes/message/inbound','processing_failed_exception.php',36],['blocks/online_users/classes','fetcher.php',45],['lib/pear/HTML/QuickForm','checkbox.php',48],['auth/cas/CAS/CAS','OutOfSequenceBeforeProxyException.php',48],['mod/lti/service/toolproxy/classes/local/service','toolproxy.php',41],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','URI.php',15],['lib/classes','chart_axis.php',65],['mod/glossary/classes','entry_query_builder.php',83],['mod/feedback/item/label','lib.php',26],['lib/adodb/drivers','adodb-mssqlnative.inc.php',131],['lib/adodb/drivers','adodb-mssqlnative.inc.php',847],['lib/adodb/drivers','adodb-mssqlnative.inc.php',1099],['lib/horde/framework/Horde/Imap/Client','Ids.php',78],['lib/form','editor.php',62],['lib','environmentlib.php',1258],['mod/workshop','fileinfolib.php',43],['mod/workshop','fileinfolib.php',198],['mod/feedback/classes','templates_table.php',39],['tag/classes','manage_table.php',44],['lib/adodb/drivers','adodb-odbc_db2.inc.php',115],['lib/adodb/drivers','adodb-odbc_db2.inc.php',309],['backup/cc/cc_lib/gral_lib','cssparser.php',21],['lib/horde/framework/Horde/Support','Array.php',21],['lib/google/src/Google/Service','GroupsMigration.php',40],['admin/tool/lp/classes/output','user_evidence_list_page.php',61],['lib/google/src/Google/Service','Audit.php',39],['lib/simplepie/library/SimplePie','File.php',68],['lib/horde/framework/Horde/Imap/Client','Mailbox.php',62],['enrol/lti/classes','manage_table.php',62],['lib/simplepie/library/SimplePie/Content/Type','Sniffer.php',69],['question/type','questionbase.php',124],['question/type','questionbase.php',438],['question/type','questionbase.php',531],['question/type','questionbase.php',750],['question/type','questionbase.php',835],['question/type','questionbase.php',868],['question/type','questionbase.php',914],['question/type','questionbase.php',1013],['question/type/ddimageortext','question.php',64],['question/type/ddimageortext','question.php',122],['lib','excellib.class.php',47],['lib','excellib.class.php',155],['lib','excellib.class.php',456],['lib/minify/lib','CSSmin.php',43],['lib/dml','moodle_temptables.php',51],['lib/minify/lib/Minify/Cache','ZendPlatform.php',23],['backup/util/xml/parser','progressive_parser.class.php',79],['backup/util/xml/parser','progressive_parser.class.php',305],['blocks/rss_client/classes/output','block.php',47],['question/type/ddmarker','question.php',417],['question/type/ddmarker','question.php',469],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Percentage.php',18],['admin/tool/lp/classes/output','user_competency_summary_in_course.php',51],['backup/util/helper','convert_helper.class.php',378],['lib/classes/update','validator.php',265],['lib/lessphp/Tree','Attribute.php',16],['admin/tool/generator/classes','backend.php',84],['backup/util/loggers','file_logger.class.php',35],['lib/adodb','adodb-exceptions.inc.php',30],['lib/google/src/Google','Client.php',70],['user/filters','profilefield.php',36],['backup/util/helper','restore_inforef_parser_processor.class.php',37],['cache/tests/fixtures','lib.php',326],['mod/lti/service/profile/classes/local/resource','profile.php',43],['competency/classes','invalid_persistent_exception.php',38],['backup/util/plan','backup_plan.class.php',36],['backup/util/plan','backup_plan.class.php',130],['lib/phpexcel/PHPExcel/Writer/Excel2007','WriterPart.php',63],['backup/util/settings','setting_dependency.class.php',68],['backup/util/settings','setting_dependency.class.php',175],['backup/util/settings','setting_dependency.class.php',328],['backup/util/settings','setting_dependency.class.php',439],['backup/util/settings','setting_dependency.class.php',465],['backup/util/settings','setting_dependency.class.php',491],['backup/util/settings','setting_dependency.class.php',556],['backup/util/xml','xml_writer.class.php',57],['backup/util/xml','xml_writer.class.php',284],['enrol/imsenterprise','locallib.php',38],['enrol/imsenterprise','locallib.php',115],['lib/dml','moodle_database.php',139],['search/classes','base.php',69],['admin/tool/lp/classes/output','competency_summary.php',54],['lib','upgradelib.php',45],['lib','upgradelib.php',61],['lib','upgradelib.php',76],['lib','upgradelib.php',94],['lib','upgradelib.php',111],['lib/htmlpurifier/HTMLPurifier/AttrTransform','NameSync.php',11],['mod/workshop/form/rubric','lib.php',105],['grade','lib.php',103],['grade','lib.php',927],['grade','lib.php',1089],['grade','lib.php',2053],['grade','lib.php',2213],['lib/horde/framework/Horde/Imap/Client/Data','Acl.php',32],['lib/phpexcel/PHPExcel/Reader/Excel5','RC4.php',35],['lib/google/src/Google/Service','Datastore.php',46],['admin/tool/lpmigrate/classes','framework_processor.php',98],['lib/dtl','database_importer.php',61],['lib/horde/framework/Horde/Imap/Client/Password','Xoauth2.php',44],['badges/lib','awardlib.php',55],['backup/util/helper','backup_array_iterator.class.php',39],['admin/tool/monitor/classes','subscription.php',43],['question/type/calculated','edit_calculated_form.php',51],['lib/spout/src/Spout/Reader/XLSX/Helper/SharedStringsCaching','FileBasedStrategy.php',57],['lib/form','datetimeselector.php',72],['lib/horde/framework/Horde/Imap/Client','Base.php',153],['lib/classes','collator.php',58],['admin/tool/lp/classes','course_competency_statistics.php',48],['lib/google/src/Google/Service','Storage.php',57],['lib/spout/src/Spout/Reader/CSV','SheetIterator.php',28],['lib/lessphp/Tree','Paren.php',14],['mod/lti/classes','service_exception_handler.php',63],['lib/tcpdf/include/barcodes','pdf417.php',523],['mod/assign/feedback/offline','importgradeslib.php',66],['lib/filestorage','file_exceptions.php',36],['lib/filestorage','file_exceptions.php',57],['lib/filestorage','file_exceptions.php',89],['lib/filestorage','file_exceptions.php',108],['lib/filestorage','file_exceptions.php',129],['lib/horde/framework/Horde/Mail/Transport','Smtp.php',100],['lib/htmlpurifier/HTMLPurifier/ConfigSchema/Interchange','Id.php',17],['question/engine/upgrade','upgradelib.php',283],['question/engine/upgrade','upgradelib.php',384],['question/type/numerical','question.php',323],['lib/pear/PEAR','Exception.php',107],['course/format','renderer.php',44],['lib/dml','oci_native_moodle_recordset.php',34],['question/behaviour','behaviourtypebase.php',133],['lib/pear/HTML','QuickForm.php',246],['lib/pear/HTML','QuickForm.php',1979],['backup/util/structure','base_atom.class.php',41],['backup/util/structure','base_atom.class.php',114],['backup/util/structure','base_atom.class.php',135],['backup/util/structure','base_atom.class.php',156],['lib/horde/framework/Horde/Imap/Client/Data','BaseSubject.php',39],['lib/google/src/Google/Auth','LoginTicket.php',37],['lib/adodb/drivers','adodb-csv.inc.php',41],['lib/adodb/drivers','adodb-csv.inc.php',196],['user/filters','yesno.php',33],['mod/wiki/parser','parser.php',98],['lib/htmlpurifier/HTMLPurifier/Token','Comment.php',19],['lib/phpexcel/PHPExcel/Calculation','FormulaParser.php',87],['backup/cc/cc_lib','cc_assesment_truefalse.php',27],['lib/htmlpurifier/HTMLPurifier','Encoder.php',10],['admin/tool/lpmigrate/classes/form','migrate_framework.php',45],['backup/util/xml/parser/tests','parser_test.php',797],['lib/htmlpurifier/HTMLPurifier/AttrTransform','EnumToCSS.php',34],['lib/tests','medialib_test.php',644],['lib/google/src/Google/Service','QPXExpress.php',39],['tag/classes/output','tagname.php',41],['lib/mustache/src/Mustache','Context.php',20],['lib/adodb/drivers','adodb-oracle.inc.php',32],['lib/adodb/drivers','adodb-oracle.inc.php',224],['backup/moodle2','restore_section_task.class.php',42],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Composite.php',25],['lib/htmlpurifier/HTMLPurifier/AttrTransform','Nofollow.php',16],['mod/forum/classes/output','forum_post.php',110],['admin/tool/assignmentupgrade','locallib.php',50],['admin/tool/assignmentupgrade','locallib.php',93],['repository/googledocs','lib.php',65],['cache/stores/memcache','lib.php',120],['lib/filestorage','file_storage.php',78],['admin/tool/monitor/classes/output/managerules','renderable.php',56],['mod/lti/service/toolsettings/classes/local/resource','linksettings.php',45],['lib/form','duration.php',55],['lib','outputlib.php',480],['lib','outputlib.php',2038],['filter/tex','latex.php',13],['backup/moodle2','backup_course_task.class.php',39],['lib/adodb','adodb.inc.php',310],['lib/adodb','adodb.inc.php',3035],['lib/adodb','adodb.inc.php',3160],['lib/adodb','adodb.inc.php',3242],['lib/adodb','adodb.inc.php',4353],['lib/horde/framework/Horde/Support','Randomid.php',26],['lib/google/src/Google/Logger','File.php',51],['admin/roles/classes','allow_role_page.php',37],['mod/quiz/report/overview','overview_table.php',41],['lib/lessphp/Tree','Keyword.php',17],['lib/htmlpurifier/HTMLPurifier/Node','Comment.php',19],['question/type/ddmarker','questiontype.php',48],['mod/folder','renderer.php',159],['lib','portfoliolib.php',101],['tag/classes/output','tagcollsearchable.php',40],['webservice/soap/classes','wsdl.php',88],['lib/lessphp/Exception','Parser.php',30],['badges','renderer.php',973],['badges','renderer.php',1014],['badges','renderer.php',1078],['badges','renderer.php',1111],['badges','renderer.php',1137],['competency/classes/external','exporter.php',56],['mod/lti/service/toolproxy/classes/local/resource','toolproxy.php',47],['lib/google/src/Google/Service','Genomics.php',63],['lib/phpexcel/PHPExcel/Writer','PDF.php',38],['lib/phpexcel/PHPExcel/Shared/trend','exponentialBestFitClass.php',125],['lib/google/src/Google/Service','Games.php',60],['backup/converter/moodle1','lib.php',725],['backup/converter/moodle1','lib.php',865],['backup/converter/moodle1','lib.php',1145],['backup/converter/moodle1','lib.php',1190],['backup/converter/moodle1','lib.php',1480],['backup/util/helper','restore_logs_processor.class.php',45],['backup/util/helper','restore_logs_processor.class.php',141],['lib/htmlpurifier/HTMLPurifier/AttrTransform','Input.php',14],['lib/google/src/Google/Service','Licensing.php',40],['mod/workshop/form/comments','lib.php',99],['backup/util/settings/section','section_backup_setting.class.php',25],['lib/htmlpurifier/HTMLPurifier','Doctype.php',48],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Font.php',22],['lib/google/src/Google/Service','Fitness.php',58],['blocks/private_files','renderer.php',83],['lib/phpexcel/PHPExcel/Worksheet','ColumnCellIterator.php',51],['enrol/flatfile','adminlib.php',35],['lib/xmldb','xmldb_object.php',55],['lib/google/src/Google/Service','Reports.php',47],['question/classes/statistics/responses','analysis_for_actual_response.php',70],['auth/pam','auth.php',53],['lib/horde/framework/Horde','Stream.php',50],['comment','lib.php',100],['lib/htmlpurifier/HTMLPurifier','URIParser.php',10],['lib/htmlpurifier/HTMLPurifier/Node','Text.php',35],['lib/phpexcel/PHPExcel/Worksheet','RowDimension.php',53],['lib/google/src/Google/Service','Gmail.php',64],['lib/google/src/Google/Service','Taskqueue.php',44],['lib/minify/lib/Minify','ImportProcessor.php',48],['lib/horde/framework/Horde/Mime','Related.php',32],['blocks','moodleblock.class.php',111],['lib/tcpdf','tcpdf_parser.php',92],['backup/util/plan','restore_structure_step.class.php',46],['blocks/rss_client/classes/output','channel_image.php',61],['lib/pear/HTML/QuickForm','hierselect.php',105],['question/type/numerical/tests','form_test.php',40],['badges/lib','backpacklib.php',40],['mod/workshop/allocation/manual','lib.php',51],['mod/quiz/report/responses','last_responses_table.php',39],['lib/simplepie','autoloader.php',62],['lib/spout/src/Spout/Common/Helper','StringHelper.php',21],['lib/phpexcel/PHPExcel/Worksheet','BaseDrawing.php',121],['lib/pear/Crypt','CHAP.php',82],['lib/pear/Crypt','CHAP.php',170],['lib/pear/Crypt','CHAP.php',424],['lib/spout/src/Spout/Writer/Common/Helper','AbstractStyleHelper.php',22],['backup/util/xml/parser/processors','progressive_parser_processor.class.php',57],['mod/quiz/classes/question','qubaids_for_users_attempts.php',37],['lib/spout/src/Spout/Reader/XLSX','RowIterator.php',63],['lib/phpexcel/PHPExcel/Reader/Excel5','Escher.php',77],['lib/simplepie/library/SimplePie','gzdecode.php',186],['mod/wiki','renderer.php',540],['lib/adodb','adodb-active-recordx.inc.php',138],['availability/classes','result.php',46],['lib','accesslib.php',5352],['lib','accesslib.php',5897],['lib','accesslib.php',6167],['lib','accesslib.php',6408],['lib','accesslib.php',6595],['lib','accesslib.php',6827],['lib','accesslib.php',7049],['lib','accesslib.php',7291],['lib/phpexcel/PHPExcel/Shared/OLE','PPS.php',110],['grade/grading/form','lib.php',82],['grade/grading/form','lib.php',766],['question/engine','questionusage.php',78],['question/engine','questionusage.php',973],['auth/manual','auth.php',46],['question/engine/upgrade','behaviourconverters.php',78],['mod/wiki/diff','diff_nwiki.php',35],['mod/wiki/diff','diff_nwiki.php',50],['mod/wiki/diff','diff_nwiki.php',63],['mod/wiki/diff','diff_nwiki.php',76],['mod/wiki/diff','diff_nwiki.php',495],['mod/wiki/diff','diff_nwiki.php',640],['mod/wiki/diff','diff_nwiki.php',850],['mod/wiki/diff','diff_nwiki.php',901],['mod/wiki/diff','diff_nwiki.php',953],['lib/adodb/drivers','adodb-proxy.inc.php',28],['lib/classes/lock','file_lock_factory.php',57],['lib/google/src/Google/Auth','OAuth2.php',55],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','Pixels.php',17],['lib/filebrowser','file_info_context_module.php',47],['auth/none','auth.php',34],['lib/simplepie/library/SimplePie/Cache','Base.php',70],['lib/htmlpurifier/HTMLPurifier','Queue.php',24],['lib/horde/framework/Horde/Text','Flowed.php',75],['admin/tool/log/store/legacy/classes/log','store.php',33],['lib/mustache/src/Mustache','HelperCollection.php',19],['backup/util/structure','backup_structure_processor.class.php',45],['backup/util/structure','backup_structure_processor.class.php',133],['admin/tool/lp/classes/output','related_competencies.php',47],['mod/quiz/classes/question/bank','custom_view.php',44],['files','renderer.php',1083],['lib/form','text.php',47],['lib/phpexcel/PHPExcel/Shared/trend','bestFitClass.php',398],['backup/cc','cc112moodle.php',59],['admin/tool/cohortroles/classes/output','cohort_role_assignments_table.php',45],['lib/horde/framework/Horde/Imap/Client/Data','Envelope.php',46],['lib/google/src/Google/Service','Logging.php',39],['lib/lessphp/Tree','Expression.php',16],['mod/lti/classes/local/ltiservice','service_base.php',63],['lib/phpexcel/PHPExcel/Reader','HTML.php',118],['search/engine/solr/classes','schema.php',60],['backup/util/xml/parser/processors','simplified_parser_processor.class.php',46],['lib/htmlpurifier/HTMLPurifier','UnitConverter.php',50],['lib/adodb/drivers','adodb-ado5.inc.php',42],['lib/adodb/drivers','adodb-ado5.inc.php',380],['mod/assign/feedback/editpdf/classes','comment.php',58],['cache/classes','interfaces.php',473],['lib/phpexcel/PHPExcel/Worksheet','Protection.php',157],['repository/merlot','lib.php',37],['lib/adodb/drivers','adodb-firebird.inc.php',69],['backup/util/settings','backup_setting.class.php',43],['lib/adodb/drivers','adodb-fbsql.inc.php',28],['lib/adodb/drivers','adodb-fbsql.inc.php',167],['mnet/xmlrpc','serverlib.php',674],['webservice/soap','lib.php',45],['admin/tool/log/store/database/classes/log','store.php',47],['lib/google/src/Google/Service','Doubleclicksearch.php',43],['lib/form','passwordunmask.php',46],['lib/lessphp/Tree','Variable.php',20],['report/log/classes','renderable.php',96],['mod/lti/service/toolsettings/classes/local/resource','systemsettings.php',43],['question/classes/bank','view.php',70],['grade/report/singleview/classes/local/ui','range.php',38],['lib/simplepie/library/SimplePie/Cache','MySQL.php',80],['admin/roles/classes','define_role_table_basic.php',31],['backup/cc/cc_lib','cc_converter_resource.php',28],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Mongo.php',78],['blocks/rss_client','editfeed.php',36],['admin/tool/lpmigrate/classes/output','migrate_framework_results.php',55],['blocks/lp/classes/output','competencies_to_review_page.php',49],['lib/horde/framework/Horde/Crypt/Blowfish/Php','Base.php',318],['backup/util/loggers','base_logger.class.php',42],['backup/util/loggers','base_logger.class.php',187],['mod/assign/feedback/file','renderable.php',44],['backup/cc/cc_lib','cc_utils.php',313],['backup/cc/cc_lib','cc_utils.php',381],['backup/cc/cc_lib','cc_utils.php',437],['lib/adodb/drivers','adodb-db2.inc.php',66],['lib/adodb/drivers','adodb-db2.inc.php',731],['lib/adodb','adodb-xmlschema03.inc.php',136],['lib/adodb','adodb-xmlschema03.inc.php',270],['lib/adodb','adodb-xmlschema03.inc.php',678],['lib/adodb','adodb-xmlschema03.inc.php',823],['lib/adodb','adodb-xmlschema03.inc.php',1081],['lib/adodb','adodb-xmlschema03.inc.php',1399],['repository/youtube','lib.php',58],['lib/phpexcel/PHPExcel/Writer/PDF','mPDF.php',38],['auth/cas/CAS/CAS','GracefullTerminationException.php',48],['lib/adodb/drivers','adodb-sybase_ase.inc.php',25],['lib/adodb/drivers','adodb-sybase_ase.inc.php',115],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Background.php',20],['lib/adodb','adodb-memcache.lib.inc.php',53],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','FrameTarget.php',19],['lib/phpexcel/PHPExcel/Writer','Excel2007.php',118],['lib/minify/lib/MrClay/Cli','Arg.php',82],['lib/phpexcel/PHPExcel/Worksheet/AutoFilter','Column.php',117],['lib/simplepie','moodle_simplepie.php',50],['lib/simplepie','moodle_simplepie.php',121],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','FontFamily.php',11],['lib/simplepie/library/SimplePie/Decode/HTML','Entities.php',80],['lib/spout/src/Spout/Common/Helper','FileSystemHelper.php',22],['lib/pear/HTML/QuickForm','button.php',37],['lib/google/src/Google/Service','Autoscaler.php',46],['lib/mustache/src/Mustache','Engine.php',63],['lib/google/src/Google/Http','MediaFileUpload.php',75],['lib/phpexcel/PHPExcel','Worksheet.php',327],['mod/assign','gradingtable.php',68],['lib/google/src/Google/Service','AdExchangeSeller.php',53],['question/engine/tests','helpers.php',582],['question/engine/tests','helpers.php',594],['question/engine/tests','helpers.php',608],['question/engine/tests','helpers.php',623],['question/engine/tests','helpers.php',637],['question/engine/tests','helpers.php',652],['question/engine/tests','helpers.php',665],['question/engine/tests','helpers.php',676],['question/engine/tests','helpers.php',1196],['repository/webdav','lib.php',38],['tag/classes/output','tagisstandard.php',39],['lib/google/src/Google/Service','Appsactivity.php',52],['badges/criteria','award_criteria_course.php',47],['lib','searchlib.php',53],['lib','searchlib.php',95],['lib/lessphp/Output','Mapped.php',39],['availability/classes','tree.php',118],['lib/lessphp/Tree','Javascript.php',20],['lib/horde/framework/Horde/Imap/Client','Cache.php',53],['lib/htmlpurifier/HTMLPurifier','AttrCollections.php',16],['lib/mustache/src/Mustache/Loader','InlineLoader.php',56],['repository/url','lib.php',46],['lib/phpexcel/PHPExcel/CachedObjectStorage','SQLite3.php',293],['lib/lessphp/Tree','Ruleset.php',45],['tag/classes/output','tagindex.php',52],['backup/util/ui','backup_ui_stage.class.php',43],['backup/util/ui','backup_ui_stage.class.php',79],['backup/util/ui','backup_ui_stage.class.php',234],['backup/util/ui','backup_ui_stage.class.php',387],['backup/util/ui','backup_ui_stage.class.php',516],['backup/util/ui','backup_ui_stage.class.php',575],['grade/report/singleview/classes/local/screen','screen.php',67],['lib/tcpdf/include/barcodes','datamatrix.php',229],['lib/horde/framework/Horde/Imap/Client/Socket','Catenate.php',37],['lib/google/src/Google/Service','Prediction.php',51],['lib/classes/output','notification.php',101],['lib/lessphp/Tree','Unit.php',16],['backup/util/settings/course','course_backup_setting.class.php',25],['lib/spout/src/Spout/Writer','AbstractWriter.php',68],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','DenyElementDecorator.php',21],['lib','outputfactories.php',120],['lib','outputfactories.php',367],['lib','dtllib.php',66],['mod/assign','assignmentplugin.php',50],['mnet/service/enrol','locallib.php',48],['mnet/service/enrol','locallib.php',466],['mnet/service/enrol','locallib.php',537],['backup/cc/cc_lib','cc_version11.php',57],['availability/condition/completion/classes','condition.php',48],['admin/roles/classes','allow_override_page.php',31],['mod/workshop/allocation','lib.php',103],['lib/htmlpurifier/HTMLPurifier/AttrTransform','BoolToCSS.php',24],['lib/horde/framework/Horde/Imap/Client/Base','Mailbox.php',59],['lib/spout/src/Spout/Reader/Wrapper','SimpleXMLElement.php',23],['lib/google/src/Google/Service','SiteVerification.php',43],['lib/phpexcel/PHPExcel/Calculation','Function.php',64],['availability/classes','capability_checker.php',49],['lib/google/src/Google/Service','Drive.php',76],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Decorator.php',12],['lib/phpexcel/PHPExcel/Shared/JAMA','LUDecomposition.php',56],['lib','setuplib.php',67],['lib','setuplib.php',113],['lib','setuplib.php',165],['lib','setuplib.php',184],['lib','setuplib.php',199],['lib','setuplib.php',219],['lib','setuplib.php',249],['lib','setuplib.php',271],['lib','setuplib.php',287],['lib','setuplib.php',309],['lib','setuplib.php',328],['lib','setuplib.php',346],['lib/form','textarea.php',50],['webservice/soap','locallib.php',57],['availability/classes','info.php',55],['lib/tcpdf','tcpdf_barcodes_1d.php',58],['lib/spout/src/Spout/Reader/XLSX/Helper','SheetHelper.php',49],['filter/urltolink/tests','filter_test.php',209],['lib/simplepie/library/SimplePie','Category.php',81],['admin/tool/lp/classes/output','manage_competencies_page.php',65],['lib/markdown','Markdown.php',99],['mod/assign','locallib.php',160],['mod/assign','locallib.php',8131],['lib/adodb/drivers','adodb-ldap.inc.php',48],['lib/adodb/drivers','adodb-ldap.inc.php',297],['lib/editor/tinymce/plugins/spellchecker/classes/utils','JSON.php',32],['lib/editor/tinymce/plugins/spellchecker/classes/utils','JSON.php',373],['lib','odslib.class.php',42],['lib','odslib.class.php',124],['lib','odslib.class.php',422],['lib','odslib.class.php',827],['lib/horde/framework/Horde/Crypt/Blowfish','Base.php',56],['lib/phpexcel/PHPExcel/Reader/Excel5','MD5.php',36],['grade/report/singleview/classes/local/ui','checkbox_attribute.php',42],['lib/lessphp/Tree','Quoted.php',20],['mod/lesson','mod_form.php',36],['blocks/rss_client/classes/output','item.php',89],['lib/google/src/Google/Service','IdentityToolkit.php',38],['lib/horde/framework/Horde/Stream','Temp.php',25],['tag/classes/output','tagflag.php',39],['admin/tool/monitor/classes/output/managesubs','rules.php',56],['lib/htmlpurifier/HTMLPurifier/ChildDef','Table.php',57],['lib/behat/form_field','behat_form_field.php',59],['lib/phpexcel/PHPExcel/Worksheet/Drawing','Shadow.php',93],['lib/spout/src/Spout/Reader/ODS/Helper','CellValueFormatter.php',42],['tag/classes','collections_table.php',36],['lib/google/src/Google/Service','Spectrum.php',38],['lib/htmlpurifier/HTMLPurifier/AttrTransform','Length.php',19],['admin/tool/lp/classes/output','user_competency_summary.php',49],['lib/phpexcel/PHPExcel','NamedRange.php',65],['lib/pear/HTML/QuickForm','image.php',36],['lib/htmlpurifier/HTMLPurifier/AttrDef/URI','Host.php',15],['lib/form','searchableselector.php',44],['lib/phpexcel/PHPExcel/Shared/JAMA','SingularValueDecomposition.php',52],['lib/adodb/drivers','adodb-oci805.inc.php',51],['lib/google/src/Google','Service.php',28],['lib/google/src/Google/IO','Abstract.php',50],['lib/spout/src/Spout/Writer/ODS/Internal','Worksheet.php',46],['lib/form','header.php',45],['question/type/randomsamatch/tests','helper.php',121],['mod/workshop/form/accumulative','lib.php',99],['lib/phpexcel/PHPExcel/Shared/trend','linearBestFitClass.php',89],['lib/form','submit.php',41],['report/log/classes','table_log.php',45],['admin/roles/classes','admins_potential_selector.php',30],['question/classes/engine/variants','least_used_strategy.php',51],['question/engine/upgrade','logger.php',42],['question/engine/upgrade','logger.php',87],['mod/data','lib.php',68],['mod/data','lib.php',2278],['mod/data','lib.php',2552],['mod/data','lib.php',2573],['backup/util/xml/parser/processors','grouped_parser_processor.class.php',67],['lib/horde/framework/Horde/Imap/Client/Exception','NoSupportPop3.php',26],['mod/scorm','renderer.php',129],['lib/phpunit/classes','advanced_testcase.php',45],['lib/spout/src/Spout/Reader/ODS','SheetIterator.php',41],['backup/cc/cc_lib','cc_version1.php',57],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','LinkTypes.php',21],['tag/classes','areas_table.php',36],['lib/phpexcel/PHPExcel/Shared/trend','powerBestFitClass.php',125],['lib/portfolio/formats/leap2a','lib.php',62],['lib/portfolio/formats/leap2a','lib.php',258],['lib/portfolio/formats/leap2a','lib.php',503],['lib/google/src/Google/Service','Proximitybeacon.php',42],['lib/pear','PEAR.php',139],['lib/pear','PEAR.php',818],['competency/classes/external','persistent_exporter.php',42],['lib/google/src/Google/Service','Groupssettings.php',40],['lib/phpexcel/PHPExcel/Reader','CSV.php',87],['lib/horde/framework/Horde/Exception','LastError.php',16],['lib/google/src/Google/Service','Directory.php',134],['lib/google/src/Google/Service','Fusiontables.php',48],['question/type/missingtype','edit_missingtype_form.php',38],['lib/google/src/Google/Service','AdSenseHost.php',49],['lib/lessphp/Tree','Directive.php',20],['auth/ldap','auth.php',119],['auth/cas/CAS/CAS','CookieJar.php',46],['lib/phpexcel/PHPExcel/CachedObjectStorage','Wincache.php',245],['availability/condition/date/classes','condition.php',52],['lib/horde/framework/Horde/Mime','Mail.php',93],['lib','outputactions.php',60],['lib','outputactions.php',91],['lib','outputactions.php',148],['lib/horde/framework/Horde/Crypt/Blowfish','Mcrypt.php',47],['lib/classes','string_manager_standard.php',53],['repository/skydrive','microsoftliveapi.php',50],['user/filters','globalrole.php',35],['enrol/lti/ims-blti','OAuth.php',16],['enrol/lti/ims-blti','OAuth.php',32],['enrol/lti/ims-blti','OAuth.php',187],['enrol/lti/ims-blti','OAuth.php',451],['course/classes/output','course_module_name.php',46],['lib/google/src/Google/Service','Plus.php',52],['lib/horde/framework/Horde/Mime','Mdn.php',35],['lib/pear/HTML/QuickForm','html.php',36],['repository/s3','S3.php',193],['repository/s3','S3.php',2018],['repository/s3','S3.php',2374],['lib/spout/src/Spout/Reader/XLSX/Helper','SharedStringsHelper.php',39],['question/classes/bank/search','hidden_condition.php',42],['lib/htmlpurifier/HTMLPurifier/ChildDef','Empty.php',22],['lib/pear/HTML/QuickForm','element.php',73],['question/classes/statistics/responses','analysis_for_subpart.php',50],['admin/tool/log/classes','setting_managestores.php',30],['lib/google/src/Google/Service','Mirror.php',49],['lib/adodb/drivers','adodb-db2ora.inc.php',80],['lib/minify/lib/HTTP','Encoder.php',75],['mod/feedback/classes','completion.php',47],['admin/tool/uploadcourse/classes','processor.php',122],['lib/lessphp','Parser.php',78],['lib/adodb/drivers','adodb-sapdb.inc.php',36],['lib/adodb/drivers','adodb-sapdb.inc.php',179],['lib/ddl','sql_generator.php',175],['lib/google/src/Google/Service','AndroidEnterprise.php',51],['admin/tool/lp/classes/output','template_competencies_page.php',70],['lib/horde/framework/Horde/Support','ObjectStub.php',29],['mod/assignment/backup/moodle1','lib.php',223],['blocks','edit_form.php',47],['lib/simplepie/library/SimplePie/Cache','Memcache.php',81],['mod/quiz/report/statistics','statistics_question_table.php',49],['mod/workshop/form/numerrors','lib.php',102],['mod/quiz/classes','repaginate.php',49],['lib/classes/session','memcached.php',51],['lib/phpexcel/PHPExcel/Shared/OLE/PPS','Root.php',43],['lib/phpexcel/PHPExcel/Writer/PDF','Core.php',206],['mod/workshop','mod_form.php',43],['mod/assign/feedback/editpdf/fpdi','pdf_context.php',48],['availability/condition/profile/classes','condition.php',73],['lib/horde/framework/Horde/Imap/Client','DateTime.php',29],['auth/cas/CAS/CAS','Client.php',862],['lib/xhprof','xhprof_moodle.php',788],['lib/dtl','file_xml_database_exporter.php',36],['course','lib.php',3061],['lib/adodb/drivers','adodb-mssqlpo.inc.php',54],['lib/xmldb','xmldb_table.php',49],['lib/adodb/perf','perf-postgres.inc.php',92],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Filter.php',15],['question/type/ddmarker','shapes.php',40],['question/type/ddmarker','shapes.php',203],['question/type/ddmarker','shapes.php',267],['question/type/ddmarker','shapes.php',332],['question/type/ddmarker','shapes.php',470],['mod/lti/classes/local/ltiservice','response.php',58],['backup/util/helper','restore_users_parser_processor.class.php',43],['lib/pear/HTML','Common.php',79],['mod/glossary','locallib.php',481],['lib/adodb/perf','perf-mssqlnative.inc.php',70],['lib/adodb/perf','perf-mssql.inc.php',70],['backup/util/plan','base_plan.class.php',39],['backup/util/plan','base_plan.class.php',215],['backup/util/plan','restore_task.class.php',32],['backup/util/plan','restore_task.class.php',121],['lib/classes/event','base.php',124],['lib/form','checkbox.php',46],['admin/roles/classes','permissions_table.php',38],['lib/pear/HTML/QuickForm','submit.php',37],['auth/fc','auth.php',37],['enrol/ldap','settingslib.php',32],['enrol/ldap','settingslib.php',90],['enrol/ldap','settingslib.php',204],['lib/minify/lib/Minify/Cache','Memcache.php',22],['lib/lessphp/Tree','Condition.php',18],['admin/tool/lp/classes/output','plans_page.php',59],['lib/mustache/src/Mustache','Autoloader.php',19],['lib/spout/src/Spout/Writer/XLSX/Internal','Worksheet.php',52],['lib/phpexcel/PHPExcel','Comment.php',93],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','AlphaValue.php',6],['lib/lessphp/Tree','Url.php',17],['mod/lesson','override_form.php',58],['lib/form','button.php',45],['admin/tool/lp/classes/output','manage_templates_page.php',56],['lib/google/src/Google/Service','Playmoviespartner.php',44],['backup/util/ui','base_ui_stage.class.php',67],['backup/cc/cc_lib','cc_converters.php',75],['lib/dtl','database_mover.php',33],['enrol','locallib.php',125],['enrol','locallib.php',1256],['enrol','locallib.php',1379],['enrol','locallib.php',1430],['enrol','locallib.php',1463],['lib/htmlpurifier/HTMLPurifier','URI.php',58],['backup/moodle2','restore_course_task.class.php',41],['lib/htmlpurifier/HTMLPurifier/Printer','ConfigForm.php',40],['lib/htmlpurifier/HTMLPurifier/Printer','ConfigForm.php',221],['lib','xmlize.php',31],['lib','googleapi.php',52],['lib','googleapi.php',243],['grade/report/singleview/classes/local/ui','element.php',47],['lib/html2text','lib.php',43],['user/filters','lib.php',52],['user/filters','lib.php',272],['auth/cas/CAS/CAS/PGTStorage','Db.php',122],['lib/classes/lock','db_record_lock_factory.php',61],['lib/pear/HTML/QuickForm','link.php',47],['backup/cc/cc_lib','cc_asssesment.php',290],['backup/cc/cc_lib','cc_asssesment.php',345],['backup/cc/cc_lib','cc_asssesment.php',364],['backup/cc/cc_lib','cc_asssesment.php',415],['backup/cc/cc_lib','cc_asssesment.php',476],['backup/cc/cc_lib','cc_asssesment.php',486],['backup/cc/cc_lib','cc_asssesment.php',561],['backup/cc/cc_lib','cc_asssesment.php',585],['backup/cc/cc_lib','cc_asssesment.php',635],['backup/cc/cc_lib','cc_asssesment.php',668],['backup/cc/cc_lib','cc_asssesment.php',693],['backup/cc/cc_lib','cc_asssesment.php',788],['backup/cc/cc_lib','cc_asssesment.php',814],['backup/cc/cc_lib','cc_asssesment.php',838],['backup/cc/cc_lib','cc_asssesment.php',965],['backup/cc/cc_lib','cc_asssesment.php',971],['backup/cc/cc_lib','cc_asssesment.php',986],['backup/cc/cc_lib','cc_asssesment.php',1003],['backup/cc/cc_lib','cc_asssesment.php',1017],['backup/cc/cc_lib','cc_asssesment.php',1045],['backup/cc/cc_lib','cc_asssesment.php',1186],['backup/cc/cc_lib','cc_asssesment.php',1263],['backup/cc/cc_lib','cc_asssesment.php',1317],['backup/cc/cc_lib','cc_asssesment.php',1389],['backup/cc/cc_lib','cc_asssesment.php',1451],['backup/cc/cc_lib','cc_asssesment.php',1558],['backup/cc/cc_lib','cc_asssesment.php',1620],['backup/cc/cc_lib','cc_asssesment.php',1648],['backup/cc/cc_lib','cc_asssesment.php',1716],['backup/cc/cc_lib','cc_asssesment.php',2155],['backup/cc/cc_lib','cc_asssesment.php',2264],['backup/cc/cc_lib','cc_asssesment.php',2469],['lib/phpunit/classes','hint_resultprinter.php',37],['lib/horde/framework/Horde/Mail/Transport','Mail.php',53],['auth/pop3','auth.php',35],['lib/adodb/drivers','adodb-oci8.inc.php',106],['lib/adodb/drivers','adodb-oci8.inc.php',1539],['lib/adodb/drivers','adodb-oci8.inc.php',1805],['lib/classes/session','database.php',52],['backup/util/ui','restore_ui_components.php',81],['backup/util/ui','restore_ui_components.php',287],['backup/util/ui','restore_ui_components.php',382],['question/classes/bank/search','category_condition.php',60],['lib/google/src/Google/Auth','AssertionCredentials.php',53],['backup/util/plan','restore_plan.class.php',43],['backup/util/plan','restore_plan.class.php',203],['backup/util/xml/parser/processors','findpaths_parser_processor.class.php',35],['lib/phpexcel/PHPExcel/CalcEngine','Logger.php',63],['lib/jabber/XMPP','Log.php',67],['lib/horde/framework/Horde/Imap/Client/Exception','ServerResponse.php',44],['lib/lessphp/Tree','Assignment.php',15],['lib/dtl','string_xml_database_importer.php',34],['admin/tool/lp/classes/output','manage_competency_frameworks_page.php',62],['question/type/calculated','question.php',188],['question/type/calculated','question.php',303],['repository/recent','lib.php',39],['grade/report/singleview/classes/local/ui','text_attribute.php',42],['admin/webservice','lib.php',38],['lib','coursecatlib.php',194],['lib','coursecatlib.php',2782],['lib/google/src/Google/Service','Cloudtrace.php',43],['lib','filterlib.php',73],['lib','filterlib.php',377],['lib','filterlib.php',456],['lib/classes/lock','lock_factory.php',39],['lib/filebrowser','file_info_context_course.php',39],['lib/filebrowser','file_info_context_course.php',492],['lib/filebrowser','file_info_context_course.php',596],['lib/filebrowser','file_info_context_course.php',745],['enrol','renderer.php',426],['enrol','renderer.php',723],['question/classes/statistics/questions','calculated_for_subquestion.php',57],['backup/moodle2','backup_format_plugin.class.php',40],['admin/tool/lp/classes','course_competency_rule_form_element.php',45],['auth/cas/CAS/CAS','ProxyTicketException.php',46],['lib/phpunit/classes','basic_testcase.php',39],['lib/spout/src/Spout/Reader/ODS','RowIterator.php',49],['backup/util/dbops','backup_dbops.class.php',37],['admin/tool/customlang','locallib.php',44],['admin/tool/customlang','locallib.php',405],['admin/tool/customlang','locallib.php',471],['backup/util/structure','backup_optigroup_element.class.php',51],['mod/quiz/report/grading','gradingsettings_form.php',44],['backup/util/plan','restore_step.class.php',32],['backup/util/plan','restore_step.class.php',104],['lib/form','hidden.php',44],['repository/filesystem','lib.php',48],['backup/controller','backup_controller.class.php',68],['backup/controller','backup_controller.class.php',409],['backup/util/helper','restore_log_rule.class.php',62],['tag/classes','tag.php',77],['lib/htmlpurifier/HTMLPurifier/AttrTransform','SafeParam.php',27],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Db.php',38],['lib/spout/src/Spout/Writer/Style','StyleBuilder.php',19],['lib/dml','sqlsrv_native_moodle_database.php',53],['user/filters','date.php',40],['auth/nologin','auth.php',35],['lib/google/src/Google','Model.php',35],['lib/horde/framework/Horde/Imap/Client/Socket','ClientSort.php',37],['lib/horde/framework/Horde/Imap/Client/Exception','SearchCharset.php',34],['lib/horde/framework/Horde/Support','StringStream.php',30],['lib/adodb/drivers','adodb-mysqli.inc.php',66],['lib/adodb/drivers','adodb-mysqli.inc.php',887],['lib/adodb/drivers','adodb-mysqli.inc.php',1193],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','ImportantDecorator.php',21],['lib/form','questioncategory.php',46],['lib/mustache/src/Mustache','Template.php',29],['backup/util/structure','base_nested_element.class.php',44],['backup/util/structure','base_nested_element.class.php',258],['lib/google/src/Google/Logger','Abstract.php',123],['backup/cc/cc_lib','cc_general.php',38],['lib/phpexcel/PHPExcel','ReferenceHelper.php',58],['lib/pear/HTML/QuickForm','password.php',37],['lib/dml','moodle_transaction.php',40],['lib/phpexcel/PHPExcel/Reader','Excel2003XML.php',53],['lib/htmlpurifier/HTMLPurifier/AttrDef','Switch.php',29],['repository/flickr','lib.php',51],['lib/form','grading.php',57],['lib/classes/update','api.php',71],['backup/cc/cc_lib','cc_converter_lti.php',29],['backup/moodle2','backup_subplugin.class.php',44],['lib/portfolio','caller.php',67],['lib/classes/progress','display_if_slow.php',60],['lib/adodb/perf','perf-informix.inc.php',66],['lib/classes','chart_base.php',52],['lib/lessphp/Tree','Media.php',18],['lib/spout/src/Spout/Common/Escaper','XLSX.php',19],['grade/export/ods','grade_export_ods.php',24],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Length.php',23],['lib/google/src/Google/Service','Calendar.php',50],['lib/form','group.php',44],['lib/phpexcel/PHPExcel/Writer','OpenDocument.php',44],['lib/pear/HTML/QuickForm/Renderer','Object.php',75],['admin/tool/lp/classes/output','user_evidence_page.php',48],['lib/horde/framework/Horde/Imap/Client/Fetch','Results.php',54],['grade/export/xls','grade_export_xls.php',24],['lib/classes/output','mustache_pix_helper.php',43],['lib/horde/framework/Horde/Imap/Client/Mailbox','List.php',46],['lib/google/src/Google/Auth','ComputeEngine.php',35],['cache/stores/session','lib.php',131],['lib/mustache/src/Mustache/Logger','StreamLogger.php',44],['admin/tool/log/store/database/backup/moodle2','backup_logstore_database_nested_element.php',43],['user','renderer.php',220],['lib/htmlpurifier/HTMLPurifier/ChildDef','Required.php',23],['availability/condition/grade/classes','condition.php',46],['lib/lessphp/Tree','RulesetCall.php',14],['blocks/rss_client/classes/output','feed.php',75],['lib/form','select.php',47],['lib/htmlpurifier/HTMLPurifier','ContentSets.php',33],['lib/lessphp/Visitor','toCSS.php',13],['lib','outputfragmentrequirementslib.php',40],['backup/util/ui','restore_moodleform.class.php',34],['lib/google/src/Google/Service','Cloudbilling.php',43],['lib/google/src/Google/Service','PlusDomains.php',72],['lib','externallib.php',37],['lib','externallib.php',531],['lib','externallib.php',562],['lib','externallib.php',593],['lib','externallib.php',622],['lib','externallib.php',648],['lib','externallib.php',778],['lib','externallib.php',813],['lib','externallib.php',984],['lib','externallib.php',1177],['blog','locallib.php',71],['blog','locallib.php',564],['blog','locallib.php',847],['blog','locallib.php',892],['blog','locallib.php',965],['blog','locallib.php',1016],['blog','locallib.php',1041],['blog','locallib.php',1051],['blog','locallib.php',1063],['blog','locallib.php',1084],['lib/phpexcel/PHPExcel/Worksheet','ColumnDimension.php',53],['auth/cas','auth.php',39],['lib','lexer.php',41],['lib','lexer.php',145],['lib','lexer.php',217],['lib/phpexcel/PHPExcel/Shared/JAMA','QRDecomposition.php',48],['lib/google/src/Google/Service','Exception.php',34],['lib/htmlpurifier/HTMLPurifier','Printer.php',21],['tag/classes/output','tagcloud.php',49],['lib/google/src/Google/Service','Storagetransfer.php',44],['user/filters','select.php',46],['cache/stores/mongodb','lib.php',116],['admin/tool/lp/classes/output','course_competencies_page.php',73],['lib/google/src/Google/Cache','Null.php',28],['lib','graphlib.php',1176],['lib/phpexcel/PHPExcel/Style','Protection.php',49],['lib/google/src/Google/Service','GamesConfiguration.php',42],['repository/dropbox','locallib.php',46],['lib/phpexcel/PHPExcel/Style','Alignment.php',100],['lib/htmlpurifier/HTMLPurifier','Language.php',63],['cache/stores/file','lib.php',117],['tag/classes/output','tagareashowstandard.php',41],['question/type/multianswer','edit_multianswer_form.php',63],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','Bool.php',22],['mod/assign','renderable.php',41],['mod/assign','renderable.php',71],['mod/assign','renderable.php',103],['mod/assign','renderable.php',139],['mod/assign','renderable.php',191],['mod/assign','renderable.php',242],['mod/assign','renderable.php',291],['mod/assign','renderable.php',395],['mod/assign','renderable.php',531],['mod/assign','renderable.php',586],['mod/assign','renderable.php',670],['mod/assign','renderable.php',707],['mod/assign','renderable.php',747],['mod/assign','renderable.php',800],['mod/assign','renderable.php',854],['lib/form','selectwithlink.php',56],['backup/moodle2','backup_activity_task.class.php',45],['lib/phpmailer','class.phpmailer.php',633],['lib/horde/framework/Horde/Imap/Client/Data','AclRights.php',39],['auth/db','auth.php',36],['lib/lessphp/Tree','Value.php',14],['lib/form','course.php',62],['question/engine','questionattemptstep.php',97],['question/engine','questionattemptstep.php',608],['cohort','locallib.php',37],['cohort','locallib.php',101],['badges/criteria','award_criteria.php',127],['lib/adodb/perf','perf-mysql.inc.php',86],['cache/stores/memcached','lib.php',133],['grade/report/singleview/classes/local/ui','empty_element.php',38],['lib/google/src/Google/Service','AppState.php',40],['lib/adodb/drivers','adodb-odbc_oracle.inc.php',107],['lib/pear/HTML/QuickForm/Renderer','Default.php',139],['tag/classes/output','tag.php',46],['question','previewlib.php',122],['backup/util/loggers','database_logger.class.php',40],['mod/forum/classes','potential_subscriber_selector.php',47],['lib/htmlpurifier/HTMLPurifier/ConfigSchema','InterchangeBuilder.php',15],['lib/phpexcel/PHPExcel/Reader','SYLK.php',67],['lib/form','submitlink.php',47],['backup/util/dbops','restore_dbops.class.php',1788],['lib/xmldb','xmldb_index.php',56],['question','category_class.php',58],['question','category_class.php',160],['lib/google/src/Google/Service','Webfonts.php',38],['webservice/xmlrpc','locallib.php',41],['admin/roles/classes','check_users_selector.php',38],['lib/htmlpurifier/HTMLPurifier/AttrTransform','ImgSpace.php',24],['user/profile/field/checkbox','field.class.php',33],['lib/form','cancel.php',47],['lib/google/src/Google/Service','Resourceviews.php',57],['lib/phpexcel/PHPExcel/Style','Font.php',100],['lib/portfolio','plugin.php',445],['calendar','lib.php',2003],['calendar','lib.php',2774],['mod/wiki','pagelib.php',93],['mod/wiki','pagelib.php',380],['mod/wiki','pagelib.php',981],['mod/wiki','pagelib.php',1190],['mod/wiki','pagelib.php',2194],['mod/wiki','pagelib.php',2422],['tag/classes/output','tagfeed.php',43],['tag/classes/output','tagareaenabled.php',38],['backup/util/xml/parser/processors','selective_like_parser_processor.class.php',35],['mod/workshop','locallib.php',183],['mod/workshop','locallib.php',2976],['mod/workshop','locallib.php',3411],['mod/workshop','locallib.php',3647],['mod/workshop','locallib.php',3889],['mod/workshop','locallib.php',3975],['mod/workshop','locallib.php',4060],['mod/workshop','locallib.php',4079],['lib/form','advcheckbox.php',48],['backup/cc/cc_lib','cc_assesment_sfib.php',27],['cohort/classes/output','cohortidnumber.php',37],['lib/adodb/drivers','adodb-ado.inc.php',42],['lib/adodb/drivers','adodb-ado.inc.php',346],['lib/form','filepicker.php',53],['mod/assign','adminlib.php',41],['mod/assign','adminlib.php',102],['lib/tests/fixtures','test_renderer_factory.php',41],['backup/cc/cc_lib','cc_converter_label.php',28],['lib/htmlpurifier/HTMLPurifier','Lexer.php',152],['grade/report/singleview','lib.php',69],['backup/cc/cc_lib','cc_converter_page.php',28],['lib/google/src/Google/Logger','Psr.php',39],['lib/simplepie/library/SimplePie/HTTP','Parser.php',131],['backup/util/plan','backup_step.class.php',32],['backup/util/plan','backup_step.class.php',55],['lib/lessphp/Tree','Import.php',30],['lib/jabber/XMPP','XMPP_Old.php',45],['lib/phpexcel/PHPExcel/Worksheet','Drawing.php',37],['lib/google/src/Google/Service','Classroom.php',60],['lib/phpexcel/PHPExcel/Chart/Renderer','jpgraph.php',875],['admin/tool/lp/classes/external','competency_path_exporter.php',38],['cohort/classes/output','cohortname.php',37],['grade/report/overview','lib.php',76],['lib/horde/framework/Horde/Mail/Rfc822','Address.php',66],['admin/roles/classes','admins_existing_selector.php',30],['lib/phpunit/classes','arraydataset.php',45],['question/engine','questionattempt.php',166],['question/engine','questionattempt.php',1532],['question/engine','questionattempt.php',1618],['question/engine','questionattempt.php',1703],['lib/horde/framework/Horde/Support','Uuid.php',23],['lib/horde/framework/Horde/Imap/Client/Data/Format','Nil.php',27],['webservice/rest','lib.php',47],['lib/phpexcel/PHPExcel/Worksheet','HeaderFooterDrawing.php',79],['backup/util/xml/output','memory_xml_output.class.php',37],['repository/flickr_public','image.php',34],['mod/lti/classes/local/ltiservice','resource_base.php',62],['admin/tool/lp/classes/output','template_plans_table.php',53],['mod/quiz','mod_form.php',48],['lib/simplepie/library/SimplePie','Caption.php',98],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Multiple.php',33],['lib/htmlpurifier/HTMLPurifier','PercentEncoder.php',20],['lib/phpexcel/PHPExcel/Calculation','ExceptionHandler.php',30],['lib/htmlpurifier/HTMLPurifier/Token','Tag.php',33],['backup/moodle2','backup_theme_plugin.class.php',61],['mod/chat','chatd.php',78],['mod/chat','chatd.php',103],['lib/phpexcel/PHPExcel','DocumentSecurity.php',65],['lib/htmlpurifier/HTMLPurifier','URIDefinition.php',21],['lib/spout/src/Spout/Writer/XLSX/Internal','Workbook.php',45],['lib/phpexcel/PHPExcel/Shared','XMLWriter.php',49],['lib/lessphp/Tree','Operation.php',19],['lib/htmlpurifier/HTMLPurifier/Lexer','PH5P.php',461],['lib/htmlpurifier/HTMLPurifier/Lexer','PH5P.php',1699],['backup/cc/cc_lib','cc_converter_folder.php',28],['backup/util/helper','restore_roles_parser_processor.class.php',39],['lib/simplepie/library/SimplePie','Locator.php',68],['lib/google/src/Google/Service','SQLAdmin.php',50],['lib/lessphp/Tree','DetachedRuleset.php',15],['admin/tool/assignmentupgrade','upgradableassignmentstable.php',49],['backup/cc','validator.php',30],['backup/cc','validator.php',116],['backup/cc','validator.php',202],['backup/cc','validator.php',230],['backup/cc','validator.php',236],['backup/cc','validator.php',242],['backup/cc','validator.php',248],['backup/cc','validator.php',254],['backup/cc','validator.php',260],['lib/horde/framework/Horde/Imap/Client/Interaction','Client.php',34],['mod/quiz','override_form.php',58],['auth/cas/CAS/CAS/PGTStorage','AbstractStorage.php',57],['lib/htmlpurifier/HTMLPurifier','Length.php',41],['backup/util/helper','restore_decode_rule.class.php',47],['backup/util/helper','restore_decode_rule.class.php',192],['lib/horde/framework/Horde/Imap/Client/Data','Sync.php',133],['lib/phpexcel/PHPExcel/Shared/trend','logarithmicBestFitClass.php',97],['lib/adodb/perf','perf-db2.inc.php',61],['lib/phpexcel/PHPExcel/Style','Supervisor.php',44],['lib/htmlpurifier/HTMLPurifier/AttrTransform','TargetBlank.php',17],['lib/ddl','database_manager.php',48],['lib/mustache/src/Mustache/Exception','UnknownFilterException.php',22],['admin/roles/classes','define_role_table_advanced.php',46],['lib/dml','oci_native_moodle_temptables.php',40],['lib/horde/framework/Horde/Stream','Existing.php',28],['enrol/manual','locallib.php',37],['enrol/manual','locallib.php',102],['availability/classes','multiple_messages.php',56],['lib/phpexcel/PHPExcel/Reader','Gnumeric.php',55],['admin/roles/classes','override_permissions_table_advanced.php',31],['lib/pear/Net','GeoIP.php',323],['lib/mustache/src/Mustache/Loader','ArrayLoader.php',31],['lib/form','modgrade.php',78],['admin/tool/log/store/database/backup/moodle2','restore_logstore_database_subplugin.class.php',40],['cache/classes','config.php',80],['lib/pear/HTML/QuickForm','hidden.php',37],['question/type/calculated','datasetitems_form.php',72],['lib/tests','navigationlib_test.php',554],['lib/tests','navigationlib_test.php',612],['lib/tests','navigationlib_test.php',639],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Number.php',18],['lib/tests','completionlib_test.php',882],['admin/tool/generator/classes','site_backend.php',58],['lib/jabber/XMPP','XMLStream.php',171],['lib/simplepie/library/SimplePie','Sanitize.php',75],['cache/classes','factory.php',149],['lib/minify/lib/Minify/Cache','WinCache.php',20],['user/classes/output/myprofile','node.php',82],['lib/horde/framework/Horde/Stream','TempString.php',40],['lib/adodb/drivers','adodb-borland_ibase.inc.php',83],['mod/forum','locallib.php',55],['mod/forum','locallib.php',419],['mod/lti/service/memberships/classes/local/resource','contextmemberships.php',44],['lib/phpexcel/PHPExcel/Worksheet/AutoFilter/Column','Rule.php',262],['lib/classes/update','code_manager.php',57],['search/engine/solr/classes','engine.php',103],['lib/horde/framework/Horde/Imap/Client/Interaction/Server','Tagged.php',36],['lib/google/src/Google/Service','Compute.php',89],['lib/phpexcel/PHPExcel/Style','Borders.php',113],['lib','completionlib.php',243],['lib/google/src/Google/Service','Pubsub.php',44],['lib/adodb/drivers','adodb-ads.inc.php',69],['lib/adodb/drivers','adodb-ads.inc.php',657],['lib/markdown','MarkdownExtra.php',56],['lib/minify/lib/Minify/Cache','XCache.php',22],['lib/google/src/Google/Service','YouTube.php',75],['lib/lessphp','Functions.php',15],['auth/cas/CAS/CAS','AuthenticationException.php',53],['mod/quiz','locallib.php',1923],['competency/classes/external','stored_file_exporter.php',45],['user/filters','checkbox.php',51],['backup/moodle2','restore_settingslib.php',86],['backup/moodle2','restore_settingslib.php',149],['lib/htmlpurifier/HTMLPurifier/Node','Element.php',39],['lib/pear/HTML/QuickForm','date.php',260],['lib/lessphp/SourceMap','Generator.php',82],['backup/util/plan','base_step.class.php',35],['backup/util/plan','base_step.class.php',127],['mod/lti/service/memberships/classes/local/service','memberships.php',50],['lib/google/src/Google/Cache','Apc.php',37],['backup/util/ui','restore_ui_stage.class.php',42],['backup/util/ui','restore_ui_stage.class.php',265],['backup/util/ui','restore_ui_stage.class.php',452],['backup/util/ui','restore_ui_stage.class.php',592],['backup/util/ui','restore_ui_stage.class.php',704],['backup/util/ui','restore_ui_stage.class.php',852],['backup/util/ui','restore_ui_stage.class.php',959],['backup/util/ui','restore_ui_stage.class.php',1100],['lib/pear/Auth','RADIUS.php',120],['lib/pear/Auth','RADIUS.php',579],['lib/pear/Auth','RADIUS.php',672],['lib/pear/Auth','RADIUS.php',879],['lib/adodb/drivers','adodb-ado_access.inc.php',46],['admin/tool/xmldb/actions','XMLDBAction.class.php',56],['backup/converter/moodle1','handlerlib.php',120],['backup/converter/moodle1','handlerlib.php',1710],['backup/converter/moodle1','handlerlib.php',1902],['backup/converter/moodle1','handlerlib.php',2155],['backup/controller','restore_controller.class.php',63],['backup/controller','restore_controller.class.php',519],['lib/google/src/Google/Http','Request.php',58],['lib/google/src/Google/Service','Dfareporting.php',99],['lib/google/src/Google/Service','Manager.php',60],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Hashtable.php',73],['lib/htmlpurifier/HTMLPurifier/ConfigSchema','Validator.php',30],['lib/google/src/Google/Service','CloudMonitoring.php',45],['lib/editor/tinymce/plugins/spellchecker/classes','SpellChecker.php',11],['lib/horde/framework/Horde/Imap/Client/Ids','Map.php',44],['lib/horde/framework/Horde/Mail/Transport','Sendmail.php',65],['lib','webdavlib.php',84],['lib/dml','pgsql_native_moodle_recordset.php',43],['lib/horde/framework/Horde/Support','Guid.php',24],['lib/mustache/src/Mustache','LambdaHelper.php',25],['question/engine/upgrade/tests','helper.php',45],['admin/tool/uploadcourse/classes','tracker.php',72],['grade/report/user','lib.php',188],['lib/adodb/drivers','adodb-sqlanywhere.inc.php',156],['auth/cas/CAS/CAS','OutOfSequenceBeforeClientException.php',47],['backup/util/plan','base_task.class.php',40],['backup/util/plan','base_task.class.php',277],['lib/adodb/drivers','adodb-db2oci.inc.php',220]], 1102],
'delete': ['delete', 'Deletes an item from the cache store. ', [['cache/stores/static','lib.php',374],['cache','disabledlib.php',102],['lib/google/src/Google/Service','AdSense.php',1258],['lib/google/src/Google/Service','AdSense.php',1730],['lib/grade','grade_item.php',396],['lib/google/src/Google/Service','Replicapool.php',378],['lib/google/src/Google/Service','Tasks.php',310],['lib/google/src/Google/Service','Tasks.php',428],['lib/google/src/Google/Service','AndroidPublisher.php',1230],['lib/google/src/Google/Service','AndroidPublisher.php',1310],['lib/google/src/Google/Service','AndroidPublisher.php',1668],['lib/google/src/Google/Service','AndroidPublisher.php',1763],['lib/google/src/Google/Service','AndroidPublisher.php',2083],['lib/google/src/Google/Service','YouTubeReporting.php',255],['lib/google/src/Google/Service','Reseller.php',441],['lib/google/src/Google/Cache','Memcache.php',144],['lib','filelib.php',3481],['lib/google/src/Google/Service','Computeaccounts.php',418],['lib/google/src/Google/Service','Computeaccounts.php',497],['lib/google/src/Google/Service','Computeaccounts.php',668],['lib/grade','grade_category.php',281],['lib/grade','grade_scale.php',136],['lib/adodb','adodb-active-record.inc.php',901],['lib/grade','grade_object.php',270],['lib/google/src/Google/Service','YouTubeAnalytics.php',352],['lib/google/src/Google/Service','YouTubeAnalytics.php',447],['lib/google/src/Google/Service','MapsEngine.php',1693],['lib/google/src/Google/Service','MapsEngine.php',1991],['lib/google/src/Google/Service','MapsEngine.php',2344],['lib/google/src/Google/Service','MapsEngine.php',2651],['lib/google/src/Google/Service','MapsEngine.php',2912],['completion','data_object.php',273],['lib/google/src/Google/Cache','File.php',115],['cache/classes','dummystore.php',198],['lib/google/src/Google/Service','Dns.php',378],['cache/classes','loaders.php',792],['cache/classes','loaders.php',1471],['cache/classes','loaders.php',1841],['lib/google/src/Google/Service','Appengine.php',352],['lib/google/src/Google/Service','Appengine.php',455],['tag/classes','collection.php',260],['lib/filebrowser','file_info.php',418],['lib/google/src/Google/Service','AdExchangeBuyer.php',938],['lib/google/src/Google/Service','AdExchangeBuyer.php',1137],['lib/google/src/Google/Service','AdExchangeBuyer.php',1561],['lib/filebrowser','virtual_root_file.php',69],['lib/google/src/Google/Service','Books.php',1946],['lib/grade','grade_grade.php',1024],['lib/grade','grade_outcome.php',97],['lib/google/src/Google/Service','Analytics.php',2165],['lib/google/src/Google/Service','Analytics.php',2534],['lib/google/src/Google/Service','Analytics.php',2655],['lib/google/src/Google/Service','Analytics.php',2872],['lib/google/src/Google/Service','Analytics.php',3001],['lib/google/src/Google/Service','Analytics.php',3092],['lib/google/src/Google/Service','Analytics.php',3406],['lib/google/src/Google/Service','Analytics.php',3631],['lib/google/src/Google/Service','DeploymentManager.php',452],['lib/google/src/Google/Service','Blogger.php',1065],['lib/google/src/Google/Service','Blogger.php',1227],['lib/google/src/Google/Service','Blogger.php',1451],['lib/filebrowser','file_info_stored.php',631],['competency/classes','persistent.php',510],['lib/google/src/Google/Service','CloudUserAccounts.php',528],['lib/google/src/Google/Service','CloudUserAccounts.php',628],['lib/google/src/Google/Service','CloudUserAccounts.php',893],['lib/google/src/Google/Service','Cloudresourcemanager.php',390],['lib/htmlpurifier/HTMLPurifier','Zipper.php',89],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',960],['lib/google/src/Google/Service','TagManager.php',1022],['lib/google/src/Google/Service','TagManager.php',1113],['lib/google/src/Google/Service','TagManager.php',1265],['lib/google/src/Google/Service','TagManager.php',1358],['lib/google/src/Google/Service','TagManager.php',1452],['lib/google/src/Google/Service','TagManager.php',1546],['lib/google/src/Google/Service','TagManager.php',1696],['mod/lesson','locallib.php',1037],['mod/lesson','locallib.php',2271],['repository','lib.php',427],['repository','lib.php',1962],['admin/tool/uploadcourse/classes','course.php',226],['lib','badgeslib.php',640],['lib/google/src/Google/Service','Bigquery.php',531],['lib/google/src/Google/Service','Bigquery.php',863],['lib/google/src/Google/Service','ShoppingContent.php',1050],['lib/google/src/Google/Service','ShoppingContent.php',1448],['lib/google/src/Google/Service','ShoppingContent.php',1970],['lib/google/src/Google/Service','Webmasters.php',355],['lib/google/src/Google/Service','Webmasters.php',449],['lib/google/src/Google/Service','Clouddebugger.php',384],['lib/filestorage','stored_file.php',323],['lib/google/src/Google/Service','Container.php',309],['lib/google/src/Google/Service','Storage.php',1042],['lib/google/src/Google/Service','Storage.php',1157],['lib/google/src/Google/Service','Storage.php',1332],['lib/google/src/Google/Service','Storage.php',1454],['lib/google/src/Google/Service','Storage.php',1681],['cache/stores/memcache','lib.php',401],['lib/google/src/Google/Service','Genomics.php',646],['lib/google/src/Google/Service','Genomics.php',735],['lib/google/src/Google/Service','Genomics.php',903],['lib/google/src/Google/Service','Genomics.php',971],['lib/google/src/Google/Service','Genomics.php',1326],['lib/google/src/Google/Service','Genomics.php',1443],['lib/google/src/Google/Service','Licensing.php',224],['lib/google/src/Google/Service','Fitness.php',400],['lib/google/src/Google/Service','Fitness.php',512],['lib/google/src/Google/Service','Fitness.php',647],['comment','lib.php',790],['lib/google/src/Google/Service','Gmail.php',763],['lib/google/src/Google/Service','Gmail.php',921],['lib/google/src/Google/Service','Gmail.php',1014],['lib/google/src/Google/Service','Gmail.php',1234],['lib/google/src/Google/Service','Taskqueue.php',293],['lib/adodb','adodb-active-recordx.inc.php',1016],['lib','accesslib.php',5580],['cache/classes','interfaces.php',161],['lib/google/src/Google/Service','Autoscaler.php',315],['lib/google/src/Google/Service','Autoscaler.php',429],['lib/google/src/Google/Service','Prediction.php',262],['lib/google/src/Google/Service','SiteVerification.php',139],['lib/google/src/Google/Service','Drive.php',1522],['lib/google/src/Google/Service','Drive.php',1603],['lib/google/src/Google/Service','Drive.php',1748],['lib/google/src/Google/Service','Drive.php',2040],['lib/google/src/Google/Service','Drive.php',2110],['lib/google/src/Google/Service','Drive.php',2240],['lib/google/src/Google/Service','Drive.php',2403],['lib/google/src/Google/Service','Drive.php',2523],['lib/google/src/Google/Service','Proximitybeacon.php',522],['lib/google/src/Google/Service','Directory.php',1683],['lib/google/src/Google/Service','Directory.php',1916],['lib/google/src/Google/Service','Directory.php',1989],['lib/google/src/Google/Service','Directory.php',2059],['lib/google/src/Google/Service','Directory.php',2169],['lib/google/src/Google/Service','Directory.php',2224],['lib/google/src/Google/Service','Directory.php',2351],['lib/google/src/Google/Service','Directory.php',2420],['lib/google/src/Google/Service','Directory.php',2517],['lib/google/src/Google/Service','Directory.php',2652],['lib/google/src/Google/Service','Directory.php',2731],['lib/google/src/Google/Service','Directory.php',2836],['lib/google/src/Google/Service','Directory.php',2938],['lib/google/src/Google/Service','Directory.php',2999],['lib/google/src/Google/Service','Directory.php',3199],['lib/google/src/Google/Service','Directory.php',3274],['lib/google/src/Google/Service','Fusiontables.php',645],['lib/google/src/Google/Service','Fusiontables.php',812],['lib/google/src/Google/Service','Fusiontables.php',937],['lib/google/src/Google/Service','Fusiontables.php',1126],['lib/google/src/Google/Service','Fusiontables.php',1188],['lib/google/src/Google/Service','AdSenseHost.php',734],['lib/google/src/Google/Service','AdSenseHost.php',1010],['lib/google/src/Google/Service','AdSenseHost.php',1168],['lib/google/src/Google/Service','Mirror.php',425],['lib/google/src/Google/Service','Mirror.php',593],['lib/google/src/Google/Service','Mirror.php',661],['lib/google/src/Google/Service','Mirror.php',772],['tag/classes','area.php',187],['lib/google/src/Google/Service','AndroidEnterprise.php',988],['lib/google/src/Google/Service','AndroidEnterprise.php',1092],['lib/google/src/Google/Service','AndroidEnterprise.php',1280],['lib/google/src/Google/Service','AndroidEnterprise.php',1415],['lib/google/src/Google/Service','AndroidEnterprise.php',1597],['course','lib.php',3263],['mnet','peer.php',118],['search/tests/fixtures','mock_search_engine.php',48],['lib/google/src/Google/Service','Calendar.php',903],['lib/google/src/Google/Service','Calendar.php',1071],['lib/google/src/Google/Service','Calendar.php',1269],['lib/google/src/Google/Service','Calendar.php',1412],['cache/stores/session','lib.php',417],['blog','locallib.php',322],['lib/google/src/Google/Service','Storagetransfer.php',381],['cache/stores/mongodb','lib.php',361],['lib/google/src/Google/Cache','Null.php',53],['lib/google/src/Google/Service','GamesConfiguration.php',251],['lib/google/src/Google/Service','GamesConfiguration.php',390],['cache/stores/file','lib.php',393],['badges/criteria','award_criteria.php',330],['cache/stores/memcached','lib.php',402],['lib/google/src/Google/Service','AppState.php',154],['lib/google/src/Google/Service','Resourceviews.php',423],['lib/portfolio','plugin.php',692],['calendar','lib.php',2423],['lib/google/src/Google/Service','Classroom.php',466],['lib/google/src/Google/Service','Classroom.php',615],['lib/google/src/Google/Service','Classroom.php',701],['lib/google/src/Google/Service','Classroom.php',806],['lib/google/src/Google/Service','Classroom.php',934],['lib/google/src/Google/Service','SQLAdmin.php',786],['lib/google/src/Google/Service','SQLAdmin.php',856],['lib/google/src/Google/Service','SQLAdmin.php',1023],['lib/google/src/Google/Service','SQLAdmin.php',1368],['lib/google/src/Google/Service','SQLAdmin.php',1483],['badges/criteria','award_criteria_manual.php',220],['search/engine/solr/classes','engine.php',1045],['lib/google/src/Google/Service','Compute.php',4021],['lib/google/src/Google/Service','Compute.php',4149],['lib/google/src/Google/Service','Compute.php',4284],['lib/google/src/Google/Service','Compute.php',4571],['lib/google/src/Google/Service','Compute.php',4671],['lib/google/src/Google/Service','Compute.php',4829],['lib/google/src/Google/Service','Compute.php',4942],['lib/google/src/Google/Service','Compute.php',5033],['lib/google/src/Google/Service','Compute.php',5174],['lib/google/src/Google/Service','Compute.php',5248],['lib/google/src/Google/Service','Compute.php',5378],['lib/google/src/Google/Service','Compute.php',5508],['lib/google/src/Google/Service','Compute.php',5683],['lib/google/src/Google/Service','Compute.php',5984],['lib/google/src/Google/Service','Compute.php',6156],['lib/google/src/Google/Service','Compute.php',6316],['lib/google/src/Google/Service','Compute.php',6717],['lib/google/src/Google/Service','Compute.php',6898],['lib/google/src/Google/Service','Compute.php',7037],['lib/google/src/Google/Service','Compute.php',7128],['lib/google/src/Google/Service','Compute.php',7208],['lib/google/src/Google/Service','Compute.php',7299],['lib/google/src/Google/Service','Compute.php',7409],['lib/google/src/Google/Service','Compute.php',7570],['lib/google/src/Google/Service','Compute.php',7734],['lib/google/src/Google/Service','Compute.php',7938],['lib/google/src/Google/Service','Compute.php',8035],['lib/google/src/Google/Service','Compute.php',8210],['lib/google/src/Google/Service','Compute.php',8305],['lib/google/src/Google/Service','Pubsub.php',240],['lib/google/src/Google/Service','Pubsub.php',379],['lib/google/src/Google/Service','YouTube.php',1810],['lib/google/src/Google/Service','YouTube.php',2061],['lib/google/src/Google/Service','YouTube.php',2459],['lib/google/src/Google/Service','YouTube.php',2889],['lib/google/src/Google/Service','YouTube.php',3187],['lib/google/src/Google/Service','YouTube.php',3419],['lib/google/src/Google/Service','YouTube.php',3559],['lib/google/src/Google/Service','YouTube.php',3928],['lib/google/src/Google/Service','YouTube.php',4158],['lib/google/src/Google/Cache','Apc.php',105],['lib/google/src/Google/Service','Dfareporting.php',5000],['lib/google/src/Google/Service','Dfareporting.php',5566],['lib/google/src/Google/Service','Dfareporting.php',5753],['lib/google/src/Google/Service','Dfareporting.php',5877],['lib/google/src/Google/Service','Dfareporting.php',6397],['lib/google/src/Google/Service','Dfareporting.php',6578],['lib/google/src/Google/Service','Dfareporting.php',6731],['lib/google/src/Google/Service','Dfareporting.php',6996],['lib/google/src/Google/Service','Dfareporting.php',7503],['lib/google/src/Google/Service','Dfareporting.php',8102],['lib/google/src/Google/Service','Dfareporting.php',8768],['lib/google/src/Google/Service','Manager.php',244],['lib/google/src/Google/Service','Manager.php',324],['lib/google/src/Google/Service','CloudMonitoring.php',274],['lib','webdavlib.php',691]], 317],
'send_test_pdf': ['send_test_pdf', 'If the test pdf has been generated correctly and send it direct to the browser. ', [['lib/filestorage','file_storage.php',261]], 1],
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'sql_length': ['sql_length', 'Returns the SQL text to be used to calculate the length in characters of one expression. ', [['lib/dml','mssql_native_moodle_database.php',1285],['lib/dml','mysqli_native_moodle_database.php',1590],['lib/dml','moodle_database.php',2134],['lib/dml','sqlsrv_native_moodle_database.php',1353]], 6],
'pack_reference': ['pack_reference', 'When user referring to a moodle file, we build the reference field ', [['lib/filestorage','file_storage.php',2197]], 19],
'mimeinfo_from_type': ['mimeinfo_from_type', 'Obtains information about a filetype based on the MIME type rather than the other way around. ', [['lib','filelib.php',1467]], 4],
'count_records_sql': ['count_records_sql', 'Get the result of a SQL SELECT COUNT(...) query. ', [['lib/dml','moodle_database.php',1796]], 155],
'test_unoconv_path': ['test_unoconv_path', 'Check if unoconv configured path is correct and working. ', [['lib/filestorage','file_storage.php',293]], 1],
'get_unused_filename': ['get_unused_filename', 'Get an unused filename from the current draft area. ', [['repository','lib.php',929],['lib/filestorage','file_storage.php',438]], 35],
'file_is_executable': ['file_is_executable', 'Tells whether the filename is executable. ', [['lib','filelib.php',2488]], 6],
'delete_reference': ['delete_reference', 'Unlink the stored file from the referenced file ', [['lib/filestorage','stored_file.php',270]], 4],
'xsendfile': ['xsendfile', 'Serve file content using X-Sendfile header. Please make sure that all headers are already sent and the all access control checks passed. ', [['lib/filestorage','file_storage.php',2066],['lib','xsendfilelib.php',27]], 9],
'mtrace': ['mtrace', 'Outputs the given message via {@link mtrace()}. ', [['lib/classes','plugin_manager.php',1376],['lib','moodlelib.php',8509]], 406],
'update_references_to_storedfile': ['update_references_to_storedfile', 'Updates all files that are referencing this file with the new contenthash and filesize ', [['lib/filestorage','file_storage.php',2426]], 1],
'clean_param': ['clean_param', 'Used by {@link optional_param()} and {@link required_param()} to clean the variables and/or cast to specific types, based on an options field. <code> $course->format = clean_param($course->format, PARAM_ALPHA); $selectedgradeitem = clean_param($selectedgradeitem, PARAM_INT); </code> ', [['lib','moodlelib.php',769]], 635],
'file_exists_by_hash': ['file_exists_by_hash', 'Whether or not the file exist ', [['lib/filestorage','file_storage.php',157]], 1],
'is_directory': ['is_directory', 'Whether or not this is a directory ', [['lib/filebrowser','file_info_context_system.php',133],['mod/lesson/classes','file_info.php',94],['mod/imscp','locallib.php',328],['lib/filebrowser','file_info_context_coursecat.php',146],['mod/book','locallib.php',463],['lib/filebrowser','file_info_context_user.php',265],['lib/filebrowser','virtual_root_file.php',60],['mod/data','locallib.php',477],['lib/filebrowser','file_info_stored.php',267],['lib/filestorage','stored_file.php',310],['mod/workshop','fileinfolib.php',82],['mod/workshop','fileinfolib.php',241],['lib/filebrowser','file_info_context_module.php',249],['mod/glossary','locallib.php',525],['lib/filebrowser','file_info_context_course.php',372],['lib/filebrowser','file_info_context_course.php',657],['lib/filebrowser','file_info_context_course.php',803],['mod/forum','locallib.php',463]], 140],
'create_file_from_url': ['create_file_from_url', 'Add new local file. ', [['lib/filestorage','file_storage.php',1312]], 5],
'get_component': ['get_component', 'Gets the Frankenstyle component name for this plugin. ', [['availability/classes','frontend.php',86],['lib/classes/task','task_base.php',125],['lib/filebrowser','virtual_root_file.php',191],['grade/grading','lib.php',126],['lib/filestorage','stored_file.php',661],['cache/classes','definition.php',650],['comment','lib.php',975],['grade/grading/form','lib.php',111]], 71],
'mimetype': ['mimetype', 'Return mimetype by given file pathname ', [['lib/filestorage','file_storage.php',2472]], 5],
'instance': ['instance', 'Returns an instance of the cache_factor method. ', [['cache','disabledlib.php',171],['cache','disabledlib.php',296],['lib/classes','useragent.php',101],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['search/classes','manager.php',109],['cache','locallib.php',52],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['lib/classes','plugin_manager.php',103],['lib/htmlpurifier','HTMLPurifier.php',251],['course/format','lib.php',156],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['admin/tool/installaddon/classes','installer.php',40],['lib','modinfolib.php',373],['cache/classes','helper.php',76],['lib/tests','string_manager_standard_test.php',124],['lib/portfolio','exporter.php',251],['lib/classes/update','validator.php',88],['search/classes','document_factory.php',49],['lib','accesslib.php',6235],['lib','accesslib.php',6487],['lib','accesslib.php',6665],['lib','accesslib.php',6919],['lib','accesslib.php',7180],['lib','accesslib.php',7392],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443],['lib','filterlib.php',80],['search/tests/fixtures','testable_core_search.php',43],['lib/tests/fixtures','testable_update_checker.php',45],['backup/cc','validator.php',35],['cache/classes','config.php',87],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29]], 4647],
'sql_substr': ['sql_substr', 'Returns the proper substr() SQL text used to extract substrings from DB NOTE: this was originally returning only function name ', [['lib/dml','mssql_native_moodle_database.php',1305],['lib/dml','moodle_database.php',2143],['lib/dml','sqlsrv_native_moodle_database.php',1373],['lib/dml/tests','dml_test.php',5556]], 19],
'create_file_preview': ['create_file_preview', 'Generates a preview image for the stored file ', [['lib/filestorage','file_storage.php',586]], 1],
'sql_like_escape': ['sql_like_escape', 'Escape sql LIKE special characters like \'_\' or \'%\'. ', [['lib/dml','moodle_database.php',2073]], 26],
'get_references_count_by_storedfile': ['get_references_count_by_storedfile', 'Returns the number of aliases that link to the given stored_file ', [['lib/filestorage','file_storage.php',2404]], 2],
'sql_like': ['sql_like', 'Returns \'LIKE\' part of a query. ', [['lib/dml','oci_native_moodle_database.php',1575],['lib/dml','pgsql_native_moodle_database.php',1188],['lib/dml','mssql_native_moodle_database.php',1224],['lib/dml','mysqli_native_moodle_database.php',1514],['lib/dml','moodle_database.php',2053],['lib/dml','sqlsrv_native_moodle_database.php',1291]], 159],
'close': ['close', 'Close archive, write changes to disk. ', [['lib/filestorage','zip_archive.php',183],['lib/dml','mssql_native_moodle_recordset.php',87],['auth/fc','fcFPP.php',78],['lib/dml','mysqli_native_moodle_recordset.php',86],['lib/spout/src/Spout/Reader','ReaderInterface.php',30],['lib/spout/src/Spout/Writer/ODS/Internal','Workbook.php',81],['lib/dml','pdo_moodle_recordset.php',79],['lib','csvlib.class.php',256],['lib/horde/framework/Horde/Socket','Client.php',135],['backup/util/helper','backup_null_iterator.class.php',53],['admin/tool/uploaduser','locallib.php',149],['lib/tcpdf','tcpdf.php',2943],['lib/phpunit/classes','phpmailer_sink.php',41],['lib/phpmailer','class.smtp.php',582],['lib/dml','sqlsrv_native_moodle_recordset.php',133],['lib/classes/dml','recordset_walk.php',153],['lib/spout/src/Spout/Writer/XLSX/Helper','SharedStringsHelper.php',84],['grade/export','lib.php',689],['lib','excellib.class.php',93],['backup/util/loggers','file_logger.class.php',69],['grade','lib.php',324],['backup/util/helper','backup_array_iterator.class.php',63],['lib/horde/framework/Horde/Imap/Client','Base.php',1846],['mod/assign/feedback/offline','importgradeslib.php',204],['lib/dml','oci_native_moodle_recordset.php',80],['lib/adodb','adodb.inc.php',2361],['lib/adodb','adodb.inc.php',3090],['lib/adodb','adodb.inc.php',3870],['lib/google/src/Google/Logger','File.php',132],['lib/phpunit/classes','event_sink.php',39],['lib/horde/framework/Horde','Stream.php',585],['backup/util/loggers','base_logger.class.php',89],['lib/phpexcel/PHPExcel/Shared','ZipArchive.php',71],['question/engine/tests','helpers.php',1241],['lib/spout/src/Spout/Writer','AbstractWriter.php',312],['lib','odslib.class.php',71],['lib/spout/src/Spout/Writer/Common/Internal','WorksheetInterface.php',34],['lib/spout/src/Spout/Writer/ODS/Internal','Worksheet.php',214],['lib/spout/src/Spout/Writer','WriterInterface.php',84],['lib/spout/src/Spout/Writer/XLSX/Internal','Worksheet.php',174],['lib/spout/src/Spout/Reader','AbstractReader.php',183],['lib/phpunit/classes','message_sink.php',39],['lib/spout/src/Spout/Writer/Common/Internal','WorkbookInterface.php',65],['lib/spout/src/Spout/Writer/XLSX/Internal','Workbook.php',95],['lib/pear/Net','GeoIP.php',556],['lib/tests','completionlib_test.php',907],['lib/pear/Auth','RADIUS.php',550],['lib/pear/Auth','RADIUS.php',710],['lib/pear/Auth','RADIUS.php',829],['lib','webdavlib.php',176],['lib/dml','pgsql_native_moodle_recordset.php',107]], 1128],
'is_number': ['is_number', 'Return true if given value is integer or string with integer value ', [['lib','moodlelib.php',1291],['lib/phpexcel/PHPExcel/Calculation','Functions.php',464]], 68],
'generate_image_thumbnail': ['generate_image_thumbnail', 'Generates a thumbnail for the given image ', [['lib','gdlib.php',273],['lib/filestorage','stored_file.php',1038]], 5],
'get_area_files': ['get_area_files', 'Returns all area files (optionally limited by itemid) ', [['lib/filestorage','file_storage.php',782],['lib','externallib.php',1134]], 216],
'add_file_to_pool': ['add_file_to_pool', 'Add file content to sha1 pool. ', [['lib/filestorage','file_storage.php',1895],['backup/converter/moodle1','lib.php',1409]], 7],
'search_references': ['search_references', 'Returns all aliases that refer to some stored_file via the given reference ', [['lib/filestorage','file_storage.php',2302]], 5],
'import_external_file_contents': ['import_external_file_contents', 'Downloads the file from external repository and saves it in moodle filepool. This function is different from {@link repository::sync_reference()} because it has bigger request timeout and always downloads the content. ', [['repository','lib.php',1682],['lib/filestorage','stored_file.php',1011]], 7],
'create_file_from_reference': ['create_file_from_reference', 'Create a new alias/shortcut file from file reference information ', [['lib/filestorage','file_storage.php',1599]], 17],
'update_references': ['update_references', 'Updates a reference to the external resource and all files that use it ', [['lib/filestorage','file_storage.php',2676]], 2],
'get_content': ['get_content', '', [['blocks/blog_menu','block_blog_menu.php',52],['blocks/course_overview','block_course_overview.php',45],['blocks/completionstatus','block_completionstatus.php',44],['blocks/globalsearch','block_globalsearch.php',45],['blocks/calendar_upcoming','block_calendar_upcoming.php',33],['blocks/private_files','block_private_files.php',43],['blocks/admin_bookmarks','block_admin_bookmarks.php',69],['blocks/myprofile','block_myprofile.php',47],['blocks/mentees','block_mentees.php',43],['blocks/html','block_html.php',47],['blocks/section_links','block_section_links.php',53],['lib/filebrowser','virtual_root_file.php',106],['blocks/lp','block_lp.php',54],['blocks/site_main_menu','block_site_main_menu.php',34],['blocks/social_activities','block_social_activities.php',34],['blocks/tag_flickr','block_tag_flickr.php',46],['blocks/mnet_hosts','block_mnet_hosts.php',42],['blocks/quiz_results','block_quiz_results.php',52],['lib','modinfolib.php',1235],['blocks/settings','block_settings.php',103],['blocks/activity_modules','block_activity_modules.php',33],['lib','navigationlib.php',568],['lib/simplepie/library/SimplePie','Item.php',372],['lib/filestorage','stored_file.php',451],['blocks/glossary_random','block_glossary_random.php',223],['blocks/news_items','block_news_items.php',37],['blocks/blog_tags','block_blog_tags.php',62],['blocks/feedback','block_feedback.php',39],['blocks','moodleblock.class.php',143],['blocks/search_forums','block_search_forums.php',30],['blocks/navigation','block_navigation.php',118],['blocks/comments','block_comments.php',48],['blocks/badges','block_badges.php',69],['blocks/blog_recent','block_blog_recent.php',46],['blocks/selfcompletion','block_selfcompletion.php',45],['blocks/community','block_community.php',50],['blocks/recent_activity','block_recent_activity.php',50],['blocks/tag_youtube','block_tag_youtube.php',63],['blocks/course_summary','block_course_summary.php',48],['blocks/tags','block_tags.php',52],['blocks/participants','block_participants.php',30],['blocks/online_users','block_online_users.php',41],['mod/workshop','locallib.php',4032],['blocks/login','block_login.php',34],['blocks/activity_results','block_activity_results.php',138],['blocks/calendar_month','block_calendar_month.php',33],['blocks/course_list','block_course_list.php',37],['blocks/messages','block_messages.php',30],['blocks/rss_client','block_rss_client.php',80]], 71],
'get_unused_dirname': ['get_unused_dirname', 'Return an available directory name. ', [['lib/filestorage','file_storage.php',521]], 1],
'create_converted_document': ['create_converted_document', 'Perform a file format conversion on the specified document. ', [['lib/filestorage','file_storage.php',330]], 1],
'validate_param': ['validate_param', 'Strict validation of parameter values, the values are only converted to requested PHP type. Internally it is using clean_param, the values before and after cleaning must be equal - otherwise an invalid_parameter_exception is thrown. Objects and classes are not accepted. ', [['lib','moodlelib.php',696]], 36],
'unpack_reference': ['unpack_reference', 'Unpack reference field ', [['lib/filestorage','file_storage.php',2215]], 10],
'get_itemid': ['get_itemid', 'Returns file itemid ', [['lib/filebrowser','virtual_root_file.php',209],['lib/filestorage','stored_file.php',681],['comment','lib.php',1019]], 67],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'get_filearea': ['get_filearea', 'Returns file area ', [['lib/filebrowser','virtual_root_file.php',200],['lib/filestorage','stored_file.php',671]], 50],
'allow_commit': ['allow_commit', 'Commit delegated transaction. The real database commit SQL is executed only after committing all delegated transactions. ', [['lib/dml','moodle_transaction.php',78]], 135],
'get_mimetype': ['get_mimetype', 'Returns mimetype ', [['lib/filebrowser','file_info.php',277],['lib/filebrowser','virtual_root_file.php',254],['lib/filebrowser','file_info_stored.php',240],['lib/filestorage','stored_file.php',738],['lib','medialib.php',192],['lib/portfolio','caller.php',453]], 59],
'get_fieldset_sql': ['get_fieldset_sql', 'Selects rows and return values of first column as array. ', [['lib/dml','pdo_moodle_database.php',288],['lib/dml','oci_native_moodle_database.php',1196],['lib/dml','pgsql_native_moodle_database.php',799],['lib/dml','mssql_native_moodle_database.php',839],['lib/dml','mysqli_native_moodle_database.php',1106],['lib/dml','sqlsrv_native_moodle_database.php',925],['lib/dml/tests','dml_test.php',5546]], 58],
'getmessage': ['getmessage', '', [['lib/google/src/Google/Service','Freebase.php',441],['lib/google/src/Google/Service','AdSense.php',2970],['lib/google/src/Google/Service','Replicapool.php',1165],['lib/google/src/Google/Service','Replicapool.php',1257],['lib/google/src/Google/Service','Computeaccounts.php',1368],['lib/google/src/Google/Service','Computeaccounts.php',1460],['lib/google/src/Google/Service','Appengine.php',1604],['lib/google/src/Google/Service','Books.php',3579],['lib/google/src/Google/Service','Books.php',4429],['lib/google/src/Google/Service','Script.php',360],['lib/google/src/Google/Service','DeploymentManager.php',1116],['lib/google/src/Google/Service','DeploymentManager.php',1604],['lib/google/src/Google/Service','DeploymentManager.php',1641],['lib/google/src/Google/Service','DeploymentManager.php',1823],['lib/google/src/Google/Service','DeploymentManager.php',1860],['lib/google/src/Google/Service','Dataflow.php',2656],['lib/google/src/Google/Service','CloudUserAccounts.php',1807],['lib/google/src/Google/Service','CloudUserAccounts.php',1899],['lib/google/src/Google/Service','Replicapoolupdater.php',617],['lib/google/src/Google/Service','Replicapoolupdater.php',926],['lib/google/src/Google/Service','Replicapoolupdater.php',1018],['lib/google/src/Google/Service','Replicapoolupdater.php',1252],['lib/google/src/Google/Service','Bigquery.php',1367],['lib/google/src/Google/Service','ShoppingContent.php',4125],['lib/google/src/Google/Service','ShoppingContent.php',4527],['lib/google/src/Google/Service','ShoppingContent.php',4572],['lib/google/src/Google/Service','Genomics.php',3622],['lib/google/src/Google/Service','Reports.php',1106],['lib/google/src/Google/Service','Gmail.php',1371],['lib/google/src/Google/Service','Gmail.php',1467],['lib/google/src/Google/Service','Gmail.php',1495],['lib/google/src/Google/Service','Gmail.php',1513],['lib/google/src/Google/Service','Gmail.php',1531],['lib/google/src/Google/Service','Autoscaler.php',1079],['lib/google/src/Google/Service','Autoscaler.php',1171],['lib/google/src/Google/Service','AdExchangeSeller.php',1043],['lib/google/src/Google/Service','IdentityToolkit.php',1266],['lib/pear','PEAR.php',941],['lib/google/src/Google/Service','Storagetransfer.php',948],['lib/htmlpurifier/HTMLPurifier','Language.php',86],['lib/google/src/Google/Service','Resourceviews.php',894],['lib/google/src/Google/Service','Resourceviews.php',986],['lib/google/src/Google/Service','SQLAdmin.php',3029],['lib/google/src/Google/Service','Compute.php',8752],['lib/google/src/Google/Service','Compute.php',9200],['lib/google/src/Google/Service','Compute.php',10292],['lib/google/src/Google/Service','Compute.php',10384],['lib/google/src/Google/Service','Compute.php',10890],['lib/google/src/Google/Service','Compute.php',12525],['lib/google/src/Google/Service','Compute.php',12771],['lib/google/src/Google/Service','Compute.php',13249],['lib/google/src/Google/Service','Compute.php',13652],['lib/google/src/Google/Service','Compute.php',13804],['lib/google/src/Google/Service','Compute.php',14396],['lib/google/src/Google/Service','Compute.php',14488],['lib/google/src/Google/Service','Compute.php',14580],['lib/google/src/Google/Service','Compute.php',15235],['lib/google/src/Google/Service','Compute.php',16249],['lib/google/src/Google/Service','Compute.php',16675],['lib/google/src/Google/Service','Compute.php',17005],['lib/google/src/Google/Service','Compute.php',17723],['lib/google/src/Google/Service','Pubsub.php',711],['lib/google/src/Google/Service','Pubsub.php',748],['lib/google/src/Google/Service','Dfareporting.php',19533]], 489],
'search_references_count': ['search_references_count', 'Returns the number of aliases that refer to some stored_file via the given reference ', [['lib/filestorage','file_storage.php',2345]], 7],
'get_file_by_hash': ['get_file_by_hash', 'Fetch file using local file full pathname hash ', [['lib/filestorage','file_storage.php',679]], 73],
'cron_trace_time_and_memory': ['cron_trace_time_and_memory', 'Output some standard information during cron runs. Specifically current time and memory usage. This method also does gc_collect_cycles() (before displaying memory usage) to try to help PHP manage memory better. ', [['lib','cronlib.php',161]], 16],
'get_external_files': ['get_external_files', 'Returns all files belonging to given repository ', [['lib/filestorage','file_storage.php',757]], 5],
'get_imageinfo': ['get_imageinfo', 'Returns width, height and mimetype of the stored image, or false ', [['lib/filebrowser','file_info_stored.php',230],['lib/filestorage','stored_file.php',569]], 14],
'get_records_sql': ['get_records_sql', 'Get a number of records as an array of objects. ', [['lib/dml','pdo_moodle_database.php',309],['lib/dml','oci_native_moodle_database.php',1145],['lib/dml','pgsql_native_moodle_database.php',732],['lib/dml','mssql_native_moodle_database.php',805],['lib/dml','mysqli_native_moodle_database.php',1057],['lib/dml','sqlsrv_native_moodle_database.php',890],['lib/dml/tests','dml_test.php',5545]], 700],
'search_server_files': ['search_server_files', 'Search through the server files. ', [['lib/filestorage','file_storage.php',2245]], 2],
'try_content_recovery': ['try_content_recovery', 'Tries to recover missing content of file from trash. ', [['lib/filestorage','file_storage.php',2122]], 6],
'base64_encode': ['base64_encode', '', [], 134],
'is_null': ['is_null', '', [], 2003],
'imagefill': ['imagefill', '', [], 6],
'imagealphablending': ['imagealphablending', '', [], 6],
'imagepng': ['imagepng', '', [], 11],
'proc_close': ['proc_close', '', [], 2],
'is_array': ['is_array', '', [], 1608],
'strpos': ['strpos', '', [], 1604],
'array_pop': ['array_pop', '', [], 483],
'implode': ['implode', '', [], 1281],
'imagecreatefromstring': ['imagecreatefromstring', '', [], 9],
'trim': ['trim', '', [], 1948],
'file_put_contents': ['file_put_contents', '', [], 94],
'clearstatcache': ['clearstatcache', '', [], 29],
'time': ['time', '', [], 1959],
'imagecreatetruecolor': ['imagecreatetruecolor', '', [], 11],
'uniqid': ['uniqid', '', [], 86],
'mkdir': ['mkdir', '', [], 64],
'file_exists': ['file_exists', '', [], 867],
'count': ['count', '', [], 4095],
'is_numeric': ['is_numeric', '', [], 672],
'filesize': ['filesize', '', [], 82],
'imagecolortransparent': ['imagecolortransparent', '', [], 10],
'unlink': ['unlink', '', [], 256],
'max': ['max', '', [], 1266],
'strtolower': ['strtolower', '', [], 817],
'file_get_contents': ['file_get_contents', '', [], 228],
'chdir': ['chdir', '', [], 41],
'proc_open': ['proc_open', '', [], 2],
'ksort': ['ksort', '', [], 153],
'chmod': ['chmod', '', [], 50],
'explode': ['explode', '', [], 1572],
'imagedestroy': ['imagedestroy', '', [], 19],
'pathinfo': ['pathinfo', '', [], 68],
'exec': ['exec', '', [], 346],
'imagesavealpha': ['imagesavealpha', '', [], 5],
'imagecopy': ['imagecopy', '', [], 2],
'strrpos': ['strrpos', '', [], 75],
'in_array': ['in_array', '', [], 1234],
'rename': ['rename', '', [], 48],
'escapeshellcmd': ['escapeshellcmd', '', [], 7],
'rtrim': ['rtrim', '', [], 165],
'sha1_file': ['sha1_file', '', [], 17],
'imagecopyresampled': ['imagecopyresampled', '', [], 4],
'imagejpeg': ['imagejpeg', '', [], 7],
'is_readable': ['is_readable', '', [], 196],
'imagegif': ['imagegif', '', [], 6],
'substr_count': ['substr_count', '', [], 72],
'imagecolorallocatealpha': ['imagecolorallocatealpha', '', [], 5],
'function_exists': ['function_exists', '', [], 419],
'getcwd': ['getcwd', '', [], 18],
'defined': ['defined', '', [], 4731],
'file': ['file', '', [], 92],
'preg_match_all': ['preg_match_all', '', [], 161],
'escapeshellarg': ['escapeshellarg', '', [], 38],
'array_merge': ['array_merge', '', [], 2944],
'class_exists': ['class_exists', '', [], 279],
'is_dir': ['is_dir', '', [], 211],
'sha1': ['sha1', '', [], 186],
'fclose': ['fclose', '', [], 275],
'ob_start': ['ob_start', '', [], 101],
'ob_get_contents': ['ob_get_contents', '', [], 62],
'unserialize': ['unserialize', '', [], 192],
'ignore_user_abort': ['ignore_user_abort', '', [], 25],
'base64_decode': ['base64_decode', '', [], 92],
'ob_end_clean': ['ob_end_clean', '', [], 76],
'serialize': ['serialize', '', [], 282],
'tempnam': ['tempnam', '', [], 31],
'copy': ['copy', '', [], 49],
'preg_match': ['preg_match', '', [], 1286],
'stream_get_contents': ['stream_get_contents', '', [], 23],
'array_unique': ['array_unique', '', [], 171]};
CLASS_DATA={
'core_text': ['core_text', 'defines string api\'s for manipulating strings ', [['lib/classes','text.php',27]], 566],
'stored_file_creation_exception': ['stored_file_creation_exception', 'Can not create file exception. ', [['lib/filestorage','file_exceptions.php',48]], 4],
'file_exception': ['file_exception', 'Basic file related exception class. ', [['lib/filestorage','file_exceptions.php',27]], 92],
'file_pool_content_exception': ['file_pool_content_exception', 'Hash file content problem exception. ', [['lib/filestorage','file_exceptions.php',99]], 2],
'context_system': ['context_system', 'System context class ', [['lib','accesslib.php',6157]], 1147],
'file_reference_exception': ['file_reference_exception', 'Problem with records in the {files_reference} table. ', [['lib/filestorage','file_exceptions.php',120]], 4],
'coding_exception': ['coding_exception', 'Exception indicating programming error, must be fixed by a programer. For example a core API might throw this type of exception if a plugin calls it incorrectly. ', [['lib','setuplib.php',239]], 1200],
'core_collator': ['core_collator', 'A collator class with static methods that can be used for sorting. ', [['lib/classes','collator.php',28]], 152],
'stored_file': ['stored_file', 'Class representing local files stored in a sha1 file pool. ', [['lib/filestorage','stored_file.php',30]], 14],
'file_storage': ['file_storage', 'File storage class used for low level access to stored files. ', [['lib/filestorage','file_storage.php',30]], 21]};
CONST_DATA={
'PARAM_URL': ['PARAM_URL', '', [['lib','moodlelib.php',239]], 165],
'MUST_EXIST': ['MUST_EXIST', '', [['lib','dmllib.php',52]], 1384],
'IGNORE_MISSING': ['IGNORE_MISSING', '', [['lib','dmllib.php',48]], 215],
'PARAM_FILE': ['PARAM_FILE', '', [['lib','moodlelib.php',133]], 121],
'IGNORE_MULTIPLE': ['IGNORE_MULTIPLE', '', [['lib','dmllib.php',50]], 43],
'CONTEXT_USER': ['CONTEXT_USER', '', [['lib','accesslib.php',144]], 123],
'PARAM_PATH': ['PARAM_PATH', '', [['lib','moodlelib.php',178]], 175],
'NULL_NOT_ALLOWED': ['NULL_NOT_ALLOWED', '', [['lib','moodlelib.php',347]], 88],
'PARAM_INT': ['PARAM_INT', '', [['lib','moodlelib.php',156]], 3812],
'PARAM_COMPONENT': ['PARAM_COMPONENT', '', [['lib','moodlelib.php',310]], 113],
'PARAM_TEXT': ['PARAM_TEXT', '', [['lib','moodlelib.php',228]], 542],
'PARAM_AREA': ['PARAM_AREA', '', [['lib','moodlelib.php',317]], 47],
'DEBUG_DEVELOPER': ['DEBUG_DEVELOPER', '', [['lib','setuplib.php',40]], 736],
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',140],['','install.php',93],['lib','setup.php',391]], 4153]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
