<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /lib/accesslib.php source</title>
    <link rel="stylesheet" href="../sample.css" type="text/css">
    <link rel="stylesheet" href="../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu May 28 19:17:31 2015 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../';
subdir='lib';
filename='accesslib.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/lib/</a> -> <a href="accesslib.php.html">accesslib.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="accesslib.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="accesslib.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * This file contains functions for managing user access</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * &lt;b&gt;Public API vs internals&lt;/b&gt;</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> *</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * General users probably only care about</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> *</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> * Context handling</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> * - context_course::instance($courseid), context_module::instance($cm-&gt;id), context_coursecat::instance($catid)</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment"> * - context::instance_by_id($contextid)</span>
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment"> * - $context-&gt;get_parent_contexts();</span>
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment"> * - $context-&gt;get_child_contexts();</span>
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment"> *</span>
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment"> * Whether the user can do something...</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> * - has_capability()</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> * - has_any_capability()</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment"> * - has_all_capabilities()</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment"> * - require_capability()</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment"> * - require_login() (from moodlelib)</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment"> * - is_enrolled()</span>
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment"> * - is_viewing()</span>
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment"> * - is_guest()</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment"> * - is_siteadmin()</span>
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment"> * - isguestuser()</span>
<a name="l41"><span class="linenum">  41</span></a>  <span class="comment"> * - isloggedin()</span>
<a name="l42"><span class="linenum">  42</span></a>  <span class="comment"> *</span>
<a name="l43"><span class="linenum">  43</span></a>  <span class="comment"> * What courses has this user access to?</span>
<a name="l44"><span class="linenum">  44</span></a>  <span class="comment"> * - get_enrolled_users()</span>
<a name="l45"><span class="linenum">  45</span></a>  <span class="comment"> *</span>
<a name="l46"><span class="linenum">  46</span></a>  <span class="comment"> * What users can do X in this context?</span>
<a name="l47"><span class="linenum">  47</span></a>  <span class="comment"> * - get_enrolled_users() - at and bellow course context</span>
<a name="l48"><span class="linenum">  48</span></a>  <span class="comment"> * - get_users_by_capability() - above course context</span>
<a name="l49"><span class="linenum">  49</span></a>  <span class="comment"> *</span>
<a name="l50"><span class="linenum">  50</span></a>  <span class="comment"> * Modify roles</span>
<a name="l51"><span class="linenum">  51</span></a>  <span class="comment"> * - role_assign()</span>
<a name="l52"><span class="linenum">  52</span></a>  <span class="comment"> * - role_unassign()</span>
<a name="l53"><span class="linenum">  53</span></a>  <span class="comment"> * - role_unassign_all()</span>
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment"> *</span>
<a name="l55"><span class="linenum">  55</span></a>  <span class="comment"> * Advanced - for internal use only</span>
<a name="l56"><span class="linenum">  56</span></a>  <span class="comment"> * - load_all_capabilities()</span>
<a name="l57"><span class="linenum">  57</span></a>  <span class="comment"> * - reload_all_capabilities()</span>
<a name="l58"><span class="linenum">  58</span></a>  <span class="comment"> * - has_capability_in_accessdata()</span>
<a name="l59"><span class="linenum">  59</span></a>  <span class="comment"> * - get_user_access_sitewide()</span>
<a name="l60"><span class="linenum">  60</span></a>  <span class="comment"> * - load_course_context()</span>
<a name="l61"><span class="linenum">  61</span></a>  <span class="comment"> * - load_role_access_by_context()</span>
<a name="l62"><span class="linenum">  62</span></a>  <span class="comment"> * - etc.</span>
<a name="l63"><span class="linenum">  63</span></a>  <span class="comment"> *</span>
<a name="l64"><span class="linenum">  64</span></a>  <span class="comment"> * &lt;b&gt;Name conventions&lt;/b&gt;</span>
<a name="l65"><span class="linenum">  65</span></a>  <span class="comment"> *</span>
<a name="l66"><span class="linenum">  66</span></a>  <span class="comment"> * &quot;ctx&quot; means context</span>
<a name="l67"><span class="linenum">  67</span></a>  <span class="comment"> *</span>
<a name="l68"><span class="linenum">  68</span></a>  <span class="comment"> * &lt;b&gt;accessdata&lt;/b&gt;</span>
<a name="l69"><span class="linenum">  69</span></a>  <span class="comment"> *</span>
<a name="l70"><span class="linenum">  70</span></a>  <span class="comment"> * Access control data is held in the &quot;accessdata&quot; array</span>
<a name="l71"><span class="linenum">  71</span></a>  <span class="comment"> * which - for the logged-in user, will be in $USER-&gt;access</span>
<a name="l72"><span class="linenum">  72</span></a>  <span class="comment"> *</span>
<a name="l73"><span class="linenum">  73</span></a>  <span class="comment"> * For other users can be generated and passed around (but may also be cached</span>
<a name="l74"><span class="linenum">  74</span></a>  <span class="comment"> * against userid in $ACCESSLIB_PRIVATE-&gt;accessdatabyuser).</span>
<a name="l75"><span class="linenum">  75</span></a>  <span class="comment"> *</span>
<a name="l76"><span class="linenum">  76</span></a>  <span class="comment"> * $accessdata is a multidimensional array, holding</span>
<a name="l77"><span class="linenum">  77</span></a>  <span class="comment"> * role assignments (RAs), role-capabilities-perm sets</span>
<a name="l78"><span class="linenum">  78</span></a>  <span class="comment"> * (role defs) and a list of courses we have loaded</span>
<a name="l79"><span class="linenum">  79</span></a>  <span class="comment"> * data for.</span>
<a name="l80"><span class="linenum">  80</span></a>  <span class="comment"> *</span>
<a name="l81"><span class="linenum">  81</span></a>  <span class="comment"> * Things are keyed on &quot;contextpaths&quot; (the path field of</span>
<a name="l82"><span class="linenum">  82</span></a>  <span class="comment"> * the context table) for fast walking up/down the tree.</span>
<a name="l83"><span class="linenum">  83</span></a>  <span class="comment"> * &lt;code&gt;</span>
<a name="l84"><span class="linenum">  84</span></a>  <span class="comment"> * $accessdata['ra'][$contextpath] = array($roleid=&gt;$roleid)</span>
<a name="l85"><span class="linenum">  85</span></a>  <span class="comment"> *                  [$contextpath] = array($roleid=&gt;$roleid)</span>
<a name="l86"><span class="linenum">  86</span></a>  <span class="comment"> *                  [$contextpath] = array($roleid=&gt;$roleid)</span>
<a name="l87"><span class="linenum">  87</span></a>  <span class="comment"> * &lt;/code&gt;</span>
<a name="l88"><span class="linenum">  88</span></a>  <span class="comment"> *</span>
<a name="l89"><span class="linenum">  89</span></a>  <span class="comment"> * Role definitions are stored like this</span>
<a name="l90"><span class="linenum">  90</span></a>  <span class="comment"> * (no cap merge is done - so it's compact)</span>
<a name="l91"><span class="linenum">  91</span></a>  <span class="comment"> *</span>
<a name="l92"><span class="linenum">  92</span></a>  <span class="comment"> * &lt;code&gt;</span>
<a name="l93"><span class="linenum">  93</span></a>  <span class="comment"> * $accessdata['rdef'][&quot;$contextpath:$roleid&quot;]['mod/forum:viewpost'] = 1</span>
<a name="l94"><span class="linenum">  94</span></a>  <span class="comment"> *                                            ['mod/forum:editallpost'] = -1</span>
<a name="l95"><span class="linenum">  95</span></a>  <span class="comment"> *                                            ['mod/forum:startdiscussion'] = -1000</span>
<a name="l96"><span class="linenum">  96</span></a>  <span class="comment"> * &lt;/code&gt;</span>
<a name="l97"><span class="linenum">  97</span></a>  <span class="comment"> *</span>
<a name="l98"><span class="linenum">  98</span></a>  <span class="comment"> * See how has_capability_in_accessdata() walks up the tree.</span>
<a name="l99"><span class="linenum">  99</span></a>  <span class="comment"> *</span>
<a name="l100"><span class="linenum"> 100</span></a>  <span class="comment"> * First we only load rdef and ra down to the course level, but not below.</span>
<a name="l101"><span class="linenum"> 101</span></a>  <span class="comment"> * This keeps accessdata small and compact. Below-the-course ra/rdef</span>
<a name="l102"><span class="linenum"> 102</span></a>  <span class="comment"> * are loaded as needed. We keep track of which courses we have loaded ra/rdef in</span>
<a name="l103"><span class="linenum"> 103</span></a>  <span class="comment"> * &lt;code&gt;</span>
<a name="l104"><span class="linenum"> 104</span></a>  <span class="comment"> * $accessdata['loaded'] = array($courseid1=&gt;1, $courseid2=&gt;1)</span>
<a name="l105"><span class="linenum"> 105</span></a>  <span class="comment"> * &lt;/code&gt;</span>
<a name="l106"><span class="linenum"> 106</span></a>  <span class="comment"> *</span>
<a name="l107"><span class="linenum"> 107</span></a>  <span class="comment"> * &lt;b&gt;Stale accessdata&lt;/b&gt;</span>
<a name="l108"><span class="linenum"> 108</span></a>  <span class="comment"> *</span>
<a name="l109"><span class="linenum"> 109</span></a>  <span class="comment"> * For the logged-in user, accessdata is long-lived.</span>
<a name="l110"><span class="linenum"> 110</span></a>  <span class="comment"> *</span>
<a name="l111"><span class="linenum"> 111</span></a>  <span class="comment"> * On each pageload we load $ACCESSLIB_PRIVATE-&gt;dirtycontexts which lists</span>
<a name="l112"><span class="linenum"> 112</span></a>  <span class="comment"> * context paths affected by changes. Any check at-or-below</span>
<a name="l113"><span class="linenum"> 113</span></a>  <span class="comment"> * a dirty context will trigger a transparent reload of accessdata.</span>
<a name="l114"><span class="linenum"> 114</span></a>  <span class="comment"> *</span>
<a name="l115"><span class="linenum"> 115</span></a>  <span class="comment"> * Changes at the system level will force the reload for everyone.</span>
<a name="l116"><span class="linenum"> 116</span></a>  <span class="comment"> *</span>
<a name="l117"><span class="linenum"> 117</span></a>  <span class="comment"> * &lt;b&gt;Default role caps&lt;/b&gt;</span>
<a name="l118"><span class="linenum"> 118</span></a>  <span class="comment"> * The default role assignment is not in the DB, so we</span>
<a name="l119"><span class="linenum"> 119</span></a>  <span class="comment"> * add it manually to accessdata.</span>
<a name="l120"><span class="linenum"> 120</span></a>  <span class="comment"> *</span>
<a name="l121"><span class="linenum"> 121</span></a>  <span class="comment"> * This means that functions that work directly off the</span>
<a name="l122"><span class="linenum"> 122</span></a>  <span class="comment"> * DB need to ensure that the default role caps</span>
<a name="l123"><span class="linenum"> 123</span></a>  <span class="comment"> * are dealt with appropriately.</span>
<a name="l124"><span class="linenum"> 124</span></a>  <span class="comment"> *</span>
<a name="l125"><span class="linenum"> 125</span></a>  <span class="comment"> * @package    core_access</span>
<a name="l126"><span class="linenum"> 126</span></a>  <span class="comment"> * @copyright  1999 onwards Martin Dougiamas  http://dougiamas.com</span>
<a name="l127"><span class="linenum"> 127</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l128"><span class="linenum"> 128</span></a>  <span class="comment"> */</span>
<a name="l129"><span class="linenum"> 129</span></a>  
<a name="l130"><span class="linenum"> 130</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l131"><span class="linenum"> 131</span></a>  
<a name="l132"><span class="linenum"> 132</span></a>  <span class="comment">/** No capability change */</span>
<a name="l133"><span class="linenum"> 133</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('CAP_INHERIT')" href="../_constants/CAP_INHERIT.html" onMouseOver="constPopup(event,'CAP_INHERIT')">CAP_INHERIT</a>', 0);
<a name="l134"><span class="linenum"> 134</span></a>  <span class="comment">/** Allow permission, overrides CAP_PREVENT defined in parent contexts */</span>
<a name="l135"><span class="linenum"> 135</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('CAP_ALLOW')" href="../_constants/CAP_ALLOW.html" onMouseOver="constPopup(event,'CAP_ALLOW')">CAP_ALLOW</a>', 1);
<a name="l136"><span class="linenum"> 136</span></a>  <span class="comment">/** Prevent permission, overrides CAP_ALLOW defined in parent contexts */</span>
<a name="l137"><span class="linenum"> 137</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('CAP_PREVENT')" href="../_constants/CAP_PREVENT.html" onMouseOver="constPopup(event,'CAP_PREVENT')">CAP_PREVENT</a>', -1);
<a name="l138"><span class="linenum"> 138</span></a>  <span class="comment">/** Prohibit permission, overrides everything in current and child contexts */</span>
<a name="l139"><span class="linenum"> 139</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('CAP_PROHIBIT')" href="../_constants/CAP_PROHIBIT.html" onMouseOver="constPopup(event,'CAP_PROHIBIT')">CAP_PROHIBIT</a>', -1000);
<a name="l140"><span class="linenum"> 140</span></a>  
<a name="l141"><span class="linenum"> 141</span></a>  <span class="comment">/** System context level - only one instance in every system */</span>
<a name="l142"><span class="linenum"> 142</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('CONTEXT_SYSTEM')" href="../_constants/CONTEXT_SYSTEM.html" onMouseOver="constPopup(event,'CONTEXT_SYSTEM')">CONTEXT_SYSTEM</a>', 10);
<a name="l143"><span class="linenum"> 143</span></a>  <span class="comment">/** User context level -  one instance for each user describing what others can do to user */</span>
<a name="l144"><span class="linenum"> 144</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('CONTEXT_USER')" href="../_constants/CONTEXT_USER.html" onMouseOver="constPopup(event,'CONTEXT_USER')">CONTEXT_USER</a>', 30);
<a name="l145"><span class="linenum"> 145</span></a>  <span class="comment">/** Course category context level - one instance for each category */</span>
<a name="l146"><span class="linenum"> 146</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>', 40);
<a name="l147"><span class="linenum"> 147</span></a>  <span class="comment">/** Course context level - one instances for each course */</span>
<a name="l148"><span class="linenum"> 148</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>', 50);
<a name="l149"><span class="linenum"> 149</span></a>  <span class="comment">/** Course module context level - one instance for each course module */</span>
<a name="l150"><span class="linenum"> 150</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>', 70);
<a name="l151"><span class="linenum"> 151</span></a>  <span class="comment">/**</span>
<a name="l152"><span class="linenum"> 152</span></a>  <span class="comment"> * Block context level - one instance for each block, sticky blocks are tricky</span>
<a name="l153"><span class="linenum"> 153</span></a>  <span class="comment"> * because ppl think they should be able to override them at lower contexts.</span>
<a name="l154"><span class="linenum"> 154</span></a>  <span class="comment"> * Any other context level instance can be parent of block context.</span>
<a name="l155"><span class="linenum"> 155</span></a>  <span class="comment"> */</span>
<a name="l156"><span class="linenum"> 156</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('CONTEXT_BLOCK')" href="../_constants/CONTEXT_BLOCK.html" onMouseOver="constPopup(event,'CONTEXT_BLOCK')">CONTEXT_BLOCK</a>', 80);
<a name="l157"><span class="linenum"> 157</span></a>  
<a name="l158"><span class="linenum"> 158</span></a>  <span class="comment">/** Capability allow management of trusts - NOT IMPLEMENTED YET - see {@link http://docs.moodle.org/dev/Hardening_new_Roles_system} */</span>
<a name="l159"><span class="linenum"> 159</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('RISK_MANAGETRUST')" href="../_constants/RISK_MANAGETRUST.html" onMouseOver="constPopup(event,'RISK_MANAGETRUST')">RISK_MANAGETRUST</a>', 0x0001);
<a name="l160"><span class="linenum"> 160</span></a>  <span class="comment">/** Capability allows changes in system configuration - see {@link http://docs.moodle.org/dev/Hardening_new_Roles_system} */</span>
<a name="l161"><span class="linenum"> 161</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('RISK_CONFIG')" href="../_constants/RISK_CONFIG.html" onMouseOver="constPopup(event,'RISK_CONFIG')">RISK_CONFIG</a>',      0x0002);
<a name="l162"><span class="linenum"> 162</span></a>  <span class="comment">/** Capability allows user to add scripted content - see {@link http://docs.moodle.org/dev/Hardening_new_Roles_system} */</span>
<a name="l163"><span class="linenum"> 163</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('RISK_XSS')" href="../_constants/RISK_XSS.html" onMouseOver="constPopup(event,'RISK_XSS')">RISK_XSS</a>',         0x0004);
<a name="l164"><span class="linenum"> 164</span></a>  <span class="comment">/** Capability allows access to personal user information - see {@link http://docs.moodle.org/dev/Hardening_new_Roles_system} */</span>
<a name="l165"><span class="linenum"> 165</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('RISK_PERSONAL')" href="../_constants/RISK_PERSONAL.html" onMouseOver="constPopup(event,'RISK_PERSONAL')">RISK_PERSONAL</a>',    0x0008);
<a name="l166"><span class="linenum"> 166</span></a>  <span class="comment">/** Capability allows users to add content others may see - see {@link http://docs.moodle.org/dev/Hardening_new_Roles_system} */</span>
<a name="l167"><span class="linenum"> 167</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('RISK_SPAM')" href="../_constants/RISK_SPAM.html" onMouseOver="constPopup(event,'RISK_SPAM')">RISK_SPAM</a>',        0x0010);
<a name="l168"><span class="linenum"> 168</span></a>  <span class="comment">/** capability allows mass delete of data belonging to other users - see {@link http://docs.moodle.org/dev/Hardening_new_Roles_system} */</span>
<a name="l169"><span class="linenum"> 169</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('RISK_DATALOSS')" href="../_constants/RISK_DATALOSS.html" onMouseOver="constPopup(event,'RISK_DATALOSS')">RISK_DATALOSS</a>',    0x0020);
<a name="l170"><span class="linenum"> 170</span></a>  
<a name="l171"><span class="linenum"> 171</span></a>  <span class="comment">/** rolename displays - the name as defined in the role definition, localised if name empty */</span>
<a name="l172"><span class="linenum"> 172</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('ROLENAME_ORIGINAL')" href="../_constants/ROLENAME_ORIGINAL.html" onMouseOver="constPopup(event,'ROLENAME_ORIGINAL')">ROLENAME_ORIGINAL</a>', 0);
<a name="l173"><span class="linenum"> 173</span></a>  <span class="comment">/** rolename displays - the name as defined by a role alias at the course level, falls back to ROLENAME_ORIGINAL if alias not present */</span>
<a name="l174"><span class="linenum"> 174</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('ROLENAME_ALIAS')" href="../_constants/ROLENAME_ALIAS.html" onMouseOver="constPopup(event,'ROLENAME_ALIAS')">ROLENAME_ALIAS</a>', 1);
<a name="l175"><span class="linenum"> 175</span></a>  <span class="comment">/** rolename displays - Both, like this:  Role alias (Original) */</span>
<a name="l176"><span class="linenum"> 176</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('ROLENAME_BOTH')" href="../_constants/ROLENAME_BOTH.html" onMouseOver="constPopup(event,'ROLENAME_BOTH')">ROLENAME_BOTH</a>', 2);
<a name="l177"><span class="linenum"> 177</span></a>  <span class="comment">/** rolename displays - the name as defined in the role definition and the shortname in brackets */</span>
<a name="l178"><span class="linenum"> 178</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('ROLENAME_ORIGINALANDSHORT')" href="../_constants/ROLENAME_ORIGINALANDSHORT.html" onMouseOver="constPopup(event,'ROLENAME_ORIGINALANDSHORT')">ROLENAME_ORIGINALANDSHORT</a>', 3);
<a name="l179"><span class="linenum"> 179</span></a>  <span class="comment">/** rolename displays - the name as defined by a role alias, in raw form suitable for editing */</span>
<a name="l180"><span class="linenum"> 180</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('ROLENAME_ALIAS_RAW')" href="../_constants/ROLENAME_ALIAS_RAW.html" onMouseOver="constPopup(event,'ROLENAME_ALIAS_RAW')">ROLENAME_ALIAS_RAW</a>', 4);
<a name="l181"><span class="linenum"> 181</span></a>  <span class="comment">/** rolename displays - the name is simply short role name */</span>
<a name="l182"><span class="linenum"> 182</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('ROLENAME_SHORT')" href="../_constants/ROLENAME_SHORT.html" onMouseOver="constPopup(event,'ROLENAME_SHORT')">ROLENAME_SHORT</a>', 5);
<a name="l183"><span class="linenum"> 183</span></a>  
<a name="l184"><span class="linenum"> 184</span></a>  if (!<a class="phpfunction" onClick="logFunction('defined')" href="../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('CONTEXT_CACHE_MAX_SIZE')" href="../_constants/CONTEXT_CACHE_MAX_SIZE.html" onMouseOver="constPopup(event,'CONTEXT_CACHE_MAX_SIZE')">CONTEXT_CACHE_MAX_SIZE</a>')) {
<a name="l185"><span class="linenum"> 185</span></a>  <span class="comment">    /** maximum size of context cache - it is possible to tweak this config.php or in any script before inclusion of context.php */</span>
<a name="l186"><span class="linenum"> 186</span></a>      <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('CONTEXT_CACHE_MAX_SIZE')" href="../_constants/CONTEXT_CACHE_MAX_SIZE.html" onMouseOver="constPopup(event,'CONTEXT_CACHE_MAX_SIZE')">CONTEXT_CACHE_MAX_SIZE</a>', 2500);
<a name="l187"><span class="linenum"> 187</span></a>  }
<a name="l188"><span class="linenum"> 188</span></a>  
<a name="l189"><span class="linenum"> 189</span></a>  <span class="comment">/**</span>
<a name="l190"><span class="linenum"> 190</span></a>  <span class="comment"> * Although this looks like a global variable, it isn't really.</span>
<a name="l191"><span class="linenum"> 191</span></a>  <span class="comment"> *</span>
<a name="l192"><span class="linenum"> 192</span></a>  <span class="comment"> * It is just a private implementation detail to accesslib that MUST NOT be used elsewhere.</span>
<a name="l193"><span class="linenum"> 193</span></a>  <span class="comment"> * It is used to cache various bits of data between function calls for performance reasons.</span>
<a name="l194"><span class="linenum"> 194</span></a>  <span class="comment"> * Sadly, a PHP global variable is the only way to implement this, without rewriting everything</span>
<a name="l195"><span class="linenum"> 195</span></a>  <span class="comment"> * as methods of a class, instead of functions.</span>
<a name="l196"><span class="linenum"> 196</span></a>  <span class="comment"> *</span>
<a name="l197"><span class="linenum"> 197</span></a>  <span class="comment"> * @access private</span>
<a name="l198"><span class="linenum"> 198</span></a>  <span class="comment"> * @global stdClass $ACCESSLIB_PRIVATE</span>
<a name="l199"><span class="linenum"> 199</span></a>  <span class="comment"> * @name $ACCESSLIB_PRIVATE</span>
<a name="l200"><span class="linenum"> 200</span></a>  <span class="comment"> */</span>
<a name="l201"><span class="linenum"> 201</span></a>  global <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>;
<a name="l202"><span class="linenum"> 202</span></a>  <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a> = new stdClass();
<a name="l203"><span class="linenum"> 203</span></a>  <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('dirtycontexts')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/dirtycontexts.html">dirtycontexts</a>    = null;    <span class="comment">// Dirty contexts cache, loaded from DB once per page</span>
<a name="l204"><span class="linenum"> 204</span></a>  <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('accessdatabyuser')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/accessdatabyuser.html">accessdatabyuser</a> = array(); <span class="comment">// Holds the cache of $accessdata structure for users (including $USER)</span>
<a name="l205"><span class="linenum"> 205</span></a>  <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('rolepermissions')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/rolepermissions.html">rolepermissions</a>  = array(); <span class="comment">// role permissions cache - helps a lot with mem usage</span>
<a name="l206"><span class="linenum"> 206</span></a>  <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('capabilities')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/capabilities.html">capabilities</a>     = null;    <span class="comment">// detailed information about the capabilities</span>
<a name="l207"><span class="linenum"> 207</span></a>  
<a name="l208"><span class="linenum"> 208</span></a>  <span class="comment">/**</span>
<a name="l209"><span class="linenum"> 209</span></a>  <span class="comment"> * Clears accesslib's private caches. ONLY BE USED BY UNIT TESTS</span>
<a name="l210"><span class="linenum"> 210</span></a>  <span class="comment"> *</span>
<a name="l211"><span class="linenum"> 211</span></a>  <span class="comment"> * This method should ONLY BE USED BY UNIT TESTS. It clears all of</span>
<a name="l212"><span class="linenum"> 212</span></a>  <span class="comment"> * accesslib's private caches. You need to do this before setting up test data,</span>
<a name="l213"><span class="linenum"> 213</span></a>  <span class="comment"> * and also at the end of the tests.</span>
<a name="l214"><span class="linenum"> 214</span></a>  <span class="comment"> *</span>
<a name="l215"><span class="linenum"> 215</span></a>  <span class="comment"> * @access private</span>
<a name="l216"><span class="linenum"> 216</span></a>  <span class="comment"> * @return void</span>
<a name="l217"><span class="linenum"> 217</span></a>  <span class="comment"> */</span>
<a name="l218"><span class="linenum"> 218</span></a>  function <a class="function" onClick="logFunction('accesslib_clear_all_caches_for_unit_testing')" href="../_functions/accesslib_clear_all_caches_for_unit_testing.html" onMouseOver="funcPopup(event,'accesslib_clear_all_caches_for_unit_testing')">accesslib_clear_all_caches_for_unit_testing</a>() {
<a name="l219"><span class="linenum"> 219</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l220"><span class="linenum"> 220</span></a>      if (!<a class="constant" onClick="logConstant('PHPUNIT_TEST')" href="../_constants/PHPUNIT_TEST.html" onMouseOver="constPopup(event,'PHPUNIT_TEST')">PHPUNIT_TEST</a>) {
<a name="l221"><span class="linenum"> 221</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('You must not call clear_all_caches outside of unit tests.');
<a name="l222"><span class="linenum"> 222</span></a>      }
<a name="l223"><span class="linenum"> 223</span></a>  
<a name="l224"><span class="linenum"> 224</span></a>      <a class="function" onClick="logFunction('accesslib_clear_all_caches')" href="../_functions/accesslib_clear_all_caches.html" onMouseOver="funcPopup(event,'accesslib_clear_all_caches')">accesslib_clear_all_caches</a>(true);
<a name="l225"><span class="linenum"> 225</span></a>  
<a name="l226"><span class="linenum"> 226</span></a>      unset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>);
<a name="l227"><span class="linenum"> 227</span></a>  }
<a name="l228"><span class="linenum"> 228</span></a>  
<a name="l229"><span class="linenum"> 229</span></a>  <span class="comment">/**</span>
<a name="l230"><span class="linenum"> 230</span></a>  <span class="comment"> * Clears accesslib's private caches. ONLY BE USED FROM THIS LIBRARY FILE!</span>
<a name="l231"><span class="linenum"> 231</span></a>  <span class="comment"> *</span>
<a name="l232"><span class="linenum"> 232</span></a>  <span class="comment"> * This reset does not touch global $USER.</span>
<a name="l233"><span class="linenum"> 233</span></a>  <span class="comment"> *</span>
<a name="l234"><span class="linenum"> 234</span></a>  <span class="comment"> * @access private</span>
<a name="l235"><span class="linenum"> 235</span></a>  <span class="comment"> * @param bool $resetcontexts</span>
<a name="l236"><span class="linenum"> 236</span></a>  <span class="comment"> * @return void</span>
<a name="l237"><span class="linenum"> 237</span></a>  <span class="comment"> */</span>
<a name="l238"><span class="linenum"> 238</span></a>  function <a class="function" onClick="logFunction('accesslib_clear_all_caches')" href="../_functions/accesslib_clear_all_caches.html" onMouseOver="funcPopup(event,'accesslib_clear_all_caches')">accesslib_clear_all_caches</a>(<a class="var it28792" onMouseOver="hilite(28792)" onMouseOut="lolite()" onClick="logVariable('resetcontexts')" href="../_variables/resetcontexts.html">$resetcontexts</a>) {
<a name="l239"><span class="linenum"> 239</span></a>      global <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>;
<a name="l240"><span class="linenum"> 240</span></a>  
<a name="l241"><span class="linenum"> 241</span></a>      <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('dirtycontexts')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/dirtycontexts.html">dirtycontexts</a>    = null;
<a name="l242"><span class="linenum"> 242</span></a>      <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('accessdatabyuser')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/accessdatabyuser.html">accessdatabyuser</a> = array();
<a name="l243"><span class="linenum"> 243</span></a>      <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('rolepermissions')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/rolepermissions.html">rolepermissions</a>  = array();
<a name="l244"><span class="linenum"> 244</span></a>      <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('capabilities')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/capabilities.html">capabilities</a>     = null;
<a name="l245"><span class="linenum"> 245</span></a>  
<a name="l246"><span class="linenum"> 246</span></a>      if (<a class="var it28792" onMouseOver="hilite(28792)" onMouseOut="lolite()" onClick="logVariable('resetcontexts')" href="../_variables/resetcontexts.html">$resetcontexts</a>) {
<a name="l247"><span class="linenum"> 247</span></a>          <a class="class" onClick="logClass('context_helper')" href="../_classes/context_helper.html" onMouseOver="classPopup(event,'context_helper')">context_helper</a>::<a class="function" onClick="logFunction('reset_caches')" href="../_functions/reset_caches.html" onMouseOver="funcPopup(event,'reset_caches')">reset_caches</a>();
<a name="l248"><span class="linenum"> 248</span></a>      }
<a name="l249"><span class="linenum"> 249</span></a>  }
<a name="l250"><span class="linenum"> 250</span></a>  
<a name="l251"><span class="linenum"> 251</span></a>  <span class="comment">/**</span>
<a name="l252"><span class="linenum"> 252</span></a>  <span class="comment"> * Gets the accessdata for role &quot;sitewide&quot; (system down to course)</span>
<a name="l253"><span class="linenum"> 253</span></a>  <span class="comment"> *</span>
<a name="l254"><span class="linenum"> 254</span></a>  <span class="comment"> * @access private</span>
<a name="l255"><span class="linenum"> 255</span></a>  <span class="comment"> * @param int $roleid</span>
<a name="l256"><span class="linenum"> 256</span></a>  <span class="comment"> * @return array</span>
<a name="l257"><span class="linenum"> 257</span></a>  <span class="comment"> */</span>
<a name="l258"><span class="linenum"> 258</span></a>  function <a class="function" onClick="logFunction('get_role_access')" href="../_functions/get_role_access.html" onMouseOver="funcPopup(event,'get_role_access')">get_role_access</a>(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>) {
<a name="l259"><span class="linenum"> 259</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>;
<a name="l260"><span class="linenum"> 260</span></a>  
<a name="l261"><span class="linenum"> 261</span></a>      <span class="comment">/* Get it in 1 DB query...</span>
<a name="l262"><span class="linenum"> 262</span></a>  <span class="comment">     * - relevant role caps at the root and down</span>
<a name="l263"><span class="linenum"> 263</span></a>  <span class="comment">     *   to the course level - but not below</span>
<a name="l264"><span class="linenum"> 264</span></a>  <span class="comment">     */</span>
<a name="l265"><span class="linenum"> 265</span></a>  
<a name="l266"><span class="linenum"> 266</span></a>  <span class="comment">    //TODO: MUC - this could be cached in shared memory to speed up first page loading, web crawlers, etc.</span>
<a name="l267"><span class="linenum"> 267</span></a>  
<a name="l268"><span class="linenum"> 268</span></a>      <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a> = <a class="function" onClick="logFunction('get_empty_accessdata')" href="../_functions/get_empty_accessdata.html" onMouseOver="funcPopup(event,'get_empty_accessdata')">get_empty_accessdata</a>();
<a name="l269"><span class="linenum"> 269</span></a>  
<a name="l270"><span class="linenum"> 270</span></a>      <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['ra']['/'.<a class="constant" onClick="logConstant('SYSCONTEXTID')" href="../_constants/SYSCONTEXTID.html" onMouseOver="constPopup(event,'SYSCONTEXTID')">SYSCONTEXTID</a>] = array((int)<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a> =&gt; (int)<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>);
<a name="l271"><span class="linenum"> 271</span></a>  
<a name="l272"><span class="linenum"> 272</span></a>  <span class="comment">    // Overrides for the role IN ANY CONTEXTS down to COURSE - not below -.</span>
<a name="l273"><span class="linenum"> 273</span></a>  
<a name="l274"><span class="linenum"> 274</span></a>      <span class="comment">/*</span>
<a name="l275"><span class="linenum"> 275</span></a>  <span class="comment">    $sql = &quot;SELECT ctx.path,</span>
<a name="l276"><span class="linenum"> 276</span></a>  <span class="comment">                   rc.capability, rc.permission</span>
<a name="l277"><span class="linenum"> 277</span></a>  <span class="comment">              FROM {context} ctx</span>
<a name="l278"><span class="linenum"> 278</span></a>  <span class="comment">              JOIN {role_capabilities} rc ON rc.contextid = ctx.id</span>
<a name="l279"><span class="linenum"> 279</span></a>  <span class="comment">         LEFT JOIN {context} cctx</span>
<a name="l280"><span class="linenum"> 280</span></a>  <span class="comment">                   ON (cctx.contextlevel = &quot;.CONTEXT_COURSE.&quot; AND ctx.path LIKE &quot;.$DB-&gt;sql_concat('cctx.path',&quot;'/%'&quot;).&quot;)</span>
<a name="l281"><span class="linenum"> 281</span></a>  <span class="comment">             WHERE rc.roleid = ? AND cctx.id IS NULL&quot;;</span>
<a name="l282"><span class="linenum"> 282</span></a>  <span class="comment">    $params = array($roleid);</span>
<a name="l283"><span class="linenum"> 283</span></a>  <span class="comment">    */</span>
<a name="l284"><span class="linenum"> 284</span></a>  
<a name="l285"><span class="linenum"> 285</span></a>  <span class="comment">    // Note: the commented out query is 100% accurate but slow, so let's cheat instead by hardcoding the blocks mess directly.</span>
<a name="l286"><span class="linenum"> 286</span></a>  
<a name="l287"><span class="linenum"> 287</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT COALESCE(ctx.path, bctx.path) AS path, rc.capability, rc.permission
<a name="l288"><span class="linenum"> 288</span></a>                FROM {role_capabilities} rc
<a name="l289"><span class="linenum"> 289</span></a>           LEFT JOIN {context} ctx <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (ctx.id = rc.contextid AND ctx.contextlevel &lt;= &quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>.&quot;)
<a name="l290"><span class="linenum"> 290</span></a>           LEFT <a class="function" onClick="logFunction('JOIN')" href="../_functions/join.html" onMouseOver="funcPopup(event,'join')">JOIN</a> ({context} bctx
<a name="l291"><span class="linenum"> 291</span></a>                      JOIN {block_instances} bi <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (bi.id = bctx.instanceid)
<a name="l292"><span class="linenum"> 292</span></a>                      JOIN {context} pctx <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (pctx.id = bi.parentcontextid AND pctx.contextlevel &lt; &quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>.&quot;)
<a name="l293"><span class="linenum"> 293</span></a>                     ) <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (bctx.id = rc.contextid AND bctx.contextlevel = &quot;.<a class="constant" onClick="logConstant('CONTEXT_BLOCK')" href="../_constants/CONTEXT_BLOCK.html" onMouseOver="constPopup(event,'CONTEXT_BLOCK')">CONTEXT_BLOCK</a>.&quot;)
<a name="l294"><span class="linenum"> 294</span></a>               WHERE rc.roleid = :roleid AND (ctx.id IS NOT NULL OR bctx.id IS NOT NULL)&quot;;
<a name="l295"><span class="linenum"> 295</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array('roleid'=&gt;<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>);
<a name="l296"><span class="linenum"> 296</span></a>  
<a name="l297"><span class="linenum"> 297</span></a>  <span class="comment">    // we need extra caching in CLI scripts and cron</span>
<a name="l298"><span class="linenum"> 298</span></a>      <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l299"><span class="linenum"> 299</span></a>      foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> as <a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>) {
<a name="l300"><span class="linenum"> 300</span></a>          <a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a> = &quot;{<a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>-&gt;<a onClick="logVariable('path')" class="var it40976" onMouseOver="hilite(40976)" onMouseOut="lolite()" href="../_variables/path.html">path</a>}:{<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>}&quot;;
<a name="l301"><span class="linenum"> 301</span></a>          <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rdef'][<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>][<a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>-&gt;<a onClick="logVariable('capability')" class="var it40976" onMouseOver="hilite(40976)" onMouseOut="lolite()" href="../_variables/capability.html">capability</a>] = (int)<a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>-&gt;<a onClick="logVariable('permission')" class="var it40976" onMouseOver="hilite(40976)" onMouseOut="lolite()" href="../_variables/permission.html">permission</a>;
<a name="l302"><span class="linenum"> 302</span></a>      }
<a name="l303"><span class="linenum"> 303</span></a>      <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l304"><span class="linenum"> 304</span></a>  
<a name="l305"><span class="linenum"> 305</span></a>  <span class="comment">    // share the role definitions</span>
<a name="l306"><span class="linenum"> 306</span></a>      foreach (<a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rdef'] as <a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>=&gt;<a class="var it1136" onMouseOver="hilite(1136)" onMouseOut="lolite()" onClick="logVariable('unused')" href="../_variables/unused.html">$unused</a>) {
<a name="l307"><span class="linenum"> 307</span></a>          if (!isset(<a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('rolepermissions')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/rolepermissions.html">rolepermissions</a>[<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>])) {
<a name="l308"><span class="linenum"> 308</span></a>              <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('rolepermissions')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/rolepermissions.html">rolepermissions</a>[<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>] = <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rdef'][<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>];
<a name="l309"><span class="linenum"> 309</span></a>          }
<a name="l310"><span class="linenum"> 310</span></a>          <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rdef_count']++;
<a name="l311"><span class="linenum"> 311</span></a>          <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rdef'][<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>] =&amp; <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('rolepermissions')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/rolepermissions.html">rolepermissions</a>[<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>];
<a name="l312"><span class="linenum"> 312</span></a>      }
<a name="l313"><span class="linenum"> 313</span></a>  
<a name="l314"><span class="linenum"> 314</span></a>      return <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>;
<a name="l315"><span class="linenum"> 315</span></a>  }
<a name="l316"><span class="linenum"> 316</span></a>  
<a name="l317"><span class="linenum"> 317</span></a>  <span class="comment">/**</span>
<a name="l318"><span class="linenum"> 318</span></a>  <span class="comment"> * Get the default guest role, this is used for guest account,</span>
<a name="l319"><span class="linenum"> 319</span></a>  <span class="comment"> * search engine spiders, etc.</span>
<a name="l320"><span class="linenum"> 320</span></a>  <span class="comment"> *</span>
<a name="l321"><span class="linenum"> 321</span></a>  <span class="comment"> * @return stdClass role record</span>
<a name="l322"><span class="linenum"> 322</span></a>  <span class="comment"> */</span>
<a name="l323"><span class="linenum"> 323</span></a>  function <a class="function" onClick="logFunction('get_guest_role')" href="../_functions/get_guest_role.html" onMouseOver="funcPopup(event,'get_guest_role')">get_guest_role</a>() {
<a name="l324"><span class="linenum"> 324</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l325"><span class="linenum"> 325</span></a>  
<a name="l326"><span class="linenum"> 326</span></a>      if (empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('guestroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/guestroleid.html">guestroleid</a>)) {
<a name="l327"><span class="linenum"> 327</span></a>          if (<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('role', array('archetype'=&gt;'guest'))) {
<a name="l328"><span class="linenum"> 328</span></a>              <a class="var it359" onMouseOver="hilite(359)" onMouseOut="lolite()" onClick="logVariable('guestrole')" href="../_variables/guestrole.html">$guestrole</a> = <a class="phpfunction" onClick="logFunction('array_shift')" href="../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>);   <span class="comment">// Pick the first one</span>
<a name="l329"><span class="linenum"> 329</span></a>              <a class="function" onClick="logFunction('set_config')" href="../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('guestroleid', <a class="var it359" onMouseOver="hilite(359)" onMouseOut="lolite()" onClick="logVariable('guestrole')" href="../_variables/guestrole.html">$guestrole</a>-&gt;<a onClick="logVariable('id')" class="var it40977" onMouseOver="hilite(40977)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l330"><span class="linenum"> 330</span></a>              return <a class="var it359" onMouseOver="hilite(359)" onMouseOut="lolite()" onClick="logVariable('guestrole')" href="../_variables/guestrole.html">$guestrole</a>;
<a name="l331"><span class="linenum"> 331</span></a>          } else {
<a name="l332"><span class="linenum"> 332</span></a>              <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Can not find any guest role!');
<a name="l333"><span class="linenum"> 333</span></a>              return false;
<a name="l334"><span class="linenum"> 334</span></a>          }
<a name="l335"><span class="linenum"> 335</span></a>      } else {
<a name="l336"><span class="linenum"> 336</span></a>          if (<a class="var it359" onMouseOver="hilite(359)" onMouseOut="lolite()" onClick="logVariable('guestrole')" href="../_variables/guestrole.html">$guestrole</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('role', array('id'=&gt;<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('guestroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/guestroleid.html">guestroleid</a>))) {
<a name="l337"><span class="linenum"> 337</span></a>              return <a class="var it359" onMouseOver="hilite(359)" onMouseOut="lolite()" onClick="logVariable('guestrole')" href="../_variables/guestrole.html">$guestrole</a>;
<a name="l338"><span class="linenum"> 338</span></a>          } else {
<a name="l339"><span class="linenum"> 339</span></a>  <span class="comment">            // somebody is messing with guest roles, remove incorrect setting and try to find a new one</span>
<a name="l340"><span class="linenum"> 340</span></a>              <a class="function" onClick="logFunction('set_config')" href="../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('guestroleid', '');
<a name="l341"><span class="linenum"> 341</span></a>              return <a class="function" onClick="logFunction('get_guest_role')" href="../_functions/get_guest_role.html" onMouseOver="funcPopup(event,'get_guest_role')">get_guest_role</a>();
<a name="l342"><span class="linenum"> 342</span></a>          }
<a name="l343"><span class="linenum"> 343</span></a>      }
<a name="l344"><span class="linenum"> 344</span></a>  }
<a name="l345"><span class="linenum"> 345</span></a>  
<a name="l346"><span class="linenum"> 346</span></a>  <span class="comment">/**</span>
<a name="l347"><span class="linenum"> 347</span></a>  <span class="comment"> * Check whether a user has a particular capability in a given context.</span>
<a name="l348"><span class="linenum"> 348</span></a>  <span class="comment"> *</span>
<a name="l349"><span class="linenum"> 349</span></a>  <span class="comment"> * For example:</span>
<a name="l350"><span class="linenum"> 350</span></a>  <span class="comment"> *      $context = context_module::instance($cm-&gt;id);</span>
<a name="l351"><span class="linenum"> 351</span></a>  <span class="comment"> *      has_capability('mod/forum:replypost', $context)</span>
<a name="l352"><span class="linenum"> 352</span></a>  <span class="comment"> *</span>
<a name="l353"><span class="linenum"> 353</span></a>  <span class="comment"> * By default checks the capabilities of the current user, but you can pass a</span>
<a name="l354"><span class="linenum"> 354</span></a>  <span class="comment"> * different userid. By default will return true for admin users, but you can override that with the fourth argument.</span>
<a name="l355"><span class="linenum"> 355</span></a>  <span class="comment"> *</span>
<a name="l356"><span class="linenum"> 356</span></a>  <span class="comment"> * Guest and not-logged-in users can never get any dangerous capability - that is any write capability</span>
<a name="l357"><span class="linenum"> 357</span></a>  <span class="comment"> * or capabilities with XSS, config or data loss risks.</span>
<a name="l358"><span class="linenum"> 358</span></a>  <span class="comment"> *</span>
<a name="l359"><span class="linenum"> 359</span></a>  <span class="comment"> * @category access</span>
<a name="l360"><span class="linenum"> 360</span></a>  <span class="comment"> *</span>
<a name="l361"><span class="linenum"> 361</span></a>  <span class="comment"> * @param string $capability the name of the capability to check. For example mod/forum:view</span>
<a name="l362"><span class="linenum"> 362</span></a>  <span class="comment"> * @param context $context the context to check the capability in. You normally get this with instance method of a context class.</span>
<a name="l363"><span class="linenum"> 363</span></a>  <span class="comment"> * @param integer|stdClass $user A user id or object. By default (null) checks the permissions of the current user.</span>
<a name="l364"><span class="linenum"> 364</span></a>  <span class="comment"> * @param boolean $doanything If false, ignores effect of admin role assignment</span>
<a name="l365"><span class="linenum"> 365</span></a>  <span class="comment"> * @return boolean true if the user has this capability. Otherwise false.</span>
<a name="l366"><span class="linenum"> 366</span></a>  <span class="comment"> */</span>
<a name="l367"><span class="linenum"> 367</span></a>  function <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = null, <a class="var it28638" onMouseOver="hilite(28638)" onMouseOut="lolite()" onClick="logVariable('doanything')" href="../_variables/doanything.html">$doanything</a> = true) {
<a name="l368"><span class="linenum"> 368</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it13253" onMouseOver="hilite(13253)" onMouseOut="lolite()" onClick="logVariable('SCRIPT')" href="../_variables/SCRIPT.html">$SCRIPT</a>, <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>;
<a name="l369"><span class="linenum"> 369</span></a>  
<a name="l370"><span class="linenum"> 370</span></a>      if (<a class="function" onClick="logFunction('during_initial_install')" href="../_functions/during_initial_install.html" onMouseOver="funcPopup(event,'during_initial_install')">during_initial_install</a>()) {
<a name="l371"><span class="linenum"> 371</span></a>          if (<a class="var it13253" onMouseOver="hilite(13253)" onMouseOut="lolite()" onClick="logVariable('SCRIPT')" href="../_variables/SCRIPT.html">$SCRIPT</a> === &quot;/<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('admin')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/admin.html">admin</a>/index.php&quot; or <a class="var it13253" onMouseOver="hilite(13253)" onMouseOut="lolite()" onClick="logVariable('SCRIPT')" href="../_variables/SCRIPT.html">$SCRIPT</a> === &quot;/<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('admin')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/admin.html">admin</a>/cli/install.php&quot; or <a class="var it13253" onMouseOver="hilite(13253)" onMouseOut="lolite()" onClick="logVariable('SCRIPT')" href="../_variables/SCRIPT.html">$SCRIPT</a> === &quot;/<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('admin')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/admin.html">admin</a>/cli/install_database.php&quot;) {
<a name="l372"><span class="linenum"> 372</span></a>  <span class="comment">            // we are in an installer - roles can not work yet</span>
<a name="l373"><span class="linenum"> 373</span></a>              return true;
<a name="l374"><span class="linenum"> 374</span></a>          } else {
<a name="l375"><span class="linenum"> 375</span></a>              return false;
<a name="l376"><span class="linenum"> 376</span></a>          }
<a name="l377"><span class="linenum"> 377</span></a>      }
<a name="l378"><span class="linenum"> 378</span></a>  
<a name="l379"><span class="linenum"> 379</span></a>      if (<a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, 'moodle/legacy:') === 0) {
<a name="l380"><span class="linenum"> 380</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Legacy capabilities can not be used any more!');
<a name="l381"><span class="linenum"> 381</span></a>      }
<a name="l382"><span class="linenum"> 382</span></a>  
<a name="l383"><span class="linenum"> 383</span></a>      if (!<a class="phpfunction" onClick="logFunction('is_bool')" href="../_functions/is_bool.html" onMouseOver="phpfuncPopup(event,'is_bool')">is_bool</a>(<a class="var it28638" onMouseOver="hilite(28638)" onMouseOut="lolite()" onClick="logVariable('doanything')" href="../_variables/doanything.html">$doanything</a>)) {
<a name="l384"><span class="linenum"> 384</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Capability parameter &quot;doanything&quot; is wierd, only true or false is allowed. This has to be fixed in code.');
<a name="l385"><span class="linenum"> 385</span></a>      }
<a name="l386"><span class="linenum"> 386</span></a>  
<a name="l387"><span class="linenum"> 387</span></a>  <span class="comment">    // capability must exist</span>
<a name="l388"><span class="linenum"> 388</span></a>      if (!<a class="var it28794" onMouseOver="hilite(28794)" onMouseOut="lolite()" onClick="logVariable('capinfo')" href="../_variables/capinfo.html">$capinfo</a> = <a class="function" onClick="logFunction('get_capability_info')" href="../_functions/get_capability_info.html" onMouseOver="funcPopup(event,'get_capability_info')">get_capability_info</a>(<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>)) {
<a name="l389"><span class="linenum"> 389</span></a>          <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Capability &quot;'.<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>.'&quot; was not found! This has to be fixed in code.');
<a name="l390"><span class="linenum"> 390</span></a>          return false;
<a name="l391"><span class="linenum"> 391</span></a>      }
<a name="l392"><span class="linenum"> 392</span></a>  
<a name="l393"><span class="linenum"> 393</span></a>      if (!isset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>)) {
<a name="l394"><span class="linenum"> 394</span></a>  <span class="comment">        // should never happen</span>
<a name="l395"><span class="linenum"> 395</span></a>          <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a> = 0;
<a name="l396"><span class="linenum"> 396</span></a>          <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Capability check being performed on a user with no ID.', <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l397"><span class="linenum"> 397</span></a>      }
<a name="l398"><span class="linenum"> 398</span></a>  
<a name="l399"><span class="linenum"> 399</span></a>  <span class="comment">    // make sure there is a real user specified</span>
<a name="l400"><span class="linenum"> 400</span></a>      if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> === null) {
<a name="l401"><span class="linenum"> 401</span></a>          <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l402"><span class="linenum"> 402</span></a>      } else {
<a name="l403"><span class="linenum"> 403</span></a>          <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> = <a class="phpfunction" onClick="logFunction('is_object')" href="../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) ? <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a> : <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>;
<a name="l404"><span class="linenum"> 404</span></a>      }
<a name="l405"><span class="linenum"> 405</span></a>  
<a name="l406"><span class="linenum"> 406</span></a>  <span class="comment">    // make sure forcelogin cuts off not-logged-in users if enabled</span>
<a name="l407"><span class="linenum"> 407</span></a>      if (!empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('forcelogin')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/forcelogin.html">forcelogin</a>) and <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> == 0) {
<a name="l408"><span class="linenum"> 408</span></a>          return false;
<a name="l409"><span class="linenum"> 409</span></a>      }
<a name="l410"><span class="linenum"> 410</span></a>  
<a name="l411"><span class="linenum"> 411</span></a>  <span class="comment">    // make sure the guest account and not-logged-in users never get any risky caps no matter what the actual settings are.</span>
<a name="l412"><span class="linenum"> 412</span></a>      if ((<a class="var it28794" onMouseOver="hilite(28794)" onMouseOut="lolite()" onClick="logVariable('capinfo')" href="../_variables/capinfo.html">$capinfo</a>-&gt;<a onClick="logVariable('captype')" class="var it40978" onMouseOver="hilite(40978)" onMouseOut="lolite()" href="../_variables/captype.html">captype</a> === 'write') <a class="function" onClick="logFunction('or')" href="../_functions/or.html" onMouseOver="funcPopup(event,'or')">or</a> (<a class="var it28794" onMouseOver="hilite(28794)" onMouseOut="lolite()" onClick="logVariable('capinfo')" href="../_variables/capinfo.html">$capinfo</a>-&gt;<a onClick="logVariable('riskbitmask')" class="var it40978" onMouseOver="hilite(40978)" onMouseOut="lolite()" href="../_variables/riskbitmask.html">riskbitmask</a> &amp; (<a class="constant" onClick="logConstant('RISK_XSS')" href="../_constants/RISK_XSS.html" onMouseOver="constPopup(event,'RISK_XSS')">RISK_XSS</a> | <a class="constant" onClick="logConstant('RISK_CONFIG')" href="../_constants/RISK_CONFIG.html" onMouseOver="constPopup(event,'RISK_CONFIG')">RISK_CONFIG</a> | <a class="constant" onClick="logConstant('RISK_DATALOSS')" href="../_constants/RISK_DATALOSS.html" onMouseOver="constPopup(event,'RISK_DATALOSS')">RISK_DATALOSS</a>))) {
<a name="l413"><span class="linenum"> 413</span></a>          if (<a class="function" onClick="logFunction('isguestuser')" href="../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) or <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> == 0) {
<a name="l414"><span class="linenum"> 414</span></a>              return false;
<a name="l415"><span class="linenum"> 415</span></a>          }
<a name="l416"><span class="linenum"> 416</span></a>      }
<a name="l417"><span class="linenum"> 417</span></a>  
<a name="l418"><span class="linenum"> 418</span></a>  <span class="comment">    // somehow make sure the user is not deleted and actually exists</span>
<a name="l419"><span class="linenum"> 419</span></a>      if (<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> != 0) {
<a name="l420"><span class="linenum"> 420</span></a>          if (<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> == <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a> and isset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('deleted')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/deleted.html">deleted</a>)) {
<a name="l421"><span class="linenum"> 421</span></a>  <span class="comment">            // this prevents one query per page, it is a bit of cheating,</span>
<a name="l422"><span class="linenum"> 422</span></a>  <span class="comment">            // but hopefully session is terminated properly once user is deleted</span>
<a name="l423"><span class="linenum"> 423</span></a>              if (<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('deleted')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/deleted.html">deleted</a>) {
<a name="l424"><span class="linenum"> 424</span></a>                  return false;
<a name="l425"><span class="linenum"> 425</span></a>              }
<a name="l426"><span class="linenum"> 426</span></a>          } else {
<a name="l427"><span class="linenum"> 427</span></a>              if (!<a class="class" onClick="logClass('context_user')" href="../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="constant" onClick="logConstant('IGNORE_MISSING')" href="../_constants/IGNORE_MISSING.html" onMouseOver="constPopup(event,'IGNORE_MISSING')">IGNORE_MISSING</a>)) {
<a name="l428"><span class="linenum"> 428</span></a>  <span class="comment">                // no user context == invalid userid</span>
<a name="l429"><span class="linenum"> 429</span></a>                  return false;
<a name="l430"><span class="linenum"> 430</span></a>              }
<a name="l431"><span class="linenum"> 431</span></a>          }
<a name="l432"><span class="linenum"> 432</span></a>      }
<a name="l433"><span class="linenum"> 433</span></a>  
<a name="l434"><span class="linenum"> 434</span></a>  <span class="comment">    // context path/depth must be valid</span>
<a name="l435"><span class="linenum"> 435</span></a>      if (empty(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('path')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/path.html">path</a>) or <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('depth')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/depth.html">depth</a> == 0) {
<a name="l436"><span class="linenum"> 436</span></a>  <span class="comment">        // this should not happen often, each upgrade tries to rebuild the context paths</span>
<a name="l437"><span class="linenum"> 437</span></a>          <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Context id '.<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>.' does not have valid path, please use <a class="function" onClick="logFunction('build_context_path')" href="../_functions/build_context_path.html" onMouseOver="funcPopup(event,'build_context_path')">build_context_path</a>()');
<a name="l438"><span class="linenum"> 438</span></a>          if (<a class="function" onClick="logFunction('is_siteadmin')" href="../_functions/is_siteadmin.html" onMouseOver="funcPopup(event,'is_siteadmin')">is_siteadmin</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>)) {
<a name="l439"><span class="linenum"> 439</span></a>              return true;
<a name="l440"><span class="linenum"> 440</span></a>          } else {
<a name="l441"><span class="linenum"> 441</span></a>              return false;
<a name="l442"><span class="linenum"> 442</span></a>          }
<a name="l443"><span class="linenum"> 443</span></a>      }
<a name="l444"><span class="linenum"> 444</span></a>  
<a name="l445"><span class="linenum"> 445</span></a>  <span class="comment">    // Find out if user is admin - it is not possible to override the doanything in any way</span>
<a name="l446"><span class="linenum"> 446</span></a>  <span class="comment">    // and it is not possible to switch to admin role either.</span>
<a name="l447"><span class="linenum"> 447</span></a>      if (<a class="var it28638" onMouseOver="hilite(28638)" onMouseOut="lolite()" onClick="logVariable('doanything')" href="../_variables/doanything.html">$doanything</a>) {
<a name="l448"><span class="linenum"> 448</span></a>          if (<a class="function" onClick="logFunction('is_siteadmin')" href="../_functions/is_siteadmin.html" onMouseOver="funcPopup(event,'is_siteadmin')">is_siteadmin</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>)) {
<a name="l449"><span class="linenum"> 449</span></a>              if (<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> != <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) {
<a name="l450"><span class="linenum"> 450</span></a>                  return true;
<a name="l451"><span class="linenum"> 451</span></a>              }
<a name="l452"><span class="linenum"> 452</span></a>  <span class="comment">            // make sure switchrole is not used in this context</span>
<a name="l453"><span class="linenum"> 453</span></a>              if (empty(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['rsw'])) {
<a name="l454"><span class="linenum"> 454</span></a>                  return true;
<a name="l455"><span class="linenum"> 455</span></a>              }
<a name="l456"><span class="linenum"> 456</span></a>              <a class="var it224" onMouseOver="hilite(224)" onMouseOut="lolite()" onClick="logVariable('parts')" href="../_variables/parts.html">$parts</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>('/', <a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('path')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/path.html">path</a>, '/'));
<a name="l457"><span class="linenum"> 457</span></a>              <a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a> = '';
<a name="l458"><span class="linenum"> 458</span></a>              <a class="var it7022" onMouseOver="hilite(7022)" onMouseOut="lolite()" onClick="logVariable('switched')" href="../_variables/switched.html">$switched</a> = false;
<a name="l459"><span class="linenum"> 459</span></a>              foreach (<a class="var it224" onMouseOver="hilite(224)" onMouseOut="lolite()" onClick="logVariable('parts')" href="../_variables/parts.html">$parts</a> as <a class="var it779" onMouseOver="hilite(779)" onMouseOut="lolite()" onClick="logVariable('part')" href="../_variables/part.html">$part</a>) {
<a name="l460"><span class="linenum"> 460</span></a>                  <a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a> .= '/' . <a class="var it779" onMouseOver="hilite(779)" onMouseOut="lolite()" onClick="logVariable('part')" href="../_variables/part.html">$part</a>;
<a name="l461"><span class="linenum"> 461</span></a>                  if (!empty(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['rsw'][<a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>])) {
<a name="l462"><span class="linenum"> 462</span></a>                      <a class="var it7022" onMouseOver="hilite(7022)" onMouseOut="lolite()" onClick="logVariable('switched')" href="../_variables/switched.html">$switched</a> = true;
<a name="l463"><span class="linenum"> 463</span></a>                      break;
<a name="l464"><span class="linenum"> 464</span></a>                  }
<a name="l465"><span class="linenum"> 465</span></a>              }
<a name="l466"><span class="linenum"> 466</span></a>              if (!<a class="var it7022" onMouseOver="hilite(7022)" onMouseOut="lolite()" onClick="logVariable('switched')" href="../_variables/switched.html">$switched</a>) {
<a name="l467"><span class="linenum"> 467</span></a>                  return true;
<a name="l468"><span class="linenum"> 468</span></a>              }
<a name="l469"><span class="linenum"> 469</span></a>  <span class="comment">            //ok, admin switched role in this context, let's use normal access control rules</span>
<a name="l470"><span class="linenum"> 470</span></a>          }
<a name="l471"><span class="linenum"> 471</span></a>      }
<a name="l472"><span class="linenum"> 472</span></a>  
<a name="l473"><span class="linenum"> 473</span></a>  <span class="comment">    // Careful check for staleness...</span>
<a name="l474"><span class="linenum"> 474</span></a>      <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('reload_if_dirty')" href="../_functions/reload_if_dirty.html" onMouseOver="funcPopup(event,'reload_if_dirty')">reload_if_dirty</a>();
<a name="l475"><span class="linenum"> 475</span></a>  
<a name="l476"><span class="linenum"> 476</span></a>      if (<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a> == <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) {
<a name="l477"><span class="linenum"> 477</span></a>          if (!isset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>)) {
<a name="l478"><span class="linenum"> 478</span></a>              <a class="function" onClick="logFunction('load_all_capabilities')" href="../_functions/load_all_capabilities.html" onMouseOver="funcPopup(event,'load_all_capabilities')">load_all_capabilities</a>();
<a name="l479"><span class="linenum"> 479</span></a>          }
<a name="l480"><span class="linenum"> 480</span></a>          <a class="var it1026" onMouseOver="hilite(1026)" onMouseOut="lolite()" onClick="logVariable('access')" href="../_variables/access.html">$access</a> =&amp; <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>;
<a name="l481"><span class="linenum"> 481</span></a>  
<a name="l482"><span class="linenum"> 482</span></a>      } else {
<a name="l483"><span class="linenum"> 483</span></a>  <span class="comment">        // make sure user accessdata is really loaded</span>
<a name="l484"><span class="linenum"> 484</span></a>          <a class="function" onClick="logFunction('get_user_accessdata')" href="../_functions/get_user_accessdata.html" onMouseOver="funcPopup(event,'get_user_accessdata')">get_user_accessdata</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, true);
<a name="l485"><span class="linenum"> 485</span></a>          <a class="var it1026" onMouseOver="hilite(1026)" onMouseOut="lolite()" onClick="logVariable('access')" href="../_variables/access.html">$access</a> =&amp; <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('accessdatabyuser')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/accessdatabyuser.html">accessdatabyuser</a>[<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>];
<a name="l486"><span class="linenum"> 486</span></a>      }
<a name="l487"><span class="linenum"> 487</span></a>  
<a name="l488"><span class="linenum"> 488</span></a>  
<a name="l489"><span class="linenum"> 489</span></a>  <span class="comment">    // Load accessdata for below-the-course context if necessary,</span>
<a name="l490"><span class="linenum"> 490</span></a>  <span class="comment">    // all contexts at and above all courses are already loaded</span>
<a name="l491"><span class="linenum"> 491</span></a>      if (<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> != <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a> and <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_course_context')" href="../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>(false)) {
<a name="l492"><span class="linenum"> 492</span></a>          <a class="function" onClick="logFunction('load_course_context')" href="../_functions/load_course_context.html" onMouseOver="funcPopup(event,'load_course_context')">load_course_context</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>, <a class="var it1026" onMouseOver="hilite(1026)" onMouseOut="lolite()" onClick="logVariable('access')" href="../_variables/access.html">$access</a>);
<a name="l493"><span class="linenum"> 493</span></a>      }
<a name="l494"><span class="linenum"> 494</span></a>  
<a name="l495"><span class="linenum"> 495</span></a>      return <a class="function" onClick="logFunction('has_capability_in_accessdata')" href="../_functions/has_capability_in_accessdata.html" onMouseOver="funcPopup(event,'has_capability_in_accessdata')">has_capability_in_accessdata</a>(<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it1026" onMouseOver="hilite(1026)" onMouseOut="lolite()" onClick="logVariable('access')" href="../_variables/access.html">$access</a>);
<a name="l496"><span class="linenum"> 496</span></a>  }
<a name="l497"><span class="linenum"> 497</span></a>  
<a name="l498"><span class="linenum"> 498</span></a>  <span class="comment">/**</span>
<a name="l499"><span class="linenum"> 499</span></a>  <span class="comment"> * Check if the user has any one of several capabilities from a list.</span>
<a name="l500"><span class="linenum"> 500</span></a>  <span class="comment"> *</span>
<a name="l501"><span class="linenum"> 501</span></a>  <span class="comment"> * This is just a utility method that calls has_capability in a loop. Try to put</span>
<a name="l502"><span class="linenum"> 502</span></a>  <span class="comment"> * the capabilities that most users are likely to have first in the list for best</span>
<a name="l503"><span class="linenum"> 503</span></a>  <span class="comment"> * performance.</span>
<a name="l504"><span class="linenum"> 504</span></a>  <span class="comment"> *</span>
<a name="l505"><span class="linenum"> 505</span></a>  <span class="comment"> * @category access</span>
<a name="l506"><span class="linenum"> 506</span></a>  <span class="comment"> * @see has_capability()</span>
<a name="l507"><span class="linenum"> 507</span></a>  <span class="comment"> *</span>
<a name="l508"><span class="linenum"> 508</span></a>  <span class="comment"> * @param array $capabilities an array of capability names.</span>
<a name="l509"><span class="linenum"> 509</span></a>  <span class="comment"> * @param context $context the context to check the capability in. You normally get this with instance method of a context class.</span>
<a name="l510"><span class="linenum"> 510</span></a>  <span class="comment"> * @param integer|stdClass $user A user id or object. By default (null) checks the permissions of the current user.</span>
<a name="l511"><span class="linenum"> 511</span></a>  <span class="comment"> * @param boolean $doanything If false, ignore effect of admin role assignment</span>
<a name="l512"><span class="linenum"> 512</span></a>  <span class="comment"> * @return boolean true if the user has any of these capabilities. Otherwise false.</span>
<a name="l513"><span class="linenum"> 513</span></a>  <span class="comment"> */</span>
<a name="l514"><span class="linenum"> 514</span></a>  function <a class="function" onClick="logFunction('has_any_capability')" href="../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(array <a class="var it497" onMouseOver="hilite(497)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../_variables/capabilities.html">$capabilities</a>, context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = null, <a class="var it28638" onMouseOver="hilite(28638)" onMouseOut="lolite()" onClick="logVariable('doanything')" href="../_variables/doanything.html">$doanything</a> = true) {
<a name="l515"><span class="linenum"> 515</span></a>      foreach (<a class="var it497" onMouseOver="hilite(497)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../_variables/capabilities.html">$capabilities</a> as <a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>) {
<a name="l516"><span class="linenum"> 516</span></a>          if (<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="var it28638" onMouseOver="hilite(28638)" onMouseOut="lolite()" onClick="logVariable('doanything')" href="../_variables/doanything.html">$doanything</a>)) {
<a name="l517"><span class="linenum"> 517</span></a>              return true;
<a name="l518"><span class="linenum"> 518</span></a>          }
<a name="l519"><span class="linenum"> 519</span></a>      }
<a name="l520"><span class="linenum"> 520</span></a>      return false;
<a name="l521"><span class="linenum"> 521</span></a>  }
<a name="l522"><span class="linenum"> 522</span></a>  
<a name="l523"><span class="linenum"> 523</span></a>  <span class="comment">/**</span>
<a name="l524"><span class="linenum"> 524</span></a>  <span class="comment"> * Check if the user has all the capabilities in a list.</span>
<a name="l525"><span class="linenum"> 525</span></a>  <span class="comment"> *</span>
<a name="l526"><span class="linenum"> 526</span></a>  <span class="comment"> * This is just a utility method that calls has_capability in a loop. Try to put</span>
<a name="l527"><span class="linenum"> 527</span></a>  <span class="comment"> * the capabilities that fewest users are likely to have first in the list for best</span>
<a name="l528"><span class="linenum"> 528</span></a>  <span class="comment"> * performance.</span>
<a name="l529"><span class="linenum"> 529</span></a>  <span class="comment"> *</span>
<a name="l530"><span class="linenum"> 530</span></a>  <span class="comment"> * @category access</span>
<a name="l531"><span class="linenum"> 531</span></a>  <span class="comment"> * @see has_capability()</span>
<a name="l532"><span class="linenum"> 532</span></a>  <span class="comment"> *</span>
<a name="l533"><span class="linenum"> 533</span></a>  <span class="comment"> * @param array $capabilities an array of capability names.</span>
<a name="l534"><span class="linenum"> 534</span></a>  <span class="comment"> * @param context $context the context to check the capability in. You normally get this with instance method of a context class.</span>
<a name="l535"><span class="linenum"> 535</span></a>  <span class="comment"> * @param integer|stdClass $user A user id or object. By default (null) checks the permissions of the current user.</span>
<a name="l536"><span class="linenum"> 536</span></a>  <span class="comment"> * @param boolean $doanything If false, ignore effect of admin role assignment</span>
<a name="l537"><span class="linenum"> 537</span></a>  <span class="comment"> * @return boolean true if the user has all of these capabilities. Otherwise false.</span>
<a name="l538"><span class="linenum"> 538</span></a>  <span class="comment"> */</span>
<a name="l539"><span class="linenum"> 539</span></a>  function <a class="function" onClick="logFunction('has_all_capabilities')" href="../_functions/has_all_capabilities.html" onMouseOver="funcPopup(event,'has_all_capabilities')">has_all_capabilities</a>(array <a class="var it497" onMouseOver="hilite(497)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../_variables/capabilities.html">$capabilities</a>, context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = null, <a class="var it28638" onMouseOver="hilite(28638)" onMouseOut="lolite()" onClick="logVariable('doanything')" href="../_variables/doanything.html">$doanything</a> = true) {
<a name="l540"><span class="linenum"> 540</span></a>      foreach (<a class="var it497" onMouseOver="hilite(497)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../_variables/capabilities.html">$capabilities</a> as <a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>) {
<a name="l541"><span class="linenum"> 541</span></a>          if (!<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="var it28638" onMouseOver="hilite(28638)" onMouseOut="lolite()" onClick="logVariable('doanything')" href="../_variables/doanything.html">$doanything</a>)) {
<a name="l542"><span class="linenum"> 542</span></a>              return false;
<a name="l543"><span class="linenum"> 543</span></a>          }
<a name="l544"><span class="linenum"> 544</span></a>      }
<a name="l545"><span class="linenum"> 545</span></a>      return true;
<a name="l546"><span class="linenum"> 546</span></a>  }
<a name="l547"><span class="linenum"> 547</span></a>  
<a name="l548"><span class="linenum"> 548</span></a>  <span class="comment">/**</span>
<a name="l549"><span class="linenum"> 549</span></a>  <span class="comment"> * Is course creator going to have capability in a new course?</span>
<a name="l550"><span class="linenum"> 550</span></a>  <span class="comment"> *</span>
<a name="l551"><span class="linenum"> 551</span></a>  <span class="comment"> * This is intended to be used in enrolment plugins before or during course creation,</span>
<a name="l552"><span class="linenum"> 552</span></a>  <span class="comment"> * do not use after the course is fully created.</span>
<a name="l553"><span class="linenum"> 553</span></a>  <span class="comment"> *</span>
<a name="l554"><span class="linenum"> 554</span></a>  <span class="comment"> * @category access</span>
<a name="l555"><span class="linenum"> 555</span></a>  <span class="comment"> *</span>
<a name="l556"><span class="linenum"> 556</span></a>  <span class="comment"> * @param string $capability the name of the capability to check.</span>
<a name="l557"><span class="linenum"> 557</span></a>  <span class="comment"> * @param context $context course or category context where is course going to be created</span>
<a name="l558"><span class="linenum"> 558</span></a>  <span class="comment"> * @param integer|stdClass $user A user id or object. By default (null) checks the permissions of the current user.</span>
<a name="l559"><span class="linenum"> 559</span></a>  <span class="comment"> * @return boolean true if the user will have this capability.</span>
<a name="l560"><span class="linenum"> 560</span></a>  <span class="comment"> *</span>
<a name="l561"><span class="linenum"> 561</span></a>  <span class="comment"> * @throws coding_exception if different type of context submitted</span>
<a name="l562"><span class="linenum"> 562</span></a>  <span class="comment"> */</span>
<a name="l563"><span class="linenum"> 563</span></a>  function <a class="function" onClick="logFunction('guess_if_creator_will_have_course_capability')" href="../_functions/guess_if_creator_will_have_course_capability.html" onMouseOver="funcPopup(event,'guess_if_creator_will_have_course_capability')">guess_if_creator_will_have_course_capability</a>(<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = null) {
<a name="l564"><span class="linenum"> 564</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l565"><span class="linenum"> 565</span></a>  
<a name="l566"><span class="linenum"> 566</span></a>      if (<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> != <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a> and <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> != <a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>) {
<a name="l567"><span class="linenum"> 567</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Only course or course category context expected');
<a name="l568"><span class="linenum"> 568</span></a>      }
<a name="l569"><span class="linenum"> 569</span></a>  
<a name="l570"><span class="linenum"> 570</span></a>      if (<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l571"><span class="linenum"> 571</span></a>  <span class="comment">        // User already has the capability, it could be only removed if CAP_PROHIBIT</span>
<a name="l572"><span class="linenum"> 572</span></a>  <span class="comment">        // was involved here, but we ignore that.</span>
<a name="l573"><span class="linenum"> 573</span></a>          return true;
<a name="l574"><span class="linenum"> 574</span></a>      }
<a name="l575"><span class="linenum"> 575</span></a>  
<a name="l576"><span class="linenum"> 576</span></a>      if (!<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:create', <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l577"><span class="linenum"> 577</span></a>          return false;
<a name="l578"><span class="linenum"> 578</span></a>      }
<a name="l579"><span class="linenum"> 579</span></a>  
<a name="l580"><span class="linenum"> 580</span></a>      if (!<a class="function" onClick="logFunction('enrol_is_enabled')" href="../_functions/enrol_is_enabled.html" onMouseOver="funcPopup(event,'enrol_is_enabled')">enrol_is_enabled</a>('manual')) {
<a name="l581"><span class="linenum"> 581</span></a>          return false;
<a name="l582"><span class="linenum"> 582</span></a>      }
<a name="l583"><span class="linenum"> 583</span></a>  
<a name="l584"><span class="linenum"> 584</span></a>      if (empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('creatornewroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/creatornewroleid.html">creatornewroleid</a>)) {
<a name="l585"><span class="linenum"> 585</span></a>          return false;
<a name="l586"><span class="linenum"> 586</span></a>      }
<a name="l587"><span class="linenum"> 587</span></a>  
<a name="l588"><span class="linenum"> 588</span></a>      if (<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> == <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>) {
<a name="l589"><span class="linenum"> 589</span></a>          if (<a class="function" onClick="logFunction('is_viewing')" href="../_functions/is_viewing.html" onMouseOver="funcPopup(event,'is_viewing')">is_viewing</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, 'moodle/role:assign') or <a class="function" onClick="logFunction('is_enrolled')" href="../_functions/is_enrolled.html" onMouseOver="funcPopup(event,'is_enrolled')">is_enrolled</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, 'moodle/role:assign')) {
<a name="l590"><span class="linenum"> 590</span></a>              return false;
<a name="l591"><span class="linenum"> 591</span></a>          }
<a name="l592"><span class="linenum"> 592</span></a>      } else {
<a name="l593"><span class="linenum"> 593</span></a>          if (<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:view', <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) and <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/role:assign', <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l594"><span class="linenum"> 594</span></a>              return false;
<a name="l595"><span class="linenum"> 595</span></a>          }
<a name="l596"><span class="linenum"> 596</span></a>      }
<a name="l597"><span class="linenum"> 597</span></a>  
<a name="l598"><span class="linenum"> 598</span></a>  <span class="comment">    // Most likely they will be enrolled after the course creation is finished,</span>
<a name="l599"><span class="linenum"> 599</span></a>  <span class="comment">    // does the new role have the required capability?</span>
<a name="l600"><span class="linenum"> 600</span></a>      <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it28796" onMouseOver="hilite(28796)" onMouseOut="lolite()" onClick="logVariable('neededroles')" href="../_variables/neededroles.html">$neededroles</a>, <a class="var it28797" onMouseOver="hilite(28797)" onMouseOut="lolite()" onClick="logVariable('forbiddenroles')" href="../_variables/forbiddenroles.html">$forbiddenroles</a>) = <a class="function" onClick="logFunction('get_roles_with_cap_in_context')" href="../_functions/get_roles_with_cap_in_context.html" onMouseOver="funcPopup(event,'get_roles_with_cap_in_context')">get_roles_with_cap_in_context</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>);
<a name="l601"><span class="linenum"> 601</span></a>      return isset(<a class="var it28796" onMouseOver="hilite(28796)" onMouseOut="lolite()" onClick="logVariable('neededroles')" href="../_variables/neededroles.html">$neededroles</a>[<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('creatornewroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/creatornewroleid.html">creatornewroleid</a>]);
<a name="l602"><span class="linenum"> 602</span></a>  }
<a name="l603"><span class="linenum"> 603</span></a>  
<a name="l604"><span class="linenum"> 604</span></a>  <span class="comment">/**</span>
<a name="l605"><span class="linenum"> 605</span></a>  <span class="comment"> * Check if the user is an admin at the site level.</span>
<a name="l606"><span class="linenum"> 606</span></a>  <span class="comment"> *</span>
<a name="l607"><span class="linenum"> 607</span></a>  <span class="comment"> * Please note that use of proper capabilities is always encouraged,</span>
<a name="l608"><span class="linenum"> 608</span></a>  <span class="comment"> * this function is supposed to be used from core or for temporary hacks.</span>
<a name="l609"><span class="linenum"> 609</span></a>  <span class="comment"> *</span>
<a name="l610"><span class="linenum"> 610</span></a>  <span class="comment"> * @category access</span>
<a name="l611"><span class="linenum"> 611</span></a>  <span class="comment"> *</span>
<a name="l612"><span class="linenum"> 612</span></a>  <span class="comment"> * @param  int|stdClass  $user_or_id user id or user object</span>
<a name="l613"><span class="linenum"> 613</span></a>  <span class="comment"> * @return bool true if user is one of the administrators, false otherwise</span>
<a name="l614"><span class="linenum"> 614</span></a>  <span class="comment"> */</span>
<a name="l615"><span class="linenum"> 615</span></a>  function <a class="function" onClick="logFunction('is_siteadmin')" href="../_functions/is_siteadmin.html" onMouseOver="funcPopup(event,'is_siteadmin')">is_siteadmin</a>(<a class="var it11449" onMouseOver="hilite(11449)" onMouseOut="lolite()" onClick="logVariable('user_or_id')" href="../_variables/user_or_id.html">$user_or_id</a> = null) {
<a name="l616"><span class="linenum"> 616</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l617"><span class="linenum"> 617</span></a>  
<a name="l618"><span class="linenum"> 618</span></a>      if (<a class="var it11449" onMouseOver="hilite(11449)" onMouseOut="lolite()" onClick="logVariable('user_or_id')" href="../_variables/user_or_id.html">$user_or_id</a> === null) {
<a name="l619"><span class="linenum"> 619</span></a>          <a class="var it11449" onMouseOver="hilite(11449)" onMouseOut="lolite()" onClick="logVariable('user_or_id')" href="../_variables/user_or_id.html">$user_or_id</a> = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l620"><span class="linenum"> 620</span></a>      }
<a name="l621"><span class="linenum"> 621</span></a>  
<a name="l622"><span class="linenum"> 622</span></a>      if (empty(<a class="var it11449" onMouseOver="hilite(11449)" onMouseOut="lolite()" onClick="logVariable('user_or_id')" href="../_variables/user_or_id.html">$user_or_id</a>)) {
<a name="l623"><span class="linenum"> 623</span></a>          return false;
<a name="l624"><span class="linenum"> 624</span></a>      }
<a name="l625"><span class="linenum"> 625</span></a>      if (!empty(<a class="var it11449" onMouseOver="hilite(11449)" onMouseOut="lolite()" onClick="logVariable('user_or_id')" href="../_variables/user_or_id.html">$user_or_id</a>-&gt;<a onClick="logVariable('id')" class="var it40979" onMouseOver="hilite(40979)" onMouseOut="lolite()" href="../_variables/id.html">id</a>)) {
<a name="l626"><span class="linenum"> 626</span></a>          <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> = <a class="var it11449" onMouseOver="hilite(11449)" onMouseOut="lolite()" onClick="logVariable('user_or_id')" href="../_variables/user_or_id.html">$user_or_id</a>-&gt;<a onClick="logVariable('id')" class="var it40979" onMouseOver="hilite(40979)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l627"><span class="linenum"> 627</span></a>      } else {
<a name="l628"><span class="linenum"> 628</span></a>          <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> = <a class="var it11449" onMouseOver="hilite(11449)" onMouseOut="lolite()" onClick="logVariable('user_or_id')" href="../_variables/user_or_id.html">$user_or_id</a>;
<a name="l629"><span class="linenum"> 629</span></a>      }
<a name="l630"><span class="linenum"> 630</span></a>  
<a name="l631"><span class="linenum"> 631</span></a>  <span class="comment">    // Because this script is called many times (150+ for course page) with</span>
<a name="l632"><span class="linenum"> 632</span></a>  <span class="comment">    // the same parameters, it is worth doing minor optimisations. This static</span>
<a name="l633"><span class="linenum"> 633</span></a>  <span class="comment">    // cache stores the value for a single userid, saving about 2ms from course</span>
<a name="l634"><span class="linenum"> 634</span></a>  <span class="comment">    // page load time without using significant memory. As the static cache</span>
<a name="l635"><span class="linenum"> 635</span></a>  <span class="comment">    // also includes the value it depends on, this cannot break unit tests.</span>
<a name="l636"><span class="linenum"> 636</span></a>      static <a class="var it28798" onMouseOver="hilite(28798)" onMouseOut="lolite()" onClick="logVariable('knownid')" href="../_variables/knownid.html">$knownid</a>, <a class="var it28799" onMouseOver="hilite(28799)" onMouseOut="lolite()" onClick="logVariable('knownresult')" href="../_variables/knownresult.html">$knownresult</a>, <a class="var it28800" onMouseOver="hilite(28800)" onMouseOut="lolite()" onClick="logVariable('knownsiteadmins')" href="../_variables/knownsiteadmins.html">$knownsiteadmins</a>;
<a name="l637"><span class="linenum"> 637</span></a>      if (<a class="var it28798" onMouseOver="hilite(28798)" onMouseOut="lolite()" onClick="logVariable('knownid')" href="../_variables/knownid.html">$knownid</a> === <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> &amp;&amp; <a class="var it28800" onMouseOver="hilite(28800)" onMouseOut="lolite()" onClick="logVariable('knownsiteadmins')" href="../_variables/knownsiteadmins.html">$knownsiteadmins</a> === <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('siteadmins')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/siteadmins.html">siteadmins</a>) {
<a name="l638"><span class="linenum"> 638</span></a>          return <a class="var it28799" onMouseOver="hilite(28799)" onMouseOut="lolite()" onClick="logVariable('knownresult')" href="../_variables/knownresult.html">$knownresult</a>;
<a name="l639"><span class="linenum"> 639</span></a>      }
<a name="l640"><span class="linenum"> 640</span></a>      <a class="var it28798" onMouseOver="hilite(28798)" onMouseOut="lolite()" onClick="logVariable('knownid')" href="../_variables/knownid.html">$knownid</a> = <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>;
<a name="l641"><span class="linenum"> 641</span></a>      <a class="var it28800" onMouseOver="hilite(28800)" onMouseOut="lolite()" onClick="logVariable('knownsiteadmins')" href="../_variables/knownsiteadmins.html">$knownsiteadmins</a> = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('siteadmins')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/siteadmins.html">siteadmins</a>;
<a name="l642"><span class="linenum"> 642</span></a>  
<a name="l643"><span class="linenum"> 643</span></a>      <a class="var it4295" onMouseOver="hilite(4295)" onMouseOut="lolite()" onClick="logVariable('siteadmins')" href="../_variables/siteadmins.html">$siteadmins</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('siteadmins')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/siteadmins.html">siteadmins</a>);
<a name="l644"><span class="linenum"> 644</span></a>      <a class="var it28799" onMouseOver="hilite(28799)" onMouseOut="lolite()" onClick="logVariable('knownresult')" href="../_variables/knownresult.html">$knownresult</a> = <a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it4295" onMouseOver="hilite(4295)" onMouseOut="lolite()" onClick="logVariable('siteadmins')" href="../_variables/siteadmins.html">$siteadmins</a>);
<a name="l645"><span class="linenum"> 645</span></a>      return <a class="var it28799" onMouseOver="hilite(28799)" onMouseOut="lolite()" onClick="logVariable('knownresult')" href="../_variables/knownresult.html">$knownresult</a>;
<a name="l646"><span class="linenum"> 646</span></a>  }
<a name="l647"><span class="linenum"> 647</span></a>  
<a name="l648"><span class="linenum"> 648</span></a>  <span class="comment">/**</span>
<a name="l649"><span class="linenum"> 649</span></a>  <span class="comment"> * Returns true if user has at least one role assign</span>
<a name="l650"><span class="linenum"> 650</span></a>  <span class="comment"> * of 'coursecontact' role (is potentially listed in some course descriptions).</span>
<a name="l651"><span class="linenum"> 651</span></a>  <span class="comment"> *</span>
<a name="l652"><span class="linenum"> 652</span></a>  <span class="comment"> * @param int $userid</span>
<a name="l653"><span class="linenum"> 653</span></a>  <span class="comment"> * @return bool</span>
<a name="l654"><span class="linenum"> 654</span></a>  <span class="comment"> */</span>
<a name="l655"><span class="linenum"> 655</span></a>  function <a class="function" onClick="logFunction('has_coursecontact_role')" href="../_functions/has_coursecontact_role.html" onMouseOver="funcPopup(event,'has_coursecontact_role')">has_coursecontact_role</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) {
<a name="l656"><span class="linenum"> 656</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l657"><span class="linenum"> 657</span></a>  
<a name="l658"><span class="linenum"> 658</span></a>      if (empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('coursecontact')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/coursecontact.html">coursecontact</a>)) {
<a name="l659"><span class="linenum"> 659</span></a>          return false;
<a name="l660"><span class="linenum"> 660</span></a>      }
<a name="l661"><span class="linenum"> 661</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT 1
<a name="l662"><span class="linenum"> 662</span></a>                FROM {role_assignments}
<a name="l663"><span class="linenum"> 663</span></a>               WHERE userid = :userid AND roleid IN (<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('coursecontact')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/coursecontact.html">coursecontact</a>)&quot;;
<a name="l664"><span class="linenum"> 664</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists_sql')" href="../_functions/record_exists_sql.html" onMouseOver="funcPopup(event,'record_exists_sql')">record_exists_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, array('userid'=&gt;<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>));
<a name="l665"><span class="linenum"> 665</span></a>  }
<a name="l666"><span class="linenum"> 666</span></a>  
<a name="l667"><span class="linenum"> 667</span></a>  <span class="comment">/**</span>
<a name="l668"><span class="linenum"> 668</span></a>  <span class="comment"> * Does the user have a capability to do something?</span>
<a name="l669"><span class="linenum"> 669</span></a>  <span class="comment"> *</span>
<a name="l670"><span class="linenum"> 670</span></a>  <span class="comment"> * Walk the accessdata array and return true/false.</span>
<a name="l671"><span class="linenum"> 671</span></a>  <span class="comment"> * Deals with prohibits, role switching, aggregating</span>
<a name="l672"><span class="linenum"> 672</span></a>  <span class="comment"> * capabilities, etc.</span>
<a name="l673"><span class="linenum"> 673</span></a>  <span class="comment"> *</span>
<a name="l674"><span class="linenum"> 674</span></a>  <span class="comment"> * The main feature of here is being FAST and with no</span>
<a name="l675"><span class="linenum"> 675</span></a>  <span class="comment"> * side effects.</span>
<a name="l676"><span class="linenum"> 676</span></a>  <span class="comment"> *</span>
<a name="l677"><span class="linenum"> 677</span></a>  <span class="comment"> * Notes:</span>
<a name="l678"><span class="linenum"> 678</span></a>  <span class="comment"> *</span>
<a name="l679"><span class="linenum"> 679</span></a>  <span class="comment"> * Switch Role merges with default role</span>
<a name="l680"><span class="linenum"> 680</span></a>  <span class="comment"> * ------------------------------------</span>
<a name="l681"><span class="linenum"> 681</span></a>  <span class="comment"> * If you are a teacher in course X, you have at least</span>
<a name="l682"><span class="linenum"> 682</span></a>  <span class="comment"> * teacher-in-X + defaultloggedinuser-sitewide. So in the</span>
<a name="l683"><span class="linenum"> 683</span></a>  <span class="comment"> * course you'll have techer+defaultloggedinuser.</span>
<a name="l684"><span class="linenum"> 684</span></a>  <span class="comment"> * We try to mimic that in switchrole.</span>
<a name="l685"><span class="linenum"> 685</span></a>  <span class="comment"> *</span>
<a name="l686"><span class="linenum"> 686</span></a>  <span class="comment"> * Permission evaluation</span>
<a name="l687"><span class="linenum"> 687</span></a>  <span class="comment"> * ---------------------</span>
<a name="l688"><span class="linenum"> 688</span></a>  <span class="comment"> * Originally there was an extremely complicated way</span>
<a name="l689"><span class="linenum"> 689</span></a>  <span class="comment"> * to determine the user access that dealt with</span>
<a name="l690"><span class="linenum"> 690</span></a>  <span class="comment"> * &quot;locality&quot; or role assignments and role overrides.</span>
<a name="l691"><span class="linenum"> 691</span></a>  <span class="comment"> * Now we simply evaluate access for each role separately</span>
<a name="l692"><span class="linenum"> 692</span></a>  <span class="comment"> * and then verify if user has at least one role with allow</span>
<a name="l693"><span class="linenum"> 693</span></a>  <span class="comment"> * and at the same time no role with prohibit.</span>
<a name="l694"><span class="linenum"> 694</span></a>  <span class="comment"> *</span>
<a name="l695"><span class="linenum"> 695</span></a>  <span class="comment"> * @access private</span>
<a name="l696"><span class="linenum"> 696</span></a>  <span class="comment"> * @param string $capability</span>
<a name="l697"><span class="linenum"> 697</span></a>  <span class="comment"> * @param context $context</span>
<a name="l698"><span class="linenum"> 698</span></a>  <span class="comment"> * @param array $accessdata</span>
<a name="l699"><span class="linenum"> 699</span></a>  <span class="comment"> * @return bool</span>
<a name="l700"><span class="linenum"> 700</span></a>  <span class="comment"> */</span>
<a name="l701"><span class="linenum"> 701</span></a>  function <a class="function" onClick="logFunction('has_capability_in_accessdata')" href="../_functions/has_capability_in_accessdata.html" onMouseOver="funcPopup(event,'has_capability_in_accessdata')">has_capability_in_accessdata</a>(<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, array &amp;<a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>) {
<a name="l702"><span class="linenum"> 702</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l703"><span class="linenum"> 703</span></a>  
<a name="l704"><span class="linenum"> 704</span></a>  <span class="comment">    // Build $paths as a list of current + all parent &quot;paths&quot; with order bottom-to-top</span>
<a name="l705"><span class="linenum"> 705</span></a>      <a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('path')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/path.html">path</a>;
<a name="l706"><span class="linenum"> 706</span></a>      <a class="var it599" onMouseOver="hilite(599)" onMouseOut="lolite()" onClick="logVariable('paths')" href="../_variables/paths.html">$paths</a> = array(<a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>);
<a name="l707"><span class="linenum"> 707</span></a>      while(<a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a> = <a class="phpfunction" onClick="logFunction('rtrim')" href="../_functions/rtrim.html" onMouseOver="phpfuncPopup(event,'rtrim')">rtrim</a>(<a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>, '0123456789')) {
<a name="l708"><span class="linenum"> 708</span></a>          <a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a> = <a class="phpfunction" onClick="logFunction('rtrim')" href="../_functions/rtrim.html" onMouseOver="phpfuncPopup(event,'rtrim')">rtrim</a>(<a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>, '/');
<a name="l709"><span class="linenum"> 709</span></a>          if (<a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a> === '') {
<a name="l710"><span class="linenum"> 710</span></a>              break;
<a name="l711"><span class="linenum"> 711</span></a>          }
<a name="l712"><span class="linenum"> 712</span></a>          <a class="var it599" onMouseOver="hilite(599)" onMouseOut="lolite()" onClick="logVariable('paths')" href="../_variables/paths.html">$paths</a>[] = <a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>;
<a name="l713"><span class="linenum"> 713</span></a>      }
<a name="l714"><span class="linenum"> 714</span></a>  
<a name="l715"><span class="linenum"> 715</span></a>      <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a> = array();
<a name="l716"><span class="linenum"> 716</span></a>      <a class="var it28801" onMouseOver="hilite(28801)" onMouseOut="lolite()" onClick="logVariable('switchedrole')" href="../_variables/switchedrole.html">$switchedrole</a> = false;
<a name="l717"><span class="linenum"> 717</span></a>  
<a name="l718"><span class="linenum"> 718</span></a>  <span class="comment">    // Find out if role switched</span>
<a name="l719"><span class="linenum"> 719</span></a>      if (!empty(<a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rsw'])) {
<a name="l720"><span class="linenum"> 720</span></a>  <span class="comment">        // From the bottom up...</span>
<a name="l721"><span class="linenum"> 721</span></a>          foreach (<a class="var it599" onMouseOver="hilite(599)" onMouseOut="lolite()" onClick="logVariable('paths')" href="../_variables/paths.html">$paths</a> as <a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>) {
<a name="l722"><span class="linenum"> 722</span></a>              if (isset(<a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rsw'][<a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>])) {
<a name="l723"><span class="linenum"> 723</span></a>  <span class="comment">                // Found a switchrole assignment - check for that role _plus_ the default user role</span>
<a name="l724"><span class="linenum"> 724</span></a>                  <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a> = array(<a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rsw'][<a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>]=&gt;null, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultuserroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultuserroleid.html">defaultuserroleid</a>=&gt;null);
<a name="l725"><span class="linenum"> 725</span></a>                  <a class="var it28801" onMouseOver="hilite(28801)" onMouseOut="lolite()" onClick="logVariable('switchedrole')" href="../_variables/switchedrole.html">$switchedrole</a> = true;
<a name="l726"><span class="linenum"> 726</span></a>                  break;
<a name="l727"><span class="linenum"> 727</span></a>              }
<a name="l728"><span class="linenum"> 728</span></a>          }
<a name="l729"><span class="linenum"> 729</span></a>      }
<a name="l730"><span class="linenum"> 730</span></a>  
<a name="l731"><span class="linenum"> 731</span></a>      if (!<a class="var it28801" onMouseOver="hilite(28801)" onMouseOut="lolite()" onClick="logVariable('switchedrole')" href="../_variables/switchedrole.html">$switchedrole</a>) {
<a name="l732"><span class="linenum"> 732</span></a>  <span class="comment">        // get all users roles in this context and above</span>
<a name="l733"><span class="linenum"> 733</span></a>          foreach (<a class="var it599" onMouseOver="hilite(599)" onMouseOut="lolite()" onClick="logVariable('paths')" href="../_variables/paths.html">$paths</a> as <a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>) {
<a name="l734"><span class="linenum"> 734</span></a>              if (isset(<a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['ra'][<a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>])) {
<a name="l735"><span class="linenum"> 735</span></a>                  foreach (<a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['ra'][<a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>] as <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>) {
<a name="l736"><span class="linenum"> 736</span></a>                      <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>[<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>] = null;
<a name="l737"><span class="linenum"> 737</span></a>                  }
<a name="l738"><span class="linenum"> 738</span></a>              }
<a name="l739"><span class="linenum"> 739</span></a>          }
<a name="l740"><span class="linenum"> 740</span></a>      }
<a name="l741"><span class="linenum"> 741</span></a>  
<a name="l742"><span class="linenum"> 742</span></a>  <span class="comment">    // Now find out what access is given to each role, going bottom--&gt;up direction</span>
<a name="l743"><span class="linenum"> 743</span></a>      <a class="var it2730" onMouseOver="hilite(2730)" onMouseOut="lolite()" onClick="logVariable('allowed')" href="../_variables/allowed.html">$allowed</a> = false;
<a name="l744"><span class="linenum"> 744</span></a>      foreach (<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a> as <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a> =&gt; <a class="var it7277" onMouseOver="hilite(7277)" onMouseOut="lolite()" onClick="logVariable('ignored')" href="../_variables/ignored.html">$ignored</a>) {
<a name="l745"><span class="linenum"> 745</span></a>          foreach (<a class="var it599" onMouseOver="hilite(599)" onMouseOut="lolite()" onClick="logVariable('paths')" href="../_variables/paths.html">$paths</a> as <a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>) {
<a name="l746"><span class="linenum"> 746</span></a>              if (isset(<a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rdef'][&quot;{<a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>}:<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>&quot;][<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>])) {
<a name="l747"><span class="linenum"> 747</span></a>                  <a class="var it26371" onMouseOver="hilite(26371)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../_variables/perm.html">$perm</a> = (int)<a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rdef'][&quot;{<a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>}:<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>&quot;][<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>];
<a name="l748"><span class="linenum"> 748</span></a>                  if (<a class="var it26371" onMouseOver="hilite(26371)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../_variables/perm.html">$perm</a> === <a class="constant" onClick="logConstant('CAP_PROHIBIT')" href="../_constants/CAP_PROHIBIT.html" onMouseOver="constPopup(event,'CAP_PROHIBIT')">CAP_PROHIBIT</a>) {
<a name="l749"><span class="linenum"> 749</span></a>  <span class="comment">                    // any CAP_PROHIBIT found means no permission for the user</span>
<a name="l750"><span class="linenum"> 750</span></a>                      return false;
<a name="l751"><span class="linenum"> 751</span></a>                  }
<a name="l752"><span class="linenum"> 752</span></a>                  if (<a class="phpfunction" onClick="logFunction('is_null')" href="../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>[<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>])) {
<a name="l753"><span class="linenum"> 753</span></a>                      <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>[<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>] = <a class="var it26371" onMouseOver="hilite(26371)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../_variables/perm.html">$perm</a>;
<a name="l754"><span class="linenum"> 754</span></a>                  }
<a name="l755"><span class="linenum"> 755</span></a>              }
<a name="l756"><span class="linenum"> 756</span></a>          }
<a name="l757"><span class="linenum"> 757</span></a>  <span class="comment">        // CAP_ALLOW in any role means the user has a permission, we continue only to detect prohibits</span>
<a name="l758"><span class="linenum"> 758</span></a>          <a class="var it2730" onMouseOver="hilite(2730)" onMouseOut="lolite()" onClick="logVariable('allowed')" href="../_variables/allowed.html">$allowed</a> = (<a class="var it2730" onMouseOver="hilite(2730)" onMouseOut="lolite()" onClick="logVariable('allowed')" href="../_variables/allowed.html">$allowed</a> or <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>[<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>] === <a class="constant" onClick="logConstant('CAP_ALLOW')" href="../_constants/CAP_ALLOW.html" onMouseOver="constPopup(event,'CAP_ALLOW')">CAP_ALLOW</a>);
<a name="l759"><span class="linenum"> 759</span></a>      }
<a name="l760"><span class="linenum"> 760</span></a>  
<a name="l761"><span class="linenum"> 761</span></a>      return <a class="var it2730" onMouseOver="hilite(2730)" onMouseOut="lolite()" onClick="logVariable('allowed')" href="../_variables/allowed.html">$allowed</a>;
<a name="l762"><span class="linenum"> 762</span></a>  }
<a name="l763"><span class="linenum"> 763</span></a>  
<a name="l764"><span class="linenum"> 764</span></a>  <span class="comment">/**</span>
<a name="l765"><span class="linenum"> 765</span></a>  <span class="comment"> * A convenience function that tests has_capability, and displays an error if</span>
<a name="l766"><span class="linenum"> 766</span></a>  <span class="comment"> * the user does not have that capability.</span>
<a name="l767"><span class="linenum"> 767</span></a>  <span class="comment"> *</span>
<a name="l768"><span class="linenum"> 768</span></a>  <span class="comment"> * NOTE before Moodle 2.0, this function attempted to make an appropriate</span>
<a name="l769"><span class="linenum"> 769</span></a>  <span class="comment"> * require_login call before checking the capability. This is no longer the case.</span>
<a name="l770"><span class="linenum"> 770</span></a>  <span class="comment"> * You must call require_login (or one of its variants) if you want to check the</span>
<a name="l771"><span class="linenum"> 771</span></a>  <span class="comment"> * user is logged in, before you call this function.</span>
<a name="l772"><span class="linenum"> 772</span></a>  <span class="comment"> *</span>
<a name="l773"><span class="linenum"> 773</span></a>  <span class="comment"> * @see has_capability()</span>
<a name="l774"><span class="linenum"> 774</span></a>  <span class="comment"> *</span>
<a name="l775"><span class="linenum"> 775</span></a>  <span class="comment"> * @param string $capability the name of the capability to check. For example mod/forum:view</span>
<a name="l776"><span class="linenum"> 776</span></a>  <span class="comment"> * @param context $context the context to check the capability in. You normally get this with context_xxxx::instance().</span>
<a name="l777"><span class="linenum"> 777</span></a>  <span class="comment"> * @param int $userid A user id. By default (null) checks the permissions of the current user.</span>
<a name="l778"><span class="linenum"> 778</span></a>  <span class="comment"> * @param bool $doanything If false, ignore effect of admin role assignment</span>
<a name="l779"><span class="linenum"> 779</span></a>  <span class="comment"> * @param string $errormessage The error string to to user. Defaults to 'nopermissions'.</span>
<a name="l780"><span class="linenum"> 780</span></a>  <span class="comment"> * @param string $stringfile The language file to load the error string from. Defaults to 'error'.</span>
<a name="l781"><span class="linenum"> 781</span></a>  <span class="comment"> * @return void terminates with an error if the user does not have the given capability.</span>
<a name="l782"><span class="linenum"> 782</span></a>  <span class="comment"> */</span>
<a name="l783"><span class="linenum"> 783</span></a>  function <a class="function" onClick="logFunction('require_capability')" href="../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>(<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> = null, <a class="var it28638" onMouseOver="hilite(28638)" onMouseOut="lolite()" onClick="logVariable('doanything')" href="../_variables/doanything.html">$doanything</a> = true,
<a name="l784"><span class="linenum"> 784</span></a>                              <a class="var it3102" onMouseOver="hilite(3102)" onMouseOut="lolite()" onClick="logVariable('errormessage')" href="../_variables/errormessage.html">$errormessage</a> = 'nopermissions', <a class="var it28802" onMouseOver="hilite(28802)" onMouseOut="lolite()" onClick="logVariable('stringfile')" href="../_variables/stringfile.html">$stringfile</a> = '') {
<a name="l785"><span class="linenum"> 785</span></a>      if (!<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it28638" onMouseOver="hilite(28638)" onMouseOut="lolite()" onClick="logVariable('doanything')" href="../_variables/doanything.html">$doanything</a>)) {
<a name="l786"><span class="linenum"> 786</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, <a class="var it3102" onMouseOver="hilite(3102)" onMouseOut="lolite()" onClick="logVariable('errormessage')" href="../_variables/errormessage.html">$errormessage</a>, <a class="var it28802" onMouseOver="hilite(28802)" onMouseOut="lolite()" onClick="logVariable('stringfile')" href="../_variables/stringfile.html">$stringfile</a>);
<a name="l787"><span class="linenum"> 787</span></a>      }
<a name="l788"><span class="linenum"> 788</span></a>  }
<a name="l789"><span class="linenum"> 789</span></a>  
<a name="l790"><span class="linenum"> 790</span></a>  <span class="comment">/**</span>
<a name="l791"><span class="linenum"> 791</span></a>  <span class="comment"> * Return a nested array showing role assignments</span>
<a name="l792"><span class="linenum"> 792</span></a>  <span class="comment"> * all relevant role capabilities for the user at</span>
<a name="l793"><span class="linenum"> 793</span></a>  <span class="comment"> * site/course_category/course levels</span>
<a name="l794"><span class="linenum"> 794</span></a>  <span class="comment"> *</span>
<a name="l795"><span class="linenum"> 795</span></a>  <span class="comment"> * We do _not_ delve deeper than courses because the number of</span>
<a name="l796"><span class="linenum"> 796</span></a>  <span class="comment"> * overrides at the module/block levels can be HUGE.</span>
<a name="l797"><span class="linenum"> 797</span></a>  <span class="comment"> *</span>
<a name="l798"><span class="linenum"> 798</span></a>  <span class="comment"> * [ra]   =&gt; [/path][roleid]=roleid</span>
<a name="l799"><span class="linenum"> 799</span></a>  <span class="comment"> * [rdef] =&gt; [/path:roleid][capability]=permission</span>
<a name="l800"><span class="linenum"> 800</span></a>  <span class="comment"> *</span>
<a name="l801"><span class="linenum"> 801</span></a>  <span class="comment"> * @access private</span>
<a name="l802"><span class="linenum"> 802</span></a>  <span class="comment"> * @param int $userid - the id of the user</span>
<a name="l803"><span class="linenum"> 803</span></a>  <span class="comment"> * @return array access info array</span>
<a name="l804"><span class="linenum"> 804</span></a>  <span class="comment"> */</span>
<a name="l805"><span class="linenum"> 805</span></a>  function <a class="function" onClick="logFunction('get_user_access_sitewide')" href="../_functions/get_user_access_sitewide.html" onMouseOver="funcPopup(event,'get_user_access_sitewide')">get_user_access_sitewide</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) {
<a name="l806"><span class="linenum"> 806</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>;
<a name="l807"><span class="linenum"> 807</span></a>  
<a name="l808"><span class="linenum"> 808</span></a>      <span class="comment">/* Get in a few cheap DB queries...</span>
<a name="l809"><span class="linenum"> 809</span></a>  <span class="comment">     * - role assignments</span>
<a name="l810"><span class="linenum"> 810</span></a>  <span class="comment">     * - relevant role caps</span>
<a name="l811"><span class="linenum"> 811</span></a>  <span class="comment">     *   - above and within this user's RAs</span>
<a name="l812"><span class="linenum"> 812</span></a>  <span class="comment">     *   - below this user's RAs - limited to course level</span>
<a name="l813"><span class="linenum"> 813</span></a>  <span class="comment">     */</span>
<a name="l814"><span class="linenum"> 814</span></a>  
<a name="l815"><span class="linenum"> 815</span></a>  <span class="comment">    // raparents collects paths &amp; roles we need to walk up the parenthood to build the minimal rdef</span>
<a name="l816"><span class="linenum"> 816</span></a>      <a class="var it28803" onMouseOver="hilite(28803)" onMouseOut="lolite()" onClick="logVariable('raparents')" href="../_variables/raparents.html">$raparents</a> = array();
<a name="l817"><span class="linenum"> 817</span></a>      <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a> = <a class="function" onClick="logFunction('get_empty_accessdata')" href="../_functions/get_empty_accessdata.html" onMouseOver="funcPopup(event,'get_empty_accessdata')">get_empty_accessdata</a>();
<a name="l818"><span class="linenum"> 818</span></a>  
<a name="l819"><span class="linenum"> 819</span></a>  <span class="comment">    // start with the default role</span>
<a name="l820"><span class="linenum"> 820</span></a>      if (!empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultuserroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultuserroleid.html">defaultuserroleid</a>)) {
<a name="l821"><span class="linenum"> 821</span></a>          <a class="var it1172" onMouseOver="hilite(1172)" onMouseOut="lolite()" onClick="logVariable('syscontext')" href="../_variables/syscontext.html">$syscontext</a> = <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l822"><span class="linenum"> 822</span></a>          <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['ra'][<a class="var it1172" onMouseOver="hilite(1172)" onMouseOut="lolite()" onClick="logVariable('syscontext')" href="../_variables/syscontext.html">$syscontext</a>-&gt;<a onClick="logVariable('path')" class="var it39448" onMouseOver="hilite(39448)" onMouseOut="lolite()" href="../_variables/path.html">path</a>][(int)<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultuserroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultuserroleid.html">defaultuserroleid</a>] = (int)<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultuserroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultuserroleid.html">defaultuserroleid</a>;
<a name="l823"><span class="linenum"> 823</span></a>          <a class="var it28803" onMouseOver="hilite(28803)" onMouseOut="lolite()" onClick="logVariable('raparents')" href="../_variables/raparents.html">$raparents</a>[<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultuserroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultuserroleid.html">defaultuserroleid</a>][<a class="var it1172" onMouseOver="hilite(1172)" onMouseOut="lolite()" onClick="logVariable('syscontext')" href="../_variables/syscontext.html">$syscontext</a>-&gt;<a onClick="logVariable('id')" class="var it39448" onMouseOver="hilite(39448)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="var it1172" onMouseOver="hilite(1172)" onMouseOut="lolite()" onClick="logVariable('syscontext')" href="../_variables/syscontext.html">$syscontext</a>-&gt;<a onClick="logVariable('id')" class="var it39448" onMouseOver="hilite(39448)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l824"><span class="linenum"> 824</span></a>      }
<a name="l825"><span class="linenum"> 825</span></a>  
<a name="l826"><span class="linenum"> 826</span></a>  <span class="comment">    // load the &quot;default frontpage role&quot;</span>
<a name="l827"><span class="linenum"> 827</span></a>      if (!empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultfrontpageroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultfrontpageroleid.html">defaultfrontpageroleid</a>)) {
<a name="l828"><span class="linenum"> 828</span></a>          <a class="var it17355" onMouseOver="hilite(17355)" onMouseOut="lolite()" onClick="logVariable('frontpagecontext')" href="../_variables/frontpagecontext.html">$frontpagecontext</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="function" onClick="logFunction('get_site')" href="../_functions/get_site.html" onMouseOver="funcPopup(event,'get_site')">get_site</a>()-&gt;id);
<a name="l829"><span class="linenum"> 829</span></a>          if (<a class="var it17355" onMouseOver="hilite(17355)" onMouseOut="lolite()" onClick="logVariable('frontpagecontext')" href="../_variables/frontpagecontext.html">$frontpagecontext</a>-&gt;<a onClick="logVariable('path')" class="var it40980" onMouseOver="hilite(40980)" onMouseOut="lolite()" href="../_variables/path.html">path</a>) {
<a name="l830"><span class="linenum"> 830</span></a>              <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['ra'][<a class="var it17355" onMouseOver="hilite(17355)" onMouseOut="lolite()" onClick="logVariable('frontpagecontext')" href="../_variables/frontpagecontext.html">$frontpagecontext</a>-&gt;<a onClick="logVariable('path')" class="var it40980" onMouseOver="hilite(40980)" onMouseOut="lolite()" href="../_variables/path.html">path</a>][(int)<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultfrontpageroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultfrontpageroleid.html">defaultfrontpageroleid</a>] = (int)<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultfrontpageroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultfrontpageroleid.html">defaultfrontpageroleid</a>;
<a name="l831"><span class="linenum"> 831</span></a>              <a class="var it28803" onMouseOver="hilite(28803)" onMouseOut="lolite()" onClick="logVariable('raparents')" href="../_variables/raparents.html">$raparents</a>[<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultfrontpageroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultfrontpageroleid.html">defaultfrontpageroleid</a>][<a class="var it17355" onMouseOver="hilite(17355)" onMouseOut="lolite()" onClick="logVariable('frontpagecontext')" href="../_variables/frontpagecontext.html">$frontpagecontext</a>-&gt;<a onClick="logVariable('id')" class="var it40980" onMouseOver="hilite(40980)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="var it17355" onMouseOver="hilite(17355)" onMouseOut="lolite()" onClick="logVariable('frontpagecontext')" href="../_variables/frontpagecontext.html">$frontpagecontext</a>-&gt;<a onClick="logVariable('id')" class="var it40980" onMouseOver="hilite(40980)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l832"><span class="linenum"> 832</span></a>          }
<a name="l833"><span class="linenum"> 833</span></a>      }
<a name="l834"><span class="linenum"> 834</span></a>  
<a name="l835"><span class="linenum"> 835</span></a>  <span class="comment">    // preload every assigned role at and above course context</span>
<a name="l836"><span class="linenum"> 836</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT ctx.path, ra.roleid, ra.contextid
<a name="l837"><span class="linenum"> 837</span></a>                FROM {role_assignments} ra
<a name="l838"><span class="linenum"> 838</span></a>                JOIN {context} ctx
<a name="l839"><span class="linenum"> 839</span></a>                     ON ctx.id = ra.contextid
<a name="l840"><span class="linenum"> 840</span></a>           LEFT JOIN {block_instances} bi
<a name="l841"><span class="linenum"> 841</span></a>                     <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (ctx.contextlevel = &quot;.<a class="constant" onClick="logConstant('CONTEXT_BLOCK')" href="../_constants/CONTEXT_BLOCK.html" onMouseOver="constPopup(event,'CONTEXT_BLOCK')">CONTEXT_BLOCK</a>.&quot; AND bi.id = ctx.instanceid)
<a name="l842"><span class="linenum"> 842</span></a>           LEFT JOIN {context} bpctx
<a name="l843"><span class="linenum"> 843</span></a>                     <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (bpctx.id = bi.parentcontextid)
<a name="l844"><span class="linenum"> 844</span></a>               WHERE ra.userid = :userid
<a name="l845"><span class="linenum"> 845</span></a>                     AND (ctx.contextlevel &lt;= &quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>.&quot; OR bpctx.contextlevel &lt; &quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>.&quot;)&quot;;
<a name="l846"><span class="linenum"> 846</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array('userid'=&gt;<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>);
<a name="l847"><span class="linenum"> 847</span></a>      <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l848"><span class="linenum"> 848</span></a>      foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> as <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>) {
<a name="l849"><span class="linenum"> 849</span></a>  <span class="comment">        // RAs leafs are arrays to support multi-role assignments...</span>
<a name="l850"><span class="linenum"> 850</span></a>          <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['ra'][<a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('path')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/path.html">path</a>][(int)<a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('roleid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>] = (int)<a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('roleid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>;
<a name="l851"><span class="linenum"> 851</span></a>          <a class="var it28803" onMouseOver="hilite(28803)" onMouseOut="lolite()" onClick="logVariable('raparents')" href="../_variables/raparents.html">$raparents</a>[<a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('roleid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>][<a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('contextid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/contextid.html">contextid</a>] = <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('contextid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/contextid.html">contextid</a>;
<a name="l852"><span class="linenum"> 852</span></a>      }
<a name="l853"><span class="linenum"> 853</span></a>      <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l854"><span class="linenum"> 854</span></a>  
<a name="l855"><span class="linenum"> 855</span></a>      if (empty(<a class="var it28803" onMouseOver="hilite(28803)" onMouseOut="lolite()" onClick="logVariable('raparents')" href="../_variables/raparents.html">$raparents</a>)) {
<a name="l856"><span class="linenum"> 856</span></a>          return <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>;
<a name="l857"><span class="linenum"> 857</span></a>      }
<a name="l858"><span class="linenum"> 858</span></a>  
<a name="l859"><span class="linenum"> 859</span></a>  <span class="comment">    // now get overrides of interesting roles in all interesting child contexts</span>
<a name="l860"><span class="linenum"> 860</span></a>  <span class="comment">    // hopefully we will not run out of SQL limits here,</span>
<a name="l861"><span class="linenum"> 861</span></a>  <span class="comment">    // users would have to have very many roles at/above course context...</span>
<a name="l862"><span class="linenum"> 862</span></a>      <a class="var it1474" onMouseOver="hilite(1474)" onMouseOut="lolite()" onClick="logVariable('sqls')" href="../_variables/sqls.html">$sqls</a> = array();
<a name="l863"><span class="linenum"> 863</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array();
<a name="l864"><span class="linenum"> 864</span></a>  
<a name="l865"><span class="linenum"> 865</span></a>      static <a class="var it7114" onMouseOver="hilite(7114)" onMouseOut="lolite()" onClick="logVariable('cp')" href="../_variables/cp.html">$cp</a> = 0;
<a name="l866"><span class="linenum"> 866</span></a>      foreach (<a class="var it28803" onMouseOver="hilite(28803)" onMouseOut="lolite()" onClick="logVariable('raparents')" href="../_variables/raparents.html">$raparents</a> as <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>=&gt;<a class="var it11181" onMouseOver="hilite(11181)" onMouseOut="lolite()" onClick="logVariable('ras')" href="../_variables/ras.html">$ras</a>) {
<a name="l867"><span class="linenum"> 867</span></a>          <a class="var it7114" onMouseOver="hilite(7114)" onMouseOut="lolite()" onClick="logVariable('cp')" href="../_variables/cp.html">$cp</a>++;
<a name="l868"><span class="linenum"> 868</span></a>          <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it28804" onMouseOver="hilite(28804)" onMouseOut="lolite()" onClick="logVariable('sqlcids')" href="../_variables/sqlcids.html">$sqlcids</a>, <a class="var it28805" onMouseOver="hilite(28805)" onMouseOut="lolite()" onClick="logVariable('cids')" href="../_variables/cids.html">$cids</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it11181" onMouseOver="hilite(11181)" onMouseOut="lolite()" onClick="logVariable('ras')" href="../_variables/ras.html">$ras</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'c'.<a class="var it7114" onMouseOver="hilite(7114)" onMouseOut="lolite()" onClick="logVariable('cp')" href="../_variables/cp.html">$cp</a>.'_');
<a name="l869"><span class="linenum"> 869</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it28805" onMouseOver="hilite(28805)" onMouseOut="lolite()" onClick="logVariable('cids')" href="../_variables/cids.html">$cids</a>);
<a name="l870"><span class="linenum"> 870</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['r'.<a class="var it7114" onMouseOver="hilite(7114)" onMouseOut="lolite()" onClick="logVariable('cp')" href="../_variables/cp.html">$cp</a>] = <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>;
<a name="l871"><span class="linenum"> 871</span></a>          <a class="var it1474" onMouseOver="hilite(1474)" onMouseOut="lolite()" onClick="logVariable('sqls')" href="../_variables/sqls.html">$sqls</a>[] = &quot;(SELECT ctx.path, rc.roleid, rc.capability, rc.permission
<a name="l872"><span class="linenum"> 872</span></a>                       FROM {role_capabilities} rc
<a name="l873"><span class="linenum"> 873</span></a>                       JOIN {context} ctx
<a name="l874"><span class="linenum"> 874</span></a>                            <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (ctx.id = rc.contextid)
<a name="l875"><span class="linenum"> 875</span></a>                       JOIN {context} pctx
<a name="l876"><span class="linenum"> 876</span></a>                            <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (pctx.id <a class="var it28804" onMouseOver="hilite(28804)" onMouseOut="lolite()" onClick="logVariable('sqlcids')" href="../_variables/sqlcids.html">$sqlcids</a>
<a name="l877"><span class="linenum"> 877</span></a>                                AND (ctx.id = pctx.id
<a name="l878"><span class="linenum"> 878</span></a>                                     OR ctx.path LIKE &quot;.<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_concat')" href="../_functions/sql_concat.html" onMouseOver="funcPopup(event,'sql_concat')">sql_concat</a>('pctx.path',&quot;'/%'&quot;).&quot;
<a name="l879"><span class="linenum"> 879</span></a>                                     OR pctx.path LIKE &quot;.<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_concat')" href="../_functions/sql_concat.html" onMouseOver="funcPopup(event,'sql_concat')">sql_concat</a>('ctx.path',&quot;'/%'&quot;).&quot;))
<a name="l880"><span class="linenum"> 880</span></a>                  LEFT JOIN {block_instances} bi
<a name="l881"><span class="linenum"> 881</span></a>                            <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (ctx.contextlevel = &quot;.<a class="constant" onClick="logConstant('CONTEXT_BLOCK')" href="../_constants/CONTEXT_BLOCK.html" onMouseOver="constPopup(event,'CONTEXT_BLOCK')">CONTEXT_BLOCK</a>.&quot; AND bi.id = ctx.instanceid)
<a name="l882"><span class="linenum"> 882</span></a>                  LEFT JOIN {context} bpctx
<a name="l883"><span class="linenum"> 883</span></a>                            <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (bpctx.id = bi.parentcontextid)
<a name="l884"><span class="linenum"> 884</span></a>                      WHERE rc.roleid = :r{<a class="var it7114" onMouseOver="hilite(7114)" onMouseOut="lolite()" onClick="logVariable('cp')" href="../_variables/cp.html">$cp</a>}
<a name="l885"><span class="linenum"> 885</span></a>                            AND (ctx.contextlevel &lt;= &quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>.&quot; OR bpctx.contextlevel &lt; &quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>.&quot;)
<a name="l886"><span class="linenum"> 886</span></a>                     )&quot;;
<a name="l887"><span class="linenum"> 887</span></a>      }
<a name="l888"><span class="linenum"> 888</span></a>  
<a name="l889"><span class="linenum"> 889</span></a>  <span class="comment">    // fixed capability order is necessary for rdef dedupe</span>
<a name="l890"><span class="linenum"> 890</span></a>      <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(&quot;\nUNION\n&quot;, <a class="var it1474" onMouseOver="hilite(1474)" onMouseOut="lolite()" onClick="logVariable('sqls')" href="../_variables/sqls.html">$sqls</a>). &quot;ORDER BY capability&quot;, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l891"><span class="linenum"> 891</span></a>  
<a name="l892"><span class="linenum"> 892</span></a>      foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> as <a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>) {
<a name="l893"><span class="linenum"> 893</span></a>          <a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a> = <a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>-&gt;<a onClick="logVariable('path')" class="var it40976" onMouseOver="hilite(40976)" onMouseOut="lolite()" href="../_variables/path.html">path</a>.':'.<a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>-&gt;<a onClick="logVariable('roleid')" class="var it40976" onMouseOver="hilite(40976)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>;
<a name="l894"><span class="linenum"> 894</span></a>          <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rdef'][<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>][<a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>-&gt;<a onClick="logVariable('capability')" class="var it40976" onMouseOver="hilite(40976)" onMouseOut="lolite()" href="../_variables/capability.html">capability</a>] = (int)<a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>-&gt;<a onClick="logVariable('permission')" class="var it40976" onMouseOver="hilite(40976)" onMouseOut="lolite()" href="../_variables/permission.html">permission</a>;
<a name="l895"><span class="linenum"> 895</span></a>      }
<a name="l896"><span class="linenum"> 896</span></a>      <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l897"><span class="linenum"> 897</span></a>  
<a name="l898"><span class="linenum"> 898</span></a>  <span class="comment">    // share the role definitions</span>
<a name="l899"><span class="linenum"> 899</span></a>      foreach (<a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rdef'] as <a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>=&gt;<a class="var it1136" onMouseOver="hilite(1136)" onMouseOut="lolite()" onClick="logVariable('unused')" href="../_variables/unused.html">$unused</a>) {
<a name="l900"><span class="linenum"> 900</span></a>          if (!isset(<a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('rolepermissions')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/rolepermissions.html">rolepermissions</a>[<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>])) {
<a name="l901"><span class="linenum"> 901</span></a>              <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('rolepermissions')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/rolepermissions.html">rolepermissions</a>[<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>] = <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rdef'][<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>];
<a name="l902"><span class="linenum"> 902</span></a>          }
<a name="l903"><span class="linenum"> 903</span></a>          <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rdef_count']++;
<a name="l904"><span class="linenum"> 904</span></a>          <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rdef'][<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>] =&amp; <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('rolepermissions')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/rolepermissions.html">rolepermissions</a>[<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>];
<a name="l905"><span class="linenum"> 905</span></a>      }
<a name="l906"><span class="linenum"> 906</span></a>  
<a name="l907"><span class="linenum"> 907</span></a>      return <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>;
<a name="l908"><span class="linenum"> 908</span></a>  }
<a name="l909"><span class="linenum"> 909</span></a>  
<a name="l910"><span class="linenum"> 910</span></a>  <span class="comment">/**</span>
<a name="l911"><span class="linenum"> 911</span></a>  <span class="comment"> * Add to the access ctrl array the data needed by a user for a given course.</span>
<a name="l912"><span class="linenum"> 912</span></a>  <span class="comment"> *</span>
<a name="l913"><span class="linenum"> 913</span></a>  <span class="comment"> * This function injects all course related access info into the accessdata array.</span>
<a name="l914"><span class="linenum"> 914</span></a>  <span class="comment"> *</span>
<a name="l915"><span class="linenum"> 915</span></a>  <span class="comment"> * @access private</span>
<a name="l916"><span class="linenum"> 916</span></a>  <span class="comment"> * @param int $userid the id of the user</span>
<a name="l917"><span class="linenum"> 917</span></a>  <span class="comment"> * @param context_course $coursecontext course context</span>
<a name="l918"><span class="linenum"> 918</span></a>  <span class="comment"> * @param array $accessdata accessdata array (modified)</span>
<a name="l919"><span class="linenum"> 919</span></a>  <span class="comment"> * @return void modifies $accessdata parameter</span>
<a name="l920"><span class="linenum"> 920</span></a>  <span class="comment"> */</span>
<a name="l921"><span class="linenum"> 921</span></a>  function <a class="function" onClick="logFunction('load_course_context')" href="../_functions/load_course_context.html" onMouseOver="funcPopup(event,'load_course_context')">load_course_context</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, context_course <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>, &amp;<a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>) {
<a name="l922"><span class="linenum"> 922</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>;
<a name="l923"><span class="linenum"> 923</span></a>  
<a name="l924"><span class="linenum"> 924</span></a>      if (empty(<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('path')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/path.html">path</a>)) {
<a name="l925"><span class="linenum"> 925</span></a>  <span class="comment">        // weird, this should not happen</span>
<a name="l926"><span class="linenum"> 926</span></a>          return;
<a name="l927"><span class="linenum"> 927</span></a>      }
<a name="l928"><span class="linenum"> 928</span></a>  
<a name="l929"><span class="linenum"> 929</span></a>      if (isset(<a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['loaded'][<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>])) {
<a name="l930"><span class="linenum"> 930</span></a>  <span class="comment">        // already loaded, great!</span>
<a name="l931"><span class="linenum"> 931</span></a>          return;
<a name="l932"><span class="linenum"> 932</span></a>      }
<a name="l933"><span class="linenum"> 933</span></a>  
<a name="l934"><span class="linenum"> 934</span></a>      <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a> = array();
<a name="l935"><span class="linenum"> 935</span></a>  
<a name="l936"><span class="linenum"> 936</span></a>      if (empty(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>)) {
<a name="l937"><span class="linenum"> 937</span></a>          if (!empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('notloggedinroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/notloggedinroleid.html">notloggedinroleid</a>)) {
<a name="l938"><span class="linenum"> 938</span></a>              <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>[<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('notloggedinroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/notloggedinroleid.html">notloggedinroleid</a>] = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('notloggedinroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/notloggedinroleid.html">notloggedinroleid</a>;
<a name="l939"><span class="linenum"> 939</span></a>          }
<a name="l940"><span class="linenum"> 940</span></a>  
<a name="l941"><span class="linenum"> 941</span></a>      } else if (<a class="function" onClick="logFunction('isguestuser')" href="../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>)) {
<a name="l942"><span class="linenum"> 942</span></a>          if (<a class="var it359" onMouseOver="hilite(359)" onMouseOut="lolite()" onClick="logVariable('guestrole')" href="../_variables/guestrole.html">$guestrole</a> = <a class="function" onClick="logFunction('get_guest_role')" href="../_functions/get_guest_role.html" onMouseOver="funcPopup(event,'get_guest_role')">get_guest_role</a>()) {
<a name="l943"><span class="linenum"> 943</span></a>              <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>[<a class="var it359" onMouseOver="hilite(359)" onMouseOut="lolite()" onClick="logVariable('guestrole')" href="../_variables/guestrole.html">$guestrole</a>-&gt;<a onClick="logVariable('id')" class="var it40977" onMouseOver="hilite(40977)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="var it359" onMouseOver="hilite(359)" onMouseOut="lolite()" onClick="logVariable('guestrole')" href="../_variables/guestrole.html">$guestrole</a>-&gt;<a onClick="logVariable('id')" class="var it40977" onMouseOver="hilite(40977)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l944"><span class="linenum"> 944</span></a>          }
<a name="l945"><span class="linenum"> 945</span></a>  
<a name="l946"><span class="linenum"> 946</span></a>      } else {
<a name="l947"><span class="linenum"> 947</span></a>  <span class="comment">        // Interesting role assignments at, above and below the course context</span>
<a name="l948"><span class="linenum"> 948</span></a>          <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it28806" onMouseOver="hilite(28806)" onMouseOut="lolite()" onClick="logVariable('parentsaself')" href="../_variables/parentsaself.html">$parentsaself</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a class="function" onClick="logFunction('get_parent_context_ids')" href="../_functions/get_parent_context_ids.html" onMouseOver="funcPopup(event,'get_parent_context_ids')">get_parent_context_ids</a>(true), <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'pc_');
<a name="l949"><span class="linenum"> 949</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['userid'] = <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>;
<a name="l950"><span class="linenum"> 950</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['children'] = <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('path')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/path.html">path</a>.&quot;/%&quot;;
<a name="l951"><span class="linenum"> 951</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT ra.*, ctx.path
<a name="l952"><span class="linenum"> 952</span></a>                    FROM {role_assignments} ra
<a name="l953"><span class="linenum"> 953</span></a>                    JOIN {context} ctx ON ra.contextid = ctx.id
<a name="l954"><span class="linenum"> 954</span></a>                   WHERE ra.userid = :userid AND (ctx.id <a class="var it28806" onMouseOver="hilite(28806)" onMouseOut="lolite()" onClick="logVariable('parentsaself')" href="../_variables/parentsaself.html">$parentsaself</a> OR ctx.path LIKE :children)&quot;;
<a name="l955"><span class="linenum"> 955</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l956"><span class="linenum"> 956</span></a>  
<a name="l957"><span class="linenum"> 957</span></a>  <span class="comment">        // add missing role definitions</span>
<a name="l958"><span class="linenum"> 958</span></a>          foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> as <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>) {
<a name="l959"><span class="linenum"> 959</span></a>              <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['ra'][<a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('path')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/path.html">path</a>][(int)<a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('roleid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>] = (int)<a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('roleid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>;
<a name="l960"><span class="linenum"> 960</span></a>              <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>[<a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('roleid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>] = <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('roleid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>;
<a name="l961"><span class="linenum"> 961</span></a>          }
<a name="l962"><span class="linenum"> 962</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l963"><span class="linenum"> 963</span></a>  
<a name="l964"><span class="linenum"> 964</span></a>  <span class="comment">        // add the &quot;default frontpage role&quot; when on the frontpage</span>
<a name="l965"><span class="linenum"> 965</span></a>          if (!empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultfrontpageroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultfrontpageroleid.html">defaultfrontpageroleid</a>)) {
<a name="l966"><span class="linenum"> 966</span></a>              <a class="var it17355" onMouseOver="hilite(17355)" onMouseOut="lolite()" onClick="logVariable('frontpagecontext')" href="../_variables/frontpagecontext.html">$frontpagecontext</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="function" onClick="logFunction('get_site')" href="../_functions/get_site.html" onMouseOver="funcPopup(event,'get_site')">get_site</a>()-&gt;id);
<a name="l967"><span class="linenum"> 967</span></a>              if (<a class="var it17355" onMouseOver="hilite(17355)" onMouseOut="lolite()" onClick="logVariable('frontpagecontext')" href="../_variables/frontpagecontext.html">$frontpagecontext</a>-&gt;<a onClick="logVariable('id')" class="var it40980" onMouseOver="hilite(40980)" onMouseOut="lolite()" href="../_variables/id.html">id</a> == <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('id')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) {
<a name="l968"><span class="linenum"> 968</span></a>                  <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>[<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultfrontpageroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultfrontpageroleid.html">defaultfrontpageroleid</a>] = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultfrontpageroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultfrontpageroleid.html">defaultfrontpageroleid</a>;
<a name="l969"><span class="linenum"> 969</span></a>              }
<a name="l970"><span class="linenum"> 970</span></a>          }
<a name="l971"><span class="linenum"> 971</span></a>  
<a name="l972"><span class="linenum"> 972</span></a>  <span class="comment">        // do not forget the default role</span>
<a name="l973"><span class="linenum"> 973</span></a>          if (!empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultuserroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultuserroleid.html">defaultuserroleid</a>)) {
<a name="l974"><span class="linenum"> 974</span></a>              <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>[<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultuserroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultuserroleid.html">defaultuserroleid</a>] = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultuserroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultuserroleid.html">defaultuserroleid</a>;
<a name="l975"><span class="linenum"> 975</span></a>          }
<a name="l976"><span class="linenum"> 976</span></a>      }
<a name="l977"><span class="linenum"> 977</span></a>  
<a name="l978"><span class="linenum"> 978</span></a>      if (!<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>) {
<a name="l979"><span class="linenum"> 979</span></a>  <span class="comment">        // weird, default roles must be missing...</span>
<a name="l980"><span class="linenum"> 980</span></a>          <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['loaded'][<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>] = 1;
<a name="l981"><span class="linenum"> 981</span></a>          return;
<a name="l982"><span class="linenum"> 982</span></a>      }
<a name="l983"><span class="linenum"> 983</span></a>  
<a name="l984"><span class="linenum"> 984</span></a>  <span class="comment">    // now get overrides of interesting roles in all interesting contexts (this course + children + parents)</span>
<a name="l985"><span class="linenum"> 985</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array('c'=&gt;<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('id')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l986"><span class="linenum"> 986</span></a>      <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it28806" onMouseOver="hilite(28806)" onMouseOut="lolite()" onClick="logVariable('parentsaself')" href="../_variables/parentsaself.html">$parentsaself</a>, <a class="var it532" onMouseOver="hilite(532)" onMouseOut="lolite()" onClick="logVariable('rparams')" href="../_variables/rparams.html">$rparams</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a class="function" onClick="logFunction('get_parent_context_ids')" href="../_functions/get_parent_context_ids.html" onMouseOver="funcPopup(event,'get_parent_context_ids')">get_parent_context_ids</a>(true), <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'pc_');
<a name="l987"><span class="linenum"> 987</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it532" onMouseOver="hilite(532)" onMouseOut="lolite()" onClick="logVariable('rparams')" href="../_variables/rparams.html">$rparams</a>);
<a name="l988"><span class="linenum"> 988</span></a>      <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it3996" onMouseOver="hilite(3996)" onMouseOut="lolite()" onClick="logVariable('roleids')" href="../_variables/roleids.html">$roleids</a>, <a class="var it532" onMouseOver="hilite(532)" onMouseOut="lolite()" onClick="logVariable('rparams')" href="../_variables/rparams.html">$rparams</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'r_');
<a name="l989"><span class="linenum"> 989</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it532" onMouseOver="hilite(532)" onMouseOut="lolite()" onClick="logVariable('rparams')" href="../_variables/rparams.html">$rparams</a>);
<a name="l990"><span class="linenum"> 990</span></a>  
<a name="l991"><span class="linenum"> 991</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT ctx.path, rc.roleid, rc.capability, rc.permission
<a name="l992"><span class="linenum"> 992</span></a>                   FROM {role_capabilities} rc
<a name="l993"><span class="linenum"> 993</span></a>                   JOIN {context} ctx
<a name="l994"><span class="linenum"> 994</span></a>                        <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (ctx.id = rc.contextid)
<a name="l995"><span class="linenum"> 995</span></a>                   JOIN {context} cctx
<a name="l996"><span class="linenum"> 996</span></a>                        <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (cctx.id = :c
<a name="l997"><span class="linenum"> 997</span></a>                            AND (ctx.id <a class="var it28806" onMouseOver="hilite(28806)" onMouseOut="lolite()" onClick="logVariable('parentsaself')" href="../_variables/parentsaself.html">$parentsaself</a> OR ctx.path LIKE &quot;.<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_concat')" href="../_functions/sql_concat.html" onMouseOver="funcPopup(event,'sql_concat')">sql_concat</a>('cctx.path',&quot;'/%'&quot;).&quot;))
<a name="l998"><span class="linenum"> 998</span></a>                  WHERE rc.roleid <a class="var it3996" onMouseOver="hilite(3996)" onMouseOut="lolite()" onClick="logVariable('roleids')" href="../_variables/roleids.html">$roleids</a>
<a name="l999"><span class="linenum"> 999</span></a>               ORDER BY rc.capability&quot;; <span class="comment">// fixed capability order is necessary for rdef dedupe</span>
<a name="l1000"><span class="linenum">1000</span></a>      <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l1001"><span class="linenum">1001</span></a>  
<a name="l1002"><span class="linenum">1002</span></a>      <a class="var it28807" onMouseOver="hilite(28807)" onMouseOut="lolite()" onClick="logVariable('newrdefs')" href="../_variables/newrdefs.html">$newrdefs</a> = array();
<a name="l1003"><span class="linenum">1003</span></a>      foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> as <a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>) {
<a name="l1004"><span class="linenum">1004</span></a>          <a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a> = <a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>-&gt;<a onClick="logVariable('path')" class="var it40976" onMouseOver="hilite(40976)" onMouseOut="lolite()" href="../_variables/path.html">path</a>.':'.<a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>-&gt;<a onClick="logVariable('roleid')" class="var it40976" onMouseOver="hilite(40976)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>;
<a name="l1005"><span class="linenum">1005</span></a>          if (isset(<a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rdef'][<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>])) {
<a name="l1006"><span class="linenum">1006</span></a>              continue;
<a name="l1007"><span class="linenum">1007</span></a>          }
<a name="l1008"><span class="linenum">1008</span></a>          <a class="var it28807" onMouseOver="hilite(28807)" onMouseOut="lolite()" onClick="logVariable('newrdefs')" href="../_variables/newrdefs.html">$newrdefs</a>[<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>][<a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>-&gt;<a onClick="logVariable('capability')" class="var it40976" onMouseOver="hilite(40976)" onMouseOut="lolite()" href="../_variables/capability.html">capability</a>] = (int)<a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>-&gt;<a onClick="logVariable('permission')" class="var it40976" onMouseOver="hilite(40976)" onMouseOut="lolite()" href="../_variables/permission.html">permission</a>;
<a name="l1009"><span class="linenum">1009</span></a>      }
<a name="l1010"><span class="linenum">1010</span></a>      <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l1011"><span class="linenum">1011</span></a>  
<a name="l1012"><span class="linenum">1012</span></a>  <span class="comment">    // share new role definitions</span>
<a name="l1013"><span class="linenum">1013</span></a>      foreach (<a class="var it28807" onMouseOver="hilite(28807)" onMouseOut="lolite()" onClick="logVariable('newrdefs')" href="../_variables/newrdefs.html">$newrdefs</a> as <a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>=&gt;<a class="var it1136" onMouseOver="hilite(1136)" onMouseOut="lolite()" onClick="logVariable('unused')" href="../_variables/unused.html">$unused</a>) {
<a name="l1014"><span class="linenum">1014</span></a>          if (!isset(<a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('rolepermissions')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/rolepermissions.html">rolepermissions</a>[<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>])) {
<a name="l1015"><span class="linenum">1015</span></a>              <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('rolepermissions')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/rolepermissions.html">rolepermissions</a>[<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>] = <a class="var it28807" onMouseOver="hilite(28807)" onMouseOut="lolite()" onClick="logVariable('newrdefs')" href="../_variables/newrdefs.html">$newrdefs</a>[<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>];
<a name="l1016"><span class="linenum">1016</span></a>          }
<a name="l1017"><span class="linenum">1017</span></a>          <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rdef_count']++;
<a name="l1018"><span class="linenum">1018</span></a>          <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rdef'][<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>] =&amp; <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('rolepermissions')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/rolepermissions.html">rolepermissions</a>[<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>];
<a name="l1019"><span class="linenum">1019</span></a>      }
<a name="l1020"><span class="linenum">1020</span></a>  
<a name="l1021"><span class="linenum">1021</span></a>      <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['loaded'][<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>] = 1;
<a name="l1022"><span class="linenum">1022</span></a>  
<a name="l1023"><span class="linenum">1023</span></a>  <span class="comment">    // we want to deduplicate the USER-&gt;access from time to time, this looks like a good place,</span>
<a name="l1024"><span class="linenum">1024</span></a>  <span class="comment">    // because we have to do it before the end of session</span>
<a name="l1025"><span class="linenum">1025</span></a>      <a class="function" onClick="logFunction('dedupe_user_access')" href="../_functions/dedupe_user_access.html" onMouseOver="funcPopup(event,'dedupe_user_access')">dedupe_user_access</a>();
<a name="l1026"><span class="linenum">1026</span></a>  }
<a name="l1027"><span class="linenum">1027</span></a>  
<a name="l1028"><span class="linenum">1028</span></a>  <span class="comment">/**</span>
<a name="l1029"><span class="linenum">1029</span></a>  <span class="comment"> * Add to the access ctrl array the data needed by a role for a given context.</span>
<a name="l1030"><span class="linenum">1030</span></a>  <span class="comment"> *</span>
<a name="l1031"><span class="linenum">1031</span></a>  <span class="comment"> * The data is added in the rdef key.</span>
<a name="l1032"><span class="linenum">1032</span></a>  <span class="comment"> * This role-centric function is useful for role_switching</span>
<a name="l1033"><span class="linenum">1033</span></a>  <span class="comment"> * and temporary course roles.</span>
<a name="l1034"><span class="linenum">1034</span></a>  <span class="comment"> *</span>
<a name="l1035"><span class="linenum">1035</span></a>  <span class="comment"> * @access private</span>
<a name="l1036"><span class="linenum">1036</span></a>  <span class="comment"> * @param int $roleid the id of the user</span>
<a name="l1037"><span class="linenum">1037</span></a>  <span class="comment"> * @param context $context needs path!</span>
<a name="l1038"><span class="linenum">1038</span></a>  <span class="comment"> * @param array $accessdata accessdata array (is modified)</span>
<a name="l1039"><span class="linenum">1039</span></a>  <span class="comment"> * @return array</span>
<a name="l1040"><span class="linenum">1040</span></a>  <span class="comment"> */</span>
<a name="l1041"><span class="linenum">1041</span></a>  function <a class="function" onClick="logFunction('load_role_access_by_context')" href="../_functions/load_role_access_by_context.html" onMouseOver="funcPopup(event,'load_role_access_by_context')">load_role_access_by_context</a>(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, &amp;<a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>) {
<a name="l1042"><span class="linenum">1042</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>;
<a name="l1043"><span class="linenum">1043</span></a>  
<a name="l1044"><span class="linenum">1044</span></a>      <span class="comment">/* Get the relevant rolecaps into rdef</span>
<a name="l1045"><span class="linenum">1045</span></a>  <span class="comment">     * - relevant role caps</span>
<a name="l1046"><span class="linenum">1046</span></a>  <span class="comment">     *   - at ctx and above</span>
<a name="l1047"><span class="linenum">1047</span></a>  <span class="comment">     *   - below this ctx</span>
<a name="l1048"><span class="linenum">1048</span></a>  <span class="comment">     */</span>
<a name="l1049"><span class="linenum">1049</span></a>  
<a name="l1050"><span class="linenum">1050</span></a>      if (empty(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('path')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/path.html">path</a>)) {
<a name="l1051"><span class="linenum">1051</span></a>  <span class="comment">        // weird, this should not happen</span>
<a name="l1052"><span class="linenum">1052</span></a>          return;
<a name="l1053"><span class="linenum">1053</span></a>      }
<a name="l1054"><span class="linenum">1054</span></a>  
<a name="l1055"><span class="linenum">1055</span></a>      <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it28806" onMouseOver="hilite(28806)" onMouseOut="lolite()" onClick="logVariable('parentsaself')" href="../_variables/parentsaself.html">$parentsaself</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_parent_context_ids')" href="../_functions/get_parent_context_ids.html" onMouseOver="funcPopup(event,'get_parent_context_ids')">get_parent_context_ids</a>(true), <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'pc_');
<a name="l1056"><span class="linenum">1056</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['roleid'] = <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>;
<a name="l1057"><span class="linenum">1057</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['childpath'] = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('path')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/path.html">path</a>.'/%';
<a name="l1058"><span class="linenum">1058</span></a>  
<a name="l1059"><span class="linenum">1059</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT ctx.path, rc.capability, rc.permission
<a name="l1060"><span class="linenum">1060</span></a>                FROM {role_capabilities} rc
<a name="l1061"><span class="linenum">1061</span></a>                JOIN {context} ctx <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (rc.contextid = ctx.id)
<a name="l1062"><span class="linenum">1062</span></a>               WHERE rc.roleid = :roleid AND (ctx.id <a class="var it28806" onMouseOver="hilite(28806)" onMouseOut="lolite()" onClick="logVariable('parentsaself')" href="../_variables/parentsaself.html">$parentsaself</a> OR ctx.path LIKE :childpath)
<a name="l1063"><span class="linenum">1063</span></a>            ORDER BY rc.capability&quot;; <span class="comment">// fixed capability order is necessary for rdef dedupe</span>
<a name="l1064"><span class="linenum">1064</span></a>      <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l1065"><span class="linenum">1065</span></a>  
<a name="l1066"><span class="linenum">1066</span></a>      <a class="var it28807" onMouseOver="hilite(28807)" onMouseOut="lolite()" onClick="logVariable('newrdefs')" href="../_variables/newrdefs.html">$newrdefs</a> = array();
<a name="l1067"><span class="linenum">1067</span></a>      foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> as <a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>) {
<a name="l1068"><span class="linenum">1068</span></a>          <a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a> = <a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>-&gt;<a onClick="logVariable('path')" class="var it40976" onMouseOver="hilite(40976)" onMouseOut="lolite()" href="../_variables/path.html">path</a>.':'.<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>;
<a name="l1069"><span class="linenum">1069</span></a>          if (isset(<a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rdef'][<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>])) {
<a name="l1070"><span class="linenum">1070</span></a>              continue;
<a name="l1071"><span class="linenum">1071</span></a>          }
<a name="l1072"><span class="linenum">1072</span></a>          <a class="var it28807" onMouseOver="hilite(28807)" onMouseOut="lolite()" onClick="logVariable('newrdefs')" href="../_variables/newrdefs.html">$newrdefs</a>[<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>][<a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>-&gt;<a onClick="logVariable('capability')" class="var it40976" onMouseOver="hilite(40976)" onMouseOut="lolite()" href="../_variables/capability.html">capability</a>] = (int)<a class="var it7059" onMouseOver="hilite(7059)" onMouseOut="lolite()" onClick="logVariable('rd')" href="../_variables/rd.html">$rd</a>-&gt;<a onClick="logVariable('permission')" class="var it40976" onMouseOver="hilite(40976)" onMouseOut="lolite()" href="../_variables/permission.html">permission</a>;
<a name="l1073"><span class="linenum">1073</span></a>      }
<a name="l1074"><span class="linenum">1074</span></a>      <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l1075"><span class="linenum">1075</span></a>  
<a name="l1076"><span class="linenum">1076</span></a>  <span class="comment">    // share new role definitions</span>
<a name="l1077"><span class="linenum">1077</span></a>      foreach (<a class="var it28807" onMouseOver="hilite(28807)" onMouseOut="lolite()" onClick="logVariable('newrdefs')" href="../_variables/newrdefs.html">$newrdefs</a> as <a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>=&gt;<a class="var it1136" onMouseOver="hilite(1136)" onMouseOut="lolite()" onClick="logVariable('unused')" href="../_variables/unused.html">$unused</a>) {
<a name="l1078"><span class="linenum">1078</span></a>          if (!isset(<a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('rolepermissions')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/rolepermissions.html">rolepermissions</a>[<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>])) {
<a name="l1079"><span class="linenum">1079</span></a>              <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('rolepermissions')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/rolepermissions.html">rolepermissions</a>[<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>] = <a class="var it28807" onMouseOver="hilite(28807)" onMouseOut="lolite()" onClick="logVariable('newrdefs')" href="../_variables/newrdefs.html">$newrdefs</a>[<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>];
<a name="l1080"><span class="linenum">1080</span></a>          }
<a name="l1081"><span class="linenum">1081</span></a>          <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rdef_count']++;
<a name="l1082"><span class="linenum">1082</span></a>          <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rdef'][<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>] =&amp; <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('rolepermissions')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/rolepermissions.html">rolepermissions</a>[<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>];
<a name="l1083"><span class="linenum">1083</span></a>      }
<a name="l1084"><span class="linenum">1084</span></a>  }
<a name="l1085"><span class="linenum">1085</span></a>  
<a name="l1086"><span class="linenum">1086</span></a>  <span class="comment">/**</span>
<a name="l1087"><span class="linenum">1087</span></a>  <span class="comment"> * Returns empty accessdata structure.</span>
<a name="l1088"><span class="linenum">1088</span></a>  <span class="comment"> *</span>
<a name="l1089"><span class="linenum">1089</span></a>  <span class="comment"> * @access private</span>
<a name="l1090"><span class="linenum">1090</span></a>  <span class="comment"> * @return array empt accessdata</span>
<a name="l1091"><span class="linenum">1091</span></a>  <span class="comment"> */</span>
<a name="l1092"><span class="linenum">1092</span></a>  function <a class="function" onClick="logFunction('get_empty_accessdata')" href="../_functions/get_empty_accessdata.html" onMouseOver="funcPopup(event,'get_empty_accessdata')">get_empty_accessdata</a>() {
<a name="l1093"><span class="linenum">1093</span></a>      <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>               = array(); <span class="comment">// named list</span>
<a name="l1094"><span class="linenum">1094</span></a>      <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['ra']         = array();
<a name="l1095"><span class="linenum">1095</span></a>      <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rdef']       = array();
<a name="l1096"><span class="linenum">1096</span></a>      <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rdef_count'] = 0;       <span class="comment">// this bloody hack is necessary because count($array) is slooooowwww in PHP</span>
<a name="l1097"><span class="linenum">1097</span></a>      <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rdef_lcc']   = 0;       <span class="comment">// rdef_count during the last compression</span>
<a name="l1098"><span class="linenum">1098</span></a>      <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['loaded']     = array(); <span class="comment">// loaded course contexts</span>
<a name="l1099"><span class="linenum">1099</span></a>      <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['time']       = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1100"><span class="linenum">1100</span></a>      <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>['rsw']        = array();
<a name="l1101"><span class="linenum">1101</span></a>  
<a name="l1102"><span class="linenum">1102</span></a>      return <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>;
<a name="l1103"><span class="linenum">1103</span></a>  }
<a name="l1104"><span class="linenum">1104</span></a>  
<a name="l1105"><span class="linenum">1105</span></a>  <span class="comment">/**</span>
<a name="l1106"><span class="linenum">1106</span></a>  <span class="comment"> * Get accessdata for a given user.</span>
<a name="l1107"><span class="linenum">1107</span></a>  <span class="comment"> *</span>
<a name="l1108"><span class="linenum">1108</span></a>  <span class="comment"> * @access private</span>
<a name="l1109"><span class="linenum">1109</span></a>  <span class="comment"> * @param int $userid</span>
<a name="l1110"><span class="linenum">1110</span></a>  <span class="comment"> * @param bool $preloadonly true means do not return access array</span>
<a name="l1111"><span class="linenum">1111</span></a>  <span class="comment"> * @return array accessdata</span>
<a name="l1112"><span class="linenum">1112</span></a>  <span class="comment"> */</span>
<a name="l1113"><span class="linenum">1113</span></a>  function <a class="function" onClick="logFunction('get_user_accessdata')" href="../_functions/get_user_accessdata.html" onMouseOver="funcPopup(event,'get_user_accessdata')">get_user_accessdata</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it28808" onMouseOver="hilite(28808)" onMouseOut="lolite()" onClick="logVariable('preloadonly')" href="../_variables/preloadonly.html">$preloadonly</a>=false) {
<a name="l1114"><span class="linenum">1114</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l1115"><span class="linenum">1115</span></a>  
<a name="l1116"><span class="linenum">1116</span></a>      if (!empty(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['rdef']) and empty(<a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('rolepermissions')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/rolepermissions.html">rolepermissions</a>)) {
<a name="l1117"><span class="linenum">1117</span></a>  <span class="comment">        // share rdef from USER session with rolepermissions cache in order to conserve memory</span>
<a name="l1118"><span class="linenum">1118</span></a>          foreach (<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['rdef'] as <a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>=&gt;<a class="var it44" onMouseOver="hilite(44)" onMouseOut="lolite()" onClick="logVariable('v')" href="../_variables/v.html">$v</a>) {
<a name="l1119"><span class="linenum">1119</span></a>              <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('rolepermissions')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/rolepermissions.html">rolepermissions</a>[<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>] =&amp; <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['rdef'][<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>];
<a name="l1120"><span class="linenum">1120</span></a>          }
<a name="l1121"><span class="linenum">1121</span></a>          <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('accessdatabyuser')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/accessdatabyuser.html">accessdatabyuser</a>[<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>;
<a name="l1122"><span class="linenum">1122</span></a>      }
<a name="l1123"><span class="linenum">1123</span></a>  
<a name="l1124"><span class="linenum">1124</span></a>      if (!isset(<a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('accessdatabyuser')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/accessdatabyuser.html">accessdatabyuser</a>[<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>])) {
<a name="l1125"><span class="linenum">1125</span></a>          if (empty(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>)) {
<a name="l1126"><span class="linenum">1126</span></a>              if (!empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('notloggedinroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/notloggedinroleid.html">notloggedinroleid</a>)) {
<a name="l1127"><span class="linenum">1127</span></a>                  <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a> = <a class="function" onClick="logFunction('get_role_access')" href="../_functions/get_role_access.html" onMouseOver="funcPopup(event,'get_role_access')">get_role_access</a>(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('notloggedinroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/notloggedinroleid.html">notloggedinroleid</a>);
<a name="l1128"><span class="linenum">1128</span></a>              } else {
<a name="l1129"><span class="linenum">1129</span></a>  <span class="comment">                // weird</span>
<a name="l1130"><span class="linenum">1130</span></a>                  return <a class="function" onClick="logFunction('get_empty_accessdata')" href="../_functions/get_empty_accessdata.html" onMouseOver="funcPopup(event,'get_empty_accessdata')">get_empty_accessdata</a>();
<a name="l1131"><span class="linenum">1131</span></a>              }
<a name="l1132"><span class="linenum">1132</span></a>  
<a name="l1133"><span class="linenum">1133</span></a>          } else if (<a class="function" onClick="logFunction('isguestuser')" href="../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>)) {
<a name="l1134"><span class="linenum">1134</span></a>              if (<a class="var it359" onMouseOver="hilite(359)" onMouseOut="lolite()" onClick="logVariable('guestrole')" href="../_variables/guestrole.html">$guestrole</a> = <a class="function" onClick="logFunction('get_guest_role')" href="../_functions/get_guest_role.html" onMouseOver="funcPopup(event,'get_guest_role')">get_guest_role</a>()) {
<a name="l1135"><span class="linenum">1135</span></a>                  <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a> = <a class="function" onClick="logFunction('get_role_access')" href="../_functions/get_role_access.html" onMouseOver="funcPopup(event,'get_role_access')">get_role_access</a>(<a class="var it359" onMouseOver="hilite(359)" onMouseOut="lolite()" onClick="logVariable('guestrole')" href="../_variables/guestrole.html">$guestrole</a>-&gt;<a onClick="logVariable('id')" class="var it40977" onMouseOver="hilite(40977)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l1136"><span class="linenum">1136</span></a>              } else {
<a name="l1137"><span class="linenum">1137</span></a>  <span class="comment">                //weird</span>
<a name="l1138"><span class="linenum">1138</span></a>                  return <a class="function" onClick="logFunction('get_empty_accessdata')" href="../_functions/get_empty_accessdata.html" onMouseOver="funcPopup(event,'get_empty_accessdata')">get_empty_accessdata</a>();
<a name="l1139"><span class="linenum">1139</span></a>              }
<a name="l1140"><span class="linenum">1140</span></a>  
<a name="l1141"><span class="linenum">1141</span></a>          } else {
<a name="l1142"><span class="linenum">1142</span></a>              <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a> = <a class="function" onClick="logFunction('get_user_access_sitewide')" href="../_functions/get_user_access_sitewide.html" onMouseOver="funcPopup(event,'get_user_access_sitewide')">get_user_access_sitewide</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>); <span class="comment">// includes default role and frontpage role</span>
<a name="l1143"><span class="linenum">1143</span></a>          }
<a name="l1144"><span class="linenum">1144</span></a>  
<a name="l1145"><span class="linenum">1145</span></a>          <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('accessdatabyuser')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/accessdatabyuser.html">accessdatabyuser</a>[<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>] = <a class="var it28793" onMouseOver="hilite(28793)" onMouseOut="lolite()" onClick="logVariable('accessdata')" href="../_variables/accessdata.html">$accessdata</a>;
<a name="l1146"><span class="linenum">1146</span></a>      }
<a name="l1147"><span class="linenum">1147</span></a>  
<a name="l1148"><span class="linenum">1148</span></a>      if (<a class="var it28808" onMouseOver="hilite(28808)" onMouseOut="lolite()" onClick="logVariable('preloadonly')" href="../_variables/preloadonly.html">$preloadonly</a>) {
<a name="l1149"><span class="linenum">1149</span></a>          return;
<a name="l1150"><span class="linenum">1150</span></a>      } else {
<a name="l1151"><span class="linenum">1151</span></a>          return <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('accessdatabyuser')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/accessdatabyuser.html">accessdatabyuser</a>[<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>];
<a name="l1152"><span class="linenum">1152</span></a>      }
<a name="l1153"><span class="linenum">1153</span></a>  }
<a name="l1154"><span class="linenum">1154</span></a>  
<a name="l1155"><span class="linenum">1155</span></a>  <span class="comment">/**</span>
<a name="l1156"><span class="linenum">1156</span></a>  <span class="comment"> * Try to minimise the size of $USER-&gt;access by eliminating duplicate override storage,</span>
<a name="l1157"><span class="linenum">1157</span></a>  <span class="comment"> * this function looks for contexts with the same overrides and shares them.</span>
<a name="l1158"><span class="linenum">1158</span></a>  <span class="comment"> *</span>
<a name="l1159"><span class="linenum">1159</span></a>  <span class="comment"> * @access private</span>
<a name="l1160"><span class="linenum">1160</span></a>  <span class="comment"> * @return void</span>
<a name="l1161"><span class="linenum">1161</span></a>  <span class="comment"> */</span>
<a name="l1162"><span class="linenum">1162</span></a>  function <a class="function" onClick="logFunction('dedupe_user_access')" href="../_functions/dedupe_user_access.html" onMouseOver="funcPopup(event,'dedupe_user_access')">dedupe_user_access</a>() {
<a name="l1163"><span class="linenum">1163</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l1164"><span class="linenum">1164</span></a>  
<a name="l1165"><span class="linenum">1165</span></a>      if (<a class="constant" onClick="logConstant('CLI_SCRIPT')" href="../_constants/CLI_SCRIPT.html" onMouseOver="constPopup(event,'CLI_SCRIPT')">CLI_SCRIPT</a>) {
<a name="l1166"><span class="linenum">1166</span></a>  <span class="comment">        // no session in CLI --&gt; no compression necessary</span>
<a name="l1167"><span class="linenum">1167</span></a>          return;
<a name="l1168"><span class="linenum">1168</span></a>      }
<a name="l1169"><span class="linenum">1169</span></a>  
<a name="l1170"><span class="linenum">1170</span></a>      if (empty(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['rdef_count'])) {
<a name="l1171"><span class="linenum">1171</span></a>  <span class="comment">        // weird, this should not happen</span>
<a name="l1172"><span class="linenum">1172</span></a>          return;
<a name="l1173"><span class="linenum">1173</span></a>      }
<a name="l1174"><span class="linenum">1174</span></a>  
<a name="l1175"><span class="linenum">1175</span></a>  <span class="comment">    // the rdef is growing only, we never remove stuff from it, the rdef_lcc helps us to detect new stuff in rdef</span>
<a name="l1176"><span class="linenum">1176</span></a>      if (<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['rdef_count'] - <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['rdef_lcc'] &gt; 10) {
<a name="l1177"><span class="linenum">1177</span></a>  <span class="comment">        // do not compress after each change, wait till there is more stuff to be done</span>
<a name="l1178"><span class="linenum">1178</span></a>          return;
<a name="l1179"><span class="linenum">1179</span></a>      }
<a name="l1180"><span class="linenum">1180</span></a>  
<a name="l1181"><span class="linenum">1181</span></a>      <a class="var it28809" onMouseOver="hilite(28809)" onMouseOut="lolite()" onClick="logVariable('hashmap')" href="../_variables/hashmap.html">$hashmap</a> = array();
<a name="l1182"><span class="linenum">1182</span></a>      foreach (<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['rdef'] as <a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>=&gt;<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('def')" href="../_variables/def.html">$def</a>) {
<a name="l1183"><span class="linenum">1183</span></a>          <a class="var it6788" onMouseOver="hilite(6788)" onMouseOut="lolite()" onClick="logVariable('hash')" href="../_variables/hash.html">$hash</a> = <a class="phpfunction" onClick="logFunction('sha1')" href="../_functions/sha1.html" onMouseOver="phpfuncPopup(event,'sha1')">sha1</a>(<a class="phpfunction" onClick="logFunction('serialize')" href="../_functions/serialize.html" onMouseOver="phpfuncPopup(event,'serialize')">serialize</a>(<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('def')" href="../_variables/def.html">$def</a>));
<a name="l1184"><span class="linenum">1184</span></a>          if (isset(<a class="var it28809" onMouseOver="hilite(28809)" onMouseOut="lolite()" onClick="logVariable('hashmap')" href="../_variables/hashmap.html">$hashmap</a>[<a class="var it6788" onMouseOver="hilite(6788)" onMouseOut="lolite()" onClick="logVariable('hash')" href="../_variables/hash.html">$hash</a>])) {
<a name="l1185"><span class="linenum">1185</span></a>              <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['rdef'][<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>] =&amp; <a class="var it28809" onMouseOver="hilite(28809)" onMouseOut="lolite()" onClick="logVariable('hashmap')" href="../_variables/hashmap.html">$hashmap</a>[<a class="var it6788" onMouseOver="hilite(6788)" onMouseOut="lolite()" onClick="logVariable('hash')" href="../_variables/hash.html">$hash</a>];
<a name="l1186"><span class="linenum">1186</span></a>          } else {
<a name="l1187"><span class="linenum">1187</span></a>              <a class="var it28809" onMouseOver="hilite(28809)" onMouseOut="lolite()" onClick="logVariable('hashmap')" href="../_variables/hashmap.html">$hashmap</a>[<a class="var it6788" onMouseOver="hilite(6788)" onMouseOut="lolite()" onClick="logVariable('hash')" href="../_variables/hash.html">$hash</a>] =&amp; <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['rdef'][<a class="var it50" onMouseOver="hilite(50)" onMouseOut="lolite()" onClick="logVariable('k')" href="../_variables/k.html">$k</a>];
<a name="l1188"><span class="linenum">1188</span></a>          }
<a name="l1189"><span class="linenum">1189</span></a>      }
<a name="l1190"><span class="linenum">1190</span></a>  
<a name="l1191"><span class="linenum">1191</span></a>      <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['rdef_lcc'] = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['rdef_count'];
<a name="l1192"><span class="linenum">1192</span></a>  }
<a name="l1193"><span class="linenum">1193</span></a>  
<a name="l1194"><span class="linenum">1194</span></a>  <span class="comment">/**</span>
<a name="l1195"><span class="linenum">1195</span></a>  <span class="comment"> * A convenience function to completely load all the capabilities</span>
<a name="l1196"><span class="linenum">1196</span></a>  <span class="comment"> * for the current user. It is called from has_capability() and functions change permissions.</span>
<a name="l1197"><span class="linenum">1197</span></a>  <span class="comment"> *</span>
<a name="l1198"><span class="linenum">1198</span></a>  <span class="comment"> * Call it only _after_ you've setup $USER and called check_enrolment_plugins();</span>
<a name="l1199"><span class="linenum">1199</span></a>  <span class="comment"> * @see check_enrolment_plugins()</span>
<a name="l1200"><span class="linenum">1200</span></a>  <span class="comment"> *</span>
<a name="l1201"><span class="linenum">1201</span></a>  <span class="comment"> * @access private</span>
<a name="l1202"><span class="linenum">1202</span></a>  <span class="comment"> * @return void</span>
<a name="l1203"><span class="linenum">1203</span></a>  <span class="comment"> */</span>
<a name="l1204"><span class="linenum">1204</span></a>  function <a class="function" onClick="logFunction('load_all_capabilities')" href="../_functions/load_all_capabilities.html" onMouseOver="funcPopup(event,'load_all_capabilities')">load_all_capabilities</a>() {
<a name="l1205"><span class="linenum">1205</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l1206"><span class="linenum">1206</span></a>  
<a name="l1207"><span class="linenum">1207</span></a>  <span class="comment">    // roles not installed yet - we are in the middle of installation</span>
<a name="l1208"><span class="linenum">1208</span></a>      if (<a class="function" onClick="logFunction('during_initial_install')" href="../_functions/during_initial_install.html" onMouseOver="funcPopup(event,'during_initial_install')">during_initial_install</a>()) {
<a name="l1209"><span class="linenum">1209</span></a>          return;
<a name="l1210"><span class="linenum">1210</span></a>      }
<a name="l1211"><span class="linenum">1211</span></a>  
<a name="l1212"><span class="linenum">1212</span></a>      if (!isset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>)) {
<a name="l1213"><span class="linenum">1213</span></a>  <span class="comment">        // this should not happen</span>
<a name="l1214"><span class="linenum">1214</span></a>          <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a> = 0;
<a name="l1215"><span class="linenum">1215</span></a>      }
<a name="l1216"><span class="linenum">1216</span></a>  
<a name="l1217"><span class="linenum">1217</span></a>      unset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>);
<a name="l1218"><span class="linenum">1218</span></a>      <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a> = <a class="function" onClick="logFunction('get_user_accessdata')" href="../_functions/get_user_accessdata.html" onMouseOver="funcPopup(event,'get_user_accessdata')">get_user_accessdata</a>(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l1219"><span class="linenum">1219</span></a>  
<a name="l1220"><span class="linenum">1220</span></a>  <span class="comment">    // deduplicate the overrides to minimize session size</span>
<a name="l1221"><span class="linenum">1221</span></a>      <a class="function" onClick="logFunction('dedupe_user_access')" href="../_functions/dedupe_user_access.html" onMouseOver="funcPopup(event,'dedupe_user_access')">dedupe_user_access</a>();
<a name="l1222"><span class="linenum">1222</span></a>  
<a name="l1223"><span class="linenum">1223</span></a>  <span class="comment">    // Clear to force a refresh</span>
<a name="l1224"><span class="linenum">1224</span></a>      unset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('mycourses')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/mycourses.html">mycourses</a>);
<a name="l1225"><span class="linenum">1225</span></a>  
<a name="l1226"><span class="linenum">1226</span></a>  <span class="comment">    // init/reset internal enrol caches - active course enrolments and temp access</span>
<a name="l1227"><span class="linenum">1227</span></a>      <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('enrol')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a> = array('enrolled'=&gt;array(), 'tempguest'=&gt;array());
<a name="l1228"><span class="linenum">1228</span></a>  }
<a name="l1229"><span class="linenum">1229</span></a>  
<a name="l1230"><span class="linenum">1230</span></a>  <span class="comment">/**</span>
<a name="l1231"><span class="linenum">1231</span></a>  <span class="comment"> * A convenience function to completely reload all the capabilities</span>
<a name="l1232"><span class="linenum">1232</span></a>  <span class="comment"> * for the current user when roles have been updated in a relevant</span>
<a name="l1233"><span class="linenum">1233</span></a>  <span class="comment"> * context -- but PRESERVING switchroles and loginas.</span>
<a name="l1234"><span class="linenum">1234</span></a>  <span class="comment"> * This function resets all accesslib and context caches.</span>
<a name="l1235"><span class="linenum">1235</span></a>  <span class="comment"> *</span>
<a name="l1236"><span class="linenum">1236</span></a>  <span class="comment"> * That is - completely transparent to the user.</span>
<a name="l1237"><span class="linenum">1237</span></a>  <span class="comment"> *</span>
<a name="l1238"><span class="linenum">1238</span></a>  <span class="comment"> * Note: reloads $USER-&gt;access completely.</span>
<a name="l1239"><span class="linenum">1239</span></a>  <span class="comment"> *</span>
<a name="l1240"><span class="linenum">1240</span></a>  <span class="comment"> * @access private</span>
<a name="l1241"><span class="linenum">1241</span></a>  <span class="comment"> * @return void</span>
<a name="l1242"><span class="linenum">1242</span></a>  <span class="comment"> */</span>
<a name="l1243"><span class="linenum">1243</span></a>  function <a class="function" onClick="logFunction('reload_all_capabilities')" href="../_functions/reload_all_capabilities.html" onMouseOver="funcPopup(event,'reload_all_capabilities')">reload_all_capabilities</a>() {
<a name="l1244"><span class="linenum">1244</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>;
<a name="l1245"><span class="linenum">1245</span></a>  
<a name="l1246"><span class="linenum">1246</span></a>  <span class="comment">    // copy switchroles</span>
<a name="l1247"><span class="linenum">1247</span></a>      <a class="var it28810" onMouseOver="hilite(28810)" onMouseOut="lolite()" onClick="logVariable('sw')" href="../_variables/sw.html">$sw</a> = array();
<a name="l1248"><span class="linenum">1248</span></a>      if (!empty(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['rsw'])) {
<a name="l1249"><span class="linenum">1249</span></a>          <a class="var it28810" onMouseOver="hilite(28810)" onMouseOut="lolite()" onClick="logVariable('sw')" href="../_variables/sw.html">$sw</a> = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['rsw'];
<a name="l1250"><span class="linenum">1250</span></a>      }
<a name="l1251"><span class="linenum">1251</span></a>  
<a name="l1252"><span class="linenum">1252</span></a>      <a class="function" onClick="logFunction('accesslib_clear_all_caches')" href="../_functions/accesslib_clear_all_caches.html" onMouseOver="funcPopup(event,'accesslib_clear_all_caches')">accesslib_clear_all_caches</a>(true);
<a name="l1253"><span class="linenum">1253</span></a>      unset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>);
<a name="l1254"><span class="linenum">1254</span></a>      <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('dirtycontexts')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/dirtycontexts.html">dirtycontexts</a> = array(); <span class="comment">// prevent dirty flags refetching on this page</span>
<a name="l1255"><span class="linenum">1255</span></a>  
<a name="l1256"><span class="linenum">1256</span></a>      <a class="function" onClick="logFunction('load_all_capabilities')" href="../_functions/load_all_capabilities.html" onMouseOver="funcPopup(event,'load_all_capabilities')">load_all_capabilities</a>();
<a name="l1257"><span class="linenum">1257</span></a>  
<a name="l1258"><span class="linenum">1258</span></a>      foreach (<a class="var it28810" onMouseOver="hilite(28810)" onMouseOut="lolite()" onClick="logVariable('sw')" href="../_variables/sw.html">$sw</a> as <a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a> =&gt; <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>) {
<a name="l1259"><span class="linenum">1259</span></a>          if (<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('context', array('path'=&gt;<a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>))) {
<a name="l1260"><span class="linenum">1260</span></a>              <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = context::<a class="function" onClick="logFunction('instance_by_id')" href="../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l1261"><span class="linenum">1261</span></a>              <a class="function" onClick="logFunction('role_switch')" href="../_functions/role_switch.html" onMouseOver="funcPopup(event,'role_switch')">role_switch</a>(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l1262"><span class="linenum">1262</span></a>          }
<a name="l1263"><span class="linenum">1263</span></a>      }
<a name="l1264"><span class="linenum">1264</span></a>  }
<a name="l1265"><span class="linenum">1265</span></a>  
<a name="l1266"><span class="linenum">1266</span></a>  <span class="comment">/**</span>
<a name="l1267"><span class="linenum">1267</span></a>  <span class="comment"> * Adds a temp role to current USER-&gt;access array.</span>
<a name="l1268"><span class="linenum">1268</span></a>  <span class="comment"> *</span>
<a name="l1269"><span class="linenum">1269</span></a>  <span class="comment"> * Useful for the &quot;temporary guest&quot; access we grant to logged-in users.</span>
<a name="l1270"><span class="linenum">1270</span></a>  <span class="comment"> * This is useful for enrol plugins only.</span>
<a name="l1271"><span class="linenum">1271</span></a>  <span class="comment"> *</span>
<a name="l1272"><span class="linenum">1272</span></a>  <span class="comment"> * @since Moodle 2.2</span>
<a name="l1273"><span class="linenum">1273</span></a>  <span class="comment"> * @param context_course $coursecontext</span>
<a name="l1274"><span class="linenum">1274</span></a>  <span class="comment"> * @param int $roleid</span>
<a name="l1275"><span class="linenum">1275</span></a>  <span class="comment"> * @return void</span>
<a name="l1276"><span class="linenum">1276</span></a>  <span class="comment"> */</span>
<a name="l1277"><span class="linenum">1277</span></a>  function <a class="function" onClick="logFunction('load_temp_course_role')" href="../_functions/load_temp_course_role.html" onMouseOver="funcPopup(event,'load_temp_course_role')">load_temp_course_role</a>(context_course <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>, <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>) {
<a name="l1278"><span class="linenum">1278</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../_variables/SITE.html">$SITE</a>;
<a name="l1279"><span class="linenum">1279</span></a>  
<a name="l1280"><span class="linenum">1280</span></a>      if (empty(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>)) {
<a name="l1281"><span class="linenum">1281</span></a>          <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('invalid role specified in <a class="function" onClick="logFunction('load_temp_course_role')" href="../_functions/load_temp_course_role.html" onMouseOver="funcPopup(event,'load_temp_course_role')">load_temp_course_role</a>()');
<a name="l1282"><span class="linenum">1282</span></a>          return;
<a name="l1283"><span class="linenum">1283</span></a>      }
<a name="l1284"><span class="linenum">1284</span></a>  
<a name="l1285"><span class="linenum">1285</span></a>      if (<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a> == <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../_variables/SITE.html">$SITE</a>-&gt;<a onClick="logVariable('id')" class="var it39635" onMouseOver="hilite(39635)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) {
<a name="l1286"><span class="linenum">1286</span></a>          <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Can not use temp roles on the frontpage');
<a name="l1287"><span class="linenum">1287</span></a>          return;
<a name="l1288"><span class="linenum">1288</span></a>      }
<a name="l1289"><span class="linenum">1289</span></a>  
<a name="l1290"><span class="linenum">1290</span></a>      if (!isset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>)) {
<a name="l1291"><span class="linenum">1291</span></a>          <a class="function" onClick="logFunction('load_all_capabilities')" href="../_functions/load_all_capabilities.html" onMouseOver="funcPopup(event,'load_all_capabilities')">load_all_capabilities</a>();
<a name="l1292"><span class="linenum">1292</span></a>      }
<a name="l1293"><span class="linenum">1293</span></a>  
<a name="l1294"><span class="linenum">1294</span></a>      <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a class="function" onClick="logFunction('reload_if_dirty')" href="../_functions/reload_if_dirty.html" onMouseOver="funcPopup(event,'reload_if_dirty')">reload_if_dirty</a>();
<a name="l1295"><span class="linenum">1295</span></a>  
<a name="l1296"><span class="linenum">1296</span></a>      if (isset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['ra'][<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('path')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/path.html">path</a>][<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>])) {
<a name="l1297"><span class="linenum">1297</span></a>          return;
<a name="l1298"><span class="linenum">1298</span></a>      }
<a name="l1299"><span class="linenum">1299</span></a>  
<a name="l1300"><span class="linenum">1300</span></a>  <span class="comment">    // load course stuff first</span>
<a name="l1301"><span class="linenum">1301</span></a>      <a class="function" onClick="logFunction('load_course_context')" href="../_functions/load_course_context.html" onMouseOver="funcPopup(event,'load_course_context')">load_course_context</a>(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>);
<a name="l1302"><span class="linenum">1302</span></a>  
<a name="l1303"><span class="linenum">1303</span></a>      <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['ra'][<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('path')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/path.html">path</a>][(int)<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>] = (int)<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>;
<a name="l1304"><span class="linenum">1304</span></a>  
<a name="l1305"><span class="linenum">1305</span></a>      <a class="function" onClick="logFunction('load_role_access_by_context')" href="../_functions/load_role_access_by_context.html" onMouseOver="funcPopup(event,'load_role_access_by_context')">load_role_access_by_context</a>(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>);
<a name="l1306"><span class="linenum">1306</span></a>  }
<a name="l1307"><span class="linenum">1307</span></a>  
<a name="l1308"><span class="linenum">1308</span></a>  <span class="comment">/**</span>
<a name="l1309"><span class="linenum">1309</span></a>  <span class="comment"> * Removes any extra guest roles from current USER-&gt;access array.</span>
<a name="l1310"><span class="linenum">1310</span></a>  <span class="comment"> * This is useful for enrol plugins only.</span>
<a name="l1311"><span class="linenum">1311</span></a>  <span class="comment"> *</span>
<a name="l1312"><span class="linenum">1312</span></a>  <span class="comment"> * @since Moodle 2.2</span>
<a name="l1313"><span class="linenum">1313</span></a>  <span class="comment"> * @param context_course $coursecontext</span>
<a name="l1314"><span class="linenum">1314</span></a>  <span class="comment"> * @return void</span>
<a name="l1315"><span class="linenum">1315</span></a>  <span class="comment"> */</span>
<a name="l1316"><span class="linenum">1316</span></a>  function <a class="function" onClick="logFunction('remove_temp_course_roles')" href="../_functions/remove_temp_course_roles.html" onMouseOver="funcPopup(event,'remove_temp_course_roles')">remove_temp_course_roles</a>(context_course <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>) {
<a name="l1317"><span class="linenum">1317</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../_variables/SITE.html">$SITE</a>;
<a name="l1318"><span class="linenum">1318</span></a>  
<a name="l1319"><span class="linenum">1319</span></a>      if (<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a> == <a class="var it1063" onMouseOver="hilite(1063)" onMouseOut="lolite()" onClick="logVariable('SITE')" href="../_variables/SITE.html">$SITE</a>-&gt;<a onClick="logVariable('id')" class="var it39635" onMouseOver="hilite(39635)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) {
<a name="l1320"><span class="linenum">1320</span></a>          <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Can not use temp roles on the frontpage');
<a name="l1321"><span class="linenum">1321</span></a>          return;
<a name="l1322"><span class="linenum">1322</span></a>      }
<a name="l1323"><span class="linenum">1323</span></a>  
<a name="l1324"><span class="linenum">1324</span></a>      if (empty(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['ra'][<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('path')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/path.html">path</a>])) {
<a name="l1325"><span class="linenum">1325</span></a>  <span class="comment">        //no roles here, weird</span>
<a name="l1326"><span class="linenum">1326</span></a>          return;
<a name="l1327"><span class="linenum">1327</span></a>      }
<a name="l1328"><span class="linenum">1328</span></a>  
<a name="l1329"><span class="linenum">1329</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT DISTINCT ra.roleid AS id
<a name="l1330"><span class="linenum">1330</span></a>                FROM {role_assignments} ra
<a name="l1331"><span class="linenum">1331</span></a>               WHERE ra.contextid = :contextid AND ra.userid = :userid&quot;;
<a name="l1332"><span class="linenum">1332</span></a>      <a class="var it11181" onMouseOver="hilite(11181)" onMouseOut="lolite()" onClick="logVariable('ras')" href="../_variables/ras.html">$ras</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, array('contextid'=&gt;<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('id')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'userid'=&gt;<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l1333"><span class="linenum">1333</span></a>  
<a name="l1334"><span class="linenum">1334</span></a>      <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['ra'][<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('path')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/path.html">path</a>] = array();
<a name="l1335"><span class="linenum">1335</span></a>      foreach(<a class="var it11181" onMouseOver="hilite(11181)" onMouseOut="lolite()" onClick="logVariable('ras')" href="../_variables/ras.html">$ras</a> as <a class="var it746" onMouseOver="hilite(746)" onMouseOut="lolite()" onClick="logVariable('r')" href="../_variables/r.html">$r</a>) {
<a name="l1336"><span class="linenum">1336</span></a>          <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['ra'][<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('path')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/path.html">path</a>][(int)<a class="var it746" onMouseOver="hilite(746)" onMouseOut="lolite()" onClick="logVariable('r')" href="../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('id')" class="var it39453" onMouseOver="hilite(39453)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = (int)<a class="var it746" onMouseOver="hilite(746)" onMouseOut="lolite()" onClick="logVariable('r')" href="../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('id')" class="var it39453" onMouseOver="hilite(39453)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l1337"><span class="linenum">1337</span></a>      }
<a name="l1338"><span class="linenum">1338</span></a>  }
<a name="l1339"><span class="linenum">1339</span></a>  
<a name="l1340"><span class="linenum">1340</span></a>  <span class="comment">/**</span>
<a name="l1341"><span class="linenum">1341</span></a>  <span class="comment"> * Returns array of all role archetypes.</span>
<a name="l1342"><span class="linenum">1342</span></a>  <span class="comment"> *</span>
<a name="l1343"><span class="linenum">1343</span></a>  <span class="comment"> * @return array</span>
<a name="l1344"><span class="linenum">1344</span></a>  <span class="comment"> */</span>
<a name="l1345"><span class="linenum">1345</span></a>  function <a class="function" onClick="logFunction('get_role_archetypes')" href="../_functions/get_role_archetypes.html" onMouseOver="funcPopup(event,'get_role_archetypes')">get_role_archetypes</a>() {
<a name="l1346"><span class="linenum">1346</span></a>      return array(
<a name="l1347"><span class="linenum">1347</span></a>          'manager'        =&gt; 'manager',
<a name="l1348"><span class="linenum">1348</span></a>          'coursecreator'  =&gt; 'coursecreator',
<a name="l1349"><span class="linenum">1349</span></a>          'editingteacher' =&gt; 'editingteacher',
<a name="l1350"><span class="linenum">1350</span></a>          'teacher'        =&gt; 'teacher',
<a name="l1351"><span class="linenum">1351</span></a>          'student'        =&gt; 'student',
<a name="l1352"><span class="linenum">1352</span></a>          'guest'          =&gt; 'guest',
<a name="l1353"><span class="linenum">1353</span></a>          'user'           =&gt; 'user',
<a name="l1354"><span class="linenum">1354</span></a>          'frontpage'      =&gt; 'frontpage'
<a name="l1355"><span class="linenum">1355</span></a>      );
<a name="l1356"><span class="linenum">1356</span></a>  }
<a name="l1357"><span class="linenum">1357</span></a>  
<a name="l1358"><span class="linenum">1358</span></a>  <span class="comment">/**</span>
<a name="l1359"><span class="linenum">1359</span></a>  <span class="comment"> * Assign the defaults found in this capability definition to roles that have</span>
<a name="l1360"><span class="linenum">1360</span></a>  <span class="comment"> * the corresponding legacy capabilities assigned to them.</span>
<a name="l1361"><span class="linenum">1361</span></a>  <span class="comment"> *</span>
<a name="l1362"><span class="linenum">1362</span></a>  <span class="comment"> * @param string $capability</span>
<a name="l1363"><span class="linenum">1363</span></a>  <span class="comment"> * @param array $legacyperms an array in the format (example):</span>
<a name="l1364"><span class="linenum">1364</span></a>  <span class="comment"> *                      'guest' =&gt; CAP_PREVENT,</span>
<a name="l1365"><span class="linenum">1365</span></a>  <span class="comment"> *                      'student' =&gt; CAP_ALLOW,</span>
<a name="l1366"><span class="linenum">1366</span></a>  <span class="comment"> *                      'teacher' =&gt; CAP_ALLOW,</span>
<a name="l1367"><span class="linenum">1367</span></a>  <span class="comment"> *                      'editingteacher' =&gt; CAP_ALLOW,</span>
<a name="l1368"><span class="linenum">1368</span></a>  <span class="comment"> *                      'coursecreator' =&gt; CAP_ALLOW,</span>
<a name="l1369"><span class="linenum">1369</span></a>  <span class="comment"> *                      'manager' =&gt; CAP_ALLOW</span>
<a name="l1370"><span class="linenum">1370</span></a>  <span class="comment"> * @return boolean success or failure.</span>
<a name="l1371"><span class="linenum">1371</span></a>  <span class="comment"> */</span>
<a name="l1372"><span class="linenum">1372</span></a>  function <a class="function" onClick="logFunction('assign_legacy_capabilities')" href="../_functions/assign_legacy_capabilities.html" onMouseOver="funcPopup(event,'assign_legacy_capabilities')">assign_legacy_capabilities</a>(<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, <a class="var it28811" onMouseOver="hilite(28811)" onMouseOut="lolite()" onClick="logVariable('legacyperms')" href="../_variables/legacyperms.html">$legacyperms</a>) {
<a name="l1373"><span class="linenum">1373</span></a>  
<a name="l1374"><span class="linenum">1374</span></a>      <a class="var it3916" onMouseOver="hilite(3916)" onMouseOut="lolite()" onClick="logVariable('archetypes')" href="../_variables/archetypes.html">$archetypes</a> = <a class="function" onClick="logFunction('get_role_archetypes')" href="../_functions/get_role_archetypes.html" onMouseOver="funcPopup(event,'get_role_archetypes')">get_role_archetypes</a>();
<a name="l1375"><span class="linenum">1375</span></a>  
<a name="l1376"><span class="linenum">1376</span></a>      foreach (<a class="var it28811" onMouseOver="hilite(28811)" onMouseOut="lolite()" onClick="logVariable('legacyperms')" href="../_variables/legacyperms.html">$legacyperms</a> as <a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> =&gt; <a class="var it26371" onMouseOver="hilite(26371)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../_variables/perm.html">$perm</a>) {
<a name="l1377"><span class="linenum">1377</span></a>  
<a name="l1378"><span class="linenum">1378</span></a>          <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('systemcontext')" href="../_variables/systemcontext.html">$systemcontext</a> = <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l1379"><span class="linenum">1379</span></a>          if (<a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> === 'admin') {
<a name="l1380"><span class="linenum">1380</span></a>              <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Legacy type admin in access.php was renamed to manager, please update the code.');
<a name="l1381"><span class="linenum">1381</span></a>              <a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> = 'manager';
<a name="l1382"><span class="linenum">1382</span></a>          }
<a name="l1383"><span class="linenum">1383</span></a>  
<a name="l1384"><span class="linenum">1384</span></a>          if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>, <a class="var it3916" onMouseOver="hilite(3916)" onMouseOut="lolite()" onClick="logVariable('archetypes')" href="../_variables/archetypes.html">$archetypes</a>)) {
<a name="l1385"><span class="linenum">1385</span></a>              <a class="function" onClick="logFunction('print_error')" href="../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('invalidlegacy', '', '', <a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>);
<a name="l1386"><span class="linenum">1386</span></a>          }
<a name="l1387"><span class="linenum">1387</span></a>  
<a name="l1388"><span class="linenum">1388</span></a>          if (<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a> = <a class="function" onClick="logFunction('get_archetype_roles')" href="../_functions/get_archetype_roles.html" onMouseOver="funcPopup(event,'get_archetype_roles')">get_archetype_roles</a>(<a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>)) {
<a name="l1389"><span class="linenum">1389</span></a>              foreach (<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a> as <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>) {
<a name="l1390"><span class="linenum">1390</span></a>  <span class="comment">                // Assign a site level capability.</span>
<a name="l1391"><span class="linenum">1391</span></a>                  if (!<a class="function" onClick="logFunction('assign_capability')" href="../_functions/assign_capability.html" onMouseOver="funcPopup(event,'assign_capability')">assign_capability</a>(<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, <a class="var it26371" onMouseOver="hilite(26371)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../_variables/perm.html">$perm</a>, <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('id')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('systemcontext')" href="../_variables/systemcontext.html">$systemcontext</a>-&gt;<a onClick="logVariable('id')" class="var it39845" onMouseOver="hilite(39845)" onMouseOut="lolite()" href="../_variables/id.html">id</a>)) {
<a name="l1392"><span class="linenum">1392</span></a>                      return false;
<a name="l1393"><span class="linenum">1393</span></a>                  }
<a name="l1394"><span class="linenum">1394</span></a>              }
<a name="l1395"><span class="linenum">1395</span></a>          }
<a name="l1396"><span class="linenum">1396</span></a>      }
<a name="l1397"><span class="linenum">1397</span></a>      return true;
<a name="l1398"><span class="linenum">1398</span></a>  }
<a name="l1399"><span class="linenum">1399</span></a>  
<a name="l1400"><span class="linenum">1400</span></a>  <span class="comment">/**</span>
<a name="l1401"><span class="linenum">1401</span></a>  <span class="comment"> * Verify capability risks.</span>
<a name="l1402"><span class="linenum">1402</span></a>  <span class="comment"> *</span>
<a name="l1403"><span class="linenum">1403</span></a>  <span class="comment"> * @param stdClass $capability a capability - a row from the capabilities table.</span>
<a name="l1404"><span class="linenum">1404</span></a>  <span class="comment"> * @return boolean whether this capability is safe - that is, whether people with the</span>
<a name="l1405"><span class="linenum">1405</span></a>  <span class="comment"> *      safeoverrides capability should be allowed to change it.</span>
<a name="l1406"><span class="linenum">1406</span></a>  <span class="comment"> */</span>
<a name="l1407"><span class="linenum">1407</span></a>  function <a class="function" onClick="logFunction('is_safe_capability')" href="../_functions/is_safe_capability.html" onMouseOver="funcPopup(event,'is_safe_capability')">is_safe_capability</a>(<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>) {
<a name="l1408"><span class="linenum">1408</span></a>      return !((<a class="constant" onClick="logConstant('RISK_DATALOSS')" href="../_constants/RISK_DATALOSS.html" onMouseOver="constPopup(event,'RISK_DATALOSS')">RISK_DATALOSS</a> | <a class="constant" onClick="logConstant('RISK_MANAGETRUST')" href="../_constants/RISK_MANAGETRUST.html" onMouseOver="constPopup(event,'RISK_MANAGETRUST')">RISK_MANAGETRUST</a> | <a class="constant" onClick="logConstant('RISK_CONFIG')" href="../_constants/RISK_CONFIG.html" onMouseOver="constPopup(event,'RISK_CONFIG')">RISK_CONFIG</a> | <a class="constant" onClick="logConstant('RISK_XSS')" href="../_constants/RISK_XSS.html" onMouseOver="constPopup(event,'RISK_XSS')">RISK_XSS</a> | <a class="constant" onClick="logConstant('RISK_PERSONAL')" href="../_constants/RISK_PERSONAL.html" onMouseOver="constPopup(event,'RISK_PERSONAL')">RISK_PERSONAL</a>) &amp; <a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>-&gt;<a onClick="logVariable('riskbitmask')" class="var it40428" onMouseOver="hilite(40428)" onMouseOut="lolite()" href="../_variables/riskbitmask.html">riskbitmask</a>);
<a name="l1409"><span class="linenum">1409</span></a>  }
<a name="l1410"><span class="linenum">1410</span></a>  
<a name="l1411"><span class="linenum">1411</span></a>  <span class="comment">/**</span>
<a name="l1412"><span class="linenum">1412</span></a>  <span class="comment"> * Get the local override (if any) for a given capability in a role in a context</span>
<a name="l1413"><span class="linenum">1413</span></a>  <span class="comment"> *</span>
<a name="l1414"><span class="linenum">1414</span></a>  <span class="comment"> * @param int $roleid</span>
<a name="l1415"><span class="linenum">1415</span></a>  <span class="comment"> * @param int $contextid</span>
<a name="l1416"><span class="linenum">1416</span></a>  <span class="comment"> * @param string $capability</span>
<a name="l1417"><span class="linenum">1417</span></a>  <span class="comment"> * @return stdClass local capability override</span>
<a name="l1418"><span class="linenum">1418</span></a>  <span class="comment"> */</span>
<a name="l1419"><span class="linenum">1419</span></a>  function <a class="function" onClick="logFunction('get_local_override')" href="../_functions/get_local_override.html" onMouseOver="funcPopup(event,'get_local_override')">get_local_override</a>(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, <a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a>, <a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>) {
<a name="l1420"><span class="linenum">1420</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1421"><span class="linenum">1421</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('role_capabilities', array('roleid'=&gt;<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, 'capability'=&gt;<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, 'contextid'=&gt;<a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a>));
<a name="l1422"><span class="linenum">1422</span></a>  }
<a name="l1423"><span class="linenum">1423</span></a>  
<a name="l1424"><span class="linenum">1424</span></a>  <span class="comment">/**</span>
<a name="l1425"><span class="linenum">1425</span></a>  <span class="comment"> * Returns context instance plus related course and cm instances</span>
<a name="l1426"><span class="linenum">1426</span></a>  <span class="comment"> *</span>
<a name="l1427"><span class="linenum">1427</span></a>  <span class="comment"> * @param int $contextid</span>
<a name="l1428"><span class="linenum">1428</span></a>  <span class="comment"> * @return array of ($context, $course, $cm)</span>
<a name="l1429"><span class="linenum">1429</span></a>  <span class="comment"> */</span>
<a name="l1430"><span class="linenum">1430</span></a>  function <a class="function" onClick="logFunction('get_context_info_array')" href="../_functions/get_context_info_array.html" onMouseOver="funcPopup(event,'get_context_info_array')">get_context_info_array</a>(<a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a>) {
<a name="l1431"><span class="linenum">1431</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1432"><span class="linenum">1432</span></a>  
<a name="l1433"><span class="linenum">1433</span></a>      <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = context::<a class="function" onClick="logFunction('instance_by_id')" href="../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>(<a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a>, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l1434"><span class="linenum">1434</span></a>      <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>  = null;
<a name="l1435"><span class="linenum">1435</span></a>      <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>      = null;
<a name="l1436"><span class="linenum">1436</span></a>  
<a name="l1437"><span class="linenum">1437</span></a>      if (<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> == <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>) {
<a name="l1438"><span class="linenum">1438</span></a>          <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id'=&gt;<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l1439"><span class="linenum">1439</span></a>  
<a name="l1440"><span class="linenum">1440</span></a>      } else if (<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> == <a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>) {
<a name="l1441"><span class="linenum">1441</span></a>          <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_id')" href="../_functions/get_coursemodule_from_id.html" onMouseOver="funcPopup(event,'get_coursemodule_from_id')">get_coursemodule_from_id</a>('', <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>, 0, false, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l1442"><span class="linenum">1442</span></a>          <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id'=&gt;<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('course')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/course.html">course</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l1443"><span class="linenum">1443</span></a>  
<a name="l1444"><span class="linenum">1444</span></a>      } else if (<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> == <a class="constant" onClick="logConstant('CONTEXT_BLOCK')" href="../_constants/CONTEXT_BLOCK.html" onMouseOver="constPopup(event,'CONTEXT_BLOCK')">CONTEXT_BLOCK</a>) {
<a name="l1445"><span class="linenum">1445</span></a>          <a class="var it75" onMouseOver="hilite(75)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../_variables/parent.html">$parent</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_parent_context')" href="../_functions/get_parent_context.html" onMouseOver="funcPopup(event,'get_parent_context')">get_parent_context</a>();
<a name="l1446"><span class="linenum">1446</span></a>  
<a name="l1447"><span class="linenum">1447</span></a>          if (<a class="var it75" onMouseOver="hilite(75)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../_variables/parent.html">$parent</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39475" onMouseOver="hilite(39475)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> == <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>) {
<a name="l1448"><span class="linenum">1448</span></a>              <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id'=&gt;<a class="var it75" onMouseOver="hilite(75)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../_variables/parent.html">$parent</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39475" onMouseOver="hilite(39475)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l1449"><span class="linenum">1449</span></a>          } else if (<a class="var it75" onMouseOver="hilite(75)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../_variables/parent.html">$parent</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39475" onMouseOver="hilite(39475)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> == <a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>) {
<a name="l1450"><span class="linenum">1450</span></a>              <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_id')" href="../_functions/get_coursemodule_from_id.html" onMouseOver="funcPopup(event,'get_coursemodule_from_id')">get_coursemodule_from_id</a>('', <a class="var it75" onMouseOver="hilite(75)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../_variables/parent.html">$parent</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39475" onMouseOver="hilite(39475)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>, 0, false, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l1451"><span class="linenum">1451</span></a>              <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id'=&gt;<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('course')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/course.html">course</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l1452"><span class="linenum">1452</span></a>          }
<a name="l1453"><span class="linenum">1453</span></a>      }
<a name="l1454"><span class="linenum">1454</span></a>  
<a name="l1455"><span class="linenum">1455</span></a>      return array(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>, <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>);
<a name="l1456"><span class="linenum">1456</span></a>  }
<a name="l1457"><span class="linenum">1457</span></a>  
<a name="l1458"><span class="linenum">1458</span></a>  <span class="comment">/**</span>
<a name="l1459"><span class="linenum">1459</span></a>  <span class="comment"> * Function that creates a role</span>
<a name="l1460"><span class="linenum">1460</span></a>  <span class="comment"> *</span>
<a name="l1461"><span class="linenum">1461</span></a>  <span class="comment"> * @param string $name role name</span>
<a name="l1462"><span class="linenum">1462</span></a>  <span class="comment"> * @param string $shortname role short name</span>
<a name="l1463"><span class="linenum">1463</span></a>  <span class="comment"> * @param string $description role description</span>
<a name="l1464"><span class="linenum">1464</span></a>  <span class="comment"> * @param string $archetype</span>
<a name="l1465"><span class="linenum">1465</span></a>  <span class="comment"> * @return int id or dml_exception</span>
<a name="l1466"><span class="linenum">1466</span></a>  <span class="comment"> */</span>
<a name="l1467"><span class="linenum">1467</span></a>  function <a class="function" onClick="logFunction('create_role')" href="../_functions/create_role.html" onMouseOver="funcPopup(event,'create_role')">create_role</a>(<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>, <a class="var it1256" onMouseOver="hilite(1256)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../_variables/shortname.html">$shortname</a>, <a class="var it507" onMouseOver="hilite(507)" onMouseOut="lolite()" onClick="logVariable('description')" href="../_variables/description.html">$description</a>, <a class="var it7279" onMouseOver="hilite(7279)" onMouseOut="lolite()" onClick="logVariable('archetype')" href="../_variables/archetype.html">$archetype</a> = '') {
<a name="l1468"><span class="linenum">1468</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1469"><span class="linenum">1469</span></a>  
<a name="l1470"><span class="linenum">1470</span></a>      if (<a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it7279" onMouseOver="hilite(7279)" onMouseOut="lolite()" onClick="logVariable('archetype')" href="../_variables/archetype.html">$archetype</a>, 'moodle/legacy:') !== false) {
<a name="l1471"><span class="linenum">1471</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Use new role archetype parameter in <a class="function" onClick="logFunction('create_role')" href="../_functions/create_role.html" onMouseOver="funcPopup(event,'create_role')">create_role</a>() instead of old legacy capabilities.');
<a name="l1472"><span class="linenum">1472</span></a>      }
<a name="l1473"><span class="linenum">1473</span></a>  
<a name="l1474"><span class="linenum">1474</span></a>  <span class="comment">    // verify role archetype actually exists</span>
<a name="l1475"><span class="linenum">1475</span></a>      <a class="var it3916" onMouseOver="hilite(3916)" onMouseOut="lolite()" onClick="logVariable('archetypes')" href="../_variables/archetypes.html">$archetypes</a> = <a class="function" onClick="logFunction('get_role_archetypes')" href="../_functions/get_role_archetypes.html" onMouseOver="funcPopup(event,'get_role_archetypes')">get_role_archetypes</a>();
<a name="l1476"><span class="linenum">1476</span></a>      if (empty(<a class="var it3916" onMouseOver="hilite(3916)" onMouseOut="lolite()" onClick="logVariable('archetypes')" href="../_variables/archetypes.html">$archetypes</a>[<a class="var it7279" onMouseOver="hilite(7279)" onMouseOut="lolite()" onClick="logVariable('archetype')" href="../_variables/archetype.html">$archetype</a>])) {
<a name="l1477"><span class="linenum">1477</span></a>          <a class="var it7279" onMouseOver="hilite(7279)" onMouseOut="lolite()" onClick="logVariable('archetype')" href="../_variables/archetype.html">$archetype</a> = '';
<a name="l1478"><span class="linenum">1478</span></a>      }
<a name="l1479"><span class="linenum">1479</span></a>  
<a name="l1480"><span class="linenum">1480</span></a>  <span class="comment">    // Insert the role record.</span>
<a name="l1481"><span class="linenum">1481</span></a>      <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a> = new stdClass();
<a name="l1482"><span class="linenum">1482</span></a>      <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('name')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/name.html">name</a>        = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>;
<a name="l1483"><span class="linenum">1483</span></a>      <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('shortname')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/shortname.html">shortname</a>   = <a class="var it1256" onMouseOver="hilite(1256)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../_variables/shortname.html">$shortname</a>;
<a name="l1484"><span class="linenum">1484</span></a>      <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('description')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/description.html">description</a> = <a class="var it507" onMouseOver="hilite(507)" onMouseOut="lolite()" onClick="logVariable('description')" href="../_variables/description.html">$description</a>;
<a name="l1485"><span class="linenum">1485</span></a>      <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('archetype')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/archetype.html">archetype</a>   = <a class="var it7279" onMouseOver="hilite(7279)" onMouseOut="lolite()" onClick="logVariable('archetype')" href="../_variables/archetype.html">$archetype</a>;
<a name="l1486"><span class="linenum">1486</span></a>  
<a name="l1487"><span class="linenum">1487</span></a>  <span class="comment">    //find free sortorder number</span>
<a name="l1488"><span class="linenum">1488</span></a>      <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('sortorder')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/sortorder.html">sortorder</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('role', '<a class="phpfunction" onClick="logFunction('MAX')" href="../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">MAX</a>(sortorder) + 1', array());
<a name="l1489"><span class="linenum">1489</span></a>      if (empty(<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('sortorder')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/sortorder.html">sortorder</a>)) {
<a name="l1490"><span class="linenum">1490</span></a>          <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('sortorder')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/sortorder.html">sortorder</a> = 1;
<a name="l1491"><span class="linenum">1491</span></a>      }
<a name="l1492"><span class="linenum">1492</span></a>      <a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('role', <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>);
<a name="l1493"><span class="linenum">1493</span></a>  
<a name="l1494"><span class="linenum">1494</span></a>      return <a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>;
<a name="l1495"><span class="linenum">1495</span></a>  }
<a name="l1496"><span class="linenum">1496</span></a>  
<a name="l1497"><span class="linenum">1497</span></a>  <span class="comment">/**</span>
<a name="l1498"><span class="linenum">1498</span></a>  <span class="comment"> * Function that deletes a role and cleanups up after it</span>
<a name="l1499"><span class="linenum">1499</span></a>  <span class="comment"> *</span>
<a name="l1500"><span class="linenum">1500</span></a>  <span class="comment"> * @param int $roleid id of role to delete</span>
<a name="l1501"><span class="linenum">1501</span></a>  <span class="comment"> * @return bool always true</span>
<a name="l1502"><span class="linenum">1502</span></a>  <span class="comment"> */</span>
<a name="l1503"><span class="linenum">1503</span></a>  function <a class="function" onClick="logFunction('delete_role')" href="../_functions/delete_role.html" onMouseOver="funcPopup(event,'delete_role')">delete_role</a>(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>) {
<a name="l1504"><span class="linenum">1504</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1505"><span class="linenum">1505</span></a>  
<a name="l1506"><span class="linenum">1506</span></a>  <span class="comment">    // first unssign all users</span>
<a name="l1507"><span class="linenum">1507</span></a>      <a class="function" onClick="logFunction('role_unassign_all')" href="../_functions/role_unassign_all.html" onMouseOver="funcPopup(event,'role_unassign_all')">role_unassign_all</a>(array('roleid'=&gt;<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>));
<a name="l1508"><span class="linenum">1508</span></a>  
<a name="l1509"><span class="linenum">1509</span></a>  <span class="comment">    // cleanup all references to this role, ignore errors</span>
<a name="l1510"><span class="linenum">1510</span></a>      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('role_capabilities',   array('roleid'=&gt;<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>));
<a name="l1511"><span class="linenum">1511</span></a>      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('role_allow_assign',   array('roleid'=&gt;<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>));
<a name="l1512"><span class="linenum">1512</span></a>      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('role_allow_assign',   array('allowassign'=&gt;<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>));
<a name="l1513"><span class="linenum">1513</span></a>      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('role_allow_override', array('roleid'=&gt;<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>));
<a name="l1514"><span class="linenum">1514</span></a>      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('role_allow_override', array('allowoverride'=&gt;<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>));
<a name="l1515"><span class="linenum">1515</span></a>      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('role_names',          array('roleid'=&gt;<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>));
<a name="l1516"><span class="linenum">1516</span></a>      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('role_context_levels', array('roleid'=&gt;<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>));
<a name="l1517"><span class="linenum">1517</span></a>  
<a name="l1518"><span class="linenum">1518</span></a>  <span class="comment">    // Get role record before it's deleted.</span>
<a name="l1519"><span class="linenum">1519</span></a>      <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('role', array('id'=&gt;<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>));
<a name="l1520"><span class="linenum">1520</span></a>  
<a name="l1521"><span class="linenum">1521</span></a>  <span class="comment">    // Finally delete the role itself.</span>
<a name="l1522"><span class="linenum">1522</span></a>      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('role', array('id'=&gt;<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>));
<a name="l1523"><span class="linenum">1523</span></a>  
<a name="l1524"><span class="linenum">1524</span></a>  <span class="comment">    // Trigger event.</span>
<a name="l1525"><span class="linenum">1525</span></a>      <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('role_deleted')" href="../_classes/role_deleted.html" onMouseOver="classPopup(event,'role_deleted')">role_deleted</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(
<a name="l1526"><span class="linenum">1526</span></a>          array(
<a name="l1527"><span class="linenum">1527</span></a>              'context' =&gt; <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(),
<a name="l1528"><span class="linenum">1528</span></a>              'objectid' =&gt; <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>,
<a name="l1529"><span class="linenum">1529</span></a>              'other' =&gt;
<a name="l1530"><span class="linenum">1530</span></a>                  array(
<a name="l1531"><span class="linenum">1531</span></a>                      'shortname' =&gt; <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('shortname')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/shortname.html">shortname</a>,
<a name="l1532"><span class="linenum">1532</span></a>                      'description' =&gt; <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('description')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/description.html">description</a>,
<a name="l1533"><span class="linenum">1533</span></a>                      'archetype' =&gt; <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;archetype
<a name="l1534"><span class="linenum">1534</span></a>                  )
<a name="l1535"><span class="linenum">1535</span></a>              )
<a name="l1536"><span class="linenum">1536</span></a>          );
<a name="l1537"><span class="linenum">1537</span></a>      <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('role', <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>);
<a name="l1538"><span class="linenum">1538</span></a>      <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1539"><span class="linenum">1539</span></a>  
<a name="l1540"><span class="linenum">1540</span></a>      return true;
<a name="l1541"><span class="linenum">1541</span></a>  }
<a name="l1542"><span class="linenum">1542</span></a>  
<a name="l1543"><span class="linenum">1543</span></a>  <span class="comment">/**</span>
<a name="l1544"><span class="linenum">1544</span></a>  <span class="comment"> * Function to write context specific overrides, or default capabilities.</span>
<a name="l1545"><span class="linenum">1545</span></a>  <span class="comment"> *</span>
<a name="l1546"><span class="linenum">1546</span></a>  <span class="comment"> * NOTE: use $context-&gt;mark_dirty() after this</span>
<a name="l1547"><span class="linenum">1547</span></a>  <span class="comment"> *</span>
<a name="l1548"><span class="linenum">1548</span></a>  <span class="comment"> * @param string $capability string name</span>
<a name="l1549"><span class="linenum">1549</span></a>  <span class="comment"> * @param int $permission CAP_ constants</span>
<a name="l1550"><span class="linenum">1550</span></a>  <span class="comment"> * @param int $roleid role id</span>
<a name="l1551"><span class="linenum">1551</span></a>  <span class="comment"> * @param int|context $contextid context id</span>
<a name="l1552"><span class="linenum">1552</span></a>  <span class="comment"> * @param bool $overwrite</span>
<a name="l1553"><span class="linenum">1553</span></a>  <span class="comment"> * @return bool always true or exception</span>
<a name="l1554"><span class="linenum">1554</span></a>  <span class="comment"> */</span>
<a name="l1555"><span class="linenum">1555</span></a>  function <a class="function" onClick="logFunction('assign_capability')" href="../_functions/assign_capability.html" onMouseOver="funcPopup(event,'assign_capability')">assign_capability</a>(<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, <a class="var it3735" onMouseOver="hilite(3735)" onMouseOut="lolite()" onClick="logVariable('permission')" href="../_variables/permission.html">$permission</a>, <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, <a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a>, <a class="var it9604" onMouseOver="hilite(9604)" onMouseOut="lolite()" onClick="logVariable('overwrite')" href="../_variables/overwrite.html">$overwrite</a> = false) {
<a name="l1556"><span class="linenum">1556</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1557"><span class="linenum">1557</span></a>  
<a name="l1558"><span class="linenum">1558</span></a>      if (<a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a> instanceof context) {
<a name="l1559"><span class="linenum">1559</span></a>          <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a>;
<a name="l1560"><span class="linenum">1560</span></a>      } else {
<a name="l1561"><span class="linenum">1561</span></a>          <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = context::<a class="function" onClick="logFunction('instance_by_id')" href="../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>(<a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a>);
<a name="l1562"><span class="linenum">1562</span></a>      }
<a name="l1563"><span class="linenum">1563</span></a>  
<a name="l1564"><span class="linenum">1564</span></a>      if (empty(<a class="var it3735" onMouseOver="hilite(3735)" onMouseOut="lolite()" onClick="logVariable('permission')" href="../_variables/permission.html">$permission</a>) || <a class="var it3735" onMouseOver="hilite(3735)" onMouseOut="lolite()" onClick="logVariable('permission')" href="../_variables/permission.html">$permission</a> == <a class="constant" onClick="logConstant('CAP_INHERIT')" href="../_constants/CAP_INHERIT.html" onMouseOver="constPopup(event,'CAP_INHERIT')">CAP_INHERIT</a>) { // if permission is not set
<a name="l1565"><span class="linenum">1565</span></a>          <a class="function" onClick="logFunction('unassign_capability')" href="../_functions/unassign_capability.html" onMouseOver="funcPopup(event,'unassign_capability')">unassign_capability</a>(<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l1566"><span class="linenum">1566</span></a>          return true;
<a name="l1567"><span class="linenum">1567</span></a>      }
<a name="l1568"><span class="linenum">1568</span></a>  
<a name="l1569"><span class="linenum">1569</span></a>      <a class="var it3149" onMouseOver="hilite(3149)" onMouseOut="lolite()" onClick="logVariable('existing')" href="../_variables/existing.html">$existing</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('role_capabilities', array('contextid'=&gt;<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'roleid'=&gt;<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, 'capability'=&gt;<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>));
<a name="l1570"><span class="linenum">1570</span></a>  
<a name="l1571"><span class="linenum">1571</span></a>      if (<a class="var it3149" onMouseOver="hilite(3149)" onMouseOut="lolite()" onClick="logVariable('existing')" href="../_variables/existing.html">$existing</a> and !<a class="var it9604" onMouseOver="hilite(9604)" onMouseOut="lolite()" onClick="logVariable('overwrite')" href="../_variables/overwrite.html">$overwrite</a>) {   // We want to keep whatever is there already
<a name="l1572"><span class="linenum">1572</span></a>          return true;
<a name="l1573"><span class="linenum">1573</span></a>      }
<a name="l1574"><span class="linenum">1574</span></a>  
<a name="l1575"><span class="linenum">1575</span></a>      <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a> = new stdClass();
<a name="l1576"><span class="linenum">1576</span></a>      <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>-&gt;<a onClick="logVariable('contextid')" class="var it40429" onMouseOver="hilite(40429)" onMouseOut="lolite()" href="../_variables/contextid.html">contextid</a>    = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l1577"><span class="linenum">1577</span></a>      <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>-&gt;<a onClick="logVariable('roleid')" class="var it40429" onMouseOver="hilite(40429)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>       = <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>;
<a name="l1578"><span class="linenum">1578</span></a>      <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>-&gt;<a onClick="logVariable('capability')" class="var it40429" onMouseOver="hilite(40429)" onMouseOut="lolite()" href="../_variables/capability.html">capability</a>   = <a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>;
<a name="l1579"><span class="linenum">1579</span></a>      <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>-&gt;<a onClick="logVariable('permission')" class="var it40429" onMouseOver="hilite(40429)" onMouseOut="lolite()" href="../_variables/permission.html">permission</a>   = <a class="var it3735" onMouseOver="hilite(3735)" onMouseOut="lolite()" onClick="logVariable('permission')" href="../_variables/permission.html">$permission</a>;
<a name="l1580"><span class="linenum">1580</span></a>      <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>-&gt;<a onClick="logVariable('timemodified')" class="var it40429" onMouseOver="hilite(40429)" onMouseOut="lolite()" href="../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1581"><span class="linenum">1581</span></a>      <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>-&gt;<a onClick="logVariable('modifierid')" class="var it40429" onMouseOver="hilite(40429)" onMouseOut="lolite()" href="../_variables/modifierid.html">modifierid</a>   = empty(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) ? 0 : <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l1582"><span class="linenum">1582</span></a>  
<a name="l1583"><span class="linenum">1583</span></a>      if (<a class="var it3149" onMouseOver="hilite(3149)" onMouseOut="lolite()" onClick="logVariable('existing')" href="../_variables/existing.html">$existing</a>) {
<a name="l1584"><span class="linenum">1584</span></a>          <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>-&gt;<a onClick="logVariable('id')" class="var it40429" onMouseOver="hilite(40429)" onMouseOut="lolite()" href="../_variables/id.html">id</a> = <a class="var it3149" onMouseOver="hilite(3149)" onMouseOut="lolite()" onClick="logVariable('existing')" href="../_variables/existing.html">$existing</a>-&gt;<a onClick="logVariable('id')" class="var it39876" onMouseOver="hilite(39876)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l1585"><span class="linenum">1585</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('role_capabilities', <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>);
<a name="l1586"><span class="linenum">1586</span></a>      } else {
<a name="l1587"><span class="linenum">1587</span></a>          if (<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('context', array('id'=&gt;<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>))) {
<a name="l1588"><span class="linenum">1588</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('role_capabilities', <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>);
<a name="l1589"><span class="linenum">1589</span></a>          }
<a name="l1590"><span class="linenum">1590</span></a>      }
<a name="l1591"><span class="linenum">1591</span></a>      return true;
<a name="l1592"><span class="linenum">1592</span></a>  }
<a name="l1593"><span class="linenum">1593</span></a>  
<a name="l1594"><span class="linenum">1594</span></a>  <span class="comment">/**</span>
<a name="l1595"><span class="linenum">1595</span></a>  <span class="comment"> * Unassign a capability from a role.</span>
<a name="l1596"><span class="linenum">1596</span></a>  <span class="comment"> *</span>
<a name="l1597"><span class="linenum">1597</span></a>  <span class="comment"> * NOTE: use $context-&gt;mark_dirty() after this</span>
<a name="l1598"><span class="linenum">1598</span></a>  <span class="comment"> *</span>
<a name="l1599"><span class="linenum">1599</span></a>  <span class="comment"> * @param string $capability the name of the capability</span>
<a name="l1600"><span class="linenum">1600</span></a>  <span class="comment"> * @param int $roleid the role id</span>
<a name="l1601"><span class="linenum">1601</span></a>  <span class="comment"> * @param int|context $contextid null means all contexts</span>
<a name="l1602"><span class="linenum">1602</span></a>  <span class="comment"> * @return boolean true or exception</span>
<a name="l1603"><span class="linenum">1603</span></a>  <span class="comment"> */</span>
<a name="l1604"><span class="linenum">1604</span></a>  function <a class="function" onClick="logFunction('unassign_capability')" href="../_functions/unassign_capability.html" onMouseOver="funcPopup(event,'unassign_capability')">unassign_capability</a>(<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, <a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a> = null) {
<a name="l1605"><span class="linenum">1605</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1606"><span class="linenum">1606</span></a>  
<a name="l1607"><span class="linenum">1607</span></a>      if (!empty(<a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a>)) {
<a name="l1608"><span class="linenum">1608</span></a>          if (<a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a> instanceof context) {
<a name="l1609"><span class="linenum">1609</span></a>              <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a>;
<a name="l1610"><span class="linenum">1610</span></a>          } else {
<a name="l1611"><span class="linenum">1611</span></a>              <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = context::<a class="function" onClick="logFunction('instance_by_id')" href="../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>(<a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a>);
<a name="l1612"><span class="linenum">1612</span></a>          }
<a name="l1613"><span class="linenum">1613</span></a>  <span class="comment">        // delete from context rel, if this is the last override in this context</span>
<a name="l1614"><span class="linenum">1614</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('role_capabilities', array('capability'=&gt;<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, 'roleid'=&gt;<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, 'contextid'=&gt;<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l1615"><span class="linenum">1615</span></a>      } else {
<a name="l1616"><span class="linenum">1616</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('role_capabilities', array('capability'=&gt;<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, 'roleid'=&gt;<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>));
<a name="l1617"><span class="linenum">1617</span></a>      }
<a name="l1618"><span class="linenum">1618</span></a>      return true;
<a name="l1619"><span class="linenum">1619</span></a>  }
<a name="l1620"><span class="linenum">1620</span></a>  
<a name="l1621"><span class="linenum">1621</span></a>  <span class="comment">/**</span>
<a name="l1622"><span class="linenum">1622</span></a>  <span class="comment"> * Get the roles that have a given capability assigned to it</span>
<a name="l1623"><span class="linenum">1623</span></a>  <span class="comment"> *</span>
<a name="l1624"><span class="linenum">1624</span></a>  <span class="comment"> * This function does not resolve the actual permission of the capability.</span>
<a name="l1625"><span class="linenum">1625</span></a>  <span class="comment"> * It just checks for permissions and overrides.</span>
<a name="l1626"><span class="linenum">1626</span></a>  <span class="comment"> * Use get_roles_with_cap_in_context() if resolution is required.</span>
<a name="l1627"><span class="linenum">1627</span></a>  <span class="comment"> *</span>
<a name="l1628"><span class="linenum">1628</span></a>  <span class="comment"> * @param string $capability capability name (string)</span>
<a name="l1629"><span class="linenum">1629</span></a>  <span class="comment"> * @param string $permission optional, the permission defined for this capability</span>
<a name="l1630"><span class="linenum">1630</span></a>  <span class="comment"> *                      either CAP_ALLOW, CAP_PREVENT or CAP_PROHIBIT. Defaults to null which means any.</span>
<a name="l1631"><span class="linenum">1631</span></a>  <span class="comment"> * @param stdClass $context null means any</span>
<a name="l1632"><span class="linenum">1632</span></a>  <span class="comment"> * @return array of role records</span>
<a name="l1633"><span class="linenum">1633</span></a>  <span class="comment"> */</span>
<a name="l1634"><span class="linenum">1634</span></a>  function <a class="function" onClick="logFunction('get_roles_with_capability')" href="../_functions/get_roles_with_capability.html" onMouseOver="funcPopup(event,'get_roles_with_capability')">get_roles_with_capability</a>(<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, <a class="var it3735" onMouseOver="hilite(3735)" onMouseOut="lolite()" onClick="logVariable('permission')" href="../_variables/permission.html">$permission</a> = null, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = null) {
<a name="l1635"><span class="linenum">1635</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1636"><span class="linenum">1636</span></a>  
<a name="l1637"><span class="linenum">1637</span></a>      if (<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l1638"><span class="linenum">1638</span></a>          <a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../_variables/contexts.html">$contexts</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_parent_context_ids')" href="../_functions/get_parent_context_ids.html" onMouseOver="funcPopup(event,'get_parent_context_ids')">get_parent_context_ids</a>(true);
<a name="l1639"><span class="linenum">1639</span></a>          <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it10795" onMouseOver="hilite(10795)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../_variables/insql.html">$insql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../_variables/contexts.html">$contexts</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'ctx');
<a name="l1640"><span class="linenum">1640</span></a>          <a class="var it24411" onMouseOver="hilite(24411)" onMouseOut="lolite()" onClick="logVariable('contextsql')" href="../_variables/contextsql.html">$contextsql</a> = &quot;AND rc.contextid <a class="var it10795" onMouseOver="hilite(10795)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../_variables/insql.html">$insql</a>&quot;;
<a name="l1641"><span class="linenum">1641</span></a>      } else {
<a name="l1642"><span class="linenum">1642</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array();
<a name="l1643"><span class="linenum">1643</span></a>          <a class="var it24411" onMouseOver="hilite(24411)" onMouseOut="lolite()" onClick="logVariable('contextsql')" href="../_variables/contextsql.html">$contextsql</a> = '';
<a name="l1644"><span class="linenum">1644</span></a>      }
<a name="l1645"><span class="linenum">1645</span></a>  
<a name="l1646"><span class="linenum">1646</span></a>      if (<a class="var it3735" onMouseOver="hilite(3735)" onMouseOut="lolite()" onClick="logVariable('permission')" href="../_variables/permission.html">$permission</a>) {
<a name="l1647"><span class="linenum">1647</span></a>          <a class="var it5860" onMouseOver="hilite(5860)" onMouseOut="lolite()" onClick="logVariable('permissionsql')" href="../_variables/permissionsql.html">$permissionsql</a> = &quot; AND rc.permission = :permission&quot;;
<a name="l1648"><span class="linenum">1648</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['permission'] = <a class="var it3735" onMouseOver="hilite(3735)" onMouseOut="lolite()" onClick="logVariable('permission')" href="../_variables/permission.html">$permission</a>;
<a name="l1649"><span class="linenum">1649</span></a>      } else {
<a name="l1650"><span class="linenum">1650</span></a>          <a class="var it5860" onMouseOver="hilite(5860)" onMouseOut="lolite()" onClick="logVariable('permissionsql')" href="../_variables/permissionsql.html">$permissionsql</a> = '';
<a name="l1651"><span class="linenum">1651</span></a>      }
<a name="l1652"><span class="linenum">1652</span></a>  
<a name="l1653"><span class="linenum">1653</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT r.*
<a name="l1654"><span class="linenum">1654</span></a>                FROM {role} r
<a name="l1655"><span class="linenum">1655</span></a>               WHERE r.id IN (SELECT rc.roleid
<a name="l1656"><span class="linenum">1656</span></a>                                FROM {role_capabilities} rc
<a name="l1657"><span class="linenum">1657</span></a>                               WHERE rc.capability = :capname
<a name="l1658"><span class="linenum">1658</span></a>                                     <a class="var it24411" onMouseOver="hilite(24411)" onMouseOut="lolite()" onClick="logVariable('contextsql')" href="../_variables/contextsql.html">$contextsql</a>
<a name="l1659"><span class="linenum">1659</span></a>                                     <a class="var it5860" onMouseOver="hilite(5860)" onMouseOut="lolite()" onClick="logVariable('permissionsql')" href="../_variables/permissionsql.html">$permissionsql</a>)&quot;;
<a name="l1660"><span class="linenum">1660</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['capname'] = <a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>;
<a name="l1661"><span class="linenum">1661</span></a>  
<a name="l1662"><span class="linenum">1662</span></a>  
<a name="l1663"><span class="linenum">1663</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l1664"><span class="linenum">1664</span></a>  }
<a name="l1665"><span class="linenum">1665</span></a>  
<a name="l1666"><span class="linenum">1666</span></a>  <span class="comment">/**</span>
<a name="l1667"><span class="linenum">1667</span></a>  <span class="comment"> * This function makes a role-assignment (a role for a user in a particular context)</span>
<a name="l1668"><span class="linenum">1668</span></a>  <span class="comment"> *</span>
<a name="l1669"><span class="linenum">1669</span></a>  <span class="comment"> * @param int $roleid the role of the id</span>
<a name="l1670"><span class="linenum">1670</span></a>  <span class="comment"> * @param int $userid userid</span>
<a name="l1671"><span class="linenum">1671</span></a>  <span class="comment"> * @param int|context $contextid id of the context</span>
<a name="l1672"><span class="linenum">1672</span></a>  <span class="comment"> * @param string $component example 'enrol_ldap', defaults to '' which means manual assignment,</span>
<a name="l1673"><span class="linenum">1673</span></a>  <span class="comment"> * @param int $itemid id of enrolment/auth plugin</span>
<a name="l1674"><span class="linenum">1674</span></a>  <span class="comment"> * @param string $timemodified defaults to current time</span>
<a name="l1675"><span class="linenum">1675</span></a>  <span class="comment"> * @return int new/existing id of the assignment</span>
<a name="l1676"><span class="linenum">1676</span></a>  <span class="comment"> */</span>
<a name="l1677"><span class="linenum">1677</span></a>  function <a class="function" onClick="logFunction('role_assign')" href="../_functions/role_assign.html" onMouseOver="funcPopup(event,'role_assign')">role_assign</a>(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a>, <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a> = '', <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../_variables/itemid.html">$itemid</a> = 0, <a class="var it91" onMouseOver="hilite(91)" onMouseOut="lolite()" onClick="logVariable('timemodified')" href="../_variables/timemodified.html">$timemodified</a> = '') {
<a name="l1678"><span class="linenum">1678</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1679"><span class="linenum">1679</span></a>  
<a name="l1680"><span class="linenum">1680</span></a>  <span class="comment">    // first of all detect if somebody is using old style parameters</span>
<a name="l1681"><span class="linenum">1681</span></a>      if (<a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a> === 0 or <a class="phpfunction" onClick="logFunction('is_numeric')" href="../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>)) {
<a name="l1682"><span class="linenum">1682</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid call to <a class="function" onClick="logFunction('role_assign')" href="../_functions/role_assign.html" onMouseOver="funcPopup(event,'role_assign')">role_assign</a>(), code needs to be updated to use new order of parameters');
<a name="l1683"><span class="linenum">1683</span></a>      }
<a name="l1684"><span class="linenum">1684</span></a>  
<a name="l1685"><span class="linenum">1685</span></a>  <span class="comment">    // now validate all parameters</span>
<a name="l1686"><span class="linenum">1686</span></a>      if (empty(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>)) {
<a name="l1687"><span class="linenum">1687</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid call to <a class="function" onClick="logFunction('role_assign')" href="../_functions/role_assign.html" onMouseOver="funcPopup(event,'role_assign')">role_assign</a>(), roleid can not be empty');
<a name="l1688"><span class="linenum">1688</span></a>      }
<a name="l1689"><span class="linenum">1689</span></a>  
<a name="l1690"><span class="linenum">1690</span></a>      if (empty(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>)) {
<a name="l1691"><span class="linenum">1691</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid call to <a class="function" onClick="logFunction('role_assign')" href="../_functions/role_assign.html" onMouseOver="funcPopup(event,'role_assign')">role_assign</a>(), userid can not be empty');
<a name="l1692"><span class="linenum">1692</span></a>      }
<a name="l1693"><span class="linenum">1693</span></a>  
<a name="l1694"><span class="linenum">1694</span></a>      if (<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../_variables/itemid.html">$itemid</a>) {
<a name="l1695"><span class="linenum">1695</span></a>          if (<a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>, '_') === false) {
<a name="l1696"><span class="linenum">1696</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid call to <a class="function" onClick="logFunction('role_assign')" href="../_functions/role_assign.html" onMouseOver="funcPopup(event,'role_assign')">role_assign</a>(), component must start with plugin type such as&quot;enrol_&quot; when itemid specified', 'component:'.<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>);
<a name="l1697"><span class="linenum">1697</span></a>          }
<a name="l1698"><span class="linenum">1698</span></a>      } else {
<a name="l1699"><span class="linenum">1699</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../_variables/itemid.html">$itemid</a> = 0;
<a name="l1700"><span class="linenum">1700</span></a>          if (<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a> !== '' and <a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>, '_') === false) {
<a name="l1701"><span class="linenum">1701</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid call to <a class="function" onClick="logFunction('role_assign')" href="../_functions/role_assign.html" onMouseOver="funcPopup(event,'role_assign')">role_assign</a>(), invalid component string', 'component:'.<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>);
<a name="l1702"><span class="linenum">1702</span></a>          }
<a name="l1703"><span class="linenum">1703</span></a>      }
<a name="l1704"><span class="linenum">1704</span></a>  
<a name="l1705"><span class="linenum">1705</span></a>      if (!<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('user', array('id'=&gt;<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, 'deleted'=&gt;0))) {
<a name="l1706"><span class="linenum">1706</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('User ID does not exist or is deleted!', 'userid:'.<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>);
<a name="l1707"><span class="linenum">1707</span></a>      }
<a name="l1708"><span class="linenum">1708</span></a>  
<a name="l1709"><span class="linenum">1709</span></a>      if (<a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a> instanceof context) {
<a name="l1710"><span class="linenum">1710</span></a>          <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a>;
<a name="l1711"><span class="linenum">1711</span></a>      } else {
<a name="l1712"><span class="linenum">1712</span></a>          <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = context::<a class="function" onClick="logFunction('instance_by_id')" href="../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>(<a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a>, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l1713"><span class="linenum">1713</span></a>      }
<a name="l1714"><span class="linenum">1714</span></a>  
<a name="l1715"><span class="linenum">1715</span></a>      if (!<a class="var it91" onMouseOver="hilite(91)" onMouseOut="lolite()" onClick="logVariable('timemodified')" href="../_variables/timemodified.html">$timemodified</a>) {
<a name="l1716"><span class="linenum">1716</span></a>          <a class="var it91" onMouseOver="hilite(91)" onMouseOut="lolite()" onClick="logVariable('timemodified')" href="../_variables/timemodified.html">$timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1717"><span class="linenum">1717</span></a>      }
<a name="l1718"><span class="linenum">1718</span></a>  
<a name="l1719"><span class="linenum">1719</span></a>  <span class="comment">    // Check for existing entry</span>
<a name="l1720"><span class="linenum">1720</span></a>      <a class="var it11181" onMouseOver="hilite(11181)" onMouseOut="lolite()" onClick="logVariable('ras')" href="../_variables/ras.html">$ras</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('role_assignments', array('roleid'=&gt;<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, 'contextid'=&gt;<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'userid'=&gt;<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, 'component'=&gt;<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>, 'itemid'=&gt;<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../_variables/itemid.html">$itemid</a>), 'id');
<a name="l1721"><span class="linenum">1721</span></a>  
<a name="l1722"><span class="linenum">1722</span></a>      if (<a class="var it11181" onMouseOver="hilite(11181)" onMouseOut="lolite()" onClick="logVariable('ras')" href="../_variables/ras.html">$ras</a>) {
<a name="l1723"><span class="linenum">1723</span></a>  <span class="comment">        // role already assigned - this should not happen</span>
<a name="l1724"><span class="linenum">1724</span></a>          if (<a class="phpfunction" onClick="logFunction('count')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it11181" onMouseOver="hilite(11181)" onMouseOut="lolite()" onClick="logVariable('ras')" href="../_variables/ras.html">$ras</a>) &gt; 1) {
<a name="l1725"><span class="linenum">1725</span></a>  <span class="comment">            // very weird - remove all duplicates!</span>
<a name="l1726"><span class="linenum">1726</span></a>              <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a> = <a class="phpfunction" onClick="logFunction('array_shift')" href="../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it11181" onMouseOver="hilite(11181)" onMouseOut="lolite()" onClick="logVariable('ras')" href="../_variables/ras.html">$ras</a>);
<a name="l1727"><span class="linenum">1727</span></a>              foreach (<a class="var it11181" onMouseOver="hilite(11181)" onMouseOut="lolite()" onClick="logVariable('ras')" href="../_variables/ras.html">$ras</a> as <a class="var it746" onMouseOver="hilite(746)" onMouseOut="lolite()" onClick="logVariable('r')" href="../_variables/r.html">$r</a>) {
<a name="l1728"><span class="linenum">1728</span></a>                  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('role_assignments', array('id'=&gt;<a class="var it746" onMouseOver="hilite(746)" onMouseOut="lolite()" onClick="logVariable('r')" href="../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('id')" class="var it39453" onMouseOver="hilite(39453)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l1729"><span class="linenum">1729</span></a>              }
<a name="l1730"><span class="linenum">1730</span></a>          } else {
<a name="l1731"><span class="linenum">1731</span></a>              <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it11181" onMouseOver="hilite(11181)" onMouseOut="lolite()" onClick="logVariable('ras')" href="../_variables/ras.html">$ras</a>);
<a name="l1732"><span class="linenum">1732</span></a>          }
<a name="l1733"><span class="linenum">1733</span></a>  
<a name="l1734"><span class="linenum">1734</span></a>  <span class="comment">        // actually there is no need to update, reset anything or trigger any event, so just return</span>
<a name="l1735"><span class="linenum">1735</span></a>          return <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('id')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l1736"><span class="linenum">1736</span></a>      }
<a name="l1737"><span class="linenum">1737</span></a>  
<a name="l1738"><span class="linenum">1738</span></a>  <span class="comment">    // Create a new entry</span>
<a name="l1739"><span class="linenum">1739</span></a>      <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a> = new stdClass();
<a name="l1740"><span class="linenum">1740</span></a>      <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('roleid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>       = <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>;
<a name="l1741"><span class="linenum">1741</span></a>      <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('contextid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/contextid.html">contextid</a>    = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l1742"><span class="linenum">1742</span></a>      <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('userid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>       = <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>;
<a name="l1743"><span class="linenum">1743</span></a>      <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('component')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/component.html">component</a>    = <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>;
<a name="l1744"><span class="linenum">1744</span></a>      <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('itemid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/itemid.html">itemid</a>       = <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../_variables/itemid.html">$itemid</a>;
<a name="l1745"><span class="linenum">1745</span></a>      <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('timemodified')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/timemodified.html">timemodified</a> = <a class="var it91" onMouseOver="hilite(91)" onMouseOut="lolite()" onClick="logVariable('timemodified')" href="../_variables/timemodified.html">$timemodified</a>;
<a name="l1746"><span class="linenum">1746</span></a>      <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('modifierid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/modifierid.html">modifierid</a>   = empty(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) ? 0 : <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l1747"><span class="linenum">1747</span></a>      <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('sortorder')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/sortorder.html">sortorder</a>    = 0;
<a name="l1748"><span class="linenum">1748</span></a>  
<a name="l1749"><span class="linenum">1749</span></a>      <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('id')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/id.html">id</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('role_assignments', <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>);
<a name="l1750"><span class="linenum">1750</span></a>  
<a name="l1751"><span class="linenum">1751</span></a>  <span class="comment">    // mark context as dirty - again expensive, but needed</span>
<a name="l1752"><span class="linenum">1752</span></a>      <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('mark_dirty')" href="../_functions/mark_dirty.html" onMouseOver="funcPopup(event,'mark_dirty')">mark_dirty</a>();
<a name="l1753"><span class="linenum">1753</span></a>  
<a name="l1754"><span class="linenum">1754</span></a>      if (!empty(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) &amp;&amp; <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a> == <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) {
<a name="l1755"><span class="linenum">1755</span></a>  <span class="comment">        // If the user is the current user, then do full reload of capabilities too.</span>
<a name="l1756"><span class="linenum">1756</span></a>          <a class="function" onClick="logFunction('reload_all_capabilities')" href="../_functions/reload_all_capabilities.html" onMouseOver="funcPopup(event,'reload_all_capabilities')">reload_all_capabilities</a>();
<a name="l1757"><span class="linenum">1757</span></a>      }
<a name="l1758"><span class="linenum">1758</span></a>  
<a name="l1759"><span class="linenum">1759</span></a>      <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('role_assigned')" href="../_classes/role_assigned.html" onMouseOver="classPopup(event,'role_assigned')">role_assigned</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(array(
<a name="l1760"><span class="linenum">1760</span></a>          'context' =&gt; <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>,
<a name="l1761"><span class="linenum">1761</span></a>          'objectid' =&gt; <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('roleid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>,
<a name="l1762"><span class="linenum">1762</span></a>          'relateduserid' =&gt; <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('userid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>,
<a name="l1763"><span class="linenum">1763</span></a>          'other' =&gt; array(
<a name="l1764"><span class="linenum">1764</span></a>              'id' =&gt; <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('id')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l1765"><span class="linenum">1765</span></a>              'component' =&gt; <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('component')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/component.html">component</a>,
<a name="l1766"><span class="linenum">1766</span></a>              'itemid' =&gt; <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;itemid
<a name="l1767"><span class="linenum">1767</span></a>          )
<a name="l1768"><span class="linenum">1768</span></a>      ));
<a name="l1769"><span class="linenum">1769</span></a>      <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('role_assignments', <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>);
<a name="l1770"><span class="linenum">1770</span></a>      <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1771"><span class="linenum">1771</span></a>  
<a name="l1772"><span class="linenum">1772</span></a>      return <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('id')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l1773"><span class="linenum">1773</span></a>  }
<a name="l1774"><span class="linenum">1774</span></a>  
<a name="l1775"><span class="linenum">1775</span></a>  <span class="comment">/**</span>
<a name="l1776"><span class="linenum">1776</span></a>  <span class="comment"> * Removes one role assignment</span>
<a name="l1777"><span class="linenum">1777</span></a>  <span class="comment"> *</span>
<a name="l1778"><span class="linenum">1778</span></a>  <span class="comment"> * @param int $roleid</span>
<a name="l1779"><span class="linenum">1779</span></a>  <span class="comment"> * @param int  $userid</span>
<a name="l1780"><span class="linenum">1780</span></a>  <span class="comment"> * @param int  $contextid</span>
<a name="l1781"><span class="linenum">1781</span></a>  <span class="comment"> * @param string $component</span>
<a name="l1782"><span class="linenum">1782</span></a>  <span class="comment"> * @param int  $itemid</span>
<a name="l1783"><span class="linenum">1783</span></a>  <span class="comment"> * @return void</span>
<a name="l1784"><span class="linenum">1784</span></a>  <span class="comment"> */</span>
<a name="l1785"><span class="linenum">1785</span></a>  function <a class="function" onClick="logFunction('role_unassign')" href="../_functions/role_unassign.html" onMouseOver="funcPopup(event,'role_unassign')">role_unassign</a>(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a>, <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a> = '', <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../_variables/itemid.html">$itemid</a> = 0) {
<a name="l1786"><span class="linenum">1786</span></a>  <span class="comment">    // first make sure the params make sense</span>
<a name="l1787"><span class="linenum">1787</span></a>      if (<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a> == 0 or <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> == 0 or <a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a> == 0) {
<a name="l1788"><span class="linenum">1788</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid call to <a class="function" onClick="logFunction('role_unassign')" href="../_functions/role_unassign.html" onMouseOver="funcPopup(event,'role_unassign')">role_unassign</a>(), please use <a class="function" onClick="logFunction('role_unassign_all')" href="../_functions/role_unassign_all.html" onMouseOver="funcPopup(event,'role_unassign_all')">role_unassign_all</a>() when removing multiple role assignments');
<a name="l1789"><span class="linenum">1789</span></a>      }
<a name="l1790"><span class="linenum">1790</span></a>  
<a name="l1791"><span class="linenum">1791</span></a>      if (<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../_variables/itemid.html">$itemid</a>) {
<a name="l1792"><span class="linenum">1792</span></a>          if (<a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>, '_') === false) {
<a name="l1793"><span class="linenum">1793</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid call to <a class="function" onClick="logFunction('role_assign')" href="../_functions/role_assign.html" onMouseOver="funcPopup(event,'role_assign')">role_assign</a>(), component must start with plugin type such as &quot;enrol_&quot; when itemid specified', 'component:'.<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>);
<a name="l1794"><span class="linenum">1794</span></a>          }
<a name="l1795"><span class="linenum">1795</span></a>      } else {
<a name="l1796"><span class="linenum">1796</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../_variables/itemid.html">$itemid</a> = 0;
<a name="l1797"><span class="linenum">1797</span></a>          if (<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a> !== '' and <a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>, '_') === false) {
<a name="l1798"><span class="linenum">1798</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid call to <a class="function" onClick="logFunction('role_assign')" href="../_functions/role_assign.html" onMouseOver="funcPopup(event,'role_assign')">role_assign</a>(), invalid component string', 'component:'.<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>);
<a name="l1799"><span class="linenum">1799</span></a>          }
<a name="l1800"><span class="linenum">1800</span></a>      }
<a name="l1801"><span class="linenum">1801</span></a>  
<a name="l1802"><span class="linenum">1802</span></a>      <a class="function" onClick="logFunction('role_unassign_all')" href="../_functions/role_unassign_all.html" onMouseOver="funcPopup(event,'role_unassign_all')">role_unassign_all</a>(array('roleid'=&gt;<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, 'userid'=&gt;<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, 'contextid'=&gt;<a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a>, 'component'=&gt;<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>, 'itemid'=&gt;<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../_variables/itemid.html">$itemid</a>), false, false);
<a name="l1803"><span class="linenum">1803</span></a>  }
<a name="l1804"><span class="linenum">1804</span></a>  
<a name="l1805"><span class="linenum">1805</span></a>  <span class="comment">/**</span>
<a name="l1806"><span class="linenum">1806</span></a>  <span class="comment"> * Removes multiple role assignments, parameters may contain:</span>
<a name="l1807"><span class="linenum">1807</span></a>  <span class="comment"> *   'roleid', 'userid', 'contextid', 'component', 'enrolid'.</span>
<a name="l1808"><span class="linenum">1808</span></a>  <span class="comment"> *</span>
<a name="l1809"><span class="linenum">1809</span></a>  <span class="comment"> * @param array $params role assignment parameters</span>
<a name="l1810"><span class="linenum">1810</span></a>  <span class="comment"> * @param bool $subcontexts unassign in subcontexts too</span>
<a name="l1811"><span class="linenum">1811</span></a>  <span class="comment"> * @param bool $includemanual include manual role assignments too</span>
<a name="l1812"><span class="linenum">1812</span></a>  <span class="comment"> * @return void</span>
<a name="l1813"><span class="linenum">1813</span></a>  <span class="comment"> */</span>
<a name="l1814"><span class="linenum">1814</span></a>  function <a class="function" onClick="logFunction('role_unassign_all')" href="../_functions/role_unassign_all.html" onMouseOver="funcPopup(event,'role_unassign_all')">role_unassign_all</a>(array <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it28812" onMouseOver="hilite(28812)" onMouseOut="lolite()" onClick="logVariable('subcontexts')" href="../_variables/subcontexts.html">$subcontexts</a> = false, <a class="var it28813" onMouseOver="hilite(28813)" onMouseOut="lolite()" onClick="logVariable('includemanual')" href="../_variables/includemanual.html">$includemanual</a> = false) {
<a name="l1815"><span class="linenum">1815</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1816"><span class="linenum">1816</span></a>  
<a name="l1817"><span class="linenum">1817</span></a>      if (!<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) {
<a name="l1818"><span class="linenum">1818</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Missing parameters in role_unsassign_all() call');
<a name="l1819"><span class="linenum">1819</span></a>      }
<a name="l1820"><span class="linenum">1820</span></a>  
<a name="l1821"><span class="linenum">1821</span></a>      <a class="var it2730" onMouseOver="hilite(2730)" onMouseOut="lolite()" onClick="logVariable('allowed')" href="../_variables/allowed.html">$allowed</a> = array('roleid', 'userid', 'contextid', 'component', 'itemid');
<a name="l1822"><span class="linenum">1822</span></a>      foreach (<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> as <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>=&gt;<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../_variables/value.html">$value</a>) {
<a name="l1823"><span class="linenum">1823</span></a>          if (!<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>, <a class="var it2730" onMouseOver="hilite(2730)" onMouseOut="lolite()" onClick="logVariable('allowed')" href="../_variables/allowed.html">$allowed</a>)) {
<a name="l1824"><span class="linenum">1824</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Unknown role_unsassign_all() parameter key', 'key:'.<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>);
<a name="l1825"><span class="linenum">1825</span></a>          }
<a name="l1826"><span class="linenum">1826</span></a>      }
<a name="l1827"><span class="linenum">1827</span></a>  
<a name="l1828"><span class="linenum">1828</span></a>      if (isset(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['component']) and <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['component'] !== '' and <a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['component'], '_') === false) {
<a name="l1829"><span class="linenum">1829</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid component paramter in role_unsassign_all() call', 'component:'.<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['component']);
<a name="l1830"><span class="linenum">1830</span></a>      }
<a name="l1831"><span class="linenum">1831</span></a>  
<a name="l1832"><span class="linenum">1832</span></a>      if (<a class="var it28813" onMouseOver="hilite(28813)" onMouseOut="lolite()" onClick="logVariable('includemanual')" href="../_variables/includemanual.html">$includemanual</a>) {
<a name="l1833"><span class="linenum">1833</span></a>          if (!isset(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['component']) or <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['component'] === '') {
<a name="l1834"><span class="linenum">1834</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('include manual parameter requires component parameter in role_unsassign_all() call');
<a name="l1835"><span class="linenum">1835</span></a>          }
<a name="l1836"><span class="linenum">1836</span></a>      }
<a name="l1837"><span class="linenum">1837</span></a>  
<a name="l1838"><span class="linenum">1838</span></a>      if (<a class="var it28812" onMouseOver="hilite(28812)" onMouseOut="lolite()" onClick="logVariable('subcontexts')" href="../_variables/subcontexts.html">$subcontexts</a>) {
<a name="l1839"><span class="linenum">1839</span></a>          if (empty(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['contextid'])) {
<a name="l1840"><span class="linenum">1840</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('subcontexts paramtere requires component parameter in role_unsassign_all() call');
<a name="l1841"><span class="linenum">1841</span></a>          }
<a name="l1842"><span class="linenum">1842</span></a>      }
<a name="l1843"><span class="linenum">1843</span></a>  
<a name="l1844"><span class="linenum">1844</span></a>      <a class="var it11181" onMouseOver="hilite(11181)" onMouseOut="lolite()" onClick="logVariable('ras')" href="../_variables/ras.html">$ras</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('role_assignments', <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l1845"><span class="linenum">1845</span></a>      foreach(<a class="var it11181" onMouseOver="hilite(11181)" onMouseOut="lolite()" onClick="logVariable('ras')" href="../_variables/ras.html">$ras</a> as <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>) {
<a name="l1846"><span class="linenum">1846</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('role_assignments', array('id'=&gt;<a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('id')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l1847"><span class="linenum">1847</span></a>          if (<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = context::<a class="function" onClick="logFunction('instance_by_id')" href="../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>(<a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('contextid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/contextid.html">contextid</a>, <a class="constant" onClick="logConstant('IGNORE_MISSING')" href="../_constants/IGNORE_MISSING.html" onMouseOver="constPopup(event,'IGNORE_MISSING')">IGNORE_MISSING</a>)) {
<a name="l1848"><span class="linenum">1848</span></a>  <span class="comment">            // this is a bit expensive but necessary</span>
<a name="l1849"><span class="linenum">1849</span></a>              <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('mark_dirty')" href="../_functions/mark_dirty.html" onMouseOver="funcPopup(event,'mark_dirty')">mark_dirty</a>();
<a name="l1850"><span class="linenum">1850</span></a>  <span class="comment">            // If the user is the current user, then do full reload of capabilities too.</span>
<a name="l1851"><span class="linenum">1851</span></a>              if (!empty(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) &amp;&amp; <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a> == <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('userid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>) {
<a name="l1852"><span class="linenum">1852</span></a>                  <a class="function" onClick="logFunction('reload_all_capabilities')" href="../_functions/reload_all_capabilities.html" onMouseOver="funcPopup(event,'reload_all_capabilities')">reload_all_capabilities</a>();
<a name="l1853"><span class="linenum">1853</span></a>              }
<a name="l1854"><span class="linenum">1854</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('role_unassigned')" href="../_classes/role_unassigned.html" onMouseOver="classPopup(event,'role_unassigned')">role_unassigned</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(array(
<a name="l1855"><span class="linenum">1855</span></a>                  'context' =&gt; <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>,
<a name="l1856"><span class="linenum">1856</span></a>                  'objectid' =&gt; <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('roleid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>,
<a name="l1857"><span class="linenum">1857</span></a>                  'relateduserid' =&gt; <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('userid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>,
<a name="l1858"><span class="linenum">1858</span></a>                  'other' =&gt; array(
<a name="l1859"><span class="linenum">1859</span></a>                      'id' =&gt; <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('id')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l1860"><span class="linenum">1860</span></a>                      'component' =&gt; <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('component')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/component.html">component</a>,
<a name="l1861"><span class="linenum">1861</span></a>                      'itemid' =&gt; <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;itemid
<a name="l1862"><span class="linenum">1862</span></a>                  )
<a name="l1863"><span class="linenum">1863</span></a>              ));
<a name="l1864"><span class="linenum">1864</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('role_assignments', <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>);
<a name="l1865"><span class="linenum">1865</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1866"><span class="linenum">1866</span></a>          }
<a name="l1867"><span class="linenum">1867</span></a>      }
<a name="l1868"><span class="linenum">1868</span></a>      unset(<a class="var it11181" onMouseOver="hilite(11181)" onMouseOut="lolite()" onClick="logVariable('ras')" href="../_variables/ras.html">$ras</a>);
<a name="l1869"><span class="linenum">1869</span></a>  
<a name="l1870"><span class="linenum">1870</span></a>  <span class="comment">    // process subcontexts</span>
<a name="l1871"><span class="linenum">1871</span></a>      if (<a class="var it28812" onMouseOver="hilite(28812)" onMouseOut="lolite()" onClick="logVariable('subcontexts')" href="../_variables/subcontexts.html">$subcontexts</a> and <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = context::<a class="function" onClick="logFunction('instance_by_id')" href="../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['contextid'], <a class="constant" onClick="logConstant('IGNORE_MISSING')" href="../_constants/IGNORE_MISSING.html" onMouseOver="constPopup(event,'IGNORE_MISSING')">IGNORE_MISSING</a>)) {
<a name="l1872"><span class="linenum">1872</span></a>          if (<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['contextid'] instanceof context) {
<a name="l1873"><span class="linenum">1873</span></a>              <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['contextid'];
<a name="l1874"><span class="linenum">1874</span></a>          } else {
<a name="l1875"><span class="linenum">1875</span></a>              <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = context::<a class="function" onClick="logFunction('instance_by_id')" href="../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['contextid'], <a class="constant" onClick="logConstant('IGNORE_MISSING')" href="../_constants/IGNORE_MISSING.html" onMouseOver="constPopup(event,'IGNORE_MISSING')">IGNORE_MISSING</a>);
<a name="l1876"><span class="linenum">1876</span></a>          }
<a name="l1877"><span class="linenum">1877</span></a>  
<a name="l1878"><span class="linenum">1878</span></a>          if (<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l1879"><span class="linenum">1879</span></a>              <a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../_variables/contexts.html">$contexts</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_child_contexts')" href="../_functions/get_child_contexts.html" onMouseOver="funcPopup(event,'get_child_contexts')">get_child_contexts</a>();
<a name="l1880"><span class="linenum">1880</span></a>              <a class="var it28814" onMouseOver="hilite(28814)" onMouseOut="lolite()" onClick="logVariable('mparams')" href="../_variables/mparams.html">$mparams</a> = <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>;
<a name="l1881"><span class="linenum">1881</span></a>              foreach(<a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../_variables/contexts.html">$contexts</a> as <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l1882"><span class="linenum">1882</span></a>                  <a class="var it28814" onMouseOver="hilite(28814)" onMouseOut="lolite()" onClick="logVariable('mparams')" href="../_variables/mparams.html">$mparams</a>['contextid'] = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l1883"><span class="linenum">1883</span></a>                  <a class="var it11181" onMouseOver="hilite(11181)" onMouseOut="lolite()" onClick="logVariable('ras')" href="../_variables/ras.html">$ras</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('role_assignments', <a class="var it28814" onMouseOver="hilite(28814)" onMouseOut="lolite()" onClick="logVariable('mparams')" href="../_variables/mparams.html">$mparams</a>);
<a name="l1884"><span class="linenum">1884</span></a>                  foreach(<a class="var it11181" onMouseOver="hilite(11181)" onMouseOut="lolite()" onClick="logVariable('ras')" href="../_variables/ras.html">$ras</a> as <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>) {
<a name="l1885"><span class="linenum">1885</span></a>                      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('role_assignments', array('id'=&gt;<a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('id')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l1886"><span class="linenum">1886</span></a>  <span class="comment">                    // this is a bit expensive but necessary</span>
<a name="l1887"><span class="linenum">1887</span></a>                      <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('mark_dirty')" href="../_functions/mark_dirty.html" onMouseOver="funcPopup(event,'mark_dirty')">mark_dirty</a>();
<a name="l1888"><span class="linenum">1888</span></a>  <span class="comment">                    // If the user is the current user, then do full reload of capabilities too.</span>
<a name="l1889"><span class="linenum">1889</span></a>                      if (!empty(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) &amp;&amp; <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a> == <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('userid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>) {
<a name="l1890"><span class="linenum">1890</span></a>                          <a class="function" onClick="logFunction('reload_all_capabilities')" href="../_functions/reload_all_capabilities.html" onMouseOver="funcPopup(event,'reload_all_capabilities')">reload_all_capabilities</a>();
<a name="l1891"><span class="linenum">1891</span></a>                      }
<a name="l1892"><span class="linenum">1892</span></a>                      <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('role_unassigned')" href="../_classes/role_unassigned.html" onMouseOver="classPopup(event,'role_unassigned')">role_unassigned</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(
<a name="l1893"><span class="linenum">1893</span></a>                          array('context'=&gt;<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, 'objectid'=&gt;<a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('roleid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>, 'relateduserid'=&gt;<a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('userid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>,
<a name="l1894"><span class="linenum">1894</span></a>                              'other'=&gt;array('id'=&gt;<a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('id')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'component'=&gt;<a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('component')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/component.html">component</a>, 'itemid'=&gt;<a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('itemid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/itemid.html">itemid</a>)));
<a name="l1895"><span class="linenum">1895</span></a>                      <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('role_assignments', <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>);
<a name="l1896"><span class="linenum">1896</span></a>                      <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1897"><span class="linenum">1897</span></a>                  }
<a name="l1898"><span class="linenum">1898</span></a>              }
<a name="l1899"><span class="linenum">1899</span></a>          }
<a name="l1900"><span class="linenum">1900</span></a>      }
<a name="l1901"><span class="linenum">1901</span></a>  
<a name="l1902"><span class="linenum">1902</span></a>  <span class="comment">    // do this once more for all manual role assignments</span>
<a name="l1903"><span class="linenum">1903</span></a>      if (<a class="var it28813" onMouseOver="hilite(28813)" onMouseOut="lolite()" onClick="logVariable('includemanual')" href="../_variables/includemanual.html">$includemanual</a>) {
<a name="l1904"><span class="linenum">1904</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['component'] = '';
<a name="l1905"><span class="linenum">1905</span></a>          <a class="function" onClick="logFunction('role_unassign_all')" href="../_functions/role_unassign_all.html" onMouseOver="funcPopup(event,'role_unassign_all')">role_unassign_all</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it28812" onMouseOver="hilite(28812)" onMouseOut="lolite()" onClick="logVariable('subcontexts')" href="../_variables/subcontexts.html">$subcontexts</a>, false);
<a name="l1906"><span class="linenum">1906</span></a>      }
<a name="l1907"><span class="linenum">1907</span></a>  }
<a name="l1908"><span class="linenum">1908</span></a>  
<a name="l1909"><span class="linenum">1909</span></a>  <span class="comment">/**</span>
<a name="l1910"><span class="linenum">1910</span></a>  <span class="comment"> * Determines if a user is currently logged in</span>
<a name="l1911"><span class="linenum">1911</span></a>  <span class="comment"> *</span>
<a name="l1912"><span class="linenum">1912</span></a>  <span class="comment"> * @category   access</span>
<a name="l1913"><span class="linenum">1913</span></a>  <span class="comment"> *</span>
<a name="l1914"><span class="linenum">1914</span></a>  <span class="comment"> * @return bool</span>
<a name="l1915"><span class="linenum">1915</span></a>  <span class="comment"> */</span>
<a name="l1916"><span class="linenum">1916</span></a>  function <a class="function" onClick="logFunction('isloggedin')" href="../_functions/isloggedin.html" onMouseOver="funcPopup(event,'isloggedin')">isloggedin</a>() {
<a name="l1917"><span class="linenum">1917</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l1918"><span class="linenum">1918</span></a>  
<a name="l1919"><span class="linenum">1919</span></a>      return (!empty(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l1920"><span class="linenum">1920</span></a>  }
<a name="l1921"><span class="linenum">1921</span></a>  
<a name="l1922"><span class="linenum">1922</span></a>  <span class="comment">/**</span>
<a name="l1923"><span class="linenum">1923</span></a>  <span class="comment"> * Determines if a user is logged in as real guest user with username 'guest'.</span>
<a name="l1924"><span class="linenum">1924</span></a>  <span class="comment"> *</span>
<a name="l1925"><span class="linenum">1925</span></a>  <span class="comment"> * @category   access</span>
<a name="l1926"><span class="linenum">1926</span></a>  <span class="comment"> *</span>
<a name="l1927"><span class="linenum">1927</span></a>  <span class="comment"> * @param int|object $user mixed user object or id, $USER if not specified</span>
<a name="l1928"><span class="linenum">1928</span></a>  <span class="comment"> * @return bool true if user is the real guest user, false if not logged in or other user</span>
<a name="l1929"><span class="linenum">1929</span></a>  <span class="comment"> */</span>
<a name="l1930"><span class="linenum">1930</span></a>  function <a class="function" onClick="logFunction('isguestuser')" href="../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = null) {
<a name="l1931"><span class="linenum">1931</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l1932"><span class="linenum">1932</span></a>  
<a name="l1933"><span class="linenum">1933</span></a>  <span class="comment">    // make sure we have the user id cached in config table, because we are going to use it a lot</span>
<a name="l1934"><span class="linenum">1934</span></a>      if (empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('siteguest')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/siteguest.html">siteguest</a>)) {
<a name="l1935"><span class="linenum">1935</span></a>          if (!<a class="var it3829" onMouseOver="hilite(3829)" onMouseOut="lolite()" onClick="logVariable('guestid')" href="../_variables/guestid.html">$guestid</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('user', 'id', array('username'=&gt;'guest', 'mnethostid'=&gt;<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('mnet_localhost_id')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/mnet_localhost_id.html">mnet_localhost_id</a>))) {
<a name="l1936"><span class="linenum">1936</span></a>  <span class="comment">            // guest does not exist yet, weird</span>
<a name="l1937"><span class="linenum">1937</span></a>              return false;
<a name="l1938"><span class="linenum">1938</span></a>          }
<a name="l1939"><span class="linenum">1939</span></a>          <a class="function" onClick="logFunction('set_config')" href="../_functions/set_config.html" onMouseOver="funcPopup(event,'set_config')">set_config</a>('siteguest', <a class="var it3829" onMouseOver="hilite(3829)" onMouseOut="lolite()" onClick="logVariable('guestid')" href="../_variables/guestid.html">$guestid</a>);
<a name="l1940"><span class="linenum">1940</span></a>      }
<a name="l1941"><span class="linenum">1941</span></a>      if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> === null) {
<a name="l1942"><span class="linenum">1942</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l1943"><span class="linenum">1943</span></a>      }
<a name="l1944"><span class="linenum">1944</span></a>  
<a name="l1945"><span class="linenum">1945</span></a>      if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> === null) {
<a name="l1946"><span class="linenum">1946</span></a>  <span class="comment">        // happens when setting the $USER</span>
<a name="l1947"><span class="linenum">1947</span></a>          return false;
<a name="l1948"><span class="linenum">1948</span></a>  
<a name="l1949"><span class="linenum">1949</span></a>      } else if (<a class="phpfunction" onClick="logFunction('is_numeric')" href="../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l1950"><span class="linenum">1950</span></a>          return (<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('siteguest')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/siteguest.html">siteguest</a> == <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l1951"><span class="linenum">1951</span></a>  
<a name="l1952"><span class="linenum">1952</span></a>      } else if (<a class="phpfunction" onClick="logFunction('is_object')" href="../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l1953"><span class="linenum">1953</span></a>          if (empty(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>)) {
<a name="l1954"><span class="linenum">1954</span></a>              return false; <span class="comment">// not logged in means is not be guest</span>
<a name="l1955"><span class="linenum">1955</span></a>          } else {
<a name="l1956"><span class="linenum">1956</span></a>              return (<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('siteguest')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/siteguest.html">siteguest</a> == <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l1957"><span class="linenum">1957</span></a>          }
<a name="l1958"><span class="linenum">1958</span></a>  
<a name="l1959"><span class="linenum">1959</span></a>      } else {
<a name="l1960"><span class="linenum">1960</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid user parameter supplied for <a class="function" onClick="logFunction('isguestuser')" href="../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>() function!');
<a name="l1961"><span class="linenum">1961</span></a>      }
<a name="l1962"><span class="linenum">1962</span></a>  }
<a name="l1963"><span class="linenum">1963</span></a>  
<a name="l1964"><span class="linenum">1964</span></a>  <span class="comment">/**</span>
<a name="l1965"><span class="linenum">1965</span></a>  <span class="comment"> * Does user have a (temporary or real) guest access to course?</span>
<a name="l1966"><span class="linenum">1966</span></a>  <span class="comment"> *</span>
<a name="l1967"><span class="linenum">1967</span></a>  <span class="comment"> * @category   access</span>
<a name="l1968"><span class="linenum">1968</span></a>  <span class="comment"> *</span>
<a name="l1969"><span class="linenum">1969</span></a>  <span class="comment"> * @param context $context</span>
<a name="l1970"><span class="linenum">1970</span></a>  <span class="comment"> * @param stdClass|int $user</span>
<a name="l1971"><span class="linenum">1971</span></a>  <span class="comment"> * @return bool</span>
<a name="l1972"><span class="linenum">1972</span></a>  <span class="comment"> */</span>
<a name="l1973"><span class="linenum">1973</span></a>  function <a class="function" onClick="logFunction('is_guest')" href="../_functions/is_guest.html" onMouseOver="funcPopup(event,'is_guest')">is_guest</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = null) {
<a name="l1974"><span class="linenum">1974</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l1975"><span class="linenum">1975</span></a>  
<a name="l1976"><span class="linenum">1976</span></a>  <span class="comment">    // first find the course context</span>
<a name="l1977"><span class="linenum">1977</span></a>      <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_course_context')" href="../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>();
<a name="l1978"><span class="linenum">1978</span></a>  
<a name="l1979"><span class="linenum">1979</span></a>  <span class="comment">    // make sure there is a real user specified</span>
<a name="l1980"><span class="linenum">1980</span></a>      if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> === null) {
<a name="l1981"><span class="linenum">1981</span></a>          <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> = isset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) ? <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a> : 0;
<a name="l1982"><span class="linenum">1982</span></a>      } else {
<a name="l1983"><span class="linenum">1983</span></a>          <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> = <a class="phpfunction" onClick="logFunction('is_object')" href="../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) ? <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a> : <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>;
<a name="l1984"><span class="linenum">1984</span></a>      }
<a name="l1985"><span class="linenum">1985</span></a>  
<a name="l1986"><span class="linenum">1986</span></a>      if (<a class="function" onClick="logFunction('isguestuser')" href="../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>)) {
<a name="l1987"><span class="linenum">1987</span></a>  <span class="comment">        // can not inspect or be enrolled</span>
<a name="l1988"><span class="linenum">1988</span></a>          return true;
<a name="l1989"><span class="linenum">1989</span></a>      }
<a name="l1990"><span class="linenum">1990</span></a>  
<a name="l1991"><span class="linenum">1991</span></a>      if (<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:view', <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l1992"><span class="linenum">1992</span></a>  <span class="comment">        // viewing users appear out of nowhere, they are neither guests nor participants</span>
<a name="l1993"><span class="linenum">1993</span></a>          return false;
<a name="l1994"><span class="linenum">1994</span></a>      }
<a name="l1995"><span class="linenum">1995</span></a>  
<a name="l1996"><span class="linenum">1996</span></a>  <span class="comment">    // consider only real active enrolments here</span>
<a name="l1997"><span class="linenum">1997</span></a>      if (<a class="function" onClick="logFunction('is_enrolled')" href="../_functions/is_enrolled.html" onMouseOver="funcPopup(event,'is_enrolled')">is_enrolled</a>(<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, '', true)) {
<a name="l1998"><span class="linenum">1998</span></a>          return false;
<a name="l1999"><span class="linenum">1999</span></a>      }
<a name="l2000"><span class="linenum">2000</span></a>  
<a name="l2001"><span class="linenum">2001</span></a>      return true;
<a name="l2002"><span class="linenum">2002</span></a>  }
<a name="l2003"><span class="linenum">2003</span></a>  
<a name="l2004"><span class="linenum">2004</span></a>  <span class="comment">/**</span>
<a name="l2005"><span class="linenum">2005</span></a>  <span class="comment"> * Returns true if the user has moodle/course:view capability in the course,</span>
<a name="l2006"><span class="linenum">2006</span></a>  <span class="comment"> * this is intended for admins, managers (aka small admins), inspectors, etc.</span>
<a name="l2007"><span class="linenum">2007</span></a>  <span class="comment"> *</span>
<a name="l2008"><span class="linenum">2008</span></a>  <span class="comment"> * @category   access</span>
<a name="l2009"><span class="linenum">2009</span></a>  <span class="comment"> *</span>
<a name="l2010"><span class="linenum">2010</span></a>  <span class="comment"> * @param context $context</span>
<a name="l2011"><span class="linenum">2011</span></a>  <span class="comment"> * @param int|stdClass $user if null $USER is used</span>
<a name="l2012"><span class="linenum">2012</span></a>  <span class="comment"> * @param string $withcapability extra capability name</span>
<a name="l2013"><span class="linenum">2013</span></a>  <span class="comment"> * @return bool</span>
<a name="l2014"><span class="linenum">2014</span></a>  <span class="comment"> */</span>
<a name="l2015"><span class="linenum">2015</span></a>  function <a class="function" onClick="logFunction('is_viewing')" href="../_functions/is_viewing.html" onMouseOver="funcPopup(event,'is_viewing')">is_viewing</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = null, <a class="var it28815" onMouseOver="hilite(28815)" onMouseOut="lolite()" onClick="logVariable('withcapability')" href="../_variables/withcapability.html">$withcapability</a> = '') {
<a name="l2016"><span class="linenum">2016</span></a>  <span class="comment">    // first find the course context</span>
<a name="l2017"><span class="linenum">2017</span></a>      <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_course_context')" href="../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>();
<a name="l2018"><span class="linenum">2018</span></a>  
<a name="l2019"><span class="linenum">2019</span></a>      if (<a class="function" onClick="logFunction('isguestuser')" href="../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l2020"><span class="linenum">2020</span></a>  <span class="comment">        // can not inspect</span>
<a name="l2021"><span class="linenum">2021</span></a>          return false;
<a name="l2022"><span class="linenum">2022</span></a>      }
<a name="l2023"><span class="linenum">2023</span></a>  
<a name="l2024"><span class="linenum">2024</span></a>      if (!<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:view', <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l2025"><span class="linenum">2025</span></a>  <span class="comment">        // admins are allowed to inspect courses</span>
<a name="l2026"><span class="linenum">2026</span></a>          return false;
<a name="l2027"><span class="linenum">2027</span></a>      }
<a name="l2028"><span class="linenum">2028</span></a>  
<a name="l2029"><span class="linenum">2029</span></a>      if (<a class="var it28815" onMouseOver="hilite(28815)" onMouseOut="lolite()" onClick="logVariable('withcapability')" href="../_variables/withcapability.html">$withcapability</a> and !<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(<a class="var it28815" onMouseOver="hilite(28815)" onMouseOut="lolite()" onClick="logVariable('withcapability')" href="../_variables/withcapability.html">$withcapability</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l2030"><span class="linenum">2030</span></a>  <span class="comment">        // site admins always have the capability, but the enrolment above blocks</span>
<a name="l2031"><span class="linenum">2031</span></a>          return false;
<a name="l2032"><span class="linenum">2032</span></a>      }
<a name="l2033"><span class="linenum">2033</span></a>  
<a name="l2034"><span class="linenum">2034</span></a>      return true;
<a name="l2035"><span class="linenum">2035</span></a>  }
<a name="l2036"><span class="linenum">2036</span></a>  
<a name="l2037"><span class="linenum">2037</span></a>  <span class="comment">/**</span>
<a name="l2038"><span class="linenum">2038</span></a>  <span class="comment"> * Returns true if user is enrolled (is participating) in course</span>
<a name="l2039"><span class="linenum">2039</span></a>  <span class="comment"> * this is intended for students and teachers.</span>
<a name="l2040"><span class="linenum">2040</span></a>  <span class="comment"> *</span>
<a name="l2041"><span class="linenum">2041</span></a>  <span class="comment"> * Since 2.2 the result for active enrolments and current user are cached.</span>
<a name="l2042"><span class="linenum">2042</span></a>  <span class="comment"> *</span>
<a name="l2043"><span class="linenum">2043</span></a>  <span class="comment"> * @package   core_enrol</span>
<a name="l2044"><span class="linenum">2044</span></a>  <span class="comment"> * @category  access</span>
<a name="l2045"><span class="linenum">2045</span></a>  <span class="comment"> *</span>
<a name="l2046"><span class="linenum">2046</span></a>  <span class="comment"> * @param context $context</span>
<a name="l2047"><span class="linenum">2047</span></a>  <span class="comment"> * @param int|stdClass $user if null $USER is used, otherwise user object or id expected</span>
<a name="l2048"><span class="linenum">2048</span></a>  <span class="comment"> * @param string $withcapability extra capability name</span>
<a name="l2049"><span class="linenum">2049</span></a>  <span class="comment"> * @param bool $onlyactive consider only active enrolments in enabled plugins and time restrictions</span>
<a name="l2050"><span class="linenum">2050</span></a>  <span class="comment"> * @return bool</span>
<a name="l2051"><span class="linenum">2051</span></a>  <span class="comment"> */</span>
<a name="l2052"><span class="linenum">2052</span></a>  function <a class="function" onClick="logFunction('is_enrolled')" href="../_functions/is_enrolled.html" onMouseOver="funcPopup(event,'is_enrolled')">is_enrolled</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = null, <a class="var it28815" onMouseOver="hilite(28815)" onMouseOut="lolite()" onClick="logVariable('withcapability')" href="../_variables/withcapability.html">$withcapability</a> = '', <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('onlyactive')" href="../_variables/onlyactive.html">$onlyactive</a> = false) {
<a name="l2053"><span class="linenum">2053</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l2054"><span class="linenum">2054</span></a>  
<a name="l2055"><span class="linenum">2055</span></a>  <span class="comment">    // first find the course context</span>
<a name="l2056"><span class="linenum">2056</span></a>      <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_course_context')" href="../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>();
<a name="l2057"><span class="linenum">2057</span></a>  
<a name="l2058"><span class="linenum">2058</span></a>  <span class="comment">    // make sure there is a real user specified</span>
<a name="l2059"><span class="linenum">2059</span></a>      if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> === null) {
<a name="l2060"><span class="linenum">2060</span></a>          <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> = isset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) ? <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a> : 0;
<a name="l2061"><span class="linenum">2061</span></a>      } else {
<a name="l2062"><span class="linenum">2062</span></a>          <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> = <a class="phpfunction" onClick="logFunction('is_object')" href="../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) ? <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a> : <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>;
<a name="l2063"><span class="linenum">2063</span></a>      }
<a name="l2064"><span class="linenum">2064</span></a>  
<a name="l2065"><span class="linenum">2065</span></a>      if (empty(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>)) {
<a name="l2066"><span class="linenum">2066</span></a>  <span class="comment">        // not-logged-in!</span>
<a name="l2067"><span class="linenum">2067</span></a>          return false;
<a name="l2068"><span class="linenum">2068</span></a>      } else if (<a class="function" onClick="logFunction('isguestuser')" href="../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>)) {
<a name="l2069"><span class="linenum">2069</span></a>  <span class="comment">        // guest account can not be enrolled anywhere</span>
<a name="l2070"><span class="linenum">2070</span></a>          return false;
<a name="l2071"><span class="linenum">2071</span></a>      }
<a name="l2072"><span class="linenum">2072</span></a>  
<a name="l2073"><span class="linenum">2073</span></a>      if (<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a> == <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>) {
<a name="l2074"><span class="linenum">2074</span></a>  <span class="comment">        // everybody participates on frontpage</span>
<a name="l2075"><span class="linenum">2075</span></a>      } else {
<a name="l2076"><span class="linenum">2076</span></a>  <span class="comment">        // try cached info first - the enrolled flag is set only when active enrolment present</span>
<a name="l2077"><span class="linenum">2077</span></a>          if (<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a> == <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) {
<a name="l2078"><span class="linenum">2078</span></a>              <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a class="function" onClick="logFunction('reload_if_dirty')" href="../_functions/reload_if_dirty.html" onMouseOver="funcPopup(event,'reload_if_dirty')">reload_if_dirty</a>();
<a name="l2079"><span class="linenum">2079</span></a>              if (isset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('enrol')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>['enrolled'][<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>])) {
<a name="l2080"><span class="linenum">2080</span></a>                  if (<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('enrol')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>['enrolled'][<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>] &gt; <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()) {
<a name="l2081"><span class="linenum">2081</span></a>                      if (<a class="var it28815" onMouseOver="hilite(28815)" onMouseOut="lolite()" onClick="logVariable('withcapability')" href="../_variables/withcapability.html">$withcapability</a> and !<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(<a class="var it28815" onMouseOver="hilite(28815)" onMouseOut="lolite()" onClick="logVariable('withcapability')" href="../_variables/withcapability.html">$withcapability</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>)) {
<a name="l2082"><span class="linenum">2082</span></a>                          return false;
<a name="l2083"><span class="linenum">2083</span></a>                      }
<a name="l2084"><span class="linenum">2084</span></a>                      return true;
<a name="l2085"><span class="linenum">2085</span></a>                  }
<a name="l2086"><span class="linenum">2086</span></a>              }
<a name="l2087"><span class="linenum">2087</span></a>          }
<a name="l2088"><span class="linenum">2088</span></a>  
<a name="l2089"><span class="linenum">2089</span></a>          if (<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('onlyactive')" href="../_variables/onlyactive.html">$onlyactive</a>) {
<a name="l2090"><span class="linenum">2090</span></a>  <span class="comment">            // look for active enrolments only</span>
<a name="l2091"><span class="linenum">2091</span></a>              <a class="var it12947" onMouseOver="hilite(12947)" onMouseOut="lolite()" onClick="logVariable('until')" href="../_variables/until.html">$until</a> = <a class="function" onClick="logFunction('enrol_get_enrolment_end')" href="../_functions/enrol_get_enrolment_end.html" onMouseOver="funcPopup(event,'enrol_get_enrolment_end')">enrol_get_enrolment_end</a>(<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>);
<a name="l2092"><span class="linenum">2092</span></a>  
<a name="l2093"><span class="linenum">2093</span></a>              if (<a class="var it12947" onMouseOver="hilite(12947)" onMouseOut="lolite()" onClick="logVariable('until')" href="../_variables/until.html">$until</a> === false) {
<a name="l2094"><span class="linenum">2094</span></a>                  return false;
<a name="l2095"><span class="linenum">2095</span></a>              }
<a name="l2096"><span class="linenum">2096</span></a>  
<a name="l2097"><span class="linenum">2097</span></a>              if (<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a> == <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) {
<a name="l2098"><span class="linenum">2098</span></a>                  if (<a class="var it12947" onMouseOver="hilite(12947)" onMouseOut="lolite()" onClick="logVariable('until')" href="../_variables/until.html">$until</a> == 0) {
<a name="l2099"><span class="linenum">2099</span></a>                      <a class="var it12947" onMouseOver="hilite(12947)" onMouseOut="lolite()" onClick="logVariable('until')" href="../_variables/until.html">$until</a> = <a class="constant" onClick="logConstant('ENROL_MAX_TIMESTAMP')" href="../_constants/ENROL_MAX_TIMESTAMP.html" onMouseOver="constPopup(event,'ENROL_MAX_TIMESTAMP')">ENROL_MAX_TIMESTAMP</a>;
<a name="l2100"><span class="linenum">2100</span></a>                  }
<a name="l2101"><span class="linenum">2101</span></a>                  <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('enrol')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>['enrolled'][<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>] = <a class="var it12947" onMouseOver="hilite(12947)" onMouseOut="lolite()" onClick="logVariable('until')" href="../_variables/until.html">$until</a>;
<a name="l2102"><span class="linenum">2102</span></a>                  if (isset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('enrol')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>['tempguest'][<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>])) {
<a name="l2103"><span class="linenum">2103</span></a>                      unset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('enrol')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>['tempguest'][<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>]);
<a name="l2104"><span class="linenum">2104</span></a>                      <a class="function" onClick="logFunction('remove_temp_course_roles')" href="../_functions/remove_temp_course_roles.html" onMouseOver="funcPopup(event,'remove_temp_course_roles')">remove_temp_course_roles</a>(<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>);
<a name="l2105"><span class="linenum">2105</span></a>                  }
<a name="l2106"><span class="linenum">2106</span></a>              }
<a name="l2107"><span class="linenum">2107</span></a>  
<a name="l2108"><span class="linenum">2108</span></a>          } else {
<a name="l2109"><span class="linenum">2109</span></a>  <span class="comment">            // any enrolment is good for us here, even outdated, disabled or inactive</span>
<a name="l2110"><span class="linenum">2110</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT 'x'
<a name="l2111"><span class="linenum">2111</span></a>                        FROM {user_enrolments} ue
<a name="l2112"><span class="linenum">2112</span></a>                        JOIN {enrol} e <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (e.id = ue.enrolid AND e.courseid = :courseid)
<a name="l2113"><span class="linenum">2113</span></a>                        JOIN {user} u ON u.id = ue.userid
<a name="l2114"><span class="linenum">2114</span></a>                       WHERE ue.userid = :userid AND u.deleted = 0&quot;;
<a name="l2115"><span class="linenum">2115</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array('userid'=&gt;<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, 'courseid'=&gt;<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>);
<a name="l2116"><span class="linenum">2116</span></a>              if (!<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists_sql')" href="../_functions/record_exists_sql.html" onMouseOver="funcPopup(event,'record_exists_sql')">record_exists_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>)) {
<a name="l2117"><span class="linenum">2117</span></a>                  return false;
<a name="l2118"><span class="linenum">2118</span></a>              }
<a name="l2119"><span class="linenum">2119</span></a>          }
<a name="l2120"><span class="linenum">2120</span></a>      }
<a name="l2121"><span class="linenum">2121</span></a>  
<a name="l2122"><span class="linenum">2122</span></a>      if (<a class="var it28815" onMouseOver="hilite(28815)" onMouseOut="lolite()" onClick="logVariable('withcapability')" href="../_variables/withcapability.html">$withcapability</a> and !<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(<a class="var it28815" onMouseOver="hilite(28815)" onMouseOut="lolite()" onClick="logVariable('withcapability')" href="../_variables/withcapability.html">$withcapability</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>)) {
<a name="l2123"><span class="linenum">2123</span></a>          return false;
<a name="l2124"><span class="linenum">2124</span></a>      }
<a name="l2125"><span class="linenum">2125</span></a>  
<a name="l2126"><span class="linenum">2126</span></a>      return true;
<a name="l2127"><span class="linenum">2127</span></a>  }
<a name="l2128"><span class="linenum">2128</span></a>  
<a name="l2129"><span class="linenum">2129</span></a>  <span class="comment">/**</span>
<a name="l2130"><span class="linenum">2130</span></a>  <span class="comment"> * Returns true if the user is able to access the course.</span>
<a name="l2131"><span class="linenum">2131</span></a>  <span class="comment"> *</span>
<a name="l2132"><span class="linenum">2132</span></a>  <span class="comment"> * This function is in no way, shape, or form a substitute for require_login.</span>
<a name="l2133"><span class="linenum">2133</span></a>  <span class="comment"> * It should only be used in circumstances where it is not possible to call require_login</span>
<a name="l2134"><span class="linenum">2134</span></a>  <span class="comment"> * such as the navigation.</span>
<a name="l2135"><span class="linenum">2135</span></a>  <span class="comment"> *</span>
<a name="l2136"><span class="linenum">2136</span></a>  <span class="comment"> * This function checks many of the methods of access to a course such as the view</span>
<a name="l2137"><span class="linenum">2137</span></a>  <span class="comment"> * capability, enrollments, and guest access. It also makes use of the cache</span>
<a name="l2138"><span class="linenum">2138</span></a>  <span class="comment"> * generated by require_login for guest access.</span>
<a name="l2139"><span class="linenum">2139</span></a>  <span class="comment"> *</span>
<a name="l2140"><span class="linenum">2140</span></a>  <span class="comment"> * The flags within the $USER object that are used here should NEVER be used outside</span>
<a name="l2141"><span class="linenum">2141</span></a>  <span class="comment"> * of this function can_access_course and require_login. Doing so WILL break future</span>
<a name="l2142"><span class="linenum">2142</span></a>  <span class="comment"> * versions.</span>
<a name="l2143"><span class="linenum">2143</span></a>  <span class="comment"> *</span>
<a name="l2144"><span class="linenum">2144</span></a>  <span class="comment"> * @param stdClass $course record</span>
<a name="l2145"><span class="linenum">2145</span></a>  <span class="comment"> * @param stdClass|int|null $user user record or id, current user if null</span>
<a name="l2146"><span class="linenum">2146</span></a>  <span class="comment"> * @param string $withcapability Check for this capability as well.</span>
<a name="l2147"><span class="linenum">2147</span></a>  <span class="comment"> * @param bool $onlyactive consider only active enrolments in enabled plugins and time restrictions</span>
<a name="l2148"><span class="linenum">2148</span></a>  <span class="comment"> * @return boolean Returns true if the user is able to access the course</span>
<a name="l2149"><span class="linenum">2149</span></a>  <span class="comment"> */</span>
<a name="l2150"><span class="linenum">2150</span></a>  function <a class="function" onClick="logFunction('can_access_course')" href="../_functions/can_access_course.html" onMouseOver="funcPopup(event,'can_access_course')">can_access_course</a>(stdClass <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = null, <a class="var it28815" onMouseOver="hilite(28815)" onMouseOut="lolite()" onClick="logVariable('withcapability')" href="../_variables/withcapability.html">$withcapability</a> = '', <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('onlyactive')" href="../_variables/onlyactive.html">$onlyactive</a> = false) {
<a name="l2151"><span class="linenum">2151</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l2152"><span class="linenum">2152</span></a>  
<a name="l2153"><span class="linenum">2153</span></a>  <span class="comment">    // this function originally accepted $coursecontext parameter</span>
<a name="l2154"><span class="linenum">2154</span></a>      if (<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a> instanceof context) {
<a name="l2155"><span class="linenum">2155</span></a>          if (<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a> instanceof context_course) {
<a name="l2156"><span class="linenum">2156</span></a>              <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('deprecated context parameter, please use <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a> record');
<a name="l2157"><span class="linenum">2157</span></a>              <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>;
<a name="l2158"><span class="linenum">2158</span></a>              <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id'=&gt;<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>));
<a name="l2159"><span class="linenum">2159</span></a>          } else {
<a name="l2160"><span class="linenum">2160</span></a>              <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Invalid context parameter, please use <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a> record');
<a name="l2161"><span class="linenum">2161</span></a>              return false;
<a name="l2162"><span class="linenum">2162</span></a>          }
<a name="l2163"><span class="linenum">2163</span></a>      } else {
<a name="l2164"><span class="linenum">2164</span></a>          <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l2165"><span class="linenum">2165</span></a>      }
<a name="l2166"><span class="linenum">2166</span></a>  
<a name="l2167"><span class="linenum">2167</span></a>      if (!isset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>)) {
<a name="l2168"><span class="linenum">2168</span></a>  <span class="comment">        // should never happen</span>
<a name="l2169"><span class="linenum">2169</span></a>          <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a> = 0;
<a name="l2170"><span class="linenum">2170</span></a>          <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Course access check being performed on a user with no ID.', <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l2171"><span class="linenum">2171</span></a>      }
<a name="l2172"><span class="linenum">2172</span></a>  
<a name="l2173"><span class="linenum">2173</span></a>  <span class="comment">    // make sure there is a user specified</span>
<a name="l2174"><span class="linenum">2174</span></a>      if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> === null) {
<a name="l2175"><span class="linenum">2175</span></a>          <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l2176"><span class="linenum">2176</span></a>      } else {
<a name="l2177"><span class="linenum">2177</span></a>          <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> = <a class="phpfunction" onClick="logFunction('is_object')" href="../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) ? <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a> : <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>;
<a name="l2178"><span class="linenum">2178</span></a>      }
<a name="l2179"><span class="linenum">2179</span></a>      unset(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l2180"><span class="linenum">2180</span></a>  
<a name="l2181"><span class="linenum">2181</span></a>      if (<a class="var it28815" onMouseOver="hilite(28815)" onMouseOut="lolite()" onClick="logVariable('withcapability')" href="../_variables/withcapability.html">$withcapability</a> and !<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(<a class="var it28815" onMouseOver="hilite(28815)" onMouseOut="lolite()" onClick="logVariable('withcapability')" href="../_variables/withcapability.html">$withcapability</a>, <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>)) {
<a name="l2182"><span class="linenum">2182</span></a>          return false;
<a name="l2183"><span class="linenum">2183</span></a>      }
<a name="l2184"><span class="linenum">2184</span></a>  
<a name="l2185"><span class="linenum">2185</span></a>      if (<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> == <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) {
<a name="l2186"><span class="linenum">2186</span></a>          if (!empty(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['rsw'][<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('path')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/path.html">path</a>])) {
<a name="l2187"><span class="linenum">2187</span></a>  <span class="comment">            // the fact that somebody switched role means they can access the course no matter to what role they switched</span>
<a name="l2188"><span class="linenum">2188</span></a>              return true;
<a name="l2189"><span class="linenum">2189</span></a>          }
<a name="l2190"><span class="linenum">2190</span></a>      }
<a name="l2191"><span class="linenum">2191</span></a>  
<a name="l2192"><span class="linenum">2192</span></a>      if (!<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('visible')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/visible.html">visible</a> and !<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:viewhiddencourses', <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>)) {
<a name="l2193"><span class="linenum">2193</span></a>          return false;
<a name="l2194"><span class="linenum">2194</span></a>      }
<a name="l2195"><span class="linenum">2195</span></a>  
<a name="l2196"><span class="linenum">2196</span></a>      if (<a class="function" onClick="logFunction('is_viewing')" href="../_functions/is_viewing.html" onMouseOver="funcPopup(event,'is_viewing')">is_viewing</a>(<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>)) {
<a name="l2197"><span class="linenum">2197</span></a>          return true;
<a name="l2198"><span class="linenum">2198</span></a>      }
<a name="l2199"><span class="linenum">2199</span></a>  
<a name="l2200"><span class="linenum">2200</span></a>      if (<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> != <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) {
<a name="l2201"><span class="linenum">2201</span></a>  <span class="comment">        // for performance reasons we do not verify temporary guest access for other users, sorry...</span>
<a name="l2202"><span class="linenum">2202</span></a>          return <a class="function" onClick="logFunction('is_enrolled')" href="../_functions/is_enrolled.html" onMouseOver="funcPopup(event,'is_enrolled')">is_enrolled</a>(<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, '', <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('onlyactive')" href="../_variables/onlyactive.html">$onlyactive</a>);
<a name="l2203"><span class="linenum">2203</span></a>      }
<a name="l2204"><span class="linenum">2204</span></a>  
<a name="l2205"><span class="linenum">2205</span></a>  <span class="comment">    // === from here we deal only with $USER ===</span>
<a name="l2206"><span class="linenum">2206</span></a>  
<a name="l2207"><span class="linenum">2207</span></a>      <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a class="function" onClick="logFunction('reload_if_dirty')" href="../_functions/reload_if_dirty.html" onMouseOver="funcPopup(event,'reload_if_dirty')">reload_if_dirty</a>();
<a name="l2208"><span class="linenum">2208</span></a>  
<a name="l2209"><span class="linenum">2209</span></a>      if (isset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('enrol')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>['enrolled'][<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>])) {
<a name="l2210"><span class="linenum">2210</span></a>          if (<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('enrol')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>['enrolled'][<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] &gt; <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()) {
<a name="l2211"><span class="linenum">2211</span></a>              return true;
<a name="l2212"><span class="linenum">2212</span></a>          }
<a name="l2213"><span class="linenum">2213</span></a>      }
<a name="l2214"><span class="linenum">2214</span></a>      if (isset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('enrol')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>['tempguest'][<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>])) {
<a name="l2215"><span class="linenum">2215</span></a>          if (<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('enrol')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>['tempguest'][<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] &gt; <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()) {
<a name="l2216"><span class="linenum">2216</span></a>              return true;
<a name="l2217"><span class="linenum">2217</span></a>          }
<a name="l2218"><span class="linenum">2218</span></a>      }
<a name="l2219"><span class="linenum">2219</span></a>  
<a name="l2220"><span class="linenum">2220</span></a>      if (<a class="function" onClick="logFunction('is_enrolled')" href="../_functions/is_enrolled.html" onMouseOver="funcPopup(event,'is_enrolled')">is_enrolled</a>(<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, '', <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('onlyactive')" href="../_variables/onlyactive.html">$onlyactive</a>)) {
<a name="l2221"><span class="linenum">2221</span></a>          return true;
<a name="l2222"><span class="linenum">2222</span></a>      }
<a name="l2223"><span class="linenum">2223</span></a>  
<a name="l2224"><span class="linenum">2224</span></a>  <span class="comment">    // if not enrolled try to gain temporary guest access</span>
<a name="l2225"><span class="linenum">2225</span></a>      <a class="var it1238" onMouseOver="hilite(1238)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('enrol', array('courseid'=&gt;<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'status'=&gt;<a class="constant" onClick="logConstant('ENROL_INSTANCE_ENABLED')" href="../_constants/ENROL_INSTANCE_ENABLED.html" onMouseOver="constPopup(event,'ENROL_INSTANCE_ENABLED')">ENROL_INSTANCE_ENABLED</a>), 'sortorder, id ASC');
<a name="l2226"><span class="linenum">2226</span></a>      <a class="var it3147" onMouseOver="hilite(3147)" onMouseOut="lolite()" onClick="logVariable('enrols')" href="../_variables/enrols.html">$enrols</a> = <a class="function" onClick="logFunction('enrol_get_plugins')" href="../_functions/enrol_get_plugins.html" onMouseOver="funcPopup(event,'enrol_get_plugins')">enrol_get_plugins</a>(true);
<a name="l2227"><span class="linenum">2227</span></a>      foreach(<a class="var it1238" onMouseOver="hilite(1238)" onMouseOut="lolite()" onClick="logVariable('instances')" href="../_variables/instances.html">$instances</a> as <a class="var it528" onMouseOver="hilite(528)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l2228"><span class="linenum">2228</span></a>          if (!isset(<a class="var it3147" onMouseOver="hilite(3147)" onMouseOut="lolite()" onClick="logVariable('enrols')" href="../_variables/enrols.html">$enrols</a>[<a class="var it528" onMouseOver="hilite(528)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it39530" onMouseOver="hilite(39530)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>])) {
<a name="l2229"><span class="linenum">2229</span></a>              continue;
<a name="l2230"><span class="linenum">2230</span></a>          }
<a name="l2231"><span class="linenum">2231</span></a>  <span class="comment">        // Get a duration for the guest access, a timestamp in the future, 0 (always) or false.</span>
<a name="l2232"><span class="linenum">2232</span></a>          <a class="var it12947" onMouseOver="hilite(12947)" onMouseOut="lolite()" onClick="logVariable('until')" href="../_variables/until.html">$until</a> = <a class="var it3147" onMouseOver="hilite(3147)" onMouseOut="lolite()" onClick="logVariable('enrols')" href="../_variables/enrols.html">$enrols</a>[<a class="var it528" onMouseOver="hilite(528)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>-&gt;<a onClick="logVariable('enrol')" class="var it39530" onMouseOver="hilite(39530)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>]-&gt;<a class="function" onClick="logFunction('try_guestaccess')" href="../_functions/try_guestaccess.html" onMouseOver="funcPopup(event,'try_guestaccess')">try_guestaccess</a>(<a class="var it528" onMouseOver="hilite(528)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>);
<a name="l2233"><span class="linenum">2233</span></a>          if (<a class="var it12947" onMouseOver="hilite(12947)" onMouseOut="lolite()" onClick="logVariable('until')" href="../_variables/until.html">$until</a> !== false and <a class="var it12947" onMouseOver="hilite(12947)" onMouseOut="lolite()" onClick="logVariable('until')" href="../_variables/until.html">$until</a> &gt; <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()) {
<a name="l2234"><span class="linenum">2234</span></a>              <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('enrol')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>['tempguest'][<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="var it12947" onMouseOver="hilite(12947)" onMouseOut="lolite()" onClick="logVariable('until')" href="../_variables/until.html">$until</a>;
<a name="l2235"><span class="linenum">2235</span></a>              return true;
<a name="l2236"><span class="linenum">2236</span></a>          }
<a name="l2237"><span class="linenum">2237</span></a>      }
<a name="l2238"><span class="linenum">2238</span></a>      if (isset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('enrol')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>['tempguest'][<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>])) {
<a name="l2239"><span class="linenum">2239</span></a>          unset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('enrol')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/enrol.html">enrol</a>['tempguest'][<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>]);
<a name="l2240"><span class="linenum">2240</span></a>          <a class="function" onClick="logFunction('remove_temp_course_roles')" href="../_functions/remove_temp_course_roles.html" onMouseOver="funcPopup(event,'remove_temp_course_roles')">remove_temp_course_roles</a>(<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>);
<a name="l2241"><span class="linenum">2241</span></a>      }
<a name="l2242"><span class="linenum">2242</span></a>  
<a name="l2243"><span class="linenum">2243</span></a>      return false;
<a name="l2244"><span class="linenum">2244</span></a>  }
<a name="l2245"><span class="linenum">2245</span></a>  
<a name="l2246"><span class="linenum">2246</span></a>  <span class="comment">/**</span>
<a name="l2247"><span class="linenum">2247</span></a>  <span class="comment"> * Returns array with sql code and parameters returning all ids</span>
<a name="l2248"><span class="linenum">2248</span></a>  <span class="comment"> * of users enrolled into course.</span>
<a name="l2249"><span class="linenum">2249</span></a>  <span class="comment"> *</span>
<a name="l2250"><span class="linenum">2250</span></a>  <span class="comment"> * This function is using 'eu[0-9]+_' prefix for table names and parameters.</span>
<a name="l2251"><span class="linenum">2251</span></a>  <span class="comment"> *</span>
<a name="l2252"><span class="linenum">2252</span></a>  <span class="comment"> * @package   core_enrol</span>
<a name="l2253"><span class="linenum">2253</span></a>  <span class="comment"> * @category  access</span>
<a name="l2254"><span class="linenum">2254</span></a>  <span class="comment"> *</span>
<a name="l2255"><span class="linenum">2255</span></a>  <span class="comment"> * @param context $context</span>
<a name="l2256"><span class="linenum">2256</span></a>  <span class="comment"> * @param string $withcapability</span>
<a name="l2257"><span class="linenum">2257</span></a>  <span class="comment"> * @param int $groupid 0 means ignore groups, any other value limits the result by group id</span>
<a name="l2258"><span class="linenum">2258</span></a>  <span class="comment"> * @param bool $onlyactive consider only active enrolments in enabled plugins and time restrictions</span>
<a name="l2259"><span class="linenum">2259</span></a>  <span class="comment"> * @param bool $onlysuspended inverse of onlyactive, consider only suspended enrolments</span>
<a name="l2260"><span class="linenum">2260</span></a>  <span class="comment"> * @return array list($sql, $params)</span>
<a name="l2261"><span class="linenum">2261</span></a>  <span class="comment"> */</span>
<a name="l2262"><span class="linenum">2262</span></a>  function <a class="function" onClick="logFunction('get_enrolled_sql')" href="../_functions/get_enrolled_sql.html" onMouseOver="funcPopup(event,'get_enrolled_sql')">get_enrolled_sql</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it28815" onMouseOver="hilite(28815)" onMouseOut="lolite()" onClick="logVariable('withcapability')" href="../_variables/withcapability.html">$withcapability</a> = '', <a class="var it1423" onMouseOver="hilite(1423)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../_variables/groupid.html">$groupid</a> = 0, <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('onlyactive')" href="../_variables/onlyactive.html">$onlyactive</a> = false, <a class="var it28816" onMouseOver="hilite(28816)" onMouseOut="lolite()" onClick="logVariable('onlysuspended')" href="../_variables/onlysuspended.html">$onlysuspended</a> = false) {
<a name="l2263"><span class="linenum">2263</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l2264"><span class="linenum">2264</span></a>  
<a name="l2265"><span class="linenum">2265</span></a>  <span class="comment">    // use unique prefix just in case somebody makes some SQL magic with the result</span>
<a name="l2266"><span class="linenum">2266</span></a>      static <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a> = 0;
<a name="l2267"><span class="linenum">2267</span></a>      <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a>++;
<a name="l2268"><span class="linenum">2268</span></a>      <a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a> = 'eu'.<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a>.'_';
<a name="l2269"><span class="linenum">2269</span></a>  
<a name="l2270"><span class="linenum">2270</span></a>  <span class="comment">    // first find the course context</span>
<a name="l2271"><span class="linenum">2271</span></a>      <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_course_context')" href="../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>();
<a name="l2272"><span class="linenum">2272</span></a>  
<a name="l2273"><span class="linenum">2273</span></a>      <a class="var it5773" onMouseOver="hilite(5773)" onMouseOut="lolite()" onClick="logVariable('isfrontpage')" href="../_variables/isfrontpage.html">$isfrontpage</a> = (<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a> == <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>);
<a name="l2274"><span class="linenum">2274</span></a>  
<a name="l2275"><span class="linenum">2275</span></a>      if (<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('onlyactive')" href="../_variables/onlyactive.html">$onlyactive</a> &amp;&amp; <a class="var it28816" onMouseOver="hilite(28816)" onMouseOut="lolite()" onClick="logVariable('onlysuspended')" href="../_variables/onlysuspended.html">$onlysuspended</a>) {
<a name="l2276"><span class="linenum">2276</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>(&quot;Both onlyactive and onlysuspended are set, this is probably not what you want!&quot;);
<a name="l2277"><span class="linenum">2277</span></a>      }
<a name="l2278"><span class="linenum">2278</span></a>      if (<a class="var it5773" onMouseOver="hilite(5773)" onMouseOut="lolite()" onClick="logVariable('isfrontpage')" href="../_variables/isfrontpage.html">$isfrontpage</a> &amp;&amp; <a class="var it28816" onMouseOver="hilite(28816)" onMouseOut="lolite()" onClick="logVariable('onlysuspended')" href="../_variables/onlysuspended.html">$onlysuspended</a>) {
<a name="l2279"><span class="linenum">2279</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>(&quot;onlysuspended is not supported on frontpage; please add your own early-exit!&quot;);
<a name="l2280"><span class="linenum">2280</span></a>      }
<a name="l2281"><span class="linenum">2281</span></a>  
<a name="l2282"><span class="linenum">2282</span></a>      <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('joins')" href="../_variables/joins.html">$joins</a>  = array();
<a name="l2283"><span class="linenum">2283</span></a>      <a class="var it9795" onMouseOver="hilite(9795)" onMouseOut="lolite()" onClick="logVariable('wheres')" href="../_variables/wheres.html">$wheres</a> = array();
<a name="l2284"><span class="linenum">2284</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array();
<a name="l2285"><span class="linenum">2285</span></a>  
<a name="l2286"><span class="linenum">2286</span></a>      <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it12554" onMouseOver="hilite(12554)" onMouseOut="lolite()" onClick="logVariable('contextids')" href="../_variables/contextids.html">$contextids</a>, <a class="var it28817" onMouseOver="hilite(28817)" onMouseOut="lolite()" onClick="logVariable('contextpaths')" href="../_variables/contextpaths.html">$contextpaths</a>) = <a class="function" onClick="logFunction('get_context_info_list')" href="../_functions/get_context_info_list.html" onMouseOver="funcPopup(event,'get_context_info_list')">get_context_info_list</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l2287"><span class="linenum">2287</span></a>  
<a name="l2288"><span class="linenum">2288</span></a>  <span class="comment">    // get all relevant capability info for all roles</span>
<a name="l2289"><span class="linenum">2289</span></a>      if (<a class="var it28815" onMouseOver="hilite(28815)" onMouseOut="lolite()" onClick="logVariable('withcapability')" href="../_variables/withcapability.html">$withcapability</a>) {
<a name="l2290"><span class="linenum">2290</span></a>          <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it28818" onMouseOver="hilite(28818)" onMouseOut="lolite()" onClick="logVariable('incontexts')" href="../_variables/incontexts.html">$incontexts</a>, <a class="var it26962" onMouseOver="hilite(26962)" onMouseOut="lolite()" onClick="logVariable('cparams')" href="../_variables/cparams.html">$cparams</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it12554" onMouseOver="hilite(12554)" onMouseOut="lolite()" onClick="logVariable('contextids')" href="../_variables/contextids.html">$contextids</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'ctx');
<a name="l2291"><span class="linenum">2291</span></a>          <a class="var it26962" onMouseOver="hilite(26962)" onMouseOut="lolite()" onClick="logVariable('cparams')" href="../_variables/cparams.html">$cparams</a>['cap'] = <a class="var it28815" onMouseOver="hilite(28815)" onMouseOut="lolite()" onClick="logVariable('withcapability')" href="../_variables/withcapability.html">$withcapability</a>;
<a name="l2292"><span class="linenum">2292</span></a>  
<a name="l2293"><span class="linenum">2293</span></a>          <a class="var it22422" onMouseOver="hilite(22422)" onMouseOut="lolite()" onClick="logVariable('defs')" href="../_variables/defs.html">$defs</a> = array();
<a name="l2294"><span class="linenum">2294</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT rc.id, rc.roleid, rc.permission, ctx.path
<a name="l2295"><span class="linenum">2295</span></a>                    FROM {role_capabilities} rc
<a name="l2296"><span class="linenum">2296</span></a>                    JOIN {context} ctx on rc.contextid = ctx.id
<a name="l2297"><span class="linenum">2297</span></a>                   WHERE rc.contextid <a class="var it28818" onMouseOver="hilite(28818)" onMouseOut="lolite()" onClick="logVariable('incontexts')" href="../_variables/incontexts.html">$incontexts</a> AND rc.capability = :cap&quot;;
<a name="l2298"><span class="linenum">2298</span></a>          <a class="var it28819" onMouseOver="hilite(28819)" onMouseOut="lolite()" onClick="logVariable('rcs')" href="../_variables/rcs.html">$rcs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it26962" onMouseOver="hilite(26962)" onMouseOut="lolite()" onClick="logVariable('cparams')" href="../_variables/cparams.html">$cparams</a>);
<a name="l2299"><span class="linenum">2299</span></a>          foreach (<a class="var it28819" onMouseOver="hilite(28819)" onMouseOut="lolite()" onClick="logVariable('rcs')" href="../_variables/rcs.html">$rcs</a> as <a class="var it6467" onMouseOver="hilite(6467)" onMouseOut="lolite()" onClick="logVariable('rc')" href="../_variables/rc.html">$rc</a>) {
<a name="l2300"><span class="linenum">2300</span></a>              <a class="var it22422" onMouseOver="hilite(22422)" onMouseOut="lolite()" onClick="logVariable('defs')" href="../_variables/defs.html">$defs</a>[<a class="var it6467" onMouseOver="hilite(6467)" onMouseOut="lolite()" onClick="logVariable('rc')" href="../_variables/rc.html">$rc</a>-&gt;<a onClick="logVariable('path')" class="var it40328" onMouseOver="hilite(40328)" onMouseOut="lolite()" href="../_variables/path.html">path</a>][<a class="var it6467" onMouseOver="hilite(6467)" onMouseOut="lolite()" onClick="logVariable('rc')" href="../_variables/rc.html">$rc</a>-&gt;<a onClick="logVariable('roleid')" class="var it40328" onMouseOver="hilite(40328)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>] = <a class="var it6467" onMouseOver="hilite(6467)" onMouseOut="lolite()" onClick="logVariable('rc')" href="../_variables/rc.html">$rc</a>-&gt;<a onClick="logVariable('permission')" class="var it40328" onMouseOver="hilite(40328)" onMouseOut="lolite()" href="../_variables/permission.html">permission</a>;
<a name="l2301"><span class="linenum">2301</span></a>          }
<a name="l2302"><span class="linenum">2302</span></a>  
<a name="l2303"><span class="linenum">2303</span></a>          <a class="var it1026" onMouseOver="hilite(1026)" onMouseOut="lolite()" onClick="logVariable('access')" href="../_variables/access.html">$access</a> = array();
<a name="l2304"><span class="linenum">2304</span></a>          if (!empty(<a class="var it22422" onMouseOver="hilite(22422)" onMouseOut="lolite()" onClick="logVariable('defs')" href="../_variables/defs.html">$defs</a>)) {
<a name="l2305"><span class="linenum">2305</span></a>              foreach (<a class="var it28817" onMouseOver="hilite(28817)" onMouseOut="lolite()" onClick="logVariable('contextpaths')" href="../_variables/contextpaths.html">$contextpaths</a> as <a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>) {
<a name="l2306"><span class="linenum">2306</span></a>                  if (empty(<a class="var it22422" onMouseOver="hilite(22422)" onMouseOut="lolite()" onClick="logVariable('defs')" href="../_variables/defs.html">$defs</a>[<a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>])) {
<a name="l2307"><span class="linenum">2307</span></a>                      continue;
<a name="l2308"><span class="linenum">2308</span></a>                  }
<a name="l2309"><span class="linenum">2309</span></a>                  foreach(<a class="var it22422" onMouseOver="hilite(22422)" onMouseOut="lolite()" onClick="logVariable('defs')" href="../_variables/defs.html">$defs</a>[<a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>] as <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a> =&gt; <a class="var it26371" onMouseOver="hilite(26371)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../_variables/perm.html">$perm</a>) {
<a name="l2310"><span class="linenum">2310</span></a>                      if (<a class="var it26371" onMouseOver="hilite(26371)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../_variables/perm.html">$perm</a> == <a class="constant" onClick="logConstant('CAP_PROHIBIT')" href="../_constants/CAP_PROHIBIT.html" onMouseOver="constPopup(event,'CAP_PROHIBIT')">CAP_PROHIBIT</a>) {
<a name="l2311"><span class="linenum">2311</span></a>                          <a class="var it1026" onMouseOver="hilite(1026)" onMouseOut="lolite()" onClick="logVariable('access')" href="../_variables/access.html">$access</a>[<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>] = <a class="constant" onClick="logConstant('CAP_PROHIBIT')" href="../_constants/CAP_PROHIBIT.html" onMouseOver="constPopup(event,'CAP_PROHIBIT')">CAP_PROHIBIT</a>;
<a name="l2312"><span class="linenum">2312</span></a>                          continue;
<a name="l2313"><span class="linenum">2313</span></a>                      }
<a name="l2314"><span class="linenum">2314</span></a>                      if (!isset(<a class="var it1026" onMouseOver="hilite(1026)" onMouseOut="lolite()" onClick="logVariable('access')" href="../_variables/access.html">$access</a>[<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>])) {
<a name="l2315"><span class="linenum">2315</span></a>                          <a class="var it1026" onMouseOver="hilite(1026)" onMouseOut="lolite()" onClick="logVariable('access')" href="../_variables/access.html">$access</a>[<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>] = (int)<a class="var it26371" onMouseOver="hilite(26371)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../_variables/perm.html">$perm</a>;
<a name="l2316"><span class="linenum">2316</span></a>                      }
<a name="l2317"><span class="linenum">2317</span></a>                  }
<a name="l2318"><span class="linenum">2318</span></a>              }
<a name="l2319"><span class="linenum">2319</span></a>          }
<a name="l2320"><span class="linenum">2320</span></a>  
<a name="l2321"><span class="linenum">2321</span></a>          unset(<a class="var it22422" onMouseOver="hilite(22422)" onMouseOut="lolite()" onClick="logVariable('defs')" href="../_variables/defs.html">$defs</a>);
<a name="l2322"><span class="linenum">2322</span></a>  
<a name="l2323"><span class="linenum">2323</span></a>  <span class="comment">        // make lists of roles that are needed and prohibited</span>
<a name="l2324"><span class="linenum">2324</span></a>          <a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>     = array(); <span class="comment">// one of these is enough</span>
<a name="l2325"><span class="linenum">2325</span></a>          <a class="var it28820" onMouseOver="hilite(28820)" onMouseOut="lolite()" onClick="logVariable('prohibited')" href="../_variables/prohibited.html">$prohibited</a> = array(); <span class="comment">// must not have any of these</span>
<a name="l2326"><span class="linenum">2326</span></a>          foreach (<a class="var it1026" onMouseOver="hilite(1026)" onMouseOut="lolite()" onClick="logVariable('access')" href="../_variables/access.html">$access</a> as <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a> =&gt; <a class="var it26371" onMouseOver="hilite(26371)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../_variables/perm.html">$perm</a>) {
<a name="l2327"><span class="linenum">2327</span></a>              if (<a class="var it26371" onMouseOver="hilite(26371)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../_variables/perm.html">$perm</a> == <a class="constant" onClick="logConstant('CAP_PROHIBIT')" href="../_constants/CAP_PROHIBIT.html" onMouseOver="constPopup(event,'CAP_PROHIBIT')">CAP_PROHIBIT</a>) {
<a name="l2328"><span class="linenum">2328</span></a>                  unset(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>[<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>]);
<a name="l2329"><span class="linenum">2329</span></a>                  <a class="var it28820" onMouseOver="hilite(28820)" onMouseOut="lolite()" onClick="logVariable('prohibited')" href="../_variables/prohibited.html">$prohibited</a>[<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>] = true;
<a name="l2330"><span class="linenum">2330</span></a>              } else if (<a class="var it26371" onMouseOver="hilite(26371)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../_variables/perm.html">$perm</a> == <a class="constant" onClick="logConstant('CAP_ALLOW')" href="../_constants/CAP_ALLOW.html" onMouseOver="constPopup(event,'CAP_ALLOW')">CAP_ALLOW</a> and empty(<a class="var it28820" onMouseOver="hilite(28820)" onMouseOut="lolite()" onClick="logVariable('prohibited')" href="../_variables/prohibited.html">$prohibited</a>[<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>])) {
<a name="l2331"><span class="linenum">2331</span></a>                  <a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>[<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>] = true;
<a name="l2332"><span class="linenum">2332</span></a>              }
<a name="l2333"><span class="linenum">2333</span></a>          }
<a name="l2334"><span class="linenum">2334</span></a>  
<a name="l2335"><span class="linenum">2335</span></a>          <a class="var it16422" onMouseOver="hilite(16422)" onMouseOut="lolite()" onClick="logVariable('defaultuserroleid')" href="../_variables/defaultuserroleid.html">$defaultuserroleid</a>      = isset(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultuserroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultuserroleid.html">defaultuserroleid</a>) ? <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultuserroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultuserroleid.html">defaultuserroleid</a> : 0;
<a name="l2336"><span class="linenum">2336</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('defaultfrontpageroleid')" href="../_variables/defaultfrontpageroleid.html">$defaultfrontpageroleid</a> = isset(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultfrontpageroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultfrontpageroleid.html">defaultfrontpageroleid</a>) ? <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultfrontpageroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultfrontpageroleid.html">defaultfrontpageroleid</a> : 0;
<a name="l2337"><span class="linenum">2337</span></a>  
<a name="l2338"><span class="linenum">2338</span></a>          <a class="var it28821" onMouseOver="hilite(28821)" onMouseOut="lolite()" onClick="logVariable('nobody')" href="../_variables/nobody.html">$nobody</a> = false;
<a name="l2339"><span class="linenum">2339</span></a>  
<a name="l2340"><span class="linenum">2340</span></a>          if (<a class="var it5773" onMouseOver="hilite(5773)" onMouseOut="lolite()" onClick="logVariable('isfrontpage')" href="../_variables/isfrontpage.html">$isfrontpage</a>) {
<a name="l2341"><span class="linenum">2341</span></a>              if (!empty(<a class="var it28820" onMouseOver="hilite(28820)" onMouseOut="lolite()" onClick="logVariable('prohibited')" href="../_variables/prohibited.html">$prohibited</a>[<a class="var it16422" onMouseOver="hilite(16422)" onMouseOut="lolite()" onClick="logVariable('defaultuserroleid')" href="../_variables/defaultuserroleid.html">$defaultuserroleid</a>]) or !empty(<a class="var it28820" onMouseOver="hilite(28820)" onMouseOut="lolite()" onClick="logVariable('prohibited')" href="../_variables/prohibited.html">$prohibited</a>[<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('defaultfrontpageroleid')" href="../_variables/defaultfrontpageroleid.html">$defaultfrontpageroleid</a>])) {
<a name="l2342"><span class="linenum">2342</span></a>                  <a class="var it28821" onMouseOver="hilite(28821)" onMouseOut="lolite()" onClick="logVariable('nobody')" href="../_variables/nobody.html">$nobody</a> = true;
<a name="l2343"><span class="linenum">2343</span></a>              } else if (!empty(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>[<a class="var it16422" onMouseOver="hilite(16422)" onMouseOut="lolite()" onClick="logVariable('defaultuserroleid')" href="../_variables/defaultuserroleid.html">$defaultuserroleid</a>]) or !empty(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>[<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('defaultfrontpageroleid')" href="../_variables/defaultfrontpageroleid.html">$defaultfrontpageroleid</a>])) {
<a name="l2344"><span class="linenum">2344</span></a>  <span class="comment">                // everybody not having prohibit has the capability</span>
<a name="l2345"><span class="linenum">2345</span></a>                  <a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a> = array();
<a name="l2346"><span class="linenum">2346</span></a>              } else if (empty(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>)) {
<a name="l2347"><span class="linenum">2347</span></a>                  <a class="var it28821" onMouseOver="hilite(28821)" onMouseOut="lolite()" onClick="logVariable('nobody')" href="../_variables/nobody.html">$nobody</a> = true;
<a name="l2348"><span class="linenum">2348</span></a>              }
<a name="l2349"><span class="linenum">2349</span></a>          } else {
<a name="l2350"><span class="linenum">2350</span></a>              if (!empty(<a class="var it28820" onMouseOver="hilite(28820)" onMouseOut="lolite()" onClick="logVariable('prohibited')" href="../_variables/prohibited.html">$prohibited</a>[<a class="var it16422" onMouseOver="hilite(16422)" onMouseOut="lolite()" onClick="logVariable('defaultuserroleid')" href="../_variables/defaultuserroleid.html">$defaultuserroleid</a>])) {
<a name="l2351"><span class="linenum">2351</span></a>                  <a class="var it28821" onMouseOver="hilite(28821)" onMouseOut="lolite()" onClick="logVariable('nobody')" href="../_variables/nobody.html">$nobody</a> = true;
<a name="l2352"><span class="linenum">2352</span></a>              } else if (!empty(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>[<a class="var it16422" onMouseOver="hilite(16422)" onMouseOut="lolite()" onClick="logVariable('defaultuserroleid')" href="../_variables/defaultuserroleid.html">$defaultuserroleid</a>])) {
<a name="l2353"><span class="linenum">2353</span></a>  <span class="comment">                // everybody not having prohibit has the capability</span>
<a name="l2354"><span class="linenum">2354</span></a>                  <a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a> = array();
<a name="l2355"><span class="linenum">2355</span></a>              } else if (empty(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>)) {
<a name="l2356"><span class="linenum">2356</span></a>                  <a class="var it28821" onMouseOver="hilite(28821)" onMouseOut="lolite()" onClick="logVariable('nobody')" href="../_variables/nobody.html">$nobody</a> = true;
<a name="l2357"><span class="linenum">2357</span></a>              }
<a name="l2358"><span class="linenum">2358</span></a>          }
<a name="l2359"><span class="linenum">2359</span></a>  
<a name="l2360"><span class="linenum">2360</span></a>          if (<a class="var it28821" onMouseOver="hilite(28821)" onMouseOut="lolite()" onClick="logVariable('nobody')" href="../_variables/nobody.html">$nobody</a>) {
<a name="l2361"><span class="linenum">2361</span></a>  <span class="comment">            // nobody can match so return some SQL that does not return any results</span>
<a name="l2362"><span class="linenum">2362</span></a>              <a class="var it9795" onMouseOver="hilite(9795)" onMouseOut="lolite()" onClick="logVariable('wheres')" href="../_variables/wheres.html">$wheres</a>[] = &quot;1 = 2&quot;;
<a name="l2363"><span class="linenum">2363</span></a>  
<a name="l2364"><span class="linenum">2364</span></a>          } else {
<a name="l2365"><span class="linenum">2365</span></a>  
<a name="l2366"><span class="linenum">2366</span></a>              if (<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>) {
<a name="l2367"><span class="linenum">2367</span></a>                  <a class="var it25259" onMouseOver="hilite(25259)" onMouseOut="lolite()" onClick="logVariable('ctxids')" href="../_variables/ctxids.html">$ctxids</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',', <a class="var it12554" onMouseOver="hilite(12554)" onMouseOut="lolite()" onClick="logVariable('contextids')" href="../_variables/contextids.html">$contextids</a>);
<a name="l2368"><span class="linenum">2368</span></a>                  <a class="var it3996" onMouseOver="hilite(3996)" onMouseOut="lolite()" onClick="logVariable('roleids')" href="../_variables/roleids.html">$roleids</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',', <a class="phpfunction" onClick="logFunction('array_keys')" href="../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>));
<a name="l2369"><span class="linenum">2369</span></a>                  <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('joins')" href="../_variables/joins.html">$joins</a>[] = &quot;JOIN {role_assignments} {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}ra3 <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> ({<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}ra3.userid = {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}u.id AND {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}ra3.roleid IN (<a class="var it3996" onMouseOver="hilite(3996)" onMouseOut="lolite()" onClick="logVariable('roleids')" href="../_variables/roleids.html">$roleids</a>) AND {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}ra3.contextid IN (<a class="var it25259" onMouseOver="hilite(25259)" onMouseOut="lolite()" onClick="logVariable('ctxids')" href="../_variables/ctxids.html">$ctxids</a>))&quot;;
<a name="l2370"><span class="linenum">2370</span></a>              }
<a name="l2371"><span class="linenum">2371</span></a>  
<a name="l2372"><span class="linenum">2372</span></a>              if (<a class="var it28820" onMouseOver="hilite(28820)" onMouseOut="lolite()" onClick="logVariable('prohibited')" href="../_variables/prohibited.html">$prohibited</a>) {
<a name="l2373"><span class="linenum">2373</span></a>                  <a class="var it25259" onMouseOver="hilite(25259)" onMouseOut="lolite()" onClick="logVariable('ctxids')" href="../_variables/ctxids.html">$ctxids</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',', <a class="var it12554" onMouseOver="hilite(12554)" onMouseOut="lolite()" onClick="logVariable('contextids')" href="../_variables/contextids.html">$contextids</a>);
<a name="l2374"><span class="linenum">2374</span></a>                  <a class="var it3996" onMouseOver="hilite(3996)" onMouseOut="lolite()" onClick="logVariable('roleids')" href="../_variables/roleids.html">$roleids</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',', <a class="phpfunction" onClick="logFunction('array_keys')" href="../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it28820" onMouseOver="hilite(28820)" onMouseOut="lolite()" onClick="logVariable('prohibited')" href="../_variables/prohibited.html">$prohibited</a>));
<a name="l2375"><span class="linenum">2375</span></a>                  <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('joins')" href="../_variables/joins.html">$joins</a>[] = &quot;LEFT JOIN {role_assignments} {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}ra4 <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> ({<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}ra4.userid = {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}u.id AND {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}ra4.roleid IN (<a class="var it3996" onMouseOver="hilite(3996)" onMouseOut="lolite()" onClick="logVariable('roleids')" href="../_variables/roleids.html">$roleids</a>) AND {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}ra4.contextid IN (<a class="var it25259" onMouseOver="hilite(25259)" onMouseOut="lolite()" onClick="logVariable('ctxids')" href="../_variables/ctxids.html">$ctxids</a>))&quot;;
<a name="l2376"><span class="linenum">2376</span></a>                  <a class="var it9795" onMouseOver="hilite(9795)" onMouseOut="lolite()" onClick="logVariable('wheres')" href="../_variables/wheres.html">$wheres</a>[] = &quot;{<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}ra4.id IS NULL&quot;;
<a name="l2377"><span class="linenum">2377</span></a>              }
<a name="l2378"><span class="linenum">2378</span></a>  
<a name="l2379"><span class="linenum">2379</span></a>              if (<a class="var it1423" onMouseOver="hilite(1423)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../_variables/groupid.html">$groupid</a>) {
<a name="l2380"><span class="linenum">2380</span></a>                  <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('joins')" href="../_variables/joins.html">$joins</a>[] = &quot;JOIN {groups_members} {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}gm <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> ({<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}gm.userid = {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}u.id AND {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}gm.groupid = :{<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}gmid)&quot;;
<a name="l2381"><span class="linenum">2381</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>[&quot;{<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}gmid&quot;] = <a class="var it1423" onMouseOver="hilite(1423)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../_variables/groupid.html">$groupid</a>;
<a name="l2382"><span class="linenum">2382</span></a>              }
<a name="l2383"><span class="linenum">2383</span></a>          }
<a name="l2384"><span class="linenum">2384</span></a>  
<a name="l2385"><span class="linenum">2385</span></a>      } else {
<a name="l2386"><span class="linenum">2386</span></a>          if (<a class="var it1423" onMouseOver="hilite(1423)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../_variables/groupid.html">$groupid</a>) {
<a name="l2387"><span class="linenum">2387</span></a>              <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('joins')" href="../_variables/joins.html">$joins</a>[] = &quot;JOIN {groups_members} {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}gm <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> ({<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}gm.userid = {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}u.id AND {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}gm.groupid = :{<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}gmid)&quot;;
<a name="l2388"><span class="linenum">2388</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>[&quot;{<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}gmid&quot;] = <a class="var it1423" onMouseOver="hilite(1423)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../_variables/groupid.html">$groupid</a>;
<a name="l2389"><span class="linenum">2389</span></a>          }
<a name="l2390"><span class="linenum">2390</span></a>      }
<a name="l2391"><span class="linenum">2391</span></a>  
<a name="l2392"><span class="linenum">2392</span></a>      <a class="var it9795" onMouseOver="hilite(9795)" onMouseOut="lolite()" onClick="logVariable('wheres')" href="../_variables/wheres.html">$wheres</a>[] = &quot;{<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}u.deleted = 0 AND {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}u.id &lt;&gt; :{<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}guestid&quot;;
<a name="l2393"><span class="linenum">2393</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>[&quot;{<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}guestid&quot;] = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('siteguest')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/siteguest.html">siteguest</a>;
<a name="l2394"><span class="linenum">2394</span></a>  
<a name="l2395"><span class="linenum">2395</span></a>      if (<a class="var it5773" onMouseOver="hilite(5773)" onMouseOut="lolite()" onClick="logVariable('isfrontpage')" href="../_variables/isfrontpage.html">$isfrontpage</a>) {
<a name="l2396"><span class="linenum">2396</span></a>  <span class="comment">        // all users are &quot;enrolled&quot; on the frontpage</span>
<a name="l2397"><span class="linenum">2397</span></a>      } else {
<a name="l2398"><span class="linenum">2398</span></a>          <a class="var it28822" onMouseOver="hilite(28822)" onMouseOut="lolite()" onClick="logVariable('where1')" href="../_variables/where1.html">$where1</a> = &quot;{<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}ue.status = :{<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}active AND {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}e.status = :{<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}enabled&quot;;
<a name="l2399"><span class="linenum">2399</span></a>          <a class="var it28823" onMouseOver="hilite(28823)" onMouseOut="lolite()" onClick="logVariable('where2')" href="../_variables/where2.html">$where2</a> = &quot;{<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}ue.timestart &lt; :{<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}now1 AND ({<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}ue.timeend = 0 OR {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}ue.timeend &gt; :{<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}now2)&quot;;
<a name="l2400"><span class="linenum">2400</span></a>          <a class="var it28824" onMouseOver="hilite(28824)" onMouseOut="lolite()" onClick="logVariable('ejoin')" href="../_variables/ejoin.html">$ejoin</a> = &quot;JOIN {enrol} {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}e <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> ({<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}e.id = {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}ue.enrolid AND {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}e.courseid = :{<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}courseid)&quot;;
<a name="l2401"><span class="linenum">2401</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>[<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>.'courseid'] = <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>;
<a name="l2402"><span class="linenum">2402</span></a>  
<a name="l2403"><span class="linenum">2403</span></a>          if (!<a class="var it28816" onMouseOver="hilite(28816)" onMouseOut="lolite()" onClick="logVariable('onlysuspended')" href="../_variables/onlysuspended.html">$onlysuspended</a>) {
<a name="l2404"><span class="linenum">2404</span></a>              <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('joins')" href="../_variables/joins.html">$joins</a>[] = &quot;JOIN {user_enrolments} {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}ue ON {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}ue.userid = {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}u.id&quot;;
<a name="l2405"><span class="linenum">2405</span></a>              <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('joins')" href="../_variables/joins.html">$joins</a>[] = <a class="var it28824" onMouseOver="hilite(28824)" onMouseOut="lolite()" onClick="logVariable('ejoin')" href="../_variables/ejoin.html">$ejoin</a>;
<a name="l2406"><span class="linenum">2406</span></a>              if (<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('onlyactive')" href="../_variables/onlyactive.html">$onlyactive</a>) {
<a name="l2407"><span class="linenum">2407</span></a>                  <a class="var it9795" onMouseOver="hilite(9795)" onMouseOut="lolite()" onClick="logVariable('wheres')" href="../_variables/wheres.html">$wheres</a>[] = &quot;<a class="var it28822" onMouseOver="hilite(28822)" onMouseOut="lolite()" onClick="logVariable('where1')" href="../_variables/where1.html">$where1</a> AND <a class="var it28823" onMouseOver="hilite(28823)" onMouseOut="lolite()" onClick="logVariable('where2')" href="../_variables/where2.html">$where2</a>&quot;;
<a name="l2408"><span class="linenum">2408</span></a>              }
<a name="l2409"><span class="linenum">2409</span></a>          } else {
<a name="l2410"><span class="linenum">2410</span></a>  <span class="comment">            // Suspended only where there is enrolment but ALL are suspended.</span>
<a name="l2411"><span class="linenum">2411</span></a>  <span class="comment">            // Consider multiple enrols where one is not suspended or plain role_assign.</span>
<a name="l2412"><span class="linenum">2412</span></a>              <a class="var it28825" onMouseOver="hilite(28825)" onMouseOut="lolite()" onClick="logVariable('enrolselect')" href="../_variables/enrolselect.html">$enrolselect</a> = &quot;SELECT DISTINCT {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}ue.userid FROM {user_enrolments} {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}ue <a class="var it28824" onMouseOver="hilite(28824)" onMouseOut="lolite()" onClick="logVariable('ejoin')" href="../_variables/ejoin.html">$ejoin</a> WHERE <a class="var it28822" onMouseOver="hilite(28822)" onMouseOut="lolite()" onClick="logVariable('where1')" href="../_variables/where1.html">$where1</a> AND <a class="var it28823" onMouseOver="hilite(28823)" onMouseOut="lolite()" onClick="logVariable('where2')" href="../_variables/where2.html">$where2</a>&quot;;
<a name="l2413"><span class="linenum">2413</span></a>              <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('joins')" href="../_variables/joins.html">$joins</a>[] = &quot;JOIN {user_enrolments} {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}ue1 ON {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}ue1.userid = {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}u.id&quot;;
<a name="l2414"><span class="linenum">2414</span></a>              <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('joins')" href="../_variables/joins.html">$joins</a>[] = &quot;JOIN {enrol} {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}e1 <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> ({<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}e1.id = {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}ue1.enrolid AND {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}e1.courseid = :{<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}_e1_courseid)&quot;;
<a name="l2415"><span class="linenum">2415</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>[&quot;{<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}_e1_courseid&quot;] = <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>;
<a name="l2416"><span class="linenum">2416</span></a>              <a class="var it9795" onMouseOver="hilite(9795)" onMouseOut="lolite()" onClick="logVariable('wheres')" href="../_variables/wheres.html">$wheres</a>[] = &quot;{<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}u.id NOT IN (<a class="var it28825" onMouseOver="hilite(28825)" onMouseOut="lolite()" onClick="logVariable('enrolselect')" href="../_variables/enrolselect.html">$enrolselect</a>)&quot;;
<a name="l2417"><span class="linenum">2417</span></a>          }
<a name="l2418"><span class="linenum">2418</span></a>  
<a name="l2419"><span class="linenum">2419</span></a>          if (<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('onlyactive')" href="../_variables/onlyactive.html">$onlyactive</a> || <a class="var it28816" onMouseOver="hilite(28816)" onMouseOut="lolite()" onClick="logVariable('onlysuspended')" href="../_variables/onlysuspended.html">$onlysuspended</a>) {
<a name="l2420"><span class="linenum">2420</span></a>              <a class="var it345" onMouseOver="hilite(345)" onMouseOut="lolite()" onClick="logVariable('now')" href="../_variables/now.html">$now</a> = <a class="phpfunction" onClick="logFunction('round')" href="../_functions/round.html" onMouseOver="phpfuncPopup(event,'round')">round</a>(<a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>(), -2); <span class="comment">// rounding helps caching in DB</span>
<a name="l2421"><span class="linenum">2421</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, array(<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>.'enabled'=&gt;<a class="constant" onClick="logConstant('ENROL_INSTANCE_ENABLED')" href="../_constants/ENROL_INSTANCE_ENABLED.html" onMouseOver="constPopup(event,'ENROL_INSTANCE_ENABLED')">ENROL_INSTANCE_ENABLED</a>,
<a name="l2422"><span class="linenum">2422</span></a>                                                   <a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>.'active'=&gt;<a class="constant" onClick="logConstant('ENROL_USER_ACTIVE')" href="../_constants/ENROL_USER_ACTIVE.html" onMouseOver="constPopup(event,'ENROL_USER_ACTIVE')">ENROL_USER_ACTIVE</a>,
<a name="l2423"><span class="linenum">2423</span></a>                                                   <a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>.'now1'=&gt;<a class="var it345" onMouseOver="hilite(345)" onMouseOut="lolite()" onClick="logVariable('now')" href="../_variables/now.html">$now</a>, <a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>.'now2'=&gt;<a class="var it345" onMouseOver="hilite(345)" onMouseOut="lolite()" onClick="logVariable('now')" href="../_variables/now.html">$now</a>));
<a name="l2424"><span class="linenum">2424</span></a>          }
<a name="l2425"><span class="linenum">2425</span></a>      }
<a name="l2426"><span class="linenum">2426</span></a>  
<a name="l2427"><span class="linenum">2427</span></a>      <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('joins')" href="../_variables/joins.html">$joins</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(&quot;\n&quot;, <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('joins')" href="../_variables/joins.html">$joins</a>);
<a name="l2428"><span class="linenum">2428</span></a>      <a class="var it9795" onMouseOver="hilite(9795)" onMouseOut="lolite()" onClick="logVariable('wheres')" href="../_variables/wheres.html">$wheres</a> = &quot;WHERE &quot;.<a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(&quot; AND &quot;, <a class="var it9795" onMouseOver="hilite(9795)" onMouseOut="lolite()" onClick="logVariable('wheres')" href="../_variables/wheres.html">$wheres</a>);
<a name="l2429"><span class="linenum">2429</span></a>  
<a name="l2430"><span class="linenum">2430</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT DISTINCT {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}u.id
<a name="l2431"><span class="linenum">2431</span></a>                FROM {user} {<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../_variables/prefix.html">$prefix</a>}u
<a name="l2432"><span class="linenum">2432</span></a>              <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('joins')" href="../_variables/joins.html">$joins</a>
<a name="l2433"><span class="linenum">2433</span></a>             <a class="var it9795" onMouseOver="hilite(9795)" onMouseOut="lolite()" onClick="logVariable('wheres')" href="../_variables/wheres.html">$wheres</a>&quot;;
<a name="l2434"><span class="linenum">2434</span></a>  
<a name="l2435"><span class="linenum">2435</span></a>      return array(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l2436"><span class="linenum">2436</span></a>  }
<a name="l2437"><span class="linenum">2437</span></a>  
<a name="l2438"><span class="linenum">2438</span></a>  <span class="comment">/**</span>
<a name="l2439"><span class="linenum">2439</span></a>  <span class="comment"> * Returns list of users enrolled into course.</span>
<a name="l2440"><span class="linenum">2440</span></a>  <span class="comment"> *</span>
<a name="l2441"><span class="linenum">2441</span></a>  <span class="comment"> * @package   core_enrol</span>
<a name="l2442"><span class="linenum">2442</span></a>  <span class="comment"> * @category  access</span>
<a name="l2443"><span class="linenum">2443</span></a>  <span class="comment"> *</span>
<a name="l2444"><span class="linenum">2444</span></a>  <span class="comment"> * @param context $context</span>
<a name="l2445"><span class="linenum">2445</span></a>  <span class="comment"> * @param string $withcapability</span>
<a name="l2446"><span class="linenum">2446</span></a>  <span class="comment"> * @param int $groupid 0 means ignore groups, any other value limits the result by group id</span>
<a name="l2447"><span class="linenum">2447</span></a>  <span class="comment"> * @param string $userfields requested user record fields</span>
<a name="l2448"><span class="linenum">2448</span></a>  <span class="comment"> * @param string $orderby</span>
<a name="l2449"><span class="linenum">2449</span></a>  <span class="comment"> * @param int $limitfrom return a subset of records, starting at this point (optional, required if $limitnum is set).</span>
<a name="l2450"><span class="linenum">2450</span></a>  <span class="comment"> * @param int $limitnum return a subset comprising this many records (optional, required if $limitfrom is set).</span>
<a name="l2451"><span class="linenum">2451</span></a>  <span class="comment"> * @param bool $onlyactive consider only active enrolments in enabled plugins and time restrictions</span>
<a name="l2452"><span class="linenum">2452</span></a>  <span class="comment"> * @return array of user records</span>
<a name="l2453"><span class="linenum">2453</span></a>  <span class="comment"> */</span>
<a name="l2454"><span class="linenum">2454</span></a>  function <a class="function" onClick="logFunction('get_enrolled_users')" href="../_functions/get_enrolled_users.html" onMouseOver="funcPopup(event,'get_enrolled_users')">get_enrolled_users</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it28815" onMouseOver="hilite(28815)" onMouseOut="lolite()" onClick="logVariable('withcapability')" href="../_variables/withcapability.html">$withcapability</a> = '', <a class="var it1423" onMouseOver="hilite(1423)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../_variables/groupid.html">$groupid</a> = 0, <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a> = 'u.*', <a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../_variables/orderby.html">$orderby</a> = null,
<a name="l2455"><span class="linenum">2455</span></a>          <a class="var it2932" onMouseOver="hilite(2932)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../_variables/limitfrom.html">$limitfrom</a> = 0, <a class="var it3120" onMouseOver="hilite(3120)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../_variables/limitnum.html">$limitnum</a> = 0, <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('onlyactive')" href="../_variables/onlyactive.html">$onlyactive</a> = false) {
<a name="l2456"><span class="linenum">2456</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l2457"><span class="linenum">2457</span></a>  
<a name="l2458"><span class="linenum">2458</span></a>      <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it9245" onMouseOver="hilite(9245)" onMouseOut="lolite()" onClick="logVariable('esql')" href="../_variables/esql.html">$esql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="function" onClick="logFunction('get_enrolled_sql')" href="../_functions/get_enrolled_sql.html" onMouseOver="funcPopup(event,'get_enrolled_sql')">get_enrolled_sql</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it28815" onMouseOver="hilite(28815)" onMouseOut="lolite()" onClick="logVariable('withcapability')" href="../_variables/withcapability.html">$withcapability</a>, <a class="var it1423" onMouseOver="hilite(1423)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../_variables/groupid.html">$groupid</a>, <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('onlyactive')" href="../_variables/onlyactive.html">$onlyactive</a>);
<a name="l2459"><span class="linenum">2459</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT <a class="var it2982" onMouseOver="hilite(2982)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../_variables/userfields.html">$userfields</a>
<a name="l2460"><span class="linenum">2460</span></a>                FROM {user} u
<a name="l2461"><span class="linenum">2461</span></a>                <a class="function" onClick="logFunction('JOIN')" href="../_functions/join.html" onMouseOver="funcPopup(event,'join')">JOIN</a> (<a class="var it9245" onMouseOver="hilite(9245)" onMouseOut="lolite()" onClick="logVariable('esql')" href="../_variables/esql.html">$esql</a>) je ON je.id = u.id
<a name="l2462"><span class="linenum">2462</span></a>               WHERE u.deleted = 0&quot;;
<a name="l2463"><span class="linenum">2463</span></a>  
<a name="l2464"><span class="linenum">2464</span></a>      if (<a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../_variables/orderby.html">$orderby</a>) {
<a name="l2465"><span class="linenum">2465</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> ORDER BY <a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../_variables/orderby.html">$orderby</a>&quot;;
<a name="l2466"><span class="linenum">2466</span></a>      } else {
<a name="l2467"><span class="linenum">2467</span></a>          <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>, <a class="var it533" onMouseOver="hilite(533)" onMouseOut="lolite()" onClick="logVariable('sortparams')" href="../_variables/sortparams.html">$sortparams</a>) = <a class="function" onClick="logFunction('users_order_by_sql')" href="../_functions/users_order_by_sql.html" onMouseOver="funcPopup(event,'users_order_by_sql')">users_order_by_sql</a>('u');
<a name="l2468"><span class="linenum">2468</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> ORDER BY <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>&quot;;
<a name="l2469"><span class="linenum">2469</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it533" onMouseOver="hilite(533)" onMouseOut="lolite()" onClick="logVariable('sortparams')" href="../_variables/sortparams.html">$sortparams</a>);
<a name="l2470"><span class="linenum">2470</span></a>      }
<a name="l2471"><span class="linenum">2471</span></a>  
<a name="l2472"><span class="linenum">2472</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it2932" onMouseOver="hilite(2932)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../_variables/limitfrom.html">$limitfrom</a>, <a class="var it3120" onMouseOver="hilite(3120)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../_variables/limitnum.html">$limitnum</a>);
<a name="l2473"><span class="linenum">2473</span></a>  }
<a name="l2474"><span class="linenum">2474</span></a>  
<a name="l2475"><span class="linenum">2475</span></a>  <span class="comment">/**</span>
<a name="l2476"><span class="linenum">2476</span></a>  <span class="comment"> * Counts list of users enrolled into course (as per above function)</span>
<a name="l2477"><span class="linenum">2477</span></a>  <span class="comment"> *</span>
<a name="l2478"><span class="linenum">2478</span></a>  <span class="comment"> * @package   core_enrol</span>
<a name="l2479"><span class="linenum">2479</span></a>  <span class="comment"> * @category  access</span>
<a name="l2480"><span class="linenum">2480</span></a>  <span class="comment"> *</span>
<a name="l2481"><span class="linenum">2481</span></a>  <span class="comment"> * @param context $context</span>
<a name="l2482"><span class="linenum">2482</span></a>  <span class="comment"> * @param string $withcapability</span>
<a name="l2483"><span class="linenum">2483</span></a>  <span class="comment"> * @param int $groupid 0 means ignore groups, any other value limits the result by group id</span>
<a name="l2484"><span class="linenum">2484</span></a>  <span class="comment"> * @param bool $onlyactive consider only active enrolments in enabled plugins and time restrictions</span>
<a name="l2485"><span class="linenum">2485</span></a>  <span class="comment"> * @return array of user records</span>
<a name="l2486"><span class="linenum">2486</span></a>  <span class="comment"> */</span>
<a name="l2487"><span class="linenum">2487</span></a>  function <a class="function" onClick="logFunction('count_enrolled_users')" href="../_functions/count_enrolled_users.html" onMouseOver="funcPopup(event,'count_enrolled_users')">count_enrolled_users</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it28815" onMouseOver="hilite(28815)" onMouseOut="lolite()" onClick="logVariable('withcapability')" href="../_variables/withcapability.html">$withcapability</a> = '', <a class="var it1423" onMouseOver="hilite(1423)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../_variables/groupid.html">$groupid</a> = 0, <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('onlyactive')" href="../_variables/onlyactive.html">$onlyactive</a> = false) {
<a name="l2488"><span class="linenum">2488</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l2489"><span class="linenum">2489</span></a>  
<a name="l2490"><span class="linenum">2490</span></a>      <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it9245" onMouseOver="hilite(9245)" onMouseOut="lolite()" onClick="logVariable('esql')" href="../_variables/esql.html">$esql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="function" onClick="logFunction('get_enrolled_sql')" href="../_functions/get_enrolled_sql.html" onMouseOver="funcPopup(event,'get_enrolled_sql')">get_enrolled_sql</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it28815" onMouseOver="hilite(28815)" onMouseOut="lolite()" onClick="logVariable('withcapability')" href="../_variables/withcapability.html">$withcapability</a>, <a class="var it1423" onMouseOver="hilite(1423)" onMouseOut="lolite()" onClick="logVariable('groupid')" href="../_variables/groupid.html">$groupid</a>, <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('onlyactive')" href="../_variables/onlyactive.html">$onlyactive</a>);
<a name="l2491"><span class="linenum">2491</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT <a class="phpfunction" onClick="logFunction('count')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(u.id)
<a name="l2492"><span class="linenum">2492</span></a>                FROM {user} u
<a name="l2493"><span class="linenum">2493</span></a>                <a class="function" onClick="logFunction('JOIN')" href="../_functions/join.html" onMouseOver="funcPopup(event,'join')">JOIN</a> (<a class="var it9245" onMouseOver="hilite(9245)" onMouseOut="lolite()" onClick="logVariable('esql')" href="../_variables/esql.html">$esql</a>) je ON je.id = u.id
<a name="l2494"><span class="linenum">2494</span></a>               WHERE u.deleted = 0&quot;;
<a name="l2495"><span class="linenum">2495</span></a>  
<a name="l2496"><span class="linenum">2496</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records_sql')" href="../_functions/count_records_sql.html" onMouseOver="funcPopup(event,'count_records_sql')">count_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l2497"><span class="linenum">2497</span></a>  }
<a name="l2498"><span class="linenum">2498</span></a>  
<a name="l2499"><span class="linenum">2499</span></a>  <span class="comment">/**</span>
<a name="l2500"><span class="linenum">2500</span></a>  <span class="comment"> * Loads the capability definitions for the component (from file).</span>
<a name="l2501"><span class="linenum">2501</span></a>  <span class="comment"> *</span>
<a name="l2502"><span class="linenum">2502</span></a>  <span class="comment"> * Loads the capability definitions for the component (from file). If no</span>
<a name="l2503"><span class="linenum">2503</span></a>  <span class="comment"> * capabilities are defined for the component, we simply return an empty array.</span>
<a name="l2504"><span class="linenum">2504</span></a>  <span class="comment"> *</span>
<a name="l2505"><span class="linenum">2505</span></a>  <span class="comment"> * @access private</span>
<a name="l2506"><span class="linenum">2506</span></a>  <span class="comment"> * @param string $component full plugin name, examples: 'moodle', 'mod_forum'</span>
<a name="l2507"><span class="linenum">2507</span></a>  <span class="comment"> * @return array array of capabilities</span>
<a name="l2508"><span class="linenum">2508</span></a>  <span class="comment"> */</span>
<a name="l2509"><span class="linenum">2509</span></a>  function <a class="function" onClick="logFunction('load_capability_def')" href="../_functions/load_capability_def.html" onMouseOver="funcPopup(event,'load_capability_def')">load_capability_def</a>(<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>) {
<a name="l2510"><span class="linenum">2510</span></a>      <a class="var it17358" onMouseOver="hilite(17358)" onMouseOut="lolite()" onClick="logVariable('defpath')" href="../_variables/defpath.html">$defpath</a> = <a class="class" onClick="logClass('core_component')" href="../_classes/core_component.html" onMouseOver="classPopup(event,'core_component')">core_component</a>::<a class="function" onClick="logFunction('get_component_directory')" href="../_functions/get_component_directory.html" onMouseOver="funcPopup(event,'get_component_directory')">get_component_directory</a>(<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>).'/db/access.php';
<a name="l2511"><span class="linenum">2511</span></a>  
<a name="l2512"><span class="linenum">2512</span></a>      <a class="var it497" onMouseOver="hilite(497)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../_variables/capabilities.html">$capabilities</a> = array();
<a name="l2513"><span class="linenum">2513</span></a>      if (<a class="phpfunction" onClick="logFunction('file_exists')" href="../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it17358" onMouseOver="hilite(17358)" onMouseOut="lolite()" onClick="logVariable('defpath')" href="../_variables/defpath.html">$defpath</a>)) {
<a name="l2514"><span class="linenum">2514</span></a>          <a class="function" onClick="logFunction('require')" href="../_functions/require.html" onMouseOver="funcPopup(event,'require')">require</a>(<a class="var it17358" onMouseOver="hilite(17358)" onMouseOut="lolite()" onClick="logVariable('defpath')" href="../_variables/defpath.html">$defpath</a>);
<a name="l2515"><span class="linenum">2515</span></a>          if (!empty(${<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>.'_capabilities'})) {
<a name="l2516"><span class="linenum">2516</span></a>  <span class="comment">            // BC capability array name</span>
<a name="l2517"><span class="linenum">2517</span></a>  <span class="comment">            // since 2.0 we prefer $capabilities instead - it is easier to use and matches db/* files</span>
<a name="l2518"><span class="linenum">2518</span></a>              <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('componentname_capabilities array is deprecated, please use <a class="var it497" onMouseOver="hilite(497)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../_variables/capabilities.html">$capabilities</a> array only in access.php files');
<a name="l2519"><span class="linenum">2519</span></a>              <a class="var it497" onMouseOver="hilite(497)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../_variables/capabilities.html">$capabilities</a> = ${<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>.'_capabilities'};
<a name="l2520"><span class="linenum">2520</span></a>          }
<a name="l2521"><span class="linenum">2521</span></a>      }
<a name="l2522"><span class="linenum">2522</span></a>  
<a name="l2523"><span class="linenum">2523</span></a>      return <a class="var it497" onMouseOver="hilite(497)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../_variables/capabilities.html">$capabilities</a>;
<a name="l2524"><span class="linenum">2524</span></a>  }
<a name="l2525"><span class="linenum">2525</span></a>  
<a name="l2526"><span class="linenum">2526</span></a>  <span class="comment">/**</span>
<a name="l2527"><span class="linenum">2527</span></a>  <span class="comment"> * Gets the capabilities that have been cached in the database for this component.</span>
<a name="l2528"><span class="linenum">2528</span></a>  <span class="comment"> *</span>
<a name="l2529"><span class="linenum">2529</span></a>  <span class="comment"> * @access private</span>
<a name="l2530"><span class="linenum">2530</span></a>  <span class="comment"> * @param string $component - examples: 'moodle', 'mod_forum'</span>
<a name="l2531"><span class="linenum">2531</span></a>  <span class="comment"> * @return array array of capabilities</span>
<a name="l2532"><span class="linenum">2532</span></a>  <span class="comment"> */</span>
<a name="l2533"><span class="linenum">2533</span></a>  function <a class="function" onClick="logFunction('get_cached_capabilities')" href="../_functions/get_cached_capabilities.html" onMouseOver="funcPopup(event,'get_cached_capabilities')">get_cached_capabilities</a>(<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a> = 'moodle') {
<a name="l2534"><span class="linenum">2534</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l2535"><span class="linenum">2535</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('capabilities', array('component'=&gt;<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>));
<a name="l2536"><span class="linenum">2536</span></a>  }
<a name="l2537"><span class="linenum">2537</span></a>  
<a name="l2538"><span class="linenum">2538</span></a>  <span class="comment">/**</span>
<a name="l2539"><span class="linenum">2539</span></a>  <span class="comment"> * Returns default capabilities for given role archetype.</span>
<a name="l2540"><span class="linenum">2540</span></a>  <span class="comment"> *</span>
<a name="l2541"><span class="linenum">2541</span></a>  <span class="comment"> * @param string $archetype role archetype</span>
<a name="l2542"><span class="linenum">2542</span></a>  <span class="comment"> * @return array</span>
<a name="l2543"><span class="linenum">2543</span></a>  <span class="comment"> */</span>
<a name="l2544"><span class="linenum">2544</span></a>  function <a class="function" onClick="logFunction('get_default_capabilities')" href="../_functions/get_default_capabilities.html" onMouseOver="funcPopup(event,'get_default_capabilities')">get_default_capabilities</a>(<a class="var it7279" onMouseOver="hilite(7279)" onMouseOut="lolite()" onClick="logVariable('archetype')" href="../_variables/archetype.html">$archetype</a>) {
<a name="l2545"><span class="linenum">2545</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l2546"><span class="linenum">2546</span></a>  
<a name="l2547"><span class="linenum">2547</span></a>      if (!<a class="var it7279" onMouseOver="hilite(7279)" onMouseOut="lolite()" onClick="logVariable('archetype')" href="../_variables/archetype.html">$archetype</a>) {
<a name="l2548"><span class="linenum">2548</span></a>          return array();
<a name="l2549"><span class="linenum">2549</span></a>      }
<a name="l2550"><span class="linenum">2550</span></a>  
<a name="l2551"><span class="linenum">2551</span></a>      <a class="var it28826" onMouseOver="hilite(28826)" onMouseOut="lolite()" onClick="logVariable('alldefs')" href="../_variables/alldefs.html">$alldefs</a> = array();
<a name="l2552"><span class="linenum">2552</span></a>      <a class="var it2243" onMouseOver="hilite(2243)" onMouseOut="lolite()" onClick="logVariable('defaults')" href="../_variables/defaults.html">$defaults</a> = array();
<a name="l2553"><span class="linenum">2553</span></a>      <a class="var it3408" onMouseOver="hilite(3408)" onMouseOut="lolite()" onClick="logVariable('components')" href="../_variables/components.html">$components</a> = array();
<a name="l2554"><span class="linenum">2554</span></a>      <a class="var it28827" onMouseOver="hilite(28827)" onMouseOut="lolite()" onClick="logVariable('allcaps')" href="../_variables/allcaps.html">$allcaps</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('capabilities');
<a name="l2555"><span class="linenum">2555</span></a>  
<a name="l2556"><span class="linenum">2556</span></a>      foreach (<a class="var it28827" onMouseOver="hilite(28827)" onMouseOut="lolite()" onClick="logVariable('allcaps')" href="../_variables/allcaps.html">$allcaps</a> as <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>) {
<a name="l2557"><span class="linenum">2557</span></a>          if (!<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>-&gt;<a onClick="logVariable('component')" class="var it40429" onMouseOver="hilite(40429)" onMouseOut="lolite()" href="../_variables/component.html">component</a>, <a class="var it3408" onMouseOver="hilite(3408)" onMouseOut="lolite()" onClick="logVariable('components')" href="../_variables/components.html">$components</a>)) {
<a name="l2558"><span class="linenum">2558</span></a>              <a class="var it3408" onMouseOver="hilite(3408)" onMouseOut="lolite()" onClick="logVariable('components')" href="../_variables/components.html">$components</a>[] = <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>-&gt;<a onClick="logVariable('component')" class="var it40429" onMouseOver="hilite(40429)" onMouseOut="lolite()" href="../_variables/component.html">component</a>;
<a name="l2559"><span class="linenum">2559</span></a>              <a class="var it28826" onMouseOver="hilite(28826)" onMouseOut="lolite()" onClick="logVariable('alldefs')" href="../_variables/alldefs.html">$alldefs</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it28826" onMouseOver="hilite(28826)" onMouseOut="lolite()" onClick="logVariable('alldefs')" href="../_variables/alldefs.html">$alldefs</a>, <a class="function" onClick="logFunction('load_capability_def')" href="../_functions/load_capability_def.html" onMouseOver="funcPopup(event,'load_capability_def')">load_capability_def</a>(<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>-&gt;<a onClick="logVariable('component')" class="var it40429" onMouseOver="hilite(40429)" onMouseOut="lolite()" href="../_variables/component.html">component</a>));
<a name="l2560"><span class="linenum">2560</span></a>          }
<a name="l2561"><span class="linenum">2561</span></a>      }
<a name="l2562"><span class="linenum">2562</span></a>      foreach(<a class="var it28826" onMouseOver="hilite(28826)" onMouseOut="lolite()" onClick="logVariable('alldefs')" href="../_variables/alldefs.html">$alldefs</a> as <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>=&gt;<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('def')" href="../_variables/def.html">$def</a>) {
<a name="l2563"><span class="linenum">2563</span></a>  <span class="comment">        // Use array 'archetypes if available. Only if not specified, use 'legacy'.</span>
<a name="l2564"><span class="linenum">2564</span></a>          if (isset(<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('def')" href="../_variables/def.html">$def</a>['archetypes'])) {
<a name="l2565"><span class="linenum">2565</span></a>              if (isset(<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('def')" href="../_variables/def.html">$def</a>['archetypes'][<a class="var it7279" onMouseOver="hilite(7279)" onMouseOut="lolite()" onClick="logVariable('archetype')" href="../_variables/archetype.html">$archetype</a>])) {
<a name="l2566"><span class="linenum">2566</span></a>                  <a class="var it2243" onMouseOver="hilite(2243)" onMouseOut="lolite()" onClick="logVariable('defaults')" href="../_variables/defaults.html">$defaults</a>[<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>] = <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('def')" href="../_variables/def.html">$def</a>['archetypes'][<a class="var it7279" onMouseOver="hilite(7279)" onMouseOut="lolite()" onClick="logVariable('archetype')" href="../_variables/archetype.html">$archetype</a>];
<a name="l2567"><span class="linenum">2567</span></a>              }
<a name="l2568"><span class="linenum">2568</span></a>  <span class="comment">        // 'legacy' is for backward compatibility with 1.9 access.php</span>
<a name="l2569"><span class="linenum">2569</span></a>          } else {
<a name="l2570"><span class="linenum">2570</span></a>              if (isset(<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('def')" href="../_variables/def.html">$def</a>['legacy'][<a class="var it7279" onMouseOver="hilite(7279)" onMouseOut="lolite()" onClick="logVariable('archetype')" href="../_variables/archetype.html">$archetype</a>])) {
<a name="l2571"><span class="linenum">2571</span></a>                  <a class="var it2243" onMouseOver="hilite(2243)" onMouseOut="lolite()" onClick="logVariable('defaults')" href="../_variables/defaults.html">$defaults</a>[<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>] = <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('def')" href="../_variables/def.html">$def</a>['legacy'][<a class="var it7279" onMouseOver="hilite(7279)" onMouseOut="lolite()" onClick="logVariable('archetype')" href="../_variables/archetype.html">$archetype</a>];
<a name="l2572"><span class="linenum">2572</span></a>              }
<a name="l2573"><span class="linenum">2573</span></a>          }
<a name="l2574"><span class="linenum">2574</span></a>      }
<a name="l2575"><span class="linenum">2575</span></a>  
<a name="l2576"><span class="linenum">2576</span></a>      return <a class="var it2243" onMouseOver="hilite(2243)" onMouseOut="lolite()" onClick="logVariable('defaults')" href="../_variables/defaults.html">$defaults</a>;
<a name="l2577"><span class="linenum">2577</span></a>  }
<a name="l2578"><span class="linenum">2578</span></a>  
<a name="l2579"><span class="linenum">2579</span></a>  <span class="comment">/**</span>
<a name="l2580"><span class="linenum">2580</span></a>  <span class="comment"> * Return default roles that can be assigned, overridden or switched</span>
<a name="l2581"><span class="linenum">2581</span></a>  <span class="comment"> * by give role archetype.</span>
<a name="l2582"><span class="linenum">2582</span></a>  <span class="comment"> *</span>
<a name="l2583"><span class="linenum">2583</span></a>  <span class="comment"> * @param string $type  assign|override|switch</span>
<a name="l2584"><span class="linenum">2584</span></a>  <span class="comment"> * @param string $archetype</span>
<a name="l2585"><span class="linenum">2585</span></a>  <span class="comment"> * @return array of role ids</span>
<a name="l2586"><span class="linenum">2586</span></a>  <span class="comment"> */</span>
<a name="l2587"><span class="linenum">2587</span></a>  function <a class="function" onClick="logFunction('get_default_role_archetype_allows')" href="../_functions/get_default_role_archetype_allows.html" onMouseOver="funcPopup(event,'get_default_role_archetype_allows')">get_default_role_archetype_allows</a>(<a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>, <a class="var it7279" onMouseOver="hilite(7279)" onMouseOut="lolite()" onClick="logVariable('archetype')" href="../_variables/archetype.html">$archetype</a>) {
<a name="l2588"><span class="linenum">2588</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l2589"><span class="linenum">2589</span></a>  
<a name="l2590"><span class="linenum">2590</span></a>      if (empty(<a class="var it7279" onMouseOver="hilite(7279)" onMouseOut="lolite()" onClick="logVariable('archetype')" href="../_variables/archetype.html">$archetype</a>)) {
<a name="l2591"><span class="linenum">2591</span></a>          return array();
<a name="l2592"><span class="linenum">2592</span></a>      }
<a name="l2593"><span class="linenum">2593</span></a>  
<a name="l2594"><span class="linenum">2594</span></a>      <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('role');
<a name="l2595"><span class="linenum">2595</span></a>      <a class="var it28828" onMouseOver="hilite(28828)" onMouseOut="lolite()" onClick="logVariable('archetypemap')" href="../_variables/archetypemap.html">$archetypemap</a> = array();
<a name="l2596"><span class="linenum">2596</span></a>      foreach (<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a> as <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>) {
<a name="l2597"><span class="linenum">2597</span></a>          if (<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('archetype')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/archetype.html">archetype</a>) {
<a name="l2598"><span class="linenum">2598</span></a>              <a class="var it28828" onMouseOver="hilite(28828)" onMouseOut="lolite()" onClick="logVariable('archetypemap')" href="../_variables/archetypemap.html">$archetypemap</a>[<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('archetype')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/archetype.html">archetype</a>][<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('id')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('id')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l2599"><span class="linenum">2599</span></a>          }
<a name="l2600"><span class="linenum">2600</span></a>      }
<a name="l2601"><span class="linenum">2601</span></a>  
<a name="l2602"><span class="linenum">2602</span></a>      <a class="var it2243" onMouseOver="hilite(2243)" onMouseOut="lolite()" onClick="logVariable('defaults')" href="../_variables/defaults.html">$defaults</a> = array(
<a name="l2603"><span class="linenum">2603</span></a>          'assign' =&gt; array(
<a name="l2604"><span class="linenum">2604</span></a>              'manager'        =&gt; array('manager', 'coursecreator', 'editingteacher', 'teacher', 'student'),
<a name="l2605"><span class="linenum">2605</span></a>              'coursecreator'  =&gt; array(),
<a name="l2606"><span class="linenum">2606</span></a>              'editingteacher' =&gt; array('teacher', 'student'),
<a name="l2607"><span class="linenum">2607</span></a>              'teacher'        =&gt; array(),
<a name="l2608"><span class="linenum">2608</span></a>              'student'        =&gt; array(),
<a name="l2609"><span class="linenum">2609</span></a>              'guest'          =&gt; array(),
<a name="l2610"><span class="linenum">2610</span></a>              'user'           =&gt; array(),
<a name="l2611"><span class="linenum">2611</span></a>              'frontpage'      =&gt; array(),
<a name="l2612"><span class="linenum">2612</span></a>          ),
<a name="l2613"><span class="linenum">2613</span></a>          'override' =&gt; array(
<a name="l2614"><span class="linenum">2614</span></a>              'manager'        =&gt; array('manager', 'coursecreator', 'editingteacher', 'teacher', 'student', 'guest', 'user', 'frontpage'),
<a name="l2615"><span class="linenum">2615</span></a>              'coursecreator'  =&gt; array(),
<a name="l2616"><span class="linenum">2616</span></a>              'editingteacher' =&gt; array('teacher', 'student', 'guest'),
<a name="l2617"><span class="linenum">2617</span></a>              'teacher'        =&gt; array(),
<a name="l2618"><span class="linenum">2618</span></a>              'student'        =&gt; array(),
<a name="l2619"><span class="linenum">2619</span></a>              'guest'          =&gt; array(),
<a name="l2620"><span class="linenum">2620</span></a>              'user'           =&gt; array(),
<a name="l2621"><span class="linenum">2621</span></a>              'frontpage'      =&gt; array(),
<a name="l2622"><span class="linenum">2622</span></a>          ),
<a name="l2623"><span class="linenum">2623</span></a>          'switch' =&gt; array(
<a name="l2624"><span class="linenum">2624</span></a>              'manager'        =&gt; array('editingteacher', 'teacher', 'student', 'guest'),
<a name="l2625"><span class="linenum">2625</span></a>              'coursecreator'  =&gt; array(),
<a name="l2626"><span class="linenum">2626</span></a>              'editingteacher' =&gt; array('teacher', 'student', 'guest'),
<a name="l2627"><span class="linenum">2627</span></a>              'teacher'        =&gt; array('student', 'guest'),
<a name="l2628"><span class="linenum">2628</span></a>              'student'        =&gt; array(),
<a name="l2629"><span class="linenum">2629</span></a>              'guest'          =&gt; array(),
<a name="l2630"><span class="linenum">2630</span></a>              'user'           =&gt; array(),
<a name="l2631"><span class="linenum">2631</span></a>              'frontpage'      =&gt; array(),
<a name="l2632"><span class="linenum">2632</span></a>          ),
<a name="l2633"><span class="linenum">2633</span></a>      );
<a name="l2634"><span class="linenum">2634</span></a>  
<a name="l2635"><span class="linenum">2635</span></a>      if (!isset(<a class="var it2243" onMouseOver="hilite(2243)" onMouseOut="lolite()" onClick="logVariable('defaults')" href="../_variables/defaults.html">$defaults</a>[<a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>][<a class="var it7279" onMouseOver="hilite(7279)" onMouseOut="lolite()" onClick="logVariable('archetype')" href="../_variables/archetype.html">$archetype</a>])) {
<a name="l2636"><span class="linenum">2636</span></a>          <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>(&quot;Unknown type '<a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>'' or archetype '<a class="var it7279" onMouseOver="hilite(7279)" onMouseOut="lolite()" onClick="logVariable('archetype')" href="../_variables/archetype.html">$archetype</a>''&quot;);
<a name="l2637"><span class="linenum">2637</span></a>          return array();
<a name="l2638"><span class="linenum">2638</span></a>      }
<a name="l2639"><span class="linenum">2639</span></a>  
<a name="l2640"><span class="linenum">2640</span></a>      <a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../_variables/return.html">$return</a> = array();
<a name="l2641"><span class="linenum">2641</span></a>      foreach (<a class="var it2243" onMouseOver="hilite(2243)" onMouseOut="lolite()" onClick="logVariable('defaults')" href="../_variables/defaults.html">$defaults</a>[<a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>][<a class="var it7279" onMouseOver="hilite(7279)" onMouseOut="lolite()" onClick="logVariable('archetype')" href="../_variables/archetype.html">$archetype</a>] as <a class="var it5343" onMouseOver="hilite(5343)" onMouseOut="lolite()" onClick="logVariable('at')" href="../_variables/at.html">$at</a>) {
<a name="l2642"><span class="linenum">2642</span></a>          if (isset(<a class="var it28828" onMouseOver="hilite(28828)" onMouseOut="lolite()" onClick="logVariable('archetypemap')" href="../_variables/archetypemap.html">$archetypemap</a>[<a class="var it5343" onMouseOver="hilite(5343)" onMouseOut="lolite()" onClick="logVariable('at')" href="../_variables/at.html">$at</a>])) {
<a name="l2643"><span class="linenum">2643</span></a>              foreach (<a class="var it28828" onMouseOver="hilite(28828)" onMouseOut="lolite()" onClick="logVariable('archetypemap')" href="../_variables/archetypemap.html">$archetypemap</a>[<a class="var it5343" onMouseOver="hilite(5343)" onMouseOut="lolite()" onClick="logVariable('at')" href="../_variables/at.html">$at</a>] as <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>) {
<a name="l2644"><span class="linenum">2644</span></a>                  <a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../_variables/return.html">$return</a>[<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>] = <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>;
<a name="l2645"><span class="linenum">2645</span></a>              }
<a name="l2646"><span class="linenum">2646</span></a>          }
<a name="l2647"><span class="linenum">2647</span></a>      }
<a name="l2648"><span class="linenum">2648</span></a>  
<a name="l2649"><span class="linenum">2649</span></a>      return <a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../_variables/return.html">$return</a>;
<a name="l2650"><span class="linenum">2650</span></a>  }
<a name="l2651"><span class="linenum">2651</span></a>  
<a name="l2652"><span class="linenum">2652</span></a>  <span class="comment">/**</span>
<a name="l2653"><span class="linenum">2653</span></a>  <span class="comment"> * Reset role capabilities to default according to selected role archetype.</span>
<a name="l2654"><span class="linenum">2654</span></a>  <span class="comment"> * If no archetype selected, removes all capabilities.</span>
<a name="l2655"><span class="linenum">2655</span></a>  <span class="comment"> *</span>
<a name="l2656"><span class="linenum">2656</span></a>  <span class="comment"> * This applies to capabilities that are assigned to the role (that you could</span>
<a name="l2657"><span class="linenum">2657</span></a>  <span class="comment"> * edit in the 'define roles' interface), and not to any capability overrides</span>
<a name="l2658"><span class="linenum">2658</span></a>  <span class="comment"> * in different locations.</span>
<a name="l2659"><span class="linenum">2659</span></a>  <span class="comment"> *</span>
<a name="l2660"><span class="linenum">2660</span></a>  <span class="comment"> * @param int $roleid ID of role to reset capabilities for</span>
<a name="l2661"><span class="linenum">2661</span></a>  <span class="comment"> */</span>
<a name="l2662"><span class="linenum">2662</span></a>  function <a class="function" onClick="logFunction('reset_role_capabilities')" href="../_functions/reset_role_capabilities.html" onMouseOver="funcPopup(event,'reset_role_capabilities')">reset_role_capabilities</a>(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>) {
<a name="l2663"><span class="linenum">2663</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l2664"><span class="linenum">2664</span></a>  
<a name="l2665"><span class="linenum">2665</span></a>      <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('role', array('id'=&gt;<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l2666"><span class="linenum">2666</span></a>      <a class="var it28829" onMouseOver="hilite(28829)" onMouseOut="lolite()" onClick="logVariable('defaultcaps')" href="../_variables/defaultcaps.html">$defaultcaps</a> = <a class="function" onClick="logFunction('get_default_capabilities')" href="../_functions/get_default_capabilities.html" onMouseOver="funcPopup(event,'get_default_capabilities')">get_default_capabilities</a>(<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('archetype')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/archetype.html">archetype</a>);
<a name="l2667"><span class="linenum">2667</span></a>  
<a name="l2668"><span class="linenum">2668</span></a>      <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('systemcontext')" href="../_variables/systemcontext.html">$systemcontext</a> = <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l2669"><span class="linenum">2669</span></a>  
<a name="l2670"><span class="linenum">2670</span></a>      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('role_capabilities',
<a name="l2671"><span class="linenum">2671</span></a>              array('roleid' =&gt; <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, 'contextid' =&gt; <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('systemcontext')" href="../_variables/systemcontext.html">$systemcontext</a>-&gt;<a onClick="logVariable('id')" class="var it39845" onMouseOver="hilite(39845)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l2672"><span class="linenum">2672</span></a>  
<a name="l2673"><span class="linenum">2673</span></a>      foreach(<a class="var it28829" onMouseOver="hilite(28829)" onMouseOut="lolite()" onClick="logVariable('defaultcaps')" href="../_variables/defaultcaps.html">$defaultcaps</a> as <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>=&gt;<a class="var it3735" onMouseOver="hilite(3735)" onMouseOut="lolite()" onClick="logVariable('permission')" href="../_variables/permission.html">$permission</a>) {
<a name="l2674"><span class="linenum">2674</span></a>          <a class="function" onClick="logFunction('assign_capability')" href="../_functions/assign_capability.html" onMouseOver="funcPopup(event,'assign_capability')">assign_capability</a>(<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>, <a class="var it3735" onMouseOver="hilite(3735)" onMouseOut="lolite()" onClick="logVariable('permission')" href="../_variables/permission.html">$permission</a>, <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('systemcontext')" href="../_variables/systemcontext.html">$systemcontext</a>-&gt;<a onClick="logVariable('id')" class="var it39845" onMouseOver="hilite(39845)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l2675"><span class="linenum">2675</span></a>      }
<a name="l2676"><span class="linenum">2676</span></a>  
<a name="l2677"><span class="linenum">2677</span></a>  <span class="comment">    // Mark the system context dirty.</span>
<a name="l2678"><span class="linenum">2678</span></a>      <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>()-&gt;<a class="function" onClick="logFunction('mark_dirty')" href="../_functions/mark_dirty.html" onMouseOver="funcPopup(event,'mark_dirty')">mark_dirty</a>();
<a name="l2679"><span class="linenum">2679</span></a>  }
<a name="l2680"><span class="linenum">2680</span></a>  
<a name="l2681"><span class="linenum">2681</span></a>  <span class="comment">/**</span>
<a name="l2682"><span class="linenum">2682</span></a>  <span class="comment"> * Updates the capabilities table with the component capability definitions.</span>
<a name="l2683"><span class="linenum">2683</span></a>  <span class="comment"> * If no parameters are given, the function updates the core moodle</span>
<a name="l2684"><span class="linenum">2684</span></a>  <span class="comment"> * capabilities.</span>
<a name="l2685"><span class="linenum">2685</span></a>  <span class="comment"> *</span>
<a name="l2686"><span class="linenum">2686</span></a>  <span class="comment"> * Note that the absence of the db/access.php capabilities definition file</span>
<a name="l2687"><span class="linenum">2687</span></a>  <span class="comment"> * will cause any stored capabilities for the component to be removed from</span>
<a name="l2688"><span class="linenum">2688</span></a>  <span class="comment"> * the database.</span>
<a name="l2689"><span class="linenum">2689</span></a>  <span class="comment"> *</span>
<a name="l2690"><span class="linenum">2690</span></a>  <span class="comment"> * @access private</span>
<a name="l2691"><span class="linenum">2691</span></a>  <span class="comment"> * @param string $component examples: 'moodle', 'mod/forum', 'block/quiz_results'</span>
<a name="l2692"><span class="linenum">2692</span></a>  <span class="comment"> * @return boolean true if success, exception in case of any problems</span>
<a name="l2693"><span class="linenum">2693</span></a>  <span class="comment"> */</span>
<a name="l2694"><span class="linenum">2694</span></a>  function <a class="function" onClick="logFunction('update_capabilities')" href="../_functions/update_capabilities.html" onMouseOver="funcPopup(event,'update_capabilities')">update_capabilities</a>(<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a> = 'moodle') {
<a name="l2695"><span class="linenum">2695</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l2696"><span class="linenum">2696</span></a>  
<a name="l2697"><span class="linenum">2697</span></a>      <a class="var it28830" onMouseOver="hilite(28830)" onMouseOut="lolite()" onClick="logVariable('storedcaps')" href="../_variables/storedcaps.html">$storedcaps</a> = array();
<a name="l2698"><span class="linenum">2698</span></a>  
<a name="l2699"><span class="linenum">2699</span></a>      <a class="var it28831" onMouseOver="hilite(28831)" onMouseOut="lolite()" onClick="logVariable('filecaps')" href="../_variables/filecaps.html">$filecaps</a> = <a class="function" onClick="logFunction('load_capability_def')" href="../_functions/load_capability_def.html" onMouseOver="funcPopup(event,'load_capability_def')">load_capability_def</a>(<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>);
<a name="l2700"><span class="linenum">2700</span></a>      foreach(<a class="var it28831" onMouseOver="hilite(28831)" onMouseOut="lolite()" onClick="logVariable('filecaps')" href="../_variables/filecaps.html">$filecaps</a> as <a class="var it23190" onMouseOver="hilite(23190)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../_variables/capname.html">$capname</a>=&gt;<a class="var it1136" onMouseOver="hilite(1136)" onMouseOut="lolite()" onClick="logVariable('unused')" href="../_variables/unused.html">$unused</a>) {
<a name="l2701"><span class="linenum">2701</span></a>          if (!<a class="phpfunction" onClick="logFunction('preg_match')" href="../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('|^[a-z]+/[a-z_0-9]+:[a-z_0-9]+$|', <a class="var it23190" onMouseOver="hilite(23190)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../_variables/capname.html">$capname</a>)) {
<a name="l2702"><span class="linenum">2702</span></a>              <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>(&quot;Coding problem: Invalid capability name '<a class="var it23190" onMouseOver="hilite(23190)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../_variables/capname.html">$capname</a>', use 'clonepermissionsfrom' field for migration.&quot;);
<a name="l2703"><span class="linenum">2703</span></a>          }
<a name="l2704"><span class="linenum">2704</span></a>      }
<a name="l2705"><span class="linenum">2705</span></a>  
<a name="l2706"><span class="linenum">2706</span></a>      <a class="var it28832" onMouseOver="hilite(28832)" onMouseOut="lolite()" onClick="logVariable('cachedcaps')" href="../_variables/cachedcaps.html">$cachedcaps</a> = <a class="function" onClick="logFunction('get_cached_capabilities')" href="../_functions/get_cached_capabilities.html" onMouseOver="funcPopup(event,'get_cached_capabilities')">get_cached_capabilities</a>(<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>);
<a name="l2707"><span class="linenum">2707</span></a>      if (<a class="var it28832" onMouseOver="hilite(28832)" onMouseOut="lolite()" onClick="logVariable('cachedcaps')" href="../_variables/cachedcaps.html">$cachedcaps</a>) {
<a name="l2708"><span class="linenum">2708</span></a>          foreach (<a class="var it28832" onMouseOver="hilite(28832)" onMouseOut="lolite()" onClick="logVariable('cachedcaps')" href="../_variables/cachedcaps.html">$cachedcaps</a> as <a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>) {
<a name="l2709"><span class="linenum">2709</span></a>              <a class="phpfunction" onClick="logFunction('array_push')" href="../_functions/array_push.html" onMouseOver="phpfuncPopup(event,'array_push')">array_push</a>(<a class="var it28830" onMouseOver="hilite(28830)" onMouseOut="lolite()" onClick="logVariable('storedcaps')" href="../_variables/storedcaps.html">$storedcaps</a>, <a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>-&gt;<a onClick="logVariable('name')" class="var it40981" onMouseOver="hilite(40981)" onMouseOut="lolite()" href="../_variables/name.html">name</a>);
<a name="l2710"><span class="linenum">2710</span></a>  <span class="comment">            // update risk bitmasks and context levels in existing capabilities if needed</span>
<a name="l2711"><span class="linenum">2711</span></a>              if (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>-&gt;<a onClick="logVariable('name')" class="var it40981" onMouseOver="hilite(40981)" onMouseOut="lolite()" href="../_variables/name.html">name</a>, <a class="var it28831" onMouseOver="hilite(28831)" onMouseOut="lolite()" onClick="logVariable('filecaps')" href="../_variables/filecaps.html">$filecaps</a>)) {
<a name="l2712"><span class="linenum">2712</span></a>                  if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>('riskbitmask', <a class="var it28831" onMouseOver="hilite(28831)" onMouseOut="lolite()" onClick="logVariable('filecaps')" href="../_variables/filecaps.html">$filecaps</a>[<a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>-&gt;<a onClick="logVariable('name')" class="var it40981" onMouseOver="hilite(40981)" onMouseOut="lolite()" href="../_variables/name.html">name</a>])) {
<a name="l2713"><span class="linenum">2713</span></a>                      <a class="var it28831" onMouseOver="hilite(28831)" onMouseOut="lolite()" onClick="logVariable('filecaps')" href="../_variables/filecaps.html">$filecaps</a>[<a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>-&gt;<a onClick="logVariable('name')" class="var it40981" onMouseOver="hilite(40981)" onMouseOut="lolite()" href="../_variables/name.html">name</a>]['riskbitmask'] = 0; <span class="comment">// no risk if not specified</span>
<a name="l2714"><span class="linenum">2714</span></a>                  }
<a name="l2715"><span class="linenum">2715</span></a>                  if (<a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>-&gt;<a onClick="logVariable('captype')" class="var it40981" onMouseOver="hilite(40981)" onMouseOut="lolite()" href="../_variables/captype.html">captype</a> != <a class="var it28831" onMouseOver="hilite(28831)" onMouseOut="lolite()" onClick="logVariable('filecaps')" href="../_variables/filecaps.html">$filecaps</a>[<a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>-&gt;<a onClick="logVariable('name')" class="var it40981" onMouseOver="hilite(40981)" onMouseOut="lolite()" href="../_variables/name.html">name</a>]['captype']) {
<a name="l2716"><span class="linenum">2716</span></a>                      <a class="var it28834" onMouseOver="hilite(28834)" onMouseOut="lolite()" onClick="logVariable('updatecap')" href="../_variables/updatecap.html">$updatecap</a> = new stdClass();
<a name="l2717"><span class="linenum">2717</span></a>                      <a class="var it28834" onMouseOver="hilite(28834)" onMouseOut="lolite()" onClick="logVariable('updatecap')" href="../_variables/updatecap.html">$updatecap</a>-&gt;<a onClick="logVariable('id')" class="var it40982" onMouseOver="hilite(40982)" onMouseOut="lolite()" href="../_variables/id.html">id</a> = <a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>-&gt;<a onClick="logVariable('id')" class="var it40981" onMouseOver="hilite(40981)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l2718"><span class="linenum">2718</span></a>                      <a class="var it28834" onMouseOver="hilite(28834)" onMouseOut="lolite()" onClick="logVariable('updatecap')" href="../_variables/updatecap.html">$updatecap</a>-&gt;<a onClick="logVariable('captype')" class="var it40982" onMouseOver="hilite(40982)" onMouseOut="lolite()" href="../_variables/captype.html">captype</a> = <a class="var it28831" onMouseOver="hilite(28831)" onMouseOut="lolite()" onClick="logVariable('filecaps')" href="../_variables/filecaps.html">$filecaps</a>[<a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>-&gt;<a onClick="logVariable('name')" class="var it40981" onMouseOver="hilite(40981)" onMouseOut="lolite()" href="../_variables/name.html">name</a>]['captype'];
<a name="l2719"><span class="linenum">2719</span></a>                      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('capabilities', <a class="var it28834" onMouseOver="hilite(28834)" onMouseOut="lolite()" onClick="logVariable('updatecap')" href="../_variables/updatecap.html">$updatecap</a>);
<a name="l2720"><span class="linenum">2720</span></a>                  }
<a name="l2721"><span class="linenum">2721</span></a>                  if (<a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>-&gt;<a onClick="logVariable('riskbitmask')" class="var it40981" onMouseOver="hilite(40981)" onMouseOut="lolite()" href="../_variables/riskbitmask.html">riskbitmask</a> != <a class="var it28831" onMouseOver="hilite(28831)" onMouseOut="lolite()" onClick="logVariable('filecaps')" href="../_variables/filecaps.html">$filecaps</a>[<a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>-&gt;<a onClick="logVariable('name')" class="var it40981" onMouseOver="hilite(40981)" onMouseOut="lolite()" href="../_variables/name.html">name</a>]['riskbitmask']) {
<a name="l2722"><span class="linenum">2722</span></a>                      <a class="var it28834" onMouseOver="hilite(28834)" onMouseOut="lolite()" onClick="logVariable('updatecap')" href="../_variables/updatecap.html">$updatecap</a> = new stdClass();
<a name="l2723"><span class="linenum">2723</span></a>                      <a class="var it28834" onMouseOver="hilite(28834)" onMouseOut="lolite()" onClick="logVariable('updatecap')" href="../_variables/updatecap.html">$updatecap</a>-&gt;<a onClick="logVariable('id')" class="var it40982" onMouseOver="hilite(40982)" onMouseOut="lolite()" href="../_variables/id.html">id</a> = <a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>-&gt;<a onClick="logVariable('id')" class="var it40981" onMouseOver="hilite(40981)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l2724"><span class="linenum">2724</span></a>                      <a class="var it28834" onMouseOver="hilite(28834)" onMouseOut="lolite()" onClick="logVariable('updatecap')" href="../_variables/updatecap.html">$updatecap</a>-&gt;<a onClick="logVariable('riskbitmask')" class="var it40982" onMouseOver="hilite(40982)" onMouseOut="lolite()" href="../_variables/riskbitmask.html">riskbitmask</a> = <a class="var it28831" onMouseOver="hilite(28831)" onMouseOut="lolite()" onClick="logVariable('filecaps')" href="../_variables/filecaps.html">$filecaps</a>[<a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>-&gt;<a onClick="logVariable('name')" class="var it40981" onMouseOver="hilite(40981)" onMouseOut="lolite()" href="../_variables/name.html">name</a>]['riskbitmask'];
<a name="l2725"><span class="linenum">2725</span></a>                      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('capabilities', <a class="var it28834" onMouseOver="hilite(28834)" onMouseOut="lolite()" onClick="logVariable('updatecap')" href="../_variables/updatecap.html">$updatecap</a>);
<a name="l2726"><span class="linenum">2726</span></a>                  }
<a name="l2727"><span class="linenum">2727</span></a>  
<a name="l2728"><span class="linenum">2728</span></a>                  if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>('contextlevel', <a class="var it28831" onMouseOver="hilite(28831)" onMouseOut="lolite()" onClick="logVariable('filecaps')" href="../_variables/filecaps.html">$filecaps</a>[<a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>-&gt;<a onClick="logVariable('name')" class="var it40981" onMouseOver="hilite(40981)" onMouseOut="lolite()" href="../_variables/name.html">name</a>])) {
<a name="l2729"><span class="linenum">2729</span></a>                      <a class="var it28831" onMouseOver="hilite(28831)" onMouseOut="lolite()" onClick="logVariable('filecaps')" href="../_variables/filecaps.html">$filecaps</a>[<a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>-&gt;<a onClick="logVariable('name')" class="var it40981" onMouseOver="hilite(40981)" onMouseOut="lolite()" href="../_variables/name.html">name</a>]['contextlevel'] = 0; <span class="comment">// no context level defined</span>
<a name="l2730"><span class="linenum">2730</span></a>                  }
<a name="l2731"><span class="linenum">2731</span></a>                  if (<a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it40981" onMouseOver="hilite(40981)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> != <a class="var it28831" onMouseOver="hilite(28831)" onMouseOut="lolite()" onClick="logVariable('filecaps')" href="../_variables/filecaps.html">$filecaps</a>[<a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>-&gt;<a onClick="logVariable('name')" class="var it40981" onMouseOver="hilite(40981)" onMouseOut="lolite()" href="../_variables/name.html">name</a>]['contextlevel']) {
<a name="l2732"><span class="linenum">2732</span></a>                      <a class="var it28834" onMouseOver="hilite(28834)" onMouseOut="lolite()" onClick="logVariable('updatecap')" href="../_variables/updatecap.html">$updatecap</a> = new stdClass();
<a name="l2733"><span class="linenum">2733</span></a>                      <a class="var it28834" onMouseOver="hilite(28834)" onMouseOut="lolite()" onClick="logVariable('updatecap')" href="../_variables/updatecap.html">$updatecap</a>-&gt;<a onClick="logVariable('id')" class="var it40982" onMouseOver="hilite(40982)" onMouseOut="lolite()" href="../_variables/id.html">id</a> = <a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>-&gt;<a onClick="logVariable('id')" class="var it40981" onMouseOver="hilite(40981)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l2734"><span class="linenum">2734</span></a>                      <a class="var it28834" onMouseOver="hilite(28834)" onMouseOut="lolite()" onClick="logVariable('updatecap')" href="../_variables/updatecap.html">$updatecap</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it40982" onMouseOver="hilite(40982)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> = <a class="var it28831" onMouseOver="hilite(28831)" onMouseOut="lolite()" onClick="logVariable('filecaps')" href="../_variables/filecaps.html">$filecaps</a>[<a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>-&gt;<a onClick="logVariable('name')" class="var it40981" onMouseOver="hilite(40981)" onMouseOut="lolite()" href="../_variables/name.html">name</a>]['contextlevel'];
<a name="l2735"><span class="linenum">2735</span></a>                      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('capabilities', <a class="var it28834" onMouseOver="hilite(28834)" onMouseOut="lolite()" onClick="logVariable('updatecap')" href="../_variables/updatecap.html">$updatecap</a>);
<a name="l2736"><span class="linenum">2736</span></a>                  }
<a name="l2737"><span class="linenum">2737</span></a>              }
<a name="l2738"><span class="linenum">2738</span></a>          }
<a name="l2739"><span class="linenum">2739</span></a>      }
<a name="l2740"><span class="linenum">2740</span></a>  
<a name="l2741"><span class="linenum">2741</span></a>  <span class="comment">    // Are there new capabilities in the file definition?</span>
<a name="l2742"><span class="linenum">2742</span></a>      <a class="var it28835" onMouseOver="hilite(28835)" onMouseOut="lolite()" onClick="logVariable('newcaps')" href="../_variables/newcaps.html">$newcaps</a> = array();
<a name="l2743"><span class="linenum">2743</span></a>  
<a name="l2744"><span class="linenum">2744</span></a>      foreach (<a class="var it28831" onMouseOver="hilite(28831)" onMouseOut="lolite()" onClick="logVariable('filecaps')" href="../_variables/filecaps.html">$filecaps</a> as <a class="var it28836" onMouseOver="hilite(28836)" onMouseOut="lolite()" onClick="logVariable('filecap')" href="../_variables/filecap.html">$filecap</a> =&gt; <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('def')" href="../_variables/def.html">$def</a>) {
<a name="l2745"><span class="linenum">2745</span></a>          if (!<a class="var it28830" onMouseOver="hilite(28830)" onMouseOut="lolite()" onClick="logVariable('storedcaps')" href="../_variables/storedcaps.html">$storedcaps</a> ||
<a name="l2746"><span class="linenum">2746</span></a>                  (<a class="var it28830" onMouseOver="hilite(28830)" onMouseOut="lolite()" onClick="logVariable('storedcaps')" href="../_variables/storedcaps.html">$storedcaps</a> &amp;&amp; <a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it28836" onMouseOver="hilite(28836)" onMouseOut="lolite()" onClick="logVariable('filecap')" href="../_variables/filecap.html">$filecap</a>, <a class="var it28830" onMouseOver="hilite(28830)" onMouseOut="lolite()" onClick="logVariable('storedcaps')" href="../_variables/storedcaps.html">$storedcaps</a>) === false)) {
<a name="l2747"><span class="linenum">2747</span></a>              if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>('riskbitmask', <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('def')" href="../_variables/def.html">$def</a>)) {
<a name="l2748"><span class="linenum">2748</span></a>                  <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('def')" href="../_variables/def.html">$def</a>['riskbitmask'] = 0; <span class="comment">// no risk if not specified</span>
<a name="l2749"><span class="linenum">2749</span></a>              }
<a name="l2750"><span class="linenum">2750</span></a>              <a class="var it28835" onMouseOver="hilite(28835)" onMouseOut="lolite()" onClick="logVariable('newcaps')" href="../_variables/newcaps.html">$newcaps</a>[<a class="var it28836" onMouseOver="hilite(28836)" onMouseOut="lolite()" onClick="logVariable('filecap')" href="../_variables/filecap.html">$filecap</a>] = <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('def')" href="../_variables/def.html">$def</a>;
<a name="l2751"><span class="linenum">2751</span></a>          }
<a name="l2752"><span class="linenum">2752</span></a>      }
<a name="l2753"><span class="linenum">2753</span></a>  <span class="comment">    // Add new capabilities to the stored definition.</span>
<a name="l2754"><span class="linenum">2754</span></a>      <a class="var it28837" onMouseOver="hilite(28837)" onMouseOut="lolite()" onClick="logVariable('existingcaps')" href="../_variables/existingcaps.html">$existingcaps</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_menu')" href="../_functions/get_records_menu.html" onMouseOver="funcPopup(event,'get_records_menu')">get_records_menu</a>('capabilities', array(), 'id', 'id, name');
<a name="l2755"><span class="linenum">2755</span></a>      foreach (<a class="var it28835" onMouseOver="hilite(28835)" onMouseOut="lolite()" onClick="logVariable('newcaps')" href="../_variables/newcaps.html">$newcaps</a> as <a class="var it23190" onMouseOver="hilite(23190)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../_variables/capname.html">$capname</a> =&gt; <a class="var it28838" onMouseOver="hilite(28838)" onMouseOut="lolite()" onClick="logVariable('capdef')" href="../_variables/capdef.html">$capdef</a>) {
<a name="l2756"><span class="linenum">2756</span></a>          <a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a> = new stdClass();
<a name="l2757"><span class="linenum">2757</span></a>          <a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>-&gt;<a onClick="logVariable('name')" class="var it40428" onMouseOver="hilite(40428)" onMouseOut="lolite()" href="../_variables/name.html">name</a>         = <a class="var it23190" onMouseOver="hilite(23190)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../_variables/capname.html">$capname</a>;
<a name="l2758"><span class="linenum">2758</span></a>          <a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>-&gt;<a onClick="logVariable('captype')" class="var it40428" onMouseOver="hilite(40428)" onMouseOut="lolite()" href="../_variables/captype.html">captype</a>      = <a class="var it28838" onMouseOver="hilite(28838)" onMouseOut="lolite()" onClick="logVariable('capdef')" href="../_variables/capdef.html">$capdef</a>['captype'];
<a name="l2759"><span class="linenum">2759</span></a>          <a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it40428" onMouseOver="hilite(40428)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> = <a class="var it28838" onMouseOver="hilite(28838)" onMouseOut="lolite()" onClick="logVariable('capdef')" href="../_variables/capdef.html">$capdef</a>['contextlevel'];
<a name="l2760"><span class="linenum">2760</span></a>          <a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>-&gt;<a onClick="logVariable('component')" class="var it40428" onMouseOver="hilite(40428)" onMouseOut="lolite()" href="../_variables/component.html">component</a>    = <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>;
<a name="l2761"><span class="linenum">2761</span></a>          <a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>-&gt;<a onClick="logVariable('riskbitmask')" class="var it40428" onMouseOver="hilite(40428)" onMouseOut="lolite()" href="../_variables/riskbitmask.html">riskbitmask</a>  = <a class="var it28838" onMouseOver="hilite(28838)" onMouseOut="lolite()" onClick="logVariable('capdef')" href="../_variables/capdef.html">$capdef</a>['riskbitmask'];
<a name="l2762"><span class="linenum">2762</span></a>  
<a name="l2763"><span class="linenum">2763</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('capabilities', <a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, false);
<a name="l2764"><span class="linenum">2764</span></a>  
<a name="l2765"><span class="linenum">2765</span></a>          if (isset(<a class="var it28838" onMouseOver="hilite(28838)" onMouseOut="lolite()" onClick="logVariable('capdef')" href="../_variables/capdef.html">$capdef</a>['clonepermissionsfrom']) &amp;&amp; <a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it28838" onMouseOver="hilite(28838)" onMouseOut="lolite()" onClick="logVariable('capdef')" href="../_variables/capdef.html">$capdef</a>['clonepermissionsfrom'], <a class="var it28837" onMouseOver="hilite(28837)" onMouseOut="lolite()" onClick="logVariable('existingcaps')" href="../_variables/existingcaps.html">$existingcaps</a>)){
<a name="l2766"><span class="linenum">2766</span></a>              if (<a class="var it28839" onMouseOver="hilite(28839)" onMouseOut="lolite()" onClick="logVariable('rolecapabilities')" href="../_variables/rolecapabilities.html">$rolecapabilities</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('role_capabilities', array('capability'=&gt;<a class="var it28838" onMouseOver="hilite(28838)" onMouseOut="lolite()" onClick="logVariable('capdef')" href="../_variables/capdef.html">$capdef</a>['clonepermissionsfrom']))){
<a name="l2767"><span class="linenum">2767</span></a>                  foreach (<a class="var it28839" onMouseOver="hilite(28839)" onMouseOut="lolite()" onClick="logVariable('rolecapabilities')" href="../_variables/rolecapabilities.html">$rolecapabilities</a> as <a class="var it28840" onMouseOver="hilite(28840)" onMouseOut="lolite()" onClick="logVariable('rolecapability')" href="../_variables/rolecapability.html">$rolecapability</a>){
<a name="l2768"><span class="linenum">2768</span></a>  <span class="comment">                    //assign_capability will update rather than insert if capability exists</span>
<a name="l2769"><span class="linenum">2769</span></a>                      if (!<a class="function" onClick="logFunction('assign_capability')" href="../_functions/assign_capability.html" onMouseOver="funcPopup(event,'assign_capability')">assign_capability</a>(<a class="var it23190" onMouseOver="hilite(23190)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../_variables/capname.html">$capname</a>, <a class="var it28840" onMouseOver="hilite(28840)" onMouseOut="lolite()" onClick="logVariable('rolecapability')" href="../_variables/rolecapability.html">$rolecapability</a>-&gt;<a onClick="logVariable('permission')" class="var it40983" onMouseOver="hilite(40983)" onMouseOut="lolite()" href="../_variables/permission.html">permission</a>,
<a name="l2770"><span class="linenum">2770</span></a>                                              <a class="var it28840" onMouseOver="hilite(28840)" onMouseOut="lolite()" onClick="logVariable('rolecapability')" href="../_variables/rolecapability.html">$rolecapability</a>-&gt;<a onClick="logVariable('roleid')" class="var it40983" onMouseOver="hilite(40983)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>, <a class="var it28840" onMouseOver="hilite(28840)" onMouseOut="lolite()" onClick="logVariable('rolecapability')" href="../_variables/rolecapability.html">$rolecapability</a>-&gt;<a onClick="logVariable('contextid')" class="var it40983" onMouseOver="hilite(40983)" onMouseOut="lolite()" href="../_variables/contextid.html">contextid</a>, true)){
<a name="l2771"><span class="linenum">2771</span></a>                           echo <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('notification')" href="../_functions/notification.html" onMouseOver="funcPopup(event,'notification')">notification</a>('Could not clone capabilities for '.<a class="var it23190" onMouseOver="hilite(23190)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../_variables/capname.html">$capname</a>);
<a name="l2772"><span class="linenum">2772</span></a>                      }
<a name="l2773"><span class="linenum">2773</span></a>                  }
<a name="l2774"><span class="linenum">2774</span></a>              }
<a name="l2775"><span class="linenum">2775</span></a>  <span class="comment">        // we ignore archetype key if we have cloned permissions</span>
<a name="l2776"><span class="linenum">2776</span></a>          } else if (isset(<a class="var it28838" onMouseOver="hilite(28838)" onMouseOut="lolite()" onClick="logVariable('capdef')" href="../_variables/capdef.html">$capdef</a>['archetypes']) &amp;&amp; <a class="phpfunction" onClick="logFunction('is_array')" href="../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it28838" onMouseOver="hilite(28838)" onMouseOut="lolite()" onClick="logVariable('capdef')" href="../_variables/capdef.html">$capdef</a>['archetypes'])) {
<a name="l2777"><span class="linenum">2777</span></a>              <a class="function" onClick="logFunction('assign_legacy_capabilities')" href="../_functions/assign_legacy_capabilities.html" onMouseOver="funcPopup(event,'assign_legacy_capabilities')">assign_legacy_capabilities</a>(<a class="var it23190" onMouseOver="hilite(23190)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../_variables/capname.html">$capname</a>, <a class="var it28838" onMouseOver="hilite(28838)" onMouseOut="lolite()" onClick="logVariable('capdef')" href="../_variables/capdef.html">$capdef</a>['archetypes']);
<a name="l2778"><span class="linenum">2778</span></a>  <span class="comment">        // 'legacy' is for backward compatibility with 1.9 access.php</span>
<a name="l2779"><span class="linenum">2779</span></a>          } else if (isset(<a class="var it28838" onMouseOver="hilite(28838)" onMouseOut="lolite()" onClick="logVariable('capdef')" href="../_variables/capdef.html">$capdef</a>['legacy']) &amp;&amp; <a class="phpfunction" onClick="logFunction('is_array')" href="../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it28838" onMouseOver="hilite(28838)" onMouseOut="lolite()" onClick="logVariable('capdef')" href="../_variables/capdef.html">$capdef</a>['legacy'])) {
<a name="l2780"><span class="linenum">2780</span></a>              <a class="function" onClick="logFunction('assign_legacy_capabilities')" href="../_functions/assign_legacy_capabilities.html" onMouseOver="funcPopup(event,'assign_legacy_capabilities')">assign_legacy_capabilities</a>(<a class="var it23190" onMouseOver="hilite(23190)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../_variables/capname.html">$capname</a>, <a class="var it28838" onMouseOver="hilite(28838)" onMouseOut="lolite()" onClick="logVariable('capdef')" href="../_variables/capdef.html">$capdef</a>['legacy']);
<a name="l2781"><span class="linenum">2781</span></a>          }
<a name="l2782"><span class="linenum">2782</span></a>      }
<a name="l2783"><span class="linenum">2783</span></a>  <span class="comment">    // Are there any capabilities that have been removed from the file</span>
<a name="l2784"><span class="linenum">2784</span></a>  <span class="comment">    // definition that we need to delete from the stored capabilities and</span>
<a name="l2785"><span class="linenum">2785</span></a>  <span class="comment">    // role assignments?</span>
<a name="l2786"><span class="linenum">2786</span></a>      <a class="function" onClick="logFunction('capabilities_cleanup')" href="../_functions/capabilities_cleanup.html" onMouseOver="funcPopup(event,'capabilities_cleanup')">capabilities_cleanup</a>(<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>, <a class="var it28831" onMouseOver="hilite(28831)" onMouseOut="lolite()" onClick="logVariable('filecaps')" href="../_variables/filecaps.html">$filecaps</a>);
<a name="l2787"><span class="linenum">2787</span></a>  
<a name="l2788"><span class="linenum">2788</span></a>  <span class="comment">    // reset static caches</span>
<a name="l2789"><span class="linenum">2789</span></a>      <a class="function" onClick="logFunction('accesslib_clear_all_caches')" href="../_functions/accesslib_clear_all_caches.html" onMouseOver="funcPopup(event,'accesslib_clear_all_caches')">accesslib_clear_all_caches</a>(false);
<a name="l2790"><span class="linenum">2790</span></a>  
<a name="l2791"><span class="linenum">2791</span></a>      return true;
<a name="l2792"><span class="linenum">2792</span></a>  }
<a name="l2793"><span class="linenum">2793</span></a>  
<a name="l2794"><span class="linenum">2794</span></a>  <span class="comment">/**</span>
<a name="l2795"><span class="linenum">2795</span></a>  <span class="comment"> * Deletes cached capabilities that are no longer needed by the component.</span>
<a name="l2796"><span class="linenum">2796</span></a>  <span class="comment"> * Also unassigns these capabilities from any roles that have them.</span>
<a name="l2797"><span class="linenum">2797</span></a>  <span class="comment"> * NOTE: this function is called from lib/db/upgrade.php</span>
<a name="l2798"><span class="linenum">2798</span></a>  <span class="comment"> *</span>
<a name="l2799"><span class="linenum">2799</span></a>  <span class="comment"> * @access private</span>
<a name="l2800"><span class="linenum">2800</span></a>  <span class="comment"> * @param string $component examples: 'moodle', 'mod_forum', 'block_quiz_results'</span>
<a name="l2801"><span class="linenum">2801</span></a>  <span class="comment"> * @param array $newcapdef array of the new capability definitions that will be</span>
<a name="l2802"><span class="linenum">2802</span></a>  <span class="comment"> *                     compared with the cached capabilities</span>
<a name="l2803"><span class="linenum">2803</span></a>  <span class="comment"> * @return int number of deprecated capabilities that have been removed</span>
<a name="l2804"><span class="linenum">2804</span></a>  <span class="comment"> */</span>
<a name="l2805"><span class="linenum">2805</span></a>  function <a class="function" onClick="logFunction('capabilities_cleanup')" href="../_functions/capabilities_cleanup.html" onMouseOver="funcPopup(event,'capabilities_cleanup')">capabilities_cleanup</a>(<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>, <a class="var it28841" onMouseOver="hilite(28841)" onMouseOut="lolite()" onClick="logVariable('newcapdef')" href="../_variables/newcapdef.html">$newcapdef</a> = null) {
<a name="l2806"><span class="linenum">2806</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l2807"><span class="linenum">2807</span></a>  
<a name="l2808"><span class="linenum">2808</span></a>      <a class="var it10344" onMouseOver="hilite(10344)" onMouseOut="lolite()" onClick="logVariable('removedcount')" href="../_variables/removedcount.html">$removedcount</a> = 0;
<a name="l2809"><span class="linenum">2809</span></a>  
<a name="l2810"><span class="linenum">2810</span></a>      if (<a class="var it28832" onMouseOver="hilite(28832)" onMouseOut="lolite()" onClick="logVariable('cachedcaps')" href="../_variables/cachedcaps.html">$cachedcaps</a> = <a class="function" onClick="logFunction('get_cached_capabilities')" href="../_functions/get_cached_capabilities.html" onMouseOver="funcPopup(event,'get_cached_capabilities')">get_cached_capabilities</a>(<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>)) {
<a name="l2811"><span class="linenum">2811</span></a>          foreach (<a class="var it28832" onMouseOver="hilite(28832)" onMouseOut="lolite()" onClick="logVariable('cachedcaps')" href="../_variables/cachedcaps.html">$cachedcaps</a> as <a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>) {
<a name="l2812"><span class="linenum">2812</span></a>              if (empty(<a class="var it28841" onMouseOver="hilite(28841)" onMouseOut="lolite()" onClick="logVariable('newcapdef')" href="../_variables/newcapdef.html">$newcapdef</a>) ||
<a name="l2813"><span class="linenum">2813</span></a>                          <a class="phpfunction" onClick="logFunction('array_key_exists')" href="../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>-&gt;<a onClick="logVariable('name')" class="var it40981" onMouseOver="hilite(40981)" onMouseOut="lolite()" href="../_variables/name.html">name</a>, <a class="var it28841" onMouseOver="hilite(28841)" onMouseOut="lolite()" onClick="logVariable('newcapdef')" href="../_variables/newcapdef.html">$newcapdef</a>) === false) {
<a name="l2814"><span class="linenum">2814</span></a>  
<a name="l2815"><span class="linenum">2815</span></a>  <span class="comment">                // Remove from capabilities cache.</span>
<a name="l2816"><span class="linenum">2816</span></a>                  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('capabilities', array('name'=&gt;<a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>-&gt;<a onClick="logVariable('name')" class="var it40981" onMouseOver="hilite(40981)" onMouseOut="lolite()" href="../_variables/name.html">name</a>));
<a name="l2817"><span class="linenum">2817</span></a>                  <a class="var it10344" onMouseOver="hilite(10344)" onMouseOut="lolite()" onClick="logVariable('removedcount')" href="../_variables/removedcount.html">$removedcount</a>++;
<a name="l2818"><span class="linenum">2818</span></a>  <span class="comment">                // Delete from roles.</span>
<a name="l2819"><span class="linenum">2819</span></a>                  if (<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a> = <a class="function" onClick="logFunction('get_roles_with_capability')" href="../_functions/get_roles_with_capability.html" onMouseOver="funcPopup(event,'get_roles_with_capability')">get_roles_with_capability</a>(<a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>-&gt;<a onClick="logVariable('name')" class="var it40981" onMouseOver="hilite(40981)" onMouseOut="lolite()" href="../_variables/name.html">name</a>)) {
<a name="l2820"><span class="linenum">2820</span></a>                      foreach(<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a> as <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>) {
<a name="l2821"><span class="linenum">2821</span></a>                          if (!<a class="function" onClick="logFunction('unassign_capability')" href="../_functions/unassign_capability.html" onMouseOver="funcPopup(event,'unassign_capability')">unassign_capability</a>(<a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>-&gt;<a onClick="logVariable('name')" class="var it40981" onMouseOver="hilite(40981)" onMouseOut="lolite()" href="../_variables/name.html">name</a>, <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('id')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/id.html">id</a>)) {
<a name="l2822"><span class="linenum">2822</span></a>                              <a class="function" onClick="logFunction('print_error')" href="../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('cannotunassigncap', 'error', '', (object)array('cap'=&gt;<a class="var it28833" onMouseOver="hilite(28833)" onMouseOut="lolite()" onClick="logVariable('cachedcap')" href="../_variables/cachedcap.html">$cachedcap</a>-&gt;<a onClick="logVariable('name')" class="var it40981" onMouseOver="hilite(40981)" onMouseOut="lolite()" href="../_variables/name.html">name</a>, 'role'=&gt;<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('name')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/name.html">name</a>));
<a name="l2823"><span class="linenum">2823</span></a>                          }
<a name="l2824"><span class="linenum">2824</span></a>                      }
<a name="l2825"><span class="linenum">2825</span></a>                  }
<a name="l2826"><span class="linenum">2826</span></a>              } <span class="comment">// End if.</span>
<a name="l2827"><span class="linenum">2827</span></a>          }
<a name="l2828"><span class="linenum">2828</span></a>      }
<a name="l2829"><span class="linenum">2829</span></a>      return <a class="var it10344" onMouseOver="hilite(10344)" onMouseOut="lolite()" onClick="logVariable('removedcount')" href="../_variables/removedcount.html">$removedcount</a>;
<a name="l2830"><span class="linenum">2830</span></a>  }
<a name="l2831"><span class="linenum">2831</span></a>  
<a name="l2832"><span class="linenum">2832</span></a>  <span class="comment">/**</span>
<a name="l2833"><span class="linenum">2833</span></a>  <span class="comment"> * Returns an array of all the known types of risk</span>
<a name="l2834"><span class="linenum">2834</span></a>  <span class="comment"> * The array keys can be used, for example as CSS class names, or in calls to</span>
<a name="l2835"><span class="linenum">2835</span></a>  <span class="comment"> * print_risk_icon. The values are the corresponding RISK_ constants.</span>
<a name="l2836"><span class="linenum">2836</span></a>  <span class="comment"> *</span>
<a name="l2837"><span class="linenum">2837</span></a>  <span class="comment"> * @return array all the known types of risk.</span>
<a name="l2838"><span class="linenum">2838</span></a>  <span class="comment"> */</span>
<a name="l2839"><span class="linenum">2839</span></a>  function <a class="function" onClick="logFunction('get_all_risks')" href="../_functions/get_all_risks.html" onMouseOver="funcPopup(event,'get_all_risks')">get_all_risks</a>() {
<a name="l2840"><span class="linenum">2840</span></a>      return array(
<a name="l2841"><span class="linenum">2841</span></a>          'riskmanagetrust' =&gt; <a class="constant" onClick="logConstant('RISK_MANAGETRUST')" href="../_constants/RISK_MANAGETRUST.html" onMouseOver="constPopup(event,'RISK_MANAGETRUST')">RISK_MANAGETRUST</a>,
<a name="l2842"><span class="linenum">2842</span></a>          'riskconfig'      =&gt; <a class="constant" onClick="logConstant('RISK_CONFIG')" href="../_constants/RISK_CONFIG.html" onMouseOver="constPopup(event,'RISK_CONFIG')">RISK_CONFIG</a>,
<a name="l2843"><span class="linenum">2843</span></a>          'riskxss'         =&gt; <a class="constant" onClick="logConstant('RISK_XSS')" href="../_constants/RISK_XSS.html" onMouseOver="constPopup(event,'RISK_XSS')">RISK_XSS</a>,
<a name="l2844"><span class="linenum">2844</span></a>          'riskpersonal'    =&gt; <a class="constant" onClick="logConstant('RISK_PERSONAL')" href="../_constants/RISK_PERSONAL.html" onMouseOver="constPopup(event,'RISK_PERSONAL')">RISK_PERSONAL</a>,
<a name="l2845"><span class="linenum">2845</span></a>          'riskspam'        =&gt; <a class="constant" onClick="logConstant('RISK_SPAM')" href="../_constants/RISK_SPAM.html" onMouseOver="constPopup(event,'RISK_SPAM')">RISK_SPAM</a>,
<a name="l2846"><span class="linenum">2846</span></a>          'riskdataloss'    =&gt; <a class="constant" onClick="logConstant('RISK_DATALOSS')" href="../_constants/RISK_DATALOSS.html" onMouseOver="constPopup(event,'RISK_DATALOSS')">RISK_DATALOSS</a>,
<a name="l2847"><span class="linenum">2847</span></a>      );
<a name="l2848"><span class="linenum">2848</span></a>  }
<a name="l2849"><span class="linenum">2849</span></a>  
<a name="l2850"><span class="linenum">2850</span></a>  <span class="comment">/**</span>
<a name="l2851"><span class="linenum">2851</span></a>  <span class="comment"> * Return a link to moodle docs for a given capability name</span>
<a name="l2852"><span class="linenum">2852</span></a>  <span class="comment"> *</span>
<a name="l2853"><span class="linenum">2853</span></a>  <span class="comment"> * @param stdClass $capability a capability - a row from the mdl_capabilities table.</span>
<a name="l2854"><span class="linenum">2854</span></a>  <span class="comment"> * @return string the human-readable capability name as a link to Moodle Docs.</span>
<a name="l2855"><span class="linenum">2855</span></a>  <span class="comment"> */</span>
<a name="l2856"><span class="linenum">2856</span></a>  function <a class="function" onClick="logFunction('get_capability_docs_link')" href="../_functions/get_capability_docs_link.html" onMouseOver="funcPopup(event,'get_capability_docs_link')">get_capability_docs_link</a>(<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>) {
<a name="l2857"><span class="linenum">2857</span></a>      <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a> = <a class="function" onClick="logFunction('get_docs_url')" href="../_functions/get_docs_url.html" onMouseOver="funcPopup(event,'get_docs_url')">get_docs_url</a>('Capabilities/' . <a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>-&gt;<a onClick="logVariable('name')" class="var it40428" onMouseOver="hilite(40428)" onMouseOut="lolite()" href="../_variables/name.html">name</a>);
<a name="l2858"><span class="linenum">2858</span></a>      return '&lt;a onclick=&quot;this.target=\'docspopup\'&quot; href=&quot;' . <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a> . '&quot;&gt;' . <a class="function" onClick="logFunction('get_capability_string')" href="../_functions/get_capability_string.html" onMouseOver="funcPopup(event,'get_capability_string')">get_capability_string</a>(<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>-&gt;<a onClick="logVariable('name')" class="var it40428" onMouseOver="hilite(40428)" onMouseOut="lolite()" href="../_variables/name.html">name</a>) . '&lt;/a&gt;';
<a name="l2859"><span class="linenum">2859</span></a>  }
<a name="l2860"><span class="linenum">2860</span></a>  
<a name="l2861"><span class="linenum">2861</span></a>  <span class="comment">/**</span>
<a name="l2862"><span class="linenum">2862</span></a>  <span class="comment"> * This function pulls out all the resolved capabilities (overrides and</span>
<a name="l2863"><span class="linenum">2863</span></a>  <span class="comment"> * defaults) of a role used in capability overrides in contexts at a given</span>
<a name="l2864"><span class="linenum">2864</span></a>  <span class="comment"> * context.</span>
<a name="l2865"><span class="linenum">2865</span></a>  <span class="comment"> *</span>
<a name="l2866"><span class="linenum">2866</span></a>  <span class="comment"> * @param int $roleid</span>
<a name="l2867"><span class="linenum">2867</span></a>  <span class="comment"> * @param context $context</span>
<a name="l2868"><span class="linenum">2868</span></a>  <span class="comment"> * @param string $cap capability, optional, defaults to ''</span>
<a name="l2869"><span class="linenum">2869</span></a>  <span class="comment"> * @return array Array of capabilities</span>
<a name="l2870"><span class="linenum">2870</span></a>  <span class="comment"> */</span>
<a name="l2871"><span class="linenum">2871</span></a>  function <a class="function" onClick="logFunction('role_context_capabilities')" href="../_functions/role_context_capabilities.html" onMouseOver="funcPopup(event,'role_context_capabilities')">role_context_capabilities</a>(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a> = '') {
<a name="l2872"><span class="linenum">2872</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l2873"><span class="linenum">2873</span></a>  
<a name="l2874"><span class="linenum">2874</span></a>      <a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../_variables/contexts.html">$contexts</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_parent_context_ids')" href="../_functions/get_parent_context_ids.html" onMouseOver="funcPopup(event,'get_parent_context_ids')">get_parent_context_ids</a>(true);
<a name="l2875"><span class="linenum">2875</span></a>      <a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../_variables/contexts.html">$contexts</a> = '('.<a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',', <a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../_variables/contexts.html">$contexts</a>).')';
<a name="l2876"><span class="linenum">2876</span></a>  
<a name="l2877"><span class="linenum">2877</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>);
<a name="l2878"><span class="linenum">2878</span></a>  
<a name="l2879"><span class="linenum">2879</span></a>      if (<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>) {
<a name="l2880"><span class="linenum">2880</span></a>          <a class="var it1502" onMouseOver="hilite(1502)" onMouseOut="lolite()" onClick="logVariable('search')" href="../_variables/search.html">$search</a> = &quot; AND rc.capability = ? &quot;;
<a name="l2881"><span class="linenum">2881</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>[] = <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>;
<a name="l2882"><span class="linenum">2882</span></a>      } else {
<a name="l2883"><span class="linenum">2883</span></a>          <a class="var it1502" onMouseOver="hilite(1502)" onMouseOut="lolite()" onClick="logVariable('search')" href="../_variables/search.html">$search</a> = '';
<a name="l2884"><span class="linenum">2884</span></a>      }
<a name="l2885"><span class="linenum">2885</span></a>  
<a name="l2886"><span class="linenum">2886</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT rc.*
<a name="l2887"><span class="linenum">2887</span></a>                FROM {role_capabilities} rc, {context} c
<a name="l2888"><span class="linenum">2888</span></a>               WHERE rc.contextid in <a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../_variables/contexts.html">$contexts</a>
<a name="l2889"><span class="linenum">2889</span></a>                     AND rc.roleid = ?
<a name="l2890"><span class="linenum">2890</span></a>                     AND rc.contextid = c.id <a class="var it1502" onMouseOver="hilite(1502)" onMouseOut="lolite()" onClick="logVariable('search')" href="../_variables/search.html">$search</a>
<a name="l2891"><span class="linenum">2891</span></a>            ORDER BY c.contextlevel DESC, rc.capability DESC&quot;;
<a name="l2892"><span class="linenum">2892</span></a>  
<a name="l2893"><span class="linenum">2893</span></a>      <a class="var it497" onMouseOver="hilite(497)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../_variables/capabilities.html">$capabilities</a> = array();
<a name="l2894"><span class="linenum">2894</span></a>  
<a name="l2895"><span class="linenum">2895</span></a>      if (<a class="var it2579" onMouseOver="hilite(2579)" onMouseOut="lolite()" onClick="logVariable('records')" href="../_variables/records.html">$records</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>)) {
<a name="l2896"><span class="linenum">2896</span></a>  <span class="comment">        // We are traversing via reverse order.</span>
<a name="l2897"><span class="linenum">2897</span></a>          foreach (<a class="var it2579" onMouseOver="hilite(2579)" onMouseOut="lolite()" onClick="logVariable('records')" href="../_variables/records.html">$records</a> as <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>) {
<a name="l2898"><span class="linenum">2898</span></a>  <span class="comment">            // If not set yet (i.e. inherit or not set at all), or currently we have a prohibit</span>
<a name="l2899"><span class="linenum">2899</span></a>              if (!isset(<a class="var it497" onMouseOver="hilite(497)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../_variables/capabilities.html">$capabilities</a>[<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('capability')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/capability.html">capability</a>]) || <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('permission')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/permission.html">permission</a>&lt;-500) {
<a name="l2900"><span class="linenum">2900</span></a>                  <a class="var it497" onMouseOver="hilite(497)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../_variables/capabilities.html">$capabilities</a>[<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('capability')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/capability.html">capability</a>] = <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('permission')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/permission.html">permission</a>;
<a name="l2901"><span class="linenum">2901</span></a>              }
<a name="l2902"><span class="linenum">2902</span></a>          }
<a name="l2903"><span class="linenum">2903</span></a>      }
<a name="l2904"><span class="linenum">2904</span></a>      return <a class="var it497" onMouseOver="hilite(497)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../_variables/capabilities.html">$capabilities</a>;
<a name="l2905"><span class="linenum">2905</span></a>  }
<a name="l2906"><span class="linenum">2906</span></a>  
<a name="l2907"><span class="linenum">2907</span></a>  <span class="comment">/**</span>
<a name="l2908"><span class="linenum">2908</span></a>  <span class="comment"> * Constructs array with contextids as first parameter and context paths,</span>
<a name="l2909"><span class="linenum">2909</span></a>  <span class="comment"> * in both cases bottom top including self.</span>
<a name="l2910"><span class="linenum">2910</span></a>  <span class="comment"> *</span>
<a name="l2911"><span class="linenum">2911</span></a>  <span class="comment"> * @access private</span>
<a name="l2912"><span class="linenum">2912</span></a>  <span class="comment"> * @param context $context</span>
<a name="l2913"><span class="linenum">2913</span></a>  <span class="comment"> * @return array</span>
<a name="l2914"><span class="linenum">2914</span></a>  <span class="comment"> */</span>
<a name="l2915"><span class="linenum">2915</span></a>  function <a class="function" onClick="logFunction('get_context_info_list')" href="../_functions/get_context_info_list.html" onMouseOver="funcPopup(event,'get_context_info_list')">get_context_info_list</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l2916"><span class="linenum">2916</span></a>      <a class="var it12554" onMouseOver="hilite(12554)" onMouseOut="lolite()" onClick="logVariable('contextids')" href="../_variables/contextids.html">$contextids</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>('/', <a class="phpfunction" onClick="logFunction('ltrim')" href="../_functions/ltrim.html" onMouseOver="phpfuncPopup(event,'ltrim')">ltrim</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('path')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/path.html">path</a>, '/'));
<a name="l2917"><span class="linenum">2917</span></a>      <a class="var it28817" onMouseOver="hilite(28817)" onMouseOut="lolite()" onClick="logVariable('contextpaths')" href="../_variables/contextpaths.html">$contextpaths</a> = array();
<a name="l2918"><span class="linenum">2918</span></a>      <a class="var it28842" onMouseOver="hilite(28842)" onMouseOut="lolite()" onClick="logVariable('contextids2')" href="../_variables/contextids2.html">$contextids2</a> = <a class="var it12554" onMouseOver="hilite(12554)" onMouseOut="lolite()" onClick="logVariable('contextids')" href="../_variables/contextids.html">$contextids</a>;
<a name="l2919"><span class="linenum">2919</span></a>      while (<a class="var it28842" onMouseOver="hilite(28842)" onMouseOut="lolite()" onClick="logVariable('contextids2')" href="../_variables/contextids2.html">$contextids2</a>) {
<a name="l2920"><span class="linenum">2920</span></a>          <a class="var it28817" onMouseOver="hilite(28817)" onMouseOut="lolite()" onClick="logVariable('contextpaths')" href="../_variables/contextpaths.html">$contextpaths</a>[] = '/' . <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>('/', <a class="var it28842" onMouseOver="hilite(28842)" onMouseOut="lolite()" onClick="logVariable('contextids2')" href="../_variables/contextids2.html">$contextids2</a>);
<a name="l2921"><span class="linenum">2921</span></a>          <a class="phpfunction" onClick="logFunction('array_pop')" href="../_functions/array_pop.html" onMouseOver="phpfuncPopup(event,'array_pop')">array_pop</a>(<a class="var it28842" onMouseOver="hilite(28842)" onMouseOut="lolite()" onClick="logVariable('contextids2')" href="../_variables/contextids2.html">$contextids2</a>);
<a name="l2922"><span class="linenum">2922</span></a>      }
<a name="l2923"><span class="linenum">2923</span></a>      return array(<a class="var it12554" onMouseOver="hilite(12554)" onMouseOut="lolite()" onClick="logVariable('contextids')" href="../_variables/contextids.html">$contextids</a>, <a class="var it28817" onMouseOver="hilite(28817)" onMouseOut="lolite()" onClick="logVariable('contextpaths')" href="../_variables/contextpaths.html">$contextpaths</a>);
<a name="l2924"><span class="linenum">2924</span></a>  }
<a name="l2925"><span class="linenum">2925</span></a>  
<a name="l2926"><span class="linenum">2926</span></a>  <span class="comment">/**</span>
<a name="l2927"><span class="linenum">2927</span></a>  <span class="comment"> * Check if context is the front page context or a context inside it</span>
<a name="l2928"><span class="linenum">2928</span></a>  <span class="comment"> *</span>
<a name="l2929"><span class="linenum">2929</span></a>  <span class="comment"> * Returns true if this context is the front page context, or a context inside it,</span>
<a name="l2930"><span class="linenum">2930</span></a>  <span class="comment"> * otherwise false.</span>
<a name="l2931"><span class="linenum">2931</span></a>  <span class="comment"> *</span>
<a name="l2932"><span class="linenum">2932</span></a>  <span class="comment"> * @param context $context a context object.</span>
<a name="l2933"><span class="linenum">2933</span></a>  <span class="comment"> * @return bool</span>
<a name="l2934"><span class="linenum">2934</span></a>  <span class="comment"> */</span>
<a name="l2935"><span class="linenum">2935</span></a>  function <a class="function" onClick="logFunction('is_inside_frontpage')" href="../_functions/is_inside_frontpage.html" onMouseOver="funcPopup(event,'is_inside_frontpage')">is_inside_frontpage</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l2936"><span class="linenum">2936</span></a>      <a class="var it17355" onMouseOver="hilite(17355)" onMouseOut="lolite()" onClick="logVariable('frontpagecontext')" href="../_variables/frontpagecontext.html">$frontpagecontext</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>);
<a name="l2937"><span class="linenum">2937</span></a>      return <a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('path')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/path.html">path</a> . '/', <a class="var it17355" onMouseOver="hilite(17355)" onMouseOut="lolite()" onClick="logVariable('frontpagecontext')" href="../_variables/frontpagecontext.html">$frontpagecontext</a>-&gt;<a onClick="logVariable('path')" class="var it40980" onMouseOver="hilite(40980)" onMouseOut="lolite()" href="../_variables/path.html">path</a> . '/') === 0;
<a name="l2938"><span class="linenum">2938</span></a>  }
<a name="l2939"><span class="linenum">2939</span></a>  
<a name="l2940"><span class="linenum">2940</span></a>  <span class="comment">/**</span>
<a name="l2941"><span class="linenum">2941</span></a>  <span class="comment"> * Returns capability information (cached)</span>
<a name="l2942"><span class="linenum">2942</span></a>  <span class="comment"> *</span>
<a name="l2943"><span class="linenum">2943</span></a>  <span class="comment"> * @param string $capabilityname</span>
<a name="l2944"><span class="linenum">2944</span></a>  <span class="comment"> * @return stdClass or null if capability not found</span>
<a name="l2945"><span class="linenum">2945</span></a>  <span class="comment"> */</span>
<a name="l2946"><span class="linenum">2946</span></a>  function <a class="function" onClick="logFunction('get_capability_info')" href="../_functions/get_capability_info.html" onMouseOver="funcPopup(event,'get_capability_info')">get_capability_info</a>(<a class="var it28843" onMouseOver="hilite(28843)" onMouseOut="lolite()" onClick="logVariable('capabilityname')" href="../_variables/capabilityname.html">$capabilityname</a>) {
<a name="l2947"><span class="linenum">2947</span></a>      global <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>; <span class="comment">// one request per page only</span>
<a name="l2948"><span class="linenum">2948</span></a>  
<a name="l2949"><span class="linenum">2949</span></a>  <span class="comment">    //TODO: MUC - this could be cached in shared memory, it would eliminate 1 query per page</span>
<a name="l2950"><span class="linenum">2950</span></a>  
<a name="l2951"><span class="linenum">2951</span></a>      if (empty(<a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('capabilities')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/capabilities.html">capabilities</a>)) {
<a name="l2952"><span class="linenum">2952</span></a>          <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('capabilities')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/capabilities.html">capabilities</a> = array();
<a name="l2953"><span class="linenum">2953</span></a>          <a class="var it4955" onMouseOver="hilite(4955)" onMouseOut="lolite()" onClick="logVariable('caps')" href="../_variables/caps.html">$caps</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('capabilities', array(), '', 'id, name, captype, riskbitmask');
<a name="l2954"><span class="linenum">2954</span></a>          foreach (<a class="var it4955" onMouseOver="hilite(4955)" onMouseOut="lolite()" onClick="logVariable('caps')" href="../_variables/caps.html">$caps</a> as <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>) {
<a name="l2955"><span class="linenum">2955</span></a>              <a class="var it23190" onMouseOver="hilite(23190)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../_variables/capname.html">$capname</a> = <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>-&gt;<a onClick="logVariable('name')" class="var it40429" onMouseOver="hilite(40429)" onMouseOut="lolite()" href="../_variables/name.html">name</a>;
<a name="l2956"><span class="linenum">2956</span></a>              unset(<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>-&gt;<a onClick="logVariable('id')" class="var it40429" onMouseOver="hilite(40429)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l2957"><span class="linenum">2957</span></a>              unset(<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>-&gt;<a onClick="logVariable('name')" class="var it40429" onMouseOver="hilite(40429)" onMouseOut="lolite()" href="../_variables/name.html">name</a>);
<a name="l2958"><span class="linenum">2958</span></a>              <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>-&gt;<a onClick="logVariable('riskbitmask')" class="var it40429" onMouseOver="hilite(40429)" onMouseOut="lolite()" href="../_variables/riskbitmask.html">riskbitmask</a> = (int)<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>-&gt;<a onClick="logVariable('riskbitmask')" class="var it40429" onMouseOver="hilite(40429)" onMouseOut="lolite()" href="../_variables/riskbitmask.html">riskbitmask</a>;
<a name="l2959"><span class="linenum">2959</span></a>              <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('capabilities')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/capabilities.html">capabilities</a>[<a class="var it23190" onMouseOver="hilite(23190)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../_variables/capname.html">$capname</a>] = <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>;
<a name="l2960"><span class="linenum">2960</span></a>          }
<a name="l2961"><span class="linenum">2961</span></a>      }
<a name="l2962"><span class="linenum">2962</span></a>  
<a name="l2963"><span class="linenum">2963</span></a>      return isset(<a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('capabilities')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/capabilities.html">capabilities</a>[<a class="var it28843" onMouseOver="hilite(28843)" onMouseOut="lolite()" onClick="logVariable('capabilityname')" href="../_variables/capabilityname.html">$capabilityname</a>]) ? <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('capabilities')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/capabilities.html">capabilities</a>[<a class="var it28843" onMouseOver="hilite(28843)" onMouseOut="lolite()" onClick="logVariable('capabilityname')" href="../_variables/capabilityname.html">$capabilityname</a>] : null;
<a name="l2964"><span class="linenum">2964</span></a>  }
<a name="l2965"><span class="linenum">2965</span></a>  
<a name="l2966"><span class="linenum">2966</span></a>  <span class="comment">/**</span>
<a name="l2967"><span class="linenum">2967</span></a>  <span class="comment"> * Returns the human-readable, translated version of the capability.</span>
<a name="l2968"><span class="linenum">2968</span></a>  <span class="comment"> * Basically a big switch statement.</span>
<a name="l2969"><span class="linenum">2969</span></a>  <span class="comment"> *</span>
<a name="l2970"><span class="linenum">2970</span></a>  <span class="comment"> * @param string $capabilityname e.g. mod/choice:readresponses</span>
<a name="l2971"><span class="linenum">2971</span></a>  <span class="comment"> * @return string</span>
<a name="l2972"><span class="linenum">2972</span></a>  <span class="comment"> */</span>
<a name="l2973"><span class="linenum">2973</span></a>  function <a class="function" onClick="logFunction('get_capability_string')" href="../_functions/get_capability_string.html" onMouseOver="funcPopup(event,'get_capability_string')">get_capability_string</a>(<a class="var it28843" onMouseOver="hilite(28843)" onMouseOut="lolite()" onClick="logVariable('capabilityname')" href="../_variables/capabilityname.html">$capabilityname</a>) {
<a name="l2974"><span class="linenum">2974</span></a>  
<a name="l2975"><span class="linenum">2975</span></a>  <span class="comment">    // Typical capability name is 'plugintype/pluginname:capabilityname'</span>
<a name="l2976"><span class="linenum">2976</span></a>      <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>, <a class="var it23190" onMouseOver="hilite(23190)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../_variables/capname.html">$capname</a>) = <a class="phpfunction" onClick="logFunction('preg_split')" href="../_functions/preg_split.html" onMouseOver="phpfuncPopup(event,'preg_split')">preg_split</a>('|[/:]|', <a class="var it28843" onMouseOver="hilite(28843)" onMouseOut="lolite()" onClick="logVariable('capabilityname')" href="../_variables/capabilityname.html">$capabilityname</a>);
<a name="l2977"><span class="linenum">2977</span></a>  
<a name="l2978"><span class="linenum">2978</span></a>      if (<a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> === 'moodle') {
<a name="l2979"><span class="linenum">2979</span></a>          <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a> = 'core_role';
<a name="l2980"><span class="linenum">2980</span></a>      } else if (<a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> === 'quizreport') {
<a name="l2981"><span class="linenum">2981</span></a>  <span class="comment">        //ugly hack!!</span>
<a name="l2982"><span class="linenum">2982</span></a>          <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a> = 'quiz_'.<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>;
<a name="l2983"><span class="linenum">2983</span></a>      } else {
<a name="l2984"><span class="linenum">2984</span></a>          <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a> = <a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>.'_'.<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>;
<a name="l2985"><span class="linenum">2985</span></a>      }
<a name="l2986"><span class="linenum">2986</span></a>  
<a name="l2987"><span class="linenum">2987</span></a>      <a class="var it28844" onMouseOver="hilite(28844)" onMouseOut="lolite()" onClick="logVariable('stringname')" href="../_variables/stringname.html">$stringname</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>.':'.<a class="var it23190" onMouseOver="hilite(23190)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../_variables/capname.html">$capname</a>;
<a name="l2988"><span class="linenum">2988</span></a>  
<a name="l2989"><span class="linenum">2989</span></a>      if (<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a> === 'core_role' or <a class="function" onClick="logFunction('get_string_manager')" href="../_functions/get_string_manager.html" onMouseOver="funcPopup(event,'get_string_manager')">get_string_manager</a>()-&gt;<a class="function" onClick="logFunction('string_exists')" href="../_functions/string_exists.html" onMouseOver="funcPopup(event,'string_exists')">string_exists</a>(<a class="var it28844" onMouseOver="hilite(28844)" onMouseOut="lolite()" onClick="logVariable('stringname')" href="../_variables/stringname.html">$stringname</a>, <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>)) {
<a name="l2990"><span class="linenum">2990</span></a>          return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(<a class="var it28844" onMouseOver="hilite(28844)" onMouseOut="lolite()" onClick="logVariable('stringname')" href="../_variables/stringname.html">$stringname</a>, <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>);
<a name="l2991"><span class="linenum">2991</span></a>      }
<a name="l2992"><span class="linenum">2992</span></a>  
<a name="l2993"><span class="linenum">2993</span></a>      <a class="var it1099" onMouseOver="hilite(1099)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../_variables/dir.html">$dir</a> = <a class="class" onClick="logClass('core_component')" href="../_classes/core_component.html" onMouseOver="classPopup(event,'core_component')">core_component</a>::<a class="function" onClick="logFunction('get_component_directory')" href="../_functions/get_component_directory.html" onMouseOver="funcPopup(event,'get_component_directory')">get_component_directory</a>(<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>);
<a name="l2994"><span class="linenum">2994</span></a>      if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it1099" onMouseOver="hilite(1099)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../_variables/dir.html">$dir</a>)) {
<a name="l2995"><span class="linenum">2995</span></a>  <span class="comment">        // plugin broken or does not exist, do not bother with printing of debug message</span>
<a name="l2996"><span class="linenum">2996</span></a>          return <a class="var it28843" onMouseOver="hilite(28843)" onMouseOut="lolite()" onClick="logVariable('capabilityname')" href="../_variables/capabilityname.html">$capabilityname</a>.' ???';
<a name="l2997"><span class="linenum">2997</span></a>      }
<a name="l2998"><span class="linenum">2998</span></a>  
<a name="l2999"><span class="linenum">2999</span></a>  <span class="comment">    // something is wrong in plugin, better print debug</span>
<a name="l3000"><span class="linenum">3000</span></a>      return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(<a class="var it28844" onMouseOver="hilite(28844)" onMouseOut="lolite()" onClick="logVariable('stringname')" href="../_variables/stringname.html">$stringname</a>, <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>);
<a name="l3001"><span class="linenum">3001</span></a>  }
<a name="l3002"><span class="linenum">3002</span></a>  
<a name="l3003"><span class="linenum">3003</span></a>  <span class="comment">/**</span>
<a name="l3004"><span class="linenum">3004</span></a>  <span class="comment"> * This gets the mod/block/course/core etc strings.</span>
<a name="l3005"><span class="linenum">3005</span></a>  <span class="comment"> *</span>
<a name="l3006"><span class="linenum">3006</span></a>  <span class="comment"> * @param string $component</span>
<a name="l3007"><span class="linenum">3007</span></a>  <span class="comment"> * @param int $contextlevel</span>
<a name="l3008"><span class="linenum">3008</span></a>  <span class="comment"> * @return string|bool String is success, false if failed</span>
<a name="l3009"><span class="linenum">3009</span></a>  <span class="comment"> */</span>
<a name="l3010"><span class="linenum">3010</span></a>  function <a class="function" onClick="logFunction('get_component_string')" href="../_functions/get_component_string.html" onMouseOver="funcPopup(event,'get_component_string')">get_component_string</a>(<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>, <a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../_variables/contextlevel.html">$contextlevel</a>) {
<a name="l3011"><span class="linenum">3011</span></a>  
<a name="l3012"><span class="linenum">3012</span></a>      if (<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a> === 'moodle' or <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a> === 'core') {
<a name="l3013"><span class="linenum">3013</span></a>          switch (<a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../_variables/contextlevel.html">$contextlevel</a>) {
<a name="l3014"><span class="linenum">3014</span></a>  <span class="comment">            // TODO MDL-46123: this should probably use context level names instead</span>
<a name="l3015"><span class="linenum">3015</span></a>              case <a class="constant" onClick="logConstant('CONTEXT_SYSTEM')" href="../_constants/CONTEXT_SYSTEM.html" onMouseOver="constPopup(event,'CONTEXT_SYSTEM')">CONTEXT_SYSTEM</a>:    return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('coresystem');
<a name="l3016"><span class="linenum">3016</span></a>              case <a class="constant" onClick="logConstant('CONTEXT_USER')" href="../_constants/CONTEXT_USER.html" onMouseOver="constPopup(event,'CONTEXT_USER')">CONTEXT_USER</a>:      return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('users');
<a name="l3017"><span class="linenum">3017</span></a>              case <a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>: return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('categories');
<a name="l3018"><span class="linenum">3018</span></a>              case <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>:    return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('course');
<a name="l3019"><span class="linenum">3019</span></a>              case <a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>:    return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('activities');
<a name="l3020"><span class="linenum">3020</span></a>              case <a class="constant" onClick="logConstant('CONTEXT_BLOCK')" href="../_constants/CONTEXT_BLOCK.html" onMouseOver="constPopup(event,'CONTEXT_BLOCK')">CONTEXT_BLOCK</a>:     return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('block');
<a name="l3021"><span class="linenum">3021</span></a>              default:                <a class="function" onClick="logFunction('print_error')" href="../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('unknowncontext');
<a name="l3022"><span class="linenum">3022</span></a>          }
<a name="l3023"><span class="linenum">3023</span></a>      }
<a name="l3024"><span class="linenum">3024</span></a>  
<a name="l3025"><span class="linenum">3025</span></a>      <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>) = <a class="class" onClick="logClass('core_component')" href="../_classes/core_component.html" onMouseOver="classPopup(event,'core_component')">core_component</a>::<a class="function" onClick="logFunction('normalize_component')" href="../_functions/normalize_component.html" onMouseOver="funcPopup(event,'normalize_component')">normalize_component</a>(<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>);
<a name="l3026"><span class="linenum">3026</span></a>      <a class="var it1099" onMouseOver="hilite(1099)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../_variables/dir.html">$dir</a> = <a class="class" onClick="logClass('core_component')" href="../_classes/core_component.html" onMouseOver="classPopup(event,'core_component')">core_component</a>::<a class="function" onClick="logFunction('get_plugin_directory')" href="../_functions/get_plugin_directory.html" onMouseOver="funcPopup(event,'get_plugin_directory')">get_plugin_directory</a>(<a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>);
<a name="l3027"><span class="linenum">3027</span></a>      if (!<a class="phpfunction" onClick="logFunction('file_exists')" href="../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it1099" onMouseOver="hilite(1099)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../_variables/dir.html">$dir</a>)) {
<a name="l3028"><span class="linenum">3028</span></a>  <span class="comment">        // plugin not installed, bad luck, there is no way to find the name</span>
<a name="l3029"><span class="linenum">3029</span></a>          return <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>.' ???';
<a name="l3030"><span class="linenum">3030</span></a>      }
<a name="l3031"><span class="linenum">3031</span></a>  
<a name="l3032"><span class="linenum">3032</span></a>      switch (<a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>) {
<a name="l3033"><span class="linenum">3033</span></a>  <span class="comment">        // TODO MDL-46123: this is really hacky and should be improved.</span>
<a name="l3034"><span class="linenum">3034</span></a>          case 'quiz':         return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>.':componentname', <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>);<span class="comment">// insane hack!!!</span>
<a name="l3035"><span class="linenum">3035</span></a>          case 'repository':   return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('repository', 'repository').': '.<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('pluginname', <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>);
<a name="l3036"><span class="linenum">3036</span></a>          case 'gradeimport':  return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('gradeimport', 'grades').': '.<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('pluginname', <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>);
<a name="l3037"><span class="linenum">3037</span></a>          case 'gradeexport':  return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('gradeexport', 'grades').': '.<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('pluginname', <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>);
<a name="l3038"><span class="linenum">3038</span></a>          case 'gradereport':  return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('gradereport', 'grades').': '.<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('pluginname', <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>);
<a name="l3039"><span class="linenum">3039</span></a>          case 'webservice':   return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('webservice', 'webservice').': '.<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('pluginname', <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>);
<a name="l3040"><span class="linenum">3040</span></a>          case 'block':        return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('block').': '.<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('pluginname', <a class="phpfunction" onClick="logFunction('basename')" href="../_functions/basename.html" onMouseOver="phpfuncPopup(event,'basename')">basename</a>(<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>));
<a name="l3041"><span class="linenum">3041</span></a>          case 'mod':
<a name="l3042"><span class="linenum">3042</span></a>              if (<a class="function" onClick="logFunction('get_string_manager')" href="../_functions/get_string_manager.html" onMouseOver="funcPopup(event,'get_string_manager')">get_string_manager</a>()-&gt;<a class="function" onClick="logFunction('string_exists')" href="../_functions/string_exists.html" onMouseOver="funcPopup(event,'string_exists')">string_exists</a>('pluginname', <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>)) {
<a name="l3043"><span class="linenum">3043</span></a>                  return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('activity').': '.<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('pluginname', <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>);
<a name="l3044"><span class="linenum">3044</span></a>              } else {
<a name="l3045"><span class="linenum">3045</span></a>                  return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('activity').': '.<a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('modulename', <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>);
<a name="l3046"><span class="linenum">3046</span></a>              }
<a name="l3047"><span class="linenum">3047</span></a>          default: return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('pluginname', <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('component')" href="../_variables/component.html">$component</a>);
<a name="l3048"><span class="linenum">3048</span></a>      }
<a name="l3049"><span class="linenum">3049</span></a>  }
<a name="l3050"><span class="linenum">3050</span></a>  
<a name="l3051"><span class="linenum">3051</span></a>  <span class="comment">/**</span>
<a name="l3052"><span class="linenum">3052</span></a>  <span class="comment"> * Gets the list of roles assigned to this context and up (parents)</span>
<a name="l3053"><span class="linenum">3053</span></a>  <span class="comment"> * from the list of roles that are visible on user profile page</span>
<a name="l3054"><span class="linenum">3054</span></a>  <span class="comment"> * and participants page.</span>
<a name="l3055"><span class="linenum">3055</span></a>  <span class="comment"> *</span>
<a name="l3056"><span class="linenum">3056</span></a>  <span class="comment"> * @param context $context</span>
<a name="l3057"><span class="linenum">3057</span></a>  <span class="comment"> * @return array</span>
<a name="l3058"><span class="linenum">3058</span></a>  <span class="comment"> */</span>
<a name="l3059"><span class="linenum">3059</span></a>  function <a class="function" onClick="logFunction('get_profile_roles')" href="../_functions/get_profile_roles.html" onMouseOver="funcPopup(event,'get_profile_roles')">get_profile_roles</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l3060"><span class="linenum">3060</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l3061"><span class="linenum">3061</span></a>  
<a name="l3062"><span class="linenum">3062</span></a>      if (empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('profileroles')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/profileroles.html">profileroles</a>)) {
<a name="l3063"><span class="linenum">3063</span></a>          return array();
<a name="l3064"><span class="linenum">3064</span></a>      }
<a name="l3065"><span class="linenum">3065</span></a>  
<a name="l3066"><span class="linenum">3066</span></a>      <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it28846" onMouseOver="hilite(28846)" onMouseOut="lolite()" onClick="logVariable('rallowed')" href="../_variables/rallowed.html">$rallowed</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('profileroles')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/profileroles.html">profileroles</a>), <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'a');
<a name="l3067"><span class="linenum">3067</span></a>      <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it25186" onMouseOver="hilite(25186)" onMouseOut="lolite()" onClick="logVariable('contextlist')" href="../_variables/contextlist.html">$contextlist</a>, <a class="var it26962" onMouseOver="hilite(26962)" onMouseOut="lolite()" onClick="logVariable('cparams')" href="../_variables/cparams.html">$cparams</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_parent_context_ids')" href="../_functions/get_parent_context_ids.html" onMouseOver="funcPopup(event,'get_parent_context_ids')">get_parent_context_ids</a>(true), <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'p');
<a name="l3068"><span class="linenum">3068</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it26962" onMouseOver="hilite(26962)" onMouseOut="lolite()" onClick="logVariable('cparams')" href="../_variables/cparams.html">$cparams</a>);
<a name="l3069"><span class="linenum">3069</span></a>  
<a name="l3070"><span class="linenum">3070</span></a>      if (<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_course_context')" href="../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>(false)) {
<a name="l3071"><span class="linenum">3071</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['coursecontext'] = <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('id')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l3072"><span class="linenum">3072</span></a>      } else {
<a name="l3073"><span class="linenum">3073</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['coursecontext'] = 0;
<a name="l3074"><span class="linenum">3074</span></a>      }
<a name="l3075"><span class="linenum">3075</span></a>  
<a name="l3076"><span class="linenum">3076</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT DISTINCT r.id, r.name, r.shortname, r.sortorder, rn.name AS coursealias
<a name="l3077"><span class="linenum">3077</span></a>                FROM {role_assignments} ra, {role} r
<a name="l3078"><span class="linenum">3078</span></a>           LEFT JOIN {role_names} rn <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (rn.contextid = :coursecontext AND rn.roleid = r.id)
<a name="l3079"><span class="linenum">3079</span></a>               WHERE r.id = ra.roleid
<a name="l3080"><span class="linenum">3080</span></a>                     AND ra.contextid <a class="var it25186" onMouseOver="hilite(25186)" onMouseOut="lolite()" onClick="logVariable('contextlist')" href="../_variables/contextlist.html">$contextlist</a>
<a name="l3081"><span class="linenum">3081</span></a>                     AND r.id <a class="var it28846" onMouseOver="hilite(28846)" onMouseOut="lolite()" onClick="logVariable('rallowed')" href="../_variables/rallowed.html">$rallowed</a>
<a name="l3082"><span class="linenum">3082</span></a>            ORDER BY r.sortorder ASC&quot;;
<a name="l3083"><span class="linenum">3083</span></a>  
<a name="l3084"><span class="linenum">3084</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l3085"><span class="linenum">3085</span></a>  }
<a name="l3086"><span class="linenum">3086</span></a>  
<a name="l3087"><span class="linenum">3087</span></a>  <span class="comment">/**</span>
<a name="l3088"><span class="linenum">3088</span></a>  <span class="comment"> * Gets the list of roles assigned to this context and up (parents)</span>
<a name="l3089"><span class="linenum">3089</span></a>  <span class="comment"> *</span>
<a name="l3090"><span class="linenum">3090</span></a>  <span class="comment"> * @param context $context</span>
<a name="l3091"><span class="linenum">3091</span></a>  <span class="comment"> * @return array</span>
<a name="l3092"><span class="linenum">3092</span></a>  <span class="comment"> */</span>
<a name="l3093"><span class="linenum">3093</span></a>  function <a class="function" onClick="logFunction('get_roles_used_in_context')" href="../_functions/get_roles_used_in_context.html" onMouseOver="funcPopup(event,'get_roles_used_in_context')">get_roles_used_in_context</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l3094"><span class="linenum">3094</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l3095"><span class="linenum">3095</span></a>  
<a name="l3096"><span class="linenum">3096</span></a>      <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it25186" onMouseOver="hilite(25186)" onMouseOut="lolite()" onClick="logVariable('contextlist')" href="../_variables/contextlist.html">$contextlist</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_parent_context_ids')" href="../_functions/get_parent_context_ids.html" onMouseOver="funcPopup(event,'get_parent_context_ids')">get_parent_context_ids</a>(true), <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'cl');
<a name="l3097"><span class="linenum">3097</span></a>  
<a name="l3098"><span class="linenum">3098</span></a>      if (<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_course_context')" href="../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>(false)) {
<a name="l3099"><span class="linenum">3099</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['coursecontext'] = <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('id')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l3100"><span class="linenum">3100</span></a>      } else {
<a name="l3101"><span class="linenum">3101</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['coursecontext'] = 0;
<a name="l3102"><span class="linenum">3102</span></a>      }
<a name="l3103"><span class="linenum">3103</span></a>  
<a name="l3104"><span class="linenum">3104</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT DISTINCT r.id, r.name, r.shortname, r.sortorder, rn.name AS coursealias
<a name="l3105"><span class="linenum">3105</span></a>                FROM {role_assignments} ra, {role} r
<a name="l3106"><span class="linenum">3106</span></a>           LEFT JOIN {role_names} rn <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (rn.contextid = :coursecontext AND rn.roleid = r.id)
<a name="l3107"><span class="linenum">3107</span></a>               WHERE r.id = ra.roleid
<a name="l3108"><span class="linenum">3108</span></a>                     AND ra.contextid <a class="var it25186" onMouseOver="hilite(25186)" onMouseOut="lolite()" onClick="logVariable('contextlist')" href="../_variables/contextlist.html">$contextlist</a>
<a name="l3109"><span class="linenum">3109</span></a>            ORDER BY r.sortorder ASC&quot;;
<a name="l3110"><span class="linenum">3110</span></a>  
<a name="l3111"><span class="linenum">3111</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l3112"><span class="linenum">3112</span></a>  }
<a name="l3113"><span class="linenum">3113</span></a>  
<a name="l3114"><span class="linenum">3114</span></a>  <span class="comment">/**</span>
<a name="l3115"><span class="linenum">3115</span></a>  <span class="comment"> * This function is used to print roles column in user profile page.</span>
<a name="l3116"><span class="linenum">3116</span></a>  <span class="comment"> * It is using the CFG-&gt;profileroles to limit the list to only interesting roles.</span>
<a name="l3117"><span class="linenum">3117</span></a>  <span class="comment"> * (The permission tab has full details of user role assignments.)</span>
<a name="l3118"><span class="linenum">3118</span></a>  <span class="comment"> *</span>
<a name="l3119"><span class="linenum">3119</span></a>  <span class="comment"> * @param int $userid</span>
<a name="l3120"><span class="linenum">3120</span></a>  <span class="comment"> * @param int $courseid</span>
<a name="l3121"><span class="linenum">3121</span></a>  <span class="comment"> * @return string</span>
<a name="l3122"><span class="linenum">3122</span></a>  <span class="comment"> */</span>
<a name="l3123"><span class="linenum">3123</span></a>  function <a class="function" onClick="logFunction('get_user_roles_in_course')" href="../_functions/get_user_roles_in_course.html" onMouseOver="funcPopup(event,'get_user_roles_in_course')">get_user_roles_in_course</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>) {
<a name="l3124"><span class="linenum">3124</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l3125"><span class="linenum">3125</span></a>  
<a name="l3126"><span class="linenum">3126</span></a>      if (empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('profileroles')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/profileroles.html">profileroles</a>)) {
<a name="l3127"><span class="linenum">3127</span></a>          return '';
<a name="l3128"><span class="linenum">3128</span></a>      }
<a name="l3129"><span class="linenum">3129</span></a>  
<a name="l3130"><span class="linenum">3130</span></a>      if (<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a> == <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>) {
<a name="l3131"><span class="linenum">3131</span></a>          <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l3132"><span class="linenum">3132</span></a>      } else {
<a name="l3133"><span class="linenum">3133</span></a>          <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>);
<a name="l3134"><span class="linenum">3134</span></a>      }
<a name="l3135"><span class="linenum">3135</span></a>  
<a name="l3136"><span class="linenum">3136</span></a>      <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it28846" onMouseOver="hilite(28846)" onMouseOut="lolite()" onClick="logVariable('rallowed')" href="../_variables/rallowed.html">$rallowed</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('profileroles')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/profileroles.html">profileroles</a>), <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'a');
<a name="l3137"><span class="linenum">3137</span></a>      <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it25186" onMouseOver="hilite(25186)" onMouseOut="lolite()" onClick="logVariable('contextlist')" href="../_variables/contextlist.html">$contextlist</a>, <a class="var it26962" onMouseOver="hilite(26962)" onMouseOut="lolite()" onClick="logVariable('cparams')" href="../_variables/cparams.html">$cparams</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_parent_context_ids')" href="../_functions/get_parent_context_ids.html" onMouseOver="funcPopup(event,'get_parent_context_ids')">get_parent_context_ids</a>(true), <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'p');
<a name="l3138"><span class="linenum">3138</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it26962" onMouseOver="hilite(26962)" onMouseOut="lolite()" onClick="logVariable('cparams')" href="../_variables/cparams.html">$cparams</a>);
<a name="l3139"><span class="linenum">3139</span></a>  
<a name="l3140"><span class="linenum">3140</span></a>      if (<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_course_context')" href="../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>(false)) {
<a name="l3141"><span class="linenum">3141</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['coursecontext'] = <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('id')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l3142"><span class="linenum">3142</span></a>      } else {
<a name="l3143"><span class="linenum">3143</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['coursecontext'] = 0;
<a name="l3144"><span class="linenum">3144</span></a>      }
<a name="l3145"><span class="linenum">3145</span></a>  
<a name="l3146"><span class="linenum">3146</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT DISTINCT r.id, r.name, r.shortname, r.sortorder, rn.name AS coursealias
<a name="l3147"><span class="linenum">3147</span></a>                FROM {role_assignments} ra, {role} r
<a name="l3148"><span class="linenum">3148</span></a>           LEFT JOIN {role_names} rn <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (rn.contextid = :coursecontext AND rn.roleid = r.id)
<a name="l3149"><span class="linenum">3149</span></a>               WHERE r.id = ra.roleid
<a name="l3150"><span class="linenum">3150</span></a>                     AND ra.contextid <a class="var it25186" onMouseOver="hilite(25186)" onMouseOut="lolite()" onClick="logVariable('contextlist')" href="../_variables/contextlist.html">$contextlist</a>
<a name="l3151"><span class="linenum">3151</span></a>                     AND r.id <a class="var it28846" onMouseOver="hilite(28846)" onMouseOut="lolite()" onClick="logVariable('rallowed')" href="../_variables/rallowed.html">$rallowed</a>
<a name="l3152"><span class="linenum">3152</span></a>                     AND ra.userid = :userid
<a name="l3153"><span class="linenum">3153</span></a>            ORDER BY r.sortorder ASC&quot;;
<a name="l3154"><span class="linenum">3154</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['userid'] = <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>;
<a name="l3155"><span class="linenum">3155</span></a>  
<a name="l3156"><span class="linenum">3156</span></a>      <a class="var it28847" onMouseOver="hilite(28847)" onMouseOut="lolite()" onClick="logVariable('rolestring')" href="../_variables/rolestring.html">$rolestring</a> = '';
<a name="l3157"><span class="linenum">3157</span></a>  
<a name="l3158"><span class="linenum">3158</span></a>      if (<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>)) {
<a name="l3159"><span class="linenum">3159</span></a>          <a class="var it5777" onMouseOver="hilite(5777)" onMouseOut="lolite()" onClick="logVariable('rolenames')" href="../_variables/rolenames.html">$rolenames</a> = <a class="function" onClick="logFunction('role_fix_names')" href="../_functions/role_fix_names.html" onMouseOver="funcPopup(event,'role_fix_names')">role_fix_names</a>(<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="constant" onClick="logConstant('ROLENAME_ALIAS')" href="../_constants/ROLENAME_ALIAS.html" onMouseOver="constPopup(event,'ROLENAME_ALIAS')">ROLENAME_ALIAS</a>, true);   <span class="comment">// Substitute aliases</span>
<a name="l3160"><span class="linenum">3160</span></a>  
<a name="l3161"><span class="linenum">3161</span></a>          foreach (<a class="var it5777" onMouseOver="hilite(5777)" onMouseOut="lolite()" onClick="logVariable('rolenames')" href="../_variables/rolenames.html">$rolenames</a> as <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a> =&gt; <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('rolename')" href="../_variables/rolename.html">$rolename</a>) {
<a name="l3162"><span class="linenum">3162</span></a>              <a class="var it5777" onMouseOver="hilite(5777)" onMouseOut="lolite()" onClick="logVariable('rolenames')" href="../_variables/rolenames.html">$rolenames</a>[<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>] = '&lt;a href=&quot;'.<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('wwwroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/wwwroot.html">wwwroot</a>.'/user/index.php?contextid='.<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>.'&amp;amp;roleid='.<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>.'&quot;&gt;'.<a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('rolename')" href="../_variables/rolename.html">$rolename</a>.'&lt;/a&gt;';
<a name="l3163"><span class="linenum">3163</span></a>          }
<a name="l3164"><span class="linenum">3164</span></a>          <a class="var it28847" onMouseOver="hilite(28847)" onMouseOut="lolite()" onClick="logVariable('rolestring')" href="../_variables/rolestring.html">$rolestring</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',', <a class="var it5777" onMouseOver="hilite(5777)" onMouseOut="lolite()" onClick="logVariable('rolenames')" href="../_variables/rolenames.html">$rolenames</a>);
<a name="l3165"><span class="linenum">3165</span></a>      }
<a name="l3166"><span class="linenum">3166</span></a>  
<a name="l3167"><span class="linenum">3167</span></a>      return <a class="var it28847" onMouseOver="hilite(28847)" onMouseOut="lolite()" onClick="logVariable('rolestring')" href="../_variables/rolestring.html">$rolestring</a>;
<a name="l3168"><span class="linenum">3168</span></a>  }
<a name="l3169"><span class="linenum">3169</span></a>  
<a name="l3170"><span class="linenum">3170</span></a>  <span class="comment">/**</span>
<a name="l3171"><span class="linenum">3171</span></a>  <span class="comment"> * Checks if a user can assign users to a particular role in this context</span>
<a name="l3172"><span class="linenum">3172</span></a>  <span class="comment"> *</span>
<a name="l3173"><span class="linenum">3173</span></a>  <span class="comment"> * @param context $context</span>
<a name="l3174"><span class="linenum">3174</span></a>  <span class="comment"> * @param int $targetroleid - the id of the role you want to assign users to</span>
<a name="l3175"><span class="linenum">3175</span></a>  <span class="comment"> * @return boolean</span>
<a name="l3176"><span class="linenum">3176</span></a>  <span class="comment"> */</span>
<a name="l3177"><span class="linenum">3177</span></a>  function <a class="function" onClick="logFunction('user_can_assign')" href="../_functions/user_can_assign.html" onMouseOver="funcPopup(event,'user_can_assign')">user_can_assign</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it12377" onMouseOver="hilite(12377)" onMouseOut="lolite()" onClick="logVariable('targetroleid')" href="../_variables/targetroleid.html">$targetroleid</a>) {
<a name="l3178"><span class="linenum">3178</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l3179"><span class="linenum">3179</span></a>  
<a name="l3180"><span class="linenum">3180</span></a>  <span class="comment">    // First check to see if the user is a site administrator.</span>
<a name="l3181"><span class="linenum">3181</span></a>      if (<a class="function" onClick="logFunction('is_siteadmin')" href="../_functions/is_siteadmin.html" onMouseOver="funcPopup(event,'is_siteadmin')">is_siteadmin</a>()) {
<a name="l3182"><span class="linenum">3182</span></a>          return true;
<a name="l3183"><span class="linenum">3183</span></a>      }
<a name="l3184"><span class="linenum">3184</span></a>  
<a name="l3185"><span class="linenum">3185</span></a>  <span class="comment">    // Check if user has override capability.</span>
<a name="l3186"><span class="linenum">3186</span></a>  <span class="comment">    // If not return false.</span>
<a name="l3187"><span class="linenum">3187</span></a>      if (!<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/role:assign', <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>)) {
<a name="l3188"><span class="linenum">3188</span></a>          return false;
<a name="l3189"><span class="linenum">3189</span></a>      }
<a name="l3190"><span class="linenum">3190</span></a>  <span class="comment">    // pull out all active roles of this user from this context(or above)</span>
<a name="l3191"><span class="linenum">3191</span></a>      if (<a class="var it3166" onMouseOver="hilite(3166)" onMouseOut="lolite()" onClick="logVariable('userroles')" href="../_variables/userroles.html">$userroles</a> = <a class="function" onClick="logFunction('get_user_roles')" href="../_functions/get_user_roles.html" onMouseOver="funcPopup(event,'get_user_roles')">get_user_roles</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>)) {
<a name="l3192"><span class="linenum">3192</span></a>          foreach (<a class="var it3166" onMouseOver="hilite(3166)" onMouseOut="lolite()" onClick="logVariable('userroles')" href="../_variables/userroles.html">$userroles</a> as <a class="var it23801" onMouseOver="hilite(23801)" onMouseOut="lolite()" onClick="logVariable('userrole')" href="../_variables/userrole.html">$userrole</a>) {
<a name="l3193"><span class="linenum">3193</span></a>  <span class="comment">            // if any in the role_allow_override table, then it's ok</span>
<a name="l3194"><span class="linenum">3194</span></a>              if (<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('role_allow_assign', array('roleid'=&gt;<a class="var it23801" onMouseOver="hilite(23801)" onMouseOut="lolite()" onClick="logVariable('userrole')" href="../_variables/userrole.html">$userrole</a>-&gt;<a onClick="logVariable('roleid')" class="var it40898" onMouseOver="hilite(40898)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>, 'allowassign'=&gt;<a class="var it12377" onMouseOver="hilite(12377)" onMouseOut="lolite()" onClick="logVariable('targetroleid')" href="../_variables/targetroleid.html">$targetroleid</a>))) {
<a name="l3195"><span class="linenum">3195</span></a>                  return true;
<a name="l3196"><span class="linenum">3196</span></a>              }
<a name="l3197"><span class="linenum">3197</span></a>          }
<a name="l3198"><span class="linenum">3198</span></a>      }
<a name="l3199"><span class="linenum">3199</span></a>  
<a name="l3200"><span class="linenum">3200</span></a>      return false;
<a name="l3201"><span class="linenum">3201</span></a>  }
<a name="l3202"><span class="linenum">3202</span></a>  
<a name="l3203"><span class="linenum">3203</span></a>  <span class="comment">/**</span>
<a name="l3204"><span class="linenum">3204</span></a>  <span class="comment"> * Returns all site roles in correct sort order.</span>
<a name="l3205"><span class="linenum">3205</span></a>  <span class="comment"> *</span>
<a name="l3206"><span class="linenum">3206</span></a>  <span class="comment"> * Note: this method does not localise role names or descriptions,</span>
<a name="l3207"><span class="linenum">3207</span></a>  <span class="comment"> *       use role_get_names() if you need role names.</span>
<a name="l3208"><span class="linenum">3208</span></a>  <span class="comment"> *</span>
<a name="l3209"><span class="linenum">3209</span></a>  <span class="comment"> * @param context $context optional context for course role name aliases</span>
<a name="l3210"><span class="linenum">3210</span></a>  <span class="comment"> * @return array of role records with optional coursealias property</span>
<a name="l3211"><span class="linenum">3211</span></a>  <span class="comment"> */</span>
<a name="l3212"><span class="linenum">3212</span></a>  function <a class="function" onClick="logFunction('get_all_roles')" href="../_functions/get_all_roles.html" onMouseOver="funcPopup(event,'get_all_roles')">get_all_roles</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = null) {
<a name="l3213"><span class="linenum">3213</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l3214"><span class="linenum">3214</span></a>  
<a name="l3215"><span class="linenum">3215</span></a>      if (!<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> or !<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_course_context')" href="../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>(false)) {
<a name="l3216"><span class="linenum">3216</span></a>          <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = null;
<a name="l3217"><span class="linenum">3217</span></a>      }
<a name="l3218"><span class="linenum">3218</span></a>  
<a name="l3219"><span class="linenum">3219</span></a>      if (<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>) {
<a name="l3220"><span class="linenum">3220</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT r.*, rn.name AS coursealias
<a name="l3221"><span class="linenum">3221</span></a>                    FROM {role} r
<a name="l3222"><span class="linenum">3222</span></a>               LEFT JOIN {role_names} rn <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (rn.contextid = :coursecontext AND rn.roleid = r.id)
<a name="l3223"><span class="linenum">3223</span></a>                ORDER BY r.sortorder ASC&quot;;
<a name="l3224"><span class="linenum">3224</span></a>          return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, array('coursecontext'=&gt;<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('id')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l3225"><span class="linenum">3225</span></a>  
<a name="l3226"><span class="linenum">3226</span></a>      } else {
<a name="l3227"><span class="linenum">3227</span></a>          return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('role', array(), 'sortorder ASC');
<a name="l3228"><span class="linenum">3228</span></a>      }
<a name="l3229"><span class="linenum">3229</span></a>  }
<a name="l3230"><span class="linenum">3230</span></a>  
<a name="l3231"><span class="linenum">3231</span></a>  <span class="comment">/**</span>
<a name="l3232"><span class="linenum">3232</span></a>  <span class="comment"> * Returns roles of a specified archetype</span>
<a name="l3233"><span class="linenum">3233</span></a>  <span class="comment"> *</span>
<a name="l3234"><span class="linenum">3234</span></a>  <span class="comment"> * @param string $archetype</span>
<a name="l3235"><span class="linenum">3235</span></a>  <span class="comment"> * @return array of full role records</span>
<a name="l3236"><span class="linenum">3236</span></a>  <span class="comment"> */</span>
<a name="l3237"><span class="linenum">3237</span></a>  function <a class="function" onClick="logFunction('get_archetype_roles')" href="../_functions/get_archetype_roles.html" onMouseOver="funcPopup(event,'get_archetype_roles')">get_archetype_roles</a>(<a class="var it7279" onMouseOver="hilite(7279)" onMouseOut="lolite()" onClick="logVariable('archetype')" href="../_variables/archetype.html">$archetype</a>) {
<a name="l3238"><span class="linenum">3238</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l3239"><span class="linenum">3239</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('role', array('archetype'=&gt;<a class="var it7279" onMouseOver="hilite(7279)" onMouseOut="lolite()" onClick="logVariable('archetype')" href="../_variables/archetype.html">$archetype</a>), 'sortorder ASC');
<a name="l3240"><span class="linenum">3240</span></a>  }
<a name="l3241"><span class="linenum">3241</span></a>  
<a name="l3242"><span class="linenum">3242</span></a>  <span class="comment">/**</span>
<a name="l3243"><span class="linenum">3243</span></a>  <span class="comment"> * Gets all the user roles assigned in this context, or higher contexts</span>
<a name="l3244"><span class="linenum">3244</span></a>  <span class="comment"> * this is mainly used when checking if a user can assign a role, or overriding a role</span>
<a name="l3245"><span class="linenum">3245</span></a>  <span class="comment"> * i.e. we need to know what this user holds, in order to verify against allow_assign and</span>
<a name="l3246"><span class="linenum">3246</span></a>  <span class="comment"> * allow_override tables</span>
<a name="l3247"><span class="linenum">3247</span></a>  <span class="comment"> *</span>
<a name="l3248"><span class="linenum">3248</span></a>  <span class="comment"> * @param context $context</span>
<a name="l3249"><span class="linenum">3249</span></a>  <span class="comment"> * @param int $userid</span>
<a name="l3250"><span class="linenum">3250</span></a>  <span class="comment"> * @param bool $checkparentcontexts defaults to true</span>
<a name="l3251"><span class="linenum">3251</span></a>  <span class="comment"> * @param string $order defaults to 'c.contextlevel DESC, r.sortorder ASC'</span>
<a name="l3252"><span class="linenum">3252</span></a>  <span class="comment"> * @return array</span>
<a name="l3253"><span class="linenum">3253</span></a>  <span class="comment"> */</span>
<a name="l3254"><span class="linenum">3254</span></a>  function <a class="function" onClick="logFunction('get_user_roles')" href="../_functions/get_user_roles.html" onMouseOver="funcPopup(event,'get_user_roles')">get_user_roles</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> = 0, <a class="var it28848" onMouseOver="hilite(28848)" onMouseOut="lolite()" onClick="logVariable('checkparentcontexts')" href="../_variables/checkparentcontexts.html">$checkparentcontexts</a> = true, <a class="var it2283" onMouseOver="hilite(2283)" onMouseOut="lolite()" onClick="logVariable('order')" href="../_variables/order.html">$order</a> = 'c.contextlevel DESC, r.sortorder ASC') {
<a name="l3255"><span class="linenum">3255</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l3256"><span class="linenum">3256</span></a>  
<a name="l3257"><span class="linenum">3257</span></a>      if (empty(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>)) {
<a name="l3258"><span class="linenum">3258</span></a>          if (empty(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>)) {
<a name="l3259"><span class="linenum">3259</span></a>              return array();
<a name="l3260"><span class="linenum">3260</span></a>          }
<a name="l3261"><span class="linenum">3261</span></a>          <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l3262"><span class="linenum">3262</span></a>      }
<a name="l3263"><span class="linenum">3263</span></a>  
<a name="l3264"><span class="linenum">3264</span></a>      if (<a class="var it28848" onMouseOver="hilite(28848)" onMouseOut="lolite()" onClick="logVariable('checkparentcontexts')" href="../_variables/checkparentcontexts.html">$checkparentcontexts</a>) {
<a name="l3265"><span class="linenum">3265</span></a>          <a class="var it12554" onMouseOver="hilite(12554)" onMouseOut="lolite()" onClick="logVariable('contextids')" href="../_variables/contextids.html">$contextids</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_parent_context_ids')" href="../_functions/get_parent_context_ids.html" onMouseOver="funcPopup(event,'get_parent_context_ids')">get_parent_context_ids</a>();
<a name="l3266"><span class="linenum">3266</span></a>      } else {
<a name="l3267"><span class="linenum">3267</span></a>          <a class="var it12554" onMouseOver="hilite(12554)" onMouseOut="lolite()" onClick="logVariable('contextids')" href="../_variables/contextids.html">$contextids</a> = array();
<a name="l3268"><span class="linenum">3268</span></a>      }
<a name="l3269"><span class="linenum">3269</span></a>      <a class="var it12554" onMouseOver="hilite(12554)" onMouseOut="lolite()" onClick="logVariable('contextids')" href="../_variables/contextids.html">$contextids</a>[] = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l3270"><span class="linenum">3270</span></a>  
<a name="l3271"><span class="linenum">3271</span></a>      <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it12554" onMouseOver="hilite(12554)" onMouseOut="lolite()" onClick="logVariable('contextids')" href="../_variables/contextids.html">$contextids</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it12554" onMouseOver="hilite(12554)" onMouseOut="lolite()" onClick="logVariable('contextids')" href="../_variables/contextids.html">$contextids</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_QM')" href="../_constants/SQL_PARAMS_QM.html" onMouseOver="constPopup(event,'SQL_PARAMS_QM')">SQL_PARAMS_QM</a>);
<a name="l3272"><span class="linenum">3272</span></a>  
<a name="l3273"><span class="linenum">3273</span></a>      <a class="phpfunction" onClick="logFunction('array_unshift')" href="../_functions/array_unshift.html" onMouseOver="phpfuncPopup(event,'array_unshift')">array_unshift</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>);
<a name="l3274"><span class="linenum">3274</span></a>  
<a name="l3275"><span class="linenum">3275</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT ra.*, r.name, r.shortname
<a name="l3276"><span class="linenum">3276</span></a>                FROM {role_assignments} ra, {role} r, {context} c
<a name="l3277"><span class="linenum">3277</span></a>               WHERE ra.userid = ?
<a name="l3278"><span class="linenum">3278</span></a>                     AND ra.roleid = r.id
<a name="l3279"><span class="linenum">3279</span></a>                     AND ra.contextid = c.id
<a name="l3280"><span class="linenum">3280</span></a>                     AND ra.contextid <a class="var it12554" onMouseOver="hilite(12554)" onMouseOut="lolite()" onClick="logVariable('contextids')" href="../_variables/contextids.html">$contextids</a>
<a name="l3281"><span class="linenum">3281</span></a>            ORDER BY <a class="var it2283" onMouseOver="hilite(2283)" onMouseOut="lolite()" onClick="logVariable('order')" href="../_variables/order.html">$order</a>&quot;;
<a name="l3282"><span class="linenum">3282</span></a>  
<a name="l3283"><span class="linenum">3283</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> ,<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l3284"><span class="linenum">3284</span></a>  }
<a name="l3285"><span class="linenum">3285</span></a>  
<a name="l3286"><span class="linenum">3286</span></a>  <span class="comment">/**</span>
<a name="l3287"><span class="linenum">3287</span></a>  <span class="comment"> * Like get_user_roles, but adds in the authenticated user role, and the front</span>
<a name="l3288"><span class="linenum">3288</span></a>  <span class="comment"> * page roles, if applicable.</span>
<a name="l3289"><span class="linenum">3289</span></a>  <span class="comment"> *</span>
<a name="l3290"><span class="linenum">3290</span></a>  <span class="comment"> * @param context $context the context.</span>
<a name="l3291"><span class="linenum">3291</span></a>  <span class="comment"> * @param int $userid optional. Defaults to $USER-&gt;id</span>
<a name="l3292"><span class="linenum">3292</span></a>  <span class="comment"> * @return array of objects with fields -&gt;userid, -&gt;contextid and -&gt;roleid.</span>
<a name="l3293"><span class="linenum">3293</span></a>  <span class="comment"> */</span>
<a name="l3294"><span class="linenum">3294</span></a>  function <a class="function" onClick="logFunction('get_user_roles_with_special')" href="../_functions/get_user_roles_with_special.html" onMouseOver="funcPopup(event,'get_user_roles_with_special')">get_user_roles_with_special</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> = 0) {
<a name="l3295"><span class="linenum">3295</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l3296"><span class="linenum">3296</span></a>  
<a name="l3297"><span class="linenum">3297</span></a>      if (empty(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>)) {
<a name="l3298"><span class="linenum">3298</span></a>          if (empty(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>)) {
<a name="l3299"><span class="linenum">3299</span></a>              return array();
<a name="l3300"><span class="linenum">3300</span></a>          }
<a name="l3301"><span class="linenum">3301</span></a>          <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l3302"><span class="linenum">3302</span></a>      }
<a name="l3303"><span class="linenum">3303</span></a>  
<a name="l3304"><span class="linenum">3304</span></a>      <a class="var it11181" onMouseOver="hilite(11181)" onMouseOut="lolite()" onClick="logVariable('ras')" href="../_variables/ras.html">$ras</a> = <a class="function" onClick="logFunction('get_user_roles')" href="../_functions/get_user_roles.html" onMouseOver="funcPopup(event,'get_user_roles')">get_user_roles</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>);
<a name="l3305"><span class="linenum">3305</span></a>  
<a name="l3306"><span class="linenum">3306</span></a>  <span class="comment">    // Add front-page role if relevant.</span>
<a name="l3307"><span class="linenum">3307</span></a>      <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('defaultfrontpageroleid')" href="../_variables/defaultfrontpageroleid.html">$defaultfrontpageroleid</a> = isset(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultfrontpageroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultfrontpageroleid.html">defaultfrontpageroleid</a>) ? <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultfrontpageroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultfrontpageroleid.html">defaultfrontpageroleid</a> : 0;
<a name="l3308"><span class="linenum">3308</span></a>      <a class="var it5773" onMouseOver="hilite(5773)" onMouseOut="lolite()" onClick="logVariable('isfrontpage')" href="../_variables/isfrontpage.html">$isfrontpage</a> = (<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> == <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a> &amp;&amp; <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a> == <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>) ||
<a name="l3309"><span class="linenum">3309</span></a>              <a class="function" onClick="logFunction('is_inside_frontpage')" href="../_functions/is_inside_frontpage.html" onMouseOver="funcPopup(event,'is_inside_frontpage')">is_inside_frontpage</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l3310"><span class="linenum">3310</span></a>      if (<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('defaultfrontpageroleid')" href="../_variables/defaultfrontpageroleid.html">$defaultfrontpageroleid</a> &amp;&amp; <a class="var it5773" onMouseOver="hilite(5773)" onMouseOut="lolite()" onClick="logVariable('isfrontpage')" href="../_variables/isfrontpage.html">$isfrontpage</a>) {
<a name="l3311"><span class="linenum">3311</span></a>          <a class="var it17355" onMouseOver="hilite(17355)" onMouseOut="lolite()" onClick="logVariable('frontpagecontext')" href="../_variables/frontpagecontext.html">$frontpagecontext</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>);
<a name="l3312"><span class="linenum">3312</span></a>          <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a> = new stdClass();
<a name="l3313"><span class="linenum">3313</span></a>          <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('userid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a> = <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>;
<a name="l3314"><span class="linenum">3314</span></a>          <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('contextid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/contextid.html">contextid</a> = <a class="var it17355" onMouseOver="hilite(17355)" onMouseOut="lolite()" onClick="logVariable('frontpagecontext')" href="../_variables/frontpagecontext.html">$frontpagecontext</a>-&gt;<a onClick="logVariable('id')" class="var it40980" onMouseOver="hilite(40980)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l3315"><span class="linenum">3315</span></a>          <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('roleid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a> = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('defaultfrontpageroleid')" href="../_variables/defaultfrontpageroleid.html">$defaultfrontpageroleid</a>;
<a name="l3316"><span class="linenum">3316</span></a>          <a class="var it11181" onMouseOver="hilite(11181)" onMouseOut="lolite()" onClick="logVariable('ras')" href="../_variables/ras.html">$ras</a>[] = <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>;
<a name="l3317"><span class="linenum">3317</span></a>      }
<a name="l3318"><span class="linenum">3318</span></a>  
<a name="l3319"><span class="linenum">3319</span></a>  <span class="comment">    // Add authenticated user role if relevant.</span>
<a name="l3320"><span class="linenum">3320</span></a>      <a class="var it16422" onMouseOver="hilite(16422)" onMouseOut="lolite()" onClick="logVariable('defaultuserroleid')" href="../_variables/defaultuserroleid.html">$defaultuserroleid</a>      = isset(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultuserroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultuserroleid.html">defaultuserroleid</a>) ? <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultuserroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultuserroleid.html">defaultuserroleid</a> : 0;
<a name="l3321"><span class="linenum">3321</span></a>      if (<a class="var it16422" onMouseOver="hilite(16422)" onMouseOut="lolite()" onClick="logVariable('defaultuserroleid')" href="../_variables/defaultuserroleid.html">$defaultuserroleid</a> &amp;&amp; !<a class="function" onClick="logFunction('isguestuser')" href="../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>)) {
<a name="l3322"><span class="linenum">3322</span></a>          <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('systemcontext')" href="../_variables/systemcontext.html">$systemcontext</a> = <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l3323"><span class="linenum">3323</span></a>          <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a> = new stdClass();
<a name="l3324"><span class="linenum">3324</span></a>          <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('userid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a> = <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>;
<a name="l3325"><span class="linenum">3325</span></a>          <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('contextid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/contextid.html">contextid</a> = <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('systemcontext')" href="../_variables/systemcontext.html">$systemcontext</a>-&gt;<a onClick="logVariable('id')" class="var it39845" onMouseOver="hilite(39845)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l3326"><span class="linenum">3326</span></a>          <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>-&gt;<a onClick="logVariable('roleid')" class="var it39595" onMouseOver="hilite(39595)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a> = <a class="var it16422" onMouseOver="hilite(16422)" onMouseOut="lolite()" onClick="logVariable('defaultuserroleid')" href="../_variables/defaultuserroleid.html">$defaultuserroleid</a>;
<a name="l3327"><span class="linenum">3327</span></a>          <a class="var it11181" onMouseOver="hilite(11181)" onMouseOut="lolite()" onClick="logVariable('ras')" href="../_variables/ras.html">$ras</a>[] = <a class="var it5778" onMouseOver="hilite(5778)" onMouseOut="lolite()" onClick="logVariable('ra')" href="../_variables/ra.html">$ra</a>;
<a name="l3328"><span class="linenum">3328</span></a>      }
<a name="l3329"><span class="linenum">3329</span></a>  
<a name="l3330"><span class="linenum">3330</span></a>      return <a class="var it11181" onMouseOver="hilite(11181)" onMouseOut="lolite()" onClick="logVariable('ras')" href="../_variables/ras.html">$ras</a>;
<a name="l3331"><span class="linenum">3331</span></a>  }
<a name="l3332"><span class="linenum">3332</span></a>  
<a name="l3333"><span class="linenum">3333</span></a>  <span class="comment">/**</span>
<a name="l3334"><span class="linenum">3334</span></a>  <span class="comment"> * Creates a record in the role_allow_override table</span>
<a name="l3335"><span class="linenum">3335</span></a>  <span class="comment"> *</span>
<a name="l3336"><span class="linenum">3336</span></a>  <span class="comment"> * @param int $sroleid source roleid</span>
<a name="l3337"><span class="linenum">3337</span></a>  <span class="comment"> * @param int $troleid target roleid</span>
<a name="l3338"><span class="linenum">3338</span></a>  <span class="comment"> * @return void</span>
<a name="l3339"><span class="linenum">3339</span></a>  <span class="comment"> */</span>
<a name="l3340"><span class="linenum">3340</span></a>  function <a class="function" onClick="logFunction('allow_override')" href="../_functions/allow_override.html" onMouseOver="funcPopup(event,'allow_override')">allow_override</a>(<a class="var it28849" onMouseOver="hilite(28849)" onMouseOut="lolite()" onClick="logVariable('sroleid')" href="../_variables/sroleid.html">$sroleid</a>, <a class="var it28850" onMouseOver="hilite(28850)" onMouseOut="lolite()" onClick="logVariable('troleid')" href="../_variables/troleid.html">$troleid</a>) {
<a name="l3341"><span class="linenum">3341</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l3342"><span class="linenum">3342</span></a>  
<a name="l3343"><span class="linenum">3343</span></a>      <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = new stdClass();
<a name="l3344"><span class="linenum">3344</span></a>      <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('roleid')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>        = <a class="var it28849" onMouseOver="hilite(28849)" onMouseOut="lolite()" onClick="logVariable('sroleid')" href="../_variables/sroleid.html">$sroleid</a>;
<a name="l3345"><span class="linenum">3345</span></a>      <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('allowoverride')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/allowoverride.html">allowoverride</a> = <a class="var it28850" onMouseOver="hilite(28850)" onMouseOut="lolite()" onClick="logVariable('troleid')" href="../_variables/troleid.html">$troleid</a>;
<a name="l3346"><span class="linenum">3346</span></a>      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('role_allow_override', <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l3347"><span class="linenum">3347</span></a>  }
<a name="l3348"><span class="linenum">3348</span></a>  
<a name="l3349"><span class="linenum">3349</span></a>  <span class="comment">/**</span>
<a name="l3350"><span class="linenum">3350</span></a>  <span class="comment"> * Creates a record in the role_allow_assign table</span>
<a name="l3351"><span class="linenum">3351</span></a>  <span class="comment"> *</span>
<a name="l3352"><span class="linenum">3352</span></a>  <span class="comment"> * @param int $fromroleid source roleid</span>
<a name="l3353"><span class="linenum">3353</span></a>  <span class="comment"> * @param int $targetroleid target roleid</span>
<a name="l3354"><span class="linenum">3354</span></a>  <span class="comment"> * @return void</span>
<a name="l3355"><span class="linenum">3355</span></a>  <span class="comment"> */</span>
<a name="l3356"><span class="linenum">3356</span></a>  function <a class="function" onClick="logFunction('allow_assign')" href="../_functions/allow_assign.html" onMouseOver="funcPopup(event,'allow_assign')">allow_assign</a>(<a class="var it12376" onMouseOver="hilite(12376)" onMouseOut="lolite()" onClick="logVariable('fromroleid')" href="../_variables/fromroleid.html">$fromroleid</a>, <a class="var it12377" onMouseOver="hilite(12377)" onMouseOut="lolite()" onClick="logVariable('targetroleid')" href="../_variables/targetroleid.html">$targetroleid</a>) {
<a name="l3357"><span class="linenum">3357</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l3358"><span class="linenum">3358</span></a>  
<a name="l3359"><span class="linenum">3359</span></a>      <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = new stdClass();
<a name="l3360"><span class="linenum">3360</span></a>      <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('roleid')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>      = <a class="var it12376" onMouseOver="hilite(12376)" onMouseOut="lolite()" onClick="logVariable('fromroleid')" href="../_variables/fromroleid.html">$fromroleid</a>;
<a name="l3361"><span class="linenum">3361</span></a>      <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('allowassign')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/allowassign.html">allowassign</a> = <a class="var it12377" onMouseOver="hilite(12377)" onMouseOut="lolite()" onClick="logVariable('targetroleid')" href="../_variables/targetroleid.html">$targetroleid</a>;
<a name="l3362"><span class="linenum">3362</span></a>      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('role_allow_assign', <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l3363"><span class="linenum">3363</span></a>  }
<a name="l3364"><span class="linenum">3364</span></a>  
<a name="l3365"><span class="linenum">3365</span></a>  <span class="comment">/**</span>
<a name="l3366"><span class="linenum">3366</span></a>  <span class="comment"> * Creates a record in the role_allow_switch table</span>
<a name="l3367"><span class="linenum">3367</span></a>  <span class="comment"> *</span>
<a name="l3368"><span class="linenum">3368</span></a>  <span class="comment"> * @param int $fromroleid source roleid</span>
<a name="l3369"><span class="linenum">3369</span></a>  <span class="comment"> * @param int $targetroleid target roleid</span>
<a name="l3370"><span class="linenum">3370</span></a>  <span class="comment"> * @return void</span>
<a name="l3371"><span class="linenum">3371</span></a>  <span class="comment"> */</span>
<a name="l3372"><span class="linenum">3372</span></a>  function <a class="function" onClick="logFunction('allow_switch')" href="../_functions/allow_switch.html" onMouseOver="funcPopup(event,'allow_switch')">allow_switch</a>(<a class="var it12376" onMouseOver="hilite(12376)" onMouseOut="lolite()" onClick="logVariable('fromroleid')" href="../_variables/fromroleid.html">$fromroleid</a>, <a class="var it12377" onMouseOver="hilite(12377)" onMouseOut="lolite()" onClick="logVariable('targetroleid')" href="../_variables/targetroleid.html">$targetroleid</a>) {
<a name="l3373"><span class="linenum">3373</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l3374"><span class="linenum">3374</span></a>  
<a name="l3375"><span class="linenum">3375</span></a>      <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = new stdClass();
<a name="l3376"><span class="linenum">3376</span></a>      <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('roleid')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>      = <a class="var it12376" onMouseOver="hilite(12376)" onMouseOut="lolite()" onClick="logVariable('fromroleid')" href="../_variables/fromroleid.html">$fromroleid</a>;
<a name="l3377"><span class="linenum">3377</span></a>      <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('allowswitch')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/allowswitch.html">allowswitch</a> = <a class="var it12377" onMouseOver="hilite(12377)" onMouseOut="lolite()" onClick="logVariable('targetroleid')" href="../_variables/targetroleid.html">$targetroleid</a>;
<a name="l3378"><span class="linenum">3378</span></a>      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('role_allow_switch', <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l3379"><span class="linenum">3379</span></a>  }
<a name="l3380"><span class="linenum">3380</span></a>  
<a name="l3381"><span class="linenum">3381</span></a>  <span class="comment">/**</span>
<a name="l3382"><span class="linenum">3382</span></a>  <span class="comment"> * Gets a list of roles that this user can assign in this context</span>
<a name="l3383"><span class="linenum">3383</span></a>  <span class="comment"> *</span>
<a name="l3384"><span class="linenum">3384</span></a>  <span class="comment"> * @param context $context the context.</span>
<a name="l3385"><span class="linenum">3385</span></a>  <span class="comment"> * @param int $rolenamedisplay the type of role name to display. One of the</span>
<a name="l3386"><span class="linenum">3386</span></a>  <span class="comment"> *      ROLENAME_X constants. Default ROLENAME_ALIAS.</span>
<a name="l3387"><span class="linenum">3387</span></a>  <span class="comment"> * @param bool $withusercounts if true, count the number of users with each role.</span>
<a name="l3388"><span class="linenum">3388</span></a>  <span class="comment"> * @param integer|object $user A user id or object. By default (null) checks the permissions of the current user.</span>
<a name="l3389"><span class="linenum">3389</span></a>  <span class="comment"> * @return array if $withusercounts is false, then an array $roleid =&gt; $rolename.</span>
<a name="l3390"><span class="linenum">3390</span></a>  <span class="comment"> *      if $withusercounts is true, returns a list of three arrays,</span>
<a name="l3391"><span class="linenum">3391</span></a>  <span class="comment"> *      $rolenames, $rolecounts, and $nameswithcounts.</span>
<a name="l3392"><span class="linenum">3392</span></a>  <span class="comment"> */</span>
<a name="l3393"><span class="linenum">3393</span></a>  function <a class="function" onClick="logFunction('get_assignable_roles')" href="../_functions/get_assignable_roles.html" onMouseOver="funcPopup(event,'get_assignable_roles')">get_assignable_roles</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('rolenamedisplay')" href="../_variables/rolenamedisplay.html">$rolenamedisplay</a> = <a class="constant" onClick="logConstant('ROLENAME_ALIAS')" href="../_constants/ROLENAME_ALIAS.html" onMouseOver="constPopup(event,'ROLENAME_ALIAS')">ROLENAME_ALIAS</a>, <a class="var it28852" onMouseOver="hilite(28852)" onMouseOut="lolite()" onClick="logVariable('withusercounts')" href="../_variables/withusercounts.html">$withusercounts</a> = false, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = null) {
<a name="l3394"><span class="linenum">3394</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l3395"><span class="linenum">3395</span></a>  
<a name="l3396"><span class="linenum">3396</span></a>  <span class="comment">    // make sure there is a real user specified</span>
<a name="l3397"><span class="linenum">3397</span></a>      if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> === null) {
<a name="l3398"><span class="linenum">3398</span></a>          <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> = isset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) ? <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a> : 0;
<a name="l3399"><span class="linenum">3399</span></a>      } else {
<a name="l3400"><span class="linenum">3400</span></a>          <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> = <a class="phpfunction" onClick="logFunction('is_object')" href="../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) ? <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a> : <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>;
<a name="l3401"><span class="linenum">3401</span></a>      }
<a name="l3402"><span class="linenum">3402</span></a>  
<a name="l3403"><span class="linenum">3403</span></a>      if (!<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/role:assign', <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>)) {
<a name="l3404"><span class="linenum">3404</span></a>          if (<a class="var it28852" onMouseOver="hilite(28852)" onMouseOut="lolite()" onClick="logVariable('withusercounts')" href="../_variables/withusercounts.html">$withusercounts</a>) {
<a name="l3405"><span class="linenum">3405</span></a>              return array(array(), array(), array());
<a name="l3406"><span class="linenum">3406</span></a>          } else {
<a name="l3407"><span class="linenum">3407</span></a>              return array();
<a name="l3408"><span class="linenum">3408</span></a>          }
<a name="l3409"><span class="linenum">3409</span></a>      }
<a name="l3410"><span class="linenum">3410</span></a>  
<a name="l3411"><span class="linenum">3411</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array();
<a name="l3412"><span class="linenum">3412</span></a>      <a class="var it4833" onMouseOver="hilite(4833)" onMouseOut="lolite()" onClick="logVariable('extrafields')" href="../_variables/extrafields.html">$extrafields</a> = '';
<a name="l3413"><span class="linenum">3413</span></a>  
<a name="l3414"><span class="linenum">3414</span></a>      if (<a class="var it28852" onMouseOver="hilite(28852)" onMouseOut="lolite()" onClick="logVariable('withusercounts')" href="../_variables/withusercounts.html">$withusercounts</a>) {
<a name="l3415"><span class="linenum">3415</span></a>          <a class="var it4833" onMouseOver="hilite(4833)" onMouseOut="lolite()" onClick="logVariable('extrafields')" href="../_variables/extrafields.html">$extrafields</a> = ', (SELECT <a class="phpfunction" onClick="logFunction('count')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(u.id)
<a name="l3416"><span class="linenum">3416</span></a>                               FROM {role_assignments} cra JOIN {user} u ON cra.userid = u.id
<a name="l3417"><span class="linenum">3417</span></a>                              WHERE cra.roleid = r.id AND cra.contextid = :conid AND u.deleted = 0
<a name="l3418"><span class="linenum">3418</span></a>                            ) AS usercount';
<a name="l3419"><span class="linenum">3419</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['conid'] = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l3420"><span class="linenum">3420</span></a>      }
<a name="l3421"><span class="linenum">3421</span></a>  
<a name="l3422"><span class="linenum">3422</span></a>      if (<a class="function" onClick="logFunction('is_siteadmin')" href="../_functions/is_siteadmin.html" onMouseOver="funcPopup(event,'is_siteadmin')">is_siteadmin</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>)) {
<a name="l3423"><span class="linenum">3423</span></a>  <span class="comment">        // show all roles allowed in this context to admins</span>
<a name="l3424"><span class="linenum">3424</span></a>          <a class="var it28853" onMouseOver="hilite(28853)" onMouseOut="lolite()" onClick="logVariable('assignrestriction')" href="../_variables/assignrestriction.html">$assignrestriction</a> = &quot;&quot;;
<a name="l3425"><span class="linenum">3425</span></a>      } else {
<a name="l3426"><span class="linenum">3426</span></a>          <a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('parents')" href="../_variables/parents.html">$parents</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_parent_context_ids')" href="../_functions/get_parent_context_ids.html" onMouseOver="funcPopup(event,'get_parent_context_ids')">get_parent_context_ids</a>(true);
<a name="l3427"><span class="linenum">3427</span></a>          <a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../_variables/contexts.html">$contexts</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',' , <a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('parents')" href="../_variables/parents.html">$parents</a>);
<a name="l3428"><span class="linenum">3428</span></a>          <a class="var it28853" onMouseOver="hilite(28853)" onMouseOut="lolite()" onClick="logVariable('assignrestriction')" href="../_variables/assignrestriction.html">$assignrestriction</a> = &quot;<a class="function" onClick="logFunction('JOIN')" href="../_functions/join.html" onMouseOver="funcPopup(event,'join')">JOIN</a> (SELECT DISTINCT raa.allowassign AS id
<a name="l3429"><span class="linenum">3429</span></a>                                        FROM {role_allow_assign} raa
<a name="l3430"><span class="linenum">3430</span></a>                                        JOIN {role_assignments} ra ON ra.roleid = raa.roleid
<a name="l3431"><span class="linenum">3431</span></a>                                       WHERE ra.userid = :userid AND ra.contextid IN (<a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../_variables/contexts.html">$contexts</a>)
<a name="l3432"><span class="linenum">3432</span></a>                                     ) ar ON ar.id = r.id&quot;;
<a name="l3433"><span class="linenum">3433</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['userid'] = <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>;
<a name="l3434"><span class="linenum">3434</span></a>      }
<a name="l3435"><span class="linenum">3435</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['contextlevel'] = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a>;
<a name="l3436"><span class="linenum">3436</span></a>  
<a name="l3437"><span class="linenum">3437</span></a>      if (<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_course_context')" href="../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>(false)) {
<a name="l3438"><span class="linenum">3438</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['coursecontext'] = <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('id')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l3439"><span class="linenum">3439</span></a>      } else {
<a name="l3440"><span class="linenum">3440</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['coursecontext'] = 0; <span class="comment">// no course aliases</span>
<a name="l3441"><span class="linenum">3441</span></a>          <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = null;
<a name="l3442"><span class="linenum">3442</span></a>      }
<a name="l3443"><span class="linenum">3443</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT r.id, r.name, r.shortname, rn.name AS coursealias <a class="var it4833" onMouseOver="hilite(4833)" onMouseOut="lolite()" onClick="logVariable('extrafields')" href="../_variables/extrafields.html">$extrafields</a>
<a name="l3444"><span class="linenum">3444</span></a>                FROM {role} r
<a name="l3445"><span class="linenum">3445</span></a>                <a class="var it28853" onMouseOver="hilite(28853)" onMouseOut="lolite()" onClick="logVariable('assignrestriction')" href="../_variables/assignrestriction.html">$assignrestriction</a>
<a name="l3446"><span class="linenum">3446</span></a>                JOIN {role_context_levels} rcl <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (rcl.contextlevel = :contextlevel AND r.id = rcl.roleid)
<a name="l3447"><span class="linenum">3447</span></a>           LEFT JOIN {role_names} rn <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (rn.contextid = :coursecontext AND rn.roleid = r.id)
<a name="l3448"><span class="linenum">3448</span></a>            ORDER BY r.sortorder ASC&quot;;
<a name="l3449"><span class="linenum">3449</span></a>      <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l3450"><span class="linenum">3450</span></a>  
<a name="l3451"><span class="linenum">3451</span></a>      <a class="var it5777" onMouseOver="hilite(5777)" onMouseOut="lolite()" onClick="logVariable('rolenames')" href="../_variables/rolenames.html">$rolenames</a> = <a class="function" onClick="logFunction('role_fix_names')" href="../_functions/role_fix_names.html" onMouseOver="funcPopup(event,'role_fix_names')">role_fix_names</a>(<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>, <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>, <a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('rolenamedisplay')" href="../_variables/rolenamedisplay.html">$rolenamedisplay</a>, true);
<a name="l3452"><span class="linenum">3452</span></a>  
<a name="l3453"><span class="linenum">3453</span></a>      if (!<a class="var it28852" onMouseOver="hilite(28852)" onMouseOut="lolite()" onClick="logVariable('withusercounts')" href="../_variables/withusercounts.html">$withusercounts</a>) {
<a name="l3454"><span class="linenum">3454</span></a>          return <a class="var it5777" onMouseOver="hilite(5777)" onMouseOut="lolite()" onClick="logVariable('rolenames')" href="../_variables/rolenames.html">$rolenames</a>;
<a name="l3455"><span class="linenum">3455</span></a>      }
<a name="l3456"><span class="linenum">3456</span></a>  
<a name="l3457"><span class="linenum">3457</span></a>      <a class="var it22434" onMouseOver="hilite(22434)" onMouseOut="lolite()" onClick="logVariable('rolecounts')" href="../_variables/rolecounts.html">$rolecounts</a> = array();
<a name="l3458"><span class="linenum">3458</span></a>      <a class="var it16184" onMouseOver="hilite(16184)" onMouseOut="lolite()" onClick="logVariable('nameswithcounts')" href="../_variables/nameswithcounts.html">$nameswithcounts</a> = array();
<a name="l3459"><span class="linenum">3459</span></a>      foreach (<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a> as <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>) {
<a name="l3460"><span class="linenum">3460</span></a>          <a class="var it16184" onMouseOver="hilite(16184)" onMouseOut="lolite()" onClick="logVariable('nameswithcounts')" href="../_variables/nameswithcounts.html">$nameswithcounts</a>[<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('id')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="var it5777" onMouseOver="hilite(5777)" onMouseOut="lolite()" onClick="logVariable('rolenames')" href="../_variables/rolenames.html">$rolenames</a>[<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('id')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] . ' (' . <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>[<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('id')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/id.html">id</a>]-&gt;usercount . ')';
<a name="l3461"><span class="linenum">3461</span></a>          <a class="var it22434" onMouseOver="hilite(22434)" onMouseOut="lolite()" onClick="logVariable('rolecounts')" href="../_variables/rolecounts.html">$rolecounts</a>[<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('id')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>[<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('id')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/id.html">id</a>]-&gt;usercount;
<a name="l3462"><span class="linenum">3462</span></a>      }
<a name="l3463"><span class="linenum">3463</span></a>      return array(<a class="var it5777" onMouseOver="hilite(5777)" onMouseOut="lolite()" onClick="logVariable('rolenames')" href="../_variables/rolenames.html">$rolenames</a>, <a class="var it22434" onMouseOver="hilite(22434)" onMouseOut="lolite()" onClick="logVariable('rolecounts')" href="../_variables/rolecounts.html">$rolecounts</a>, <a class="var it16184" onMouseOver="hilite(16184)" onMouseOut="lolite()" onClick="logVariable('nameswithcounts')" href="../_variables/nameswithcounts.html">$nameswithcounts</a>);
<a name="l3464"><span class="linenum">3464</span></a>  }
<a name="l3465"><span class="linenum">3465</span></a>  
<a name="l3466"><span class="linenum">3466</span></a>  <span class="comment">/**</span>
<a name="l3467"><span class="linenum">3467</span></a>  <span class="comment"> * Gets a list of roles that this user can switch to in a context</span>
<a name="l3468"><span class="linenum">3468</span></a>  <span class="comment"> *</span>
<a name="l3469"><span class="linenum">3469</span></a>  <span class="comment"> * Gets a list of roles that this user can switch to in a context, for the switchrole menu.</span>
<a name="l3470"><span class="linenum">3470</span></a>  <span class="comment"> * This function just process the contents of the role_allow_switch table. You also need to</span>
<a name="l3471"><span class="linenum">3471</span></a>  <span class="comment"> * test the moodle/role:switchroles to see if the user is allowed to switch in the first place.</span>
<a name="l3472"><span class="linenum">3472</span></a>  <span class="comment"> *</span>
<a name="l3473"><span class="linenum">3473</span></a>  <span class="comment"> * @param context $context a context.</span>
<a name="l3474"><span class="linenum">3474</span></a>  <span class="comment"> * @return array an array $roleid =&gt; $rolename.</span>
<a name="l3475"><span class="linenum">3475</span></a>  <span class="comment"> */</span>
<a name="l3476"><span class="linenum">3476</span></a>  function <a class="function" onClick="logFunction('get_switchable_roles')" href="../_functions/get_switchable_roles.html" onMouseOver="funcPopup(event,'get_switchable_roles')">get_switchable_roles</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l3477"><span class="linenum">3477</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l3478"><span class="linenum">3478</span></a>  
<a name="l3479"><span class="linenum">3479</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array();
<a name="l3480"><span class="linenum">3480</span></a>      <a class="var it6683" onMouseOver="hilite(6683)" onMouseOut="lolite()" onClick="logVariable('extrajoins')" href="../_variables/extrajoins.html">$extrajoins</a> = '';
<a name="l3481"><span class="linenum">3481</span></a>      <a class="var it28854" onMouseOver="hilite(28854)" onMouseOut="lolite()" onClick="logVariable('extrawhere')" href="../_variables/extrawhere.html">$extrawhere</a> = '';
<a name="l3482"><span class="linenum">3482</span></a>      if (!<a class="function" onClick="logFunction('is_siteadmin')" href="../_functions/is_siteadmin.html" onMouseOver="funcPopup(event,'is_siteadmin')">is_siteadmin</a>()) {
<a name="l3483"><span class="linenum">3483</span></a>  <span class="comment">        // Admins are allowed to switch to any role with.</span>
<a name="l3484"><span class="linenum">3484</span></a>  <span class="comment">        // Others are subject to the additional constraint that the switch-to role must be allowed by</span>
<a name="l3485"><span class="linenum">3485</span></a>  <span class="comment">        // 'role_allow_switch' for some role they have assigned in this context or any parent.</span>
<a name="l3486"><span class="linenum">3486</span></a>          <a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('parents')" href="../_variables/parents.html">$parents</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_parent_context_ids')" href="../_functions/get_parent_context_ids.html" onMouseOver="funcPopup(event,'get_parent_context_ids')">get_parent_context_ids</a>(true);
<a name="l3487"><span class="linenum">3487</span></a>          <a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../_variables/contexts.html">$contexts</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',' , <a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('parents')" href="../_variables/parents.html">$parents</a>);
<a name="l3488"><span class="linenum">3488</span></a>  
<a name="l3489"><span class="linenum">3489</span></a>          <a class="var it6683" onMouseOver="hilite(6683)" onMouseOut="lolite()" onClick="logVariable('extrajoins')" href="../_variables/extrajoins.html">$extrajoins</a> = &quot;JOIN {role_allow_switch} ras ON ras.allowswitch = rc.roleid
<a name="l3490"><span class="linenum">3490</span></a>          JOIN {role_assignments} ra ON ra.roleid = ras.roleid&quot;;
<a name="l3491"><span class="linenum">3491</span></a>          <a class="var it28854" onMouseOver="hilite(28854)" onMouseOut="lolite()" onClick="logVariable('extrawhere')" href="../_variables/extrawhere.html">$extrawhere</a> = &quot;WHERE ra.userid = :userid AND ra.contextid IN (<a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../_variables/contexts.html">$contexts</a>)&quot;;
<a name="l3492"><span class="linenum">3492</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['userid'] = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l3493"><span class="linenum">3493</span></a>      }
<a name="l3494"><span class="linenum">3494</span></a>  
<a name="l3495"><span class="linenum">3495</span></a>      if (<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_course_context')" href="../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>(false)) {
<a name="l3496"><span class="linenum">3496</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['coursecontext'] = <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('id')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l3497"><span class="linenum">3497</span></a>      } else {
<a name="l3498"><span class="linenum">3498</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['coursecontext'] = 0; <span class="comment">// no course aliases</span>
<a name="l3499"><span class="linenum">3499</span></a>          <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = null;
<a name="l3500"><span class="linenum">3500</span></a>      }
<a name="l3501"><span class="linenum">3501</span></a>  
<a name="l3502"><span class="linenum">3502</span></a>      <a class="var it450" onMouseOver="hilite(450)" onMouseOut="lolite()" onClick="logVariable('query')" href="../_variables/query.html">$query</a> = &quot;
<a name="l3503"><span class="linenum">3503</span></a>          SELECT r.id, r.name, r.shortname, rn.name AS coursealias
<a name="l3504"><span class="linenum">3504</span></a>            <a class="function" onClick="logFunction('FROM')" href="../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a> (SELECT DISTINCT rc.roleid
<a name="l3505"><span class="linenum">3505</span></a>                    FROM {role_capabilities} rc
<a name="l3506"><span class="linenum">3506</span></a>                    <a class="var it6683" onMouseOver="hilite(6683)" onMouseOut="lolite()" onClick="logVariable('extrajoins')" href="../_variables/extrajoins.html">$extrajoins</a>
<a name="l3507"><span class="linenum">3507</span></a>                    <a class="var it28854" onMouseOver="hilite(28854)" onMouseOut="lolite()" onClick="logVariable('extrawhere')" href="../_variables/extrawhere.html">$extrawhere</a>) idlist
<a name="l3508"><span class="linenum">3508</span></a>            JOIN {role} r ON r.id = idlist.roleid
<a name="l3509"><span class="linenum">3509</span></a>       LEFT JOIN {role_names} rn <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (rn.contextid = :coursecontext AND rn.roleid = r.id)
<a name="l3510"><span class="linenum">3510</span></a>        ORDER BY r.sortorder&quot;;
<a name="l3511"><span class="linenum">3511</span></a>      <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it450" onMouseOver="hilite(450)" onMouseOut="lolite()" onClick="logVariable('query')" href="../_variables/query.html">$query</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l3512"><span class="linenum">3512</span></a>  
<a name="l3513"><span class="linenum">3513</span></a>      return <a class="function" onClick="logFunction('role_fix_names')" href="../_functions/role_fix_names.html" onMouseOver="funcPopup(event,'role_fix_names')">role_fix_names</a>(<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="constant" onClick="logConstant('ROLENAME_ALIAS')" href="../_constants/ROLENAME_ALIAS.html" onMouseOver="constPopup(event,'ROLENAME_ALIAS')">ROLENAME_ALIAS</a>, true);
<a name="l3514"><span class="linenum">3514</span></a>  }
<a name="l3515"><span class="linenum">3515</span></a>  
<a name="l3516"><span class="linenum">3516</span></a>  <span class="comment">/**</span>
<a name="l3517"><span class="linenum">3517</span></a>  <span class="comment"> * Gets a list of roles that this user can override in this context.</span>
<a name="l3518"><span class="linenum">3518</span></a>  <span class="comment"> *</span>
<a name="l3519"><span class="linenum">3519</span></a>  <span class="comment"> * @param context $context the context.</span>
<a name="l3520"><span class="linenum">3520</span></a>  <span class="comment"> * @param int $rolenamedisplay the type of role name to display. One of the</span>
<a name="l3521"><span class="linenum">3521</span></a>  <span class="comment"> *      ROLENAME_X constants. Default ROLENAME_ALIAS.</span>
<a name="l3522"><span class="linenum">3522</span></a>  <span class="comment"> * @param bool $withcounts if true, count the number of overrides that are set for each role.</span>
<a name="l3523"><span class="linenum">3523</span></a>  <span class="comment"> * @return array if $withcounts is false, then an array $roleid =&gt; $rolename.</span>
<a name="l3524"><span class="linenum">3524</span></a>  <span class="comment"> *      if $withusercounts is true, returns a list of three arrays,</span>
<a name="l3525"><span class="linenum">3525</span></a>  <span class="comment"> *      $rolenames, $rolecounts, and $nameswithcounts.</span>
<a name="l3526"><span class="linenum">3526</span></a>  <span class="comment"> */</span>
<a name="l3527"><span class="linenum">3527</span></a>  function <a class="function" onClick="logFunction('get_overridable_roles')" href="../_functions/get_overridable_roles.html" onMouseOver="funcPopup(event,'get_overridable_roles')">get_overridable_roles</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('rolenamedisplay')" href="../_variables/rolenamedisplay.html">$rolenamedisplay</a> = <a class="constant" onClick="logConstant('ROLENAME_ALIAS')" href="../_constants/ROLENAME_ALIAS.html" onMouseOver="constPopup(event,'ROLENAME_ALIAS')">ROLENAME_ALIAS</a>, <a class="var it28855" onMouseOver="hilite(28855)" onMouseOut="lolite()" onClick="logVariable('withcounts')" href="../_variables/withcounts.html">$withcounts</a> = false) {
<a name="l3528"><span class="linenum">3528</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l3529"><span class="linenum">3529</span></a>  
<a name="l3530"><span class="linenum">3530</span></a>      if (!<a class="function" onClick="logFunction('has_any_capability')" href="../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(array('moodle/role:safeoverride', 'moodle/role:override'), <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>)) {
<a name="l3531"><span class="linenum">3531</span></a>          if (<a class="var it28855" onMouseOver="hilite(28855)" onMouseOut="lolite()" onClick="logVariable('withcounts')" href="../_variables/withcounts.html">$withcounts</a>) {
<a name="l3532"><span class="linenum">3532</span></a>              return array(array(), array(), array());
<a name="l3533"><span class="linenum">3533</span></a>          } else {
<a name="l3534"><span class="linenum">3534</span></a>              return array();
<a name="l3535"><span class="linenum">3535</span></a>          }
<a name="l3536"><span class="linenum">3536</span></a>      }
<a name="l3537"><span class="linenum">3537</span></a>  
<a name="l3538"><span class="linenum">3538</span></a>      <a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('parents')" href="../_variables/parents.html">$parents</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_parent_context_ids')" href="../_functions/get_parent_context_ids.html" onMouseOver="funcPopup(event,'get_parent_context_ids')">get_parent_context_ids</a>(true);
<a name="l3539"><span class="linenum">3539</span></a>      <a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../_variables/contexts.html">$contexts</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',' , <a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('parents')" href="../_variables/parents.html">$parents</a>);
<a name="l3540"><span class="linenum">3540</span></a>  
<a name="l3541"><span class="linenum">3541</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array();
<a name="l3542"><span class="linenum">3542</span></a>      <a class="var it4833" onMouseOver="hilite(4833)" onMouseOut="lolite()" onClick="logVariable('extrafields')" href="../_variables/extrafields.html">$extrafields</a> = '';
<a name="l3543"><span class="linenum">3543</span></a>  
<a name="l3544"><span class="linenum">3544</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['userid'] = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l3545"><span class="linenum">3545</span></a>      if (<a class="var it28855" onMouseOver="hilite(28855)" onMouseOut="lolite()" onClick="logVariable('withcounts')" href="../_variables/withcounts.html">$withcounts</a>) {
<a name="l3546"><span class="linenum">3546</span></a>          <a class="var it4833" onMouseOver="hilite(4833)" onMouseOut="lolite()" onClick="logVariable('extrafields')" href="../_variables/extrafields.html">$extrafields</a> = ', (SELECT <a class="phpfunction" onClick="logFunction('COUNT')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(rc.id) FROM {role_capabilities} rc
<a name="l3547"><span class="linenum">3547</span></a>                  WHERE rc.roleid = ro.id AND rc.contextid = :conid) AS overridecount';
<a name="l3548"><span class="linenum">3548</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['conid'] = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l3549"><span class="linenum">3549</span></a>      }
<a name="l3550"><span class="linenum">3550</span></a>  
<a name="l3551"><span class="linenum">3551</span></a>      if (<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_course_context')" href="../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>(false)) {
<a name="l3552"><span class="linenum">3552</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['coursecontext'] = <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('id')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l3553"><span class="linenum">3553</span></a>      } else {
<a name="l3554"><span class="linenum">3554</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['coursecontext'] = 0; <span class="comment">// no course aliases</span>
<a name="l3555"><span class="linenum">3555</span></a>          <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = null;
<a name="l3556"><span class="linenum">3556</span></a>      }
<a name="l3557"><span class="linenum">3557</span></a>  
<a name="l3558"><span class="linenum">3558</span></a>      if (<a class="function" onClick="logFunction('is_siteadmin')" href="../_functions/is_siteadmin.html" onMouseOver="funcPopup(event,'is_siteadmin')">is_siteadmin</a>()) {
<a name="l3559"><span class="linenum">3559</span></a>  <span class="comment">        // show all roles to admins</span>
<a name="l3560"><span class="linenum">3560</span></a>          <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;
<a name="l3561"><span class="linenum">3561</span></a>              SELECT ro.id, ro.name, ro.shortname, rn.name AS coursealias <a class="var it4833" onMouseOver="hilite(4833)" onMouseOut="lolite()" onClick="logVariable('extrafields')" href="../_variables/extrafields.html">$extrafields</a>
<a name="l3562"><span class="linenum">3562</span></a>                FROM {role} ro
<a name="l3563"><span class="linenum">3563</span></a>           LEFT JOIN {role_names} rn <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (rn.contextid = :coursecontext AND rn.roleid = ro.id)
<a name="l3564"><span class="linenum">3564</span></a>            ORDER BY ro.sortorder ASC&quot;, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l3565"><span class="linenum">3565</span></a>  
<a name="l3566"><span class="linenum">3566</span></a>      } else {
<a name="l3567"><span class="linenum">3567</span></a>          <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;
<a name="l3568"><span class="linenum">3568</span></a>              SELECT ro.id, ro.name, ro.shortname, rn.name AS coursealias <a class="var it4833" onMouseOver="hilite(4833)" onMouseOut="lolite()" onClick="logVariable('extrafields')" href="../_variables/extrafields.html">$extrafields</a>
<a name="l3569"><span class="linenum">3569</span></a>                FROM {role} ro
<a name="l3570"><span class="linenum">3570</span></a>                <a class="function" onClick="logFunction('JOIN')" href="../_functions/join.html" onMouseOver="funcPopup(event,'join')">JOIN</a> (SELECT DISTINCT r.id
<a name="l3571"><span class="linenum">3571</span></a>                        FROM {role} r
<a name="l3572"><span class="linenum">3572</span></a>                        JOIN {role_allow_override} rao ON r.id = rao.allowoverride
<a name="l3573"><span class="linenum">3573</span></a>                        JOIN {role_assignments} ra ON rao.roleid = ra.roleid
<a name="l3574"><span class="linenum">3574</span></a>                       WHERE ra.userid = :userid AND ra.contextid IN (<a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../_variables/contexts.html">$contexts</a>)
<a name="l3575"><span class="linenum">3575</span></a>                     ) inline_view ON ro.id = inline_view.id
<a name="l3576"><span class="linenum">3576</span></a>           LEFT JOIN {role_names} rn <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (rn.contextid = :coursecontext AND rn.roleid = ro.id)
<a name="l3577"><span class="linenum">3577</span></a>            ORDER BY ro.sortorder ASC&quot;, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l3578"><span class="linenum">3578</span></a>      }
<a name="l3579"><span class="linenum">3579</span></a>  
<a name="l3580"><span class="linenum">3580</span></a>      <a class="var it5777" onMouseOver="hilite(5777)" onMouseOut="lolite()" onClick="logVariable('rolenames')" href="../_variables/rolenames.html">$rolenames</a> = <a class="function" onClick="logFunction('role_fix_names')" href="../_functions/role_fix_names.html" onMouseOver="funcPopup(event,'role_fix_names')">role_fix_names</a>(<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('rolenamedisplay')" href="../_variables/rolenamedisplay.html">$rolenamedisplay</a>, true);
<a name="l3581"><span class="linenum">3581</span></a>  
<a name="l3582"><span class="linenum">3582</span></a>      if (!<a class="var it28855" onMouseOver="hilite(28855)" onMouseOut="lolite()" onClick="logVariable('withcounts')" href="../_variables/withcounts.html">$withcounts</a>) {
<a name="l3583"><span class="linenum">3583</span></a>          return <a class="var it5777" onMouseOver="hilite(5777)" onMouseOut="lolite()" onClick="logVariable('rolenames')" href="../_variables/rolenames.html">$rolenames</a>;
<a name="l3584"><span class="linenum">3584</span></a>      }
<a name="l3585"><span class="linenum">3585</span></a>  
<a name="l3586"><span class="linenum">3586</span></a>      <a class="var it22434" onMouseOver="hilite(22434)" onMouseOut="lolite()" onClick="logVariable('rolecounts')" href="../_variables/rolecounts.html">$rolecounts</a> = array();
<a name="l3587"><span class="linenum">3587</span></a>      <a class="var it16184" onMouseOver="hilite(16184)" onMouseOut="lolite()" onClick="logVariable('nameswithcounts')" href="../_variables/nameswithcounts.html">$nameswithcounts</a> = array();
<a name="l3588"><span class="linenum">3588</span></a>      foreach (<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a> as <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>) {
<a name="l3589"><span class="linenum">3589</span></a>          <a class="var it16184" onMouseOver="hilite(16184)" onMouseOut="lolite()" onClick="logVariable('nameswithcounts')" href="../_variables/nameswithcounts.html">$nameswithcounts</a>[<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('id')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="var it5777" onMouseOver="hilite(5777)" onMouseOut="lolite()" onClick="logVariable('rolenames')" href="../_variables/rolenames.html">$rolenames</a>[<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('id')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] . ' (' . <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>[<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('id')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/id.html">id</a>]-&gt;overridecount . ')';
<a name="l3590"><span class="linenum">3590</span></a>          <a class="var it22434" onMouseOver="hilite(22434)" onMouseOut="lolite()" onClick="logVariable('rolecounts')" href="../_variables/rolecounts.html">$rolecounts</a>[<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('id')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>[<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('id')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/id.html">id</a>]-&gt;overridecount;
<a name="l3591"><span class="linenum">3591</span></a>      }
<a name="l3592"><span class="linenum">3592</span></a>      return array(<a class="var it5777" onMouseOver="hilite(5777)" onMouseOut="lolite()" onClick="logVariable('rolenames')" href="../_variables/rolenames.html">$rolenames</a>, <a class="var it22434" onMouseOver="hilite(22434)" onMouseOut="lolite()" onClick="logVariable('rolecounts')" href="../_variables/rolecounts.html">$rolecounts</a>, <a class="var it16184" onMouseOver="hilite(16184)" onMouseOut="lolite()" onClick="logVariable('nameswithcounts')" href="../_variables/nameswithcounts.html">$nameswithcounts</a>);
<a name="l3593"><span class="linenum">3593</span></a>  }
<a name="l3594"><span class="linenum">3594</span></a>  
<a name="l3595"><span class="linenum">3595</span></a>  <span class="comment">/**</span>
<a name="l3596"><span class="linenum">3596</span></a>  <span class="comment"> * Create a role menu suitable for default role selection in enrol plugins.</span>
<a name="l3597"><span class="linenum">3597</span></a>  <span class="comment"> *</span>
<a name="l3598"><span class="linenum">3598</span></a>  <span class="comment"> * @package    core_enrol</span>
<a name="l3599"><span class="linenum">3599</span></a>  <span class="comment"> *</span>
<a name="l3600"><span class="linenum">3600</span></a>  <span class="comment"> * @param context $context</span>
<a name="l3601"><span class="linenum">3601</span></a>  <span class="comment"> * @param int $addroleid current or default role - always added to list</span>
<a name="l3602"><span class="linenum">3602</span></a>  <span class="comment"> * @return array roleid=&gt;localised role name</span>
<a name="l3603"><span class="linenum">3603</span></a>  <span class="comment"> */</span>
<a name="l3604"><span class="linenum">3604</span></a>  function <a class="function" onClick="logFunction('get_default_enrol_roles')" href="../_functions/get_default_enrol_roles.html" onMouseOver="funcPopup(event,'get_default_enrol_roles')">get_default_enrol_roles</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it28856" onMouseOver="hilite(28856)" onMouseOut="lolite()" onClick="logVariable('addroleid')" href="../_variables/addroleid.html">$addroleid</a> = null) {
<a name="l3605"><span class="linenum">3605</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l3606"><span class="linenum">3606</span></a>  
<a name="l3607"><span class="linenum">3607</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array('contextlevel'=&gt;<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>);
<a name="l3608"><span class="linenum">3608</span></a>  
<a name="l3609"><span class="linenum">3609</span></a>      if (<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_course_context')" href="../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>(false)) {
<a name="l3610"><span class="linenum">3610</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['coursecontext'] = <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('id')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l3611"><span class="linenum">3611</span></a>      } else {
<a name="l3612"><span class="linenum">3612</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['coursecontext'] = 0; <span class="comment">// no course names</span>
<a name="l3613"><span class="linenum">3613</span></a>          <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = null;
<a name="l3614"><span class="linenum">3614</span></a>      }
<a name="l3615"><span class="linenum">3615</span></a>  
<a name="l3616"><span class="linenum">3616</span></a>      if (<a class="var it28856" onMouseOver="hilite(28856)" onMouseOut="lolite()" onClick="logVariable('addroleid')" href="../_variables/addroleid.html">$addroleid</a>) {
<a name="l3617"><span class="linenum">3617</span></a>          <a class="var it28857" onMouseOver="hilite(28857)" onMouseOut="lolite()" onClick="logVariable('addrole')" href="../_variables/addrole.html">$addrole</a> = &quot;OR r.id = :addroleid&quot;;
<a name="l3618"><span class="linenum">3618</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['addroleid'] = <a class="var it28856" onMouseOver="hilite(28856)" onMouseOut="lolite()" onClick="logVariable('addroleid')" href="../_variables/addroleid.html">$addroleid</a>;
<a name="l3619"><span class="linenum">3619</span></a>      } else {
<a name="l3620"><span class="linenum">3620</span></a>          <a class="var it28857" onMouseOver="hilite(28857)" onMouseOut="lolite()" onClick="logVariable('addrole')" href="../_variables/addrole.html">$addrole</a> = &quot;&quot;;
<a name="l3621"><span class="linenum">3621</span></a>      }
<a name="l3622"><span class="linenum">3622</span></a>  
<a name="l3623"><span class="linenum">3623</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT r.id, r.name, r.shortname, rn.name AS coursealias
<a name="l3624"><span class="linenum">3624</span></a>                FROM {role} r
<a name="l3625"><span class="linenum">3625</span></a>           LEFT JOIN {role_context_levels} rcl <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (rcl.roleid = r.id AND rcl.contextlevel = :contextlevel)
<a name="l3626"><span class="linenum">3626</span></a>           LEFT JOIN {role_names} rn <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (rn.contextid = :coursecontext AND rn.roleid = r.id)
<a name="l3627"><span class="linenum">3627</span></a>               WHERE rcl.id IS NOT NULL <a class="var it28857" onMouseOver="hilite(28857)" onMouseOut="lolite()" onClick="logVariable('addrole')" href="../_variables/addrole.html">$addrole</a>
<a name="l3628"><span class="linenum">3628</span></a>            ORDER BY sortorder DESC&quot;;
<a name="l3629"><span class="linenum">3629</span></a>  
<a name="l3630"><span class="linenum">3630</span></a>      <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l3631"><span class="linenum">3631</span></a>  
<a name="l3632"><span class="linenum">3632</span></a>      return <a class="function" onClick="logFunction('role_fix_names')" href="../_functions/role_fix_names.html" onMouseOver="funcPopup(event,'role_fix_names')">role_fix_names</a>(<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="constant" onClick="logConstant('ROLENAME_BOTH')" href="../_constants/ROLENAME_BOTH.html" onMouseOver="constPopup(event,'ROLENAME_BOTH')">ROLENAME_BOTH</a>, true);
<a name="l3633"><span class="linenum">3633</span></a>  }
<a name="l3634"><span class="linenum">3634</span></a>  
<a name="l3635"><span class="linenum">3635</span></a>  <span class="comment">/**</span>
<a name="l3636"><span class="linenum">3636</span></a>  <span class="comment"> * Return context levels where this role is assignable.</span>
<a name="l3637"><span class="linenum">3637</span></a>  <span class="comment"> *</span>
<a name="l3638"><span class="linenum">3638</span></a>  <span class="comment"> * @param integer $roleid the id of a role.</span>
<a name="l3639"><span class="linenum">3639</span></a>  <span class="comment"> * @return array list of the context levels at which this role may be assigned.</span>
<a name="l3640"><span class="linenum">3640</span></a>  <span class="comment"> */</span>
<a name="l3641"><span class="linenum">3641</span></a>  function <a class="function" onClick="logFunction('get_role_contextlevels')" href="../_functions/get_role_contextlevels.html" onMouseOver="funcPopup(event,'get_role_contextlevels')">get_role_contextlevels</a>(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>) {
<a name="l3642"><span class="linenum">3642</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l3643"><span class="linenum">3643</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_menu')" href="../_functions/get_records_menu.html" onMouseOver="funcPopup(event,'get_records_menu')">get_records_menu</a>('role_context_levels', array('roleid' =&gt; <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>),
<a name="l3644"><span class="linenum">3644</span></a>              'contextlevel', 'id,contextlevel');
<a name="l3645"><span class="linenum">3645</span></a>  }
<a name="l3646"><span class="linenum">3646</span></a>  
<a name="l3647"><span class="linenum">3647</span></a>  <span class="comment">/**</span>
<a name="l3648"><span class="linenum">3648</span></a>  <span class="comment"> * Return roles suitable for assignment at the specified context level.</span>
<a name="l3649"><span class="linenum">3649</span></a>  <span class="comment"> *</span>
<a name="l3650"><span class="linenum">3650</span></a>  <span class="comment"> * NOTE: this function name looks like a typo, should be probably get_roles_for_contextlevel()</span>
<a name="l3651"><span class="linenum">3651</span></a>  <span class="comment"> *</span>
<a name="l3652"><span class="linenum">3652</span></a>  <span class="comment"> * @param integer $contextlevel a contextlevel.</span>
<a name="l3653"><span class="linenum">3653</span></a>  <span class="comment"> * @return array list of role ids that are assignable at this context level.</span>
<a name="l3654"><span class="linenum">3654</span></a>  <span class="comment"> */</span>
<a name="l3655"><span class="linenum">3655</span></a>  function <a class="function" onClick="logFunction('get_roles_for_contextlevels')" href="../_functions/get_roles_for_contextlevels.html" onMouseOver="funcPopup(event,'get_roles_for_contextlevels')">get_roles_for_contextlevels</a>(<a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../_variables/contextlevel.html">$contextlevel</a>) {
<a name="l3656"><span class="linenum">3656</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l3657"><span class="linenum">3657</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_menu')" href="../_functions/get_records_menu.html" onMouseOver="funcPopup(event,'get_records_menu')">get_records_menu</a>('role_context_levels', array('contextlevel' =&gt; <a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../_variables/contextlevel.html">$contextlevel</a>),
<a name="l3658"><span class="linenum">3658</span></a>              '', 'id,roleid');
<a name="l3659"><span class="linenum">3659</span></a>  }
<a name="l3660"><span class="linenum">3660</span></a>  
<a name="l3661"><span class="linenum">3661</span></a>  <span class="comment">/**</span>
<a name="l3662"><span class="linenum">3662</span></a>  <span class="comment"> * Returns default context levels where roles can be assigned.</span>
<a name="l3663"><span class="linenum">3663</span></a>  <span class="comment"> *</span>
<a name="l3664"><span class="linenum">3664</span></a>  <span class="comment"> * @param string $rolearchetype one of the role archetypes - that is, one of the keys</span>
<a name="l3665"><span class="linenum">3665</span></a>  <span class="comment"> *      from the array returned by get_role_archetypes();</span>
<a name="l3666"><span class="linenum">3666</span></a>  <span class="comment"> * @return array list of the context levels at which this type of role may be assigned by default.</span>
<a name="l3667"><span class="linenum">3667</span></a>  <span class="comment"> */</span>
<a name="l3668"><span class="linenum">3668</span></a>  function <a class="function" onClick="logFunction('get_default_contextlevels')" href="../_functions/get_default_contextlevels.html" onMouseOver="funcPopup(event,'get_default_contextlevels')">get_default_contextlevels</a>(<a class="var it28858" onMouseOver="hilite(28858)" onMouseOut="lolite()" onClick="logVariable('rolearchetype')" href="../_variables/rolearchetype.html">$rolearchetype</a>) {
<a name="l3669"><span class="linenum">3669</span></a>      static <a class="var it2243" onMouseOver="hilite(2243)" onMouseOut="lolite()" onClick="logVariable('defaults')" href="../_variables/defaults.html">$defaults</a> = array(
<a name="l3670"><span class="linenum">3670</span></a>          'manager'        =&gt; array(<a class="constant" onClick="logConstant('CONTEXT_SYSTEM')" href="../_constants/CONTEXT_SYSTEM.html" onMouseOver="constPopup(event,'CONTEXT_SYSTEM')">CONTEXT_SYSTEM</a>, <a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>, <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>),
<a name="l3671"><span class="linenum">3671</span></a>          'coursecreator'  =&gt; array(<a class="constant" onClick="logConstant('CONTEXT_SYSTEM')" href="../_constants/CONTEXT_SYSTEM.html" onMouseOver="constPopup(event,'CONTEXT_SYSTEM')">CONTEXT_SYSTEM</a>, <a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>),
<a name="l3672"><span class="linenum">3672</span></a>          'editingteacher' =&gt; array(<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>, <a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>),
<a name="l3673"><span class="linenum">3673</span></a>          'teacher'        =&gt; array(<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>, <a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>),
<a name="l3674"><span class="linenum">3674</span></a>          'student'        =&gt; array(<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>, <a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>),
<a name="l3675"><span class="linenum">3675</span></a>          'guest'          =&gt; array(),
<a name="l3676"><span class="linenum">3676</span></a>          'user'           =&gt; array(),
<a name="l3677"><span class="linenum">3677</span></a>          'frontpage'      =&gt; array());
<a name="l3678"><span class="linenum">3678</span></a>  
<a name="l3679"><span class="linenum">3679</span></a>      if (isset(<a class="var it2243" onMouseOver="hilite(2243)" onMouseOut="lolite()" onClick="logVariable('defaults')" href="../_variables/defaults.html">$defaults</a>[<a class="var it28858" onMouseOver="hilite(28858)" onMouseOut="lolite()" onClick="logVariable('rolearchetype')" href="../_variables/rolearchetype.html">$rolearchetype</a>])) {
<a name="l3680"><span class="linenum">3680</span></a>          return <a class="var it2243" onMouseOver="hilite(2243)" onMouseOut="lolite()" onClick="logVariable('defaults')" href="../_variables/defaults.html">$defaults</a>[<a class="var it28858" onMouseOver="hilite(28858)" onMouseOut="lolite()" onClick="logVariable('rolearchetype')" href="../_variables/rolearchetype.html">$rolearchetype</a>];
<a name="l3681"><span class="linenum">3681</span></a>      } else {
<a name="l3682"><span class="linenum">3682</span></a>          return array();
<a name="l3683"><span class="linenum">3683</span></a>      }
<a name="l3684"><span class="linenum">3684</span></a>  }
<a name="l3685"><span class="linenum">3685</span></a>  
<a name="l3686"><span class="linenum">3686</span></a>  <span class="comment">/**</span>
<a name="l3687"><span class="linenum">3687</span></a>  <span class="comment"> * Set the context levels at which a particular role can be assigned.</span>
<a name="l3688"><span class="linenum">3688</span></a>  <span class="comment"> * Throws exceptions in case of error.</span>
<a name="l3689"><span class="linenum">3689</span></a>  <span class="comment"> *</span>
<a name="l3690"><span class="linenum">3690</span></a>  <span class="comment"> * @param integer $roleid the id of a role.</span>
<a name="l3691"><span class="linenum">3691</span></a>  <span class="comment"> * @param array $contextlevels the context levels at which this role should be assignable,</span>
<a name="l3692"><span class="linenum">3692</span></a>  <span class="comment"> *      duplicate levels are removed.</span>
<a name="l3693"><span class="linenum">3693</span></a>  <span class="comment"> * @return void</span>
<a name="l3694"><span class="linenum">3694</span></a>  <span class="comment"> */</span>
<a name="l3695"><span class="linenum">3695</span></a>  function <a class="function" onClick="logFunction('set_role_contextlevels')" href="../_functions/set_role_contextlevels.html" onMouseOver="funcPopup(event,'set_role_contextlevels')">set_role_contextlevels</a>(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, array <a class="var it3918" onMouseOver="hilite(3918)" onMouseOut="lolite()" onClick="logVariable('contextlevels')" href="../_variables/contextlevels.html">$contextlevels</a>) {
<a name="l3696"><span class="linenum">3696</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l3697"><span class="linenum">3697</span></a>      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('role_context_levels', array('roleid' =&gt; <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>));
<a name="l3698"><span class="linenum">3698</span></a>      <a class="var it28859" onMouseOver="hilite(28859)" onMouseOut="lolite()" onClick="logVariable('rcl')" href="../_variables/rcl.html">$rcl</a> = new stdClass();
<a name="l3699"><span class="linenum">3699</span></a>      <a class="var it28859" onMouseOver="hilite(28859)" onMouseOut="lolite()" onClick="logVariable('rcl')" href="../_variables/rcl.html">$rcl</a>-&gt;<a onClick="logVariable('roleid')" class="var it40984" onMouseOver="hilite(40984)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a> = <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>;
<a name="l3700"><span class="linenum">3700</span></a>      <a class="var it3918" onMouseOver="hilite(3918)" onMouseOut="lolite()" onClick="logVariable('contextlevels')" href="../_variables/contextlevels.html">$contextlevels</a> = <a class="phpfunction" onClick="logFunction('array_unique')" href="../_functions/array_unique.html" onMouseOver="phpfuncPopup(event,'array_unique')">array_unique</a>(<a class="var it3918" onMouseOver="hilite(3918)" onMouseOut="lolite()" onClick="logVariable('contextlevels')" href="../_variables/contextlevels.html">$contextlevels</a>);
<a name="l3701"><span class="linenum">3701</span></a>      foreach (<a class="var it3918" onMouseOver="hilite(3918)" onMouseOut="lolite()" onClick="logVariable('contextlevels')" href="../_variables/contextlevels.html">$contextlevels</a> as <a class="var it283" onMouseOver="hilite(283)" onMouseOut="lolite()" onClick="logVariable('level')" href="../_variables/level.html">$level</a>) {
<a name="l3702"><span class="linenum">3702</span></a>          <a class="var it28859" onMouseOver="hilite(28859)" onMouseOut="lolite()" onClick="logVariable('rcl')" href="../_variables/rcl.html">$rcl</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it40984" onMouseOver="hilite(40984)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> = <a class="var it283" onMouseOver="hilite(283)" onMouseOut="lolite()" onClick="logVariable('level')" href="../_variables/level.html">$level</a>;
<a name="l3703"><span class="linenum">3703</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('role_context_levels', <a class="var it28859" onMouseOver="hilite(28859)" onMouseOut="lolite()" onClick="logVariable('rcl')" href="../_variables/rcl.html">$rcl</a>, false, true);
<a name="l3704"><span class="linenum">3704</span></a>      }
<a name="l3705"><span class="linenum">3705</span></a>  }
<a name="l3706"><span class="linenum">3706</span></a>  
<a name="l3707"><span class="linenum">3707</span></a>  <span class="comment">/**</span>
<a name="l3708"><span class="linenum">3708</span></a>  <span class="comment"> * Who has this capability in this context?</span>
<a name="l3709"><span class="linenum">3709</span></a>  <span class="comment"> *</span>
<a name="l3710"><span class="linenum">3710</span></a>  <span class="comment"> * This can be a very expensive call - use sparingly and keep</span>
<a name="l3711"><span class="linenum">3711</span></a>  <span class="comment"> * the results if you are going to need them again soon.</span>
<a name="l3712"><span class="linenum">3712</span></a>  <span class="comment"> *</span>
<a name="l3713"><span class="linenum">3713</span></a>  <span class="comment"> * Note if $fields is empty this function attempts to get u.*</span>
<a name="l3714"><span class="linenum">3714</span></a>  <span class="comment"> * which can get rather large - and has a serious perf impact</span>
<a name="l3715"><span class="linenum">3715</span></a>  <span class="comment"> * on some DBs.</span>
<a name="l3716"><span class="linenum">3716</span></a>  <span class="comment"> *</span>
<a name="l3717"><span class="linenum">3717</span></a>  <span class="comment"> * @param context $context</span>
<a name="l3718"><span class="linenum">3718</span></a>  <span class="comment"> * @param string|array $capability - capability name(s)</span>
<a name="l3719"><span class="linenum">3719</span></a>  <span class="comment"> * @param string $fields - fields to be pulled. The user table is aliased to 'u'. u.id MUST be included.</span>
<a name="l3720"><span class="linenum">3720</span></a>  <span class="comment"> * @param string $sort - the sort order. Default is lastaccess time.</span>
<a name="l3721"><span class="linenum">3721</span></a>  <span class="comment"> * @param mixed $limitfrom - number of records to skip (offset)</span>
<a name="l3722"><span class="linenum">3722</span></a>  <span class="comment"> * @param mixed $limitnum - number of records to fetch</span>
<a name="l3723"><span class="linenum">3723</span></a>  <span class="comment"> * @param string|array $groups - single group or array of groups - only return</span>
<a name="l3724"><span class="linenum">3724</span></a>  <span class="comment"> *               users who are in one of these group(s).</span>
<a name="l3725"><span class="linenum">3725</span></a>  <span class="comment"> * @param string|array $exceptions - list of users to exclude, comma separated or array</span>
<a name="l3726"><span class="linenum">3726</span></a>  <span class="comment"> * @param bool $doanything_ignored not used any more, admin accounts are never returned</span>
<a name="l3727"><span class="linenum">3727</span></a>  <span class="comment"> * @param bool $view_ignored - use get_enrolled_sql() instead</span>
<a name="l3728"><span class="linenum">3728</span></a>  <span class="comment"> * @param bool $useviewallgroups if $groups is set the return users who</span>
<a name="l3729"><span class="linenum">3729</span></a>  <span class="comment"> *               have capability both $capability and moodle/site:accessallgroups</span>
<a name="l3730"><span class="linenum">3730</span></a>  <span class="comment"> *               in this context, as well as users who have $capability and who are</span>
<a name="l3731"><span class="linenum">3731</span></a>  <span class="comment"> *               in $groups.</span>
<a name="l3732"><span class="linenum">3732</span></a>  <span class="comment"> * @return array of user records</span>
<a name="l3733"><span class="linenum">3733</span></a>  <span class="comment"> */</span>
<a name="l3734"><span class="linenum">3734</span></a>  function <a class="function" onClick="logFunction('get_users_by_capability')" href="../_functions/get_users_by_capability.html" onMouseOver="funcPopup(event,'get_users_by_capability')">get_users_by_capability</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, <a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = '', <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a> = '', <a class="var it2932" onMouseOver="hilite(2932)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../_variables/limitfrom.html">$limitfrom</a> = '', <a class="var it3120" onMouseOver="hilite(3120)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../_variables/limitnum.html">$limitnum</a> = '',
<a name="l3735"><span class="linenum">3735</span></a>                                   <a class="var it5191" onMouseOver="hilite(5191)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../_variables/groups.html">$groups</a> = '', <a class="var it5411" onMouseOver="hilite(5411)" onMouseOut="lolite()" onClick="logVariable('exceptions')" href="../_variables/exceptions.html">$exceptions</a> = '', <a class="var it25268" onMouseOver="hilite(25268)" onMouseOut="lolite()" onClick="logVariable('doanything_ignored')" href="../_variables/doanything_ignored.html">$doanything_ignored</a> = null, <a class="var it28860" onMouseOver="hilite(28860)" onMouseOut="lolite()" onClick="logVariable('view_ignored')" href="../_variables/view_ignored.html">$view_ignored</a> = null, <a class="var it28861" onMouseOver="hilite(28861)" onMouseOut="lolite()" onClick="logVariable('useviewallgroups')" href="../_variables/useviewallgroups.html">$useviewallgroups</a> = false) {
<a name="l3736"><span class="linenum">3736</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l3737"><span class="linenum">3737</span></a>  
<a name="l3738"><span class="linenum">3738</span></a>      <a class="var it16422" onMouseOver="hilite(16422)" onMouseOut="lolite()" onClick="logVariable('defaultuserroleid')" href="../_variables/defaultuserroleid.html">$defaultuserroleid</a>      = isset(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultuserroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultuserroleid.html">defaultuserroleid</a>) ? <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultuserroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultuserroleid.html">defaultuserroleid</a> : 0;
<a name="l3739"><span class="linenum">3739</span></a>      <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('defaultfrontpageroleid')" href="../_variables/defaultfrontpageroleid.html">$defaultfrontpageroleid</a> = isset(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultfrontpageroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultfrontpageroleid.html">defaultfrontpageroleid</a>) ? <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('defaultfrontpageroleid')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/defaultfrontpageroleid.html">defaultfrontpageroleid</a> : 0;
<a name="l3740"><span class="linenum">3740</span></a>  
<a name="l3741"><span class="linenum">3741</span></a>      <a class="var it25259" onMouseOver="hilite(25259)" onMouseOut="lolite()" onClick="logVariable('ctxids')" href="../_variables/ctxids.html">$ctxids</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('path')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/path.html">path</a>, '/');
<a name="l3742"><span class="linenum">3742</span></a>      <a class="var it25259" onMouseOver="hilite(25259)" onMouseOut="lolite()" onClick="logVariable('ctxids')" href="../_variables/ctxids.html">$ctxids</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('/', ',', <a class="var it25259" onMouseOver="hilite(25259)" onMouseOut="lolite()" onClick="logVariable('ctxids')" href="../_variables/ctxids.html">$ctxids</a>);
<a name="l3743"><span class="linenum">3743</span></a>  
<a name="l3744"><span class="linenum">3744</span></a>  <span class="comment">    // Context is the frontpage</span>
<a name="l3745"><span class="linenum">3745</span></a>      <a class="var it28862" onMouseOver="hilite(28862)" onMouseOut="lolite()" onClick="logVariable('iscoursepage')" href="../_variables/iscoursepage.html">$iscoursepage</a> = false; <span class="comment">// coursepage other than fp</span>
<a name="l3746"><span class="linenum">3746</span></a>      <a class="var it5773" onMouseOver="hilite(5773)" onMouseOut="lolite()" onClick="logVariable('isfrontpage')" href="../_variables/isfrontpage.html">$isfrontpage</a> = false;
<a name="l3747"><span class="linenum">3747</span></a>      if (<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> == <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>) {
<a name="l3748"><span class="linenum">3748</span></a>          if (<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a> == <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>) {
<a name="l3749"><span class="linenum">3749</span></a>              <a class="var it5773" onMouseOver="hilite(5773)" onMouseOut="lolite()" onClick="logVariable('isfrontpage')" href="../_variables/isfrontpage.html">$isfrontpage</a> = true;
<a name="l3750"><span class="linenum">3750</span></a>          } else {
<a name="l3751"><span class="linenum">3751</span></a>              <a class="var it28862" onMouseOver="hilite(28862)" onMouseOut="lolite()" onClick="logVariable('iscoursepage')" href="../_variables/iscoursepage.html">$iscoursepage</a> = true;
<a name="l3752"><span class="linenum">3752</span></a>          }
<a name="l3753"><span class="linenum">3753</span></a>      }
<a name="l3754"><span class="linenum">3754</span></a>      <a class="var it5773" onMouseOver="hilite(5773)" onMouseOut="lolite()" onClick="logVariable('isfrontpage')" href="../_variables/isfrontpage.html">$isfrontpage</a> = (<a class="var it5773" onMouseOver="hilite(5773)" onMouseOut="lolite()" onClick="logVariable('isfrontpage')" href="../_variables/isfrontpage.html">$isfrontpage</a> || <a class="function" onClick="logFunction('is_inside_frontpage')" href="../_functions/is_inside_frontpage.html" onMouseOver="funcPopup(event,'is_inside_frontpage')">is_inside_frontpage</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>));
<a name="l3755"><span class="linenum">3755</span></a>  
<a name="l3756"><span class="linenum">3756</span></a>      <a class="var it4955" onMouseOver="hilite(4955)" onMouseOut="lolite()" onClick="logVariable('caps')" href="../_variables/caps.html">$caps</a> = (array)<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>;
<a name="l3757"><span class="linenum">3757</span></a>  
<a name="l3758"><span class="linenum">3758</span></a>  <span class="comment">    // construct list of context paths bottom--&gt;top</span>
<a name="l3759"><span class="linenum">3759</span></a>      <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it12554" onMouseOver="hilite(12554)" onMouseOut="lolite()" onClick="logVariable('contextids')" href="../_variables/contextids.html">$contextids</a>, <a class="var it599" onMouseOver="hilite(599)" onMouseOut="lolite()" onClick="logVariable('paths')" href="../_variables/paths.html">$paths</a>) = <a class="function" onClick="logFunction('get_context_info_list')" href="../_functions/get_context_info_list.html" onMouseOver="funcPopup(event,'get_context_info_list')">get_context_info_list</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l3760"><span class="linenum">3760</span></a>  
<a name="l3761"><span class="linenum">3761</span></a>  <span class="comment">    // we need to find out all roles that have these capabilities either in definition or in overrides</span>
<a name="l3762"><span class="linenum">3762</span></a>      <a class="var it22422" onMouseOver="hilite(22422)" onMouseOut="lolite()" onClick="logVariable('defs')" href="../_variables/defs.html">$defs</a> = array();
<a name="l3763"><span class="linenum">3763</span></a>      <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it28818" onMouseOver="hilite(28818)" onMouseOut="lolite()" onClick="logVariable('incontexts')" href="../_variables/incontexts.html">$incontexts</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it12554" onMouseOver="hilite(12554)" onMouseOut="lolite()" onClick="logVariable('contextids')" href="../_variables/contextids.html">$contextids</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'con');
<a name="l3764"><span class="linenum">3764</span></a>      <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it28863" onMouseOver="hilite(28863)" onMouseOut="lolite()" onClick="logVariable('incaps')" href="../_variables/incaps.html">$incaps</a>, <a class="var it373" onMouseOver="hilite(373)" onMouseOut="lolite()" onClick="logVariable('params2')" href="../_variables/params2.html">$params2</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it4955" onMouseOver="hilite(4955)" onMouseOut="lolite()" onClick="logVariable('caps')" href="../_variables/caps.html">$caps</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'cap');
<a name="l3765"><span class="linenum">3765</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it373" onMouseOver="hilite(373)" onMouseOut="lolite()" onClick="logVariable('params2')" href="../_variables/params2.html">$params2</a>);
<a name="l3766"><span class="linenum">3766</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT rc.id, rc.roleid, rc.permission, rc.capability, ctx.path
<a name="l3767"><span class="linenum">3767</span></a>                FROM {role_capabilities} rc
<a name="l3768"><span class="linenum">3768</span></a>                JOIN {context} ctx on rc.contextid = ctx.id
<a name="l3769"><span class="linenum">3769</span></a>               WHERE rc.contextid <a class="var it28818" onMouseOver="hilite(28818)" onMouseOut="lolite()" onClick="logVariable('incontexts')" href="../_variables/incontexts.html">$incontexts</a> AND rc.capability <a class="var it28863" onMouseOver="hilite(28863)" onMouseOut="lolite()" onClick="logVariable('incaps')" href="../_variables/incaps.html">$incaps</a>&quot;;
<a name="l3770"><span class="linenum">3770</span></a>  
<a name="l3771"><span class="linenum">3771</span></a>      <a class="var it28819" onMouseOver="hilite(28819)" onMouseOut="lolite()" onClick="logVariable('rcs')" href="../_variables/rcs.html">$rcs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l3772"><span class="linenum">3772</span></a>      foreach (<a class="var it28819" onMouseOver="hilite(28819)" onMouseOut="lolite()" onClick="logVariable('rcs')" href="../_variables/rcs.html">$rcs</a> as <a class="var it6467" onMouseOver="hilite(6467)" onMouseOut="lolite()" onClick="logVariable('rc')" href="../_variables/rc.html">$rc</a>) {
<a name="l3773"><span class="linenum">3773</span></a>          <a class="var it22422" onMouseOver="hilite(22422)" onMouseOut="lolite()" onClick="logVariable('defs')" href="../_variables/defs.html">$defs</a>[<a class="var it6467" onMouseOver="hilite(6467)" onMouseOut="lolite()" onClick="logVariable('rc')" href="../_variables/rc.html">$rc</a>-&gt;<a onClick="logVariable('capability')" class="var it40328" onMouseOver="hilite(40328)" onMouseOut="lolite()" href="../_variables/capability.html">capability</a>][<a class="var it6467" onMouseOver="hilite(6467)" onMouseOut="lolite()" onClick="logVariable('rc')" href="../_variables/rc.html">$rc</a>-&gt;<a onClick="logVariable('path')" class="var it40328" onMouseOver="hilite(40328)" onMouseOut="lolite()" href="../_variables/path.html">path</a>][<a class="var it6467" onMouseOver="hilite(6467)" onMouseOut="lolite()" onClick="logVariable('rc')" href="../_variables/rc.html">$rc</a>-&gt;<a onClick="logVariable('roleid')" class="var it40328" onMouseOver="hilite(40328)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>] = <a class="var it6467" onMouseOver="hilite(6467)" onMouseOut="lolite()" onClick="logVariable('rc')" href="../_variables/rc.html">$rc</a>-&gt;<a onClick="logVariable('permission')" class="var it40328" onMouseOver="hilite(40328)" onMouseOut="lolite()" href="../_variables/permission.html">permission</a>;
<a name="l3774"><span class="linenum">3774</span></a>      }
<a name="l3775"><span class="linenum">3775</span></a>  
<a name="l3776"><span class="linenum">3776</span></a>  <span class="comment">    // go through the permissions bottom--&gt;top direction to evaluate the current permission,</span>
<a name="l3777"><span class="linenum">3777</span></a>  <span class="comment">    // first one wins (prohibit is an exception that always wins)</span>
<a name="l3778"><span class="linenum">3778</span></a>      <a class="var it1026" onMouseOver="hilite(1026)" onMouseOut="lolite()" onClick="logVariable('access')" href="../_variables/access.html">$access</a> = array();
<a name="l3779"><span class="linenum">3779</span></a>      foreach (<a class="var it4955" onMouseOver="hilite(4955)" onMouseOut="lolite()" onClick="logVariable('caps')" href="../_variables/caps.html">$caps</a> as <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>) {
<a name="l3780"><span class="linenum">3780</span></a>          foreach (<a class="var it599" onMouseOver="hilite(599)" onMouseOut="lolite()" onClick="logVariable('paths')" href="../_variables/paths.html">$paths</a> as <a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>) {
<a name="l3781"><span class="linenum">3781</span></a>              if (empty(<a class="var it22422" onMouseOver="hilite(22422)" onMouseOut="lolite()" onClick="logVariable('defs')" href="../_variables/defs.html">$defs</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>][<a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>])) {
<a name="l3782"><span class="linenum">3782</span></a>                  continue;
<a name="l3783"><span class="linenum">3783</span></a>              }
<a name="l3784"><span class="linenum">3784</span></a>              foreach(<a class="var it22422" onMouseOver="hilite(22422)" onMouseOut="lolite()" onClick="logVariable('defs')" href="../_variables/defs.html">$defs</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>][<a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>] as <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a> =&gt; <a class="var it26371" onMouseOver="hilite(26371)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../_variables/perm.html">$perm</a>) {
<a name="l3785"><span class="linenum">3785</span></a>                  if (<a class="var it26371" onMouseOver="hilite(26371)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../_variables/perm.html">$perm</a> == <a class="constant" onClick="logConstant('CAP_PROHIBIT')" href="../_constants/CAP_PROHIBIT.html" onMouseOver="constPopup(event,'CAP_PROHIBIT')">CAP_PROHIBIT</a>) {
<a name="l3786"><span class="linenum">3786</span></a>                      <a class="var it1026" onMouseOver="hilite(1026)" onMouseOut="lolite()" onClick="logVariable('access')" href="../_variables/access.html">$access</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>][<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>] = <a class="constant" onClick="logConstant('CAP_PROHIBIT')" href="../_constants/CAP_PROHIBIT.html" onMouseOver="constPopup(event,'CAP_PROHIBIT')">CAP_PROHIBIT</a>;
<a name="l3787"><span class="linenum">3787</span></a>                      continue;
<a name="l3788"><span class="linenum">3788</span></a>                  }
<a name="l3789"><span class="linenum">3789</span></a>                  if (!isset(<a class="var it1026" onMouseOver="hilite(1026)" onMouseOut="lolite()" onClick="logVariable('access')" href="../_variables/access.html">$access</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>][<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>])) {
<a name="l3790"><span class="linenum">3790</span></a>                      <a class="var it1026" onMouseOver="hilite(1026)" onMouseOut="lolite()" onClick="logVariable('access')" href="../_variables/access.html">$access</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>][<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>] = (int)<a class="var it26371" onMouseOver="hilite(26371)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../_variables/perm.html">$perm</a>;
<a name="l3791"><span class="linenum">3791</span></a>                  }
<a name="l3792"><span class="linenum">3792</span></a>              }
<a name="l3793"><span class="linenum">3793</span></a>          }
<a name="l3794"><span class="linenum">3794</span></a>      }
<a name="l3795"><span class="linenum">3795</span></a>  
<a name="l3796"><span class="linenum">3796</span></a>  <span class="comment">    // make lists of roles that are needed and prohibited in this context</span>
<a name="l3797"><span class="linenum">3797</span></a>      <a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a> = array(); <span class="comment">// one of these is enough</span>
<a name="l3798"><span class="linenum">3798</span></a>      <a class="var it28820" onMouseOver="hilite(28820)" onMouseOut="lolite()" onClick="logVariable('prohibited')" href="../_variables/prohibited.html">$prohibited</a> = array(); <span class="comment">// must not have any of these</span>
<a name="l3799"><span class="linenum">3799</span></a>      foreach (<a class="var it4955" onMouseOver="hilite(4955)" onMouseOut="lolite()" onClick="logVariable('caps')" href="../_variables/caps.html">$caps</a> as <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>) {
<a name="l3800"><span class="linenum">3800</span></a>          if (empty(<a class="var it1026" onMouseOver="hilite(1026)" onMouseOut="lolite()" onClick="logVariable('access')" href="../_variables/access.html">$access</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>])) {
<a name="l3801"><span class="linenum">3801</span></a>              continue;
<a name="l3802"><span class="linenum">3802</span></a>          }
<a name="l3803"><span class="linenum">3803</span></a>          foreach (<a class="var it1026" onMouseOver="hilite(1026)" onMouseOut="lolite()" onClick="logVariable('access')" href="../_variables/access.html">$access</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>] as <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a> =&gt; <a class="var it26371" onMouseOver="hilite(26371)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../_variables/perm.html">$perm</a>) {
<a name="l3804"><span class="linenum">3804</span></a>              if (<a class="var it26371" onMouseOver="hilite(26371)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../_variables/perm.html">$perm</a> == <a class="constant" onClick="logConstant('CAP_PROHIBIT')" href="../_constants/CAP_PROHIBIT.html" onMouseOver="constPopup(event,'CAP_PROHIBIT')">CAP_PROHIBIT</a>) {
<a name="l3805"><span class="linenum">3805</span></a>                  unset(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>][<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>]);
<a name="l3806"><span class="linenum">3806</span></a>                  <a class="var it28820" onMouseOver="hilite(28820)" onMouseOut="lolite()" onClick="logVariable('prohibited')" href="../_variables/prohibited.html">$prohibited</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>][<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>] = true;
<a name="l3807"><span class="linenum">3807</span></a>              } else if (<a class="var it26371" onMouseOver="hilite(26371)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../_variables/perm.html">$perm</a> == <a class="constant" onClick="logConstant('CAP_ALLOW')" href="../_constants/CAP_ALLOW.html" onMouseOver="constPopup(event,'CAP_ALLOW')">CAP_ALLOW</a> and empty(<a class="var it28820" onMouseOver="hilite(28820)" onMouseOut="lolite()" onClick="logVariable('prohibited')" href="../_variables/prohibited.html">$prohibited</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>][<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>])) {
<a name="l3808"><span class="linenum">3808</span></a>                  <a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>][<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>] = true;
<a name="l3809"><span class="linenum">3809</span></a>              }
<a name="l3810"><span class="linenum">3810</span></a>          }
<a name="l3811"><span class="linenum">3811</span></a>          if (empty(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>]) or !empty(<a class="var it28820" onMouseOver="hilite(28820)" onMouseOut="lolite()" onClick="logVariable('prohibited')" href="../_variables/prohibited.html">$prohibited</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>][<a class="var it16422" onMouseOver="hilite(16422)" onMouseOut="lolite()" onClick="logVariable('defaultuserroleid')" href="../_variables/defaultuserroleid.html">$defaultuserroleid</a>])) {
<a name="l3812"><span class="linenum">3812</span></a>  <span class="comment">            // easy, nobody has the permission</span>
<a name="l3813"><span class="linenum">3813</span></a>              unset(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>]);
<a name="l3814"><span class="linenum">3814</span></a>              unset(<a class="var it28820" onMouseOver="hilite(28820)" onMouseOut="lolite()" onClick="logVariable('prohibited')" href="../_variables/prohibited.html">$prohibited</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>]);
<a name="l3815"><span class="linenum">3815</span></a>          } else if (<a class="var it5773" onMouseOver="hilite(5773)" onMouseOut="lolite()" onClick="logVariable('isfrontpage')" href="../_variables/isfrontpage.html">$isfrontpage</a> and !empty(<a class="var it28820" onMouseOver="hilite(28820)" onMouseOut="lolite()" onClick="logVariable('prohibited')" href="../_variables/prohibited.html">$prohibited</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>][<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('defaultfrontpageroleid')" href="../_variables/defaultfrontpageroleid.html">$defaultfrontpageroleid</a>])) {
<a name="l3816"><span class="linenum">3816</span></a>  <span class="comment">            // everybody is disqualified on the frontpage</span>
<a name="l3817"><span class="linenum">3817</span></a>              unset(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>]);
<a name="l3818"><span class="linenum">3818</span></a>              unset(<a class="var it28820" onMouseOver="hilite(28820)" onMouseOut="lolite()" onClick="logVariable('prohibited')" href="../_variables/prohibited.html">$prohibited</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>]);
<a name="l3819"><span class="linenum">3819</span></a>          }
<a name="l3820"><span class="linenum">3820</span></a>          if (empty(<a class="var it28820" onMouseOver="hilite(28820)" onMouseOut="lolite()" onClick="logVariable('prohibited')" href="../_variables/prohibited.html">$prohibited</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>])) {
<a name="l3821"><span class="linenum">3821</span></a>              unset(<a class="var it28820" onMouseOver="hilite(28820)" onMouseOut="lolite()" onClick="logVariable('prohibited')" href="../_variables/prohibited.html">$prohibited</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>]);
<a name="l3822"><span class="linenum">3822</span></a>          }
<a name="l3823"><span class="linenum">3823</span></a>      }
<a name="l3824"><span class="linenum">3824</span></a>  
<a name="l3825"><span class="linenum">3825</span></a>      if (empty(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>)) {
<a name="l3826"><span class="linenum">3826</span></a>  <span class="comment">        // there can not be anybody if no roles match this request</span>
<a name="l3827"><span class="linenum">3827</span></a>          return array();
<a name="l3828"><span class="linenum">3828</span></a>      }
<a name="l3829"><span class="linenum">3829</span></a>  
<a name="l3830"><span class="linenum">3830</span></a>      if (empty(<a class="var it28820" onMouseOver="hilite(28820)" onMouseOut="lolite()" onClick="logVariable('prohibited')" href="../_variables/prohibited.html">$prohibited</a>)) {
<a name="l3831"><span class="linenum">3831</span></a>  <span class="comment">        // we can compact the needed roles</span>
<a name="l3832"><span class="linenum">3832</span></a>          <a class="var it291" onMouseOver="hilite(291)" onMouseOut="lolite()" onClick="logVariable('n')" href="../_variables/n.html">$n</a> = array();
<a name="l3833"><span class="linenum">3833</span></a>          foreach (<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a> as <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>) {
<a name="l3834"><span class="linenum">3834</span></a>              foreach (<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a> as <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>=&gt;<a class="var it1136" onMouseOver="hilite(1136)" onMouseOut="lolite()" onClick="logVariable('unused')" href="../_variables/unused.html">$unused</a>) {
<a name="l3835"><span class="linenum">3835</span></a>                  <a class="var it291" onMouseOver="hilite(291)" onMouseOut="lolite()" onClick="logVariable('n')" href="../_variables/n.html">$n</a>[<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>] = true;
<a name="l3836"><span class="linenum">3836</span></a>              }
<a name="l3837"><span class="linenum">3837</span></a>          }
<a name="l3838"><span class="linenum">3838</span></a>          <a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a> = array('any'=&gt;<a class="var it291" onMouseOver="hilite(291)" onMouseOut="lolite()" onClick="logVariable('n')" href="../_variables/n.html">$n</a>);
<a name="l3839"><span class="linenum">3839</span></a>          unset(<a class="var it291" onMouseOver="hilite(291)" onMouseOut="lolite()" onClick="logVariable('n')" href="../_variables/n.html">$n</a>);
<a name="l3840"><span class="linenum">3840</span></a>      }
<a name="l3841"><span class="linenum">3841</span></a>  
<a name="l3842"><span class="linenum">3842</span></a>  <span class="comment">    // ***** Set up default fields ******</span>
<a name="l3843"><span class="linenum">3843</span></a>      if (empty(<a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>)) {
<a name="l3844"><span class="linenum">3844</span></a>          if (<a class="var it28862" onMouseOver="hilite(28862)" onMouseOut="lolite()" onClick="logVariable('iscoursepage')" href="../_variables/iscoursepage.html">$iscoursepage</a>) {
<a name="l3845"><span class="linenum">3845</span></a>              <a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = 'u.*, ul.timeaccess AS lastaccess';
<a name="l3846"><span class="linenum">3846</span></a>          } else {
<a name="l3847"><span class="linenum">3847</span></a>              <a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = 'u.*';
<a name="l3848"><span class="linenum">3848</span></a>          }
<a name="l3849"><span class="linenum">3849</span></a>      } else {
<a name="l3850"><span class="linenum">3850</span></a>          if (<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('debugdeveloper')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/debugdeveloper.html">debugdeveloper</a> &amp;&amp; <a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>, 'u.*') === false &amp;&amp; <a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>, 'u.id') === false) {
<a name="l3851"><span class="linenum">3851</span></a>              <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('u.id must be included in the list of fields passed to <a class="function" onClick="logFunction('get_users_by_capability')" href="../_functions/get_users_by_capability.html" onMouseOver="funcPopup(event,'get_users_by_capability')">get_users_by_capability</a>().', <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l3852"><span class="linenum">3852</span></a>          }
<a name="l3853"><span class="linenum">3853</span></a>      }
<a name="l3854"><span class="linenum">3854</span></a>  
<a name="l3855"><span class="linenum">3855</span></a>  <span class="comment">    // Set up default sort</span>
<a name="l3856"><span class="linenum">3856</span></a>      if (empty(<a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>)) { // default to course lastaccess or just lastaccess
<a name="l3857"><span class="linenum">3857</span></a>          if (<a class="var it28862" onMouseOver="hilite(28862)" onMouseOut="lolite()" onClick="logVariable('iscoursepage')" href="../_variables/iscoursepage.html">$iscoursepage</a>) {
<a name="l3858"><span class="linenum">3858</span></a>              <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a> = 'ul.timeaccess';
<a name="l3859"><span class="linenum">3859</span></a>          } else {
<a name="l3860"><span class="linenum">3860</span></a>              <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a> = 'u.lastaccess';
<a name="l3861"><span class="linenum">3861</span></a>          }
<a name="l3862"><span class="linenum">3862</span></a>      }
<a name="l3863"><span class="linenum">3863</span></a>  
<a name="l3864"><span class="linenum">3864</span></a>  <span class="comment">    // Prepare query clauses</span>
<a name="l3865"><span class="linenum">3865</span></a>      <a class="var it28864" onMouseOver="hilite(28864)" onMouseOut="lolite()" onClick="logVariable('wherecond')" href="../_variables/wherecond.html">$wherecond</a> = array();
<a name="l3866"><span class="linenum">3866</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>    = array();
<a name="l3867"><span class="linenum">3867</span></a>      <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('joins')" href="../_variables/joins.html">$joins</a>     = array();
<a name="l3868"><span class="linenum">3868</span></a>  
<a name="l3869"><span class="linenum">3869</span></a>  <span class="comment">    // User lastaccess JOIN</span>
<a name="l3870"><span class="linenum">3870</span></a>      if ((<a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>, 'ul.timeaccess') === false) and (<a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>, 'ul.timeaccess') === false)) {
<a name="l3871"><span class="linenum">3871</span></a>  <span class="comment">         // user_lastaccess is not required MDL-13810</span>
<a name="l3872"><span class="linenum">3872</span></a>      } else {
<a name="l3873"><span class="linenum">3873</span></a>          if (<a class="var it28862" onMouseOver="hilite(28862)" onMouseOut="lolite()" onClick="logVariable('iscoursepage')" href="../_variables/iscoursepage.html">$iscoursepage</a>) {
<a name="l3874"><span class="linenum">3874</span></a>              <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('joins')" href="../_variables/joins.html">$joins</a>[] = &quot;LEFT OUTER JOIN {user_lastaccess} ul <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (ul.userid = u.id AND ul.courseid = {<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>})&quot;;
<a name="l3875"><span class="linenum">3875</span></a>          } else {
<a name="l3876"><span class="linenum">3876</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid sort in <a class="function" onClick="logFunction('get_users_by_capability')" href="../_functions/get_users_by_capability.html" onMouseOver="funcPopup(event,'get_users_by_capability')">get_users_by_capability</a>(), ul.timeaccess allowed only for course contexts.');
<a name="l3877"><span class="linenum">3877</span></a>          }
<a name="l3878"><span class="linenum">3878</span></a>      }
<a name="l3879"><span class="linenum">3879</span></a>  
<a name="l3880"><span class="linenum">3880</span></a>  <span class="comment">    // We never return deleted users or guest account.</span>
<a name="l3881"><span class="linenum">3881</span></a>      <a class="var it28864" onMouseOver="hilite(28864)" onMouseOut="lolite()" onClick="logVariable('wherecond')" href="../_variables/wherecond.html">$wherecond</a>[] = &quot;u.deleted = 0 AND u.id &lt;&gt; :guestid&quot;;
<a name="l3882"><span class="linenum">3882</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['guestid'] = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('siteguest')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/siteguest.html">siteguest</a>;
<a name="l3883"><span class="linenum">3883</span></a>  
<a name="l3884"><span class="linenum">3884</span></a>  <span class="comment">    // Groups</span>
<a name="l3885"><span class="linenum">3885</span></a>      if (<a class="var it5191" onMouseOver="hilite(5191)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../_variables/groups.html">$groups</a>) {
<a name="l3886"><span class="linenum">3886</span></a>          <a class="var it5191" onMouseOver="hilite(5191)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../_variables/groups.html">$groups</a> = (array)<a class="var it5191" onMouseOver="hilite(5191)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../_variables/groups.html">$groups</a>;
<a name="l3887"><span class="linenum">3887</span></a>          <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it15574" onMouseOver="hilite(15574)" onMouseOut="lolite()" onClick="logVariable('grouptest')" href="../_variables/grouptest.html">$grouptest</a>, <a class="var it28865" onMouseOver="hilite(28865)" onMouseOut="lolite()" onClick="logVariable('grpparams')" href="../_variables/grpparams.html">$grpparams</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it5191" onMouseOver="hilite(5191)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../_variables/groups.html">$groups</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'grp');
<a name="l3888"><span class="linenum">3888</span></a>          <a class="var it15574" onMouseOver="hilite(15574)" onMouseOut="lolite()" onClick="logVariable('grouptest')" href="../_variables/grouptest.html">$grouptest</a> = &quot;u.id IN (SELECT userid FROM {groups_members} gm WHERE gm.groupid <a class="var it15574" onMouseOver="hilite(15574)" onMouseOut="lolite()" onClick="logVariable('grouptest')" href="../_variables/grouptest.html">$grouptest</a>)&quot;;
<a name="l3889"><span class="linenum">3889</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it28865" onMouseOver="hilite(28865)" onMouseOut="lolite()" onClick="logVariable('grpparams')" href="../_variables/grpparams.html">$grpparams</a>);
<a name="l3890"><span class="linenum">3890</span></a>  
<a name="l3891"><span class="linenum">3891</span></a>          if (<a class="var it28861" onMouseOver="hilite(28861)" onMouseOut="lolite()" onClick="logVariable('useviewallgroups')" href="../_variables/useviewallgroups.html">$useviewallgroups</a>) {
<a name="l3892"><span class="linenum">3892</span></a>              <a class="var it28866" onMouseOver="hilite(28866)" onMouseOut="lolite()" onClick="logVariable('viewallgroupsusers')" href="../_variables/viewallgroupsusers.html">$viewallgroupsusers</a> = <a class="function" onClick="logFunction('get_users_by_capability')" href="../_functions/get_users_by_capability.html" onMouseOver="funcPopup(event,'get_users_by_capability')">get_users_by_capability</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, 'moodle/site:accessallgroups', 'u.id, u.id', '', '', '', '', <a class="var it5411" onMouseOver="hilite(5411)" onMouseOut="lolite()" onClick="logVariable('exceptions')" href="../_variables/exceptions.html">$exceptions</a>);
<a name="l3893"><span class="linenum">3893</span></a>              if (!empty(<a class="var it28866" onMouseOver="hilite(28866)" onMouseOut="lolite()" onClick="logVariable('viewallgroupsusers')" href="../_variables/viewallgroupsusers.html">$viewallgroupsusers</a>)) {
<a name="l3894"><span class="linenum">3894</span></a>                  <a class="var it28864" onMouseOver="hilite(28864)" onMouseOut="lolite()" onClick="logVariable('wherecond')" href="../_variables/wherecond.html">$wherecond</a>[] =  &quot;(<a class="var it15574" onMouseOver="hilite(15574)" onMouseOut="lolite()" onClick="logVariable('grouptest')" href="../_variables/grouptest.html">$grouptest</a> OR u.id IN (&quot; . <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',', <a class="phpfunction" onClick="logFunction('array_keys')" href="../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it28866" onMouseOver="hilite(28866)" onMouseOut="lolite()" onClick="logVariable('viewallgroupsusers')" href="../_variables/viewallgroupsusers.html">$viewallgroupsusers</a>)) . '))';
<a name="l3895"><span class="linenum">3895</span></a>              } else {
<a name="l3896"><span class="linenum">3896</span></a>                  <a class="var it28864" onMouseOver="hilite(28864)" onMouseOut="lolite()" onClick="logVariable('wherecond')" href="../_variables/wherecond.html">$wherecond</a>[] =  &quot;(<a class="var it15574" onMouseOver="hilite(15574)" onMouseOut="lolite()" onClick="logVariable('grouptest')" href="../_variables/grouptest.html">$grouptest</a>)&quot;;
<a name="l3897"><span class="linenum">3897</span></a>              }
<a name="l3898"><span class="linenum">3898</span></a>          } else {
<a name="l3899"><span class="linenum">3899</span></a>              <a class="var it28864" onMouseOver="hilite(28864)" onMouseOut="lolite()" onClick="logVariable('wherecond')" href="../_variables/wherecond.html">$wherecond</a>[] =  &quot;(<a class="var it15574" onMouseOver="hilite(15574)" onMouseOut="lolite()" onClick="logVariable('grouptest')" href="../_variables/grouptest.html">$grouptest</a>)&quot;;
<a name="l3900"><span class="linenum">3900</span></a>          }
<a name="l3901"><span class="linenum">3901</span></a>      }
<a name="l3902"><span class="linenum">3902</span></a>  
<a name="l3903"><span class="linenum">3903</span></a>  <span class="comment">    // User exceptions</span>
<a name="l3904"><span class="linenum">3904</span></a>      if (!empty(<a class="var it5411" onMouseOver="hilite(5411)" onMouseOut="lolite()" onClick="logVariable('exceptions')" href="../_variables/exceptions.html">$exceptions</a>)) {
<a name="l3905"><span class="linenum">3905</span></a>          <a class="var it5411" onMouseOver="hilite(5411)" onMouseOut="lolite()" onClick="logVariable('exceptions')" href="../_variables/exceptions.html">$exceptions</a> = (array)<a class="var it5411" onMouseOver="hilite(5411)" onMouseOut="lolite()" onClick="logVariable('exceptions')" href="../_variables/exceptions.html">$exceptions</a>;
<a name="l3906"><span class="linenum">3906</span></a>          <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it22633" onMouseOver="hilite(22633)" onMouseOut="lolite()" onClick="logVariable('exsql')" href="../_variables/exsql.html">$exsql</a>, <a class="var it28867" onMouseOver="hilite(28867)" onMouseOut="lolite()" onClick="logVariable('exparams')" href="../_variables/exparams.html">$exparams</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it5411" onMouseOver="hilite(5411)" onMouseOut="lolite()" onClick="logVariable('exceptions')" href="../_variables/exceptions.html">$exceptions</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'exc', false);
<a name="l3907"><span class="linenum">3907</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it28867" onMouseOver="hilite(28867)" onMouseOut="lolite()" onClick="logVariable('exparams')" href="../_variables/exparams.html">$exparams</a>);
<a name="l3908"><span class="linenum">3908</span></a>          <a class="var it28864" onMouseOver="hilite(28864)" onMouseOut="lolite()" onClick="logVariable('wherecond')" href="../_variables/wherecond.html">$wherecond</a>[] = &quot;u.id <a class="var it22633" onMouseOver="hilite(22633)" onMouseOut="lolite()" onClick="logVariable('exsql')" href="../_variables/exsql.html">$exsql</a>&quot;;
<a name="l3909"><span class="linenum">3909</span></a>      }
<a name="l3910"><span class="linenum">3910</span></a>  
<a name="l3911"><span class="linenum">3911</span></a>  <span class="comment">    // now add the needed and prohibited roles conditions as joins</span>
<a name="l3912"><span class="linenum">3912</span></a>      if (!empty(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>['any'])) {
<a name="l3913"><span class="linenum">3913</span></a>  <span class="comment">        // simple case - there are no prohibits involved</span>
<a name="l3914"><span class="linenum">3914</span></a>          if (!empty(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>['any'][<a class="var it16422" onMouseOver="hilite(16422)" onMouseOut="lolite()" onClick="logVariable('defaultuserroleid')" href="../_variables/defaultuserroleid.html">$defaultuserroleid</a>]) <a class="function" onClick="logFunction('or')" href="../_functions/or.html" onMouseOver="funcPopup(event,'or')">or</a> (<a class="var it5773" onMouseOver="hilite(5773)" onMouseOut="lolite()" onClick="logVariable('isfrontpage')" href="../_variables/isfrontpage.html">$isfrontpage</a> and !empty(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>['any'][<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('defaultfrontpageroleid')" href="../_variables/defaultfrontpageroleid.html">$defaultfrontpageroleid</a>]))) {
<a name="l3915"><span class="linenum">3915</span></a>  <span class="comment">            // everybody</span>
<a name="l3916"><span class="linenum">3916</span></a>          } else {
<a name="l3917"><span class="linenum">3917</span></a>              <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('joins')" href="../_variables/joins.html">$joins</a>[] = &quot;<a class="function" onClick="logFunction('JOIN')" href="../_functions/join.html" onMouseOver="funcPopup(event,'join')">JOIN</a> (SELECT DISTINCT userid
<a name="l3918"><span class="linenum">3918</span></a>                                  FROM {role_assignments}
<a name="l3919"><span class="linenum">3919</span></a>                                 WHERE contextid IN (<a class="var it25259" onMouseOver="hilite(25259)" onMouseOut="lolite()" onClick="logVariable('ctxids')" href="../_variables/ctxids.html">$ctxids</a>)
<a name="l3920"><span class="linenum">3920</span></a>                                       AND roleid IN (&quot;.<a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',', <a class="phpfunction" onClick="logFunction('array_keys')" href="../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>['any'])) .&quot;)
<a name="l3921"><span class="linenum">3921</span></a>                               ) ra ON ra.userid = u.id&quot;;
<a name="l3922"><span class="linenum">3922</span></a>          }
<a name="l3923"><span class="linenum">3923</span></a>      } else {
<a name="l3924"><span class="linenum">3924</span></a>          <a class="var it23552" onMouseOver="hilite(23552)" onMouseOut="lolite()" onClick="logVariable('unions')" href="../_variables/unions.html">$unions</a> = array();
<a name="l3925"><span class="linenum">3925</span></a>          <a class="var it28868" onMouseOver="hilite(28868)" onMouseOut="lolite()" onClick="logVariable('everybody')" href="../_variables/everybody.html">$everybody</a> = false;
<a name="l3926"><span class="linenum">3926</span></a>          foreach (<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a> as <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>=&gt;<a class="var it1136" onMouseOver="hilite(1136)" onMouseOut="lolite()" onClick="logVariable('unused')" href="../_variables/unused.html">$unused</a>) {
<a name="l3927"><span class="linenum">3927</span></a>              if (empty(<a class="var it28820" onMouseOver="hilite(28820)" onMouseOut="lolite()" onClick="logVariable('prohibited')" href="../_variables/prohibited.html">$prohibited</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>])) {
<a name="l3928"><span class="linenum">3928</span></a>                  if (!empty(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>][<a class="var it16422" onMouseOver="hilite(16422)" onMouseOut="lolite()" onClick="logVariable('defaultuserroleid')" href="../_variables/defaultuserroleid.html">$defaultuserroleid</a>]) <a class="function" onClick="logFunction('or')" href="../_functions/or.html" onMouseOver="funcPopup(event,'or')">or</a> (<a class="var it5773" onMouseOver="hilite(5773)" onMouseOut="lolite()" onClick="logVariable('isfrontpage')" href="../_variables/isfrontpage.html">$isfrontpage</a> and !empty(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>][<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('defaultfrontpageroleid')" href="../_variables/defaultfrontpageroleid.html">$defaultfrontpageroleid</a>]))) {
<a name="l3929"><span class="linenum">3929</span></a>                      <a class="var it28868" onMouseOver="hilite(28868)" onMouseOut="lolite()" onClick="logVariable('everybody')" href="../_variables/everybody.html">$everybody</a> = true;
<a name="l3930"><span class="linenum">3930</span></a>                      break;
<a name="l3931"><span class="linenum">3931</span></a>                  } else {
<a name="l3932"><span class="linenum">3932</span></a>                      <a class="var it23552" onMouseOver="hilite(23552)" onMouseOut="lolite()" onClick="logVariable('unions')" href="../_variables/unions.html">$unions</a>[] = &quot;SELECT userid
<a name="l3933"><span class="linenum">3933</span></a>                                     FROM {role_assignments}
<a name="l3934"><span class="linenum">3934</span></a>                                    WHERE contextid IN (<a class="var it25259" onMouseOver="hilite(25259)" onMouseOut="lolite()" onClick="logVariable('ctxids')" href="../_variables/ctxids.html">$ctxids</a>)
<a name="l3935"><span class="linenum">3935</span></a>                                          AND roleid IN (&quot;.<a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',', <a class="phpfunction" onClick="logFunction('array_keys')" href="../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>])) .&quot;)&quot;;
<a name="l3936"><span class="linenum">3936</span></a>                  }
<a name="l3937"><span class="linenum">3937</span></a>              } else {
<a name="l3938"><span class="linenum">3938</span></a>                  if (!empty(<a class="var it28820" onMouseOver="hilite(28820)" onMouseOut="lolite()" onClick="logVariable('prohibited')" href="../_variables/prohibited.html">$prohibited</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>][<a class="var it16422" onMouseOver="hilite(16422)" onMouseOut="lolite()" onClick="logVariable('defaultuserroleid')" href="../_variables/defaultuserroleid.html">$defaultuserroleid</a>]) <a class="function" onClick="logFunction('or')" href="../_functions/or.html" onMouseOver="funcPopup(event,'or')">or</a> (<a class="var it5773" onMouseOver="hilite(5773)" onMouseOut="lolite()" onClick="logVariable('isfrontpage')" href="../_variables/isfrontpage.html">$isfrontpage</a> and !empty(<a class="var it28820" onMouseOver="hilite(28820)" onMouseOut="lolite()" onClick="logVariable('prohibited')" href="../_variables/prohibited.html">$prohibited</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>][<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('defaultfrontpageroleid')" href="../_variables/defaultfrontpageroleid.html">$defaultfrontpageroleid</a>]))) {
<a name="l3939"><span class="linenum">3939</span></a>  <span class="comment">                    // nobody can have this cap because it is prevented in default roles</span>
<a name="l3940"><span class="linenum">3940</span></a>                      continue;
<a name="l3941"><span class="linenum">3941</span></a>  
<a name="l3942"><span class="linenum">3942</span></a>                  } else if (!empty(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>][<a class="var it16422" onMouseOver="hilite(16422)" onMouseOut="lolite()" onClick="logVariable('defaultuserroleid')" href="../_variables/defaultuserroleid.html">$defaultuserroleid</a>]) <a class="function" onClick="logFunction('or')" href="../_functions/or.html" onMouseOver="funcPopup(event,'or')">or</a> (<a class="var it5773" onMouseOver="hilite(5773)" onMouseOut="lolite()" onClick="logVariable('isfrontpage')" href="../_variables/isfrontpage.html">$isfrontpage</a> and !empty(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>][<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('defaultfrontpageroleid')" href="../_variables/defaultfrontpageroleid.html">$defaultfrontpageroleid</a>]))) {
<a name="l3943"><span class="linenum">3943</span></a>  <span class="comment">                    // everybody except the prohibitted - hiding does not matter</span>
<a name="l3944"><span class="linenum">3944</span></a>                      <a class="var it23552" onMouseOver="hilite(23552)" onMouseOut="lolite()" onClick="logVariable('unions')" href="../_variables/unions.html">$unions</a>[] = &quot;SELECT id AS userid
<a name="l3945"><span class="linenum">3945</span></a>                                     FROM {user}
<a name="l3946"><span class="linenum">3946</span></a>                                    WHERE id NOT IN (SELECT userid
<a name="l3947"><span class="linenum">3947</span></a>                                                       FROM {role_assignments}
<a name="l3948"><span class="linenum">3948</span></a>                                                      WHERE contextid IN (<a class="var it25259" onMouseOver="hilite(25259)" onMouseOut="lolite()" onClick="logVariable('ctxids')" href="../_variables/ctxids.html">$ctxids</a>)
<a name="l3949"><span class="linenum">3949</span></a>                                                            AND roleid IN (&quot;.<a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',', <a class="phpfunction" onClick="logFunction('array_keys')" href="../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it28820" onMouseOver="hilite(28820)" onMouseOut="lolite()" onClick="logVariable('prohibited')" href="../_variables/prohibited.html">$prohibited</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>])) .&quot;))&quot;;
<a name="l3950"><span class="linenum">3950</span></a>  
<a name="l3951"><span class="linenum">3951</span></a>                  } else {
<a name="l3952"><span class="linenum">3952</span></a>                      <a class="var it23552" onMouseOver="hilite(23552)" onMouseOut="lolite()" onClick="logVariable('unions')" href="../_variables/unions.html">$unions</a>[] = &quot;SELECT userid
<a name="l3953"><span class="linenum">3953</span></a>                                     FROM {role_assignments}
<a name="l3954"><span class="linenum">3954</span></a>                                    WHERE contextid IN (<a class="var it25259" onMouseOver="hilite(25259)" onMouseOut="lolite()" onClick="logVariable('ctxids')" href="../_variables/ctxids.html">$ctxids</a>)
<a name="l3955"><span class="linenum">3955</span></a>                                          AND roleid IN (&quot;.<a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',', <a class="phpfunction" onClick="logFunction('array_keys')" href="../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>])) .&quot;)
<a name="l3956"><span class="linenum">3956</span></a>                                          AND roleid NOT IN (&quot;.<a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',', <a class="phpfunction" onClick="logFunction('array_keys')" href="../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it28820" onMouseOver="hilite(28820)" onMouseOut="lolite()" onClick="logVariable('prohibited')" href="../_variables/prohibited.html">$prohibited</a>[<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>])) .&quot;)&quot;;
<a name="l3957"><span class="linenum">3957</span></a>                  }
<a name="l3958"><span class="linenum">3958</span></a>              }
<a name="l3959"><span class="linenum">3959</span></a>          }
<a name="l3960"><span class="linenum">3960</span></a>          if (!<a class="var it28868" onMouseOver="hilite(28868)" onMouseOut="lolite()" onClick="logVariable('everybody')" href="../_variables/everybody.html">$everybody</a>) {
<a name="l3961"><span class="linenum">3961</span></a>              if (<a class="var it23552" onMouseOver="hilite(23552)" onMouseOut="lolite()" onClick="logVariable('unions')" href="../_variables/unions.html">$unions</a>) {
<a name="l3962"><span class="linenum">3962</span></a>                  <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('joins')" href="../_variables/joins.html">$joins</a>[] = &quot;<a class="function" onClick="logFunction('JOIN')" href="../_functions/join.html" onMouseOver="funcPopup(event,'join')">JOIN</a> (SELECT DISTINCT userid <a class="function" onClick="logFunction('FROM')" href="../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a> ( &quot;.<a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(' UNION ', <a class="var it23552" onMouseOver="hilite(23552)" onMouseOut="lolite()" onClick="logVariable('unions')" href="../_variables/unions.html">$unions</a>).&quot; ) us) ra ON ra.userid = u.id&quot;;
<a name="l3963"><span class="linenum">3963</span></a>              } else {
<a name="l3964"><span class="linenum">3964</span></a>  <span class="comment">                // only prohibits found - nobody can be matched</span>
<a name="l3965"><span class="linenum">3965</span></a>                  <a class="var it28864" onMouseOver="hilite(28864)" onMouseOut="lolite()" onClick="logVariable('wherecond')" href="../_variables/wherecond.html">$wherecond</a>[] = &quot;1 = 2&quot;;
<a name="l3966"><span class="linenum">3966</span></a>              }
<a name="l3967"><span class="linenum">3967</span></a>          }
<a name="l3968"><span class="linenum">3968</span></a>      }
<a name="l3969"><span class="linenum">3969</span></a>  
<a name="l3970"><span class="linenum">3970</span></a>  <span class="comment">    // Collect WHERE conditions and needed joins</span>
<a name="l3971"><span class="linenum">3971</span></a>      <a class="var it1076" onMouseOver="hilite(1076)" onMouseOut="lolite()" onClick="logVariable('where')" href="../_variables/where.html">$where</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(' AND ', <a class="var it28864" onMouseOver="hilite(28864)" onMouseOut="lolite()" onClick="logVariable('wherecond')" href="../_variables/wherecond.html">$wherecond</a>);
<a name="l3972"><span class="linenum">3972</span></a>      if (<a class="var it1076" onMouseOver="hilite(1076)" onMouseOut="lolite()" onClick="logVariable('where')" href="../_variables/where.html">$where</a> !== '') {
<a name="l3973"><span class="linenum">3973</span></a>          <a class="var it1076" onMouseOver="hilite(1076)" onMouseOut="lolite()" onClick="logVariable('where')" href="../_variables/where.html">$where</a> = 'WHERE ' . <a class="var it1076" onMouseOver="hilite(1076)" onMouseOut="lolite()" onClick="logVariable('where')" href="../_variables/where.html">$where</a>;
<a name="l3974"><span class="linenum">3974</span></a>      }
<a name="l3975"><span class="linenum">3975</span></a>      <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('joins')" href="../_variables/joins.html">$joins</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(&quot;\n&quot;, <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('joins')" href="../_variables/joins.html">$joins</a>);
<a name="l3976"><span class="linenum">3976</span></a>  
<a name="l3977"><span class="linenum">3977</span></a>  <span class="comment">    // Ok, let's get the users!</span>
<a name="l3978"><span class="linenum">3978</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT <a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>
<a name="l3979"><span class="linenum">3979</span></a>                FROM {user} u
<a name="l3980"><span class="linenum">3980</span></a>              <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('joins')" href="../_variables/joins.html">$joins</a>
<a name="l3981"><span class="linenum">3981</span></a>              <a class="var it1076" onMouseOver="hilite(1076)" onMouseOut="lolite()" onClick="logVariable('where')" href="../_variables/where.html">$where</a>
<a name="l3982"><span class="linenum">3982</span></a>            ORDER BY <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>&quot;;
<a name="l3983"><span class="linenum">3983</span></a>  
<a name="l3984"><span class="linenum">3984</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it2932" onMouseOver="hilite(2932)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../_variables/limitfrom.html">$limitfrom</a>, <a class="var it3120" onMouseOver="hilite(3120)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../_variables/limitnum.html">$limitnum</a>);
<a name="l3985"><span class="linenum">3985</span></a>  }
<a name="l3986"><span class="linenum">3986</span></a>  
<a name="l3987"><span class="linenum">3987</span></a>  <span class="comment">/**</span>
<a name="l3988"><span class="linenum">3988</span></a>  <span class="comment"> * Re-sort a users array based on a sorting policy</span>
<a name="l3989"><span class="linenum">3989</span></a>  <span class="comment"> *</span>
<a name="l3990"><span class="linenum">3990</span></a>  <span class="comment"> * Will re-sort a $users results array (from get_users_by_capability(), usually)</span>
<a name="l3991"><span class="linenum">3991</span></a>  <span class="comment"> * based on a sorting policy. This is to support the odd practice of</span>
<a name="l3992"><span class="linenum">3992</span></a>  <span class="comment"> * sorting teachers by 'authority', where authority was &quot;lowest id of the role</span>
<a name="l3993"><span class="linenum">3993</span></a>  <span class="comment"> * assignment&quot;.</span>
<a name="l3994"><span class="linenum">3994</span></a>  <span class="comment"> *</span>
<a name="l3995"><span class="linenum">3995</span></a>  <span class="comment"> * Will execute 1 database query. Only suitable for small numbers of users, as it</span>
<a name="l3996"><span class="linenum">3996</span></a>  <span class="comment"> * uses an u.id IN() clause.</span>
<a name="l3997"><span class="linenum">3997</span></a>  <span class="comment"> *</span>
<a name="l3998"><span class="linenum">3998</span></a>  <span class="comment"> * Notes about the sorting criteria.</span>
<a name="l3999"><span class="linenum">3999</span></a>  <span class="comment"> *</span>
<a name="l4000"><span class="linenum">4000</span></a>  <span class="comment"> * As a default, we cannot rely on role.sortorder because then</span>
<a name="l4001"><span class="linenum">4001</span></a>  <span class="comment"> * admins/coursecreators will always win. That is why the sane</span>
<a name="l4002"><span class="linenum">4002</span></a>  <span class="comment"> * rule &quot;is locality matters most&quot;, with sortorder as 2nd</span>
<a name="l4003"><span class="linenum">4003</span></a>  <span class="comment"> * consideration.</span>
<a name="l4004"><span class="linenum">4004</span></a>  <span class="comment"> *</span>
<a name="l4005"><span class="linenum">4005</span></a>  <span class="comment"> * If you want role.sortorder, use the 'sortorder' policy, and</span>
<a name="l4006"><span class="linenum">4006</span></a>  <span class="comment"> * name explicitly what roles you want to cover. It's probably</span>
<a name="l4007"><span class="linenum">4007</span></a>  <span class="comment"> * a good idea to see what roles have the capabilities you want</span>
<a name="l4008"><span class="linenum">4008</span></a>  <span class="comment"> * (array_diff() them against roiles that have 'can-do-anything'</span>
<a name="l4009"><span class="linenum">4009</span></a>  <span class="comment"> * to weed out admin-ish roles. Or fetch a list of roles from</span>
<a name="l4010"><span class="linenum">4010</span></a>  <span class="comment"> * variables like $CFG-&gt;coursecontact .</span>
<a name="l4011"><span class="linenum">4011</span></a>  <span class="comment"> *</span>
<a name="l4012"><span class="linenum">4012</span></a>  <span class="comment"> * @param array $users Users array, keyed on userid</span>
<a name="l4013"><span class="linenum">4013</span></a>  <span class="comment"> * @param context $context</span>
<a name="l4014"><span class="linenum">4014</span></a>  <span class="comment"> * @param array $roles ids of the roles to include, optional</span>
<a name="l4015"><span class="linenum">4015</span></a>  <span class="comment"> * @param string $sortpolicy defaults to locality, more about</span>
<a name="l4016"><span class="linenum">4016</span></a>  <span class="comment"> * @return array sorted copy of the array</span>
<a name="l4017"><span class="linenum">4017</span></a>  <span class="comment"> */</span>
<a name="l4018"><span class="linenum">4018</span></a>  function <a class="function" onClick="logFunction('sort_by_roleassignment_authority')" href="../_functions/sort_by_roleassignment_authority.html" onMouseOver="funcPopup(event,'sort_by_roleassignment_authority')">sort_by_roleassignment_authority</a>(<a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a>, context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a> = array(), <a class="var it28869" onMouseOver="hilite(28869)" onMouseOut="lolite()" onClick="logVariable('sortpolicy')" href="../_variables/sortpolicy.html">$sortpolicy</a> = 'locality') {
<a name="l4019"><span class="linenum">4019</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l4020"><span class="linenum">4020</span></a>  
<a name="l4021"><span class="linenum">4021</span></a>      <a class="var it28870" onMouseOver="hilite(28870)" onMouseOut="lolite()" onClick="logVariable('userswhere')" href="../_variables/userswhere.html">$userswhere</a> = ' ra.userid IN (' . <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',',<a class="phpfunction" onClick="logFunction('array_keys')" href="../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a>)) . ')';
<a name="l4022"><span class="linenum">4022</span></a>      <a class="var it21324" onMouseOver="hilite(21324)" onMouseOut="lolite()" onClick="logVariable('contextwhere')" href="../_variables/contextwhere.html">$contextwhere</a> = 'AND ra.contextid IN ('.<a class="phpfunction" onClick="logFunction('str_replace')" href="../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('/', ',',<a class="phpfunction" onClick="logFunction('substr')" href="../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('path')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/path.html">path</a>, 1)).')';
<a name="l4023"><span class="linenum">4023</span></a>      if (empty(<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>)) {
<a name="l4024"><span class="linenum">4024</span></a>          <a class="var it28871" onMouseOver="hilite(28871)" onMouseOut="lolite()" onClick="logVariable('roleswhere')" href="../_variables/roleswhere.html">$roleswhere</a> = '';
<a name="l4025"><span class="linenum">4025</span></a>      } else {
<a name="l4026"><span class="linenum">4026</span></a>          <a class="var it28871" onMouseOver="hilite(28871)" onMouseOut="lolite()" onClick="logVariable('roleswhere')" href="../_variables/roleswhere.html">$roleswhere</a> = ' AND ra.roleid IN ('.<a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',',<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>).')';
<a name="l4027"><span class="linenum">4027</span></a>      }
<a name="l4028"><span class="linenum">4028</span></a>  
<a name="l4029"><span class="linenum">4029</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT ra.userid
<a name="l4030"><span class="linenum">4030</span></a>                FROM {role_assignments} ra
<a name="l4031"><span class="linenum">4031</span></a>                JOIN {role} r
<a name="l4032"><span class="linenum">4032</span></a>                     ON ra.roleid=r.id
<a name="l4033"><span class="linenum">4033</span></a>                JOIN {context} ctx
<a name="l4034"><span class="linenum">4034</span></a>                     ON ra.contextid=ctx.id
<a name="l4035"><span class="linenum">4035</span></a>               WHERE <a class="var it28870" onMouseOver="hilite(28870)" onMouseOut="lolite()" onClick="logVariable('userswhere')" href="../_variables/userswhere.html">$userswhere</a>
<a name="l4036"><span class="linenum">4036</span></a>                     <a class="var it21324" onMouseOver="hilite(21324)" onMouseOut="lolite()" onClick="logVariable('contextwhere')" href="../_variables/contextwhere.html">$contextwhere</a>
<a name="l4037"><span class="linenum">4037</span></a>                     <a class="var it28871" onMouseOver="hilite(28871)" onMouseOut="lolite()" onClick="logVariable('roleswhere')" href="../_variables/roleswhere.html">$roleswhere</a>&quot;;
<a name="l4038"><span class="linenum">4038</span></a>  
<a name="l4039"><span class="linenum">4039</span></a>  <span class="comment">    // Default 'locality' policy -- read PHPDoc notes</span>
<a name="l4040"><span class="linenum">4040</span></a>  <span class="comment">    // about sort policies...</span>
<a name="l4041"><span class="linenum">4041</span></a>      <a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../_variables/orderby.html">$orderby</a> = 'ORDER BY '
<a name="l4042"><span class="linenum">4042</span></a>                      .'ctx.depth DESC, '  <span class="comment">/* locality wins */</span>
<a name="l4043"><span class="linenum">4043</span></a>                      .'r.sortorder ASC, ' <span class="comment">/* rolesorting 2nd criteria */</span>
<a name="l4044"><span class="linenum">4044</span></a>                      .'ra.id';            <span class="comment">/* role assignment order tie-breaker */</span>
<a name="l4045"><span class="linenum">4045</span></a>      if (<a class="var it28869" onMouseOver="hilite(28869)" onMouseOut="lolite()" onClick="logVariable('sortpolicy')" href="../_variables/sortpolicy.html">$sortpolicy</a> === 'sortorder') {
<a name="l4046"><span class="linenum">4046</span></a>          <a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../_variables/orderby.html">$orderby</a> = 'ORDER BY '
<a name="l4047"><span class="linenum">4047</span></a>                          .'r.sortorder ASC, ' <span class="comment">/* rolesorting 2nd criteria */</span>
<a name="l4048"><span class="linenum">4048</span></a>                          .'ra.id';            <span class="comment">/* role assignment order tie-breaker */</span>
<a name="l4049"><span class="linenum">4049</span></a>      }
<a name="l4050"><span class="linenum">4050</span></a>  
<a name="l4051"><span class="linenum">4051</span></a>      <a class="var it28872" onMouseOver="hilite(28872)" onMouseOut="lolite()" onClick="logVariable('sortedids')" href="../_variables/sortedids.html">$sortedids</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_fieldset_sql')" href="../_functions/get_fieldset_sql.html" onMouseOver="funcPopup(event,'get_fieldset_sql')">get_fieldset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> . <a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../_variables/orderby.html">$orderby</a>);
<a name="l4052"><span class="linenum">4052</span></a>      <a class="var it28873" onMouseOver="hilite(28873)" onMouseOut="lolite()" onClick="logVariable('sortedusers')" href="../_variables/sortedusers.html">$sortedusers</a> = array();
<a name="l4053"><span class="linenum">4053</span></a>      <a class="var it617" onMouseOver="hilite(617)" onMouseOut="lolite()" onClick="logVariable('seen')" href="../_variables/seen.html">$seen</a> = array();
<a name="l4054"><span class="linenum">4054</span></a>  
<a name="l4055"><span class="linenum">4055</span></a>      foreach (<a class="var it28872" onMouseOver="hilite(28872)" onMouseOut="lolite()" onClick="logVariable('sortedids')" href="../_variables/sortedids.html">$sortedids</a> as <a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>) {
<a name="l4056"><span class="linenum">4056</span></a>  <span class="comment">        // Avoid duplicates</span>
<a name="l4057"><span class="linenum">4057</span></a>          if (isset(<a class="var it617" onMouseOver="hilite(617)" onMouseOut="lolite()" onClick="logVariable('seen')" href="../_variables/seen.html">$seen</a>[<a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>])) {
<a name="l4058"><span class="linenum">4058</span></a>              continue;
<a name="l4059"><span class="linenum">4059</span></a>          }
<a name="l4060"><span class="linenum">4060</span></a>          <a class="var it617" onMouseOver="hilite(617)" onMouseOut="lolite()" onClick="logVariable('seen')" href="../_variables/seen.html">$seen</a>[<a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>] = true;
<a name="l4061"><span class="linenum">4061</span></a>  
<a name="l4062"><span class="linenum">4062</span></a>  <span class="comment">        // assign</span>
<a name="l4063"><span class="linenum">4063</span></a>          <a class="var it28873" onMouseOver="hilite(28873)" onMouseOut="lolite()" onClick="logVariable('sortedusers')" href="../_variables/sortedusers.html">$sortedusers</a>[<a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>] = <a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a>[<a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>];
<a name="l4064"><span class="linenum">4064</span></a>      }
<a name="l4065"><span class="linenum">4065</span></a>      return <a class="var it28873" onMouseOver="hilite(28873)" onMouseOut="lolite()" onClick="logVariable('sortedusers')" href="../_variables/sortedusers.html">$sortedusers</a>;
<a name="l4066"><span class="linenum">4066</span></a>  }
<a name="l4067"><span class="linenum">4067</span></a>  
<a name="l4068"><span class="linenum">4068</span></a>  <span class="comment">/**</span>
<a name="l4069"><span class="linenum">4069</span></a>  <span class="comment"> * Gets all the users assigned this role in this context or higher</span>
<a name="l4070"><span class="linenum">4070</span></a>  <span class="comment"> *</span>
<a name="l4071"><span class="linenum">4071</span></a>  <span class="comment"> * Note that moodle is based on capabilities and it is usually better</span>
<a name="l4072"><span class="linenum">4072</span></a>  <span class="comment"> * to check permissions than to check role ids as the capabilities</span>
<a name="l4073"><span class="linenum">4073</span></a>  <span class="comment"> * system is more flexible. If you really need, you can to use this</span>
<a name="l4074"><span class="linenum">4074</span></a>  <span class="comment"> * function but consider has_capability() as a possible substitute.</span>
<a name="l4075"><span class="linenum">4075</span></a>  <span class="comment"> *</span>
<a name="l4076"><span class="linenum">4076</span></a>  <span class="comment"> * The caller function is responsible for including all the</span>
<a name="l4077"><span class="linenum">4077</span></a>  <span class="comment"> * $sort fields in $fields param.</span>
<a name="l4078"><span class="linenum">4078</span></a>  <span class="comment"> *</span>
<a name="l4079"><span class="linenum">4079</span></a>  <span class="comment"> * If $roleid is an array or is empty (all roles) you need to set $fields</span>
<a name="l4080"><span class="linenum">4080</span></a>  <span class="comment"> * (and $sort by extension) params according to it, as the first field</span>
<a name="l4081"><span class="linenum">4081</span></a>  <span class="comment"> * returned by the database should be unique (ra.id is the best candidate).</span>
<a name="l4082"><span class="linenum">4082</span></a>  <span class="comment"> *</span>
<a name="l4083"><span class="linenum">4083</span></a>  <span class="comment"> * @param int $roleid (can also be an array of ints!)</span>
<a name="l4084"><span class="linenum">4084</span></a>  <span class="comment"> * @param context $context</span>
<a name="l4085"><span class="linenum">4085</span></a>  <span class="comment"> * @param bool $parent if true, get list of users assigned in higher context too</span>
<a name="l4086"><span class="linenum">4086</span></a>  <span class="comment"> * @param string $fields fields from user (u.) , role assignment (ra) or role (r.)</span>
<a name="l4087"><span class="linenum">4087</span></a>  <span class="comment"> * @param string $sort sort from user (u.) , role assignment (ra.) or role (r.).</span>
<a name="l4088"><span class="linenum">4088</span></a>  <span class="comment"> *      null =&gt; use default sort from users_order_by_sql.</span>
<a name="l4089"><span class="linenum">4089</span></a>  <span class="comment"> * @param bool $all true means all, false means limit to enrolled users</span>
<a name="l4090"><span class="linenum">4090</span></a>  <span class="comment"> * @param string $group defaults to ''</span>
<a name="l4091"><span class="linenum">4091</span></a>  <span class="comment"> * @param mixed $limitfrom defaults to ''</span>
<a name="l4092"><span class="linenum">4092</span></a>  <span class="comment"> * @param mixed $limitnum defaults to ''</span>
<a name="l4093"><span class="linenum">4093</span></a>  <span class="comment"> * @param string $extrawheretest defaults to ''</span>
<a name="l4094"><span class="linenum">4094</span></a>  <span class="comment"> * @param array $whereorsortparams any paramter values used by $sort or $extrawheretest.</span>
<a name="l4095"><span class="linenum">4095</span></a>  <span class="comment"> * @return array</span>
<a name="l4096"><span class="linenum">4096</span></a>  <span class="comment"> */</span>
<a name="l4097"><span class="linenum">4097</span></a>  function <a class="function" onClick="logFunction('get_role_users')" href="../_functions/get_role_users.html" onMouseOver="funcPopup(event,'get_role_users')">get_role_users</a>(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it75" onMouseOver="hilite(75)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../_variables/parent.html">$parent</a> = false, <a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = '',
<a name="l4098"><span class="linenum">4098</span></a>          <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a> = null, <a class="var it2916" onMouseOver="hilite(2916)" onMouseOut="lolite()" onClick="logVariable('all')" href="../_variables/all.html">$all</a> = true, <a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../_variables/group.html">$group</a> = '',
<a name="l4099"><span class="linenum">4099</span></a>          <a class="var it2932" onMouseOver="hilite(2932)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../_variables/limitfrom.html">$limitfrom</a> = '', <a class="var it3120" onMouseOver="hilite(3120)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../_variables/limitnum.html">$limitnum</a> = '', <a class="var it28874" onMouseOver="hilite(28874)" onMouseOut="lolite()" onClick="logVariable('extrawheretest')" href="../_variables/extrawheretest.html">$extrawheretest</a> = '', <a class="var it28875" onMouseOver="hilite(28875)" onMouseOut="lolite()" onClick="logVariable('whereorsortparams')" href="../_variables/whereorsortparams.html">$whereorsortparams</a> = array()) {
<a name="l4100"><span class="linenum">4100</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l4101"><span class="linenum">4101</span></a>  
<a name="l4102"><span class="linenum">4102</span></a>      if (empty(<a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>)) {
<a name="l4103"><span class="linenum">4103</span></a>          <a class="var it7865" onMouseOver="hilite(7865)" onMouseOut="lolite()" onClick="logVariable('allnames')" href="../_variables/allnames.html">$allnames</a> = <a class="function" onClick="logFunction('get_all_user_name_fields')" href="../_functions/get_all_user_name_fields.html" onMouseOver="funcPopup(event,'get_all_user_name_fields')">get_all_user_name_fields</a>(true, 'u');
<a name="l4104"><span class="linenum">4104</span></a>          <a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = 'u.id, u.confirmed, u.username, '. <a class="var it7865" onMouseOver="hilite(7865)" onMouseOut="lolite()" onClick="logVariable('allnames')" href="../_variables/allnames.html">$allnames</a> . ', ' .
<a name="l4105"><span class="linenum">4105</span></a>                    'u.maildisplay, u.mailformat, u.maildigest, u.email, u.emailstop, u.city, '.
<a name="l4106"><span class="linenum">4106</span></a>                    'u.country, u.picture, u.idnumber, u.department, u.institution, '.
<a name="l4107"><span class="linenum">4107</span></a>                    'u.lang, u.timezone, u.lastaccess, u.mnethostid, r.name AS rolename, r.sortorder, '.
<a name="l4108"><span class="linenum">4108</span></a>                    'r.shortname AS roleshortname, rn.name AS rolecoursealias';
<a name="l4109"><span class="linenum">4109</span></a>      }
<a name="l4110"><span class="linenum">4110</span></a>  
<a name="l4111"><span class="linenum">4111</span></a>  <span class="comment">    // Prevent wrong function uses.</span>
<a name="l4112"><span class="linenum">4112</span></a>      if ((empty(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>) || <a class="phpfunction" onClick="logFunction('is_array')" href="../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>)) &amp;&amp; <a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>, 'ra.id') !== 0) {
<a name="l4113"><span class="linenum">4113</span></a>          <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('<a class="function" onClick="logFunction('get_role_users')" href="../_functions/get_role_users.html" onMouseOver="funcPopup(event,'get_role_users')">get_role_users</a>() without specifying one single roleid needs to be called prefixing ' .
<a name="l4114"><span class="linenum">4114</span></a>              'role assignments <a class="function" onClick="logFunction('id')" href="../_functions/id.html" onMouseOver="funcPopup(event,'id')">id</a> (ra.id) as unique field, you can use <a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> param for it.');
<a name="l4115"><span class="linenum">4115</span></a>  
<a name="l4116"><span class="linenum">4116</span></a>          if (!empty(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>)) {
<a name="l4117"><span class="linenum">4117</span></a>  <span class="comment">            // Solving partially the issue when specifying multiple roles.</span>
<a name="l4118"><span class="linenum">4118</span></a>              <a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a> = array();
<a name="l4119"><span class="linenum">4119</span></a>              foreach (<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a> as <a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>) {
<a name="l4120"><span class="linenum">4120</span></a>  <span class="comment">                // Ignoring duplicated keys keeping the first user appearance.</span>
<a name="l4121"><span class="linenum">4121</span></a>                  <a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a> = <a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a> + <a class="function" onClick="logFunction('get_role_users')" href="../_functions/get_role_users.html" onMouseOver="funcPopup(event,'get_role_users')">get_role_users</a>(<a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it75" onMouseOver="hilite(75)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../_variables/parent.html">$parent</a>, <a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>, <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>, <a class="var it2916" onMouseOver="hilite(2916)" onMouseOut="lolite()" onClick="logVariable('all')" href="../_variables/all.html">$all</a>, <a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../_variables/group.html">$group</a>,
<a name="l4122"><span class="linenum">4122</span></a>                      <a class="var it2932" onMouseOver="hilite(2932)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../_variables/limitfrom.html">$limitfrom</a>, <a class="var it3120" onMouseOver="hilite(3120)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../_variables/limitnum.html">$limitnum</a>, <a class="var it28874" onMouseOver="hilite(28874)" onMouseOut="lolite()" onClick="logVariable('extrawheretest')" href="../_variables/extrawheretest.html">$extrawheretest</a>, <a class="var it28875" onMouseOver="hilite(28875)" onMouseOut="lolite()" onClick="logVariable('whereorsortparams')" href="../_variables/whereorsortparams.html">$whereorsortparams</a>);
<a name="l4123"><span class="linenum">4123</span></a>              }
<a name="l4124"><span class="linenum">4124</span></a>              return <a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a>;
<a name="l4125"><span class="linenum">4125</span></a>          }
<a name="l4126"><span class="linenum">4126</span></a>      }
<a name="l4127"><span class="linenum">4127</span></a>  
<a name="l4128"><span class="linenum">4128</span></a>      <a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a> = '';
<a name="l4129"><span class="linenum">4129</span></a>      if (<a class="var it75" onMouseOver="hilite(75)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../_variables/parent.html">$parent</a>) {
<a name="l4130"><span class="linenum">4130</span></a>          <a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a> = <a class="phpfunction" onClick="logFunction('substr')" href="../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('path')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/path.html">path</a>, 1); <span class="comment">// kill leading slash</span>
<a name="l4131"><span class="linenum">4131</span></a>          <a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('/', ',', <a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a>);
<a name="l4132"><span class="linenum">4132</span></a>          if (<a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a> !== '') {
<a name="l4133"><span class="linenum">4133</span></a>              <a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a> = ' OR ra.contextid IN ('.<a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a>.' )';
<a name="l4134"><span class="linenum">4134</span></a>          }
<a name="l4135"><span class="linenum">4135</span></a>      }
<a name="l4136"><span class="linenum">4136</span></a>  
<a name="l4137"><span class="linenum">4137</span></a>      if (<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>) {
<a name="l4138"><span class="linenum">4138</span></a>          <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it28877" onMouseOver="hilite(28877)" onMouseOut="lolite()" onClick="logVariable('rids')" href="../_variables/rids.html">$rids</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'r');
<a name="l4139"><span class="linenum">4139</span></a>          <a class="var it24677" onMouseOver="hilite(24677)" onMouseOut="lolite()" onClick="logVariable('roleselect')" href="../_variables/roleselect.html">$roleselect</a> = &quot;AND ra.roleid <a class="var it28877" onMouseOver="hilite(28877)" onMouseOut="lolite()" onClick="logVariable('rids')" href="../_variables/rids.html">$rids</a>&quot;;
<a name="l4140"><span class="linenum">4140</span></a>      } else {
<a name="l4141"><span class="linenum">4141</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array();
<a name="l4142"><span class="linenum">4142</span></a>          <a class="var it24677" onMouseOver="hilite(24677)" onMouseOut="lolite()" onClick="logVariable('roleselect')" href="../_variables/roleselect.html">$roleselect</a> = '';
<a name="l4143"><span class="linenum">4143</span></a>      }
<a name="l4144"><span class="linenum">4144</span></a>  
<a name="l4145"><span class="linenum">4145</span></a>      if (<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_course_context')" href="../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>(false)) {
<a name="l4146"><span class="linenum">4146</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['coursecontext'] = <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('id')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l4147"><span class="linenum">4147</span></a>      } else {
<a name="l4148"><span class="linenum">4148</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['coursecontext'] = 0;
<a name="l4149"><span class="linenum">4149</span></a>      }
<a name="l4150"><span class="linenum">4150</span></a>  
<a name="l4151"><span class="linenum">4151</span></a>      if (<a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../_variables/group.html">$group</a>) {
<a name="l4152"><span class="linenum">4152</span></a>          <a class="var it7069" onMouseOver="hilite(7069)" onMouseOut="lolite()" onClick="logVariable('groupjoin')" href="../_variables/groupjoin.html">$groupjoin</a>   = &quot;JOIN {groups_members} gm ON gm.userid = u.id&quot;;
<a name="l4153"><span class="linenum">4153</span></a>          <a class="var it7068" onMouseOver="hilite(7068)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../_variables/groupselect.html">$groupselect</a> = &quot; AND gm.groupid = :groupid &quot;;
<a name="l4154"><span class="linenum">4154</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['groupid'] = <a class="var it4136" onMouseOver="hilite(4136)" onMouseOut="lolite()" onClick="logVariable('group')" href="../_variables/group.html">$group</a>;
<a name="l4155"><span class="linenum">4155</span></a>      } else {
<a name="l4156"><span class="linenum">4156</span></a>          <a class="var it7069" onMouseOver="hilite(7069)" onMouseOut="lolite()" onClick="logVariable('groupjoin')" href="../_variables/groupjoin.html">$groupjoin</a>   = '';
<a name="l4157"><span class="linenum">4157</span></a>          <a class="var it7068" onMouseOver="hilite(7068)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../_variables/groupselect.html">$groupselect</a> = '';
<a name="l4158"><span class="linenum">4158</span></a>      }
<a name="l4159"><span class="linenum">4159</span></a>  
<a name="l4160"><span class="linenum">4160</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['contextid'] = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l4161"><span class="linenum">4161</span></a>  
<a name="l4162"><span class="linenum">4162</span></a>      if (<a class="var it28874" onMouseOver="hilite(28874)" onMouseOut="lolite()" onClick="logVariable('extrawheretest')" href="../_variables/extrawheretest.html">$extrawheretest</a>) {
<a name="l4163"><span class="linenum">4163</span></a>          <a class="var it28874" onMouseOver="hilite(28874)" onMouseOut="lolite()" onClick="logVariable('extrawheretest')" href="../_variables/extrawheretest.html">$extrawheretest</a> = ' AND ' . <a class="var it28874" onMouseOver="hilite(28874)" onMouseOut="lolite()" onClick="logVariable('extrawheretest')" href="../_variables/extrawheretest.html">$extrawheretest</a>;
<a name="l4164"><span class="linenum">4164</span></a>      }
<a name="l4165"><span class="linenum">4165</span></a>  
<a name="l4166"><span class="linenum">4166</span></a>      if (<a class="var it28875" onMouseOver="hilite(28875)" onMouseOut="lolite()" onClick="logVariable('whereorsortparams')" href="../_variables/whereorsortparams.html">$whereorsortparams</a>) {
<a name="l4167"><span class="linenum">4167</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it28875" onMouseOver="hilite(28875)" onMouseOut="lolite()" onClick="logVariable('whereorsortparams')" href="../_variables/whereorsortparams.html">$whereorsortparams</a>);
<a name="l4168"><span class="linenum">4168</span></a>      }
<a name="l4169"><span class="linenum">4169</span></a>  
<a name="l4170"><span class="linenum">4170</span></a>      if (!<a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>) {
<a name="l4171"><span class="linenum">4171</span></a>          <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>, <a class="var it533" onMouseOver="hilite(533)" onMouseOut="lolite()" onClick="logVariable('sortparams')" href="../_variables/sortparams.html">$sortparams</a>) = <a class="function" onClick="logFunction('users_order_by_sql')" href="../_functions/users_order_by_sql.html" onMouseOver="funcPopup(event,'users_order_by_sql')">users_order_by_sql</a>('u');
<a name="l4172"><span class="linenum">4172</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it533" onMouseOver="hilite(533)" onMouseOut="lolite()" onClick="logVariable('sortparams')" href="../_variables/sortparams.html">$sortparams</a>);
<a name="l4173"><span class="linenum">4173</span></a>      }
<a name="l4174"><span class="linenum">4174</span></a>  
<a name="l4175"><span class="linenum">4175</span></a>      if (<a class="var it2916" onMouseOver="hilite(2916)" onMouseOut="lolite()" onClick="logVariable('all')" href="../_variables/all.html">$all</a> === null) {
<a name="l4176"><span class="linenum">4176</span></a>  <span class="comment">        // Previously null was used to indicate that parameter was not used.</span>
<a name="l4177"><span class="linenum">4177</span></a>          <a class="var it2916" onMouseOver="hilite(2916)" onMouseOut="lolite()" onClick="logVariable('all')" href="../_variables/all.html">$all</a> = true;
<a name="l4178"><span class="linenum">4178</span></a>      }
<a name="l4179"><span class="linenum">4179</span></a>      if (!<a class="var it2916" onMouseOver="hilite(2916)" onMouseOut="lolite()" onClick="logVariable('all')" href="../_variables/all.html">$all</a> and <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>) {
<a name="l4180"><span class="linenum">4180</span></a>  <span class="comment">        // Do not use get_enrolled_sql() here for performance reasons.</span>
<a name="l4181"><span class="linenum">4181</span></a>          <a class="var it28824" onMouseOver="hilite(28824)" onMouseOut="lolite()" onClick="logVariable('ejoin')" href="../_variables/ejoin.html">$ejoin</a> = &quot;JOIN {user_enrolments} ue ON ue.userid = u.id
<a name="l4182"><span class="linenum">4182</span></a>                    JOIN {enrol} e <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (e.id = ue.enrolid AND e.courseid = :ecourseid)&quot;;
<a name="l4183"><span class="linenum">4183</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['ecourseid'] = <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>;
<a name="l4184"><span class="linenum">4184</span></a>      } else {
<a name="l4185"><span class="linenum">4185</span></a>          <a class="var it28824" onMouseOver="hilite(28824)" onMouseOut="lolite()" onClick="logVariable('ejoin')" href="../_variables/ejoin.html">$ejoin</a> = &quot;&quot;;
<a name="l4186"><span class="linenum">4186</span></a>      }
<a name="l4187"><span class="linenum">4187</span></a>  
<a name="l4188"><span class="linenum">4188</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT DISTINCT <a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>, ra.roleid
<a name="l4189"><span class="linenum">4189</span></a>                FROM {role_assignments} ra
<a name="l4190"><span class="linenum">4190</span></a>                JOIN {user} u ON u.id = ra.userid
<a name="l4191"><span class="linenum">4191</span></a>                JOIN {role} r ON ra.roleid = r.id
<a name="l4192"><span class="linenum">4192</span></a>              <a class="var it28824" onMouseOver="hilite(28824)" onMouseOut="lolite()" onClick="logVariable('ejoin')" href="../_variables/ejoin.html">$ejoin</a>
<a name="l4193"><span class="linenum">4193</span></a>           LEFT JOIN {role_names} rn <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (rn.contextid = :coursecontext AND rn.roleid = r.id)
<a name="l4194"><span class="linenum">4194</span></a>          <a class="var it7069" onMouseOver="hilite(7069)" onMouseOut="lolite()" onClick="logVariable('groupjoin')" href="../_variables/groupjoin.html">$groupjoin</a>
<a name="l4195"><span class="linenum">4195</span></a>               <a class="function" onClick="logFunction('WHERE')" href="../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a> (ra.contextid = :contextid <a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a>)
<a name="l4196"><span class="linenum">4196</span></a>                     <a class="var it24677" onMouseOver="hilite(24677)" onMouseOut="lolite()" onClick="logVariable('roleselect')" href="../_variables/roleselect.html">$roleselect</a>
<a name="l4197"><span class="linenum">4197</span></a>                     <a class="var it7068" onMouseOver="hilite(7068)" onMouseOut="lolite()" onClick="logVariable('groupselect')" href="../_variables/groupselect.html">$groupselect</a>
<a name="l4198"><span class="linenum">4198</span></a>                     <a class="var it28874" onMouseOver="hilite(28874)" onMouseOut="lolite()" onClick="logVariable('extrawheretest')" href="../_variables/extrawheretest.html">$extrawheretest</a>
<a name="l4199"><span class="linenum">4199</span></a>            ORDER BY <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>&quot;;                  <span class="comment">// join now so that we can just use fullname() later</span>
<a name="l4200"><span class="linenum">4200</span></a>  
<a name="l4201"><span class="linenum">4201</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it2932" onMouseOver="hilite(2932)" onMouseOut="lolite()" onClick="logVariable('limitfrom')" href="../_variables/limitfrom.html">$limitfrom</a>, <a class="var it3120" onMouseOver="hilite(3120)" onMouseOut="lolite()" onClick="logVariable('limitnum')" href="../_variables/limitnum.html">$limitnum</a>);
<a name="l4202"><span class="linenum">4202</span></a>  }
<a name="l4203"><span class="linenum">4203</span></a>  
<a name="l4204"><span class="linenum">4204</span></a>  <span class="comment">/**</span>
<a name="l4205"><span class="linenum">4205</span></a>  <span class="comment"> * Counts all the users assigned this role in this context or higher</span>
<a name="l4206"><span class="linenum">4206</span></a>  <span class="comment"> *</span>
<a name="l4207"><span class="linenum">4207</span></a>  <span class="comment"> * @param int|array $roleid either int or an array of ints</span>
<a name="l4208"><span class="linenum">4208</span></a>  <span class="comment"> * @param context $context</span>
<a name="l4209"><span class="linenum">4209</span></a>  <span class="comment"> * @param bool $parent if true, get list of users assigned in higher context too</span>
<a name="l4210"><span class="linenum">4210</span></a>  <span class="comment"> * @return int Returns the result count</span>
<a name="l4211"><span class="linenum">4211</span></a>  <span class="comment"> */</span>
<a name="l4212"><span class="linenum">4212</span></a>  function <a class="function" onClick="logFunction('count_role_users')" href="../_functions/count_role_users.html" onMouseOver="funcPopup(event,'count_role_users')">count_role_users</a>(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it75" onMouseOver="hilite(75)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../_variables/parent.html">$parent</a> = false) {
<a name="l4213"><span class="linenum">4213</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l4214"><span class="linenum">4214</span></a>  
<a name="l4215"><span class="linenum">4215</span></a>      if (<a class="var it75" onMouseOver="hilite(75)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../_variables/parent.html">$parent</a>) {
<a name="l4216"><span class="linenum">4216</span></a>          if (<a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../_variables/contexts.html">$contexts</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_parent_context_ids')" href="../_functions/get_parent_context_ids.html" onMouseOver="funcPopup(event,'get_parent_context_ids')">get_parent_context_ids</a>()) {
<a name="l4217"><span class="linenum">4217</span></a>              <a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a> = ' OR r.contextid IN ('.<a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',', <a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../_variables/contexts.html">$contexts</a>).')';
<a name="l4218"><span class="linenum">4218</span></a>          } else {
<a name="l4219"><span class="linenum">4219</span></a>              <a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a> = '';
<a name="l4220"><span class="linenum">4220</span></a>          }
<a name="l4221"><span class="linenum">4221</span></a>      } else {
<a name="l4222"><span class="linenum">4222</span></a>          <a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a> = '';
<a name="l4223"><span class="linenum">4223</span></a>      }
<a name="l4224"><span class="linenum">4224</span></a>  
<a name="l4225"><span class="linenum">4225</span></a>      if (<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>) {
<a name="l4226"><span class="linenum">4226</span></a>          <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it28877" onMouseOver="hilite(28877)" onMouseOut="lolite()" onClick="logVariable('rids')" href="../_variables/rids.html">$rids</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_QM')" href="../_constants/SQL_PARAMS_QM.html" onMouseOver="constPopup(event,'SQL_PARAMS_QM')">SQL_PARAMS_QM</a>);
<a name="l4227"><span class="linenum">4227</span></a>          <a class="var it24677" onMouseOver="hilite(24677)" onMouseOut="lolite()" onClick="logVariable('roleselect')" href="../_variables/roleselect.html">$roleselect</a> = &quot;AND r.roleid <a class="var it28877" onMouseOver="hilite(28877)" onMouseOut="lolite()" onClick="logVariable('rids')" href="../_variables/rids.html">$rids</a>&quot;;
<a name="l4228"><span class="linenum">4228</span></a>      } else {
<a name="l4229"><span class="linenum">4229</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array();
<a name="l4230"><span class="linenum">4230</span></a>          <a class="var it24677" onMouseOver="hilite(24677)" onMouseOut="lolite()" onClick="logVariable('roleselect')" href="../_variables/roleselect.html">$roleselect</a> = '';
<a name="l4231"><span class="linenum">4231</span></a>      }
<a name="l4232"><span class="linenum">4232</span></a>  
<a name="l4233"><span class="linenum">4233</span></a>      <a class="phpfunction" onClick="logFunction('array_unshift')" href="../_functions/array_unshift.html" onMouseOver="phpfuncPopup(event,'array_unshift')">array_unshift</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l4234"><span class="linenum">4234</span></a>  
<a name="l4235"><span class="linenum">4235</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT <a class="phpfunction" onClick="logFunction('COUNT')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(DISTINCT u.id)
<a name="l4236"><span class="linenum">4236</span></a>                FROM {role_assignments} r
<a name="l4237"><span class="linenum">4237</span></a>                JOIN {user} u ON u.id = r.userid
<a name="l4238"><span class="linenum">4238</span></a>               <a class="function" onClick="logFunction('WHERE')" href="../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a> (r.contextid = ? <a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a>)
<a name="l4239"><span class="linenum">4239</span></a>                     <a class="var it24677" onMouseOver="hilite(24677)" onMouseOut="lolite()" onClick="logVariable('roleselect')" href="../_variables/roleselect.html">$roleselect</a>
<a name="l4240"><span class="linenum">4240</span></a>                     AND u.deleted = 0&quot;;
<a name="l4241"><span class="linenum">4241</span></a>  
<a name="l4242"><span class="linenum">4242</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records_sql')" href="../_functions/count_records_sql.html" onMouseOver="funcPopup(event,'count_records_sql')">count_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l4243"><span class="linenum">4243</span></a>  }
<a name="l4244"><span class="linenum">4244</span></a>  
<a name="l4245"><span class="linenum">4245</span></a>  <span class="comment">/**</span>
<a name="l4246"><span class="linenum">4246</span></a>  <span class="comment"> * This function gets the list of courses that this user has a particular capability in.</span>
<a name="l4247"><span class="linenum">4247</span></a>  <span class="comment"> * It is still not very efficient.</span>
<a name="l4248"><span class="linenum">4248</span></a>  <span class="comment"> *</span>
<a name="l4249"><span class="linenum">4249</span></a>  <span class="comment"> * @param string $capability Capability in question</span>
<a name="l4250"><span class="linenum">4250</span></a>  <span class="comment"> * @param int $userid User ID or null for current user</span>
<a name="l4251"><span class="linenum">4251</span></a>  <span class="comment"> * @param bool $doanything True if 'doanything' is permitted (default)</span>
<a name="l4252"><span class="linenum">4252</span></a>  <span class="comment"> * @param string $fieldsexceptid Leave blank if you only need 'id' in the course records;</span>
<a name="l4253"><span class="linenum">4253</span></a>  <span class="comment"> *   otherwise use a comma-separated list of the fields you require, not including id</span>
<a name="l4254"><span class="linenum">4254</span></a>  <span class="comment"> * @param string $orderby If set, use a comma-separated list of fields from course</span>
<a name="l4255"><span class="linenum">4255</span></a>  <span class="comment"> *   table with sql modifiers (DESC) if needed</span>
<a name="l4256"><span class="linenum">4256</span></a>  <span class="comment"> * @return array|bool Array of courses, if none found false is returned.</span>
<a name="l4257"><span class="linenum">4257</span></a>  <span class="comment"> */</span>
<a name="l4258"><span class="linenum">4258</span></a>  function <a class="function" onClick="logFunction('get_user_capability_course')" href="../_functions/get_user_capability_course.html" onMouseOver="funcPopup(event,'get_user_capability_course')">get_user_capability_course</a>(<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> = null, <a class="var it28638" onMouseOver="hilite(28638)" onMouseOut="lolite()" onClick="logVariable('doanything')" href="../_variables/doanything.html">$doanything</a> = true, <a class="var it28878" onMouseOver="hilite(28878)" onMouseOut="lolite()" onClick="logVariable('fieldsexceptid')" href="../_variables/fieldsexceptid.html">$fieldsexceptid</a> = '', <a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../_variables/orderby.html">$orderby</a> = '') {
<a name="l4259"><span class="linenum">4259</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l4260"><span class="linenum">4260</span></a>  
<a name="l4261"><span class="linenum">4261</span></a>  <span class="comment">    // Convert fields list and ordering</span>
<a name="l4262"><span class="linenum">4262</span></a>      <a class="var it28879" onMouseOver="hilite(28879)" onMouseOut="lolite()" onClick="logVariable('fieldlist')" href="../_variables/fieldlist.html">$fieldlist</a> = '';
<a name="l4263"><span class="linenum">4263</span></a>      if (<a class="var it28878" onMouseOver="hilite(28878)" onMouseOut="lolite()" onClick="logVariable('fieldsexceptid')" href="../_variables/fieldsexceptid.html">$fieldsexceptid</a>) {
<a name="l4264"><span class="linenum">4264</span></a>          <a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it28878" onMouseOver="hilite(28878)" onMouseOut="lolite()" onClick="logVariable('fieldsexceptid')" href="../_variables/fieldsexceptid.html">$fieldsexceptid</a>);
<a name="l4265"><span class="linenum">4265</span></a>          foreach(<a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> as <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../_variables/field.html">$field</a>) {
<a name="l4266"><span class="linenum">4266</span></a>              <a class="var it28879" onMouseOver="hilite(28879)" onMouseOut="lolite()" onClick="logVariable('fieldlist')" href="../_variables/fieldlist.html">$fieldlist</a> .= ',c.'.<a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../_variables/field.html">$field</a>;
<a name="l4267"><span class="linenum">4267</span></a>          }
<a name="l4268"><span class="linenum">4268</span></a>      }
<a name="l4269"><span class="linenum">4269</span></a>      if (<a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../_variables/orderby.html">$orderby</a>) {
<a name="l4270"><span class="linenum">4270</span></a>          <a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../_variables/orderby.html">$orderby</a>);
<a name="l4271"><span class="linenum">4271</span></a>          <a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../_variables/orderby.html">$orderby</a> = '';
<a name="l4272"><span class="linenum">4272</span></a>          foreach(<a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> as <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../_variables/field.html">$field</a>) {
<a name="l4273"><span class="linenum">4273</span></a>              if (<a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../_variables/orderby.html">$orderby</a>) {
<a name="l4274"><span class="linenum">4274</span></a>                  <a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../_variables/orderby.html">$orderby</a> .= ',';
<a name="l4275"><span class="linenum">4275</span></a>              }
<a name="l4276"><span class="linenum">4276</span></a>              <a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../_variables/orderby.html">$orderby</a> .= 'c.'.<a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('field')" href="../_variables/field.html">$field</a>;
<a name="l4277"><span class="linenum">4277</span></a>          }
<a name="l4278"><span class="linenum">4278</span></a>          <a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../_variables/orderby.html">$orderby</a> = 'ORDER BY '.<a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../_variables/orderby.html">$orderby</a>;
<a name="l4279"><span class="linenum">4279</span></a>      }
<a name="l4280"><span class="linenum">4280</span></a>  
<a name="l4281"><span class="linenum">4281</span></a>  <span class="comment">    // Obtain a list of everything relevant about all courses including context.</span>
<a name="l4282"><span class="linenum">4282</span></a>  <span class="comment">    // Note the result can be used directly as a context (we are going to), the course</span>
<a name="l4283"><span class="linenum">4283</span></a>  <span class="comment">    // fields are just appended.</span>
<a name="l4284"><span class="linenum">4284</span></a>  
<a name="l4285"><span class="linenum">4285</span></a>      <a class="var it28880" onMouseOver="hilite(28880)" onMouseOut="lolite()" onClick="logVariable('contextpreload')" href="../_variables/contextpreload.html">$contextpreload</a> = <a class="class" onClick="logClass('context_helper')" href="../_classes/context_helper.html" onMouseOver="classPopup(event,'context_helper')">context_helper</a>::<a class="function" onClick="logFunction('get_preload_record_columns_sql')" href="../_functions/get_preload_record_columns_sql.html" onMouseOver="funcPopup(event,'get_preload_record_columns_sql')">get_preload_record_columns_sql</a>('x');
<a name="l4286"><span class="linenum">4286</span></a>  
<a name="l4287"><span class="linenum">4287</span></a>      <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a> = array();
<a name="l4288"><span class="linenum">4288</span></a>      <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(&quot;SELECT c.id <a class="var it28879" onMouseOver="hilite(28879)" onMouseOut="lolite()" onClick="logVariable('fieldlist')" href="../_variables/fieldlist.html">$fieldlist</a>, <a class="var it28880" onMouseOver="hilite(28880)" onMouseOut="lolite()" onClick="logVariable('contextpreload')" href="../_variables/contextpreload.html">$contextpreload</a>
<a name="l4289"><span class="linenum">4289</span></a>                                      FROM {course} c
<a name="l4290"><span class="linenum">4290</span></a>                                      JOIN {context} x <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (c.id=x.instanceid AND x.contextlevel=&quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>.&quot;)
<a name="l4291"><span class="linenum">4291</span></a>                                  <a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../_variables/orderby.html">$orderby</a>&quot;);
<a name="l4292"><span class="linenum">4292</span></a>  <span class="comment">    // Check capability for each course in turn</span>
<a name="l4293"><span class="linenum">4293</span></a>      foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> as <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>) {
<a name="l4294"><span class="linenum">4294</span></a>          <a class="class" onClick="logClass('context_helper')" href="../_classes/context_helper.html" onMouseOver="classPopup(event,'context_helper')">context_helper</a>::<a class="function" onClick="logFunction('preload_from_record')" href="../_functions/preload_from_record.html" onMouseOver="funcPopup(event,'preload_from_record')">preload_from_record</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>);
<a name="l4295"><span class="linenum">4295</span></a>          <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l4296"><span class="linenum">4296</span></a>          if (<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it28638" onMouseOver="hilite(28638)" onMouseOut="lolite()" onClick="logVariable('doanything')" href="../_variables/doanything.html">$doanything</a>)) {
<a name="l4297"><span class="linenum">4297</span></a>  <span class="comment">            // We've got the capability. Make the record look like a course record</span>
<a name="l4298"><span class="linenum">4298</span></a>  <span class="comment">            // and store it</span>
<a name="l4299"><span class="linenum">4299</span></a>              <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a>[] = <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>;
<a name="l4300"><span class="linenum">4300</span></a>          }
<a name="l4301"><span class="linenum">4301</span></a>      }
<a name="l4302"><span class="linenum">4302</span></a>      <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l4303"><span class="linenum">4303</span></a>      return empty(<a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a>) ? false : <a class="var it520" onMouseOver="hilite(520)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../_variables/courses.html">$courses</a>;
<a name="l4304"><span class="linenum">4304</span></a>  }
<a name="l4305"><span class="linenum">4305</span></a>  
<a name="l4306"><span class="linenum">4306</span></a>  <span class="comment">/**</span>
<a name="l4307"><span class="linenum">4307</span></a>  <span class="comment"> * This function finds the roles assigned directly to this context only</span>
<a name="l4308"><span class="linenum">4308</span></a>  <span class="comment"> * i.e. no roles in parent contexts</span>
<a name="l4309"><span class="linenum">4309</span></a>  <span class="comment"> *</span>
<a name="l4310"><span class="linenum">4310</span></a>  <span class="comment"> * @param context $context</span>
<a name="l4311"><span class="linenum">4311</span></a>  <span class="comment"> * @return array</span>
<a name="l4312"><span class="linenum">4312</span></a>  <span class="comment"> */</span>
<a name="l4313"><span class="linenum">4313</span></a>  function <a class="function" onClick="logFunction('get_roles_on_exact_context')" href="../_functions/get_roles_on_exact_context.html" onMouseOver="funcPopup(event,'get_roles_on_exact_context')">get_roles_on_exact_context</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l4314"><span class="linenum">4314</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l4315"><span class="linenum">4315</span></a>  
<a name="l4316"><span class="linenum">4316</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT r.*
<a name="l4317"><span class="linenum">4317</span></a>                                     FROM {role_assignments} ra, {role} r
<a name="l4318"><span class="linenum">4318</span></a>                                    WHERE ra.roleid = r.id AND ra.contextid = ?&quot;,
<a name="l4319"><span class="linenum">4319</span></a>                                  array(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l4320"><span class="linenum">4320</span></a>  }
<a name="l4321"><span class="linenum">4321</span></a>  
<a name="l4322"><span class="linenum">4322</span></a>  <span class="comment">/**</span>
<a name="l4323"><span class="linenum">4323</span></a>  <span class="comment"> * Switches the current user to another role for the current session and only</span>
<a name="l4324"><span class="linenum">4324</span></a>  <span class="comment"> * in the given context.</span>
<a name="l4325"><span class="linenum">4325</span></a>  <span class="comment"> *</span>
<a name="l4326"><span class="linenum">4326</span></a>  <span class="comment"> * The caller *must* check</span>
<a name="l4327"><span class="linenum">4327</span></a>  <span class="comment"> * - that this op is allowed</span>
<a name="l4328"><span class="linenum">4328</span></a>  <span class="comment"> * - that the requested role can be switched to in this context (use get_switchable_roles)</span>
<a name="l4329"><span class="linenum">4329</span></a>  <span class="comment"> * - that the requested role is NOT $CFG-&gt;defaultuserroleid</span>
<a name="l4330"><span class="linenum">4330</span></a>  <span class="comment"> *</span>
<a name="l4331"><span class="linenum">4331</span></a>  <span class="comment"> * To &quot;unswitch&quot; pass 0 as the roleid.</span>
<a name="l4332"><span class="linenum">4332</span></a>  <span class="comment"> *</span>
<a name="l4333"><span class="linenum">4333</span></a>  <span class="comment"> * This function *will* modify $USER-&gt;access - beware</span>
<a name="l4334"><span class="linenum">4334</span></a>  <span class="comment"> *</span>
<a name="l4335"><span class="linenum">4335</span></a>  <span class="comment"> * @param integer $roleid the role to switch to.</span>
<a name="l4336"><span class="linenum">4336</span></a>  <span class="comment"> * @param context $context the context in which to perform the switch.</span>
<a name="l4337"><span class="linenum">4337</span></a>  <span class="comment"> * @return bool success or failure.</span>
<a name="l4338"><span class="linenum">4338</span></a>  <span class="comment"> */</span>
<a name="l4339"><span class="linenum">4339</span></a>  function <a class="function" onClick="logFunction('role_switch')" href="../_functions/role_switch.html" onMouseOver="funcPopup(event,'role_switch')">role_switch</a>(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l4340"><span class="linenum">4340</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l4341"><span class="linenum">4341</span></a>  
<a name="l4342"><span class="linenum">4342</span></a>  <span class="comment">    //</span>
<a name="l4343"><span class="linenum">4343</span></a>  <span class="comment">    // Plan of action</span>
<a name="l4344"><span class="linenum">4344</span></a>  <span class="comment">    //</span>
<a name="l4345"><span class="linenum">4345</span></a>  <span class="comment">    // - Add the ghost RA to $USER-&gt;access</span>
<a name="l4346"><span class="linenum">4346</span></a>  <span class="comment">    //   as $USER-&gt;access['rsw'][$path] = $roleid</span>
<a name="l4347"><span class="linenum">4347</span></a>  <span class="comment">    //</span>
<a name="l4348"><span class="linenum">4348</span></a>  <span class="comment">    // - Make sure $USER-&gt;access['rdef'] has the roledefs</span>
<a name="l4349"><span class="linenum">4349</span></a>  <span class="comment">    //   it needs to honour the switcherole</span>
<a name="l4350"><span class="linenum">4350</span></a>  <span class="comment">    //</span>
<a name="l4351"><span class="linenum">4351</span></a>  <span class="comment">    // Roledefs will get loaded &quot;deep&quot; here - down to the last child</span>
<a name="l4352"><span class="linenum">4352</span></a>  <span class="comment">    // context. Note that</span>
<a name="l4353"><span class="linenum">4353</span></a>  <span class="comment">    //</span>
<a name="l4354"><span class="linenum">4354</span></a>  <span class="comment">    // - When visiting subcontexts, our selective accessdata loading</span>
<a name="l4355"><span class="linenum">4355</span></a>  <span class="comment">    //   will still work fine - though those ra/rdefs will be ignored</span>
<a name="l4356"><span class="linenum">4356</span></a>  <span class="comment">    //   appropriately while the switch is in place</span>
<a name="l4357"><span class="linenum">4357</span></a>  <span class="comment">    //</span>
<a name="l4358"><span class="linenum">4358</span></a>  <span class="comment">    // - If a switcherole happens at a category with tons of courses</span>
<a name="l4359"><span class="linenum">4359</span></a>  <span class="comment">    //   (that have many overrides for switched-to role), the session</span>
<a name="l4360"><span class="linenum">4360</span></a>  <span class="comment">    //   will get... quite large. Sometimes you just can't win.</span>
<a name="l4361"><span class="linenum">4361</span></a>  <span class="comment">    //</span>
<a name="l4362"><span class="linenum">4362</span></a>  <span class="comment">    // To un-switch just unset($USER-&gt;access['rsw'][$path])</span>
<a name="l4363"><span class="linenum">4363</span></a>  <span class="comment">    //</span>
<a name="l4364"><span class="linenum">4364</span></a>  <span class="comment">    // Note: it is not possible to switch to roles that do not have course:view</span>
<a name="l4365"><span class="linenum">4365</span></a>  
<a name="l4366"><span class="linenum">4366</span></a>      if (!isset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>)) {
<a name="l4367"><span class="linenum">4367</span></a>          <a class="function" onClick="logFunction('load_all_capabilities')" href="../_functions/load_all_capabilities.html" onMouseOver="funcPopup(event,'load_all_capabilities')">load_all_capabilities</a>();
<a name="l4368"><span class="linenum">4368</span></a>      }
<a name="l4369"><span class="linenum">4369</span></a>  
<a name="l4370"><span class="linenum">4370</span></a>  
<a name="l4371"><span class="linenum">4371</span></a>  <span class="comment">    // Add the switch RA</span>
<a name="l4372"><span class="linenum">4372</span></a>      if (<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a> == 0) {
<a name="l4373"><span class="linenum">4373</span></a>          unset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['rsw'][<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('path')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/path.html">path</a>]);
<a name="l4374"><span class="linenum">4374</span></a>          return true;
<a name="l4375"><span class="linenum">4375</span></a>      }
<a name="l4376"><span class="linenum">4376</span></a>  
<a name="l4377"><span class="linenum">4377</span></a>      <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['rsw'][<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('path')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/path.html">path</a>] = <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>;
<a name="l4378"><span class="linenum">4378</span></a>  
<a name="l4379"><span class="linenum">4379</span></a>  <span class="comment">    // Load roledefs</span>
<a name="l4380"><span class="linenum">4380</span></a>      <a class="function" onClick="logFunction('load_role_access_by_context')" href="../_functions/load_role_access_by_context.html" onMouseOver="funcPopup(event,'load_role_access_by_context')">load_role_access_by_context</a>(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>);
<a name="l4381"><span class="linenum">4381</span></a>  
<a name="l4382"><span class="linenum">4382</span></a>      return true;
<a name="l4383"><span class="linenum">4383</span></a>  }
<a name="l4384"><span class="linenum">4384</span></a>  
<a name="l4385"><span class="linenum">4385</span></a>  <span class="comment">/**</span>
<a name="l4386"><span class="linenum">4386</span></a>  <span class="comment"> * Checks if the user has switched roles within the given course.</span>
<a name="l4387"><span class="linenum">4387</span></a>  <span class="comment"> *</span>
<a name="l4388"><span class="linenum">4388</span></a>  <span class="comment"> * Note: You can only switch roles within the course, hence it takes a course id</span>
<a name="l4389"><span class="linenum">4389</span></a>  <span class="comment"> * rather than a context. On that note Petr volunteered to implement this across</span>
<a name="l4390"><span class="linenum">4390</span></a>  <span class="comment"> * all other contexts, all requests for this should be forwarded to him ;)</span>
<a name="l4391"><span class="linenum">4391</span></a>  <span class="comment"> *</span>
<a name="l4392"><span class="linenum">4392</span></a>  <span class="comment"> * @param int $courseid The id of the course to check</span>
<a name="l4393"><span class="linenum">4393</span></a>  <span class="comment"> * @return bool True if the user has switched roles within the course.</span>
<a name="l4394"><span class="linenum">4394</span></a>  <span class="comment"> */</span>
<a name="l4395"><span class="linenum">4395</span></a>  function <a class="function" onClick="logFunction('is_role_switched')" href="../_functions/is_role_switched.html" onMouseOver="funcPopup(event,'is_role_switched')">is_role_switched</a>(<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>) {
<a name="l4396"><span class="linenum">4396</span></a>      global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l4397"><span class="linenum">4397</span></a>      <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l4398"><span class="linenum">4398</span></a>      return (!empty(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['rsw'][<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('path')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/path.html">path</a>]));
<a name="l4399"><span class="linenum">4399</span></a>  }
<a name="l4400"><span class="linenum">4400</span></a>  
<a name="l4401"><span class="linenum">4401</span></a>  <span class="comment">/**</span>
<a name="l4402"><span class="linenum">4402</span></a>  <span class="comment"> * Get any role that has an override on exact context</span>
<a name="l4403"><span class="linenum">4403</span></a>  <span class="comment"> *</span>
<a name="l4404"><span class="linenum">4404</span></a>  <span class="comment"> * @param context $context The context to check</span>
<a name="l4405"><span class="linenum">4405</span></a>  <span class="comment"> * @return array An array of roles</span>
<a name="l4406"><span class="linenum">4406</span></a>  <span class="comment"> */</span>
<a name="l4407"><span class="linenum">4407</span></a>  function <a class="function" onClick="logFunction('get_roles_with_override_on_context')" href="../_functions/get_roles_with_override_on_context.html" onMouseOver="funcPopup(event,'get_roles_with_override_on_context')">get_roles_with_override_on_context</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l4408"><span class="linenum">4408</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l4409"><span class="linenum">4409</span></a>  
<a name="l4410"><span class="linenum">4410</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT r.*
<a name="l4411"><span class="linenum">4411</span></a>                                     FROM {role_capabilities} rc, {role} r
<a name="l4412"><span class="linenum">4412</span></a>                                    WHERE rc.roleid = r.id AND rc.contextid = ?&quot;,
<a name="l4413"><span class="linenum">4413</span></a>                                  array(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l4414"><span class="linenum">4414</span></a>  }
<a name="l4415"><span class="linenum">4415</span></a>  
<a name="l4416"><span class="linenum">4416</span></a>  <span class="comment">/**</span>
<a name="l4417"><span class="linenum">4417</span></a>  <span class="comment"> * Get all capabilities for this role on this context (overrides)</span>
<a name="l4418"><span class="linenum">4418</span></a>  <span class="comment"> *</span>
<a name="l4419"><span class="linenum">4419</span></a>  <span class="comment"> * @param stdClass $role</span>
<a name="l4420"><span class="linenum">4420</span></a>  <span class="comment"> * @param context $context</span>
<a name="l4421"><span class="linenum">4421</span></a>  <span class="comment"> * @return array</span>
<a name="l4422"><span class="linenum">4422</span></a>  <span class="comment"> */</span>
<a name="l4423"><span class="linenum">4423</span></a>  function <a class="function" onClick="logFunction('get_capabilities_from_role_on_context')" href="../_functions/get_capabilities_from_role_on_context.html" onMouseOver="funcPopup(event,'get_capabilities_from_role_on_context')">get_capabilities_from_role_on_context</a>(<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>, context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l4424"><span class="linenum">4424</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l4425"><span class="linenum">4425</span></a>  
<a name="l4426"><span class="linenum">4426</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT *
<a name="l4427"><span class="linenum">4427</span></a>                                     FROM {role_capabilities}
<a name="l4428"><span class="linenum">4428</span></a>                                    WHERE contextid = ? AND roleid = ?&quot;,
<a name="l4429"><span class="linenum">4429</span></a>                                  array(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('id')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l4430"><span class="linenum">4430</span></a>  }
<a name="l4431"><span class="linenum">4431</span></a>  
<a name="l4432"><span class="linenum">4432</span></a>  <span class="comment">/**</span>
<a name="l4433"><span class="linenum">4433</span></a>  <span class="comment"> * Find out which roles has assignment on this context</span>
<a name="l4434"><span class="linenum">4434</span></a>  <span class="comment"> *</span>
<a name="l4435"><span class="linenum">4435</span></a>  <span class="comment"> * @param context $context</span>
<a name="l4436"><span class="linenum">4436</span></a>  <span class="comment"> * @return array</span>
<a name="l4437"><span class="linenum">4437</span></a>  <span class="comment"> *</span>
<a name="l4438"><span class="linenum">4438</span></a>  <span class="comment"> */</span>
<a name="l4439"><span class="linenum">4439</span></a>  function <a class="function" onClick="logFunction('get_roles_with_assignment_on_context')" href="../_functions/get_roles_with_assignment_on_context.html" onMouseOver="funcPopup(event,'get_roles_with_assignment_on_context')">get_roles_with_assignment_on_context</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l4440"><span class="linenum">4440</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l4441"><span class="linenum">4441</span></a>  
<a name="l4442"><span class="linenum">4442</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT r.*
<a name="l4443"><span class="linenum">4443</span></a>                                     FROM {role_assignments} ra, {role} r
<a name="l4444"><span class="linenum">4444</span></a>                                    WHERE ra.roleid = r.id AND ra.contextid = ?&quot;,
<a name="l4445"><span class="linenum">4445</span></a>                                  array(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l4446"><span class="linenum">4446</span></a>  }
<a name="l4447"><span class="linenum">4447</span></a>  
<a name="l4448"><span class="linenum">4448</span></a>  <span class="comment">/**</span>
<a name="l4449"><span class="linenum">4449</span></a>  <span class="comment"> * Find all user assignment of users for this role, on this context</span>
<a name="l4450"><span class="linenum">4450</span></a>  <span class="comment"> *</span>
<a name="l4451"><span class="linenum">4451</span></a>  <span class="comment"> * @param stdClass $role</span>
<a name="l4452"><span class="linenum">4452</span></a>  <span class="comment"> * @param context $context</span>
<a name="l4453"><span class="linenum">4453</span></a>  <span class="comment"> * @return array</span>
<a name="l4454"><span class="linenum">4454</span></a>  <span class="comment"> */</span>
<a name="l4455"><span class="linenum">4455</span></a>  function <a class="function" onClick="logFunction('get_users_from_role_on_context')" href="../_functions/get_users_from_role_on_context.html" onMouseOver="funcPopup(event,'get_users_from_role_on_context')">get_users_from_role_on_context</a>(<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>, context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l4456"><span class="linenum">4456</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l4457"><span class="linenum">4457</span></a>  
<a name="l4458"><span class="linenum">4458</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT *
<a name="l4459"><span class="linenum">4459</span></a>                                     FROM {role_assignments}
<a name="l4460"><span class="linenum">4460</span></a>                                    WHERE contextid = ? AND roleid = ?&quot;,
<a name="l4461"><span class="linenum">4461</span></a>                                  array(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('id')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l4462"><span class="linenum">4462</span></a>  }
<a name="l4463"><span class="linenum">4463</span></a>  
<a name="l4464"><span class="linenum">4464</span></a>  <span class="comment">/**</span>
<a name="l4465"><span class="linenum">4465</span></a>  <span class="comment"> * Simple function returning a boolean true if user has roles</span>
<a name="l4466"><span class="linenum">4466</span></a>  <span class="comment"> * in context or parent contexts, otherwise false.</span>
<a name="l4467"><span class="linenum">4467</span></a>  <span class="comment"> *</span>
<a name="l4468"><span class="linenum">4468</span></a>  <span class="comment"> * @param int $userid</span>
<a name="l4469"><span class="linenum">4469</span></a>  <span class="comment"> * @param int $roleid</span>
<a name="l4470"><span class="linenum">4470</span></a>  <span class="comment"> * @param int $contextid empty means any context</span>
<a name="l4471"><span class="linenum">4471</span></a>  <span class="comment"> * @return bool</span>
<a name="l4472"><span class="linenum">4472</span></a>  <span class="comment"> */</span>
<a name="l4473"><span class="linenum">4473</span></a>  function <a class="function" onClick="logFunction('user_has_role_assignment')" href="../_functions/user_has_role_assignment.html" onMouseOver="funcPopup(event,'user_has_role_assignment')">user_has_role_assignment</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, <a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a> = 0) {
<a name="l4474"><span class="linenum">4474</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l4475"><span class="linenum">4475</span></a>  
<a name="l4476"><span class="linenum">4476</span></a>      if (<a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a>) {
<a name="l4477"><span class="linenum">4477</span></a>          if (!<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = context::<a class="function" onClick="logFunction('instance_by_id')" href="../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>(<a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a>, <a class="constant" onClick="logConstant('IGNORE_MISSING')" href="../_constants/IGNORE_MISSING.html" onMouseOver="constPopup(event,'IGNORE_MISSING')">IGNORE_MISSING</a>)) {
<a name="l4478"><span class="linenum">4478</span></a>              return false;
<a name="l4479"><span class="linenum">4479</span></a>          }
<a name="l4480"><span class="linenum">4480</span></a>          <a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('parents')" href="../_variables/parents.html">$parents</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_parent_context_ids')" href="../_functions/get_parent_context_ids.html" onMouseOver="funcPopup(event,'get_parent_context_ids')">get_parent_context_ids</a>(true);
<a name="l4481"><span class="linenum">4481</span></a>          <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../_variables/contexts.html">$contexts</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('parents')" href="../_variables/parents.html">$parents</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'r');
<a name="l4482"><span class="linenum">4482</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['userid'] = <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>;
<a name="l4483"><span class="linenum">4483</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['roleid'] = <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>;
<a name="l4484"><span class="linenum">4484</span></a>  
<a name="l4485"><span class="linenum">4485</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT <a class="phpfunction" onClick="logFunction('COUNT')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(ra.id)
<a name="l4486"><span class="linenum">4486</span></a>                    FROM {role_assignments} ra
<a name="l4487"><span class="linenum">4487</span></a>                   WHERE ra.userid = :userid AND ra.roleid = :roleid AND ra.contextid <a class="var it2698" onMouseOver="hilite(2698)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../_variables/contexts.html">$contexts</a>&quot;;
<a name="l4488"><span class="linenum">4488</span></a>  
<a name="l4489"><span class="linenum">4489</span></a>          <a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../_variables/count.html">$count</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field_sql')" href="../_functions/get_field_sql.html" onMouseOver="funcPopup(event,'get_field_sql')">get_field_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l4490"><span class="linenum">4490</span></a>          return (<a class="var it441" onMouseOver="hilite(441)" onMouseOut="lolite()" onClick="logVariable('count')" href="../_variables/count.html">$count</a> &gt; 0);
<a name="l4491"><span class="linenum">4491</span></a>  
<a name="l4492"><span class="linenum">4492</span></a>      } else {
<a name="l4493"><span class="linenum">4493</span></a>          return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('role_assignments', array('userid'=&gt;<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, 'roleid'=&gt;<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>));
<a name="l4494"><span class="linenum">4494</span></a>      }
<a name="l4495"><span class="linenum">4495</span></a>  }
<a name="l4496"><span class="linenum">4496</span></a>  
<a name="l4497"><span class="linenum">4497</span></a>  <span class="comment">/**</span>
<a name="l4498"><span class="linenum">4498</span></a>  <span class="comment"> * Get localised role name or alias if exists and format the text.</span>
<a name="l4499"><span class="linenum">4499</span></a>  <span class="comment"> *</span>
<a name="l4500"><span class="linenum">4500</span></a>  <span class="comment"> * @param stdClass $role role object</span>
<a name="l4501"><span class="linenum">4501</span></a>  <span class="comment"> *      - optional 'coursealias' property should be included for performance reasons if course context used</span>
<a name="l4502"><span class="linenum">4502</span></a>  <span class="comment"> *      - description property is not required here</span>
<a name="l4503"><span class="linenum">4503</span></a>  <span class="comment"> * @param context|bool $context empty means system context</span>
<a name="l4504"><span class="linenum">4504</span></a>  <span class="comment"> * @param int $rolenamedisplay type of role name</span>
<a name="l4505"><span class="linenum">4505</span></a>  <span class="comment"> * @return string localised role name or course role name alias</span>
<a name="l4506"><span class="linenum">4506</span></a>  <span class="comment"> */</span>
<a name="l4507"><span class="linenum">4507</span></a>  function <a class="function" onClick="logFunction('role_get_name')" href="../_functions/role_get_name.html" onMouseOver="funcPopup(event,'role_get_name')">role_get_name</a>(stdClass <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = null, <a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('rolenamedisplay')" href="../_variables/rolenamedisplay.html">$rolenamedisplay</a> = <a class="constant" onClick="logConstant('ROLENAME_ALIAS')" href="../_constants/ROLENAME_ALIAS.html" onMouseOver="constPopup(event,'ROLENAME_ALIAS')">ROLENAME_ALIAS</a>) {
<a name="l4508"><span class="linenum">4508</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l4509"><span class="linenum">4509</span></a>  
<a name="l4510"><span class="linenum">4510</span></a>      if (<a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('rolenamedisplay')" href="../_variables/rolenamedisplay.html">$rolenamedisplay</a> == <a class="constant" onClick="logConstant('ROLENAME_SHORT')" href="../_constants/ROLENAME_SHORT.html" onMouseOver="constPopup(event,'ROLENAME_SHORT')">ROLENAME_SHORT</a>) {
<a name="l4511"><span class="linenum">4511</span></a>          return <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('shortname')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/shortname.html">shortname</a>;
<a name="l4512"><span class="linenum">4512</span></a>      }
<a name="l4513"><span class="linenum">4513</span></a>  
<a name="l4514"><span class="linenum">4514</span></a>      if (!<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> or !<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_course_context')" href="../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>(false)) {
<a name="l4515"><span class="linenum">4515</span></a>          <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = null;
<a name="l4516"><span class="linenum">4516</span></a>      }
<a name="l4517"><span class="linenum">4517</span></a>  
<a name="l4518"><span class="linenum">4518</span></a>      if (<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> and !property_exists(<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>, 'coursealias') and (<a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('rolenamedisplay')" href="../_variables/rolenamedisplay.html">$rolenamedisplay</a> == <a class="constant" onClick="logConstant('ROLENAME_ALIAS')" href="../_constants/ROLENAME_ALIAS.html" onMouseOver="constPopup(event,'ROLENAME_ALIAS')">ROLENAME_ALIAS</a> or <a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('rolenamedisplay')" href="../_variables/rolenamedisplay.html">$rolenamedisplay</a> == <a class="constant" onClick="logConstant('ROLENAME_BOTH')" href="../_constants/ROLENAME_BOTH.html" onMouseOver="constPopup(event,'ROLENAME_BOTH')">ROLENAME_BOTH</a> or <a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('rolenamedisplay')" href="../_variables/rolenamedisplay.html">$rolenamedisplay</a> == <a class="constant" onClick="logConstant('ROLENAME_ALIAS_RAW')" href="../_constants/ROLENAME_ALIAS_RAW.html" onMouseOver="constPopup(event,'ROLENAME_ALIAS_RAW')">ROLENAME_ALIAS_RAW</a>)) {
<a name="l4519"><span class="linenum">4519</span></a>          <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a> = <a class="function" onClick="logFunction('clone')" href="../_functions/clone.html" onMouseOver="funcPopup(event,'clone')">clone</a>(<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>); <span class="comment">// Do not modify parameters.</span>
<a name="l4520"><span class="linenum">4520</span></a>          if (<a class="var it746" onMouseOver="hilite(746)" onMouseOut="lolite()" onClick="logVariable('r')" href="../_variables/r.html">$r</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('role_names', array('roleid'=&gt;<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('id')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'contextid'=&gt;<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('id')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/id.html">id</a>))) {
<a name="l4521"><span class="linenum">4521</span></a>              <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('coursealias')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/coursealias.html">coursealias</a> = <a class="var it746" onMouseOver="hilite(746)" onMouseOut="lolite()" onClick="logVariable('r')" href="../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('name')" class="var it39453" onMouseOver="hilite(39453)" onMouseOut="lolite()" href="../_variables/name.html">name</a>;
<a name="l4522"><span class="linenum">4522</span></a>          } else {
<a name="l4523"><span class="linenum">4523</span></a>              <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('coursealias')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/coursealias.html">coursealias</a> = null;
<a name="l4524"><span class="linenum">4524</span></a>          }
<a name="l4525"><span class="linenum">4525</span></a>      }
<a name="l4526"><span class="linenum">4526</span></a>  
<a name="l4527"><span class="linenum">4527</span></a>      if (<a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('rolenamedisplay')" href="../_variables/rolenamedisplay.html">$rolenamedisplay</a> == <a class="constant" onClick="logConstant('ROLENAME_ALIAS_RAW')" href="../_constants/ROLENAME_ALIAS_RAW.html" onMouseOver="constPopup(event,'ROLENAME_ALIAS_RAW')">ROLENAME_ALIAS_RAW</a>) {
<a name="l4528"><span class="linenum">4528</span></a>          if (<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>) {
<a name="l4529"><span class="linenum">4529</span></a>              return <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('coursealias')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/coursealias.html">coursealias</a>;
<a name="l4530"><span class="linenum">4530</span></a>          } else {
<a name="l4531"><span class="linenum">4531</span></a>              return null;
<a name="l4532"><span class="linenum">4532</span></a>          }
<a name="l4533"><span class="linenum">4533</span></a>      }
<a name="l4534"><span class="linenum">4534</span></a>  
<a name="l4535"><span class="linenum">4535</span></a>      if (<a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('name')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/name.html">name</a>) !== '') {
<a name="l4536"><span class="linenum">4536</span></a>  <span class="comment">        // For filtering always use context where was the thing defined - system for roles here.</span>
<a name="l4537"><span class="linenum">4537</span></a>          <a class="var it7425" onMouseOver="hilite(7425)" onMouseOut="lolite()" onClick="logVariable('original')" href="../_variables/original.html">$original</a> = <a class="function" onClick="logFunction('format_string')" href="../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('name')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/name.html">name</a>, true, array('context'=&gt;<a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>()));
<a name="l4538"><span class="linenum">4538</span></a>  
<a name="l4539"><span class="linenum">4539</span></a>      } else {
<a name="l4540"><span class="linenum">4540</span></a>  <span class="comment">        // Empty role-&gt;name means we want to see localised role name based on shortname,</span>
<a name="l4541"><span class="linenum">4541</span></a>  <span class="comment">        // only default roles are supposed to be localised.</span>
<a name="l4542"><span class="linenum">4542</span></a>          switch (<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('shortname')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/shortname.html">shortname</a>) {
<a name="l4543"><span class="linenum">4543</span></a>              case 'manager':         <a class="var it7425" onMouseOver="hilite(7425)" onMouseOut="lolite()" onClick="logVariable('original')" href="../_variables/original.html">$original</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('manager', 'role'); break;
<a name="l4544"><span class="linenum">4544</span></a>              case 'coursecreator':   <a class="var it7425" onMouseOver="hilite(7425)" onMouseOut="lolite()" onClick="logVariable('original')" href="../_variables/original.html">$original</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('coursecreators'); break;
<a name="l4545"><span class="linenum">4545</span></a>              case 'editingteacher':  <a class="var it7425" onMouseOver="hilite(7425)" onMouseOut="lolite()" onClick="logVariable('original')" href="../_variables/original.html">$original</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('defaultcourseteacher'); break;
<a name="l4546"><span class="linenum">4546</span></a>              case 'teacher':         <a class="var it7425" onMouseOver="hilite(7425)" onMouseOut="lolite()" onClick="logVariable('original')" href="../_variables/original.html">$original</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('noneditingteacher'); break;
<a name="l4547"><span class="linenum">4547</span></a>              case 'student':         <a class="var it7425" onMouseOver="hilite(7425)" onMouseOut="lolite()" onClick="logVariable('original')" href="../_variables/original.html">$original</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('defaultcoursestudent'); break;
<a name="l4548"><span class="linenum">4548</span></a>              case 'guest':           <a class="var it7425" onMouseOver="hilite(7425)" onMouseOut="lolite()" onClick="logVariable('original')" href="../_variables/original.html">$original</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('guest'); break;
<a name="l4549"><span class="linenum">4549</span></a>              case 'user':            <a class="var it7425" onMouseOver="hilite(7425)" onMouseOut="lolite()" onClick="logVariable('original')" href="../_variables/original.html">$original</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('authenticateduser'); break;
<a name="l4550"><span class="linenum">4550</span></a>              case 'frontpage':       <a class="var it7425" onMouseOver="hilite(7425)" onMouseOut="lolite()" onClick="logVariable('original')" href="../_variables/original.html">$original</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('frontpageuser', 'role'); break;
<a name="l4551"><span class="linenum">4551</span></a>  <span class="comment">            // We should not get here, the role UI should require the name for custom roles!</span>
<a name="l4552"><span class="linenum">4552</span></a>              default:                <a class="var it7425" onMouseOver="hilite(7425)" onMouseOut="lolite()" onClick="logVariable('original')" href="../_variables/original.html">$original</a> = <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('shortname')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/shortname.html">shortname</a>; break;
<a name="l4553"><span class="linenum">4553</span></a>          }
<a name="l4554"><span class="linenum">4554</span></a>      }
<a name="l4555"><span class="linenum">4555</span></a>  
<a name="l4556"><span class="linenum">4556</span></a>      if (<a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('rolenamedisplay')" href="../_variables/rolenamedisplay.html">$rolenamedisplay</a> == <a class="constant" onClick="logConstant('ROLENAME_ORIGINAL')" href="../_constants/ROLENAME_ORIGINAL.html" onMouseOver="constPopup(event,'ROLENAME_ORIGINAL')">ROLENAME_ORIGINAL</a>) {
<a name="l4557"><span class="linenum">4557</span></a>          return <a class="var it7425" onMouseOver="hilite(7425)" onMouseOut="lolite()" onClick="logVariable('original')" href="../_variables/original.html">$original</a>;
<a name="l4558"><span class="linenum">4558</span></a>      }
<a name="l4559"><span class="linenum">4559</span></a>  
<a name="l4560"><span class="linenum">4560</span></a>      if (<a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('rolenamedisplay')" href="../_variables/rolenamedisplay.html">$rolenamedisplay</a> == <a class="constant" onClick="logConstant('ROLENAME_ORIGINALANDSHORT')" href="../_constants/ROLENAME_ORIGINALANDSHORT.html" onMouseOver="constPopup(event,'ROLENAME_ORIGINALANDSHORT')">ROLENAME_ORIGINALANDSHORT</a>) {
<a name="l4561"><span class="linenum">4561</span></a>          return &quot;<a class="var it7425" onMouseOver="hilite(7425)" onMouseOut="lolite()" onClick="logVariable('original')" href="../_variables/original.html">$original</a> (<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('shortname')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/shortname.html">shortname</a>)&quot;;
<a name="l4562"><span class="linenum">4562</span></a>      }
<a name="l4563"><span class="linenum">4563</span></a>  
<a name="l4564"><span class="linenum">4564</span></a>      if (<a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('rolenamedisplay')" href="../_variables/rolenamedisplay.html">$rolenamedisplay</a> == <a class="constant" onClick="logConstant('ROLENAME_ALIAS')" href="../_constants/ROLENAME_ALIAS.html" onMouseOver="constPopup(event,'ROLENAME_ALIAS')">ROLENAME_ALIAS</a>) {
<a name="l4565"><span class="linenum">4565</span></a>          if (<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> and <a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('coursealias')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/coursealias.html">coursealias</a>) !== '') {
<a name="l4566"><span class="linenum">4566</span></a>              return <a class="function" onClick="logFunction('format_string')" href="../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('coursealias')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/coursealias.html">coursealias</a>, true, array('context'=&gt;<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>));
<a name="l4567"><span class="linenum">4567</span></a>          } else {
<a name="l4568"><span class="linenum">4568</span></a>              return <a class="var it7425" onMouseOver="hilite(7425)" onMouseOut="lolite()" onClick="logVariable('original')" href="../_variables/original.html">$original</a>;
<a name="l4569"><span class="linenum">4569</span></a>          }
<a name="l4570"><span class="linenum">4570</span></a>      }
<a name="l4571"><span class="linenum">4571</span></a>  
<a name="l4572"><span class="linenum">4572</span></a>      if (<a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('rolenamedisplay')" href="../_variables/rolenamedisplay.html">$rolenamedisplay</a> == <a class="constant" onClick="logConstant('ROLENAME_BOTH')" href="../_constants/ROLENAME_BOTH.html" onMouseOver="constPopup(event,'ROLENAME_BOTH')">ROLENAME_BOTH</a>) {
<a name="l4573"><span class="linenum">4573</span></a>          if (<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> and <a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('coursealias')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/coursealias.html">coursealias</a>) !== '') {
<a name="l4574"><span class="linenum">4574</span></a>              return <a class="function" onClick="logFunction('format_string')" href="../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('coursealias')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/coursealias.html">coursealias</a>, true, array('context'=&gt;<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>)) . &quot; (<a class="var it7425" onMouseOver="hilite(7425)" onMouseOut="lolite()" onClick="logVariable('original')" href="../_variables/original.html">$original</a>)&quot;;
<a name="l4575"><span class="linenum">4575</span></a>          } else {
<a name="l4576"><span class="linenum">4576</span></a>              return <a class="var it7425" onMouseOver="hilite(7425)" onMouseOut="lolite()" onClick="logVariable('original')" href="../_variables/original.html">$original</a>;
<a name="l4577"><span class="linenum">4577</span></a>          }
<a name="l4578"><span class="linenum">4578</span></a>      }
<a name="l4579"><span class="linenum">4579</span></a>  
<a name="l4580"><span class="linenum">4580</span></a>      throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid <a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('rolenamedisplay')" href="../_variables/rolenamedisplay.html">$rolenamedisplay</a> parameter specified in <a class="function" onClick="logFunction('role_get_name')" href="../_functions/role_get_name.html" onMouseOver="funcPopup(event,'role_get_name')">role_get_name</a>()');
<a name="l4581"><span class="linenum">4581</span></a>  }
<a name="l4582"><span class="linenum">4582</span></a>  
<a name="l4583"><span class="linenum">4583</span></a>  <span class="comment">/**</span>
<a name="l4584"><span class="linenum">4584</span></a>  <span class="comment"> * Returns localised role description if available.</span>
<a name="l4585"><span class="linenum">4585</span></a>  <span class="comment"> * If the name is empty it tries to find the default role name using</span>
<a name="l4586"><span class="linenum">4586</span></a>  <span class="comment"> * hardcoded list of default role names or other methods in the future.</span>
<a name="l4587"><span class="linenum">4587</span></a>  <span class="comment"> *</span>
<a name="l4588"><span class="linenum">4588</span></a>  <span class="comment"> * @param stdClass $role</span>
<a name="l4589"><span class="linenum">4589</span></a>  <span class="comment"> * @return string localised role name</span>
<a name="l4590"><span class="linenum">4590</span></a>  <span class="comment"> */</span>
<a name="l4591"><span class="linenum">4591</span></a>  function <a class="function" onClick="logFunction('role_get_description')" href="../_functions/role_get_description.html" onMouseOver="funcPopup(event,'role_get_description')">role_get_description</a>(stdClass <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>) {
<a name="l4592"><span class="linenum">4592</span></a>      if (!<a class="function" onClick="logFunction('html_is_blank')" href="../_functions/html_is_blank.html" onMouseOver="funcPopup(event,'html_is_blank')">html_is_blank</a>(<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('description')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/description.html">description</a>)) {
<a name="l4593"><span class="linenum">4593</span></a>          return <a class="function" onClick="logFunction('format_text')" href="../_functions/format_text.html" onMouseOver="funcPopup(event,'format_text')">format_text</a>(<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('description')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/description.html">description</a>, <a class="constant" onClick="logConstant('FORMAT_HTML')" href="../_constants/FORMAT_HTML.html" onMouseOver="constPopup(event,'FORMAT_HTML')">FORMAT_HTML</a>, array('context'=&gt;<a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>()));
<a name="l4594"><span class="linenum">4594</span></a>      }
<a name="l4595"><span class="linenum">4595</span></a>  
<a name="l4596"><span class="linenum">4596</span></a>      switch (<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('shortname')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/shortname.html">shortname</a>) {
<a name="l4597"><span class="linenum">4597</span></a>          case 'manager':         return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('managerdescription', 'role');
<a name="l4598"><span class="linenum">4598</span></a>          case 'coursecreator':   return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('coursecreatorsdescription');
<a name="l4599"><span class="linenum">4599</span></a>          case 'editingteacher':  return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('defaultcourseteacherdescription');
<a name="l4600"><span class="linenum">4600</span></a>          case 'teacher':         return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('noneditingteacherdescription');
<a name="l4601"><span class="linenum">4601</span></a>          case 'student':         return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('defaultcoursestudentdescription');
<a name="l4602"><span class="linenum">4602</span></a>          case 'guest':           return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('guestdescription');
<a name="l4603"><span class="linenum">4603</span></a>          case 'user':            return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('authenticateduserdescription');
<a name="l4604"><span class="linenum">4604</span></a>          case 'frontpage':       return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('frontpageuserdescription', 'role');
<a name="l4605"><span class="linenum">4605</span></a>          default:                return '';
<a name="l4606"><span class="linenum">4606</span></a>      }
<a name="l4607"><span class="linenum">4607</span></a>  }
<a name="l4608"><span class="linenum">4608</span></a>  
<a name="l4609"><span class="linenum">4609</span></a>  <span class="comment">/**</span>
<a name="l4610"><span class="linenum">4610</span></a>  <span class="comment"> * Get all the localised role names for a context.</span>
<a name="l4611"><span class="linenum">4611</span></a>  <span class="comment"> *</span>
<a name="l4612"><span class="linenum">4612</span></a>  <span class="comment"> * In new installs default roles have empty names, this function</span>
<a name="l4613"><span class="linenum">4613</span></a>  <span class="comment"> * add localised role names using current language pack.</span>
<a name="l4614"><span class="linenum">4614</span></a>  <span class="comment"> *</span>
<a name="l4615"><span class="linenum">4615</span></a>  <span class="comment"> * @param context $context the context, null means system context</span>
<a name="l4616"><span class="linenum">4616</span></a>  <span class="comment"> * @param array of role objects with a -&gt;localname field containing the context-specific role name.</span>
<a name="l4617"><span class="linenum">4617</span></a>  <span class="comment"> * @param int $rolenamedisplay</span>
<a name="l4618"><span class="linenum">4618</span></a>  <span class="comment"> * @param bool $returnmenu true means id=&gt;localname, false means id=&gt;rolerecord</span>
<a name="l4619"><span class="linenum">4619</span></a>  <span class="comment"> * @return array Array of context-specific role names, or role objects with a -&gt;localname field added.</span>
<a name="l4620"><span class="linenum">4620</span></a>  <span class="comment"> */</span>
<a name="l4621"><span class="linenum">4621</span></a>  function <a class="function" onClick="logFunction('role_get_names')" href="../_functions/role_get_names.html" onMouseOver="funcPopup(event,'role_get_names')">role_get_names</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = null, <a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('rolenamedisplay')" href="../_variables/rolenamedisplay.html">$rolenamedisplay</a> = <a class="constant" onClick="logConstant('ROLENAME_ALIAS')" href="../_constants/ROLENAME_ALIAS.html" onMouseOver="constPopup(event,'ROLENAME_ALIAS')">ROLENAME_ALIAS</a>, <a class="var it28882" onMouseOver="hilite(28882)" onMouseOut="lolite()" onClick="logVariable('returnmenu')" href="../_variables/returnmenu.html">$returnmenu</a> = null) {
<a name="l4622"><span class="linenum">4622</span></a>      return <a class="function" onClick="logFunction('role_fix_names')" href="../_functions/role_fix_names.html" onMouseOver="funcPopup(event,'role_fix_names')">role_fix_names</a>(<a class="function" onClick="logFunction('get_all_roles')" href="../_functions/get_all_roles.html" onMouseOver="funcPopup(event,'get_all_roles')">get_all_roles</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>), <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('rolenamedisplay')" href="../_variables/rolenamedisplay.html">$rolenamedisplay</a>, <a class="var it28882" onMouseOver="hilite(28882)" onMouseOut="lolite()" onClick="logVariable('returnmenu')" href="../_variables/returnmenu.html">$returnmenu</a>);
<a name="l4623"><span class="linenum">4623</span></a>  }
<a name="l4624"><span class="linenum">4624</span></a>  
<a name="l4625"><span class="linenum">4625</span></a>  <span class="comment">/**</span>
<a name="l4626"><span class="linenum">4626</span></a>  <span class="comment"> * Prepare list of roles for display, apply aliases and localise default role names.</span>
<a name="l4627"><span class="linenum">4627</span></a>  <span class="comment"> *</span>
<a name="l4628"><span class="linenum">4628</span></a>  <span class="comment"> * @param array $roleoptions array roleid =&gt; roleobject (with optional coursealias), strings are accepted for backwards compatibility only</span>
<a name="l4629"><span class="linenum">4629</span></a>  <span class="comment"> * @param context $context the context, null means system context</span>
<a name="l4630"><span class="linenum">4630</span></a>  <span class="comment"> * @param int $rolenamedisplay</span>
<a name="l4631"><span class="linenum">4631</span></a>  <span class="comment"> * @param bool $returnmenu null means keep the same format as $roleoptions, true means id=&gt;localname, false means id=&gt;rolerecord</span>
<a name="l4632"><span class="linenum">4632</span></a>  <span class="comment"> * @return array Array of context-specific role names, or role objects with a -&gt;localname field added.</span>
<a name="l4633"><span class="linenum">4633</span></a>  <span class="comment"> */</span>
<a name="l4634"><span class="linenum">4634</span></a>  function <a class="function" onClick="logFunction('role_fix_names')" href="../_functions/role_fix_names.html" onMouseOver="funcPopup(event,'role_fix_names')">role_fix_names</a>(<a class="var it12699" onMouseOver="hilite(12699)" onMouseOut="lolite()" onClick="logVariable('roleoptions')" href="../_variables/roleoptions.html">$roleoptions</a>, context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = null, <a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('rolenamedisplay')" href="../_variables/rolenamedisplay.html">$rolenamedisplay</a> = <a class="constant" onClick="logConstant('ROLENAME_ALIAS')" href="../_constants/ROLENAME_ALIAS.html" onMouseOver="constPopup(event,'ROLENAME_ALIAS')">ROLENAME_ALIAS</a>, <a class="var it28882" onMouseOver="hilite(28882)" onMouseOut="lolite()" onClick="logVariable('returnmenu')" href="../_variables/returnmenu.html">$returnmenu</a> = null) {
<a name="l4635"><span class="linenum">4635</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l4636"><span class="linenum">4636</span></a>  
<a name="l4637"><span class="linenum">4637</span></a>      if (empty(<a class="var it12699" onMouseOver="hilite(12699)" onMouseOut="lolite()" onClick="logVariable('roleoptions')" href="../_variables/roleoptions.html">$roleoptions</a>)) {
<a name="l4638"><span class="linenum">4638</span></a>          return array();
<a name="l4639"><span class="linenum">4639</span></a>      }
<a name="l4640"><span class="linenum">4640</span></a>  
<a name="l4641"><span class="linenum">4641</span></a>      if (!<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> or !<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_course_context')" href="../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>(false)) {
<a name="l4642"><span class="linenum">4642</span></a>          <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = null;
<a name="l4643"><span class="linenum">4643</span></a>      }
<a name="l4644"><span class="linenum">4644</span></a>  
<a name="l4645"><span class="linenum">4645</span></a>  <span class="comment">    // We usually need all role columns...</span>
<a name="l4646"><span class="linenum">4646</span></a>      <a class="var it389" onMouseOver="hilite(389)" onMouseOut="lolite()" onClick="logVariable('first')" href="../_variables/first.html">$first</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it12699" onMouseOver="hilite(12699)" onMouseOut="lolite()" onClick="logVariable('roleoptions')" href="../_variables/roleoptions.html">$roleoptions</a>);
<a name="l4647"><span class="linenum">4647</span></a>      if (<a class="var it28882" onMouseOver="hilite(28882)" onMouseOut="lolite()" onClick="logVariable('returnmenu')" href="../_variables/returnmenu.html">$returnmenu</a> === null) {
<a name="l4648"><span class="linenum">4648</span></a>          <a class="var it28882" onMouseOver="hilite(28882)" onMouseOut="lolite()" onClick="logVariable('returnmenu')" href="../_variables/returnmenu.html">$returnmenu</a> = !<a class="phpfunction" onClick="logFunction('is_object')" href="../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it389" onMouseOver="hilite(389)" onMouseOut="lolite()" onClick="logVariable('first')" href="../_variables/first.html">$first</a>);
<a name="l4649"><span class="linenum">4649</span></a>      }
<a name="l4650"><span class="linenum">4650</span></a>  
<a name="l4651"><span class="linenum">4651</span></a>      if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it389" onMouseOver="hilite(389)" onMouseOut="lolite()" onClick="logVariable('first')" href="../_variables/first.html">$first</a>) or !property_exists(<a class="var it389" onMouseOver="hilite(389)" onMouseOut="lolite()" onClick="logVariable('first')" href="../_variables/first.html">$first</a>, 'shortname')) {
<a name="l4652"><span class="linenum">4652</span></a>          <a class="var it3145" onMouseOver="hilite(3145)" onMouseOut="lolite()" onClick="logVariable('allroles')" href="../_variables/allroles.html">$allroles</a> = <a class="function" onClick="logFunction('get_all_roles')" href="../_functions/get_all_roles.html" onMouseOver="funcPopup(event,'get_all_roles')">get_all_roles</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l4653"><span class="linenum">4653</span></a>          foreach (<a class="var it12699" onMouseOver="hilite(12699)" onMouseOut="lolite()" onClick="logVariable('roleoptions')" href="../_variables/roleoptions.html">$roleoptions</a> as <a class="var it3150" onMouseOver="hilite(3150)" onMouseOut="lolite()" onClick="logVariable('rid')" href="../_variables/rid.html">$rid</a> =&gt; <a class="var it1136" onMouseOver="hilite(1136)" onMouseOut="lolite()" onClick="logVariable('unused')" href="../_variables/unused.html">$unused</a>) {
<a name="l4654"><span class="linenum">4654</span></a>              <a class="var it12699" onMouseOver="hilite(12699)" onMouseOut="lolite()" onClick="logVariable('roleoptions')" href="../_variables/roleoptions.html">$roleoptions</a>[<a class="var it3150" onMouseOver="hilite(3150)" onMouseOut="lolite()" onClick="logVariable('rid')" href="../_variables/rid.html">$rid</a>] = <a class="var it3145" onMouseOver="hilite(3145)" onMouseOut="lolite()" onClick="logVariable('allroles')" href="../_variables/allroles.html">$allroles</a>[<a class="var it3150" onMouseOver="hilite(3150)" onMouseOut="lolite()" onClick="logVariable('rid')" href="../_variables/rid.html">$rid</a>];
<a name="l4655"><span class="linenum">4655</span></a>          }
<a name="l4656"><span class="linenum">4656</span></a>      }
<a name="l4657"><span class="linenum">4657</span></a>  
<a name="l4658"><span class="linenum">4658</span></a>  <span class="comment">    // Inject coursealias if necessary.</span>
<a name="l4659"><span class="linenum">4659</span></a>      if (<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> and (<a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('rolenamedisplay')" href="../_variables/rolenamedisplay.html">$rolenamedisplay</a> == <a class="constant" onClick="logConstant('ROLENAME_ALIAS_RAW')" href="../_constants/ROLENAME_ALIAS_RAW.html" onMouseOver="constPopup(event,'ROLENAME_ALIAS_RAW')">ROLENAME_ALIAS_RAW</a> or <a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('rolenamedisplay')" href="../_variables/rolenamedisplay.html">$rolenamedisplay</a> == <a class="constant" onClick="logConstant('ROLENAME_ALIAS')" href="../_constants/ROLENAME_ALIAS.html" onMouseOver="constPopup(event,'ROLENAME_ALIAS')">ROLENAME_ALIAS</a> or <a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('rolenamedisplay')" href="../_variables/rolenamedisplay.html">$rolenamedisplay</a> == <a class="constant" onClick="logConstant('ROLENAME_BOTH')" href="../_constants/ROLENAME_BOTH.html" onMouseOver="constPopup(event,'ROLENAME_BOTH')">ROLENAME_BOTH</a>)) {
<a name="l4660"><span class="linenum">4660</span></a>          <a class="var it389" onMouseOver="hilite(389)" onMouseOut="lolite()" onClick="logVariable('first')" href="../_variables/first.html">$first</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it12699" onMouseOver="hilite(12699)" onMouseOut="lolite()" onClick="logVariable('roleoptions')" href="../_variables/roleoptions.html">$roleoptions</a>);
<a name="l4661"><span class="linenum">4661</span></a>          if (!property_exists(<a class="var it389" onMouseOver="hilite(389)" onMouseOut="lolite()" onClick="logVariable('first')" href="../_variables/first.html">$first</a>, 'coursealias')) {
<a name="l4662"><span class="linenum">4662</span></a>              <a class="var it28883" onMouseOver="hilite(28883)" onMouseOut="lolite()" onClick="logVariable('aliasnames')" href="../_variables/aliasnames.html">$aliasnames</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('role_names', array('contextid'=&gt;<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('id')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l4663"><span class="linenum">4663</span></a>              foreach (<a class="var it28883" onMouseOver="hilite(28883)" onMouseOut="lolite()" onClick="logVariable('aliasnames')" href="../_variables/aliasnames.html">$aliasnames</a> as <a class="var it9120" onMouseOver="hilite(9120)" onMouseOut="lolite()" onClick="logVariable('alias')" href="../_variables/alias.html">$alias</a>) {
<a name="l4664"><span class="linenum">4664</span></a>                  if (isset(<a class="var it12699" onMouseOver="hilite(12699)" onMouseOut="lolite()" onClick="logVariable('roleoptions')" href="../_variables/roleoptions.html">$roleoptions</a>[<a class="var it9120" onMouseOver="hilite(9120)" onMouseOut="lolite()" onClick="logVariable('alias')" href="../_variables/alias.html">$alias</a>-&gt;<a onClick="logVariable('roleid')" class="var it39906" onMouseOver="hilite(39906)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>])) {
<a name="l4665"><span class="linenum">4665</span></a>                      <a class="var it12699" onMouseOver="hilite(12699)" onMouseOut="lolite()" onClick="logVariable('roleoptions')" href="../_variables/roleoptions.html">$roleoptions</a>[<a class="var it9120" onMouseOver="hilite(9120)" onMouseOut="lolite()" onClick="logVariable('alias')" href="../_variables/alias.html">$alias</a>-&gt;<a onClick="logVariable('roleid')" class="var it39906" onMouseOver="hilite(39906)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>]-&gt;coursealias = <a class="var it9120" onMouseOver="hilite(9120)" onMouseOut="lolite()" onClick="logVariable('alias')" href="../_variables/alias.html">$alias</a>-&gt;<a onClick="logVariable('name')" class="var it39906" onMouseOver="hilite(39906)" onMouseOut="lolite()" href="../_variables/name.html">name</a>;
<a name="l4666"><span class="linenum">4666</span></a>                  }
<a name="l4667"><span class="linenum">4667</span></a>              }
<a name="l4668"><span class="linenum">4668</span></a>          }
<a name="l4669"><span class="linenum">4669</span></a>      }
<a name="l4670"><span class="linenum">4670</span></a>  
<a name="l4671"><span class="linenum">4671</span></a>  <span class="comment">    // Add localname property.</span>
<a name="l4672"><span class="linenum">4672</span></a>      foreach (<a class="var it12699" onMouseOver="hilite(12699)" onMouseOut="lolite()" onClick="logVariable('roleoptions')" href="../_variables/roleoptions.html">$roleoptions</a> as <a class="var it3150" onMouseOver="hilite(3150)" onMouseOut="lolite()" onClick="logVariable('rid')" href="../_variables/rid.html">$rid</a> =&gt; <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>) {
<a name="l4673"><span class="linenum">4673</span></a>          <a class="var it12699" onMouseOver="hilite(12699)" onMouseOut="lolite()" onClick="logVariable('roleoptions')" href="../_variables/roleoptions.html">$roleoptions</a>[<a class="var it3150" onMouseOver="hilite(3150)" onMouseOut="lolite()" onClick="logVariable('rid')" href="../_variables/rid.html">$rid</a>]-&gt;localname = <a class="function" onClick="logFunction('role_get_name')" href="../_functions/role_get_name.html" onMouseOver="funcPopup(event,'role_get_name')">role_get_name</a>(<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>, <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>, <a class="var it28851" onMouseOver="hilite(28851)" onMouseOut="lolite()" onClick="logVariable('rolenamedisplay')" href="../_variables/rolenamedisplay.html">$rolenamedisplay</a>);
<a name="l4674"><span class="linenum">4674</span></a>      }
<a name="l4675"><span class="linenum">4675</span></a>  
<a name="l4676"><span class="linenum">4676</span></a>      if (!<a class="var it28882" onMouseOver="hilite(28882)" onMouseOut="lolite()" onClick="logVariable('returnmenu')" href="../_variables/returnmenu.html">$returnmenu</a>) {
<a name="l4677"><span class="linenum">4677</span></a>          return <a class="var it12699" onMouseOver="hilite(12699)" onMouseOut="lolite()" onClick="logVariable('roleoptions')" href="../_variables/roleoptions.html">$roleoptions</a>;
<a name="l4678"><span class="linenum">4678</span></a>      }
<a name="l4679"><span class="linenum">4679</span></a>  
<a name="l4680"><span class="linenum">4680</span></a>      <a class="var it4415" onMouseOver="hilite(4415)" onMouseOut="lolite()" onClick="logVariable('menu')" href="../_variables/menu.html">$menu</a> = array();
<a name="l4681"><span class="linenum">4681</span></a>      foreach (<a class="var it12699" onMouseOver="hilite(12699)" onMouseOut="lolite()" onClick="logVariable('roleoptions')" href="../_variables/roleoptions.html">$roleoptions</a> as <a class="var it3150" onMouseOver="hilite(3150)" onMouseOut="lolite()" onClick="logVariable('rid')" href="../_variables/rid.html">$rid</a> =&gt; <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>) {
<a name="l4682"><span class="linenum">4682</span></a>          <a class="var it4415" onMouseOver="hilite(4415)" onMouseOut="lolite()" onClick="logVariable('menu')" href="../_variables/menu.html">$menu</a>[<a class="var it3150" onMouseOver="hilite(3150)" onMouseOut="lolite()" onClick="logVariable('rid')" href="../_variables/rid.html">$rid</a>] = <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('localname')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/localname.html">localname</a>;
<a name="l4683"><span class="linenum">4683</span></a>      }
<a name="l4684"><span class="linenum">4684</span></a>  
<a name="l4685"><span class="linenum">4685</span></a>      return <a class="var it4415" onMouseOver="hilite(4415)" onMouseOut="lolite()" onClick="logVariable('menu')" href="../_variables/menu.html">$menu</a>;
<a name="l4686"><span class="linenum">4686</span></a>  }
<a name="l4687"><span class="linenum">4687</span></a>  
<a name="l4688"><span class="linenum">4688</span></a>  <span class="comment">/**</span>
<a name="l4689"><span class="linenum">4689</span></a>  <span class="comment"> * Aids in detecting if a new line is required when reading a new capability</span>
<a name="l4690"><span class="linenum">4690</span></a>  <span class="comment"> *</span>
<a name="l4691"><span class="linenum">4691</span></a>  <span class="comment"> * This function helps admin/roles/manage.php etc to detect if a new line should be printed</span>
<a name="l4692"><span class="linenum">4692</span></a>  <span class="comment"> * when we read in a new capability.</span>
<a name="l4693"><span class="linenum">4693</span></a>  <span class="comment"> * Most of the time, if the 2 components are different we should print a new line, (e.g. course system-&gt;rss client)</span>
<a name="l4694"><span class="linenum">4694</span></a>  <span class="comment"> * but when we are in grade, all reports/import/export capabilities should be together</span>
<a name="l4695"><span class="linenum">4695</span></a>  <span class="comment"> *</span>
<a name="l4696"><span class="linenum">4696</span></a>  <span class="comment"> * @param string $cap component string a</span>
<a name="l4697"><span class="linenum">4697</span></a>  <span class="comment"> * @param string $comp component string b</span>
<a name="l4698"><span class="linenum">4698</span></a>  <span class="comment"> * @param int $contextlevel</span>
<a name="l4699"><span class="linenum">4699</span></a>  <span class="comment"> * @return bool whether 2 component are in different &quot;sections&quot;</span>
<a name="l4700"><span class="linenum">4700</span></a>  <span class="comment"> */</span>
<a name="l4701"><span class="linenum">4701</span></a>  function <a class="function" onClick="logFunction('component_level_changed')" href="../_functions/component_level_changed.html" onMouseOver="funcPopup(event,'component_level_changed')">component_level_changed</a>(<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>, <a class="var it14855" onMouseOver="hilite(14855)" onMouseOut="lolite()" onClick="logVariable('comp')" href="../_variables/comp.html">$comp</a>, <a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../_variables/contextlevel.html">$contextlevel</a>) {
<a name="l4702"><span class="linenum">4702</span></a>  
<a name="l4703"><span class="linenum">4703</span></a>      if (<a class="phpfunction" onClick="logFunction('strstr')" href="../_functions/strstr.html" onMouseOver="phpfuncPopup(event,'strstr')">strstr</a>(<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>-&gt;<a onClick="logVariable('component')" class="var it40429" onMouseOver="hilite(40429)" onMouseOut="lolite()" href="../_variables/component.html">component</a>, '/') &amp;&amp; <a class="phpfunction" onClick="logFunction('strstr')" href="../_functions/strstr.html" onMouseOver="phpfuncPopup(event,'strstr')">strstr</a>(<a class="var it14855" onMouseOver="hilite(14855)" onMouseOut="lolite()" onClick="logVariable('comp')" href="../_variables/comp.html">$comp</a>, '/')) {
<a name="l4704"><span class="linenum">4704</span></a>          <a class="var it28884" onMouseOver="hilite(28884)" onMouseOut="lolite()" onClick="logVariable('compsa')" href="../_variables/compsa.html">$compsa</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>('/', <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>-&gt;<a onClick="logVariable('component')" class="var it40429" onMouseOver="hilite(40429)" onMouseOut="lolite()" href="../_variables/component.html">component</a>);
<a name="l4705"><span class="linenum">4705</span></a>          <a class="var it28885" onMouseOver="hilite(28885)" onMouseOut="lolite()" onClick="logVariable('compsb')" href="../_variables/compsb.html">$compsb</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>('/', <a class="var it14855" onMouseOver="hilite(14855)" onMouseOut="lolite()" onClick="logVariable('comp')" href="../_variables/comp.html">$comp</a>);
<a name="l4706"><span class="linenum">4706</span></a>  
<a name="l4707"><span class="linenum">4707</span></a>  <span class="comment">        // list of system reports</span>
<a name="l4708"><span class="linenum">4708</span></a>          if ((<a class="var it28884" onMouseOver="hilite(28884)" onMouseOut="lolite()" onClick="logVariable('compsa')" href="../_variables/compsa.html">$compsa</a>[0] == 'report') &amp;&amp; (<a class="var it28885" onMouseOver="hilite(28885)" onMouseOut="lolite()" onClick="logVariable('compsb')" href="../_variables/compsb.html">$compsb</a>[0] == 'report')) {
<a name="l4709"><span class="linenum">4709</span></a>              return false;
<a name="l4710"><span class="linenum">4710</span></a>          }
<a name="l4711"><span class="linenum">4711</span></a>  
<a name="l4712"><span class="linenum">4712</span></a>  <span class="comment">        // we are in gradebook, still</span>
<a name="l4713"><span class="linenum">4713</span></a>          if ((<a class="var it28884" onMouseOver="hilite(28884)" onMouseOut="lolite()" onClick="logVariable('compsa')" href="../_variables/compsa.html">$compsa</a>[0] == 'gradeexport' || <a class="var it28884" onMouseOver="hilite(28884)" onMouseOut="lolite()" onClick="logVariable('compsa')" href="../_variables/compsa.html">$compsa</a>[0] == 'gradeimport' || <a class="var it28884" onMouseOver="hilite(28884)" onMouseOut="lolite()" onClick="logVariable('compsa')" href="../_variables/compsa.html">$compsa</a>[0] == 'gradereport') &amp;&amp;
<a name="l4714"><span class="linenum">4714</span></a>              (<a class="var it28885" onMouseOver="hilite(28885)" onMouseOut="lolite()" onClick="logVariable('compsb')" href="../_variables/compsb.html">$compsb</a>[0] == 'gradeexport' || <a class="var it28885" onMouseOver="hilite(28885)" onMouseOut="lolite()" onClick="logVariable('compsb')" href="../_variables/compsb.html">$compsb</a>[0] == 'gradeimport' || <a class="var it28885" onMouseOver="hilite(28885)" onMouseOut="lolite()" onClick="logVariable('compsb')" href="../_variables/compsb.html">$compsb</a>[0] == 'gradereport')) {
<a name="l4715"><span class="linenum">4715</span></a>              return false;
<a name="l4716"><span class="linenum">4716</span></a>          }
<a name="l4717"><span class="linenum">4717</span></a>  
<a name="l4718"><span class="linenum">4718</span></a>          if ((<a class="var it28884" onMouseOver="hilite(28884)" onMouseOut="lolite()" onClick="logVariable('compsa')" href="../_variables/compsa.html">$compsa</a>[0] == 'coursereport') &amp;&amp; (<a class="var it28885" onMouseOver="hilite(28885)" onMouseOut="lolite()" onClick="logVariable('compsb')" href="../_variables/compsb.html">$compsb</a>[0] == 'coursereport')) {
<a name="l4719"><span class="linenum">4719</span></a>              return false;
<a name="l4720"><span class="linenum">4720</span></a>          }
<a name="l4721"><span class="linenum">4721</span></a>      }
<a name="l4722"><span class="linenum">4722</span></a>  
<a name="l4723"><span class="linenum">4723</span></a>      return (<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>-&gt;<a onClick="logVariable('component')" class="var it40429" onMouseOver="hilite(40429)" onMouseOut="lolite()" href="../_variables/component.html">component</a> != <a class="var it14855" onMouseOver="hilite(14855)" onMouseOut="lolite()" onClick="logVariable('comp')" href="../_variables/comp.html">$comp</a> || <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it40429" onMouseOver="hilite(40429)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> != <a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../_variables/contextlevel.html">$contextlevel</a>);
<a name="l4724"><span class="linenum">4724</span></a>  }
<a name="l4725"><span class="linenum">4725</span></a>  
<a name="l4726"><span class="linenum">4726</span></a>  <span class="comment">/**</span>
<a name="l4727"><span class="linenum">4727</span></a>  <span class="comment"> * Fix the roles.sortorder field in the database, so it contains sequential integers,</span>
<a name="l4728"><span class="linenum">4728</span></a>  <span class="comment"> * and return an array of roleids in order.</span>
<a name="l4729"><span class="linenum">4729</span></a>  <span class="comment"> *</span>
<a name="l4730"><span class="linenum">4730</span></a>  <span class="comment"> * @param array $allroles array of roles, as returned by get_all_roles();</span>
<a name="l4731"><span class="linenum">4731</span></a>  <span class="comment"> * @return array $role-&gt;sortorder =-&gt; $role-&gt;id with the keys in ascending order.</span>
<a name="l4732"><span class="linenum">4732</span></a>  <span class="comment"> */</span>
<a name="l4733"><span class="linenum">4733</span></a>  function <a class="function" onClick="logFunction('fix_role_sortorder')" href="../_functions/fix_role_sortorder.html" onMouseOver="funcPopup(event,'fix_role_sortorder')">fix_role_sortorder</a>(<a class="var it3145" onMouseOver="hilite(3145)" onMouseOut="lolite()" onClick="logVariable('allroles')" href="../_variables/allroles.html">$allroles</a>) {
<a name="l4734"><span class="linenum">4734</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l4735"><span class="linenum">4735</span></a>  
<a name="l4736"><span class="linenum">4736</span></a>      <a class="var it28886" onMouseOver="hilite(28886)" onMouseOut="lolite()" onClick="logVariable('rolesort')" href="../_variables/rolesort.html">$rolesort</a> = array();
<a name="l4737"><span class="linenum">4737</span></a>      <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a> = 0;
<a name="l4738"><span class="linenum">4738</span></a>      foreach (<a class="var it3145" onMouseOver="hilite(3145)" onMouseOut="lolite()" onClick="logVariable('allroles')" href="../_variables/allroles.html">$allroles</a> as <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>) {
<a name="l4739"><span class="linenum">4739</span></a>          <a class="var it28886" onMouseOver="hilite(28886)" onMouseOut="lolite()" onClick="logVariable('rolesort')" href="../_variables/rolesort.html">$rolesort</a>[<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a>] = <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('id')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l4740"><span class="linenum">4740</span></a>          if (<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('sortorder')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/sortorder.html">sortorder</a> != <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a>) {
<a name="l4741"><span class="linenum">4741</span></a>              <a class="var it746" onMouseOver="hilite(746)" onMouseOut="lolite()" onClick="logVariable('r')" href="../_variables/r.html">$r</a> = new stdClass();
<a name="l4742"><span class="linenum">4742</span></a>              <a class="var it746" onMouseOver="hilite(746)" onMouseOut="lolite()" onClick="logVariable('r')" href="../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('id')" class="var it39453" onMouseOver="hilite(39453)" onMouseOut="lolite()" href="../_variables/id.html">id</a> = <a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('id')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l4743"><span class="linenum">4743</span></a>              <a class="var it746" onMouseOver="hilite(746)" onMouseOut="lolite()" onClick="logVariable('r')" href="../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('sortorder')" class="var it39453" onMouseOver="hilite(39453)" onMouseOut="lolite()" href="../_variables/sortorder.html">sortorder</a> = <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a>;
<a name="l4744"><span class="linenum">4744</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('role', <a class="var it746" onMouseOver="hilite(746)" onMouseOut="lolite()" onClick="logVariable('r')" href="../_variables/r.html">$r</a>);
<a name="l4745"><span class="linenum">4745</span></a>              <a class="var it3145" onMouseOver="hilite(3145)" onMouseOut="lolite()" onClick="logVariable('allroles')" href="../_variables/allroles.html">$allroles</a>[<a class="var it426" onMouseOver="hilite(426)" onMouseOut="lolite()" onClick="logVariable('role')" href="../_variables/role.html">$role</a>-&gt;<a onClick="logVariable('id')" class="var it39449" onMouseOver="hilite(39449)" onMouseOut="lolite()" href="../_variables/id.html">id</a>]-&gt;sortorder = <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a>;
<a name="l4746"><span class="linenum">4746</span></a>          }
<a name="l4747"><span class="linenum">4747</span></a>          <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a>++;
<a name="l4748"><span class="linenum">4748</span></a>      }
<a name="l4749"><span class="linenum">4749</span></a>      return <a class="var it28886" onMouseOver="hilite(28886)" onMouseOut="lolite()" onClick="logVariable('rolesort')" href="../_variables/rolesort.html">$rolesort</a>;
<a name="l4750"><span class="linenum">4750</span></a>  }
<a name="l4751"><span class="linenum">4751</span></a>  
<a name="l4752"><span class="linenum">4752</span></a>  <span class="comment">/**</span>
<a name="l4753"><span class="linenum">4753</span></a>  <span class="comment"> * Switch the sort order of two roles (used in admin/roles/manage.php).</span>
<a name="l4754"><span class="linenum">4754</span></a>  <span class="comment"> *</span>
<a name="l4755"><span class="linenum">4755</span></a>  <span class="comment"> * @param stdClass $first The first role. Actually, only -&gt;sortorder is used.</span>
<a name="l4756"><span class="linenum">4756</span></a>  <span class="comment"> * @param stdClass $second The second role. Actually, only -&gt;sortorder is used.</span>
<a name="l4757"><span class="linenum">4757</span></a>  <span class="comment"> * @return boolean success or failure</span>
<a name="l4758"><span class="linenum">4758</span></a>  <span class="comment"> */</span>
<a name="l4759"><span class="linenum">4759</span></a>  function <a class="function" onClick="logFunction('switch_roles')" href="../_functions/switch_roles.html" onMouseOver="funcPopup(event,'switch_roles')">switch_roles</a>(<a class="var it389" onMouseOver="hilite(389)" onMouseOut="lolite()" onClick="logVariable('first')" href="../_variables/first.html">$first</a>, <a class="var it1280" onMouseOver="hilite(1280)" onMouseOut="lolite()" onClick="logVariable('second')" href="../_variables/second.html">$second</a>) {
<a name="l4760"><span class="linenum">4760</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l4761"><span class="linenum">4761</span></a>      <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('temp')" href="../_variables/temp.html">$temp</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field')" href="../_functions/get_field.html" onMouseOver="funcPopup(event,'get_field')">get_field</a>('role', '<a class="phpfunction" onClick="logFunction('MAX')" href="../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">MAX</a>(sortorder) + 1', array());
<a name="l4762"><span class="linenum">4762</span></a>      <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('role', 'sortorder', <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('temp')" href="../_variables/temp.html">$temp</a>, array('sortorder' =&gt; <a class="var it389" onMouseOver="hilite(389)" onMouseOut="lolite()" onClick="logVariable('first')" href="../_variables/first.html">$first</a>-&gt;<a onClick="logVariable('sortorder')" class="var it40290" onMouseOver="hilite(40290)" onMouseOut="lolite()" href="../_variables/sortorder.html">sortorder</a>));
<a name="l4763"><span class="linenum">4763</span></a>      <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a> = <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a> &amp;&amp; <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('role', 'sortorder', <a class="var it389" onMouseOver="hilite(389)" onMouseOut="lolite()" onClick="logVariable('first')" href="../_variables/first.html">$first</a>-&gt;<a onClick="logVariable('sortorder')" class="var it40290" onMouseOver="hilite(40290)" onMouseOut="lolite()" href="../_variables/sortorder.html">sortorder</a>, array('sortorder' =&gt; <a class="var it1280" onMouseOver="hilite(1280)" onMouseOut="lolite()" onClick="logVariable('second')" href="../_variables/second.html">$second</a>-&gt;<a onClick="logVariable('sortorder')" class="var it40985" onMouseOver="hilite(40985)" onMouseOut="lolite()" href="../_variables/sortorder.html">sortorder</a>));
<a name="l4764"><span class="linenum">4764</span></a>      <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a> = <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a> &amp;&amp; <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('role', 'sortorder', <a class="var it1280" onMouseOver="hilite(1280)" onMouseOut="lolite()" onClick="logVariable('second')" href="../_variables/second.html">$second</a>-&gt;<a onClick="logVariable('sortorder')" class="var it40985" onMouseOver="hilite(40985)" onMouseOut="lolite()" href="../_variables/sortorder.html">sortorder</a>, array('sortorder' =&gt; <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('temp')" href="../_variables/temp.html">$temp</a>));
<a name="l4765"><span class="linenum">4765</span></a>      return <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>;
<a name="l4766"><span class="linenum">4766</span></a>  }
<a name="l4767"><span class="linenum">4767</span></a>  
<a name="l4768"><span class="linenum">4768</span></a>  <span class="comment">/**</span>
<a name="l4769"><span class="linenum">4769</span></a>  <span class="comment"> * Duplicates all the base definitions of a role</span>
<a name="l4770"><span class="linenum">4770</span></a>  <span class="comment"> *</span>
<a name="l4771"><span class="linenum">4771</span></a>  <span class="comment"> * @param stdClass $sourcerole role to copy from</span>
<a name="l4772"><span class="linenum">4772</span></a>  <span class="comment"> * @param int $targetrole id of role to copy to</span>
<a name="l4773"><span class="linenum">4773</span></a>  <span class="comment"> */</span>
<a name="l4774"><span class="linenum">4774</span></a>  function <a class="function" onClick="logFunction('role_cap_duplicate')" href="../_functions/role_cap_duplicate.html" onMouseOver="funcPopup(event,'role_cap_duplicate')">role_cap_duplicate</a>(<a class="var it3923" onMouseOver="hilite(3923)" onMouseOut="lolite()" onClick="logVariable('sourcerole')" href="../_variables/sourcerole.html">$sourcerole</a>, <a class="var it12380" onMouseOver="hilite(12380)" onMouseOut="lolite()" onClick="logVariable('targetrole')" href="../_variables/targetrole.html">$targetrole</a>) {
<a name="l4775"><span class="linenum">4775</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l4776"><span class="linenum">4776</span></a>  
<a name="l4777"><span class="linenum">4777</span></a>      <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('systemcontext')" href="../_variables/systemcontext.html">$systemcontext</a> = <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l4778"><span class="linenum">4778</span></a>      <a class="var it4955" onMouseOver="hilite(4955)" onMouseOut="lolite()" onClick="logVariable('caps')" href="../_variables/caps.html">$caps</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;SELECT *
<a name="l4779"><span class="linenum">4779</span></a>                                      FROM {role_capabilities}
<a name="l4780"><span class="linenum">4780</span></a>                                     WHERE roleid = ? AND contextid = ?&quot;,
<a name="l4781"><span class="linenum">4781</span></a>                                   array(<a class="var it3923" onMouseOver="hilite(3923)" onMouseOut="lolite()" onClick="logVariable('sourcerole')" href="../_variables/sourcerole.html">$sourcerole</a>-&gt;<a onClick="logVariable('id')" class="var it40986" onMouseOver="hilite(40986)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('systemcontext')" href="../_variables/systemcontext.html">$systemcontext</a>-&gt;<a onClick="logVariable('id')" class="var it39845" onMouseOver="hilite(39845)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l4782"><span class="linenum">4782</span></a>  <span class="comment">    // adding capabilities</span>
<a name="l4783"><span class="linenum">4783</span></a>      foreach (<a class="var it4955" onMouseOver="hilite(4955)" onMouseOut="lolite()" onClick="logVariable('caps')" href="../_variables/caps.html">$caps</a> as <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>) {
<a name="l4784"><span class="linenum">4784</span></a>          unset(<a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>-&gt;<a onClick="logVariable('id')" class="var it40429" onMouseOver="hilite(40429)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l4785"><span class="linenum">4785</span></a>          <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>-&gt;<a onClick="logVariable('roleid')" class="var it40429" onMouseOver="hilite(40429)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a> = <a class="var it12380" onMouseOver="hilite(12380)" onMouseOut="lolite()" onClick="logVariable('targetrole')" href="../_variables/targetrole.html">$targetrole</a>;
<a name="l4786"><span class="linenum">4786</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('role_capabilities', <a class="var it3026" onMouseOver="hilite(3026)" onMouseOut="lolite()" onClick="logVariable('cap')" href="../_variables/cap.html">$cap</a>);
<a name="l4787"><span class="linenum">4787</span></a>      }
<a name="l4788"><span class="linenum">4788</span></a>  }
<a name="l4789"><span class="linenum">4789</span></a>  
<a name="l4790"><span class="linenum">4790</span></a>  <span class="comment">/**</span>
<a name="l4791"><span class="linenum">4791</span></a>  <span class="comment"> * Returns two lists, this can be used to find out if user has capability.</span>
<a name="l4792"><span class="linenum">4792</span></a>  <span class="comment"> * Having any needed role and no forbidden role in this context means</span>
<a name="l4793"><span class="linenum">4793</span></a>  <span class="comment"> * user has this capability in this context.</span>
<a name="l4794"><span class="linenum">4794</span></a>  <span class="comment"> * Use get_role_names_with_cap_in_context() if you need role names to display in the UI</span>
<a name="l4795"><span class="linenum">4795</span></a>  <span class="comment"> *</span>
<a name="l4796"><span class="linenum">4796</span></a>  <span class="comment"> * @param stdClass $context</span>
<a name="l4797"><span class="linenum">4797</span></a>  <span class="comment"> * @param string $capability</span>
<a name="l4798"><span class="linenum">4798</span></a>  <span class="comment"> * @return array($neededroles, $forbiddenroles)</span>
<a name="l4799"><span class="linenum">4799</span></a>  <span class="comment"> */</span>
<a name="l4800"><span class="linenum">4800</span></a>  function <a class="function" onClick="logFunction('get_roles_with_cap_in_context')" href="../_functions/get_roles_with_cap_in_context.html" onMouseOver="funcPopup(event,'get_roles_with_cap_in_context')">get_roles_with_cap_in_context</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>) {
<a name="l4801"><span class="linenum">4801</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l4802"><span class="linenum">4802</span></a>  
<a name="l4803"><span class="linenum">4803</span></a>      <a class="var it25259" onMouseOver="hilite(25259)" onMouseOut="lolite()" onClick="logVariable('ctxids')" href="../_variables/ctxids.html">$ctxids</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('path')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/path.html">path</a>, '/'); <span class="comment">// kill leading slash</span>
<a name="l4804"><span class="linenum">4804</span></a>      <a class="var it25259" onMouseOver="hilite(25259)" onMouseOut="lolite()" onClick="logVariable('ctxids')" href="../_variables/ctxids.html">$ctxids</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('/', ',', <a class="var it25259" onMouseOver="hilite(25259)" onMouseOut="lolite()" onClick="logVariable('ctxids')" href="../_variables/ctxids.html">$ctxids</a>);
<a name="l4805"><span class="linenum">4805</span></a>  
<a name="l4806"><span class="linenum">4806</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT rc.id, rc.roleid, rc.permission, ctx.depth
<a name="l4807"><span class="linenum">4807</span></a>                FROM {role_capabilities} rc
<a name="l4808"><span class="linenum">4808</span></a>                JOIN {context} ctx ON ctx.id = rc.contextid
<a name="l4809"><span class="linenum">4809</span></a>               WHERE rc.capability = :cap AND ctx.id IN (<a class="var it25259" onMouseOver="hilite(25259)" onMouseOut="lolite()" onClick="logVariable('ctxids')" href="../_variables/ctxids.html">$ctxids</a>)
<a name="l4810"><span class="linenum">4810</span></a>            ORDER BY rc.roleid ASC, ctx.depth DESC&quot;;
<a name="l4811"><span class="linenum">4811</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array('cap'=&gt;<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>);
<a name="l4812"><span class="linenum">4812</span></a>  
<a name="l4813"><span class="linenum">4813</span></a>      if (!<a class="var it28887" onMouseOver="hilite(28887)" onMouseOut="lolite()" onClick="logVariable('capdefs')" href="../_variables/capdefs.html">$capdefs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>)) {
<a name="l4814"><span class="linenum">4814</span></a>  <span class="comment">        // no cap definitions --&gt; no capability</span>
<a name="l4815"><span class="linenum">4815</span></a>          return array(array(), array());
<a name="l4816"><span class="linenum">4816</span></a>      }
<a name="l4817"><span class="linenum">4817</span></a>  
<a name="l4818"><span class="linenum">4818</span></a>      <a class="var it7794" onMouseOver="hilite(7794)" onMouseOut="lolite()" onClick="logVariable('forbidden')" href="../_variables/forbidden.html">$forbidden</a> = array();
<a name="l4819"><span class="linenum">4819</span></a>      <a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>    = array();
<a name="l4820"><span class="linenum">4820</span></a>      foreach(<a class="var it28887" onMouseOver="hilite(28887)" onMouseOut="lolite()" onClick="logVariable('capdefs')" href="../_variables/capdefs.html">$capdefs</a> as <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('def')" href="../_variables/def.html">$def</a>) {
<a name="l4821"><span class="linenum">4821</span></a>          if (isset(<a class="var it7794" onMouseOver="hilite(7794)" onMouseOut="lolite()" onClick="logVariable('forbidden')" href="../_variables/forbidden.html">$forbidden</a>[<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('def')" href="../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('roleid')" class="var it39459" onMouseOver="hilite(39459)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>])) {
<a name="l4822"><span class="linenum">4822</span></a>              continue;
<a name="l4823"><span class="linenum">4823</span></a>          }
<a name="l4824"><span class="linenum">4824</span></a>          if (<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('def')" href="../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('permission')" class="var it39459" onMouseOver="hilite(39459)" onMouseOut="lolite()" href="../_variables/permission.html">permission</a> == <a class="constant" onClick="logConstant('CAP_PROHIBIT')" href="../_constants/CAP_PROHIBIT.html" onMouseOver="constPopup(event,'CAP_PROHIBIT')">CAP_PROHIBIT</a>) {
<a name="l4825"><span class="linenum">4825</span></a>              <a class="var it7794" onMouseOver="hilite(7794)" onMouseOut="lolite()" onClick="logVariable('forbidden')" href="../_variables/forbidden.html">$forbidden</a>[<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('def')" href="../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('roleid')" class="var it39459" onMouseOver="hilite(39459)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>] = <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('def')" href="../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('roleid')" class="var it39459" onMouseOver="hilite(39459)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>;
<a name="l4826"><span class="linenum">4826</span></a>              unset(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>[<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('def')" href="../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('roleid')" class="var it39459" onMouseOver="hilite(39459)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>]);
<a name="l4827"><span class="linenum">4827</span></a>              continue;
<a name="l4828"><span class="linenum">4828</span></a>          }
<a name="l4829"><span class="linenum">4829</span></a>          if (!isset(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>[<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('def')" href="../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('roleid')" class="var it39459" onMouseOver="hilite(39459)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>])) {
<a name="l4830"><span class="linenum">4830</span></a>              if (<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('def')" href="../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('permission')" class="var it39459" onMouseOver="hilite(39459)" onMouseOut="lolite()" href="../_variables/permission.html">permission</a> == <a class="constant" onClick="logConstant('CAP_ALLOW')" href="../_constants/CAP_ALLOW.html" onMouseOver="constPopup(event,'CAP_ALLOW')">CAP_ALLOW</a>) {
<a name="l4831"><span class="linenum">4831</span></a>                  <a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>[<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('def')" href="../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('roleid')" class="var it39459" onMouseOver="hilite(39459)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>] = true;
<a name="l4832"><span class="linenum">4832</span></a>              } else if (<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('def')" href="../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('permission')" class="var it39459" onMouseOver="hilite(39459)" onMouseOut="lolite()" href="../_variables/permission.html">permission</a> == <a class="constant" onClick="logConstant('CAP_PREVENT')" href="../_constants/CAP_PREVENT.html" onMouseOver="constPopup(event,'CAP_PREVENT')">CAP_PREVENT</a>) {
<a name="l4833"><span class="linenum">4833</span></a>                  <a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>[<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('def')" href="../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('roleid')" class="var it39459" onMouseOver="hilite(39459)" onMouseOut="lolite()" href="../_variables/roleid.html">roleid</a>] = false;
<a name="l4834"><span class="linenum">4834</span></a>              }
<a name="l4835"><span class="linenum">4835</span></a>          }
<a name="l4836"><span class="linenum">4836</span></a>      }
<a name="l4837"><span class="linenum">4837</span></a>      unset(<a class="var it28887" onMouseOver="hilite(28887)" onMouseOut="lolite()" onClick="logVariable('capdefs')" href="../_variables/capdefs.html">$capdefs</a>);
<a name="l4838"><span class="linenum">4838</span></a>  
<a name="l4839"><span class="linenum">4839</span></a>  <span class="comment">    // remove all those roles not allowing</span>
<a name="l4840"><span class="linenum">4840</span></a>      foreach(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a> as <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>=&gt;<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../_variables/value.html">$value</a>) {
<a name="l4841"><span class="linenum">4841</span></a>          if (!<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../_variables/value.html">$value</a>) {
<a name="l4842"><span class="linenum">4842</span></a>              unset(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>[<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>]);
<a name="l4843"><span class="linenum">4843</span></a>          } else {
<a name="l4844"><span class="linenum">4844</span></a>              <a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>[<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>] = <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>;
<a name="l4845"><span class="linenum">4845</span></a>          }
<a name="l4846"><span class="linenum">4846</span></a>      }
<a name="l4847"><span class="linenum">4847</span></a>  
<a name="l4848"><span class="linenum">4848</span></a>      return array(<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>, <a class="var it7794" onMouseOver="hilite(7794)" onMouseOut="lolite()" onClick="logVariable('forbidden')" href="../_variables/forbidden.html">$forbidden</a>);
<a name="l4849"><span class="linenum">4849</span></a>  }
<a name="l4850"><span class="linenum">4850</span></a>  
<a name="l4851"><span class="linenum">4851</span></a>  <span class="comment">/**</span>
<a name="l4852"><span class="linenum">4852</span></a>  <span class="comment"> * Returns an array of role IDs that have ALL of the the supplied capabilities</span>
<a name="l4853"><span class="linenum">4853</span></a>  <span class="comment"> * Uses get_roles_with_cap_in_context(). Returns $allowed minus $forbidden</span>
<a name="l4854"><span class="linenum">4854</span></a>  <span class="comment"> *</span>
<a name="l4855"><span class="linenum">4855</span></a>  <span class="comment"> * @param stdClass $context</span>
<a name="l4856"><span class="linenum">4856</span></a>  <span class="comment"> * @param array $capabilities An array of capabilities</span>
<a name="l4857"><span class="linenum">4857</span></a>  <span class="comment"> * @return array of roles with all of the required capabilities</span>
<a name="l4858"><span class="linenum">4858</span></a>  <span class="comment"> */</span>
<a name="l4859"><span class="linenum">4859</span></a>  function <a class="function" onClick="logFunction('get_roles_with_caps_in_context')" href="../_functions/get_roles_with_caps_in_context.html" onMouseOver="funcPopup(event,'get_roles_with_caps_in_context')">get_roles_with_caps_in_context</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it497" onMouseOver="hilite(497)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../_variables/capabilities.html">$capabilities</a>) {
<a name="l4860"><span class="linenum">4860</span></a>      <a class="var it28888" onMouseOver="hilite(28888)" onMouseOut="lolite()" onClick="logVariable('neededarr')" href="../_variables/neededarr.html">$neededarr</a> = array();
<a name="l4861"><span class="linenum">4861</span></a>      <a class="var it28889" onMouseOver="hilite(28889)" onMouseOut="lolite()" onClick="logVariable('forbiddenarr')" href="../_variables/forbiddenarr.html">$forbiddenarr</a> = array();
<a name="l4862"><span class="linenum">4862</span></a>      foreach(<a class="var it497" onMouseOver="hilite(497)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../_variables/capabilities.html">$capabilities</a> as <a class="var it28890" onMouseOver="hilite(28890)" onMouseOut="lolite()" onClick="logVariable('caprequired')" href="../_variables/caprequired.html">$caprequired</a>) {
<a name="l4863"><span class="linenum">4863</span></a>          <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it28888" onMouseOver="hilite(28888)" onMouseOut="lolite()" onClick="logVariable('neededarr')" href="../_variables/neededarr.html">$neededarr</a>[], <a class="var it28889" onMouseOver="hilite(28889)" onMouseOut="lolite()" onClick="logVariable('forbiddenarr')" href="../_variables/forbiddenarr.html">$forbiddenarr</a>[]) = <a class="function" onClick="logFunction('get_roles_with_cap_in_context')" href="../_functions/get_roles_with_cap_in_context.html" onMouseOver="funcPopup(event,'get_roles_with_cap_in_context')">get_roles_with_cap_in_context</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it28890" onMouseOver="hilite(28890)" onMouseOut="lolite()" onClick="logVariable('caprequired')" href="../_variables/caprequired.html">$caprequired</a>);
<a name="l4864"><span class="linenum">4864</span></a>      }
<a name="l4865"><span class="linenum">4865</span></a>  
<a name="l4866"><span class="linenum">4866</span></a>      <a class="var it28891" onMouseOver="hilite(28891)" onMouseOut="lolite()" onClick="logVariable('rolesthatcanrate')" href="../_variables/rolesthatcanrate.html">$rolesthatcanrate</a> = array();
<a name="l4867"><span class="linenum">4867</span></a>      if (!empty(<a class="var it28888" onMouseOver="hilite(28888)" onMouseOut="lolite()" onClick="logVariable('neededarr')" href="../_variables/neededarr.html">$neededarr</a>)) {
<a name="l4868"><span class="linenum">4868</span></a>          foreach (<a class="var it28888" onMouseOver="hilite(28888)" onMouseOut="lolite()" onClick="logVariable('neededarr')" href="../_variables/neededarr.html">$neededarr</a> as <a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>) {
<a name="l4869"><span class="linenum">4869</span></a>              if (empty(<a class="var it28891" onMouseOver="hilite(28891)" onMouseOut="lolite()" onClick="logVariable('rolesthatcanrate')" href="../_variables/rolesthatcanrate.html">$rolesthatcanrate</a>)) {
<a name="l4870"><span class="linenum">4870</span></a>                  <a class="var it28891" onMouseOver="hilite(28891)" onMouseOut="lolite()" onClick="logVariable('rolesthatcanrate')" href="../_variables/rolesthatcanrate.html">$rolesthatcanrate</a> = <a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>;
<a name="l4871"><span class="linenum">4871</span></a>              } else {
<a name="l4872"><span class="linenum">4872</span></a>  <span class="comment">                //only want roles that have all caps</span>
<a name="l4873"><span class="linenum">4873</span></a>                  <a class="var it28891" onMouseOver="hilite(28891)" onMouseOut="lolite()" onClick="logVariable('rolesthatcanrate')" href="../_variables/rolesthatcanrate.html">$rolesthatcanrate</a> = array_intersect_key(<a class="var it28891" onMouseOver="hilite(28891)" onMouseOut="lolite()" onClick="logVariable('rolesthatcanrate')" href="../_variables/rolesthatcanrate.html">$rolesthatcanrate</a>,<a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('needed')" href="../_variables/needed.html">$needed</a>);
<a name="l4874"><span class="linenum">4874</span></a>              }
<a name="l4875"><span class="linenum">4875</span></a>          }
<a name="l4876"><span class="linenum">4876</span></a>      }
<a name="l4877"><span class="linenum">4877</span></a>      if (!empty(<a class="var it28889" onMouseOver="hilite(28889)" onMouseOut="lolite()" onClick="logVariable('forbiddenarr')" href="../_variables/forbiddenarr.html">$forbiddenarr</a>) &amp;&amp; !empty(<a class="var it28891" onMouseOver="hilite(28891)" onMouseOut="lolite()" onClick="logVariable('rolesthatcanrate')" href="../_variables/rolesthatcanrate.html">$rolesthatcanrate</a>)) {
<a name="l4878"><span class="linenum">4878</span></a>          foreach (<a class="var it28889" onMouseOver="hilite(28889)" onMouseOut="lolite()" onClick="logVariable('forbiddenarr')" href="../_variables/forbiddenarr.html">$forbiddenarr</a> as <a class="var it7794" onMouseOver="hilite(7794)" onMouseOut="lolite()" onClick="logVariable('forbidden')" href="../_variables/forbidden.html">$forbidden</a>) {
<a name="l4879"><span class="linenum">4879</span></a>  <span class="comment">           //remove any roles that are forbidden any of the caps</span>
<a name="l4880"><span class="linenum">4880</span></a>             <a class="var it28891" onMouseOver="hilite(28891)" onMouseOut="lolite()" onClick="logVariable('rolesthatcanrate')" href="../_variables/rolesthatcanrate.html">$rolesthatcanrate</a> = <a class="phpfunction" onClick="logFunction('array_diff')" href="../_functions/array_diff.html" onMouseOver="phpfuncPopup(event,'array_diff')">array_diff</a>(<a class="var it28891" onMouseOver="hilite(28891)" onMouseOut="lolite()" onClick="logVariable('rolesthatcanrate')" href="../_variables/rolesthatcanrate.html">$rolesthatcanrate</a>, <a class="var it7794" onMouseOver="hilite(7794)" onMouseOut="lolite()" onClick="logVariable('forbidden')" href="../_variables/forbidden.html">$forbidden</a>);
<a name="l4881"><span class="linenum">4881</span></a>          }
<a name="l4882"><span class="linenum">4882</span></a>      }
<a name="l4883"><span class="linenum">4883</span></a>      return <a class="var it28891" onMouseOver="hilite(28891)" onMouseOut="lolite()" onClick="logVariable('rolesthatcanrate')" href="../_variables/rolesthatcanrate.html">$rolesthatcanrate</a>;
<a name="l4884"><span class="linenum">4884</span></a>  }
<a name="l4885"><span class="linenum">4885</span></a>  
<a name="l4886"><span class="linenum">4886</span></a>  <span class="comment">/**</span>
<a name="l4887"><span class="linenum">4887</span></a>  <span class="comment"> * Returns an array of role names that have ALL of the the supplied capabilities</span>
<a name="l4888"><span class="linenum">4888</span></a>  <span class="comment"> * Uses get_roles_with_caps_in_context(). Returns $allowed minus $forbidden</span>
<a name="l4889"><span class="linenum">4889</span></a>  <span class="comment"> *</span>
<a name="l4890"><span class="linenum">4890</span></a>  <span class="comment"> * @param stdClass $context</span>
<a name="l4891"><span class="linenum">4891</span></a>  <span class="comment"> * @param array $capabilities An array of capabilities</span>
<a name="l4892"><span class="linenum">4892</span></a>  <span class="comment"> * @return array of roles with all of the required capabilities</span>
<a name="l4893"><span class="linenum">4893</span></a>  <span class="comment"> */</span>
<a name="l4894"><span class="linenum">4894</span></a>  function <a class="function" onClick="logFunction('get_role_names_with_caps_in_context')" href="../_functions/get_role_names_with_caps_in_context.html" onMouseOver="funcPopup(event,'get_role_names_with_caps_in_context')">get_role_names_with_caps_in_context</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it497" onMouseOver="hilite(497)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../_variables/capabilities.html">$capabilities</a>) {
<a name="l4895"><span class="linenum">4895</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l4896"><span class="linenum">4896</span></a>  
<a name="l4897"><span class="linenum">4897</span></a>      <a class="var it28891" onMouseOver="hilite(28891)" onMouseOut="lolite()" onClick="logVariable('rolesthatcanrate')" href="../_variables/rolesthatcanrate.html">$rolesthatcanrate</a> = <a class="function" onClick="logFunction('get_roles_with_caps_in_context')" href="../_functions/get_roles_with_caps_in_context.html" onMouseOver="funcPopup(event,'get_roles_with_caps_in_context')">get_roles_with_caps_in_context</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it497" onMouseOver="hilite(497)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../_variables/capabilities.html">$capabilities</a>);
<a name="l4898"><span class="linenum">4898</span></a>      <a class="var it3145" onMouseOver="hilite(3145)" onMouseOut="lolite()" onClick="logVariable('allroles')" href="../_variables/allroles.html">$allroles</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('role', null, 'sortorder DESC');
<a name="l4899"><span class="linenum">4899</span></a>  
<a name="l4900"><span class="linenum">4900</span></a>      <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a> = array();
<a name="l4901"><span class="linenum">4901</span></a>      foreach (<a class="var it28891" onMouseOver="hilite(28891)" onMouseOut="lolite()" onClick="logVariable('rolesthatcanrate')" href="../_variables/rolesthatcanrate.html">$rolesthatcanrate</a> as <a class="var it746" onMouseOver="hilite(746)" onMouseOut="lolite()" onClick="logVariable('r')" href="../_variables/r.html">$r</a>) {
<a name="l4902"><span class="linenum">4902</span></a>          <a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>[<a class="var it746" onMouseOver="hilite(746)" onMouseOut="lolite()" onClick="logVariable('r')" href="../_variables/r.html">$r</a>] = <a class="var it3145" onMouseOver="hilite(3145)" onMouseOut="lolite()" onClick="logVariable('allroles')" href="../_variables/allroles.html">$allroles</a>[<a class="var it746" onMouseOver="hilite(746)" onMouseOut="lolite()" onClick="logVariable('r')" href="../_variables/r.html">$r</a>];
<a name="l4903"><span class="linenum">4903</span></a>      }
<a name="l4904"><span class="linenum">4904</span></a>  
<a name="l4905"><span class="linenum">4905</span></a>      return <a class="function" onClick="logFunction('role_fix_names')" href="../_functions/role_fix_names.html" onMouseOver="funcPopup(event,'role_fix_names')">role_fix_names</a>(<a class="var it425" onMouseOver="hilite(425)" onMouseOut="lolite()" onClick="logVariable('roles')" href="../_variables/roles.html">$roles</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="constant" onClick="logConstant('ROLENAME_ALIAS')" href="../_constants/ROLENAME_ALIAS.html" onMouseOver="constPopup(event,'ROLENAME_ALIAS')">ROLENAME_ALIAS</a>, true);
<a name="l4906"><span class="linenum">4906</span></a>  }
<a name="l4907"><span class="linenum">4907</span></a>  
<a name="l4908"><span class="linenum">4908</span></a>  <span class="comment">/**</span>
<a name="l4909"><span class="linenum">4909</span></a>  <span class="comment"> * This function verifies the prohibit comes from this context</span>
<a name="l4910"><span class="linenum">4910</span></a>  <span class="comment"> * and there are no more prohibits in parent contexts.</span>
<a name="l4911"><span class="linenum">4911</span></a>  <span class="comment"> *</span>
<a name="l4912"><span class="linenum">4912</span></a>  <span class="comment"> * @param int $roleid</span>
<a name="l4913"><span class="linenum">4913</span></a>  <span class="comment"> * @param context $context</span>
<a name="l4914"><span class="linenum">4914</span></a>  <span class="comment"> * @param string $capability name</span>
<a name="l4915"><span class="linenum">4915</span></a>  <span class="comment"> * @return bool</span>
<a name="l4916"><span class="linenum">4916</span></a>  <span class="comment"> */</span>
<a name="l4917"><span class="linenum">4917</span></a>  function <a class="function" onClick="logFunction('prohibit_is_removable')" href="../_functions/prohibit_is_removable.html" onMouseOver="funcPopup(event,'prohibit_is_removable')">prohibit_is_removable</a>(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>) {
<a name="l4918"><span class="linenum">4918</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l4919"><span class="linenum">4919</span></a>  
<a name="l4920"><span class="linenum">4920</span></a>      <a class="var it25259" onMouseOver="hilite(25259)" onMouseOut="lolite()" onClick="logVariable('ctxids')" href="../_variables/ctxids.html">$ctxids</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('path')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/path.html">path</a>, '/'); <span class="comment">// kill leading slash</span>
<a name="l4921"><span class="linenum">4921</span></a>      <a class="var it25259" onMouseOver="hilite(25259)" onMouseOut="lolite()" onClick="logVariable('ctxids')" href="../_variables/ctxids.html">$ctxids</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('/', ',', <a class="var it25259" onMouseOver="hilite(25259)" onMouseOut="lolite()" onClick="logVariable('ctxids')" href="../_variables/ctxids.html">$ctxids</a>);
<a name="l4922"><span class="linenum">4922</span></a>  
<a name="l4923"><span class="linenum">4923</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array('roleid'=&gt;<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, 'cap'=&gt;<a class="var it2621" onMouseOver="hilite(2621)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../_variables/capability.html">$capability</a>, 'prohibit'=&gt;<a class="constant" onClick="logConstant('CAP_PROHIBIT')" href="../_constants/CAP_PROHIBIT.html" onMouseOver="constPopup(event,'CAP_PROHIBIT')">CAP_PROHIBIT</a>);
<a name="l4924"><span class="linenum">4924</span></a>  
<a name="l4925"><span class="linenum">4925</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT ctx.id
<a name="l4926"><span class="linenum">4926</span></a>                FROM {role_capabilities} rc
<a name="l4927"><span class="linenum">4927</span></a>                JOIN {context} ctx ON ctx.id = rc.contextid
<a name="l4928"><span class="linenum">4928</span></a>               WHERE rc.roleid = :roleid AND rc.permission = :prohibit AND rc.capability = :cap AND ctx.id IN (<a class="var it25259" onMouseOver="hilite(25259)" onMouseOut="lolite()" onClick="logVariable('ctxids')" href="../_variables/ctxids.html">$ctxids</a>)
<a name="l4929"><span class="linenum">4929</span></a>            ORDER BY ctx.depth DESC&quot;;
<a name="l4930"><span class="linenum">4930</span></a>  
<a name="l4931"><span class="linenum">4931</span></a>      if (!<a class="var it28892" onMouseOver="hilite(28892)" onMouseOut="lolite()" onClick="logVariable('prohibits')" href="../_variables/prohibits.html">$prohibits</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>)) {
<a name="l4932"><span class="linenum">4932</span></a>  <span class="comment">        // no prohibits == nothing to remove</span>
<a name="l4933"><span class="linenum">4933</span></a>          return true;
<a name="l4934"><span class="linenum">4934</span></a>      }
<a name="l4935"><span class="linenum">4935</span></a>  
<a name="l4936"><span class="linenum">4936</span></a>      if (<a class="phpfunction" onClick="logFunction('count')" href="../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it28892" onMouseOver="hilite(28892)" onMouseOut="lolite()" onClick="logVariable('prohibits')" href="../_variables/prohibits.html">$prohibits</a>) &gt; 1) {
<a name="l4937"><span class="linenum">4937</span></a>  <span class="comment">        // more prohibits can not be removed</span>
<a name="l4938"><span class="linenum">4938</span></a>          return false;
<a name="l4939"><span class="linenum">4939</span></a>      }
<a name="l4940"><span class="linenum">4940</span></a>  
<a name="l4941"><span class="linenum">4941</span></a>      return !empty(<a class="var it28892" onMouseOver="hilite(28892)" onMouseOut="lolite()" onClick="logVariable('prohibits')" href="../_variables/prohibits.html">$prohibits</a>[<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>]);
<a name="l4942"><span class="linenum">4942</span></a>  }
<a name="l4943"><span class="linenum">4943</span></a>  
<a name="l4944"><span class="linenum">4944</span></a>  <span class="comment">/**</span>
<a name="l4945"><span class="linenum">4945</span></a>  <span class="comment"> * More user friendly role permission changing,</span>
<a name="l4946"><span class="linenum">4946</span></a>  <span class="comment"> * it should produce as few overrides as possible.</span>
<a name="l4947"><span class="linenum">4947</span></a>  <span class="comment"> *</span>
<a name="l4948"><span class="linenum">4948</span></a>  <span class="comment"> * @param int $roleid</span>
<a name="l4949"><span class="linenum">4949</span></a>  <span class="comment"> * @param stdClass $context</span>
<a name="l4950"><span class="linenum">4950</span></a>  <span class="comment"> * @param string $capname capability name</span>
<a name="l4951"><span class="linenum">4951</span></a>  <span class="comment"> * @param int $permission</span>
<a name="l4952"><span class="linenum">4952</span></a>  <span class="comment"> * @return void</span>
<a name="l4953"><span class="linenum">4953</span></a>  <span class="comment"> */</span>
<a name="l4954"><span class="linenum">4954</span></a>  function <a class="function" onClick="logFunction('role_change_permission')" href="../_functions/role_change_permission.html" onMouseOver="funcPopup(event,'role_change_permission')">role_change_permission</a>(<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it23190" onMouseOver="hilite(23190)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../_variables/capname.html">$capname</a>, <a class="var it3735" onMouseOver="hilite(3735)" onMouseOut="lolite()" onClick="logVariable('permission')" href="../_variables/permission.html">$permission</a>) {
<a name="l4955"><span class="linenum">4955</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l4956"><span class="linenum">4956</span></a>  
<a name="l4957"><span class="linenum">4957</span></a>      if (<a class="var it3735" onMouseOver="hilite(3735)" onMouseOut="lolite()" onClick="logVariable('permission')" href="../_variables/permission.html">$permission</a> == <a class="constant" onClick="logConstant('CAP_INHERIT')" href="../_constants/CAP_INHERIT.html" onMouseOver="constPopup(event,'CAP_INHERIT')">CAP_INHERIT</a>) {
<a name="l4958"><span class="linenum">4958</span></a>          <a class="function" onClick="logFunction('unassign_capability')" href="../_functions/unassign_capability.html" onMouseOver="funcPopup(event,'unassign_capability')">unassign_capability</a>(<a class="var it23190" onMouseOver="hilite(23190)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../_variables/capname.html">$capname</a>, <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l4959"><span class="linenum">4959</span></a>          <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('mark_dirty')" href="../_functions/mark_dirty.html" onMouseOver="funcPopup(event,'mark_dirty')">mark_dirty</a>();
<a name="l4960"><span class="linenum">4960</span></a>          return;
<a name="l4961"><span class="linenum">4961</span></a>      }
<a name="l4962"><span class="linenum">4962</span></a>  
<a name="l4963"><span class="linenum">4963</span></a>      <a class="var it25259" onMouseOver="hilite(25259)" onMouseOut="lolite()" onClick="logVariable('ctxids')" href="../_variables/ctxids.html">$ctxids</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('path')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/path.html">path</a>, '/'); <span class="comment">// kill leading slash</span>
<a name="l4964"><span class="linenum">4964</span></a>      <a class="var it25259" onMouseOver="hilite(25259)" onMouseOut="lolite()" onClick="logVariable('ctxids')" href="../_variables/ctxids.html">$ctxids</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('/', ',', <a class="var it25259" onMouseOver="hilite(25259)" onMouseOut="lolite()" onClick="logVariable('ctxids')" href="../_variables/ctxids.html">$ctxids</a>);
<a name="l4965"><span class="linenum">4965</span></a>  
<a name="l4966"><span class="linenum">4966</span></a>      <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array('roleid'=&gt;<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, 'cap'=&gt;<a class="var it23190" onMouseOver="hilite(23190)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../_variables/capname.html">$capname</a>);
<a name="l4967"><span class="linenum">4967</span></a>  
<a name="l4968"><span class="linenum">4968</span></a>      <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT ctx.id, rc.permission, ctx.depth
<a name="l4969"><span class="linenum">4969</span></a>                FROM {role_capabilities} rc
<a name="l4970"><span class="linenum">4970</span></a>                JOIN {context} ctx ON ctx.id = rc.contextid
<a name="l4971"><span class="linenum">4971</span></a>               WHERE rc.roleid = :roleid AND rc.capability = :cap AND ctx.id IN (<a class="var it25259" onMouseOver="hilite(25259)" onMouseOut="lolite()" onClick="logVariable('ctxids')" href="../_variables/ctxids.html">$ctxids</a>)
<a name="l4972"><span class="linenum">4972</span></a>            ORDER BY ctx.depth DESC&quot;;
<a name="l4973"><span class="linenum">4973</span></a>  
<a name="l4974"><span class="linenum">4974</span></a>      if (<a class="var it3149" onMouseOver="hilite(3149)" onMouseOut="lolite()" onClick="logVariable('existing')" href="../_variables/existing.html">$existing</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>)) {
<a name="l4975"><span class="linenum">4975</span></a>          foreach(<a class="var it3149" onMouseOver="hilite(3149)" onMouseOut="lolite()" onClick="logVariable('existing')" href="../_variables/existing.html">$existing</a> as <a class="var it193" onMouseOver="hilite(193)" onMouseOut="lolite()" onClick="logVariable('e')" href="../_variables/e.html">$e</a>) {
<a name="l4976"><span class="linenum">4976</span></a>              if (<a class="var it193" onMouseOver="hilite(193)" onMouseOut="lolite()" onClick="logVariable('e')" href="../_variables/e.html">$e</a>-&gt;<a onClick="logVariable('permission')" class="var it39497" onMouseOver="hilite(39497)" onMouseOut="lolite()" href="../_variables/permission.html">permission</a> == <a class="constant" onClick="logConstant('CAP_PROHIBIT')" href="../_constants/CAP_PROHIBIT.html" onMouseOver="constPopup(event,'CAP_PROHIBIT')">CAP_PROHIBIT</a>) {
<a name="l4977"><span class="linenum">4977</span></a>  <span class="comment">                // prohibit can not be overridden, no point in changing anything</span>
<a name="l4978"><span class="linenum">4978</span></a>                  return;
<a name="l4979"><span class="linenum">4979</span></a>              }
<a name="l4980"><span class="linenum">4980</span></a>          }
<a name="l4981"><span class="linenum">4981</span></a>          <a class="var it27697" onMouseOver="hilite(27697)" onMouseOut="lolite()" onClick="logVariable('lowest')" href="../_variables/lowest.html">$lowest</a> = <a class="phpfunction" onClick="logFunction('array_shift')" href="../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it3149" onMouseOver="hilite(3149)" onMouseOut="lolite()" onClick="logVariable('existing')" href="../_variables/existing.html">$existing</a>);
<a name="l4982"><span class="linenum">4982</span></a>          if (<a class="var it27697" onMouseOver="hilite(27697)" onMouseOut="lolite()" onClick="logVariable('lowest')" href="../_variables/lowest.html">$lowest</a>-&gt;<a onClick="logVariable('permission')" class="var it40987" onMouseOver="hilite(40987)" onMouseOut="lolite()" href="../_variables/permission.html">permission</a> == <a class="var it3735" onMouseOver="hilite(3735)" onMouseOut="lolite()" onClick="logVariable('permission')" href="../_variables/permission.html">$permission</a>) {
<a name="l4983"><span class="linenum">4983</span></a>  <span class="comment">            // permission already set in this context or parent - nothing to do</span>
<a name="l4984"><span class="linenum">4984</span></a>              return;
<a name="l4985"><span class="linenum">4985</span></a>          }
<a name="l4986"><span class="linenum">4986</span></a>          if (<a class="var it3149" onMouseOver="hilite(3149)" onMouseOut="lolite()" onClick="logVariable('existing')" href="../_variables/existing.html">$existing</a>) {
<a name="l4987"><span class="linenum">4987</span></a>              <a class="var it75" onMouseOver="hilite(75)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../_variables/parent.html">$parent</a> = <a class="phpfunction" onClick="logFunction('array_shift')" href="../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it3149" onMouseOver="hilite(3149)" onMouseOut="lolite()" onClick="logVariable('existing')" href="../_variables/existing.html">$existing</a>);
<a name="l4988"><span class="linenum">4988</span></a>              if (<a class="var it75" onMouseOver="hilite(75)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../_variables/parent.html">$parent</a>-&gt;<a onClick="logVariable('permission')" class="var it39475" onMouseOver="hilite(39475)" onMouseOut="lolite()" href="../_variables/permission.html">permission</a> == <a class="var it3735" onMouseOver="hilite(3735)" onMouseOut="lolite()" onClick="logVariable('permission')" href="../_variables/permission.html">$permission</a>) {
<a name="l4989"><span class="linenum">4989</span></a>  <span class="comment">                // permission already set in parent context or parent - just unset in this context</span>
<a name="l4990"><span class="linenum">4990</span></a>  <span class="comment">                // we do this because we want as few overrides as possible for performance reasons</span>
<a name="l4991"><span class="linenum">4991</span></a>                  <a class="function" onClick="logFunction('unassign_capability')" href="../_functions/unassign_capability.html" onMouseOver="funcPopup(event,'unassign_capability')">unassign_capability</a>(<a class="var it23190" onMouseOver="hilite(23190)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../_variables/capname.html">$capname</a>, <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l4992"><span class="linenum">4992</span></a>                  <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('mark_dirty')" href="../_functions/mark_dirty.html" onMouseOver="funcPopup(event,'mark_dirty')">mark_dirty</a>();
<a name="l4993"><span class="linenum">4993</span></a>                  return;
<a name="l4994"><span class="linenum">4994</span></a>              }
<a name="l4995"><span class="linenum">4995</span></a>          }
<a name="l4996"><span class="linenum">4996</span></a>  
<a name="l4997"><span class="linenum">4997</span></a>      } else {
<a name="l4998"><span class="linenum">4998</span></a>          if (<a class="var it3735" onMouseOver="hilite(3735)" onMouseOut="lolite()" onClick="logVariable('permission')" href="../_variables/permission.html">$permission</a> == <a class="constant" onClick="logConstant('CAP_PREVENT')" href="../_constants/CAP_PREVENT.html" onMouseOver="constPopup(event,'CAP_PREVENT')">CAP_PREVENT</a>) {
<a name="l4999"><span class="linenum">4999</span></a>  <span class="comment">            // nothing means role does not have permission</span>
<a name="l5000"><span class="linenum">5000</span></a>              return;
<a name="l5001"><span class="linenum">5001</span></a>          }
<a name="l5002"><span class="linenum">5002</span></a>      }
<a name="l5003"><span class="linenum">5003</span></a>  
<a name="l5004"><span class="linenum">5004</span></a>  <span class="comment">    // assign the needed capability</span>
<a name="l5005"><span class="linenum">5005</span></a>      <a class="function" onClick="logFunction('assign_capability')" href="../_functions/assign_capability.html" onMouseOver="funcPopup(event,'assign_capability')">assign_capability</a>(<a class="var it23190" onMouseOver="hilite(23190)" onMouseOut="lolite()" onClick="logVariable('capname')" href="../_variables/capname.html">$capname</a>, <a class="var it3735" onMouseOver="hilite(3735)" onMouseOut="lolite()" onClick="logVariable('permission')" href="../_variables/permission.html">$permission</a>, <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../_variables/roleid.html">$roleid</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, true);
<a name="l5006"><span class="linenum">5006</span></a>  
<a name="l5007"><span class="linenum">5007</span></a>  <span class="comment">    // force cap reloading</span>
<a name="l5008"><span class="linenum">5008</span></a>      <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('mark_dirty')" href="../_functions/mark_dirty.html" onMouseOver="funcPopup(event,'mark_dirty')">mark_dirty</a>();
<a name="l5009"><span class="linenum">5009</span></a>  }
<a name="l5010"><span class="linenum">5010</span></a>  
<a name="l5011"><span class="linenum">5011</span></a>  
<a name="l5012"><span class="linenum">5012</span></a>  <span class="comment">/**</span>
<a name="l5013"><span class="linenum">5013</span></a>  <span class="comment"> * Basic moodle context abstraction class.</span>
<a name="l5014"><span class="linenum">5014</span></a>  <span class="comment"> *</span>
<a name="l5015"><span class="linenum">5015</span></a>  <span class="comment"> * Google confirms that no other important framework is using &quot;context&quot; class,</span>
<a name="l5016"><span class="linenum">5016</span></a>  <span class="comment"> * we could use something else like mcontext or moodle_context, but we need to type</span>
<a name="l5017"><span class="linenum">5017</span></a>  <span class="comment"> * this very often which would be annoying and it would take too much space...</span>
<a name="l5018"><span class="linenum">5018</span></a>  <span class="comment"> *</span>
<a name="l5019"><span class="linenum">5019</span></a>  <span class="comment"> * This class is derived from stdClass for backwards compatibility with</span>
<a name="l5020"><span class="linenum">5020</span></a>  <span class="comment"> * odl $context record that was returned from DML $DB-&gt;get_record()</span>
<a name="l5021"><span class="linenum">5021</span></a>  <span class="comment"> *</span>
<a name="l5022"><span class="linenum">5022</span></a>  <span class="comment"> * @package   core_access</span>
<a name="l5023"><span class="linenum">5023</span></a>  <span class="comment"> * @category  access</span>
<a name="l5024"><span class="linenum">5024</span></a>  <span class="comment"> * @copyright Petr Skoda {@link http://skodak.org}</span>
<a name="l5025"><span class="linenum">5025</span></a>  <span class="comment"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l5026"><span class="linenum">5026</span></a>  <span class="comment"> * @since     Moodle 2.2</span>
<a name="l5027"><span class="linenum">5027</span></a>  <span class="comment"> *</span>
<a name="l5028"><span class="linenum">5028</span></a>  <span class="comment"> * @property-read int $id context id</span>
<a name="l5029"><span class="linenum">5029</span></a>  <span class="comment"> * @property-read int $contextlevel CONTEXT_SYSTEM, CONTEXT_COURSE, etc.</span>
<a name="l5030"><span class="linenum">5030</span></a>  <span class="comment"> * @property-read int $instanceid id of related instance in each context</span>
<a name="l5031"><span class="linenum">5031</span></a>  <span class="comment"> * @property-read string $path path to context, starts with system context</span>
<a name="l5032"><span class="linenum">5032</span></a>  <span class="comment"> * @property-read int $depth</span>
<a name="l5033"><span class="linenum">5033</span></a>  <span class="comment"> */</span>
<a name="l5034"><span class="linenum">5034</span></a>  abstract class context extends stdClass implements IteratorAggregate {
<a name="l5035"><span class="linenum">5035</span></a>  
<a name="l5036"><span class="linenum">5036</span></a>      <span class="comment">/**</span>
<a name="l5037"><span class="linenum">5037</span></a>  <span class="comment">     * The context id</span>
<a name="l5038"><span class="linenum">5038</span></a>  <span class="comment">     * Can be accessed publicly through $context-&gt;id</span>
<a name="l5039"><span class="linenum">5039</span></a>  <span class="comment">     * @var int</span>
<a name="l5040"><span class="linenum">5040</span></a>  <span class="comment">     */</span>
<a name="l5041"><span class="linenum">5041</span></a>      protected <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('_id')" href="../_variables/_id.html">$_id</a>;
<a name="l5042"><span class="linenum">5042</span></a>  
<a name="l5043"><span class="linenum">5043</span></a>      <span class="comment">/**</span>
<a name="l5044"><span class="linenum">5044</span></a>  <span class="comment">     * The context level</span>
<a name="l5045"><span class="linenum">5045</span></a>  <span class="comment">     * Can be accessed publicly through $context-&gt;contextlevel</span>
<a name="l5046"><span class="linenum">5046</span></a>  <span class="comment">     * @var int One of CONTEXT_* e.g. CONTEXT_COURSE, CONTEXT_MODULE</span>
<a name="l5047"><span class="linenum">5047</span></a>  <span class="comment">     */</span>
<a name="l5048"><span class="linenum">5048</span></a>      protected <a class="var it28893" onMouseOver="hilite(28893)" onMouseOut="lolite()" onClick="logVariable('_contextlevel')" href="../_variables/_contextlevel.html">$_contextlevel</a>;
<a name="l5049"><span class="linenum">5049</span></a>  
<a name="l5050"><span class="linenum">5050</span></a>      <span class="comment">/**</span>
<a name="l5051"><span class="linenum">5051</span></a>  <span class="comment">     * Id of the item this context is related to e.g. COURSE_CONTEXT =&gt; course.id</span>
<a name="l5052"><span class="linenum">5052</span></a>  <span class="comment">     * Can be accessed publicly through $context-&gt;instanceid</span>
<a name="l5053"><span class="linenum">5053</span></a>  <span class="comment">     * @var int</span>
<a name="l5054"><span class="linenum">5054</span></a>  <span class="comment">     */</span>
<a name="l5055"><span class="linenum">5055</span></a>      protected <a class="var it28894" onMouseOver="hilite(28894)" onMouseOut="lolite()" onClick="logVariable('_instanceid')" href="../_variables/_instanceid.html">$_instanceid</a>;
<a name="l5056"><span class="linenum">5056</span></a>  
<a name="l5057"><span class="linenum">5057</span></a>      <span class="comment">/**</span>
<a name="l5058"><span class="linenum">5058</span></a>  <span class="comment">     * The path to the context always starting from the system context</span>
<a name="l5059"><span class="linenum">5059</span></a>  <span class="comment">     * Can be accessed publicly through $context-&gt;path</span>
<a name="l5060"><span class="linenum">5060</span></a>  <span class="comment">     * @var string</span>
<a name="l5061"><span class="linenum">5061</span></a>  <span class="comment">     */</span>
<a name="l5062"><span class="linenum">5062</span></a>      protected <a class="var it8827" onMouseOver="hilite(8827)" onMouseOut="lolite()" onClick="logVariable('_path')" href="../_variables/_path.html">$_path</a>;
<a name="l5063"><span class="linenum">5063</span></a>  
<a name="l5064"><span class="linenum">5064</span></a>      <span class="comment">/**</span>
<a name="l5065"><span class="linenum">5065</span></a>  <span class="comment">     * The depth of the context in relation to parent contexts</span>
<a name="l5066"><span class="linenum">5066</span></a>  <span class="comment">     * Can be accessed publicly through $context-&gt;depth</span>
<a name="l5067"><span class="linenum">5067</span></a>  <span class="comment">     * @var int</span>
<a name="l5068"><span class="linenum">5068</span></a>  <span class="comment">     */</span>
<a name="l5069"><span class="linenum">5069</span></a>      protected <a class="var it28895" onMouseOver="hilite(28895)" onMouseOut="lolite()" onClick="logVariable('_depth')" href="../_variables/_depth.html">$_depth</a>;
<a name="l5070"><span class="linenum">5070</span></a>  
<a name="l5071"><span class="linenum">5071</span></a>      <span class="comment">/**</span>
<a name="l5072"><span class="linenum">5072</span></a>  <span class="comment">     * @var array Context caching info</span>
<a name="l5073"><span class="linenum">5073</span></a>  <span class="comment">     */</span>
<a name="l5074"><span class="linenum">5074</span></a>      private static <a class="var it28896" onMouseOver="hilite(28896)" onMouseOut="lolite()" onClick="logVariable('cache_contextsbyid')" href="../_variables/cache_contextsbyid.html">$cache_contextsbyid</a> = array();
<a name="l5075"><span class="linenum">5075</span></a>  
<a name="l5076"><span class="linenum">5076</span></a>      <span class="comment">/**</span>
<a name="l5077"><span class="linenum">5077</span></a>  <span class="comment">     * @var array Context caching info</span>
<a name="l5078"><span class="linenum">5078</span></a>  <span class="comment">     */</span>
<a name="l5079"><span class="linenum">5079</span></a>      private static <a class="var it28897" onMouseOver="hilite(28897)" onMouseOut="lolite()" onClick="logVariable('cache_contexts')" href="../_variables/cache_contexts.html">$cache_contexts</a>     = array();
<a name="l5080"><span class="linenum">5080</span></a>  
<a name="l5081"><span class="linenum">5081</span></a>      <span class="comment">/**</span>
<a name="l5082"><span class="linenum">5082</span></a>  <span class="comment">     * Context count</span>
<a name="l5083"><span class="linenum">5083</span></a>  <span class="comment">     * Why do we do count contexts? Because count($array) is horribly slow for large arrays</span>
<a name="l5084"><span class="linenum">5084</span></a>  <span class="comment">     * @var int</span>
<a name="l5085"><span class="linenum">5085</span></a>  <span class="comment">     */</span>
<a name="l5086"><span class="linenum">5086</span></a>      protected static <a class="var it28898" onMouseOver="hilite(28898)" onMouseOut="lolite()" onClick="logVariable('cache_count')" href="../_variables/cache_count.html">$cache_count</a>      = 0;
<a name="l5087"><span class="linenum">5087</span></a>  
<a name="l5088"><span class="linenum">5088</span></a>      <span class="comment">/**</span>
<a name="l5089"><span class="linenum">5089</span></a>  <span class="comment">     * @var array Context caching info</span>
<a name="l5090"><span class="linenum">5090</span></a>  <span class="comment">     */</span>
<a name="l5091"><span class="linenum">5091</span></a>      protected static <a class="var it28899" onMouseOver="hilite(28899)" onMouseOut="lolite()" onClick="logVariable('cache_preloaded')" href="../_variables/cache_preloaded.html">$cache_preloaded</a>  = array();
<a name="l5092"><span class="linenum">5092</span></a>  
<a name="l5093"><span class="linenum">5093</span></a>      <span class="comment">/**</span>
<a name="l5094"><span class="linenum">5094</span></a>  <span class="comment">     * @var context_system The system context once initialised</span>
<a name="l5095"><span class="linenum">5095</span></a>  <span class="comment">     */</span>
<a name="l5096"><span class="linenum">5096</span></a>      protected static <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('systemcontext')" href="../_variables/systemcontext.html">$systemcontext</a>    = null;
<a name="l5097"><span class="linenum">5097</span></a>  
<a name="l5098"><span class="linenum">5098</span></a>      <span class="comment">/**</span>
<a name="l5099"><span class="linenum">5099</span></a>  <span class="comment">     * Resets the cache to remove all data.</span>
<a name="l5100"><span class="linenum">5100</span></a>  <span class="comment">     * @static</span>
<a name="l5101"><span class="linenum">5101</span></a>  <span class="comment">     */</span>
<a name="l5102"><span class="linenum">5102</span></a>      protected static function <a class="function" onClick="logFunction('reset_caches')" href="../_functions/reset_caches.html" onMouseOver="funcPopup(event,'reset_caches')">reset_caches</a>() {
<a name="l5103"><span class="linenum">5103</span></a>          self::<a class="var it28896" onMouseOver="hilite(28896)" onMouseOut="lolite()" onClick="logVariable('cache_contextsbyid')" href="../_variables/cache_contextsbyid.html">$cache_contextsbyid</a> = array();
<a name="l5104"><span class="linenum">5104</span></a>          self::<a class="var it28897" onMouseOver="hilite(28897)" onMouseOut="lolite()" onClick="logVariable('cache_contexts')" href="../_variables/cache_contexts.html">$cache_contexts</a>     = array();
<a name="l5105"><span class="linenum">5105</span></a>          self::<a class="var it28898" onMouseOver="hilite(28898)" onMouseOut="lolite()" onClick="logVariable('cache_count')" href="../_variables/cache_count.html">$cache_count</a>        = 0;
<a name="l5106"><span class="linenum">5106</span></a>          self::<a class="var it28899" onMouseOver="hilite(28899)" onMouseOut="lolite()" onClick="logVariable('cache_preloaded')" href="../_variables/cache_preloaded.html">$cache_preloaded</a>    = array();
<a name="l5107"><span class="linenum">5107</span></a>  
<a name="l5108"><span class="linenum">5108</span></a>          self::<a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('systemcontext')" href="../_variables/systemcontext.html">$systemcontext</a> = null;
<a name="l5109"><span class="linenum">5109</span></a>      }
<a name="l5110"><span class="linenum">5110</span></a>  
<a name="l5111"><span class="linenum">5111</span></a>      <span class="comment">/**</span>
<a name="l5112"><span class="linenum">5112</span></a>  <span class="comment">     * Adds a context to the cache. If the cache is full, discards a batch of</span>
<a name="l5113"><span class="linenum">5113</span></a>  <span class="comment">     * older entries.</span>
<a name="l5114"><span class="linenum">5114</span></a>  <span class="comment">     *</span>
<a name="l5115"><span class="linenum">5115</span></a>  <span class="comment">     * @static</span>
<a name="l5116"><span class="linenum">5116</span></a>  <span class="comment">     * @param context $context New context to add</span>
<a name="l5117"><span class="linenum">5117</span></a>  <span class="comment">     * @return void</span>
<a name="l5118"><span class="linenum">5118</span></a>  <span class="comment">     */</span>
<a name="l5119"><span class="linenum">5119</span></a>      protected static function <a class="function" onClick="logFunction('cache_add')" href="../_functions/cache_add.html" onMouseOver="funcPopup(event,'cache_add')">cache_add</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l5120"><span class="linenum">5120</span></a>          if (isset(self::<a class="var it28896" onMouseOver="hilite(28896)" onMouseOut="lolite()" onClick="logVariable('cache_contextsbyid')" href="../_variables/cache_contextsbyid.html">$cache_contextsbyid</a>[<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>])) {
<a name="l5121"><span class="linenum">5121</span></a>  <span class="comment">            // already cached, no need to do anything - this is relatively cheap, we do all this because count() is slow</span>
<a name="l5122"><span class="linenum">5122</span></a>              return;
<a name="l5123"><span class="linenum">5123</span></a>          }
<a name="l5124"><span class="linenum">5124</span></a>  
<a name="l5125"><span class="linenum">5125</span></a>          if (self::<a class="var it28898" onMouseOver="hilite(28898)" onMouseOut="lolite()" onClick="logVariable('cache_count')" href="../_variables/cache_count.html">$cache_count</a> &gt;= <a class="constant" onClick="logConstant('CONTEXT_CACHE_MAX_SIZE')" href="../_constants/CONTEXT_CACHE_MAX_SIZE.html" onMouseOver="constPopup(event,'CONTEXT_CACHE_MAX_SIZE')">CONTEXT_CACHE_MAX_SIZE</a>) {
<a name="l5126"><span class="linenum">5126</span></a>              <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a> = 0;
<a name="l5127"><span class="linenum">5127</span></a>              foreach(self::<a class="var it28896" onMouseOver="hilite(28896)" onMouseOut="lolite()" onClick="logVariable('cache_contextsbyid')" href="../_variables/cache_contextsbyid.html">$cache_contextsbyid</a> as <a class="var it331" onMouseOver="hilite(331)" onMouseOut="lolite()" onClick="logVariable('ctx')" href="../_variables/ctx.html">$ctx</a>) {
<a name="l5128"><span class="linenum">5128</span></a>                  <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a>++;
<a name="l5129"><span class="linenum">5129</span></a>                  if (<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a> &lt;= 100) {
<a name="l5130"><span class="linenum">5130</span></a>  <span class="comment">                    // we want to keep the first contexts to be loaded on this page, hopefully they will be needed again later</span>
<a name="l5131"><span class="linenum">5131</span></a>                      continue;
<a name="l5132"><span class="linenum">5132</span></a>                  }
<a name="l5133"><span class="linenum">5133</span></a>                  if (<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('i')" href="../_variables/i.html">$i</a> &gt; (<a class="constant" onClick="logConstant('CONTEXT_CACHE_MAX_SIZE')" href="../_constants/CONTEXT_CACHE_MAX_SIZE.html" onMouseOver="constPopup(event,'CONTEXT_CACHE_MAX_SIZE')">CONTEXT_CACHE_MAX_SIZE</a> / 3)) {
<a name="l5134"><span class="linenum">5134</span></a>  <span class="comment">                    // we remove oldest third of the contexts to make room for more contexts</span>
<a name="l5135"><span class="linenum">5135</span></a>                      break;
<a name="l5136"><span class="linenum">5136</span></a>                  }
<a name="l5137"><span class="linenum">5137</span></a>                  unset(self::<a class="var it28896" onMouseOver="hilite(28896)" onMouseOut="lolite()" onClick="logVariable('cache_contextsbyid')" href="../_variables/cache_contextsbyid.html">$cache_contextsbyid</a>[<a class="var it331" onMouseOver="hilite(331)" onMouseOut="lolite()" onClick="logVariable('ctx')" href="../_variables/ctx.html">$ctx</a>-&gt;<a onClick="logVariable('id')" class="var it39843" onMouseOver="hilite(39843)" onMouseOut="lolite()" href="../_variables/id.html">id</a>]);
<a name="l5138"><span class="linenum">5138</span></a>                  unset(self::<a class="var it28897" onMouseOver="hilite(28897)" onMouseOut="lolite()" onClick="logVariable('cache_contexts')" href="../_variables/cache_contexts.html">$cache_contexts</a>[<a class="var it331" onMouseOver="hilite(331)" onMouseOut="lolite()" onClick="logVariable('ctx')" href="../_variables/ctx.html">$ctx</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39843" onMouseOver="hilite(39843)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a>][<a class="var it331" onMouseOver="hilite(331)" onMouseOut="lolite()" onClick="logVariable('ctx')" href="../_variables/ctx.html">$ctx</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39843" onMouseOver="hilite(39843)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>]);
<a name="l5139"><span class="linenum">5139</span></a>                  self::<a class="var it28898" onMouseOver="hilite(28898)" onMouseOut="lolite()" onClick="logVariable('cache_count')" href="../_variables/cache_count.html">$cache_count</a>--;
<a name="l5140"><span class="linenum">5140</span></a>              }
<a name="l5141"><span class="linenum">5141</span></a>          }
<a name="l5142"><span class="linenum">5142</span></a>  
<a name="l5143"><span class="linenum">5143</span></a>          self::<a class="var it28897" onMouseOver="hilite(28897)" onMouseOut="lolite()" onClick="logVariable('cache_contexts')" href="../_variables/cache_contexts.html">$cache_contexts</a>[<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a>][<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>] = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>;
<a name="l5144"><span class="linenum">5144</span></a>          self::<a class="var it28896" onMouseOver="hilite(28896)" onMouseOut="lolite()" onClick="logVariable('cache_contextsbyid')" href="../_variables/cache_contextsbyid.html">$cache_contextsbyid</a>[<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>;
<a name="l5145"><span class="linenum">5145</span></a>          self::<a class="var it28898" onMouseOver="hilite(28898)" onMouseOut="lolite()" onClick="logVariable('cache_count')" href="../_variables/cache_count.html">$cache_count</a>++;
<a name="l5146"><span class="linenum">5146</span></a>      }
<a name="l5147"><span class="linenum">5147</span></a>  
<a name="l5148"><span class="linenum">5148</span></a>      <span class="comment">/**</span>
<a name="l5149"><span class="linenum">5149</span></a>  <span class="comment">     * Removes a context from the cache.</span>
<a name="l5150"><span class="linenum">5150</span></a>  <span class="comment">     *</span>
<a name="l5151"><span class="linenum">5151</span></a>  <span class="comment">     * @static</span>
<a name="l5152"><span class="linenum">5152</span></a>  <span class="comment">     * @param context $context Context object to remove</span>
<a name="l5153"><span class="linenum">5153</span></a>  <span class="comment">     * @return void</span>
<a name="l5154"><span class="linenum">5154</span></a>  <span class="comment">     */</span>
<a name="l5155"><span class="linenum">5155</span></a>      protected static function <a class="function" onClick="logFunction('cache_remove')" href="../_functions/cache_remove.html" onMouseOver="funcPopup(event,'cache_remove')">cache_remove</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l5156"><span class="linenum">5156</span></a>          if (!isset(self::<a class="var it28896" onMouseOver="hilite(28896)" onMouseOut="lolite()" onClick="logVariable('cache_contextsbyid')" href="../_variables/cache_contextsbyid.html">$cache_contextsbyid</a>[<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>])) {
<a name="l5157"><span class="linenum">5157</span></a>  <span class="comment">            // not cached, no need to do anything - this is relatively cheap, we do all this because count() is slow</span>
<a name="l5158"><span class="linenum">5158</span></a>              return;
<a name="l5159"><span class="linenum">5159</span></a>          }
<a name="l5160"><span class="linenum">5160</span></a>          unset(self::<a class="var it28897" onMouseOver="hilite(28897)" onMouseOut="lolite()" onClick="logVariable('cache_contexts')" href="../_variables/cache_contexts.html">$cache_contexts</a>[<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a>][<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>]);
<a name="l5161"><span class="linenum">5161</span></a>          unset(self::<a class="var it28896" onMouseOver="hilite(28896)" onMouseOut="lolite()" onClick="logVariable('cache_contextsbyid')" href="../_variables/cache_contextsbyid.html">$cache_contextsbyid</a>[<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>]);
<a name="l5162"><span class="linenum">5162</span></a>  
<a name="l5163"><span class="linenum">5163</span></a>          self::<a class="var it28898" onMouseOver="hilite(28898)" onMouseOut="lolite()" onClick="logVariable('cache_count')" href="../_variables/cache_count.html">$cache_count</a>--;
<a name="l5164"><span class="linenum">5164</span></a>  
<a name="l5165"><span class="linenum">5165</span></a>          if (self::<a class="var it28898" onMouseOver="hilite(28898)" onMouseOut="lolite()" onClick="logVariable('cache_count')" href="../_variables/cache_count.html">$cache_count</a> &lt; 0) {
<a name="l5166"><span class="linenum">5166</span></a>              self::<a class="var it28898" onMouseOver="hilite(28898)" onMouseOut="lolite()" onClick="logVariable('cache_count')" href="../_variables/cache_count.html">$cache_count</a> = 0;
<a name="l5167"><span class="linenum">5167</span></a>          }
<a name="l5168"><span class="linenum">5168</span></a>      }
<a name="l5169"><span class="linenum">5169</span></a>  
<a name="l5170"><span class="linenum">5170</span></a>      <span class="comment">/**</span>
<a name="l5171"><span class="linenum">5171</span></a>  <span class="comment">     * Gets a context from the cache.</span>
<a name="l5172"><span class="linenum">5172</span></a>  <span class="comment">     *</span>
<a name="l5173"><span class="linenum">5173</span></a>  <span class="comment">     * @static</span>
<a name="l5174"><span class="linenum">5174</span></a>  <span class="comment">     * @param int $contextlevel Context level</span>
<a name="l5175"><span class="linenum">5175</span></a>  <span class="comment">     * @param int $instance Instance ID</span>
<a name="l5176"><span class="linenum">5176</span></a>  <span class="comment">     * @return context|bool Context or false if not in cache</span>
<a name="l5177"><span class="linenum">5177</span></a>  <span class="comment">     */</span>
<a name="l5178"><span class="linenum">5178</span></a>      protected static function <a class="function" onClick="logFunction('cache_get')" href="../_functions/cache_get.html" onMouseOver="funcPopup(event,'cache_get')">cache_get</a>(<a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../_variables/contextlevel.html">$contextlevel</a>, <a class="var it528" onMouseOver="hilite(528)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>) {
<a name="l5179"><span class="linenum">5179</span></a>          if (isset(self::<a class="var it28897" onMouseOver="hilite(28897)" onMouseOut="lolite()" onClick="logVariable('cache_contexts')" href="../_variables/cache_contexts.html">$cache_contexts</a>[<a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../_variables/contextlevel.html">$contextlevel</a>][<a class="var it528" onMouseOver="hilite(528)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>])) {
<a name="l5180"><span class="linenum">5180</span></a>              return self::<a class="var it28897" onMouseOver="hilite(28897)" onMouseOut="lolite()" onClick="logVariable('cache_contexts')" href="../_variables/cache_contexts.html">$cache_contexts</a>[<a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../_variables/contextlevel.html">$contextlevel</a>][<a class="var it528" onMouseOver="hilite(528)" onMouseOut="lolite()" onClick="logVariable('instance')" href="../_variables/instance.html">$instance</a>];
<a name="l5181"><span class="linenum">5181</span></a>          }
<a name="l5182"><span class="linenum">5182</span></a>          return false;
<a name="l5183"><span class="linenum">5183</span></a>      }
<a name="l5184"><span class="linenum">5184</span></a>  
<a name="l5185"><span class="linenum">5185</span></a>      <span class="comment">/**</span>
<a name="l5186"><span class="linenum">5186</span></a>  <span class="comment">     * Gets a context from the cache based on its id.</span>
<a name="l5187"><span class="linenum">5187</span></a>  <span class="comment">     *</span>
<a name="l5188"><span class="linenum">5188</span></a>  <span class="comment">     * @static</span>
<a name="l5189"><span class="linenum">5189</span></a>  <span class="comment">     * @param int $id Context ID</span>
<a name="l5190"><span class="linenum">5190</span></a>  <span class="comment">     * @return context|bool Context or false if not in cache</span>
<a name="l5191"><span class="linenum">5191</span></a>  <span class="comment">     */</span>
<a name="l5192"><span class="linenum">5192</span></a>      protected static function <a class="function" onClick="logFunction('cache_get_by_id')" href="../_functions/cache_get_by_id.html" onMouseOver="funcPopup(event,'cache_get_by_id')">cache_get_by_id</a>(<a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>) {
<a name="l5193"><span class="linenum">5193</span></a>          if (isset(self::<a class="var it28896" onMouseOver="hilite(28896)" onMouseOut="lolite()" onClick="logVariable('cache_contextsbyid')" href="../_variables/cache_contextsbyid.html">$cache_contextsbyid</a>[<a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>])) {
<a name="l5194"><span class="linenum">5194</span></a>              return self::<a class="var it28896" onMouseOver="hilite(28896)" onMouseOut="lolite()" onClick="logVariable('cache_contextsbyid')" href="../_variables/cache_contextsbyid.html">$cache_contextsbyid</a>[<a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>];
<a name="l5195"><span class="linenum">5195</span></a>          }
<a name="l5196"><span class="linenum">5196</span></a>          return false;
<a name="l5197"><span class="linenum">5197</span></a>      }
<a name="l5198"><span class="linenum">5198</span></a>  
<a name="l5199"><span class="linenum">5199</span></a>      <span class="comment">/**</span>
<a name="l5200"><span class="linenum">5200</span></a>  <span class="comment">     * Preloads context information from db record and strips the cached info.</span>
<a name="l5201"><span class="linenum">5201</span></a>  <span class="comment">     *</span>
<a name="l5202"><span class="linenum">5202</span></a>  <span class="comment">     * @static</span>
<a name="l5203"><span class="linenum">5203</span></a>  <span class="comment">     * @param stdClass $rec</span>
<a name="l5204"><span class="linenum">5204</span></a>  <span class="comment">     * @return void (modifies $rec)</span>
<a name="l5205"><span class="linenum">5205</span></a>  <span class="comment">     */</span>
<a name="l5206"><span class="linenum">5206</span></a>       protected static function <a class="function" onClick="logFunction('preload_from_record')" href="../_functions/preload_from_record.html" onMouseOver="funcPopup(event,'preload_from_record')">preload_from_record</a>(stdClass <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../_variables/rec.html">$rec</a>) {
<a name="l5207"><span class="linenum">5207</span></a>           if (empty(<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('ctxid')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../_variables/ctxid.html">ctxid</a>) or empty(<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('ctxlevel')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../_variables/ctxlevel.html">ctxlevel</a>) or !isset(<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('ctxinstance')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../_variables/ctxinstance.html">ctxinstance</a>) or empty(<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('ctxpath')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../_variables/ctxpath.html">ctxpath</a>) or empty(<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('ctxdepth')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../_variables/ctxdepth.html">ctxdepth</a>)) {
<a name="l5208"><span class="linenum">5208</span></a>  <span class="comment">             // $rec does not have enough data, passed here repeatedly or context does not exist yet</span>
<a name="l5209"><span class="linenum">5209</span></a>               return;
<a name="l5210"><span class="linenum">5210</span></a>           }
<a name="l5211"><span class="linenum">5211</span></a>  
<a name="l5212"><span class="linenum">5212</span></a>  <span class="comment">         // note: in PHP5 the objects are passed by reference, no need to return $rec</span>
<a name="l5213"><span class="linenum">5213</span></a>           <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = new stdClass();
<a name="l5214"><span class="linenum">5214</span></a>           <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/id.html">id</a>           = <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('ctxid')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../_variables/ctxid.html">ctxid</a>;       unset(<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('ctxid')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../_variables/ctxid.html">ctxid</a>);
<a name="l5215"><span class="linenum">5215</span></a>           <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> = <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('ctxlevel')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../_variables/ctxlevel.html">ctxlevel</a>;    unset(<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('ctxlevel')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../_variables/ctxlevel.html">ctxlevel</a>);
<a name="l5216"><span class="linenum">5216</span></a>           <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>   = <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('ctxinstance')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../_variables/ctxinstance.html">ctxinstance</a>; unset(<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('ctxinstance')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../_variables/ctxinstance.html">ctxinstance</a>);
<a name="l5217"><span class="linenum">5217</span></a>           <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('path')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/path.html">path</a>         = <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('ctxpath')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../_variables/ctxpath.html">ctxpath</a>;     unset(<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('ctxpath')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../_variables/ctxpath.html">ctxpath</a>);
<a name="l5218"><span class="linenum">5218</span></a>           <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('depth')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/depth.html">depth</a>        = <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('ctxdepth')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../_variables/ctxdepth.html">ctxdepth</a>;    unset(<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../_variables/rec.html">$rec</a>-&gt;<a onClick="logVariable('ctxdepth')" class="var it39948" onMouseOver="hilite(39948)" onMouseOut="lolite()" href="../_variables/ctxdepth.html">ctxdepth</a>);
<a name="l5219"><span class="linenum">5219</span></a>  
<a name="l5220"><span class="linenum">5220</span></a>           return context::<a class="function" onClick="logFunction('create_instance_from_record')" href="../_functions/create_instance_from_record.html" onMouseOver="funcPopup(event,'create_instance_from_record')">create_instance_from_record</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l5221"><span class="linenum">5221</span></a>       }
<a name="l5222"><span class="linenum">5222</span></a>  
<a name="l5223"><span class="linenum">5223</span></a>  
<a name="l5224"><span class="linenum">5224</span></a>  <span class="comment">    // ====== magic methods =======</span>
<a name="l5225"><span class="linenum">5225</span></a>  
<a name="l5226"><span class="linenum">5226</span></a>      <span class="comment">/**</span>
<a name="l5227"><span class="linenum">5227</span></a>  <span class="comment">     * Magic setter method, we do not want anybody to modify properties from the outside</span>
<a name="l5228"><span class="linenum">5228</span></a>  <span class="comment">     * @param string $name</span>
<a name="l5229"><span class="linenum">5229</span></a>  <span class="comment">     * @param mixed $value</span>
<a name="l5230"><span class="linenum">5230</span></a>  <span class="comment">     */</span>
<a name="l5231"><span class="linenum">5231</span></a>      public function <a class="function" onClick="logFunction('__set')" href="../_functions/__set.html" onMouseOver="funcPopup(event,'__set')">__set</a>(<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>, <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../_variables/value.html">$value</a>) {
<a name="l5232"><span class="linenum">5232</span></a>          <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Can not change context instance properties!');
<a name="l5233"><span class="linenum">5233</span></a>      }
<a name="l5234"><span class="linenum">5234</span></a>  
<a name="l5235"><span class="linenum">5235</span></a>      <span class="comment">/**</span>
<a name="l5236"><span class="linenum">5236</span></a>  <span class="comment">     * Magic method getter, redirects to read only values.</span>
<a name="l5237"><span class="linenum">5237</span></a>  <span class="comment">     * @param string $name</span>
<a name="l5238"><span class="linenum">5238</span></a>  <span class="comment">     * @return mixed</span>
<a name="l5239"><span class="linenum">5239</span></a>  <span class="comment">     */</span>
<a name="l5240"><span class="linenum">5240</span></a>      public function <a class="function" onClick="logFunction('__get')" href="../_functions/__get.html" onMouseOver="funcPopup(event,'__get')">__get</a>(<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>) {
<a name="l5241"><span class="linenum">5241</span></a>          switch (<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>) {
<a name="l5242"><span class="linenum">5242</span></a>              case 'id':           return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a>;
<a name="l5243"><span class="linenum">5243</span></a>              case 'contextlevel': return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_contextlevel')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_contextlevel.html">_contextlevel</a>;
<a name="l5244"><span class="linenum">5244</span></a>              case 'instanceid':   return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_instanceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_instanceid.html">_instanceid</a>;
<a name="l5245"><span class="linenum">5245</span></a>              case 'path':         return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a>;
<a name="l5246"><span class="linenum">5246</span></a>              case 'depth':        return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_depth')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_depth.html">_depth</a>;
<a name="l5247"><span class="linenum">5247</span></a>  
<a name="l5248"><span class="linenum">5248</span></a>              default:
<a name="l5249"><span class="linenum">5249</span></a>                  <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Invalid context property accessed! '.<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>);
<a name="l5250"><span class="linenum">5250</span></a>                  return null;
<a name="l5251"><span class="linenum">5251</span></a>          }
<a name="l5252"><span class="linenum">5252</span></a>      }
<a name="l5253"><span class="linenum">5253</span></a>  
<a name="l5254"><span class="linenum">5254</span></a>      <span class="comment">/**</span>
<a name="l5255"><span class="linenum">5255</span></a>  <span class="comment">     * Full support for isset on our magic read only properties.</span>
<a name="l5256"><span class="linenum">5256</span></a>  <span class="comment">     * @param string $name</span>
<a name="l5257"><span class="linenum">5257</span></a>  <span class="comment">     * @return bool</span>
<a name="l5258"><span class="linenum">5258</span></a>  <span class="comment">     */</span>
<a name="l5259"><span class="linenum">5259</span></a>      public function <a class="function" onClick="logFunction('__isset')" href="../_functions/__isset.html" onMouseOver="funcPopup(event,'__isset')">__isset</a>(<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>) {
<a name="l5260"><span class="linenum">5260</span></a>          switch (<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>) {
<a name="l5261"><span class="linenum">5261</span></a>              case 'id':           return isset(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a>);
<a name="l5262"><span class="linenum">5262</span></a>              case 'contextlevel': return isset(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_contextlevel')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_contextlevel.html">_contextlevel</a>);
<a name="l5263"><span class="linenum">5263</span></a>              case 'instanceid':   return isset(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_instanceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_instanceid.html">_instanceid</a>);
<a name="l5264"><span class="linenum">5264</span></a>              case 'path':         return isset(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a>);
<a name="l5265"><span class="linenum">5265</span></a>              case 'depth':        return isset(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_depth')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_depth.html">_depth</a>);
<a name="l5266"><span class="linenum">5266</span></a>  
<a name="l5267"><span class="linenum">5267</span></a>              default: return false;
<a name="l5268"><span class="linenum">5268</span></a>          }
<a name="l5269"><span class="linenum">5269</span></a>  
<a name="l5270"><span class="linenum">5270</span></a>      }
<a name="l5271"><span class="linenum">5271</span></a>  
<a name="l5272"><span class="linenum">5272</span></a>      <span class="comment">/**</span>
<a name="l5273"><span class="linenum">5273</span></a>  <span class="comment">     * ALl properties are read only, sorry.</span>
<a name="l5274"><span class="linenum">5274</span></a>  <span class="comment">     * @param string $name</span>
<a name="l5275"><span class="linenum">5275</span></a>  <span class="comment">     */</span>
<a name="l5276"><span class="linenum">5276</span></a>      public function <a class="function" onClick="logFunction('__unset')" href="../_functions/__unset.html" onMouseOver="funcPopup(event,'__unset')">__unset</a>(<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>) {
<a name="l5277"><span class="linenum">5277</span></a>          <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Can not unset context instance properties!');
<a name="l5278"><span class="linenum">5278</span></a>      }
<a name="l5279"><span class="linenum">5279</span></a>  
<a name="l5280"><span class="linenum">5280</span></a>  <span class="comment">    // ====== implementing method from interface IteratorAggregate ======</span>
<a name="l5281"><span class="linenum">5281</span></a>  
<a name="l5282"><span class="linenum">5282</span></a>      <span class="comment">/**</span>
<a name="l5283"><span class="linenum">5283</span></a>  <span class="comment">     * Create an iterator because magic vars can't be seen by 'foreach'.</span>
<a name="l5284"><span class="linenum">5284</span></a>  <span class="comment">     *</span>
<a name="l5285"><span class="linenum">5285</span></a>  <span class="comment">     * Now we can convert context object to array using convert_to_array(),</span>
<a name="l5286"><span class="linenum">5286</span></a>  <span class="comment">     * and feed it properly to json_encode().</span>
<a name="l5287"><span class="linenum">5287</span></a>  <span class="comment">     */</span>
<a name="l5288"><span class="linenum">5288</span></a>      public function <a class="function" onClick="logFunction('getIterator')" href="../_functions/getiterator.html" onMouseOver="funcPopup(event,'getiterator')">getIterator</a>() {
<a name="l5289"><span class="linenum">5289</span></a>          <a class="var it575" onMouseOver="hilite(575)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../_variables/ret.html">$ret</a> = array(
<a name="l5290"><span class="linenum">5290</span></a>              'id'           =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l5291"><span class="linenum">5291</span></a>              'contextlevel' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a>,
<a name="l5292"><span class="linenum">5292</span></a>              'instanceid'   =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>,
<a name="l5293"><span class="linenum">5293</span></a>              'path'         =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/path.html">path</a>,
<a name="l5294"><span class="linenum">5294</span></a>              'depth'        =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;depth
<a name="l5295"><span class="linenum">5295</span></a>          );
<a name="l5296"><span class="linenum">5296</span></a>          return new ArrayIterator(<a class="var it575" onMouseOver="hilite(575)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../_variables/ret.html">$ret</a>);
<a name="l5297"><span class="linenum">5297</span></a>      }
<a name="l5298"><span class="linenum">5298</span></a>  
<a name="l5299"><span class="linenum">5299</span></a>  <span class="comment">    // ====== general context methods ======</span>
<a name="l5300"><span class="linenum">5300</span></a>  
<a name="l5301"><span class="linenum">5301</span></a>      <span class="comment">/**</span>
<a name="l5302"><span class="linenum">5302</span></a>  <span class="comment">     * Constructor is protected so that devs are forced to</span>
<a name="l5303"><span class="linenum">5303</span></a>  <span class="comment">     * use context_xxx::instance() or context::instance_by_id().</span>
<a name="l5304"><span class="linenum">5304</span></a>  <span class="comment">     *</span>
<a name="l5305"><span class="linenum">5305</span></a>  <span class="comment">     * @param stdClass $record</span>
<a name="l5306"><span class="linenum">5306</span></a>  <span class="comment">     */</span>
<a name="l5307"><span class="linenum">5307</span></a>      protected function <a class="function" onClick="logFunction('__construct')" href="../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>(stdClass <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>) {
<a name="l5308"><span class="linenum">5308</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a>           = (int)<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l5309"><span class="linenum">5309</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_contextlevel')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_contextlevel.html">_contextlevel</a> = (int)<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a>;
<a name="l5310"><span class="linenum">5310</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_instanceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_instanceid.html">_instanceid</a>   = <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>;
<a name="l5311"><span class="linenum">5311</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a>         = <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('path')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/path.html">path</a>;
<a name="l5312"><span class="linenum">5312</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_depth')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_depth.html">_depth</a>        = <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('depth')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/depth.html">depth</a>;
<a name="l5313"><span class="linenum">5313</span></a>      }
<a name="l5314"><span class="linenum">5314</span></a>  
<a name="l5315"><span class="linenum">5315</span></a>      <span class="comment">/**</span>
<a name="l5316"><span class="linenum">5316</span></a>  <span class="comment">     * This function is also used to work around 'protected' keyword problems in context_helper.</span>
<a name="l5317"><span class="linenum">5317</span></a>  <span class="comment">     * @static</span>
<a name="l5318"><span class="linenum">5318</span></a>  <span class="comment">     * @param stdClass $record</span>
<a name="l5319"><span class="linenum">5319</span></a>  <span class="comment">     * @return context instance</span>
<a name="l5320"><span class="linenum">5320</span></a>  <span class="comment">     */</span>
<a name="l5321"><span class="linenum">5321</span></a>      protected static function <a class="function" onClick="logFunction('create_instance_from_record')" href="../_functions/create_instance_from_record.html" onMouseOver="funcPopup(event,'create_instance_from_record')">create_instance_from_record</a>(stdClass <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>) {
<a name="l5322"><span class="linenum">5322</span></a>          <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a> = <a class="class" onClick="logClass('context_helper')" href="../_classes/context_helper.html" onMouseOver="classPopup(event,'context_helper')">context_helper</a>::<a class="function" onClick="logFunction('get_class_for_level')" href="../_functions/get_class_for_level.html" onMouseOver="funcPopup(event,'get_class_for_level')">get_class_for_level</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a>);
<a name="l5323"><span class="linenum">5323</span></a>  
<a name="l5324"><span class="linenum">5324</span></a>          if (<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = context::<a class="function" onClick="logFunction('cache_get_by_id')" href="../_functions/cache_get_by_id.html" onMouseOver="funcPopup(event,'cache_get_by_id')">cache_get_by_id</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/id.html">id</a>)) {
<a name="l5325"><span class="linenum">5325</span></a>              return <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>;
<a name="l5326"><span class="linenum">5326</span></a>          }
<a name="l5327"><span class="linenum">5327</span></a>  
<a name="l5328"><span class="linenum">5328</span></a>          <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = new <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l5329"><span class="linenum">5329</span></a>          context::<a class="function" onClick="logFunction('cache_add')" href="../_functions/cache_add.html" onMouseOver="funcPopup(event,'cache_add')">cache_add</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l5330"><span class="linenum">5330</span></a>  
<a name="l5331"><span class="linenum">5331</span></a>          return <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>;
<a name="l5332"><span class="linenum">5332</span></a>      }
<a name="l5333"><span class="linenum">5333</span></a>  
<a name="l5334"><span class="linenum">5334</span></a>      <span class="comment">/**</span>
<a name="l5335"><span class="linenum">5335</span></a>  <span class="comment">     * Copy prepared new contexts from temp table to context table,</span>
<a name="l5336"><span class="linenum">5336</span></a>  <span class="comment">     * we do this in db specific way for perf reasons only.</span>
<a name="l5337"><span class="linenum">5337</span></a>  <span class="comment">     * @static</span>
<a name="l5338"><span class="linenum">5338</span></a>  <span class="comment">     */</span>
<a name="l5339"><span class="linenum">5339</span></a>      protected static function <a class="function" onClick="logFunction('merge_context_temp_table')" href="../_functions/merge_context_temp_table.html" onMouseOver="funcPopup(event,'merge_context_temp_table')">merge_context_temp_table</a>() {
<a name="l5340"><span class="linenum">5340</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l5341"><span class="linenum">5341</span></a>  
<a name="l5342"><span class="linenum">5342</span></a>          <span class="comment">/* MDL-11347:</span>
<a name="l5343"><span class="linenum">5343</span></a>  <span class="comment">         *  - mysql does not allow to use FROM in UPDATE statements</span>
<a name="l5344"><span class="linenum">5344</span></a>  <span class="comment">         *  - using two tables after UPDATE works in mysql, but might give unexpected</span>
<a name="l5345"><span class="linenum">5345</span></a>  <span class="comment">         *    results in pg 8 (depends on configuration)</span>
<a name="l5346"><span class="linenum">5346</span></a>  <span class="comment">         *  - using table alias in UPDATE does not work in pg &lt; 8.2</span>
<a name="l5347"><span class="linenum">5347</span></a>  <span class="comment">         *</span>
<a name="l5348"><span class="linenum">5348</span></a>  <span class="comment">         * Different code for each database - mostly for performance reasons</span>
<a name="l5349"><span class="linenum">5349</span></a>  <span class="comment">         */</span>
<a name="l5350"><span class="linenum">5350</span></a>  
<a name="l5351"><span class="linenum">5351</span></a>          <a class="var it18192" onMouseOver="hilite(18192)" onMouseOut="lolite()" onClick="logVariable('dbfamily')" href="../_variables/dbfamily.html">$dbfamily</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_dbfamily')" href="../_functions/get_dbfamily.html" onMouseOver="funcPopup(event,'get_dbfamily')">get_dbfamily</a>();
<a name="l5352"><span class="linenum">5352</span></a>          if (<a class="var it18192" onMouseOver="hilite(18192)" onMouseOut="lolite()" onClick="logVariable('dbfamily')" href="../_variables/dbfamily.html">$dbfamily</a> == 'mysql') {
<a name="l5353"><span class="linenum">5353</span></a>              <a class="var it13017" onMouseOver="hilite(13017)" onMouseOut="lolite()" onClick="logVariable('updatesql')" href="../_variables/updatesql.html">$updatesql</a> = &quot;UPDATE {context} ct, {context_temp} temp
<a name="l5354"><span class="linenum">5354</span></a>                               SET ct.path     = temp.path,
<a name="l5355"><span class="linenum">5355</span></a>                                   ct.depth    = temp.depth
<a name="l5356"><span class="linenum">5356</span></a>                             WHERE ct.id = temp.id&quot;;
<a name="l5357"><span class="linenum">5357</span></a>          } else if (<a class="var it18192" onMouseOver="hilite(18192)" onMouseOut="lolite()" onClick="logVariable('dbfamily')" href="../_variables/dbfamily.html">$dbfamily</a> == 'oracle') {
<a name="l5358"><span class="linenum">5358</span></a>              <a class="var it13017" onMouseOver="hilite(13017)" onMouseOut="lolite()" onClick="logVariable('updatesql')" href="../_variables/updatesql.html">$updatesql</a> = &quot;UPDATE {context} ct
<a name="l5359"><span class="linenum">5359</span></a>                               <a class="function" onClick="logFunction('SET')" href="../_functions/set.html" onMouseOver="funcPopup(event,'set')">SET</a> (ct.path, ct.depth) =
<a name="l5360"><span class="linenum">5360</span></a>                                   (SELECT temp.path, temp.depth
<a name="l5361"><span class="linenum">5361</span></a>                                      FROM {context_temp} temp
<a name="l5362"><span class="linenum">5362</span></a>                                     WHERE temp.id=ct.id)
<a name="l5363"><span class="linenum">5363</span></a>                             WHERE <a class="function" onClick="logFunction('EXISTS')" href="../_functions/exists.html" onMouseOver="funcPopup(event,'exists')">EXISTS</a> (SELECT 'x'
<a name="l5364"><span class="linenum">5364</span></a>                                             FROM {context_temp} temp
<a name="l5365"><span class="linenum">5365</span></a>                                             WHERE temp.id = ct.id)&quot;;
<a name="l5366"><span class="linenum">5366</span></a>          } else if (<a class="var it18192" onMouseOver="hilite(18192)" onMouseOut="lolite()" onClick="logVariable('dbfamily')" href="../_variables/dbfamily.html">$dbfamily</a> == 'postgres' or <a class="var it18192" onMouseOver="hilite(18192)" onMouseOut="lolite()" onClick="logVariable('dbfamily')" href="../_variables/dbfamily.html">$dbfamily</a> == 'mssql') {
<a name="l5367"><span class="linenum">5367</span></a>              <a class="var it13017" onMouseOver="hilite(13017)" onMouseOut="lolite()" onClick="logVariable('updatesql')" href="../_variables/updatesql.html">$updatesql</a> = &quot;UPDATE {context}
<a name="l5368"><span class="linenum">5368</span></a>                               SET path     = temp.path,
<a name="l5369"><span class="linenum">5369</span></a>                                   depth    = temp.depth
<a name="l5370"><span class="linenum">5370</span></a>                              FROM {context_temp} temp
<a name="l5371"><span class="linenum">5371</span></a>                             WHERE temp.id={context}.id&quot;;
<a name="l5372"><span class="linenum">5372</span></a>          } else {
<a name="l5373"><span class="linenum">5373</span></a>  <span class="comment">            // sqlite and others</span>
<a name="l5374"><span class="linenum">5374</span></a>              <a class="var it13017" onMouseOver="hilite(13017)" onMouseOut="lolite()" onClick="logVariable('updatesql')" href="../_variables/updatesql.html">$updatesql</a> = &quot;UPDATE {context}
<a name="l5375"><span class="linenum">5375</span></a>                               SET path     = (SELECT path FROM {context_temp} WHERE id = {context}.id),
<a name="l5376"><span class="linenum">5376</span></a>                                   depth    = (SELECT depth FROM {context_temp} WHERE id = {context}.id)
<a name="l5377"><span class="linenum">5377</span></a>                               WHERE id IN (SELECT id FROM {context_temp})&quot;;
<a name="l5378"><span class="linenum">5378</span></a>          }
<a name="l5379"><span class="linenum">5379</span></a>  
<a name="l5380"><span class="linenum">5380</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it13017" onMouseOver="hilite(13017)" onMouseOut="lolite()" onClick="logVariable('updatesql')" href="../_variables/updatesql.html">$updatesql</a>);
<a name="l5381"><span class="linenum">5381</span></a>      }
<a name="l5382"><span class="linenum">5382</span></a>  
<a name="l5383"><span class="linenum">5383</span></a>     <span class="comment">/**</span>
<a name="l5384"><span class="linenum">5384</span></a>  <span class="comment">    * Get a context instance as an object, from a given context id.</span>
<a name="l5385"><span class="linenum">5385</span></a>  <span class="comment">    *</span>
<a name="l5386"><span class="linenum">5386</span></a>  <span class="comment">    * @static</span>
<a name="l5387"><span class="linenum">5387</span></a>  <span class="comment">    * @param int $id context id</span>
<a name="l5388"><span class="linenum">5388</span></a>  <span class="comment">    * @param int $strictness IGNORE_MISSING means compatible mode, false returned if record not found, debug message if more found;</span>
<a name="l5389"><span class="linenum">5389</span></a>  <span class="comment">    *                        MUST_EXIST means throw exception if no record found</span>
<a name="l5390"><span class="linenum">5390</span></a>  <span class="comment">    * @return context|bool the context object or false if not found</span>
<a name="l5391"><span class="linenum">5391</span></a>  <span class="comment">    */</span>
<a name="l5392"><span class="linenum">5392</span></a>      public static function <a class="function" onClick="logFunction('instance_by_id')" href="../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>(<a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>, <a class="var it4662" onMouseOver="hilite(4662)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a> = <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>) {
<a name="l5393"><span class="linenum">5393</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l5394"><span class="linenum">5394</span></a>  
<a name="l5395"><span class="linenum">5395</span></a>          if (get_called_class() !== 'context' and get_called_class() !== 'context_helper') {
<a name="l5396"><span class="linenum">5396</span></a>  <span class="comment">            // some devs might confuse context-&gt;id and instanceid, better prevent these mistakes completely</span>
<a name="l5397"><span class="linenum">5397</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('use only context::<a class="function" onClick="logFunction('instance_by_id')" href="../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>() for real context levels use ::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>() methods');
<a name="l5398"><span class="linenum">5398</span></a>          }
<a name="l5399"><span class="linenum">5399</span></a>  
<a name="l5400"><span class="linenum">5400</span></a>          if (<a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a> == <a class="constant" onClick="logConstant('SYSCONTEXTID')" href="../_constants/SYSCONTEXTID.html" onMouseOver="constPopup(event,'SYSCONTEXTID')">SYSCONTEXTID</a>) {
<a name="l5401"><span class="linenum">5401</span></a>              return <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(0, <a class="var it4662" onMouseOver="hilite(4662)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a>);
<a name="l5402"><span class="linenum">5402</span></a>          }
<a name="l5403"><span class="linenum">5403</span></a>  
<a name="l5404"><span class="linenum">5404</span></a>          if (<a class="phpfunction" onClick="logFunction('is_array')" href="../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>) or <a class="phpfunction" onClick="logFunction('is_object')" href="../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>) or empty(<a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>)) {
<a name="l5405"><span class="linenum">5405</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid context id specified context::<a class="function" onClick="logFunction('instance_by_id')" href="../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>()');
<a name="l5406"><span class="linenum">5406</span></a>          }
<a name="l5407"><span class="linenum">5407</span></a>  
<a name="l5408"><span class="linenum">5408</span></a>          if (<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = context::<a class="function" onClick="logFunction('cache_get_by_id')" href="../_functions/cache_get_by_id.html" onMouseOver="funcPopup(event,'cache_get_by_id')">cache_get_by_id</a>(<a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>)) {
<a name="l5409"><span class="linenum">5409</span></a>              return <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>;
<a name="l5410"><span class="linenum">5410</span></a>          }
<a name="l5411"><span class="linenum">5411</span></a>  
<a name="l5412"><span class="linenum">5412</span></a>          if (<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('context', array('id'=&gt;<a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a>), '*', <a class="var it4662" onMouseOver="hilite(4662)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a>)) {
<a name="l5413"><span class="linenum">5413</span></a>              return context::<a class="function" onClick="logFunction('create_instance_from_record')" href="../_functions/create_instance_from_record.html" onMouseOver="funcPopup(event,'create_instance_from_record')">create_instance_from_record</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l5414"><span class="linenum">5414</span></a>          }
<a name="l5415"><span class="linenum">5415</span></a>  
<a name="l5416"><span class="linenum">5416</span></a>          return false;
<a name="l5417"><span class="linenum">5417</span></a>      }
<a name="l5418"><span class="linenum">5418</span></a>  
<a name="l5419"><span class="linenum">5419</span></a>      <span class="comment">/**</span>
<a name="l5420"><span class="linenum">5420</span></a>  <span class="comment">     * Update context info after moving context in the tree structure.</span>
<a name="l5421"><span class="linenum">5421</span></a>  <span class="comment">     *</span>
<a name="l5422"><span class="linenum">5422</span></a>  <span class="comment">     * @param context $newparent</span>
<a name="l5423"><span class="linenum">5423</span></a>  <span class="comment">     * @return void</span>
<a name="l5424"><span class="linenum">5424</span></a>  <span class="comment">     */</span>
<a name="l5425"><span class="linenum">5425</span></a>      public function <a class="function" onClick="logFunction('update_moved')" href="../_functions/update_moved.html" onMouseOver="funcPopup(event,'update_moved')">update_moved</a>(context <a class="var it10840" onMouseOver="hilite(10840)" onMouseOut="lolite()" onClick="logVariable('newparent')" href="../_variables/newparent.html">$newparent</a>) {
<a name="l5426"><span class="linenum">5426</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l5427"><span class="linenum">5427</span></a>  
<a name="l5428"><span class="linenum">5428</span></a>          <a class="var it28904" onMouseOver="hilite(28904)" onMouseOut="lolite()" onClick="logVariable('frompath')" href="../_variables/frompath.html">$frompath</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a>;
<a name="l5429"><span class="linenum">5429</span></a>          <a class="var it16794" onMouseOver="hilite(16794)" onMouseOut="lolite()" onClick="logVariable('newpath')" href="../_variables/newpath.html">$newpath</a>  = <a class="var it10840" onMouseOver="hilite(10840)" onMouseOut="lolite()" onClick="logVariable('newparent')" href="../_variables/newparent.html">$newparent</a>-&gt;<a onClick="logVariable('path')" class="var it40988" onMouseOver="hilite(40988)" onMouseOut="lolite()" href="../_variables/path.html">path</a> . '/' . <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a>;
<a name="l5430"><span class="linenum">5430</span></a>  
<a name="l5431"><span class="linenum">5431</span></a>          <a class="var it24866" onMouseOver="hilite(24866)" onMouseOut="lolite()" onClick="logVariable('trans')" href="../_variables/trans.html">$trans</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l5432"><span class="linenum">5432</span></a>  
<a name="l5433"><span class="linenum">5433</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('mark_dirty')" href="../_functions/mark_dirty.html" onMouseOver="funcPopup(event,'mark_dirty')">mark_dirty</a>();
<a name="l5434"><span class="linenum">5434</span></a>  
<a name="l5435"><span class="linenum">5435</span></a>          <a class="var it28905" onMouseOver="hilite(28905)" onMouseOut="lolite()" onClick="logVariable('setdepth')" href="../_variables/setdepth.html">$setdepth</a> = '';
<a name="l5436"><span class="linenum">5436</span></a>          if ((<a class="var it10840" onMouseOver="hilite(10840)" onMouseOut="lolite()" onClick="logVariable('newparent')" href="../_variables/newparent.html">$newparent</a>-&gt;<a onClick="logVariable('depth')" class="var it40988" onMouseOver="hilite(40988)" onMouseOut="lolite()" href="../_variables/depth.html">depth</a> +1) != <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_depth')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_depth.html">_depth</a>) {
<a name="l5437"><span class="linenum">5437</span></a>              <a class="var it538" onMouseOver="hilite(538)" onMouseOut="lolite()" onClick="logVariable('diff')" href="../_variables/diff.html">$diff</a> = <a class="var it10840" onMouseOver="hilite(10840)" onMouseOut="lolite()" onClick="logVariable('newparent')" href="../_variables/newparent.html">$newparent</a>-&gt;<a onClick="logVariable('depth')" class="var it40988" onMouseOver="hilite(40988)" onMouseOut="lolite()" href="../_variables/depth.html">depth</a> - <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_depth')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_depth.html">_depth</a> + 1;
<a name="l5438"><span class="linenum">5438</span></a>              <a class="var it28905" onMouseOver="hilite(28905)" onMouseOut="lolite()" onClick="logVariable('setdepth')" href="../_variables/setdepth.html">$setdepth</a> = &quot;, depth = depth + <a class="var it538" onMouseOver="hilite(538)" onMouseOut="lolite()" onClick="logVariable('diff')" href="../_variables/diff.html">$diff</a>&quot;;
<a name="l5439"><span class="linenum">5439</span></a>          }
<a name="l5440"><span class="linenum">5440</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;UPDATE {context}
<a name="l5441"><span class="linenum">5441</span></a>                     SET path = ?
<a name="l5442"><span class="linenum">5442</span></a>                         <a class="var it28905" onMouseOver="hilite(28905)" onMouseOut="lolite()" onClick="logVariable('setdepth')" href="../_variables/setdepth.html">$setdepth</a>
<a name="l5443"><span class="linenum">5443</span></a>                   WHERE id = ?&quot;;
<a name="l5444"><span class="linenum">5444</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array(<a class="var it16794" onMouseOver="hilite(16794)" onMouseOut="lolite()" onClick="logVariable('newpath')" href="../_variables/newpath.html">$newpath</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a>);
<a name="l5445"><span class="linenum">5445</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l5446"><span class="linenum">5446</span></a>  
<a name="l5447"><span class="linenum">5447</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a>  = <a class="var it16794" onMouseOver="hilite(16794)" onMouseOut="lolite()" onClick="logVariable('newpath')" href="../_variables/newpath.html">$newpath</a>;
<a name="l5448"><span class="linenum">5448</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_depth')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_depth.html">_depth</a> = <a class="var it10840" onMouseOver="hilite(10840)" onMouseOut="lolite()" onClick="logVariable('newparent')" href="../_variables/newparent.html">$newparent</a>-&gt;<a onClick="logVariable('depth')" class="var it40988" onMouseOver="hilite(40988)" onMouseOut="lolite()" href="../_variables/depth.html">depth</a> + 1;
<a name="l5449"><span class="linenum">5449</span></a>  
<a name="l5450"><span class="linenum">5450</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;UPDATE {context}
<a name="l5451"><span class="linenum">5451</span></a>                     SET path = &quot;.<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_concat')" href="../_functions/sql_concat.html" onMouseOver="funcPopup(event,'sql_concat')">sql_concat</a>(&quot;?&quot;, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_substr')" href="../_functions/sql_substr.html" onMouseOver="funcPopup(event,'sql_substr')">sql_substr</a>(&quot;path&quot;, <a class="function" onClick="logFunction('strlen')" href="../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it28904" onMouseOver="hilite(28904)" onMouseOut="lolite()" onClick="logVariable('frompath')" href="../_variables/frompath.html">$frompath</a>)+1)).&quot;
<a name="l5452"><span class="linenum">5452</span></a>                         <a class="var it28905" onMouseOver="hilite(28905)" onMouseOut="lolite()" onClick="logVariable('setdepth')" href="../_variables/setdepth.html">$setdepth</a>
<a name="l5453"><span class="linenum">5453</span></a>                   WHERE path LIKE ?&quot;;
<a name="l5454"><span class="linenum">5454</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array(<a class="var it16794" onMouseOver="hilite(16794)" onMouseOut="lolite()" onClick="logVariable('newpath')" href="../_variables/newpath.html">$newpath</a>, &quot;{<a class="var it28904" onMouseOver="hilite(28904)" onMouseOut="lolite()" onClick="logVariable('frompath')" href="../_variables/frompath.html">$frompath</a>}/%&quot;);
<a name="l5455"><span class="linenum">5455</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l5456"><span class="linenum">5456</span></a>  
<a name="l5457"><span class="linenum">5457</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('mark_dirty')" href="../_functions/mark_dirty.html" onMouseOver="funcPopup(event,'mark_dirty')">mark_dirty</a>();
<a name="l5458"><span class="linenum">5458</span></a>  
<a name="l5459"><span class="linenum">5459</span></a>          context::<a class="function" onClick="logFunction('reset_caches')" href="../_functions/reset_caches.html" onMouseOver="funcPopup(event,'reset_caches')">reset_caches</a>();
<a name="l5460"><span class="linenum">5460</span></a>  
<a name="l5461"><span class="linenum">5461</span></a>          <a class="var it24866" onMouseOver="hilite(24866)" onMouseOut="lolite()" onClick="logVariable('trans')" href="../_variables/trans.html">$trans</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l5462"><span class="linenum">5462</span></a>      }
<a name="l5463"><span class="linenum">5463</span></a>  
<a name="l5464"><span class="linenum">5464</span></a>      <span class="comment">/**</span>
<a name="l5465"><span class="linenum">5465</span></a>  <span class="comment">     * Remove all context path info and optionally rebuild it.</span>
<a name="l5466"><span class="linenum">5466</span></a>  <span class="comment">     *</span>
<a name="l5467"><span class="linenum">5467</span></a>  <span class="comment">     * @param bool $rebuild</span>
<a name="l5468"><span class="linenum">5468</span></a>  <span class="comment">     * @return void</span>
<a name="l5469"><span class="linenum">5469</span></a>  <span class="comment">     */</span>
<a name="l5470"><span class="linenum">5470</span></a>      public function <a class="function" onClick="logFunction('reset_paths')" href="../_functions/reset_paths.html" onMouseOver="funcPopup(event,'reset_paths')">reset_paths</a>(<a class="var it28906" onMouseOver="hilite(28906)" onMouseOut="lolite()" onClick="logVariable('rebuild')" href="../_variables/rebuild.html">$rebuild</a> = true) {
<a name="l5471"><span class="linenum">5471</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l5472"><span class="linenum">5472</span></a>  
<a name="l5473"><span class="linenum">5473</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a>) {
<a name="l5474"><span class="linenum">5474</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('mark_dirty')" href="../_functions/mark_dirty.html" onMouseOver="funcPopup(event,'mark_dirty')">mark_dirty</a>();
<a name="l5475"><span class="linenum">5475</span></a>          }
<a name="l5476"><span class="linenum">5476</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field_select')" href="../_functions/set_field_select.html" onMouseOver="funcPopup(event,'set_field_select')">set_field_select</a>('context', 'depth', 0, &quot;path LIKE '%/<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a>/%'&quot;);
<a name="l5477"><span class="linenum">5477</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field_select')" href="../_functions/set_field_select.html" onMouseOver="funcPopup(event,'set_field_select')">set_field_select</a>('context', 'path', NULL, &quot;path LIKE '%/<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a>/%'&quot;);
<a name="l5478"><span class="linenum">5478</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_contextlevel')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_contextlevel.html">_contextlevel</a> != <a class="constant" onClick="logConstant('CONTEXT_SYSTEM')" href="../_constants/CONTEXT_SYSTEM.html" onMouseOver="constPopup(event,'CONTEXT_SYSTEM')">CONTEXT_SYSTEM</a>) {
<a name="l5479"><span class="linenum">5479</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('context', 'depth', 0, array('id'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a>));
<a name="l5480"><span class="linenum">5480</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('context', 'path', NULL, array('id'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a>));
<a name="l5481"><span class="linenum">5481</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_depth')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_depth.html">_depth</a> = 0;
<a name="l5482"><span class="linenum">5482</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a> = null;
<a name="l5483"><span class="linenum">5483</span></a>          }
<a name="l5484"><span class="linenum">5484</span></a>  
<a name="l5485"><span class="linenum">5485</span></a>          if (<a class="var it28906" onMouseOver="hilite(28906)" onMouseOut="lolite()" onClick="logVariable('rebuild')" href="../_variables/rebuild.html">$rebuild</a>) {
<a name="l5486"><span class="linenum">5486</span></a>              <a class="class" onClick="logClass('context_helper')" href="../_classes/context_helper.html" onMouseOver="classPopup(event,'context_helper')">context_helper</a>::<a class="function" onClick="logFunction('build_all_paths')" href="../_functions/build_all_paths.html" onMouseOver="funcPopup(event,'build_all_paths')">build_all_paths</a>(false);
<a name="l5487"><span class="linenum">5487</span></a>          }
<a name="l5488"><span class="linenum">5488</span></a>  
<a name="l5489"><span class="linenum">5489</span></a>          context::<a class="function" onClick="logFunction('reset_caches')" href="../_functions/reset_caches.html" onMouseOver="funcPopup(event,'reset_caches')">reset_caches</a>();
<a name="l5490"><span class="linenum">5490</span></a>      }
<a name="l5491"><span class="linenum">5491</span></a>  
<a name="l5492"><span class="linenum">5492</span></a>      <span class="comment">/**</span>
<a name="l5493"><span class="linenum">5493</span></a>  <span class="comment">     * Delete all data linked to content, do not delete the context record itself</span>
<a name="l5494"><span class="linenum">5494</span></a>  <span class="comment">     */</span>
<a name="l5495"><span class="linenum">5495</span></a>      public function <a class="function" onClick="logFunction('delete_content')" href="../_functions/delete_content.html" onMouseOver="funcPopup(event,'delete_content')">delete_content</a>() {
<a name="l5496"><span class="linenum">5496</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l5497"><span class="linenum">5497</span></a>  
<a name="l5498"><span class="linenum">5498</span></a>          <a class="function" onClick="logFunction('blocks_delete_all_for_context')" href="../_functions/blocks_delete_all_for_context.html" onMouseOver="funcPopup(event,'blocks_delete_all_for_context')">blocks_delete_all_for_context</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a>);
<a name="l5499"><span class="linenum">5499</span></a>          <a class="function" onClick="logFunction('filter_delete_all_for_context')" href="../_functions/filter_delete_all_for_context.html" onMouseOver="funcPopup(event,'filter_delete_all_for_context')">filter_delete_all_for_context</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a>);
<a name="l5500"><span class="linenum">5500</span></a>  
<a name="l5501"><span class="linenum">5501</span></a>          require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a> . '<a class="filename" href="../comment/lib.php.html">/comment/lib.php</a>');
<a name="l5502"><span class="linenum">5502</span></a>          <a class="class" onClick="logClass('comment')" href="../_classes/comment.html" onMouseOver="classPopup(event,'comment')">comment</a>::<a class="function" onClick="logFunction('delete_comments')" href="../_functions/delete_comments.html" onMouseOver="funcPopup(event,'delete_comments')">delete_comments</a>(array('contextid'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a>));
<a name="l5503"><span class="linenum">5503</span></a>  
<a name="l5504"><span class="linenum">5504</span></a>          require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../rating/lib.php.html">/rating/lib.php</a>');
<a name="l5505"><span class="linenum">5505</span></a>          <a class="var it13012" onMouseOver="hilite(13012)" onMouseOut="lolite()" onClick="logVariable('delopt')" href="../_variables/delopt.html">$delopt</a> = new stdclass();
<a name="l5506"><span class="linenum">5506</span></a>          <a class="var it13012" onMouseOver="hilite(13012)" onMouseOut="lolite()" onClick="logVariable('delopt')" href="../_variables/delopt.html">$delopt</a>-&gt;<a onClick="logVariable('contextid')" class="var it40708" onMouseOver="hilite(40708)" onMouseOut="lolite()" href="../_variables/contextid.html">contextid</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a>;
<a name="l5507"><span class="linenum">5507</span></a>          <a class="var it6647" onMouseOver="hilite(6647)" onMouseOut="lolite()" onClick="logVariable('rm')" href="../_variables/rm.html">$rm</a> = <span class="keyword">new </span><a class="class" onClick="logClass('rating_manager')" href="../_classes/rating_manager.html" onMouseOver="classPopup(event,'rating_manager')">rating_manager</a>();
<a name="l5508"><span class="linenum">5508</span></a>          <a class="var it6647" onMouseOver="hilite(6647)" onMouseOut="lolite()" onClick="logVariable('rm')" href="../_variables/rm.html">$rm</a>-&gt;<a class="function" onClick="logFunction('delete_ratings')" href="../_functions/delete_ratings.html" onMouseOver="funcPopup(event,'delete_ratings')">delete_ratings</a>(<a class="var it13012" onMouseOver="hilite(13012)" onMouseOut="lolite()" onClick="logVariable('delopt')" href="../_variables/delopt.html">$delopt</a>);
<a name="l5509"><span class="linenum">5509</span></a>  
<a name="l5510"><span class="linenum">5510</span></a>  <span class="comment">        // delete all files attached to this context</span>
<a name="l5511"><span class="linenum">5511</span></a>          <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l5512"><span class="linenum">5512</span></a>          <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('delete_area_files')" href="../_functions/delete_area_files.html" onMouseOver="funcPopup(event,'delete_area_files')">delete_area_files</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a>);
<a name="l5513"><span class="linenum">5513</span></a>  
<a name="l5514"><span class="linenum">5514</span></a>  <span class="comment">        // Delete all repository instances attached to this context.</span>
<a name="l5515"><span class="linenum">5515</span></a>          require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a> . '<a class="filename" href="../repository/lib.php.html">/repository/lib.php</a>');
<a name="l5516"><span class="linenum">5516</span></a>          <a class="class" onClick="logClass('repository')" href="../_classes/repository.html" onMouseOver="classPopup(event,'repository')">repository</a>::<a class="function" onClick="logFunction('delete_all_for_context')" href="../_functions/delete_all_for_context.html" onMouseOver="funcPopup(event,'delete_all_for_context')">delete_all_for_context</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a>);
<a name="l5517"><span class="linenum">5517</span></a>  
<a name="l5518"><span class="linenum">5518</span></a>  <span class="comment">        // delete all advanced grading data attached to this context</span>
<a name="l5519"><span class="linenum">5519</span></a>          require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../grade/grading/lib.php.html">/grade/grading/lib.php</a>');
<a name="l5520"><span class="linenum">5520</span></a>          <a class="class" onClick="logClass('grading_manager')" href="../_classes/grading_manager.html" onMouseOver="classPopup(event,'grading_manager')">grading_manager</a>::<a class="function" onClick="logFunction('delete_all_for_context')" href="../_functions/delete_all_for_context.html" onMouseOver="funcPopup(event,'delete_all_for_context')">delete_all_for_context</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a>);
<a name="l5521"><span class="linenum">5521</span></a>  
<a name="l5522"><span class="linenum">5522</span></a>  <span class="comment">        // now delete stuff from role related tables, role_unassign_all</span>
<a name="l5523"><span class="linenum">5523</span></a>  <span class="comment">        // and unenrol should be called earlier to do proper cleanup</span>
<a name="l5524"><span class="linenum">5524</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('role_assignments', array('contextid'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a>));
<a name="l5525"><span class="linenum">5525</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('role_capabilities', array('contextid'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a>));
<a name="l5526"><span class="linenum">5526</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('role_names', array('contextid'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a>));
<a name="l5527"><span class="linenum">5527</span></a>      }
<a name="l5528"><span class="linenum">5528</span></a>  
<a name="l5529"><span class="linenum">5529</span></a>      <span class="comment">/**</span>
<a name="l5530"><span class="linenum">5530</span></a>  <span class="comment">     * Delete the context content and the context record itself</span>
<a name="l5531"><span class="linenum">5531</span></a>  <span class="comment">     */</span>
<a name="l5532"><span class="linenum">5532</span></a>      public function <a class="function" onClick="logFunction('delete')" href="../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>() {
<a name="l5533"><span class="linenum">5533</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l5534"><span class="linenum">5534</span></a>  
<a name="l5535"><span class="linenum">5535</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_contextlevel')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_contextlevel.html">_contextlevel</a> &lt;= <a class="constant" onClick="logConstant('CONTEXT_SYSTEM')" href="../_constants/CONTEXT_SYSTEM.html" onMouseOver="constPopup(event,'CONTEXT_SYSTEM')">CONTEXT_SYSTEM</a>) {
<a name="l5536"><span class="linenum">5536</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Cannot delete system context');
<a name="l5537"><span class="linenum">5537</span></a>          }
<a name="l5538"><span class="linenum">5538</span></a>  
<a name="l5539"><span class="linenum">5539</span></a>  <span class="comment">        // double check the context still exists</span>
<a name="l5540"><span class="linenum">5540</span></a>          if (!<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('context', array('id'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a>))) {
<a name="l5541"><span class="linenum">5541</span></a>              context::<a class="function" onClick="logFunction('cache_remove')" href="../_functions/cache_remove.html" onMouseOver="funcPopup(event,'cache_remove')">cache_remove</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>);
<a name="l5542"><span class="linenum">5542</span></a>              return;
<a name="l5543"><span class="linenum">5543</span></a>          }
<a name="l5544"><span class="linenum">5544</span></a>  
<a name="l5545"><span class="linenum">5545</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('delete_content')" href="../_functions/delete_content.html" onMouseOver="funcPopup(event,'delete_content')">delete_content</a>();
<a name="l5546"><span class="linenum">5546</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('context', array('id'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a>));
<a name="l5547"><span class="linenum">5547</span></a>  <span class="comment">        // purge static context cache if entry present</span>
<a name="l5548"><span class="linenum">5548</span></a>          context::<a class="function" onClick="logFunction('cache_remove')" href="../_functions/cache_remove.html" onMouseOver="funcPopup(event,'cache_remove')">cache_remove</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>);
<a name="l5549"><span class="linenum">5549</span></a>  
<a name="l5550"><span class="linenum">5550</span></a>  <span class="comment">        // do not mark dirty contexts if parents unknown</span>
<a name="l5551"><span class="linenum">5551</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_null')" href="../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a>) and <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_depth')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_depth.html">_depth</a> &gt; 0) {
<a name="l5552"><span class="linenum">5552</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('mark_dirty')" href="../_functions/mark_dirty.html" onMouseOver="funcPopup(event,'mark_dirty')">mark_dirty</a>();
<a name="l5553"><span class="linenum">5553</span></a>          }
<a name="l5554"><span class="linenum">5554</span></a>      }
<a name="l5555"><span class="linenum">5555</span></a>  
<a name="l5556"><span class="linenum">5556</span></a>  <span class="comment">    // ====== context level related methods ======</span>
<a name="l5557"><span class="linenum">5557</span></a>  
<a name="l5558"><span class="linenum">5558</span></a>      <span class="comment">/**</span>
<a name="l5559"><span class="linenum">5559</span></a>  <span class="comment">     * Utility method for context creation</span>
<a name="l5560"><span class="linenum">5560</span></a>  <span class="comment">     *</span>
<a name="l5561"><span class="linenum">5561</span></a>  <span class="comment">     * @static</span>
<a name="l5562"><span class="linenum">5562</span></a>  <span class="comment">     * @param int $contextlevel</span>
<a name="l5563"><span class="linenum">5563</span></a>  <span class="comment">     * @param int $instanceid</span>
<a name="l5564"><span class="linenum">5564</span></a>  <span class="comment">     * @param string $parentpath</span>
<a name="l5565"><span class="linenum">5565</span></a>  <span class="comment">     * @return stdClass context record</span>
<a name="l5566"><span class="linenum">5566</span></a>  <span class="comment">     */</span>
<a name="l5567"><span class="linenum">5567</span></a>      protected static function <a class="function" onClick="logFunction('insert_context_record')" href="../_functions/insert_context_record.html" onMouseOver="funcPopup(event,'insert_context_record')">insert_context_record</a>(<a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../_variables/contextlevel.html">$contextlevel</a>, <a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>, <a class="var it24178" onMouseOver="hilite(24178)" onMouseOut="lolite()" onClick="logVariable('parentpath')" href="../_variables/parentpath.html">$parentpath</a>) {
<a name="l5568"><span class="linenum">5568</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l5569"><span class="linenum">5569</span></a>  
<a name="l5570"><span class="linenum">5570</span></a>          <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = new stdClass();
<a name="l5571"><span class="linenum">5571</span></a>          <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> = <a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../_variables/contextlevel.html">$contextlevel</a>;
<a name="l5572"><span class="linenum">5572</span></a>          <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>   = <a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>;
<a name="l5573"><span class="linenum">5573</span></a>          <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('depth')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/depth.html">depth</a>        = 0;
<a name="l5574"><span class="linenum">5574</span></a>          <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('path')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/path.html">path</a>         = null; <span class="comment">//not known before insert</span>
<a name="l5575"><span class="linenum">5575</span></a>  
<a name="l5576"><span class="linenum">5576</span></a>          <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/id.html">id</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('context', <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l5577"><span class="linenum">5577</span></a>  
<a name="l5578"><span class="linenum">5578</span></a>  <span class="comment">        // now add path if known - it can be added later</span>
<a name="l5579"><span class="linenum">5579</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_null')" href="../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it24178" onMouseOver="hilite(24178)" onMouseOut="lolite()" onClick="logVariable('parentpath')" href="../_variables/parentpath.html">$parentpath</a>)) {
<a name="l5580"><span class="linenum">5580</span></a>              <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('path')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/path.html">path</a> = <a class="var it24178" onMouseOver="hilite(24178)" onMouseOut="lolite()" onClick="logVariable('parentpath')" href="../_variables/parentpath.html">$parentpath</a>.'/'.<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l5581"><span class="linenum">5581</span></a>              <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('depth')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/depth.html">depth</a> = <a class="phpfunction" onClick="logFunction('substr_count')" href="../_functions/substr_count.html" onMouseOver="phpfuncPopup(event,'substr_count')">substr_count</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('path')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/path.html">path</a>, '/');
<a name="l5582"><span class="linenum">5582</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('context', <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l5583"><span class="linenum">5583</span></a>          }
<a name="l5584"><span class="linenum">5584</span></a>  
<a name="l5585"><span class="linenum">5585</span></a>          return <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>;
<a name="l5586"><span class="linenum">5586</span></a>      }
<a name="l5587"><span class="linenum">5587</span></a>  
<a name="l5588"><span class="linenum">5588</span></a>      <span class="comment">/**</span>
<a name="l5589"><span class="linenum">5589</span></a>  <span class="comment">     * Returns human readable context identifier.</span>
<a name="l5590"><span class="linenum">5590</span></a>  <span class="comment">     *</span>
<a name="l5591"><span class="linenum">5591</span></a>  <span class="comment">     * @param boolean $withprefix whether to prefix the name of the context with the</span>
<a name="l5592"><span class="linenum">5592</span></a>  <span class="comment">     *      type of context, e.g. User, Course, Forum, etc.</span>
<a name="l5593"><span class="linenum">5593</span></a>  <span class="comment">     * @param boolean $short whether to use the short name of the thing. Only applies</span>
<a name="l5594"><span class="linenum">5594</span></a>  <span class="comment">     *      to course contexts</span>
<a name="l5595"><span class="linenum">5595</span></a>  <span class="comment">     * @return string the human readable context name.</span>
<a name="l5596"><span class="linenum">5596</span></a>  <span class="comment">     */</span>
<a name="l5597"><span class="linenum">5597</span></a>      public function <a class="function" onClick="logFunction('get_context_name')" href="../_functions/get_context_name.html" onMouseOver="funcPopup(event,'get_context_name')">get_context_name</a>(<a class="var it25263" onMouseOver="hilite(25263)" onMouseOut="lolite()" onClick="logVariable('withprefix')" href="../_variables/withprefix.html">$withprefix</a> = true, <a class="var it1725" onMouseOver="hilite(1725)" onMouseOut="lolite()" onClick="logVariable('short')" href="../_variables/short.html">$short</a> = false) {
<a name="l5598"><span class="linenum">5598</span></a>  <span class="comment">        // must be implemented in all context levels</span>
<a name="l5599"><span class="linenum">5599</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('can not get name of abstract context');
<a name="l5600"><span class="linenum">5600</span></a>      }
<a name="l5601"><span class="linenum">5601</span></a>  
<a name="l5602"><span class="linenum">5602</span></a>      <span class="comment">/**</span>
<a name="l5603"><span class="linenum">5603</span></a>  <span class="comment">     * Returns the most relevant URL for this context.</span>
<a name="l5604"><span class="linenum">5604</span></a>  <span class="comment">     *</span>
<a name="l5605"><span class="linenum">5605</span></a>  <span class="comment">     * @return moodle_url</span>
<a name="l5606"><span class="linenum">5606</span></a>  <span class="comment">     */</span>
<a name="l5607"><span class="linenum">5607</span></a>      public abstract function <a class="function" onClick="logFunction('get_url')" href="../_functions/get_url.html" onMouseOver="funcPopup(event,'get_url')">get_url</a>();
<a name="l5608"><span class="linenum">5608</span></a>  
<a name="l5609"><span class="linenum">5609</span></a>      <span class="comment">/**</span>
<a name="l5610"><span class="linenum">5610</span></a>  <span class="comment">     * Returns array of relevant context capability records.</span>
<a name="l5611"><span class="linenum">5611</span></a>  <span class="comment">     *</span>
<a name="l5612"><span class="linenum">5612</span></a>  <span class="comment">     * @return array</span>
<a name="l5613"><span class="linenum">5613</span></a>  <span class="comment">     */</span>
<a name="l5614"><span class="linenum">5614</span></a>      public abstract function <a class="function" onClick="logFunction('get_capabilities')" href="../_functions/get_capabilities.html" onMouseOver="funcPopup(event,'get_capabilities')">get_capabilities</a>();
<a name="l5615"><span class="linenum">5615</span></a>  
<a name="l5616"><span class="linenum">5616</span></a>      <span class="comment">/**</span>
<a name="l5617"><span class="linenum">5617</span></a>  <span class="comment">     * Recursive function which, given a context, find all its children context ids.</span>
<a name="l5618"><span class="linenum">5618</span></a>  <span class="comment">     *</span>
<a name="l5619"><span class="linenum">5619</span></a>  <span class="comment">     * For course category contexts it will return immediate children and all subcategory contexts.</span>
<a name="l5620"><span class="linenum">5620</span></a>  <span class="comment">     * It will NOT recurse into courses or subcategories categories.</span>
<a name="l5621"><span class="linenum">5621</span></a>  <span class="comment">     * If you want to do that, call it on the returned courses/categories.</span>
<a name="l5622"><span class="linenum">5622</span></a>  <span class="comment">     *</span>
<a name="l5623"><span class="linenum">5623</span></a>  <span class="comment">     * When called for a course context, it will return the modules and blocks</span>
<a name="l5624"><span class="linenum">5624</span></a>  <span class="comment">     * displayed in the course page and blocks displayed on the module pages.</span>
<a name="l5625"><span class="linenum">5625</span></a>  <span class="comment">     *</span>
<a name="l5626"><span class="linenum">5626</span></a>  <span class="comment">     * If called on a user/course/module context it _will_ populate the cache with the appropriate</span>
<a name="l5627"><span class="linenum">5627</span></a>  <span class="comment">     * contexts ;-)</span>
<a name="l5628"><span class="linenum">5628</span></a>  <span class="comment">     *</span>
<a name="l5629"><span class="linenum">5629</span></a>  <span class="comment">     * @return array Array of child records</span>
<a name="l5630"><span class="linenum">5630</span></a>  <span class="comment">     */</span>
<a name="l5631"><span class="linenum">5631</span></a>      public function <a class="function" onClick="logFunction('get_child_contexts')" href="../_functions/get_child_contexts.html" onMouseOver="funcPopup(event,'get_child_contexts')">get_child_contexts</a>() {
<a name="l5632"><span class="linenum">5632</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l5633"><span class="linenum">5633</span></a>  
<a name="l5634"><span class="linenum">5634</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a>) or empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_depth')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_depth.html">_depth</a>)) {
<a name="l5635"><span class="linenum">5635</span></a>              <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Can not find child contexts of context '.<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a>.' try rebuilding of context paths');
<a name="l5636"><span class="linenum">5636</span></a>              return array();
<a name="l5637"><span class="linenum">5637</span></a>          }
<a name="l5638"><span class="linenum">5638</span></a>  
<a name="l5639"><span class="linenum">5639</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT ctx.*
<a name="l5640"><span class="linenum">5640</span></a>                    FROM {context} ctx
<a name="l5641"><span class="linenum">5641</span></a>                   WHERE ctx.path LIKE ?&quot;;
<a name="l5642"><span class="linenum">5642</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a>.'/%');
<a name="l5643"><span class="linenum">5643</span></a>          <a class="var it2579" onMouseOver="hilite(2579)" onMouseOut="lolite()" onClick="logVariable('records')" href="../_variables/records.html">$records</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l5644"><span class="linenum">5644</span></a>  
<a name="l5645"><span class="linenum">5645</span></a>          <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a> = array();
<a name="l5646"><span class="linenum">5646</span></a>          foreach (<a class="var it2579" onMouseOver="hilite(2579)" onMouseOut="lolite()" onClick="logVariable('records')" href="../_variables/records.html">$records</a> as <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>) {
<a name="l5647"><span class="linenum">5647</span></a>              <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>[<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = context::<a class="function" onClick="logFunction('create_instance_from_record')" href="../_functions/create_instance_from_record.html" onMouseOver="funcPopup(event,'create_instance_from_record')">create_instance_from_record</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l5648"><span class="linenum">5648</span></a>          }
<a name="l5649"><span class="linenum">5649</span></a>  
<a name="l5650"><span class="linenum">5650</span></a>          return <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>;
<a name="l5651"><span class="linenum">5651</span></a>      }
<a name="l5652"><span class="linenum">5652</span></a>  
<a name="l5653"><span class="linenum">5653</span></a>      <span class="comment">/**</span>
<a name="l5654"><span class="linenum">5654</span></a>  <span class="comment">     * Returns parent contexts of this context in reversed order, i.e. parent first,</span>
<a name="l5655"><span class="linenum">5655</span></a>  <span class="comment">     * then grand parent, etc.</span>
<a name="l5656"><span class="linenum">5656</span></a>  <span class="comment">     *</span>
<a name="l5657"><span class="linenum">5657</span></a>  <span class="comment">     * @param bool $includeself tre means include self too</span>
<a name="l5658"><span class="linenum">5658</span></a>  <span class="comment">     * @return array of context instances</span>
<a name="l5659"><span class="linenum">5659</span></a>  <span class="comment">     */</span>
<a name="l5660"><span class="linenum">5660</span></a>      public function <a class="function" onClick="logFunction('get_parent_contexts')" href="../_functions/get_parent_contexts.html" onMouseOver="funcPopup(event,'get_parent_contexts')">get_parent_contexts</a>(<a class="var it5385" onMouseOver="hilite(5385)" onMouseOut="lolite()" onClick="logVariable('includeself')" href="../_variables/includeself.html">$includeself</a> = false) {
<a name="l5661"><span class="linenum">5661</span></a>          if (!<a class="var it12554" onMouseOver="hilite(12554)" onMouseOut="lolite()" onClick="logVariable('contextids')" href="../_variables/contextids.html">$contextids</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_parent_context_ids')" href="../_functions/get_parent_context_ids.html" onMouseOver="funcPopup(event,'get_parent_context_ids')">get_parent_context_ids</a>(<a class="var it5385" onMouseOver="hilite(5385)" onMouseOut="lolite()" onClick="logVariable('includeself')" href="../_variables/includeself.html">$includeself</a>)) {
<a name="l5662"><span class="linenum">5662</span></a>              return array();
<a name="l5663"><span class="linenum">5663</span></a>          }
<a name="l5664"><span class="linenum">5664</span></a>  
<a name="l5665"><span class="linenum">5665</span></a>          <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a> = array();
<a name="l5666"><span class="linenum">5666</span></a>          foreach (<a class="var it12554" onMouseOver="hilite(12554)" onMouseOut="lolite()" onClick="logVariable('contextids')" href="../_variables/contextids.html">$contextids</a> as <a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a>) {
<a name="l5667"><span class="linenum">5667</span></a>              <a class="var it75" onMouseOver="hilite(75)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../_variables/parent.html">$parent</a> = context::<a class="function" onClick="logFunction('instance_by_id')" href="../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>(<a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a>, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l5668"><span class="linenum">5668</span></a>              <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>[<a class="var it75" onMouseOver="hilite(75)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../_variables/parent.html">$parent</a>-&gt;<a onClick="logVariable('id')" class="var it39475" onMouseOver="hilite(39475)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="var it75" onMouseOver="hilite(75)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../_variables/parent.html">$parent</a>;
<a name="l5669"><span class="linenum">5669</span></a>          }
<a name="l5670"><span class="linenum">5670</span></a>  
<a name="l5671"><span class="linenum">5671</span></a>          return <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>;
<a name="l5672"><span class="linenum">5672</span></a>      }
<a name="l5673"><span class="linenum">5673</span></a>  
<a name="l5674"><span class="linenum">5674</span></a>      <span class="comment">/**</span>
<a name="l5675"><span class="linenum">5675</span></a>  <span class="comment">     * Returns parent contexts of this context in reversed order, i.e. parent first,</span>
<a name="l5676"><span class="linenum">5676</span></a>  <span class="comment">     * then grand parent, etc.</span>
<a name="l5677"><span class="linenum">5677</span></a>  <span class="comment">     *</span>
<a name="l5678"><span class="linenum">5678</span></a>  <span class="comment">     * @param bool $includeself tre means include self too</span>
<a name="l5679"><span class="linenum">5679</span></a>  <span class="comment">     * @return array of context ids</span>
<a name="l5680"><span class="linenum">5680</span></a>  <span class="comment">     */</span>
<a name="l5681"><span class="linenum">5681</span></a>      public function <a class="function" onClick="logFunction('get_parent_context_ids')" href="../_functions/get_parent_context_ids.html" onMouseOver="funcPopup(event,'get_parent_context_ids')">get_parent_context_ids</a>(<a class="var it5385" onMouseOver="hilite(5385)" onMouseOut="lolite()" onClick="logVariable('includeself')" href="../_variables/includeself.html">$includeself</a> = false) {
<a name="l5682"><span class="linenum">5682</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a>)) {
<a name="l5683"><span class="linenum">5683</span></a>              return array();
<a name="l5684"><span class="linenum">5684</span></a>          }
<a name="l5685"><span class="linenum">5685</span></a>  
<a name="l5686"><span class="linenum">5686</span></a>          <a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a>, '/'); <span class="comment">// kill leading slash</span>
<a name="l5687"><span class="linenum">5687</span></a>          <a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>('/', <a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a>);
<a name="l5688"><span class="linenum">5688</span></a>          if (!<a class="var it5385" onMouseOver="hilite(5385)" onMouseOut="lolite()" onClick="logVariable('includeself')" href="../_variables/includeself.html">$includeself</a>) {
<a name="l5689"><span class="linenum">5689</span></a>              <a class="phpfunction" onClick="logFunction('array_pop')" href="../_functions/array_pop.html" onMouseOver="phpfuncPopup(event,'array_pop')">array_pop</a>(<a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a>); <span class="comment">// and remove its own id</span>
<a name="l5690"><span class="linenum">5690</span></a>          }
<a name="l5691"><span class="linenum">5691</span></a>  
<a name="l5692"><span class="linenum">5692</span></a>          return <a class="phpfunction" onClick="logFunction('array_reverse')" href="../_functions/array_reverse.html" onMouseOver="phpfuncPopup(event,'array_reverse')">array_reverse</a>(<a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a>);
<a name="l5693"><span class="linenum">5693</span></a>      }
<a name="l5694"><span class="linenum">5694</span></a>  
<a name="l5695"><span class="linenum">5695</span></a>      <span class="comment">/**</span>
<a name="l5696"><span class="linenum">5696</span></a>  <span class="comment">     * Returns parent context</span>
<a name="l5697"><span class="linenum">5697</span></a>  <span class="comment">     *</span>
<a name="l5698"><span class="linenum">5698</span></a>  <span class="comment">     * @return context</span>
<a name="l5699"><span class="linenum">5699</span></a>  <span class="comment">     */</span>
<a name="l5700"><span class="linenum">5700</span></a>      public function <a class="function" onClick="logFunction('get_parent_context')" href="../_functions/get_parent_context.html" onMouseOver="funcPopup(event,'get_parent_context')">get_parent_context</a>() {
<a name="l5701"><span class="linenum">5701</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a>) or <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a> == <a class="constant" onClick="logConstant('SYSCONTEXTID')" href="../_constants/SYSCONTEXTID.html" onMouseOver="constPopup(event,'SYSCONTEXTID')">SYSCONTEXTID</a>) {
<a name="l5702"><span class="linenum">5702</span></a>              return false;
<a name="l5703"><span class="linenum">5703</span></a>          }
<a name="l5704"><span class="linenum">5704</span></a>  
<a name="l5705"><span class="linenum">5705</span></a>          <a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a>, '/'); <span class="comment">// kill leading slash</span>
<a name="l5706"><span class="linenum">5706</span></a>          <a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>('/', <a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a>);
<a name="l5707"><span class="linenum">5707</span></a>          <a class="phpfunction" onClick="logFunction('array_pop')" href="../_functions/array_pop.html" onMouseOver="phpfuncPopup(event,'array_pop')">array_pop</a>(<a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a>); <span class="comment">// self</span>
<a name="l5708"><span class="linenum">5708</span></a>          <a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a> = <a class="phpfunction" onClick="logFunction('array_pop')" href="../_functions/array_pop.html" onMouseOver="phpfuncPopup(event,'array_pop')">array_pop</a>(<a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a>); <span class="comment">// immediate parent</span>
<a name="l5709"><span class="linenum">5709</span></a>  
<a name="l5710"><span class="linenum">5710</span></a>          return context::<a class="function" onClick="logFunction('instance_by_id')" href="../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>(<a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../_variables/contextid.html">$contextid</a>, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l5711"><span class="linenum">5711</span></a>      }
<a name="l5712"><span class="linenum">5712</span></a>  
<a name="l5713"><span class="linenum">5713</span></a>      <span class="comment">/**</span>
<a name="l5714"><span class="linenum">5714</span></a>  <span class="comment">     * Is this context part of any course? If yes return course context.</span>
<a name="l5715"><span class="linenum">5715</span></a>  <span class="comment">     *</span>
<a name="l5716"><span class="linenum">5716</span></a>  <span class="comment">     * @param bool $strict true means throw exception if not found, false means return false if not found</span>
<a name="l5717"><span class="linenum">5717</span></a>  <span class="comment">     * @return context_course context of the enclosing course, null if not found or exception</span>
<a name="l5718"><span class="linenum">5718</span></a>  <span class="comment">     */</span>
<a name="l5719"><span class="linenum">5719</span></a>      public function <a class="function" onClick="logFunction('get_course_context')" href="../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>(<a class="var it13192" onMouseOver="hilite(13192)" onMouseOut="lolite()" onClick="logVariable('strict')" href="../_variables/strict.html">$strict</a> = true) {
<a name="l5720"><span class="linenum">5720</span></a>          if (<a class="var it13192" onMouseOver="hilite(13192)" onMouseOut="lolite()" onClick="logVariable('strict')" href="../_variables/strict.html">$strict</a>) {
<a name="l5721"><span class="linenum">5721</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Context does not belong to any course.');
<a name="l5722"><span class="linenum">5722</span></a>          } else {
<a name="l5723"><span class="linenum">5723</span></a>              return false;
<a name="l5724"><span class="linenum">5724</span></a>          }
<a name="l5725"><span class="linenum">5725</span></a>      }
<a name="l5726"><span class="linenum">5726</span></a>  
<a name="l5727"><span class="linenum">5727</span></a>      <span class="comment">/**</span>
<a name="l5728"><span class="linenum">5728</span></a>  <span class="comment">     * Returns sql necessary for purging of stale context instances.</span>
<a name="l5729"><span class="linenum">5729</span></a>  <span class="comment">     *</span>
<a name="l5730"><span class="linenum">5730</span></a>  <span class="comment">     * @static</span>
<a name="l5731"><span class="linenum">5731</span></a>  <span class="comment">     * @return string cleanup SQL</span>
<a name="l5732"><span class="linenum">5732</span></a>  <span class="comment">     */</span>
<a name="l5733"><span class="linenum">5733</span></a>      protected static function <a class="function" onClick="logFunction('get_cleanup_sql')" href="../_functions/get_cleanup_sql.html" onMouseOver="funcPopup(event,'get_cleanup_sql')">get_cleanup_sql</a>() {
<a name="l5734"><span class="linenum">5734</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('<a class="function" onClick="logFunction('get_cleanup_sql')" href="../_functions/get_cleanup_sql.html" onMouseOver="funcPopup(event,'get_cleanup_sql')">get_cleanup_sql</a>() method must be implemented in all context levels');
<a name="l5735"><span class="linenum">5735</span></a>      }
<a name="l5736"><span class="linenum">5736</span></a>  
<a name="l5737"><span class="linenum">5737</span></a>      <span class="comment">/**</span>
<a name="l5738"><span class="linenum">5738</span></a>  <span class="comment">     * Rebuild context paths and depths at context level.</span>
<a name="l5739"><span class="linenum">5739</span></a>  <span class="comment">     *</span>
<a name="l5740"><span class="linenum">5740</span></a>  <span class="comment">     * @static</span>
<a name="l5741"><span class="linenum">5741</span></a>  <span class="comment">     * @param bool $force</span>
<a name="l5742"><span class="linenum">5742</span></a>  <span class="comment">     * @return void</span>
<a name="l5743"><span class="linenum">5743</span></a>  <span class="comment">     */</span>
<a name="l5744"><span class="linenum">5744</span></a>      protected static function <a class="function" onClick="logFunction('build_paths')" href="../_functions/build_paths.html" onMouseOver="funcPopup(event,'build_paths')">build_paths</a>(<a class="var it5797" onMouseOver="hilite(5797)" onMouseOut="lolite()" onClick="logVariable('force')" href="../_variables/force.html">$force</a>) {
<a name="l5745"><span class="linenum">5745</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('<a class="function" onClick="logFunction('build_paths')" href="../_functions/build_paths.html" onMouseOver="funcPopup(event,'build_paths')">build_paths</a>() method must be implemented in all context levels');
<a name="l5746"><span class="linenum">5746</span></a>      }
<a name="l5747"><span class="linenum">5747</span></a>  
<a name="l5748"><span class="linenum">5748</span></a>      <span class="comment">/**</span>
<a name="l5749"><span class="linenum">5749</span></a>  <span class="comment">     * Create missing context instances at given level</span>
<a name="l5750"><span class="linenum">5750</span></a>  <span class="comment">     *</span>
<a name="l5751"><span class="linenum">5751</span></a>  <span class="comment">     * @static</span>
<a name="l5752"><span class="linenum">5752</span></a>  <span class="comment">     * @return void</span>
<a name="l5753"><span class="linenum">5753</span></a>  <span class="comment">     */</span>
<a name="l5754"><span class="linenum">5754</span></a>      protected static function <a class="function" onClick="logFunction('create_level_instances')" href="../_functions/create_level_instances.html" onMouseOver="funcPopup(event,'create_level_instances')">create_level_instances</a>() {
<a name="l5755"><span class="linenum">5755</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('<a class="function" onClick="logFunction('create_level_instances')" href="../_functions/create_level_instances.html" onMouseOver="funcPopup(event,'create_level_instances')">create_level_instances</a>() method must be implemented in all context levels');
<a name="l5756"><span class="linenum">5756</span></a>      }
<a name="l5757"><span class="linenum">5757</span></a>  
<a name="l5758"><span class="linenum">5758</span></a>      <span class="comment">/**</span>
<a name="l5759"><span class="linenum">5759</span></a>  <span class="comment">     * Reset all cached permissions and definitions if the necessary.</span>
<a name="l5760"><span class="linenum">5760</span></a>  <span class="comment">     * @return void</span>
<a name="l5761"><span class="linenum">5761</span></a>  <span class="comment">     */</span>
<a name="l5762"><span class="linenum">5762</span></a>      public function <a class="function" onClick="logFunction('reload_if_dirty')" href="../_functions/reload_if_dirty.html" onMouseOver="funcPopup(event,'reload_if_dirty')">reload_if_dirty</a>() {
<a name="l5763"><span class="linenum">5763</span></a>          global <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l5764"><span class="linenum">5764</span></a>  
<a name="l5765"><span class="linenum">5765</span></a>  <span class="comment">        // Load dirty contexts list if needed</span>
<a name="l5766"><span class="linenum">5766</span></a>          if (<a class="constant" onClick="logConstant('CLI_SCRIPT')" href="../_constants/CLI_SCRIPT.html" onMouseOver="constPopup(event,'CLI_SCRIPT')">CLI_SCRIPT</a>) {
<a name="l5767"><span class="linenum">5767</span></a>              if (!isset(<a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('dirtycontexts')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/dirtycontexts.html">dirtycontexts</a>)) {
<a name="l5768"><span class="linenum">5768</span></a>  <span class="comment">                // we do not load dirty flags in CLI and cron</span>
<a name="l5769"><span class="linenum">5769</span></a>                  <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('dirtycontexts')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/dirtycontexts.html">dirtycontexts</a> = array();
<a name="l5770"><span class="linenum">5770</span></a>              }
<a name="l5771"><span class="linenum">5771</span></a>          } else {
<a name="l5772"><span class="linenum">5772</span></a>              if (!isset(<a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('dirtycontexts')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/dirtycontexts.html">dirtycontexts</a>)) {
<a name="l5773"><span class="linenum">5773</span></a>                  if (!isset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['time'])) {
<a name="l5774"><span class="linenum">5774</span></a>  <span class="comment">                    // nothing was loaded yet, we do not need to check dirty contexts now</span>
<a name="l5775"><span class="linenum">5775</span></a>                      return;
<a name="l5776"><span class="linenum">5776</span></a>                  }
<a name="l5777"><span class="linenum">5777</span></a>  <span class="comment">                // no idea why -2 is there, server cluster time difference maybe... (skodak)</span>
<a name="l5778"><span class="linenum">5778</span></a>                  <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('dirtycontexts')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/dirtycontexts.html">dirtycontexts</a> = <a class="function" onClick="logFunction('get_cache_flags')" href="../_functions/get_cache_flags.html" onMouseOver="funcPopup(event,'get_cache_flags')">get_cache_flags</a>('accesslib/dirtycontexts', <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['time']-2);
<a name="l5779"><span class="linenum">5779</span></a>              }
<a name="l5780"><span class="linenum">5780</span></a>          }
<a name="l5781"><span class="linenum">5781</span></a>  
<a name="l5782"><span class="linenum">5782</span></a>          foreach (<a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('dirtycontexts')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/dirtycontexts.html">dirtycontexts</a> as <a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>=&gt;<a class="var it1136" onMouseOver="hilite(1136)" onMouseOut="lolite()" onClick="logVariable('unused')" href="../_variables/unused.html">$unused</a>) {
<a name="l5783"><span class="linenum">5783</span></a>              if (<a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a> === <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a> or <a class="phpfunction" onClick="logFunction('strpos')" href="../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a>, <a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>.'/') === 0) {
<a name="l5784"><span class="linenum">5784</span></a>  <span class="comment">                // reload all capabilities of USER and others - preserving loginas, roleswitches, etc</span>
<a name="l5785"><span class="linenum">5785</span></a>  <span class="comment">                // and then cleanup any marks of dirtyness... at least from our short term memory! :-)</span>
<a name="l5786"><span class="linenum">5786</span></a>                  <a class="function" onClick="logFunction('reload_all_capabilities')" href="../_functions/reload_all_capabilities.html" onMouseOver="funcPopup(event,'reload_all_capabilities')">reload_all_capabilities</a>();
<a name="l5787"><span class="linenum">5787</span></a>                  break;
<a name="l5788"><span class="linenum">5788</span></a>              }
<a name="l5789"><span class="linenum">5789</span></a>          }
<a name="l5790"><span class="linenum">5790</span></a>      }
<a name="l5791"><span class="linenum">5791</span></a>  
<a name="l5792"><span class="linenum">5792</span></a>      <span class="comment">/**</span>
<a name="l5793"><span class="linenum">5793</span></a>  <span class="comment">     * Mark a context as dirty (with timestamp) so as to force reloading of the context.</span>
<a name="l5794"><span class="linenum">5794</span></a>  <span class="comment">     */</span>
<a name="l5795"><span class="linenum">5795</span></a>      public function <a class="function" onClick="logFunction('mark_dirty')" href="../_functions/mark_dirty.html" onMouseOver="funcPopup(event,'mark_dirty')">mark_dirty</a>() {
<a name="l5796"><span class="linenum">5796</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>;
<a name="l5797"><span class="linenum">5797</span></a>  
<a name="l5798"><span class="linenum">5798</span></a>          if (<a class="function" onClick="logFunction('during_initial_install')" href="../_functions/during_initial_install.html" onMouseOver="funcPopup(event,'during_initial_install')">during_initial_install</a>()) {
<a name="l5799"><span class="linenum">5799</span></a>              return;
<a name="l5800"><span class="linenum">5800</span></a>          }
<a name="l5801"><span class="linenum">5801</span></a>  
<a name="l5802"><span class="linenum">5802</span></a>  <span class="comment">        // only if it is a non-empty string</span>
<a name="l5803"><span class="linenum">5803</span></a>          if (<a class="phpfunction" onClick="logFunction('is_string')" href="../_functions/is_string.html" onMouseOver="phpfuncPopup(event,'is_string')">is_string</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a>) &amp;&amp; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a> !== '') {
<a name="l5804"><span class="linenum">5804</span></a>              <a class="function" onClick="logFunction('set_cache_flag')" href="../_functions/set_cache_flag.html" onMouseOver="funcPopup(event,'set_cache_flag')">set_cache_flag</a>('accesslib/dirtycontexts', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a>, 1, <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()+<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('sessiontimeout')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/sessiontimeout.html">sessiontimeout</a>);
<a name="l5805"><span class="linenum">5805</span></a>              if (isset(<a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('dirtycontexts')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/dirtycontexts.html">dirtycontexts</a>)) {
<a name="l5806"><span class="linenum">5806</span></a>                  <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('dirtycontexts')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/dirtycontexts.html">dirtycontexts</a>[<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a>] = 1;
<a name="l5807"><span class="linenum">5807</span></a>              } else {
<a name="l5808"><span class="linenum">5808</span></a>                  if (<a class="constant" onClick="logConstant('CLI_SCRIPT')" href="../_constants/CLI_SCRIPT.html" onMouseOver="constPopup(event,'CLI_SCRIPT')">CLI_SCRIPT</a>) {
<a name="l5809"><span class="linenum">5809</span></a>                      <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('dirtycontexts')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/dirtycontexts.html">dirtycontexts</a> = array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a> =&gt; 1);
<a name="l5810"><span class="linenum">5810</span></a>                  } else {
<a name="l5811"><span class="linenum">5811</span></a>                      if (isset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['time'])) {
<a name="l5812"><span class="linenum">5812</span></a>                          <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('dirtycontexts')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/dirtycontexts.html">dirtycontexts</a> = <a class="function" onClick="logFunction('get_cache_flags')" href="../_functions/get_cache_flags.html" onMouseOver="funcPopup(event,'get_cache_flags')">get_cache_flags</a>('accesslib/dirtycontexts', <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('access')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/access.html">access</a>['time']-2);
<a name="l5813"><span class="linenum">5813</span></a>                      } else {
<a name="l5814"><span class="linenum">5814</span></a>                          <a class="var it25264" onMouseOver="hilite(25264)" onMouseOut="lolite()" onClick="logVariable('ACCESSLIB_PRIVATE')" href="../_variables/ACCESSLIB_PRIVATE.html">$ACCESSLIB_PRIVATE</a>-&gt;<a onClick="logVariable('dirtycontexts')" class="var it40975" onMouseOver="hilite(40975)" onMouseOut="lolite()" href="../_variables/dirtycontexts.html">dirtycontexts</a> = array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a> =&gt; 1);
<a name="l5815"><span class="linenum">5815</span></a>                      }
<a name="l5816"><span class="linenum">5816</span></a>  <span class="comment">                    // flags not loaded yet, it will be done later in $context-&gt;reload_if_dirty()</span>
<a name="l5817"><span class="linenum">5817</span></a>                  }
<a name="l5818"><span class="linenum">5818</span></a>              }
<a name="l5819"><span class="linenum">5819</span></a>          }
<a name="l5820"><span class="linenum">5820</span></a>      }
<a name="l5821"><span class="linenum">5821</span></a>  }
<a name="l5822"><span class="linenum">5822</span></a>  
<a name="l5823"><span class="linenum">5823</span></a>  
<a name="l5824"><span class="linenum">5824</span></a>  <span class="comment">/**</span>
<a name="l5825"><span class="linenum">5825</span></a>  <span class="comment"> * Context maintenance and helper methods.</span>
<a name="l5826"><span class="linenum">5826</span></a>  <span class="comment"> *</span>
<a name="l5827"><span class="linenum">5827</span></a>  <span class="comment"> * This is &quot;extends context&quot; is a bloody hack that tires to work around the deficiencies</span>
<a name="l5828"><span class="linenum">5828</span></a>  <span class="comment"> * in the &quot;protected&quot; keyword in PHP, this helps us to hide all the internals of context</span>
<a name="l5829"><span class="linenum">5829</span></a>  <span class="comment"> * level implementation from the rest of code, the code completion returns what developers need.</span>
<a name="l5830"><span class="linenum">5830</span></a>  <span class="comment"> *</span>
<a name="l5831"><span class="linenum">5831</span></a>  <span class="comment"> * Thank you Tim Hunt for helping me with this nasty trick.</span>
<a name="l5832"><span class="linenum">5832</span></a>  <span class="comment"> *</span>
<a name="l5833"><span class="linenum">5833</span></a>  <span class="comment"> * @package   core_access</span>
<a name="l5834"><span class="linenum">5834</span></a>  <span class="comment"> * @category  access</span>
<a name="l5835"><span class="linenum">5835</span></a>  <span class="comment"> * @copyright Petr Skoda {@link http://skodak.org}</span>
<a name="l5836"><span class="linenum">5836</span></a>  <span class="comment"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l5837"><span class="linenum">5837</span></a>  <span class="comment"> * @since     Moodle 2.2</span>
<a name="l5838"><span class="linenum">5838</span></a>  <span class="comment"> */</span>
<a name="l5839"><span class="linenum">5839</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('context_helper')" href="../_classes/context_helper.html" onMouseOver="classPopup(event,'context_helper')">context_helper</a> extends context {
<a name="l5840"><span class="linenum">5840</span></a>  
<a name="l5841"><span class="linenum">5841</span></a>      <span class="comment">/**</span>
<a name="l5842"><span class="linenum">5842</span></a>  <span class="comment">     * @var array An array mapping context levels to classes</span>
<a name="l5843"><span class="linenum">5843</span></a>  <span class="comment">     */</span>
<a name="l5844"><span class="linenum">5844</span></a>      private static <a class="var it10047" onMouseOver="hilite(10047)" onMouseOut="lolite()" onClick="logVariable('alllevels')" href="../_variables/alllevels.html">$alllevels</a>;
<a name="l5845"><span class="linenum">5845</span></a>  
<a name="l5846"><span class="linenum">5846</span></a>      <span class="comment">/**</span>
<a name="l5847"><span class="linenum">5847</span></a>  <span class="comment">     * Instance does not make sense here, only static use</span>
<a name="l5848"><span class="linenum">5848</span></a>  <span class="comment">     */</span>
<a name="l5849"><span class="linenum">5849</span></a>      protected function <a class="function" onClick="logFunction('__construct')" href="../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>() {
<a name="l5850"><span class="linenum">5850</span></a>      }
<a name="l5851"><span class="linenum">5851</span></a>  
<a name="l5852"><span class="linenum">5852</span></a>      <span class="comment">/**</span>
<a name="l5853"><span class="linenum">5853</span></a>  <span class="comment">     * Reset internal context levels array.</span>
<a name="l5854"><span class="linenum">5854</span></a>  <span class="comment">     */</span>
<a name="l5855"><span class="linenum">5855</span></a>      public static function <a class="function" onClick="logFunction('reset_levels')" href="../_functions/reset_levels.html" onMouseOver="funcPopup(event,'reset_levels')">reset_levels</a>() {
<a name="l5856"><span class="linenum">5856</span></a>          self::<a class="var it10047" onMouseOver="hilite(10047)" onMouseOut="lolite()" onClick="logVariable('alllevels')" href="../_variables/alllevels.html">$alllevels</a> = null;
<a name="l5857"><span class="linenum">5857</span></a>      }
<a name="l5858"><span class="linenum">5858</span></a>  
<a name="l5859"><span class="linenum">5859</span></a>      <span class="comment">/**</span>
<a name="l5860"><span class="linenum">5860</span></a>  <span class="comment">     * Initialise context levels, call before using self::$alllevels.</span>
<a name="l5861"><span class="linenum">5861</span></a>  <span class="comment">     */</span>
<a name="l5862"><span class="linenum">5862</span></a>      private static function <a class="function" onClick="logFunction('init_levels')" href="../_functions/init_levels.html" onMouseOver="funcPopup(event,'init_levels')">init_levels</a>() {
<a name="l5863"><span class="linenum">5863</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l5864"><span class="linenum">5864</span></a>  
<a name="l5865"><span class="linenum">5865</span></a>          if (isset(self::<a class="var it10047" onMouseOver="hilite(10047)" onMouseOut="lolite()" onClick="logVariable('alllevels')" href="../_variables/alllevels.html">$alllevels</a>)) {
<a name="l5866"><span class="linenum">5866</span></a>              return;
<a name="l5867"><span class="linenum">5867</span></a>          }
<a name="l5868"><span class="linenum">5868</span></a>          self::<a class="var it10047" onMouseOver="hilite(10047)" onMouseOut="lolite()" onClick="logVariable('alllevels')" href="../_variables/alllevels.html">$alllevels</a> = array(
<a name="l5869"><span class="linenum">5869</span></a>              <a class="constant" onClick="logConstant('CONTEXT_SYSTEM')" href="../_constants/CONTEXT_SYSTEM.html" onMouseOver="constPopup(event,'CONTEXT_SYSTEM')">CONTEXT_SYSTEM</a>    =&gt; 'context_system',
<a name="l5870"><span class="linenum">5870</span></a>              <a class="constant" onClick="logConstant('CONTEXT_USER')" href="../_constants/CONTEXT_USER.html" onMouseOver="constPopup(event,'CONTEXT_USER')">CONTEXT_USER</a>      =&gt; 'context_user',
<a name="l5871"><span class="linenum">5871</span></a>              <a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a> =&gt; 'context_coursecat',
<a name="l5872"><span class="linenum">5872</span></a>              <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>    =&gt; 'context_course',
<a name="l5873"><span class="linenum">5873</span></a>              <a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>    =&gt; 'context_module',
<a name="l5874"><span class="linenum">5874</span></a>              <a class="constant" onClick="logConstant('CONTEXT_BLOCK')" href="../_constants/CONTEXT_BLOCK.html" onMouseOver="constPopup(event,'CONTEXT_BLOCK')">CONTEXT_BLOCK</a>     =&gt; 'context_block',
<a name="l5875"><span class="linenum">5875</span></a>          );
<a name="l5876"><span class="linenum">5876</span></a>  
<a name="l5877"><span class="linenum">5877</span></a>          if (empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('custom_context_classes')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/custom_context_classes.html">custom_context_classes</a>)) {
<a name="l5878"><span class="linenum">5878</span></a>              return;
<a name="l5879"><span class="linenum">5879</span></a>          }
<a name="l5880"><span class="linenum">5880</span></a>  
<a name="l5881"><span class="linenum">5881</span></a>          <a class="var it1631" onMouseOver="hilite(1631)" onMouseOut="lolite()" onClick="logVariable('levels')" href="../_variables/levels.html">$levels</a> = <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('custom_context_classes')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/custom_context_classes.html">custom_context_classes</a>;
<a name="l5882"><span class="linenum">5882</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_array')" href="../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it1631" onMouseOver="hilite(1631)" onMouseOut="lolite()" onClick="logVariable('levels')" href="../_variables/levels.html">$levels</a>)) {
<a name="l5883"><span class="linenum">5883</span></a>              <a class="var it1631" onMouseOver="hilite(1631)" onMouseOut="lolite()" onClick="logVariable('levels')" href="../_variables/levels.html">$levels</a> = @<a class="phpfunction" onClick="logFunction('unserialize')" href="../_functions/unserialize.html" onMouseOver="phpfuncPopup(event,'unserialize')">unserialize</a>(<a class="var it1631" onMouseOver="hilite(1631)" onMouseOut="lolite()" onClick="logVariable('levels')" href="../_variables/levels.html">$levels</a>);
<a name="l5884"><span class="linenum">5884</span></a>          }
<a name="l5885"><span class="linenum">5885</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_array')" href="../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it1631" onMouseOver="hilite(1631)" onMouseOut="lolite()" onClick="logVariable('levels')" href="../_variables/levels.html">$levels</a>)) {
<a name="l5886"><span class="linenum">5886</span></a>              <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Invalid <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('custom_context_classes')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/custom_context_classes.html">custom_context_classes</a> detected, value ignored.', <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l5887"><span class="linenum">5887</span></a>              return;
<a name="l5888"><span class="linenum">5888</span></a>          }
<a name="l5889"><span class="linenum">5889</span></a>  
<a name="l5890"><span class="linenum">5890</span></a>  <span class="comment">        // Unsupported custom levels, use with care!!!</span>
<a name="l5891"><span class="linenum">5891</span></a>          foreach (<a class="var it1631" onMouseOver="hilite(1631)" onMouseOut="lolite()" onClick="logVariable('levels')" href="../_variables/levels.html">$levels</a> as <a class="var it283" onMouseOver="hilite(283)" onMouseOut="lolite()" onClick="logVariable('level')" href="../_variables/level.html">$level</a> =&gt; <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a>) {
<a name="l5892"><span class="linenum">5892</span></a>              self::<a class="var it10047" onMouseOver="hilite(10047)" onMouseOut="lolite()" onClick="logVariable('alllevels')" href="../_variables/alllevels.html">$alllevels</a>[<a class="var it283" onMouseOver="hilite(283)" onMouseOut="lolite()" onClick="logVariable('level')" href="../_variables/level.html">$level</a>] = <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a>;
<a name="l5893"><span class="linenum">5893</span></a>          }
<a name="l5894"><span class="linenum">5894</span></a>          <a class="phpfunction" onClick="logFunction('ksort')" href="../_functions/ksort.html" onMouseOver="phpfuncPopup(event,'ksort')">ksort</a>(self::<a class="var it10047" onMouseOver="hilite(10047)" onMouseOut="lolite()" onClick="logVariable('alllevels')" href="../_variables/alllevels.html">$alllevels</a>);
<a name="l5895"><span class="linenum">5895</span></a>      }
<a name="l5896"><span class="linenum">5896</span></a>  
<a name="l5897"><span class="linenum">5897</span></a>      <span class="comment">/**</span>
<a name="l5898"><span class="linenum">5898</span></a>  <span class="comment">     * Returns a class name of the context level class</span>
<a name="l5899"><span class="linenum">5899</span></a>  <span class="comment">     *</span>
<a name="l5900"><span class="linenum">5900</span></a>  <span class="comment">     * @static</span>
<a name="l5901"><span class="linenum">5901</span></a>  <span class="comment">     * @param int $contextlevel (CONTEXT_SYSTEM, etc.)</span>
<a name="l5902"><span class="linenum">5902</span></a>  <span class="comment">     * @return string class name of the context class</span>
<a name="l5903"><span class="linenum">5903</span></a>  <span class="comment">     */</span>
<a name="l5904"><span class="linenum">5904</span></a>      public static function <a class="function" onClick="logFunction('get_class_for_level')" href="../_functions/get_class_for_level.html" onMouseOver="funcPopup(event,'get_class_for_level')">get_class_for_level</a>(<a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../_variables/contextlevel.html">$contextlevel</a>) {
<a name="l5905"><span class="linenum">5905</span></a>          self::<a class="function" onClick="logFunction('init_levels')" href="../_functions/init_levels.html" onMouseOver="funcPopup(event,'init_levels')">init_levels</a>();
<a name="l5906"><span class="linenum">5906</span></a>          if (isset(self::<a class="var it10047" onMouseOver="hilite(10047)" onMouseOut="lolite()" onClick="logVariable('alllevels')" href="../_variables/alllevels.html">$alllevels</a>[<a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../_variables/contextlevel.html">$contextlevel</a>])) {
<a name="l5907"><span class="linenum">5907</span></a>              return self::<a class="var it10047" onMouseOver="hilite(10047)" onMouseOut="lolite()" onClick="logVariable('alllevels')" href="../_variables/alllevels.html">$alllevels</a>[<a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../_variables/contextlevel.html">$contextlevel</a>];
<a name="l5908"><span class="linenum">5908</span></a>          } else {
<a name="l5909"><span class="linenum">5909</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid context level specified');
<a name="l5910"><span class="linenum">5910</span></a>          }
<a name="l5911"><span class="linenum">5911</span></a>      }
<a name="l5912"><span class="linenum">5912</span></a>  
<a name="l5913"><span class="linenum">5913</span></a>      <span class="comment">/**</span>
<a name="l5914"><span class="linenum">5914</span></a>  <span class="comment">     * Returns a list of all context levels</span>
<a name="l5915"><span class="linenum">5915</span></a>  <span class="comment">     *</span>
<a name="l5916"><span class="linenum">5916</span></a>  <span class="comment">     * @static</span>
<a name="l5917"><span class="linenum">5917</span></a>  <span class="comment">     * @return array int=&gt;string (level=&gt;level class name)</span>
<a name="l5918"><span class="linenum">5918</span></a>  <span class="comment">     */</span>
<a name="l5919"><span class="linenum">5919</span></a>      public static function <a class="function" onClick="logFunction('get_all_levels')" href="../_functions/get_all_levels.html" onMouseOver="funcPopup(event,'get_all_levels')">get_all_levels</a>() {
<a name="l5920"><span class="linenum">5920</span></a>          self::<a class="function" onClick="logFunction('init_levels')" href="../_functions/init_levels.html" onMouseOver="funcPopup(event,'init_levels')">init_levels</a>();
<a name="l5921"><span class="linenum">5921</span></a>          return self::<a class="var it10047" onMouseOver="hilite(10047)" onMouseOut="lolite()" onClick="logVariable('alllevels')" href="../_variables/alllevels.html">$alllevels</a>;
<a name="l5922"><span class="linenum">5922</span></a>      }
<a name="l5923"><span class="linenum">5923</span></a>  
<a name="l5924"><span class="linenum">5924</span></a>      <span class="comment">/**</span>
<a name="l5925"><span class="linenum">5925</span></a>  <span class="comment">     * Remove stale contexts that belonged to deleted instances.</span>
<a name="l5926"><span class="linenum">5926</span></a>  <span class="comment">     * Ideally all code should cleanup contexts properly, unfortunately accidents happen...</span>
<a name="l5927"><span class="linenum">5927</span></a>  <span class="comment">     *</span>
<a name="l5928"><span class="linenum">5928</span></a>  <span class="comment">     * @static</span>
<a name="l5929"><span class="linenum">5929</span></a>  <span class="comment">     * @return void</span>
<a name="l5930"><span class="linenum">5930</span></a>  <span class="comment">     */</span>
<a name="l5931"><span class="linenum">5931</span></a>      public static function <a class="function" onClick="logFunction('cleanup_instances')" href="../_functions/cleanup_instances.html" onMouseOver="funcPopup(event,'cleanup_instances')">cleanup_instances</a>() {
<a name="l5932"><span class="linenum">5932</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l5933"><span class="linenum">5933</span></a>          self::<a class="function" onClick="logFunction('init_levels')" href="../_functions/init_levels.html" onMouseOver="funcPopup(event,'init_levels')">init_levels</a>();
<a name="l5934"><span class="linenum">5934</span></a>  
<a name="l5935"><span class="linenum">5935</span></a>          <a class="var it1474" onMouseOver="hilite(1474)" onMouseOut="lolite()" onClick="logVariable('sqls')" href="../_variables/sqls.html">$sqls</a> = array();
<a name="l5936"><span class="linenum">5936</span></a>          foreach (self::<a class="var it10047" onMouseOver="hilite(10047)" onMouseOut="lolite()" onClick="logVariable('alllevels')" href="../_variables/alllevels.html">$alllevels</a> as <a class="var it283" onMouseOver="hilite(283)" onMouseOut="lolite()" onClick="logVariable('level')" href="../_variables/level.html">$level</a>=&gt;<a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a>) {
<a name="l5937"><span class="linenum">5937</span></a>              <a class="var it1474" onMouseOver="hilite(1474)" onMouseOut="lolite()" onClick="logVariable('sqls')" href="../_variables/sqls.html">$sqls</a>[] = <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a>::<a class="function" onClick="logFunction('get_cleanup_sql')" href="../_functions/get_cleanup_sql.html" onMouseOver="funcPopup(event,'get_cleanup_sql')">get_cleanup_sql</a>();
<a name="l5938"><span class="linenum">5938</span></a>          }
<a name="l5939"><span class="linenum">5939</span></a>  
<a name="l5940"><span class="linenum">5940</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(&quot; UNION &quot;, <a class="var it1474" onMouseOver="hilite(1474)" onMouseOut="lolite()" onClick="logVariable('sqls')" href="../_variables/sqls.html">$sqls</a>);
<a name="l5941"><span class="linenum">5941</span></a>  
<a name="l5942"><span class="linenum">5942</span></a>  <span class="comment">        // it is probably better to use transactions, it might be faster too</span>
<a name="l5943"><span class="linenum">5943</span></a>          <a class="var it2929" onMouseOver="hilite(2929)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../_variables/transaction.html">$transaction</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l5944"><span class="linenum">5944</span></a>  
<a name="l5945"><span class="linenum">5945</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>);
<a name="l5946"><span class="linenum">5946</span></a>          foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> as <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>) {
<a name="l5947"><span class="linenum">5947</span></a>              <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = context::<a class="function" onClick="logFunction('create_instance_from_record')" href="../_functions/create_instance_from_record.html" onMouseOver="funcPopup(event,'create_instance_from_record')">create_instance_from_record</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l5948"><span class="linenum">5948</span></a>              <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l5949"><span class="linenum">5949</span></a>          }
<a name="l5950"><span class="linenum">5950</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l5951"><span class="linenum">5951</span></a>  
<a name="l5952"><span class="linenum">5952</span></a>          <a class="var it2929" onMouseOver="hilite(2929)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l5953"><span class="linenum">5953</span></a>      }
<a name="l5954"><span class="linenum">5954</span></a>  
<a name="l5955"><span class="linenum">5955</span></a>      <span class="comment">/**</span>
<a name="l5956"><span class="linenum">5956</span></a>  <span class="comment">     * Create all context instances at the given level and above.</span>
<a name="l5957"><span class="linenum">5957</span></a>  <span class="comment">     *</span>
<a name="l5958"><span class="linenum">5958</span></a>  <span class="comment">     * @static</span>
<a name="l5959"><span class="linenum">5959</span></a>  <span class="comment">     * @param int $contextlevel null means all levels</span>
<a name="l5960"><span class="linenum">5960</span></a>  <span class="comment">     * @param bool $buildpaths</span>
<a name="l5961"><span class="linenum">5961</span></a>  <span class="comment">     * @return void</span>
<a name="l5962"><span class="linenum">5962</span></a>  <span class="comment">     */</span>
<a name="l5963"><span class="linenum">5963</span></a>      public static function <a class="function" onClick="logFunction('create_instances')" href="../_functions/create_instances.html" onMouseOver="funcPopup(event,'create_instances')">create_instances</a>(<a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../_variables/contextlevel.html">$contextlevel</a> = null, <a class="var it25262" onMouseOver="hilite(25262)" onMouseOut="lolite()" onClick="logVariable('buildpaths')" href="../_variables/buildpaths.html">$buildpaths</a> = true) {
<a name="l5964"><span class="linenum">5964</span></a>          self::<a class="function" onClick="logFunction('init_levels')" href="../_functions/init_levels.html" onMouseOver="funcPopup(event,'init_levels')">init_levels</a>();
<a name="l5965"><span class="linenum">5965</span></a>          foreach (self::<a class="var it10047" onMouseOver="hilite(10047)" onMouseOut="lolite()" onClick="logVariable('alllevels')" href="../_variables/alllevels.html">$alllevels</a> as <a class="var it283" onMouseOver="hilite(283)" onMouseOut="lolite()" onClick="logVariable('level')" href="../_variables/level.html">$level</a>=&gt;<a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a>) {
<a name="l5966"><span class="linenum">5966</span></a>              if (<a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../_variables/contextlevel.html">$contextlevel</a> and <a class="var it283" onMouseOver="hilite(283)" onMouseOut="lolite()" onClick="logVariable('level')" href="../_variables/level.html">$level</a> &gt; <a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../_variables/contextlevel.html">$contextlevel</a>) {
<a name="l5967"><span class="linenum">5967</span></a>  <span class="comment">                // skip potential sub-contexts</span>
<a name="l5968"><span class="linenum">5968</span></a>                  continue;
<a name="l5969"><span class="linenum">5969</span></a>              }
<a name="l5970"><span class="linenum">5970</span></a>              <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a>::<a class="function" onClick="logFunction('create_level_instances')" href="../_functions/create_level_instances.html" onMouseOver="funcPopup(event,'create_level_instances')">create_level_instances</a>();
<a name="l5971"><span class="linenum">5971</span></a>              if (<a class="var it25262" onMouseOver="hilite(25262)" onMouseOut="lolite()" onClick="logVariable('buildpaths')" href="../_variables/buildpaths.html">$buildpaths</a>) {
<a name="l5972"><span class="linenum">5972</span></a>                  <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a>::<a class="function" onClick="logFunction('build_paths')" href="../_functions/build_paths.html" onMouseOver="funcPopup(event,'build_paths')">build_paths</a>(false);
<a name="l5973"><span class="linenum">5973</span></a>              }
<a name="l5974"><span class="linenum">5974</span></a>          }
<a name="l5975"><span class="linenum">5975</span></a>      }
<a name="l5976"><span class="linenum">5976</span></a>  
<a name="l5977"><span class="linenum">5977</span></a>      <span class="comment">/**</span>
<a name="l5978"><span class="linenum">5978</span></a>  <span class="comment">     * Rebuild paths and depths in all context levels.</span>
<a name="l5979"><span class="linenum">5979</span></a>  <span class="comment">     *</span>
<a name="l5980"><span class="linenum">5980</span></a>  <span class="comment">     * @static</span>
<a name="l5981"><span class="linenum">5981</span></a>  <span class="comment">     * @param bool $force false means add missing only</span>
<a name="l5982"><span class="linenum">5982</span></a>  <span class="comment">     * @return void</span>
<a name="l5983"><span class="linenum">5983</span></a>  <span class="comment">     */</span>
<a name="l5984"><span class="linenum">5984</span></a>      public static function <a class="function" onClick="logFunction('build_all_paths')" href="../_functions/build_all_paths.html" onMouseOver="funcPopup(event,'build_all_paths')">build_all_paths</a>(<a class="var it5797" onMouseOver="hilite(5797)" onMouseOut="lolite()" onClick="logVariable('force')" href="../_variables/force.html">$force</a> = false) {
<a name="l5985"><span class="linenum">5985</span></a>          self::<a class="function" onClick="logFunction('init_levels')" href="../_functions/init_levels.html" onMouseOver="funcPopup(event,'init_levels')">init_levels</a>();
<a name="l5986"><span class="linenum">5986</span></a>          foreach (self::<a class="var it10047" onMouseOver="hilite(10047)" onMouseOut="lolite()" onClick="logVariable('alllevels')" href="../_variables/alllevels.html">$alllevels</a> as <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a>) {
<a name="l5987"><span class="linenum">5987</span></a>              <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a>::<a class="function" onClick="logFunction('build_paths')" href="../_functions/build_paths.html" onMouseOver="funcPopup(event,'build_paths')">build_paths</a>(<a class="var it5797" onMouseOver="hilite(5797)" onMouseOut="lolite()" onClick="logVariable('force')" href="../_variables/force.html">$force</a>);
<a name="l5988"><span class="linenum">5988</span></a>          }
<a name="l5989"><span class="linenum">5989</span></a>  
<a name="l5990"><span class="linenum">5990</span></a>  <span class="comment">        // reset static course cache - it might have incorrect cached data</span>
<a name="l5991"><span class="linenum">5991</span></a>          <a class="function" onClick="logFunction('accesslib_clear_all_caches')" href="../_functions/accesslib_clear_all_caches.html" onMouseOver="funcPopup(event,'accesslib_clear_all_caches')">accesslib_clear_all_caches</a>(true);
<a name="l5992"><span class="linenum">5992</span></a>      }
<a name="l5993"><span class="linenum">5993</span></a>  
<a name="l5994"><span class="linenum">5994</span></a>      <span class="comment">/**</span>
<a name="l5995"><span class="linenum">5995</span></a>  <span class="comment">     * Resets the cache to remove all data.</span>
<a name="l5996"><span class="linenum">5996</span></a>  <span class="comment">     * @static</span>
<a name="l5997"><span class="linenum">5997</span></a>  <span class="comment">     */</span>
<a name="l5998"><span class="linenum">5998</span></a>      public static function <a class="function" onClick="logFunction('reset_caches')" href="../_functions/reset_caches.html" onMouseOver="funcPopup(event,'reset_caches')">reset_caches</a>() {
<a name="l5999"><span class="linenum">5999</span></a>          context::<a class="function" onClick="logFunction('reset_caches')" href="../_functions/reset_caches.html" onMouseOver="funcPopup(event,'reset_caches')">reset_caches</a>();
<a name="l6000"><span class="linenum">6000</span></a>      }
<a name="l6001"><span class="linenum">6001</span></a>  
<a name="l6002"><span class="linenum">6002</span></a>      <span class="comment">/**</span>
<a name="l6003"><span class="linenum">6003</span></a>  <span class="comment">     * Returns all fields necessary for context preloading from user $rec.</span>
<a name="l6004"><span class="linenum">6004</span></a>  <span class="comment">     *</span>
<a name="l6005"><span class="linenum">6005</span></a>  <span class="comment">     * This helps with performance when dealing with hundreds of contexts.</span>
<a name="l6006"><span class="linenum">6006</span></a>  <span class="comment">     *</span>
<a name="l6007"><span class="linenum">6007</span></a>  <span class="comment">     * @static</span>
<a name="l6008"><span class="linenum">6008</span></a>  <span class="comment">     * @param string $tablealias context table alias in the query</span>
<a name="l6009"><span class="linenum">6009</span></a>  <span class="comment">     * @return array (table.column=&gt;alias, ...)</span>
<a name="l6010"><span class="linenum">6010</span></a>  <span class="comment">     */</span>
<a name="l6011"><span class="linenum">6011</span></a>      public static function <a class="function" onClick="logFunction('get_preload_record_columns')" href="../_functions/get_preload_record_columns.html" onMouseOver="funcPopup(event,'get_preload_record_columns')">get_preload_record_columns</a>(<a class="var it10216" onMouseOver="hilite(10216)" onMouseOut="lolite()" onClick="logVariable('tablealias')" href="../_variables/tablealias.html">$tablealias</a>) {
<a name="l6012"><span class="linenum">6012</span></a>          return array(&quot;<a class="var it10216" onMouseOver="hilite(10216)" onMouseOut="lolite()" onClick="logVariable('tablealias')" href="../_variables/tablealias.html">$tablealias</a>.id&quot;=&gt;&quot;ctxid&quot;, &quot;<a class="var it10216" onMouseOver="hilite(10216)" onMouseOut="lolite()" onClick="logVariable('tablealias')" href="../_variables/tablealias.html">$tablealias</a>.path&quot;=&gt;&quot;ctxpath&quot;, &quot;<a class="var it10216" onMouseOver="hilite(10216)" onMouseOut="lolite()" onClick="logVariable('tablealias')" href="../_variables/tablealias.html">$tablealias</a>.depth&quot;=&gt;&quot;ctxdepth&quot;, &quot;<a class="var it10216" onMouseOver="hilite(10216)" onMouseOut="lolite()" onClick="logVariable('tablealias')" href="../_variables/tablealias.html">$tablealias</a>.contextlevel&quot;=&gt;&quot;ctxlevel&quot;, &quot;<a class="var it10216" onMouseOver="hilite(10216)" onMouseOut="lolite()" onClick="logVariable('tablealias')" href="../_variables/tablealias.html">$tablealias</a>.instanceid&quot;=&gt;&quot;ctxinstance&quot;);
<a name="l6013"><span class="linenum">6013</span></a>      }
<a name="l6014"><span class="linenum">6014</span></a>  
<a name="l6015"><span class="linenum">6015</span></a>      <span class="comment">/**</span>
<a name="l6016"><span class="linenum">6016</span></a>  <span class="comment">     * Returns all fields necessary for context preloading from user $rec.</span>
<a name="l6017"><span class="linenum">6017</span></a>  <span class="comment">     *</span>
<a name="l6018"><span class="linenum">6018</span></a>  <span class="comment">     * This helps with performance when dealing with hundreds of contexts.</span>
<a name="l6019"><span class="linenum">6019</span></a>  <span class="comment">     *</span>
<a name="l6020"><span class="linenum">6020</span></a>  <span class="comment">     * @static</span>
<a name="l6021"><span class="linenum">6021</span></a>  <span class="comment">     * @param string $tablealias context table alias in the query</span>
<a name="l6022"><span class="linenum">6022</span></a>  <span class="comment">     * @return string</span>
<a name="l6023"><span class="linenum">6023</span></a>  <span class="comment">     */</span>
<a name="l6024"><span class="linenum">6024</span></a>      public static function <a class="function" onClick="logFunction('get_preload_record_columns_sql')" href="../_functions/get_preload_record_columns_sql.html" onMouseOver="funcPopup(event,'get_preload_record_columns_sql')">get_preload_record_columns_sql</a>(<a class="var it10216" onMouseOver="hilite(10216)" onMouseOut="lolite()" onClick="logVariable('tablealias')" href="../_variables/tablealias.html">$tablealias</a>) {
<a name="l6025"><span class="linenum">6025</span></a>          return &quot;<a class="var it10216" onMouseOver="hilite(10216)" onMouseOut="lolite()" onClick="logVariable('tablealias')" href="../_variables/tablealias.html">$tablealias</a>.id AS ctxid, <a class="var it10216" onMouseOver="hilite(10216)" onMouseOut="lolite()" onClick="logVariable('tablealias')" href="../_variables/tablealias.html">$tablealias</a>.path AS ctxpath, <a class="var it10216" onMouseOver="hilite(10216)" onMouseOut="lolite()" onClick="logVariable('tablealias')" href="../_variables/tablealias.html">$tablealias</a>.depth AS ctxdepth, <a class="var it10216" onMouseOver="hilite(10216)" onMouseOut="lolite()" onClick="logVariable('tablealias')" href="../_variables/tablealias.html">$tablealias</a>.contextlevel AS ctxlevel, <a class="var it10216" onMouseOver="hilite(10216)" onMouseOut="lolite()" onClick="logVariable('tablealias')" href="../_variables/tablealias.html">$tablealias</a>.instanceid AS ctxinstance&quot;;
<a name="l6026"><span class="linenum">6026</span></a>      }
<a name="l6027"><span class="linenum">6027</span></a>  
<a name="l6028"><span class="linenum">6028</span></a>      <span class="comment">/**</span>
<a name="l6029"><span class="linenum">6029</span></a>  <span class="comment">     * Preloads context information from db record and strips the cached info.</span>
<a name="l6030"><span class="linenum">6030</span></a>  <span class="comment">     *</span>
<a name="l6031"><span class="linenum">6031</span></a>  <span class="comment">     * The db request has to contain all columns from context_helper::get_preload_record_columns().</span>
<a name="l6032"><span class="linenum">6032</span></a>  <span class="comment">     *</span>
<a name="l6033"><span class="linenum">6033</span></a>  <span class="comment">     * @static</span>
<a name="l6034"><span class="linenum">6034</span></a>  <span class="comment">     * @param stdClass $rec</span>
<a name="l6035"><span class="linenum">6035</span></a>  <span class="comment">     * @return void (modifies $rec)</span>
<a name="l6036"><span class="linenum">6036</span></a>  <span class="comment">     */</span>
<a name="l6037"><span class="linenum">6037</span></a>       public static function <a class="function" onClick="logFunction('preload_from_record')" href="../_functions/preload_from_record.html" onMouseOver="funcPopup(event,'preload_from_record')">preload_from_record</a>(stdClass <a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../_variables/rec.html">$rec</a>) {
<a name="l6038"><span class="linenum">6038</span></a>           context::<a class="function" onClick="logFunction('preload_from_record')" href="../_functions/preload_from_record.html" onMouseOver="funcPopup(event,'preload_from_record')">preload_from_record</a>(<a class="var it6138" onMouseOver="hilite(6138)" onMouseOut="lolite()" onClick="logVariable('rec')" href="../_variables/rec.html">$rec</a>);
<a name="l6039"><span class="linenum">6039</span></a>       }
<a name="l6040"><span class="linenum">6040</span></a>  
<a name="l6041"><span class="linenum">6041</span></a>      <span class="comment">/**</span>
<a name="l6042"><span class="linenum">6042</span></a>  <span class="comment">     * Preload all contexts instances from course.</span>
<a name="l6043"><span class="linenum">6043</span></a>  <span class="comment">     *</span>
<a name="l6044"><span class="linenum">6044</span></a>  <span class="comment">     * To be used if you expect multiple queries for course activities...</span>
<a name="l6045"><span class="linenum">6045</span></a>  <span class="comment">     *</span>
<a name="l6046"><span class="linenum">6046</span></a>  <span class="comment">     * @static</span>
<a name="l6047"><span class="linenum">6047</span></a>  <span class="comment">     * @param int $courseid</span>
<a name="l6048"><span class="linenum">6048</span></a>  <span class="comment">     */</span>
<a name="l6049"><span class="linenum">6049</span></a>      public static function <a class="function" onClick="logFunction('preload_course')" href="../_functions/preload_course.html" onMouseOver="funcPopup(event,'preload_course')">preload_course</a>(<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>) {
<a name="l6050"><span class="linenum">6050</span></a>  <span class="comment">        // Users can call this multiple times without doing any harm</span>
<a name="l6051"><span class="linenum">6051</span></a>          if (isset(context::<a class="var it28899" onMouseOver="hilite(28899)" onMouseOut="lolite()" onClick="logVariable('cache_preloaded')" href="../_variables/cache_preloaded.html">$cache_preloaded</a>[<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>])) {
<a name="l6052"><span class="linenum">6052</span></a>              return;
<a name="l6053"><span class="linenum">6053</span></a>          }
<a name="l6054"><span class="linenum">6054</span></a>          <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>);
<a name="l6055"><span class="linenum">6055</span></a>          <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a class="function" onClick="logFunction('get_child_contexts')" href="../_functions/get_child_contexts.html" onMouseOver="funcPopup(event,'get_child_contexts')">get_child_contexts</a>();
<a name="l6056"><span class="linenum">6056</span></a>  
<a name="l6057"><span class="linenum">6057</span></a>          context::<a class="var it28899" onMouseOver="hilite(28899)" onMouseOut="lolite()" onClick="logVariable('cache_preloaded')" href="../_variables/cache_preloaded.html">$cache_preloaded</a>[<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../_variables/courseid.html">$courseid</a>] = true;
<a name="l6058"><span class="linenum">6058</span></a>      }
<a name="l6059"><span class="linenum">6059</span></a>  
<a name="l6060"><span class="linenum">6060</span></a>      <span class="comment">/**</span>
<a name="l6061"><span class="linenum">6061</span></a>  <span class="comment">     * Delete context instance</span>
<a name="l6062"><span class="linenum">6062</span></a>  <span class="comment">     *</span>
<a name="l6063"><span class="linenum">6063</span></a>  <span class="comment">     * @static</span>
<a name="l6064"><span class="linenum">6064</span></a>  <span class="comment">     * @param int $contextlevel</span>
<a name="l6065"><span class="linenum">6065</span></a>  <span class="comment">     * @param int $instanceid</span>
<a name="l6066"><span class="linenum">6066</span></a>  <span class="comment">     * @return void</span>
<a name="l6067"><span class="linenum">6067</span></a>  <span class="comment">     */</span>
<a name="l6068"><span class="linenum">6068</span></a>      public static function <a class="function" onClick="logFunction('delete_instance')" href="../_functions/delete_instance.html" onMouseOver="funcPopup(event,'delete_instance')">delete_instance</a>(<a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../_variables/contextlevel.html">$contextlevel</a>, <a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>) {
<a name="l6069"><span class="linenum">6069</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l6070"><span class="linenum">6070</span></a>  
<a name="l6071"><span class="linenum">6071</span></a>  <span class="comment">        // double check the context still exists</span>
<a name="l6072"><span class="linenum">6072</span></a>          if (<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('context', array('contextlevel'=&gt;<a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../_variables/contextlevel.html">$contextlevel</a>, 'instanceid'=&gt;<a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>))) {
<a name="l6073"><span class="linenum">6073</span></a>              <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = context::<a class="function" onClick="logFunction('create_instance_from_record')" href="../_functions/create_instance_from_record.html" onMouseOver="funcPopup(event,'create_instance_from_record')">create_instance_from_record</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l6074"><span class="linenum">6074</span></a>              <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l6075"><span class="linenum">6075</span></a>          } else {
<a name="l6076"><span class="linenum">6076</span></a>  <span class="comment">            // we should try to purge the cache anyway</span>
<a name="l6077"><span class="linenum">6077</span></a>          }
<a name="l6078"><span class="linenum">6078</span></a>      }
<a name="l6079"><span class="linenum">6079</span></a>  
<a name="l6080"><span class="linenum">6080</span></a>      <span class="comment">/**</span>
<a name="l6081"><span class="linenum">6081</span></a>  <span class="comment">     * Returns the name of specified context level</span>
<a name="l6082"><span class="linenum">6082</span></a>  <span class="comment">     *</span>
<a name="l6083"><span class="linenum">6083</span></a>  <span class="comment">     * @static</span>
<a name="l6084"><span class="linenum">6084</span></a>  <span class="comment">     * @param int $contextlevel</span>
<a name="l6085"><span class="linenum">6085</span></a>  <span class="comment">     * @return string name of the context level</span>
<a name="l6086"><span class="linenum">6086</span></a>  <span class="comment">     */</span>
<a name="l6087"><span class="linenum">6087</span></a>      public static function <a class="function" onClick="logFunction('get_level_name')" href="../_functions/get_level_name.html" onMouseOver="funcPopup(event,'get_level_name')">get_level_name</a>(<a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../_variables/contextlevel.html">$contextlevel</a>) {
<a name="l6088"><span class="linenum">6088</span></a>          <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a> = <a class="class" onClick="logClass('context_helper')" href="../_classes/context_helper.html" onMouseOver="classPopup(event,'context_helper')">context_helper</a>::<a class="function" onClick="logFunction('get_class_for_level')" href="../_functions/get_class_for_level.html" onMouseOver="funcPopup(event,'get_class_for_level')">get_class_for_level</a>(<a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('contextlevel')" href="../_variables/contextlevel.html">$contextlevel</a>);
<a name="l6089"><span class="linenum">6089</span></a>          return <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a>::<a class="function" onClick="logFunction('get_level_name')" href="../_functions/get_level_name.html" onMouseOver="funcPopup(event,'get_level_name')">get_level_name</a>();
<a name="l6090"><span class="linenum">6090</span></a>      }
<a name="l6091"><span class="linenum">6091</span></a>  
<a name="l6092"><span class="linenum">6092</span></a>      <span class="comment">/**</span>
<a name="l6093"><span class="linenum">6093</span></a>  <span class="comment">     * not used</span>
<a name="l6094"><span class="linenum">6094</span></a>  <span class="comment">     */</span>
<a name="l6095"><span class="linenum">6095</span></a>      public function <a class="function" onClick="logFunction('get_url')" href="../_functions/get_url.html" onMouseOver="funcPopup(event,'get_url')">get_url</a>() {
<a name="l6096"><span class="linenum">6096</span></a>      }
<a name="l6097"><span class="linenum">6097</span></a>  
<a name="l6098"><span class="linenum">6098</span></a>      <span class="comment">/**</span>
<a name="l6099"><span class="linenum">6099</span></a>  <span class="comment">     * not used</span>
<a name="l6100"><span class="linenum">6100</span></a>  <span class="comment">     */</span>
<a name="l6101"><span class="linenum">6101</span></a>      public function <a class="function" onClick="logFunction('get_capabilities')" href="../_functions/get_capabilities.html" onMouseOver="funcPopup(event,'get_capabilities')">get_capabilities</a>() {
<a name="l6102"><span class="linenum">6102</span></a>      }
<a name="l6103"><span class="linenum">6103</span></a>  }
<a name="l6104"><span class="linenum">6104</span></a>  
<a name="l6105"><span class="linenum">6105</span></a>  
<a name="l6106"><span class="linenum">6106</span></a>  <span class="comment">/**</span>
<a name="l6107"><span class="linenum">6107</span></a>  <span class="comment"> * System context class</span>
<a name="l6108"><span class="linenum">6108</span></a>  <span class="comment"> *</span>
<a name="l6109"><span class="linenum">6109</span></a>  <span class="comment"> * @package   core_access</span>
<a name="l6110"><span class="linenum">6110</span></a>  <span class="comment"> * @category  access</span>
<a name="l6111"><span class="linenum">6111</span></a>  <span class="comment"> * @copyright Petr Skoda {@link http://skodak.org}</span>
<a name="l6112"><span class="linenum">6112</span></a>  <span class="comment"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l6113"><span class="linenum">6113</span></a>  <span class="comment"> * @since     Moodle 2.2</span>
<a name="l6114"><span class="linenum">6114</span></a>  <span class="comment"> */</span>
<a name="l6115"><span class="linenum">6115</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a> extends context {
<a name="l6116"><span class="linenum">6116</span></a>      <span class="comment">/**</span>
<a name="l6117"><span class="linenum">6117</span></a>  <span class="comment">     * Please use context_system::instance() if you need the instance of context.</span>
<a name="l6118"><span class="linenum">6118</span></a>  <span class="comment">     *</span>
<a name="l6119"><span class="linenum">6119</span></a>  <span class="comment">     * @param stdClass $record</span>
<a name="l6120"><span class="linenum">6120</span></a>  <span class="comment">     */</span>
<a name="l6121"><span class="linenum">6121</span></a>      protected function <a class="function" onClick="logFunction('__construct')" href="../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>(stdClass <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>) {
<a name="l6122"><span class="linenum">6122</span></a>          parent::<a class="function" onClick="logFunction('__construct')" href="../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l6123"><span class="linenum">6123</span></a>          if (<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> != <a class="constant" onClick="logConstant('CONTEXT_SYSTEM')" href="../_constants/CONTEXT_SYSTEM.html" onMouseOver="constPopup(event,'CONTEXT_SYSTEM')">CONTEXT_SYSTEM</a>) {
<a name="l6124"><span class="linenum">6124</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> in context_system constructor.');
<a name="l6125"><span class="linenum">6125</span></a>          }
<a name="l6126"><span class="linenum">6126</span></a>      }
<a name="l6127"><span class="linenum">6127</span></a>  
<a name="l6128"><span class="linenum">6128</span></a>      <span class="comment">/**</span>
<a name="l6129"><span class="linenum">6129</span></a>  <span class="comment">     * Returns human readable context level name.</span>
<a name="l6130"><span class="linenum">6130</span></a>  <span class="comment">     *</span>
<a name="l6131"><span class="linenum">6131</span></a>  <span class="comment">     * @static</span>
<a name="l6132"><span class="linenum">6132</span></a>  <span class="comment">     * @return string the human readable context level name.</span>
<a name="l6133"><span class="linenum">6133</span></a>  <span class="comment">     */</span>
<a name="l6134"><span class="linenum">6134</span></a>      public static function <a class="function" onClick="logFunction('get_level_name')" href="../_functions/get_level_name.html" onMouseOver="funcPopup(event,'get_level_name')">get_level_name</a>() {
<a name="l6135"><span class="linenum">6135</span></a>          return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('coresystem');
<a name="l6136"><span class="linenum">6136</span></a>      }
<a name="l6137"><span class="linenum">6137</span></a>  
<a name="l6138"><span class="linenum">6138</span></a>      <span class="comment">/**</span>
<a name="l6139"><span class="linenum">6139</span></a>  <span class="comment">     * Returns human readable context identifier.</span>
<a name="l6140"><span class="linenum">6140</span></a>  <span class="comment">     *</span>
<a name="l6141"><span class="linenum">6141</span></a>  <span class="comment">     * @param boolean $withprefix does not apply to system context</span>
<a name="l6142"><span class="linenum">6142</span></a>  <span class="comment">     * @param boolean $short does not apply to system context</span>
<a name="l6143"><span class="linenum">6143</span></a>  <span class="comment">     * @return string the human readable context name.</span>
<a name="l6144"><span class="linenum">6144</span></a>  <span class="comment">     */</span>
<a name="l6145"><span class="linenum">6145</span></a>      public function <a class="function" onClick="logFunction('get_context_name')" href="../_functions/get_context_name.html" onMouseOver="funcPopup(event,'get_context_name')">get_context_name</a>(<a class="var it25263" onMouseOver="hilite(25263)" onMouseOut="lolite()" onClick="logVariable('withprefix')" href="../_variables/withprefix.html">$withprefix</a> = true, <a class="var it1725" onMouseOver="hilite(1725)" onMouseOut="lolite()" onClick="logVariable('short')" href="../_variables/short.html">$short</a> = false) {
<a name="l6146"><span class="linenum">6146</span></a>          return self::<a class="function" onClick="logFunction('get_level_name')" href="../_functions/get_level_name.html" onMouseOver="funcPopup(event,'get_level_name')">get_level_name</a>();
<a name="l6147"><span class="linenum">6147</span></a>      }
<a name="l6148"><span class="linenum">6148</span></a>  
<a name="l6149"><span class="linenum">6149</span></a>      <span class="comment">/**</span>
<a name="l6150"><span class="linenum">6150</span></a>  <span class="comment">     * Returns the most relevant URL for this context.</span>
<a name="l6151"><span class="linenum">6151</span></a>  <span class="comment">     *</span>
<a name="l6152"><span class="linenum">6152</span></a>  <span class="comment">     * @return moodle_url</span>
<a name="l6153"><span class="linenum">6153</span></a>  <span class="comment">     */</span>
<a name="l6154"><span class="linenum">6154</span></a>      public function <a class="function" onClick="logFunction('get_url')" href="../_functions/get_url.html" onMouseOver="funcPopup(event,'get_url')">get_url</a>() {
<a name="l6155"><span class="linenum">6155</span></a>          return <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('/');
<a name="l6156"><span class="linenum">6156</span></a>      }
<a name="l6157"><span class="linenum">6157</span></a>  
<a name="l6158"><span class="linenum">6158</span></a>      <span class="comment">/**</span>
<a name="l6159"><span class="linenum">6159</span></a>  <span class="comment">     * Returns array of relevant context capability records.</span>
<a name="l6160"><span class="linenum">6160</span></a>  <span class="comment">     *</span>
<a name="l6161"><span class="linenum">6161</span></a>  <span class="comment">     * @return array</span>
<a name="l6162"><span class="linenum">6162</span></a>  <span class="comment">     */</span>
<a name="l6163"><span class="linenum">6163</span></a>      public function <a class="function" onClick="logFunction('get_capabilities')" href="../_functions/get_capabilities.html" onMouseOver="funcPopup(event,'get_capabilities')">get_capabilities</a>() {
<a name="l6164"><span class="linenum">6164</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l6165"><span class="linenum">6165</span></a>  
<a name="l6166"><span class="linenum">6166</span></a>          <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a> = 'ORDER BY contextlevel,component,name';   <span class="comment">// To group them sensibly for display</span>
<a name="l6167"><span class="linenum">6167</span></a>  
<a name="l6168"><span class="linenum">6168</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array();
<a name="l6169"><span class="linenum">6169</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT *
<a name="l6170"><span class="linenum">6170</span></a>                    FROM {capabilities}&quot;;
<a name="l6171"><span class="linenum">6171</span></a>  
<a name="l6172"><span class="linenum">6172</span></a>          return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>.' '.<a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l6173"><span class="linenum">6173</span></a>      }
<a name="l6174"><span class="linenum">6174</span></a>  
<a name="l6175"><span class="linenum">6175</span></a>      <span class="comment">/**</span>
<a name="l6176"><span class="linenum">6176</span></a>  <span class="comment">     * Create missing context instances at system context</span>
<a name="l6177"><span class="linenum">6177</span></a>  <span class="comment">     * @static</span>
<a name="l6178"><span class="linenum">6178</span></a>  <span class="comment">     */</span>
<a name="l6179"><span class="linenum">6179</span></a>      protected static function <a class="function" onClick="logFunction('create_level_instances')" href="../_functions/create_level_instances.html" onMouseOver="funcPopup(event,'create_level_instances')">create_level_instances</a>() {
<a name="l6180"><span class="linenum">6180</span></a>  <span class="comment">        // nothing to do here, the system context is created automatically in installer</span>
<a name="l6181"><span class="linenum">6181</span></a>          self::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(0);
<a name="l6182"><span class="linenum">6182</span></a>      }
<a name="l6183"><span class="linenum">6183</span></a>  
<a name="l6184"><span class="linenum">6184</span></a>      <span class="comment">/**</span>
<a name="l6185"><span class="linenum">6185</span></a>  <span class="comment">     * Returns system context instance.</span>
<a name="l6186"><span class="linenum">6186</span></a>  <span class="comment">     *</span>
<a name="l6187"><span class="linenum">6187</span></a>  <span class="comment">     * @static</span>
<a name="l6188"><span class="linenum">6188</span></a>  <span class="comment">     * @param int $instanceid</span>
<a name="l6189"><span class="linenum">6189</span></a>  <span class="comment">     * @param int $strictness</span>
<a name="l6190"><span class="linenum">6190</span></a>  <span class="comment">     * @param bool $cache</span>
<a name="l6191"><span class="linenum">6191</span></a>  <span class="comment">     * @return context_system context instance</span>
<a name="l6192"><span class="linenum">6192</span></a>  <span class="comment">     */</span>
<a name="l6193"><span class="linenum">6193</span></a>      public static function <a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a> = 0, <a class="var it4662" onMouseOver="hilite(4662)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a> = <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>, <a class="var it1081" onMouseOver="hilite(1081)" onMouseOut="lolite()" onClick="logVariable('cache')" href="../_variables/cache.html">$cache</a> = true) {
<a name="l6194"><span class="linenum">6194</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l6195"><span class="linenum">6195</span></a>  
<a name="l6196"><span class="linenum">6196</span></a>          if (<a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a> != 0) {
<a name="l6197"><span class="linenum">6197</span></a>              <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('<a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(): invalid <a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../_variables/id.html">$id</a> parameter detected, should be 0');
<a name="l6198"><span class="linenum">6198</span></a>          }
<a name="l6199"><span class="linenum">6199</span></a>  
<a name="l6200"><span class="linenum">6200</span></a>          if (<a class="phpfunction" onClick="logFunction('defined')" href="../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('SYSCONTEXTID')" href="../_constants/SYSCONTEXTID.html" onMouseOver="constPopup(event,'SYSCONTEXTID')">SYSCONTEXTID</a>') and <a class="var it1081" onMouseOver="hilite(1081)" onMouseOut="lolite()" onClick="logVariable('cache')" href="../_variables/cache.html">$cache</a>) { // dangerous: define this in config.php to eliminate 1 query/page
<a name="l6201"><span class="linenum">6201</span></a>              if (!isset(context::<a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('systemcontext')" href="../_variables/systemcontext.html">$systemcontext</a>)) {
<a name="l6202"><span class="linenum">6202</span></a>                  <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = new stdClass();
<a name="l6203"><span class="linenum">6203</span></a>                  <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/id.html">id</a>           = <a class="constant" onClick="logConstant('SYSCONTEXTID')" href="../_constants/SYSCONTEXTID.html" onMouseOver="constPopup(event,'SYSCONTEXTID')">SYSCONTEXTID</a>;
<a name="l6204"><span class="linenum">6204</span></a>                  <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> = <a class="constant" onClick="logConstant('CONTEXT_SYSTEM')" href="../_constants/CONTEXT_SYSTEM.html" onMouseOver="constPopup(event,'CONTEXT_SYSTEM')">CONTEXT_SYSTEM</a>;
<a name="l6205"><span class="linenum">6205</span></a>                  <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>   = 0;
<a name="l6206"><span class="linenum">6206</span></a>                  <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('path')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/path.html">path</a>         = '/'.<a class="constant" onClick="logConstant('SYSCONTEXTID')" href="../_constants/SYSCONTEXTID.html" onMouseOver="constPopup(event,'SYSCONTEXTID')">SYSCONTEXTID</a>;
<a name="l6207"><span class="linenum">6207</span></a>                  <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('depth')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/depth.html">depth</a>        = 1;
<a name="l6208"><span class="linenum">6208</span></a>                  context::<a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('systemcontext')" href="../_variables/systemcontext.html">$systemcontext</a> = <span class="keyword">new </span><a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l6209"><span class="linenum">6209</span></a>              }
<a name="l6210"><span class="linenum">6210</span></a>              return context::<a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('systemcontext')" href="../_variables/systemcontext.html">$systemcontext</a>;
<a name="l6211"><span class="linenum">6211</span></a>          }
<a name="l6212"><span class="linenum">6212</span></a>  
<a name="l6213"><span class="linenum">6213</span></a>  
<a name="l6214"><span class="linenum">6214</span></a>          try {
<a name="l6215"><span class="linenum">6215</span></a>  <span class="comment">            // We ignore the strictness completely because system context must exist except during install.</span>
<a name="l6216"><span class="linenum">6216</span></a>              <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('context', array('contextlevel'=&gt;<a class="constant" onClick="logConstant('CONTEXT_SYSTEM')" href="../_constants/CONTEXT_SYSTEM.html" onMouseOver="constPopup(event,'CONTEXT_SYSTEM')">CONTEXT_SYSTEM</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l6217"><span class="linenum">6217</span></a>          } catch (dml_exception <a class="var it193" onMouseOver="hilite(193)" onMouseOut="lolite()" onClick="logVariable('e')" href="../_variables/e.html">$e</a>) {
<a name="l6218"><span class="linenum">6218</span></a>  <span class="comment">            //table or record does not exist</span>
<a name="l6219"><span class="linenum">6219</span></a>              if (!<a class="function" onClick="logFunction('during_initial_install')" href="../_functions/during_initial_install.html" onMouseOver="funcPopup(event,'during_initial_install')">during_initial_install</a>()) {
<a name="l6220"><span class="linenum">6220</span></a>  <span class="comment">                // do not mess with system context after install, it simply must exist</span>
<a name="l6221"><span class="linenum">6221</span></a>                  throw <a class="var it193" onMouseOver="hilite(193)" onMouseOut="lolite()" onClick="logVariable('e')" href="../_variables/e.html">$e</a>;
<a name="l6222"><span class="linenum">6222</span></a>              }
<a name="l6223"><span class="linenum">6223</span></a>              <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = null;
<a name="l6224"><span class="linenum">6224</span></a>          }
<a name="l6225"><span class="linenum">6225</span></a>  
<a name="l6226"><span class="linenum">6226</span></a>          if (!<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>) {
<a name="l6227"><span class="linenum">6227</span></a>              <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = new stdClass();
<a name="l6228"><span class="linenum">6228</span></a>              <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> = <a class="constant" onClick="logConstant('CONTEXT_SYSTEM')" href="../_constants/CONTEXT_SYSTEM.html" onMouseOver="constPopup(event,'CONTEXT_SYSTEM')">CONTEXT_SYSTEM</a>;
<a name="l6229"><span class="linenum">6229</span></a>              <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a>   = 0;
<a name="l6230"><span class="linenum">6230</span></a>              <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('depth')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/depth.html">depth</a>        = 1;
<a name="l6231"><span class="linenum">6231</span></a>              <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('path')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/path.html">path</a>         = null; <span class="comment">//not known before insert</span>
<a name="l6232"><span class="linenum">6232</span></a>  
<a name="l6233"><span class="linenum">6233</span></a>              try {
<a name="l6234"><span class="linenum">6234</span></a>                  if (<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records')" href="../_functions/count_records.html" onMouseOver="funcPopup(event,'count_records')">count_records</a>('context')) {
<a name="l6235"><span class="linenum">6235</span></a>  <span class="comment">                    // contexts already exist, this is very weird, system must be first!!!</span>
<a name="l6236"><span class="linenum">6236</span></a>                      return null;
<a name="l6237"><span class="linenum">6237</span></a>                  }
<a name="l6238"><span class="linenum">6238</span></a>                  if (<a class="phpfunction" onClick="logFunction('defined')" href="../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('SYSCONTEXTID')" href="../_constants/SYSCONTEXTID.html" onMouseOver="constPopup(event,'SYSCONTEXTID')">SYSCONTEXTID</a>')) {
<a name="l6239"><span class="linenum">6239</span></a>  <span class="comment">                    // this would happen only in unittest on sites that went through weird 1.7 upgrade</span>
<a name="l6240"><span class="linenum">6240</span></a>                      <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/id.html">id</a> = <a class="constant" onClick="logConstant('SYSCONTEXTID')" href="../_constants/SYSCONTEXTID.html" onMouseOver="constPopup(event,'SYSCONTEXTID')">SYSCONTEXTID</a>;
<a name="l6241"><span class="linenum">6241</span></a>                      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('import_record')" href="../_functions/import_record.html" onMouseOver="funcPopup(event,'import_record')">import_record</a>('context', <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l6242"><span class="linenum">6242</span></a>                      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_manager')" href="../_functions/get_manager.html" onMouseOver="funcPopup(event,'get_manager')">get_manager</a>()-&gt;<a class="function" onClick="logFunction('reset_sequence')" href="../_functions/reset_sequence.html" onMouseOver="funcPopup(event,'reset_sequence')">reset_sequence</a>('context');
<a name="l6243"><span class="linenum">6243</span></a>                  } else {
<a name="l6244"><span class="linenum">6244</span></a>                      <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/id.html">id</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('context', <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l6245"><span class="linenum">6245</span></a>                  }
<a name="l6246"><span class="linenum">6246</span></a>              } catch (dml_exception <a class="var it193" onMouseOver="hilite(193)" onMouseOut="lolite()" onClick="logVariable('e')" href="../_variables/e.html">$e</a>) {
<a name="l6247"><span class="linenum">6247</span></a>  <span class="comment">                // can not create context - table does not exist yet, sorry</span>
<a name="l6248"><span class="linenum">6248</span></a>                  return null;
<a name="l6249"><span class="linenum">6249</span></a>              }
<a name="l6250"><span class="linenum">6250</span></a>          }
<a name="l6251"><span class="linenum">6251</span></a>  
<a name="l6252"><span class="linenum">6252</span></a>          if (<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a> != 0) {
<a name="l6253"><span class="linenum">6253</span></a>  <span class="comment">            // this is very weird, somebody must be messing with context table</span>
<a name="l6254"><span class="linenum">6254</span></a>              <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Invalid system context detected');
<a name="l6255"><span class="linenum">6255</span></a>          }
<a name="l6256"><span class="linenum">6256</span></a>  
<a name="l6257"><span class="linenum">6257</span></a>          if (<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('depth')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/depth.html">depth</a> != 1 or <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('path')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/path.html">path</a> != '/'.<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) {
<a name="l6258"><span class="linenum">6258</span></a>  <span class="comment">            // fix path if necessary, initial install or path reset</span>
<a name="l6259"><span class="linenum">6259</span></a>              <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('depth')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/depth.html">depth</a> = 1;
<a name="l6260"><span class="linenum">6260</span></a>              <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('path')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/path.html">path</a>  = '/'.<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l6261"><span class="linenum">6261</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('context', <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l6262"><span class="linenum">6262</span></a>          }
<a name="l6263"><span class="linenum">6263</span></a>  
<a name="l6264"><span class="linenum">6264</span></a>          if (!<a class="phpfunction" onClick="logFunction('defined')" href="../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('SYSCONTEXTID')" href="../_constants/SYSCONTEXTID.html" onMouseOver="constPopup(event,'SYSCONTEXTID')">SYSCONTEXTID</a>')) {
<a name="l6265"><span class="linenum">6265</span></a>              <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('SYSCONTEXTID')" href="../_constants/SYSCONTEXTID.html" onMouseOver="constPopup(event,'SYSCONTEXTID')">SYSCONTEXTID</a>', <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l6266"><span class="linenum">6266</span></a>          }
<a name="l6267"><span class="linenum">6267</span></a>  
<a name="l6268"><span class="linenum">6268</span></a>          context::<a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('systemcontext')" href="../_variables/systemcontext.html">$systemcontext</a> = <span class="keyword">new </span><a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l6269"><span class="linenum">6269</span></a>          return context::<a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('systemcontext')" href="../_variables/systemcontext.html">$systemcontext</a>;
<a name="l6270"><span class="linenum">6270</span></a>      }
<a name="l6271"><span class="linenum">6271</span></a>  
<a name="l6272"><span class="linenum">6272</span></a>      <span class="comment">/**</span>
<a name="l6273"><span class="linenum">6273</span></a>  <span class="comment">     * Returns all site contexts except the system context, DO NOT call on production servers!!</span>
<a name="l6274"><span class="linenum">6274</span></a>  <span class="comment">     *</span>
<a name="l6275"><span class="linenum">6275</span></a>  <span class="comment">     * Contexts are not cached.</span>
<a name="l6276"><span class="linenum">6276</span></a>  <span class="comment">     *</span>
<a name="l6277"><span class="linenum">6277</span></a>  <span class="comment">     * @return array</span>
<a name="l6278"><span class="linenum">6278</span></a>  <span class="comment">     */</span>
<a name="l6279"><span class="linenum">6279</span></a>      public function <a class="function" onClick="logFunction('get_child_contexts')" href="../_functions/get_child_contexts.html" onMouseOver="funcPopup(event,'get_child_contexts')">get_child_contexts</a>() {
<a name="l6280"><span class="linenum">6280</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l6281"><span class="linenum">6281</span></a>  
<a name="l6282"><span class="linenum">6282</span></a>          <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Fetching of system context child courses is strongly discouraged on production servers (it may eat all available memory)!');
<a name="l6283"><span class="linenum">6283</span></a>  
<a name="l6284"><span class="linenum">6284</span></a>  <span class="comment">        // Just get all the contexts except for CONTEXT_SYSTEM level</span>
<a name="l6285"><span class="linenum">6285</span></a>  <span class="comment">        // and hope we don't OOM in the process - don't cache</span>
<a name="l6286"><span class="linenum">6286</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT c.*
<a name="l6287"><span class="linenum">6287</span></a>                    FROM {context} c
<a name="l6288"><span class="linenum">6288</span></a>                   WHERE contextlevel &gt; &quot;.<a class="constant" onClick="logConstant('CONTEXT_SYSTEM')" href="../_constants/CONTEXT_SYSTEM.html" onMouseOver="constPopup(event,'CONTEXT_SYSTEM')">CONTEXT_SYSTEM</a>;
<a name="l6289"><span class="linenum">6289</span></a>          <a class="var it2579" onMouseOver="hilite(2579)" onMouseOut="lolite()" onClick="logVariable('records')" href="../_variables/records.html">$records</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>);
<a name="l6290"><span class="linenum">6290</span></a>  
<a name="l6291"><span class="linenum">6291</span></a>          <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a> = array();
<a name="l6292"><span class="linenum">6292</span></a>          foreach (<a class="var it2579" onMouseOver="hilite(2579)" onMouseOut="lolite()" onClick="logVariable('records')" href="../_variables/records.html">$records</a> as <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>) {
<a name="l6293"><span class="linenum">6293</span></a>              <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>[<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = context::<a class="function" onClick="logFunction('create_instance_from_record')" href="../_functions/create_instance_from_record.html" onMouseOver="funcPopup(event,'create_instance_from_record')">create_instance_from_record</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l6294"><span class="linenum">6294</span></a>          }
<a name="l6295"><span class="linenum">6295</span></a>  
<a name="l6296"><span class="linenum">6296</span></a>          return <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>;
<a name="l6297"><span class="linenum">6297</span></a>      }
<a name="l6298"><span class="linenum">6298</span></a>  
<a name="l6299"><span class="linenum">6299</span></a>      <span class="comment">/**</span>
<a name="l6300"><span class="linenum">6300</span></a>  <span class="comment">     * Returns sql necessary for purging of stale context instances.</span>
<a name="l6301"><span class="linenum">6301</span></a>  <span class="comment">     *</span>
<a name="l6302"><span class="linenum">6302</span></a>  <span class="comment">     * @static</span>
<a name="l6303"><span class="linenum">6303</span></a>  <span class="comment">     * @return string cleanup SQL</span>
<a name="l6304"><span class="linenum">6304</span></a>  <span class="comment">     */</span>
<a name="l6305"><span class="linenum">6305</span></a>      protected static function <a class="function" onClick="logFunction('get_cleanup_sql')" href="../_functions/get_cleanup_sql.html" onMouseOver="funcPopup(event,'get_cleanup_sql')">get_cleanup_sql</a>() {
<a name="l6306"><span class="linenum">6306</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;
<a name="l6307"><span class="linenum">6307</span></a>                    SELECT c.*
<a name="l6308"><span class="linenum">6308</span></a>                      FROM {context} c
<a name="l6309"><span class="linenum">6309</span></a>                     WHERE 1=2
<a name="l6310"><span class="linenum">6310</span></a>                 &quot;;
<a name="l6311"><span class="linenum">6311</span></a>  
<a name="l6312"><span class="linenum">6312</span></a>          return <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>;
<a name="l6313"><span class="linenum">6313</span></a>      }
<a name="l6314"><span class="linenum">6314</span></a>  
<a name="l6315"><span class="linenum">6315</span></a>      <span class="comment">/**</span>
<a name="l6316"><span class="linenum">6316</span></a>  <span class="comment">     * Rebuild context paths and depths at system context level.</span>
<a name="l6317"><span class="linenum">6317</span></a>  <span class="comment">     *</span>
<a name="l6318"><span class="linenum">6318</span></a>  <span class="comment">     * @static</span>
<a name="l6319"><span class="linenum">6319</span></a>  <span class="comment">     * @param bool $force</span>
<a name="l6320"><span class="linenum">6320</span></a>  <span class="comment">     */</span>
<a name="l6321"><span class="linenum">6321</span></a>      protected static function <a class="function" onClick="logFunction('build_paths')" href="../_functions/build_paths.html" onMouseOver="funcPopup(event,'build_paths')">build_paths</a>(<a class="var it5797" onMouseOver="hilite(5797)" onMouseOut="lolite()" onClick="logVariable('force')" href="../_variables/force.html">$force</a>) {
<a name="l6322"><span class="linenum">6322</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l6323"><span class="linenum">6323</span></a>  
<a name="l6324"><span class="linenum">6324</span></a>  <span class="comment">        /* note: ignore $force here, we always do full test of system context */</span>
<a name="l6325"><span class="linenum">6325</span></a>  
<a name="l6326"><span class="linenum">6326</span></a>  <span class="comment">        // exactly one record must exist</span>
<a name="l6327"><span class="linenum">6327</span></a>          <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('context', array('contextlevel'=&gt;<a class="constant" onClick="logConstant('CONTEXT_SYSTEM')" href="../_constants/CONTEXT_SYSTEM.html" onMouseOver="constPopup(event,'CONTEXT_SYSTEM')">CONTEXT_SYSTEM</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l6328"><span class="linenum">6328</span></a>  
<a name="l6329"><span class="linenum">6329</span></a>          if (<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a> != 0) {
<a name="l6330"><span class="linenum">6330</span></a>              <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Invalid system context detected');
<a name="l6331"><span class="linenum">6331</span></a>          }
<a name="l6332"><span class="linenum">6332</span></a>  
<a name="l6333"><span class="linenum">6333</span></a>          if (<a class="phpfunction" onClick="logFunction('defined')" href="../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('SYSCONTEXTID')" href="../_constants/SYSCONTEXTID.html" onMouseOver="constPopup(event,'SYSCONTEXTID')">SYSCONTEXTID</a>') and <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/id.html">id</a> != <a class="constant" onClick="logConstant('SYSCONTEXTID')" href="../_constants/SYSCONTEXTID.html" onMouseOver="constPopup(event,'SYSCONTEXTID')">SYSCONTEXTID</a>) {
<a name="l6334"><span class="linenum">6334</span></a>              <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Invalid <a class="constant" onClick="logConstant('SYSCONTEXTID')" href="../_constants/SYSCONTEXTID.html" onMouseOver="constPopup(event,'SYSCONTEXTID')">SYSCONTEXTID</a> detected');
<a name="l6335"><span class="linenum">6335</span></a>          }
<a name="l6336"><span class="linenum">6336</span></a>  
<a name="l6337"><span class="linenum">6337</span></a>          if (<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('depth')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/depth.html">depth</a> != 1 or <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('path')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/path.html">path</a> != '/'.<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) {
<a name="l6338"><span class="linenum">6338</span></a>  <span class="comment">            // fix path if necessary, initial install or path reset</span>
<a name="l6339"><span class="linenum">6339</span></a>              <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('depth')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/depth.html">depth</a>    = 1;
<a name="l6340"><span class="linenum">6340</span></a>              <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('path')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/path.html">path</a>     = '/'.<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l6341"><span class="linenum">6341</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('context', <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l6342"><span class="linenum">6342</span></a>          }
<a name="l6343"><span class="linenum">6343</span></a>      }
<a name="l6344"><span class="linenum">6344</span></a>  }
<a name="l6345"><span class="linenum">6345</span></a>  
<a name="l6346"><span class="linenum">6346</span></a>  
<a name="l6347"><span class="linenum">6347</span></a>  <span class="comment">/**</span>
<a name="l6348"><span class="linenum">6348</span></a>  <span class="comment"> * User context class</span>
<a name="l6349"><span class="linenum">6349</span></a>  <span class="comment"> *</span>
<a name="l6350"><span class="linenum">6350</span></a>  <span class="comment"> * @package   core_access</span>
<a name="l6351"><span class="linenum">6351</span></a>  <span class="comment"> * @category  access</span>
<a name="l6352"><span class="linenum">6352</span></a>  <span class="comment"> * @copyright Petr Skoda {@link http://skodak.org}</span>
<a name="l6353"><span class="linenum">6353</span></a>  <span class="comment"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l6354"><span class="linenum">6354</span></a>  <span class="comment"> * @since     Moodle 2.2</span>
<a name="l6355"><span class="linenum">6355</span></a>  <span class="comment"> */</span>
<a name="l6356"><span class="linenum">6356</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('context_user')" href="../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a> extends context {
<a name="l6357"><span class="linenum">6357</span></a>      <span class="comment">/**</span>
<a name="l6358"><span class="linenum">6358</span></a>  <span class="comment">     * Please use context_user::instance($userid) if you need the instance of context.</span>
<a name="l6359"><span class="linenum">6359</span></a>  <span class="comment">     * Alternatively if you know only the context id use context::instance_by_id($contextid)</span>
<a name="l6360"><span class="linenum">6360</span></a>  <span class="comment">     *</span>
<a name="l6361"><span class="linenum">6361</span></a>  <span class="comment">     * @param stdClass $record</span>
<a name="l6362"><span class="linenum">6362</span></a>  <span class="comment">     */</span>
<a name="l6363"><span class="linenum">6363</span></a>      protected function <a class="function" onClick="logFunction('__construct')" href="../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>(stdClass <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>) {
<a name="l6364"><span class="linenum">6364</span></a>          parent::<a class="function" onClick="logFunction('__construct')" href="../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l6365"><span class="linenum">6365</span></a>          if (<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> != <a class="constant" onClick="logConstant('CONTEXT_USER')" href="../_constants/CONTEXT_USER.html" onMouseOver="constPopup(event,'CONTEXT_USER')">CONTEXT_USER</a>) {
<a name="l6366"><span class="linenum">6366</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> in context_user constructor.');
<a name="l6367"><span class="linenum">6367</span></a>          }
<a name="l6368"><span class="linenum">6368</span></a>      }
<a name="l6369"><span class="linenum">6369</span></a>  
<a name="l6370"><span class="linenum">6370</span></a>      <span class="comment">/**</span>
<a name="l6371"><span class="linenum">6371</span></a>  <span class="comment">     * Returns human readable context level name.</span>
<a name="l6372"><span class="linenum">6372</span></a>  <span class="comment">     *</span>
<a name="l6373"><span class="linenum">6373</span></a>  <span class="comment">     * @static</span>
<a name="l6374"><span class="linenum">6374</span></a>  <span class="comment">     * @return string the human readable context level name.</span>
<a name="l6375"><span class="linenum">6375</span></a>  <span class="comment">     */</span>
<a name="l6376"><span class="linenum">6376</span></a>      public static function <a class="function" onClick="logFunction('get_level_name')" href="../_functions/get_level_name.html" onMouseOver="funcPopup(event,'get_level_name')">get_level_name</a>() {
<a name="l6377"><span class="linenum">6377</span></a>          return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('user');
<a name="l6378"><span class="linenum">6378</span></a>      }
<a name="l6379"><span class="linenum">6379</span></a>  
<a name="l6380"><span class="linenum">6380</span></a>      <span class="comment">/**</span>
<a name="l6381"><span class="linenum">6381</span></a>  <span class="comment">     * Returns human readable context identifier.</span>
<a name="l6382"><span class="linenum">6382</span></a>  <span class="comment">     *</span>
<a name="l6383"><span class="linenum">6383</span></a>  <span class="comment">     * @param boolean $withprefix whether to prefix the name of the context with User</span>
<a name="l6384"><span class="linenum">6384</span></a>  <span class="comment">     * @param boolean $short does not apply to user context</span>
<a name="l6385"><span class="linenum">6385</span></a>  <span class="comment">     * @return string the human readable context name.</span>
<a name="l6386"><span class="linenum">6386</span></a>  <span class="comment">     */</span>
<a name="l6387"><span class="linenum">6387</span></a>      public function <a class="function" onClick="logFunction('get_context_name')" href="../_functions/get_context_name.html" onMouseOver="funcPopup(event,'get_context_name')">get_context_name</a>(<a class="var it25263" onMouseOver="hilite(25263)" onMouseOut="lolite()" onClick="logVariable('withprefix')" href="../_variables/withprefix.html">$withprefix</a> = true, <a class="var it1725" onMouseOver="hilite(1725)" onMouseOut="lolite()" onClick="logVariable('short')" href="../_variables/short.html">$short</a> = false) {
<a name="l6388"><span class="linenum">6388</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l6389"><span class="linenum">6389</span></a>  
<a name="l6390"><span class="linenum">6390</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = '';
<a name="l6391"><span class="linenum">6391</span></a>          if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_instanceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_instanceid.html">_instanceid</a>, 'deleted'=&gt;0))) {
<a name="l6392"><span class="linenum">6392</span></a>              if (<a class="var it25263" onMouseOver="hilite(25263)" onMouseOut="lolite()" onClick="logVariable('withprefix')" href="../_variables/withprefix.html">$withprefix</a>){
<a name="l6393"><span class="linenum">6393</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('user').': ';
<a name="l6394"><span class="linenum">6394</span></a>              }
<a name="l6395"><span class="linenum">6395</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> .= <a class="function" onClick="logFunction('fullname')" href="../_functions/fullname.html" onMouseOver="funcPopup(event,'fullname')">fullname</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l6396"><span class="linenum">6396</span></a>          }
<a name="l6397"><span class="linenum">6397</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>;
<a name="l6398"><span class="linenum">6398</span></a>      }
<a name="l6399"><span class="linenum">6399</span></a>  
<a name="l6400"><span class="linenum">6400</span></a>      <span class="comment">/**</span>
<a name="l6401"><span class="linenum">6401</span></a>  <span class="comment">     * Returns the most relevant URL for this context.</span>
<a name="l6402"><span class="linenum">6402</span></a>  <span class="comment">     *</span>
<a name="l6403"><span class="linenum">6403</span></a>  <span class="comment">     * @return moodle_url</span>
<a name="l6404"><span class="linenum">6404</span></a>  <span class="comment">     */</span>
<a name="l6405"><span class="linenum">6405</span></a>      public function <a class="function" onClick="logFunction('get_url')" href="../_functions/get_url.html" onMouseOver="funcPopup(event,'get_url')">get_url</a>() {
<a name="l6406"><span class="linenum">6406</span></a>          global <a class="var it2554" onMouseOver="hilite(2554)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../_variables/COURSE.html">$COURSE</a>;
<a name="l6407"><span class="linenum">6407</span></a>  
<a name="l6408"><span class="linenum">6408</span></a>          if (<a class="var it2554" onMouseOver="hilite(2554)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../_variables/COURSE.html">$COURSE</a>-&gt;<a onClick="logVariable('id')" class="var it39504" onMouseOver="hilite(39504)" onMouseOut="lolite()" href="../_variables/id.html">id</a> == <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>) {
<a name="l6409"><span class="linenum">6409</span></a>              <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../user/profile.php.html">/user/profile.php</a>', array('id'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_instanceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_instanceid.html">_instanceid</a>));
<a name="l6410"><span class="linenum">6410</span></a>          } else {
<a name="l6411"><span class="linenum">6411</span></a>              <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a> = <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../user/view.php.html">/user/view.php</a>', array('id'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_instanceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_instanceid.html">_instanceid</a>, 'courseid'=&gt;<a class="var it2554" onMouseOver="hilite(2554)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../_variables/COURSE.html">$COURSE</a>-&gt;<a onClick="logVariable('id')" class="var it39504" onMouseOver="hilite(39504)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l6412"><span class="linenum">6412</span></a>          }
<a name="l6413"><span class="linenum">6413</span></a>          return <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('url')" href="../_variables/url.html">$url</a>;
<a name="l6414"><span class="linenum">6414</span></a>      }
<a name="l6415"><span class="linenum">6415</span></a>  
<a name="l6416"><span class="linenum">6416</span></a>      <span class="comment">/**</span>
<a name="l6417"><span class="linenum">6417</span></a>  <span class="comment">     * Returns array of relevant context capability records.</span>
<a name="l6418"><span class="linenum">6418</span></a>  <span class="comment">     *</span>
<a name="l6419"><span class="linenum">6419</span></a>  <span class="comment">     * @return array</span>
<a name="l6420"><span class="linenum">6420</span></a>  <span class="comment">     */</span>
<a name="l6421"><span class="linenum">6421</span></a>      public function <a class="function" onClick="logFunction('get_capabilities')" href="../_functions/get_capabilities.html" onMouseOver="funcPopup(event,'get_capabilities')">get_capabilities</a>() {
<a name="l6422"><span class="linenum">6422</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l6423"><span class="linenum">6423</span></a>  
<a name="l6424"><span class="linenum">6424</span></a>          <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a> = 'ORDER BY contextlevel,component,name';   <span class="comment">// To group them sensibly for display</span>
<a name="l6425"><span class="linenum">6425</span></a>  
<a name="l6426"><span class="linenum">6426</span></a>          <a class="var it28908" onMouseOver="hilite(28908)" onMouseOut="lolite()" onClick="logVariable('extracaps')" href="../_variables/extracaps.html">$extracaps</a> = array('moodle/grade:viewall');
<a name="l6427"><span class="linenum">6427</span></a>          <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it2018" onMouseOver="hilite(2018)" onMouseOut="lolite()" onClick="logVariable('extra')" href="../_variables/extra.html">$extra</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it28908" onMouseOver="hilite(28908)" onMouseOut="lolite()" onClick="logVariable('extracaps')" href="../_variables/extracaps.html">$extracaps</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'cap');
<a name="l6428"><span class="linenum">6428</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT *
<a name="l6429"><span class="linenum">6429</span></a>                    FROM {capabilities}
<a name="l6430"><span class="linenum">6430</span></a>                   WHERE contextlevel = &quot;.<a class="constant" onClick="logConstant('CONTEXT_USER')" href="../_constants/CONTEXT_USER.html" onMouseOver="constPopup(event,'CONTEXT_USER')">CONTEXT_USER</a>.&quot;
<a name="l6431"><span class="linenum">6431</span></a>                         OR name <a class="var it2018" onMouseOver="hilite(2018)" onMouseOut="lolite()" onClick="logVariable('extra')" href="../_variables/extra.html">$extra</a>&quot;;
<a name="l6432"><span class="linenum">6432</span></a>  
<a name="l6433"><span class="linenum">6433</span></a>          return <a class="var it2579" onMouseOver="hilite(2579)" onMouseOut="lolite()" onClick="logVariable('records')" href="../_variables/records.html">$records</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>.' '.<a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l6434"><span class="linenum">6434</span></a>      }
<a name="l6435"><span class="linenum">6435</span></a>  
<a name="l6436"><span class="linenum">6436</span></a>      <span class="comment">/**</span>
<a name="l6437"><span class="linenum">6437</span></a>  <span class="comment">     * Returns user context instance.</span>
<a name="l6438"><span class="linenum">6438</span></a>  <span class="comment">     *</span>
<a name="l6439"><span class="linenum">6439</span></a>  <span class="comment">     * @static</span>
<a name="l6440"><span class="linenum">6440</span></a>  <span class="comment">     * @param int $instanceid</span>
<a name="l6441"><span class="linenum">6441</span></a>  <span class="comment">     * @param int $strictness</span>
<a name="l6442"><span class="linenum">6442</span></a>  <span class="comment">     * @return context_user context instance</span>
<a name="l6443"><span class="linenum">6443</span></a>  <span class="comment">     */</span>
<a name="l6444"><span class="linenum">6444</span></a>      public static function <a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>, <a class="var it4662" onMouseOver="hilite(4662)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a> = <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>) {
<a name="l6445"><span class="linenum">6445</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l6446"><span class="linenum">6446</span></a>  
<a name="l6447"><span class="linenum">6447</span></a>          if (<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = context::<a class="function" onClick="logFunction('cache_get')" href="../_functions/cache_get.html" onMouseOver="funcPopup(event,'cache_get')">cache_get</a>(<a class="constant" onClick="logConstant('CONTEXT_USER')" href="../_constants/CONTEXT_USER.html" onMouseOver="constPopup(event,'CONTEXT_USER')">CONTEXT_USER</a>, <a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>)) {
<a name="l6448"><span class="linenum">6448</span></a>              return <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>;
<a name="l6449"><span class="linenum">6449</span></a>          }
<a name="l6450"><span class="linenum">6450</span></a>  
<a name="l6451"><span class="linenum">6451</span></a>          if (!<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('context', array('contextlevel'=&gt;<a class="constant" onClick="logConstant('CONTEXT_USER')" href="../_constants/CONTEXT_USER.html" onMouseOver="constPopup(event,'CONTEXT_USER')">CONTEXT_USER</a>, 'instanceid'=&gt;<a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>))) {
<a name="l6452"><span class="linenum">6452</span></a>              if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id'=&gt;<a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>, 'deleted'=&gt;0), 'id', <a class="var it4662" onMouseOver="hilite(4662)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a>)) {
<a name="l6453"><span class="linenum">6453</span></a>                  <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = context::<a class="function" onClick="logFunction('insert_context_record')" href="../_functions/insert_context_record.html" onMouseOver="funcPopup(event,'insert_context_record')">insert_context_record</a>(<a class="constant" onClick="logConstant('CONTEXT_USER')" href="../_constants/CONTEXT_USER.html" onMouseOver="constPopup(event,'CONTEXT_USER')">CONTEXT_USER</a>, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, '/'.<a class="constant" onClick="logConstant('SYSCONTEXTID')" href="../_constants/SYSCONTEXTID.html" onMouseOver="constPopup(event,'SYSCONTEXTID')">SYSCONTEXTID</a>, 0);
<a name="l6454"><span class="linenum">6454</span></a>              }
<a name="l6455"><span class="linenum">6455</span></a>          }
<a name="l6456"><span class="linenum">6456</span></a>  
<a name="l6457"><span class="linenum">6457</span></a>          if (<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>) {
<a name="l6458"><span class="linenum">6458</span></a>              <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <span class="keyword">new </span><a class="class" onClick="logClass('context_user')" href="../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l6459"><span class="linenum">6459</span></a>              context::<a class="function" onClick="logFunction('cache_add')" href="../_functions/cache_add.html" onMouseOver="funcPopup(event,'cache_add')">cache_add</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l6460"><span class="linenum">6460</span></a>              return <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>;
<a name="l6461"><span class="linenum">6461</span></a>          }
<a name="l6462"><span class="linenum">6462</span></a>  
<a name="l6463"><span class="linenum">6463</span></a>          return false;
<a name="l6464"><span class="linenum">6464</span></a>      }
<a name="l6465"><span class="linenum">6465</span></a>  
<a name="l6466"><span class="linenum">6466</span></a>      <span class="comment">/**</span>
<a name="l6467"><span class="linenum">6467</span></a>  <span class="comment">     * Create missing context instances at user context level</span>
<a name="l6468"><span class="linenum">6468</span></a>  <span class="comment">     * @static</span>
<a name="l6469"><span class="linenum">6469</span></a>  <span class="comment">     */</span>
<a name="l6470"><span class="linenum">6470</span></a>      protected static function <a class="function" onClick="logFunction('create_level_instances')" href="../_functions/create_level_instances.html" onMouseOver="funcPopup(event,'create_level_instances')">create_level_instances</a>() {
<a name="l6471"><span class="linenum">6471</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l6472"><span class="linenum">6472</span></a>  
<a name="l6473"><span class="linenum">6473</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT &quot;.<a class="constant" onClick="logConstant('CONTEXT_USER')" href="../_constants/CONTEXT_USER.html" onMouseOver="constPopup(event,'CONTEXT_USER')">CONTEXT_USER</a>.&quot;, u.id
<a name="l6474"><span class="linenum">6474</span></a>                    FROM {user} u
<a name="l6475"><span class="linenum">6475</span></a>                   WHERE u.deleted = 0
<a name="l6476"><span class="linenum">6476</span></a>                         AND NOT <a class="function" onClick="logFunction('EXISTS')" href="../_functions/exists.html" onMouseOver="funcPopup(event,'exists')">EXISTS</a> (SELECT 'x'
<a name="l6477"><span class="linenum">6477</span></a>                                           FROM {context} cx
<a name="l6478"><span class="linenum">6478</span></a>                                          WHERE u.id = cx.instanceid AND cx.contextlevel=&quot;.<a class="constant" onClick="logConstant('CONTEXT_USER')" href="../_constants/CONTEXT_USER.html" onMouseOver="constPopup(event,'CONTEXT_USER')">CONTEXT_USER</a>.&quot;)&quot;;
<a name="l6479"><span class="linenum">6479</span></a>          <a class="var it28909" onMouseOver="hilite(28909)" onMouseOut="lolite()" onClick="logVariable('contextdata')" href="../_variables/contextdata.html">$contextdata</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>);
<a name="l6480"><span class="linenum">6480</span></a>          foreach (<a class="var it28909" onMouseOver="hilite(28909)" onMouseOut="lolite()" onClick="logVariable('contextdata')" href="../_variables/contextdata.html">$contextdata</a> as <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l6481"><span class="linenum">6481</span></a>              context::<a class="function" onClick="logFunction('insert_context_record')" href="../_functions/insert_context_record.html" onMouseOver="funcPopup(event,'insert_context_record')">insert_context_record</a>(<a class="constant" onClick="logConstant('CONTEXT_USER')" href="../_constants/CONTEXT_USER.html" onMouseOver="constPopup(event,'CONTEXT_USER')">CONTEXT_USER</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, null);
<a name="l6482"><span class="linenum">6482</span></a>          }
<a name="l6483"><span class="linenum">6483</span></a>          <a class="var it28909" onMouseOver="hilite(28909)" onMouseOut="lolite()" onClick="logVariable('contextdata')" href="../_variables/contextdata.html">$contextdata</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l6484"><span class="linenum">6484</span></a>      }
<a name="l6485"><span class="linenum">6485</span></a>  
<a name="l6486"><span class="linenum">6486</span></a>      <span class="comment">/**</span>
<a name="l6487"><span class="linenum">6487</span></a>  <span class="comment">     * Returns sql necessary for purging of stale context instances.</span>
<a name="l6488"><span class="linenum">6488</span></a>  <span class="comment">     *</span>
<a name="l6489"><span class="linenum">6489</span></a>  <span class="comment">     * @static</span>
<a name="l6490"><span class="linenum">6490</span></a>  <span class="comment">     * @return string cleanup SQL</span>
<a name="l6491"><span class="linenum">6491</span></a>  <span class="comment">     */</span>
<a name="l6492"><span class="linenum">6492</span></a>      protected static function <a class="function" onClick="logFunction('get_cleanup_sql')" href="../_functions/get_cleanup_sql.html" onMouseOver="funcPopup(event,'get_cleanup_sql')">get_cleanup_sql</a>() {
<a name="l6493"><span class="linenum">6493</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;
<a name="l6494"><span class="linenum">6494</span></a>                    SELECT c.*
<a name="l6495"><span class="linenum">6495</span></a>                      FROM {context} c
<a name="l6496"><span class="linenum">6496</span></a>           LEFT OUTER JOIN {user} u <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (c.instanceid = u.id AND u.deleted = 0)
<a name="l6497"><span class="linenum">6497</span></a>                     WHERE u.id IS NULL AND c.contextlevel = &quot;.<a class="constant" onClick="logConstant('CONTEXT_USER')" href="../_constants/CONTEXT_USER.html" onMouseOver="constPopup(event,'CONTEXT_USER')">CONTEXT_USER</a>.&quot;
<a name="l6498"><span class="linenum">6498</span></a>                 &quot;;
<a name="l6499"><span class="linenum">6499</span></a>  
<a name="l6500"><span class="linenum">6500</span></a>          return <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>;
<a name="l6501"><span class="linenum">6501</span></a>      }
<a name="l6502"><span class="linenum">6502</span></a>  
<a name="l6503"><span class="linenum">6503</span></a>      <span class="comment">/**</span>
<a name="l6504"><span class="linenum">6504</span></a>  <span class="comment">     * Rebuild context paths and depths at user context level.</span>
<a name="l6505"><span class="linenum">6505</span></a>  <span class="comment">     *</span>
<a name="l6506"><span class="linenum">6506</span></a>  <span class="comment">     * @static</span>
<a name="l6507"><span class="linenum">6507</span></a>  <span class="comment">     * @param bool $force</span>
<a name="l6508"><span class="linenum">6508</span></a>  <span class="comment">     */</span>
<a name="l6509"><span class="linenum">6509</span></a>      protected static function <a class="function" onClick="logFunction('build_paths')" href="../_functions/build_paths.html" onMouseOver="funcPopup(event,'build_paths')">build_paths</a>(<a class="var it5797" onMouseOver="hilite(5797)" onMouseOut="lolite()" onClick="logVariable('force')" href="../_variables/force.html">$force</a>) {
<a name="l6510"><span class="linenum">6510</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l6511"><span class="linenum">6511</span></a>  
<a name="l6512"><span class="linenum">6512</span></a>  <span class="comment">        // First update normal users.</span>
<a name="l6513"><span class="linenum">6513</span></a>          <a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_concat')" href="../_functions/sql_concat.html" onMouseOver="funcPopup(event,'sql_concat')">sql_concat</a>('?', 'id');
<a name="l6514"><span class="linenum">6514</span></a>          <a class="var it28910" onMouseOver="hilite(28910)" onMouseOut="lolite()" onClick="logVariable('pathstart')" href="../_variables/pathstart.html">$pathstart</a> = '/' . <a class="constant" onClick="logConstant('SYSCONTEXTID')" href="../_constants/SYSCONTEXTID.html" onMouseOver="constPopup(event,'SYSCONTEXTID')">SYSCONTEXTID</a> . '/';
<a name="l6515"><span class="linenum">6515</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array(<a class="var it28910" onMouseOver="hilite(28910)" onMouseOut="lolite()" onClick="logVariable('pathstart')" href="../_variables/pathstart.html">$pathstart</a>);
<a name="l6516"><span class="linenum">6516</span></a>  
<a name="l6517"><span class="linenum">6517</span></a>          if (<a class="var it5797" onMouseOver="hilite(5797)" onMouseOut="lolite()" onClick="logVariable('force')" href="../_variables/force.html">$force</a>) {
<a name="l6518"><span class="linenum">6518</span></a>              <a class="var it1076" onMouseOver="hilite(1076)" onMouseOut="lolite()" onClick="logVariable('where')" href="../_variables/where.html">$where</a> = &quot;depth &lt;&gt; 2 OR path IS NULL OR path &lt;&gt; ({<a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>})&quot;;
<a name="l6519"><span class="linenum">6519</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>[] = <a class="var it28910" onMouseOver="hilite(28910)" onMouseOut="lolite()" onClick="logVariable('pathstart')" href="../_variables/pathstart.html">$pathstart</a>;
<a name="l6520"><span class="linenum">6520</span></a>          } else {
<a name="l6521"><span class="linenum">6521</span></a>              <a class="var it1076" onMouseOver="hilite(1076)" onMouseOut="lolite()" onClick="logVariable('where')" href="../_variables/where.html">$where</a> = &quot;depth = 0 OR path IS NULL&quot;;
<a name="l6522"><span class="linenum">6522</span></a>          }
<a name="l6523"><span class="linenum">6523</span></a>  
<a name="l6524"><span class="linenum">6524</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;UPDATE {context}
<a name="l6525"><span class="linenum">6525</span></a>                     SET depth = 2,
<a name="l6526"><span class="linenum">6526</span></a>                         path = {<a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('path')" href="../_variables/path.html">$path</a>}
<a name="l6527"><span class="linenum">6527</span></a>                   WHERE contextlevel = &quot; . <a class="constant" onClick="logConstant('CONTEXT_USER')" href="../_constants/CONTEXT_USER.html" onMouseOver="constPopup(event,'CONTEXT_USER')">CONTEXT_USER</a> . &quot;
<a name="l6528"><span class="linenum">6528</span></a>                     AND (<a class="var it1076" onMouseOver="hilite(1076)" onMouseOut="lolite()" onClick="logVariable('where')" href="../_variables/where.html">$where</a>)&quot;;
<a name="l6529"><span class="linenum">6529</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l6530"><span class="linenum">6530</span></a>      }
<a name="l6531"><span class="linenum">6531</span></a>  }
<a name="l6532"><span class="linenum">6532</span></a>  
<a name="l6533"><span class="linenum">6533</span></a>  
<a name="l6534"><span class="linenum">6534</span></a>  <span class="comment">/**</span>
<a name="l6535"><span class="linenum">6535</span></a>  <span class="comment"> * Course category context class</span>
<a name="l6536"><span class="linenum">6536</span></a>  <span class="comment"> *</span>
<a name="l6537"><span class="linenum">6537</span></a>  <span class="comment"> * @package   core_access</span>
<a name="l6538"><span class="linenum">6538</span></a>  <span class="comment"> * @category  access</span>
<a name="l6539"><span class="linenum">6539</span></a>  <span class="comment"> * @copyright Petr Skoda {@link http://skodak.org}</span>
<a name="l6540"><span class="linenum">6540</span></a>  <span class="comment"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l6541"><span class="linenum">6541</span></a>  <span class="comment"> * @since     Moodle 2.2</span>
<a name="l6542"><span class="linenum">6542</span></a>  <span class="comment"> */</span>
<a name="l6543"><span class="linenum">6543</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('context_coursecat')" href="../_classes/context_coursecat.html" onMouseOver="classPopup(event,'context_coursecat')">context_coursecat</a> extends context {
<a name="l6544"><span class="linenum">6544</span></a>      <span class="comment">/**</span>
<a name="l6545"><span class="linenum">6545</span></a>  <span class="comment">     * Please use context_coursecat::instance($coursecatid) if you need the instance of context.</span>
<a name="l6546"><span class="linenum">6546</span></a>  <span class="comment">     * Alternatively if you know only the context id use context::instance_by_id($contextid)</span>
<a name="l6547"><span class="linenum">6547</span></a>  <span class="comment">     *</span>
<a name="l6548"><span class="linenum">6548</span></a>  <span class="comment">     * @param stdClass $record</span>
<a name="l6549"><span class="linenum">6549</span></a>  <span class="comment">     */</span>
<a name="l6550"><span class="linenum">6550</span></a>      protected function <a class="function" onClick="logFunction('__construct')" href="../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>(stdClass <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>) {
<a name="l6551"><span class="linenum">6551</span></a>          parent::<a class="function" onClick="logFunction('__construct')" href="../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l6552"><span class="linenum">6552</span></a>          if (<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> != <a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>) {
<a name="l6553"><span class="linenum">6553</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> in context_coursecat constructor.');
<a name="l6554"><span class="linenum">6554</span></a>          }
<a name="l6555"><span class="linenum">6555</span></a>      }
<a name="l6556"><span class="linenum">6556</span></a>  
<a name="l6557"><span class="linenum">6557</span></a>      <span class="comment">/**</span>
<a name="l6558"><span class="linenum">6558</span></a>  <span class="comment">     * Returns human readable context level name.</span>
<a name="l6559"><span class="linenum">6559</span></a>  <span class="comment">     *</span>
<a name="l6560"><span class="linenum">6560</span></a>  <span class="comment">     * @static</span>
<a name="l6561"><span class="linenum">6561</span></a>  <span class="comment">     * @return string the human readable context level name.</span>
<a name="l6562"><span class="linenum">6562</span></a>  <span class="comment">     */</span>
<a name="l6563"><span class="linenum">6563</span></a>      public static function <a class="function" onClick="logFunction('get_level_name')" href="../_functions/get_level_name.html" onMouseOver="funcPopup(event,'get_level_name')">get_level_name</a>() {
<a name="l6564"><span class="linenum">6564</span></a>          return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('category');
<a name="l6565"><span class="linenum">6565</span></a>      }
<a name="l6566"><span class="linenum">6566</span></a>  
<a name="l6567"><span class="linenum">6567</span></a>      <span class="comment">/**</span>
<a name="l6568"><span class="linenum">6568</span></a>  <span class="comment">     * Returns human readable context identifier.</span>
<a name="l6569"><span class="linenum">6569</span></a>  <span class="comment">     *</span>
<a name="l6570"><span class="linenum">6570</span></a>  <span class="comment">     * @param boolean $withprefix whether to prefix the name of the context with Category</span>
<a name="l6571"><span class="linenum">6571</span></a>  <span class="comment">     * @param boolean $short does not apply to course categories</span>
<a name="l6572"><span class="linenum">6572</span></a>  <span class="comment">     * @return string the human readable context name.</span>
<a name="l6573"><span class="linenum">6573</span></a>  <span class="comment">     */</span>
<a name="l6574"><span class="linenum">6574</span></a>      public function <a class="function" onClick="logFunction('get_context_name')" href="../_functions/get_context_name.html" onMouseOver="funcPopup(event,'get_context_name')">get_context_name</a>(<a class="var it25263" onMouseOver="hilite(25263)" onMouseOut="lolite()" onClick="logVariable('withprefix')" href="../_variables/withprefix.html">$withprefix</a> = true, <a class="var it1725" onMouseOver="hilite(1725)" onMouseOut="lolite()" onClick="logVariable('short')" href="../_variables/short.html">$short</a> = false) {
<a name="l6575"><span class="linenum">6575</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l6576"><span class="linenum">6576</span></a>  
<a name="l6577"><span class="linenum">6577</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = '';
<a name="l6578"><span class="linenum">6578</span></a>          if (<a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('category')" href="../_variables/category.html">$category</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course_categories', array('id'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_instanceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_instanceid.html">_instanceid</a>))) {
<a name="l6579"><span class="linenum">6579</span></a>              if (<a class="var it25263" onMouseOver="hilite(25263)" onMouseOut="lolite()" onClick="logVariable('withprefix')" href="../_variables/withprefix.html">$withprefix</a>){
<a name="l6580"><span class="linenum">6580</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('category').': ';
<a name="l6581"><span class="linenum">6581</span></a>              }
<a name="l6582"><span class="linenum">6582</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> .= <a class="function" onClick="logFunction('format_string')" href="../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('category')" href="../_variables/category.html">$category</a>-&gt;<a onClick="logVariable('name')" class="var it39558" onMouseOver="hilite(39558)" onMouseOut="lolite()" href="../_variables/name.html">name</a>, true, array('context' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>));
<a name="l6583"><span class="linenum">6583</span></a>          }
<a name="l6584"><span class="linenum">6584</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>;
<a name="l6585"><span class="linenum">6585</span></a>      }
<a name="l6586"><span class="linenum">6586</span></a>  
<a name="l6587"><span class="linenum">6587</span></a>      <span class="comment">/**</span>
<a name="l6588"><span class="linenum">6588</span></a>  <span class="comment">     * Returns the most relevant URL for this context.</span>
<a name="l6589"><span class="linenum">6589</span></a>  <span class="comment">     *</span>
<a name="l6590"><span class="linenum">6590</span></a>  <span class="comment">     * @return moodle_url</span>
<a name="l6591"><span class="linenum">6591</span></a>  <span class="comment">     */</span>
<a name="l6592"><span class="linenum">6592</span></a>      public function <a class="function" onClick="logFunction('get_url')" href="../_functions/get_url.html" onMouseOver="funcPopup(event,'get_url')">get_url</a>() {
<a name="l6593"><span class="linenum">6593</span></a>          return <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../course/index.php.html">/course/index.php</a>', array('categoryid' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_instanceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_instanceid.html">_instanceid</a>));
<a name="l6594"><span class="linenum">6594</span></a>      }
<a name="l6595"><span class="linenum">6595</span></a>  
<a name="l6596"><span class="linenum">6596</span></a>      <span class="comment">/**</span>
<a name="l6597"><span class="linenum">6597</span></a>  <span class="comment">     * Returns array of relevant context capability records.</span>
<a name="l6598"><span class="linenum">6598</span></a>  <span class="comment">     *</span>
<a name="l6599"><span class="linenum">6599</span></a>  <span class="comment">     * @return array</span>
<a name="l6600"><span class="linenum">6600</span></a>  <span class="comment">     */</span>
<a name="l6601"><span class="linenum">6601</span></a>      public function <a class="function" onClick="logFunction('get_capabilities')" href="../_functions/get_capabilities.html" onMouseOver="funcPopup(event,'get_capabilities')">get_capabilities</a>() {
<a name="l6602"><span class="linenum">6602</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l6603"><span class="linenum">6603</span></a>  
<a name="l6604"><span class="linenum">6604</span></a>          <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a> = 'ORDER BY contextlevel,component,name';   <span class="comment">// To group them sensibly for display</span>
<a name="l6605"><span class="linenum">6605</span></a>  
<a name="l6606"><span class="linenum">6606</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array();
<a name="l6607"><span class="linenum">6607</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT *
<a name="l6608"><span class="linenum">6608</span></a>                    FROM {capabilities}
<a name="l6609"><span class="linenum">6609</span></a>                   WHERE contextlevel IN (&quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>.&quot;,&quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>.&quot;,&quot;.<a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>.&quot;,&quot;.<a class="constant" onClick="logConstant('CONTEXT_BLOCK')" href="../_constants/CONTEXT_BLOCK.html" onMouseOver="constPopup(event,'CONTEXT_BLOCK')">CONTEXT_BLOCK</a>.&quot;)&quot;;
<a name="l6610"><span class="linenum">6610</span></a>  
<a name="l6611"><span class="linenum">6611</span></a>          return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>.' '.<a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l6612"><span class="linenum">6612</span></a>      }
<a name="l6613"><span class="linenum">6613</span></a>  
<a name="l6614"><span class="linenum">6614</span></a>      <span class="comment">/**</span>
<a name="l6615"><span class="linenum">6615</span></a>  <span class="comment">     * Returns course category context instance.</span>
<a name="l6616"><span class="linenum">6616</span></a>  <span class="comment">     *</span>
<a name="l6617"><span class="linenum">6617</span></a>  <span class="comment">     * @static</span>
<a name="l6618"><span class="linenum">6618</span></a>  <span class="comment">     * @param int $instanceid</span>
<a name="l6619"><span class="linenum">6619</span></a>  <span class="comment">     * @param int $strictness</span>
<a name="l6620"><span class="linenum">6620</span></a>  <span class="comment">     * @return context_coursecat context instance</span>
<a name="l6621"><span class="linenum">6621</span></a>  <span class="comment">     */</span>
<a name="l6622"><span class="linenum">6622</span></a>      public static function <a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>, <a class="var it4662" onMouseOver="hilite(4662)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a> = <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>) {
<a name="l6623"><span class="linenum">6623</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l6624"><span class="linenum">6624</span></a>  
<a name="l6625"><span class="linenum">6625</span></a>          if (<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = context::<a class="function" onClick="logFunction('cache_get')" href="../_functions/cache_get.html" onMouseOver="funcPopup(event,'cache_get')">cache_get</a>(<a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>, <a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>)) {
<a name="l6626"><span class="linenum">6626</span></a>              return <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>;
<a name="l6627"><span class="linenum">6627</span></a>          }
<a name="l6628"><span class="linenum">6628</span></a>  
<a name="l6629"><span class="linenum">6629</span></a>          if (!<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('context', array('contextlevel'=&gt;<a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>, 'instanceid'=&gt;<a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>))) {
<a name="l6630"><span class="linenum">6630</span></a>              if (<a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('category')" href="../_variables/category.html">$category</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course_categories', array('id'=&gt;<a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>), 'id,parent', <a class="var it4662" onMouseOver="hilite(4662)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a>)) {
<a name="l6631"><span class="linenum">6631</span></a>                  if (<a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('category')" href="../_variables/category.html">$category</a>-&gt;<a onClick="logVariable('parent')" class="var it39558" onMouseOver="hilite(39558)" onMouseOut="lolite()" href="../_variables/parent.html">parent</a>) {
<a name="l6632"><span class="linenum">6632</span></a>                      <a class="var it4943" onMouseOver="hilite(4943)" onMouseOut="lolite()" onClick="logVariable('parentcontext')" href="../_variables/parentcontext.html">$parentcontext</a> = <a class="class" onClick="logClass('context_coursecat')" href="../_classes/context_coursecat.html" onMouseOver="classPopup(event,'context_coursecat')">context_coursecat</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('category')" href="../_variables/category.html">$category</a>-&gt;<a onClick="logVariable('parent')" class="var it39558" onMouseOver="hilite(39558)" onMouseOut="lolite()" href="../_variables/parent.html">parent</a>);
<a name="l6633"><span class="linenum">6633</span></a>                      <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = context::<a class="function" onClick="logFunction('insert_context_record')" href="../_functions/insert_context_record.html" onMouseOver="funcPopup(event,'insert_context_record')">insert_context_record</a>(<a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>, <a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('category')" href="../_variables/category.html">$category</a>-&gt;<a onClick="logVariable('id')" class="var it39558" onMouseOver="hilite(39558)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it4943" onMouseOver="hilite(4943)" onMouseOut="lolite()" onClick="logVariable('parentcontext')" href="../_variables/parentcontext.html">$parentcontext</a>-&gt;<a onClick="logVariable('path')" class="var it39842" onMouseOver="hilite(39842)" onMouseOut="lolite()" href="../_variables/path.html">path</a>);
<a name="l6634"><span class="linenum">6634</span></a>                  } else {
<a name="l6635"><span class="linenum">6635</span></a>                      <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = context::<a class="function" onClick="logFunction('insert_context_record')" href="../_functions/insert_context_record.html" onMouseOver="funcPopup(event,'insert_context_record')">insert_context_record</a>(<a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>, <a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('category')" href="../_variables/category.html">$category</a>-&gt;<a onClick="logVariable('id')" class="var it39558" onMouseOver="hilite(39558)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, '/'.<a class="constant" onClick="logConstant('SYSCONTEXTID')" href="../_constants/SYSCONTEXTID.html" onMouseOver="constPopup(event,'SYSCONTEXTID')">SYSCONTEXTID</a>, 0);
<a name="l6636"><span class="linenum">6636</span></a>                  }
<a name="l6637"><span class="linenum">6637</span></a>              }
<a name="l6638"><span class="linenum">6638</span></a>          }
<a name="l6639"><span class="linenum">6639</span></a>  
<a name="l6640"><span class="linenum">6640</span></a>          if (<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>) {
<a name="l6641"><span class="linenum">6641</span></a>              <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <span class="keyword">new </span><a class="class" onClick="logClass('context_coursecat')" href="../_classes/context_coursecat.html" onMouseOver="classPopup(event,'context_coursecat')">context_coursecat</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l6642"><span class="linenum">6642</span></a>              context::<a class="function" onClick="logFunction('cache_add')" href="../_functions/cache_add.html" onMouseOver="funcPopup(event,'cache_add')">cache_add</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l6643"><span class="linenum">6643</span></a>              return <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>;
<a name="l6644"><span class="linenum">6644</span></a>          }
<a name="l6645"><span class="linenum">6645</span></a>  
<a name="l6646"><span class="linenum">6646</span></a>          return false;
<a name="l6647"><span class="linenum">6647</span></a>      }
<a name="l6648"><span class="linenum">6648</span></a>  
<a name="l6649"><span class="linenum">6649</span></a>      <span class="comment">/**</span>
<a name="l6650"><span class="linenum">6650</span></a>  <span class="comment">     * Returns immediate child contexts of category and all subcategories,</span>
<a name="l6651"><span class="linenum">6651</span></a>  <span class="comment">     * children of subcategories and courses are not returned.</span>
<a name="l6652"><span class="linenum">6652</span></a>  <span class="comment">     *</span>
<a name="l6653"><span class="linenum">6653</span></a>  <span class="comment">     * @return array</span>
<a name="l6654"><span class="linenum">6654</span></a>  <span class="comment">     */</span>
<a name="l6655"><span class="linenum">6655</span></a>      public function <a class="function" onClick="logFunction('get_child_contexts')" href="../_functions/get_child_contexts.html" onMouseOver="funcPopup(event,'get_child_contexts')">get_child_contexts</a>() {
<a name="l6656"><span class="linenum">6656</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l6657"><span class="linenum">6657</span></a>  
<a name="l6658"><span class="linenum">6658</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a>) or empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_depth')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_depth.html">_depth</a>)) {
<a name="l6659"><span class="linenum">6659</span></a>              <a class="function" onClick="logFunction('debugging')" href="../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Can not find child contexts of context '.<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_id.html">_id</a>.' try rebuilding of context paths');
<a name="l6660"><span class="linenum">6660</span></a>              return array();
<a name="l6661"><span class="linenum">6661</span></a>          }
<a name="l6662"><span class="linenum">6662</span></a>  
<a name="l6663"><span class="linenum">6663</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT ctx.*
<a name="l6664"><span class="linenum">6664</span></a>                    FROM {context} ctx
<a name="l6665"><span class="linenum">6665</span></a>                   WHERE ctx.path LIKE ? AND (ctx.depth = ? OR ctx.contextlevel = ?)&quot;;
<a name="l6666"><span class="linenum">6666</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_path')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_path.html">_path</a>.'/%', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('depth')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/depth.html">depth</a>+1, <a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>);
<a name="l6667"><span class="linenum">6667</span></a>          <a class="var it2579" onMouseOver="hilite(2579)" onMouseOut="lolite()" onClick="logVariable('records')" href="../_variables/records.html">$records</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l6668"><span class="linenum">6668</span></a>  
<a name="l6669"><span class="linenum">6669</span></a>          <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a> = array();
<a name="l6670"><span class="linenum">6670</span></a>          foreach (<a class="var it2579" onMouseOver="hilite(2579)" onMouseOut="lolite()" onClick="logVariable('records')" href="../_variables/records.html">$records</a> as <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>) {
<a name="l6671"><span class="linenum">6671</span></a>              <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>[<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = context::<a class="function" onClick="logFunction('create_instance_from_record')" href="../_functions/create_instance_from_record.html" onMouseOver="funcPopup(event,'create_instance_from_record')">create_instance_from_record</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l6672"><span class="linenum">6672</span></a>          }
<a name="l6673"><span class="linenum">6673</span></a>  
<a name="l6674"><span class="linenum">6674</span></a>          return <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../_variables/result.html">$result</a>;
<a name="l6675"><span class="linenum">6675</span></a>      }
<a name="l6676"><span class="linenum">6676</span></a>  
<a name="l6677"><span class="linenum">6677</span></a>      <span class="comment">/**</span>
<a name="l6678"><span class="linenum">6678</span></a>  <span class="comment">     * Create missing context instances at course category context level</span>
<a name="l6679"><span class="linenum">6679</span></a>  <span class="comment">     * @static</span>
<a name="l6680"><span class="linenum">6680</span></a>  <span class="comment">     */</span>
<a name="l6681"><span class="linenum">6681</span></a>      protected static function <a class="function" onClick="logFunction('create_level_instances')" href="../_functions/create_level_instances.html" onMouseOver="funcPopup(event,'create_level_instances')">create_level_instances</a>() {
<a name="l6682"><span class="linenum">6682</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l6683"><span class="linenum">6683</span></a>  
<a name="l6684"><span class="linenum">6684</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT &quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>.&quot;, cc.id
<a name="l6685"><span class="linenum">6685</span></a>                    FROM {course_categories} cc
<a name="l6686"><span class="linenum">6686</span></a>                   WHERE NOT <a class="function" onClick="logFunction('EXISTS')" href="../_functions/exists.html" onMouseOver="funcPopup(event,'exists')">EXISTS</a> (SELECT 'x'
<a name="l6687"><span class="linenum">6687</span></a>                                       FROM {context} cx
<a name="l6688"><span class="linenum">6688</span></a>                                      WHERE cc.id = cx.instanceid AND cx.contextlevel=&quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>.&quot;)&quot;;
<a name="l6689"><span class="linenum">6689</span></a>          <a class="var it28909" onMouseOver="hilite(28909)" onMouseOut="lolite()" onClick="logVariable('contextdata')" href="../_variables/contextdata.html">$contextdata</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>);
<a name="l6690"><span class="linenum">6690</span></a>          foreach (<a class="var it28909" onMouseOver="hilite(28909)" onMouseOut="lolite()" onClick="logVariable('contextdata')" href="../_variables/contextdata.html">$contextdata</a> as <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l6691"><span class="linenum">6691</span></a>              context::<a class="function" onClick="logFunction('insert_context_record')" href="../_functions/insert_context_record.html" onMouseOver="funcPopup(event,'insert_context_record')">insert_context_record</a>(<a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, null);
<a name="l6692"><span class="linenum">6692</span></a>          }
<a name="l6693"><span class="linenum">6693</span></a>          <a class="var it28909" onMouseOver="hilite(28909)" onMouseOut="lolite()" onClick="logVariable('contextdata')" href="../_variables/contextdata.html">$contextdata</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l6694"><span class="linenum">6694</span></a>      }
<a name="l6695"><span class="linenum">6695</span></a>  
<a name="l6696"><span class="linenum">6696</span></a>      <span class="comment">/**</span>
<a name="l6697"><span class="linenum">6697</span></a>  <span class="comment">     * Returns sql necessary for purging of stale context instances.</span>
<a name="l6698"><span class="linenum">6698</span></a>  <span class="comment">     *</span>
<a name="l6699"><span class="linenum">6699</span></a>  <span class="comment">     * @static</span>
<a name="l6700"><span class="linenum">6700</span></a>  <span class="comment">     * @return string cleanup SQL</span>
<a name="l6701"><span class="linenum">6701</span></a>  <span class="comment">     */</span>
<a name="l6702"><span class="linenum">6702</span></a>      protected static function <a class="function" onClick="logFunction('get_cleanup_sql')" href="../_functions/get_cleanup_sql.html" onMouseOver="funcPopup(event,'get_cleanup_sql')">get_cleanup_sql</a>() {
<a name="l6703"><span class="linenum">6703</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;
<a name="l6704"><span class="linenum">6704</span></a>                    SELECT c.*
<a name="l6705"><span class="linenum">6705</span></a>                      FROM {context} c
<a name="l6706"><span class="linenum">6706</span></a>           LEFT OUTER JOIN {course_categories} cc ON c.instanceid = cc.id
<a name="l6707"><span class="linenum">6707</span></a>                     WHERE cc.id IS NULL AND c.contextlevel = &quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>.&quot;
<a name="l6708"><span class="linenum">6708</span></a>                 &quot;;
<a name="l6709"><span class="linenum">6709</span></a>  
<a name="l6710"><span class="linenum">6710</span></a>          return <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>;
<a name="l6711"><span class="linenum">6711</span></a>      }
<a name="l6712"><span class="linenum">6712</span></a>  
<a name="l6713"><span class="linenum">6713</span></a>      <span class="comment">/**</span>
<a name="l6714"><span class="linenum">6714</span></a>  <span class="comment">     * Rebuild context paths and depths at course category context level.</span>
<a name="l6715"><span class="linenum">6715</span></a>  <span class="comment">     *</span>
<a name="l6716"><span class="linenum">6716</span></a>  <span class="comment">     * @static</span>
<a name="l6717"><span class="linenum">6717</span></a>  <span class="comment">     * @param bool $force</span>
<a name="l6718"><span class="linenum">6718</span></a>  <span class="comment">     */</span>
<a name="l6719"><span class="linenum">6719</span></a>      protected static function <a class="function" onClick="logFunction('build_paths')" href="../_functions/build_paths.html" onMouseOver="funcPopup(event,'build_paths')">build_paths</a>(<a class="var it5797" onMouseOver="hilite(5797)" onMouseOut="lolite()" onClick="logVariable('force')" href="../_variables/force.html">$force</a>) {
<a name="l6720"><span class="linenum">6720</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l6721"><span class="linenum">6721</span></a>  
<a name="l6722"><span class="linenum">6722</span></a>          if (<a class="var it5797" onMouseOver="hilite(5797)" onMouseOut="lolite()" onClick="logVariable('force')" href="../_variables/force.html">$force</a> or <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists_select')" href="../_functions/record_exists_select.html" onMouseOver="funcPopup(event,'record_exists_select')">record_exists_select</a>('context', &quot;contextlevel = &quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>.&quot; AND (depth = 0 OR path IS NULL)&quot;)) {
<a name="l6723"><span class="linenum">6723</span></a>              if (<a class="var it5797" onMouseOver="hilite(5797)" onMouseOut="lolite()" onClick="logVariable('force')" href="../_variables/force.html">$force</a>) {
<a name="l6724"><span class="linenum">6724</span></a>                  <a class="var it28911" onMouseOver="hilite(28911)" onMouseOut="lolite()" onClick="logVariable('ctxemptyclause')" href="../_variables/ctxemptyclause.html">$ctxemptyclause</a> = <a class="var it28912" onMouseOver="hilite(28912)" onMouseOut="lolite()" onClick="logVariable('emptyclause')" href="../_variables/emptyclause.html">$emptyclause</a> = '';
<a name="l6725"><span class="linenum">6725</span></a>              } else {
<a name="l6726"><span class="linenum">6726</span></a>                  <a class="var it28911" onMouseOver="hilite(28911)" onMouseOut="lolite()" onClick="logVariable('ctxemptyclause')" href="../_variables/ctxemptyclause.html">$ctxemptyclause</a> = &quot;AND (ctx.path IS NULL OR ctx.depth = 0)&quot;;
<a name="l6727"><span class="linenum">6727</span></a>                  <a class="var it28912" onMouseOver="hilite(28912)" onMouseOut="lolite()" onClick="logVariable('emptyclause')" href="../_variables/emptyclause.html">$emptyclause</a>    = &quot;AND ({context}.path IS NULL OR {context}.depth = 0)&quot;;
<a name="l6728"><span class="linenum">6728</span></a>              }
<a name="l6729"><span class="linenum">6729</span></a>  
<a name="l6730"><span class="linenum">6730</span></a>              <a class="var it5295" onMouseOver="hilite(5295)" onMouseOut="lolite()" onClick="logVariable('base')" href="../_variables/base.html">$base</a> = '/'.<a class="constant" onClick="logConstant('SYSCONTEXTID')" href="../_constants/SYSCONTEXTID.html" onMouseOver="constPopup(event,'SYSCONTEXTID')">SYSCONTEXTID</a>;
<a name="l6731"><span class="linenum">6731</span></a>  
<a name="l6732"><span class="linenum">6732</span></a>  <span class="comment">            // Normal top level categories</span>
<a name="l6733"><span class="linenum">6733</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;UPDATE {context}
<a name="l6734"><span class="linenum">6734</span></a>                         SET depth=2,
<a name="l6735"><span class="linenum">6735</span></a>                             path=&quot;.<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_concat')" href="../_functions/sql_concat.html" onMouseOver="funcPopup(event,'sql_concat')">sql_concat</a>(&quot;'<a class="var it5295" onMouseOver="hilite(5295)" onMouseOut="lolite()" onClick="logVariable('base')" href="../_variables/base.html">$base</a>/'&quot;, 'id').&quot;
<a name="l6736"><span class="linenum">6736</span></a>                       WHERE contextlevel=&quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>.&quot;
<a name="l6737"><span class="linenum">6737</span></a>                             AND <a class="function" onClick="logFunction('EXISTS')" href="../_functions/exists.html" onMouseOver="funcPopup(event,'exists')">EXISTS</a> (SELECT 'x'
<a name="l6738"><span class="linenum">6738</span></a>                                           FROM {course_categories} cc
<a name="l6739"><span class="linenum">6739</span></a>                                          WHERE cc.id = {context}.instanceid AND cc.depth=1)
<a name="l6740"><span class="linenum">6740</span></a>                             <a class="var it28912" onMouseOver="hilite(28912)" onMouseOut="lolite()" onClick="logVariable('emptyclause')" href="../_variables/emptyclause.html">$emptyclause</a>&quot;;
<a name="l6741"><span class="linenum">6741</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>);
<a name="l6742"><span class="linenum">6742</span></a>  
<a name="l6743"><span class="linenum">6743</span></a>  <span class="comment">            // Deeper categories - one query per depthlevel</span>
<a name="l6744"><span class="linenum">6744</span></a>              <a class="var it18939" onMouseOver="hilite(18939)" onMouseOut="lolite()" onClick="logVariable('maxdepth')" href="../_variables/maxdepth.html">$maxdepth</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field_sql')" href="../_functions/get_field_sql.html" onMouseOver="funcPopup(event,'get_field_sql')">get_field_sql</a>(&quot;SELECT <a class="phpfunction" onClick="logFunction('MAX')" href="../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">MAX</a>(depth) FROM {course_categories}&quot;);
<a name="l6745"><span class="linenum">6745</span></a>              for (<a class="var it291" onMouseOver="hilite(291)" onMouseOut="lolite()" onClick="logVariable('n')" href="../_variables/n.html">$n</a>=2; <a class="var it291" onMouseOver="hilite(291)" onMouseOut="lolite()" onClick="logVariable('n')" href="../_variables/n.html">$n</a>&lt;=<a class="var it18939" onMouseOver="hilite(18939)" onMouseOut="lolite()" onClick="logVariable('maxdepth')" href="../_variables/maxdepth.html">$maxdepth</a>; <a class="var it291" onMouseOver="hilite(291)" onMouseOut="lolite()" onClick="logVariable('n')" href="../_variables/n.html">$n</a>++) {
<a name="l6746"><span class="linenum">6746</span></a>                  <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;INSERT INTO {context_temp} (id, path, depth)
<a name="l6747"><span class="linenum">6747</span></a>                          SELECT ctx.id, &quot;.<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_concat')" href="../_functions/sql_concat.html" onMouseOver="funcPopup(event,'sql_concat')">sql_concat</a>('pctx.path', &quot;'/'&quot;, 'ctx.id').&quot;, pctx.depth+1
<a name="l6748"><span class="linenum">6748</span></a>                            FROM {context} ctx
<a name="l6749"><span class="linenum">6749</span></a>                            JOIN {course_categories} cc <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (cc.id = ctx.instanceid AND ctx.contextlevel = &quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>.&quot; AND cc.depth = <a class="var it291" onMouseOver="hilite(291)" onMouseOut="lolite()" onClick="logVariable('n')" href="../_variables/n.html">$n</a>)
<a name="l6750"><span class="linenum">6750</span></a>                            JOIN {context} pctx <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (pctx.instanceid = cc.parent AND pctx.contextlevel = &quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>.&quot;)
<a name="l6751"><span class="linenum">6751</span></a>                           WHERE pctx.path IS NOT NULL AND pctx.depth &gt; 0
<a name="l6752"><span class="linenum">6752</span></a>                                 <a class="var it28911" onMouseOver="hilite(28911)" onMouseOut="lolite()" onClick="logVariable('ctxemptyclause')" href="../_variables/ctxemptyclause.html">$ctxemptyclause</a>&quot;;
<a name="l6753"><span class="linenum">6753</span></a>                  <a class="var it24866" onMouseOver="hilite(24866)" onMouseOut="lolite()" onClick="logVariable('trans')" href="../_variables/trans.html">$trans</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l6754"><span class="linenum">6754</span></a>                  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('context_temp');
<a name="l6755"><span class="linenum">6755</span></a>                  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>);
<a name="l6756"><span class="linenum">6756</span></a>                  context::<a class="function" onClick="logFunction('merge_context_temp_table')" href="../_functions/merge_context_temp_table.html" onMouseOver="funcPopup(event,'merge_context_temp_table')">merge_context_temp_table</a>();
<a name="l6757"><span class="linenum">6757</span></a>                  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('context_temp');
<a name="l6758"><span class="linenum">6758</span></a>                  <a class="var it24866" onMouseOver="hilite(24866)" onMouseOut="lolite()" onClick="logVariable('trans')" href="../_variables/trans.html">$trans</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l6759"><span class="linenum">6759</span></a>  
<a name="l6760"><span class="linenum">6760</span></a>              }
<a name="l6761"><span class="linenum">6761</span></a>          }
<a name="l6762"><span class="linenum">6762</span></a>      }
<a name="l6763"><span class="linenum">6763</span></a>  }
<a name="l6764"><span class="linenum">6764</span></a>  
<a name="l6765"><span class="linenum">6765</span></a>  
<a name="l6766"><span class="linenum">6766</span></a>  <span class="comment">/**</span>
<a name="l6767"><span class="linenum">6767</span></a>  <span class="comment"> * Course context class</span>
<a name="l6768"><span class="linenum">6768</span></a>  <span class="comment"> *</span>
<a name="l6769"><span class="linenum">6769</span></a>  <span class="comment"> * @package   core_access</span>
<a name="l6770"><span class="linenum">6770</span></a>  <span class="comment"> * @category  access</span>
<a name="l6771"><span class="linenum">6771</span></a>  <span class="comment"> * @copyright Petr Skoda {@link http://skodak.org}</span>
<a name="l6772"><span class="linenum">6772</span></a>  <span class="comment"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l6773"><span class="linenum">6773</span></a>  <span class="comment"> * @since     Moodle 2.2</span>
<a name="l6774"><span class="linenum">6774</span></a>  <span class="comment"> */</span>
<a name="l6775"><span class="linenum">6775</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a> extends context {
<a name="l6776"><span class="linenum">6776</span></a>      <span class="comment">/**</span>
<a name="l6777"><span class="linenum">6777</span></a>  <span class="comment">     * Please use context_course::instance($courseid) if you need the instance of context.</span>
<a name="l6778"><span class="linenum">6778</span></a>  <span class="comment">     * Alternatively if you know only the context id use context::instance_by_id($contextid)</span>
<a name="l6779"><span class="linenum">6779</span></a>  <span class="comment">     *</span>
<a name="l6780"><span class="linenum">6780</span></a>  <span class="comment">     * @param stdClass $record</span>
<a name="l6781"><span class="linenum">6781</span></a>  <span class="comment">     */</span>
<a name="l6782"><span class="linenum">6782</span></a>      protected function <a class="function" onClick="logFunction('__construct')" href="../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>(stdClass <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>) {
<a name="l6783"><span class="linenum">6783</span></a>          parent::<a class="function" onClick="logFunction('__construct')" href="../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l6784"><span class="linenum">6784</span></a>          if (<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> != <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>) {
<a name="l6785"><span class="linenum">6785</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> in context_course constructor.');
<a name="l6786"><span class="linenum">6786</span></a>          }
<a name="l6787"><span class="linenum">6787</span></a>      }
<a name="l6788"><span class="linenum">6788</span></a>  
<a name="l6789"><span class="linenum">6789</span></a>      <span class="comment">/**</span>
<a name="l6790"><span class="linenum">6790</span></a>  <span class="comment">     * Returns human readable context level name.</span>
<a name="l6791"><span class="linenum">6791</span></a>  <span class="comment">     *</span>
<a name="l6792"><span class="linenum">6792</span></a>  <span class="comment">     * @static</span>
<a name="l6793"><span class="linenum">6793</span></a>  <span class="comment">     * @return string the human readable context level name.</span>
<a name="l6794"><span class="linenum">6794</span></a>  <span class="comment">     */</span>
<a name="l6795"><span class="linenum">6795</span></a>      public static function <a class="function" onClick="logFunction('get_level_name')" href="../_functions/get_level_name.html" onMouseOver="funcPopup(event,'get_level_name')">get_level_name</a>() {
<a name="l6796"><span class="linenum">6796</span></a>          return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('course');
<a name="l6797"><span class="linenum">6797</span></a>      }
<a name="l6798"><span class="linenum">6798</span></a>  
<a name="l6799"><span class="linenum">6799</span></a>      <span class="comment">/**</span>
<a name="l6800"><span class="linenum">6800</span></a>  <span class="comment">     * Returns human readable context identifier.</span>
<a name="l6801"><span class="linenum">6801</span></a>  <span class="comment">     *</span>
<a name="l6802"><span class="linenum">6802</span></a>  <span class="comment">     * @param boolean $withprefix whether to prefix the name of the context with Course</span>
<a name="l6803"><span class="linenum">6803</span></a>  <span class="comment">     * @param boolean $short whether to use the short name of the thing.</span>
<a name="l6804"><span class="linenum">6804</span></a>  <span class="comment">     * @return string the human readable context name.</span>
<a name="l6805"><span class="linenum">6805</span></a>  <span class="comment">     */</span>
<a name="l6806"><span class="linenum">6806</span></a>      public function <a class="function" onClick="logFunction('get_context_name')" href="../_functions/get_context_name.html" onMouseOver="funcPopup(event,'get_context_name')">get_context_name</a>(<a class="var it25263" onMouseOver="hilite(25263)" onMouseOut="lolite()" onClick="logVariable('withprefix')" href="../_variables/withprefix.html">$withprefix</a> = true, <a class="var it1725" onMouseOver="hilite(1725)" onMouseOut="lolite()" onClick="logVariable('short')" href="../_variables/short.html">$short</a> = false) {
<a name="l6807"><span class="linenum">6807</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l6808"><span class="linenum">6808</span></a>  
<a name="l6809"><span class="linenum">6809</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = '';
<a name="l6810"><span class="linenum">6810</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_instanceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_instanceid.html">_instanceid</a> == <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>) {
<a name="l6811"><span class="linenum">6811</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('frontpage', 'admin');
<a name="l6812"><span class="linenum">6812</span></a>          } else {
<a name="l6813"><span class="linenum">6813</span></a>              if (<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_instanceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_instanceid.html">_instanceid</a>))) {
<a name="l6814"><span class="linenum">6814</span></a>                  if (<a class="var it25263" onMouseOver="hilite(25263)" onMouseOut="lolite()" onClick="logVariable('withprefix')" href="../_variables/withprefix.html">$withprefix</a>){
<a name="l6815"><span class="linenum">6815</span></a>                      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('course').': ';
<a name="l6816"><span class="linenum">6816</span></a>                  }
<a name="l6817"><span class="linenum">6817</span></a>                  if (<a class="var it1725" onMouseOver="hilite(1725)" onMouseOut="lolite()" onClick="logVariable('short')" href="../_variables/short.html">$short</a>){
<a name="l6818"><span class="linenum">6818</span></a>                      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> .= <a class="function" onClick="logFunction('format_string')" href="../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('shortname')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/shortname.html">shortname</a>, true, array('context' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>));
<a name="l6819"><span class="linenum">6819</span></a>                  } else {
<a name="l6820"><span class="linenum">6820</span></a>                      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> .= <a class="function" onClick="logFunction('format_string')" href="../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="function" onClick="logFunction('get_course_display_name_for_list')" href="../_functions/get_course_display_name_for_list.html" onMouseOver="funcPopup(event,'get_course_display_name_for_list')">get_course_display_name_for_list</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>));
<a name="l6821"><span class="linenum">6821</span></a>                 }
<a name="l6822"><span class="linenum">6822</span></a>              }
<a name="l6823"><span class="linenum">6823</span></a>          }
<a name="l6824"><span class="linenum">6824</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>;
<a name="l6825"><span class="linenum">6825</span></a>      }
<a name="l6826"><span class="linenum">6826</span></a>  
<a name="l6827"><span class="linenum">6827</span></a>      <span class="comment">/**</span>
<a name="l6828"><span class="linenum">6828</span></a>  <span class="comment">     * Returns the most relevant URL for this context.</span>
<a name="l6829"><span class="linenum">6829</span></a>  <span class="comment">     *</span>
<a name="l6830"><span class="linenum">6830</span></a>  <span class="comment">     * @return moodle_url</span>
<a name="l6831"><span class="linenum">6831</span></a>  <span class="comment">     */</span>
<a name="l6832"><span class="linenum">6832</span></a>      public function <a class="function" onClick="logFunction('get_url')" href="../_functions/get_url.html" onMouseOver="funcPopup(event,'get_url')">get_url</a>() {
<a name="l6833"><span class="linenum">6833</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_instanceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_instanceid.html">_instanceid</a> != <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>) {
<a name="l6834"><span class="linenum">6834</span></a>              return <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('<a class="filename" href="../course/view.php.html">/course/view.php</a>', array('id'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_instanceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_instanceid.html">_instanceid</a>));
<a name="l6835"><span class="linenum">6835</span></a>          }
<a name="l6836"><span class="linenum">6836</span></a>  
<a name="l6837"><span class="linenum">6837</span></a>          return <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('/');
<a name="l6838"><span class="linenum">6838</span></a>      }
<a name="l6839"><span class="linenum">6839</span></a>  
<a name="l6840"><span class="linenum">6840</span></a>      <span class="comment">/**</span>
<a name="l6841"><span class="linenum">6841</span></a>  <span class="comment">     * Returns array of relevant context capability records.</span>
<a name="l6842"><span class="linenum">6842</span></a>  <span class="comment">     *</span>
<a name="l6843"><span class="linenum">6843</span></a>  <span class="comment">     * @return array</span>
<a name="l6844"><span class="linenum">6844</span></a>  <span class="comment">     */</span>
<a name="l6845"><span class="linenum">6845</span></a>      public function <a class="function" onClick="logFunction('get_capabilities')" href="../_functions/get_capabilities.html" onMouseOver="funcPopup(event,'get_capabilities')">get_capabilities</a>() {
<a name="l6846"><span class="linenum">6846</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l6847"><span class="linenum">6847</span></a>  
<a name="l6848"><span class="linenum">6848</span></a>          <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a> = 'ORDER BY contextlevel,component,name';   <span class="comment">// To group them sensibly for display</span>
<a name="l6849"><span class="linenum">6849</span></a>  
<a name="l6850"><span class="linenum">6850</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array();
<a name="l6851"><span class="linenum">6851</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT *
<a name="l6852"><span class="linenum">6852</span></a>                    FROM {capabilities}
<a name="l6853"><span class="linenum">6853</span></a>                   WHERE contextlevel IN (&quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>.&quot;,&quot;.<a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>.&quot;,&quot;.<a class="constant" onClick="logConstant('CONTEXT_BLOCK')" href="../_constants/CONTEXT_BLOCK.html" onMouseOver="constPopup(event,'CONTEXT_BLOCK')">CONTEXT_BLOCK</a>.&quot;)&quot;;
<a name="l6854"><span class="linenum">6854</span></a>  
<a name="l6855"><span class="linenum">6855</span></a>          return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>.' '.<a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l6856"><span class="linenum">6856</span></a>      }
<a name="l6857"><span class="linenum">6857</span></a>  
<a name="l6858"><span class="linenum">6858</span></a>      <span class="comment">/**</span>
<a name="l6859"><span class="linenum">6859</span></a>  <span class="comment">     * Is this context part of any course? If yes return course context.</span>
<a name="l6860"><span class="linenum">6860</span></a>  <span class="comment">     *</span>
<a name="l6861"><span class="linenum">6861</span></a>  <span class="comment">     * @param bool $strict true means throw exception if not found, false means return false if not found</span>
<a name="l6862"><span class="linenum">6862</span></a>  <span class="comment">     * @return context_course context of the enclosing course, null if not found or exception</span>
<a name="l6863"><span class="linenum">6863</span></a>  <span class="comment">     */</span>
<a name="l6864"><span class="linenum">6864</span></a>      public function <a class="function" onClick="logFunction('get_course_context')" href="../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>(<a class="var it13192" onMouseOver="hilite(13192)" onMouseOut="lolite()" onClick="logVariable('strict')" href="../_variables/strict.html">$strict</a> = true) {
<a name="l6865"><span class="linenum">6865</span></a>          return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>;
<a name="l6866"><span class="linenum">6866</span></a>      }
<a name="l6867"><span class="linenum">6867</span></a>  
<a name="l6868"><span class="linenum">6868</span></a>      <span class="comment">/**</span>
<a name="l6869"><span class="linenum">6869</span></a>  <span class="comment">     * Returns course context instance.</span>
<a name="l6870"><span class="linenum">6870</span></a>  <span class="comment">     *</span>
<a name="l6871"><span class="linenum">6871</span></a>  <span class="comment">     * @static</span>
<a name="l6872"><span class="linenum">6872</span></a>  <span class="comment">     * @param int $instanceid</span>
<a name="l6873"><span class="linenum">6873</span></a>  <span class="comment">     * @param int $strictness</span>
<a name="l6874"><span class="linenum">6874</span></a>  <span class="comment">     * @return context_course context instance</span>
<a name="l6875"><span class="linenum">6875</span></a>  <span class="comment">     */</span>
<a name="l6876"><span class="linenum">6876</span></a>      public static function <a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>, <a class="var it4662" onMouseOver="hilite(4662)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a> = <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>) {
<a name="l6877"><span class="linenum">6877</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l6878"><span class="linenum">6878</span></a>  
<a name="l6879"><span class="linenum">6879</span></a>          if (<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = context::<a class="function" onClick="logFunction('cache_get')" href="../_functions/cache_get.html" onMouseOver="funcPopup(event,'cache_get')">cache_get</a>(<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>, <a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>)) {
<a name="l6880"><span class="linenum">6880</span></a>              return <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>;
<a name="l6881"><span class="linenum">6881</span></a>          }
<a name="l6882"><span class="linenum">6882</span></a>  
<a name="l6883"><span class="linenum">6883</span></a>          if (!<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('context', array('contextlevel'=&gt;<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>, 'instanceid'=&gt;<a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>))) {
<a name="l6884"><span class="linenum">6884</span></a>              if (<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id'=&gt;<a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>), 'id,category', <a class="var it4662" onMouseOver="hilite(4662)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a>)) {
<a name="l6885"><span class="linenum">6885</span></a>                  if (<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('category')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/category.html">category</a>) {
<a name="l6886"><span class="linenum">6886</span></a>                      <a class="var it4943" onMouseOver="hilite(4943)" onMouseOut="lolite()" onClick="logVariable('parentcontext')" href="../_variables/parentcontext.html">$parentcontext</a> = <a class="class" onClick="logClass('context_coursecat')" href="../_classes/context_coursecat.html" onMouseOver="classPopup(event,'context_coursecat')">context_coursecat</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('category')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/category.html">category</a>);
<a name="l6887"><span class="linenum">6887</span></a>                      <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = context::<a class="function" onClick="logFunction('insert_context_record')" href="../_functions/insert_context_record.html" onMouseOver="funcPopup(event,'insert_context_record')">insert_context_record</a>(<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>, <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it4943" onMouseOver="hilite(4943)" onMouseOut="lolite()" onClick="logVariable('parentcontext')" href="../_variables/parentcontext.html">$parentcontext</a>-&gt;<a onClick="logVariable('path')" class="var it39842" onMouseOver="hilite(39842)" onMouseOut="lolite()" href="../_variables/path.html">path</a>);
<a name="l6888"><span class="linenum">6888</span></a>                  } else {
<a name="l6889"><span class="linenum">6889</span></a>                      <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = context::<a class="function" onClick="logFunction('insert_context_record')" href="../_functions/insert_context_record.html" onMouseOver="funcPopup(event,'insert_context_record')">insert_context_record</a>(<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>, <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, '/'.<a class="constant" onClick="logConstant('SYSCONTEXTID')" href="../_constants/SYSCONTEXTID.html" onMouseOver="constPopup(event,'SYSCONTEXTID')">SYSCONTEXTID</a>, 0);
<a name="l6890"><span class="linenum">6890</span></a>                  }
<a name="l6891"><span class="linenum">6891</span></a>              }
<a name="l6892"><span class="linenum">6892</span></a>          }
<a name="l6893"><span class="linenum">6893</span></a>  
<a name="l6894"><span class="linenum">6894</span></a>          if (<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>) {
<a name="l6895"><span class="linenum">6895</span></a>              <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <span class="keyword">new </span><a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l6896"><span class="linenum">6896</span></a>              context::<a class="function" onClick="logFunction('cache_add')" href="../_functions/cache_add.html" onMouseOver="funcPopup(event,'cache_add')">cache_add</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l6897"><span class="linenum">6897</span></a>              return <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>;
<a name="l6898"><span class="linenum">6898</span></a>          }
<a name="l6899"><span class="linenum">6899</span></a>  
<a name="l6900"><span class="linenum">6900</span></a>          return false;
<a name="l6901"><span class="linenum">6901</span></a>      }
<a name="l6902"><span class="linenum">6902</span></a>  
<a name="l6903"><span class="linenum">6903</span></a>      <span class="comment">/**</span>
<a name="l6904"><span class="linenum">6904</span></a>  <span class="comment">     * Create missing context instances at course context level</span>
<a name="l6905"><span class="linenum">6905</span></a>  <span class="comment">     * @static</span>
<a name="l6906"><span class="linenum">6906</span></a>  <span class="comment">     */</span>
<a name="l6907"><span class="linenum">6907</span></a>      protected static function <a class="function" onClick="logFunction('create_level_instances')" href="../_functions/create_level_instances.html" onMouseOver="funcPopup(event,'create_level_instances')">create_level_instances</a>() {
<a name="l6908"><span class="linenum">6908</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l6909"><span class="linenum">6909</span></a>  
<a name="l6910"><span class="linenum">6910</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT &quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>.&quot;, c.id
<a name="l6911"><span class="linenum">6911</span></a>                    FROM {course} c
<a name="l6912"><span class="linenum">6912</span></a>                   WHERE NOT <a class="function" onClick="logFunction('EXISTS')" href="../_functions/exists.html" onMouseOver="funcPopup(event,'exists')">EXISTS</a> (SELECT 'x'
<a name="l6913"><span class="linenum">6913</span></a>                                       FROM {context} cx
<a name="l6914"><span class="linenum">6914</span></a>                                      WHERE c.id = cx.instanceid AND cx.contextlevel=&quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>.&quot;)&quot;;
<a name="l6915"><span class="linenum">6915</span></a>          <a class="var it28909" onMouseOver="hilite(28909)" onMouseOut="lolite()" onClick="logVariable('contextdata')" href="../_variables/contextdata.html">$contextdata</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>);
<a name="l6916"><span class="linenum">6916</span></a>          foreach (<a class="var it28909" onMouseOver="hilite(28909)" onMouseOut="lolite()" onClick="logVariable('contextdata')" href="../_variables/contextdata.html">$contextdata</a> as <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l6917"><span class="linenum">6917</span></a>              context::<a class="function" onClick="logFunction('insert_context_record')" href="../_functions/insert_context_record.html" onMouseOver="funcPopup(event,'insert_context_record')">insert_context_record</a>(<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, null);
<a name="l6918"><span class="linenum">6918</span></a>          }
<a name="l6919"><span class="linenum">6919</span></a>          <a class="var it28909" onMouseOver="hilite(28909)" onMouseOut="lolite()" onClick="logVariable('contextdata')" href="../_variables/contextdata.html">$contextdata</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l6920"><span class="linenum">6920</span></a>      }
<a name="l6921"><span class="linenum">6921</span></a>  
<a name="l6922"><span class="linenum">6922</span></a>      <span class="comment">/**</span>
<a name="l6923"><span class="linenum">6923</span></a>  <span class="comment">     * Returns sql necessary for purging of stale context instances.</span>
<a name="l6924"><span class="linenum">6924</span></a>  <span class="comment">     *</span>
<a name="l6925"><span class="linenum">6925</span></a>  <span class="comment">     * @static</span>
<a name="l6926"><span class="linenum">6926</span></a>  <span class="comment">     * @return string cleanup SQL</span>
<a name="l6927"><span class="linenum">6927</span></a>  <span class="comment">     */</span>
<a name="l6928"><span class="linenum">6928</span></a>      protected static function <a class="function" onClick="logFunction('get_cleanup_sql')" href="../_functions/get_cleanup_sql.html" onMouseOver="funcPopup(event,'get_cleanup_sql')">get_cleanup_sql</a>() {
<a name="l6929"><span class="linenum">6929</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;
<a name="l6930"><span class="linenum">6930</span></a>                    SELECT c.*
<a name="l6931"><span class="linenum">6931</span></a>                      FROM {context} c
<a name="l6932"><span class="linenum">6932</span></a>           LEFT OUTER JOIN {course} co ON c.instanceid = co.id
<a name="l6933"><span class="linenum">6933</span></a>                     WHERE co.id IS NULL AND c.contextlevel = &quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>.&quot;
<a name="l6934"><span class="linenum">6934</span></a>                 &quot;;
<a name="l6935"><span class="linenum">6935</span></a>  
<a name="l6936"><span class="linenum">6936</span></a>          return <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>;
<a name="l6937"><span class="linenum">6937</span></a>      }
<a name="l6938"><span class="linenum">6938</span></a>  
<a name="l6939"><span class="linenum">6939</span></a>      <span class="comment">/**</span>
<a name="l6940"><span class="linenum">6940</span></a>  <span class="comment">     * Rebuild context paths and depths at course context level.</span>
<a name="l6941"><span class="linenum">6941</span></a>  <span class="comment">     *</span>
<a name="l6942"><span class="linenum">6942</span></a>  <span class="comment">     * @static</span>
<a name="l6943"><span class="linenum">6943</span></a>  <span class="comment">     * @param bool $force</span>
<a name="l6944"><span class="linenum">6944</span></a>  <span class="comment">     */</span>
<a name="l6945"><span class="linenum">6945</span></a>      protected static function <a class="function" onClick="logFunction('build_paths')" href="../_functions/build_paths.html" onMouseOver="funcPopup(event,'build_paths')">build_paths</a>(<a class="var it5797" onMouseOver="hilite(5797)" onMouseOut="lolite()" onClick="logVariable('force')" href="../_variables/force.html">$force</a>) {
<a name="l6946"><span class="linenum">6946</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l6947"><span class="linenum">6947</span></a>  
<a name="l6948"><span class="linenum">6948</span></a>          if (<a class="var it5797" onMouseOver="hilite(5797)" onMouseOut="lolite()" onClick="logVariable('force')" href="../_variables/force.html">$force</a> or <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists_select')" href="../_functions/record_exists_select.html" onMouseOver="funcPopup(event,'record_exists_select')">record_exists_select</a>('context', &quot;contextlevel = &quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>.&quot; AND (depth = 0 OR path IS NULL)&quot;)) {
<a name="l6949"><span class="linenum">6949</span></a>              if (<a class="var it5797" onMouseOver="hilite(5797)" onMouseOut="lolite()" onClick="logVariable('force')" href="../_variables/force.html">$force</a>) {
<a name="l6950"><span class="linenum">6950</span></a>                  <a class="var it28911" onMouseOver="hilite(28911)" onMouseOut="lolite()" onClick="logVariable('ctxemptyclause')" href="../_variables/ctxemptyclause.html">$ctxemptyclause</a> = <a class="var it28912" onMouseOver="hilite(28912)" onMouseOut="lolite()" onClick="logVariable('emptyclause')" href="../_variables/emptyclause.html">$emptyclause</a> = '';
<a name="l6951"><span class="linenum">6951</span></a>              } else {
<a name="l6952"><span class="linenum">6952</span></a>                  <a class="var it28911" onMouseOver="hilite(28911)" onMouseOut="lolite()" onClick="logVariable('ctxemptyclause')" href="../_variables/ctxemptyclause.html">$ctxemptyclause</a> = &quot;AND (ctx.path IS NULL OR ctx.depth = 0)&quot;;
<a name="l6953"><span class="linenum">6953</span></a>                  <a class="var it28912" onMouseOver="hilite(28912)" onMouseOut="lolite()" onClick="logVariable('emptyclause')" href="../_variables/emptyclause.html">$emptyclause</a>    = &quot;AND ({context}.path IS NULL OR {context}.depth = 0)&quot;;
<a name="l6954"><span class="linenum">6954</span></a>              }
<a name="l6955"><span class="linenum">6955</span></a>  
<a name="l6956"><span class="linenum">6956</span></a>              <a class="var it5295" onMouseOver="hilite(5295)" onMouseOut="lolite()" onClick="logVariable('base')" href="../_variables/base.html">$base</a> = '/'.<a class="constant" onClick="logConstant('SYSCONTEXTID')" href="../_constants/SYSCONTEXTID.html" onMouseOver="constPopup(event,'SYSCONTEXTID')">SYSCONTEXTID</a>;
<a name="l6957"><span class="linenum">6957</span></a>  
<a name="l6958"><span class="linenum">6958</span></a>  <span class="comment">            // Standard frontpage</span>
<a name="l6959"><span class="linenum">6959</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;UPDATE {context}
<a name="l6960"><span class="linenum">6960</span></a>                         SET depth = 2,
<a name="l6961"><span class="linenum">6961</span></a>                             path = &quot;.<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_concat')" href="../_functions/sql_concat.html" onMouseOver="funcPopup(event,'sql_concat')">sql_concat</a>(&quot;'<a class="var it5295" onMouseOver="hilite(5295)" onMouseOut="lolite()" onClick="logVariable('base')" href="../_variables/base.html">$base</a>/'&quot;, 'id').&quot;
<a name="l6962"><span class="linenum">6962</span></a>                       WHERE contextlevel = &quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>.&quot;
<a name="l6963"><span class="linenum">6963</span></a>                             AND <a class="function" onClick="logFunction('EXISTS')" href="../_functions/exists.html" onMouseOver="funcPopup(event,'exists')">EXISTS</a> (SELECT 'x'
<a name="l6964"><span class="linenum">6964</span></a>                                           FROM {course} c
<a name="l6965"><span class="linenum">6965</span></a>                                          WHERE c.id = {context}.instanceid AND c.category = 0)
<a name="l6966"><span class="linenum">6966</span></a>                             <a class="var it28912" onMouseOver="hilite(28912)" onMouseOut="lolite()" onClick="logVariable('emptyclause')" href="../_variables/emptyclause.html">$emptyclause</a>&quot;;
<a name="l6967"><span class="linenum">6967</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>);
<a name="l6968"><span class="linenum">6968</span></a>  
<a name="l6969"><span class="linenum">6969</span></a>  <span class="comment">            // standard courses</span>
<a name="l6970"><span class="linenum">6970</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;INSERT INTO {context_temp} (id, path, depth)
<a name="l6971"><span class="linenum">6971</span></a>                      SELECT ctx.id, &quot;.<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_concat')" href="../_functions/sql_concat.html" onMouseOver="funcPopup(event,'sql_concat')">sql_concat</a>('pctx.path', &quot;'/'&quot;, 'ctx.id').&quot;, pctx.depth+1
<a name="l6972"><span class="linenum">6972</span></a>                        FROM {context} ctx
<a name="l6973"><span class="linenum">6973</span></a>                        JOIN {course} c <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (c.id = ctx.instanceid AND ctx.contextlevel = &quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>.&quot; AND c.category &lt;&gt; 0)
<a name="l6974"><span class="linenum">6974</span></a>                        JOIN {context} pctx <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (pctx.instanceid = c.category AND pctx.contextlevel = &quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>.&quot;)
<a name="l6975"><span class="linenum">6975</span></a>                       WHERE pctx.path IS NOT NULL AND pctx.depth &gt; 0
<a name="l6976"><span class="linenum">6976</span></a>                             <a class="var it28911" onMouseOver="hilite(28911)" onMouseOut="lolite()" onClick="logVariable('ctxemptyclause')" href="../_variables/ctxemptyclause.html">$ctxemptyclause</a>&quot;;
<a name="l6977"><span class="linenum">6977</span></a>              <a class="var it24866" onMouseOver="hilite(24866)" onMouseOut="lolite()" onClick="logVariable('trans')" href="../_variables/trans.html">$trans</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l6978"><span class="linenum">6978</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('context_temp');
<a name="l6979"><span class="linenum">6979</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>);
<a name="l6980"><span class="linenum">6980</span></a>              context::<a class="function" onClick="logFunction('merge_context_temp_table')" href="../_functions/merge_context_temp_table.html" onMouseOver="funcPopup(event,'merge_context_temp_table')">merge_context_temp_table</a>();
<a name="l6981"><span class="linenum">6981</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('context_temp');
<a name="l6982"><span class="linenum">6982</span></a>              <a class="var it24866" onMouseOver="hilite(24866)" onMouseOut="lolite()" onClick="logVariable('trans')" href="../_variables/trans.html">$trans</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l6983"><span class="linenum">6983</span></a>          }
<a name="l6984"><span class="linenum">6984</span></a>      }
<a name="l6985"><span class="linenum">6985</span></a>  }
<a name="l6986"><span class="linenum">6986</span></a>  
<a name="l6987"><span class="linenum">6987</span></a>  
<a name="l6988"><span class="linenum">6988</span></a>  <span class="comment">/**</span>
<a name="l6989"><span class="linenum">6989</span></a>  <span class="comment"> * Course module context class</span>
<a name="l6990"><span class="linenum">6990</span></a>  <span class="comment"> *</span>
<a name="l6991"><span class="linenum">6991</span></a>  <span class="comment"> * @package   core_access</span>
<a name="l6992"><span class="linenum">6992</span></a>  <span class="comment"> * @category  access</span>
<a name="l6993"><span class="linenum">6993</span></a>  <span class="comment"> * @copyright Petr Skoda {@link http://skodak.org}</span>
<a name="l6994"><span class="linenum">6994</span></a>  <span class="comment"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l6995"><span class="linenum">6995</span></a>  <span class="comment"> * @since     Moodle 2.2</span>
<a name="l6996"><span class="linenum">6996</span></a>  <span class="comment"> */</span>
<a name="l6997"><span class="linenum">6997</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('context_module')" href="../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a> extends context {
<a name="l6998"><span class="linenum">6998</span></a>      <span class="comment">/**</span>
<a name="l6999"><span class="linenum">6999</span></a>  <span class="comment">     * Please use context_module::instance($cmid) if you need the instance of context.</span>
<a name="l7000"><span class="linenum">7000</span></a>  <span class="comment">     * Alternatively if you know only the context id use context::instance_by_id($contextid)</span>
<a name="l7001"><span class="linenum">7001</span></a>  <span class="comment">     *</span>
<a name="l7002"><span class="linenum">7002</span></a>  <span class="comment">     * @param stdClass $record</span>
<a name="l7003"><span class="linenum">7003</span></a>  <span class="comment">     */</span>
<a name="l7004"><span class="linenum">7004</span></a>      protected function <a class="function" onClick="logFunction('__construct')" href="../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>(stdClass <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>) {
<a name="l7005"><span class="linenum">7005</span></a>          parent::<a class="function" onClick="logFunction('__construct')" href="../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l7006"><span class="linenum">7006</span></a>          if (<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> != <a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>) {
<a name="l7007"><span class="linenum">7007</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> in context_module constructor.');
<a name="l7008"><span class="linenum">7008</span></a>          }
<a name="l7009"><span class="linenum">7009</span></a>      }
<a name="l7010"><span class="linenum">7010</span></a>  
<a name="l7011"><span class="linenum">7011</span></a>      <span class="comment">/**</span>
<a name="l7012"><span class="linenum">7012</span></a>  <span class="comment">     * Returns human readable context level name.</span>
<a name="l7013"><span class="linenum">7013</span></a>  <span class="comment">     *</span>
<a name="l7014"><span class="linenum">7014</span></a>  <span class="comment">     * @static</span>
<a name="l7015"><span class="linenum">7015</span></a>  <span class="comment">     * @return string the human readable context level name.</span>
<a name="l7016"><span class="linenum">7016</span></a>  <span class="comment">     */</span>
<a name="l7017"><span class="linenum">7017</span></a>      public static function <a class="function" onClick="logFunction('get_level_name')" href="../_functions/get_level_name.html" onMouseOver="funcPopup(event,'get_level_name')">get_level_name</a>() {
<a name="l7018"><span class="linenum">7018</span></a>          return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('activitymodule');
<a name="l7019"><span class="linenum">7019</span></a>      }
<a name="l7020"><span class="linenum">7020</span></a>  
<a name="l7021"><span class="linenum">7021</span></a>      <span class="comment">/**</span>
<a name="l7022"><span class="linenum">7022</span></a>  <span class="comment">     * Returns human readable context identifier.</span>
<a name="l7023"><span class="linenum">7023</span></a>  <span class="comment">     *</span>
<a name="l7024"><span class="linenum">7024</span></a>  <span class="comment">     * @param boolean $withprefix whether to prefix the name of the context with the</span>
<a name="l7025"><span class="linenum">7025</span></a>  <span class="comment">     *      module name, e.g. Forum, Glossary, etc.</span>
<a name="l7026"><span class="linenum">7026</span></a>  <span class="comment">     * @param boolean $short does not apply to module context</span>
<a name="l7027"><span class="linenum">7027</span></a>  <span class="comment">     * @return string the human readable context name.</span>
<a name="l7028"><span class="linenum">7028</span></a>  <span class="comment">     */</span>
<a name="l7029"><span class="linenum">7029</span></a>      public function <a class="function" onClick="logFunction('get_context_name')" href="../_functions/get_context_name.html" onMouseOver="funcPopup(event,'get_context_name')">get_context_name</a>(<a class="var it25263" onMouseOver="hilite(25263)" onMouseOut="lolite()" onClick="logVariable('withprefix')" href="../_variables/withprefix.html">$withprefix</a> = true, <a class="var it1725" onMouseOver="hilite(1725)" onMouseOut="lolite()" onClick="logVariable('short')" href="../_variables/short.html">$short</a> = false) {
<a name="l7030"><span class="linenum">7030</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l7031"><span class="linenum">7031</span></a>  
<a name="l7032"><span class="linenum">7032</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = '';
<a name="l7033"><span class="linenum">7033</span></a>          if (<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(&quot;SELECT cm.*, md.name AS modname
<a name="l7034"><span class="linenum">7034</span></a>                                           FROM {course_modules} cm
<a name="l7035"><span class="linenum">7035</span></a>                                           JOIN {modules} md ON md.id = cm.module
<a name="l7036"><span class="linenum">7036</span></a>                                          WHERE cm.id = ?&quot;, array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_instanceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_instanceid.html">_instanceid</a>))) {
<a name="l7037"><span class="linenum">7037</span></a>              if (<a class="var it414" onMouseOver="hilite(414)" onMouseOut="lolite()" onClick="logVariable('mod')" href="../_variables/mod.html">$mod</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('modname')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/modname.html">modname</a>, array('id' =&gt; <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/instance.html">instance</a>))) {
<a name="l7038"><span class="linenum">7038</span></a>                      if (<a class="var it25263" onMouseOver="hilite(25263)" onMouseOut="lolite()" onClick="logVariable('withprefix')" href="../_variables/withprefix.html">$withprefix</a>){
<a name="l7039"><span class="linenum">7039</span></a>                          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('modulename', <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('modname')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/modname.html">modname</a>).': ';
<a name="l7040"><span class="linenum">7040</span></a>                      }
<a name="l7041"><span class="linenum">7041</span></a>                      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> .= <a class="function" onClick="logFunction('format_string')" href="../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it414" onMouseOver="hilite(414)" onMouseOut="lolite()" onClick="logVariable('mod')" href="../_variables/mod.html">$mod</a>-&gt;<a onClick="logVariable('name')" class="var it40073" onMouseOver="hilite(40073)" onMouseOut="lolite()" href="../_variables/name.html">name</a>, true, array('context' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>));
<a name="l7042"><span class="linenum">7042</span></a>                  }
<a name="l7043"><span class="linenum">7043</span></a>              }
<a name="l7044"><span class="linenum">7044</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>;
<a name="l7045"><span class="linenum">7045</span></a>      }
<a name="l7046"><span class="linenum">7046</span></a>  
<a name="l7047"><span class="linenum">7047</span></a>      <span class="comment">/**</span>
<a name="l7048"><span class="linenum">7048</span></a>  <span class="comment">     * Returns the most relevant URL for this context.</span>
<a name="l7049"><span class="linenum">7049</span></a>  <span class="comment">     *</span>
<a name="l7050"><span class="linenum">7050</span></a>  <span class="comment">     * @return moodle_url</span>
<a name="l7051"><span class="linenum">7051</span></a>  <span class="comment">     */</span>
<a name="l7052"><span class="linenum">7052</span></a>      public function <a class="function" onClick="logFunction('get_url')" href="../_functions/get_url.html" onMouseOver="funcPopup(event,'get_url')">get_url</a>() {
<a name="l7053"><span class="linenum">7053</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l7054"><span class="linenum">7054</span></a>  
<a name="l7055"><span class="linenum">7055</span></a>          if (<a class="var it561" onMouseOver="hilite(561)" onMouseOut="lolite()" onClick="logVariable('modname')" href="../_variables/modname.html">$modname</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field_sql')" href="../_functions/get_field_sql.html" onMouseOver="funcPopup(event,'get_field_sql')">get_field_sql</a>(&quot;SELECT md.name AS modname
<a name="l7056"><span class="linenum">7056</span></a>                                               FROM {course_modules} cm
<a name="l7057"><span class="linenum">7057</span></a>                                               JOIN {modules} md ON md.id = cm.module
<a name="l7058"><span class="linenum">7058</span></a>                                              WHERE cm.id = ?&quot;, array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_instanceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_instanceid.html">_instanceid</a>))) {
<a name="l7059"><span class="linenum">7059</span></a>              return <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('/mod/' . <a class="var it561" onMouseOver="hilite(561)" onMouseOut="lolite()" onClick="logVariable('modname')" href="../_variables/modname.html">$modname</a> . '/view.php', array('id'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_instanceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_instanceid.html">_instanceid</a>));
<a name="l7060"><span class="linenum">7060</span></a>          }
<a name="l7061"><span class="linenum">7061</span></a>  
<a name="l7062"><span class="linenum">7062</span></a>          return <span class="keyword">new </span><a class="class" onClick="logClass('moodle_url')" href="../_classes/moodle_url.html" onMouseOver="classPopup(event,'moodle_url')">moodle_url</a>('/');
<a name="l7063"><span class="linenum">7063</span></a>      }
<a name="l7064"><span class="linenum">7064</span></a>  
<a name="l7065"><span class="linenum">7065</span></a>      <span class="comment">/**</span>
<a name="l7066"><span class="linenum">7066</span></a>  <span class="comment">     * Returns array of relevant context capability records.</span>
<a name="l7067"><span class="linenum">7067</span></a>  <span class="comment">     *</span>
<a name="l7068"><span class="linenum">7068</span></a>  <span class="comment">     * @return array</span>
<a name="l7069"><span class="linenum">7069</span></a>  <span class="comment">     */</span>
<a name="l7070"><span class="linenum">7070</span></a>      public function <a class="function" onClick="logFunction('get_capabilities')" href="../_functions/get_capabilities.html" onMouseOver="funcPopup(event,'get_capabilities')">get_capabilities</a>() {
<a name="l7071"><span class="linenum">7071</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l7072"><span class="linenum">7072</span></a>  
<a name="l7073"><span class="linenum">7073</span></a>          <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a> = 'ORDER BY contextlevel,component,name';   <span class="comment">// To group them sensibly for display</span>
<a name="l7074"><span class="linenum">7074</span></a>  
<a name="l7075"><span class="linenum">7075</span></a>          <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course_modules', array('id'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_instanceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_instanceid.html">_instanceid</a>));
<a name="l7076"><span class="linenum">7076</span></a>          <a class="var it611" onMouseOver="hilite(611)" onMouseOut="lolite()" onClick="logVariable('module')" href="../_variables/module.html">$module</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('modules', array('id'=&gt;<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('module')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/module.html">module</a>));
<a name="l7077"><span class="linenum">7077</span></a>  
<a name="l7078"><span class="linenum">7078</span></a>          <a class="var it28913" onMouseOver="hilite(28913)" onMouseOut="lolite()" onClick="logVariable('subcaps')" href="../_variables/subcaps.html">$subcaps</a> = array();
<a name="l7079"><span class="linenum">7079</span></a>          <a class="var it6010" onMouseOver="hilite(6010)" onMouseOut="lolite()" onClick="logVariable('subpluginsfile')" href="../_variables/subpluginsfile.html">$subpluginsfile</a> = &quot;<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>/mod/<a class="var it611" onMouseOver="hilite(611)" onMouseOut="lolite()" onClick="logVariable('module')" href="../_variables/module.html">$module</a>-&gt;<a onClick="logVariable('name')" class="var it39455" onMouseOver="hilite(39455)" onMouseOut="lolite()" href="../_variables/name.html">name</a>/db/subplugins.php&quot;;
<a name="l7080"><span class="linenum">7080</span></a>          if (<a class="phpfunction" onClick="logFunction('file_exists')" href="../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it6010" onMouseOver="hilite(6010)" onMouseOut="lolite()" onClick="logVariable('subpluginsfile')" href="../_variables/subpluginsfile.html">$subpluginsfile</a>)) {
<a name="l7081"><span class="linenum">7081</span></a>              <a class="var it5373" onMouseOver="hilite(5373)" onMouseOut="lolite()" onClick="logVariable('subplugins')" href="../_variables/subplugins.html">$subplugins</a> = array();  <span class="comment">// should be redefined in the file</span>
<a name="l7082"><span class="linenum">7082</span></a>              include(<a class="var it6010" onMouseOver="hilite(6010)" onMouseOut="lolite()" onClick="logVariable('subpluginsfile')" href="../_variables/subpluginsfile.html">$subpluginsfile</a>);
<a name="l7083"><span class="linenum">7083</span></a>              if (!empty(<a class="var it5373" onMouseOver="hilite(5373)" onMouseOut="lolite()" onClick="logVariable('subplugins')" href="../_variables/subplugins.html">$subplugins</a>)) {
<a name="l7084"><span class="linenum">7084</span></a>                  foreach (<a class="phpfunction" onClick="logFunction('array_keys')" href="../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it5373" onMouseOver="hilite(5373)" onMouseOut="lolite()" onClick="logVariable('subplugins')" href="../_variables/subplugins.html">$subplugins</a>) as <a class="var it6009" onMouseOver="hilite(6009)" onMouseOut="lolite()" onClick="logVariable('subplugintype')" href="../_variables/subplugintype.html">$subplugintype</a>) {
<a name="l7085"><span class="linenum">7085</span></a>                      foreach (<a class="phpfunction" onClick="logFunction('array_keys')" href="../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="class" onClick="logClass('core_component')" href="../_classes/core_component.html" onMouseOver="classPopup(event,'core_component')">core_component</a>::<a class="function" onClick="logFunction('get_plugin_list')" href="../_functions/get_plugin_list.html" onMouseOver="funcPopup(event,'get_plugin_list')">get_plugin_list</a>(<a class="var it6009" onMouseOver="hilite(6009)" onMouseOut="lolite()" onClick="logVariable('subplugintype')" href="../_variables/subplugintype.html">$subplugintype</a>)) as <a class="var it5377" onMouseOver="hilite(5377)" onMouseOut="lolite()" onClick="logVariable('subpluginname')" href="../_variables/subpluginname.html">$subpluginname</a>) {
<a name="l7086"><span class="linenum">7086</span></a>                          <a class="var it28913" onMouseOver="hilite(28913)" onMouseOut="lolite()" onClick="logVariable('subcaps')" href="../_variables/subcaps.html">$subcaps</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it28913" onMouseOver="hilite(28913)" onMouseOut="lolite()" onClick="logVariable('subcaps')" href="../_variables/subcaps.html">$subcaps</a>, <a class="phpfunction" onClick="logFunction('array_keys')" href="../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="function" onClick="logFunction('load_capability_def')" href="../_functions/load_capability_def.html" onMouseOver="funcPopup(event,'load_capability_def')">load_capability_def</a>(<a class="var it6009" onMouseOver="hilite(6009)" onMouseOut="lolite()" onClick="logVariable('subplugintype')" href="../_variables/subplugintype.html">$subplugintype</a>.'_'.<a class="var it5377" onMouseOver="hilite(5377)" onMouseOut="lolite()" onClick="logVariable('subpluginname')" href="../_variables/subpluginname.html">$subpluginname</a>)));
<a name="l7087"><span class="linenum">7087</span></a>                      }
<a name="l7088"><span class="linenum">7088</span></a>                  }
<a name="l7089"><span class="linenum">7089</span></a>              }
<a name="l7090"><span class="linenum">7090</span></a>          }
<a name="l7091"><span class="linenum">7091</span></a>  
<a name="l7092"><span class="linenum">7092</span></a>          <a class="var it13036" onMouseOver="hilite(13036)" onMouseOut="lolite()" onClick="logVariable('modfile')" href="../_variables/modfile.html">$modfile</a> = &quot;<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>/mod/<a class="var it611" onMouseOver="hilite(611)" onMouseOut="lolite()" onClick="logVariable('module')" href="../_variables/module.html">$module</a>-&gt;<a onClick="logVariable('name')" class="var it39455" onMouseOver="hilite(39455)" onMouseOut="lolite()" href="../_variables/name.html">name</a>/lib.php&quot;;
<a name="l7093"><span class="linenum">7093</span></a>          <a class="var it28908" onMouseOver="hilite(28908)" onMouseOut="lolite()" onClick="logVariable('extracaps')" href="../_variables/extracaps.html">$extracaps</a> = array();
<a name="l7094"><span class="linenum">7094</span></a>          if (<a class="phpfunction" onClick="logFunction('file_exists')" href="../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it13036" onMouseOver="hilite(13036)" onMouseOut="lolite()" onClick="logVariable('modfile')" href="../_variables/modfile.html">$modfile</a>)) {
<a name="l7095"><span class="linenum">7095</span></a>              include_once(<a class="var it13036" onMouseOver="hilite(13036)" onMouseOut="lolite()" onClick="logVariable('modfile')" href="../_variables/modfile.html">$modfile</a>);
<a name="l7096"><span class="linenum">7096</span></a>              <a class="var it28914" onMouseOver="hilite(28914)" onMouseOut="lolite()" onClick="logVariable('modfunction')" href="../_variables/modfunction.html">$modfunction</a> = <a class="var it611" onMouseOver="hilite(611)" onMouseOut="lolite()" onClick="logVariable('module')" href="../_variables/module.html">$module</a>-&gt;<a onClick="logVariable('name')" class="var it39455" onMouseOver="hilite(39455)" onMouseOut="lolite()" href="../_variables/name.html">name</a>.'_get_extra_capabilities';
<a name="l7097"><span class="linenum">7097</span></a>              if (<a class="phpfunction" onClick="logFunction('function_exists')" href="../_functions/function_exists.html" onMouseOver="phpfuncPopup(event,'function_exists')">function_exists</a>(<a class="var it28914" onMouseOver="hilite(28914)" onMouseOut="lolite()" onClick="logVariable('modfunction')" href="../_variables/modfunction.html">$modfunction</a>)) {
<a name="l7098"><span class="linenum">7098</span></a>                  <a class="var it28908" onMouseOver="hilite(28908)" onMouseOut="lolite()" onClick="logVariable('extracaps')" href="../_variables/extracaps.html">$extracaps</a> = <a class="var it28914" onMouseOver="hilite(28914)" onMouseOut="lolite()" onClick="logVariable('modfunction')" href="../_variables/modfunction.html">$modfunction</a>();
<a name="l7099"><span class="linenum">7099</span></a>              }
<a name="l7100"><span class="linenum">7100</span></a>          }
<a name="l7101"><span class="linenum">7101</span></a>  
<a name="l7102"><span class="linenum">7102</span></a>          <a class="var it28908" onMouseOver="hilite(28908)" onMouseOut="lolite()" onClick="logVariable('extracaps')" href="../_variables/extracaps.html">$extracaps</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it28913" onMouseOver="hilite(28913)" onMouseOut="lolite()" onClick="logVariable('subcaps')" href="../_variables/subcaps.html">$subcaps</a>, <a class="var it28908" onMouseOver="hilite(28908)" onMouseOut="lolite()" onClick="logVariable('extracaps')" href="../_variables/extracaps.html">$extracaps</a>);
<a name="l7103"><span class="linenum">7103</span></a>          <a class="var it2018" onMouseOver="hilite(2018)" onMouseOut="lolite()" onClick="logVariable('extra')" href="../_variables/extra.html">$extra</a> = '';
<a name="l7104"><span class="linenum">7104</span></a>          <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it2018" onMouseOver="hilite(2018)" onMouseOut="lolite()" onClick="logVariable('extra')" href="../_variables/extra.html">$extra</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(
<a name="l7105"><span class="linenum">7105</span></a>              <a class="var it28908" onMouseOver="hilite(28908)" onMouseOut="lolite()" onClick="logVariable('extracaps')" href="../_variables/extracaps.html">$extracaps</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'cap0', true, '');
<a name="l7106"><span class="linenum">7106</span></a>          if (!empty(<a class="var it2018" onMouseOver="hilite(2018)" onMouseOut="lolite()" onClick="logVariable('extra')" href="../_variables/extra.html">$extra</a>)) {
<a name="l7107"><span class="linenum">7107</span></a>              <a class="var it2018" onMouseOver="hilite(2018)" onMouseOut="lolite()" onClick="logVariable('extra')" href="../_variables/extra.html">$extra</a> = &quot;OR name <a class="var it2018" onMouseOver="hilite(2018)" onMouseOut="lolite()" onClick="logVariable('extra')" href="../_variables/extra.html">$extra</a>&quot;;
<a name="l7108"><span class="linenum">7108</span></a>          }
<a name="l7109"><span class="linenum">7109</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT *
<a name="l7110"><span class="linenum">7110</span></a>                    FROM {capabilities}
<a name="l7111"><span class="linenum">7111</span></a>                   <a class="function" onClick="logFunction('WHERE')" href="../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a> (contextlevel = &quot;.<a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>.&quot;
<a name="l7112"><span class="linenum">7112</span></a>                         AND (component = :component OR component = 'moodle'))
<a name="l7113"><span class="linenum">7113</span></a>                         <a class="var it2018" onMouseOver="hilite(2018)" onMouseOut="lolite()" onClick="logVariable('extra')" href="../_variables/extra.html">$extra</a>&quot;;
<a name="l7114"><span class="linenum">7114</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['component'] = &quot;mod_<a class="var it611" onMouseOver="hilite(611)" onMouseOut="lolite()" onClick="logVariable('module')" href="../_variables/module.html">$module</a>-&gt;<a onClick="logVariable('name')" class="var it39455" onMouseOver="hilite(39455)" onMouseOut="lolite()" href="../_variables/name.html">name</a>&quot;;
<a name="l7115"><span class="linenum">7115</span></a>  
<a name="l7116"><span class="linenum">7116</span></a>          return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>.' '.<a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l7117"><span class="linenum">7117</span></a>      }
<a name="l7118"><span class="linenum">7118</span></a>  
<a name="l7119"><span class="linenum">7119</span></a>      <span class="comment">/**</span>
<a name="l7120"><span class="linenum">7120</span></a>  <span class="comment">     * Is this context part of any course? If yes return course context.</span>
<a name="l7121"><span class="linenum">7121</span></a>  <span class="comment">     *</span>
<a name="l7122"><span class="linenum">7122</span></a>  <span class="comment">     * @param bool $strict true means throw exception if not found, false means return false if not found</span>
<a name="l7123"><span class="linenum">7123</span></a>  <span class="comment">     * @return context_course context of the enclosing course, null if not found or exception</span>
<a name="l7124"><span class="linenum">7124</span></a>  <span class="comment">     */</span>
<a name="l7125"><span class="linenum">7125</span></a>      public function <a class="function" onClick="logFunction('get_course_context')" href="../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>(<a class="var it13192" onMouseOver="hilite(13192)" onMouseOut="lolite()" onClick="logVariable('strict')" href="../_variables/strict.html">$strict</a> = true) {
<a name="l7126"><span class="linenum">7126</span></a>          return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_parent_context')" href="../_functions/get_parent_context.html" onMouseOver="funcPopup(event,'get_parent_context')">get_parent_context</a>();
<a name="l7127"><span class="linenum">7127</span></a>      }
<a name="l7128"><span class="linenum">7128</span></a>  
<a name="l7129"><span class="linenum">7129</span></a>      <span class="comment">/**</span>
<a name="l7130"><span class="linenum">7130</span></a>  <span class="comment">     * Returns module context instance.</span>
<a name="l7131"><span class="linenum">7131</span></a>  <span class="comment">     *</span>
<a name="l7132"><span class="linenum">7132</span></a>  <span class="comment">     * @static</span>
<a name="l7133"><span class="linenum">7133</span></a>  <span class="comment">     * @param int $instanceid</span>
<a name="l7134"><span class="linenum">7134</span></a>  <span class="comment">     * @param int $strictness</span>
<a name="l7135"><span class="linenum">7135</span></a>  <span class="comment">     * @return context_module context instance</span>
<a name="l7136"><span class="linenum">7136</span></a>  <span class="comment">     */</span>
<a name="l7137"><span class="linenum">7137</span></a>      public static function <a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>, <a class="var it4662" onMouseOver="hilite(4662)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a> = <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>) {
<a name="l7138"><span class="linenum">7138</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l7139"><span class="linenum">7139</span></a>  
<a name="l7140"><span class="linenum">7140</span></a>          if (<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = context::<a class="function" onClick="logFunction('cache_get')" href="../_functions/cache_get.html" onMouseOver="funcPopup(event,'cache_get')">cache_get</a>(<a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>, <a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>)) {
<a name="l7141"><span class="linenum">7141</span></a>              return <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>;
<a name="l7142"><span class="linenum">7142</span></a>          }
<a name="l7143"><span class="linenum">7143</span></a>  
<a name="l7144"><span class="linenum">7144</span></a>          if (!<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('context', array('contextlevel'=&gt;<a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>, 'instanceid'=&gt;<a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>))) {
<a name="l7145"><span class="linenum">7145</span></a>              if (<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course_modules', array('id'=&gt;<a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>), 'id,course', <a class="var it4662" onMouseOver="hilite(4662)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a>)) {
<a name="l7146"><span class="linenum">7146</span></a>                  <a class="var it4943" onMouseOver="hilite(4943)" onMouseOut="lolite()" onClick="logVariable('parentcontext')" href="../_variables/parentcontext.html">$parentcontext</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('course')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/course.html">course</a>);
<a name="l7147"><span class="linenum">7147</span></a>                  <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = context::<a class="function" onClick="logFunction('insert_context_record')" href="../_functions/insert_context_record.html" onMouseOver="funcPopup(event,'insert_context_record')">insert_context_record</a>(<a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>, <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it4943" onMouseOver="hilite(4943)" onMouseOut="lolite()" onClick="logVariable('parentcontext')" href="../_variables/parentcontext.html">$parentcontext</a>-&gt;<a onClick="logVariable('path')" class="var it39842" onMouseOver="hilite(39842)" onMouseOut="lolite()" href="../_variables/path.html">path</a>);
<a name="l7148"><span class="linenum">7148</span></a>              }
<a name="l7149"><span class="linenum">7149</span></a>          }
<a name="l7150"><span class="linenum">7150</span></a>  
<a name="l7151"><span class="linenum">7151</span></a>          if (<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>) {
<a name="l7152"><span class="linenum">7152</span></a>              <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <span class="keyword">new </span><a class="class" onClick="logClass('context_module')" href="../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l7153"><span class="linenum">7153</span></a>              context::<a class="function" onClick="logFunction('cache_add')" href="../_functions/cache_add.html" onMouseOver="funcPopup(event,'cache_add')">cache_add</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l7154"><span class="linenum">7154</span></a>              return <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>;
<a name="l7155"><span class="linenum">7155</span></a>          }
<a name="l7156"><span class="linenum">7156</span></a>  
<a name="l7157"><span class="linenum">7157</span></a>          return false;
<a name="l7158"><span class="linenum">7158</span></a>      }
<a name="l7159"><span class="linenum">7159</span></a>  
<a name="l7160"><span class="linenum">7160</span></a>      <span class="comment">/**</span>
<a name="l7161"><span class="linenum">7161</span></a>  <span class="comment">     * Create missing context instances at module context level</span>
<a name="l7162"><span class="linenum">7162</span></a>  <span class="comment">     * @static</span>
<a name="l7163"><span class="linenum">7163</span></a>  <span class="comment">     */</span>
<a name="l7164"><span class="linenum">7164</span></a>      protected static function <a class="function" onClick="logFunction('create_level_instances')" href="../_functions/create_level_instances.html" onMouseOver="funcPopup(event,'create_level_instances')">create_level_instances</a>() {
<a name="l7165"><span class="linenum">7165</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l7166"><span class="linenum">7166</span></a>  
<a name="l7167"><span class="linenum">7167</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT &quot;.<a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>.&quot;, cm.id
<a name="l7168"><span class="linenum">7168</span></a>                    FROM {course_modules} cm
<a name="l7169"><span class="linenum">7169</span></a>                   WHERE NOT <a class="function" onClick="logFunction('EXISTS')" href="../_functions/exists.html" onMouseOver="funcPopup(event,'exists')">EXISTS</a> (SELECT 'x'
<a name="l7170"><span class="linenum">7170</span></a>                                       FROM {context} cx
<a name="l7171"><span class="linenum">7171</span></a>                                      WHERE cm.id = cx.instanceid AND cx.contextlevel=&quot;.<a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>.&quot;)&quot;;
<a name="l7172"><span class="linenum">7172</span></a>          <a class="var it28909" onMouseOver="hilite(28909)" onMouseOut="lolite()" onClick="logVariable('contextdata')" href="../_variables/contextdata.html">$contextdata</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>);
<a name="l7173"><span class="linenum">7173</span></a>          foreach (<a class="var it28909" onMouseOver="hilite(28909)" onMouseOut="lolite()" onClick="logVariable('contextdata')" href="../_variables/contextdata.html">$contextdata</a> as <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l7174"><span class="linenum">7174</span></a>              context::<a class="function" onClick="logFunction('insert_context_record')" href="../_functions/insert_context_record.html" onMouseOver="funcPopup(event,'insert_context_record')">insert_context_record</a>(<a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, null);
<a name="l7175"><span class="linenum">7175</span></a>          }
<a name="l7176"><span class="linenum">7176</span></a>          <a class="var it28909" onMouseOver="hilite(28909)" onMouseOut="lolite()" onClick="logVariable('contextdata')" href="../_variables/contextdata.html">$contextdata</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l7177"><span class="linenum">7177</span></a>      }
<a name="l7178"><span class="linenum">7178</span></a>  
<a name="l7179"><span class="linenum">7179</span></a>      <span class="comment">/**</span>
<a name="l7180"><span class="linenum">7180</span></a>  <span class="comment">     * Returns sql necessary for purging of stale context instances.</span>
<a name="l7181"><span class="linenum">7181</span></a>  <span class="comment">     *</span>
<a name="l7182"><span class="linenum">7182</span></a>  <span class="comment">     * @static</span>
<a name="l7183"><span class="linenum">7183</span></a>  <span class="comment">     * @return string cleanup SQL</span>
<a name="l7184"><span class="linenum">7184</span></a>  <span class="comment">     */</span>
<a name="l7185"><span class="linenum">7185</span></a>      protected static function <a class="function" onClick="logFunction('get_cleanup_sql')" href="../_functions/get_cleanup_sql.html" onMouseOver="funcPopup(event,'get_cleanup_sql')">get_cleanup_sql</a>() {
<a name="l7186"><span class="linenum">7186</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;
<a name="l7187"><span class="linenum">7187</span></a>                    SELECT c.*
<a name="l7188"><span class="linenum">7188</span></a>                      FROM {context} c
<a name="l7189"><span class="linenum">7189</span></a>           LEFT OUTER JOIN {course_modules} cm ON c.instanceid = cm.id
<a name="l7190"><span class="linenum">7190</span></a>                     WHERE cm.id IS NULL AND c.contextlevel = &quot;.<a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>.&quot;
<a name="l7191"><span class="linenum">7191</span></a>                 &quot;;
<a name="l7192"><span class="linenum">7192</span></a>  
<a name="l7193"><span class="linenum">7193</span></a>          return <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>;
<a name="l7194"><span class="linenum">7194</span></a>      }
<a name="l7195"><span class="linenum">7195</span></a>  
<a name="l7196"><span class="linenum">7196</span></a>      <span class="comment">/**</span>
<a name="l7197"><span class="linenum">7197</span></a>  <span class="comment">     * Rebuild context paths and depths at module context level.</span>
<a name="l7198"><span class="linenum">7198</span></a>  <span class="comment">     *</span>
<a name="l7199"><span class="linenum">7199</span></a>  <span class="comment">     * @static</span>
<a name="l7200"><span class="linenum">7200</span></a>  <span class="comment">     * @param bool $force</span>
<a name="l7201"><span class="linenum">7201</span></a>  <span class="comment">     */</span>
<a name="l7202"><span class="linenum">7202</span></a>      protected static function <a class="function" onClick="logFunction('build_paths')" href="../_functions/build_paths.html" onMouseOver="funcPopup(event,'build_paths')">build_paths</a>(<a class="var it5797" onMouseOver="hilite(5797)" onMouseOut="lolite()" onClick="logVariable('force')" href="../_variables/force.html">$force</a>) {
<a name="l7203"><span class="linenum">7203</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l7204"><span class="linenum">7204</span></a>  
<a name="l7205"><span class="linenum">7205</span></a>          if (<a class="var it5797" onMouseOver="hilite(5797)" onMouseOut="lolite()" onClick="logVariable('force')" href="../_variables/force.html">$force</a> or <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists_select')" href="../_functions/record_exists_select.html" onMouseOver="funcPopup(event,'record_exists_select')">record_exists_select</a>('context', &quot;contextlevel = &quot;.<a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>.&quot; AND (depth = 0 OR path IS NULL)&quot;)) {
<a name="l7206"><span class="linenum">7206</span></a>              if (<a class="var it5797" onMouseOver="hilite(5797)" onMouseOut="lolite()" onClick="logVariable('force')" href="../_variables/force.html">$force</a>) {
<a name="l7207"><span class="linenum">7207</span></a>                  <a class="var it28911" onMouseOver="hilite(28911)" onMouseOut="lolite()" onClick="logVariable('ctxemptyclause')" href="../_variables/ctxemptyclause.html">$ctxemptyclause</a> = '';
<a name="l7208"><span class="linenum">7208</span></a>              } else {
<a name="l7209"><span class="linenum">7209</span></a>                  <a class="var it28911" onMouseOver="hilite(28911)" onMouseOut="lolite()" onClick="logVariable('ctxemptyclause')" href="../_variables/ctxemptyclause.html">$ctxemptyclause</a> = &quot;AND (ctx.path IS NULL OR ctx.depth = 0)&quot;;
<a name="l7210"><span class="linenum">7210</span></a>              }
<a name="l7211"><span class="linenum">7211</span></a>  
<a name="l7212"><span class="linenum">7212</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;INSERT INTO {context_temp} (id, path, depth)
<a name="l7213"><span class="linenum">7213</span></a>                      SELECT ctx.id, &quot;.<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_concat')" href="../_functions/sql_concat.html" onMouseOver="funcPopup(event,'sql_concat')">sql_concat</a>('pctx.path', &quot;'/'&quot;, 'ctx.id').&quot;, pctx.depth+1
<a name="l7214"><span class="linenum">7214</span></a>                        FROM {context} ctx
<a name="l7215"><span class="linenum">7215</span></a>                        JOIN {course_modules} cm <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (cm.id = ctx.instanceid AND ctx.contextlevel = &quot;.<a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>.&quot;)
<a name="l7216"><span class="linenum">7216</span></a>                        JOIN {context} pctx <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (pctx.instanceid = cm.course AND pctx.contextlevel = &quot;.<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>.&quot;)
<a name="l7217"><span class="linenum">7217</span></a>                       WHERE pctx.path IS NOT NULL AND pctx.depth &gt; 0
<a name="l7218"><span class="linenum">7218</span></a>                             <a class="var it28911" onMouseOver="hilite(28911)" onMouseOut="lolite()" onClick="logVariable('ctxemptyclause')" href="../_variables/ctxemptyclause.html">$ctxemptyclause</a>&quot;;
<a name="l7219"><span class="linenum">7219</span></a>              <a class="var it24866" onMouseOver="hilite(24866)" onMouseOut="lolite()" onClick="logVariable('trans')" href="../_variables/trans.html">$trans</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l7220"><span class="linenum">7220</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('context_temp');
<a name="l7221"><span class="linenum">7221</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>);
<a name="l7222"><span class="linenum">7222</span></a>              context::<a class="function" onClick="logFunction('merge_context_temp_table')" href="../_functions/merge_context_temp_table.html" onMouseOver="funcPopup(event,'merge_context_temp_table')">merge_context_temp_table</a>();
<a name="l7223"><span class="linenum">7223</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('context_temp');
<a name="l7224"><span class="linenum">7224</span></a>              <a class="var it24866" onMouseOver="hilite(24866)" onMouseOut="lolite()" onClick="logVariable('trans')" href="../_variables/trans.html">$trans</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l7225"><span class="linenum">7225</span></a>          }
<a name="l7226"><span class="linenum">7226</span></a>      }
<a name="l7227"><span class="linenum">7227</span></a>  }
<a name="l7228"><span class="linenum">7228</span></a>  
<a name="l7229"><span class="linenum">7229</span></a>  
<a name="l7230"><span class="linenum">7230</span></a>  <span class="comment">/**</span>
<a name="l7231"><span class="linenum">7231</span></a>  <span class="comment"> * Block context class</span>
<a name="l7232"><span class="linenum">7232</span></a>  <span class="comment"> *</span>
<a name="l7233"><span class="linenum">7233</span></a>  <span class="comment"> * @package   core_access</span>
<a name="l7234"><span class="linenum">7234</span></a>  <span class="comment"> * @category  access</span>
<a name="l7235"><span class="linenum">7235</span></a>  <span class="comment"> * @copyright Petr Skoda {@link http://skodak.org}</span>
<a name="l7236"><span class="linenum">7236</span></a>  <span class="comment"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l7237"><span class="linenum">7237</span></a>  <span class="comment"> * @since     Moodle 2.2</span>
<a name="l7238"><span class="linenum">7238</span></a>  <span class="comment"> */</span>
<a name="l7239"><span class="linenum">7239</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('context_block')" href="../_classes/context_block.html" onMouseOver="classPopup(event,'context_block')">context_block</a> extends context {
<a name="l7240"><span class="linenum">7240</span></a>      <span class="comment">/**</span>
<a name="l7241"><span class="linenum">7241</span></a>  <span class="comment">     * Please use context_block::instance($blockinstanceid) if you need the instance of context.</span>
<a name="l7242"><span class="linenum">7242</span></a>  <span class="comment">     * Alternatively if you know only the context id use context::instance_by_id($contextid)</span>
<a name="l7243"><span class="linenum">7243</span></a>  <span class="comment">     *</span>
<a name="l7244"><span class="linenum">7244</span></a>  <span class="comment">     * @param stdClass $record</span>
<a name="l7245"><span class="linenum">7245</span></a>  <span class="comment">     */</span>
<a name="l7246"><span class="linenum">7246</span></a>      protected function <a class="function" onClick="logFunction('__construct')" href="../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>(stdClass <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>) {
<a name="l7247"><span class="linenum">7247</span></a>          parent::<a class="function" onClick="logFunction('__construct')" href="../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l7248"><span class="linenum">7248</span></a>          if (<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> != <a class="constant" onClick="logConstant('CONTEXT_BLOCK')" href="../_constants/CONTEXT_BLOCK.html" onMouseOver="constPopup(event,'CONTEXT_BLOCK')">CONTEXT_BLOCK</a>) {
<a name="l7249"><span class="linenum">7249</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it39518" onMouseOver="hilite(39518)" onMouseOut="lolite()" href="../_variables/contextlevel.html">contextlevel</a> in context_block constructor');
<a name="l7250"><span class="linenum">7250</span></a>          }
<a name="l7251"><span class="linenum">7251</span></a>      }
<a name="l7252"><span class="linenum">7252</span></a>  
<a name="l7253"><span class="linenum">7253</span></a>      <span class="comment">/**</span>
<a name="l7254"><span class="linenum">7254</span></a>  <span class="comment">     * Returns human readable context level name.</span>
<a name="l7255"><span class="linenum">7255</span></a>  <span class="comment">     *</span>
<a name="l7256"><span class="linenum">7256</span></a>  <span class="comment">     * @static</span>
<a name="l7257"><span class="linenum">7257</span></a>  <span class="comment">     * @return string the human readable context level name.</span>
<a name="l7258"><span class="linenum">7258</span></a>  <span class="comment">     */</span>
<a name="l7259"><span class="linenum">7259</span></a>      public static function <a class="function" onClick="logFunction('get_level_name')" href="../_functions/get_level_name.html" onMouseOver="funcPopup(event,'get_level_name')">get_level_name</a>() {
<a name="l7260"><span class="linenum">7260</span></a>          return <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('block');
<a name="l7261"><span class="linenum">7261</span></a>      }
<a name="l7262"><span class="linenum">7262</span></a>  
<a name="l7263"><span class="linenum">7263</span></a>      <span class="comment">/**</span>
<a name="l7264"><span class="linenum">7264</span></a>  <span class="comment">     * Returns human readable context identifier.</span>
<a name="l7265"><span class="linenum">7265</span></a>  <span class="comment">     *</span>
<a name="l7266"><span class="linenum">7266</span></a>  <span class="comment">     * @param boolean $withprefix whether to prefix the name of the context with Block</span>
<a name="l7267"><span class="linenum">7267</span></a>  <span class="comment">     * @param boolean $short does not apply to block context</span>
<a name="l7268"><span class="linenum">7268</span></a>  <span class="comment">     * @return string the human readable context name.</span>
<a name="l7269"><span class="linenum">7269</span></a>  <span class="comment">     */</span>
<a name="l7270"><span class="linenum">7270</span></a>      public function <a class="function" onClick="logFunction('get_context_name')" href="../_functions/get_context_name.html" onMouseOver="funcPopup(event,'get_context_name')">get_context_name</a>(<a class="var it25263" onMouseOver="hilite(25263)" onMouseOut="lolite()" onClick="logVariable('withprefix')" href="../_variables/withprefix.html">$withprefix</a> = true, <a class="var it1725" onMouseOver="hilite(1725)" onMouseOut="lolite()" onClick="logVariable('short')" href="../_variables/short.html">$short</a> = false) {
<a name="l7271"><span class="linenum">7271</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l7272"><span class="linenum">7272</span></a>  
<a name="l7273"><span class="linenum">7273</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = '';
<a name="l7274"><span class="linenum">7274</span></a>          if (<a class="var it26683" onMouseOver="hilite(26683)" onMouseOut="lolite()" onClick="logVariable('blockinstance')" href="../_variables/blockinstance.html">$blockinstance</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('block_instances', array('id'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_instanceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_instanceid.html">_instanceid</a>))) {
<a name="l7275"><span class="linenum">7275</span></a>              global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l7276"><span class="linenum">7276</span></a>              require_once(&quot;<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>/blocks/moodleblock.class.php&quot;);
<a name="l7277"><span class="linenum">7277</span></a>              require_once(&quot;<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>/blocks/<a class="var it26683" onMouseOver="hilite(26683)" onMouseOut="lolite()" onClick="logVariable('blockinstance')" href="../_variables/blockinstance.html">$blockinstance</a>-&gt;<a onClick="logVariable('blockname')" class="var it40989" onMouseOver="hilite(40989)" onMouseOut="lolite()" href="../_variables/blockname.html">blockname</a>/block_<a class="var it26683" onMouseOver="hilite(26683)" onMouseOut="lolite()" onClick="logVariable('blockinstance')" href="../_variables/blockinstance.html">$blockinstance</a>-&gt;<a onClick="logVariable('blockname')" class="var it40989" onMouseOver="hilite(40989)" onMouseOut="lolite()" href="../_variables/blockname.html">blockname</a>.php&quot;);
<a name="l7278"><span class="linenum">7278</span></a>              <a class="var it3915" onMouseOver="hilite(3915)" onMouseOut="lolite()" onClick="logVariable('blockname')" href="../_variables/blockname.html">$blockname</a> = &quot;block_<a class="var it26683" onMouseOver="hilite(26683)" onMouseOut="lolite()" onClick="logVariable('blockinstance')" href="../_variables/blockinstance.html">$blockinstance</a>-&gt;<a onClick="logVariable('blockname')" class="var it40989" onMouseOver="hilite(40989)" onMouseOut="lolite()" href="../_variables/blockname.html">blockname</a>&quot;;
<a name="l7279"><span class="linenum">7279</span></a>              if (<a class="var it26692" onMouseOver="hilite(26692)" onMouseOut="lolite()" onClick="logVariable('blockobject')" href="../_variables/blockobject.html">$blockobject</a> = new <a class="var it3915" onMouseOver="hilite(3915)" onMouseOut="lolite()" onClick="logVariable('blockname')" href="../_variables/blockname.html">$blockname</a>()) {
<a name="l7280"><span class="linenum">7280</span></a>                  if (<a class="var it25263" onMouseOver="hilite(25263)" onMouseOut="lolite()" onClick="logVariable('withprefix')" href="../_variables/withprefix.html">$withprefix</a>){
<a name="l7281"><span class="linenum">7281</span></a>                      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> = <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('block').': ';
<a name="l7282"><span class="linenum">7282</span></a>                  }
<a name="l7283"><span class="linenum">7283</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> .= <a class="var it26692" onMouseOver="hilite(26692)" onMouseOut="lolite()" onClick="logVariable('blockobject')" href="../_variables/blockobject.html">$blockobject</a>-&gt;<a onClick="logVariable('title')" class="var it40990" onMouseOver="hilite(40990)" onMouseOut="lolite()" href="../_variables/title.html">title</a>;
<a name="l7284"><span class="linenum">7284</span></a>              }
<a name="l7285"><span class="linenum">7285</span></a>          }
<a name="l7286"><span class="linenum">7286</span></a>  
<a name="l7287"><span class="linenum">7287</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>;
<a name="l7288"><span class="linenum">7288</span></a>      }
<a name="l7289"><span class="linenum">7289</span></a>  
<a name="l7290"><span class="linenum">7290</span></a>      <span class="comment">/**</span>
<a name="l7291"><span class="linenum">7291</span></a>  <span class="comment">     * Returns the most relevant URL for this context.</span>
<a name="l7292"><span class="linenum">7292</span></a>  <span class="comment">     *</span>
<a name="l7293"><span class="linenum">7293</span></a>  <span class="comment">     * @return moodle_url</span>
<a name="l7294"><span class="linenum">7294</span></a>  <span class="comment">     */</span>
<a name="l7295"><span class="linenum">7295</span></a>      public function <a class="function" onClick="logFunction('get_url')" href="../_functions/get_url.html" onMouseOver="funcPopup(event,'get_url')">get_url</a>() {
<a name="l7296"><span class="linenum">7296</span></a>          <a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_parent_context')" href="../_functions/get_parent_context.html" onMouseOver="funcPopup(event,'get_parent_context')">get_parent_context</a>();
<a name="l7297"><span class="linenum">7297</span></a>          return <a class="var it28876" onMouseOver="hilite(28876)" onMouseOut="lolite()" onClick="logVariable('parentcontexts')" href="../_variables/parentcontexts.html">$parentcontexts</a>-&gt;<a class="function" onClick="logFunction('get_url')" href="../_functions/get_url.html" onMouseOver="funcPopup(event,'get_url')">get_url</a>();
<a name="l7298"><span class="linenum">7298</span></a>      }
<a name="l7299"><span class="linenum">7299</span></a>  
<a name="l7300"><span class="linenum">7300</span></a>      <span class="comment">/**</span>
<a name="l7301"><span class="linenum">7301</span></a>  <span class="comment">     * Returns array of relevant context capability records.</span>
<a name="l7302"><span class="linenum">7302</span></a>  <span class="comment">     *</span>
<a name="l7303"><span class="linenum">7303</span></a>  <span class="comment">     * @return array</span>
<a name="l7304"><span class="linenum">7304</span></a>  <span class="comment">     */</span>
<a name="l7305"><span class="linenum">7305</span></a>      public function <a class="function" onClick="logFunction('get_capabilities')" href="../_functions/get_capabilities.html" onMouseOver="funcPopup(event,'get_capabilities')">get_capabilities</a>() {
<a name="l7306"><span class="linenum">7306</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l7307"><span class="linenum">7307</span></a>  
<a name="l7308"><span class="linenum">7308</span></a>          <a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a> = 'ORDER BY contextlevel,component,name';   <span class="comment">// To group them sensibly for display</span>
<a name="l7309"><span class="linenum">7309</span></a>  
<a name="l7310"><span class="linenum">7310</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array();
<a name="l7311"><span class="linenum">7311</span></a>          <a class="var it26668" onMouseOver="hilite(26668)" onMouseOut="lolite()" onClick="logVariable('bi')" href="../_variables/bi.html">$bi</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('block_instances', array('id' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_instanceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/_instanceid.html">_instanceid</a>));
<a name="l7312"><span class="linenum">7312</span></a>  
<a name="l7313"><span class="linenum">7313</span></a>          <a class="var it2018" onMouseOver="hilite(2018)" onMouseOut="lolite()" onClick="logVariable('extra')" href="../_variables/extra.html">$extra</a> = '';
<a name="l7314"><span class="linenum">7314</span></a>          <a class="var it28908" onMouseOver="hilite(28908)" onMouseOut="lolite()" onClick="logVariable('extracaps')" href="../_variables/extracaps.html">$extracaps</a> = <a class="function" onClick="logFunction('block_method_result')" href="../_functions/block_method_result.html" onMouseOver="funcPopup(event,'block_method_result')">block_method_result</a>(<a class="var it26668" onMouseOver="hilite(26668)" onMouseOut="lolite()" onClick="logVariable('bi')" href="../_variables/bi.html">$bi</a>-&gt;<a onClick="logVariable('blockname')" class="var it40991" onMouseOver="hilite(40991)" onMouseOut="lolite()" href="../_variables/blockname.html">blockname</a>, 'get_extra_capabilities');
<a name="l7315"><span class="linenum">7315</span></a>          if (<a class="var it28908" onMouseOver="hilite(28908)" onMouseOut="lolite()" onClick="logVariable('extracaps')" href="../_variables/extracaps.html">$extracaps</a>) {
<a name="l7316"><span class="linenum">7316</span></a>              <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it2018" onMouseOver="hilite(2018)" onMouseOut="lolite()" onClick="logVariable('extra')" href="../_variables/extra.html">$extra</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it28908" onMouseOver="hilite(28908)" onMouseOut="lolite()" onClick="logVariable('extracaps')" href="../_variables/extracaps.html">$extracaps</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'cap');
<a name="l7317"><span class="linenum">7317</span></a>              <a class="var it2018" onMouseOver="hilite(2018)" onMouseOut="lolite()" onClick="logVariable('extra')" href="../_variables/extra.html">$extra</a> = &quot;OR name <a class="var it2018" onMouseOver="hilite(2018)" onMouseOut="lolite()" onClick="logVariable('extra')" href="../_variables/extra.html">$extra</a>&quot;;
<a name="l7318"><span class="linenum">7318</span></a>          }
<a name="l7319"><span class="linenum">7319</span></a>  
<a name="l7320"><span class="linenum">7320</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT *
<a name="l7321"><span class="linenum">7321</span></a>                    FROM {capabilities}
<a name="l7322"><span class="linenum">7322</span></a>                   <a class="function" onClick="logFunction('WHERE')" href="../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a> (contextlevel = &quot;.<a class="constant" onClick="logConstant('CONTEXT_BLOCK')" href="../_constants/CONTEXT_BLOCK.html" onMouseOver="constPopup(event,'CONTEXT_BLOCK')">CONTEXT_BLOCK</a>.&quot;
<a name="l7323"><span class="linenum">7323</span></a>                         AND component = :component)
<a name="l7324"><span class="linenum">7324</span></a>                         <a class="var it2018" onMouseOver="hilite(2018)" onMouseOut="lolite()" onClick="logVariable('extra')" href="../_variables/extra.html">$extra</a>&quot;;
<a name="l7325"><span class="linenum">7325</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['component'] = 'block_' . <a class="var it26668" onMouseOver="hilite(26668)" onMouseOut="lolite()" onClick="logVariable('bi')" href="../_variables/bi.html">$bi</a>-&gt;<a onClick="logVariable('blockname')" class="var it40991" onMouseOver="hilite(40991)" onMouseOut="lolite()" href="../_variables/blockname.html">blockname</a>;
<a name="l7326"><span class="linenum">7326</span></a>  
<a name="l7327"><span class="linenum">7327</span></a>          return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>.' '.<a class="var it124" onMouseOver="hilite(124)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../_variables/sort.html">$sort</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l7328"><span class="linenum">7328</span></a>      }
<a name="l7329"><span class="linenum">7329</span></a>  
<a name="l7330"><span class="linenum">7330</span></a>      <span class="comment">/**</span>
<a name="l7331"><span class="linenum">7331</span></a>  <span class="comment">     * Is this context part of any course? If yes return course context.</span>
<a name="l7332"><span class="linenum">7332</span></a>  <span class="comment">     *</span>
<a name="l7333"><span class="linenum">7333</span></a>  <span class="comment">     * @param bool $strict true means throw exception if not found, false means return false if not found</span>
<a name="l7334"><span class="linenum">7334</span></a>  <span class="comment">     * @return context_course context of the enclosing course, null if not found or exception</span>
<a name="l7335"><span class="linenum">7335</span></a>  <span class="comment">     */</span>
<a name="l7336"><span class="linenum">7336</span></a>      public function <a class="function" onClick="logFunction('get_course_context')" href="../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>(<a class="var it13192" onMouseOver="hilite(13192)" onMouseOut="lolite()" onClick="logVariable('strict')" href="../_variables/strict.html">$strict</a> = true) {
<a name="l7337"><span class="linenum">7337</span></a>          <a class="var it4943" onMouseOver="hilite(4943)" onMouseOut="lolite()" onClick="logVariable('parentcontext')" href="../_variables/parentcontext.html">$parentcontext</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_parent_context')" href="../_functions/get_parent_context.html" onMouseOver="funcPopup(event,'get_parent_context')">get_parent_context</a>();
<a name="l7338"><span class="linenum">7338</span></a>          return <a class="var it4943" onMouseOver="hilite(4943)" onMouseOut="lolite()" onClick="logVariable('parentcontext')" href="../_variables/parentcontext.html">$parentcontext</a>-&gt;<a class="function" onClick="logFunction('get_course_context')" href="../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>(<a class="var it13192" onMouseOver="hilite(13192)" onMouseOut="lolite()" onClick="logVariable('strict')" href="../_variables/strict.html">$strict</a>);
<a name="l7339"><span class="linenum">7339</span></a>      }
<a name="l7340"><span class="linenum">7340</span></a>  
<a name="l7341"><span class="linenum">7341</span></a>      <span class="comment">/**</span>
<a name="l7342"><span class="linenum">7342</span></a>  <span class="comment">     * Returns block context instance.</span>
<a name="l7343"><span class="linenum">7343</span></a>  <span class="comment">     *</span>
<a name="l7344"><span class="linenum">7344</span></a>  <span class="comment">     * @static</span>
<a name="l7345"><span class="linenum">7345</span></a>  <span class="comment">     * @param int $instanceid</span>
<a name="l7346"><span class="linenum">7346</span></a>  <span class="comment">     * @param int $strictness</span>
<a name="l7347"><span class="linenum">7347</span></a>  <span class="comment">     * @return context_block context instance</span>
<a name="l7348"><span class="linenum">7348</span></a>  <span class="comment">     */</span>
<a name="l7349"><span class="linenum">7349</span></a>      public static function <a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>, <a class="var it4662" onMouseOver="hilite(4662)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a> = <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>) {
<a name="l7350"><span class="linenum">7350</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l7351"><span class="linenum">7351</span></a>  
<a name="l7352"><span class="linenum">7352</span></a>          if (<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = context::<a class="function" onClick="logFunction('cache_get')" href="../_functions/cache_get.html" onMouseOver="funcPopup(event,'cache_get')">cache_get</a>(<a class="constant" onClick="logConstant('CONTEXT_BLOCK')" href="../_constants/CONTEXT_BLOCK.html" onMouseOver="constPopup(event,'CONTEXT_BLOCK')">CONTEXT_BLOCK</a>, <a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>)) {
<a name="l7353"><span class="linenum">7353</span></a>              return <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>;
<a name="l7354"><span class="linenum">7354</span></a>          }
<a name="l7355"><span class="linenum">7355</span></a>  
<a name="l7356"><span class="linenum">7356</span></a>          if (!<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('context', array('contextlevel'=&gt;<a class="constant" onClick="logConstant('CONTEXT_BLOCK')" href="../_constants/CONTEXT_BLOCK.html" onMouseOver="constPopup(event,'CONTEXT_BLOCK')">CONTEXT_BLOCK</a>, 'instanceid'=&gt;<a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>))) {
<a name="l7357"><span class="linenum">7357</span></a>              if (<a class="var it26668" onMouseOver="hilite(26668)" onMouseOut="lolite()" onClick="logVariable('bi')" href="../_variables/bi.html">$bi</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('block_instances', array('id'=&gt;<a class="var it1622" onMouseOver="hilite(1622)" onMouseOut="lolite()" onClick="logVariable('instanceid')" href="../_variables/instanceid.html">$instanceid</a>), 'id,parentcontextid', <a class="var it4662" onMouseOver="hilite(4662)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a>)) {
<a name="l7358"><span class="linenum">7358</span></a>                  <a class="var it4943" onMouseOver="hilite(4943)" onMouseOut="lolite()" onClick="logVariable('parentcontext')" href="../_variables/parentcontext.html">$parentcontext</a> = context::<a class="function" onClick="logFunction('instance_by_id')" href="../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>(<a class="var it26668" onMouseOver="hilite(26668)" onMouseOut="lolite()" onClick="logVariable('bi')" href="../_variables/bi.html">$bi</a>-&gt;<a onClick="logVariable('parentcontextid')" class="var it40991" onMouseOver="hilite(40991)" onMouseOut="lolite()" href="../_variables/parentcontextid.html">parentcontextid</a>);
<a name="l7359"><span class="linenum">7359</span></a>                  <a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a> = context::<a class="function" onClick="logFunction('insert_context_record')" href="../_functions/insert_context_record.html" onMouseOver="funcPopup(event,'insert_context_record')">insert_context_record</a>(<a class="constant" onClick="logConstant('CONTEXT_BLOCK')" href="../_constants/CONTEXT_BLOCK.html" onMouseOver="constPopup(event,'CONTEXT_BLOCK')">CONTEXT_BLOCK</a>, <a class="var it26668" onMouseOver="hilite(26668)" onMouseOut="lolite()" onClick="logVariable('bi')" href="../_variables/bi.html">$bi</a>-&gt;<a onClick="logVariable('id')" class="var it40991" onMouseOver="hilite(40991)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it4943" onMouseOver="hilite(4943)" onMouseOut="lolite()" onClick="logVariable('parentcontext')" href="../_variables/parentcontext.html">$parentcontext</a>-&gt;<a onClick="logVariable('path')" class="var it39842" onMouseOver="hilite(39842)" onMouseOut="lolite()" href="../_variables/path.html">path</a>);
<a name="l7360"><span class="linenum">7360</span></a>              }
<a name="l7361"><span class="linenum">7361</span></a>          }
<a name="l7362"><span class="linenum">7362</span></a>  
<a name="l7363"><span class="linenum">7363</span></a>          if (<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>) {
<a name="l7364"><span class="linenum">7364</span></a>              <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <span class="keyword">new </span><a class="class" onClick="logClass('context_block')" href="../_classes/context_block.html" onMouseOver="classPopup(event,'context_block')">context_block</a>(<a class="var it534" onMouseOver="hilite(534)" onMouseOut="lolite()" onClick="logVariable('record')" href="../_variables/record.html">$record</a>);
<a name="l7365"><span class="linenum">7365</span></a>              context::<a class="function" onClick="logFunction('cache_add')" href="../_functions/cache_add.html" onMouseOver="funcPopup(event,'cache_add')">cache_add</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l7366"><span class="linenum">7366</span></a>              return <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>;
<a name="l7367"><span class="linenum">7367</span></a>          }
<a name="l7368"><span class="linenum">7368</span></a>  
<a name="l7369"><span class="linenum">7369</span></a>          return false;
<a name="l7370"><span class="linenum">7370</span></a>      }
<a name="l7371"><span class="linenum">7371</span></a>  
<a name="l7372"><span class="linenum">7372</span></a>      <span class="comment">/**</span>
<a name="l7373"><span class="linenum">7373</span></a>  <span class="comment">     * Block do not have child contexts...</span>
<a name="l7374"><span class="linenum">7374</span></a>  <span class="comment">     * @return array</span>
<a name="l7375"><span class="linenum">7375</span></a>  <span class="comment">     */</span>
<a name="l7376"><span class="linenum">7376</span></a>      public function <a class="function" onClick="logFunction('get_child_contexts')" href="../_functions/get_child_contexts.html" onMouseOver="funcPopup(event,'get_child_contexts')">get_child_contexts</a>() {
<a name="l7377"><span class="linenum">7377</span></a>          return array();
<a name="l7378"><span class="linenum">7378</span></a>      }
<a name="l7379"><span class="linenum">7379</span></a>  
<a name="l7380"><span class="linenum">7380</span></a>      <span class="comment">/**</span>
<a name="l7381"><span class="linenum">7381</span></a>  <span class="comment">     * Create missing context instances at block context level</span>
<a name="l7382"><span class="linenum">7382</span></a>  <span class="comment">     * @static</span>
<a name="l7383"><span class="linenum">7383</span></a>  <span class="comment">     */</span>
<a name="l7384"><span class="linenum">7384</span></a>      protected static function <a class="function" onClick="logFunction('create_level_instances')" href="../_functions/create_level_instances.html" onMouseOver="funcPopup(event,'create_level_instances')">create_level_instances</a>() {
<a name="l7385"><span class="linenum">7385</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l7386"><span class="linenum">7386</span></a>  
<a name="l7387"><span class="linenum">7387</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT &quot;.<a class="constant" onClick="logConstant('CONTEXT_BLOCK')" href="../_constants/CONTEXT_BLOCK.html" onMouseOver="constPopup(event,'CONTEXT_BLOCK')">CONTEXT_BLOCK</a>.&quot;, bi.id
<a name="l7388"><span class="linenum">7388</span></a>                    FROM {block_instances} bi
<a name="l7389"><span class="linenum">7389</span></a>                   WHERE NOT <a class="function" onClick="logFunction('EXISTS')" href="../_functions/exists.html" onMouseOver="funcPopup(event,'exists')">EXISTS</a> (SELECT 'x'
<a name="l7390"><span class="linenum">7390</span></a>                                       FROM {context} cx
<a name="l7391"><span class="linenum">7391</span></a>                                      WHERE bi.id = cx.instanceid AND cx.contextlevel=&quot;.<a class="constant" onClick="logConstant('CONTEXT_BLOCK')" href="../_constants/CONTEXT_BLOCK.html" onMouseOver="constPopup(event,'CONTEXT_BLOCK')">CONTEXT_BLOCK</a>.&quot;)&quot;;
<a name="l7392"><span class="linenum">7392</span></a>          <a class="var it28909" onMouseOver="hilite(28909)" onMouseOut="lolite()" onClick="logVariable('contextdata')" href="../_variables/contextdata.html">$contextdata</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>);
<a name="l7393"><span class="linenum">7393</span></a>          foreach (<a class="var it28909" onMouseOver="hilite(28909)" onMouseOut="lolite()" onClick="logVariable('contextdata')" href="../_variables/contextdata.html">$contextdata</a> as <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>) {
<a name="l7394"><span class="linenum">7394</span></a>              context::<a class="function" onClick="logFunction('insert_context_record')" href="../_functions/insert_context_record.html" onMouseOver="funcPopup(event,'insert_context_record')">insert_context_record</a>(<a class="constant" onClick="logConstant('CONTEXT_BLOCK')" href="../_constants/CONTEXT_BLOCK.html" onMouseOver="constPopup(event,'CONTEXT_BLOCK')">CONTEXT_BLOCK</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, null);
<a name="l7395"><span class="linenum">7395</span></a>          }
<a name="l7396"><span class="linenum">7396</span></a>          <a class="var it28909" onMouseOver="hilite(28909)" onMouseOut="lolite()" onClick="logVariable('contextdata')" href="../_variables/contextdata.html">$contextdata</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l7397"><span class="linenum">7397</span></a>      }
<a name="l7398"><span class="linenum">7398</span></a>  
<a name="l7399"><span class="linenum">7399</span></a>      <span class="comment">/**</span>
<a name="l7400"><span class="linenum">7400</span></a>  <span class="comment">     * Returns sql necessary for purging of stale context instances.</span>
<a name="l7401"><span class="linenum">7401</span></a>  <span class="comment">     *</span>
<a name="l7402"><span class="linenum">7402</span></a>  <span class="comment">     * @static</span>
<a name="l7403"><span class="linenum">7403</span></a>  <span class="comment">     * @return string cleanup SQL</span>
<a name="l7404"><span class="linenum">7404</span></a>  <span class="comment">     */</span>
<a name="l7405"><span class="linenum">7405</span></a>      protected static function <a class="function" onClick="logFunction('get_cleanup_sql')" href="../_functions/get_cleanup_sql.html" onMouseOver="funcPopup(event,'get_cleanup_sql')">get_cleanup_sql</a>() {
<a name="l7406"><span class="linenum">7406</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;
<a name="l7407"><span class="linenum">7407</span></a>                    SELECT c.*
<a name="l7408"><span class="linenum">7408</span></a>                      FROM {context} c
<a name="l7409"><span class="linenum">7409</span></a>           LEFT OUTER JOIN {block_instances} bi ON c.instanceid = bi.id
<a name="l7410"><span class="linenum">7410</span></a>                     WHERE bi.id IS NULL AND c.contextlevel = &quot;.<a class="constant" onClick="logConstant('CONTEXT_BLOCK')" href="../_constants/CONTEXT_BLOCK.html" onMouseOver="constPopup(event,'CONTEXT_BLOCK')">CONTEXT_BLOCK</a>.&quot;
<a name="l7411"><span class="linenum">7411</span></a>                 &quot;;
<a name="l7412"><span class="linenum">7412</span></a>  
<a name="l7413"><span class="linenum">7413</span></a>          return <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>;
<a name="l7414"><span class="linenum">7414</span></a>      }
<a name="l7415"><span class="linenum">7415</span></a>  
<a name="l7416"><span class="linenum">7416</span></a>      <span class="comment">/**</span>
<a name="l7417"><span class="linenum">7417</span></a>  <span class="comment">     * Rebuild context paths and depths at block context level.</span>
<a name="l7418"><span class="linenum">7418</span></a>  <span class="comment">     *</span>
<a name="l7419"><span class="linenum">7419</span></a>  <span class="comment">     * @static</span>
<a name="l7420"><span class="linenum">7420</span></a>  <span class="comment">     * @param bool $force</span>
<a name="l7421"><span class="linenum">7421</span></a>  <span class="comment">     */</span>
<a name="l7422"><span class="linenum">7422</span></a>      protected static function <a class="function" onClick="logFunction('build_paths')" href="../_functions/build_paths.html" onMouseOver="funcPopup(event,'build_paths')">build_paths</a>(<a class="var it5797" onMouseOver="hilite(5797)" onMouseOut="lolite()" onClick="logVariable('force')" href="../_variables/force.html">$force</a>) {
<a name="l7423"><span class="linenum">7423</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l7424"><span class="linenum">7424</span></a>  
<a name="l7425"><span class="linenum">7425</span></a>          if (<a class="var it5797" onMouseOver="hilite(5797)" onMouseOut="lolite()" onClick="logVariable('force')" href="../_variables/force.html">$force</a> or <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists_select')" href="../_functions/record_exists_select.html" onMouseOver="funcPopup(event,'record_exists_select')">record_exists_select</a>('context', &quot;contextlevel = &quot;.<a class="constant" onClick="logConstant('CONTEXT_BLOCK')" href="../_constants/CONTEXT_BLOCK.html" onMouseOver="constPopup(event,'CONTEXT_BLOCK')">CONTEXT_BLOCK</a>.&quot; AND (depth = 0 OR path IS NULL)&quot;)) {
<a name="l7426"><span class="linenum">7426</span></a>              if (<a class="var it5797" onMouseOver="hilite(5797)" onMouseOut="lolite()" onClick="logVariable('force')" href="../_variables/force.html">$force</a>) {
<a name="l7427"><span class="linenum">7427</span></a>                  <a class="var it28911" onMouseOver="hilite(28911)" onMouseOut="lolite()" onClick="logVariable('ctxemptyclause')" href="../_variables/ctxemptyclause.html">$ctxemptyclause</a> = '';
<a name="l7428"><span class="linenum">7428</span></a>              } else {
<a name="l7429"><span class="linenum">7429</span></a>                  <a class="var it28911" onMouseOver="hilite(28911)" onMouseOut="lolite()" onClick="logVariable('ctxemptyclause')" href="../_variables/ctxemptyclause.html">$ctxemptyclause</a> = &quot;AND (ctx.path IS NULL OR ctx.depth = 0)&quot;;
<a name="l7430"><span class="linenum">7430</span></a>              }
<a name="l7431"><span class="linenum">7431</span></a>  
<a name="l7432"><span class="linenum">7432</span></a>  <span class="comment">            // pctx.path IS NOT NULL prevents fatal problems with broken block instances that point to invalid context parent</span>
<a name="l7433"><span class="linenum">7433</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;INSERT INTO {context_temp} (id, path, depth)
<a name="l7434"><span class="linenum">7434</span></a>                      SELECT ctx.id, &quot;.<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_concat')" href="../_functions/sql_concat.html" onMouseOver="funcPopup(event,'sql_concat')">sql_concat</a>('pctx.path', &quot;'/'&quot;, 'ctx.id').&quot;, pctx.depth+1
<a name="l7435"><span class="linenum">7435</span></a>                        FROM {context} ctx
<a name="l7436"><span class="linenum">7436</span></a>                        JOIN {block_instances} bi <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (bi.id = ctx.instanceid AND ctx.contextlevel = &quot;.<a class="constant" onClick="logConstant('CONTEXT_BLOCK')" href="../_constants/CONTEXT_BLOCK.html" onMouseOver="constPopup(event,'CONTEXT_BLOCK')">CONTEXT_BLOCK</a>.&quot;)
<a name="l7437"><span class="linenum">7437</span></a>                        JOIN {context} pctx <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (pctx.id = bi.parentcontextid)
<a name="l7438"><span class="linenum">7438</span></a>                       <a class="function" onClick="logFunction('WHERE')" href="../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a> (pctx.path IS NOT NULL AND pctx.depth &gt; 0)
<a name="l7439"><span class="linenum">7439</span></a>                             <a class="var it28911" onMouseOver="hilite(28911)" onMouseOut="lolite()" onClick="logVariable('ctxemptyclause')" href="../_variables/ctxemptyclause.html">$ctxemptyclause</a>&quot;;
<a name="l7440"><span class="linenum">7440</span></a>              <a class="var it24866" onMouseOver="hilite(24866)" onMouseOut="lolite()" onClick="logVariable('trans')" href="../_variables/trans.html">$trans</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l7441"><span class="linenum">7441</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('context_temp');
<a name="l7442"><span class="linenum">7442</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>);
<a name="l7443"><span class="linenum">7443</span></a>              context::<a class="function" onClick="logFunction('merge_context_temp_table')" href="../_functions/merge_context_temp_table.html" onMouseOver="funcPopup(event,'merge_context_temp_table')">merge_context_temp_table</a>();
<a name="l7444"><span class="linenum">7444</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('context_temp');
<a name="l7445"><span class="linenum">7445</span></a>              <a class="var it24866" onMouseOver="hilite(24866)" onMouseOut="lolite()" onClick="logVariable('trans')" href="../_variables/trans.html">$trans</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l7446"><span class="linenum">7446</span></a>          }
<a name="l7447"><span class="linenum">7447</span></a>      }
<a name="l7448"><span class="linenum">7448</span></a>  }
<a name="l7449"><span class="linenum">7449</span></a>  
<a name="l7450"><span class="linenum">7450</span></a>  
<a name="l7451"><span class="linenum">7451</span></a>  <span class="comment">// ============== DEPRECATED FUNCTIONS ==========================================</span>
<a name="l7452"><span class="linenum">7452</span></a>  <span class="comment">// Old context related functions were deprecated in 2.0, it is recommended</span>
<a name="l7453"><span class="linenum">7453</span></a>  <span class="comment">// to use context classes in new code. Old function can be used when</span>
<a name="l7454"><span class="linenum">7454</span></a>  <span class="comment">// creating patches that are supposed to be backported to older stable branches.</span>
<a name="l7455"><span class="linenum">7455</span></a>  <span class="comment">// These deprecated functions will not be removed in near future,</span>
<a name="l7456"><span class="linenum">7456</span></a>  <span class="comment">// before removing devs will be warned with a debugging message first,</span>
<a name="l7457"><span class="linenum">7457</span></a>  <span class="comment">// then we will add error message and only after that we can remove the functions</span>
<a name="l7458"><span class="linenum">7458</span></a>  <span class="comment">// completely.</span>
<a name="l7459"><span class="linenum">7459</span></a>  
<a name="l7460"><span class="linenum">7460</span></a>  <span class="comment">/**</span>
<a name="l7461"><span class="linenum">7461</span></a>  <span class="comment"> * Runs get_records select on context table and returns the result</span>
<a name="l7462"><span class="linenum">7462</span></a>  <span class="comment"> * Does get_records_select on the context table, and returns the results ordered</span>
<a name="l7463"><span class="linenum">7463</span></a>  <span class="comment"> * by contextlevel, and then the natural sort order within each level.</span>
<a name="l7464"><span class="linenum">7464</span></a>  <span class="comment"> * for the purpose of $select, you need to know that the context table has been</span>
<a name="l7465"><span class="linenum">7465</span></a>  <span class="comment"> * aliased to ctx, so for example, you can call get_sorted_contexts('ctx.depth = 3');</span>
<a name="l7466"><span class="linenum">7466</span></a>  <span class="comment"> *</span>
<a name="l7467"><span class="linenum">7467</span></a>  <span class="comment"> * @param string $select the contents of the WHERE clause. Remember to do ctx.fieldname.</span>
<a name="l7468"><span class="linenum">7468</span></a>  <span class="comment"> * @param array $params any parameters required by $select.</span>
<a name="l7469"><span class="linenum">7469</span></a>  <span class="comment"> * @return array the requested context records.</span>
<a name="l7470"><span class="linenum">7470</span></a>  <span class="comment"> */</span>
<a name="l7471"><span class="linenum">7471</span></a>  function <a class="function" onClick="logFunction('get_sorted_contexts')" href="../_functions/get_sorted_contexts.html" onMouseOver="funcPopup(event,'get_sorted_contexts')">get_sorted_contexts</a>(<a class="var it2282" onMouseOver="hilite(2282)" onMouseOut="lolite()" onClick="logVariable('select')" href="../_variables/select.html">$select</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array()) {
<a name="l7472"><span class="linenum">7472</span></a>  
<a name="l7473"><span class="linenum">7473</span></a>  <span class="comment">    //TODO: we should probably rewrite all the code that is using this thing, the trouble is we MUST NOT modify the context instances...</span>
<a name="l7474"><span class="linenum">7474</span></a>  
<a name="l7475"><span class="linenum">7475</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l7476"><span class="linenum">7476</span></a>      if (<a class="var it2282" onMouseOver="hilite(2282)" onMouseOut="lolite()" onClick="logVariable('select')" href="../_variables/select.html">$select</a>) {
<a name="l7477"><span class="linenum">7477</span></a>          <a class="var it2282" onMouseOver="hilite(2282)" onMouseOut="lolite()" onClick="logVariable('select')" href="../_variables/select.html">$select</a> = 'WHERE ' . <a class="var it2282" onMouseOver="hilite(2282)" onMouseOut="lolite()" onClick="logVariable('select')" href="../_variables/select.html">$select</a>;
<a name="l7478"><span class="linenum">7478</span></a>      }
<a name="l7479"><span class="linenum">7479</span></a>      return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;
<a name="l7480"><span class="linenum">7480</span></a>              SELECT ctx.*
<a name="l7481"><span class="linenum">7481</span></a>                FROM {context} ctx
<a name="l7482"><span class="linenum">7482</span></a>                LEFT JOIN {user} u ON ctx.contextlevel = &quot; . <a class="constant" onClick="logConstant('CONTEXT_USER')" href="../_constants/CONTEXT_USER.html" onMouseOver="constPopup(event,'CONTEXT_USER')">CONTEXT_USER</a> . &quot; AND u.id = ctx.instanceid
<a name="l7483"><span class="linenum">7483</span></a>                LEFT JOIN {course_categories} cat ON ctx.contextlevel = &quot; . <a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a> . &quot; AND cat.id = ctx.instanceid
<a name="l7484"><span class="linenum">7484</span></a>                LEFT JOIN {course} c ON ctx.contextlevel = &quot; . <a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a> . &quot; AND c.id = ctx.instanceid
<a name="l7485"><span class="linenum">7485</span></a>                LEFT JOIN {course_modules} cm ON ctx.contextlevel = &quot; . <a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a> . &quot; AND cm.id = ctx.instanceid
<a name="l7486"><span class="linenum">7486</span></a>                LEFT JOIN {block_instances} bi ON ctx.contextlevel = &quot; . <a class="constant" onClick="logConstant('CONTEXT_BLOCK')" href="../_constants/CONTEXT_BLOCK.html" onMouseOver="constPopup(event,'CONTEXT_BLOCK')">CONTEXT_BLOCK</a> . &quot; AND bi.id = ctx.instanceid
<a name="l7487"><span class="linenum">7487</span></a>             <a class="var it2282" onMouseOver="hilite(2282)" onMouseOut="lolite()" onClick="logVariable('select')" href="../_variables/select.html">$select</a>
<a name="l7488"><span class="linenum">7488</span></a>            ORDER BY ctx.contextlevel, bi.defaultregion, COALESCE(cat.sortorder, c.sortorder, cm.section, bi.defaultweight), u.lastname, u.firstname, cm.id
<a name="l7489"><span class="linenum">7489</span></a>              &quot;, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l7490"><span class="linenum">7490</span></a>  }
<a name="l7491"><span class="linenum">7491</span></a>  
<a name="l7492"><span class="linenum">7492</span></a>  <span class="comment">/**</span>
<a name="l7493"><span class="linenum">7493</span></a>  <span class="comment"> * Given context and array of users, returns array of users whose enrolment status is suspended,</span>
<a name="l7494"><span class="linenum">7494</span></a>  <span class="comment"> * or enrolment has expired or has not started. Also removes those users from the given array</span>
<a name="l7495"><span class="linenum">7495</span></a>  <span class="comment"> *</span>
<a name="l7496"><span class="linenum">7496</span></a>  <span class="comment"> * @param context $context context in which suspended users should be extracted.</span>
<a name="l7497"><span class="linenum">7497</span></a>  <span class="comment"> * @param array $users list of users.</span>
<a name="l7498"><span class="linenum">7498</span></a>  <span class="comment"> * @param array $ignoreusers array of user ids to ignore, e.g. guest</span>
<a name="l7499"><span class="linenum">7499</span></a>  <span class="comment"> * @return array list of suspended users.</span>
<a name="l7500"><span class="linenum">7500</span></a>  <span class="comment"> */</span>
<a name="l7501"><span class="linenum">7501</span></a>  function <a class="function" onClick="logFunction('extract_suspended_users')" href="../_functions/extract_suspended_users.html" onMouseOver="funcPopup(event,'extract_suspended_users')">extract_suspended_users</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, &amp;<a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a>, <a class="var it28915" onMouseOver="hilite(28915)" onMouseOut="lolite()" onClick="logVariable('ignoreusers')" href="../_variables/ignoreusers.html">$ignoreusers</a>=array()) {
<a name="l7502"><span class="linenum">7502</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l7503"><span class="linenum">7503</span></a>  
<a name="l7504"><span class="linenum">7504</span></a>  <span class="comment">    // Get active enrolled users.</span>
<a name="l7505"><span class="linenum">7505</span></a>      <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="function" onClick="logFunction('get_enrolled_sql')" href="../_functions/get_enrolled_sql.html" onMouseOver="funcPopup(event,'get_enrolled_sql')">get_enrolled_sql</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, null, null, true);
<a name="l7506"><span class="linenum">7506</span></a>      <a class="var it28916" onMouseOver="hilite(28916)" onMouseOut="lolite()" onClick="logVariable('activeusers')" href="../_variables/activeusers.html">$activeusers</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l7507"><span class="linenum">7507</span></a>  
<a name="l7508"><span class="linenum">7508</span></a>  <span class="comment">    // Move suspended users to a separate array &amp; remove from the initial one.</span>
<a name="l7509"><span class="linenum">7509</span></a>      <a class="var it11303" onMouseOver="hilite(11303)" onMouseOut="lolite()" onClick="logVariable('susers')" href="../_variables/susers.html">$susers</a> = array();
<a name="l7510"><span class="linenum">7510</span></a>      if (sizeof(<a class="var it28916" onMouseOver="hilite(28916)" onMouseOut="lolite()" onClick="logVariable('activeusers')" href="../_variables/activeusers.html">$activeusers</a>)) {
<a name="l7511"><span class="linenum">7511</span></a>          foreach (<a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a> as <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> =&gt; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) {
<a name="l7512"><span class="linenum">7512</span></a>              if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it28916" onMouseOver="hilite(28916)" onMouseOut="lolite()" onClick="logVariable('activeusers')" href="../_variables/activeusers.html">$activeusers</a>) &amp;&amp; !<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it28915" onMouseOver="hilite(28915)" onMouseOut="lolite()" onClick="logVariable('ignoreusers')" href="../_variables/ignoreusers.html">$ignoreusers</a>)) {
<a name="l7513"><span class="linenum">7513</span></a>                  <a class="var it11303" onMouseOver="hilite(11303)" onMouseOut="lolite()" onClick="logVariable('susers')" href="../_variables/susers.html">$susers</a>[<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>;
<a name="l7514"><span class="linenum">7514</span></a>                  unset(<a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a>[<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>]);
<a name="l7515"><span class="linenum">7515</span></a>              }
<a name="l7516"><span class="linenum">7516</span></a>          }
<a name="l7517"><span class="linenum">7517</span></a>      }
<a name="l7518"><span class="linenum">7518</span></a>      return <a class="var it11303" onMouseOver="hilite(11303)" onMouseOut="lolite()" onClick="logVariable('susers')" href="../_variables/susers.html">$susers</a>;
<a name="l7519"><span class="linenum">7519</span></a>  }
<a name="l7520"><span class="linenum">7520</span></a>  
<a name="l7521"><span class="linenum">7521</span></a>  <span class="comment">/**</span>
<a name="l7522"><span class="linenum">7522</span></a>  <span class="comment"> * Given context and array of users, returns array of user ids whose enrolment status is suspended,</span>
<a name="l7523"><span class="linenum">7523</span></a>  <span class="comment"> * or enrolment has expired or not started.</span>
<a name="l7524"><span class="linenum">7524</span></a>  <span class="comment"> *</span>
<a name="l7525"><span class="linenum">7525</span></a>  <span class="comment"> * @param context $context context in which user enrolment is checked.</span>
<a name="l7526"><span class="linenum">7526</span></a>  <span class="comment"> * @param bool $usecache Enable or disable (default) the request cache</span>
<a name="l7527"><span class="linenum">7527</span></a>  <span class="comment"> * @return array list of suspended user id's.</span>
<a name="l7528"><span class="linenum">7528</span></a>  <span class="comment"> */</span>
<a name="l7529"><span class="linenum">7529</span></a>  function <a class="function" onClick="logFunction('get_suspended_userids')" href="../_functions/get_suspended_userids.html" onMouseOver="funcPopup(event,'get_suspended_userids')">get_suspended_userids</a>(context <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it97" onMouseOver="hilite(97)" onMouseOut="lolite()" onClick="logVariable('usecache')" href="../_variables/usecache.html">$usecache</a> = false) {
<a name="l7530"><span class="linenum">7530</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l7531"><span class="linenum">7531</span></a>  
<a name="l7532"><span class="linenum">7532</span></a>      if (<a class="var it97" onMouseOver="hilite(97)" onMouseOut="lolite()" onClick="logVariable('usecache')" href="../_variables/usecache.html">$usecache</a>) {
<a name="l7533"><span class="linenum">7533</span></a>          <a class="var it1081" onMouseOver="hilite(1081)" onMouseOut="lolite()" onClick="logVariable('cache')" href="../_variables/cache.html">$cache</a> = <a class="class" onClick="logClass('cache')" href="../_classes/cache.html" onMouseOver="classPopup(event,'cache')">cache</a>::<a class="function" onClick="logFunction('make')" href="../_functions/make.html" onMouseOver="funcPopup(event,'make')">make</a>('core', 'suspended_userids');
<a name="l7534"><span class="linenum">7534</span></a>          <a class="var it11303" onMouseOver="hilite(11303)" onMouseOut="lolite()" onClick="logVariable('susers')" href="../_variables/susers.html">$susers</a> = <a class="var it1081" onMouseOver="hilite(1081)" onMouseOut="lolite()" onClick="logVariable('cache')" href="../_variables/cache.html">$cache</a>-&gt;<a class="function" onClick="logFunction('get')" href="../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l7535"><span class="linenum">7535</span></a>          if (<a class="var it11303" onMouseOver="hilite(11303)" onMouseOut="lolite()" onClick="logVariable('susers')" href="../_variables/susers.html">$susers</a> !== false) {
<a name="l7536"><span class="linenum">7536</span></a>              return <a class="var it11303" onMouseOver="hilite(11303)" onMouseOut="lolite()" onClick="logVariable('susers')" href="../_variables/susers.html">$susers</a>;
<a name="l7537"><span class="linenum">7537</span></a>          }
<a name="l7538"><span class="linenum">7538</span></a>      }
<a name="l7539"><span class="linenum">7539</span></a>  
<a name="l7540"><span class="linenum">7540</span></a>      <a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_course_context')" href="../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>();
<a name="l7541"><span class="linenum">7541</span></a>      <a class="var it11303" onMouseOver="hilite(11303)" onMouseOut="lolite()" onClick="logVariable('susers')" href="../_variables/susers.html">$susers</a> = array();
<a name="l7542"><span class="linenum">7542</span></a>  
<a name="l7543"><span class="linenum">7543</span></a>  <span class="comment">    // Front page users are always enrolled, so suspended list is empty.</span>
<a name="l7544"><span class="linenum">7544</span></a>      if (<a class="var it1590" onMouseOver="hilite(1590)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('instanceid')" class="var it39493" onMouseOver="hilite(39493)" onMouseOut="lolite()" href="../_variables/instanceid.html">instanceid</a> != <a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>) {
<a name="l7545"><span class="linenum">7545</span></a>          <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="function" onClick="logFunction('get_enrolled_sql')" href="../_functions/get_enrolled_sql.html" onMouseOver="funcPopup(event,'get_enrolled_sql')">get_enrolled_sql</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, null, null, false, true);
<a name="l7546"><span class="linenum">7546</span></a>          <a class="var it11303" onMouseOver="hilite(11303)" onMouseOut="lolite()" onClick="logVariable('susers')" href="../_variables/susers.html">$susers</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_fieldset_sql')" href="../_functions/get_fieldset_sql.html" onMouseOver="funcPopup(event,'get_fieldset_sql')">get_fieldset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l7547"><span class="linenum">7547</span></a>          <a class="var it11303" onMouseOver="hilite(11303)" onMouseOut="lolite()" onClick="logVariable('susers')" href="../_variables/susers.html">$susers</a> = <a class="phpfunction" onClick="logFunction('array_combine')" href="../_functions/array_combine.html" onMouseOver="phpfuncPopup(event,'array_combine')">array_combine</a>(<a class="var it11303" onMouseOver="hilite(11303)" onMouseOut="lolite()" onClick="logVariable('susers')" href="../_variables/susers.html">$susers</a>, <a class="var it11303" onMouseOver="hilite(11303)" onMouseOut="lolite()" onClick="logVariable('susers')" href="../_variables/susers.html">$susers</a>);
<a name="l7548"><span class="linenum">7548</span></a>      }
<a name="l7549"><span class="linenum">7549</span></a>  
<a name="l7550"><span class="linenum">7550</span></a>  <span class="comment">    // Cache results for the remainder of this request.</span>
<a name="l7551"><span class="linenum">7551</span></a>      if (<a class="var it97" onMouseOver="hilite(97)" onMouseOut="lolite()" onClick="logVariable('usecache')" href="../_variables/usecache.html">$usecache</a>) {
<a name="l7552"><span class="linenum">7552</span></a>          <a class="var it1081" onMouseOver="hilite(1081)" onMouseOut="lolite()" onClick="logVariable('cache')" href="../_variables/cache.html">$cache</a>-&gt;<a class="function" onClick="logFunction('set')" href="../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it39491" onMouseOver="hilite(39491)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, <a class="var it11303" onMouseOver="hilite(11303)" onMouseOut="lolite()" onClick="logVariable('susers')" href="../_variables/susers.html">$susers</a>);
<a name="l7553"><span class="linenum">7553</span></a>      }
<a name="l7554"><span class="linenum">7554</span></a>  
<a name="l7555"><span class="linenum">7555</span></a>      return <a class="var it11303" onMouseOver="hilite(11303)" onMouseOut="lolite()" onClick="logVariable('susers')" href="../_variables/susers.html">$susers</a>;
<a name="l7556"><span class="linenum">7556</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'set_config': ['set_config', 'Set a configuration value for this plugin ', [['mod/assign','assignmentplugin.php',314],['lib/portfolio','plugin.php',515],['lib','moodlelib.php',1331],['lib','enrollib.php',1152],['lib/editor/tinymce/classes','plugin.php',84]], 985],
'reset_sequence': ['reset_sequence', 'Reset a sequence to the id field of a table. ', [['lib/ddl','database_manager.php',102]], 12],
'delete_content': ['delete_content', 'Delete all data linked to content, do not delete the context record itself ', [['lib','accesslib.php',5492],['mod/data','lib.php',399]], 9],
'instance_by_id': ['instance_by_id', 'Get a context instance as an object, from a given context id. ', [['lib','accesslib.php',5383]], 174],
'get_all_roles': ['get_all_roles', 'Gets all of the roles this course can contain. ', [['enrol','locallib.php',573],['lib','accesslib.php',3203]], 47],
'get_suspended_userids': ['get_suspended_userids', 'Given context and array of users, returns array of user ids whose enrolment status is suspended, or enrolment has expired or not started. ', [['lib','accesslib.php',7521]], 8],
'sql_substr': ['sql_substr', 'Returns the proper substr() SQL text used to extract substrings from DB NOTE: this was originally returning only function name ', [['lib/dml','sqlsrv_native_moodle_database.php',1311],['lib/dml','moodle_database.php',2094],['lib/dml','mssql_native_moodle_database.php',1245],['lib/dml/tests','dml_test.php',5435]], 21],
'get_default_contextlevels': ['get_default_contextlevels', 'Returns default context levels where roles can be assigned. ', [['lib','accesslib.php',3661]], 10],
'reset_paths': ['reset_paths', 'Remove all context path info and optionally rebuild it. ', [['lib','accesslib.php',5464]], 7],
'role_switch': ['role_switch', 'Switches the current user to another role for the current session and only in the given context. ', [['lib','accesslib.php',4322]], 8],
'delete_all_for_context': ['delete_all_for_context', 'Delete all the instances associated to a context. ', [['repository','lib.php',2033],['grade/grading','lib.php',598]], 4],
'where': ['where', 'Add where clause ', [['lib/zend/Zend/Service/WindowsAzure/Storage','TableEntityQuery.php',120],['question/classes/bank/search','category_condition.php',96],['question/classes/bank/search','hidden_condition.php',53],['question/engine','datalib.php',1882],['question/engine','datalib.php',1964]], 61],
'has_all_capabilities': ['has_all_capabilities', 'Check if the user has all the capabilities in a list. ', [['lib','accesslib.php',523]], 25],
'get_profile_roles': ['get_profile_roles', 'Gets the list of roles assigned to this context and up (parents) from the list of roles that are visible on user profile page and participants page. ', [['lib','accesslib.php',3051]], 3],
'load_capability_def': ['load_capability_def', 'Loads the capability definitions for the component (from file). ', [['lib','accesslib.php',2499]], 3],
'exists': ['exists', 'Checks whether or not the variable exists. ', [['lib/htmlpurifier/HTMLPurifier','Context.php',73],['lib/horde/framework/Horde','Variables.php',101],['admin/tool/health','index.php',139],['admin/tool/health','index.php',160],['admin/tool/health','index.php',184],['admin/tool/health','index.php',208],['admin/tool/health','index.php',229],['admin/tool/health','index.php',248],['admin/tool/health','index.php',267],['admin/tool/health','index.php',313],['admin/tool/health','index.php',334],['admin/tool/health','index.php',420],['admin/tool/health','index.php',444],['admin/tool/health','index.php',481],['admin/tool/health','index.php',506],['admin/tool/health','index.php',554],['admin/tool/health','index.php',617],['admin/tool/health','index.php',707],['admin/tool/health','index.php',777],['lib/horde/framework/Horde/Imap/Client/Data','Fetch.php',468],['admin/tool/uploadcourse/classes','course.php',252]], 56],
'get_roles_with_cap_in_context': ['get_roles_with_cap_in_context', 'Returns two lists, this can be used to find out if user has capability. Having any needed role and no forbidden role in this context means user has this capability in this context. Use get_role_names_with_cap_in_context() if you need role names to display in the UI ', [['lib','accesslib.php',4790]], 10],
'assign_legacy_capabilities': ['assign_legacy_capabilities', 'Assign the defaults found in this capability definition to roles that have the corresponding legacy capabilities assigned to them. ', [['lib','accesslib.php',1358]], 3],
'get_role_users': ['get_role_users', 'Gets all the users assigned this role in this context or higher ', [['lib','accesslib.php',4068]], 29],
'id': ['id', 'Convenience function that creates an HTMLPurifier_ConfigSchema_Interchange_Id object based on a string Id. ', [['lib/htmlpurifier/HTMLPurifier/ConfigSchema','InterchangeBuilder.php',199]], 51],
'format_string': ['format_string', 'Given a simple string, this function returns the string processed by enabled string filters if $CFG->filterall is enabled ', [['lib','weblib.php',1318]], 854],
'role_change_permission': ['role_change_permission', 'More user friendly role permission changing, it should produce as few overrides as possible. ', [['lib','accesslib.php',4944]], 14],
'get_roles_used_in_context': ['get_roles_used_in_context', 'Gets the list of roles assigned to this context and up (parents) ', [['lib','accesslib.php',3087]], 3],
'get_roles_for_contextlevels': ['get_roles_for_contextlevels', 'Return roles suitable for assignment at the specified context level. ', [['lib','accesslib.php',3647]], 2],
'trigger': ['trigger', '', [['lib/evalmath','evalmath.class.php',438],['lib/classes/event','base.php',682]], 778],
'get_preload_record_columns': ['get_preload_record_columns', 'Returns all fields necessary for context preloading from user $rec. ', [['lib','accesslib.php',6002]], 2],
'switch_roles': ['switch_roles', 'Switch the sort order of two roles (used in admin/roles/manage.php). ', [['lib','accesslib.php',4752]], 2],
'get_roles_with_assignment_on_context': ['get_roles_with_assignment_on_context', 'Find out which roles has assignment on this context ', [['lib','accesslib.php',4432]], 0],
'notification': ['notification', 'Output a notification (that is, a status message about something that has just happened). ', [['lib','outputrenderers.php',2762],['lib','outputrenderers.php',4128],['lib','outputrenderers.php',4201]], 495],
'capabilities_cleanup': ['capabilities_cleanup', 'Deletes cached capabilities that are no longer needed by the component. Also unassigns these capabilities from any roles that have them. NOTE: this function is called from lib/db/upgrade.php ', [['lib','accesslib.php',2794]], 6],
'get_capabilities': ['get_capabilities', 'Returns array of relevant context capability records. ', [['lib/tests','customcontext_test.php',43],['lib/tests','customcontext_test.php',67],['lib/tests','customcontext_test.php',91],['lib','accesslib.php',6098],['lib','accesslib.php',6158],['lib','accesslib.php',6416],['lib','accesslib.php',6596],['lib','accesslib.php',6840],['lib','accesslib.php',7065],['lib','accesslib.php',7300]], 9],
'get_capability_string': ['get_capability_string', 'Returns the human-readable, translated version of the capability. Basically a big switch statement. ', [['lib','accesslib.php',2966]], 6],
'on': ['on', '', [['lib/requirejs','require.js',506]], 3494],
'get_default_enrol_roles': ['get_default_enrol_roles', 'Create a role menu suitable for default role selection in enrol plugins. ', [['lib','accesslib.php',3595]], 12],
'debugging': ['debugging', 'Standard Debugging Function ', [['lib','weblib.php',2854]], 853],
'get_component_directory': ['get_component_directory', 'Return exact absolute path to a plugin directory. ', [['lib/classes','component.php',1003],['lib','deprecatedlib.php',543]], 44],
'get_user_accessdata': ['get_user_accessdata', 'Get accessdata for a given user. ', [['lib','accesslib.php',1105]], 2],
'strlen': ['strlen', 'Multibyte safe strlen() function, uses mbstring or iconv for UTF-8, falls back to typo3. ', [['lib/classes','text.php',281],['lib/typo3','class.t3lib_cs.php',1520]], 1698],
'delete_comments': ['delete_comments', 'Delete comments ', [['comment','locallib.php',203],['comment','lib.php',750]], 3],
'import_record': ['import_record', 'Import a record into a table, id field is required. Safety checks are NOT carried out. Lobs are supported. ', [['lib/dml','pgsql_native_moodle_database.php',1046],['lib/dml','oci_native_moodle_database.php',1285],['lib/dml','sqlsrv_native_moodle_database.php',1014],['lib/dml','mssql_native_moodle_database.php',933],['lib/dml','mysqli_native_moodle_database.php',1331],['lib/dml/tests','dml_test.php',5428],['lib/dml','pdo_moodle_database.php',576]], 24],
'count_records': ['count_records', 'Count the records in a table where all the given conditions met. ', [['lib/dml','moodle_database.php',1717]], 1399],
'delete_area_files': ['delete_area_files', 'Delete all area files (optionally limited by itemid). ', [['lib/filestorage','file_storage.php',740]], 117],
'accesslib_clear_all_caches_for_unit_testing': ['accesslib_clear_all_caches_for_unit_testing', 'Clears accesslib\'s private caches. ONLY BE USED BY UNIT TESTS ', [['lib','accesslib.php',208]], 37],
'fullname': ['fullname', 'Returns a persons full name ', [['lib','moodlelib.php',3234],['mod/assign','locallib.php',3440]], 532],
'get_fieldset_sql': ['get_fieldset_sql', 'Selects records and return values (first field) as an array using a SQL statement. ', [['lib/dml','pgsql_native_moodle_database.php',800],['lib/dml','oci_native_moodle_database.php',1151],['lib/dml','sqlsrv_native_moodle_database.php',858],['lib/dml','mssql_native_moodle_database.php',775],['lib/dml','mysqli_native_moodle_database.php',1098],['lib/dml/tests','dml_test.php',5425],['lib/dml','pdo_moodle_database.php',287]], 51],
'get_user_capability_course': ['get_user_capability_course', 'This function gets the list of courses that this user has a particular capability in. It is still not very efficient. ', [['lib','accesslib.php',4245]], 1],
'get_docs_url': ['get_docs_url', 'Returns the Moodle Docs URL in the users language for a given \'More help\' link. ', [['lib','setuplib.php',630]], 29],
'dedupe_user_access': ['dedupe_user_access', 'Try to minimise the size of $USER->access by eliminating duplicate override storage, this function looks for contexts with the same overrides and shares them. ', [['lib','accesslib.php',1155]], 2],
'user_can_assign': ['user_can_assign', 'Checks if a user can assign users to a particular role in this context ', [['lib','accesslib.php',3170]], 3],
'clone': ['clone', '', [['lib/editor/tinymce/tiny_mce/3.5.11/plugins/media/js','media.js',11]], 315],
'get_preload_record_columns_sql': ['get_preload_record_columns_sql', 'Returns all fields necessary for context preloading from user $rec. ', [['lib','accesslib.php',6015]], 54],
'role_assign': ['role_assign', 'Assigns the specified role to a user in the context. ', [['lib/testing/generator','data_generator.php',885],['lib','accesslib.php',1666],['enrol','externallib.php',1008]], 172],
'preload_course': ['preload_course', 'Preload all contexts instances from course. ', [['lib','accesslib.php',6041]], 7],
'start_delegated_transaction': ['start_delegated_transaction', 'On DBs that support it, switch to transaction mode and begin a transaction you\'ll need to ensure you call allow_commit() on the returned object or your changes *will* be lost. ', [['lib/dml','moodle_database.php',2344]], 137],
'update_capabilities': ['update_capabilities', 'Updates the capabilities table with the component capability definitions. If no parameters are given, the function updates the core moodle capabilities. ', [['lib','accesslib.php',2681]], 13],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required. ', [['lib/dml','pgsql_native_moodle_database.php',883],['lib/dml','oci_native_moodle_database.php',1249],['lib/dml','sqlsrv_native_moodle_database.php',978],['lib/dml','mssql_native_moodle_database.php',898],['lib/dml','mysqli_native_moodle_database.php',1177],['lib/dml/tests','dml_test.php',5427],['lib/dml','pdo_moodle_database.php',386],['question/engine/upgrade','upgradelib.php',121]], 1512],
'allow_commit': ['allow_commit', 'Commit delegated transaction. The real database commit SQL is executed only after committing all delegated transactions. ', [['lib/dml','moodle_transaction.php',78]], 127],
'try_guestaccess': ['try_guestaccess', 'Attempt to automatically gain temporary guest access to course, calling code has to make sure the plugin and instance are active. ', [['enrol/guest','lib.php',64],['lib','enrollib.php',1254]], 2],
'getiterator': ['getiterator', 'Returns an iterator for the link set ', [['lib/zend/Zend/Service/Simpy','LinkSet.php',64],['lib/zend/Zend/Rest/Client','Result.php',165],['lib/adodb','adodb.inc.php',2848],['lib/adodb','adodb.inc.php',2965],['lib/horde/framework/Horde/Imap/Client/Fetch','Results.php',175],['lib/horde/framework/Horde/Imap/Client/Data/Format','List.php',97],['lib/classes/event','base.php',873],['lib/horde/framework/Horde/Support','Stub.php',135],['lib/zend/Zend/Service/Simpy','WatchlistFilterSet.php',58],['lib','modinfolib.php',1172],['lib','modinfolib.php',2672],['lib/zend/Zend/Http','CookieJar.php',373],['lib/horde/framework/Horde','Variables.php',391],['lib/horde/framework/Horde/Imap/Client/Data','Acl.php',135],['lib/zend/Zend/Service/Simpy','TagSet.php',64],['lib/horde/framework/Horde/Mime','Related.php',146],['lib/horde/framework/Horde/Imap/Client/Mailbox','List.php',153],['lib','accesslib.php',5282],['lib/horde/framework/Horde/Support','Array.php',156],['lib/zend/Zend/Service/Simpy','WatchlistSet.php',63],['lib/horde/framework/Horde/Imap/Client/Ids','Map.php',202],['lib/zend/Zend/Service/Simpy','NoteSet.php',64],['lib','navigationlib.php',947],['lib/horde/framework/Horde/Imap/Client/Namespace','List.php',125],['lib','coursecatlib.php',180],['lib','coursecatlib.php',2875],['lib/horde/framework/Horde/Imap/Client/Interaction','Pipeline.php',146]], 5],
'mark_dirty': ['mark_dirty', 'Mark a context as dirty (with timestamp) so as to force reloading of the context. ', [['lib','accesslib.php',5792]], 42],
'has_capability': ['has_capability', 'Wrapper round the has_capability funciton that automatically passes in the quiz context. ', [['mod/quiz','attemptlib.php',299],['mod/quiz','attemptlib.php',884],['lib','accesslib.php',346]], 1929],
'get_context_name': ['get_context_name', 'Returns human readable context identifier. ', [['lib','accesslib.php',5588],['lib','accesslib.php',6138],['lib','accesslib.php',6380],['lib','accesslib.php',6567],['lib','accesslib.php',6799],['lib','accesslib.php',7021],['lib','accesslib.php',7263]], 53],
'load_role_access_by_context': ['load_role_access_by_context', 'Add to the access ctrl array the data needed by a role for a given context. ', [['lib','accesslib.php',1028]], 2],
'extract_suspended_users': ['extract_suspended_users', 'Given context and array of users, returns array of users whose enrolment status is suspended, or enrolment has expired or has not started. Also removes those users from the given array ', [['lib','accesslib.php',7492]], 0],
'get_string': ['get_string', 'Return a core get_string() call ', [['lib/external','externallib.php',112],['lib','moodlelib.php',6538],['lib','moodlelib.php',9417],['lib/classes','string_manager_standard.php',280],['lib/classes','string_manager.php',38],['lib/classes','string_manager_install.php',95],['question/behaviour','behaviourbase.php',756]], 19235],
'get_recordset_sql': ['get_recordset_sql', 'Get a number of records as a moodle_recordset using a SQL statement. ', [['lib/dml','pgsql_native_moodle_database.php',688],['lib/dml','oci_native_moodle_database.php',1065],['lib/dml','sqlsrv_native_moodle_database.php',761],['lib/dml','mssql_native_moodle_database.php',687],['lib/dml','mysqli_native_moodle_database.php',985],['lib/dml/tests','dml_test.php',5423],['lib/dml','pdo_moodle_database.php',251]], 279],
'get_component_string': ['get_component_string', 'This gets the mod/block/course/core etc strings. ', [['lib','accesslib.php',3003]], 1],
'get_string_manager': ['get_string_manager', 'Returns current string_manager instance. ', [['lib','moodlelib.php',6481]], 147],
'get_plugin_directory': ['get_plugin_directory', 'Returns the exact absolute path to plugin directory. ', [['lib/classes','component.php',890],['lib','deprecatedlib.php',508]], 21],
'delete_instance': ['delete_instance', 'The assignment has been deleted - remove the plugin specific data ', [['mod/assign','assignmentplugin.php',525],['mod/workshop/allocation/random','lib.php',243],['mod/assign/submission/file','locallib.php',447],['mod/assign/submission/onlinetext','locallib.php',538],['mod/workshop/form/accumulative','lib.php',375],['mod/workshop/form/rubric','lib.php',405],['mod/workshop/form/numerrors','lib.php',394],['lib','enrollib.php',1737],['mod/assign','locallib.php',677],['mod/workshop/form','lib.php',118],['mod/workshop/allocation/scheduled','lib.php',200],['mod/assign/feedback/editpdf','locallib.php',260],['mod/workshop/form/comments','lib.php',360],['mod/assign/feedback/file','locallib.php',256],['lib','accesslib.php',6060],['mod/workshop/eval','lib.php',59],['mod/workshop/allocation/manual','lib.php',349],['mod/assign/feedback/comments','locallib.php',458],['mod/workshop/eval/best','lib.php',125],['mod/workshop/allocation','lib.php',62]], 35],
'delete': ['delete', 'Deletes a key pair ', [['lib/zend/Zend/Service/Amazon/Ec2','Keypair.php',110],['lib/google/src/Google/Service','Reseller.php',440],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',1006],['lib/adodb','adodb-active-recordx.inc.php',949],['lib/zend/Zend/Service/Delicious','Post.php',236],['lib/grade','grade_object.php',270],['lib/zend/Zend/Gdata','Gapps.php',258],['lib/google/src/Google/Service','Fusiontables.php',644],['lib/google/src/Google/Service','Fusiontables.php',809],['lib/google/src/Google/Service','Fusiontables.php',934],['lib/google/src/Google/Service','Fusiontables.php',1127],['lib/google/src/Google/Service','Fusiontables.php',1188],['blog','locallib.php',325],['lib/google/src/Google/Service','Blogger.php',1051],['lib/google/src/Google/Service','Blogger.php',1212],['lib/google/src/Google/Service','Blogger.php',1434],['lib/portfolio','plugin.php',692],['lib/google/src/Google/Service','AdExchangeBuyer.php',605],['lib/google/src/Google/Service','Manager.php',240],['lib/google/src/Google/Service','Manager.php',320],['lib/zend/Zend/Service/Amazon/Ec2','Securitygroups.php',137],['lib','webdavlib.php',691],['lib/grade','grade_item.php',354],['lib/google/src/Google/Service','Gmail.php',686],['lib/google/src/Google/Service','Gmail.php',843],['lib/google/src/Google/Service','Gmail.php',936],['lib/google/src/Google/Service','Gmail.php',1146],['course','lib.php',3133],['lib/google/src/Google/Service','Mirror.php',424],['lib/google/src/Google/Service','Mirror.php',592],['lib/google/src/Google/Service','Mirror.php',660],['lib/google/src/Google/Service','Mirror.php',771],['lib/google/src/Google/Service','Genomics.php',632],['lib/google/src/Google/Service','Genomics.php',731],['lib/google/src/Google/Service','Genomics.php',963],['lib/google/src/Google/Service','Genomics.php',1327],['lib/google/src/Google/Service','Genomics.php',1399],['cache/classes','interfaces.php',161],['lib/google/src/Google/Service','Dfareporting.php',470],['lib/zend/Zend/Gdata/Gbase','ItemEntry.php',133],['lib/google/src/Google/Service','Licensing.php',221],['lib/google/src/Google/Service','Drive.php',1462],['lib/google/src/Google/Service','Drive.php',1536],['lib/google/src/Google/Service','Drive.php',1681],['lib/google/src/Google/Service','Drive.php',1932],['lib/google/src/Google/Service','Drive.php',2002],['lib/google/src/Google/Service','Drive.php',2131],['lib/google/src/Google/Service','Drive.php',2294],['lib/google/src/Google/Service','Drive.php',2414],['completion','data_object.php',272],['lib/google/src/Google/Service','Books.php',1804],['lib/zend/Zend/Gdata','App.php',914],['lib/google/src/Google/Cache','Memcache.php',142],['lib/google/src/Google/Service','Bigquery.php',512],['lib/google/src/Google/Service','Bigquery.php',822],['cache','disabledlib.php',102],['lib/zend/Zend/Server','Cache.php',132],['lib/zend/Zend/Gdata/App','Entry.php',212],['cache/stores/memcached','lib.php',368],['lib/google/src/Google/Service','YouTube.php',1470],['lib/google/src/Google/Service','YouTube.php',1979],['lib/google/src/Google/Service','YouTube.php',2277],['lib/google/src/Google/Service','YouTube.php',2510],['lib/google/src/Google/Service','YouTube.php',2657],['lib/google/src/Google/Service','YouTube.php',2998],['lib/google/src/Google/Service','YouTube.php',3196],['lib/google/src/Google/Service','Webmasters.php',298],['lib/google/src/Google/Service','Webmasters.php',388],['lib/google/src/Google/Service','Autoscaler.php',314],['lib/google/src/Google/Service','Autoscaler.php',428],['calendar','lib.php',2388],['lib/zend/Zend/Service/Amazon','Sqs.php',129],['lib/google/src/Google/Service','ShoppingContent.php',553],['lib/google/src/Google/Service','ShoppingContent.php',735],['lib/google/src/Google/Service','ShoppingContent.php',969],['mod/lesson','locallib.php',1039],['mod/lesson','locallib.php',2274],['lib/google/src/Google/Service','SQLAdmin.php',628],['lib/google/src/Google/Service','SQLAdmin.php',923],['lib/google/src/Google/Service','Fitness.php',458],['lib/google/src/Google/Service','Fitness.php',563],['lib/google/src/Google/Service','TagManager.php',1049],['lib/google/src/Google/Service','TagManager.php',1140],['lib/google/src/Google/Service','TagManager.php',1233],['lib/google/src/Google/Service','TagManager.php',1326],['lib/google/src/Google/Service','TagManager.php',1419],['lib/google/src/Google/Service','TagManager.php',1513],['lib/google/src/Google/Service','TagManager.php',1607],['lib/google/src/Google/Service','TagManager.php',1757],['lib/google/src/Google/Service','Directory.php',1300],['lib/google/src/Google/Service','Directory.php',1477],['lib/google/src/Google/Service','Directory.php',1587],['lib/google/src/Google/Service','Directory.php',1642],['lib/google/src/Google/Service','Directory.php',1769],['lib/google/src/Google/Service','Directory.php',1838],['lib/google/src/Google/Service','Directory.php',1935],['lib/google/src/Google/Service','Directory.php',2042],['lib/google/src/Google/Service','Directory.php',2144],['lib/google/src/Google/Service','Directory.php',2205],['lib/google/src/Google/Service','Directory.php',2405],['lib/google/src/Google/Service','Directory.php',2480],['cache/stores/static','lib.php',374],['lib/google/src/Google/Service','AppState.php',153],['lib/google/src/Google/Service','Taskqueue.php',292],['lib/google/src/Google/Service','Container.php',343],['lib/google/src/Google/Service','AndroidPublisher.php',1177],['lib/google/src/Google/Service','AndroidPublisher.php',1257],['lib/google/src/Google/Service','AndroidPublisher.php',1595],['lib/google/src/Google/Service','AndroidPublisher.php',1690],['lib/google/src/Google/Service','AndroidPublisher.php',1972],['repository','lib.php',427],['repository','lib.php',2012],['lib','accesslib.php',5529],['lib/google/src/Google/Service','AdSenseHost.php',733],['lib/google/src/Google/Service','AdSenseHost.php',1009],['lib/google/src/Google/Service','AdSenseHost.php',1167],['cache/stores/memcache','lib.php',401],['lib','filelib.php',3440],['lib/google/src/Google/Service','MapsEngine.php',1692],['lib/google/src/Google/Service','MapsEngine.php',1990],['lib/google/src/Google/Service','MapsEngine.php',2343],['lib/google/src/Google/Service','MapsEngine.php',2650],['lib/google/src/Google/Service','MapsEngine.php',2911],['lib/grade','grade_grade.php',955],['comment','lib.php',786],['lib/google/src/Google/Service','SiteVerification.php',138],['lib/google/src/Google/Service','Prediction.php',261],['cache/stores/session','lib.php',417],['cache/classes','dummystore.php',198],['lib/google/src/Google/Service','Compute.php',2812],['lib/google/src/Google/Service','Compute.php',2896],['lib/google/src/Google/Service','Compute.php',3139],['lib/google/src/Google/Service','Compute.php',3225],['lib/google/src/Google/Service','Compute.php',3361],['lib/google/src/Google/Service','Compute.php',3463],['lib/google/src/Google/Service','Compute.php',3543],['lib/google/src/Google/Service','Compute.php',3662],['lib/google/src/Google/Service','Compute.php',3725],['lib/google/src/Google/Service','Compute.php',3844],['lib/google/src/Google/Service','Compute.php',3941],['lib/google/src/Google/Service','Compute.php',4080],['lib/google/src/Google/Service','Compute.php',4406],['lib/google/src/Google/Service','Compute.php',4543],['lib/google/src/Google/Service','Compute.php',4660],['lib/google/src/Google/Service','Compute.php',4740],['lib/google/src/Google/Service','Compute.php',4806],['lib/google/src/Google/Service','Compute.php',4927],['lib/google/src/Google/Service','Compute.php',5069],['lib/google/src/Google/Service','Compute.php',5229],['lib/google/src/Google/Service','Compute.php',5360],['badges/criteria','award_criteria.php',330],['badges/criteria','award_criteria_manual.php',220],['lib/google/src/Google/Service','Calendar.php',886],['lib/google/src/Google/Service','Calendar.php',1040],['lib/google/src/Google/Service','Calendar.php',1228],['lib/google/src/Google/Service','Calendar.php',1362],['lib/google/src/Google/Service','Analytics.php',2068],['lib/google/src/Google/Service','Analytics.php',2211],['lib/google/src/Google/Service','Analytics.php',2293],['lib/google/src/Google/Service','Analytics.php',2414],['lib/google/src/Google/Service','Analytics.php',2631],['lib/google/src/Google/Service','Analytics.php',2760],['lib/google/src/Google/Service','Analytics.php',2851],['lib/google/src/Google/Service','Analytics.php',3181],['lib/google/src/Google/Service','Analytics.php',3406],['lib/google/src/Google/Service','Tasks.php',309],['lib/google/src/Google/Service','Tasks.php',427],['cache/classes','loaders.php',777],['cache/classes','loaders.php',1491],['cache/classes','loaders.php',1859],['cache/stores/mongodb','lib.php',361],['lib/grade','grade_category.php',259],['cache/stores/file','lib.php',392],['lib/google/src/Google/Service','Storage.php',945],['lib/google/src/Google/Service','Storage.php',1060],['lib/google/src/Google/Service','Storage.php',1227],['lib/google/src/Google/Service','Storage.php',1349],['lib/google/src/Google/Service','Storage.php',1565],['admin/tool/uploadcourse/classes','course.php',226],['lib/google/src/Google/Cache','Null.php',51],['lib/filestorage','stored_file.php',323],['lib/filebrowser','virtual_root_file.php',69],['lib/google/src/Google/Service','AdSense.php',1257],['lib/google/src/Google/Service','AdSense.php',1729],['lib/google/src/Google/Service','Pubsub.php',239],['lib/google/src/Google/Service','Pubsub.php',378],['lib/grade','grade_scale.php',136],['lib/filebrowser','file_info.php',418],['lib/google/src/Google/Cache','File.php',106],['lib/htmlpurifier/HTMLPurifier','Zipper.php',89],['lib/google/src/Google/Service','Dns.php',370],['lib/filebrowser','file_info_stored.php',631],['lib/google/src/Google/Service','Replicapool.php',374],['lib/google/src/Google/Service','Resourceviews.php',419],['lib','badgeslib.php',620],['lib/google/src/Google/Cache','Apc.php',103],['lib/adodb','adodb-active-record.inc.php',792],['mnet','peer.php',122],['lib/grade','grade_outcome.php',97]], 260],
'get_users_by_capability': ['get_users_by_capability', 'Who has this capability in this context? ', [['lib','accesslib.php',3707],['availability/classes','capability_checker.php',58]], 53],
'update_moved': ['update_moved', 'Update context info after moving context in the tree structure. ', [['lib','accesslib.php',5419]], 8],
'get_local_override': ['get_local_override', 'Get the local override (if any) for a given capability in a role in a context ', [['lib','accesslib.php',1411]], 0],
'set_field_select': ['set_field_select', 'Set a single field in every table record which match a particular WHERE clause. ', [['lib/dml','pgsql_native_moodle_database.php',1192],['lib/dml','oci_native_moodle_database.php',1387],['lib/dml','sqlsrv_native_moodle_database.php',1111],['lib/dml','mssql_native_moodle_database.php',1033],['lib/dml','mysqli_native_moodle_database.php',1427],['lib/dml/tests','dml_test.php',5431],['lib/dml','pdo_moodle_database.php',491]], 78],
'get_records': ['get_records', 'Get a number of records as an array of objects where all the given conditions met. ', [['lib/dml','moodle_database.php',1236],['lib','coursecatlib.php',654],['question','category_class.php',63]], 860],
'get_empty_accessdata': ['get_empty_accessdata', 'Returns empty accessdata structure. ', [['lib','accesslib.php',1086]], 4],
'has_any_capability': ['has_any_capability', 'Check if the user has any one of several capabilities from a list. ', [['lib','accesslib.php',498]], 56],
'get_user_access_sitewide': ['get_user_access_sitewide', 'Return a nested array showing role assignments all relevant role capabilities for the user at site/course_category/course levels ', [['lib','accesslib.php',790]], 1],
'get_records_menu': ['get_records_menu', 'Get the first two columns from a number of records as an associative array where all the given conditions met. ', [['lib/dml','moodle_database.php',1326]], 69],
'unassign_capability': ['unassign_capability', 'Unassign a capability from a role. ', [['lib','accesslib.php',1594]], 12],
'merge_context_temp_table': ['merge_context_temp_table', 'Copy prepared new contexts from temp table to context table, we do this in db specific way for perf reasons only. ', [['lib','accesslib.php',5334]], 4],
'get_overridable_roles': ['get_overridable_roles', 'Gets a list of roles that this user can override in this context. ', [['lib','accesslib.php',3516]], 14],
'remove_temp_course_roles': ['remove_temp_course_roles', 'Removes any extra guest roles from current USER->access array. This is useful for enrol plugins only. ', [['lib','accesslib.php',1308]], 9],
'get_child_contexts': ['get_child_contexts', 'Recursive function which, given a context, find all its children contexts. ', [['lib','deprecatedlib.php',3408],['lib','accesslib.php',5616],['lib','accesslib.php',6272],['lib','accesslib.php',6649],['lib','accesslib.php',7372]], 24],
'cache_get_by_id': ['cache_get_by_id', 'Gets a context from the cache based on its id. ', [['lib','accesslib.php',5185]], 2],
'get_roles_on_exact_context': ['get_roles_on_exact_context', 'This function finds the roles assigned directly to this context only i.e. no roles in parent contexts ', [['lib','accesslib.php',4306]], 0],
'build_context_path': ['build_context_path', 'Populate context.path and context.depth where missing. ', [['lib','deprecatedlib.php',3458]], 6],
'set_field': ['set_field', 'Sets the custom profile field used for testing. ', [['availability/condition/profile/tests','condition_test.php',349],['lib/dml','moodle_database.php',1688]], 462],
'allow_override': ['allow_override', 'Creates a record in the role_allow_override table ', [['lib','accesslib.php',3333]], 2],
'get_guest_role': ['get_guest_role', 'Get the default guest role, this is used for guest account, search engine spiders, etc. ', [['lib','accesslib.php',317]], 7],
'build_all_paths': ['build_all_paths', 'Rebuild paths and depths in all context levels. ', [['lib','accesslib.php',5977]], 10],
'make': ['make', '', [['mod/quiz/accessrule/delaybetweenattempts','rule.php',40],['admin/tool/generator/classes','site_backend.php',89],['mod/quiz/accessrule/numattempts','rule.php',40],['lib/htmlpurifier/HTMLPurifier','AttrDef.php',67],['mod/quiz/accessrule/securewindow','rule.php',55],['lib/htmlpurifier/HTMLPurifier/ConfigSchema/Interchange','Id.php',52],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','Bool.php',45],['mod/quiz/accessrule/ipaddress','rule.php',40],['lib/htmlpurifier/HTMLPurifier','DoctypeRegistry.php',96],['lib/yuilib/2in3/2.9.0/build/yui2-logger','yui2-logger.js',655],['mod/quiz/accessrule/safebrowser','rule.php',40],['admin/tool/generator/classes','course_backend.php',202],['backup/util/ui','backup_ui_setting.class.php',234],['admin/tool/assignmentupgrade','locallib.php',110],['cache/classes','loaders.php',163],['lib/htmlpurifier/HTMLPurifier/AttrDef','Clone.php',38],['mod/quiz/accessrule','accessrulebase.php',63],['lib/htmlpurifier/HTMLPurifier/AttrDef','Enum.php',60],['mod/quiz/accessrule/timelimit','rule.php',41],['mod/quiz/accessrule/openclosedate','rule.php',40],['lib/yuilib/2in3/2.9.0/build/yui2-logger','yui2-logger-debug.js',655],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','Pixels.php',64],['lib/htmlpurifier/HTMLPurifier','Length.php',52],['lib/htmlpurifier/HTMLPurifier/AttrDef','URI.php',33],['mod/quiz/accessrule/password','rule.php',40]], 163],
'filter_delete_all_for_context': ['filter_delete_all_for_context', 'Delete all the data in the database relating to a context, used when contexts are deleted. ', [['lib','filterlib.php',1117]], 3],
'load_all_capabilities': ['load_all_capabilities', 'A convenience function to completely load all the capabilities for the current user. It is called from has_capability() and functions change permissions. ', [['lib','accesslib.php',1194]], 11],
'get_roles_with_caps_in_context': ['get_roles_with_caps_in_context', 'Returns an array of role IDs that have ALL of the the supplied capabilities Uses get_roles_with_cap_in_context(). Returns $allowed minus $forbidden ', [['lib','accesslib.php',4851]], 1],
'reset_role_capabilities': ['reset_role_capabilities', 'Reset role capabilities to default according to selected role archetype. If no archetype selected, removes all capabilities. ', [['lib','accesslib.php',2652]], 1],
'is_safe_capability': ['is_safe_capability', 'Verify capability risks. ', [['lib','accesslib.php',1400]], 7],
'role_unassign': ['role_unassign', 'Removes one role assignment ', [['lib','accesslib.php',1775],['enrol','externallib.php',1053]], 30],
'get_course_context': ['get_course_context', 'Get the context of the current course. ', [['mod/assign','locallib.php',1208],['lib','deprecatedlib.php',3666],['lib','accesslib.php',5713],['lib','accesslib.php',6858],['lib','accesslib.php',7119],['lib','accesslib.php',7330],['mod/assign','gradingtable.php',1342]], 85],
'join': ['join', 'Join a room. For internal use by the Games SDK only. Calling this method directly is unsupported. (rooms.join) ', [['lib/google/src/Google/Service','Games.php',1715],['lib/google/src/Google/Service','Games.php',2099]], 949],
'sql_concat': ['sql_concat', '', [['lib/dml','pgsql_native_moodle_database.php',1315],['lib/dml','oci_native_moodle_database.php',1550],['lib/dml','sqlsrv_native_moodle_database.php',1257],['lib/dml','sqlite3_pdo_moodle_database.php',353],['lib/dml','mssql_native_moodle_database.php',1194],['lib/dml','mysqli_native_moodle_database.php',1531],['lib/dml/tests','dml_test.php',5433],['lib/dml','pdo_moodle_database.php',536]], 73],
'get_record': ['get_record', 'Get a single database record as an object where all the given conditions met. ', [['lib/dml','moodle_database.php',1413]], 2960],
'get_level_name': ['get_level_name', 'Returns the name of specified context level ', [['lib','accesslib.php',6080],['lib','accesslib.php',6128],['lib','accesslib.php',6370],['lib','accesslib.php',6557],['lib','accesslib.php',6789],['lib','accesslib.php',7011],['lib','accesslib.php',7253]], 13],
'require_capability': ['require_capability', 'Adds a required capability which all results will be checked against ', [['backup/util/ui','restore_ui_components.php',157],['mod/quiz','attemptlib.php',306],['mod/quiz','attemptlib.php',891],['lib','accesslib.php',764]], 628],
'has_capability_in_accessdata': ['has_capability_in_accessdata', 'Does the user have a capability to do something? ', [['lib','accesslib.php',667]], 1],
'record_exists': ['record_exists', 'Test whether a record exists in a table where all the given conditions met. ', [['lib/dml','moodle_database.php',1768]], 735],
'get_record_sql': ['get_record_sql', 'Get a single database record as an object using a SQL statement. ', [['lib/dml','oci_native_moodle_database.php',1035],['lib/dml','moodle_database.php',1457]], 140],
'get_field_sql': ['get_field_sql', 'Get a single field value (first field) using a SQL statement. ', [['lib/dml','moodle_database.php',1539]], 135],
'get_parent_context_ids': ['get_parent_context_ids', 'Returns parent contexts of this context in reversed order, i.e. parent first, then grand parent, etc. ', [['lib','accesslib.php',5674]], 58],
'set': ['set', '', [['lib/adodb','adodb-active-recordx.inc.php',620],['lib/phpexcel/PHPExcel/Shared/JAMA','Matrix.php',286],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Serializer.php',31],['lib/portfolio','plugin.php',647],['lib/portfolio','exporter.php',154],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Mongo.php',167],['lib/pear/Net/GeoIP','Location.php',125],['cache/classes','interfaces.php',68],['lib/htmlpurifier/HTMLPurifier','AttrTypes.php',85],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Template.php.in',39],['lib/google/src/Google/Cache','Memcache.php',111],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Hashtable.php',162],['cache','disabledlib.php',81],['grade/report/singleview/classes/local/ui','finalgrade.php',136],['cache/stores/memcached','lib.php',320],['lib/google/src/Google/Service','YouTube.php',3122],['lib/google/src/Google/Service','YouTube.php',3481],['lib/zend/Zend','Registry.php',153],['lib/phpmailer','class.phpmailer.php',3144],['grade/report/singleview/classes/local/ui','feedback.php',102],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Db.php',114],['lib/google/src/Google/Service','ShoppingContent.php',919],['lib/htmlpurifier/HTMLPurifier','PropertyList.php',51],['grade/report/singleview/classes/local/ui','override.php',95],['lib/horde/framework/Horde','Variables.php',189],['lib/htmlpurifier/HTMLPurifier','Config.php',289],['cache/stores/static','lib.php',265],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Null.php',24],['lib/portfolio','caller.php',187],['lib/zend/Zend','Date.php',1056],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Memory.php',47],['cache/stores/memcache','lib.php',358],['lib','filelib.php',3615],['cache/stores/session','lib.php',290],['cache/classes','dummystore.php',170],['lib/horde/framework/Horde/Imap/Client','Cache.php',127],['grade/report/singleview/classes/local/ui','exclude.php',77],['cache/classes','loaders.php',484],['cache/classes','loaders.php',1370],['cache/classes','loaders.php',1815],['cache/stores/mongodb','lib.php',305],['lib/zend/Zend/Service','Audioscrobbler.php',125],['cache/stores/file','lib.php',425],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Decorator.php',60],['lib/google/src/Google/Cache','Null.php',42],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Null.php',41],['lib/google/src/Google/Cache','File.php',84],['lib','navigationlib.php',5017],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Cleanup.php',41],['lib/google/src/Google/Cache','Apc.php',80],['lib/adodb','adodb-active-record.inc.php',569],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Cache.php',203]], 4687],
'string_exists': ['string_exists', 'Does the string actually exist? ', [['lib/classes','string_manager_standard.php',263],['lib/classes','string_manager.php',50],['lib/classes','string_manager_install.php',64]], 76],
'cache_remove': ['cache_remove', 'Removes a context from the cache. ', [['lib','accesslib.php',5148]], 2],
'or': ['or', '', [['lib/tcpdf','LICENSE.TXT',69]], 552],
'prohibit_is_removable': ['prohibit_is_removable', 'This function verifies the prohibit comes from this context and there are no more prohibits in parent contexts. ', [['lib','accesslib.php',4908]], 1],
'get_course_display_name_for_list': ['get_course_display_name_for_list', 'Gets the name of a course to be displayed when showing a list of courses. By default this is just $course->fullname but user can configure it. The result of this function should be passed through print_string. ', [['lib','moodlelib.php',9254]], 17],
'__get': ['__get', '__get override. ', [['lib/alfresco/Service','Version.php',59],['lib/minify/lib/MrClay/Cli','Arg.php',170],['lib/adodb','adodb-active-recordx.inc.php',333],['lib/horde/framework/Horde/Imap/Client/Data','Envelope.php',63],['lib/zend/Zend/Service/WindowsAzure/Storage','SignedIdentifier.php',82],['lib/zend/Zend/Gdata','Query.php',396],['lib/zend/Zend/Rest/Client','Result.php',93],['user/classes/output/myprofile','tree.php',144],['lib/zend/Zend/Server/Reflection/Function','Abstract.php',376],['lib/horde/framework/Horde/Imap/Client/Fetch','Results.php',70],['lib/zend/Zend/Service/StrikeIron','Decorator.php',59],['course','lib.php',2960],['lib/pear/Net/GeoIP','Location.php',158],['lib/zend/Zend/Service/WindowsAzure/Storage','BlobContainer.php',83],['lib/horde/framework/Horde/Imap/Client','Ids.php',92],['lib/classes/event','base.php',826],['lib/horde/framework/Horde/Support','Stub.php',41],['lib/zend/Zend/XmlRpc/Client','ServerProxy.php',67],['lib/horde/framework/Horde/Imap/Client','Tokenize.php',84],['lib/zend/Zend/Validate','Abstract.php',175],['lib/horde/framework/Horde/Stream','TempString.php',65],['lib/zend/Zend/Service/WindowsAzure/Storage','QueueMessage.php',89],['lib/zend/Zend/Gdata/App','FeedSourceParent.php',121],['lib','modinfolib.php',124],['lib','modinfolib.php',1153],['lib','modinfolib.php',2601],['calendar/tests','rrule_manager_tests.php',521],['lib/htmlpurifier/HTMLPurifier','Token.php',48],['lib/horde/framework/Horde/Mail/Rfc822','List.php',75],['lib/horde/framework/Horde/Imap/Client/Data','Namespace.php',67],['lib/horde/framework/Horde/Mail/Rfc822','Group.php',85],['lib/classes/message/inbound','handler.php',79],['user/classes/output/myprofile','node.php',106],['lib/classes/plugininfo','mod.php',43],['calendar','lib.php',2042],['lib/horde/framework/Horde/Imap/Client','Url.php',196],['lib/zend/Zend/Service','Twitter.php',216],['lib/zend/Zend/Gdata/App','Base.php',466],['mod/lesson','locallib.php',2031],['lib/horde/framework/Horde','Variables.php',150],['lib/zend/Zend/Gdata/App','BaseMediaSource.php',102],['lib/classes/plugininfo','base.php',168],['lib/horde/framework/Horde/Imap/Client/Interaction','Command.php',92],['lib/zend/Zend/Service/Nirvanix','Response.php',81],['lib/horde/framework/Horde/Imap/Client','Mailbox.php',85],['lib/horde/framework/Horde/Socket','Client.php',91],['lib','accesslib.php',5235],['lib/zend/Zend/Gdata/App','Feed.php',68],['lib/zend/Zend/Server/Reflection','Class.php',112],['lib/zend/Zend/Service/WindowsAzure/Storage','DynamicTableEntity.php',61],['lib/minify/lib','JSMinPlus.php',1686],['lib/classes/plugininfo','block.php',44],['lib/horde/framework/Horde/Support','Array.php',116],['lib/zend/Zend/Service/WindowsAzure/Storage','TableInstance.php',83],['user/classes/output/myprofile','category.php',185],['lib/horde/framework/Horde','Stream.php',74],['lib/horde/framework/Horde/Mail/Rfc822','Address.php',108],['lib/horde/framework/Horde/Imap/Client/Ids','Map.php',56],['lib','adminlib.php',1072],['lib/google/src/Google','Model.php',46],['lib/horde/framework/Horde/Crypt','Blowfish.php',86],['lib/simplepie/library/SimplePie','IRI.php',168],['lib','pagelib.php',756],['lib/alfresco/Service','BaseObject.php',23],['lib/alfresco/Service','Node.php',251],['admin/tool/monitor/classes','subscription.php',54],['lib/zend/Zend/Service/WindowsAzure/Storage','BlobInstance.php',104],['lib/horde/framework/Horde/Imap/Client/Data','Sync.php',255],['lib/zend/Zend/Service/WindowsAzure/Storage','QueueInstance.php',79],['lib','navigationlib.php',4993],['lib/mustache/src/Mustache','HelperCollection.php',67],['lib/horde/framework/Horde/Imap/Client/Exception','ServerResponse.php',69],['lib/classes/message','message.php',187],['lib','coursecatlib.php',134],['lib','coursecatlib.php',2829],['lib/horde/framework/Horde/Imap/Client/Interaction','Pipeline.php',72],['lib/adodb','adodb-active-record.inc.php',269],['lib/horde/framework/Horde/Support','ObjectStub.php',41],['admin/tool/monitor/classes','rule.php',166],['lib/horde/framework/Horde/Imap/Client/Auth','DigestMD5.php',121]], 25],
'get_role_contextlevels': ['get_role_contextlevels', 'Return context levels where this role is assignable. ', [['lib','accesslib.php',3635]], 5],
'create_instance_from_record': ['create_instance_from_record', 'This function is also used to work around \'protected\' keyword problems in context_helper. ', [['lib','accesslib.php',5315]], 7],
'get_capability_info': ['get_capability_info', 'Returns capability information (cached) ', [['lib','accesslib.php',2940]], 7],
'get_role_archetypes': ['get_role_archetypes', 'Returns array of all role archetypes. ', [['lib','accesslib.php',1340]], 14],
'accesslib_clear_all_caches': ['accesslib_clear_all_caches', 'Clears accesslib\'s private caches. ONLY BE USED FROM THIS LIBRARY FILE! ', [['lib','accesslib.php',229]], 11],
'get_sorted_contexts': ['get_sorted_contexts', 'Runs get_records select on context table and returns the result Does get_records_select on the context table, and returns the results ordered by contextlevel, and then the natural sort order within each level. for the purpose of $select, you need to know that the context table has been aliased to ctx, so for example, you can call get_sorted_contexts(\'ctx.depth = 3\'); ', [['lib','accesslib.php',7460]], 2],
'isloggedin': ['isloggedin', 'Return true, if session is currently logged into the backend server ', [['lib/zend/Zend/Service','LiveDocx.php',293],['lib','accesslib.php',1909]], 177],
'role_get_description': ['role_get_description', 'Returns localised role description if available. If the name is empty it tries to find the default role name using hardcoded list of default role names or other methods in the future. ', [['lib','accesslib.php',4583]], 2],
'get_user_roles_with_special': ['get_user_roles_with_special', 'Like get_user_roles, but adds in the authenticated user role, and the front page roles, if applicable. ', [['lib','accesslib.php',3286]], 1],
'fix_role_sortorder': ['fix_role_sortorder', 'Fix the roles.sortorder field in the database, so it contains sequential integers, and return an array of roleids in order. ', [['lib','accesslib.php',4726]], 0],
'reload_if_dirty': ['reload_if_dirty', 'Reset all cached permissions and definitions if the necessary. ', [['lib','accesslib.php',5758]], 6],
'get_user_roles': ['get_user_roles', 'Gets the roles assigned to this user that are applicable for this course. ', [['enrol','locallib.php',799],['lib','accesslib.php',3242]], 7],
'get_roles_with_override_on_context': ['get_roles_with_override_on_context', 'Get any role that has an override on exact context ', [['lib','accesslib.php',4401]], 0],
'has_coursecontact_role': ['has_coursecontact_role', 'Returns true if user has at least one role assign of \'coursecontact\' role (is potentially listed in some course descriptions). ', [['lib','accesslib.php',648]], 13],
'role_fix_names': ['role_fix_names', 'Prepare list of roles for display, apply aliases and localise default role names. ', [['lib','accesslib.php',4625]], 42],
'cache_get': ['cache_get', 'Gets a context from the cache. ', [['lib','accesslib.php',5170]], 5],
'component_level_changed': ['component_level_changed', 'Aids in detecting if a new line is required when reading a new capability ', [['lib','accesslib.php',4688]], 1],
'count_role_users': ['count_role_users', 'Counts all the users assigned this role in this context or higher ', [['lib','accesslib.php',4204]], 6],
'html_is_blank': ['html_is_blank', 'Tests whether anything was returned by text editor ', [['lib','moodlelib.php',1316]], 11],
'__unset': ['__unset', 'Ignore unsetting a property. ', [['lib/horde/framework/Horde/Support','Stub.php',65],['lib/zend/Zend/Gdata/App','Base.php',545],['lib/horde/framework/Horde','Variables.php',248],['lib','accesslib.php',5272],['lib/horde/framework/Horde/Support','Array.php',136],['lib/google/src/Google','Model.php',277],['lib/simplepie/library/SimplePie','IRI.php',239],['lib/mustache/src/Mustache','HelperCollection.php',125],['lib','coursecatlib.php',171],['lib','coursecatlib.php',2856],['lib/horde/framework/Horde/Support','ObjectStub.php',64]], 2],
'get_cache_flags': ['get_cache_flags', 'Get volatile flags ', [['lib','moodlelib.php',1632]], 10],
'get_role_names_with_caps_in_context': ['get_role_names_with_caps_in_context', 'Returns an array of role names that have ALL of the the supplied capabilities Uses get_roles_with_caps_in_context(). Returns $allowed minus $forbidden ', [['lib','accesslib.php',4886]], 1],
'during_initial_install': ['during_initial_install', 'Indicates whether we are in the middle of the initial Moodle install. ', [['lib','setuplib.php',1124]], 48],
'enrol_is_enabled': ['enrol_is_enabled', 'Checks if a given plugin is in the list of enabled enrolment plugins. ', [['lib','enrollib.php',171]], 56],
'count_records_sql': ['count_records_sql', 'Get the result of a SQL SELECT COUNT(...) query. ', [['lib/dml','moodle_database.php',1747]], 132],
'assign_capability': ['assign_capability', '', [['lib/tests','coursecatlib_test.php',66],['lib','accesslib.php',1543]], 118],
'get_class_for_level': ['get_class_for_level', 'Returns a class name of the context level class ', [['lib','accesslib.php',5897]], 6],
'get_dbfamily': ['get_dbfamily', 'Returns database family type - describes SQL dialect Note: can be used before connect() ', [['lib/dml','pgsql_native_moodle_database.php',61],['lib/dml','oci_native_moodle_database.php',67],['lib/dml','sqlsrv_native_moodle_database.php',75],['lib/dml','sqlite3_pdo_moodle_database.php',50],['lib/dml','mssql_native_moodle_database.php',56],['lib/dml','mysqli_native_moodle_database.php',117],['lib/dml/tests','dml_test.php',5406]], 59],
'is_viewing': ['is_viewing', 'Returns true if the user has moodle/course:view capability in the course, this is intended for admins, managers (aka small admins), inspectors, etc. ', [['lib','accesslib.php',2004]], 25],
'get_default_capabilities': ['get_default_capabilities', 'Returns default capabilities for given role archetype. ', [['lib','accesslib.php',2538]], 3],
'allow_switch': ['allow_switch', 'Creates a record in the role_allow_switch table ', [['lib','accesslib.php',3365]], 2],
'record_exists_select': ['record_exists_select', 'Test whether any records exists in a table which match a particular WHERE clause. ', [['lib/dml','moodle_database.php',1781]], 35],
'record_exists_sql': ['record_exists_sql', 'Test whether a SQL SELECT statement returns any records. ', [['lib/dml','moodle_database.php',1797]], 47],
'get_site': ['get_site', 'Returns $course object of the top-level site. ', [['lib','datalib.php',547]], 76],
'can_access_course': ['can_access_course', 'Returns true if the user is able to access the course. ', [['lib','accesslib.php',2129]], 10],
'get_context_info_list': ['get_context_info_list', 'Constructs array with contextids as first parameter and context paths, in both cases bottom top including self. ', [['lib','accesslib.php',2907]], 2],
'get': ['get', 'Gets a customer resource if one exists and is owned by the reseller. (customers.get) ', [['lib/google/src/Google/Service','Reseller.php',294],['lib/google/src/Google/Service','Reseller.php',457],['lib/editor/tinymce/tiny_mce/3.5.11/plugins/media/js','media.js',7],['lib/google/src/Google/Service','Replicapoolupdater.php',275],['lib/zend/Zend/Gdata','Gapps.php',187],['lib/google/src/Google/Service','Fusiontables.php',658],['lib/google/src/Google/Service','Fusiontables.php',823],['lib/google/src/Google/Service','Fusiontables.php',947],['lib/google/src/Google/Service','Fusiontables.php',1141],['lib/google/src/Google/Service','Fusiontables.php',1202],['lib/phpexcel/PHPExcel/Shared/JAMA','Matrix.php',148],['lib/htmlpurifier/HTMLPurifier','Context.php',36],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Serializer.php',67],['lib/horde/framework/Horde/Imap/Client/Fetch','Results.php',78],['lib/lessphp','Cache.php',27],['lib/google/src/Google/Service','Blogger.php',931],['lib/google/src/Google/Service','Blogger.php',962],['lib/google/src/Google/Service','Blogger.php',1066],['lib/google/src/Google/Service','Blogger.php',1184],['lib/google/src/Google/Service','Blogger.php',1226],['lib/google/src/Google/Service','Blogger.php',1365],['lib/google/src/Google/Service','Blogger.php',1448],['lib/google/src/Google/Service','Blogger.php',1669],['lib/google/src/Google/Service','Doubleclicksearch.php',256],['lib/google/src/Google/Service','Doubleclicksearch.php',380],['lib/portfolio','plugin.php',631],['lib/google/src/Google/Service','AdExchangeBuyer.php',349],['lib/google/src/Google/Service','AdExchangeBuyer.php',419],['lib/google/src/Google/Service','AdExchangeBuyer.php',460],['lib/google/src/Google/Service','AdExchangeBuyer.php',528],['lib/google/src/Google/Service','AdExchangeBuyer.php',620],['lib/google/src/Google/Service','Manager.php',255],['lib/google/src/Google/Service','Manager.php',334],['lib/google/src/Google/Service','Reports.php',374],['lib/google/src/Google/Service','Reports.php',408],['lib/portfolio','exporter.php',134],['lib','webdavlib.php',264],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Mongo.php',105],['lib/simplepie/library/SimplePie/Parse','Date.php',567],['lib/google/src/Google/Service','Gmail.php',702],['lib/google/src/Google/Service','Gmail.php',859],['lib/google/src/Google/Service','Gmail.php',952],['lib/google/src/Google/Service','Gmail.php',1118],['lib/google/src/Google/Service','Gmail.php',1162],['lib/google/src/Google/Service','Plus.php',352],['lib/google/src/Google/Service','Plus.php',427],['lib/google/src/Google/Service','Plus.php',547],['lib/horde/framework/Horde/Support','ConsistentHash.php',69],['lib/testing/classes','nasty_strings.php',73],['lib/google/src/Google/Service','Mirror.php',437],['lib/google/src/Google/Service','Mirror.php',522],['lib/google/src/Google/Service','Mirror.php',562],['lib/google/src/Google/Service','Mirror.php',673],['lib/google/src/Google/Service','Mirror.php',785],['lib/google/src/Google/Service','Genomics.php',645],['lib/google/src/Google/Service','Genomics.php',744],['lib/google/src/Google/Service','Genomics.php',891],['lib/google/src/Google/Service','Genomics.php',997],['lib/google/src/Google/Service','Genomics.php',1187],['lib/google/src/Google/Service','Genomics.php',1269],['lib/google/src/Google/Service','Genomics.php',1340],['lib/google/src/Google/Service','Genomics.php',1430],['lib/google/src/Google/Service','Urlshortener.php',108],['cache/classes','interfaces.php',41],['lib/google/src/Google/Service','Dfareporting.php',421],['lib/google/src/Google/Service','Dfareporting.php',484],['lib/google/src/Google/Service','Dfareporting.php',626],['lib/google/src/Google/Service','Dfareporting.php',675],['lib/google/src/Google/Service','PlusDomains.php',467],['lib/google/src/Google/Service','PlusDomains.php',592],['lib/google/src/Google/Service','PlusDomains.php',718],['lib/google/src/Google/Service','PlusDomains.php',812],['lib/htmlpurifier/HTMLPurifier','AttrTypes.php',64],['lib/google/src/Google/Service','Licensing.php',236],['lib/google/src/Google/Service','Drive.php',1277],['lib/google/src/Google/Service','Drive.php',1313],['lib/google/src/Google/Service','Drive.php',1366],['lib/google/src/Google/Service','Drive.php',1476],['lib/google/src/Google/Service','Drive.php',1550],['lib/google/src/Google/Service','Drive.php',1706],['lib/google/src/Google/Service','Drive.php',1946],['lib/google/src/Google/Service','Drive.php',2016],['lib/google/src/Google/Service','Drive.php',2147],['lib/google/src/Google/Service','Drive.php',2241],['lib/google/src/Google/Service','Drive.php',2309],['lib/google/src/Google/Service','Drive.php',2428],['lib/google/src/Google/Service','Books.php',1343],['lib/google/src/Google/Service','Books.php',1512],['lib/google/src/Google/Service','Books.php',1564],['lib/google/src/Google/Service','Books.php',1639],['lib/google/src/Google/Service','Books.php',1819],['lib/google/src/Google/Service','Books.php',1960],['lib/google/src/Google/Service','Books.php',2077],['lib/google/src/Google/Service','Books.php',2175],['lib/google/src/Google/Service','Books.php',2207],['lib/zend/Zend/Gdata','App.php',847],['lib/google/src/Google/Service','AdExchangeSeller.php',443],['lib/google/src/Google/Service','AdExchangeSeller.php',551],['lib/google/src/Google/Service','AdExchangeSeller.php',665],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Template.php.in',58],['lib/google/src/Google/Cache','Memcache.php',72],['lib/google/src/Google/Service','Bigquery.php',533],['lib/google/src/Google/Service','Bigquery.php',633],['lib/google/src/Google/Service','Bigquery.php',838],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Hashtable.php',108],['cache','disabledlib.php',55],['lib/zend/Zend/Server','Cache.php',78],['lib/google/src/Google/Service','Groupssettings.php',107],['cache/stores/memcached','lib.php',285],['lib/google/src/Google/Service','Coordinate.php',476],['lib/google/src/Google/Service','Coordinate.php',642],['lib/zend/Zend','Registry.php',130],['lib/google/src/Google/Service','Webmasters.php',314],['lib/google/src/Google/Service','Webmasters.php',403],['lib/google/src/Google/Service','Webmasters.php',479],['lib/google/src/Google/Service','Autoscaler.php',330],['lib/google/src/Google/Service','Autoscaler.php',444],['lib/editor/tinymce/tiny_mce/3.5.11','tiny_mce_src.js',981],['lib/editor/tinymce/tiny_mce/3.5.11','tiny_mce_src.js',16595],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Db.php',65],['lib/google/src/Google/Service','ShoppingContent.php',567],['lib/google/src/Google/Service','ShoppingContent.php',675],['lib/google/src/Google/Service','ShoppingContent.php',749],['lib/google/src/Google/Service','ShoppingContent.php',857],['lib/google/src/Google/Service','ShoppingContent.php',985],['lib/google/src/Google/Service','ShoppingContent.php',1062],['lib/htmlpurifier/HTMLPurifier','PropertyList.php',34],['lib/editor/tinymce/classes','plugin.php',447],['mod/lesson','locallib.php',3239],['lib/horde/framework/Horde','Variables.php',135],['lib/google/src/Google/Service','SQLAdmin.php',528],['lib/google/src/Google/Service','SQLAdmin.php',664],['lib/google/src/Google/Service','SQLAdmin.php',872],['lib/google/src/Google/Service','SQLAdmin.php',941],['lib/google/src/Google/Service','Fitness.php',363],['lib/google/src/Google/Service','Fitness.php',489],['lib/google/src/Google/Service','TagManager.php',977],['lib/google/src/Google/Service','TagManager.php',1063],['lib/google/src/Google/Service','TagManager.php',1155],['lib/google/src/Google/Service','TagManager.php',1248],['lib/google/src/Google/Service','TagManager.php',1341],['lib/google/src/Google/Service','TagManager.php',1434],['lib/google/src/Google/Service','TagManager.php',1528],['lib/google/src/Google/Service','TagManager.php',1622],['lib/google/src/Google/Service','TagManager.php',1772],['lib/google/src/Google/Service','Directory.php',1315],['lib/google/src/Google/Service','Directory.php',1383],['lib/google/src/Google/Service','Directory.php',1490],['lib/google/src/Google/Service','Directory.php',1656],['lib/google/src/Google/Service','Directory.php',1783],['lib/google/src/Google/Service','Directory.php',1853],['lib/google/src/Google/Service','Directory.php',1949],['lib/google/src/Google/Service','Directory.php',2056],['lib/google/src/Google/Service','Directory.php',2160],['lib/google/src/Google/Service','Directory.php',2218],['lib/google/src/Google/Service','Directory.php',2493],['lib/htmlpurifier/HTMLPurifier','Config.php',161],['cache/stores/static','lib.php',220],['question/engine','states.php',116],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Null.php',52],['lib/htmlpurifier/HTMLPurifier','DoctypeRegistry.php',76],['lib/google/src/Google/Service','AppState.php',170],['lib/google/src/Google/Service','Taskqueue.php',263],['lib/google/src/Google/Service','Taskqueue.php',307],['lib/horde/framework/Horde/Imap/Client','Mailbox.php',46],['lib/google/src/Google/Service','Container.php',364],['lib/google/src/Google/Service','Container.php',411],['lib/portfolio','caller.php',170],['lib/portfolio','caller.php',538],['lib/google/src/Google/Service','AndroidPublisher.php',1194],['lib/google/src/Google/Service','AndroidPublisher.php',1296],['lib/google/src/Google/Service','AndroidPublisher.php',1437],['lib/google/src/Google/Service','AndroidPublisher.php',1500],['lib/google/src/Google/Service','AndroidPublisher.php',1723],['lib/google/src/Google/Service','AndroidPublisher.php',1811],['lib/google/src/Google/Service','AndroidPublisher.php',1875],['lib/google/src/Google/Service','AndroidPublisher.php',1987],['lib/google/src/Google/Service','AndroidPublisher.php',2112],['lib/google/src/Google/Service','AndroidPublisher.php',2182],['lib/zend/Zend','Date.php',516],['lib/google/src/Google/Service','AdSenseHost.php',644],['lib/google/src/Google/Service','AdSenseHost.php',685],['lib/google/src/Google/Service','AdSenseHost.php',750],['lib/google/src/Google/Service','AdSenseHost.php',917],['lib/google/src/Google/Service','AdSenseHost.php',1025],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Memory.php',74],['cache/stores/memcache','lib.php',312],['lib/google/src/Google/Service','Games.php',1219],['lib/google/src/Google/Service','Games.php',1338],['lib/google/src/Google/Service','Games.php',1440],['lib/google/src/Google/Service','Games.php',1698],['lib/google/src/Google/Service','Games.php',1805],['lib/google/src/Google/Service','Games.php',1947],['lib/google/src/Google/Service','Games.php',2081],['lib','filelib.php',3341],['lib','filelib.php',3589],['lib','oauthlib.php',302],['lib/google/src/Google/Service','MapsEngine.php',1529],['lib/google/src/Google/Service','MapsEngine.php',1708],['lib/google/src/Google/Service','MapsEngine.php',2005],['lib/google/src/Google/Service','MapsEngine.php',2267],['lib/google/src/Google/Service','MapsEngine.php',2359],['lib/google/src/Google/Service','MapsEngine.php',2665],['lib/google/src/Google/Service','MapsEngine.php',2926],['lib/google/src/Google/Service','MapsEngine.php',3117],['lib/minify/lib','JSMinPlus.php',1827],['lib/google/src/Google/Service','SiteVerification.php',151],['lib/horde/framework/Horde/Support','Array.php',30],['lib/google/src/Google/Service','Prediction.php',275],['cache/stores/session','lib.php',225],['cache/classes','dummystore.php',141],['lib/google/src/Google/Service','Compute.php',2828],['lib/google/src/Google/Service','Compute.php',2911],['lib/google/src/Google/Service','Compute.php',3050],['lib/google/src/Google/Service','Compute.php',3155],['lib/google/src/Google/Service','Compute.php',3240],['lib/google/src/Google/Service','Compute.php',3377],['lib/google/src/Google/Service','Compute.php',3478],['lib/google/src/Google/Service','Compute.php',3558],['lib/google/src/Google/Service','Compute.php',3676],['lib/google/src/Google/Service','Compute.php',3741],['lib/google/src/Google/Service','Compute.php',3876],['lib/google/src/Google/Service','Compute.php',3957],['lib/google/src/Google/Service','Compute.php',4132],['lib/google/src/Google/Service','Compute.php',4306],['lib/google/src/Google/Service','Compute.php',4355],['lib/google/src/Google/Service','Compute.php',4421],['lib/google/src/Google/Service','Compute.php',4486],['lib/google/src/Google/Service','Compute.php',4559],['lib/google/src/Google/Service','Compute.php',4611],['lib/google/src/Google/Service','Compute.php',4675],['lib/google/src/Google/Service','Compute.php',4756],['lib/google/src/Google/Service','Compute.php',4822],['lib/google/src/Google/Service','Compute.php',4943],['lib/google/src/Google/Service','Compute.php',5085],['lib/google/src/Google/Service','Compute.php',5244],['lib/google/src/Google/Service','Compute.php',5376],['lib/google/src/Google/Service','Compute.php',5428],['lib/horde/framework/Horde/Imap/Client','Cache.php',88],['lib/google/src/Google/Service','Calendar.php',900],['lib/google/src/Google/Service','Calendar.php',1053],['lib/google/src/Google/Service','Calendar.php',1241],['lib/google/src/Google/Service','Calendar.php',1337],['lib/google/src/Google/Service','Calendar.php',1379],['lib/google/src/Google/Service','Calendar.php',1780],['lib/google/src/Google/Service','Analytics.php',1891],['lib/google/src/Google/Service','Analytics.php',1940],['lib/google/src/Google/Service','Analytics.php',1987],['lib/google/src/Google/Service','Analytics.php',2309],['lib/google/src/Google/Service','Analytics.php',2429],['lib/google/src/Google/Service','Analytics.php',2522],['lib/google/src/Google/Service','Analytics.php',2648],['lib/google/src/Google/Service','Analytics.php',2867],['lib/google/src/Google/Service','Analytics.php',3004],['lib/google/src/Google/Service','Analytics.php',3095],['lib/google/src/Google/Service','Analytics.php',3197],['lib/google/src/Google/Service','Analytics.php',3308],['lib/google/src/Google/Service','Tasks.php',322],['lib/google/src/Google/Service','Tasks.php',441],['lib/behat/classes','behat_context_helper.php',66],['backup/cc/cc_lib/gral_lib','cssparser.php',137],['cache/classes','loaders.php',270],['cache/classes','loaders.php',1442],['cache/classes','loaders.php',1749],['cache/stores/mongodb','lib.php',252],['lib/zend/Zend/Service','Audioscrobbler.php',110],['lib/google/src/Google/Service','Oauth2.php',143],['lib/google/src/Google/Service','Oauth2.php',180],['cache/stores/file','lib.php',329],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Decorator.php',79],['lib/google/src/Google/Service','Storage.php',962],['lib/google/src/Google/Service','Storage.php',1078],['lib/google/src/Google/Service','Storage.php',1244],['lib/google/src/Google/Service','Storage.php',1370],['lib/google/src/Google/Service','Storage.php',1592],['lib/google/src/Google/Cache','Null.php',34],['lib/google/src/Google/Service','AdSense.php',1075],['lib/google/src/Google/Service','AdSense.php',1154],['lib/google/src/Google/Service','AdSense.php',1302],['lib/google/src/Google/Service','AdSense.php',1518],['lib/google/src/Google/Service','AdSense.php',1630],['lib/google/src/Google/Service','AdSense.php',1772],['lib/google/src/Google/Service','AdSense.php',2046],['lib/google/src/Google/Service','Pubsub.php',254],['lib/google/src/Google/Service','Pubsub.php',393],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Null.php',27],['lib/google/src/Google/Cache','File.php',45],['lib','navigationlib.php',382],['lib','navigationlib.php',833],['lib','navigationlib.php',2693],['lib','navigationlib.php',3126],['lib/google/src/Google/Service','Dns.php',299],['lib/google/src/Google/Service','Dns.php',385],['lib/google/src/Google/Service','Dns.php',434],['lib/mustache/src/Mustache','HelperCollection.php',81],['lib/htmlpurifier/HTMLPurifier/DefinitionCache/Decorator','Cleanup.php',68],['lib/google/src/Google/Service','Replicapool.php',416],['lib/google/src/Google/Service','Replicapool.php',571],['lib/google/src/Google/Service','Resourceviews.php',350],['lib/google/src/Google/Service','Resourceviews.php',435],['lib','coursecatlib.php',215],['lib/google/src/Google/Cache','Apc.php',50],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Cache.php',163]], 21003],
'get_role_access': ['get_role_access', 'Gets the accessdata for role "sitewide" (system down to course) ', [['lib','accesslib.php',251]], 3],
'add_record_snapshot': ['add_record_snapshot', 'Add cached data that will be most probably used in event observers. ', [['lib/classes/event','base.php',757]], 262],
'cleanup_instances': ['cleanup_instances', 'Remove stale contexts that belonged to deleted instances. Ideally all code should cleanup contexts properly, unfortunately accidents happen... ', [['lib','accesslib.php',5924]], 7],
'role_unassign_all': ['role_unassign_all', 'Removes multiple role assignments, parameters may contain: \'roleid\', \'userid\', \'contextid\', \'component\', \'enrolid\'. ', [['lib','accesslib.php',1805]], 45],
'get_context_info_array': ['get_context_info_array', 'Returns context instance plus related course and cm instances ', [['lib','accesslib.php',1424]], 54],
'list': ['list', '', [['mod/data/preset/imagegallery','jstemplate.js',9]], 1891],
'role_get_names': ['role_get_names', 'Get all the localised role names for a context. ', [['lib','accesslib.php',4609]], 4],
'blocks_delete_all_for_context': ['blocks_delete_all_for_context', 'Delete all the blocks that belong to a particular context. ', [['lib','blocklib.php',2041]], 3],
'get_capability_docs_link': ['get_capability_docs_link', 'Return a link to moodle docs for a given capability name ', [['lib','accesslib.php',2850]], 5],
'__isset': ['__isset', '', [['lib/horde/framework/Horde/Imap/Client/Data','Envelope.php',170],['lib/zend/Zend/Rest/Client','Result.php',144],['course','lib.php',2970],['lib/pear/Net/GeoIP','Location.php',187],['lib/classes/event','base.php',859],['lib/horde/framework/Horde/Support','Stub.php',53],['lib','modinfolib.php',140],['lib','modinfolib.php',1193],['lib','modinfolib.php',2569],['lib/horde/framework/Horde/Imap/Client/Data','Namespace.php',115],['calendar','lib.php',2061],['lib/zend/Zend/Gdata/App','Base.php',515],['mod/lesson','locallib.php',2047],['lib/horde/framework/Horde','Variables.php',111],['lib/zend/Zend/Gdata/App','BaseMediaSource.php',149],['lib','accesslib.php',5254],['lib/horde/framework/Horde/Support','Array.php',128],['lib','adminlib.php',1102],['lib/google/src/Google','Model.php',272],['lib/simplepie/library/SimplePie','IRI.php',221],['lib/mustache/src/Mustache','HelperCollection.php',99],['lib','coursecatlib.php',158],['lib','coursecatlib.php',2819],['lib/horde/framework/Horde/Support','ObjectStub.php',57]], 2],
'user_has_role_assignment': ['user_has_role_assignment', 'Simple function returning a boolean true if user has roles in context or parent contexts, otherwise false. ', [['lib','accesslib.php',4464]], 5],
'build_paths': ['build_paths', 'Rebuild context paths and depths at context level. ', [['lib','accesslib.php',5737],['lib','accesslib.php',6315],['lib','accesslib.php',6503],['lib','accesslib.php',6713],['lib','accesslib.php',6939],['lib','accesslib.php',7196],['lib','accesslib.php',7416]], 3],
'create': ['create', 'Creates a new 2048 bit RSA key pair and returns a unique ID that can be used to reference this key pair when launching new instances. ', [['lib/zend/Zend/Service/Amazon/Ec2','Keypair.php',39],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',271],['repository/filesystem','lib.php',283],['lib/zend/Zend/Service/Amazon/Ec2','Securitygroups.php',39],['lib/google/src/Google/Service','Gmail.php',670],['lib/google/src/Google/Service','Gmail.php',827],['course','lib.php',2874],['lib/classes/event','base.php',139],['lib/google/src/Google/Service','Genomics.php',618],['lib/google/src/Google/Service','Genomics.php',717],['lib/google/src/Google/Service','Genomics.php',850],['lib/google/src/Google/Service','Genomics.php',1313],['lib','modinfolib.php',1747],['calendar','lib.php',2651],['lib/zend/Zend/Service/Amazon','Sqs.php',82],['lib','weblib.php',3048],['mod/lesson','locallib.php',1013],['mod/lesson','locallib.php',2166],['mod/lesson','locallib.php',3203],['lib/google/src/Google/Service','Fitness.php',340],['lib/google/src/Google/Service','TagManager.php',1034],['lib/google/src/Google/Service','TagManager.php',1124],['lib/google/src/Google/Service','TagManager.php',1217],['lib/google/src/Google/Service','TagManager.php',1310],['lib/google/src/Google/Service','TagManager.php',1403],['lib/google/src/Google/Service','TagManager.php',1497],['lib/google/src/Google/Service','TagManager.php',1591],['lib/google/src/Google/Service','TagManager.php',1742],['lib/simplepie/library/SimplePie','Cache.php',95],['lib/htmlpurifier/HTMLPurifier','Config.php',114],['lib/htmlpurifier/HTMLPurifier','Lexer.php',53],['lib/google/src/Google/Service','Container.php',314],['lib/adodb','adodb-xmlschema03.inc.php',170],['lib/adodb','adodb-xmlschema03.inc.php',514],['lib/adodb','adodb-xmlschema03.inc.php',779],['lib/adodb','adodb-xmlschema03.inc.php',930],['lib/adodb','adodb-xmlschema03.inc.php',1228],['repository','lib.php',206],['repository','lib.php',1960],['mod/quiz','attemptlib.php',100],['mod/quiz','attemptlib.php',555],['lib/google/src/Google/Service','Games.php',1648],['lib/google/src/Google/Service','Games.php',2012],['lib/google/src/Google/Service','MapsEngine.php',1676],['lib/google/src/Google/Service','MapsEngine.php',1976],['lib/google/src/Google/Service','MapsEngine.php',2252],['lib/google/src/Google/Service','MapsEngine.php',2329],['lib/google/src/Google/Service','MapsEngine.php',2897],['lib/adodb','adodb-xmlschema.inc.php',152],['lib/adodb','adodb-xmlschema.inc.php',473],['lib/adodb','adodb-xmlschema.inc.php',738],['lib/adodb','adodb-xmlschema.inc.php',884],['lib/adodb','adodb-xmlschema.inc.php',1129],['lib/horde/framework/Horde/Imap/Client/Interaction','Server.php',65],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',81],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',58],['lib/google/src/Google/Service','Pubsub.php',219],['lib/google/src/Google/Service','Pubsub.php',364],['lib/htmlpurifier/HTMLPurifier','ElementDef.php',135],['lib/simplepie/library/SimplePie','Registry.php',153],['lib','navigationlib.php',266],['lib/google/src/Google/Service','Dns.php',282],['lib/google/src/Google/Service','Dns.php',355],['lib','coursecatlib.php',328],['mod/quiz/classes','structure.php',65]], 3074],
'get_manager': ['get_manager', 'Returns the sql generator used for db manipulation. Used mostly in upgrade.php scripts. ', [['lib/dml','moodle_database.php',1030]], 273],
'is_enrolled': ['is_enrolled', 'Returns true if user is enrolled (is participating) in course this is intended for students and teachers. ', [['lib','accesslib.php',2037]], 143],
'delete_ratings': ['delete_ratings', 'Delete one or more ratings. Specify either a rating id, an item id or just the context id. ', [['rating','lib.php',381]], 16],
'reset_caches': ['reset_caches', 'Reset any caches ', [['lib/classes/update','checker.php',74],['lib/dml','moodle_database.php',1019],['lib/classes','string_manager_standard.php',594],['lib/classes','text.php',108],['lib/classes','string_manager.php',127],['repository','lib.php',2686],['lib','accesslib.php',5098],['lib','accesslib.php',5994],['lib/classes','string_manager_install.php',245],['lib/classes','filetypes.php',419],['mod/glossary/classes/local','concept_cache.php',49],['lib/classes','plugin_manager.php',95],['lib','filterlib.php',93],['lib/classes/update','deployer.php',66]], 101],
'sort_by_roleassignment_authority': ['sort_by_roleassignment_authority', 'Re-sort a users array based on a sorting policy ', [['lib','accesslib.php',3987]], 5],
'get_default_role_archetype_allows': ['get_default_role_archetype_allows', 'Return default roles that can be assigned, overridden or switched by give role archetype. ', [['lib','accesslib.php',2579]], 14],
'get_archetype_roles': ['get_archetype_roles', 'Returns roles of a specified archetype ', [['lib','accesslib.php',3231]], 21],
'get_user_roles_in_course': ['get_user_roles_in_course', 'This function is used to print roles column in user profile page. It is using the CFG->profileroles to limit the list to only interesting roles. (The permission tab has full details of user role assignments.) ', [['lib','accesslib.php',3114]], 4],
'reload_all_capabilities': ['reload_all_capabilities', 'A convenience function to completely reload all the capabilities for the current user when roles have been updated in a relevant context -- but PRESERVING switchroles and loginas. This function resets all accesslib and context caches. ', [['lib','accesslib.php',1230]], 7],
'isguestuser': ['isguestuser', 'Determines if a user is logged in as real guest user with username \'guest\'. ', [['lib','accesslib.php',1922]], 237],
'is_siteadmin': ['is_siteadmin', 'Check if the user is an admin at the site level. ', [['lib','accesslib.php',604]], 92],
'preload_from_record': ['preload_from_record', 'Preloads context information from db record and strips the cached info. ', [['lib','accesslib.php',5199],['lib','accesslib.php',6028]], 57],
'__construct': ['__construct', 'Constructor ', [['lib/jabber/XMPP','Log.php',67],['lib/zend/Zend/Gdata/Books','VolumeFeed.php',41],['lib/markdown','MarkdownExtra.php',51],['lib/zend/Zend/Gdata/Books/Extension','BooksCategory.php',42],['lib/horde/framework/Horde/Support','Uuid.php',23],['lib/zend/Zend/Validate','Iban.php',106],['repository/wikimedia','wikimedia.php',35],['lib/lessphp/Tree','Operation.php',19],['lib/alfresco/Service','Version.php',38],['lib/filestorage','file_exceptions.php',36],['lib/filestorage','file_exceptions.php',57],['lib/filestorage','file_exceptions.php',89],['lib/filestorage','file_exceptions.php',108],['lib/filestorage','file_exceptions.php',129],['backup/moodle2','backup_activity_task.class.php',45],['lib/htmlpurifier/HTMLPurifier','AttrCollections.php',16],['lib/phpunit/classes','database_driver_testcase.php',55],['lib/google/src/Google/Service','Reseller.php',44],['lib/horde/framework/Horde/Imap/Client/Interaction/Command','Continuation.php',42],['lib/phpunit/classes','advanced_testcase.php',45],['lib/zend/Zend/Service/DeveloperGarden/Request','RequestAbstract.php',40],['lib','outputlib.php',447],['lib','outputlib.php',2000],['repository/filesystem','lib.php',48],['lib/zend/Zend/XmlRpc/Value','Nil.php',40],['lib/lessphp/Tree','NameValue.php',21],['lib/zend/Zend/Gdata/YouTube','UserProfileEntry.php',283],['lib/zend/Zend/Gdata/Gapps','EmailListRecipientEntry.php',69],['lib/simplepie/library/SimplePie','Restriction.php',81],['lib/filebrowser','file_info_context_course.php',39],['lib/filebrowser','file_info_context_course.php',492],['lib/filebrowser','file_info_context_course.php',596],['lib/filebrowser','file_info_context_course.php',745],['lib/minify/lib/MrClay/Cli','Arg.php',82],['lib/horde/framework/Horde/Crypt/Blowfish','Mcrypt.php',47],['lib/classes/update','checker.php',50],['lib/adodb','adodb-active-recordx.inc.php',131],['lib/phpexcel/PHPExcel','Calculation.php',1721],['lib/zend/Zend/Gdata/Photos/Extension','NumPhotos.php',50],['availability/classes','info_module.php',40],['lib/zend/Zend/Gdata/Geo/Extension','GmlPos.php',49],['lib/zend/Zend/Gdata/App/Extension','Link.php',49],['lib/zend/Zend/Gdata/Photos/Extension','Access.php',51],['lib/zend/Zend/Server/Reflection','Parameter.php',58],['lib/zend/Zend/Service/DeveloperGarden/Client','ClientAbstract.php',129],['lib/horde/framework/Horde/Imap/Client','DateTime.php',29],['lib/zend/Zend/Validate/Db','Abstract.php',79],['cache/locks/file','lib.php',66],['lib/phpexcel/PHPExcel/CachedObjectStorage','PHPTemp.php',180],['question/type/missingtype','edit_missingtype_form.php',38],['auth/cas/CAS/CAS','Client.php',862],['lib/horde/framework/Horde/Imap/Client/Data','Envelope.php',46],['lib/zend/Zend/Gdata/Books','VolumeQuery.php',46],['lib/minify/lib/Minify/Cache','XCache.php',22],['lib/zend/Zend/XmlRpc','Request.php',92],['lib/zend/Zend/Service/Delicious','Post.php',74],['lib/zend/Zend/Gdata/Extension','FeedLink.php',53],['lib/zend/Zend/Http/Client/Adapter','Socket.php',97],['lib/grade','grade_object.php',80],['lib/zend/Zend/Gdata/YouTube','ContactFeed.php',55],['backup/util/plan','base_plan.class.php',39],['backup/util/plan','base_plan.class.php',215],['mod/lti/service/toolsettings/classes/local/resource','systemsettings.php',43],['lib/google/src/Google/Auth','LoginTicket.php',35],['lib/phpexcel/PHPExcel/Reader/Excel5','Escher.php',84],['lib/zend/Zend/Service/DeveloperGarden/SecurityTokenServer','Cache.php',59],['question/type/randomsamatch','question.php',114],['lib/zend/Zend/Service/WindowsAzure/Storage','SignedIdentifier.php',49],['lib/zend/Zend/Amf/Parse','OutputStream.php',40],['blocks','moodleblock.class.php',111],['lib/simplepie','autoloader.php',62],['mod/scorm','renderer.php',129],['lib/zend/Zend/Gdata/Extension','Who.php',64],['lib/zend/Zend/Gdata/Gapps','EmailListQuery.php',54],['lib/zend/Zend/Service/Simpy','LinkSet.php',47],['repository/flickr_public','lib.php',49],['lib/horde/framework/Horde/Imap/Client/Base','Debug.php',55],['lib/google/src/Google/Service','Replicapoolupdater.php',47],['admin/tool/generator/classes','site_backend.php',58],['mod/assign','assignmentplugin.php',50],['mod/lti/service/toolsettings/classes/local/resource','linksettings.php',45],['mod/lti/service/profile/classes/local/resource','profile.php',43],['lib/htmlpurifier/HTMLPurifier/AttrDef','Integer.php',36],['lib/horde/framework/Horde/Mail/Transport','Smtpmx.php',138],['backup/util/structure','base_optigroup.class.php',35],['backup/util/structure','base_optigroup.class.php',169],['lib/lessphp/Tree','Anonymous.php',21],['user','renderer.php',186],['lib/zend/Zend/Service/WindowsAzure','Storage.php',170],['lib/google/src/Google','Service.php',26],['lib/lessphp/Tree','Url.php',17],['webservice','lib.php',745],['webservice','lib.php',841],['webservice','lib.php',1120],['lib/phpexcel/PHPExcel/Worksheet/AutoFilter/Column','Rule.php',270],['lib/zend/Zend/Gdata/YouTube/Extension','MediaContent.php',55],['lib/horde/framework/Horde/Support','Randomid.php',26],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','DenyElementDecorator.php',21],['lib/tests','completionlib_test.php',863],['lib/zend/Zend/Service/Amazon','Accessories.php',44],['lib/zend/Zend/Validate/Barcode','Code39ext.php',47],['mod/assign/feedback/editpdf/classes','comment.php',58],['lib/phpexcel/PHPExcel/Writer/PDF','mPDF.php',46],['backup/moodle2','backup_settingslib.php',42],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','GetConferenceTemplateListRequest.php',46],['lib/zend/Zend/XmlRpc/Value','Base64.php',40],['backup/util/structure','backup_structure_processor.class.php',45],['backup/util/structure','backup_structure_processor.class.php',133],['lib/zend/Zend/Service/WindowsAzure/Storage','Blob.php',117],['lib/lessphp','Parser.php',75],['lib/zend/Zend/Service/DeveloperGarden/Response/IpLocation','LocateIPResponse.php',47],['lib/zend/Zend/Gdata','Query.php',72],['lib/zend/Zend/Service/Technorati','TagResultSet.php',57],['lib/zend/Zend/Rest/Client','Result.php',42],['lib/lessphp/Tree','Call.php',19],['lib/zend/Zend/Server/Method','Callback.php',59],['lib/minify/lib/Minify/JS','ClosureCompiler.php',38],['mod/workshop/backup/moodle1','lib.php',308],['lib/zend/Zend/Gdata/YouTube','ActivityFeed.php',54],['admin/tool/log/store/database/classes/log','store.php',47],['lib/zend/Zend/Validate','Alpha.php',65],['lib/zend/Zend/Gdata','Gapps.php',109],['lib/zend/Zend/Service/Flickr','Result.php',174],['question/type/multianswer','edit_multianswer_form.php',58],['mod/assign/feedback/file','renderable.php',44],['lib/horde/framework/Horde','Secret.php',48],['lib/zend/Zend/Gdata/Photos/Extension','AlbumId.php',51],['lib/lessphp/SourceMap','Base64VLQ.php',67],['lib/lessphp/Tree/Mixin','Call.php',14],['auth/cas/CAS/CAS','GracefullTerminationException.php',48],['lib/google/src/Google/Service','Fusiontables.php',48],['grade/report/singleview','lib.php',69],['lib/classes/lock','lock.php',55],['grade/grading/form','lib.php',82],['grade/grading/form','lib.php',766],['blog','locallib.php',71],['blog','locallib.php',581],['blog','locallib.php',849],['blog','locallib.php',894],['blog','locallib.php',953],['blog','locallib.php',1004],['blog','locallib.php',1028],['blog','locallib.php',1038],['blog','locallib.php',1050],['blog','locallib.php',1071],['lib/zend/Zend/Gdata/Exif/Extension','Flash.php',49],['backup/cc/cc_lib','cc_general.php',38],['lib/phpexcel/PHPExcel/Shared/JAMA','Matrix.php',61],['admin/webservice','lib.php',38],['lib/zend/Zend/Validate/File','FilesSize.php',60],['lib/phpexcel/PHPExcel/Writer/PDF','DomPDF.php',46],['lib/horde/framework/Horde/Imap/Client/Data/Format','Nstring.php',27],['repository/boxnet','lib.php',56],['lib/htmlpurifier/HTMLPurifier','Language.php',63],['lib/zend/Zend/Validate','Int.php',53],['lib/horde/framework/Horde/Mail/Transport','Smtphorde.php',62],['lib/zend/Zend/Soap','Server.php',146],['lib/zend/Zend/Gdata/Photos','PhotoEntry.php',215],['lib/zend/Zend/Service/Yahoo','LocalResult.php',111],['lib/zend/Zend/Service/DeveloperGarden/Request/BaseUserService','GetAccountBalance.php',40],['badges/lib','backpacklib.php',40],['lib/zend/Zend/Service/Yahoo','Result.php',77],['lib/form','filemanager.php',306],['lib/lessphp/Tree','Condition.php',18],['lib/pear/PEAR','Exception.php',107],['lib/zend/Zend/Gdata/YouTube/Extension','Racy.php',45],['question/classes/bank','view.php',70],['lib/adodb','adodb.inc.php',2790],['lib/adodb','adodb.inc.php',2865],['lib/zend/Zend/Gdata/App/Extension','Text.php',45],['question/engine/upgrade/tests','helper.php',45],['lib/zend/Zend/Validate/Barcode','Ean5.php',47],['blocks/private_files','renderer.php',83],['backup/util/settings/section','section_backup_setting.class.php',25],['lib/classes','useragent.php',115],['lib/zend/Zend/Gdata/Photos/Extension','CommentCount.php',51],['lib/horde/framework/Horde/Imap/Client/Data/Format','String.php',38],['lib/zend/Zend/Gdata/Spreadsheets/Extension','ColCount.php',49],['lib/horde/framework/Horde/Translation/Handler','Gettext.php',34],['lib/portfolio','exceptions.php',50],['lib/zend/Zend/Gdata/Calendar/Extension','QuickAdd.php',45],['lib/xmldb','xmldb_object.php',55],['lib/zend/Zend/Service','SlideShare.php',283],['webservice/amf','introspector.php',52],['question/behaviour/adaptive','behaviour.php',310],['question/behaviour','behaviourtypebase.php',133],['admin/tool/assignmentupgrade','upgradableassignmentstable.php',49],['course','renderer.php',52],['lib/zend/Zend/Validate','Hostname.php',315],['lib/phpexcel/PHPExcel/CachedObjectStorage','Memcache.php',249],['lib/zend/Zend/Amf','Server.php',134],['enrol/imsenterprise','locallib.php',38],['enrol/imsenterprise','locallib.php',115],['lib/zend/Zend/Http','Cookie.php',98],['lib/lessphp/Tree','Extend.php',28],['lib/zend/Zend/Validate','Barcode.php',75],['lib/zend/Zend/XmlRpc/Value','BigInteger.php',47],['lib/google/src/Google/Service','DoubleClickBidManager.php',40],['lib/google/src/Google/Service','QPXExpress.php',39],['lib/zend/Zend/Server/Reflection/Function','Abstract.php',105],['lib/phpexcel/PHPExcel/Style','Color.php',72],['lib/zend/Zend/Validate/File','Hash.php',60],['backup/util/settings/root','root_backup_setting.class.php',34],['backup/cc/cc_lib','cc_converter_basiclti.php',29],['lib/zend/Zend/Gdata/Photos/Extension','QuotaCurrent.php',50],['lib/zend/Zend/Service/Nirvanix/Namespace','Base.php',76],['lib/horde/framework/Horde/Imap/Client/Fetch','Results.php',54],['lib/zend/Zend/Service/Technorati','DailyCountsResult.php',60],['lib/zend/Zend/Rest','Server.php',102],['lib/zend/Zend/Gdata/Photos','UserFeed.php',106],['lib/tcpdf/include/barcodes','pdf417.php',523],['lib/minify/lib/Minify/CSS','Compressor.php',51],['lib/zend/Zend/Gdata/YouTube/Extension','VideoId.php',44],['lib/google/src/Google/Service','Blogger.php',50],['mod/workshop/allocation/random','lib.php',52],['mod/workshop/allocation/random','lib.php',727],['lib/zend/Zend/Gdata/App/Extension','Published.php',43],['lib/google/src/Google/Service','Doubleclicksearch.php',43],['lib/htmlpurifier/HTMLPurifier/AttrTransform','Nofollow.php',16],['lib/phpexcel/PHPExcel/Shared/trend','powerBestFitClass.php',129],['lib/zend/Zend/Gdata/Photos','AlbumEntry.php',193],['lib/zend/Zend/Gdata/Docs','DocumentListFeed.php',56],['lib/zend/Zend/Gdata/App/Extension','Icon.php',43],['lib/portfolio','plugin.php',445],['lib/zend/Zend/Gdata/Extension','OpenSearchItemsPerPage.php',44],['lib/horde/framework/Horde/Exception','LastError.php',16],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','ID.php',28],['lib/zend/Zend/Service/Yahoo','WebResult.php',83],['lib/horde/framework/Horde/Imap/Client/Interaction','Client.php',34],['lib/google/src/Google/Service','AdExchangeBuyer.php',46],['lib/dtl','file_xml_database_exporter.php',36],['backup/cc','validator.php',30],['backup/cc','validator.php',116],['backup/cc','validator.php',202],['backup/cc','validator.php',230],['backup/cc','validator.php',236],['backup/cc','validator.php',242],['backup/cc','validator.php',248],['backup/cc','validator.php',254],['backup/cc','validator.php',260],['lib/zend/Zend/Gdata/YouTube/Extension','Token.php',44],['lib/phpexcel/PHPExcel/Worksheet','HeaderFooterDrawing.php',87],['lib/phpexcel/PHPExcel/Writer/PDF','tcPDF.php',47],['lib/xmldb','xmldb_field.php',84],['lib/phpexcel/PHPExcel/Writer','Excel2007.php',126],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','GetConferenceStatusRequest.php',65],['lib/google/src/Google/Service','Manager.php',57],['lib/zend/Zend/Service/Amazon','Offer.php',79],['lib/horde/framework/Horde/Imap/Client/Data/Format','Mailbox.php',35],['lib/zend/Zend/Gdata/App','FeedEntryParent.php',129],['lib/zend/Zend/Service/Technorati','KeyInfoResult.php',61],['lib/htmlpurifier/HTMLPurifier/TagTransform','Simple.php',19],['webservice/rest','lib.php',47],['lib/zend/Zend/Service/StrikeIron','Decorator.php',47],['lib/google/src/Google/Http','Batch.php',38],['lib/google/src/Google/Service','Reports.php',47],['auth/cas/CAS/CAS','OutOfSequenceBeforeAuthenticationCallException.php',47],['lib/zend/Zend/Gdata/Media/Extension','MediaKeywords.php',43],['repository/url','lib.php',46],['lib','xmlize.php',31],['mod/forum/classes','potential_subscriber_selector.php',47],['lib/filebrowser','file_info_context_system.php',37],['lib/zend/Zend/Service/Amazon','Abstract.php',74],['lib/zend/Zend/Server','Definition.php',43],['lib/minify/lib/Minify','ImportProcessor.php',48],['lib/zend/Zend/Amf/Util','BinaryStream.php',53],['lib/portfolio','exporter.php',113],['backup/cc/cc_lib','cc_converter_page.php',28],['lib/zend/Zend/Gdata/YouTube','SubscriptionFeed.php',55],['lib/alfresco/Service','SpacesStore.php',28],['repository/recent','lib.php',39],['lib/zend/Zend/Service/DeveloperGarden/IpLocation','IpAddress.php',59],['lib/zend/Zend/Validate','Regex.php',62],['lib/phpexcel/PHPExcel/Shared/trend','exponentialBestFitClass.php',135],['lib/phpexcel/PHPExcel','ReferenceHelper.php',65],['lib','webdavlib.php',84],['lib/htmlpurifier/HTMLPurifier/AttrTransform','TargetBlank.php',17],['auth/cas/CAS/CAS','AuthenticationException.php',53],['lib/zend/Zend/Gdata/Gapps','NicknameQuery.php',54],['lib/bennu','iCalendar_properties.php',28],['lib/bennu','iCalendar_properties.php',220],['lib/bennu','iCalendar_properties.php',238],['lib/bennu','iCalendar_properties.php',259],['lib/bennu','iCalendar_properties.php',275],['lib/bennu','iCalendar_properties.php',296],['lib/bennu','iCalendar_properties.php',343],['lib/bennu','iCalendar_properties.php',358],['lib/bennu','iCalendar_properties.php',376],['lib/bennu','iCalendar_properties.php',391],['lib/bennu','iCalendar_properties.php',406],['lib/bennu','iCalendar_properties.php',447],['lib/bennu','iCalendar_properties.php',462],['lib/bennu','iCalendar_properties.php',485],['lib/bennu','iCalendar_properties.php',509],['lib/bennu','iCalendar_properties.php',524],['lib/bennu','iCalendar_properties.php',555],['lib/bennu','iCalendar_properties.php',573],['lib/bennu','iCalendar_properties.php',594],['lib/bennu','iCalendar_properties.php',637],['lib/bennu','iCalendar_properties.php',680],['lib/bennu','iCalendar_properties.php',724],['lib/bennu','iCalendar_properties.php',747],['lib/bennu','iCalendar_properties.php',782],['lib/bennu','iCalendar_properties.php',808],['lib/bennu','iCalendar_properties.php',849],['lib/bennu','iCalendar_properties.php',864],['lib/bennu','iCalendar_properties.php',905],['lib/bennu','iCalendar_properties.php',938],['lib/bennu','iCalendar_properties.php',952],['lib/bennu','iCalendar_properties.php',965],['lib/bennu','iCalendar_properties.php',987],['lib/bennu','iCalendar_properties.php',1017],['lib/bennu','iCalendar_properties.php',1031],['lib/bennu','iCalendar_properties.php',1061],['lib/bennu','iCalendar_properties.php',1075],['lib/bennu','iCalendar_properties.php',1098],['lib/bennu','iCalendar_properties.php',1110],['lib/bennu','iCalendar_properties.php',1139],['lib/bennu','iCalendar_properties.php',1160],['lib/bennu','iCalendar_properties.php',1181],['lib/bennu','iCalendar_properties.php',1203],['lib/bennu','iCalendar_properties.php',1227],['lib/bennu','iCalendar_properties.php',1260],['lib/bennu','iCalendar_properties.php',1386],['lib/bennu','iCalendar_properties.php',1407],['lib/bennu','iCalendar_properties.php',1429],['lib/bennu','iCalendar_properties.php',1450],['lib/phpexcel/PHPExcel/Calculation','ExceptionHandler.php',36],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Mongo.php',78],['lib/horde/framework/Horde','Domhtml.php',53],['auth/cas/CAS/CAS','OutOfSequenceBeforeProxyException.php',48],['lib/simplepie/library/SimplePie/Parse','Date.php',536],['lib/google/src/Google/Service','Customsearch.php',38],['lib/zend/Zend/Gdata/App','MediaFileSource.php',54],['backup/util/plan','restore_step.class.php',32],['backup/util/plan','restore_step.class.php',104],['lib/lessphp/Tree','Comment.php',17],['availability/tests/fixtures','mock_info.php',40],['lib/htmlpurifier/HTMLPurifier/AttrTransform','EnumToCSS.php',34],['backup/util/ui','base_ui.class.php',84],['lib/phpexcel/PHPExcel','DocumentSecurity.php',73],['lib/htmlpurifier/HTMLPurifier/AttrDef/URI','Host.php',15],['backup/cc/cc_lib','cc_converter_lti.php',29],['lib/zend/Zend/Gdata/YouTube/Extension','Position.php',44],['lib/zend/Zend/Service/WindowsAzure/Credentials','CredentialsAbstract.php',77],['lib/zend/Zend/Soap','AutoDiscover.php',94],['lib/htmlpurifier/HTMLPurifier','URI.php',58],['lib/phpexcel/PHPExcel','IOFactory.php',77],['lib/zend/Zend/Gdata/App/Extension','Email.php',43],['lib/zend/Zend/Gdata/Media/Extension','MediaHash.php',45],['lib/zend/Zend/Gdata/App/Extension','Element.php',42],['lib/google/src/Google/Service','Gmail.php',55],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Multiple.php',33],['repository/dropbox','lib.php',49],['lib/minify/lib/Minify','Source.php',43],['backup/util/dbops','backup_dbops.class.php',37],['lib/google/src/Google/Service','Plus.php',52],['lib/horde/framework/Horde/Imap/Client/Data/Format','List.php',28],['lib/google/src/Google/Service','Spectrum.php',38],['files','renderer.php',1080],['lib/zend/Zend/Validate/Barcode','Ean2.php',47],['course','lib.php',2932],['lib/horde/framework/Horde/Support','ConsistentHash.php',56],['lib/zend/Zend/Service/Simpy','Watchlist.php',89],['lib/phpexcel/PHPExcel','Style.php',101],['lib/zend/Zend/Gdata/YouTube/Extension','CountHint.php',44],['lib/minify/lib/Minify/Cache','Memcache.php',22],['auth/db','auth.php',36],['lib/zend/Zend/Gdata/Gapps','UserQuery.php',54],['admin/roles/classes','assign_user_selector_base.php',40],['lib/zend/Zend/Gdata/Exif/Extension','Model.php',49],['lib/zend/Zend/Gdata/YouTube','PlaylistListFeed.php',55],['lib/zend/Zend/Gdata/Docs','DocumentListEntry.php',42],['mod/quiz/tests','repaginate_test.php',39],['question/engine','questionusage.php',78],['question/engine','questionusage.php',973],['lib/simplepie/library/SimplePie/Cache','MySQL.php',80],['lib/zend/Zend/Service/Twitter','Search.php',70],['lib/zend/Zend/Server/Method','Parameter.php',59],['lib/phpunit/classes','basic_testcase.php',39],['lib/zend/Zend/Service/WindowsAzure/Storage','BlobContainer.php',50],['lib/zend/Zend/Service/DeveloperGarden/Response/LocalSearch','LocalSearchResponse.php',50],['lib/horde/framework/Horde/Imap/Client','Ids.php',78],['mod/wiki/parser/markups','html.php',18],['lib/google/src/Google/Service','Mirror.php',49],['lib/classes/event','base.php',114],['lib/alfresco/Service','Repository.php',36],['lib/zend/Zend/Service/Technorati','CosmosResult.php',84],['backup/moodle2','backup_xml_transformer.class.php',50],['lib/phpexcel/PHPExcel/Reader/Excel5','RC4.php',42],['lib/zend/Zend/Service/Yahoo','PageDataResult.php',47],['lib/zend/Zend/Service/WindowsAzure/Storage','Table.php',99],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','UpdateConferenceTemplateRequest.php',60],['lib/phpexcel/PHPExcel/Shared/JAMA','EigenvalueDecomposition.php',775],['lib/tcpdf','tcpdf_parser.php',92],['lib/minify/lib/Minify/Cache','APC.php',19],['lib/zend/Zend/Gdata','MimeBodyString.php',49],['lib/phpexcel/PHPExcel/Reader','OOCalc.php',55],['lib/phpexcel/PHPExcel/Calculation','FormulaParser.php',92],['lib/google/src/Google/Http','MediaFileUpload.php',73],['lib/zend/Zend/XmlRpc/Client','ServerProxy.php',54],['lib','listlib.php',82],['lib','listlib.php',485],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Background.php',20],['lib/zend/Zend/Gdata/Health','ProfileFeed.php',49],['lib/google/src/Google/Service','Genomics.php',60],['lib/google/src/Google/Service','Urlshortener.php',40],['lib/zend/Zend/Server/Reflection','Method.php',51],['lib/tests','medialib_test.php',631],['lib/htmlpurifier/HTMLPurifier/ChildDef','Required.php',23],['lib/zend/Zend/Soap/Client','DotNet.php',43],['admin/roles/classes','allow_role_page.php',37],['backup/util/dbops','restore_dbops.class.php',1755],['lib/zend/Zend/Service/Yahoo','NewsResult.php',97],['backup/util/plan','restore_task.class.php',32],['backup/util/plan','restore_task.class.php',121],['webservice/rest','locallib.php',40],['lib/simplepie/library/SimplePie','Sanitize.php',75],['lib','uploadlib.php',40],['lib/zend/Zend/Gdata','Health.php',109],['lib','questionlib.php',1269],['lib','questionlib.php',1513],['lib/dml','oci_native_moodle_recordset.php',34],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','RemoveParticipantRequest.php',53],['lib/zend/Zend/XmlRpc/Value','String.php',38],['lib/zend/Zend/Gdata/Calendar/Extension','AccessLevel.php',45],['lib/ddl','database_manager.php',48],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','CreateConferenceTemplateRequest.php',60],['backup/util/xml/parser','progressive_parser.class.php',79],['backup/util/xml/parser','progressive_parser.class.php',305],['backup/util/settings','base_setting.class.php',89],['backup/util/settings','base_setting.class.php',556],['lib/dtl','database_exporter.php',55],['mod/workshop/form/accumulative','lib.php',99],['lib/htmlpurifier/HTMLPurifier','HTMLDefinition.php',182],['grade/report/singleview/classes/local/ui','bulk_insert.php',40],['lib/zend/Zend/Validate','Float.php',53],['lib/zend/Zend/Gdata/Gapps/Extension','EmailList.php',59],['cache/classes','interfaces.php',473],['lib/zend/Zend/Gdata/App/Extension','Edited.php',43],['lib/zend/Zend/Gdata/Gapps','UserEntry.php',103],['lib/lessphp/Tree','Element.php',19],['lib','moodlelib.php',9143],['lib','moodlelib.php',9354],['repository/picasa','lib.php',41],['webservice/soap','lib.php',42],['lib/zend/Zend/Gdata/Calendar','EventEntry.php',71],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Border.php',18],['lib/phpexcel/PHPExcel/Shared/trend','linearBestFitClass.php',98],['backup/cc/cc_lib','cc_assesment_essay.php',25],['lib/zend/Zend/Service/WindowsAzure/RetryPolicy','RetryN.php',56],['lib/dml','moodle_temptables.php',51],['lib/zend/Zend/Gdata/Media/Extension','MediaContent.php',116],['lib/zend/Zend/Gdata/Gapps','EmailListEntry.php',80],['admin/roles/classes','allow_assign_page.php',31],['lib/zend/Zend/Gdata','Books.php',80],['lib/zend/Zend/Amf/Value','MessageHeader.php',64],['lib/zend/Zend/Validate','GreaterThan.php',59],['lib/zend/Zend/Gdata/YouTube/Extension','PlaylistId.php',44],['calendar/classes','rrule_manager.php',182],['lib/phpexcel/PHPExcel/Worksheet','Drawing.php',45],['lib/zend/Zend/Service/ReCaptcha','Response.php',53],['lib/simplepie/library/SimplePie/HTTP','Parser.php',131],['lib/phpexcel/PHPExcel/Style','NumberFormat.php',106],['lib/zend/Zend/Amf/Value/Messaging','RemotingMessage.php',58],['lib/tcpdf','tcpdf.php',1822],['lib/zend/Zend/Gdata/YouTube/Extension','Username.php',44],['lib/zend/Zend/Gdata/Photos/Extension','Version.php',51],['lib/htmlpurifier/HTMLPurifier/AttrTransform','Input.php',14],['lib/zend/Zend/Service/WindowsAzure/Storage','Batch.php',77],['lib/mustache/src/Mustache','Engine.php',61],['lib/xmldb','xmldb_structure.php',40],['lib/zend/Zend/Gdata/Photos','TagEntry.php',61],['webservice/amf','locallib.php',41],['webservice/amf','locallib.php',60],['lib/htmlpurifier/HTMLPurifier/ChildDef','Chameleon.php',36],['lib/horde/framework/Horde/Imap/Client','Base.php',153],['question/type/numerical/tests','form_test.php',40],['lib/google/src/Google/Service','IdentityToolkit.php',38],['comment','locallib.php',39],['lib/zend/Zend/Gdata/Extension','Comments.php',50],['lib/google/src/Google/Service','Resource.php',60],['lib/horde/framework/Horde/Imap/Client/Socket','Catenate.php',37],['lib/zend/Zend/Gdata/YouTube/Extension','Recorded.php',44],['lib/zend/Zend/Amf/Request','Http.php',46],['backup/util/settings','setting_dependency.class.php',68],['backup/util/settings','setting_dependency.class.php',175],['backup/util/settings','setting_dependency.class.php',328],['backup/util/settings','setting_dependency.class.php',439],['backup/util/settings','setting_dependency.class.php',465],['backup/util/settings','setting_dependency.class.php',491],['backup/util/settings','setting_dependency.class.php',556],['question/engine/upgrade','behaviourconverters.php',78],['lib/zend/Zend/Service/DeveloperGarden/ConferenceCall','ParticipantDetail.php',62],['repository/s3','lib.php',39],['lib/minify/lib/MrClay','Cli.php',74],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','AlphaValue.php',6],['lib/horde/framework/Horde/Imap/Client','Tokenize.php',67],['lib/zend/Zend/Gdata/App','HttpException.php',51],['lib/zend/Zend/Soap/Client','Common.php',40],['lib/google/src/Google/Service','Dfareporting.php',45],['lib/lessphp/Output','Mapped.php',39],['lib/classes/output','notification.php',66],['lib/google/src/Google/Service','PlusDomains.php',72],['backup/util/plan','base_task.class.php',40],['backup/util/plan','base_task.class.php',277],['lib/editor/tinymce','adminlib.php',36],['lib/zend/Zend/Service/Amazon/Ec2','Exception.php',41],['lib/phpexcel/PHPExcel/Cell','Hyperlink.php',52],['lib/simplepie/library/SimplePie','Locator.php',68],['lib/phpexcel/PHPExcel/Chart/Renderer','jpgraph.php',846],['lib/xmldb','xmldb_key.php',43],['user/filters','checkbox.php',51],['lib/phpexcel/PHPExcel/Reader','SYLK.php',75],['question/type/numerical','questiontype.php',507],['backup/cc/cc_lib','cc_converter_url.php',29],['lib/zend/Zend/Gdata/App/Extension','Control.php',50],['lib/minify/lib','FirePHP.php',189],['lib/lessphp/Tree/Mixin','Definition.php',18],['lib/zend/Zend/Service/Yahoo','LocalResultSet.php',61],['lib','ddllib.php',80],['lib','ddllib.php',93],['lib','ddllib.php',107],['lib','ddllib.php',126],['lib','ddllib.php',140],['admin/tool/langimport/classes','controller.php',48],['lib/google/src/Google/Auth','AssertionCredentials.php',53],['lib/horde/framework/Horde/Stream','String.php',27],['lib','excellib.class.php',47],['lib','excellib.class.php',155],['lib','excellib.class.php',454],['lib/horde/framework/Horde/Stream','Temp.php',25],['lib/alfresco/Service','VersionHistory.php',34],['lib/zend/Zend/Service/DeveloperGarden/ConferenceCall','ConferenceSchedule.php',81],['mod/quiz/classes','repaginate.php',49],['lib/zend/Zend/Validate','Isbn.php',65],['lib/zend/Zend/Service/Amazon','Image.php',55],['backup/util/ui','restore_ui_components.php',81],['backup/util/ui','restore_ui_components.php',287],['backup/util/ui','restore_ui_components.php',382],['lib/classes/lock','db_record_lock_factory.php',61],['lib/horde/framework/Horde/Stream','TempString.php',40],['lib/htmlpurifier/HTMLPurifier/ConfigSchema','InterchangeBuilder.php',15],['lib/htmlpurifier/HTMLPurifier/ChildDef','Empty.php',22],['lib/zend/Zend/Gdata/Spreadsheets/Extension','Cell.php',76],['question/type/calculated','question.php',188],['question/type/calculated','question.php',303],['lib/horde/framework/Horde/Text','Flowed.php',75],['lib/horde/framework/Horde/Imap/Client/Data/Format','Date.php',25],['lib/zend/Zend/Gdata/Gapps/Extension','Login.php',111],['mod/workshop/form/rubric','lib.php',105],['cohort','locallib.php',37],['cohort','locallib.php',101],['lib/zend/Zend/XmlRpc/Value','DateTime.php',53],['lib/zend/Zend/Service/WindowsAzure/Storage','QueueMessage.php',52],['lib/htmlpurifier/HTMLPurifier','Queue.php',24],['lib/zend/Zend/Amf/Parse','Serializer.php',40],['lib/google/src/Google/Service','GroupsMigration.php',38],['lib/phpexcel/PHPExcel/Worksheet','PageSetup.php',277],['lib/zend/Zend/Gdata/Gapps','ServiceException.php',61],['lib/htmlpurifier/HTMLPurifier','AttrTypes.php',14],['lib/zend/Zend/XmlRpc','Fault.php',100],['lib/zend/Zend/Gdata','Photos.php',124],['question/type/calculated','datasetdefinitions_form.php',53],['lib/phpexcel/PHPExcel/Reader','Excel5.php',424],['question/type/shortanswer','question.php',43],['backup/util/structure','base_final_element.class.php',38],['backup/util/structure','base_final_element.class.php',239],['backup/util/structure','base_final_element.class.php',256],['lib/zend/Zend/Service','LiveDocx.php',67],['backup/util/plan','backup_plan.class.php',36],['backup/util/plan','backup_plan.class.php',130],['lib/google/src/Google/Auth','AppIdentity.php',38],['lib/zend/Zend/Gdata/Exif/Extension','FocalLength.php',49],['lib/zend/Zend/Gdata/App/Extension','Id.php',43],['lib/zend/Zend/Gdata/Books/Extension','PreviewLink.php',42],['mod/chat','locallib.php',179],['mod/chat','locallib.php',227],['lib/google/src/Google/Service','Licensing.php',38],['auth/cas/CAS/CAS/PGTStorage','File.php',105],['lib/zend/Zend/Server/Method','Definition.php',64],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','GetParticipantStatusRequest.php',53],['question/classes/bank','column_base.php',44],['lib/zend/Zend/XmlRpc/Server','Fault.php',67],['lib/zend/Zend/Amf/Value/Messaging','AcknowledgeMessage.php',40],['grade/report/singleview/classes/local/ui','range.php',38],['lib/zend/Zend/Gdata/Books/Extension','Viewability.php',45],['mod/book','locallib.php',405],['lib/zend/Zend/XmlRpc/Value','Array.php',39],['lib/zend/Zend/Service/Technorati','Result.php',63],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','RemoveConferenceTemplateRequest.php',46],['lib/zend/Zend/Gdata/Exif/Extension','Exposure.php',49],['lib/zend/Zend/Gdata/Exif','Feed.php',58],['question/type/randomsamatch/tests','helper.php',121],['lib/htmlpurifier/HTMLPurifier','PropertyListIterator.php',22],['question/engine/upgrade','logger.php',42],['question/engine/upgrade','logger.php',87],['lib/portfolio/formats/leap2a','lib.php',62],['lib/portfolio/formats/leap2a','lib.php',258],['lib/portfolio/formats/leap2a','lib.php',503],['lib/zend/Zend/Gdata/Spreadsheets','CellEntry.php',49],['lib/zend/Zend/Gdata/Photos/Extension','PhotoId.php',49],['lib/zend/Zend/Http/Response','Stream.php',120],['lib','modinfolib.php',429],['lib','modinfolib.php',1680],['lib','modinfolib.php',2516],['lib/dtl','database_importer.php',61],['lib/tcpdf','tcpdf_barcodes_2d.php',58],['lib/zend/Zend/Gdata/Exif/Extension','Iso.php',49],['lib/zend/Zend/Gdata/YouTube','VideoQuery.php',48],['lib/lessphp/Tree','Variable.php',20],['backup/moodle2','restore_activity_task.class.php',48],['lib/htmlpurifier/HTMLPurifier/AttrTransform','ImgSpace.php',24],['lib/google/src/Google/Signer','P12.php',33],['lib/lessphp/Tree','DetachedRuleset.php',15],['lib/zend/Zend/Gdata/YouTube','SubscriptionEntry.php',138],['lib/zend/Zend/Http/Client/Adapter','Test.php',81],['','mdeploy.php',120],['lib/ddl','sqlite_sql_generator.php',73],['lib/google/src/Google/Service','Drive.php',70],['mod/quiz/classes','admin_review_setting.php',82],['lib','pdflib.php',161],['lib/zend/Zend/Gdata/YouTube/Extension','Duration.php',45],['mod/quiz/report','attemptsreport_options.php',95],['lib/zend/Zend/Validate/File','Md5.php',60],['backup/util/helper','restore_questions_parser_processor.class.php',42],['lib/horde/framework/Horde/Imap/Client/Exception','SearchCharset.php',34],['lib/filebrowser','file_info_context_coursecat.php',39],['badges','renderer.php',972],['badges','renderer.php',1013],['badges','renderer.php',1077],['badges','renderer.php',1110],['badges','renderer.php',1136],['lib/horde/framework/Horde/Imap/Client','Socket.php',168],['lib/htmlpurifier/HTMLPurifier/ConfigSchema/Interchange','Id.php',17],['lib/zend/Zend/Gdata/Gapps/Extension','Nickname.php',59],['lib/zend/Zend/Gdata/YouTube/Extension','MediaRating.php',54],['lib/htmlpurifier/HTMLPurifier','UnitConverter.php',50],['mnet/xmlrpc','serverlib.php',674],['completion','data_object.php',68],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Filter.php',15],['lib/horde/framework/Horde/Support','StringStream.php',30],['lib/simplepie/library/SimplePie','gzdecode.php',186],['lib/jabber/XMPP','Roster.php',48],['lib/classes/dml','recordset_walk.php',64],['lib','dmllib.php',69],['lib','dmllib.php',84],['lib','dmllib.php',104],['lib','dmllib.php',129],['lib','dmllib.php',159],['lib','dmllib.php',187],['lib','dmllib.php',240],['lib','dmllib.php',270],['lib/phpexcel/PHPExcel/Worksheet','BaseDrawing.php',129],['lib/google/src/Google/Service','Books.php',57],['mod/assign/feedback/offline','importgradeslib.php',60],['lib/zend/Zend/Gdata','App.php',165],['lib/pear/Net','GeoIP.php',323],['lib/zend/Zend/Gdata/Photos/Extension','Name.php',50],['lib/google/src/Google/Service','AdExchangeSeller.php',53],['lib/zend/Zend/Gdata/Docs','Query.php',75],['lib/zend/Zend/Gdata/YouTube/Extension','Occupation.php',44],['lib/zend/Zend/Gdata/Exif/Extension','Time.php',49],['cache/tests/fixtures','lib.php',325],['lib/horde/framework/Horde/Mail/Rfc822','List.php',61],['lib/google/src/Google/Cache','Memcache.php',42],['lib/dml','sqlsrv_native_moodle_database.php',47],['backup/util/structure','backup_optigroup_element.class.php',51],['backup/cc/cc_lib','cc_converter_resource.php',28],['lib/simplepie/library/SimplePie','Caption.php',98],['mod/lti','OAuth.php',73],['mod/lti','OAuth.php',89],['mod/lti','OAuth.php',244],['mod/lti','OAuth.php',499],['lib/classes','collator.php',58],['lib/zend/Zend/Service/Delicious','PostList.php',56],['lib/classes/output','mustache_filesystem_loader.php',39],['lib/zend/Zend/Service/Amazon/Ec2','Abstract.php',91],['backup/util/xml/parser/processors','grouped_parser_processor.class.php',67],['mod/workshop/form/numerrors','lib.php',102],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','GetConferenceTemplateRequest.php',46],['report/log/classes','table_log.php',52],['lib/zend/Zend/Gdata/YouTube','CommentEntry.php',48],['lib/simplepie/library/SimplePie/Cache','Base.php',70],['lib/zend/Zend/Gdata/YouTube/Extension','Status.php',44],['lib/adodb','adodb-exceptions.inc.php',28],['backup/util/helper','backup_array_iterator.class.php',39],['lib/zend/Zend/Rest','Client.php',54],['lib/zend/Zend/Gdata/YouTube/Extension','Company.php',44],['question/classes/statistics/responses','analysis_for_class.php',68],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','RemoveConferenceTemplateParticipantRequest.php',53],['question/engine','lib.php',770],['question/engine','lib.php',1000],['question/engine','lib.php',1048],['lib/tcpdf','tcpdf_barcodes_1d.php',58],['lib/google/src/Google/Service','Bigquery.php',59],['backup/moodle2','restore_course_task.class.php',41],['lib/zend/Zend/Gdata/Media/Extension','MediaRestriction.php',54],['lib/htmlpurifier/HTMLPurifier','DefinitionCache.php',22],['lib/phpexcel/PHPExcel/Writer','CSV.php',86],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Hashtable.php',73],['cache','disabledlib.php',44],['lib/htmlpurifier/HTMLPurifier','PercentEncoder.php',20],['lib/mustache/src/Mustache/Exception','UnknownTemplateException.php',22],['webservice/xmlrpc','locallib.php',85],['lib/google/src/Google/Service','Freebase.php',38],['mod/lti/service/profile/classes/local/service','profile.php',41],['admin/tool/monitor/classes/output/managesubs','rules.php',56],['backup/util/settings','backup_setting.class.php',43],['grade/report/singleview/classes/local/ui','checkbox_attribute.php',42],['lib/alfresco/Service','ContentData.php',38],['enrol/ldap','lib.php',36],['lib/zend/Zend/Validate/File','MimeType.php',112],['lib/zend/Zend/Gdata/Gbase/Extension','BaseAttribute.php',47],['lib/zend/Zend/Gdata/Gapps','NicknameEntry.php',79],['lib/minify/lib/Minify','HTML.php',49],['lib/zend/Zend/Gdata/Extension','OriginalEvent.php',56],['lib/zend/Zend/Gdata/YouTube','InboxFeed.php',55],['lib/google/src/Google/Service','Groupssettings.php',40],['availability/classes','info.php',55],['lib/horde/framework/Horde/Mail/Rfc822','Group.php',45],['lib/tests','navigationlib_test.php',472],['lib/tests','navigationlib_test.php',530],['lib/tests','navigationlib_test.php',557],['lib/zend/Zend/Service/DeveloperGarden/Request/IpLocation','LocateIPRequest.php',58],['mod/quiz/report/statistics/classes','calculated.php',43],['grade/report/singleview/classes/local/ui','dropdown_attribute.php',49],['cache/stores/memcached','lib.php',107],['lib/zend/Zend/Validate','Between.php',89],['lib/zend/Zend/Gdata/Media/Extension','MediaGroup.php',183],['user/selector','lib.php',85],['user/selector','lib.php',674],['lib/google/src/Google/Service','YouTube.php',68],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Length.php',23],['lib/zend/Zend/Gdata','Exif.php',51],['backup/util/helper','backup_helper.class.php',380],['backup/util/plan','backup_step.class.php',32],['backup/util/plan','backup_step.class.php',55],['backup/util/helper','restore_inforef_parser_processor.class.php',37],['lib/phpexcel/PHPExcel/Cell','DataValidation.php',154],['lib/phpexcel/PHPExcel/CalcEngine','Logger.php',71],['lib/zend/Zend/Gdata','YouTube.php',192],['lib/zend/Zend/Gdata/Calendar/Extension','Link.php',48],['blocks','edit_form.php',47],['lib/dml','mssql_native_moodle_recordset.php',34],['mod/assign','locallib.php',149],['mod/assign','locallib.php',7411],['grade/report/user','lib.php',188],['lib/zend/Zend/Validate/Barcode','Code93ext.php',47],['lib/zend/Zend/Service/DeveloperGarden/Request/BaseUserService','ChangeQuotaPool.php',47],['lib/phpexcel/PHPExcel/CachedObjectStorage','SQLite3.php',294],['lib/horde/framework/Horde/Mail/Transport','Mail.php',53],['lib/zend/Zend/Gdata','Media.php',51],['lib/zend/Zend/Gdata/Gapps/Extension','Quota.php',59],['lib/zend/Zend/Amf/Value','ByteArray.php',38],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','Bool.php',22],['lib/simplepie/library/SimplePie/Cache','File.php',82],['lib/behat/form_field','behat_form_field.php',59],['mod/lti/service/toolproxy/classes/local/resource','toolproxy.php',47],['backup/moodle2','restore_subplugin.class.php',45],['lib/zend/Zend/Gdata/Spreadsheets','SpreadsheetFeed.php',54],['backup/util/structure','base_processor.class.php',49],['lib/zend/Zend/Gdata/Calendar/Extension','Timezone.php',45],['lib/zend/Zend/Validate','Ip.php',56],['lib/zend/Zend/Gdata/Extension','OpenSearchTotalResults.php',44],['badges/criteria','award_criteria_activity.php',45],['lib/zend/Zend/Service/Technorati','DailyCountsResultSet.php',67],['lib/zend/Zend/XmlRpc/Value','Collection.php',40],['lib/google/src/Google/Service','Coordinate.php',47],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','LinkTypes.php',21],['lib/classes/output','mustache_pix_helper.php',43],['lib/zend/Zend/Amf/Value','MessageBody.php',81],['user/classes/output/myprofile','node.php',82],['lib/htmlpurifier/HTMLPurifier','TokenFactory.php',43],['lib/zend/Zend','Registry.php',186],['lib/lessphp/Exception','Chunk.php',19],['lib/dtl','database_mover.php',33],['lib/zend/Zend/Http','CookieJar.php',106],['lib/zend/Zend/Gdata/Extension','Transparency.php',44],['lib/zend/Zend/Gdata/Media/Extension','MediaText.php',64],['lib/phpexcel/PHPExcel/RichText','TextElement.php',43],['lib/simplepie/library/SimplePie','Enclosure.php',219],['lib/google/src/Google/Service','Webmasters.php',46],['lib/lessphp/Tree','Value.php',14],['lib/simplepie/library','SimplePie.php',611],['lib/google/src/Google/Service','Autoscaler.php',46],['lib/zend/Zend/Gdata/App','CaptchaRequiredException.php',64],['lib/behat/features/bootstrap','behat_init_context.php',45],['lib/horde/framework/Horde/Imap/Client/Socket','ClientSort.php',37],['mod/folder','renderer.php',139],['lib/google/src/Google/Service','Webfonts.php',38],['lib/zend/Zend/Gdata/DublinCore/Extension','Description.php',44],['admin/roles/classes','admins_potential_selector.php',30],['lib/zend/Zend/Soap/Client','Local.php',52],['lib/horde/framework/Horde/Imap/Client/Interaction/Server','Tagged.php',36],['lib/lessphp/Tree','Negative.php',14],['mod/quiz','override_form.php',58],['lib/classes/session','file.php',40],['lib/google/src/Google/Auth','OAuth2.php',55],['admin/roles/classes','check_users_selector.php',38],['lib/phpexcel/PHPExcel/Reader/Excel2007','Theme.php',68],['mod/lti/classes/local/ltiservice','service_base.php',63],['lib/alfresco/Service','Store.php',31],['lib/google/src/Google/Service','Audit.php',39],['lib/zend/Zend/Gdata','Gbase.php',95],['mod/wiki','pagelib.php',94],['mod/wiki','pagelib.php',381],['mod/wiki','pagelib.php',986],['mod/wiki','pagelib.php',1195],['mod/wiki','pagelib.php',2201],['mod/wiki','pagelib.php',2429],['lib/simplepie/library/SimplePie/Decode/HTML','Entities.php',80],['calendar','lib.php',1968],['calendar','lib.php',2709],['lib/zend/Zend/Gdata/Photos','AlbumFeed.php',133],['lib/phpmailer','class.phpmailer.php',572],['lib/google/src/Google/Service','Datastore.php',46],['lib/google/src/Google/Service','YouTubeAnalytics.php',45],['lib/lessphp/Tree','Keyword.php',17],['lib/zend/Zend/Service/Amazon','Sqs.php',70],['backup/util/plan','backup_structure_step.class.php',38],['availability/condition/profile/classes','condition.php',73],['lib/simplepie/library/SimplePie','Rating.php',73],['lib/htmlpurifier/HTMLPurifier/AttrTransform','Length.php',19],['lib/horde/framework/Horde/Support','Backtrace.php',20],['lib/simplepie/library/SimplePie','Author.php',81],['report/loglive/classes','table_log.php',50],['lib','completionlib.php',243],['backup/cc/cc_lib','cc_converter_quiz.php',33],['lib/zend/Zend/Gdata/Exif/Extension','Make.php',49],['lib/dml','moodle_database.php',139],['lib/lessphp/Tree','Media.php',18],['lib/horde/framework/Horde/Imap/Client','Url.php',112],['lib/classes/update','info.php',48],['backup/moodle2','backup_subplugin.class.php',44],['backup/util/ui','base_moodleform.class.php',68],['lib/zend/Zend/Gdata/DublinCore/Extension','Creator.php',44],['lib/alfresco/Service','Association.php',28],['lib/zend/Zend/Gdata/Geo/Extension','GeoRssWhere.php',62],['auth/cas/CAS/CAS/PGTStorage','AbstractStorage.php',57],['lib/zend/Zend/Service','Twitter.php',125],['question/classes/statistics/responses','analysis_for_actual_response.php',70],['admin/tool/log/classes/log','store.php',30],['lib/phpexcel/PHPExcel','Comment.php',101],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','CommitConferenceRequest.php',46],['filter','local_settings_form.php',33],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Composite.php',25],['backup/util/plan','base_step.class.php',35],['backup/util/plan','base_step.class.php',127],['badges/classes','assertion.php',49],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','UpdateParticipantRequest.php',67],['lib/phpexcel/PHPExcel','RichText.php',45],['lib/zend/Zend/Gdata/App','Base.php',111],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Db.php',38],['lib/filestorage','file_storage.php',57],['lib/adodb/drivers','adodb-postgres64.inc.php',125],['lib/adodb/drivers','adodb-postgres64.inc.php',904],['lib/phpexcel/PHPExcel/Chart','Title.php',53],['lib/zend/Zend/Mime','Part.php',51],['lib/phpexcel/PHPExcel','Worksheet.php',335],['lib/phpexcel/PHPExcel/Worksheet','MemoryDrawing.php',78],['lib/google/src/Google/Service','Pagespeedonline.php',39],['lib/zend/Zend/Gdata/DublinCore/Extension','Language.php',44],['lib/phpexcel/PHPExcel/Worksheet','SheetView.php',77],['lib/alfresco/Service/WebService','AlfrescoWebService.php',30],['admin/tool/monitor/classes/output/managerules','renderable.php',56],['lib/google/src/Google/Service','ShoppingContent.php',47],['backup/util/xml/parser/processors','selective_exact_parser_processor.class.php',35],['lib/zend/Zend/Gdata/Spreadsheets','ListQuery.php',57],['backup/moodle2','backup_format_plugin.class.php',40],['mod/workshop/allocation/scheduled','lib.php',48],['lib','outputfactories.php',120],['lib','outputfactories.php',367],['lib/zend/Zend/Gdata/Spreadsheets','ListEntry.php',62],['repository/merlot','lib.php',37],['lib/htmlpurifier/HTMLPurifier','PropertyList.php',29],['mod/chat','chatd.php',78],['mod/chat','chatd.php',103],['lib/lessphp/Visitor','extendFinder.php',15],['lib/zend/Zend/Gdata/YouTube/Extension','MediaGroup.php',112],['mod/quiz/report/grading','gradingsettings_form.php',44],['lib/zend/Zend/Service/Simpy','Note.php',104],['lib/zend/Zend/Gdata/Photos/Extension','Rotation.php',51],['lib/phpexcel/PHPExcel/Worksheet','RowDimension.php',89],['lib/editor/tinymce/classes','plugin.php',49],['question/type/calculatedsimple','edit_calculatedsimple_form.php',72],['lib/zend/Zend/XmlRpc/Value','Integer.php',40],['lib/zend/Zend/Validate/File','Upload.php',74],['lib/phpexcel/PHPExcel/Shared/trend','polynomialBestFitClass.php',201],['admin/roles/classes','capability_table_with_risks.php',46],['lib/zend/Zend/Gdata/Extension','EntryLink.php',52],['question/type','questiontypebase.php',55],['question/type','questiontypebase.php',1442],['lib','outputrequirementslib.php',166],['lib/google/src/Google/Service','Appsactivity.php',49],['lib/horde/framework/Horde/Mail/Transport','Smtp.php',100],['lib/zend/Zend/Loader','Autoloader.php',446],['lib/horde/framework/Horde/Support','CombineStream.php',29],['lib/zend/Zend/Gdata','Docs.php',87],['lib/alfresco/Service/Logger','Logger.php',27],['lib/zend/Zend/Gdata/App/Extension','Logo.php',43],['lib/dml','pgsql_native_moodle_recordset.php',44],['backup/cc/cc_lib','cc_version11.php',57],['lib','weblib.php',315],['lib','weblib.php',3025],['lib','weblib.php',3325],['lib','weblib.php',3360],['lib','weblib.php',3435],['backup/cc/cc_lib','xmlbase.php',52],['backup/cc/cc_lib','cc_organization.php',47],['backup/cc/cc_lib','cc_organization.php',145],['mod/lesson','locallib.php',2007],['mod/lesson','locallib.php',2602],['lib/zend/Zend/Service/LiveDocx','MailMerge.php',61],['lib/phpexcel/PHPExcel/Worksheet/Drawing','Shadow.php',101],['lib/zend/Zend/Server/Reflection','ReturnValue.php',47],['lib/minify/lib/Minify','Build.php',77],['lib/horde/framework/Horde','Variables.php',60],['auth/cas/CAS/CAS','ProxyChain.php',48],['lib/phpexcel/PHPExcel','NamedRange.php',73],['lib/zend/Zend/Gdata/Extension','OpenSearchStartIndex.php',44],['lib/horde/framework/Horde/Imap/Client/Password','Xoauth2.php',44],['lib/zend/Zend/Service/Amazon','OfferSet.php',79],['grade/export/txt','grade_export_txt.php',27],['admin/roles/classes','allow_override_page.php',31],['lib/lessphp/Tree','Assignment.php',15],['lib/zend/Zend/Gdata/Books/Extension','ThumbnailLink.php',42],['lib/zend/Zend/Gdata/YouTube/Extension','Uploaded.php',44],['lib/zend/Zend/Gdata/Extension','AttendeeStatus.php',44],['lib/tcpdf/include/barcodes','qrcode.php',631],['lib/zend/Zend/Gdata/Photos/Extension','Weight.php',51],['enrol','locallib.php',125],['enrol','locallib.php',1240],['enrol','locallib.php',1363],['enrol','locallib.php',1414],['enrol','locallib.php',1447],['lib/lessphp/Visitor','toCSS.php',13],['question/classes/statistics/questions','calculator.php',66],['mod/forum','locallib.php',55],['mod/forum','locallib.php',419],['backup/util/helper','restore_prechecks_helper.class.php',213],['grade/edit/tree','lib.php',57],['grade/edit/tree','lib.php',605],['grade/edit/tree','lib.php',638],['grade/edit/tree','lib.php',804],['lib/zend/Zend/Gdata','Geo.php',56],['lib/zend/Zend/Gdata/Books','CollectionFeed.php',41],['lib/classes','string_manager_standard.php',53],['backup/util/loggers','base_logger.class.php',42],['backup/util/loggers','base_logger.class.php',163],['admin/tool/installaddon/classes','validator.php',223],['admin/tool/generator/classes','backend.php',84],['lib/zend/Zend/Service/WindowsAzure/Credentials','SharedAccessSignature.php',53],['lib/zend/Zend/Gdata/Spreadsheets/Extension','Custom.php',49],['availability/condition/completion/classes','condition.php',48],['question/classes/statistics/questions','calculated.php',181],['lib/lessphp/Tree','Javascript.php',20],['mod/quiz','locallib.php',1898],['lib/phpexcel/PHPExcel/Worksheet','ColumnDimension.php',89],['lib/phpexcel/PHPExcel/Reader','Excel2007.php',62],['lib/zend/Zend/Gdata/DublinCore/Extension','Date.php',45],['lib/mustache/src/Mustache/Cache','FilesystemCache.php',27],['lib/zend/Zend/Loader','PluginLoader.php',95],['lib/zend/Zend/Gdata/YouTube/Extension','Description.php',44],['lib/horde/framework/Horde/Imap/Client/Interaction','Command.php',72],['lib/zend/Zend/Gdata/App/Extension','Generator.php',45],['lib/zend/Zend/Gdata/DublinCore/Extension','Rights.php',44],['lib/phpexcel/PHPExcel/Style','Conditional.php',93],['repository/skydrive','lib.php',42],['lib/google/src/Google/Service','SQLAdmin.php',48],['lib/zend/Zend/Gdata/YouTube/Extension','NoEmbed.php',44],['lib/zend/Zend/Gdata/Exif/Extension','ImageUniqueId.php',49],['lib/simplepie/library/SimplePie','Item.php',82],['lib/phpexcel/PHPExcel/Writer/PDF','Core.php',214],['lib/zend/Zend/Validate/File','IsImage.php',53],['lib/zend/Zend/Date','Exception.php',39],['lib/zend/Zend/Amf/Adobe','Introspector.php',65],['lib/htmlpurifier/HTMLPurifier','URIParser.php',10],['lib/zend/Zend/Service','ReCaptcha.php',117],['lib/zend/Zend/Gdata/Health','ProfileEntry.php',61],['lib/zend/Zend/Server/Reflection','Prototype.php',45],['admin/roles/classes','allow_switch_page.php',33],['backup/util/helper','restore_logs_processor.class.php',45],['backup/util/helper','restore_logs_processor.class.php',140],['lib/google/src/Google/Service','Fitness.php',57],['filter/emoticon/tests','filter_test.php',68],['backup/util/helper','convert_helper.class.php',378],['backup/util/ui','restore_ui_stage.class.php',42],['backup/util/ui','restore_ui_stage.class.php',265],['backup/util/ui','restore_ui_stage.class.php',452],['backup/util/ui','restore_ui_stage.class.php',592],['backup/util/ui','restore_ui_stage.class.php',704],['backup/util/ui','restore_ui_stage.class.php',852],['backup/util/ui','restore_ui_stage.class.php',959],['backup/util/ui','restore_ui_stage.class.php',1100],['repository/webdav','lib.php',38],['repository/dropbox','locallib.php',46],['lib/lessphp/Exception','Parser.php',30],['lib/filestorage','tgz_packer.php',726],['lib/filestorage','tgz_packer.php',808],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','URI.php',15],['backup/converter/moodle1','lib.php',725],['backup/converter/moodle1','lib.php',865],['backup/converter/moodle1','lib.php',1145],['backup/converter/moodle1','lib.php',1190],['backup/converter/moodle1','lib.php',1480],['lib/classes/output','mustache_javascript_helper.php',40],['auth/cas/CAS/CAS/ProxiedService/Http','Abstract.php',58],['lib/zend/Zend/Gdata/YouTube/Extension','FirstName.php',44],['lib/zend/Zend/Service/WindowsAzure/Storage','Queue.php',83],['lib/horde/framework/Horde/Imap/Client/Data','Format.php',32],['lib/zend/Zend/Gdata/Media/Extension','MediaDescription.php',53],['lib/google/src/Google/Service','TagManager.php',66],['lib/zend/Zend/Server','Abstract.php',89],['cache/classes','config.php',80],['lib/htmlpurifier/HTMLPurifier','Generator.php',67],['lib','outputcomponents.php',80],['lib','outputcomponents.php',204],['lib','outputcomponents.php',469],['lib','outputcomponents.php',523],['lib','outputcomponents.php',579],['lib','outputcomponents.php',655],['lib','outputcomponents.php',773],['lib','outputcomponents.php',915],['lib','outputcomponents.php',999],['lib','outputcomponents.php',2178],['lib','outputcomponents.php',2217],['lib','outputcomponents.php',2290],['lib','outputcomponents.php',2371],['lib','outputcomponents.php',2574],['lib','outputcomponents.php',2622],['lib','outputcomponents.php',2682],['lib','outputcomponents.php',2855],['lib','outputcomponents.php',3025],['lib','outputcomponents.php',3129],['lib','outputcomponents.php',3196],['lib','outputcomponents.php',3324],['lib','outputcomponents.php',3608],['lib','outputcomponents.php',3637],['lib','outputcomponents.php',3663],['lib','outputcomponents.php',3685],['lib','outputcomponents.php',3714],['lib','outputcomponents.php',3746],['lib/zend/Zend/Validate/Barcode','Code25.php',53],['lib/zend/Zend/Gdata/YouTube','CommentFeed.php',53],['lib/dtl','string_xml_database_importer.php',34],['question/engine','questionattemptstep.php',97],['question/engine','questionattemptstep.php',608],['lib/htmlpurifier/HTMLPurifier/Node','Element.php',39],['lib/simplepie/library/SimplePie','Cache.php',69],['backup/util/ui','renderer.php',813],['grade/export/xls','grade_export_xls.php',24],['lib/google/src/Google/Service','Directory.php',110],['lib/zend/Zend/Gdata/YouTube/Extension','State.php',47],['lib/phpexcel/PHPExcel/Style','Alignment.php',97],['mod/quiz/report/statistics','statistics_table.php',45],['backup/util/structure','base_nested_element.class.php',44],['backup/util/structure','base_nested_element.class.php',258],['lib/zend/Zend/Gdata/DublinCore/Extension','Title.php',44],['lib/htmlpurifier/HTMLPurifier','Config.php',100],['lib/zend/Zend/Validate/Barcode','Code93.php',67],['lib/lessphp','Functions.php',15],['lib/adodb/drivers','adodb-postgres7.inc.php',78],['lib/adodb/drivers','adodb-postgres7.inc.php',273],['lib/adodb/drivers','adodb-postgres7.inc.php',304],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','GetRunningConferenceRequest.php',46],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','UpdateConferenceRequest.php',74],['lib/zend/Zend/Validate','EmailAddress.php',118],['mod/workshop','locallib.php',178],['mod/workshop','locallib.php',2801],['mod/workshop','locallib.php',3236],['mod/workshop','locallib.php',3472],['mod/workshop','locallib.php',3714],['mod/workshop','locallib.php',3800],['mod/workshop','locallib.php',3885],['mod/workshop','locallib.php',3904],['lib/zend/Zend/XmlRpc/Value','Struct.php',39],['lib/zend/Zend/Gdata/Books/Extension','Embeddability.php',45],['lib/horde/framework/Horde/Mime','Mdn.php',35],['cache/stores/static','lib.php',127],['lib','blocklib.php',54],['lib','blocklib.php',152],['lib/zend/Zend/Gdata/Books/Extension','Review.php',46],['lib','componentlib.class.php',597],['lib','componentlib.class.php',821],['lib/zend/Zend/Validate/Barcode','Code39.php',66],['lib/filebrowser','file_info_context_module.php',47],['lib/phpexcel/PHPExcel/Shared/JAMA','CholeskyDecomposition.php',42],['question/engine','states.php',61],['lib/jabber/XMPP','XMLStream.php',171],['lib/jabber/XMPP','XMPP.php',101],['lib/classes/lock','lock_factory.php',39],['lib/tests','collator_test.php',310],['lib/horde/framework/Horde/Imap/Client/Exception','NoSupportPop3.php',26],['course/format','lib.php',78],['lib/ddl','sql_generator.php',175],['lib/zend/Zend/XmlRpc/Generator','GeneratorAbstract.php',35],['mod/quiz','accessmanager.php',45],['lib/zend/Zend/Amf/Value','TraitsInfo.php',53],['admin/tool/monitor/classes/output/managesubs','subs.php',51],['lib/zend/Zend/Service/Nirvanix','Response.php',43],['lib','boxlib.php',293],['repository/flickr_public','image.php',34],['lib/google/src/Google/Service','AppState.php',40],['backup/util/structure','backup_nested_element.class.php',44],['lib/filestorage','zip_archive.php',66],['lib/google/src/Google/Service','Taskqueue.php',44],['lib/zend/Zend/Server/Method','Prototype.php',49],['lib/zend/Zend/Service/Technorati','Author.php',90],['mod/workshop/form/comments','lib.php',99],['lib/phpexcel/PHPExcel/RichText','Run.php',43],['lib/phpexcel/PHPExcel/Chart','DataSeriesValues.php',89],['lib/horde/framework/Horde/Imap/Client/Data','Acl.php',32],['lib/phpexcel/PHPExcel/Writer/Excel2007','WriterPart.php',69],['lib/zend/Zend/Service/Simpy','WatchlistFilter.php',48],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','RemoveConferenceRequest.php',46],['lib/zend/Zend/Gdata/Photos','UserEntry.php',131],['lib/mustache/src/Mustache/Loader','FilesystemLoader.php',33],['lib/zend/Zend/Gdata/Spreadsheets','ListFeed.php',54],['lib/phpexcel/PHPExcel','DocumentProperties.php',131],['lib/phpexcel/PHPExcel/Reader','Excel2003XML.php',62],['lib/lessphp/Tree','Paren.php',14],['lib/zend/Zend/Gdata/Photos/Extension','Thumbnail.php',50],['lib/horde/framework/Horde/Imap/Client','Mailbox.php',62],['admin/tool/customlang','locallib.php',44],['admin/tool/customlang','locallib.php',405],['admin/tool/customlang','locallib.php',471],['backup/util/xml/parser/processors','selective_like_parser_processor.class.php',35],['lib/filebrowser','file_info_context_user.php',39],['lib/google/src/Google/Service','CivicInfo.php',40],['lib/zend/Zend/Gdata/YouTube/Extension','Private.php',44],['lib/zend/Zend/Gdata/YouTube/Extension','Music.php',44],['backup/moodle2','restore_block_task.class.php',45],['lib/zend/Zend','Gdata.php',99],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Number.php',18],['lib/simplepie','moodle_simplepie.php',50],['lib/simplepie','moodle_simplepie.php',121],['lib/phpunit/classes','hint_resultprinter.php',37],['backup/util/plan','restore_plan.class.php',43],['backup/util/plan','restore_plan.class.php',203],['admin/roles/classes','capability_table_base.php',51],['lib/htmlpurifier/HTMLPurifier','Lexer.php',152],['lib/google/src/Google/Service','Container.php',44],['lib/zend/Zend/Service/Simpy','TagSet.php',47],['lib/phpexcel/PHPExcel/Chart','Legend.php',82],['question/type/calculated/tests','helper.php',205],['lib/phpexcel/PHPExcel/Reader','CSV.php',103],['availability/classes','result.php',46],['lib/zend/Zend/XmlRpc/Value','Double.php',40],['backup/util/helper','restore_users_parser_processor.class.php',43],['lib/htmlpurifier/HTMLPurifier/ConfigSchema','ValidatorAtom.php',31],['lib/htmlpurifier/HTMLPurifier/Lexer','PH5P.php',462],['lib/htmlpurifier/HTMLPurifier/Lexer','PH5P.php',1700],['lib/horde/framework/Horde/Mime','Related.php',32],['report/log/classes','renderable.php',93],['lib/horde/framework/Horde/Imap/Client/Base','Mailbox.php',59],['lib/phpexcel/PHPExcel/Style','Font.php',108],['lib/htmlpurifier/HTMLPurifier/ChildDef','Table.php',57],['backup/util/settings/activity','activity_backup_setting.class.php',25],['lib/mustache/src/Mustache/Exception','UnknownHelperException.php',22],['course/tests/fixtures','course_capability_assignment.php',60],['lib/zend/Zend/Service/Amazon','ResultSet.php',68],['lib/zend/Zend/Validate','Callback.php',69],['lib/zend/Zend/Gdata/Books','CollectionEntry.php',41],['lib/zend/Zend/Gdata/DublinCore/Extension','Publisher.php',44],['lib/zend/Zend/Gdata/Spreadsheets','WorksheetEntry.php',56],['badges/lib','bakerlib.php',52],['backup/util/xml','xml_writer.class.php',57],['backup/util/xml','xml_writer.class.php',284],['lib/portfolio','caller.php',67],['lib/zend/Zend/Validate/File','Sha1.php',60],['lib/htmlpurifier/HTMLPurifier/Strategy','Core.php',8],['lib/zend/Zend/Gdata/Media','Feed.php',58],['lib/zend/Zend/Gdata/YouTube/Extension','LastName.php',44],['mod/data','locallib.php',64],['mod/data','locallib.php',431],['lib/zend/Zend/Gdata/App/Extension','Content.php',44],['lib/classes/update','checker_exception.php',37],['backup/cc/cc_lib','cc_manifest.php',45],['lib','odslib.class.php',42],['lib','odslib.class.php',121],['lib','odslib.class.php',419],['lib','odslib.class.php',824],['lib/zend/Zend/Gdata/Books/Extension','AnnotationLink.php',42],['lib/zend/Zend/Gdata/Calendar/Extension','Color.php',46],['backup/util/helper','restore_structure_parser_processor.class.php',41],['admin/tool/log/store/standard/classes/log','store.php',37],['lib/horde/framework/Horde/Imap/Client/Mailbox','List.php',46],['lib/alfresco/Service','Session.php',39],['grade/report/singleview/classes/local/ui','empty_element.php',38],['enrol/database','settingslib.php',34],['lib/phpexcel/PHPExcel/Worksheet/AutoFilter','Column.php',125],['lib/google/src/Google/Service','AndroidPublisher.php',51],['lib/zend/Zend/Service','StrikeIron.php',43],['lib/zend/Zend/Gdata/Books/Extension','InfoLink.php',41],['lib/lessphp/SourceMap','Generator.php',82],['filter/urltolink/tests','filter_test.php',209],['lib/horde/framework/Horde/Socket','Client.php',52],['lib/zend/Zend/Service/Amazon','Item.php',112],['repository','lib.php',116],['repository','lib.php',533],['admin/roles/classes','define_role_table_basic.php',31],['lib/phpexcel/PHPExcel','WorksheetIterator.php',54],['lib/zend/Zend/Gdata/Photos/Extension','NumPhotosRemaining.php',50],['mod/quiz','attemptlib.php',41],['mod/quiz','attemptlib.php',82],['mod/quiz','attemptlib.php',505],['mod/quiz','attemptlib.php',2058],['mod/quiz','attemptlib.php',2113],['lib/zend/Zend/Server/Reflection','Node.php',51],['lib/zend/Zend/Gdata/Media/Extension','MediaTitle.php',49],['lib/zend/Zend','Date.php',123],['lib/zend/Zend','Mime.php',290],['lib','accesslib.php',5301],['lib','accesslib.php',5846],['lib','accesslib.php',6116],['lib','accesslib.php',6357],['lib','accesslib.php',6544],['lib','accesslib.php',6776],['lib','accesslib.php',6998],['lib','accesslib.php',7240],['question/engine/tests','helpers.php',582],['question/engine/tests','helpers.php',594],['question/engine/tests','helpers.php',608],['question/engine/tests','helpers.php',623],['question/engine/tests','helpers.php',637],['question/engine/tests','helpers.php',652],['question/engine/tests','helpers.php',665],['question/engine/tests','helpers.php',676],['question/engine/tests','helpers.php',1180],['lib/zend/Zend/Validate','Ccnum.php',62],['lib/zend/Zend/Gdata/Extension','EventStatus.php',44],['lib/google/src/Google/Verifier','Pem.php',29],['lib/zend/Zend/Service/Technorati','BlogInfoResult.php',74],['admin/tool/log/classes','setting_managestores.php',30],['lib','outputactions.php',60],['lib','outputactions.php',91],['lib','outputactions.php',148],['backup/cc/cc_lib','cc_assesment_truefalse.php',27],['backup/util/ui','restore_moodleform.class.php',34],['grade/report/singleview/classes/local/ui','element.php',47],['mod/quiz/report','attemptsreport_table.php',76],['lib/lessphp/Tree','Attribute.php',16],['lib/phpexcel/PHPExcel/Style','Supervisor.php',52],['lib/zend/Zend/Gdata/Media/Extension','MediaCategory.php',50],['lib/google/src/Google/Service','AdSenseHost.php',49],['lib/zend/Zend/Gdata/Photos/Extension','Checksum.php',51],['lib/lessphp/Tree','Expression.php',16],['mod/workshop','fileinfolib.php',43],['mod/workshop','fileinfolib.php',198],['course/format','renderer.php',44],['lib/zend/Zend/XmlRpc/Value','Boolean.php',40],['blocks/rss_client','editfeed.php',36],['lib/phpexcel/PHPExcel/Worksheet','Protection.php',157],['question/type/numerical','question.php',321],['auth/cas/CAS/CAS/ProxiedService','Imap.php',51],['lib/typo3','class.t3lib_cs.php',509],['lib/simplepie/library/SimplePie/XML/Declaration','Parser.php',110],['lib/zend/Zend/Gdata/Health','ProfileListEntry.php',49],['lib/htmlpurifier/HTMLPurifier/Filter','ExtractStyleBlocks.php',57],['cache/stores/memcache','lib.php',120],['lib/htmlpurifier/HTMLPurifier/AttrDef','Switch.php',29],['lib/zend/Zend/Gdata/Calendar/Extension','WebContent.php',47],['lib/zend/Zend/Gdata/Photos/Extension','Id.php',50],['lib/google/src/Google/Service','Games.php',60],['lib/zend/Zend/Validate/File','Size.php',92],['lib/classes/lock','file_lock_factory.php',57],['lib/htmlpurifier/HTMLPurifier/AttrTransform','SafeParam.php',27],['lib/phpexcel/PHPExcel/Reader','Gnumeric.php',64],['lib','filelib.php',2700],['lib','filelib.php',3560],['lib/classes/session','database.php',52],['lib/zend/Zend/Gdata/YouTube/Extension','Movies.php',44],['grade','lib.php',103],['grade','lib.php',785],['availability/condition/grouping/classes','condition.php',46],['lib/zend/Zend/Service/Technorati','SearchResult.php',84],['lib/dml','mysqli_native_moodle_recordset.php',42],['lib/zend/Zend/XmlRpc','Server.php',186],['mod/assign/feedback/editpdf/classes','annotation.php',66],['lib/htmlpurifier/HTMLPurifier/ConfigSchema','Validator.php',30],['lib/htmlpurifier','HTMLPurifier.php',104],['lib/zend/Zend/Gdata/Media/Extension','MediaPlayer.php',59],['lib/phpexcel/PHPExcel','Cell.php',122],['lib/phpexcel/PHPExcel/CachedObjectStorage','APC.php',248],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Percentage.php',18],['lib','oauthlib.php',65],['lib','oauthlib.php',409],['backup/util/helper','restore_log_rule.class.php',62],['lib/phpexcel/PHPExcel/Calculation','FormulaToken.php',108],['lib/zend/Zend/Server/Reflection','Class.php',66],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Font.php',22],['mnet/service/enrol','locallib.php',48],['mnet/service/enrol','locallib.php',466],['mnet/service/enrol','locallib.php',537],['repository/flickr','lib.php',51],['lib','csvlib.class.php',64],['lib','csvlib.class.php',398],['lib/google/src/Google/Service','MapsEngine.php',66],['lib/xhprof/xhprof_lib/utils','xhprof_runs.php',87],['lib/filestorage','tgz_extractor.php',119],['lib/zend/Zend/Soap','Client.php',142],['lib/zend/Zend/Gdata/Calendar/Extension','Hidden.php',45],['cache/classes','factory.php',149],['lib/zend/Zend/Gdata/Media/Extension','MediaCredit.php',54],['course','dnduploadlib.php',109],['course','dnduploadlib.php',407],['mod/lti/classes/local/ltiservice','resource_base.php',62],['lib/zend/Zend/Http','Response.php',132],['lib/horde/framework/Horde/Imap/Client','Exception.php',247],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','GetConferenceListRequest.php',63],['backup/util/ui','backup_moodleform.class.php',41],['lib/phpexcel/PHPExcel/Chart','Layout.php',143],['comment','lib.php',100],['lib/phpexcel','PHPExcel.php',354],['grade/export/ods','grade_export_ods.php',24],['auth/cas/CAS/CAS','ProxyTicketException.php',46],['lib/minify/lib','JSMinPlus.php',193],['lib/minify/lib','JSMinPlus.php',726],['lib/minify/lib','JSMinPlus.php',1638],['lib/minify/lib','JSMinPlus.php',1656],['lib/minify/lib','JSMinPlus.php',1748],['lib/zend/Zend/Gdata/YouTube/Extension','Location.php',44],['lib/lessphp/Tree','Dimension.php',15],['lib/phpexcel/PHPExcel/Worksheet','Row.php',54],['lib/phpexcel/PHPExcel/Writer','HTML.php',135],['lib/zend/Zend/Service/Technorati','TagsResultSet.php',41],['backup/moodle2','backup_theme_plugin.class.php',61],['lib/zend/Zend/Gdata','Extension.php',43],['lib/htmlpurifier/HTMLPurifier/ChildDef','Custom.php',36],['lib/google/src/Google/Service','SiteVerification.php',43],['lib/htmlpurifier/HTMLPurifier/Token','Text.php',34],['mod/forum/classes','subscriber_selector_base.php',53],['lib/zend/Zend','Auth.php',45],['lib/phpexcel/PHPExcel/Style','Borders.php',121],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','CreateConferenceRequest.php',67],['lib/zend/Zend/Gdata/Calendar','ListFeed.php',54],['lib/zend/Zend/Gdata/Extension','Visibility.php',44],['webservice/xmlrpc','lib.php',42],['lib/phpexcel/PHPExcel/CachedObjectStorage','CacheBase.php',76],['lib/zend/Zend/Gdata/App','MediaEntry.php',57],['lib/horde/framework/Horde/Mime','Part.php',261],['backup/util/ui','backup_ui_stage.class.php',43],['backup/util/ui','backup_ui_stage.class.php',79],['backup/util/ui','backup_ui_stage.class.php',234],['backup/util/ui','backup_ui_stage.class.php',387],['backup/util/ui','backup_ui_stage.class.php',516],['backup/util/ui','backup_ui_stage.class.php',575],['question/classes/engine/variants','least_used_strategy.php',51],['lib/horde/framework/Horde/Support','Array.php',21],['lib/zend/Zend/Gdata/YouTube/Extension','Statistics.php',93],['lib/zend/Zend/Gdata/Photos/Extension','BytesUsed.php',50],['lib','tablelib.php',127],['lib','tablelib.php',1400],['lib','tablelib.php',1723],['lib/zend/Zend/Gdata/App/Extension','Uri.php',43],['backup/util/plan','backup_task.class.php',32],['backup/util/plan','backup_task.class.php',56],['lib/zend/Zend/Gdata/Media/Extension','MediaCopyright.php',53],['lib/zend/Zend/Gdata/DublinCore/Extension','Identifier.php',44],['backup/util/xml/parser/processors','findpaths_parser_processor.class.php',35],['lib/zend/Zend/Gdata/Gbase','Feed.php',49],['availability/condition/date/classes','condition.php',52],['backup/util/helper','restore_moodlexml_parser_processor.class.php',38],['admin/tool/generator/classes','course_backend.php',116],['lib/google/src/Google/Service','Prediction.php',51],['cache/stores/session','lib.php',131],['cache/classes','dummystore.php',62],['lib/zend/Zend/XmlRpc/Server','System.php',39],['lib/zend/Zend/Service/WindowsAzure/Storage','TableInstance.php',50],['backup/util/settings/course','course_backup_setting.class.php',25],['mod/quiz/classes/question','qubaids_for_users_attempts.php',37],['mod/lesson','override_form.php',58],['lib/zend/Zend/Service/Simpy','WatchlistSet.php',47],['lib/google/src/Google/Service','Compute.php',78],['badges/criteria','award_criteria.php',127],['lib/zend/Zend/Gdata/Calendar/Extension','Selected.php',45],['lib/minify/lib/Minify/Cache','ZendPlatform.php',23],['lib/zend/Zend/Validate','PostCode.php',65],['lib/dml','oci_native_moodle_temptables.php',40],['lib/zend/Zend/Gdata/Photos/Extension','CommentingEnabled.php',51],['lib/simplepie/library/SimplePie','Category.php',81],['auth/cas/CAS/CAS','CookieJar.php',46],['lib/phpexcel/PHPExcel/Reader/Excel5','MD5.php',45],['backup/util/ui','backup_ui_setting.class.php',70],['backup/util/ui','backup_ui_setting.class.php',200],['backup/util/ui','backup_ui_setting.class.php',398],['backup/util/ui','backup_ui_setting.class.php',504],['backup/util/ui','backup_ui_setting.class.php',583],['user/classes/output/myprofile','category.php',68],['grade/report/singleview/classes/local/ui','grade_attribute_format.php',47],['mod/wiki/parser','parser.php',98],['backup/converter','convertlib.php',52],['backup/converter','convertlib.php',277],['repository/googledocs','lib.php',65],['lib/htmlpurifier/HTMLPurifier','Doctype.php',48],['lib/zend/Zend/Validate/File','Extension.php',71],['mod/imscp','locallib.php',289],['lib/classes/session','memcache.php',50],['lib/horde/framework/Horde/Imap/Client','Cache.php',53],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','ImportantDecorator.php',21],['lib/zend/Zend/Service','Simpy.php',53],['lib/horde/framework/Horde/Imap/Client/Interaction','Server.php',91],['lib/zend/Zend/Gdata/Gapps','EmailListRecipientQuery.php',54],['lib/zend/Zend/Gdata/YouTube','PlaylistVideoEntry.php',55],['lib/zend/Zend/Gdata/Photos','CommentEntry.php',85],['lib/horde/framework/Horde/Exception','PermissionDenied.php',15],['lib/zend/Zend/Gdata/YouTube','InboxEntry.php',92],['lib/jabber/XMPP','XMPP_Old.php',45],['lib/horde/framework/Horde/Imap/Client/Data/Format','Nil.php',27],['backup/cc/cc_lib','cc_converter_label.php',28],['lib/phpexcel/PHPExcel/Style','Border.php',75],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','GetConferenceTemplateParticipantRequest.php',53],['enrol/manual','locallib.php',37],['enrol/manual','locallib.php',102],['admin/tool/assignmentupgrade','locallib.php',50],['admin/tool/assignmentupgrade','locallib.php',93],['lib/zend/Zend/Gdata/Exif/Extension','Distance.php',49],['lib/phpexcel/PHPExcel/Writer','PDF.php',46],['lib/zend/Zend/Gdata/Photos/Extension','Size.php',50],['lib/google/src/Google/Service','CloudMonitoring.php',42],['backup/util/xml/output','memory_xml_output.class.php',37],['lib/horde/framework/Horde/Imap/Client/Data','Thread.php',41],['lib/simplepie/library/SimplePie','Credit.php',81],['lib/zend/Zend/Service','Delicious.php',112],['lib/bennu','iCalendar_components.php',21],['lib/bennu','iCalendar_components.php',333],['lib/bennu','iCalendar_components.php',355],['lib/bennu','iCalendar_components.php',433],['lib/bennu','iCalendar_components.php',513],['lib/bennu','iCalendar_components.php',551],['lib/bennu','iCalendar_components.php',602],['lib/bennu','iCalendar_components.php',659],['lib/bennu','iCalendar_components.php',679],['lib','outputrenderers.php',117],['lib','outputrenderers.php',282],['lib','outputrenderers.php',405],['lib','outputrenderers.php',4280],['lib','outputrenderers.php',4533],['lib/zend/Zend/Service/Amazon','ListmaniaList.php',44],['lib/zend/Zend/Service','Flickr.php',54],['backup/util/helper','restore_decode_rule.class.php',47],['backup/util/helper','restore_decode_rule.class.php',192],['lib/mustache/src/Mustache/Exception','UnknownFilterException.php',22],['lib/google/src/Google/Logger','File.php',49],['backup','backup.class.php',146],['lib/zend/Zend/Gdata/App/Extension','Updated.php',43],['lib/zend/Zend/Gdata/YouTube','PlaylistVideoFeed.php',55],['auth/cas/CAS/CAS/PGTStorage','Db.php',122],['lib/phpexcel/PHPExcel/Chart','DataSeries.php',137],['lib/zend/Zend/Gdata/Geo','Feed.php',51],['lib/phpexcel/PHPExcel/Shared/trend','logarithmicBestFitClass.php',107],['backup/util/loggers','file_logger.class.php',35],['admin/roles/classes','admins_existing_selector.php',30],['lib/phpexcel/PHPExcel/Shared/JAMA','LUDecomposition.php',57],['lib/zend/Zend/Gdata/Extension','Reminder.php',48],['course/format/topics','renderer.php',38],['mod/lesson/classes','file_info.php',45],['question/type/calculatedmulti','edit_calculatedmulti_form.php',47],['lib/phpexcel/PHPExcel/Worksheet','AutoFilter.php',62],['lib/minify/lib/HTTP','Encoder.php',75],['lib/zend/Zend/Gdata/App/Extension','Name.php',43],['lib/google/src/Google/Service','Calendar.php',50],['question/type','questionbase.php',124],['question/type','questionbase.php',438],['question/type','questionbase.php',531],['question/type','questionbase.php',750],['question/type','questionbase.php',835],['question/type','questionbase.php',868],['question/type','questionbase.php',914],['question/type','questionbase.php',1013],['lib/dml','database_column_info.php',137],['lib/zend/Zend/Gdata/YouTube/Extension','Gender.php',44],['lib/zend/Zend/Service','Yahoo.php',49],['lib/zend/Zend/Service/Amazon','SimilarProduct.php',44],['lib/mustache/src/Mustache/Exception','SyntaxException.php',23],['lib/htmlpurifier/HTMLPurifier','URIDefinition.php',21],['lib/horde/framework/Horde','Stream.php',50],['lib/google/src/Google/Service','Analytics.php',76],['lib/horde/framework/Horde/Mail/Transport','Mock.php',76],['lib/xmldb','xmldb_file.php',43],['lib/zend/Zend/Gdata/YouTube','PlaylistListEntry.php',97],['lib/zend/Zend/Service/Amazon/Ec2','Response.php',78],['lib/zend/Zend/Soap/Wsdl/Strategy','Composite.php',60],['lib/google/src/Google/Service','Tasks.php',44],['lib/zend/Zend/XmlRpc','Response.php',68],['lib/horde/framework/Horde/Exception','NotFound.php',15],['lib/horde/framework/Horde/Mail/Rfc822','Address.php',66],['lib/zend/Zend/Gdata/Books','VolumeEntry.php',131],['question','previewlib.php',122],['mod/wiki','renderer.php',537],['lib/phpexcel/PHPExcel/Worksheet','RowIterator.php',62],['mod/assign','renderable.php',41],['mod/assign','renderable.php',71],['mod/assign','renderable.php',103],['mod/assign','renderable.php',139],['mod/assign','renderable.php',191],['mod/assign','renderable.php',242],['mod/assign','renderable.php',291],['mod/assign','renderable.php',393],['mod/assign','renderable.php',517],['mod/assign','renderable.php',576],['mod/assign','renderable.php',613],['mod/assign','renderable.php',653],['mod/assign','renderable.php',706],['mod/assign','renderable.php',760],['lib/mustache/src/Mustache','Autoloader.php',19],['lib/zend/Zend/Service/DeveloperGarden/Request/SmsValidation','Invalidate.php',46],['lib/zend/Zend/Service/Yahoo','ImageResult.php',97],['lib/phpexcel/PHPExcel/Worksheet','HeaderFooter.php',183],['mod/quiz/classes/question/bank','custom_view.php',44],['lib/htmlpurifier/HTMLPurifier/Token','Tag.php',33],['lib/zend/Zend/Amf/Adobe','Auth.php',56],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','FontFamily.php',11],['auth/cas/CAS/CAS','TypeMismatchException.php',43],['grade/report/singleview/classes/local/screen','screen.php',67],['lib/zend/Zend/Amf/Parse','Deserializer.php',45],['lib/zend/Zend/Service/Delicious','SimplePost.php',56],['lib/zend/Zend/Service/Technorati','ResultSet.php',112],['cache/classes','loaders.php',196],['cache/classes','loaders.php',1211],['cache/classes','loaders.php',1606],['lib/zend/Zend/Gdata/Gbase','Entry.php',62],['lib/zend/Zend/Validate','Identical.php',64],['lib/horde/framework/Horde/Mail/Transport','Sendmail.php',65],['cache/stores/mongodb','lib.php',116],['mod/quiz/report/statistics/classes','calculator.php',39],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','FrameTarget.php',19],['lib/zend/Zend/Gdata/App/Extension','Draft.php',44],['enrol/ldap','settingslib.php',32],['enrol/ldap','settingslib.php',90],['enrol/ldap','settingslib.php',204],['lib/zend/Zend/Service/DeveloperGarden/ConferenceCall','ConferenceDetail.php',54],['lib/zend/Zend/Service/Yahoo','InlinkDataResult.php',47],['lib/lessphp/Tree','UnicodeDescriptor.php',14],['lib/lessphp/Tree','Directive.php',20],['lib/zend/Zend/Service/Yahoo','VideoResult.php',118],['question/type/calculated','edit_calculated_form.php',51],['lib/classes','string_manager_install.php',43],['lib/google/src/Google/Service','GamesManagement.php',50],['lib/google/src/Google/Logger','Psr.php',37],['grade/report/history/classes/output','user_button.php',40],['lib','externallib.php',129],['lib','externallib.php',426],['lib','externallib.php',457],['lib','externallib.php',488],['lib','externallib.php',517],['lib','externallib.php',649],['lib','externallib.php',684],['lib','externallib.php',782],['backup/util/ui','base_ui_stage.class.php',67],['lib/zend/Zend/Validate','CreditCard.php',136],['lib/zend/Zend/Gdata/Spreadsheets','CellQuery.php',57],['lib/htmlpurifier/HTMLPurifier/AttrDef','Clone.php',18],['mod/quiz/accessrule','accessrulebase.php',52],['lib/mustache/src/Mustache','Context.php',20],['lib/zend/Zend/Service/DeveloperGarden/Request/VoiceButler','CallStatus.php',46],['lib/zend/Zend/Gdata/Spreadsheets','CellFeed.php',78],['backup/util/xml/parser/processors','progressive_parser_processor.class.php',57],['lib/lessphp/Tree','Color.php',15],['lib/zend/Zend/Service/StrikeIron','Base.php',56],['lib/zend/Zend/Gdata/Exif/Extension','FStop.php',49],['lib/htmlpurifier/HTMLPurifier/AttrTransform','BoolToCSS.php',24],['lib/horde/framework/Horde/Imap/Client/Ids','Map.php',44],['lib/zend/Zend/Service/Simpy','Tag.php',48],['lib/htmlpurifier/HTMLPurifier/AttrDef','Enum.php',30],['cache/classes','helper.php',90],['lib/zend/Zend/Soap','Wsdl.php',73],['lib/htmlpurifier/HTMLPurifier/Lexer','DOMLex.php',35],['lib/zend/Zend/Validate/Barcode','Code25interleaved.php',53],['webservice/soap','locallib.php',162],['lib/lessphp/Tree','Quoted.php',20],['lib/simplepie/library/SimplePie/Cache','Memcache.php',81],['lib/zend/Zend/Gdata/YouTube','ActivityEntry.php',88],['backup/controller','restore_controller.class.php',63],['backup/controller','restore_controller.class.php',517],['lib/zend/Zend/Service','Audioscrobbler.php',65],['lib/zend/Zend/Service/Flickr','ResultSet.php',82],['lib/mustache/src/Mustache/Logger','StreamLogger.php',44],['lib/zend/Zend/XmlRpc/Request','Stdin.php',47],['lib/zend/Zend/Service/DeveloperGarden/Request/SmsValidation','Validate.php',63],['mod/glossary','locallib.php',481],['lib/google/src/Google/Logger','Abstract.php',121],['lib/horde/framework/Horde/Support','Guid.php',24],['lib/zend/Zend/Http/Client/Adapter','Curl.php',92],['lib/google/src/Google/Service','Oauth2.php',50],['lib/phpmailer','moodle_phpmailer.php',47],['lib/zend/Zend/Validate/Barcode','Intelligentmail.php',47],['repository/skydrive','microsoftliveapi.php',50],['mod/workshop/allocation/manual','lib.php',51],['lib/zend/Zend/Validate/File','Exists.php',62],['lib/xhprof','xhprof_moodle.php',788],['question/classes/bank/search','category_condition.php',60],['lib/markdown','Markdown.php',96],['grade/report/grader','lib.php',104],['lib/zend/Zend/Gdata/YouTube/Extension','Control.php',48],['lib/zend/Zend/Validate','StringLength.php',79],['question/behaviour','behaviourbase.php',50],['backup/cc/cc_lib','cc_converter_forum.php',29],['lib/zend/Zend/Gdata/Photos/Extension','Nickname.php',50],['lib/zend/Zend/Gdata/Exif/Extension','Tags.php',169],['lib/zend/Zend/Uri','Http.php',108],['lib/zend/Zend/Gdata/YouTube/Extension','Hometown.php',44],['cache/stores/file','lib.php',117],['lib/zend/Zend/Service','Amazon.php',75],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Decorator.php',12],['lib/zend/Zend/Gdata/Media/Extension','MediaThumbnail.php',64],['lib/zend/Zend/Service/Yahoo','Image.php',56],['lib/zend/Zend/Gdata','Feed.php',87],['lib/google/src/Google/Service','Storage.php',54],['backup/cc/cc_lib','cc_asssesment.php',290],['backup/cc/cc_lib','cc_asssesment.php',345],['backup/cc/cc_lib','cc_asssesment.php',364],['backup/cc/cc_lib','cc_asssesment.php',415],['backup/cc/cc_lib','cc_asssesment.php',476],['backup/cc/cc_lib','cc_asssesment.php',486],['backup/cc/cc_lib','cc_asssesment.php',561],['backup/cc/cc_lib','cc_asssesment.php',585],['backup/cc/cc_lib','cc_asssesment.php',635],['backup/cc/cc_lib','cc_asssesment.php',668],['backup/cc/cc_lib','cc_asssesment.php',693],['backup/cc/cc_lib','cc_asssesment.php',788],['backup/cc/cc_lib','cc_asssesment.php',814],['backup/cc/cc_lib','cc_asssesment.php',838],['backup/cc/cc_lib','cc_asssesment.php',965],['backup/cc/cc_lib','cc_asssesment.php',971],['backup/cc/cc_lib','cc_asssesment.php',986],['backup/cc/cc_lib','cc_asssesment.php',1003],['backup/cc/cc_lib','cc_asssesment.php',1017],['backup/cc/cc_lib','cc_asssesment.php',1045],['backup/cc/cc_lib','cc_asssesment.php',1186],['backup/cc/cc_lib','cc_asssesment.php',1263],['backup/cc/cc_lib','cc_asssesment.php',1317],['backup/cc/cc_lib','cc_asssesment.php',1389],['backup/cc/cc_lib','cc_asssesment.php',1451],['backup/cc/cc_lib','cc_asssesment.php',1558],['backup/cc/cc_lib','cc_asssesment.php',1620],['backup/cc/cc_lib','cc_asssesment.php',1648],['backup/cc/cc_lib','cc_asssesment.php',1716],['backup/cc/cc_lib','cc_asssesment.php',2155],['backup/cc/cc_lib','cc_asssesment.php',2264],['backup/cc/cc_lib','cc_asssesment.php',2469],['admin/tool/uploadcourse/classes','course.php',111],['lib/zend/Zend/Gdata/Extension','Where.php',52],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','ListStyle.php',20],['lib/zend/Zend/Service/Amazon','S3.php',102],['lib/horde/framework/Horde/Stream','Existing.php',28],['backup/util/output','output_controller.class.php',44],['backup/cc/cc_lib','cc_version1.php',57],['question/classes/statistics/responses','analysis_for_question.php',58],['lib/zend/Zend/Service/Simpy','Link.php',104],['backup/converter/moodle1','handlerlib.php',120],['backup/converter/moodle1','handlerlib.php',1710],['backup/converter/moodle1','handlerlib.php',1902],['backup/converter/moodle1','handlerlib.php',2155],['cache','lib.php',66],['cache','lib.php',109],['cache','lib.php',138],['cache','lib.php',183],['lib/zend/Zend/Gdata','Calendar.php',77],['lib/zend/Zend/Validate','Date.php',71],['backup/util/structure','base_atom.class.php',41],['backup/util/structure','base_atom.class.php',114],['backup/util/structure','base_atom.class.php',135],['backup/util/structure','base_atom.class.php',156],['lib/xmldb','xmldb_table.php',49],['lib/htmlpurifier/HTMLPurifier','Encoder.php',10],['backup/cc','cc112moodle.php',59],['lib/zend/Zend/XmlRpc/Client','ServerIntrospection.php',43],['lib/zend/Zend/Gdata/Photos','PhotoFeed.php',147],['backup/controller','backup_controller.class.php',68],['backup/controller','backup_controller.class.php',407],['lib','adminlib.php',792],['lib','adminlib.php',1139],['lib','adminlib.php',1213],['lib','adminlib.php',1356],['lib','adminlib.php',1553],['lib','adminlib.php',1925],['lib','adminlib.php',2037],['lib','adminlib.php',2103],['lib','adminlib.php',2204],['lib','adminlib.php',2246],['lib','adminlib.php',2284],['lib','adminlib.php',2372],['lib','adminlib.php',2406],['lib','adminlib.php',2563],['lib','adminlib.php',2648],['lib','adminlib.php',2877],['lib','adminlib.php',3033],['lib','adminlib.php',3175],['lib','adminlib.php',3266],['lib','adminlib.php',3430],['lib','adminlib.php',3510],['lib','adminlib.php',3621],['lib','adminlib.php',3772],['lib','adminlib.php',4001],['lib','adminlib.php',4068],['lib','adminlib.php',4286],['lib','adminlib.php',4315],['lib','adminlib.php',4344],['lib','adminlib.php',4368],['lib','adminlib.php',4398],['lib','adminlib.php',4434],['lib','adminlib.php',4469],['lib','adminlib.php',4501],['lib','adminlib.php',4591],['lib','adminlib.php',4624],['lib','adminlib.php',4680],['lib','adminlib.php',4704],['lib','adminlib.php',4730],['lib','adminlib.php',4753],['lib','adminlib.php',4770],['lib','adminlib.php',4815],['lib','adminlib.php',4878],['lib','adminlib.php',4913],['lib','adminlib.php',4956],['lib','adminlib.php',5039],['lib','adminlib.php',5169],['lib','adminlib.php',5211],['lib','adminlib.php',5256],['lib','adminlib.php',5313],['lib','adminlib.php',5329],['lib','adminlib.php',5385],['lib','adminlib.php',5610],['lib','adminlib.php',5664],['lib','adminlib.php',5718],['lib','adminlib.php',5735],['lib','adminlib.php',5783],['lib','adminlib.php',5825],['lib','adminlib.php',5876],['lib','adminlib.php',5932],['lib','adminlib.php',6161],['lib','adminlib.php',6341],['lib','adminlib.php',6435],['lib','adminlib.php',6582],['lib','adminlib.php',7206],['lib','adminlib.php',7658],['lib','adminlib.php',7841],['lib','adminlib.php',8128],['lib','adminlib.php',8275],['lib','adminlib.php',8435],['lib','adminlib.php',8582],['lib','adminlib.php',8746],['lib','adminlib.php',8939],['lib','adminlib.php',8993],['lib','adminlib.php',9055],['lib','adminlib.php',9100],['mod/workshop/eval/best','lib.php',44],['lib/zend/Zend/Gdata/Calendar','EventQuery.php',91],['lib/zend/Zend/Service/Technorati','TagResult.php',94],['lib/google/src/Google/Cache','Null.php',26],['enrol/flatfile','adminlib.php',35],['lib/phpexcel/PHPExcel/Chart','PlotArea.php',52],['mod/quiz/report/statistics','statistics_question_table.php',49],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','AddConferenceTemplateParticipantRequest.php',53],['mod/data','lib.php',66],['mod/data','lib.php',2164],['mod/data','lib.php',2438],['mod/data','lib.php',2459],['question/classes/statistics/questions','calculated_for_subquestion.php',57],['lib/horde/framework/Horde/Crypt/Blowfish','Base.php',56],['lib/classes/session','memcached.php',51],['lib/google/src/Google/IO','Abstract.php',37],['availability/classes','info_section.php',40],['lib/zend/Zend/Gdata/YouTube/Extension','Books.php',44],['lib/phpexcel/PHPExcel/Shared/JAMA','QRDecomposition.php',48],['lib/filestorage','stored_file.php',63],['grade/report/history/classes/output','tablelog.php',72],['lib/classes','plugin_manager.php',71],['lib/google/src/Google','Model.php',32],['lib/zend/Zend/Gdata/YouTube/Extension','Relationship.php',44],['lib/horde/framework/Horde/Crypt','Blowfish.php',54],['lib/filebrowser','virtual_root_file.php',45],['auth/cas/CAS/CAS','OutOfSequenceBeforeClientException.php',47],['availability/condition/grade/classes','condition.php',46],['lib/phpexcel/PHPExcel/CachedObjectStorage','DiscISAM.php',188],['admin/roles/classes','check_capability_table.php',40],['lib/zend/Zend/Gdata/Media','Entry.php',60],['lib/zend/Zend/Gdata','MimeFile.php',43],['admin/tool/xmldb/actions','XMLDBAction.class.php',56],['backup/cc/cc_lib','cc_resources.php',102],['lib/zend/Zend/Loader/Autoloader','Resource.php',62],['lib/phpexcel/PHPExcel/Worksheet','PageMargins.php',80],['backup/util/xml/parser/processors','simplified_parser_processor.class.php',46],['lib/simplepie/library/SimplePie','IRI.php',252],['lib/htmlpurifier/HTMLPurifier','ContentSets.php',33],['lib/htmlpurifier/HTMLPurifier','HTMLModuleManager.php',68],['lib/htmlpurifier/HTMLPurifier/Token','Comment.php',19],['lib/zend/Zend/Gdata/Calendar/Extension','SendEventNotifications.php',44],['lib/zend/Zend/Service/WindowsAzure/Storage','TableEntity.php',66],['lib/zend/Zend/Service/DeveloperGarden/Request/LocalSearch','LocalSearchRequest.php',60],['mod/quiz/report/overview','overview_table.php',41],['lib/zend/Zend/Gdata/Photos/Extension','Client.php',51],['backup/cc/cc_lib','cc_converters.php',75],['lib/google/src/Google/Service','AdSense.php',68],['lib/zend/Zend/Gdata','Entry.php',48],['lib','filterlib.php',74],['lib','filterlib.php',382],['lib/lessphp/Tree','Alpha.php',13],['lib/zend/Zend/Gdata','DublinCore.php',51],['lib/horde/framework/Horde/Support','Stack.php',18],['lib/lessphp/Tree','Selector.php',31],['lib/zend/Zend/Service','Nirvanix.php',47],['lib/dtl','file_xml_database_importer.php',34],['mod/workshop','mod_form.php',44],['lib/zend/Zend/Service/Technorati','CosmosResultSet.php',73],['lib/horde/framework/Horde/Imap/Client/Data','AclRights.php',39],['lib/zend/Zend/Gdata/YouTube/Extension','Age.php',44],['repository/s3','S3.php',176],['repository/s3','S3.php',1994],['repository/s3','S3.php',2346],['lib/lessphp/Tree','Ruleset.php',45],['lib/zend/Zend/Service/Simpy','NoteSet.php',47],['backup/util/xml/output','xml_output.class.php',52],['backup/util/xml/output','xml_output.class.php',158],['lib/google/src/Google/Service','Pubsub.php',44],['lib/alfresco/Service','Node.php',51],['lib/zend/Zend/Service','Technorati.php',79],['lib/horde/framework/Horde/Imap/Client/Data','BaseSubject.php',39],['admin/tool/monitor/classes','subscription.php',43],['lib/zend/Zend/Gdata/App/Extension','Person.php',61],['backup/moodle2','backup_course_task.class.php',39],['grade/report/singleview/classes/local/ui','text_attribute.php',42],['lib/dml','sqlsrv_native_moodle_recordset.php',40],['lib/zend/Zend/Gdata/YouTube','ContactEntry.php',61],['lib/zend/Zend/Gdata/Extension','AttendeeType.php',44],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','Pixels.php',17],['mod/assignment/backup/moodle1','lib.php',223],['lib/zend/Zend/Gdata/Health/Extension','Ccr.php',43],['lib/horde/framework/Horde/Mail/Rfc822','Identification.php',34],['mod/quiz','mod_form.php',48],['backup/util/structure','restore_path_element.class.php',47],['backup/util/structure','restore_path_element.class.php',128],['lib/zend/Zend/Gdata/Calendar','EventFeed.php',55],['lib/zend/Zend/Gdata/Spreadsheets','DocumentQuery.php',57],['availability/tests/fixtures','mock_condition.php',52],['lib/lessphp','Visitor.php',14],['mod/assign/feedback/editpdf/classes','widget.php',53],['lib/minify/lib/Minify/Cache','File.php',9],['lib/zend/Zend/Gdata/Exif','Entry.php',64],['grade/tests','reportlib_test.php',36],['mod/workshop/allocation','lib.php',103],['lib/zend/Zend/Service/WindowsAzure/Storage','BlobInstance.php',57],['lib/zend/Zend/Gdata/Photos/Extension','User.php',50],['admin/tool/uploadcourse/classes','tracker.php',72],['lib/zend/Zend/Service/Technorati','GetInfoResult.php',52],['lib/zend/Zend/Service/WindowsAzure','SessionHandler.php',61],['lib/zend/Zend/Gdata/YouTube/Extension','Hobbies.php',44],['lib/mustache/src/Mustache/Loader','ArrayLoader.php',31],['lib/zend/Zend/Gdata/Photos/Extension','Width.php',50],['admin/roles/classes','view_role_definition_table.php',28],['lib/phpunit/classes','arraydataset.php',45],['lib/horde/framework/Horde/Imap/Client/Data','Sync.php',133],['lib/zend/Zend','Exception.php',34],['backup/util/xml/parser/tests','parser_test.php',797],['lib/zend/Zend/Validate/File','ImageSize.php',113],['lib/zend/Zend/Validate','Alnum.php',65],['lib/zend/Zend/Service/Flickr','Image.php',62],['lib/phpexcel/PHPExcel/Calculation','Function.php',71],['lib/horde/framework/Horde/Support','Inflector.php',115],['lib/horde/framework/Horde/Exception','Pear.php',22],['question/classes/bank','random_question_loader.php',61],['lib/phpexcel/PHPExcel/Reader','HTML.php',104],['lib/mustache/src/Mustache/Loader','InlineLoader.php',57],['lib/zend/Zend/Gdata/Photos/Extension','QuotaLimit.php',51],['admin/tool/uploadcourse/classes','processor.php',122],['lib/zend/Zend/Gdata/Spreadsheets','WorksheetFeed.php',40],['lib/lessphp/Tree','Rule.php',24],['lib/zend/Zend/Service/Amazon','EditorialReview.php',44],['lib/zend/Zend/Service/ReCaptcha','MailHide.php',86],['lib/htmlpurifier/HTMLPurifier/AttrTransform','NameSync.php',11],['lib/classes/progress','display_if_slow.php',60],['availability/condition/group/classes','condition.php',43],['lib/zend/Zend/Gdata/Photos/Extension','Location.php',50],['backup/moodle2','restore_settingslib.php',125],['lib/filebrowser','file_info.php',43],['repository/equella','lib.php',42],['lib/zend/Zend/Http','Client.php',242],['lib/alfresco/Service','ChildAssociation.php',30],['lib/zend/Zend/Gdata/DublinCore/Extension','Subject.php',44],['lib/zend/Zend/Gdata/App/Extension','Category.php',46],['badges/lib','awardlib.php',55],['admin/roles/classes','override_permissions_table_advanced.php',31],['lib/mustache/src/Mustache','Template.php',29],['backup/util/helper','restore_roles_parser_processor.class.php',39],['lib','csslib.php',1501],['lib','csslib.php',1587],['lib','csslib.php',2068],['lib','csslib.php',2136],['lib','csslib.php',2242],['lib/zend/Zend/Service/WindowsAzure/Storage','QueueInstance.php',49],['mod/lti/service/toolproxy/classes/local/service','toolproxy.php',41],['admin/roles/classes','define_role_table_advanced.php',46],['backup/moodle2','restore_section_task.class.php',42],['mod/lti/service/toolsettings/classes/local/resource','contextsettings.php',44],['lib/google/src/Google','Client.php',71],['lib/simplepie/library/SimplePie/Content/Type','Sniffer.php',69],['backup/moodle2','restore_plugin.class.php',43],['lib/simplepie/library/SimplePie','Registry.php',99],['backup/cc','cc2moodle.php',105],['lib/classes/lock','postgres_lock_factory.php',81],['lib/phpexcel/PHPExcel/Shared','XMLWriter.php',56],['lib/htmlpurifier/HTMLPurifier','Length.php',41],['lib/zend/Zend/Validate/File','Count.php',92],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',54],['lib/editor/atto','adminlib.php',109],['lib/google/src/Google/Service','Admin.php',40],['lib/dml','moodle_transaction.php',40],['backup/util/plan','restore_structure_step.class.php',46],['question/engine','questionattempt.php',166],['question/engine','questionattempt.php',1513],['question/engine','questionattempt.php',1599],['question/engine','questionattempt.php',1684],['lib/zend/Zend/Service/Technorati','Weblog.php',152],['lib/zend/Zend/Service/DeveloperGarden/ConferenceCall','ParticipantStatus.php',48],['lib/htmlpurifier/HTMLPurifier/AttrDef','URI.php',23],['backup/util/helper','restore_decode_content.class.php',50],['backup/util/helper','restore_decode_content.class.php',125],['lib/google/src/Google/Cache','File.php',39],['lib/google/src/Google/Http','Request.php',55],['backup/moodle2','backup_block_task.class.php',43],['lib/simplepie/library/SimplePie','Source.php',61],['lib/google/src/Google/Service','Translate.php',40],['availability/classes','capability_checker.php',49],['lib','navigationlib.php',145],['lib','navigationlib.php',1012],['lib','navigationlib.php',2814],['lib','navigationlib.php',3075],['lib','navigationlib.php',3409],['lib','navigationlib.php',4775],['lib','navigationlib.php',4956],['lib/zend/Zend/Gdata/YouTube/Extension','MediaCredit.php',64],['lib/dml','pdo_moodle_database.php',42],['lib/zend/Zend/Gdata/YouTube/Extension','ReleaseDate.php',44],['lib/htmlpurifier/HTMLPurifier/Printer','ConfigForm.php',40],['lib/htmlpurifier/HTMLPurifier/Printer','ConfigForm.php',221],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','NewParticipantRequest.php',53],['lib/zend/Zend/Gdata/Spreadsheets/Extension','RowCount.php',49],['lib/zend/Zend/Validate/File','IsCompressed.php',53],['lib/zend/Zend/Gdata/Photos/Extension','MaxPhotosPerAlbum.php',51],['lib/zend/Zend/Gdata/Extension','When.php',52],['question/classes/bank/search','hidden_condition.php',42],['report/loglive/classes','renderable.php',73],['mod/lti/classes/local/ltiservice','response.php',58],['lib/zend/Zend/Gdata/Extension','Recurrence.php',43],['lib/zend/Zend/Gdata/Books/Extension','BooksLink.php',41],['backup/util/loggers','database_logger.class.php',40],['lib/phpexcel/PHPExcel/CachedObjectStorage','Wincache.php',250],['lib/phpexcel/PHPExcel','HashTable.php',52],['lib/horde/framework/Horde/Imap/Client/Namespace','List.php',34],['lib/htmlpurifier/HTMLPurifier','Zipper.php',25],['lib/classes/update','deployer.php',42],['lib/zend/Zend/Gdata/YouTube','VideoFeed.php',53],['lib/zend/Zend/Service/DeveloperGarden/Request/BaseUserService','GetQuotaInformation.php',40],['lib/minify/lib','CSSmin.php',43],['lib/zend/Zend/Validate/File','Crc32.php',60],['mod/feedback/item','feedback_item_class.php',20],['question/engine/upgrade','upgradelib.php',280],['question/engine/upgrade','upgradelib.php',381],['lib/simplepie/library/SimplePie','Copyright.php',73],['lib/zend/Zend/Gdata/Spreadsheets','SpreadsheetEntry.php',43],['lib/google/src/Google/Service','Dns.php',50],['lib/zend/Zend/Gdata/Gapps','Query.php',57],['lib/zend/Zend/Gdata/YouTube/Extension','School.php',44],['lib/mustache/src/Mustache','HelperCollection.php',19],['mod/assign','gradingtable.php',68],['backup/util/xml/output','file_xml_output.class.php',37],['lib','upgradelib.php',45],['lib','upgradelib.php',61],['lib','upgradelib.php',76],['lib','upgradelib.php',94],['lib','upgradelib.php',111],['lib/zend/Zend/Service','Akismet.php',77],['lib','googleapi.php',52],['lib','googleapi.php',243],['lib/zend/Zend/Service/Yahoo','ResultSet.php',84],['lib/classes/message/inbound','processing_failed_exception.php',36],['lib','portfoliolib.php',101],['lib/lessphp/Tree','Import.php',30],['lib/phpexcel/PHPExcel/Shared/JAMA','SingularValueDecomposition.php',53],['lib/tests/fixtures','test_renderer_factory.php',41],['mod/lesson','editpage_form.php',41],['grade/report','lib.php',156],['lib/zend/Zend/XmlRpc/Request','Http.php',53],['lib/filebrowser','file_info_stored.php',51],['lib/phpexcel/PHPExcel/Style','Protection.php',57],['lib/google/src/Google','Config.php',30],['lib/horde/framework/Horde/Imap/Client/Exception','ServerResponse.php',44],['lib/zend/Zend/Validate','LessThan.php',58],['grade/export','lib.php',60],['lib/zend/Zend/Gdata/YouTube/Extension','PlaylistTitle.php',44],['availability/classes','tree.php',118],['lib/htmlpurifier/HTMLPurifier/Node','Text.php',35],['question/classes/statistics/responses','analysis_for_subpart.php',50],['lib/zend/Zend/Validate','InArray.php',65],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','BackgroundPosition.php',57],['lib/zend/Zend/Gdata/Photos/Extension','Height.php',50],['lib/zend/Zend/Gdata/Gapps','Error.php',76],['backup/util/helper','restore_decode_processor.class.php',47],['backup/util/helper','restore_decode_processor.class.php',182],['lib/phpexcel/PHPExcel','Chart.php',150],['lib/google/src/Google/Service','Replicapool.php',48],['lib/zend/Zend/Gdata/Media/Extension','MediaRating.php',49],['lib/zend/Zend/Gdata/YouTube','VideoEntry.php',175],['admin/tool/installaddon/classes','pluginfo_client.php',68],['admin/tool/installaddon/classes','pluginfo_client.php',206],['lib/google/src/Google/Service','Resourceviews.php',54],['admin/tool/log/store/legacy/classes/log','store.php',33],['backup/moodle2','backup_section_task.class.php',40],['lib/phpexcel/PHPExcel/Worksheet','CellIterator.php',68],['question/type/tests','question_first_matching_answer_grading_strategy_test.php',40],['repository/youtube','lib.php',40],['lib/tcpdf/include/barcodes','datamatrix.php',229],['lib/testing/generator','component_generator_base.php',45],['lib/zend/Zend/Gdata/DublinCore/Extension','Format.php',44],['lib','badgeslib.php',133],['admin/tool/installaddon/classes','installer.php',488],['admin/tool/installaddon/classes','installer.php',745],['lib/zend/Zend/XmlRpc','Client.php',122],['lib/mustache/src/Mustache','LambdaHelper.php',24],['admin/roles/classes','permissions_table.php',38],['lib/jabber/XMPP','XMLObj.php',76],['lib','coursecatlib.php',197],['lib','coursecatlib.php',2668],['question/type','edit_question_form.php',96],['lib/zend/Zend/Gdata','MediaMimeStream.php',80],['mod/quiz/report/responses','last_responses_table.php',39],['lib/zend/Zend/Gdata/Photos/Extension','Timestamp.php',51],['lib','setuplib.php',106],['lib','setuplib.php',158],['lib','setuplib.php',174],['lib','setuplib.php',194],['lib','setuplib.php',224],['lib','setuplib.php',246],['lib','setuplib.php',262],['lib','setuplib.php',284],['lib','setuplib.php',303],['lib','setuplib.php',321],['lib/google/src/Google/Cache','Apc.php',35],['mod/lti/service/toolsettings/classes/local/service','toolsettings.php',41],['lib/htmlpurifier/HTMLPurifier','ErrorCollector.php',57],['lib/lessphp/Tree','Unit.php',16],['lib/zend/Zend/Service/DeveloperGarden/Request/VoiceButler','TearDownCall.php',46],['lib/minify/lib/HTTP','ConditionalGet.php',109],['lib/phpexcel/PHPExcel/CachedObjectStorage','SQLite.php',261],['lib/htmlpurifier/HTMLPurifier','Printer.php',21],['lib/zend/Zend/Service/Amazon','CustomerReview.php',69],['lib/zend/Zend/Gdata/YouTube/Extension','QueryString.php',44],['lib/zend/Zend/Gdata/Gapps/Extension','Name.php',65],['mod/assign','adminlib.php',41],['mod/assign','adminlib.php',102],['lib/lessphp/Tree','RulesetCall.php',14],['lib/zend/Zend/Gdata/Extension','Rating.php',49],['repository/alfresco','lib.php',42],['lib/zend/Zend/Service/Technorati','SearchResultSet.php',49],['lib/zend/Zend/Gdata/Photos','UserQuery.php',71],['enrol','renderer.php',426],['enrol','renderer.php',728],['badges/criteria','award_criteria_course.php',47],['lib/zend/Zend/Gdata/Extension','RecurrenceException.php',56],['lib/phpexcel/PHPExcel/Style','Fill.php',89],['lib/zend/Zend/Service/Technorati','TagsResult.php',60],['lib/horde/framework/Horde/Imap/Client/Interaction','Pipeline.php',60],['lib/google/src/Google/Service','Exception.php',12],['lib/zend/Zend/Gdata','Spreadsheets.php',115],['lib/xmldb','xmldb_index.php',56],['question/classes/statistics/responses','analyser.php',69],['lib/htmlpurifier/HTMLPurifier/Node','Comment.php',19],['lib/zend/Zend/Gdata/Photos/Extension','Position.php',50],['lib/google/src/Google/Auth','Simple.php',32],['lib/zend/Zend/Gdata/Geo/Extension','GmlPoint.php',62],['lib/horde/framework/Horde/Crypt/Blowfish/Php','Base.php',318],['lib/horde/framework/Horde/Imap/Client/Cache','Backend.php',33],['lib/zend/Zend/Rest','Route.php',71],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','UpdateConferenceTemplateParticipantRequest.php',60],['question','category_class.php',58],['lib/classes/progress','display.php',48],['lib/horde/framework/Horde/Imap/Client/Exception','NoSupportExtension.php',33],['lib/zend/Zend/Gdata/App/Extension','Rights.php',43],['lib/adodb','adodb-active-record.inc.php',113],['lib/horde/framework/Horde/Exception','Wrapped.php',16],['lib/zend/Zend/Validate','NotEmpty.php',77],['question/type/calculated','datasetitems_form.php',72],['lib/horde/framework/Horde/Support','ObjectStub.php',29],['lib/dml','pdo_moodle_recordset.php',41],['backup/cc/cc_lib','cc_converter_folder.php',28],['lib/horde/framework/Horde/Mime','Mail.php',93],['lib/zend/Zend/Gdata/Calendar','ListEntry.php',85],['admin/tool/monitor/classes','rule.php',44],['backup/cc/cc_lib','cc_utils.php',313],['backup/cc/cc_lib','cc_utils.php',381],['backup/cc/cc_lib','cc_utils.php',437],['lib/horde/framework/Horde/Imap/Client/Auth','DigestMD5.php',69],['lib/zend/Zend/Gdata/Geo','Entry.php',55],['lib/zend/Zend/Gdata/YouTube/Extension','Link.php',48],['lib','flickrlib.php',53],['lib/zend/Zend/Gdata/YouTube/Extension','AboutMe.php',44],['lib/zend/Zend/Service/DeveloperGarden','Credential.php',54],['grade/report/overview','lib.php',76],['lib/simplepie/library/SimplePie','File.php',68],['backup/moodle2','backup_plugin.class.php',44],['lib/zend/Zend/Gdata/Extension','ExtendedProperty.php',46],['backup/cc/cc_lib','cc_assesment_sfib.php',27],['rating','lib.php',114],['rating','lib.php',1070],['lib','dtllib.php',66],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Cache.php',68],['lib/mustache/src/Mustache/Loader','CascadingLoader.php',20],['question/engine','datalib.php',68],['question/engine','datalib.php',1330],['question/engine','datalib.php',1631],['question/engine','datalib.php',1739],['question/engine','datalib.php',1869],['question/engine','datalib.php',1940],['lib/phpexcel/PHPExcel/Shared/trend','bestFitClass.php',405]], 1047],
'role_context_capabilities': ['role_context_capabilities', 'This function pulls out all the resolved capabilities (overrides and defaults) of a role used in capability overrides in contexts at a given context. ', [['lib','accesslib.php',2861]], 1],
'instance': ['instance', 'Retrieve sole instance of the registry. ', [['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29],['lib/classes','useragent.php',101],['backup/cc','validator.php',35],['lib/portfolio','exporter.php',251],['lib/tests','update_deployer_test.php',69],['lib/tests','string_manager_standard_test.php',124],['lib','modinfolib.php',373],['','mdeploy.php',96],['cache','disabledlib.php',171],['cache','disabledlib.php',296],['admin/tool/installaddon/classes','validator.php',85],['cache/classes','config.php',87],['course/format','lib.php',156],['lib','accesslib.php',6184],['lib','accesslib.php',6436],['lib','accesslib.php',6614],['lib','accesslib.php',6868],['lib','accesslib.php',7129],['lib','accesslib.php',7341],['cache','locallib.php',52],['lib/htmlpurifier','HTMLPurifier.php',251],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['cache/classes','helper.php',76],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['lib/classes','plugin_manager.php',83],['lib','filterlib.php',81],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/classes/update','deployer.php',54],['admin/tool/installaddon/classes','pluginfo_client.php',37],['admin/tool/installaddon/classes','installer.php',40],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443]], 3942],
'is_inside_frontpage': ['is_inside_frontpage', 'Check if context is the front page context or a context inside it ', [['lib','accesslib.php',2926]], 4],
'get_records_sql': ['get_records_sql', 'Get a number of records as an array of objects using a SQL statement. ', [['lib/dml','pgsql_native_moodle_database.php',732],['lib/dml','oci_native_moodle_database.php',1102],['lib/dml','sqlsrv_native_moodle_database.php',823],['lib/dml','mssql_native_moodle_database.php',741],['lib/dml','mysqli_native_moodle_database.php',1049],['lib/dml/tests','dml_test.php',5424],['lib/dml','pdo_moodle_database.php',308]], 678],
'get_roles_with_capability': ['get_roles_with_capability', 'Get the roles that have a given capability assigned to it ', [['lib','accesslib.php',1621]], 14],
'is_role_switched': ['is_role_switched', 'Checks if the user has switched roles within the given course. ', [['lib','accesslib.php',4385]], 11],
'normalize_component': ['normalize_component', 'Normalize the component name using the "frankenstyle" rules. ', [['lib/classes','component.php',968],['lib','deprecatedlib.php',528]], 85],
'insert_context_record': ['insert_context_record', 'Utility method for context creation ', [['lib','accesslib.php',5558]], 12],
'execute': ['execute', 'Exceptionally override the execute method, so, based in the activity_included setting, we are able to skip the execution of one task completely ', [['backup/moodle2','backup_activity_task.class.php',205],['backup/converter/moodle1','backuplib.php',10],['filter/tex','latex.php',60],['backup/util/plan','base_plan.class.php',158],['mod/lti/service/toolsettings/classes/local/resource','systemsettings.php',61],['mod/lti/service/toolsettings/classes/local/resource','linksettings.php',63],['mod/lti/service/profile/classes/local/resource','profile.php',76],['webservice','lib.php',1772],['lib/classes/task','context_cleanup_task.php',41],['lib/adodb','adodb.inc.php',967],['enrol/imsenterprise/classes/task','cron_task.php',43],['admin/tool/messageinbound/classes/task','cleanup_task.php',47],['lib/classes/task','calendar_cron_task.php',40],['mod/workshop/allocation/random','lib.php',83],['lib/classes/task','registration_cron_task.php',40],['lib/classes/task','portfolio_cron_task.php',40],['lib/htmlpurifier/HTMLPurifier/Strategy','Composite.php',21],['lib/google/src/Google/Http','Batch.php',56],['backup/converter/imscc11','lib.php',85],['lib/classes/task','file_temp_cleanup_task.php',40],['filter/tex','texdebug.php',287],['admin/tool/monitor/classes','notification_task.php',39],['lib/classes/task','stats_cron_task.php',40],['lib/classes/task','backup_cleanup_task.php',40],['admin/tool/log/store/legacy/classes/task','cleanup_task.php',40],['backup/util/ui','backup_ui.class.php',122],['lib/dml','pgsql_native_moodle_database.php',665],['lib/classes/task','messaging_cleanup_task.php',40],['lib/zend/Zend/Service/WindowsAzure/RetryPolicy','RetryN.php',68],['lib/classes/task','session_cleanup_task.php',40],['lib/classes/task','completion_cron_task.php',40],['lib/dml','oci_native_moodle_database.php',1009],['backup/util/plan','base_task.class.php',162],['lib/adodb/drivers','adodb-pdo.inc.php',464],['backup/util/plan','backup_plan.class.php',112],['backup/util/ui','restore_ui.class.php',206],['backup/converter/imscc11','backuplib.php',42],['backup/moodle2','restore_activity_task.class.php',183],['','mdeploy.php',743],['lib/dml','sqlsrv_native_moodle_database.php',745],['lib/htmlpurifier/HTMLPurifier/Strategy','MakeWellFormed.php',66],['lib/google/src/Google/Http','REST.php',28],['admin/tool/langimport/classes/task','update_langpacks_task.php',44],['mod/lti/service/toolproxy/classes/local/resource','toolproxy.php',62],['lib/classes/task','plagiarism_cron_task.php',40],['admin/tool/messageinbound/classes/task','pickup_task.php',47],['backup/util/plan','backup_structure_step.class.php',50],['mod/forum/classes/task','cron_task.php',39],['mod/workshop/allocation/scheduled','lib.php',128],['lib/classes/task','file_trash_cleanup_task.php',40],['backup/util/plan','restore_execution_step.class.php',25],['lib/tests/fixtures','task_fixtures.php',30],['lib/tests/fixtures','task_fixtures.php',39],['lib/tests/fixtures','task_fixtures.php',48],['lib/tests/fixtures','task_fixtures.php',57],['admin/tool/installaddon/classes','validator.php',114],['backup/util/plan','backup_execution_step.class.php',25],['lib/classes/task','password_reset_cleanup_task.php',40],['lib/classes/task','automated_backup_task.php',40],['backup/converter/moodle1','lib.php',142],['lib/htmlpurifier/HTMLPurifier/Strategy','ValidateAttributes.php',16],['lib/classes/task','create_contexts_task.php',40],['backup/util/plan','restore_plan.class.php',159],['backup/converter/imscc1','lib.php',84],['lib/dml','mssql_native_moodle_database.php',662],['admin/tool/log/store/standard/classes/task','cleanup_task.php',40],['lib/classes/task','cache_cleanup_task.php',40],['lib/classes/task','badges_cron_task.php',40],['lib/classes/task','cache_cron_task.php',40],['backup/util/interfaces','executable.class.php',32],['lib/htmlpurifier/HTMLPurifier/Strategy','FixNesting.php',41],['lib/adodb/drivers','adodb-oci8po.inc.php',52],['lib/classes/task','question_cron_task.php',40],['lib/zend/Zend/Service/WindowsAzure/RetryPolicy','NoRetry.php',37],['lib/dml','mysqli_native_moodle_database.php',955],['lib/htmlpurifier/HTMLPurifier/Strategy','RemoveForeignElements.php',20],['backup/util/plan/tests/fixtures','plan_fixtures.php',47],['backup/util/plan/tests/fixtures','plan_fixtures.php',55],['lib/classes/task','events_cron_task.php',40],['lib/classes/task','delete_unconfirmed_users_task.php',40],['lib/adodb/drivers','adodb-oci8.inc.php',786],['backup/converter/imscc1','backuplib.php',10],['lib/classes/task','tag_cron_task.php',40],['lib/classes/task','blog_cron_task.php',40],['lib/classes/task','send_failed_login_notifications_task.php',43],['lib/classes/task','grade_cron_task.php',40],['lib/dml/tests','dml_test.php',5422],['admin/tool/uploadcourse/classes','processor.php',174],['backup/moodle2','restore_section_task.class.php',87],['mod/lti/service/toolsettings/classes/local/resource','contextsettings.php',62],['lib/google/src/Google','Client.php',545],['backup/util/plan','restore_structure_step.class.php',62],['lib/classes/task','legacy_plugin_cron_task.php',42],['lib/dml','pdo_moodle_database.php',226],['lib/classes/task','check_for_updates_task.php',40],['backup/util/helper','restore_decode_processor.class.php',73],['backup/moodle2','backup_section_task.class.php',97],['webservice/amf/testclient','AMFTester.mxml',282],['lib/classes/task','delete_incomplete_users_task.php',40],['mod/assign','adminlib.php',342],['lib/classes/task','send_new_user_passwords_task.php',40],['admin/tool/monitor/classes/task','clean_events.php',41]], 733],
'allow_assign': ['allow_assign', 'Creates a record in the role_allow_assign table ', [['lib','accesslib.php',3349]], 3],
'load_course_context': ['load_course_context', 'Add to the access ctrl array the data needed by a user for a given course. ', [['lib','accesslib.php',910]], 2],
'require': ['require', '', [['lib/yuilib/3.17.2/timers','timers-debug.js',27],['lib/yuilib/3.17.2/timers','timers.js',27]], 454],
'set_cache_flag': ['set_cache_flag', 'Set a volatile flag ', [['lib','moodlelib.php',1679]], 14],
'create_instances': ['create_instances', 'Create all context instances at the given level and above. ', [['lib','accesslib.php',5955],['backup/cc','cc2moodle.php',609]], 11],
'reset_levels': ['reset_levels', 'Reset internal context levels array. ', [['lib','accesslib.php',5852]], 2],
'set_role_contextlevels': ['set_role_contextlevels', 'Set the context levels at which a particular role can be assigned. Throws exceptions in case of error. ', [['lib','accesslib.php',3686]], 13],
'get_all_risks': ['get_all_risks', 'Returns an array of all the known types of risk The array keys can be used, for example as CSS class names, or in calls to print_risk_icon. The values are the corresponding RISK_ constants. ', [['lib','accesslib.php',2832]], 3],
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pgsql_native_moodle_database.php',1137],['lib/dml','oci_native_moodle_database.php',1355],['lib/dml','sqlsrv_native_moodle_database.php',1081],['lib/dml','mssql_native_moodle_database.php',1003],['lib/dml','mysqli_native_moodle_database.php',1397],['lib/dml/tests','dml_test.php',5430],['lib/dml','pdo_moodle_database.php',460]], 565],
'get_plugin_list': ['get_plugin_list', 'Get list of plugins of given type. ', [['lib/classes','component.php',781],['lib','deprecatedlib.php',467],['admin/tool/monitor/classes','eventlist.php',176]], 184],
'get_switchable_roles': ['get_switchable_roles', 'Gets a list of roles that this user can switch to in a context ', [['lib','accesslib.php',3466]], 4],
'close': ['close', 'Close the connection to the server ', [['lib/zend/Zend/Http/Client/Adapter','Socket.php',486],['lib/tests','completionlib_test.php',888],['lib/adodb','adodb.inc.php',2164],['lib/adodb','adodb.inc.php',2844],['lib/adodb','adodb.inc.php',3536],['lib','webdavlib.php',176],['admin/tool/uploaduser','locallib.php',149],['lib/dml','oci_native_moodle_recordset.php',80],['lib/tcpdf','tcpdf.php',2943],['lib/horde/framework/Horde/Imap/Client','Base.php',1846],['lib','excellib.class.php',93],['lib/zend/Zend/Http/Client/Adapter','Test.php',187],['lib/classes/dml','recordset_walk.php',153],['mod/assign/feedback/offline','importgradeslib.php',178],['lib/pear/Net','GeoIP.php',556],['backup/util/helper','backup_array_iterator.class.php',63],['lib/zend/Zend/Gdata/App','LoggingHttpClientAdapterSocket.php',109],['lib/zend/Zend/Http/Client/Adapter','Proxy.php',266],['lib/dml','mssql_native_moodle_recordset.php',87],['lib/pear/Auth','RADIUS.php',542],['lib/pear/Auth','RADIUS.php',703],['lib/pear/Auth','RADIUS.php',824],['lib/phpmailer','class.smtp.php',507],['lib/phpexcel/PHPExcel/Shared','ZipArchive.php',80],['lib/phpunit/classes','event_sink.php',39],['lib/zend/Zend/Http/Client/Adapter','Interface.php',73],['lib/dml','pgsql_native_moodle_recordset.php',104],['auth/fc','fcFPP.php',72],['lib/filestorage','zip_archive.php',183],['lib','odslib.class.php',71],['lib/horde/framework/Horde/Socket','Client.php',135],['question/engine/tests','helpers.php',1225],['grade','lib.php',323],['lib/dml','mysqli_native_moodle_recordset.php',86],['lib','csvlib.class.php',256],['lib/google/src/Google/Logger','File.php',130],['lib/horde/framework/Horde','Stream.php',585],['lib/phpunit/classes','phpmailer_sink.php',41],['lib/phpunit/classes','message_sink.php',39],['lib/zend/Zend/Http/Client/Adapter','Curl.php',460],['lib/dml','sqlsrv_native_moodle_recordset.php',133],['lib/zend/Zend/Service/WindowsAzure','SessionHandler.php',109],['backup/util/helper','backup_null_iterator.class.php',53],['grade/export','lib.php',662],['lib/dml','pdo_moodle_recordset.php',79]], 1036],
'count_enrolled_users': ['count_enrolled_users', 'Counts list of users enrolled into course (as per above function) ', [['lib','accesslib.php',2475]], 1],
'guess_if_creator_will_have_course_capability': ['guess_if_creator_will_have_course_capability', 'Is course creator going to have capability in a new course? ', [['lib','accesslib.php',548]], 26],
'role_get_name': ['role_get_name', 'Get localised role name or alias if exists and format the text. ', [['lib','accesslib.php',4497]], 46],
'create_level_instances': ['create_level_instances', 'Create missing context instances at given level ', [['lib','accesslib.php',5748],['lib','accesslib.php',6175],['lib','accesslib.php',6466],['lib','accesslib.php',6677],['lib','accesslib.php',6903],['lib','accesslib.php',7160],['lib','accesslib.php',7380]], 2],
'enrol_get_enrolment_end': ['enrol_get_enrolment_end', 'This function returns the end of current active user enrolment. ', [['lib','enrollib.php',963]], 2],
'get_all_levels': ['get_all_levels', 'Returns a list of all context levels ', [['lib','accesslib.php',5913]], 10],
'is_guest': ['is_guest', 'Does user have a (temporary or real) guest access to course? ', [['lib','accesslib.php',1964]], 4],
'block_method_result': ['block_method_result', 'Call a class method (one that does not require a block instance) on a block class. ', [['lib','blocklib.php',1639]], 1],
'get_all_user_name_fields': ['get_all_user_name_fields', 'A centralised location for the all name fields. Returns an array / sql string snippet. ', [['lib','moodlelib.php',3345]], 94],
'get_assignable_roles': ['get_assignable_roles', 'Gets all of the assignable roles for this course. ', [['enrol','locallib.php',585],['lib','accesslib.php',3381]], 45],
'delete_role': ['delete_role', 'Function that deletes a role and cleanups up after it ', [['lib','accesslib.php',1497]], 2],
'cache_add': ['cache_add', 'Adds a context to the cache. If the cache is full, discards a batch of older entries. ', [['lib','accesslib.php',5111]], 6],
'get_coursemodule_from_id': ['get_coursemodule_from_id', 'Given an id of a course module, finds the coursemodule description ', [['lib','datalib.php',1269]], 212],
'get_in_or_equal': ['get_in_or_equal', 'Constructs \'IN()\' or \'=\' sql fragment ', [['lib/dml','oci_native_moodle_database.php',1583],['lib/dml','moodle_database.php',678]], 375],
'print_error': ['print_error', 'Abort execution by throwing of a general exception, default exception handler displays the error message in most cases. ', [['lib','setuplib.php',449]], 1560],
'enrol_get_plugins': ['enrol_get_plugins', 'Returns instances of enrol plugins ', [['lib','enrollib.php',70]], 45],
'from': ['from', 'From clause ', [['lib/zend/Zend/Service/WindowsAzure/Storage','TableEntityQuery.php',84]], 226],
'users_order_by_sql': ['users_order_by_sql', 'This function generates the standard ORDER BY clause for use when generating lists of users. If you don\'t have a reason to use a different order, then you should use this method to generate the order when displaying lists of users. ', [['lib','datalib.php',290]], 60],
'get_parent_context': ['get_parent_context', 'Returns parent context ', [['lib','accesslib.php',5695]], 37],
'get_parent_contexts': ['get_parent_contexts', 'Recursive function which, given a context, find all parent context ids, and return the array in reverse order, i.e. parent first, then grand parent, etc. ', [['lib','deprecatedlib.php',3373],['lib','accesslib.php',5653]], 12],
'get_cached_capabilities': ['get_cached_capabilities', 'Gets the capabilities that have been cached in the database for this component. ', [['lib','accesslib.php',2526]], 2],
'role_cap_duplicate': ['role_cap_duplicate', 'Duplicates all the base definitions of a role ', [['lib','accesslib.php',4768]], 1],
'__set': ['__set', '', [['lib/adodb','adodb-active-recordx.inc.php',115],['lib/horde/framework/Horde/Imap/Client/Data','Envelope.php',121],['lib/zend/Zend/Service/WindowsAzure/Storage','SignedIdentifier.php',67],['lib/zend/Zend/Gdata','Query.php',407],['lib/zend/Zend/Server/Reflection/Function','Abstract.php',394],['lib','webdavlib.php',98],['lib/pear/Net/GeoIP','Location.php',142],['lib/zend/Zend/Service/WindowsAzure/Storage','BlobContainer.php',68],['lib/classes/event','base.php',844],['lib/horde/framework/Horde/Support','Stub.php',31],['lib/horde/framework/Horde/Stream','TempString.php',83],['lib/zend/Zend/Service/WindowsAzure/Storage','QueueMessage.php',74],['lib/portfolio/formats/leap2a','lib.php',277],['lib','modinfolib.php',168],['lib','modinfolib.php',1221],['lib/simplepie/library/SimplePie','gzdecode.php',175],['lib/horde/framework/Horde/Imap/Client/Data','Namespace.php',94],['lib/horde/framework/Horde/Mail/Rfc822','Group.php',74],['calendar','lib.php',2026],['lib/zend/Zend/Gdata/App','Base.php',489],['mod/lesson','locallib.php',2015],['lib/horde/framework/Horde','Variables.php',199],['lib/zend/Zend/Gdata/App','BaseMediaSource.php',125],['lib','accesslib.php',5226],['lib/zend/Zend/Server/Reflection','Class.php',130],['lib/zend/Zend/Service/WindowsAzure/Storage','DynamicTableEntity.php',51],['lib/minify/lib','JSMinPlus.php',1681],['lib/horde/framework/Horde/Support','Array.php',123],['lib/zend/Zend/Service/WindowsAzure/Storage','TableInstance.php',68],['lib/horde/framework/Horde','Stream.php',84],['lib/horde/framework/Horde/Mail/Rfc822','Address.php',88],['lib','adminlib.php',1086],['lib/simplepie/library/SimplePie','IRI.php',143],['lib','pagelib.php',774],['lib/alfresco/Service','BaseObject.php',35],['lib/alfresco/Service','Node.php',272],['lib/zend/Zend/Service/WindowsAzure/Storage','BlobInstance.php',89],['lib/zend/Zend/Service/WindowsAzure/Storage','QueueInstance.php',64],['lib','navigationlib.php',5007],['lib/mustache/src/Mustache','HelperCollection.php',43],['lib/classes/message','message.php',202],['lib','coursecatlib.php',124],['lib','coursecatlib.php',2865],['lib/adodb','adodb-active-record.inc.php',106],['lib/horde/framework/Horde/Support','ObjectStub.php',50]], 5],
'create_role': ['create_role', 'Creates a new role in the system. ', [['lib/testing/generator','data_generator.php',690],['lib','accesslib.php',1458]], 38],
'init_levels': ['init_levels', 'Initialise context levels, call before using self::$alllevels. ', [['lib','accesslib.php',5859]], 5],
'get_enrolled_sql': ['get_enrolled_sql', 'Returns array with sql code and parameters returning all ids of users enrolled into course. ', [['lib','accesslib.php',2246]], 48],
'delete_records': ['delete_records', 'Delete the records from a table where all the given conditions met. If conditions not specified, table is truncated. ', [['lib/dml','moodle_database.php',1815],['lib/dml','sqlite3_pdo_moodle_database.php',337]], 778],
'get_cleanup_sql': ['get_cleanup_sql', 'Returns sql necessary for purging of stale context instances. ', [['lib','accesslib.php',5727],['lib','accesslib.php',6299],['lib','accesslib.php',6486],['lib','accesslib.php',6696],['lib','accesslib.php',6922],['lib','accesslib.php',7179],['lib','accesslib.php',7399]], 2],
'get_field': ['get_field', 'Get the right field name to fetch a stat for these attempts that is calculated for more than one $whichattempts (count or avg). ', [['mod/quiz/report/statistics/classes','calculated.php',109],['lib/dml','moodle_database.php',1497],['user/filters','lib.php',124],['lib/behat','behat_field_manager.php',243]], 485],
'get_users_from_role_on_context': ['get_users_from_role_on_context', 'Find all user assignment of users for this role, on this context ', [['lib','accesslib.php',4448]], 0],
'get_enrolled_users': ['get_enrolled_users', 'Returns list of users enrolled into course. ', [['lib','accesslib.php',2438],['enrol','externallib.php',390],['enrol','externallib.php',821]], 51],
'get_capabilities_from_role_on_context': ['get_capabilities_from_role_on_context', 'Get all capabilities for this role on this context (overrides) ', [['lib','accesslib.php',4416]], 0],
'get_file_storage': ['get_file_storage', 'Returns local file storage instance ', [['lib','moodlelib.php',5950]], 486],
'load_temp_course_role': ['load_temp_course_role', 'Adds a temp role to current USER->access array. ', [['lib','accesslib.php',1266]], 6],
'format_text': ['format_text', 'Given text in a variety of format codings, this function returns the text as safe HTML. ', [['lib','weblib.php',1115],['lib','tablelib.php',846],['lib','tablelib.php',1583],['lib','tablelib.php',1900],['question/type','questionbase.php',345],['lib/classes','grading_external.php',182]], 325],
'get_url': ['get_url', 'Returns relevant URL. ', [['report/log/classes/event','user_report_viewed.php',82],['mod/wiki/classes/event','page_deleted.php',83],['mod/chat/classes/event','sessions_viewed.php',74],['mod/glossary/classes/event','category_deleted.php',65],['mod/workshop/classes/event','assessment_evaluations_reset.php',84],['lib/classes/event','course_resources_list_viewed.php',69],['lib/filebrowser','file_info_context_course.php',505],['mod/lesson/classes/event','content_page_viewed.php',57],['lib/classes/event','blog_association_created.php',75],['lib/classes/event','user_profile_viewed.php',76],['mod/feedback/classes/event','response_submitted.php',79],['lib/classes/event','badge_awarded.php',72],['report/outline/classes/event','report_viewed.php',83],['admin/tool/capability/classes/event','report_viewed.php',74],['lib/classes/event','message_viewed.php',63],['lib/classes/event','course_category_created.php',57],['mod/quiz/classes/event','group_override_updated.php',73],['mod/survey/classes/event','response_submitted.php',71],['lib/classes/event','blog_comment_created.php',38],['mod/book/tool/exportimscp/classes/event','book_exported.php',85],['report/loglive/classes/event','report_viewed.php',75],['mod/forum/classes/event','post_deleted.php',76],['badges/lib','backpacklib.php',116],['mod/chat/classes/event','message_sent.php',68],['mod/workshop/classes/event','submission_created.php',72],['lib/classes/event','note_updated.php',75],['mod/lesson/classes/event','group_override_deleted.php',73],['lib/classes/event','course_module_instance_list_viewed.php',84],['mod/lesson/classes/event','page_updated.php',81],['mod/forum/classes/event','discussion_subscription_deleted.php',75],['mod/quiz/classes/event','attempt_preview_started.php',73],['mod/lesson/classes/event','user_override_updated.php',73],['mod/quiz/classes/event','report_viewed.php',75],['mod/lesson/classes/event','question_answered.php',63],['mod/forum/classes/event','discussion_viewed.php',69],['mod/workshop/classes/event','submission_viewed.php',72],['mod/data/classes/event','comment_created.php',37],['mod/workshop/classes/event','submission_reassessed.php',86],['mod/glossary/classes/event','entry_deleted.php',73],['mod/glossary/classes/event','comment_created.php',37],['lib/classes/event','user_created.php',66],['mod/data/classes/event','field_updated.php',76],['mod/data/classes/event','template_updated.php',85],['lib/classes/event','comment_created.php',77],['lib/classes/event','cohort_deleted.php',67],['lib/tests','customcontext_test.php',33],['lib/tests','customcontext_test.php',57],['lib/tests','customcontext_test.php',81],['mod/scorm/classes/event','tracks_viewed.php',73],['lib/classes/event','course_viewed.php',84],['mod/quiz/classes/event','attempt_abandoned.php',81],['mod/workshop/classes/event','phase_switched.php',84],['lib/classes/event','base.php',556],['lib/classes/event','course_completion_updated.php',65],['report/completion/classes/event','report_viewed.php',67],['mod/forum/classes/event','discussion_updated.php',74],['lib/classes/event','course_reset_ended.php',62],['mod/glossary/classes/event','course_module_viewed.php',47],['mod/choice/classes/event','answer_submitted.php',81],['mod/forum/classes/event','assessable_uploaded.php',95],['mod/wiki/classes/event','page_diff_viewed.php',85],['lib/classes/event','course_category_updated.php',60],['admin/tool/langimport/classes/event','langpack_updated.php',89],['lib/classes/event','webservice_service_created.php',74],['lib/classes/event','course_created.php',73],['mod/lesson/classes/event','lesson_started.php',57],['lib/classes/event','group_created.php',74],['mod/quiz/classes/event','user_override_created.php',72],['mod/glossary/classes/event','category_updated.php',65],['backup/util/ui','restore_ui_components.php',98],['mod/glossary/classes/event','entry_disapproved.php',65],['lib/classes/event','user_password_updated.php',95],['lib/classes/event','role_deleted.php',73],['admin/tool/log/store/legacy/tests/fixtures','event.php',44],['lib/classes/event','user_loggedinas.php',85],['lib','modinfolib.php',1245],['mod/lesson/classes/event','essay_attempt_viewed.php',57],['mod/forum/classes/event','discussion_moved.php',75],['mod/assign/submission/onlinetext/classes/event','assessable_uploaded.php',92],['mod/quiz/report','attemptsreport_options.php',133],['mod/survey/classes/event','report_downloaded.php',73],['mod/wiki/classes/event','page_updated.php',83],['admin/tool/log/store/standard/tests/fixtures','event.php',44],['lib/classes/event','user_list_viewed.php',74],['mod/forum/classes/event','readtracking_disabled.php',73],['lib/classes/event','comments_viewed.php',69],['lib/classes/event','cohort_member_added.php',68],['lib/classes/event','grouping_created.php',74],['lib/classes/event','recent_activity_viewed.php',76],['lib/classes/event','role_allow_switch_updated.php',65],['mod/assign/submission/comments/classes/event','comment_deleted.php',37],['lib/classes/event','user_login_failed.php',76],['lib/classes/event','message_contact_added.php',57],['lib/classes/event','role_allow_assign_updated.php',65],['mod/quiz/classes/event','user_override_deleted.php',72],['mod/quiz/classes/event','edit_page_viewed.php',72],['mod/lesson/classes/event','highscores_viewed.php',57],['report/stats/classes/event','user_report_viewed.php',76],['mod/quiz/classes/event','group_override_deleted.php',73],['mod/book/classes/event','chapter_updated.php',88],['mod/lesson/classes/event','question_viewed.php',63],['mod/scorm/classes/event','interactions_viewed.php',72],['lib/classes/event','course_module_updated.php',76],['mod/forum/classes/event','discussion_subscription_created.php',75],['mod/quiz/classes/event','question_manually_graded.php',74],['lib/classes/event','mnet_access_control_created.php',66],['lib/classes/event','role_assigned.php',75],['mod/scorm/classes/event','user_report_viewed.php',71],['report/participation/classes/event','report_viewed.php',86],['mod/data/classes/event','comment_deleted.php',37],['lib/classes/event','user_updated.php',66],['lib/classes/event','course_section_updated.php',75],['lib/classes/event','comment_deleted.php',77],['mod/assign/submission/file/classes/event','assessable_uploaded.php',94],['admin/tool/log/store/database/tests/fixtures','event.php',44],['lib/classes/event','cohort_updated.php',67],['mod/forum/classes/event','post_updated.php',76],['mod/book/classes/event','chapter_viewed.php',88],['lib/classes/event','user_loggedout.php',72],['lib/classes/event','grade_report_viewed.php',72],['mod/book/classes/event','chapter_deleted.php',88],['admin/tool/log/store/legacy/classes/event','legacy_logged.php',43],['lib/classes/event','webservice_token_created.php',74],['enrol','locallib.php',1396],['mod/forum/classes/event','course_searched.php',75],['lib/classes/event','group_updated.php',74],['mod/quiz/classes/event','attempt_started.php',74],['mod/lesson/classes/event','group_override_updated.php',73],['lib/classes/event','course_module_viewed.php',71],['lib/classes/event','mnet_access_control_updated.php',66],['mod/wiki/classes/event','comments_viewed.php',68],['lib/tests/fixtures','event_fixtures.php',47],['lib/tests/fixtures','event_fixtures.php',273],['mod/quiz/classes/event','attempt_submitted.php',81],['mod/data/classes/event','field_created.php',77],['lib/classes/event','question_category_created.php',66],['admin/tool/monitor/classes/event','rule_deleted.php',68],['lib/classes/event','blog_comment_deleted.php',38],['mod/lesson/classes/event','group_override_created.php',74],['mod/workshop/classes/event','assessments_reset.php',83],['mod/wiki/classes/event','comment_created.php',38],['mod/lesson/classes/event','lesson_resumed.php',57],['lib','outputcomponents.php',326],['lib','outputcomponents.php',2751],['lib/classes/event','blog_entry_updated.php',92],['report/questioninstances/classes/event','report_viewed.php',83],['mod/folder/classes/event','folder_updated.php',66],['lib/classes/event','role_capabilities_updated.php',69],['lib/classes/event','blog_entries_viewed.php',80],['mod/wiki/classes/event','page_viewed.php',86],['lib/classes/event','group_deleted.php',74],['mod/quiz/classes/event','attempt_becameoverdue.php',84],['mod/quiz/classes/event','attempt_viewed.php',73],['lib/classes/event','course_module_completion_updated.php',67],['mod/workshop/classes/event','assessment_evaluated.php',75],['report/log/classes/event','report_viewed.php',85],['mod/book/classes/event','chapter_created.php',88],['mod/workshop/classes/event','submission_assessed.php',85],['lib/classes/event','cohort_created.php',67],['lib','accesslib.php',6092],['lib','accesslib.php',6149],['lib','accesslib.php',6400],['lib','accesslib.php',6587],['lib','accesslib.php',6827],['lib','accesslib.php',7047],['lib','accesslib.php',7290],['mod/scorm/classes/event','sco_launched.php',73],['mod/wiki/classes/event','comment_deleted.php',38],['lib/classes/event','blog_entry_created.php',94],['lib/classes/event','user_enrolment_created.php',72],['mod/data/classes/event','record_created.php',75],['mod/quiz/classes/event','attempt_summary_viewed.php',75],['lib/classes/event','user_enrolment_updated.php',72],['mod/quiz/classes/event','attempt_reviewed.php',72],['mod/glossary/classes/event','comment_deleted.php',37],['mod/lesson/classes/event','page_moved.php',65],['mod/glossary/classes/event','category_created.php',65],['mod/lesson/classes/event','page_created.php',63],['mod/forum/classes/event','course_module_viewed.php',50],['lib/classes/event','cohort_member_removed.php',69],['mod/wiki/classes/event','page_version_viewed.php',84],['lib/classes/event','role_allow_override_updated.php',65],['mod/workshop/classes/event','assessable_uploaded.php',102],['lib/classes/event','grouping_updated.php',74],['admin/tool/monitor/classes/event','rule_updated.php',68],['lib/classes/event','course_module_created.php',105],['admin/tool/langimport/classes/event','langpack_removed.php',80],['mod/workshop/classes/event','submission_updated.php',72],['mod/lesson/classes/event','page_deleted.php',63],['lib/classes/event','grouping_deleted.php',81],['mod/assign/submission/comments/classes/event','comment_created.php',37],['mod/wiki/classes/event','page_history_viewed.php',77],['mod/survey/classes/event','report_viewed.php',73],['report/stats/classes/event','report_viewed.php',83],['lib/classes/event','note_created.php',75],['lib/classes/event','course_reset_started.php',62],['mod/book/tool/print/classes/event','book_printed.php',85],['lib/classes/event','webservice_service_user_removed.php',68],['mod/data/classes/event','record_deleted.php',75],['mod/choice/classes/event','answer_updated.php',81],['lib/classes/event','group_member_removed.php',78],['mod/glossary/classes/event','entry_viewed.php',67],['mod/forum/classes/event','user_report_viewed.php',74],['mod/forum/classes/event','subscription_created.php',74],['lib/classes/event','calendar_event_created.php',77],['lib/classes/event','message_contact_blocked.php',57],['lib/classes/event','webservice_service_updated.php',68],['mod/wiki/classes/event','page_version_restored.php',83],['mod/data/classes/event','template_viewed.php',74],['lib/classes/event','course_user_report_viewed.php',75],['mod/data/classes/event','record_updated.php',75],['mod/wiki/classes/event','page_map_viewed.php',83],['mod/wiki/classes/event','page_locks_deleted.php',83],['lib/classes/event','webservice_service_deleted.php',68],['mod/forum/classes/event','readtracking_enabled.php',73],['lib/classes/event','role_unassigned.php',72],['lib/classes/event','course_restored.php',76],['mod/choice/classes/event','report_viewed.php',66],['lib/classes/event','user_enrolment_deleted.php',73],['mod/book/tool/print/classes/event','chapter_printed.php',88],['lib/classes/event','user_graded.php',115],['mod/assign/classes/event','base.php',90],['lib/classes/event','course_updated.php',76],['mod/forum/classes/event','post_created.php',76],['mod/data/classes/event','field_deleted.php',76],['mod/glossary/classes/event','entry_created.php',71],['mod/forum/classes/event','discussion_created.php',74],['mod/forum/classes/event','discussion_deleted.php',75],['mod/scorm/classes/event','attempt_deleted.php',71],['mod/lesson/classes/event','lesson_ended.php',58],['mod/forum/classes/event','subscribers_viewed.php',74],['mod/scorm/classes/event','report_viewed.php',72],['mod/lesson/classes/event','user_override_deleted.php',72],['report/completion/classes/event','user_report_viewed.php',77],['admin/tool/langimport/classes/event','langpack_imported.php',89],['mod/forum/classes/event','subscription_deleted.php',74],['mod/lesson/classes/event','highscore_added.php',65],['mod/lesson/classes/event','essay_assessed.php',87],['lib/classes/event','message_sent.php',91],['lib/classes/event','message_contact_removed.php',57],['lib/filebrowser','file_info.php',226],['report/outline/classes/event','activity_report_viewed.php',75],['lib/classes/event','calendar_event_updated.php',77],['mod/lesson/classes/event','user_override_created.php',72],['mod/workshop/classes/event','assessment_reevaluated.php',85],['mod/quiz/classes/event','user_override_updated.php',73],['lib/simplepie/library/SimplePie','Copyright.php',96],['lib/classes/event','webservice_service_user_added.php',68],['lib/classes/event','notes_viewed.php',71],['lib/filebrowser','file_info_stored.php',156],['mod/glossary/classes/event','entry_updated.php',71],['admin/tool/monitor/classes/event','rule_created.php',68],['mod/wiki/classes/event','page_version_deleted.php',83],['lib/classes/event','course_completed.php',91],['mod/glossary/classes/event','entry_approved.php',65],['mod/wiki/classes/event','page_created.php',77],['mod/quiz/classes/event','group_override_created.php',74],['repository/alfresco','lib.php',121],['lib/classes/event','group_member_added.php',87],['lib/classes/event','message_contact_unblocked.php',57],['mod/quiz/classes/event','attempt_deleted.php',66],['lib/classes/event','user_loggedin.php',73],['mod/lesson/classes/event','lesson_restarted.php',57]], 186],
'explode': ['explode', '', [], 1599],
'is_array': ['is_array', '', [], 1820],
'preg_split': ['preg_split', '', [], 127],
'count': ['count', '', [], 3984],
'trim': ['trim', '', [], 1889],
'in_array': ['in_array', '', [], 1173],
'time': ['time', '', [], 1768],
'round': ['round', '', [], 903],
'strstr': ['strstr', '', [], 52],
'array_shift': ['array_shift', '', [], 607],
'array_pop': ['array_pop', '', [], 438],
'implode': ['implode', '', [], 1259],
'rtrim': ['rtrim', '', [], 169],
'array_unshift': ['array_unshift', '', [], 114],
'array_key_exists': ['array_key_exists', '', [], 1539],
'substr': ['substr', '', [], 2883],
'substr_count': ['substr_count', '', [], 78],
'str_replace': ['str_replace', '', [], 1667],
'array_combine': ['array_combine', '', [], 134],
'is_null': ['is_null', '', [], 1992],
'sha1': ['sha1', '', [], 188],
'file_exists': ['file_exists', '', [], 873],
'array_keys': ['array_keys', '', [], 1152],
'array_diff': ['array_diff', '', [], 93],
'array_unique': ['array_unique', '', [], 173],
'unserialize': ['unserialize', '', [], 180],
'is_numeric': ['is_numeric', '', [], 723],
'ltrim': ['ltrim', '', [], 83],
'array_merge': ['array_merge', '', [], 2320],
'is_string': ['is_string', '', [], 680],
'array_reverse': ['array_reverse', '', [], 127],
'define': ['define', '', [], 2170],
'array_push': ['array_push', '', [], 214],
'max': ['max', '', [], 1096],
'ksort': ['ksort', '', [], 158],
'strpos': ['strpos', '', [], 1623],
'defined': ['defined', '', [], 4098],
'preg_match': ['preg_match', '', [], 1317],
'is_bool': ['is_bool', '', [], 177],
'function_exists': ['function_exists', '', [], 443],
'serialize': ['serialize', '', [], 266],
'reset': ['reset', '', [], 1070],
'is_object': ['is_object', '', [], 508],
'basename': ['basename', '', [], 163]};
CLASS_DATA={
'context_system': ['context_system', 'System context class ', [['lib','accesslib.php',6106]], 929],
'role_deleted': ['role_deleted', 'Role assigned event class. ', [['lib/classes/event','role_deleted.php',29]], 1],
'grading_manager': ['grading_manager', 'General class providing access to common grading features ', [['grade/grading','lib.php',76]], 10],
'coding_exception': ['coding_exception', 'Exception indicating programming error, must be fixed by a programer. For example a core API might throw this type of exception if a plugin calls it incorrectly. ', [['lib','setuplib.php',214]], 867],
'context_coursecat': ['context_coursecat', 'Course category context class ', [['lib','accesslib.php',6534]], 160],
'role_unassigned': ['role_unassigned', 'Role unassigned event class. ', [['lib/classes/event','role_unassigned.php',30]], 2],
'moodle_url': ['moodle_url', 'Class for creating and manipulating urls. ', [['lib','weblib.php',240]], 2887],
'context_course': ['context_course', 'Course context class ', [['lib','accesslib.php',6766]], 1197],
'context_module': ['context_module', 'Course module context class ', [['lib','accesslib.php',6988]], 942],
'rating_manager': ['rating_manager', 'The rating_manager class provides the ability to retrieve sets of ratings from the database ', [['rating','lib.php',365]], 25],
'context_user': ['context_user', 'User context class ', [['lib','accesslib.php',6347]], 288],
'repository': ['repository', 'Class for repositories ', [['lib/classes/plugininfo','repository.php',30]], 213],
'cache': ['cache', 'The main cache class. ', [['cache/classes','loaders.php',31]], 213],
'core_component': ['core_component', 'Collection of components related methods. ', [['lib/classes','component.php',41]], 485],
'required_capability_exception': ['required_capability_exception', 'Exceptions indicating user does not have permissions to do something and the execution can not continue. ', [['lib','setuplib.php',185]], 7],
'role_assigned': ['role_assigned', 'Role assigned event. ', [['lib/classes/event','role_assigned.php',29]], 1],
'context_helper': ['context_helper', 'Context maintenance and helper methods. ', [['lib','accesslib.php',5824]], 210],
'context_block': ['context_block', 'Block context class ', [['lib','accesslib.php',7230]], 26],
'comment': ['comment', 'This class represents a comment box on a page of feedback. ', [['mod/assign/feedback/editpdf/classes','comment.php',27],['comment','lib.php',26]], 54]};
CONST_DATA={
'ROLENAME_ORIGINAL': ['ROLENAME_ORIGINAL', '', [['lib','accesslib.php',172]], 19],
'DEBUG_DEVELOPER': ['DEBUG_DEVELOPER', '', [['lib','setuplib.php',40]], 554],
'ROLENAME_ALIAS_RAW': ['ROLENAME_ALIAS_RAW', '', [['lib','accesslib.php',180]], 11],
'CONTEXT_MODULE': ['CONTEXT_MODULE', '', [['lib','accesslib.php',150]], 462],
'IGNORE_MISSING': ['IGNORE_MISSING', '', [['lib','dmllib.php',48]], 204],
'CAP_PROHIBIT': ['CAP_PROHIBIT', '', [['lib','accesslib.php',139]], 63],
'CONTEXT_COURSECAT': ['CONTEXT_COURSECAT', '', [['lib','accesslib.php',146]], 99],
'ENROL_USER_ACTIVE': ['ENROL_USER_ACTIVE', '', [['lib','enrollib.php',37]], 200],
'PHPUNIT_TEST': ['PHPUNIT_TEST', '', [['admin/cli','install.php',143],['','install.php',49],['lib','setup.php',247],['lib/phpunit','bootstrap.php',63]], 54],
'RISK_CONFIG': ['RISK_CONFIG', '', [['lib','accesslib.php',161]], 25],
'SITEID': ['SITEID', '', [['admin/cli','install.php',217],['','install.php',244],['lib/db','install.php',87],['lib','setup.php',748]], 612],
'CONTEXT_BLOCK': ['CONTEXT_BLOCK', '', [['lib','accesslib.php',156]], 99],
'ENROL_INSTANCE_ENABLED': ['ENROL_INSTANCE_ENABLED', '', [['lib','enrollib.php',31]], 92],
'ROLENAME_SHORT': ['ROLENAME_SHORT', '', [['lib','accesslib.php',182]], 20],
'FORMAT_HTML': ['FORMAT_HTML', '', [['lib','weblib.php',47]], 999],
'SQL_PARAMS_NAMED': ['SQL_PARAMS_NAMED', '', [['lib/dml','moodle_database.php',32]], 271],
'ROLENAME_ALIAS': ['ROLENAME_ALIAS', '', [['lib','accesslib.php',174]], 35],
'ROLENAME_ORIGINALANDSHORT': ['ROLENAME_ORIGINALANDSHORT', '', [['lib','accesslib.php',178]], 12],
'CONTEXT_SYSTEM': ['CONTEXT_SYSTEM', '', [['lib','accesslib.php',142]], 165],
'RISK_PERSONAL': ['RISK_PERSONAL', '', [['lib','accesslib.php',165]], 116],
'MUST_EXIST': ['MUST_EXIST', '', [['lib','dmllib.php',52]], 1252],
'CONTEXT_CACHE_MAX_SIZE': ['CONTEXT_CACHE_MAX_SIZE', '', [['lib','accesslib.php',186]], 10],
'ROLENAME_BOTH': ['ROLENAME_BOTH', '', [['lib','accesslib.php',176]], 27],
'RISK_DATALOSS': ['RISK_DATALOSS', '', [['lib','accesslib.php',169]], 22],
'RISK_XSS': ['RISK_XSS', '', [['lib','accesslib.php',163]], 138],
'SYSCONTEXTID': ['SYSCONTEXTID', '', [['lib','accesslib.php',6265]], 74],
'RISK_MANAGETRUST': ['RISK_MANAGETRUST', '', [['lib','accesslib.php',159]], 4],
'RISK_SPAM': ['RISK_SPAM', '', [['lib','accesslib.php',167]], 147],
'CONTEXT_COURSE': ['CONTEXT_COURSE', '', [['lib','accesslib.php',148]], 422],
'CAP_PREVENT': ['CAP_PREVENT', '', [['lib','accesslib.php',137]], 40],
'SQL_PARAMS_QM': ['SQL_PARAMS_QM', '', [['lib/dml','moodle_database.php',35]], 39],
'ENROL_MAX_TIMESTAMP': ['ENROL_MAX_TIMESTAMP', '', [['lib','enrollib.php',46]], 6],
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',138],['','install.php',93],['lib','setup.php',386]], 3532],
'CAP_ALLOW': ['CAP_ALLOW', '', [['lib','accesslib.php',135]], 1292],
'CAP_INHERIT': ['CAP_INHERIT', '', [['lib','accesslib.php',133]], 35],
'CONTEXT_USER': ['CONTEXT_USER', '', [['lib','accesslib.php',144]], 95],
'CLI_SCRIPT': ['CLI_SCRIPT', '', [['auth/ldap/cli','sync_users.php',49],['admin/tool/behat/cli','init.php',36],['auth/db/cli','sync_users.php',45],['admin/cli','mysql_collation.php',25],['admin/cli','cron.php',31],['admin/tool/behat/cli','util_single_run.php',90],['repository/boxnet/cli','migrationv1.php',25],['admin/cli','install.php',32],['enrol/self/cli','sync.php',31],['enrol/flatfile/cli','sync.php',30],['enrol/meta/cli','sync.php',31],['admin/cli','fix_deleted_users.php',26],['','mdeploy.php',65],['admin/cli','check_database_schema.php',26],['admin/tool/dbtransfer/cli','migrate.php',30],['enrol/paypal/cli','sync.php',30],['admin/tool/behat/cli','util.php',34],['admin/tool/replace/cli','replace.php',25],['','install.php',46],['mod/chat','chatd.php',25],['admin/tool/generator/cli','maketestsite.php',25],['enrol/database/cli','sync.php',34],['enrol/manual/cli','sync.php',30],['admin','cron.php',47],['admin/cli','mysql_engine.php',27],['admin/tool/generator/cli','maketestcourse.php',25],['admin/cli','upgrade.php',38],['admin/cli','reset_password.php',27],['admin/cli','maintenance.php',26],['admin/cli','install_database.php',31],['lib/editor/tinymce/cli','update_lang_files.php',25],['theme/base/cli','svgtool.php',26],['admin/cli','automated_backups.php',29],['admin/cli','mysql_compressed_rows.php',26],['admin/cli','backup.php',26],['admin/tool/behat/cli','run.php',30],['admin/tool/task/cli','schedule_task.php',25],['enrol/ldap/cli','sync.php',43],['lib/filestorage/tests/fixtures','zip_info.php',25],['auth/cas/cli','sync_users.php',45],['lib','setup.php',289],['admin/cli','alternative_component_cache.php',30],['enrol/category/cli','sync.php',33],['lib/phpunit','bootstrap.php',73],['lib/tests/behat','behat_hooks.php',115],['admin/cli','fix_course_sequence.php',26],['admin/cli','purge_caches.php',24],['admin/tool/generator/cli','maketestplan.php',25],['lib/filestorage/tests/fixtures','zip_create_test_file.php',25],['enrol/cohort/cli','sync.php',31],['admin/tool/uploadcourse/cli','uploadcourse.php',25]], 109]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu May 28 19:17:31 2015</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
