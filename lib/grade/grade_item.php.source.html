<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /lib/grade/grade_item.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu May 28 19:17:31 2015 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='lib/grade';
filename='grade_item.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/lib/grade/</a> -> <a href="grade_item.php.html">grade_item.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="grade_item.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="grade_item.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * Definition of a class to represent a grade item</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * @package   core_grades</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @category  grade</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @copyright 2006 Nicolas Connault</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> */</span>
<a name="l25"><span class="linenum">  25</span></a>  
<a name="l26"><span class="linenum">  26</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l27"><span class="linenum">  27</span></a>  <span class="keyword">require_once</span> <a class="filename" href="../../lib/grade/grade_object.php.html" onMouseOver="reqPopup(event, 'grade_object.php', '../../lib/grade/grade_object.php')">('grade_object.php')</a>;
<a name="l28"><span class="linenum">  28</span></a>  
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment">/**</span>
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment"> * Class representing a grade item.</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> *</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> * It is responsible for handling its DB representation, modifying and returning its metadata.</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment"> *</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment"> * @package   core_grades</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment"> * @category  grade</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment"> * @copyright 2006 Nicolas Connault</span>
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment"> * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment"> */</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('grade_item')" href="../../_classes/grade_item.html" onMouseOver="classPopup(event,'grade_item')">grade_item</a> extends grade_object {
<a name="l40"><span class="linenum">  40</span></a>      <span class="comment">/**</span>
<a name="l41"><span class="linenum">  41</span></a>  <span class="comment">     * DB Table (used by grade_object).</span>
<a name="l42"><span class="linenum">  42</span></a>  <span class="comment">     * @var string $table</span>
<a name="l43"><span class="linenum">  43</span></a>  <span class="comment">     */</span>
<a name="l44"><span class="linenum">  44</span></a>      public <a class="var it127" onMouseOver="hilite(127)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = 'grade_items';
<a name="l45"><span class="linenum">  45</span></a>  
<a name="l46"><span class="linenum">  46</span></a>      <span class="comment">/**</span>
<a name="l47"><span class="linenum">  47</span></a>  <span class="comment">     * Array of required table fields, must start with 'id'.</span>
<a name="l48"><span class="linenum">  48</span></a>  <span class="comment">     * @var array $required_fields</span>
<a name="l49"><span class="linenum">  49</span></a>  <span class="comment">     */</span>
<a name="l50"><span class="linenum">  50</span></a>      public <a class="var it3047" onMouseOver="hilite(3047)" onMouseOut="lolite()" onClick="logVariable('required_fields')" href="../../_variables/required_fields.html">$required_fields</a> = array('id', 'courseid', 'categoryid', 'itemname', 'itemtype', 'itemmodule', 'iteminstance',
<a name="l51"><span class="linenum">  51</span></a>                                   'itemnumber', 'iteminfo', 'idnumber', 'calculation', 'gradetype', 'grademax', 'grademin',
<a name="l52"><span class="linenum">  52</span></a>                                   'scaleid', 'outcomeid', 'gradepass', 'multfactor', 'plusfactor', 'aggregationcoef',
<a name="l53"><span class="linenum">  53</span></a>                                   'aggregationcoef2', 'sortorder', 'display', 'decimals', 'hidden', 'locked', 'locktime',
<a name="l54"><span class="linenum">  54</span></a>                                   'needsupdate', 'weightoverride', 'timecreated', 'timemodified');
<a name="l55"><span class="linenum">  55</span></a>  
<a name="l56"><span class="linenum">  56</span></a>      <span class="comment">/**</span>
<a name="l57"><span class="linenum">  57</span></a>  <span class="comment">     * The course this grade_item belongs to.</span>
<a name="l58"><span class="linenum">  58</span></a>  <span class="comment">     * @var int $courseid</span>
<a name="l59"><span class="linenum">  59</span></a>  <span class="comment">     */</span>
<a name="l60"><span class="linenum">  60</span></a>      public <a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>;
<a name="l61"><span class="linenum">  61</span></a>  
<a name="l62"><span class="linenum">  62</span></a>      <span class="comment">/**</span>
<a name="l63"><span class="linenum">  63</span></a>  <span class="comment">     * The category this grade_item belongs to (optional).</span>
<a name="l64"><span class="linenum">  64</span></a>  <span class="comment">     * @var int $categoryid</span>
<a name="l65"><span class="linenum">  65</span></a>  <span class="comment">     */</span>
<a name="l66"><span class="linenum">  66</span></a>      public <a class="var it1252" onMouseOver="hilite(1252)" onMouseOut="lolite()" onClick="logVariable('categoryid')" href="../../_variables/categoryid.html">$categoryid</a>;
<a name="l67"><span class="linenum">  67</span></a>  
<a name="l68"><span class="linenum">  68</span></a>      <span class="comment">/**</span>
<a name="l69"><span class="linenum">  69</span></a>  <span class="comment">     * The grade_category object referenced $this-&gt;iteminstance if itemtype == 'category' or == 'course'.</span>
<a name="l70"><span class="linenum">  70</span></a>  <span class="comment">     * @var grade_category $item_category</span>
<a name="l71"><span class="linenum">  71</span></a>  <span class="comment">     */</span>
<a name="l72"><span class="linenum">  72</span></a>      public <a class="var it6487" onMouseOver="hilite(6487)" onMouseOut="lolite()" onClick="logVariable('item_category')" href="../../_variables/item_category.html">$item_category</a>;
<a name="l73"><span class="linenum">  73</span></a>  
<a name="l74"><span class="linenum">  74</span></a>      <span class="comment">/**</span>
<a name="l75"><span class="linenum">  75</span></a>  <span class="comment">     * The grade_category object referenced by $this-&gt;categoryid.</span>
<a name="l76"><span class="linenum">  76</span></a>  <span class="comment">     * @var grade_category $parent_category</span>
<a name="l77"><span class="linenum">  77</span></a>  <span class="comment">     */</span>
<a name="l78"><span class="linenum">  78</span></a>      public <a class="var it6486" onMouseOver="hilite(6486)" onMouseOut="lolite()" onClick="logVariable('parent_category')" href="../../_variables/parent_category.html">$parent_category</a>;
<a name="l79"><span class="linenum">  79</span></a>  
<a name="l80"><span class="linenum">  80</span></a>  
<a name="l81"><span class="linenum">  81</span></a>      <span class="comment">/**</span>
<a name="l82"><span class="linenum">  82</span></a>  <span class="comment">     * The name of this grade_item (pushed by the module).</span>
<a name="l83"><span class="linenum">  83</span></a>  <span class="comment">     * @var string $itemname</span>
<a name="l84"><span class="linenum">  84</span></a>  <span class="comment">     */</span>
<a name="l85"><span class="linenum">  85</span></a>      public <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('itemname')" href="../../_variables/itemname.html">$itemname</a>;
<a name="l86"><span class="linenum">  86</span></a>  
<a name="l87"><span class="linenum">  87</span></a>      <span class="comment">/**</span>
<a name="l88"><span class="linenum">  88</span></a>  <span class="comment">     * e.g. 'category', 'course' and 'mod', 'blocks', 'import', etc...</span>
<a name="l89"><span class="linenum">  89</span></a>  <span class="comment">     * @var string $itemtype</span>
<a name="l90"><span class="linenum">  90</span></a>  <span class="comment">     */</span>
<a name="l91"><span class="linenum">  91</span></a>      public <a class="var it5769" onMouseOver="hilite(5769)" onMouseOut="lolite()" onClick="logVariable('itemtype')" href="../../_variables/itemtype.html">$itemtype</a>;
<a name="l92"><span class="linenum">  92</span></a>  
<a name="l93"><span class="linenum">  93</span></a>      <span class="comment">/**</span>
<a name="l94"><span class="linenum">  94</span></a>  <span class="comment">     * The module pushing this grade (e.g. 'forum', 'quiz', 'assignment' etc).</span>
<a name="l95"><span class="linenum">  95</span></a>  <span class="comment">     * @var string $itemmodule</span>
<a name="l96"><span class="linenum">  96</span></a>  <span class="comment">     */</span>
<a name="l97"><span class="linenum">  97</span></a>      public <a class="var it6480" onMouseOver="hilite(6480)" onMouseOut="lolite()" onClick="logVariable('itemmodule')" href="../../_variables/itemmodule.html">$itemmodule</a>;
<a name="l98"><span class="linenum">  98</span></a>  
<a name="l99"><span class="linenum">  99</span></a>      <span class="comment">/**</span>
<a name="l100"><span class="linenum"> 100</span></a>  <span class="comment">     * ID of the item module</span>
<a name="l101"><span class="linenum"> 101</span></a>  <span class="comment">     * @var int $iteminstance</span>
<a name="l102"><span class="linenum"> 102</span></a>  <span class="comment">     */</span>
<a name="l103"><span class="linenum"> 103</span></a>      public <a class="var it6497" onMouseOver="hilite(6497)" onMouseOut="lolite()" onClick="logVariable('iteminstance')" href="../../_variables/iteminstance.html">$iteminstance</a>;
<a name="l104"><span class="linenum"> 104</span></a>  
<a name="l105"><span class="linenum"> 105</span></a>      <span class="comment">/**</span>
<a name="l106"><span class="linenum"> 106</span></a>  <span class="comment">     * Number of the item in a series of multiple grades pushed by an activity.</span>
<a name="l107"><span class="linenum"> 107</span></a>  <span class="comment">     * @var int $itemnumber</span>
<a name="l108"><span class="linenum"> 108</span></a>  <span class="comment">     */</span>
<a name="l109"><span class="linenum"> 109</span></a>      public <a class="var it5026" onMouseOver="hilite(5026)" onMouseOut="lolite()" onClick="logVariable('itemnumber')" href="../../_variables/itemnumber.html">$itemnumber</a>;
<a name="l110"><span class="linenum"> 110</span></a>  
<a name="l111"><span class="linenum"> 111</span></a>      <span class="comment">/**</span>
<a name="l112"><span class="linenum"> 112</span></a>  <span class="comment">     * Info and notes about this item.</span>
<a name="l113"><span class="linenum"> 113</span></a>  <span class="comment">     * @var string $iteminfo</span>
<a name="l114"><span class="linenum"> 114</span></a>  <span class="comment">     */</span>
<a name="l115"><span class="linenum"> 115</span></a>      public <a class="var it5027" onMouseOver="hilite(5027)" onMouseOut="lolite()" onClick="logVariable('iteminfo')" href="../../_variables/iteminfo.html">$iteminfo</a>;
<a name="l116"><span class="linenum"> 116</span></a>  
<a name="l117"><span class="linenum"> 117</span></a>      <span class="comment">/**</span>
<a name="l118"><span class="linenum"> 118</span></a>  <span class="comment">     * Arbitrary idnumber provided by the module responsible.</span>
<a name="l119"><span class="linenum"> 119</span></a>  <span class="comment">     * @var string $idnumber</span>
<a name="l120"><span class="linenum"> 120</span></a>  <span class="comment">     */</span>
<a name="l121"><span class="linenum"> 121</span></a>      public <a class="var it2926" onMouseOver="hilite(2926)" onMouseOut="lolite()" onClick="logVariable('idnumber')" href="../../_variables/idnumber.html">$idnumber</a>;
<a name="l122"><span class="linenum"> 122</span></a>  
<a name="l123"><span class="linenum"> 123</span></a>      <span class="comment">/**</span>
<a name="l124"><span class="linenum"> 124</span></a>  <span class="comment">     * Calculation string used for this item.</span>
<a name="l125"><span class="linenum"> 125</span></a>  <span class="comment">     * @var string $calculation</span>
<a name="l126"><span class="linenum"> 126</span></a>  <span class="comment">     */</span>
<a name="l127"><span class="linenum"> 127</span></a>      public <a class="var it6499" onMouseOver="hilite(6499)" onMouseOut="lolite()" onClick="logVariable('calculation')" href="../../_variables/calculation.html">$calculation</a>;
<a name="l128"><span class="linenum"> 128</span></a>  
<a name="l129"><span class="linenum"> 129</span></a>      <span class="comment">/**</span>
<a name="l130"><span class="linenum"> 130</span></a>  <span class="comment">     * Indicates if we already tried to normalize the grade calculation formula.</span>
<a name="l131"><span class="linenum"> 131</span></a>  <span class="comment">     * This flag helps to minimize db access when broken formulas used in calculation.</span>
<a name="l132"><span class="linenum"> 132</span></a>  <span class="comment">     * @var bool</span>
<a name="l133"><span class="linenum"> 133</span></a>  <span class="comment">     */</span>
<a name="l134"><span class="linenum"> 134</span></a>      public <a class="var it9976" onMouseOver="hilite(9976)" onMouseOut="lolite()" onClick="logVariable('calculation_normalized')" href="../../_variables/calculation_normalized.html">$calculation_normalized</a>;
<a name="l135"><span class="linenum"> 135</span></a>      <span class="comment">/**</span>
<a name="l136"><span class="linenum"> 136</span></a>  <span class="comment">     * Math evaluation object</span>
<a name="l137"><span class="linenum"> 137</span></a>  <span class="comment">     * @var calc_formula A formula object</span>
<a name="l138"><span class="linenum"> 138</span></a>  <span class="comment">     */</span>
<a name="l139"><span class="linenum"> 139</span></a>      public <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a>;
<a name="l140"><span class="linenum"> 140</span></a>  
<a name="l141"><span class="linenum"> 141</span></a>      <span class="comment">/**</span>
<a name="l142"><span class="linenum"> 142</span></a>  <span class="comment">     * The type of grade (0 = none, 1 = value, 2 = scale, 3 = text)</span>
<a name="l143"><span class="linenum"> 143</span></a>  <span class="comment">     * @var int $gradetype</span>
<a name="l144"><span class="linenum"> 144</span></a>  <span class="comment">     */</span>
<a name="l145"><span class="linenum"> 145</span></a>      public <a class="var it5023" onMouseOver="hilite(5023)" onMouseOut="lolite()" onClick="logVariable('gradetype')" href="../../_variables/gradetype.html">$gradetype</a> = <a class="constant" onClick="logConstant('GRADE_TYPE_VALUE')" href="../../_constants/GRADE_TYPE_VALUE.html" onMouseOver="constPopup(event,'GRADE_TYPE_VALUE')">GRADE_TYPE_VALUE</a>;
<a name="l146"><span class="linenum"> 146</span></a>  
<a name="l147"><span class="linenum"> 147</span></a>      <span class="comment">/**</span>
<a name="l148"><span class="linenum"> 148</span></a>  <span class="comment">     * Maximum allowable grade.</span>
<a name="l149"><span class="linenum"> 149</span></a>  <span class="comment">     * @var float $grademax</span>
<a name="l150"><span class="linenum"> 150</span></a>  <span class="comment">     */</span>
<a name="l151"><span class="linenum"> 151</span></a>      public <a class="var it5025" onMouseOver="hilite(5025)" onMouseOut="lolite()" onClick="logVariable('grademax')" href="../../_variables/grademax.html">$grademax</a> = 100;
<a name="l152"><span class="linenum"> 152</span></a>  
<a name="l153"><span class="linenum"> 153</span></a>      <span class="comment">/**</span>
<a name="l154"><span class="linenum"> 154</span></a>  <span class="comment">     * Minimum allowable grade.</span>
<a name="l155"><span class="linenum"> 155</span></a>  <span class="comment">     * @var float $grademin</span>
<a name="l156"><span class="linenum"> 156</span></a>  <span class="comment">     */</span>
<a name="l157"><span class="linenum"> 157</span></a>      public <a class="var it5024" onMouseOver="hilite(5024)" onMouseOut="lolite()" onClick="logVariable('grademin')" href="../../_variables/grademin.html">$grademin</a> = 0;
<a name="l158"><span class="linenum"> 158</span></a>  
<a name="l159"><span class="linenum"> 159</span></a>      <span class="comment">/**</span>
<a name="l160"><span class="linenum"> 160</span></a>  <span class="comment">     * id of the scale, if this grade is based on a scale.</span>
<a name="l161"><span class="linenum"> 161</span></a>  <span class="comment">     * @var int $scaleid</span>
<a name="l162"><span class="linenum"> 162</span></a>  <span class="comment">     */</span>
<a name="l163"><span class="linenum"> 163</span></a>      public <a class="var it3927" onMouseOver="hilite(3927)" onMouseOut="lolite()" onClick="logVariable('scaleid')" href="../../_variables/scaleid.html">$scaleid</a>;
<a name="l164"><span class="linenum"> 164</span></a>  
<a name="l165"><span class="linenum"> 165</span></a>      <span class="comment">/**</span>
<a name="l166"><span class="linenum"> 166</span></a>  <span class="comment">     * The grade_scale object referenced by $this-&gt;scaleid.</span>
<a name="l167"><span class="linenum"> 167</span></a>  <span class="comment">     * @var grade_scale $scale</span>
<a name="l168"><span class="linenum"> 168</span></a>  <span class="comment">     */</span>
<a name="l169"><span class="linenum"> 169</span></a>      public <a class="var it1939" onMouseOver="hilite(1939)" onMouseOut="lolite()" onClick="logVariable('scale')" href="../../_variables/scale.html">$scale</a>;
<a name="l170"><span class="linenum"> 170</span></a>  
<a name="l171"><span class="linenum"> 171</span></a>      <span class="comment">/**</span>
<a name="l172"><span class="linenum"> 172</span></a>  <span class="comment">     * The id of the optional grade_outcome associated with this grade_item.</span>
<a name="l173"><span class="linenum"> 173</span></a>  <span class="comment">     * @var int $outcomeid</span>
<a name="l174"><span class="linenum"> 174</span></a>  <span class="comment">     */</span>
<a name="l175"><span class="linenum"> 175</span></a>      public <a class="var it9977" onMouseOver="hilite(9977)" onMouseOut="lolite()" onClick="logVariable('outcomeid')" href="../../_variables/outcomeid.html">$outcomeid</a>;
<a name="l176"><span class="linenum"> 176</span></a>  
<a name="l177"><span class="linenum"> 177</span></a>      <span class="comment">/**</span>
<a name="l178"><span class="linenum"> 178</span></a>  <span class="comment">     * The grade_outcome this grade is associated with, if applicable.</span>
<a name="l179"><span class="linenum"> 179</span></a>  <span class="comment">     * @var grade_outcome $outcome</span>
<a name="l180"><span class="linenum"> 180</span></a>  <span class="comment">     */</span>
<a name="l181"><span class="linenum"> 181</span></a>      public <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../_variables/outcome.html">$outcome</a>;
<a name="l182"><span class="linenum"> 182</span></a>  
<a name="l183"><span class="linenum"> 183</span></a>      <span class="comment">/**</span>
<a name="l184"><span class="linenum"> 184</span></a>  <span class="comment">     * grade required to pass. (grademin &lt;= gradepass &lt;= grademax)</span>
<a name="l185"><span class="linenum"> 185</span></a>  <span class="comment">     * @var float $gradepass</span>
<a name="l186"><span class="linenum"> 186</span></a>  <span class="comment">     */</span>
<a name="l187"><span class="linenum"> 187</span></a>      public <a class="var it4886" onMouseOver="hilite(4886)" onMouseOut="lolite()" onClick="logVariable('gradepass')" href="../../_variables/gradepass.html">$gradepass</a> = 0;
<a name="l188"><span class="linenum"> 188</span></a>  
<a name="l189"><span class="linenum"> 189</span></a>      <span class="comment">/**</span>
<a name="l190"><span class="linenum"> 190</span></a>  <span class="comment">     * Multiply all grades by this number.</span>
<a name="l191"><span class="linenum"> 191</span></a>  <span class="comment">     * @var float $multfactor</span>
<a name="l192"><span class="linenum"> 192</span></a>  <span class="comment">     */</span>
<a name="l193"><span class="linenum"> 193</span></a>      public <a class="var it6489" onMouseOver="hilite(6489)" onMouseOut="lolite()" onClick="logVariable('multfactor')" href="../../_variables/multfactor.html">$multfactor</a> = 1.0;
<a name="l194"><span class="linenum"> 194</span></a>  
<a name="l195"><span class="linenum"> 195</span></a>      <span class="comment">/**</span>
<a name="l196"><span class="linenum"> 196</span></a>  <span class="comment">     * Add this to all grades.</span>
<a name="l197"><span class="linenum"> 197</span></a>  <span class="comment">     * @var float $plusfactor</span>
<a name="l198"><span class="linenum"> 198</span></a>  <span class="comment">     */</span>
<a name="l199"><span class="linenum"> 199</span></a>      public <a class="var it6490" onMouseOver="hilite(6490)" onMouseOut="lolite()" onClick="logVariable('plusfactor')" href="../../_variables/plusfactor.html">$plusfactor</a> = 0;
<a name="l200"><span class="linenum"> 200</span></a>  
<a name="l201"><span class="linenum"> 201</span></a>      <span class="comment">/**</span>
<a name="l202"><span class="linenum"> 202</span></a>  <span class="comment">     * Aggregation coeficient used for weighted averages or extra credit</span>
<a name="l203"><span class="linenum"> 203</span></a>  <span class="comment">     * @var float $aggregationcoef</span>
<a name="l204"><span class="linenum"> 204</span></a>  <span class="comment">     */</span>
<a name="l205"><span class="linenum"> 205</span></a>      public <a class="var it9978" onMouseOver="hilite(9978)" onMouseOut="lolite()" onClick="logVariable('aggregationcoef')" href="../../_variables/aggregationcoef.html">$aggregationcoef</a> = 0;
<a name="l206"><span class="linenum"> 206</span></a>  
<a name="l207"><span class="linenum"> 207</span></a>      <span class="comment">/**</span>
<a name="l208"><span class="linenum"> 208</span></a>  <span class="comment">     * Aggregation coeficient used for weighted averages only</span>
<a name="l209"><span class="linenum"> 209</span></a>  <span class="comment">     * @var float $aggregationcoef2</span>
<a name="l210"><span class="linenum"> 210</span></a>  <span class="comment">     */</span>
<a name="l211"><span class="linenum"> 211</span></a>      public <a class="var it9979" onMouseOver="hilite(9979)" onMouseOut="lolite()" onClick="logVariable('aggregationcoef2')" href="../../_variables/aggregationcoef2.html">$aggregationcoef2</a> = 0;
<a name="l212"><span class="linenum"> 212</span></a>  
<a name="l213"><span class="linenum"> 213</span></a>      <span class="comment">/**</span>
<a name="l214"><span class="linenum"> 214</span></a>  <span class="comment">     * Sorting order of the columns.</span>
<a name="l215"><span class="linenum"> 215</span></a>  <span class="comment">     * @var int $sortorder</span>
<a name="l216"><span class="linenum"> 216</span></a>  <span class="comment">     */</span>
<a name="l217"><span class="linenum"> 217</span></a>      public <a class="var it4036" onMouseOver="hilite(4036)" onMouseOut="lolite()" onClick="logVariable('sortorder')" href="../../_variables/sortorder.html">$sortorder</a> = 0;
<a name="l218"><span class="linenum"> 218</span></a>  
<a name="l219"><span class="linenum"> 219</span></a>      <span class="comment">/**</span>
<a name="l220"><span class="linenum"> 220</span></a>  <span class="comment">     * Display type of the grades (Real, Percentage, Letter, or default).</span>
<a name="l221"><span class="linenum"> 221</span></a>  <span class="comment">     * @var int $display</span>
<a name="l222"><span class="linenum"> 222</span></a>  <span class="comment">     */</span>
<a name="l223"><span class="linenum"> 223</span></a>      public <a class="var it4914" onMouseOver="hilite(4914)" onMouseOut="lolite()" onClick="logVariable('display')" href="../../_variables/display.html">$display</a> = <a class="constant" onClick="logConstant('GRADE_DISPLAY_TYPE_DEFAULT')" href="../../_constants/GRADE_DISPLAY_TYPE_DEFAULT.html" onMouseOver="constPopup(event,'GRADE_DISPLAY_TYPE_DEFAULT')">GRADE_DISPLAY_TYPE_DEFAULT</a>;
<a name="l224"><span class="linenum"> 224</span></a>  
<a name="l225"><span class="linenum"> 225</span></a>      <span class="comment">/**</span>
<a name="l226"><span class="linenum"> 226</span></a>  <span class="comment">     * The number of digits after the decimal point symbol. Applies only to REAL and PERCENTAGE grade display types.</span>
<a name="l227"><span class="linenum"> 227</span></a>  <span class="comment">     * @var int $decimals</span>
<a name="l228"><span class="linenum"> 228</span></a>  <span class="comment">     */</span>
<a name="l229"><span class="linenum"> 229</span></a>      public <a class="var it8848" onMouseOver="hilite(8848)" onMouseOut="lolite()" onClick="logVariable('decimals')" href="../../_variables/decimals.html">$decimals</a> = null;
<a name="l230"><span class="linenum"> 230</span></a>  
<a name="l231"><span class="linenum"> 231</span></a>      <span class="comment">/**</span>
<a name="l232"><span class="linenum"> 232</span></a>  <span class="comment">     * Grade item lock flag. Empty if not locked, locked if any value present, usually date when item was locked. Locking prevents updating.</span>
<a name="l233"><span class="linenum"> 233</span></a>  <span class="comment">     * @var int $locked</span>
<a name="l234"><span class="linenum"> 234</span></a>  <span class="comment">     */</span>
<a name="l235"><span class="linenum"> 235</span></a>      public <a class="var it996" onMouseOver="hilite(996)" onMouseOut="lolite()" onClick="logVariable('locked')" href="../../_variables/locked.html">$locked</a> = 0;
<a name="l236"><span class="linenum"> 236</span></a>  
<a name="l237"><span class="linenum"> 237</span></a>      <span class="comment">/**</span>
<a name="l238"><span class="linenum"> 238</span></a>  <span class="comment">     * Date after which the grade will be locked. Empty means no automatic locking.</span>
<a name="l239"><span class="linenum"> 239</span></a>  <span class="comment">     * @var int $locktime</span>
<a name="l240"><span class="linenum"> 240</span></a>  <span class="comment">     */</span>
<a name="l241"><span class="linenum"> 241</span></a>      public <a class="var it9479" onMouseOver="hilite(9479)" onMouseOut="lolite()" onClick="logVariable('locktime')" href="../../_variables/locktime.html">$locktime</a> = 0;
<a name="l242"><span class="linenum"> 242</span></a>  
<a name="l243"><span class="linenum"> 243</span></a>      <span class="comment">/**</span>
<a name="l244"><span class="linenum"> 244</span></a>  <span class="comment">     * If set, the whole column will be recalculated, then this flag will be switched off.</span>
<a name="l245"><span class="linenum"> 245</span></a>  <span class="comment">     * @var bool $needsupdate</span>
<a name="l246"><span class="linenum"> 246</span></a>  <span class="comment">     */</span>
<a name="l247"><span class="linenum"> 247</span></a>      public <a class="var it6482" onMouseOver="hilite(6482)" onMouseOut="lolite()" onClick="logVariable('needsupdate')" href="../../_variables/needsupdate.html">$needsupdate</a> = 1;
<a name="l248"><span class="linenum"> 248</span></a>  
<a name="l249"><span class="linenum"> 249</span></a>      <span class="comment">/**</span>
<a name="l250"><span class="linenum"> 250</span></a>  <span class="comment">     * If set, the grade item's weight has been overridden by a user and should not be automatically adjusted.</span>
<a name="l251"><span class="linenum"> 251</span></a>  <span class="comment">     */</span>
<a name="l252"><span class="linenum"> 252</span></a>      public <a class="var it9980" onMouseOver="hilite(9980)" onMouseOut="lolite()" onClick="logVariable('weightoverride')" href="../../_variables/weightoverride.html">$weightoverride</a> = 0;
<a name="l253"><span class="linenum"> 253</span></a>  
<a name="l254"><span class="linenum"> 254</span></a>      <span class="comment">/**</span>
<a name="l255"><span class="linenum"> 255</span></a>  <span class="comment">     * Cached dependson array</span>
<a name="l256"><span class="linenum"> 256</span></a>  <span class="comment">     * @var array An array of cached grade item dependencies.</span>
<a name="l257"><span class="linenum"> 257</span></a>  <span class="comment">     */</span>
<a name="l258"><span class="linenum"> 258</span></a>      public <a class="var it9981" onMouseOver="hilite(9981)" onMouseOut="lolite()" onClick="logVariable('dependson_cache')" href="../../_variables/dependson_cache.html">$dependson_cache</a> = null;
<a name="l259"><span class="linenum"> 259</span></a>  
<a name="l260"><span class="linenum"> 260</span></a>      <span class="comment">/**</span>
<a name="l261"><span class="linenum"> 261</span></a>  <span class="comment">     * In addition to update() as defined in grade_object, handle the grade_outcome and grade_scale objects.</span>
<a name="l262"><span class="linenum"> 262</span></a>  <span class="comment">     * Force regrading if necessary, rounds the float numbers using php function,</span>
<a name="l263"><span class="linenum"> 263</span></a>  <span class="comment">     * the reason is we need to compare the db value with computed number to skip regrading if possible.</span>
<a name="l264"><span class="linenum"> 264</span></a>  <span class="comment">     *</span>
<a name="l265"><span class="linenum"> 265</span></a>  <span class="comment">     * @param string $source from where was the object inserted (mod/forum, manual, etc.)</span>
<a name="l266"><span class="linenum"> 266</span></a>  <span class="comment">     * @return bool success</span>
<a name="l267"><span class="linenum"> 267</span></a>  <span class="comment">     */</span>
<a name="l268"><span class="linenum"> 268</span></a>      public function <a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>(<a class="var it1344" onMouseOver="hilite(1344)" onMouseOut="lolite()" onClick="logVariable('source')" href="../../_variables/source.html">$source</a>=null) {
<a name="l269"><span class="linenum"> 269</span></a>  <span class="comment">        // reset caches</span>
<a name="l270"><span class="linenum"> 270</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dependson_cache')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/dependson_cache.html">dependson_cache</a> = null;
<a name="l271"><span class="linenum"> 271</span></a>  
<a name="l272"><span class="linenum"> 272</span></a>  <span class="comment">        // Retrieve scale and infer grademax/min from it if needed</span>
<a name="l273"><span class="linenum"> 273</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('load_scale')" href="../../_functions/load_scale.html" onMouseOver="funcPopup(event,'load_scale')">load_scale</a>();
<a name="l274"><span class="linenum"> 274</span></a>  
<a name="l275"><span class="linenum"> 275</span></a>  <span class="comment">        // make sure there is not 0 in outcomeid</span>
<a name="l276"><span class="linenum"> 276</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('outcomeid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/outcomeid.html">outcomeid</a>)) {
<a name="l277"><span class="linenum"> 277</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('outcomeid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/outcomeid.html">outcomeid</a> = null;
<a name="l278"><span class="linenum"> 278</span></a>          }
<a name="l279"><span class="linenum"> 279</span></a>  
<a name="l280"><span class="linenum"> 280</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('qualifies_for_regrading')" href="../../_functions/qualifies_for_regrading.html" onMouseOver="funcPopup(event,'qualifies_for_regrading')">qualifies_for_regrading</a>()) {
<a name="l281"><span class="linenum"> 281</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('force_regrading')" href="../../_functions/force_regrading.html" onMouseOver="funcPopup(event,'force_regrading')">force_regrading</a>();
<a name="l282"><span class="linenum"> 282</span></a>          }
<a name="l283"><span class="linenum"> 283</span></a>  
<a name="l284"><span class="linenum"> 284</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('timemodified')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l285"><span class="linenum"> 285</span></a>  
<a name="l286"><span class="linenum"> 286</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademin')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademin.html">grademin</a>        = <a class="function" onClick="logFunction('grade_floatval')" href="../../_functions/grade_floatval.html" onMouseOver="funcPopup(event,'grade_floatval')">grade_floatval</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademin')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademin.html">grademin</a>);
<a name="l287"><span class="linenum"> 287</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademax')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademax.html">grademax</a>        = <a class="function" onClick="logFunction('grade_floatval')" href="../../_functions/grade_floatval.html" onMouseOver="funcPopup(event,'grade_floatval')">grade_floatval</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademax')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademax.html">grademax</a>);
<a name="l288"><span class="linenum"> 288</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('multfactor')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/multfactor.html">multfactor</a>      = <a class="function" onClick="logFunction('grade_floatval')" href="../../_functions/grade_floatval.html" onMouseOver="funcPopup(event,'grade_floatval')">grade_floatval</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('multfactor')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/multfactor.html">multfactor</a>);
<a name="l289"><span class="linenum"> 289</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('plusfactor')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/plusfactor.html">plusfactor</a>      = <a class="function" onClick="logFunction('grade_floatval')" href="../../_functions/grade_floatval.html" onMouseOver="funcPopup(event,'grade_floatval')">grade_floatval</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('plusfactor')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/plusfactor.html">plusfactor</a>);
<a name="l290"><span class="linenum"> 290</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('aggregationcoef')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/aggregationcoef.html">aggregationcoef</a> = <a class="function" onClick="logFunction('grade_floatval')" href="../../_functions/grade_floatval.html" onMouseOver="funcPopup(event,'grade_floatval')">grade_floatval</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('aggregationcoef')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/aggregationcoef.html">aggregationcoef</a>);
<a name="l291"><span class="linenum"> 291</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('aggregationcoef2')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/aggregationcoef2.html">aggregationcoef2</a> = <a class="function" onClick="logFunction('grade_floatval')" href="../../_functions/grade_floatval.html" onMouseOver="funcPopup(event,'grade_floatval')">grade_floatval</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('aggregationcoef2')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/aggregationcoef2.html">aggregationcoef2</a>);
<a name="l292"><span class="linenum"> 292</span></a>  
<a name="l293"><span class="linenum"> 293</span></a>          return parent::<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>(<a class="var it1344" onMouseOver="hilite(1344)" onMouseOut="lolite()" onClick="logVariable('source')" href="../../_variables/source.html">$source</a>);
<a name="l294"><span class="linenum"> 294</span></a>      }
<a name="l295"><span class="linenum"> 295</span></a>  
<a name="l296"><span class="linenum"> 296</span></a>      <span class="comment">/**</span>
<a name="l297"><span class="linenum"> 297</span></a>  <span class="comment">     * Compares the values held by this object with those of the matching record in DB, and returns</span>
<a name="l298"><span class="linenum"> 298</span></a>  <span class="comment">     * whether or not these differences are sufficient to justify an update of all parent objects.</span>
<a name="l299"><span class="linenum"> 299</span></a>  <span class="comment">     * This assumes that this object has an id number and a matching record in DB. If not, it will return false.</span>
<a name="l300"><span class="linenum"> 300</span></a>  <span class="comment">     *</span>
<a name="l301"><span class="linenum"> 301</span></a>  <span class="comment">     * @return bool</span>
<a name="l302"><span class="linenum"> 302</span></a>  <span class="comment">     */</span>
<a name="l303"><span class="linenum"> 303</span></a>      public function <a class="function" onClick="logFunction('qualifies_for_regrading')" href="../../_functions/qualifies_for_regrading.html" onMouseOver="funcPopup(event,'qualifies_for_regrading')">qualifies_for_regrading</a>() {
<a name="l304"><span class="linenum"> 304</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l305"><span class="linenum"> 305</span></a>              return false;
<a name="l306"><span class="linenum"> 306</span></a>          }
<a name="l307"><span class="linenum"> 307</span></a>  
<a name="l308"><span class="linenum"> 308</span></a>          <a class="var it9982" onMouseOver="hilite(9982)" onMouseOut="lolite()" onClick="logVariable('db_item')" href="../../_variables/db_item.html">$db_item</a> = <span class="keyword">new </span><a class="class" onClick="logClass('grade_item')" href="../../_classes/grade_item.html" onMouseOver="classPopup(event,'grade_item')">grade_item</a>(array('id' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l309"><span class="linenum"> 309</span></a>  
<a name="l310"><span class="linenum"> 310</span></a>          <a class="var it9983" onMouseOver="hilite(9983)" onMouseOut="lolite()" onClick="logVariable('calculationdiff')" href="../../_variables/calculationdiff.html">$calculationdiff</a> = <a class="var it9982" onMouseOver="hilite(9982)" onMouseOut="lolite()" onClick="logVariable('db_item')" href="../../_variables/db_item.html">$db_item</a>-&gt;<a onClick="logVariable('calculation')" class="var it40060" onMouseOver="hilite(40060)" onMouseOut="lolite()" href="../../_variables/calculation.html">calculation</a> != <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('calculation')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/calculation.html">calculation</a>;
<a name="l311"><span class="linenum"> 311</span></a>          <a class="var it9984" onMouseOver="hilite(9984)" onMouseOut="lolite()" onClick="logVariable('categorydiff')" href="../../_variables/categorydiff.html">$categorydiff</a>    = <a class="var it9982" onMouseOver="hilite(9982)" onMouseOut="lolite()" onClick="logVariable('db_item')" href="../../_variables/db_item.html">$db_item</a>-&gt;<a onClick="logVariable('categoryid')" class="var it40060" onMouseOver="hilite(40060)" onMouseOut="lolite()" href="../../_variables/categoryid.html">categoryid</a>  != <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('categoryid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/categoryid.html">categoryid</a>;
<a name="l312"><span class="linenum"> 312</span></a>          <a class="var it9985" onMouseOver="hilite(9985)" onMouseOut="lolite()" onClick="logVariable('gradetypediff')" href="../../_variables/gradetypediff.html">$gradetypediff</a>   = <a class="var it9982" onMouseOver="hilite(9982)" onMouseOut="lolite()" onClick="logVariable('db_item')" href="../../_variables/db_item.html">$db_item</a>-&gt;<a onClick="logVariable('gradetype')" class="var it40060" onMouseOver="hilite(40060)" onMouseOut="lolite()" href="../../_variables/gradetype.html">gradetype</a>   != <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('gradetype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/gradetype.html">gradetype</a>;
<a name="l313"><span class="linenum"> 313</span></a>          <a class="var it9986" onMouseOver="hilite(9986)" onMouseOut="lolite()" onClick="logVariable('scaleiddiff')" href="../../_variables/scaleiddiff.html">$scaleiddiff</a>     = <a class="var it9982" onMouseOver="hilite(9982)" onMouseOut="lolite()" onClick="logVariable('db_item')" href="../../_variables/db_item.html">$db_item</a>-&gt;<a onClick="logVariable('scaleid')" class="var it40060" onMouseOver="hilite(40060)" onMouseOut="lolite()" href="../../_variables/scaleid.html">scaleid</a>     != <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('scaleid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/scaleid.html">scaleid</a>;
<a name="l314"><span class="linenum"> 314</span></a>          <a class="var it9987" onMouseOver="hilite(9987)" onMouseOut="lolite()" onClick="logVariable('outcomeiddiff')" href="../../_variables/outcomeiddiff.html">$outcomeiddiff</a>   = <a class="var it9982" onMouseOver="hilite(9982)" onMouseOut="lolite()" onClick="logVariable('db_item')" href="../../_variables/db_item.html">$db_item</a>-&gt;<a onClick="logVariable('outcomeid')" class="var it40060" onMouseOver="hilite(40060)" onMouseOut="lolite()" href="../../_variables/outcomeid.html">outcomeid</a>   != <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('outcomeid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/outcomeid.html">outcomeid</a>;
<a name="l315"><span class="linenum"> 315</span></a>          <a class="var it9988" onMouseOver="hilite(9988)" onMouseOut="lolite()" onClick="logVariable('locktimediff')" href="../../_variables/locktimediff.html">$locktimediff</a>    = <a class="var it9982" onMouseOver="hilite(9982)" onMouseOut="lolite()" onClick="logVariable('db_item')" href="../../_variables/db_item.html">$db_item</a>-&gt;<a onClick="logVariable('locktime')" class="var it40060" onMouseOver="hilite(40060)" onMouseOut="lolite()" href="../../_variables/locktime.html">locktime</a>    != <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('locktime')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/locktime.html">locktime</a>;
<a name="l316"><span class="linenum"> 316</span></a>          <a class="var it9989" onMouseOver="hilite(9989)" onMouseOut="lolite()" onClick="logVariable('grademindiff')" href="../../_variables/grademindiff.html">$grademindiff</a>    = <a class="function" onClick="logFunction('grade_floats_different')" href="../../_functions/grade_floats_different.html" onMouseOver="funcPopup(event,'grade_floats_different')">grade_floats_different</a>(<a class="var it9982" onMouseOver="hilite(9982)" onMouseOut="lolite()" onClick="logVariable('db_item')" href="../../_variables/db_item.html">$db_item</a>-&gt;<a onClick="logVariable('grademin')" class="var it40060" onMouseOver="hilite(40060)" onMouseOut="lolite()" href="../../_variables/grademin.html">grademin</a>,        <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademin')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademin.html">grademin</a>);
<a name="l317"><span class="linenum"> 317</span></a>          <a class="var it9990" onMouseOver="hilite(9990)" onMouseOut="lolite()" onClick="logVariable('grademaxdiff')" href="../../_variables/grademaxdiff.html">$grademaxdiff</a>    = <a class="function" onClick="logFunction('grade_floats_different')" href="../../_functions/grade_floats_different.html" onMouseOver="funcPopup(event,'grade_floats_different')">grade_floats_different</a>(<a class="var it9982" onMouseOver="hilite(9982)" onMouseOut="lolite()" onClick="logVariable('db_item')" href="../../_variables/db_item.html">$db_item</a>-&gt;<a onClick="logVariable('grademax')" class="var it40060" onMouseOver="hilite(40060)" onMouseOut="lolite()" href="../../_variables/grademax.html">grademax</a>,        <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademax')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademax.html">grademax</a>);
<a name="l318"><span class="linenum"> 318</span></a>          <a class="var it9991" onMouseOver="hilite(9991)" onMouseOut="lolite()" onClick="logVariable('multfactordiff')" href="../../_variables/multfactordiff.html">$multfactordiff</a>  = <a class="function" onClick="logFunction('grade_floats_different')" href="../../_functions/grade_floats_different.html" onMouseOver="funcPopup(event,'grade_floats_different')">grade_floats_different</a>(<a class="var it9982" onMouseOver="hilite(9982)" onMouseOut="lolite()" onClick="logVariable('db_item')" href="../../_variables/db_item.html">$db_item</a>-&gt;<a onClick="logVariable('multfactor')" class="var it40060" onMouseOver="hilite(40060)" onMouseOut="lolite()" href="../../_variables/multfactor.html">multfactor</a>,      <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('multfactor')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/multfactor.html">multfactor</a>);
<a name="l319"><span class="linenum"> 319</span></a>          <a class="var it9992" onMouseOver="hilite(9992)" onMouseOut="lolite()" onClick="logVariable('plusfactordiff')" href="../../_variables/plusfactordiff.html">$plusfactordiff</a>  = <a class="function" onClick="logFunction('grade_floats_different')" href="../../_functions/grade_floats_different.html" onMouseOver="funcPopup(event,'grade_floats_different')">grade_floats_different</a>(<a class="var it9982" onMouseOver="hilite(9982)" onMouseOut="lolite()" onClick="logVariable('db_item')" href="../../_variables/db_item.html">$db_item</a>-&gt;<a onClick="logVariable('plusfactor')" class="var it40060" onMouseOver="hilite(40060)" onMouseOut="lolite()" href="../../_variables/plusfactor.html">plusfactor</a>,      <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('plusfactor')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/plusfactor.html">plusfactor</a>);
<a name="l320"><span class="linenum"> 320</span></a>          <a class="var it9993" onMouseOver="hilite(9993)" onMouseOut="lolite()" onClick="logVariable('acoefdiff')" href="../../_variables/acoefdiff.html">$acoefdiff</a>       = <a class="function" onClick="logFunction('grade_floats_different')" href="../../_functions/grade_floats_different.html" onMouseOver="funcPopup(event,'grade_floats_different')">grade_floats_different</a>(<a class="var it9982" onMouseOver="hilite(9982)" onMouseOut="lolite()" onClick="logVariable('db_item')" href="../../_variables/db_item.html">$db_item</a>-&gt;<a onClick="logVariable('aggregationcoef')" class="var it40060" onMouseOver="hilite(40060)" onMouseOut="lolite()" href="../../_variables/aggregationcoef.html">aggregationcoef</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('aggregationcoef')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/aggregationcoef.html">aggregationcoef</a>);
<a name="l321"><span class="linenum"> 321</span></a>          <a class="var it9994" onMouseOver="hilite(9994)" onMouseOut="lolite()" onClick="logVariable('acoefdiff2')" href="../../_variables/acoefdiff2.html">$acoefdiff2</a>      = <a class="function" onClick="logFunction('grade_floats_different')" href="../../_functions/grade_floats_different.html" onMouseOver="funcPopup(event,'grade_floats_different')">grade_floats_different</a>(<a class="var it9982" onMouseOver="hilite(9982)" onMouseOut="lolite()" onClick="logVariable('db_item')" href="../../_variables/db_item.html">$db_item</a>-&gt;<a onClick="logVariable('aggregationcoef2')" class="var it40060" onMouseOver="hilite(40060)" onMouseOut="lolite()" href="../../_variables/aggregationcoef2.html">aggregationcoef2</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('aggregationcoef2')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/aggregationcoef2.html">aggregationcoef2</a>);
<a name="l322"><span class="linenum"> 322</span></a>          <a class="var it9980" onMouseOver="hilite(9980)" onMouseOut="lolite()" onClick="logVariable('weightoverride')" href="../../_variables/weightoverride.html">$weightoverride</a>  = <a class="function" onClick="logFunction('grade_floats_different')" href="../../_functions/grade_floats_different.html" onMouseOver="funcPopup(event,'grade_floats_different')">grade_floats_different</a>(<a class="var it9982" onMouseOver="hilite(9982)" onMouseOut="lolite()" onClick="logVariable('db_item')" href="../../_variables/db_item.html">$db_item</a>-&gt;<a onClick="logVariable('weightoverride')" class="var it40060" onMouseOver="hilite(40060)" onMouseOut="lolite()" href="../../_variables/weightoverride.html">weightoverride</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('weightoverride')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/weightoverride.html">weightoverride</a>);
<a name="l323"><span class="linenum"> 323</span></a>  
<a name="l324"><span class="linenum"> 324</span></a>          <a class="var it9995" onMouseOver="hilite(9995)" onMouseOut="lolite()" onClick="logVariable('needsupdatediff')" href="../../_variables/needsupdatediff.html">$needsupdatediff</a> = !<a class="var it9982" onMouseOver="hilite(9982)" onMouseOut="lolite()" onClick="logVariable('db_item')" href="../../_variables/db_item.html">$db_item</a>-&gt;<a onClick="logVariable('needsupdate')" class="var it40060" onMouseOver="hilite(40060)" onMouseOut="lolite()" href="../../_variables/needsupdate.html">needsupdate</a> &amp;&amp;  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('needsupdate')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/needsupdate.html">needsupdate</a>;    <span class="comment">// force regrading only if setting the flag first time</span>
<a name="l325"><span class="linenum"> 325</span></a>          <a class="var it9996" onMouseOver="hilite(9996)" onMouseOut="lolite()" onClick="logVariable('lockeddiff')" href="../../_variables/lockeddiff.html">$lockeddiff</a>      = !empty(<a class="var it9982" onMouseOver="hilite(9982)" onMouseOut="lolite()" onClick="logVariable('db_item')" href="../../_variables/db_item.html">$db_item</a>-&gt;<a onClick="logVariable('locked')" class="var it40060" onMouseOver="hilite(40060)" onMouseOut="lolite()" href="../../_variables/locked.html">locked</a>) &amp;&amp; empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('locked')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/locked.html">locked</a>); <span class="comment">// force regrading only when unlocking</span>
<a name="l326"><span class="linenum"> 326</span></a>  
<a name="l327"><span class="linenum"> 327</span></a>          return (<a class="var it9983" onMouseOver="hilite(9983)" onMouseOut="lolite()" onClick="logVariable('calculationdiff')" href="../../_variables/calculationdiff.html">$calculationdiff</a> || <a class="var it9984" onMouseOver="hilite(9984)" onMouseOut="lolite()" onClick="logVariable('categorydiff')" href="../../_variables/categorydiff.html">$categorydiff</a> || <a class="var it9985" onMouseOver="hilite(9985)" onMouseOut="lolite()" onClick="logVariable('gradetypediff')" href="../../_variables/gradetypediff.html">$gradetypediff</a> || <a class="var it9990" onMouseOver="hilite(9990)" onMouseOut="lolite()" onClick="logVariable('grademaxdiff')" href="../../_variables/grademaxdiff.html">$grademaxdiff</a> || <a class="var it9989" onMouseOver="hilite(9989)" onMouseOut="lolite()" onClick="logVariable('grademindiff')" href="../../_variables/grademindiff.html">$grademindiff</a> || <a class="var it9986" onMouseOver="hilite(9986)" onMouseOut="lolite()" onClick="logVariable('scaleiddiff')" href="../../_variables/scaleiddiff.html">$scaleiddiff</a>
<a name="l328"><span class="linenum"> 328</span></a>               || <a class="var it9987" onMouseOver="hilite(9987)" onMouseOut="lolite()" onClick="logVariable('outcomeiddiff')" href="../../_variables/outcomeiddiff.html">$outcomeiddiff</a> || <a class="var it9991" onMouseOver="hilite(9991)" onMouseOut="lolite()" onClick="logVariable('multfactordiff')" href="../../_variables/multfactordiff.html">$multfactordiff</a> || <a class="var it9992" onMouseOver="hilite(9992)" onMouseOut="lolite()" onClick="logVariable('plusfactordiff')" href="../../_variables/plusfactordiff.html">$plusfactordiff</a> || <a class="var it9995" onMouseOver="hilite(9995)" onMouseOut="lolite()" onClick="logVariable('needsupdatediff')" href="../../_variables/needsupdatediff.html">$needsupdatediff</a>
<a name="l329"><span class="linenum"> 329</span></a>               || <a class="var it9996" onMouseOver="hilite(9996)" onMouseOut="lolite()" onClick="logVariable('lockeddiff')" href="../../_variables/lockeddiff.html">$lockeddiff</a> || <a class="var it9993" onMouseOver="hilite(9993)" onMouseOut="lolite()" onClick="logVariable('acoefdiff')" href="../../_variables/acoefdiff.html">$acoefdiff</a> || <a class="var it9994" onMouseOver="hilite(9994)" onMouseOut="lolite()" onClick="logVariable('acoefdiff2')" href="../../_variables/acoefdiff2.html">$acoefdiff2</a> || <a class="var it9980" onMouseOver="hilite(9980)" onMouseOut="lolite()" onClick="logVariable('weightoverride')" href="../../_variables/weightoverride.html">$weightoverride</a> || <a class="var it9988" onMouseOver="hilite(9988)" onMouseOut="lolite()" onClick="logVariable('locktimediff')" href="../../_variables/locktimediff.html">$locktimediff</a>);
<a name="l330"><span class="linenum"> 330</span></a>      }
<a name="l331"><span class="linenum"> 331</span></a>  
<a name="l332"><span class="linenum"> 332</span></a>      <span class="comment">/**</span>
<a name="l333"><span class="linenum"> 333</span></a>  <span class="comment">     * Finds and returns a grade_item instance based on params.</span>
<a name="l334"><span class="linenum"> 334</span></a>  <span class="comment">     *</span>
<a name="l335"><span class="linenum"> 335</span></a>  <span class="comment">     * @static</span>
<a name="l336"><span class="linenum"> 336</span></a>  <span class="comment">     * @param array $params associative arrays varname=&gt;value</span>
<a name="l337"><span class="linenum"> 337</span></a>  <span class="comment">     * @return grade_item|bool Returns a grade_item instance or false if none found</span>
<a name="l338"><span class="linenum"> 338</span></a>  <span class="comment">     */</span>
<a name="l339"><span class="linenum"> 339</span></a>      public static function <a class="function" onClick="logFunction('fetch')" href="../../_functions/fetch.html" onMouseOver="funcPopup(event,'fetch')">fetch</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>) {
<a name="l340"><span class="linenum"> 340</span></a>          return grade_object::<a class="function" onClick="logFunction('fetch_helper')" href="../../_functions/fetch_helper.html" onMouseOver="funcPopup(event,'fetch_helper')">fetch_helper</a>('grade_items', 'grade_item', <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l341"><span class="linenum"> 341</span></a>      }
<a name="l342"><span class="linenum"> 342</span></a>  
<a name="l343"><span class="linenum"> 343</span></a>      <span class="comment">/**</span>
<a name="l344"><span class="linenum"> 344</span></a>  <span class="comment">     * Finds and returns all grade_item instances based on params.</span>
<a name="l345"><span class="linenum"> 345</span></a>  <span class="comment">     *</span>
<a name="l346"><span class="linenum"> 346</span></a>  <span class="comment">     * @static</span>
<a name="l347"><span class="linenum"> 347</span></a>  <span class="comment">     * @param array $params associative arrays varname=&gt;value</span>
<a name="l348"><span class="linenum"> 348</span></a>  <span class="comment">     * @return array array of grade_item instances or false if none found.</span>
<a name="l349"><span class="linenum"> 349</span></a>  <span class="comment">     */</span>
<a name="l350"><span class="linenum"> 350</span></a>      public static function <a class="function" onClick="logFunction('fetch_all')" href="../../_functions/fetch_all.html" onMouseOver="funcPopup(event,'fetch_all')">fetch_all</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>) {
<a name="l351"><span class="linenum"> 351</span></a>          return grade_object::<a class="function" onClick="logFunction('fetch_all_helper')" href="../../_functions/fetch_all_helper.html" onMouseOver="funcPopup(event,'fetch_all_helper')">fetch_all_helper</a>('grade_items', 'grade_item', <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l352"><span class="linenum"> 352</span></a>      }
<a name="l353"><span class="linenum"> 353</span></a>  
<a name="l354"><span class="linenum"> 354</span></a>      <span class="comment">/**</span>
<a name="l355"><span class="linenum"> 355</span></a>  <span class="comment">     * Delete all grades and force_regrading of parent category.</span>
<a name="l356"><span class="linenum"> 356</span></a>  <span class="comment">     *</span>
<a name="l357"><span class="linenum"> 357</span></a>  <span class="comment">     * @param string $source from where was the object deleted (mod/forum, manual, etc.)</span>
<a name="l358"><span class="linenum"> 358</span></a>  <span class="comment">     * @return bool success</span>
<a name="l359"><span class="linenum"> 359</span></a>  <span class="comment">     */</span>
<a name="l360"><span class="linenum"> 360</span></a>      public function <a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>(<a class="var it1344" onMouseOver="hilite(1344)" onMouseOut="lolite()" onClick="logVariable('source')" href="../../_variables/source.html">$source</a>=null) {
<a name="l361"><span class="linenum"> 361</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('delete_all_grades')" href="../../_functions/delete_all_grades.html" onMouseOver="funcPopup(event,'delete_all_grades')">delete_all_grades</a>(<a class="var it1344" onMouseOver="hilite(1344)" onMouseOut="lolite()" onClick="logVariable('source')" href="../../_variables/source.html">$source</a>);
<a name="l362"><span class="linenum"> 362</span></a>          return parent::<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>(<a class="var it1344" onMouseOver="hilite(1344)" onMouseOut="lolite()" onClick="logVariable('source')" href="../../_variables/source.html">$source</a>);
<a name="l363"><span class="linenum"> 363</span></a>      }
<a name="l364"><span class="linenum"> 364</span></a>  
<a name="l365"><span class="linenum"> 365</span></a>      <span class="comment">/**</span>
<a name="l366"><span class="linenum"> 366</span></a>  <span class="comment">     * Delete all grades</span>
<a name="l367"><span class="linenum"> 367</span></a>  <span class="comment">     *</span>
<a name="l368"><span class="linenum"> 368</span></a>  <span class="comment">     * @param string $source from where was the object deleted (mod/forum, manual, etc.)</span>
<a name="l369"><span class="linenum"> 369</span></a>  <span class="comment">     * @return bool</span>
<a name="l370"><span class="linenum"> 370</span></a>  <span class="comment">     */</span>
<a name="l371"><span class="linenum"> 371</span></a>      public function <a class="function" onClick="logFunction('delete_all_grades')" href="../../_functions/delete_all_grades.html" onMouseOver="funcPopup(event,'delete_all_grades')">delete_all_grades</a>(<a class="var it1344" onMouseOver="hilite(1344)" onMouseOut="lolite()" onClick="logVariable('source')" href="../../_variables/source.html">$source</a>=null) {
<a name="l372"><span class="linenum"> 372</span></a>          if (!<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_course_item')" href="../../_functions/is_course_item.html" onMouseOver="funcPopup(event,'is_course_item')">is_course_item</a>()) {
<a name="l373"><span class="linenum"> 373</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('force_regrading')" href="../../_functions/force_regrading.html" onMouseOver="funcPopup(event,'force_regrading')">force_regrading</a>();
<a name="l374"><span class="linenum"> 374</span></a>          }
<a name="l375"><span class="linenum"> 375</span></a>  
<a name="l376"><span class="linenum"> 376</span></a>          if (<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = <a class="class" onClick="logClass('grade_grade')" href="../../_classes/grade_grade.html" onMouseOver="classPopup(event,'grade_grade')">grade_grade</a>::<a class="function" onClick="logFunction('fetch_all')" href="../../_functions/fetch_all.html" onMouseOver="funcPopup(event,'fetch_all')">fetch_all</a>(array('itemid'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l377"><span class="linenum"> 377</span></a>              foreach (<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> as <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>) {
<a name="l378"><span class="linenum"> 378</span></a>                  <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>(<a class="var it1344" onMouseOver="hilite(1344)" onMouseOut="lolite()" onClick="logVariable('source')" href="../../_variables/source.html">$source</a>);
<a name="l379"><span class="linenum"> 379</span></a>              }
<a name="l380"><span class="linenum"> 380</span></a>          }
<a name="l381"><span class="linenum"> 381</span></a>  
<a name="l382"><span class="linenum"> 382</span></a>          return true;
<a name="l383"><span class="linenum"> 383</span></a>      }
<a name="l384"><span class="linenum"> 384</span></a>  
<a name="l385"><span class="linenum"> 385</span></a>      <span class="comment">/**</span>
<a name="l386"><span class="linenum"> 386</span></a>  <span class="comment">     * In addition to perform parent::insert(), calls force_regrading() method too.</span>
<a name="l387"><span class="linenum"> 387</span></a>  <span class="comment">     *</span>
<a name="l388"><span class="linenum"> 388</span></a>  <span class="comment">     * @param string $source From where was the object inserted (mod/forum, manual, etc.)</span>
<a name="l389"><span class="linenum"> 389</span></a>  <span class="comment">     * @return int PK ID if successful, false otherwise</span>
<a name="l390"><span class="linenum"> 390</span></a>  <span class="comment">     */</span>
<a name="l391"><span class="linenum"> 391</span></a>      public function <a class="function" onClick="logFunction('insert')" href="../../_functions/insert.html" onMouseOver="funcPopup(event,'insert')">insert</a>(<a class="var it1344" onMouseOver="hilite(1344)" onMouseOut="lolite()" onClick="logVariable('source')" href="../../_variables/source.html">$source</a>=null) {
<a name="l392"><span class="linenum"> 392</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l393"><span class="linenum"> 393</span></a>  
<a name="l394"><span class="linenum"> 394</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>)) {
<a name="l395"><span class="linenum"> 395</span></a>              <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('cannotinsertgrade');
<a name="l396"><span class="linenum"> 396</span></a>          }
<a name="l397"><span class="linenum"> 397</span></a>  
<a name="l398"><span class="linenum"> 398</span></a>  <span class="comment">        // load scale if needed</span>
<a name="l399"><span class="linenum"> 399</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('load_scale')" href="../../_functions/load_scale.html" onMouseOver="funcPopup(event,'load_scale')">load_scale</a>();
<a name="l400"><span class="linenum"> 400</span></a>  
<a name="l401"><span class="linenum"> 401</span></a>  <span class="comment">        // add parent category if needed</span>
<a name="l402"><span class="linenum"> 402</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('categoryid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/categoryid.html">categoryid</a>) and !<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_course_item')" href="../../_functions/is_course_item.html" onMouseOver="funcPopup(event,'is_course_item')">is_course_item</a>() and !<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_category_item')" href="../../_functions/is_category_item.html" onMouseOver="funcPopup(event,'is_category_item')">is_category_item</a>()) {
<a name="l403"><span class="linenum"> 403</span></a>              <a class="var it9997" onMouseOver="hilite(9997)" onMouseOut="lolite()" onClick="logVariable('course_category')" href="../../_variables/course_category.html">$course_category</a> = <a class="class" onClick="logClass('grade_category')" href="../../_classes/grade_category.html" onMouseOver="classPopup(event,'grade_category')">grade_category</a>::<a class="function" onClick="logFunction('fetch_course_category')" href="../../_functions/fetch_course_category.html" onMouseOver="funcPopup(event,'fetch_course_category')">fetch_course_category</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l404"><span class="linenum"> 404</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('categoryid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/categoryid.html">categoryid</a> = <a class="var it9997" onMouseOver="hilite(9997)" onMouseOut="lolite()" onClick="logVariable('course_category')" href="../../_variables/course_category.html">$course_category</a>-&gt;<a onClick="logVariable('id')" class="var it40059" onMouseOver="hilite(40059)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l405"><span class="linenum"> 405</span></a>  
<a name="l406"><span class="linenum"> 406</span></a>          }
<a name="l407"><span class="linenum"> 407</span></a>  
<a name="l408"><span class="linenum"> 408</span></a>  <span class="comment">        // always place the new items at the end, move them after insert if needed</span>
<a name="l409"><span class="linenum"> 409</span></a>          <a class="var it9998" onMouseOver="hilite(9998)" onMouseOut="lolite()" onClick="logVariable('last_sortorder')" href="../../_variables/last_sortorder.html">$last_sortorder</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field_select')" href="../../_functions/get_field_select.html" onMouseOver="funcPopup(event,'get_field_select')">get_field_select</a>('grade_items', '<a class="phpfunction" onClick="logFunction('MAX')" href="../../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">MAX</a>(sortorder)', &quot;courseid = ?&quot;, array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>));
<a name="l410"><span class="linenum"> 410</span></a>          if (!empty(<a class="var it9998" onMouseOver="hilite(9998)" onMouseOut="lolite()" onClick="logVariable('last_sortorder')" href="../../_variables/last_sortorder.html">$last_sortorder</a>)) {
<a name="l411"><span class="linenum"> 411</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('sortorder')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a> = <a class="var it9998" onMouseOver="hilite(9998)" onMouseOut="lolite()" onClick="logVariable('last_sortorder')" href="../../_variables/last_sortorder.html">$last_sortorder</a> + 1;
<a name="l412"><span class="linenum"> 412</span></a>          } else {
<a name="l413"><span class="linenum"> 413</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('sortorder')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a> = 1;
<a name="l414"><span class="linenum"> 414</span></a>          }
<a name="l415"><span class="linenum"> 415</span></a>  
<a name="l416"><span class="linenum"> 416</span></a>  <span class="comment">        // add proper item numbers to manual items</span>
<a name="l417"><span class="linenum"> 417</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemtype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemtype.html">itemtype</a> == 'manual') {
<a name="l418"><span class="linenum"> 418</span></a>              if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemnumber')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemnumber.html">itemnumber</a>)) {
<a name="l419"><span class="linenum"> 419</span></a>                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemnumber')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemnumber.html">itemnumber</a> = 0;
<a name="l420"><span class="linenum"> 420</span></a>              }
<a name="l421"><span class="linenum"> 421</span></a>          }
<a name="l422"><span class="linenum"> 422</span></a>  
<a name="l423"><span class="linenum"> 423</span></a>  <span class="comment">        // make sure there is not 0 in outcomeid</span>
<a name="l424"><span class="linenum"> 424</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('outcomeid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/outcomeid.html">outcomeid</a>)) {
<a name="l425"><span class="linenum"> 425</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('outcomeid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/outcomeid.html">outcomeid</a> = null;
<a name="l426"><span class="linenum"> 426</span></a>          }
<a name="l427"><span class="linenum"> 427</span></a>  
<a name="l428"><span class="linenum"> 428</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('timecreated')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('timemodified')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l429"><span class="linenum"> 429</span></a>  
<a name="l430"><span class="linenum"> 430</span></a>          if (parent::<a class="function" onClick="logFunction('insert')" href="../../_functions/insert.html" onMouseOver="funcPopup(event,'insert')">insert</a>(<a class="var it1344" onMouseOver="hilite(1344)" onMouseOut="lolite()" onClick="logVariable('source')" href="../../_variables/source.html">$source</a>)) {
<a name="l431"><span class="linenum"> 431</span></a>  <span class="comment">            // force regrading of items if needed</span>
<a name="l432"><span class="linenum"> 432</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('force_regrading')" href="../../_functions/force_regrading.html" onMouseOver="funcPopup(event,'force_regrading')">force_regrading</a>();
<a name="l433"><span class="linenum"> 433</span></a>              return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l434"><span class="linenum"> 434</span></a>  
<a name="l435"><span class="linenum"> 435</span></a>          } else {
<a name="l436"><span class="linenum"> 436</span></a>              <a class="function" onClick="logFunction('debugging')" href="../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>(&quot;Could not insert this grade_item in the database!&quot;);
<a name="l437"><span class="linenum"> 437</span></a>              return false;
<a name="l438"><span class="linenum"> 438</span></a>          }
<a name="l439"><span class="linenum"> 439</span></a>      }
<a name="l440"><span class="linenum"> 440</span></a>  
<a name="l441"><span class="linenum"> 441</span></a>      <span class="comment">/**</span>
<a name="l442"><span class="linenum"> 442</span></a>  <span class="comment">     * Set idnumber of grade item, updates also course_modules table</span>
<a name="l443"><span class="linenum"> 443</span></a>  <span class="comment">     *</span>
<a name="l444"><span class="linenum"> 444</span></a>  <span class="comment">     * @param string $idnumber (without magic quotes)</span>
<a name="l445"><span class="linenum"> 445</span></a>  <span class="comment">     * @return bool success</span>
<a name="l446"><span class="linenum"> 446</span></a>  <span class="comment">     */</span>
<a name="l447"><span class="linenum"> 447</span></a>      public function <a class="function" onClick="logFunction('add_idnumber')" href="../../_functions/add_idnumber.html" onMouseOver="funcPopup(event,'add_idnumber')">add_idnumber</a>(<a class="var it2926" onMouseOver="hilite(2926)" onMouseOut="lolite()" onClick="logVariable('idnumber')" href="../../_variables/idnumber.html">$idnumber</a>) {
<a name="l448"><span class="linenum"> 448</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l449"><span class="linenum"> 449</span></a>          if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('idnumber')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>)) {
<a name="l450"><span class="linenum"> 450</span></a>              return false;
<a name="l451"><span class="linenum"> 451</span></a>          }
<a name="l452"><span class="linenum"> 452</span></a>  
<a name="l453"><span class="linenum"> 453</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemtype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemtype.html">itemtype</a> == 'mod' and !<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_outcome_item')" href="../../_functions/is_outcome_item.html" onMouseOver="funcPopup(event,'is_outcome_item')">is_outcome_item</a>()) {
<a name="l454"><span class="linenum"> 454</span></a>              if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemnumber')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemnumber.html">itemnumber</a> == 0) {
<a name="l455"><span class="linenum"> 455</span></a>  <span class="comment">                // for activity modules, itemnumber 0 is synced with the course_modules</span>
<a name="l456"><span class="linenum"> 456</span></a>                  if (!<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemmodule')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemmodule.html">itemmodule</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('iteminstance')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/iteminstance.html">iteminstance</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>)) {
<a name="l457"><span class="linenum"> 457</span></a>                      return false;
<a name="l458"><span class="linenum"> 458</span></a>                  }
<a name="l459"><span class="linenum"> 459</span></a>                  if (!empty(<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('idnumber')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>)) {
<a name="l460"><span class="linenum"> 460</span></a>                      return false;
<a name="l461"><span class="linenum"> 461</span></a>                  }
<a name="l462"><span class="linenum"> 462</span></a>                  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('course_modules', 'idnumber', <a class="var it2926" onMouseOver="hilite(2926)" onMouseOut="lolite()" onClick="logVariable('idnumber')" href="../../_variables/idnumber.html">$idnumber</a>, array('id' =&gt; <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l463"><span class="linenum"> 463</span></a>                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('idnumber')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a> = <a class="var it2926" onMouseOver="hilite(2926)" onMouseOut="lolite()" onClick="logVariable('idnumber')" href="../../_variables/idnumber.html">$idnumber</a>;
<a name="l464"><span class="linenum"> 464</span></a>                  return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l465"><span class="linenum"> 465</span></a>              } else {
<a name="l466"><span class="linenum"> 466</span></a>                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('idnumber')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a> = <a class="var it2926" onMouseOver="hilite(2926)" onMouseOut="lolite()" onClick="logVariable('idnumber')" href="../../_variables/idnumber.html">$idnumber</a>;
<a name="l467"><span class="linenum"> 467</span></a>                  return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l468"><span class="linenum"> 468</span></a>              }
<a name="l469"><span class="linenum"> 469</span></a>  
<a name="l470"><span class="linenum"> 470</span></a>          } else {
<a name="l471"><span class="linenum"> 471</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('idnumber')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a> = <a class="var it2926" onMouseOver="hilite(2926)" onMouseOut="lolite()" onClick="logVariable('idnumber')" href="../../_variables/idnumber.html">$idnumber</a>;
<a name="l472"><span class="linenum"> 472</span></a>              return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l473"><span class="linenum"> 473</span></a>          }
<a name="l474"><span class="linenum"> 474</span></a>      }
<a name="l475"><span class="linenum"> 475</span></a>  
<a name="l476"><span class="linenum"> 476</span></a>      <span class="comment">/**</span>
<a name="l477"><span class="linenum"> 477</span></a>  <span class="comment">     * Returns the locked state of this grade_item (if the grade_item is locked OR no specific</span>
<a name="l478"><span class="linenum"> 478</span></a>  <span class="comment">     * $userid is given) or the locked state of a specific grade within this item if a specific</span>
<a name="l479"><span class="linenum"> 479</span></a>  <span class="comment">     * $userid is given and the grade_item is unlocked.</span>
<a name="l480"><span class="linenum"> 480</span></a>  <span class="comment">     *</span>
<a name="l481"><span class="linenum"> 481</span></a>  <span class="comment">     * @param int $userid The user's ID</span>
<a name="l482"><span class="linenum"> 482</span></a>  <span class="comment">     * @return bool Locked state</span>
<a name="l483"><span class="linenum"> 483</span></a>  <span class="comment">     */</span>
<a name="l484"><span class="linenum"> 484</span></a>      public function <a class="function" onClick="logFunction('is_locked')" href="../../_functions/is_locked.html" onMouseOver="funcPopup(event,'is_locked')">is_locked</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>=NULL) {
<a name="l485"><span class="linenum"> 485</span></a>          if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('locked')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/locked.html">locked</a>)) {
<a name="l486"><span class="linenum"> 486</span></a>              return true;
<a name="l487"><span class="linenum"> 487</span></a>          }
<a name="l488"><span class="linenum"> 488</span></a>  
<a name="l489"><span class="linenum"> 489</span></a>          if (!empty(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>)) {
<a name="l490"><span class="linenum"> 490</span></a>              if (<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = <a class="class" onClick="logClass('grade_grade')" href="../../_classes/grade_grade.html" onMouseOver="classPopup(event,'grade_grade')">grade_grade</a>::<a class="function" onClick="logFunction('fetch')" href="../../_functions/fetch.html" onMouseOver="funcPopup(event,'fetch')">fetch</a>(array('itemid'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid'=&gt;<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>))) {
<a name="l491"><span class="linenum"> 491</span></a>                  <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('grade_item')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/grade_item.html">grade_item</a> =&amp; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>; <span class="comment">// prevent db fetching of cached grade_item</span>
<a name="l492"><span class="linenum"> 492</span></a>                  return <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('is_locked')" href="../../_functions/is_locked.html" onMouseOver="funcPopup(event,'is_locked')">is_locked</a>();
<a name="l493"><span class="linenum"> 493</span></a>              }
<a name="l494"><span class="linenum"> 494</span></a>          }
<a name="l495"><span class="linenum"> 495</span></a>  
<a name="l496"><span class="linenum"> 496</span></a>          return false;
<a name="l497"><span class="linenum"> 497</span></a>      }
<a name="l498"><span class="linenum"> 498</span></a>  
<a name="l499"><span class="linenum"> 499</span></a>      <span class="comment">/**</span>
<a name="l500"><span class="linenum"> 500</span></a>  <span class="comment">     * Locks or unlocks this grade_item and (optionally) all its associated final grades.</span>
<a name="l501"><span class="linenum"> 501</span></a>  <span class="comment">     *</span>
<a name="l502"><span class="linenum"> 502</span></a>  <span class="comment">     * @param int $lockedstate 0, 1 or a timestamp int(10) after which date the item will be locked.</span>
<a name="l503"><span class="linenum"> 503</span></a>  <span class="comment">     * @param bool $cascade Lock/unlock child objects too</span>
<a name="l504"><span class="linenum"> 504</span></a>  <span class="comment">     * @param bool $refresh Refresh grades when unlocking</span>
<a name="l505"><span class="linenum"> 505</span></a>  <span class="comment">     * @return bool True if grade_item all grades updated, false if at least one update fails</span>
<a name="l506"><span class="linenum"> 506</span></a>  <span class="comment">     */</span>
<a name="l507"><span class="linenum"> 507</span></a>      public function <a class="function" onClick="logFunction('set_locked')" href="../../_functions/set_locked.html" onMouseOver="funcPopup(event,'set_locked')">set_locked</a>(<a class="var it9999" onMouseOver="hilite(9999)" onMouseOut="lolite()" onClick="logVariable('lockedstate')" href="../../_variables/lockedstate.html">$lockedstate</a>, <a class="var it3056" onMouseOver="hilite(3056)" onMouseOut="lolite()" onClick="logVariable('cascade')" href="../../_variables/cascade.html">$cascade</a>=false, <a class="var it10000" onMouseOver="hilite(10000)" onMouseOut="lolite()" onClick="logVariable('refresh')" href="../../_variables/refresh.html">$refresh</a>=true) {
<a name="l508"><span class="linenum"> 508</span></a>          if (<a class="var it9999" onMouseOver="hilite(9999)" onMouseOut="lolite()" onClick="logVariable('lockedstate')" href="../../_variables/lockedstate.html">$lockedstate</a>) {
<a name="l509"><span class="linenum"> 509</span></a>  <span class="comment">        /// setting lock</span>
<a name="l510"><span class="linenum"> 510</span></a>              if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('needsupdate')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/needsupdate.html">needsupdate</a>) {
<a name="l511"><span class="linenum"> 511</span></a>                  return false; <span class="comment">// can not lock grade without first having final grade</span>
<a name="l512"><span class="linenum"> 512</span></a>              }
<a name="l513"><span class="linenum"> 513</span></a>  
<a name="l514"><span class="linenum"> 514</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('locked')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/locked.html">locked</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l515"><span class="linenum"> 515</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l516"><span class="linenum"> 516</span></a>  
<a name="l517"><span class="linenum"> 517</span></a>              if (<a class="var it3056" onMouseOver="hilite(3056)" onMouseOut="lolite()" onClick="logVariable('cascade')" href="../../_variables/cascade.html">$cascade</a>) {
<a name="l518"><span class="linenum"> 518</span></a>                  <a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_final')" href="../../_functions/get_final.html" onMouseOver="funcPopup(event,'get_final')">get_final</a>();
<a name="l519"><span class="linenum"> 519</span></a>                  foreach(<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> as <a class="var it2364" onMouseOver="hilite(2364)" onMouseOut="lolite()" onClick="logVariable('g')" href="../../_variables/g.html">$g</a>) {
<a name="l520"><span class="linenum"> 520</span></a>                      <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = <span class="keyword">new </span><a class="class" onClick="logClass('grade_grade')" href="../../_classes/grade_grade.html" onMouseOver="classPopup(event,'grade_grade')">grade_grade</a>(<a class="var it2364" onMouseOver="hilite(2364)" onMouseOut="lolite()" onClick="logVariable('g')" href="../../_variables/g.html">$g</a>, false);
<a name="l521"><span class="linenum"> 521</span></a>                      <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('grade_item')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/grade_item.html">grade_item</a> =&amp; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>;
<a name="l522"><span class="linenum"> 522</span></a>                      <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('set_locked')" href="../../_functions/set_locked.html" onMouseOver="funcPopup(event,'set_locked')">set_locked</a>(1, null, false);
<a name="l523"><span class="linenum"> 523</span></a>                  }
<a name="l524"><span class="linenum"> 524</span></a>              }
<a name="l525"><span class="linenum"> 525</span></a>  
<a name="l526"><span class="linenum"> 526</span></a>              return true;
<a name="l527"><span class="linenum"> 527</span></a>  
<a name="l528"><span class="linenum"> 528</span></a>          } else {
<a name="l529"><span class="linenum"> 529</span></a>  <span class="comment">        /// removing lock</span>
<a name="l530"><span class="linenum"> 530</span></a>              if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('locked')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/locked.html">locked</a>) and <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('locktime')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/locktime.html">locktime</a> &lt; <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()) {
<a name="l531"><span class="linenum"> 531</span></a>  <span class="comment">                //we have to reset locktime or else it would lock up again</span>
<a name="l532"><span class="linenum"> 532</span></a>                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('locktime')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/locktime.html">locktime</a> = 0;
<a name="l533"><span class="linenum"> 533</span></a>              }
<a name="l534"><span class="linenum"> 534</span></a>  
<a name="l535"><span class="linenum"> 535</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('locked')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/locked.html">locked</a> = 0;
<a name="l536"><span class="linenum"> 536</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l537"><span class="linenum"> 537</span></a>  
<a name="l538"><span class="linenum"> 538</span></a>              if (<a class="var it3056" onMouseOver="hilite(3056)" onMouseOut="lolite()" onClick="logVariable('cascade')" href="../../_variables/cascade.html">$cascade</a>) {
<a name="l539"><span class="linenum"> 539</span></a>                  if (<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = <a class="class" onClick="logClass('grade_grade')" href="../../_classes/grade_grade.html" onMouseOver="classPopup(event,'grade_grade')">grade_grade</a>::<a class="function" onClick="logFunction('fetch_all')" href="../../_functions/fetch_all.html" onMouseOver="funcPopup(event,'fetch_all')">fetch_all</a>(array('itemid'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l540"><span class="linenum"> 540</span></a>                      foreach(<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> as <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>) {
<a name="l541"><span class="linenum"> 541</span></a>                          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('grade_item')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/grade_item.html">grade_item</a> =&amp; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>;
<a name="l542"><span class="linenum"> 542</span></a>                          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('set_locked')" href="../../_functions/set_locked.html" onMouseOver="funcPopup(event,'set_locked')">set_locked</a>(0, null, false);
<a name="l543"><span class="linenum"> 543</span></a>                      }
<a name="l544"><span class="linenum"> 544</span></a>                  }
<a name="l545"><span class="linenum"> 545</span></a>              }
<a name="l546"><span class="linenum"> 546</span></a>  
<a name="l547"><span class="linenum"> 547</span></a>              if (<a class="var it10000" onMouseOver="hilite(10000)" onMouseOut="lolite()" onClick="logVariable('refresh')" href="../../_variables/refresh.html">$refresh</a>) {
<a name="l548"><span class="linenum"> 548</span></a>  <span class="comment">                //refresh when unlocking</span>
<a name="l549"><span class="linenum"> 549</span></a>                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('refresh_grades')" href="../../_functions/refresh_grades.html" onMouseOver="funcPopup(event,'refresh_grades')">refresh_grades</a>();
<a name="l550"><span class="linenum"> 550</span></a>              }
<a name="l551"><span class="linenum"> 551</span></a>  
<a name="l552"><span class="linenum"> 552</span></a>              return true;
<a name="l553"><span class="linenum"> 553</span></a>          }
<a name="l554"><span class="linenum"> 554</span></a>      }
<a name="l555"><span class="linenum"> 555</span></a>  
<a name="l556"><span class="linenum"> 556</span></a>      <span class="comment">/**</span>
<a name="l557"><span class="linenum"> 557</span></a>  <span class="comment">     * Lock the grade if needed. Make sure this is called only when final grades are valid</span>
<a name="l558"><span class="linenum"> 558</span></a>  <span class="comment">     */</span>
<a name="l559"><span class="linenum"> 559</span></a>      public function <a class="function" onClick="logFunction('check_locktime')" href="../../_functions/check_locktime.html" onMouseOver="funcPopup(event,'check_locktime')">check_locktime</a>() {
<a name="l560"><span class="linenum"> 560</span></a>          if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('locked')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/locked.html">locked</a>)) {
<a name="l561"><span class="linenum"> 561</span></a>              return; <span class="comment">// already locked</span>
<a name="l562"><span class="linenum"> 562</span></a>          }
<a name="l563"><span class="linenum"> 563</span></a>  
<a name="l564"><span class="linenum"> 564</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('locktime')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/locktime.html">locktime</a> and <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('locktime')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/locktime.html">locktime</a> &lt; <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()) {
<a name="l565"><span class="linenum"> 565</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('locked')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/locked.html">locked</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l566"><span class="linenum"> 566</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>('locktime');
<a name="l567"><span class="linenum"> 567</span></a>          }
<a name="l568"><span class="linenum"> 568</span></a>      }
<a name="l569"><span class="linenum"> 569</span></a>  
<a name="l570"><span class="linenum"> 570</span></a>      <span class="comment">/**</span>
<a name="l571"><span class="linenum"> 571</span></a>  <span class="comment">     * Set the locktime for this grade item.</span>
<a name="l572"><span class="linenum"> 572</span></a>  <span class="comment">     *</span>
<a name="l573"><span class="linenum"> 573</span></a>  <span class="comment">     * @param int $locktime timestamp for lock to activate</span>
<a name="l574"><span class="linenum"> 574</span></a>  <span class="comment">     * @return void</span>
<a name="l575"><span class="linenum"> 575</span></a>  <span class="comment">     */</span>
<a name="l576"><span class="linenum"> 576</span></a>      public function <a class="function" onClick="logFunction('set_locktime')" href="../../_functions/set_locktime.html" onMouseOver="funcPopup(event,'set_locktime')">set_locktime</a>(<a class="var it9479" onMouseOver="hilite(9479)" onMouseOut="lolite()" onClick="logVariable('locktime')" href="../../_variables/locktime.html">$locktime</a>) {
<a name="l577"><span class="linenum"> 577</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('locktime')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/locktime.html">locktime</a> = <a class="var it9479" onMouseOver="hilite(9479)" onMouseOut="lolite()" onClick="logVariable('locktime')" href="../../_variables/locktime.html">$locktime</a>;
<a name="l578"><span class="linenum"> 578</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l579"><span class="linenum"> 579</span></a>      }
<a name="l580"><span class="linenum"> 580</span></a>  
<a name="l581"><span class="linenum"> 581</span></a>      <span class="comment">/**</span>
<a name="l582"><span class="linenum"> 582</span></a>  <span class="comment">     * Set the locktime for this grade item.</span>
<a name="l583"><span class="linenum"> 583</span></a>  <span class="comment">     *</span>
<a name="l584"><span class="linenum"> 584</span></a>  <span class="comment">     * @return int $locktime timestamp for lock to activate</span>
<a name="l585"><span class="linenum"> 585</span></a>  <span class="comment">     */</span>
<a name="l586"><span class="linenum"> 586</span></a>      public function <a class="function" onClick="logFunction('get_locktime')" href="../../_functions/get_locktime.html" onMouseOver="funcPopup(event,'get_locktime')">get_locktime</a>() {
<a name="l587"><span class="linenum"> 587</span></a>          return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('locktime')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/locktime.html">locktime</a>;
<a name="l588"><span class="linenum"> 588</span></a>      }
<a name="l589"><span class="linenum"> 589</span></a>  
<a name="l590"><span class="linenum"> 590</span></a>      <span class="comment">/**</span>
<a name="l591"><span class="linenum"> 591</span></a>  <span class="comment">     * Set the hidden status of grade_item and all grades.</span>
<a name="l592"><span class="linenum"> 592</span></a>  <span class="comment">     *</span>
<a name="l593"><span class="linenum"> 593</span></a>  <span class="comment">     * 0 mean always visible, 1 means always hidden and a number &gt; 1 is a timestamp to hide until</span>
<a name="l594"><span class="linenum"> 594</span></a>  <span class="comment">     *</span>
<a name="l595"><span class="linenum"> 595</span></a>  <span class="comment">     * @param int $hidden new hidden status</span>
<a name="l596"><span class="linenum"> 596</span></a>  <span class="comment">     * @param bool $cascade apply to child objects too</span>
<a name="l597"><span class="linenum"> 597</span></a>  <span class="comment">     */</span>
<a name="l598"><span class="linenum"> 598</span></a>      public function <a class="function" onClick="logFunction('set_hidden')" href="../../_functions/set_hidden.html" onMouseOver="funcPopup(event,'set_hidden')">set_hidden</a>(<a class="var it1532" onMouseOver="hilite(1532)" onMouseOut="lolite()" onClick="logVariable('hidden')" href="../../_variables/hidden.html">$hidden</a>, <a class="var it3056" onMouseOver="hilite(3056)" onMouseOut="lolite()" onClick="logVariable('cascade')" href="../../_variables/cascade.html">$cascade</a>=false) {
<a name="l599"><span class="linenum"> 599</span></a>          parent::<a class="function" onClick="logFunction('set_hidden')" href="../../_functions/set_hidden.html" onMouseOver="funcPopup(event,'set_hidden')">set_hidden</a>(<a class="var it1532" onMouseOver="hilite(1532)" onMouseOut="lolite()" onClick="logVariable('hidden')" href="../../_variables/hidden.html">$hidden</a>, <a class="var it3056" onMouseOver="hilite(3056)" onMouseOut="lolite()" onClick="logVariable('cascade')" href="../../_variables/cascade.html">$cascade</a>);
<a name="l600"><span class="linenum"> 600</span></a>  
<a name="l601"><span class="linenum"> 601</span></a>          if (<a class="var it3056" onMouseOver="hilite(3056)" onMouseOut="lolite()" onClick="logVariable('cascade')" href="../../_variables/cascade.html">$cascade</a>) {
<a name="l602"><span class="linenum"> 602</span></a>              if (<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = <a class="class" onClick="logClass('grade_grade')" href="../../_classes/grade_grade.html" onMouseOver="classPopup(event,'grade_grade')">grade_grade</a>::<a class="function" onClick="logFunction('fetch_all')" href="../../_functions/fetch_all.html" onMouseOver="funcPopup(event,'fetch_all')">fetch_all</a>(array('itemid'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l603"><span class="linenum"> 603</span></a>                  foreach(<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> as <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>) {
<a name="l604"><span class="linenum"> 604</span></a>                      <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('grade_item')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/grade_item.html">grade_item</a> =&amp; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>;
<a name="l605"><span class="linenum"> 605</span></a>                      <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('set_hidden')" href="../../_functions/set_hidden.html" onMouseOver="funcPopup(event,'set_hidden')">set_hidden</a>(<a class="var it1532" onMouseOver="hilite(1532)" onMouseOut="lolite()" onClick="logVariable('hidden')" href="../../_variables/hidden.html">$hidden</a>, <a class="var it3056" onMouseOver="hilite(3056)" onMouseOut="lolite()" onClick="logVariable('cascade')" href="../../_variables/cascade.html">$cascade</a>);
<a name="l606"><span class="linenum"> 606</span></a>                  }
<a name="l607"><span class="linenum"> 607</span></a>              }
<a name="l608"><span class="linenum"> 608</span></a>          }
<a name="l609"><span class="linenum"> 609</span></a>  
<a name="l610"><span class="linenum"> 610</span></a>  <span class="comment">        //if marking item visible make sure category is visible MDL-21367</span>
<a name="l611"><span class="linenum"> 611</span></a>          if( !<a class="var it1532" onMouseOver="hilite(1532)" onMouseOut="lolite()" onClick="logVariable('hidden')" href="../../_variables/hidden.html">$hidden</a> ) {
<a name="l612"><span class="linenum"> 612</span></a>              <a class="var it10001" onMouseOver="hilite(10001)" onMouseOut="lolite()" onClick="logVariable('category_array')" href="../../_variables/category_array.html">$category_array</a> = <a class="class" onClick="logClass('grade_category')" href="../../_classes/grade_category.html" onMouseOver="classPopup(event,'grade_category')">grade_category</a>::<a class="function" onClick="logFunction('fetch_all')" href="../../_functions/fetch_all.html" onMouseOver="funcPopup(event,'fetch_all')">fetch_all</a>(array('id'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('categoryid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/categoryid.html">categoryid</a>));
<a name="l613"><span class="linenum"> 613</span></a>              if (<a class="var it10001" onMouseOver="hilite(10001)" onMouseOut="lolite()" onClick="logVariable('category_array')" href="../../_variables/category_array.html">$category_array</a> &amp;&amp; <a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('categoryid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/categoryid.html">categoryid</a>, <a class="var it10001" onMouseOver="hilite(10001)" onMouseOut="lolite()" onClick="logVariable('category_array')" href="../../_variables/category_array.html">$category_array</a>)) {
<a name="l614"><span class="linenum"> 614</span></a>                  <a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../_variables/category.html">$category</a> = <a class="var it10001" onMouseOver="hilite(10001)" onMouseOut="lolite()" onClick="logVariable('category_array')" href="../../_variables/category_array.html">$category_array</a>[<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('categoryid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/categoryid.html">categoryid</a>];
<a name="l615"><span class="linenum"> 615</span></a>  <span class="comment">                //call set_hidden on the category regardless of whether it is hidden as its parent might be hidden</span>
<a name="l616"><span class="linenum"> 616</span></a>  <span class="comment">                //if($category-&gt;is_hidden()) {</span>
<a name="l617"><span class="linenum"> 617</span></a>                      <a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../_variables/category.html">$category</a>-&gt;<a class="function" onClick="logFunction('set_hidden')" href="../../_functions/set_hidden.html" onMouseOver="funcPopup(event,'set_hidden')">set_hidden</a>(<a class="var it1532" onMouseOver="hilite(1532)" onMouseOut="lolite()" onClick="logVariable('hidden')" href="../../_variables/hidden.html">$hidden</a>, false);
<a name="l618"><span class="linenum"> 618</span></a>  <span class="comment">                //}</span>
<a name="l619"><span class="linenum"> 619</span></a>              }
<a name="l620"><span class="linenum"> 620</span></a>          }
<a name="l621"><span class="linenum"> 621</span></a>      }
<a name="l622"><span class="linenum"> 622</span></a>  
<a name="l623"><span class="linenum"> 623</span></a>      <span class="comment">/**</span>
<a name="l624"><span class="linenum"> 624</span></a>  <span class="comment">     * Returns the number of grades that are hidden</span>
<a name="l625"><span class="linenum"> 625</span></a>  <span class="comment">     *</span>
<a name="l626"><span class="linenum"> 626</span></a>  <span class="comment">     * @param string $groupsql SQL to limit the query by group</span>
<a name="l627"><span class="linenum"> 627</span></a>  <span class="comment">     * @param array $params SQL params for $groupsql</span>
<a name="l628"><span class="linenum"> 628</span></a>  <span class="comment">     * @param string $groupwheresql Where conditions for $groupsql</span>
<a name="l629"><span class="linenum"> 629</span></a>  <span class="comment">     * @return int The number of hidden grades</span>
<a name="l630"><span class="linenum"> 630</span></a>  <span class="comment">     */</span>
<a name="l631"><span class="linenum"> 631</span></a>      public function <a class="function" onClick="logFunction('has_hidden_grades')" href="../../_functions/has_hidden_grades.html" onMouseOver="funcPopup(event,'has_hidden_grades')">has_hidden_grades</a>(<a class="var it10002" onMouseOver="hilite(10002)" onMouseOut="lolite()" onClick="logVariable('groupsql')" href="../../_variables/groupsql.html">$groupsql</a>=&quot;&quot;, array <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>=null, <a class="var it10003" onMouseOver="hilite(10003)" onMouseOut="lolite()" onClick="logVariable('groupwheresql')" href="../../_variables/groupwheresql.html">$groupwheresql</a>=&quot;&quot;) {
<a name="l632"><span class="linenum"> 632</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l633"><span class="linenum"> 633</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = (array)<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>;
<a name="l634"><span class="linenum"> 634</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['itemid'] = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l635"><span class="linenum"> 635</span></a>  
<a name="l636"><span class="linenum"> 636</span></a>          return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_field_sql')" href="../../_functions/get_field_sql.html" onMouseOver="funcPopup(event,'get_field_sql')">get_field_sql</a>(&quot;SELECT <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(*) FROM {grade_grades} g LEFT JOIN &quot;
<a name="l637"><span class="linenum"> 637</span></a>                              .&quot;{user} u ON g.userid = u.id <a class="var it10002" onMouseOver="hilite(10002)" onMouseOut="lolite()" onClick="logVariable('groupsql')" href="../../_variables/groupsql.html">$groupsql</a> WHERE itemid = :itemid AND hidden = 1 <a class="var it10003" onMouseOver="hilite(10003)" onMouseOut="lolite()" onClick="logVariable('groupwheresql')" href="../../_variables/groupwheresql.html">$groupwheresql</a>&quot;, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l638"><span class="linenum"> 638</span></a>      }
<a name="l639"><span class="linenum"> 639</span></a>  
<a name="l640"><span class="linenum"> 640</span></a>      <span class="comment">/**</span>
<a name="l641"><span class="linenum"> 641</span></a>  <span class="comment">     * Mark regrading as finished successfully.</span>
<a name="l642"><span class="linenum"> 642</span></a>  <span class="comment">     */</span>
<a name="l643"><span class="linenum"> 643</span></a>      public function <a class="function" onClick="logFunction('regrading_finished')" href="../../_functions/regrading_finished.html" onMouseOver="funcPopup(event,'regrading_finished')">regrading_finished</a>() {
<a name="l644"><span class="linenum"> 644</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l645"><span class="linenum"> 645</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('needsupdate')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/needsupdate.html">needsupdate</a> = 0;
<a name="l646"><span class="linenum"> 646</span></a>  <span class="comment">        //do not use $this-&gt;update() because we do not want this logged in grade_item_history</span>
<a name="l647"><span class="linenum"> 647</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('grade_items', 'needsupdate', 0, array('id' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l648"><span class="linenum"> 648</span></a>      }
<a name="l649"><span class="linenum"> 649</span></a>  
<a name="l650"><span class="linenum"> 650</span></a>      <span class="comment">/**</span>
<a name="l651"><span class="linenum"> 651</span></a>  <span class="comment">     * Performs the necessary calculations on the grades_final referenced by this grade_item.</span>
<a name="l652"><span class="linenum"> 652</span></a>  <span class="comment">     * Also resets the needsupdate flag once successfully performed.</span>
<a name="l653"><span class="linenum"> 653</span></a>  <span class="comment">     *</span>
<a name="l654"><span class="linenum"> 654</span></a>  <span class="comment">     * This function must be used ONLY from lib/gradeslib.php/grade_regrade_final_grades(),</span>
<a name="l655"><span class="linenum"> 655</span></a>  <span class="comment">     * because the regrading must be done in correct order!!</span>
<a name="l656"><span class="linenum"> 656</span></a>  <span class="comment">     *</span>
<a name="l657"><span class="linenum"> 657</span></a>  <span class="comment">     * @param int $userid Supply a user ID to limit the regrading to a single user</span>
<a name="l658"><span class="linenum"> 658</span></a>  <span class="comment">     * @return bool true if ok, error string otherwise</span>
<a name="l659"><span class="linenum"> 659</span></a>  <span class="comment">     */</span>
<a name="l660"><span class="linenum"> 660</span></a>      public function <a class="function" onClick="logFunction('regrade_final_grades')" href="../../_functions/regrade_final_grades.html" onMouseOver="funcPopup(event,'regrade_final_grades')">regrade_final_grades</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>=null) {
<a name="l661"><span class="linenum"> 661</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l662"><span class="linenum"> 662</span></a>  
<a name="l663"><span class="linenum"> 663</span></a>  <span class="comment">        // locked grade items already have correct final grades</span>
<a name="l664"><span class="linenum"> 664</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_locked')" href="../../_functions/is_locked.html" onMouseOver="funcPopup(event,'is_locked')">is_locked</a>()) {
<a name="l665"><span class="linenum"> 665</span></a>              return true;
<a name="l666"><span class="linenum"> 666</span></a>          }
<a name="l667"><span class="linenum"> 667</span></a>  
<a name="l668"><span class="linenum"> 668</span></a>  <span class="comment">        // calculation produces final value using formula from other final values</span>
<a name="l669"><span class="linenum"> 669</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_calculated')" href="../../_functions/is_calculated.html" onMouseOver="funcPopup(event,'is_calculated')">is_calculated</a>()) {
<a name="l670"><span class="linenum"> 670</span></a>              if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('compute')" href="../../_functions/compute.html" onMouseOver="funcPopup(event,'compute')">compute</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>)) {
<a name="l671"><span class="linenum"> 671</span></a>                  return true;
<a name="l672"><span class="linenum"> 672</span></a>              } else {
<a name="l673"><span class="linenum"> 673</span></a>                  return &quot;Could not calculate grades for grade item&quot;; <span class="comment">// TODO: improve and localize</span>
<a name="l674"><span class="linenum"> 674</span></a>              }
<a name="l675"><span class="linenum"> 675</span></a>  
<a name="l676"><span class="linenum"> 676</span></a>  <span class="comment">        // noncalculated outcomes already have final values - raw grades not used</span>
<a name="l677"><span class="linenum"> 677</span></a>          } else if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_outcome_item')" href="../../_functions/is_outcome_item.html" onMouseOver="funcPopup(event,'is_outcome_item')">is_outcome_item</a>()) {
<a name="l678"><span class="linenum"> 678</span></a>              return true;
<a name="l679"><span class="linenum"> 679</span></a>  
<a name="l680"><span class="linenum"> 680</span></a>  <span class="comment">        // aggregate the category grade</span>
<a name="l681"><span class="linenum"> 681</span></a>          } else if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_category_item')" href="../../_functions/is_category_item.html" onMouseOver="funcPopup(event,'is_category_item')">is_category_item</a>() or <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_course_item')" href="../../_functions/is_course_item.html" onMouseOver="funcPopup(event,'is_course_item')">is_course_item</a>()) {
<a name="l682"><span class="linenum"> 682</span></a>  <span class="comment">            // aggregate category grade item</span>
<a name="l683"><span class="linenum"> 683</span></a>              <a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../_variables/category.html">$category</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_item_category')" href="../../_functions/get_item_category.html" onMouseOver="funcPopup(event,'get_item_category')">get_item_category</a>();
<a name="l684"><span class="linenum"> 684</span></a>              <a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../_variables/category.html">$category</a>-&gt;<a onClick="logVariable('grade_item')" class="var it39558" onMouseOver="hilite(39558)" onMouseOut="lolite()" href="../../_variables/grade_item.html">grade_item</a> =&amp; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>;
<a name="l685"><span class="linenum"> 685</span></a>              if (<a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../_variables/category.html">$category</a>-&gt;<a class="function" onClick="logFunction('generate_grades')" href="../../_functions/generate_grades.html" onMouseOver="funcPopup(event,'generate_grades')">generate_grades</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>)) {
<a name="l686"><span class="linenum"> 686</span></a>                  return true;
<a name="l687"><span class="linenum"> 687</span></a>              } else {
<a name="l688"><span class="linenum"> 688</span></a>                  return &quot;Could not aggregate final grades for category:&quot;.<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>; <span class="comment">// TODO: improve and localize</span>
<a name="l689"><span class="linenum"> 689</span></a>              }
<a name="l690"><span class="linenum"> 690</span></a>  
<a name="l691"><span class="linenum"> 691</span></a>          } else if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_manual_item')" href="../../_functions/is_manual_item.html" onMouseOver="funcPopup(event,'is_manual_item')">is_manual_item</a>()) {
<a name="l692"><span class="linenum"> 692</span></a>  <span class="comment">            // manual items track only final grades, no raw grades</span>
<a name="l693"><span class="linenum"> 693</span></a>              return true;
<a name="l694"><span class="linenum"> 694</span></a>  
<a name="l695"><span class="linenum"> 695</span></a>          } else if (!<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_raw_used')" href="../../_functions/is_raw_used.html" onMouseOver="funcPopup(event,'is_raw_used')">is_raw_used</a>()) {
<a name="l696"><span class="linenum"> 696</span></a>  <span class="comment">            // hmm - raw grades are not used- nothing to regrade</span>
<a name="l697"><span class="linenum"> 697</span></a>              return true;
<a name="l698"><span class="linenum"> 698</span></a>          }
<a name="l699"><span class="linenum"> 699</span></a>  
<a name="l700"><span class="linenum"> 700</span></a>  <span class="comment">        // normal grade item - just new final grades</span>
<a name="l701"><span class="linenum"> 701</span></a>          <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = true;
<a name="l702"><span class="linenum"> 702</span></a>          <a class="var it10004" onMouseOver="hilite(10004)" onMouseOut="lolite()" onClick="logVariable('grade_inst')" href="../../_variables/grade_inst.html">$grade_inst</a> = <span class="keyword">new </span><a class="class" onClick="logClass('grade_grade')" href="../../_classes/grade_grade.html" onMouseOver="classPopup(event,'grade_grade')">grade_grade</a>();
<a name="l703"><span class="linenum"> 703</span></a>          <a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',', <a class="var it10004" onMouseOver="hilite(10004)" onMouseOut="lolite()" onClick="logVariable('grade_inst')" href="../../_variables/grade_inst.html">$grade_inst</a>-&gt;<a onClick="logVariable('required_fields')" class="var it40061" onMouseOver="hilite(40061)" onMouseOut="lolite()" href="../../_variables/required_fields.html">required_fields</a>);
<a name="l704"><span class="linenum"> 704</span></a>          if (<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) {
<a name="l705"><span class="linenum"> 705</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>);
<a name="l706"><span class="linenum"> 706</span></a>              <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_select')" href="../../_functions/get_recordset_select.html" onMouseOver="funcPopup(event,'get_recordset_select')">get_recordset_select</a>('grade_grades', &quot;itemid=? AND userid=?&quot;, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, '', <a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>);
<a name="l707"><span class="linenum"> 707</span></a>          } else {
<a name="l708"><span class="linenum"> 708</span></a>              <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset')" href="../../_functions/get_recordset.html" onMouseOver="funcPopup(event,'get_recordset')">get_recordset</a>('grade_grades', array('itemid' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>), '', <a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>);
<a name="l709"><span class="linenum"> 709</span></a>          }
<a name="l710"><span class="linenum"> 710</span></a>          if (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>) {
<a name="l711"><span class="linenum"> 711</span></a>              foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it10005" onMouseOver="hilite(10005)" onMouseOut="lolite()" onClick="logVariable('grade_record')" href="../../_variables/grade_record.html">$grade_record</a>) {
<a name="l712"><span class="linenum"> 712</span></a>                  <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = <span class="keyword">new </span><a class="class" onClick="logClass('grade_grade')" href="../../_classes/grade_grade.html" onMouseOver="classPopup(event,'grade_grade')">grade_grade</a>(<a class="var it10005" onMouseOver="hilite(10005)" onMouseOut="lolite()" onClick="logVariable('grade_record')" href="../../_variables/grade_record.html">$grade_record</a>, false);
<a name="l713"><span class="linenum"> 713</span></a>  
<a name="l714"><span class="linenum"> 714</span></a>                  if (!empty(<a class="var it10005" onMouseOver="hilite(10005)" onMouseOut="lolite()" onClick="logVariable('grade_record')" href="../../_variables/grade_record.html">$grade_record</a>-&gt;<a onClick="logVariable('locked')" class="var it40067" onMouseOver="hilite(40067)" onMouseOut="lolite()" href="../../_variables/locked.html">locked</a>) or !empty(<a class="var it10005" onMouseOver="hilite(10005)" onMouseOut="lolite()" onClick="logVariable('grade_record')" href="../../_variables/grade_record.html">$grade_record</a>-&gt;<a onClick="logVariable('overridden')" class="var it40067" onMouseOver="hilite(40067)" onMouseOut="lolite()" href="../../_variables/overridden.html">overridden</a>)) {
<a name="l715"><span class="linenum"> 715</span></a>  <span class="comment">                    // this grade is locked - final grade must be ok</span>
<a name="l716"><span class="linenum"> 716</span></a>                      continue;
<a name="l717"><span class="linenum"> 717</span></a>                  }
<a name="l718"><span class="linenum"> 718</span></a>  
<a name="l719"><span class="linenum"> 719</span></a>                  <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('adjust_raw_grade')" href="../../_functions/adjust_raw_grade.html" onMouseOver="funcPopup(event,'adjust_raw_grade')">adjust_raw_grade</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawgrade.html">rawgrade</a>, <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawgrademin')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawgrademin.html">rawgrademin</a>, <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawgrademax')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawgrademax.html">rawgrademax</a>);
<a name="l720"><span class="linenum"> 720</span></a>  
<a name="l721"><span class="linenum"> 721</span></a>                  if (<a class="function" onClick="logFunction('grade_floats_different')" href="../../_functions/grade_floats_different.html" onMouseOver="funcPopup(event,'grade_floats_different')">grade_floats_different</a>(<a class="var it10005" onMouseOver="hilite(10005)" onMouseOut="lolite()" onClick="logVariable('grade_record')" href="../../_variables/grade_record.html">$grade_record</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it40067" onMouseOver="hilite(40067)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a>, <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a>)) {
<a name="l722"><span class="linenum"> 722</span></a>                      <a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a> = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>('system');
<a name="l723"><span class="linenum"> 723</span></a>  
<a name="l724"><span class="linenum"> 724</span></a>  <span class="comment">                    // If successful trigger a user_graded event.</span>
<a name="l725"><span class="linenum"> 725</span></a>                      if (<a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a>) {
<a name="l726"><span class="linenum"> 726</span></a>                          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('load_grade_item')" href="../../_functions/load_grade_item.html" onMouseOver="funcPopup(event,'load_grade_item')">load_grade_item</a>();
<a name="l727"><span class="linenum"> 727</span></a>                          \core\event\<a class="class" onClick="logClass('user_graded')" href="../../_classes/user_graded.html" onMouseOver="classPopup(event,'user_graded')">user_graded</a>::<a class="function" onClick="logFunction('create_from_grade')" href="../../_functions/create_from_grade.html" onMouseOver="funcPopup(event,'create_from_grade')">create_from_grade</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l728"><span class="linenum"> 728</span></a>                      } else {
<a name="l729"><span class="linenum"> 729</span></a>                          <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = &quot;Internal error updating final grade&quot;;
<a name="l730"><span class="linenum"> 730</span></a>                      }
<a name="l731"><span class="linenum"> 731</span></a>                  }
<a name="l732"><span class="linenum"> 732</span></a>              }
<a name="l733"><span class="linenum"> 733</span></a>              <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l734"><span class="linenum"> 734</span></a>          }
<a name="l735"><span class="linenum"> 735</span></a>  
<a name="l736"><span class="linenum"> 736</span></a>          return <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l737"><span class="linenum"> 737</span></a>      }
<a name="l738"><span class="linenum"> 738</span></a>  
<a name="l739"><span class="linenum"> 739</span></a>      <span class="comment">/**</span>
<a name="l740"><span class="linenum"> 740</span></a>  <span class="comment">     * Given a float grade value or integer grade scale, applies a number of adjustment based on</span>
<a name="l741"><span class="linenum"> 741</span></a>  <span class="comment">     * grade_item variables and returns the result.</span>
<a name="l742"><span class="linenum"> 742</span></a>  <span class="comment">     *</span>
<a name="l743"><span class="linenum"> 743</span></a>  <span class="comment">     * @param float $rawgrade The raw grade value</span>
<a name="l744"><span class="linenum"> 744</span></a>  <span class="comment">     * @param float $rawmin original rawmin</span>
<a name="l745"><span class="linenum"> 745</span></a>  <span class="comment">     * @param float $rawmax original rawmax</span>
<a name="l746"><span class="linenum"> 746</span></a>  <span class="comment">     * @return mixed</span>
<a name="l747"><span class="linenum"> 747</span></a>  <span class="comment">     */</span>
<a name="l748"><span class="linenum"> 748</span></a>      public function <a class="function" onClick="logFunction('adjust_raw_grade')" href="../../_functions/adjust_raw_grade.html" onMouseOver="funcPopup(event,'adjust_raw_grade')">adjust_raw_grade</a>(<a class="var it4887" onMouseOver="hilite(4887)" onMouseOut="lolite()" onClick="logVariable('rawgrade')" href="../../_variables/rawgrade.html">$rawgrade</a>, <a class="var it10006" onMouseOver="hilite(10006)" onMouseOut="lolite()" onClick="logVariable('rawmin')" href="../../_variables/rawmin.html">$rawmin</a>, <a class="var it10007" onMouseOver="hilite(10007)" onMouseOut="lolite()" onClick="logVariable('rawmax')" href="../../_variables/rawmax.html">$rawmax</a>) {
<a name="l749"><span class="linenum"> 749</span></a>          if (<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it4887" onMouseOver="hilite(4887)" onMouseOut="lolite()" onClick="logVariable('rawgrade')" href="../../_variables/rawgrade.html">$rawgrade</a>)) {
<a name="l750"><span class="linenum"> 750</span></a>              return null;
<a name="l751"><span class="linenum"> 751</span></a>          }
<a name="l752"><span class="linenum"> 752</span></a>  
<a name="l753"><span class="linenum"> 753</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('gradetype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/gradetype.html">gradetype</a> == <a class="constant" onClick="logConstant('GRADE_TYPE_VALUE')" href="../../_constants/GRADE_TYPE_VALUE.html" onMouseOver="constPopup(event,'GRADE_TYPE_VALUE')">GRADE_TYPE_VALUE</a>) { // Dealing with numerical grade
<a name="l754"><span class="linenum"> 754</span></a>  
<a name="l755"><span class="linenum"> 755</span></a>              if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademax')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademax.html">grademax</a> &lt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademin')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademin.html">grademin</a>) {
<a name="l756"><span class="linenum"> 756</span></a>                  return null;
<a name="l757"><span class="linenum"> 757</span></a>              }
<a name="l758"><span class="linenum"> 758</span></a>  
<a name="l759"><span class="linenum"> 759</span></a>              if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademax')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademax.html">grademax</a> == <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademin')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademin.html">grademin</a>) {
<a name="l760"><span class="linenum"> 760</span></a>                  return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademax')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademax.html">grademax</a>; <span class="comment">// no range</span>
<a name="l761"><span class="linenum"> 761</span></a>              }
<a name="l762"><span class="linenum"> 762</span></a>  
<a name="l763"><span class="linenum"> 763</span></a>  <span class="comment">            // Standardise score to the new grade range</span>
<a name="l764"><span class="linenum"> 764</span></a>  <span class="comment">            // NOTE: this is not compatible with current assignment grading</span>
<a name="l765"><span class="linenum"> 765</span></a>              <a class="var it10008" onMouseOver="hilite(10008)" onMouseOut="lolite()" onClick="logVariable('isassignmentmodule')" href="../../_variables/isassignmentmodule.html">$isassignmentmodule</a> = (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemmodule')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemmodule.html">itemmodule</a> == 'assignment') || (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemmodule')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemmodule.html">itemmodule</a> == 'assign');
<a name="l766"><span class="linenum"> 766</span></a>              if (!<a class="var it10008" onMouseOver="hilite(10008)" onMouseOut="lolite()" onClick="logVariable('isassignmentmodule')" href="../../_variables/isassignmentmodule.html">$isassignmentmodule</a> &amp;&amp; (<a class="var it10006" onMouseOver="hilite(10006)" onMouseOut="lolite()" onClick="logVariable('rawmin')" href="../../_variables/rawmin.html">$rawmin</a> != <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademin')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademin.html">grademin</a> or <a class="var it10007" onMouseOver="hilite(10007)" onMouseOut="lolite()" onClick="logVariable('rawmax')" href="../../_variables/rawmax.html">$rawmax</a> != <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademax')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademax.html">grademax</a>)) {
<a name="l767"><span class="linenum"> 767</span></a>                  <a class="var it4887" onMouseOver="hilite(4887)" onMouseOut="lolite()" onClick="logVariable('rawgrade')" href="../../_variables/rawgrade.html">$rawgrade</a> = <a class="class" onClick="logClass('grade_grade')" href="../../_classes/grade_grade.html" onMouseOver="classPopup(event,'grade_grade')">grade_grade</a>::<a class="function" onClick="logFunction('standardise_score')" href="../../_functions/standardise_score.html" onMouseOver="funcPopup(event,'standardise_score')">standardise_score</a>(<a class="var it4887" onMouseOver="hilite(4887)" onMouseOut="lolite()" onClick="logVariable('rawgrade')" href="../../_variables/rawgrade.html">$rawgrade</a>, <a class="var it10006" onMouseOver="hilite(10006)" onMouseOut="lolite()" onClick="logVariable('rawmin')" href="../../_variables/rawmin.html">$rawmin</a>, <a class="var it10007" onMouseOver="hilite(10007)" onMouseOut="lolite()" onClick="logVariable('rawmax')" href="../../_variables/rawmax.html">$rawmax</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademin')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademin.html">grademin</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademax')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademax.html">grademax</a>);
<a name="l768"><span class="linenum"> 768</span></a>              }
<a name="l769"><span class="linenum"> 769</span></a>  
<a name="l770"><span class="linenum"> 770</span></a>  <span class="comment">            // Apply other grade_item factors</span>
<a name="l771"><span class="linenum"> 771</span></a>              <a class="var it4887" onMouseOver="hilite(4887)" onMouseOut="lolite()" onClick="logVariable('rawgrade')" href="../../_variables/rawgrade.html">$rawgrade</a> *= <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('multfactor')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/multfactor.html">multfactor</a>;
<a name="l772"><span class="linenum"> 772</span></a>              <a class="var it4887" onMouseOver="hilite(4887)" onMouseOut="lolite()" onClick="logVariable('rawgrade')" href="../../_variables/rawgrade.html">$rawgrade</a> += <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('plusfactor')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/plusfactor.html">plusfactor</a>;
<a name="l773"><span class="linenum"> 773</span></a>  
<a name="l774"><span class="linenum"> 774</span></a>              return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('bounded_grade')" href="../../_functions/bounded_grade.html" onMouseOver="funcPopup(event,'bounded_grade')">bounded_grade</a>(<a class="var it4887" onMouseOver="hilite(4887)" onMouseOut="lolite()" onClick="logVariable('rawgrade')" href="../../_variables/rawgrade.html">$rawgrade</a>);
<a name="l775"><span class="linenum"> 775</span></a>  
<a name="l776"><span class="linenum"> 776</span></a>          } else if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('gradetype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/gradetype.html">gradetype</a> == <a class="constant" onClick="logConstant('GRADE_TYPE_SCALE')" href="../../_constants/GRADE_TYPE_SCALE.html" onMouseOver="constPopup(event,'GRADE_TYPE_SCALE')">GRADE_TYPE_SCALE</a>) { // Dealing with a scale value
<a name="l777"><span class="linenum"> 777</span></a>              if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('scale')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a>)) {
<a name="l778"><span class="linenum"> 778</span></a>                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('load_scale')" href="../../_functions/load_scale.html" onMouseOver="funcPopup(event,'load_scale')">load_scale</a>();
<a name="l779"><span class="linenum"> 779</span></a>              }
<a name="l780"><span class="linenum"> 780</span></a>  
<a name="l781"><span class="linenum"> 781</span></a>              if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademax')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademax.html">grademax</a> &lt; 0) {
<a name="l782"><span class="linenum"> 782</span></a>                  return null; <span class="comment">// scale not present - no grade</span>
<a name="l783"><span class="linenum"> 783</span></a>              }
<a name="l784"><span class="linenum"> 784</span></a>  
<a name="l785"><span class="linenum"> 785</span></a>              if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademax')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademax.html">grademax</a> == 0) {
<a name="l786"><span class="linenum"> 786</span></a>                  return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademax')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademax.html">grademax</a>; <span class="comment">// only one option</span>
<a name="l787"><span class="linenum"> 787</span></a>              }
<a name="l788"><span class="linenum"> 788</span></a>  
<a name="l789"><span class="linenum"> 789</span></a>  <span class="comment">            // Convert scale if needed</span>
<a name="l790"><span class="linenum"> 790</span></a>  <span class="comment">            // NOTE: this is not compatible with current assignment grading</span>
<a name="l791"><span class="linenum"> 791</span></a>              if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemmodule')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemmodule.html">itemmodule</a> != 'assignment' and (<a class="var it10006" onMouseOver="hilite(10006)" onMouseOut="lolite()" onClick="logVariable('rawmin')" href="../../_variables/rawmin.html">$rawmin</a> != <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademin')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademin.html">grademin</a> or <a class="var it10007" onMouseOver="hilite(10007)" onMouseOut="lolite()" onClick="logVariable('rawmax')" href="../../_variables/rawmax.html">$rawmax</a> != <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademax')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademax.html">grademax</a>)) {
<a name="l792"><span class="linenum"> 792</span></a>                  <a class="var it4887" onMouseOver="hilite(4887)" onMouseOut="lolite()" onClick="logVariable('rawgrade')" href="../../_variables/rawgrade.html">$rawgrade</a> = <a class="class" onClick="logClass('grade_grade')" href="../../_classes/grade_grade.html" onMouseOver="classPopup(event,'grade_grade')">grade_grade</a>::<a class="function" onClick="logFunction('standardise_score')" href="../../_functions/standardise_score.html" onMouseOver="funcPopup(event,'standardise_score')">standardise_score</a>(<a class="var it4887" onMouseOver="hilite(4887)" onMouseOut="lolite()" onClick="logVariable('rawgrade')" href="../../_variables/rawgrade.html">$rawgrade</a>, <a class="var it10006" onMouseOver="hilite(10006)" onMouseOut="lolite()" onClick="logVariable('rawmin')" href="../../_variables/rawmin.html">$rawmin</a>, <a class="var it10007" onMouseOver="hilite(10007)" onMouseOut="lolite()" onClick="logVariable('rawmax')" href="../../_variables/rawmax.html">$rawmax</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademin')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademin.html">grademin</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademax')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademax.html">grademax</a>);
<a name="l793"><span class="linenum"> 793</span></a>              }
<a name="l794"><span class="linenum"> 794</span></a>  
<a name="l795"><span class="linenum"> 795</span></a>              return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('bounded_grade')" href="../../_functions/bounded_grade.html" onMouseOver="funcPopup(event,'bounded_grade')">bounded_grade</a>(<a class="var it4887" onMouseOver="hilite(4887)" onMouseOut="lolite()" onClick="logVariable('rawgrade')" href="../../_variables/rawgrade.html">$rawgrade</a>);
<a name="l796"><span class="linenum"> 796</span></a>  
<a name="l797"><span class="linenum"> 797</span></a>  
<a name="l798"><span class="linenum"> 798</span></a>          } else if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('gradetype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/gradetype.html">gradetype</a> == <a class="constant" onClick="logConstant('GRADE_TYPE_TEXT')" href="../../_constants/GRADE_TYPE_TEXT.html" onMouseOver="constPopup(event,'GRADE_TYPE_TEXT')">GRADE_TYPE_TEXT</a> or <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('gradetype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/gradetype.html">gradetype</a> == <a class="constant" onClick="logConstant('GRADE_TYPE_NONE')" href="../../_constants/GRADE_TYPE_NONE.html" onMouseOver="constPopup(event,'GRADE_TYPE_NONE')">GRADE_TYPE_NONE</a>) { // no value
<a name="l799"><span class="linenum"> 799</span></a>  <span class="comment">            // somebody changed the grading type when grades already existed</span>
<a name="l800"><span class="linenum"> 800</span></a>              return null;
<a name="l801"><span class="linenum"> 801</span></a>  
<a name="l802"><span class="linenum"> 802</span></a>          } else {
<a name="l803"><span class="linenum"> 803</span></a>              <a class="function" onClick="logFunction('debugging')" href="../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>(&quot;Unknown grade type&quot;);
<a name="l804"><span class="linenum"> 804</span></a>              return null;
<a name="l805"><span class="linenum"> 805</span></a>          }
<a name="l806"><span class="linenum"> 806</span></a>      }
<a name="l807"><span class="linenum"> 807</span></a>  
<a name="l808"><span class="linenum"> 808</span></a>      <span class="comment">/**</span>
<a name="l809"><span class="linenum"> 809</span></a>  <span class="comment">     * Sets this grade_item's needsupdate to true. Also marks the course item as needing update.</span>
<a name="l810"><span class="linenum"> 810</span></a>  <span class="comment">     *</span>
<a name="l811"><span class="linenum"> 811</span></a>  <span class="comment">     * @return void</span>
<a name="l812"><span class="linenum"> 812</span></a>  <span class="comment">     */</span>
<a name="l813"><span class="linenum"> 813</span></a>      public function <a class="function" onClick="logFunction('force_regrading')" href="../../_functions/force_regrading.html" onMouseOver="funcPopup(event,'force_regrading')">force_regrading</a>() {
<a name="l814"><span class="linenum"> 814</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l815"><span class="linenum"> 815</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('needsupdate')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/needsupdate.html">needsupdate</a> = 1;
<a name="l816"><span class="linenum"> 816</span></a>  <span class="comment">        //mark this item and course item only - categories and calculated items are always regraded</span>
<a name="l817"><span class="linenum"> 817</span></a>          <a class="var it3051" onMouseOver="hilite(3051)" onMouseOut="lolite()" onClick="logVariable('wheresql')" href="../../_variables/wheresql.html">$wheresql</a> = &quot;(itemtype='course' OR id=?) AND courseid=?&quot;;
<a name="l818"><span class="linenum"> 818</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>   = array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l819"><span class="linenum"> 819</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field_select')" href="../../_functions/set_field_select.html" onMouseOver="funcPopup(event,'set_field_select')">set_field_select</a>('grade_items', 'needsupdate', 1, <a class="var it3051" onMouseOver="hilite(3051)" onMouseOut="lolite()" onClick="logVariable('wheresql')" href="../../_variables/wheresql.html">$wheresql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l820"><span class="linenum"> 820</span></a>      }
<a name="l821"><span class="linenum"> 821</span></a>  
<a name="l822"><span class="linenum"> 822</span></a>      <span class="comment">/**</span>
<a name="l823"><span class="linenum"> 823</span></a>  <span class="comment">     * Instantiates a grade_scale object from the DB if this item's scaleid variable is set</span>
<a name="l824"><span class="linenum"> 824</span></a>  <span class="comment">     *</span>
<a name="l825"><span class="linenum"> 825</span></a>  <span class="comment">     * @return grade_scale Returns a grade_scale object or null if no scale used</span>
<a name="l826"><span class="linenum"> 826</span></a>  <span class="comment">     */</span>
<a name="l827"><span class="linenum"> 827</span></a>      public function <a class="function" onClick="logFunction('load_scale')" href="../../_functions/load_scale.html" onMouseOver="funcPopup(event,'load_scale')">load_scale</a>() {
<a name="l828"><span class="linenum"> 828</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('gradetype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/gradetype.html">gradetype</a> != <a class="constant" onClick="logConstant('GRADE_TYPE_SCALE')" href="../../_constants/GRADE_TYPE_SCALE.html" onMouseOver="constPopup(event,'GRADE_TYPE_SCALE')">GRADE_TYPE_SCALE</a>) {
<a name="l829"><span class="linenum"> 829</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('scaleid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/scaleid.html">scaleid</a> = null;
<a name="l830"><span class="linenum"> 830</span></a>          }
<a name="l831"><span class="linenum"> 831</span></a>  
<a name="l832"><span class="linenum"> 832</span></a>          if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('scaleid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/scaleid.html">scaleid</a>)) {
<a name="l833"><span class="linenum"> 833</span></a>  <span class="comment">            //do not load scale if already present</span>
<a name="l834"><span class="linenum"> 834</span></a>              if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('scale')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a>-&gt;id) or <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('scale')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a>-&gt;id != <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('scaleid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/scaleid.html">scaleid</a>) {
<a name="l835"><span class="linenum"> 835</span></a>                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('scale')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a> = <a class="class" onClick="logClass('grade_scale')" href="../../_classes/grade_scale.html" onMouseOver="classPopup(event,'grade_scale')">grade_scale</a>::<a class="function" onClick="logFunction('fetch')" href="../../_functions/fetch.html" onMouseOver="funcPopup(event,'fetch')">fetch</a>(array('id'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('scaleid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/scaleid.html">scaleid</a>));
<a name="l836"><span class="linenum"> 836</span></a>                  if (!<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('scale')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a>) {
<a name="l837"><span class="linenum"> 837</span></a>                      <a class="function" onClick="logFunction('debugging')" href="../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Incorrect scale id: '.<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('scaleid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/scaleid.html">scaleid</a>);
<a name="l838"><span class="linenum"> 838</span></a>                      <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('scale')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a> = null;
<a name="l839"><span class="linenum"> 839</span></a>                      return null;
<a name="l840"><span class="linenum"> 840</span></a>                  }
<a name="l841"><span class="linenum"> 841</span></a>                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('scale')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a>-&gt;<a class="function" onClick="logFunction('load_items')" href="../../_functions/load_items.html" onMouseOver="funcPopup(event,'load_items')">load_items</a>();
<a name="l842"><span class="linenum"> 842</span></a>              }
<a name="l843"><span class="linenum"> 843</span></a>  
<a name="l844"><span class="linenum"> 844</span></a>  <span class="comment">            // Until scales are uniformly set to min=0 max=count(scaleitems)-1 throughout Moodle, we</span>
<a name="l845"><span class="linenum"> 845</span></a>  <span class="comment">            // stay with the current min=1 max=count(scaleitems)</span>
<a name="l846"><span class="linenum"> 846</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademax')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademax.html">grademax</a> = <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('scale')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a>-&gt;scale_items);
<a name="l847"><span class="linenum"> 847</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademin')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademin.html">grademin</a> = 1;
<a name="l848"><span class="linenum"> 848</span></a>  
<a name="l849"><span class="linenum"> 849</span></a>          } else {
<a name="l850"><span class="linenum"> 850</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('scale')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a> = null;
<a name="l851"><span class="linenum"> 851</span></a>          }
<a name="l852"><span class="linenum"> 852</span></a>  
<a name="l853"><span class="linenum"> 853</span></a>          return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('scale')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/scale.html">scale</a>;
<a name="l854"><span class="linenum"> 854</span></a>      }
<a name="l855"><span class="linenum"> 855</span></a>  
<a name="l856"><span class="linenum"> 856</span></a>      <span class="comment">/**</span>
<a name="l857"><span class="linenum"> 857</span></a>  <span class="comment">     * Instantiates a grade_outcome object from the DB if this item's outcomeid variable is set</span>
<a name="l858"><span class="linenum"> 858</span></a>  <span class="comment">     *</span>
<a name="l859"><span class="linenum"> 859</span></a>  <span class="comment">     * @return grade_outcome This grade item's associated grade_outcome or null</span>
<a name="l860"><span class="linenum"> 860</span></a>  <span class="comment">     */</span>
<a name="l861"><span class="linenum"> 861</span></a>      public function <a class="function" onClick="logFunction('load_outcome')" href="../../_functions/load_outcome.html" onMouseOver="funcPopup(event,'load_outcome')">load_outcome</a>() {
<a name="l862"><span class="linenum"> 862</span></a>          if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('outcomeid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/outcomeid.html">outcomeid</a>)) {
<a name="l863"><span class="linenum"> 863</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('outcome')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/outcome.html">outcome</a> = <a class="class" onClick="logClass('grade_outcome')" href="../../_classes/grade_outcome.html" onMouseOver="classPopup(event,'grade_outcome')">grade_outcome</a>::<a class="function" onClick="logFunction('fetch')" href="../../_functions/fetch.html" onMouseOver="funcPopup(event,'fetch')">fetch</a>(array('id'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('outcomeid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/outcomeid.html">outcomeid</a>));
<a name="l864"><span class="linenum"> 864</span></a>          }
<a name="l865"><span class="linenum"> 865</span></a>          return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('outcome')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/outcome.html">outcome</a>;
<a name="l866"><span class="linenum"> 866</span></a>      }
<a name="l867"><span class="linenum"> 867</span></a>  
<a name="l868"><span class="linenum"> 868</span></a>      <span class="comment">/**</span>
<a name="l869"><span class="linenum"> 869</span></a>  <span class="comment">     * Returns the grade_category object this grade_item belongs to (referenced by categoryid)</span>
<a name="l870"><span class="linenum"> 870</span></a>  <span class="comment">     * or category attached to category item.</span>
<a name="l871"><span class="linenum"> 871</span></a>  <span class="comment">     *</span>
<a name="l872"><span class="linenum"> 872</span></a>  <span class="comment">     * @return grade_category|bool Returns a grade_category object if applicable or false if this is a course item</span>
<a name="l873"><span class="linenum"> 873</span></a>  <span class="comment">     */</span>
<a name="l874"><span class="linenum"> 874</span></a>      public function <a class="function" onClick="logFunction('get_parent_category')" href="../../_functions/get_parent_category.html" onMouseOver="funcPopup(event,'get_parent_category')">get_parent_category</a>() {
<a name="l875"><span class="linenum"> 875</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_category_item')" href="../../_functions/is_category_item.html" onMouseOver="funcPopup(event,'is_category_item')">is_category_item</a>() or <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_course_item')" href="../../_functions/is_course_item.html" onMouseOver="funcPopup(event,'is_course_item')">is_course_item</a>()) {
<a name="l876"><span class="linenum"> 876</span></a>              return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_item_category')" href="../../_functions/get_item_category.html" onMouseOver="funcPopup(event,'get_item_category')">get_item_category</a>();
<a name="l877"><span class="linenum"> 877</span></a>  
<a name="l878"><span class="linenum"> 878</span></a>          } else {
<a name="l879"><span class="linenum"> 879</span></a>              return <a class="class" onClick="logClass('grade_category')" href="../../_classes/grade_category.html" onMouseOver="classPopup(event,'grade_category')">grade_category</a>::<a class="function" onClick="logFunction('fetch')" href="../../_functions/fetch.html" onMouseOver="funcPopup(event,'fetch')">fetch</a>(array('id'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('categoryid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/categoryid.html">categoryid</a>));
<a name="l880"><span class="linenum"> 880</span></a>          }
<a name="l881"><span class="linenum"> 881</span></a>      }
<a name="l882"><span class="linenum"> 882</span></a>  
<a name="l883"><span class="linenum"> 883</span></a>      <span class="comment">/**</span>
<a name="l884"><span class="linenum"> 884</span></a>  <span class="comment">     * Calls upon the get_parent_category method to retrieve the grade_category object</span>
<a name="l885"><span class="linenum"> 885</span></a>  <span class="comment">     * from the DB and assigns it to $this-&gt;parent_category. It also returns the object.</span>
<a name="l886"><span class="linenum"> 886</span></a>  <span class="comment">     *</span>
<a name="l887"><span class="linenum"> 887</span></a>  <span class="comment">     * @return grade_category This grade item's parent grade_category.</span>
<a name="l888"><span class="linenum"> 888</span></a>  <span class="comment">     */</span>
<a name="l889"><span class="linenum"> 889</span></a>      public function <a class="function" onClick="logFunction('load_parent_category')" href="../../_functions/load_parent_category.html" onMouseOver="funcPopup(event,'load_parent_category')">load_parent_category</a>() {
<a name="l890"><span class="linenum"> 890</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('parent_category')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/parent_category.html">parent_category</a>-&gt;id)) {
<a name="l891"><span class="linenum"> 891</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('parent_category')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/parent_category.html">parent_category</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_parent_category')" href="../../_functions/get_parent_category.html" onMouseOver="funcPopup(event,'get_parent_category')">get_parent_category</a>();
<a name="l892"><span class="linenum"> 892</span></a>          }
<a name="l893"><span class="linenum"> 893</span></a>          return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('parent_category')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/parent_category.html">parent_category</a>;
<a name="l894"><span class="linenum"> 894</span></a>      }
<a name="l895"><span class="linenum"> 895</span></a>  
<a name="l896"><span class="linenum"> 896</span></a>      <span class="comment">/**</span>
<a name="l897"><span class="linenum"> 897</span></a>  <span class="comment">     * Returns the grade_category for a grade category grade item</span>
<a name="l898"><span class="linenum"> 898</span></a>  <span class="comment">     *</span>
<a name="l899"><span class="linenum"> 899</span></a>  <span class="comment">     * @return grade_category|bool Returns a grade_category instance if applicable or false otherwise</span>
<a name="l900"><span class="linenum"> 900</span></a>  <span class="comment">     */</span>
<a name="l901"><span class="linenum"> 901</span></a>      public function <a class="function" onClick="logFunction('get_item_category')" href="../../_functions/get_item_category.html" onMouseOver="funcPopup(event,'get_item_category')">get_item_category</a>() {
<a name="l902"><span class="linenum"> 902</span></a>          if (!<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_course_item')" href="../../_functions/is_course_item.html" onMouseOver="funcPopup(event,'is_course_item')">is_course_item</a>() and !<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_category_item')" href="../../_functions/is_category_item.html" onMouseOver="funcPopup(event,'is_category_item')">is_category_item</a>()) {
<a name="l903"><span class="linenum"> 903</span></a>              return false;
<a name="l904"><span class="linenum"> 904</span></a>          }
<a name="l905"><span class="linenum"> 905</span></a>          return <a class="class" onClick="logClass('grade_category')" href="../../_classes/grade_category.html" onMouseOver="classPopup(event,'grade_category')">grade_category</a>::<a class="function" onClick="logFunction('fetch')" href="../../_functions/fetch.html" onMouseOver="funcPopup(event,'fetch')">fetch</a>(array('id'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('iteminstance')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/iteminstance.html">iteminstance</a>));
<a name="l906"><span class="linenum"> 906</span></a>      }
<a name="l907"><span class="linenum"> 907</span></a>  
<a name="l908"><span class="linenum"> 908</span></a>      <span class="comment">/**</span>
<a name="l909"><span class="linenum"> 909</span></a>  <span class="comment">     * Calls upon the get_item_category method to retrieve the grade_category object</span>
<a name="l910"><span class="linenum"> 910</span></a>  <span class="comment">     * from the DB and assigns it to $this-&gt;item_category. It also returns the object.</span>
<a name="l911"><span class="linenum"> 911</span></a>  <span class="comment">     *</span>
<a name="l912"><span class="linenum"> 912</span></a>  <span class="comment">     * @return grade_category</span>
<a name="l913"><span class="linenum"> 913</span></a>  <span class="comment">     */</span>
<a name="l914"><span class="linenum"> 914</span></a>      public function <a class="function" onClick="logFunction('load_item_category')" href="../../_functions/load_item_category.html" onMouseOver="funcPopup(event,'load_item_category')">load_item_category</a>() {
<a name="l915"><span class="linenum"> 915</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('item_category')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/item_category.html">item_category</a>-&gt;id)) {
<a name="l916"><span class="linenum"> 916</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('item_category')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/item_category.html">item_category</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_item_category')" href="../../_functions/get_item_category.html" onMouseOver="funcPopup(event,'get_item_category')">get_item_category</a>();
<a name="l917"><span class="linenum"> 917</span></a>          }
<a name="l918"><span class="linenum"> 918</span></a>          return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('item_category')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/item_category.html">item_category</a>;
<a name="l919"><span class="linenum"> 919</span></a>      }
<a name="l920"><span class="linenum"> 920</span></a>  
<a name="l921"><span class="linenum"> 921</span></a>      <span class="comment">/**</span>
<a name="l922"><span class="linenum"> 922</span></a>  <span class="comment">     * Is the grade item associated with category?</span>
<a name="l923"><span class="linenum"> 923</span></a>  <span class="comment">     *</span>
<a name="l924"><span class="linenum"> 924</span></a>  <span class="comment">     * @return bool</span>
<a name="l925"><span class="linenum"> 925</span></a>  <span class="comment">     */</span>
<a name="l926"><span class="linenum"> 926</span></a>      public function <a class="function" onClick="logFunction('is_category_item')" href="../../_functions/is_category_item.html" onMouseOver="funcPopup(event,'is_category_item')">is_category_item</a>() {
<a name="l927"><span class="linenum"> 927</span></a>          return (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemtype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemtype.html">itemtype</a> == 'category');
<a name="l928"><span class="linenum"> 928</span></a>      }
<a name="l929"><span class="linenum"> 929</span></a>  
<a name="l930"><span class="linenum"> 930</span></a>      <span class="comment">/**</span>
<a name="l931"><span class="linenum"> 931</span></a>  <span class="comment">     * Is the grade item associated with course?</span>
<a name="l932"><span class="linenum"> 932</span></a>  <span class="comment">     *</span>
<a name="l933"><span class="linenum"> 933</span></a>  <span class="comment">     * @return bool</span>
<a name="l934"><span class="linenum"> 934</span></a>  <span class="comment">     */</span>
<a name="l935"><span class="linenum"> 935</span></a>      public function <a class="function" onClick="logFunction('is_course_item')" href="../../_functions/is_course_item.html" onMouseOver="funcPopup(event,'is_course_item')">is_course_item</a>() {
<a name="l936"><span class="linenum"> 936</span></a>          return (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemtype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemtype.html">itemtype</a> == 'course');
<a name="l937"><span class="linenum"> 937</span></a>      }
<a name="l938"><span class="linenum"> 938</span></a>  
<a name="l939"><span class="linenum"> 939</span></a>      <span class="comment">/**</span>
<a name="l940"><span class="linenum"> 940</span></a>  <span class="comment">     * Is this a manually graded item?</span>
<a name="l941"><span class="linenum"> 941</span></a>  <span class="comment">     *</span>
<a name="l942"><span class="linenum"> 942</span></a>  <span class="comment">     * @return bool</span>
<a name="l943"><span class="linenum"> 943</span></a>  <span class="comment">     */</span>
<a name="l944"><span class="linenum"> 944</span></a>      public function <a class="function" onClick="logFunction('is_manual_item')" href="../../_functions/is_manual_item.html" onMouseOver="funcPopup(event,'is_manual_item')">is_manual_item</a>() {
<a name="l945"><span class="linenum"> 945</span></a>          return (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemtype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemtype.html">itemtype</a> == 'manual');
<a name="l946"><span class="linenum"> 946</span></a>      }
<a name="l947"><span class="linenum"> 947</span></a>  
<a name="l948"><span class="linenum"> 948</span></a>      <span class="comment">/**</span>
<a name="l949"><span class="linenum"> 949</span></a>  <span class="comment">     * Is this an outcome item?</span>
<a name="l950"><span class="linenum"> 950</span></a>  <span class="comment">     *</span>
<a name="l951"><span class="linenum"> 951</span></a>  <span class="comment">     * @return bool</span>
<a name="l952"><span class="linenum"> 952</span></a>  <span class="comment">     */</span>
<a name="l953"><span class="linenum"> 953</span></a>      public function <a class="function" onClick="logFunction('is_outcome_item')" href="../../_functions/is_outcome_item.html" onMouseOver="funcPopup(event,'is_outcome_item')">is_outcome_item</a>() {
<a name="l954"><span class="linenum"> 954</span></a>          return !empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('outcomeid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/outcomeid.html">outcomeid</a>);
<a name="l955"><span class="linenum"> 955</span></a>      }
<a name="l956"><span class="linenum"> 956</span></a>  
<a name="l957"><span class="linenum"> 957</span></a>      <span class="comment">/**</span>
<a name="l958"><span class="linenum"> 958</span></a>  <span class="comment">     * Is the grade item external - associated with module, plugin or something else?</span>
<a name="l959"><span class="linenum"> 959</span></a>  <span class="comment">     *</span>
<a name="l960"><span class="linenum"> 960</span></a>  <span class="comment">     * @return bool</span>
<a name="l961"><span class="linenum"> 961</span></a>  <span class="comment">     */</span>
<a name="l962"><span class="linenum"> 962</span></a>      public function <a class="function" onClick="logFunction('is_external_item')" href="../../_functions/is_external_item.html" onMouseOver="funcPopup(event,'is_external_item')">is_external_item</a>() {
<a name="l963"><span class="linenum"> 963</span></a>          return (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemtype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemtype.html">itemtype</a> == 'mod');
<a name="l964"><span class="linenum"> 964</span></a>      }
<a name="l965"><span class="linenum"> 965</span></a>  
<a name="l966"><span class="linenum"> 966</span></a>      <span class="comment">/**</span>
<a name="l967"><span class="linenum"> 967</span></a>  <span class="comment">     * Is the grade item overridable</span>
<a name="l968"><span class="linenum"> 968</span></a>  <span class="comment">     *</span>
<a name="l969"><span class="linenum"> 969</span></a>  <span class="comment">     * @return bool</span>
<a name="l970"><span class="linenum"> 970</span></a>  <span class="comment">     */</span>
<a name="l971"><span class="linenum"> 971</span></a>      public function <a class="function" onClick="logFunction('is_overridable_item')" href="../../_functions/is_overridable_item.html" onMouseOver="funcPopup(event,'is_overridable_item')">is_overridable_item</a>() {
<a name="l972"><span class="linenum"> 972</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_course_item')" href="../../_functions/is_course_item.html" onMouseOver="funcPopup(event,'is_course_item')">is_course_item</a>() or <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_category_item')" href="../../_functions/is_category_item.html" onMouseOver="funcPopup(event,'is_category_item')">is_category_item</a>()) {
<a name="l973"><span class="linenum"> 973</span></a>              <a class="var it10009" onMouseOver="hilite(10009)" onMouseOut="lolite()" onClick="logVariable('overridable')" href="../../_variables/overridable.html">$overridable</a> = (bool) <a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('moodle', 'grade_overridecat');
<a name="l974"><span class="linenum"> 974</span></a>          } else {
<a name="l975"><span class="linenum"> 975</span></a>              <a class="var it10009" onMouseOver="hilite(10009)" onMouseOut="lolite()" onClick="logVariable('overridable')" href="../../_variables/overridable.html">$overridable</a> = false;
<a name="l976"><span class="linenum"> 976</span></a>          }
<a name="l977"><span class="linenum"> 977</span></a>  
<a name="l978"><span class="linenum"> 978</span></a>          return !<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_outcome_item')" href="../../_functions/is_outcome_item.html" onMouseOver="funcPopup(event,'is_outcome_item')">is_outcome_item</a>() and (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_external_item')" href="../../_functions/is_external_item.html" onMouseOver="funcPopup(event,'is_external_item')">is_external_item</a>() or <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_calculated')" href="../../_functions/is_calculated.html" onMouseOver="funcPopup(event,'is_calculated')">is_calculated</a>() or <a class="var it10009" onMouseOver="hilite(10009)" onMouseOut="lolite()" onClick="logVariable('overridable')" href="../../_variables/overridable.html">$overridable</a>);
<a name="l979"><span class="linenum"> 979</span></a>      }
<a name="l980"><span class="linenum"> 980</span></a>  
<a name="l981"><span class="linenum"> 981</span></a>      <span class="comment">/**</span>
<a name="l982"><span class="linenum"> 982</span></a>  <span class="comment">     * Is the grade item feedback overridable</span>
<a name="l983"><span class="linenum"> 983</span></a>  <span class="comment">     *</span>
<a name="l984"><span class="linenum"> 984</span></a>  <span class="comment">     * @return bool</span>
<a name="l985"><span class="linenum"> 985</span></a>  <span class="comment">     */</span>
<a name="l986"><span class="linenum"> 986</span></a>      public function <a class="function" onClick="logFunction('is_overridable_item_feedback')" href="../../_functions/is_overridable_item_feedback.html" onMouseOver="funcPopup(event,'is_overridable_item_feedback')">is_overridable_item_feedback</a>() {
<a name="l987"><span class="linenum"> 987</span></a>          return !<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_outcome_item')" href="../../_functions/is_outcome_item.html" onMouseOver="funcPopup(event,'is_outcome_item')">is_outcome_item</a>() and <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_external_item')" href="../../_functions/is_external_item.html" onMouseOver="funcPopup(event,'is_external_item')">is_external_item</a>();
<a name="l988"><span class="linenum"> 988</span></a>      }
<a name="l989"><span class="linenum"> 989</span></a>  
<a name="l990"><span class="linenum"> 990</span></a>      <span class="comment">/**</span>
<a name="l991"><span class="linenum"> 991</span></a>  <span class="comment">     * Returns true if grade items uses raw grades</span>
<a name="l992"><span class="linenum"> 992</span></a>  <span class="comment">     *</span>
<a name="l993"><span class="linenum"> 993</span></a>  <span class="comment">     * @return bool</span>
<a name="l994"><span class="linenum"> 994</span></a>  <span class="comment">     */</span>
<a name="l995"><span class="linenum"> 995</span></a>      public function <a class="function" onClick="logFunction('is_raw_used')" href="../../_functions/is_raw_used.html" onMouseOver="funcPopup(event,'is_raw_used')">is_raw_used</a>() {
<a name="l996"><span class="linenum"> 996</span></a>          return (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_external_item')" href="../../_functions/is_external_item.html" onMouseOver="funcPopup(event,'is_external_item')">is_external_item</a>() and !<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_calculated')" href="../../_functions/is_calculated.html" onMouseOver="funcPopup(event,'is_calculated')">is_calculated</a>() and !<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_outcome_item')" href="../../_functions/is_outcome_item.html" onMouseOver="funcPopup(event,'is_outcome_item')">is_outcome_item</a>());
<a name="l997"><span class="linenum"> 997</span></a>      }
<a name="l998"><span class="linenum"> 998</span></a>  
<a name="l999"><span class="linenum"> 999</span></a>      <span class="comment">/**</span>
<a name="l1000"><span class="linenum">1000</span></a>  <span class="comment">     * Returns the grade item associated with the course</span>
<a name="l1001"><span class="linenum">1001</span></a>  <span class="comment">     *</span>
<a name="l1002"><span class="linenum">1002</span></a>  <span class="comment">     * @param int $courseid</span>
<a name="l1003"><span class="linenum">1003</span></a>  <span class="comment">     * @return grade_item Course level grade item object</span>
<a name="l1004"><span class="linenum">1004</span></a>  <span class="comment">     */</span>
<a name="l1005"><span class="linenum">1005</span></a>      public static function <a class="function" onClick="logFunction('fetch_course_item')" href="../../_functions/fetch_course_item.html" onMouseOver="funcPopup(event,'fetch_course_item')">fetch_course_item</a>(<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>) {
<a name="l1006"><span class="linenum">1006</span></a>          if (<a class="var it10010" onMouseOver="hilite(10010)" onMouseOut="lolite()" onClick="logVariable('course_item')" href="../../_variables/course_item.html">$course_item</a> = <a class="class" onClick="logClass('grade_item')" href="../../_classes/grade_item.html" onMouseOver="classPopup(event,'grade_item')">grade_item</a>::<a class="function" onClick="logFunction('fetch')" href="../../_functions/fetch.html" onMouseOver="funcPopup(event,'fetch')">fetch</a>(array('courseid'=&gt;<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, 'itemtype'=&gt;'course'))) {
<a name="l1007"><span class="linenum">1007</span></a>              return <a class="var it10010" onMouseOver="hilite(10010)" onMouseOut="lolite()" onClick="logVariable('course_item')" href="../../_variables/course_item.html">$course_item</a>;
<a name="l1008"><span class="linenum">1008</span></a>          }
<a name="l1009"><span class="linenum">1009</span></a>  
<a name="l1010"><span class="linenum">1010</span></a>  <span class="comment">        // first get category - it creates the associated grade item</span>
<a name="l1011"><span class="linenum">1011</span></a>          <a class="var it9997" onMouseOver="hilite(9997)" onMouseOut="lolite()" onClick="logVariable('course_category')" href="../../_variables/course_category.html">$course_category</a> = <a class="class" onClick="logClass('grade_category')" href="../../_classes/grade_category.html" onMouseOver="classPopup(event,'grade_category')">grade_category</a>::<a class="function" onClick="logFunction('fetch_course_category')" href="../../_functions/fetch_course_category.html" onMouseOver="funcPopup(event,'fetch_course_category')">fetch_course_category</a>(<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l1012"><span class="linenum">1012</span></a>          return <a class="var it9997" onMouseOver="hilite(9997)" onMouseOut="lolite()" onClick="logVariable('course_category')" href="../../_variables/course_category.html">$course_category</a>-&gt;<a class="function" onClick="logFunction('get_grade_item')" href="../../_functions/get_grade_item.html" onMouseOver="funcPopup(event,'get_grade_item')">get_grade_item</a>();
<a name="l1013"><span class="linenum">1013</span></a>      }
<a name="l1014"><span class="linenum">1014</span></a>  
<a name="l1015"><span class="linenum">1015</span></a>      <span class="comment">/**</span>
<a name="l1016"><span class="linenum">1016</span></a>  <span class="comment">     * Is grading object editable?</span>
<a name="l1017"><span class="linenum">1017</span></a>  <span class="comment">     *</span>
<a name="l1018"><span class="linenum">1018</span></a>  <span class="comment">     * @return bool</span>
<a name="l1019"><span class="linenum">1019</span></a>  <span class="comment">     */</span>
<a name="l1020"><span class="linenum">1020</span></a>      public function <a class="function" onClick="logFunction('is_editable')" href="../../_functions/is_editable.html" onMouseOver="funcPopup(event,'is_editable')">is_editable</a>() {
<a name="l1021"><span class="linenum">1021</span></a>          return true;
<a name="l1022"><span class="linenum">1022</span></a>      }
<a name="l1023"><span class="linenum">1023</span></a>  
<a name="l1024"><span class="linenum">1024</span></a>      <span class="comment">/**</span>
<a name="l1025"><span class="linenum">1025</span></a>  <span class="comment">     * Checks if grade calculated. Returns this object's calculation.</span>
<a name="l1026"><span class="linenum">1026</span></a>  <span class="comment">     *</span>
<a name="l1027"><span class="linenum">1027</span></a>  <span class="comment">     * @return bool true if grade item calculated.</span>
<a name="l1028"><span class="linenum">1028</span></a>  <span class="comment">     */</span>
<a name="l1029"><span class="linenum">1029</span></a>      public function <a class="function" onClick="logFunction('is_calculated')" href="../../_functions/is_calculated.html" onMouseOver="funcPopup(event,'is_calculated')">is_calculated</a>() {
<a name="l1030"><span class="linenum">1030</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('calculation')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/calculation.html">calculation</a>)) {
<a name="l1031"><span class="linenum">1031</span></a>              return false;
<a name="l1032"><span class="linenum">1032</span></a>          }
<a name="l1033"><span class="linenum">1033</span></a>  
<a name="l1034"><span class="linenum">1034</span></a>          <span class="comment">/*</span>
<a name="l1035"><span class="linenum">1035</span></a>  <span class="comment">         * The main reason why we use the ##gixxx## instead of [[idnumber]] is speed of depends_on(),</span>
<a name="l1036"><span class="linenum">1036</span></a>  <span class="comment">         * we would have to fetch all course grade items to find out the ids.</span>
<a name="l1037"><span class="linenum">1037</span></a>  <span class="comment">         * Also if user changes the idnumber the formula does not need to be updated.</span>
<a name="l1038"><span class="linenum">1038</span></a>  <span class="comment">         */</span>
<a name="l1039"><span class="linenum">1039</span></a>  
<a name="l1040"><span class="linenum">1040</span></a>  <span class="comment">        // first detect if we need to change calculation formula from [[idnumber]] to ##giXXX## (after backup, etc.)</span>
<a name="l1041"><span class="linenum">1041</span></a>          if (!<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('calculation_normalized')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/calculation_normalized.html">calculation_normalized</a> and <a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('calculation')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/calculation.html">calculation</a>, '[[') !== false) {
<a name="l1042"><span class="linenum">1042</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_calculation')" href="../../_functions/set_calculation.html" onMouseOver="funcPopup(event,'set_calculation')">set_calculation</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('calculation')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/calculation.html">calculation</a>);
<a name="l1043"><span class="linenum">1043</span></a>          }
<a name="l1044"><span class="linenum">1044</span></a>  
<a name="l1045"><span class="linenum">1045</span></a>          return !empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('calculation')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/calculation.html">calculation</a>);
<a name="l1046"><span class="linenum">1046</span></a>      }
<a name="l1047"><span class="linenum">1047</span></a>  
<a name="l1048"><span class="linenum">1048</span></a>      <span class="comment">/**</span>
<a name="l1049"><span class="linenum">1049</span></a>  <span class="comment">     * Returns calculation string if grade calculated.</span>
<a name="l1050"><span class="linenum">1050</span></a>  <span class="comment">     *</span>
<a name="l1051"><span class="linenum">1051</span></a>  <span class="comment">     * @return string Returns the grade item's calculation if calculation is used, null if not</span>
<a name="l1052"><span class="linenum">1052</span></a>  <span class="comment">     */</span>
<a name="l1053"><span class="linenum">1053</span></a>      public function <a class="function" onClick="logFunction('get_calculation')" href="../../_functions/get_calculation.html" onMouseOver="funcPopup(event,'get_calculation')">get_calculation</a>() {
<a name="l1054"><span class="linenum">1054</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_calculated')" href="../../_functions/is_calculated.html" onMouseOver="funcPopup(event,'is_calculated')">is_calculated</a>()) {
<a name="l1055"><span class="linenum">1055</span></a>              return <a class="class" onClick="logClass('grade_item')" href="../../_classes/grade_item.html" onMouseOver="classPopup(event,'grade_item')">grade_item</a>::<a class="function" onClick="logFunction('denormalize_formula')" href="../../_functions/denormalize_formula.html" onMouseOver="funcPopup(event,'denormalize_formula')">denormalize_formula</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('calculation')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/calculation.html">calculation</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l1056"><span class="linenum">1056</span></a>  
<a name="l1057"><span class="linenum">1057</span></a>          } else {
<a name="l1058"><span class="linenum">1058</span></a>              return NULL;
<a name="l1059"><span class="linenum">1059</span></a>          }
<a name="l1060"><span class="linenum">1060</span></a>      }
<a name="l1061"><span class="linenum">1061</span></a>  
<a name="l1062"><span class="linenum">1062</span></a>      <span class="comment">/**</span>
<a name="l1063"><span class="linenum">1063</span></a>  <span class="comment">     * Sets this item's calculation (creates it) if not yet set, or</span>
<a name="l1064"><span class="linenum">1064</span></a>  <span class="comment">     * updates it if already set (in the DB). If no calculation is given,</span>
<a name="l1065"><span class="linenum">1065</span></a>  <span class="comment">     * the calculation is removed.</span>
<a name="l1066"><span class="linenum">1066</span></a>  <span class="comment">     *</span>
<a name="l1067"><span class="linenum">1067</span></a>  <span class="comment">     * @param string $formula string representation of formula used for calculation</span>
<a name="l1068"><span class="linenum">1068</span></a>  <span class="comment">     * @return bool success</span>
<a name="l1069"><span class="linenum">1069</span></a>  <span class="comment">     */</span>
<a name="l1070"><span class="linenum">1070</span></a>      public function <a class="function" onClick="logFunction('set_calculation')" href="../../_functions/set_calculation.html" onMouseOver="funcPopup(event,'set_calculation')">set_calculation</a>(<a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a>) {
<a name="l1071"><span class="linenum">1071</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('calculation')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/calculation.html">calculation</a> = <a class="class" onClick="logClass('grade_item')" href="../../_classes/grade_item.html" onMouseOver="classPopup(event,'grade_item')">grade_item</a>::<a class="function" onClick="logFunction('normalize_formula')" href="../../_functions/normalize_formula.html" onMouseOver="funcPopup(event,'normalize_formula')">normalize_formula</a>(<a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l1072"><span class="linenum">1072</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('calculation_normalized')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/calculation_normalized.html">calculation_normalized</a> = true;
<a name="l1073"><span class="linenum">1073</span></a>          return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l1074"><span class="linenum">1074</span></a>      }
<a name="l1075"><span class="linenum">1075</span></a>  
<a name="l1076"><span class="linenum">1076</span></a>      <span class="comment">/**</span>
<a name="l1077"><span class="linenum">1077</span></a>  <span class="comment">     * Denormalizes the calculation formula to [idnumber] form</span>
<a name="l1078"><span class="linenum">1078</span></a>  <span class="comment">     *</span>
<a name="l1079"><span class="linenum">1079</span></a>  <span class="comment">     * @param string $formula A string representation of the formula</span>
<a name="l1080"><span class="linenum">1080</span></a>  <span class="comment">     * @param int $courseid The course ID</span>
<a name="l1081"><span class="linenum">1081</span></a>  <span class="comment">     * @return string The denormalized formula as a string</span>
<a name="l1082"><span class="linenum">1082</span></a>  <span class="comment">     */</span>
<a name="l1083"><span class="linenum">1083</span></a>      public static function <a class="function" onClick="logFunction('denormalize_formula')" href="../../_functions/denormalize_formula.html" onMouseOver="funcPopup(event,'denormalize_formula')">denormalize_formula</a>(<a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a>, <a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>) {
<a name="l1084"><span class="linenum">1084</span></a>          if (empty(<a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a>)) {
<a name="l1085"><span class="linenum">1085</span></a>              return '';
<a name="l1086"><span class="linenum">1086</span></a>          }
<a name="l1087"><span class="linenum">1087</span></a>  
<a name="l1088"><span class="linenum">1088</span></a>  <span class="comment">        // denormalize formula - convert ##giXX## to [[idnumber]]</span>
<a name="l1089"><span class="linenum">1089</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match_all')" href="../../_functions/preg_match_all.html" onMouseOver="phpfuncPopup(event,'preg_match_all')">preg_match_all</a>('/##gi(\d+)##/', <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a>, <a class="var it79" onMouseOver="hilite(79)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l1090"><span class="linenum">1090</span></a>              foreach (<a class="var it79" onMouseOver="hilite(79)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1] as <a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>) {
<a name="l1091"><span class="linenum">1091</span></a>                  if (<a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../../_variables/grade_item.html">$grade_item</a> = <a class="class" onClick="logClass('grade_item')" href="../../_classes/grade_item.html" onMouseOver="classPopup(event,'grade_item')">grade_item</a>::<a class="function" onClick="logFunction('fetch')" href="../../_functions/fetch.html" onMouseOver="funcPopup(event,'fetch')">fetch</a>(array('id'=&gt;<a class="var it102" onMouseOver="hilite(102)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>, 'courseid'=&gt;<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>))) {
<a name="l1092"><span class="linenum">1092</span></a>                      if (!empty(<a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../../_variables/grade_item.html">$grade_item</a>-&gt;<a onClick="logVariable('idnumber')" class="var it39507" onMouseOver="hilite(39507)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>)) {
<a name="l1093"><span class="linenum">1093</span></a>                          <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('##gi'.<a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../../_variables/grade_item.html">$grade_item</a>-&gt;<a onClick="logVariable('id')" class="var it39507" onMouseOver="hilite(39507)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>.'##', '[['.<a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../../_variables/grade_item.html">$grade_item</a>-&gt;<a onClick="logVariable('idnumber')" class="var it39507" onMouseOver="hilite(39507)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>.']]', <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a>);
<a name="l1094"><span class="linenum">1094</span></a>                      }
<a name="l1095"><span class="linenum">1095</span></a>                  }
<a name="l1096"><span class="linenum">1096</span></a>              }
<a name="l1097"><span class="linenum">1097</span></a>          }
<a name="l1098"><span class="linenum">1098</span></a>  
<a name="l1099"><span class="linenum">1099</span></a>          return <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a>;
<a name="l1100"><span class="linenum">1100</span></a>  
<a name="l1101"><span class="linenum">1101</span></a>      }
<a name="l1102"><span class="linenum">1102</span></a>  
<a name="l1103"><span class="linenum">1103</span></a>      <span class="comment">/**</span>
<a name="l1104"><span class="linenum">1104</span></a>  <span class="comment">     * Normalizes the calculation formula to [#giXX#] form</span>
<a name="l1105"><span class="linenum">1105</span></a>  <span class="comment">     *</span>
<a name="l1106"><span class="linenum">1106</span></a>  <span class="comment">     * @param string $formula The formula</span>
<a name="l1107"><span class="linenum">1107</span></a>  <span class="comment">     * @param int $courseid The course ID</span>
<a name="l1108"><span class="linenum">1108</span></a>  <span class="comment">     * @return string The normalized formula as a string</span>
<a name="l1109"><span class="linenum">1109</span></a>  <span class="comment">     */</span>
<a name="l1110"><span class="linenum">1110</span></a>      public static function <a class="function" onClick="logFunction('normalize_formula')" href="../../_functions/normalize_formula.html" onMouseOver="funcPopup(event,'normalize_formula')">normalize_formula</a>(<a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a>, <a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>) {
<a name="l1111"><span class="linenum">1111</span></a>          <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a>);
<a name="l1112"><span class="linenum">1112</span></a>  
<a name="l1113"><span class="linenum">1113</span></a>          if (empty(<a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a>)) {
<a name="l1114"><span class="linenum">1114</span></a>              return NULL;
<a name="l1115"><span class="linenum">1115</span></a>  
<a name="l1116"><span class="linenum">1116</span></a>          }
<a name="l1117"><span class="linenum">1117</span></a>  
<a name="l1118"><span class="linenum">1118</span></a>  <span class="comment">        // normalize formula - we want grade item ids ##giXXX## instead of [[idnumber]]</span>
<a name="l1119"><span class="linenum">1119</span></a>          if (<a class="var it6045" onMouseOver="hilite(6045)" onMouseOut="lolite()" onClick="logVariable('grade_items')" href="../../_variables/grade_items.html">$grade_items</a> = <a class="class" onClick="logClass('grade_item')" href="../../_classes/grade_item.html" onMouseOver="classPopup(event,'grade_item')">grade_item</a>::<a class="function" onClick="logFunction('fetch_all')" href="../../_functions/fetch_all.html" onMouseOver="funcPopup(event,'fetch_all')">fetch_all</a>(array('courseid'=&gt;<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>))) {
<a name="l1120"><span class="linenum">1120</span></a>              foreach (<a class="var it6045" onMouseOver="hilite(6045)" onMouseOut="lolite()" onClick="logVariable('grade_items')" href="../../_variables/grade_items.html">$grade_items</a> as <a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../../_variables/grade_item.html">$grade_item</a>) {
<a name="l1121"><span class="linenum">1121</span></a>                  <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('[['.<a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../../_variables/grade_item.html">$grade_item</a>-&gt;<a onClick="logVariable('idnumber')" class="var it39507" onMouseOver="hilite(39507)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>.']]', '##gi'.<a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../../_variables/grade_item.html">$grade_item</a>-&gt;<a onClick="logVariable('id')" class="var it39507" onMouseOver="hilite(39507)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>.'##', <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a>);
<a name="l1122"><span class="linenum">1122</span></a>              }
<a name="l1123"><span class="linenum">1123</span></a>          }
<a name="l1124"><span class="linenum">1124</span></a>  
<a name="l1125"><span class="linenum">1125</span></a>          return <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a>;
<a name="l1126"><span class="linenum">1126</span></a>      }
<a name="l1127"><span class="linenum">1127</span></a>  
<a name="l1128"><span class="linenum">1128</span></a>      <span class="comment">/**</span>
<a name="l1129"><span class="linenum">1129</span></a>  <span class="comment">     * Returns the final values for this grade item (as imported by module or other source).</span>
<a name="l1130"><span class="linenum">1130</span></a>  <span class="comment">     *</span>
<a name="l1131"><span class="linenum">1131</span></a>  <span class="comment">     * @param int $userid Optional: to retrieve a single user's final grade</span>
<a name="l1132"><span class="linenum">1132</span></a>  <span class="comment">     * @return array|grade_grade An array of all grade_grade instances for this grade_item, or a single grade_grade instance.</span>
<a name="l1133"><span class="linenum">1133</span></a>  <span class="comment">     */</span>
<a name="l1134"><span class="linenum">1134</span></a>      public function <a class="function" onClick="logFunction('get_final')" href="../../_functions/get_final.html" onMouseOver="funcPopup(event,'get_final')">get_final</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>=NULL) {
<a name="l1135"><span class="linenum">1135</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1136"><span class="linenum">1136</span></a>          if (<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) {
<a name="l1137"><span class="linenum">1137</span></a>              if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('grade_grades', array('itemid' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid' =&gt; <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>))) {
<a name="l1138"><span class="linenum">1138</span></a>                  return <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../../_variables/user.html">$user</a>;
<a name="l1139"><span class="linenum">1139</span></a>              }
<a name="l1140"><span class="linenum">1140</span></a>  
<a name="l1141"><span class="linenum">1141</span></a>          } else {
<a name="l1142"><span class="linenum">1142</span></a>              if (<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('grade_grades', array('itemid' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>))) {
<a name="l1143"><span class="linenum">1143</span></a>  <span class="comment">                //TODO: speed up with better SQL (MDL-31380)</span>
<a name="l1144"><span class="linenum">1144</span></a>                  <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = array();
<a name="l1145"><span class="linenum">1145</span></a>                  foreach (<a class="var it663" onMouseOver="hilite(663)" onMouseOut="lolite()" onClick="logVariable('grades')" href="../../_variables/grades.html">$grades</a> as <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>) {
<a name="l1146"><span class="linenum">1146</span></a>                      <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>[<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('userid')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>] = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>;
<a name="l1147"><span class="linenum">1147</span></a>                  }
<a name="l1148"><span class="linenum">1148</span></a>                  return <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l1149"><span class="linenum">1149</span></a>              } else {
<a name="l1150"><span class="linenum">1150</span></a>                  return array();
<a name="l1151"><span class="linenum">1151</span></a>              }
<a name="l1152"><span class="linenum">1152</span></a>          }
<a name="l1153"><span class="linenum">1153</span></a>      }
<a name="l1154"><span class="linenum">1154</span></a>  
<a name="l1155"><span class="linenum">1155</span></a>      <span class="comment">/**</span>
<a name="l1156"><span class="linenum">1156</span></a>  <span class="comment">     * Get (or create if not exist yet) grade for this user</span>
<a name="l1157"><span class="linenum">1157</span></a>  <span class="comment">     *</span>
<a name="l1158"><span class="linenum">1158</span></a>  <span class="comment">     * @param int $userid The user ID</span>
<a name="l1159"><span class="linenum">1159</span></a>  <span class="comment">     * @param bool $create If true and the user has no grade for this grade item a new grade_grade instance will be inserted</span>
<a name="l1160"><span class="linenum">1160</span></a>  <span class="comment">     * @return grade_grade The grade_grade instance for the user for this grade item</span>
<a name="l1161"><span class="linenum">1161</span></a>  <span class="comment">     */</span>
<a name="l1162"><span class="linenum">1162</span></a>      public function <a class="function" onClick="logFunction('get_grade')" href="../../_functions/get_grade.html" onMouseOver="funcPopup(event,'get_grade')">get_grade</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it10011" onMouseOver="hilite(10011)" onMouseOut="lolite()" onClick="logVariable('create')" href="../../_variables/create.html">$create</a>=true) {
<a name="l1163"><span class="linenum">1163</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l1164"><span class="linenum">1164</span></a>              <a class="function" onClick="logFunction('debugging')" href="../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Can not use before insert');
<a name="l1165"><span class="linenum">1165</span></a>              return false;
<a name="l1166"><span class="linenum">1166</span></a>          }
<a name="l1167"><span class="linenum">1167</span></a>  
<a name="l1168"><span class="linenum">1168</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = <span class="keyword">new </span><a class="class" onClick="logClass('grade_grade')" href="../../_classes/grade_grade.html" onMouseOver="classPopup(event,'grade_grade')">grade_grade</a>(array('userid'=&gt;<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, 'itemid'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l1169"><span class="linenum">1169</span></a>          if (empty(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('id')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) and <a class="var it10011" onMouseOver="hilite(10011)" onMouseOut="lolite()" onClick="logVariable('create')" href="../../_variables/create.html">$create</a>) {
<a name="l1170"><span class="linenum">1170</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('insert')" href="../../_functions/insert.html" onMouseOver="funcPopup(event,'insert')">insert</a>();
<a name="l1171"><span class="linenum">1171</span></a>          }
<a name="l1172"><span class="linenum">1172</span></a>  
<a name="l1173"><span class="linenum">1173</span></a>          return <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>;
<a name="l1174"><span class="linenum">1174</span></a>      }
<a name="l1175"><span class="linenum">1175</span></a>  
<a name="l1176"><span class="linenum">1176</span></a>      <span class="comment">/**</span>
<a name="l1177"><span class="linenum">1177</span></a>  <span class="comment">     * Returns the sortorder of this grade_item. This method is also available in</span>
<a name="l1178"><span class="linenum">1178</span></a>  <span class="comment">     * grade_category, for cases where the object type is not know.</span>
<a name="l1179"><span class="linenum">1179</span></a>  <span class="comment">     *</span>
<a name="l1180"><span class="linenum">1180</span></a>  <span class="comment">     * @return int Sort order</span>
<a name="l1181"><span class="linenum">1181</span></a>  <span class="comment">     */</span>
<a name="l1182"><span class="linenum">1182</span></a>      public function <a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>() {
<a name="l1183"><span class="linenum">1183</span></a>          return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('sortorder')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a>;
<a name="l1184"><span class="linenum">1184</span></a>      }
<a name="l1185"><span class="linenum">1185</span></a>  
<a name="l1186"><span class="linenum">1186</span></a>      <span class="comment">/**</span>
<a name="l1187"><span class="linenum">1187</span></a>  <span class="comment">     * Returns the idnumber of this grade_item. This method is also available in</span>
<a name="l1188"><span class="linenum">1188</span></a>  <span class="comment">     * grade_category, for cases where the object type is not know.</span>
<a name="l1189"><span class="linenum">1189</span></a>  <span class="comment">     *</span>
<a name="l1190"><span class="linenum">1190</span></a>  <span class="comment">     * @return string The grade item idnumber</span>
<a name="l1191"><span class="linenum">1191</span></a>  <span class="comment">     */</span>
<a name="l1192"><span class="linenum">1192</span></a>      public function <a class="function" onClick="logFunction('get_idnumber')" href="../../_functions/get_idnumber.html" onMouseOver="funcPopup(event,'get_idnumber')">get_idnumber</a>() {
<a name="l1193"><span class="linenum">1193</span></a>          return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('idnumber')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>;
<a name="l1194"><span class="linenum">1194</span></a>      }
<a name="l1195"><span class="linenum">1195</span></a>  
<a name="l1196"><span class="linenum">1196</span></a>      <span class="comment">/**</span>
<a name="l1197"><span class="linenum">1197</span></a>  <span class="comment">     * Returns this grade_item. This method is also available in</span>
<a name="l1198"><span class="linenum">1198</span></a>  <span class="comment">     * grade_category, for cases where the object type is not know.</span>
<a name="l1199"><span class="linenum">1199</span></a>  <span class="comment">     *</span>
<a name="l1200"><span class="linenum">1200</span></a>  <span class="comment">     * @return grade_item</span>
<a name="l1201"><span class="linenum">1201</span></a>  <span class="comment">     */</span>
<a name="l1202"><span class="linenum">1202</span></a>      public function <a class="function" onClick="logFunction('get_grade_item')" href="../../_functions/get_grade_item.html" onMouseOver="funcPopup(event,'get_grade_item')">get_grade_item</a>() {
<a name="l1203"><span class="linenum">1203</span></a>          return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>;
<a name="l1204"><span class="linenum">1204</span></a>      }
<a name="l1205"><span class="linenum">1205</span></a>  
<a name="l1206"><span class="linenum">1206</span></a>      <span class="comment">/**</span>
<a name="l1207"><span class="linenum">1207</span></a>  <span class="comment">     * Sets the sortorder of this grade_item. This method is also available in</span>
<a name="l1208"><span class="linenum">1208</span></a>  <span class="comment">     * grade_category, for cases where the object type is not know.</span>
<a name="l1209"><span class="linenum">1209</span></a>  <span class="comment">     *</span>
<a name="l1210"><span class="linenum">1210</span></a>  <span class="comment">     * @param int $sortorder</span>
<a name="l1211"><span class="linenum">1211</span></a>  <span class="comment">     */</span>
<a name="l1212"><span class="linenum">1212</span></a>      public function <a class="function" onClick="logFunction('set_sortorder')" href="../../_functions/set_sortorder.html" onMouseOver="funcPopup(event,'set_sortorder')">set_sortorder</a>(<a class="var it4036" onMouseOver="hilite(4036)" onMouseOut="lolite()" onClick="logVariable('sortorder')" href="../../_variables/sortorder.html">$sortorder</a>) {
<a name="l1213"><span class="linenum">1213</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('sortorder')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a> == <a class="var it4036" onMouseOver="hilite(4036)" onMouseOut="lolite()" onClick="logVariable('sortorder')" href="../../_variables/sortorder.html">$sortorder</a>) {
<a name="l1214"><span class="linenum">1214</span></a>              return;
<a name="l1215"><span class="linenum">1215</span></a>          }
<a name="l1216"><span class="linenum">1216</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('sortorder')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a> = <a class="var it4036" onMouseOver="hilite(4036)" onMouseOut="lolite()" onClick="logVariable('sortorder')" href="../../_variables/sortorder.html">$sortorder</a>;
<a name="l1217"><span class="linenum">1217</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l1218"><span class="linenum">1218</span></a>      }
<a name="l1219"><span class="linenum">1219</span></a>  
<a name="l1220"><span class="linenum">1220</span></a>      <span class="comment">/**</span>
<a name="l1221"><span class="linenum">1221</span></a>  <span class="comment">     * Update this grade item's sortorder so that it will appear after $sortorder</span>
<a name="l1222"><span class="linenum">1222</span></a>  <span class="comment">     *</span>
<a name="l1223"><span class="linenum">1223</span></a>  <span class="comment">     * @param int $sortorder The sort order to place this grade item after</span>
<a name="l1224"><span class="linenum">1224</span></a>  <span class="comment">     */</span>
<a name="l1225"><span class="linenum">1225</span></a>      public function <a class="function" onClick="logFunction('move_after_sortorder')" href="../../_functions/move_after_sortorder.html" onMouseOver="funcPopup(event,'move_after_sortorder')">move_after_sortorder</a>(<a class="var it4036" onMouseOver="hilite(4036)" onMouseOut="lolite()" onClick="logVariable('sortorder')" href="../../_variables/sortorder.html">$sortorder</a>) {
<a name="l1226"><span class="linenum">1226</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1227"><span class="linenum">1227</span></a>  
<a name="l1228"><span class="linenum">1228</span></a>  <span class="comment">        //make some room first</span>
<a name="l1229"><span class="linenum">1229</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(<a class="var it4036" onMouseOver="hilite(4036)" onMouseOut="lolite()" onClick="logVariable('sortorder')" href="../../_variables/sortorder.html">$sortorder</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l1230"><span class="linenum">1230</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;UPDATE {grade_items}
<a name="l1231"><span class="linenum">1231</span></a>                     SET sortorder = sortorder + 1
<a name="l1232"><span class="linenum">1232</span></a>                   WHERE sortorder &gt; ? AND courseid = ?&quot;;
<a name="l1233"><span class="linenum">1233</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l1234"><span class="linenum">1234</span></a>  
<a name="l1235"><span class="linenum">1235</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_sortorder')" href="../../_functions/set_sortorder.html" onMouseOver="funcPopup(event,'set_sortorder')">set_sortorder</a>(<a class="var it4036" onMouseOver="hilite(4036)" onMouseOut="lolite()" onClick="logVariable('sortorder')" href="../../_variables/sortorder.html">$sortorder</a> + 1);
<a name="l1236"><span class="linenum">1236</span></a>      }
<a name="l1237"><span class="linenum">1237</span></a>  
<a name="l1238"><span class="linenum">1238</span></a>      <span class="comment">/**</span>
<a name="l1239"><span class="linenum">1239</span></a>  <span class="comment">     * Detect duplicate grade item's sortorder and re-sort them.</span>
<a name="l1240"><span class="linenum">1240</span></a>  <span class="comment">     * Note: Duplicate sortorder will be introduced while duplicating activities or</span>
<a name="l1241"><span class="linenum">1241</span></a>  <span class="comment">     * merging two courses.</span>
<a name="l1242"><span class="linenum">1242</span></a>  <span class="comment">     *</span>
<a name="l1243"><span class="linenum">1243</span></a>  <span class="comment">     * @param int $courseid id of the course for which grade_items sortorder need to be fixed.</span>
<a name="l1244"><span class="linenum">1244</span></a>  <span class="comment">     */</span>
<a name="l1245"><span class="linenum">1245</span></a>      public static function <a class="function" onClick="logFunction('fix_duplicate_sortorder')" href="../../_functions/fix_duplicate_sortorder.html" onMouseOver="funcPopup(event,'fix_duplicate_sortorder')">fix_duplicate_sortorder</a>(<a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>) {
<a name="l1246"><span class="linenum">1246</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1247"><span class="linenum">1247</span></a>  
<a name="l1248"><span class="linenum">1248</span></a>          <a class="var it2929" onMouseOver="hilite(2929)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l1249"><span class="linenum">1249</span></a>  
<a name="l1250"><span class="linenum">1250</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT DISTINCT g1.id, g1.courseid, g1.sortorder
<a name="l1251"><span class="linenum">1251</span></a>                      FROM {grade_items} g1
<a name="l1252"><span class="linenum">1252</span></a>                      JOIN {grade_items} g2 ON g1.courseid = g2.courseid
<a name="l1253"><span class="linenum">1253</span></a>                  WHERE g1.sortorder = g2.sortorder AND g1.id != g2.id AND g1.courseid = :courseid
<a name="l1254"><span class="linenum">1254</span></a>                  ORDER BY g1.sortorder DESC, g1.id DESC&quot;;
<a name="l1255"><span class="linenum">1255</span></a>  
<a name="l1256"><span class="linenum">1256</span></a>  <span class="comment">        // Get all duplicates in course highest sort order, and higest id first so that we can make space at the</span>
<a name="l1257"><span class="linenum">1257</span></a>  <span class="comment">        // bottom higher end of the sort orders and work down by id.</span>
<a name="l1258"><span class="linenum">1258</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, array('courseid' =&gt; <a class="var it96" onMouseOver="hilite(96)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>));
<a name="l1259"><span class="linenum">1259</span></a>  
<a name="l1260"><span class="linenum">1260</span></a>          foreach(<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it10012" onMouseOver="hilite(10012)" onMouseOut="lolite()" onClick="logVariable('duplicate')" href="../../_variables/duplicate.html">$duplicate</a>) {
<a name="l1261"><span class="linenum">1261</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>(&quot;UPDATE {grade_items}
<a name="l1262"><span class="linenum">1262</span></a>                              SET sortorder = sortorder + 1
<a name="l1263"><span class="linenum">1263</span></a>                            WHERE courseid = :courseid AND
<a name="l1264"><span class="linenum">1264</span></a>                            (sortorder &gt; :sortorder <a class="function" onClick="logFunction('OR')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (sortorder = :sortorder2 AND id &gt; :id))&quot;,
<a name="l1265"><span class="linenum">1265</span></a>                  array('courseid' =&gt; <a class="var it10012" onMouseOver="hilite(10012)" onMouseOut="lolite()" onClick="logVariable('duplicate')" href="../../_variables/duplicate.html">$duplicate</a>-&gt;<a onClick="logVariable('courseid')" class="var it40068" onMouseOver="hilite(40068)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>,
<a name="l1266"><span class="linenum">1266</span></a>                      'sortorder' =&gt; <a class="var it10012" onMouseOver="hilite(10012)" onMouseOut="lolite()" onClick="logVariable('duplicate')" href="../../_variables/duplicate.html">$duplicate</a>-&gt;<a onClick="logVariable('sortorder')" class="var it40068" onMouseOver="hilite(40068)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a>,
<a name="l1267"><span class="linenum">1267</span></a>                      'sortorder2' =&gt; <a class="var it10012" onMouseOver="hilite(10012)" onMouseOut="lolite()" onClick="logVariable('duplicate')" href="../../_variables/duplicate.html">$duplicate</a>-&gt;<a onClick="logVariable('sortorder')" class="var it40068" onMouseOver="hilite(40068)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a>,
<a name="l1268"><span class="linenum">1268</span></a>                      'id' =&gt; <a class="var it10012" onMouseOver="hilite(10012)" onMouseOut="lolite()" onClick="logVariable('duplicate')" href="../../_variables/duplicate.html">$duplicate</a>-&gt;<a onClick="logVariable('id')" class="var it40068" onMouseOver="hilite(40068)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l1269"><span class="linenum">1269</span></a>          }
<a name="l1270"><span class="linenum">1270</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l1271"><span class="linenum">1271</span></a>          <a class="var it2929" onMouseOver="hilite(2929)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l1272"><span class="linenum">1272</span></a>      }
<a name="l1273"><span class="linenum">1273</span></a>  
<a name="l1274"><span class="linenum">1274</span></a>      <span class="comment">/**</span>
<a name="l1275"><span class="linenum">1275</span></a>  <span class="comment">     * Returns the most descriptive field for this object.</span>
<a name="l1276"><span class="linenum">1276</span></a>  <span class="comment">     *</span>
<a name="l1277"><span class="linenum">1277</span></a>  <span class="comment">     * Determines what type of grade item it is then returns the appropriate string</span>
<a name="l1278"><span class="linenum">1278</span></a>  <span class="comment">     *</span>
<a name="l1279"><span class="linenum">1279</span></a>  <span class="comment">     * @param bool $fulltotal If the item is a category total, returns $categoryname.&quot;total&quot; instead of &quot;Category total&quot; or &quot;Course total&quot;</span>
<a name="l1280"><span class="linenum">1280</span></a>  <span class="comment">     * @return string name</span>
<a name="l1281"><span class="linenum">1281</span></a>  <span class="comment">     */</span>
<a name="l1282"><span class="linenum">1282</span></a>      public function <a class="function" onClick="logFunction('get_name')" href="../../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>(<a class="var it10013" onMouseOver="hilite(10013)" onMouseOut="lolite()" onClick="logVariable('fulltotal')" href="../../_variables/fulltotal.html">$fulltotal</a>=false) {
<a name="l1283"><span class="linenum">1283</span></a>          if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemname')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemname.html">itemname</a>)) {
<a name="l1284"><span class="linenum">1284</span></a>  <span class="comment">            // MDL-10557</span>
<a name="l1285"><span class="linenum">1285</span></a>              return <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemname')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemname.html">itemname</a>);
<a name="l1286"><span class="linenum">1286</span></a>  
<a name="l1287"><span class="linenum">1287</span></a>          } else if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_course_item')" href="../../_functions/is_course_item.html" onMouseOver="funcPopup(event,'is_course_item')">is_course_item</a>()) {
<a name="l1288"><span class="linenum">1288</span></a>              return <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('coursetotal', 'grades');
<a name="l1289"><span class="linenum">1289</span></a>  
<a name="l1290"><span class="linenum">1290</span></a>          } else if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_category_item')" href="../../_functions/is_category_item.html" onMouseOver="funcPopup(event,'is_category_item')">is_category_item</a>()) {
<a name="l1291"><span class="linenum">1291</span></a>              if (<a class="var it10013" onMouseOver="hilite(10013)" onMouseOut="lolite()" onClick="logVariable('fulltotal')" href="../../_variables/fulltotal.html">$fulltotal</a>) {
<a name="l1292"><span class="linenum">1292</span></a>                  <a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../_variables/category.html">$category</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('load_parent_category')" href="../../_functions/load_parent_category.html" onMouseOver="funcPopup(event,'load_parent_category')">load_parent_category</a>();
<a name="l1293"><span class="linenum">1293</span></a>                  <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a> = new stdClass();
<a name="l1294"><span class="linenum">1294</span></a>                  <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('category')" class="var it39489" onMouseOver="hilite(39489)" onMouseOut="lolite()" href="../../_variables/category.html">category</a> = <a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../_variables/category.html">$category</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>();
<a name="l1295"><span class="linenum">1295</span></a>                  return <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('categorytotalfull', 'grades', <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../_variables/a.html">$a</a>);
<a name="l1296"><span class="linenum">1296</span></a>              } else {
<a name="l1297"><span class="linenum">1297</span></a>              return <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('categorytotal', 'grades');
<a name="l1298"><span class="linenum">1298</span></a>              }
<a name="l1299"><span class="linenum">1299</span></a>  
<a name="l1300"><span class="linenum">1300</span></a>          } else {
<a name="l1301"><span class="linenum">1301</span></a>              return <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('grade');
<a name="l1302"><span class="linenum">1302</span></a>          }
<a name="l1303"><span class="linenum">1303</span></a>      }
<a name="l1304"><span class="linenum">1304</span></a>  
<a name="l1305"><span class="linenum">1305</span></a>      <span class="comment">/**</span>
<a name="l1306"><span class="linenum">1306</span></a>  <span class="comment">     * A grade item can return a more detailed description which will be added to the header of the column/row in some reports.</span>
<a name="l1307"><span class="linenum">1307</span></a>  <span class="comment">     *</span>
<a name="l1308"><span class="linenum">1308</span></a>  <span class="comment">     * @return string description</span>
<a name="l1309"><span class="linenum">1309</span></a>  <span class="comment">     */</span>
<a name="l1310"><span class="linenum">1310</span></a>      public function <a class="function" onClick="logFunction('get_description')" href="../../_functions/get_description.html" onMouseOver="funcPopup(event,'get_description')">get_description</a>() {
<a name="l1311"><span class="linenum">1311</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_course_item')" href="../../_functions/is_course_item.html" onMouseOver="funcPopup(event,'is_course_item')">is_course_item</a>() || <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_category_item')" href="../../_functions/is_category_item.html" onMouseOver="funcPopup(event,'is_category_item')">is_category_item</a>()) {
<a name="l1312"><span class="linenum">1312</span></a>              <a class="var it10014" onMouseOver="hilite(10014)" onMouseOut="lolite()" onClick="logVariable('categoryitem')" href="../../_variables/categoryitem.html">$categoryitem</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('load_item_category')" href="../../_functions/load_item_category.html" onMouseOver="funcPopup(event,'load_item_category')">load_item_category</a>();
<a name="l1313"><span class="linenum">1313</span></a>              return <a class="var it10014" onMouseOver="hilite(10014)" onMouseOut="lolite()" onClick="logVariable('categoryitem')" href="../../_variables/categoryitem.html">$categoryitem</a>-&gt;<a class="function" onClick="logFunction('get_description')" href="../../_functions/get_description.html" onMouseOver="funcPopup(event,'get_description')">get_description</a>();
<a name="l1314"><span class="linenum">1314</span></a>          }
<a name="l1315"><span class="linenum">1315</span></a>          return '';
<a name="l1316"><span class="linenum">1316</span></a>      }
<a name="l1317"><span class="linenum">1317</span></a>  
<a name="l1318"><span class="linenum">1318</span></a>      <span class="comment">/**</span>
<a name="l1319"><span class="linenum">1319</span></a>  <span class="comment">     * Sets this item's categoryid. A generic method shared by objects that have a parent id of some kind.</span>
<a name="l1320"><span class="linenum">1320</span></a>  <span class="comment">     *</span>
<a name="l1321"><span class="linenum">1321</span></a>  <span class="comment">     * @param int $parentid The ID of the new parent</span>
<a name="l1322"><span class="linenum">1322</span></a>  <span class="comment">     * @return bool True if success</span>
<a name="l1323"><span class="linenum">1323</span></a>  <span class="comment">     */</span>
<a name="l1324"><span class="linenum">1324</span></a>      public function <a class="function" onClick="logFunction('set_parent')" href="../../_functions/set_parent.html" onMouseOver="funcPopup(event,'set_parent')">set_parent</a>(<a class="var it9801" onMouseOver="hilite(9801)" onMouseOut="lolite()" onClick="logVariable('parentid')" href="../../_variables/parentid.html">$parentid</a>) {
<a name="l1325"><span class="linenum">1325</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_course_item')" href="../../_functions/is_course_item.html" onMouseOver="funcPopup(event,'is_course_item')">is_course_item</a>() or <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_category_item')" href="../../_functions/is_category_item.html" onMouseOver="funcPopup(event,'is_category_item')">is_category_item</a>()) {
<a name="l1326"><span class="linenum">1326</span></a>              <a class="function" onClick="logFunction('print_error')" href="../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('cannotsetparentforcatoritem');
<a name="l1327"><span class="linenum">1327</span></a>          }
<a name="l1328"><span class="linenum">1328</span></a>  
<a name="l1329"><span class="linenum">1329</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('categoryid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/categoryid.html">categoryid</a> == <a class="var it9801" onMouseOver="hilite(9801)" onMouseOut="lolite()" onClick="logVariable('parentid')" href="../../_variables/parentid.html">$parentid</a>) {
<a name="l1330"><span class="linenum">1330</span></a>              return true;
<a name="l1331"><span class="linenum">1331</span></a>          }
<a name="l1332"><span class="linenum">1332</span></a>  
<a name="l1333"><span class="linenum">1333</span></a>  <span class="comment">        // find parent and check course id</span>
<a name="l1334"><span class="linenum">1334</span></a>          if (!<a class="var it6486" onMouseOver="hilite(6486)" onMouseOut="lolite()" onClick="logVariable('parent_category')" href="../../_variables/parent_category.html">$parent_category</a> = <a class="class" onClick="logClass('grade_category')" href="../../_classes/grade_category.html" onMouseOver="classPopup(event,'grade_category')">grade_category</a>::<a class="function" onClick="logFunction('fetch')" href="../../_functions/fetch.html" onMouseOver="funcPopup(event,'fetch')">fetch</a>(array('id'=&gt;<a class="var it9801" onMouseOver="hilite(9801)" onMouseOut="lolite()" onClick="logVariable('parentid')" href="../../_variables/parentid.html">$parentid</a>, 'courseid'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>))) {
<a name="l1335"><span class="linenum">1335</span></a>              return false;
<a name="l1336"><span class="linenum">1336</span></a>          }
<a name="l1337"><span class="linenum">1337</span></a>  
<a name="l1338"><span class="linenum">1338</span></a>  <span class="comment">        // MDL-19407 If moving from a non-SWM category to a SWM category, convert aggregationcoef to 0</span>
<a name="l1339"><span class="linenum">1339</span></a>          <a class="var it10015" onMouseOver="hilite(10015)" onMouseOut="lolite()" onClick="logVariable('currentparent')" href="../../_variables/currentparent.html">$currentparent</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('load_parent_category')" href="../../_functions/load_parent_category.html" onMouseOver="funcPopup(event,'load_parent_category')">load_parent_category</a>();
<a name="l1340"><span class="linenum">1340</span></a>  
<a name="l1341"><span class="linenum">1341</span></a>          if (<a class="var it10015" onMouseOver="hilite(10015)" onMouseOut="lolite()" onClick="logVariable('currentparent')" href="../../_variables/currentparent.html">$currentparent</a>-&gt;<a onClick="logVariable('aggregation')" class="var it40069" onMouseOver="hilite(40069)" onMouseOut="lolite()" href="../../_variables/aggregation.html">aggregation</a> != <a class="constant" onClick="logConstant('GRADE_AGGREGATE_WEIGHTED_MEAN2')" href="../../_constants/GRADE_AGGREGATE_WEIGHTED_MEAN2.html" onMouseOver="constPopup(event,'GRADE_AGGREGATE_WEIGHTED_MEAN2')">GRADE_AGGREGATE_WEIGHTED_MEAN2</a> &amp;&amp; <a class="var it6486" onMouseOver="hilite(6486)" onMouseOut="lolite()" onClick="logVariable('parent_category')" href="../../_variables/parent_category.html">$parent_category</a>-&gt;<a onClick="logVariable('aggregation')" class="var it40066" onMouseOver="hilite(40066)" onMouseOut="lolite()" href="../../_variables/aggregation.html">aggregation</a> == <a class="constant" onClick="logConstant('GRADE_AGGREGATE_WEIGHTED_MEAN2')" href="../../_constants/GRADE_AGGREGATE_WEIGHTED_MEAN2.html" onMouseOver="constPopup(event,'GRADE_AGGREGATE_WEIGHTED_MEAN2')">GRADE_AGGREGATE_WEIGHTED_MEAN2</a>) {
<a name="l1342"><span class="linenum">1342</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('aggregationcoef')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/aggregationcoef.html">aggregationcoef</a> = 0;
<a name="l1343"><span class="linenum">1343</span></a>          }
<a name="l1344"><span class="linenum">1344</span></a>  
<a name="l1345"><span class="linenum">1345</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('force_regrading')" href="../../_functions/force_regrading.html" onMouseOver="funcPopup(event,'force_regrading')">force_regrading</a>();
<a name="l1346"><span class="linenum">1346</span></a>  
<a name="l1347"><span class="linenum">1347</span></a>  <span class="comment">        // set new parent</span>
<a name="l1348"><span class="linenum">1348</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('categoryid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/categoryid.html">categoryid</a> = <a class="var it6486" onMouseOver="hilite(6486)" onMouseOut="lolite()" onClick="logVariable('parent_category')" href="../../_variables/parent_category.html">$parent_category</a>-&gt;<a onClick="logVariable('id')" class="var it40066" onMouseOver="hilite(40066)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l1349"><span class="linenum">1349</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('parent_category')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/parent_category.html">parent_category</a> =&amp; <a class="var it6486" onMouseOver="hilite(6486)" onMouseOut="lolite()" onClick="logVariable('parent_category')" href="../../_variables/parent_category.html">$parent_category</a>;
<a name="l1350"><span class="linenum">1350</span></a>  
<a name="l1351"><span class="linenum">1351</span></a>          return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l1352"><span class="linenum">1352</span></a>      }
<a name="l1353"><span class="linenum">1353</span></a>  
<a name="l1354"><span class="linenum">1354</span></a>      <span class="comment">/**</span>
<a name="l1355"><span class="linenum">1355</span></a>  <span class="comment">     * Makes sure value is a valid grade value.</span>
<a name="l1356"><span class="linenum">1356</span></a>  <span class="comment">     *</span>
<a name="l1357"><span class="linenum">1357</span></a>  <span class="comment">     * @param float $gradevalue</span>
<a name="l1358"><span class="linenum">1358</span></a>  <span class="comment">     * @return mixed float or int fixed grade value</span>
<a name="l1359"><span class="linenum">1359</span></a>  <span class="comment">     */</span>
<a name="l1360"><span class="linenum">1360</span></a>      public function <a class="function" onClick="logFunction('bounded_grade')" href="../../_functions/bounded_grade.html" onMouseOver="funcPopup(event,'bounded_grade')">bounded_grade</a>(<a class="var it10017" onMouseOver="hilite(10017)" onMouseOut="lolite()" onClick="logVariable('gradevalue')" href="../../_variables/gradevalue.html">$gradevalue</a>) {
<a name="l1361"><span class="linenum">1361</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l1362"><span class="linenum">1362</span></a>  
<a name="l1363"><span class="linenum">1363</span></a>          if (<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it10017" onMouseOver="hilite(10017)" onMouseOut="lolite()" onClick="logVariable('gradevalue')" href="../../_variables/gradevalue.html">$gradevalue</a>)) {
<a name="l1364"><span class="linenum">1364</span></a>              return null;
<a name="l1365"><span class="linenum">1365</span></a>          }
<a name="l1366"><span class="linenum">1366</span></a>  
<a name="l1367"><span class="linenum">1367</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('gradetype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/gradetype.html">gradetype</a> == <a class="constant" onClick="logConstant('GRADE_TYPE_SCALE')" href="../../_constants/GRADE_TYPE_SCALE.html" onMouseOver="constPopup(event,'GRADE_TYPE_SCALE')">GRADE_TYPE_SCALE</a>) {
<a name="l1368"><span class="linenum">1368</span></a>  <span class="comment">            // no &gt;100% grades hack for scale grades!</span>
<a name="l1369"><span class="linenum">1369</span></a>  <span class="comment">            // 1.5 is rounded to 2 ;-)</span>
<a name="l1370"><span class="linenum">1370</span></a>              return (int)<a class="function" onClick="logFunction('bounded_number')" href="../../_functions/bounded_number.html" onMouseOver="funcPopup(event,'bounded_number')">bounded_number</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademin')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademin.html">grademin</a>, <a class="phpfunction" onClick="logFunction('round')" href="../../_functions/round.html" onMouseOver="phpfuncPopup(event,'round')">round</a>(<a class="var it10017" onMouseOver="hilite(10017)" onMouseOut="lolite()" onClick="logVariable('gradevalue')" href="../../_variables/gradevalue.html">$gradevalue</a>+0.00001), <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademax')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademax.html">grademax</a>);
<a name="l1371"><span class="linenum">1371</span></a>          }
<a name="l1372"><span class="linenum">1372</span></a>  
<a name="l1373"><span class="linenum">1373</span></a>          <a class="var it5025" onMouseOver="hilite(5025)" onMouseOut="lolite()" onClick="logVariable('grademax')" href="../../_variables/grademax.html">$grademax</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademax')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademax.html">grademax</a>;
<a name="l1374"><span class="linenum">1374</span></a>  
<a name="l1375"><span class="linenum">1375</span></a>  <span class="comment">        // NOTE: if you change this value you must manually reset the needsupdate flag in all grade items</span>
<a name="l1376"><span class="linenum">1376</span></a>          <a class="var it10018" onMouseOver="hilite(10018)" onMouseOut="lolite()" onClick="logVariable('maxcoef')" href="../../_variables/maxcoef.html">$maxcoef</a> = isset(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('gradeoverhundredprocentmax')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/gradeoverhundredprocentmax.html">gradeoverhundredprocentmax</a>) ? <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('gradeoverhundredprocentmax')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/gradeoverhundredprocentmax.html">gradeoverhundredprocentmax</a> : 10; <span class="comment">// 1000% max by default</span>
<a name="l1377"><span class="linenum">1377</span></a>  
<a name="l1378"><span class="linenum">1378</span></a>          if (!empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('unlimitedgrades')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/unlimitedgrades.html">unlimitedgrades</a>)) {
<a name="l1379"><span class="linenum">1379</span></a>  <span class="comment">            // NOTE: if you change this value you must manually reset the needsupdate flag in all grade items</span>
<a name="l1380"><span class="linenum">1380</span></a>              <a class="var it5025" onMouseOver="hilite(5025)" onMouseOut="lolite()" onClick="logVariable('grademax')" href="../../_variables/grademax.html">$grademax</a> = <a class="var it5025" onMouseOver="hilite(5025)" onMouseOut="lolite()" onClick="logVariable('grademax')" href="../../_variables/grademax.html">$grademax</a> * <a class="var it10018" onMouseOver="hilite(10018)" onMouseOut="lolite()" onClick="logVariable('maxcoef')" href="../../_variables/maxcoef.html">$maxcoef</a>;
<a name="l1381"><span class="linenum">1381</span></a>          } else if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_category_item')" href="../../_functions/is_category_item.html" onMouseOver="funcPopup(event,'is_category_item')">is_category_item</a>() or <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_course_item')" href="../../_functions/is_course_item.html" onMouseOver="funcPopup(event,'is_course_item')">is_course_item</a>()) {
<a name="l1382"><span class="linenum">1382</span></a>              <a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../_variables/category.html">$category</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('load_item_category')" href="../../_functions/load_item_category.html" onMouseOver="funcPopup(event,'load_item_category')">load_item_category</a>();
<a name="l1383"><span class="linenum">1383</span></a>              if (<a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../_variables/category.html">$category</a>-&gt;<a onClick="logVariable('aggregation')" class="var it39558" onMouseOver="hilite(39558)" onMouseOut="lolite()" href="../../_variables/aggregation.html">aggregation</a> &gt;= 100) {
<a name="l1384"><span class="linenum">1384</span></a>  <span class="comment">                // grade &gt;100% hack</span>
<a name="l1385"><span class="linenum">1385</span></a>                  <a class="var it5025" onMouseOver="hilite(5025)" onMouseOut="lolite()" onClick="logVariable('grademax')" href="../../_variables/grademax.html">$grademax</a> = <a class="var it5025" onMouseOver="hilite(5025)" onMouseOut="lolite()" onClick="logVariable('grademax')" href="../../_variables/grademax.html">$grademax</a> * <a class="var it10018" onMouseOver="hilite(10018)" onMouseOut="lolite()" onClick="logVariable('maxcoef')" href="../../_variables/maxcoef.html">$maxcoef</a>;
<a name="l1386"><span class="linenum">1386</span></a>              }
<a name="l1387"><span class="linenum">1387</span></a>          }
<a name="l1388"><span class="linenum">1388</span></a>  
<a name="l1389"><span class="linenum">1389</span></a>          return (float)<a class="function" onClick="logFunction('bounded_number')" href="../../_functions/bounded_number.html" onMouseOver="funcPopup(event,'bounded_number')">bounded_number</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademin')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademin.html">grademin</a>, <a class="var it10017" onMouseOver="hilite(10017)" onMouseOut="lolite()" onClick="logVariable('gradevalue')" href="../../_variables/gradevalue.html">$gradevalue</a>, <a class="var it5025" onMouseOver="hilite(5025)" onMouseOut="lolite()" onClick="logVariable('grademax')" href="../../_variables/grademax.html">$grademax</a>);
<a name="l1390"><span class="linenum">1390</span></a>      }
<a name="l1391"><span class="linenum">1391</span></a>  
<a name="l1392"><span class="linenum">1392</span></a>      <span class="comment">/**</span>
<a name="l1393"><span class="linenum">1393</span></a>  <span class="comment">     * Finds out on which other items does this depend directly when doing calculation or category aggregation</span>
<a name="l1394"><span class="linenum">1394</span></a>  <span class="comment">     *</span>
<a name="l1395"><span class="linenum">1395</span></a>  <span class="comment">     * @param bool $reset_cache</span>
<a name="l1396"><span class="linenum">1396</span></a>  <span class="comment">     * @return array of grade_item IDs this one depends on</span>
<a name="l1397"><span class="linenum">1397</span></a>  <span class="comment">     */</span>
<a name="l1398"><span class="linenum">1398</span></a>      public function <a class="function" onClick="logFunction('depends_on')" href="../../_functions/depends_on.html" onMouseOver="funcPopup(event,'depends_on')">depends_on</a>(<a class="var it10021" onMouseOver="hilite(10021)" onMouseOut="lolite()" onClick="logVariable('reset_cache')" href="../../_variables/reset_cache.html">$reset_cache</a>=false) {
<a name="l1399"><span class="linenum">1399</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1400"><span class="linenum">1400</span></a>  
<a name="l1401"><span class="linenum">1401</span></a>          if (<a class="var it10021" onMouseOver="hilite(10021)" onMouseOut="lolite()" onClick="logVariable('reset_cache')" href="../../_variables/reset_cache.html">$reset_cache</a>) {
<a name="l1402"><span class="linenum">1402</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dependson_cache')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/dependson_cache.html">dependson_cache</a> = null;
<a name="l1403"><span class="linenum">1403</span></a>          } else if (isset(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dependson_cache')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/dependson_cache.html">dependson_cache</a>)) {
<a name="l1404"><span class="linenum">1404</span></a>              return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dependson_cache')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/dependson_cache.html">dependson_cache</a>;
<a name="l1405"><span class="linenum">1405</span></a>          }
<a name="l1406"><span class="linenum">1406</span></a>  
<a name="l1407"><span class="linenum">1407</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_locked')" href="../../_functions/is_locked.html" onMouseOver="funcPopup(event,'is_locked')">is_locked</a>()) {
<a name="l1408"><span class="linenum">1408</span></a>  <span class="comment">            // locked items do not need to be regraded</span>
<a name="l1409"><span class="linenum">1409</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dependson_cache')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/dependson_cache.html">dependson_cache</a> = array();
<a name="l1410"><span class="linenum">1410</span></a>              return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dependson_cache')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/dependson_cache.html">dependson_cache</a>;
<a name="l1411"><span class="linenum">1411</span></a>          }
<a name="l1412"><span class="linenum">1412</span></a>  
<a name="l1413"><span class="linenum">1413</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_calculated')" href="../../_functions/is_calculated.html" onMouseOver="funcPopup(event,'is_calculated')">is_calculated</a>()) {
<a name="l1414"><span class="linenum">1414</span></a>              if (<a class="phpfunction" onClick="logFunction('preg_match_all')" href="../../_functions/preg_match_all.html" onMouseOver="phpfuncPopup(event,'preg_match_all')">preg_match_all</a>('/##gi(\d+)##/', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('calculation')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/calculation.html">calculation</a>, <a class="var it79" onMouseOver="hilite(79)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l1415"><span class="linenum">1415</span></a>                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dependson_cache')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/dependson_cache.html">dependson_cache</a> = <a class="phpfunction" onClick="logFunction('array_unique')" href="../../_functions/array_unique.html" onMouseOver="phpfuncPopup(event,'array_unique')">array_unique</a>(<a class="var it79" onMouseOver="hilite(79)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]); <span class="comment">// remove duplicates</span>
<a name="l1416"><span class="linenum">1416</span></a>                  return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dependson_cache')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/dependson_cache.html">dependson_cache</a>;
<a name="l1417"><span class="linenum">1417</span></a>              } else {
<a name="l1418"><span class="linenum">1418</span></a>                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dependson_cache')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/dependson_cache.html">dependson_cache</a> = array();
<a name="l1419"><span class="linenum">1419</span></a>                  return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dependson_cache')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/dependson_cache.html">dependson_cache</a>;
<a name="l1420"><span class="linenum">1420</span></a>              }
<a name="l1421"><span class="linenum">1421</span></a>  
<a name="l1422"><span class="linenum">1422</span></a>          } else if (<a class="var it6050" onMouseOver="hilite(6050)" onMouseOut="lolite()" onClick="logVariable('grade_category')" href="../../_variables/grade_category.html">$grade_category</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('load_item_category')" href="../../_functions/load_item_category.html" onMouseOver="funcPopup(event,'load_item_category')">load_item_category</a>()) {
<a name="l1423"><span class="linenum">1423</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array();
<a name="l1424"><span class="linenum">1424</span></a>  
<a name="l1425"><span class="linenum">1425</span></a>  <span class="comment">            //only items with numeric or scale values can be aggregated</span>
<a name="l1426"><span class="linenum">1426</span></a>              if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('gradetype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/gradetype.html">gradetype</a> != <a class="constant" onClick="logConstant('GRADE_TYPE_VALUE')" href="../../_constants/GRADE_TYPE_VALUE.html" onMouseOver="constPopup(event,'GRADE_TYPE_VALUE')">GRADE_TYPE_VALUE</a> and <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('gradetype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/gradetype.html">gradetype</a> != <a class="constant" onClick="logConstant('GRADE_TYPE_SCALE')" href="../../_constants/GRADE_TYPE_SCALE.html" onMouseOver="constPopup(event,'GRADE_TYPE_SCALE')">GRADE_TYPE_SCALE</a>) {
<a name="l1427"><span class="linenum">1427</span></a>                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dependson_cache')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/dependson_cache.html">dependson_cache</a> = array();
<a name="l1428"><span class="linenum">1428</span></a>                  return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dependson_cache')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/dependson_cache.html">dependson_cache</a>;
<a name="l1429"><span class="linenum">1429</span></a>              }
<a name="l1430"><span class="linenum">1430</span></a>  
<a name="l1431"><span class="linenum">1431</span></a>              <a class="var it6050" onMouseOver="hilite(6050)" onMouseOut="lolite()" onClick="logVariable('grade_category')" href="../../_variables/grade_category.html">$grade_category</a>-&gt;<a class="function" onClick="logFunction('apply_forced_settings')" href="../../_functions/apply_forced_settings.html" onMouseOver="funcPopup(event,'apply_forced_settings')">apply_forced_settings</a>();
<a name="l1432"><span class="linenum">1432</span></a>  
<a name="l1433"><span class="linenum">1433</span></a>              if (empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enableoutcomes')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/enableoutcomes.html">enableoutcomes</a>) or <a class="var it6050" onMouseOver="hilite(6050)" onMouseOut="lolite()" onClick="logVariable('grade_category')" href="../../_variables/grade_category.html">$grade_category</a>-&gt;<a onClick="logVariable('aggregateoutcomes')" class="var it40058" onMouseOver="hilite(40058)" onMouseOut="lolite()" href="../../_variables/aggregateoutcomes.html">aggregateoutcomes</a>) {
<a name="l1434"><span class="linenum">1434</span></a>                  <a class="var it10023" onMouseOver="hilite(10023)" onMouseOut="lolite()" onClick="logVariable('outcomes_sql')" href="../../_variables/outcomes_sql.html">$outcomes_sql</a> = &quot;&quot;;
<a name="l1435"><span class="linenum">1435</span></a>              } else {
<a name="l1436"><span class="linenum">1436</span></a>                  <a class="var it10023" onMouseOver="hilite(10023)" onMouseOut="lolite()" onClick="logVariable('outcomes_sql')" href="../../_variables/outcomes_sql.html">$outcomes_sql</a> = &quot;AND gi.outcomeid IS NULL&quot;;
<a name="l1437"><span class="linenum">1437</span></a>              }
<a name="l1438"><span class="linenum">1438</span></a>  
<a name="l1439"><span class="linenum">1439</span></a>              if (empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('grade_includescalesinaggregation')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/grade_includescalesinaggregation.html">grade_includescalesinaggregation</a>)) {
<a name="l1440"><span class="linenum">1440</span></a>                  <a class="var it10024" onMouseOver="hilite(10024)" onMouseOut="lolite()" onClick="logVariable('gtypes')" href="../../_variables/gtypes.html">$gtypes</a> = &quot;gi.gradetype = ?&quot;;
<a name="l1441"><span class="linenum">1441</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="constant" onClick="logConstant('GRADE_TYPE_VALUE')" href="../../_constants/GRADE_TYPE_VALUE.html" onMouseOver="constPopup(event,'GRADE_TYPE_VALUE')">GRADE_TYPE_VALUE</a>;
<a name="l1442"><span class="linenum">1442</span></a>              } else {
<a name="l1443"><span class="linenum">1443</span></a>                  <a class="var it10024" onMouseOver="hilite(10024)" onMouseOut="lolite()" onClick="logVariable('gtypes')" href="../../_variables/gtypes.html">$gtypes</a> = &quot;(gi.gradetype = ? OR gi.gradetype = ?)&quot;;
<a name="l1444"><span class="linenum">1444</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="constant" onClick="logConstant('GRADE_TYPE_VALUE')" href="../../_constants/GRADE_TYPE_VALUE.html" onMouseOver="constPopup(event,'GRADE_TYPE_VALUE')">GRADE_TYPE_VALUE</a>;
<a name="l1445"><span class="linenum">1445</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="constant" onClick="logConstant('GRADE_TYPE_SCALE')" href="../../_constants/GRADE_TYPE_SCALE.html" onMouseOver="constPopup(event,'GRADE_TYPE_SCALE')">GRADE_TYPE_SCALE</a>;
<a name="l1446"><span class="linenum">1446</span></a>              }
<a name="l1447"><span class="linenum">1447</span></a>  
<a name="l1448"><span class="linenum">1448</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it6050" onMouseOver="hilite(6050)" onMouseOut="lolite()" onClick="logVariable('grade_category')" href="../../_variables/grade_category.html">$grade_category</a>-&gt;<a onClick="logVariable('id')" class="var it40058" onMouseOver="hilite(40058)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l1449"><span class="linenum">1449</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>;
<a name="l1450"><span class="linenum">1450</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it6050" onMouseOver="hilite(6050)" onMouseOut="lolite()" onClick="logVariable('grade_category')" href="../../_variables/grade_category.html">$grade_category</a>-&gt;<a onClick="logVariable('id')" class="var it40058" onMouseOver="hilite(40058)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l1451"><span class="linenum">1451</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>;
<a name="l1452"><span class="linenum">1452</span></a>              if (empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('grade_includescalesinaggregation')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/grade_includescalesinaggregation.html">grade_includescalesinaggregation</a>)) {
<a name="l1453"><span class="linenum">1453</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="constant" onClick="logConstant('GRADE_TYPE_VALUE')" href="../../_constants/GRADE_TYPE_VALUE.html" onMouseOver="constPopup(event,'GRADE_TYPE_VALUE')">GRADE_TYPE_VALUE</a>;
<a name="l1454"><span class="linenum">1454</span></a>              } else {
<a name="l1455"><span class="linenum">1455</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="constant" onClick="logConstant('GRADE_TYPE_VALUE')" href="../../_constants/GRADE_TYPE_VALUE.html" onMouseOver="constPopup(event,'GRADE_TYPE_VALUE')">GRADE_TYPE_VALUE</a>;
<a name="l1456"><span class="linenum">1456</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="constant" onClick="logConstant('GRADE_TYPE_SCALE')" href="../../_constants/GRADE_TYPE_SCALE.html" onMouseOver="constPopup(event,'GRADE_TYPE_SCALE')">GRADE_TYPE_SCALE</a>;
<a name="l1457"><span class="linenum">1457</span></a>              }
<a name="l1458"><span class="linenum">1458</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT gi.id
<a name="l1459"><span class="linenum">1459</span></a>                        FROM {grade_items} gi
<a name="l1460"><span class="linenum">1460</span></a>                       WHERE <a class="var it10024" onMouseOver="hilite(10024)" onMouseOut="lolite()" onClick="logVariable('gtypes')" href="../../_variables/gtypes.html">$gtypes</a>
<a name="l1461"><span class="linenum">1461</span></a>                             AND gi.categoryid = ?
<a name="l1462"><span class="linenum">1462</span></a>                             AND gi.courseid = ?
<a name="l1463"><span class="linenum">1463</span></a>                             <a class="var it10023" onMouseOver="hilite(10023)" onMouseOut="lolite()" onClick="logVariable('outcomes_sql')" href="../../_variables/outcomes_sql.html">$outcomes_sql</a>
<a name="l1464"><span class="linenum">1464</span></a>                      UNION
<a name="l1465"><span class="linenum">1465</span></a>  
<a name="l1466"><span class="linenum">1466</span></a>                      SELECT gi.id
<a name="l1467"><span class="linenum">1467</span></a>                        FROM {grade_items} gi, {grade_categories} gc
<a name="l1468"><span class="linenum">1468</span></a>                       <a class="function" onClick="logFunction('WHERE')" href="../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a> (gi.itemtype = 'category' OR gi.itemtype = 'course') AND gi.iteminstance=gc.id
<a name="l1469"><span class="linenum">1469</span></a>                             AND gc.parent = ?
<a name="l1470"><span class="linenum">1470</span></a>                             AND gi.courseid = ?
<a name="l1471"><span class="linenum">1471</span></a>                             AND <a class="var it10024" onMouseOver="hilite(10024)" onMouseOut="lolite()" onClick="logVariable('gtypes')" href="../../_variables/gtypes.html">$gtypes</a>
<a name="l1472"><span class="linenum">1472</span></a>                             <a class="var it10023" onMouseOver="hilite(10023)" onMouseOut="lolite()" onClick="logVariable('outcomes_sql')" href="../../_variables/outcomes_sql.html">$outcomes_sql</a>&quot;;
<a name="l1473"><span class="linenum">1473</span></a>  
<a name="l1474"><span class="linenum">1474</span></a>              if (<a class="var it1701" onMouseOver="hilite(1701)" onMouseOut="lolite()" onClick="logVariable('children')" href="../../_variables/children.html">$children</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>)) {
<a name="l1475"><span class="linenum">1475</span></a>                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dependson_cache')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/dependson_cache.html">dependson_cache</a> = <a class="phpfunction" onClick="logFunction('array_keys')" href="../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it1701" onMouseOver="hilite(1701)" onMouseOut="lolite()" onClick="logVariable('children')" href="../../_variables/children.html">$children</a>);
<a name="l1476"><span class="linenum">1476</span></a>                  return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dependson_cache')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/dependson_cache.html">dependson_cache</a>;
<a name="l1477"><span class="linenum">1477</span></a>              } else {
<a name="l1478"><span class="linenum">1478</span></a>                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dependson_cache')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/dependson_cache.html">dependson_cache</a> = array();
<a name="l1479"><span class="linenum">1479</span></a>                  return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dependson_cache')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/dependson_cache.html">dependson_cache</a>;
<a name="l1480"><span class="linenum">1480</span></a>              }
<a name="l1481"><span class="linenum">1481</span></a>  
<a name="l1482"><span class="linenum">1482</span></a>          } else {
<a name="l1483"><span class="linenum">1483</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dependson_cache')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/dependson_cache.html">dependson_cache</a> = array();
<a name="l1484"><span class="linenum">1484</span></a>              return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dependson_cache')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/dependson_cache.html">dependson_cache</a>;
<a name="l1485"><span class="linenum">1485</span></a>          }
<a name="l1486"><span class="linenum">1486</span></a>      }
<a name="l1487"><span class="linenum">1487</span></a>  
<a name="l1488"><span class="linenum">1488</span></a>      <span class="comment">/**</span>
<a name="l1489"><span class="linenum">1489</span></a>  <span class="comment">     * Refetch grades from modules, plugins.</span>
<a name="l1490"><span class="linenum">1490</span></a>  <span class="comment">     *</span>
<a name="l1491"><span class="linenum">1491</span></a>  <span class="comment">     * @param int $userid optional, limit the refetch to a single user</span>
<a name="l1492"><span class="linenum">1492</span></a>  <span class="comment">     * @return bool Returns true on success or if there is nothing to do</span>
<a name="l1493"><span class="linenum">1493</span></a>  <span class="comment">     */</span>
<a name="l1494"><span class="linenum">1494</span></a>      public function <a class="function" onClick="logFunction('refresh_grades')" href="../../_functions/refresh_grades.html" onMouseOver="funcPopup(event,'refresh_grades')">refresh_grades</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>=0) {
<a name="l1495"><span class="linenum">1495</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1496"><span class="linenum">1496</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemtype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemtype.html">itemtype</a> == 'mod') {
<a name="l1497"><span class="linenum">1497</span></a>              if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_outcome_item')" href="../../_functions/is_outcome_item.html" onMouseOver="funcPopup(event,'is_outcome_item')">is_outcome_item</a>()) {
<a name="l1498"><span class="linenum">1498</span></a>  <span class="comment">                //nothing to do</span>
<a name="l1499"><span class="linenum">1499</span></a>                  return true;
<a name="l1500"><span class="linenum">1500</span></a>              }
<a name="l1501"><span class="linenum">1501</span></a>  
<a name="l1502"><span class="linenum">1502</span></a>              if (!<a class="var it4373" onMouseOver="hilite(4373)" onMouseOut="lolite()" onClick="logVariable('activity')" href="../../_variables/activity.html">$activity</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemmodule')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemmodule.html">itemmodule</a>, array('id' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('iteminstance')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/iteminstance.html">iteminstance</a>))) {
<a name="l1503"><span class="linenum">1503</span></a>                  <a class="function" onClick="logFunction('debugging')" href="../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>(&quot;Can not find <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemmodule')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemmodule.html">itemmodule</a> activity with id <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('iteminstance')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/iteminstance.html">iteminstance</a>&quot;);
<a name="l1504"><span class="linenum">1504</span></a>                  return false;
<a name="l1505"><span class="linenum">1505</span></a>              }
<a name="l1506"><span class="linenum">1506</span></a>  
<a name="l1507"><span class="linenum">1507</span></a>              if (!<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_instance')" href="../../_functions/get_coursemodule_from_instance.html" onMouseOver="funcPopup(event,'get_coursemodule_from_instance')">get_coursemodule_from_instance</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemmodule')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemmodule.html">itemmodule</a>, <a class="var it4373" onMouseOver="hilite(4373)" onMouseOut="lolite()" onClick="logVariable('activity')" href="../../_variables/activity.html">$activity</a>-&gt;<a onClick="logVariable('id')" class="var it40070" onMouseOver="hilite(40070)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>)) {
<a name="l1508"><span class="linenum">1508</span></a>                  <a class="function" onClick="logFunction('debugging')" href="../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Can not find course module');
<a name="l1509"><span class="linenum">1509</span></a>                  return false;
<a name="l1510"><span class="linenum">1510</span></a>              }
<a name="l1511"><span class="linenum">1511</span></a>  
<a name="l1512"><span class="linenum">1512</span></a>              <a class="var it4373" onMouseOver="hilite(4373)" onMouseOut="lolite()" onClick="logVariable('activity')" href="../../_variables/activity.html">$activity</a>-&gt;<a onClick="logVariable('modname')" class="var it40070" onMouseOver="hilite(40070)" onMouseOut="lolite()" href="../../_variables/modname.html">modname</a>    = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemmodule')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemmodule.html">itemmodule</a>;
<a name="l1513"><span class="linenum">1513</span></a>              <a class="var it4373" onMouseOver="hilite(4373)" onMouseOut="lolite()" onClick="logVariable('activity')" href="../../_variables/activity.html">$activity</a>-&gt;<a onClick="logVariable('cmidnumber')" class="var it40070" onMouseOver="hilite(40070)" onMouseOut="lolite()" href="../../_variables/cmidnumber.html">cmidnumber</a> = <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('idnumber')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../../_variables/idnumber.html">idnumber</a>;
<a name="l1514"><span class="linenum">1514</span></a>  
<a name="l1515"><span class="linenum">1515</span></a>              return <a class="function" onClick="logFunction('grade_update_mod_grades')" href="../../_functions/grade_update_mod_grades.html" onMouseOver="funcPopup(event,'grade_update_mod_grades')">grade_update_mod_grades</a>(<a class="var it4373" onMouseOver="hilite(4373)" onMouseOut="lolite()" onClick="logVariable('activity')" href="../../_variables/activity.html">$activity</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>);
<a name="l1516"><span class="linenum">1516</span></a>          }
<a name="l1517"><span class="linenum">1517</span></a>  
<a name="l1518"><span class="linenum">1518</span></a>          return true;
<a name="l1519"><span class="linenum">1519</span></a>      }
<a name="l1520"><span class="linenum">1520</span></a>  
<a name="l1521"><span class="linenum">1521</span></a>      <span class="comment">/**</span>
<a name="l1522"><span class="linenum">1522</span></a>  <span class="comment">     * Updates final grade value for given user, this is a only way to update final</span>
<a name="l1523"><span class="linenum">1523</span></a>  <span class="comment">     * grades from gradebook and import because it logs the change in history table</span>
<a name="l1524"><span class="linenum">1524</span></a>  <span class="comment">     * and deals with overridden flag. This flag is set to prevent later overriding</span>
<a name="l1525"><span class="linenum">1525</span></a>  <span class="comment">     * from raw grades submitted from modules.</span>
<a name="l1526"><span class="linenum">1526</span></a>  <span class="comment">     *</span>
<a name="l1527"><span class="linenum">1527</span></a>  <span class="comment">     * @param int $userid The graded user</span>
<a name="l1528"><span class="linenum">1528</span></a>  <span class="comment">     * @param float|false $finalgrade The float value of final grade, false means do not change</span>
<a name="l1529"><span class="linenum">1529</span></a>  <span class="comment">     * @param string $source The modification source</span>
<a name="l1530"><span class="linenum">1530</span></a>  <span class="comment">     * @param string $feedback Optional teacher feedback</span>
<a name="l1531"><span class="linenum">1531</span></a>  <span class="comment">     * @param int $feedbackformat A format like FORMAT_PLAIN or FORMAT_HTML</span>
<a name="l1532"><span class="linenum">1532</span></a>  <span class="comment">     * @param int $usermodified The ID of the user making the modification</span>
<a name="l1533"><span class="linenum">1533</span></a>  <span class="comment">     * @return bool success</span>
<a name="l1534"><span class="linenum">1534</span></a>  <span class="comment">     */</span>
<a name="l1535"><span class="linenum">1535</span></a>      public function <a class="function" onClick="logFunction('update_final_grade')" href="../../_functions/update_final_grade.html" onMouseOver="funcPopup(event,'update_final_grade')">update_final_grade</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it4888" onMouseOver="hilite(4888)" onMouseOut="lolite()" onClick="logVariable('finalgrade')" href="../../_variables/finalgrade.html">$finalgrade</a>=false, <a class="var it1344" onMouseOver="hilite(1344)" onMouseOut="lolite()" onClick="logVariable('source')" href="../../_variables/source.html">$source</a>=NULL, <a class="var it714" onMouseOver="hilite(714)" onMouseOut="lolite()" onClick="logVariable('feedback')" href="../../_variables/feedback.html">$feedback</a>=false, <a class="var it2281" onMouseOver="hilite(2281)" onMouseOut="lolite()" onClick="logVariable('feedbackformat')" href="../../_variables/feedbackformat.html">$feedbackformat</a>=<a class="constant" onClick="logConstant('FORMAT_MOODLE')" href="../../_constants/FORMAT_MOODLE.html" onMouseOver="constPopup(event,'FORMAT_MOODLE')">FORMAT_MOODLE</a>, <a class="var it5799" onMouseOver="hilite(5799)" onMouseOut="lolite()" onClick="logVariable('usermodified')" href="../../_variables/usermodified.html">$usermodified</a>=null) {
<a name="l1536"><span class="linenum">1536</span></a>          global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l1537"><span class="linenum">1537</span></a>  
<a name="l1538"><span class="linenum">1538</span></a>          <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = true;
<a name="l1539"><span class="linenum">1539</span></a>  
<a name="l1540"><span class="linenum">1540</span></a>  <span class="comment">        // no grading used or locked</span>
<a name="l1541"><span class="linenum">1541</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('gradetype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/gradetype.html">gradetype</a> == <a class="constant" onClick="logConstant('GRADE_TYPE_NONE')" href="../../_constants/GRADE_TYPE_NONE.html" onMouseOver="constPopup(event,'GRADE_TYPE_NONE')">GRADE_TYPE_NONE</a> or <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_locked')" href="../../_functions/is_locked.html" onMouseOver="funcPopup(event,'is_locked')">is_locked</a>()) {
<a name="l1542"><span class="linenum">1542</span></a>              return false;
<a name="l1543"><span class="linenum">1543</span></a>          }
<a name="l1544"><span class="linenum">1544</span></a>  
<a name="l1545"><span class="linenum">1545</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = <span class="keyword">new </span><a class="class" onClick="logClass('grade_grade')" href="../../_classes/grade_grade.html" onMouseOver="classPopup(event,'grade_grade')">grade_grade</a>(array('itemid'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid'=&gt;<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>));
<a name="l1546"><span class="linenum">1546</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('grade_item')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/grade_item.html">grade_item</a> =&amp; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>; <span class="comment">// prevent db fetching of this grade_item</span>
<a name="l1547"><span class="linenum">1547</span></a>  
<a name="l1548"><span class="linenum">1548</span></a>          if (empty(<a class="var it5799" onMouseOver="hilite(5799)" onMouseOut="lolite()" onClick="logVariable('usermodified')" href="../../_variables/usermodified.html">$usermodified</a>)) {
<a name="l1549"><span class="linenum">1549</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('usermodified')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/usermodified.html">usermodified</a> = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l1550"><span class="linenum">1550</span></a>          } else {
<a name="l1551"><span class="linenum">1551</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('usermodified')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/usermodified.html">usermodified</a> = <a class="var it5799" onMouseOver="hilite(5799)" onMouseOut="lolite()" onClick="logVariable('usermodified')" href="../../_variables/usermodified.html">$usermodified</a>;
<a name="l1552"><span class="linenum">1552</span></a>          }
<a name="l1553"><span class="linenum">1553</span></a>  
<a name="l1554"><span class="linenum">1554</span></a>          if (<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('is_locked')" href="../../_functions/is_locked.html" onMouseOver="funcPopup(event,'is_locked')">is_locked</a>()) {
<a name="l1555"><span class="linenum">1555</span></a>  <span class="comment">            // do not update locked grades at all</span>
<a name="l1556"><span class="linenum">1556</span></a>              return false;
<a name="l1557"><span class="linenum">1557</span></a>          }
<a name="l1558"><span class="linenum">1558</span></a>  
<a name="l1559"><span class="linenum">1559</span></a>          <a class="var it9479" onMouseOver="hilite(9479)" onMouseOut="lolite()" onClick="logVariable('locktime')" href="../../_variables/locktime.html">$locktime</a> = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('get_locktime')" href="../../_functions/get_locktime.html" onMouseOver="funcPopup(event,'get_locktime')">get_locktime</a>();
<a name="l1560"><span class="linenum">1560</span></a>          if (<a class="var it9479" onMouseOver="hilite(9479)" onMouseOut="lolite()" onClick="logVariable('locktime')" href="../../_variables/locktime.html">$locktime</a> and <a class="var it9479" onMouseOver="hilite(9479)" onMouseOut="lolite()" onClick="logVariable('locktime')" href="../../_variables/locktime.html">$locktime</a> &lt; <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()) {
<a name="l1561"><span class="linenum">1561</span></a>  <span class="comment">            // do not update grades that should be already locked, force regrade instead</span>
<a name="l1562"><span class="linenum">1562</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('force_regrading')" href="../../_functions/force_regrading.html" onMouseOver="funcPopup(event,'force_regrading')">force_regrading</a>();
<a name="l1563"><span class="linenum">1563</span></a>              return false;
<a name="l1564"><span class="linenum">1564</span></a>          }
<a name="l1565"><span class="linenum">1565</span></a>  
<a name="l1566"><span class="linenum">1566</span></a>          <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a> = new stdClass();
<a name="l1567"><span class="linenum">1567</span></a>          <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a>     = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a>;
<a name="l1568"><span class="linenum">1568</span></a>          <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('overridden')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/overridden.html">overridden</a>     = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('overridden')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/overridden.html">overridden</a>;
<a name="l1569"><span class="linenum">1569</span></a>          <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('feedback')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/feedback.html">feedback</a>       = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('feedback')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/feedback.html">feedback</a>;
<a name="l1570"><span class="linenum">1570</span></a>          <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('feedbackformat')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/feedbackformat.html">feedbackformat</a> = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('feedbackformat')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/feedbackformat.html">feedbackformat</a>;
<a name="l1571"><span class="linenum">1571</span></a>  
<a name="l1572"><span class="linenum">1572</span></a>  <span class="comment">        // MDL-31713 rawgramemin and max must be up to date so conditional access %'s works properly.</span>
<a name="l1573"><span class="linenum">1573</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawgrademin')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawgrademin.html">rawgrademin</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademin')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademin.html">grademin</a>;
<a name="l1574"><span class="linenum">1574</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawgrademax')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawgrademax.html">rawgrademax</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademax')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademax.html">grademax</a>;
<a name="l1575"><span class="linenum">1575</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawscaleid')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawscaleid.html">rawscaleid</a>  = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('scaleid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/scaleid.html">scaleid</a>;
<a name="l1576"><span class="linenum">1576</span></a>  
<a name="l1577"><span class="linenum">1577</span></a>  <span class="comment">        // changed grade?</span>
<a name="l1578"><span class="linenum">1578</span></a>          if (<a class="var it4888" onMouseOver="hilite(4888)" onMouseOut="lolite()" onClick="logVariable('finalgrade')" href="../../_variables/finalgrade.html">$finalgrade</a> !== false) {
<a name="l1579"><span class="linenum">1579</span></a>              if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_overridable_item')" href="../../_functions/is_overridable_item.html" onMouseOver="funcPopup(event,'is_overridable_item')">is_overridable_item</a>()) {
<a name="l1580"><span class="linenum">1580</span></a>                  <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('overridden')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/overridden.html">overridden</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1581"><span class="linenum">1581</span></a>              }
<a name="l1582"><span class="linenum">1582</span></a>  
<a name="l1583"><span class="linenum">1583</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('bounded_grade')" href="../../_functions/bounded_grade.html" onMouseOver="funcPopup(event,'bounded_grade')">bounded_grade</a>(<a class="var it4888" onMouseOver="hilite(4888)" onMouseOut="lolite()" onClick="logVariable('finalgrade')" href="../../_variables/finalgrade.html">$finalgrade</a>);
<a name="l1584"><span class="linenum">1584</span></a>          }
<a name="l1585"><span class="linenum">1585</span></a>  
<a name="l1586"><span class="linenum">1586</span></a>  <span class="comment">        // do we have comment from teacher?</span>
<a name="l1587"><span class="linenum">1587</span></a>          if (<a class="var it714" onMouseOver="hilite(714)" onMouseOut="lolite()" onClick="logVariable('feedback')" href="../../_variables/feedback.html">$feedback</a> !== false) {
<a name="l1588"><span class="linenum">1588</span></a>              if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_overridable_item_feedback')" href="../../_functions/is_overridable_item_feedback.html" onMouseOver="funcPopup(event,'is_overridable_item_feedback')">is_overridable_item_feedback</a>()) {
<a name="l1589"><span class="linenum">1589</span></a>  <span class="comment">                // external items (modules, plugins) may have own feedback</span>
<a name="l1590"><span class="linenum">1590</span></a>                  <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('overridden')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/overridden.html">overridden</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1591"><span class="linenum">1591</span></a>              }
<a name="l1592"><span class="linenum">1592</span></a>  
<a name="l1593"><span class="linenum">1593</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('feedback')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/feedback.html">feedback</a>       = <a class="var it714" onMouseOver="hilite(714)" onMouseOut="lolite()" onClick="logVariable('feedback')" href="../../_variables/feedback.html">$feedback</a>;
<a name="l1594"><span class="linenum">1594</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('feedbackformat')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/feedbackformat.html">feedbackformat</a> = <a class="var it2281" onMouseOver="hilite(2281)" onMouseOut="lolite()" onClick="logVariable('feedbackformat')" href="../../_variables/feedbackformat.html">$feedbackformat</a>;
<a name="l1595"><span class="linenum">1595</span></a>          }
<a name="l1596"><span class="linenum">1596</span></a>  
<a name="l1597"><span class="linenum">1597</span></a>          if (empty(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('id')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l1598"><span class="linenum">1598</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('timecreated')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a>  = null;   <span class="comment">// hack alert - date submitted - no submission yet</span>
<a name="l1599"><span class="linenum">1599</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('timemodified')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>(); <span class="comment">// hack alert - date graded</span>
<a name="l1600"><span class="linenum">1600</span></a>              <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = (bool)<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('insert')" href="../../_functions/insert.html" onMouseOver="funcPopup(event,'insert')">insert</a>(<a class="var it1344" onMouseOver="hilite(1344)" onMouseOut="lolite()" onClick="logVariable('source')" href="../../_variables/source.html">$source</a>);
<a name="l1601"><span class="linenum">1601</span></a>  
<a name="l1602"><span class="linenum">1602</span></a>  <span class="comment">            // If the grade insert was successful and the final grade was not null then trigger a user_graded event.</span>
<a name="l1603"><span class="linenum">1603</span></a>              if (<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> &amp;&amp; !<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a>)) {
<a name="l1604"><span class="linenum">1604</span></a>                  \core\event\<a class="class" onClick="logClass('user_graded')" href="../../_classes/user_graded.html" onMouseOver="classPopup(event,'user_graded')">user_graded</a>::<a class="function" onClick="logFunction('create_from_grade')" href="../../_functions/create_from_grade.html" onMouseOver="funcPopup(event,'create_from_grade')">create_from_grade</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1605"><span class="linenum">1605</span></a>              }
<a name="l1606"><span class="linenum">1606</span></a>          } else if (<a class="function" onClick="logFunction('grade_floats_different')" href="../../_functions/grade_floats_different.html" onMouseOver="funcPopup(event,'grade_floats_different')">grade_floats_different</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a>, <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a>)
<a name="l1607"><span class="linenum">1607</span></a>                  or <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('feedback')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/feedback.html">feedback</a>       !== <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;feedback
<a name="l1608"><span class="linenum">1608</span></a>                  or <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('feedbackformat')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/feedbackformat.html">feedbackformat</a> != <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;feedbackformat
<a name="l1609"><span class="linenum">1609</span></a>                  <a class="function" onClick="logFunction('or')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">or</a> (<a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('overridden')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/overridden.html">overridden</a> == 0 and <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('overridden')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/overridden.html">overridden</a> &gt; 0)) {
<a name="l1610"><span class="linenum">1610</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('timemodified')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>(); <span class="comment">// hack alert - date graded</span>
<a name="l1611"><span class="linenum">1611</span></a>              <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>(<a class="var it1344" onMouseOver="hilite(1344)" onMouseOut="lolite()" onClick="logVariable('source')" href="../../_variables/source.html">$source</a>);
<a name="l1612"><span class="linenum">1612</span></a>  
<a name="l1613"><span class="linenum">1613</span></a>  <span class="comment">            // If the grade update was successful and the actual grade has changed then trigger a user_graded event.</span>
<a name="l1614"><span class="linenum">1614</span></a>              if (<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> &amp;&amp; <a class="function" onClick="logFunction('grade_floats_different')" href="../../_functions/grade_floats_different.html" onMouseOver="funcPopup(event,'grade_floats_different')">grade_floats_different</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a>, <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a>)) {
<a name="l1615"><span class="linenum">1615</span></a>                  \core\event\<a class="class" onClick="logClass('user_graded')" href="../../_classes/user_graded.html" onMouseOver="classPopup(event,'user_graded')">user_graded</a>::<a class="function" onClick="logFunction('create_from_grade')" href="../../_functions/create_from_grade.html" onMouseOver="funcPopup(event,'create_from_grade')">create_from_grade</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1616"><span class="linenum">1616</span></a>              }
<a name="l1617"><span class="linenum">1617</span></a>          } else {
<a name="l1618"><span class="linenum">1618</span></a>  <span class="comment">            // no grade change</span>
<a name="l1619"><span class="linenum">1619</span></a>              return <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l1620"><span class="linenum">1620</span></a>          }
<a name="l1621"><span class="linenum">1621</span></a>  
<a name="l1622"><span class="linenum">1622</span></a>          if (!<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>) {
<a name="l1623"><span class="linenum">1623</span></a>  <span class="comment">            // something went wrong - better force final grade recalculation</span>
<a name="l1624"><span class="linenum">1624</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('force_regrading')" href="../../_functions/force_regrading.html" onMouseOver="funcPopup(event,'force_regrading')">force_regrading</a>();
<a name="l1625"><span class="linenum">1625</span></a>  
<a name="l1626"><span class="linenum">1626</span></a>          } else if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_course_item')" href="../../_functions/is_course_item.html" onMouseOver="funcPopup(event,'is_course_item')">is_course_item</a>() and !<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('needsupdate')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/needsupdate.html">needsupdate</a>) {
<a name="l1627"><span class="linenum">1627</span></a>              if (<a class="function" onClick="logFunction('grade_regrade_final_grades')" href="../../_functions/grade_regrade_final_grades.html" onMouseOver="funcPopup(event,'grade_regrade_final_grades')">grade_regrade_final_grades</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>) !== true) {
<a name="l1628"><span class="linenum">1628</span></a>                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('force_regrading')" href="../../_functions/force_regrading.html" onMouseOver="funcPopup(event,'force_regrading')">force_regrading</a>();
<a name="l1629"><span class="linenum">1629</span></a>              }
<a name="l1630"><span class="linenum">1630</span></a>  
<a name="l1631"><span class="linenum">1631</span></a>          } else if (!<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('needsupdate')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/needsupdate.html">needsupdate</a>) {
<a name="l1632"><span class="linenum">1632</span></a>              <a class="var it10010" onMouseOver="hilite(10010)" onMouseOut="lolite()" onClick="logVariable('course_item')" href="../../_variables/course_item.html">$course_item</a> = <a class="class" onClick="logClass('grade_item')" href="../../_classes/grade_item.html" onMouseOver="classPopup(event,'grade_item')">grade_item</a>::<a class="function" onClick="logFunction('fetch_course_item')" href="../../_functions/fetch_course_item.html" onMouseOver="funcPopup(event,'fetch_course_item')">fetch_course_item</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l1633"><span class="linenum">1633</span></a>              if (!<a class="var it10010" onMouseOver="hilite(10010)" onMouseOut="lolite()" onClick="logVariable('course_item')" href="../../_variables/course_item.html">$course_item</a>-&gt;<a onClick="logVariable('needsupdate')" class="var it39609" onMouseOver="hilite(39609)" onMouseOut="lolite()" href="../../_variables/needsupdate.html">needsupdate</a>) {
<a name="l1634"><span class="linenum">1634</span></a>                  if (<a class="function" onClick="logFunction('grade_regrade_final_grades')" href="../../_functions/grade_regrade_final_grades.html" onMouseOver="funcPopup(event,'grade_regrade_final_grades')">grade_regrade_final_grades</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>) !== true) {
<a name="l1635"><span class="linenum">1635</span></a>                      <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('force_regrading')" href="../../_functions/force_regrading.html" onMouseOver="funcPopup(event,'force_regrading')">force_regrading</a>();
<a name="l1636"><span class="linenum">1636</span></a>                  }
<a name="l1637"><span class="linenum">1637</span></a>              } else {
<a name="l1638"><span class="linenum">1638</span></a>                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('force_regrading')" href="../../_functions/force_regrading.html" onMouseOver="funcPopup(event,'force_regrading')">force_regrading</a>();
<a name="l1639"><span class="linenum">1639</span></a>              }
<a name="l1640"><span class="linenum">1640</span></a>          }
<a name="l1641"><span class="linenum">1641</span></a>  
<a name="l1642"><span class="linenum">1642</span></a>          return <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l1643"><span class="linenum">1643</span></a>      }
<a name="l1644"><span class="linenum">1644</span></a>  
<a name="l1645"><span class="linenum">1645</span></a>  
<a name="l1646"><span class="linenum">1646</span></a>      <span class="comment">/**</span>
<a name="l1647"><span class="linenum">1647</span></a>  <span class="comment">     * Updates raw grade value for given user, this is a only way to update raw</span>
<a name="l1648"><span class="linenum">1648</span></a>  <span class="comment">     * grades from external source (modules, etc.),</span>
<a name="l1649"><span class="linenum">1649</span></a>  <span class="comment">     * because it logs the change in history table and deals with final grade recalculation.</span>
<a name="l1650"><span class="linenum">1650</span></a>  <span class="comment">     *</span>
<a name="l1651"><span class="linenum">1651</span></a>  <span class="comment">     * @param int $userid the graded user</span>
<a name="l1652"><span class="linenum">1652</span></a>  <span class="comment">     * @param mixed $rawgrade float value of raw grade - false means do not change</span>
<a name="l1653"><span class="linenum">1653</span></a>  <span class="comment">     * @param string $source modification source</span>
<a name="l1654"><span class="linenum">1654</span></a>  <span class="comment">     * @param string $feedback optional teacher feedback</span>
<a name="l1655"><span class="linenum">1655</span></a>  <span class="comment">     * @param int $feedbackformat A format like FORMAT_PLAIN or FORMAT_HTML</span>
<a name="l1656"><span class="linenum">1656</span></a>  <span class="comment">     * @param int $usermodified the ID of the user who did the grading</span>
<a name="l1657"><span class="linenum">1657</span></a>  <span class="comment">     * @param int $dategraded A timestamp of when the student's work was graded</span>
<a name="l1658"><span class="linenum">1658</span></a>  <span class="comment">     * @param int $datesubmitted A timestamp of when the student's work was submitted</span>
<a name="l1659"><span class="linenum">1659</span></a>  <span class="comment">     * @param grade_grade $grade A grade object, useful for bulk upgrades</span>
<a name="l1660"><span class="linenum">1660</span></a>  <span class="comment">     * @return bool success</span>
<a name="l1661"><span class="linenum">1661</span></a>  <span class="comment">     */</span>
<a name="l1662"><span class="linenum">1662</span></a>      public function <a class="function" onClick="logFunction('update_raw_grade')" href="../../_functions/update_raw_grade.html" onMouseOver="funcPopup(event,'update_raw_grade')">update_raw_grade</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it4887" onMouseOver="hilite(4887)" onMouseOut="lolite()" onClick="logVariable('rawgrade')" href="../../_variables/rawgrade.html">$rawgrade</a>=false, <a class="var it1344" onMouseOver="hilite(1344)" onMouseOut="lolite()" onClick="logVariable('source')" href="../../_variables/source.html">$source</a>=NULL, <a class="var it714" onMouseOver="hilite(714)" onMouseOut="lolite()" onClick="logVariable('feedback')" href="../../_variables/feedback.html">$feedback</a>=false, <a class="var it2281" onMouseOver="hilite(2281)" onMouseOut="lolite()" onClick="logVariable('feedbackformat')" href="../../_variables/feedbackformat.html">$feedbackformat</a>=<a class="constant" onClick="logConstant('FORMAT_MOODLE')" href="../../_constants/FORMAT_MOODLE.html" onMouseOver="constPopup(event,'FORMAT_MOODLE')">FORMAT_MOODLE</a>, <a class="var it5799" onMouseOver="hilite(5799)" onMouseOut="lolite()" onClick="logVariable('usermodified')" href="../../_variables/usermodified.html">$usermodified</a>=null, <a class="var it7081" onMouseOver="hilite(7081)" onMouseOut="lolite()" onClick="logVariable('dategraded')" href="../../_variables/dategraded.html">$dategraded</a>=null, <a class="var it10026" onMouseOver="hilite(10026)" onMouseOut="lolite()" onClick="logVariable('datesubmitted')" href="../../_variables/datesubmitted.html">$datesubmitted</a>=null, <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>=null) {
<a name="l1663"><span class="linenum">1663</span></a>          global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l1664"><span class="linenum">1664</span></a>  
<a name="l1665"><span class="linenum">1665</span></a>          <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = true;
<a name="l1666"><span class="linenum">1666</span></a>  
<a name="l1667"><span class="linenum">1667</span></a>  <span class="comment">        // calculated grades can not be updated; course and category can not be updated  because they are aggregated</span>
<a name="l1668"><span class="linenum">1668</span></a>          if (!<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_raw_used')" href="../../_functions/is_raw_used.html" onMouseOver="funcPopup(event,'is_raw_used')">is_raw_used</a>() or <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('gradetype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/gradetype.html">gradetype</a> == <a class="constant" onClick="logConstant('GRADE_TYPE_NONE')" href="../../_constants/GRADE_TYPE_NONE.html" onMouseOver="constPopup(event,'GRADE_TYPE_NONE')">GRADE_TYPE_NONE</a> or <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_locked')" href="../../_functions/is_locked.html" onMouseOver="funcPopup(event,'is_locked')">is_locked</a>()) {
<a name="l1669"><span class="linenum">1669</span></a>              return false;
<a name="l1670"><span class="linenum">1670</span></a>          }
<a name="l1671"><span class="linenum">1671</span></a>  
<a name="l1672"><span class="linenum">1672</span></a>          if (<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>)) {
<a name="l1673"><span class="linenum">1673</span></a>  <span class="comment">            //fetch from db</span>
<a name="l1674"><span class="linenum">1674</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = <span class="keyword">new </span><a class="class" onClick="logClass('grade_grade')" href="../../_classes/grade_grade.html" onMouseOver="classPopup(event,'grade_grade')">grade_grade</a>(array('itemid'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid'=&gt;<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>));
<a name="l1675"><span class="linenum">1675</span></a>          }
<a name="l1676"><span class="linenum">1676</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('grade_item')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/grade_item.html">grade_item</a> =&amp; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>; <span class="comment">// prevent db fetching of this grade_item</span>
<a name="l1677"><span class="linenum">1677</span></a>  
<a name="l1678"><span class="linenum">1678</span></a>          if (empty(<a class="var it5799" onMouseOver="hilite(5799)" onMouseOut="lolite()" onClick="logVariable('usermodified')" href="../../_variables/usermodified.html">$usermodified</a>)) {
<a name="l1679"><span class="linenum">1679</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('usermodified')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/usermodified.html">usermodified</a> = <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l1680"><span class="linenum">1680</span></a>          } else {
<a name="l1681"><span class="linenum">1681</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('usermodified')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/usermodified.html">usermodified</a> = <a class="var it5799" onMouseOver="hilite(5799)" onMouseOut="lolite()" onClick="logVariable('usermodified')" href="../../_variables/usermodified.html">$usermodified</a>;
<a name="l1682"><span class="linenum">1682</span></a>          }
<a name="l1683"><span class="linenum">1683</span></a>  
<a name="l1684"><span class="linenum">1684</span></a>          if (<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('is_locked')" href="../../_functions/is_locked.html" onMouseOver="funcPopup(event,'is_locked')">is_locked</a>()) {
<a name="l1685"><span class="linenum">1685</span></a>  <span class="comment">            // do not update locked grades at all</span>
<a name="l1686"><span class="linenum">1686</span></a>              return false;
<a name="l1687"><span class="linenum">1687</span></a>          }
<a name="l1688"><span class="linenum">1688</span></a>  
<a name="l1689"><span class="linenum">1689</span></a>          <a class="var it9479" onMouseOver="hilite(9479)" onMouseOut="lolite()" onClick="logVariable('locktime')" href="../../_variables/locktime.html">$locktime</a> = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('get_locktime')" href="../../_functions/get_locktime.html" onMouseOver="funcPopup(event,'get_locktime')">get_locktime</a>();
<a name="l1690"><span class="linenum">1690</span></a>          if (<a class="var it9479" onMouseOver="hilite(9479)" onMouseOut="lolite()" onClick="logVariable('locktime')" href="../../_variables/locktime.html">$locktime</a> and <a class="var it9479" onMouseOver="hilite(9479)" onMouseOut="lolite()" onClick="logVariable('locktime')" href="../../_variables/locktime.html">$locktime</a> &lt; <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()) {
<a name="l1691"><span class="linenum">1691</span></a>  <span class="comment">            // do not update grades that should be already locked and force regrade</span>
<a name="l1692"><span class="linenum">1692</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('force_regrading')" href="../../_functions/force_regrading.html" onMouseOver="funcPopup(event,'force_regrading')">force_regrading</a>();
<a name="l1693"><span class="linenum">1693</span></a>              return false;
<a name="l1694"><span class="linenum">1694</span></a>          }
<a name="l1695"><span class="linenum">1695</span></a>  
<a name="l1696"><span class="linenum">1696</span></a>          <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a> = new stdClass();
<a name="l1697"><span class="linenum">1697</span></a>          <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a>     = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a>;
<a name="l1698"><span class="linenum">1698</span></a>          <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('rawgrade')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/rawgrade.html">rawgrade</a>       = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawgrade.html">rawgrade</a>;
<a name="l1699"><span class="linenum">1699</span></a>          <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('rawgrademin')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/rawgrademin.html">rawgrademin</a>    = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawgrademin')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawgrademin.html">rawgrademin</a>;
<a name="l1700"><span class="linenum">1700</span></a>          <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('rawgrademax')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/rawgrademax.html">rawgrademax</a>    = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawgrademax')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawgrademax.html">rawgrademax</a>;
<a name="l1701"><span class="linenum">1701</span></a>          <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('rawscaleid')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/rawscaleid.html">rawscaleid</a>     = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawscaleid')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawscaleid.html">rawscaleid</a>;
<a name="l1702"><span class="linenum">1702</span></a>          <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('feedback')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/feedback.html">feedback</a>       = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('feedback')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/feedback.html">feedback</a>;
<a name="l1703"><span class="linenum">1703</span></a>          <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('feedbackformat')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/feedbackformat.html">feedbackformat</a> = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('feedbackformat')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/feedbackformat.html">feedbackformat</a>;
<a name="l1704"><span class="linenum">1704</span></a>  
<a name="l1705"><span class="linenum">1705</span></a>  <span class="comment">        // use new min and max</span>
<a name="l1706"><span class="linenum">1706</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawgrade.html">rawgrade</a>    = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawgrade.html">rawgrade</a>;
<a name="l1707"><span class="linenum">1707</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawgrademin')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawgrademin.html">rawgrademin</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademin')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademin.html">grademin</a>;
<a name="l1708"><span class="linenum">1708</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawgrademax')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawgrademax.html">rawgrademax</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademax')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademax.html">grademax</a>;
<a name="l1709"><span class="linenum">1709</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawscaleid')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawscaleid.html">rawscaleid</a>  = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('scaleid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/scaleid.html">scaleid</a>;
<a name="l1710"><span class="linenum">1710</span></a>  
<a name="l1711"><span class="linenum">1711</span></a>  <span class="comment">        // change raw grade?</span>
<a name="l1712"><span class="linenum">1712</span></a>          if (<a class="var it4887" onMouseOver="hilite(4887)" onMouseOut="lolite()" onClick="logVariable('rawgrade')" href="../../_variables/rawgrade.html">$rawgrade</a> !== false) {
<a name="l1713"><span class="linenum">1713</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawgrade.html">rawgrade</a> = <a class="var it4887" onMouseOver="hilite(4887)" onMouseOut="lolite()" onClick="logVariable('rawgrade')" href="../../_variables/rawgrade.html">$rawgrade</a>;
<a name="l1714"><span class="linenum">1714</span></a>          }
<a name="l1715"><span class="linenum">1715</span></a>  
<a name="l1716"><span class="linenum">1716</span></a>  <span class="comment">        // empty feedback means no feedback at all</span>
<a name="l1717"><span class="linenum">1717</span></a>          if (<a class="var it714" onMouseOver="hilite(714)" onMouseOut="lolite()" onClick="logVariable('feedback')" href="../../_variables/feedback.html">$feedback</a> === '') {
<a name="l1718"><span class="linenum">1718</span></a>              <a class="var it714" onMouseOver="hilite(714)" onMouseOut="lolite()" onClick="logVariable('feedback')" href="../../_variables/feedback.html">$feedback</a> = null;
<a name="l1719"><span class="linenum">1719</span></a>          }
<a name="l1720"><span class="linenum">1720</span></a>  
<a name="l1721"><span class="linenum">1721</span></a>  <span class="comment">        // do we have comment from teacher?</span>
<a name="l1722"><span class="linenum">1722</span></a>          if (<a class="var it714" onMouseOver="hilite(714)" onMouseOut="lolite()" onClick="logVariable('feedback')" href="../../_variables/feedback.html">$feedback</a> !== false and !<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('is_overridden')" href="../../_functions/is_overridden.html" onMouseOver="funcPopup(event,'is_overridden')">is_overridden</a>()) {
<a name="l1723"><span class="linenum">1723</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('feedback')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/feedback.html">feedback</a>       = <a class="var it714" onMouseOver="hilite(714)" onMouseOut="lolite()" onClick="logVariable('feedback')" href="../../_variables/feedback.html">$feedback</a>;
<a name="l1724"><span class="linenum">1724</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('feedbackformat')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/feedbackformat.html">feedbackformat</a> = <a class="var it2281" onMouseOver="hilite(2281)" onMouseOut="lolite()" onClick="logVariable('feedbackformat')" href="../../_variables/feedbackformat.html">$feedbackformat</a>;
<a name="l1725"><span class="linenum">1725</span></a>          }
<a name="l1726"><span class="linenum">1726</span></a>  
<a name="l1727"><span class="linenum">1727</span></a>  <span class="comment">        // update final grade if possible</span>
<a name="l1728"><span class="linenum">1728</span></a>          if (!<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('is_locked')" href="../../_functions/is_locked.html" onMouseOver="funcPopup(event,'is_locked')">is_locked</a>() and !<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('is_overridden')" href="../../_functions/is_overridden.html" onMouseOver="funcPopup(event,'is_overridden')">is_overridden</a>()) {
<a name="l1729"><span class="linenum">1729</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('adjust_raw_grade')" href="../../_functions/adjust_raw_grade.html" onMouseOver="funcPopup(event,'adjust_raw_grade')">adjust_raw_grade</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawgrade.html">rawgrade</a>, <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawgrademin')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawgrademin.html">rawgrademin</a>, <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawgrademax')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawgrademax.html">rawgrademax</a>);
<a name="l1730"><span class="linenum">1730</span></a>          }
<a name="l1731"><span class="linenum">1731</span></a>  
<a name="l1732"><span class="linenum">1732</span></a>  <span class="comment">        // TODO: hack alert - create new fields for these in 2.0</span>
<a name="l1733"><span class="linenum">1733</span></a>          <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('timecreated')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a>  = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('timecreated')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a>;
<a name="l1734"><span class="linenum">1734</span></a>          <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('timemodified')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('timemodified')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a>;
<a name="l1735"><span class="linenum">1735</span></a>  
<a name="l1736"><span class="linenum">1736</span></a>          <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('timecreated')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a> = <a class="var it10026" onMouseOver="hilite(10026)" onMouseOut="lolite()" onClick="logVariable('datesubmitted')" href="../../_variables/datesubmitted.html">$datesubmitted</a>;
<a name="l1737"><span class="linenum">1737</span></a>  
<a name="l1738"><span class="linenum">1738</span></a>          if (<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('is_overridden')" href="../../_functions/is_overridden.html" onMouseOver="funcPopup(event,'is_overridden')">is_overridden</a>()) {
<a name="l1739"><span class="linenum">1739</span></a>  <span class="comment">            // keep original graded date - update_final_grade() sets this for overridden grades</span>
<a name="l1740"><span class="linenum">1740</span></a>  
<a name="l1741"><span class="linenum">1741</span></a>          } else if (<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawgrade.html">rawgrade</a>) and <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('feedback')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/feedback.html">feedback</a>)) {
<a name="l1742"><span class="linenum">1742</span></a>  <span class="comment">            // no grade and feedback means no grading yet</span>
<a name="l1743"><span class="linenum">1743</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('timemodified')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = null;
<a name="l1744"><span class="linenum">1744</span></a>  
<a name="l1745"><span class="linenum">1745</span></a>          } else if (!empty(<a class="var it7081" onMouseOver="hilite(7081)" onMouseOut="lolite()" onClick="logVariable('dategraded')" href="../../_variables/dategraded.html">$dategraded</a>)) {
<a name="l1746"><span class="linenum">1746</span></a>  <span class="comment">            // fine - module sends info when graded (yay!)</span>
<a name="l1747"><span class="linenum">1747</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('timemodified')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="var it7081" onMouseOver="hilite(7081)" onMouseOut="lolite()" onClick="logVariable('dategraded')" href="../../_variables/dategraded.html">$dategraded</a>;
<a name="l1748"><span class="linenum">1748</span></a>  
<a name="l1749"><span class="linenum">1749</span></a>          } else if (<a class="function" onClick="logFunction('grade_floats_different')" href="../../_functions/grade_floats_different.html" onMouseOver="funcPopup(event,'grade_floats_different')">grade_floats_different</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a>, <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a>)
<a name="l1750"><span class="linenum">1750</span></a>                     or <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('feedback')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/feedback.html">feedback</a> !== <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('feedback')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/feedback.html">feedback</a>) {
<a name="l1751"><span class="linenum">1751</span></a>  <span class="comment">            // guess - if either grade or feedback changed set new graded date</span>
<a name="l1752"><span class="linenum">1752</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('timemodified')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1753"><span class="linenum">1753</span></a>  
<a name="l1754"><span class="linenum">1754</span></a>          } else {
<a name="l1755"><span class="linenum">1755</span></a>  <span class="comment">            //keep original graded date</span>
<a name="l1756"><span class="linenum">1756</span></a>          }
<a name="l1757"><span class="linenum">1757</span></a>  <span class="comment">        // end of hack alert</span>
<a name="l1758"><span class="linenum">1758</span></a>  
<a name="l1759"><span class="linenum">1759</span></a>          if (empty(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('id')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l1760"><span class="linenum">1760</span></a>              <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = (bool)<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('insert')" href="../../_functions/insert.html" onMouseOver="funcPopup(event,'insert')">insert</a>(<a class="var it1344" onMouseOver="hilite(1344)" onMouseOut="lolite()" onClick="logVariable('source')" href="../../_variables/source.html">$source</a>);
<a name="l1761"><span class="linenum">1761</span></a>  
<a name="l1762"><span class="linenum">1762</span></a>  <span class="comment">            // If the grade insert was successful and the final grade was not null then trigger a user_graded event.</span>
<a name="l1763"><span class="linenum">1763</span></a>              if (<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> &amp;&amp; !<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a>)) {
<a name="l1764"><span class="linenum">1764</span></a>                  \core\event\<a class="class" onClick="logClass('user_graded')" href="../../_classes/user_graded.html" onMouseOver="classPopup(event,'user_graded')">user_graded</a>::<a class="function" onClick="logFunction('create_from_grade')" href="../../_functions/create_from_grade.html" onMouseOver="funcPopup(event,'create_from_grade')">create_from_grade</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1765"><span class="linenum">1765</span></a>              }
<a name="l1766"><span class="linenum">1766</span></a>          } else if (<a class="function" onClick="logFunction('grade_floats_different')" href="../../_functions/grade_floats_different.html" onMouseOver="funcPopup(event,'grade_floats_different')">grade_floats_different</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a>,  <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a>)
<a name="l1767"><span class="linenum">1767</span></a>                  or <a class="function" onClick="logFunction('grade_floats_different')" href="../../_functions/grade_floats_different.html" onMouseOver="funcPopup(event,'grade_floats_different')">grade_floats_different</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawgrade.html">rawgrade</a>,    <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('rawgrade')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/rawgrade.html">rawgrade</a>)
<a name="l1768"><span class="linenum">1768</span></a>                  or <a class="function" onClick="logFunction('grade_floats_different')" href="../../_functions/grade_floats_different.html" onMouseOver="funcPopup(event,'grade_floats_different')">grade_floats_different</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawgrademin')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawgrademin.html">rawgrademin</a>, <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('rawgrademin')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/rawgrademin.html">rawgrademin</a>)
<a name="l1769"><span class="linenum">1769</span></a>                  or <a class="function" onClick="logFunction('grade_floats_different')" href="../../_functions/grade_floats_different.html" onMouseOver="funcPopup(event,'grade_floats_different')">grade_floats_different</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawgrademax')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawgrademax.html">rawgrademax</a>, <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('rawgrademax')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/rawgrademax.html">rawgrademax</a>)
<a name="l1770"><span class="linenum">1770</span></a>                  or <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('rawscaleid')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/rawscaleid.html">rawscaleid</a>     != <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;rawscaleid
<a name="l1771"><span class="linenum">1771</span></a>                  or <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('feedback')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/feedback.html">feedback</a>       !== <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;feedback
<a name="l1772"><span class="linenum">1772</span></a>                  or <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('feedbackformat')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/feedbackformat.html">feedbackformat</a> != <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;feedbackformat
<a name="l1773"><span class="linenum">1773</span></a>                  or <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('timecreated')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a>    != <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('timecreated')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a>  // part of hack above
<a name="l1774"><span class="linenum">1774</span></a>                  or <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('timemodified')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a>   != <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('timemodified')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> // part of hack above
<a name="l1775"><span class="linenum">1775</span></a>                  ) {
<a name="l1776"><span class="linenum">1776</span></a>              <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>(<a class="var it1344" onMouseOver="hilite(1344)" onMouseOut="lolite()" onClick="logVariable('source')" href="../../_variables/source.html">$source</a>);
<a name="l1777"><span class="linenum">1777</span></a>  
<a name="l1778"><span class="linenum">1778</span></a>  <span class="comment">            // If the grade update was successful and the actual grade has changed then trigger a user_graded event.</span>
<a name="l1779"><span class="linenum">1779</span></a>              if (<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> &amp;&amp; <a class="function" onClick="logFunction('grade_floats_different')" href="../../_functions/grade_floats_different.html" onMouseOver="funcPopup(event,'grade_floats_different')">grade_floats_different</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a>, <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a>)) {
<a name="l1780"><span class="linenum">1780</span></a>                  \core\event\<a class="class" onClick="logClass('user_graded')" href="../../_classes/user_graded.html" onMouseOver="classPopup(event,'user_graded')">user_graded</a>::<a class="function" onClick="logFunction('create_from_grade')" href="../../_functions/create_from_grade.html" onMouseOver="funcPopup(event,'create_from_grade')">create_from_grade</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1781"><span class="linenum">1781</span></a>              }
<a name="l1782"><span class="linenum">1782</span></a>          } else {
<a name="l1783"><span class="linenum">1783</span></a>              return <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l1784"><span class="linenum">1784</span></a>          }
<a name="l1785"><span class="linenum">1785</span></a>  
<a name="l1786"><span class="linenum">1786</span></a>          if (!<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>) {
<a name="l1787"><span class="linenum">1787</span></a>  <span class="comment">            // something went wrong - better force final grade recalculation</span>
<a name="l1788"><span class="linenum">1788</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('force_regrading')" href="../../_functions/force_regrading.html" onMouseOver="funcPopup(event,'force_regrading')">force_regrading</a>();
<a name="l1789"><span class="linenum">1789</span></a>  
<a name="l1790"><span class="linenum">1790</span></a>          } else if (!<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('needsupdate')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/needsupdate.html">needsupdate</a>) {
<a name="l1791"><span class="linenum">1791</span></a>              <a class="var it10010" onMouseOver="hilite(10010)" onMouseOut="lolite()" onClick="logVariable('course_item')" href="../../_variables/course_item.html">$course_item</a> = <a class="class" onClick="logClass('grade_item')" href="../../_classes/grade_item.html" onMouseOver="classPopup(event,'grade_item')">grade_item</a>::<a class="function" onClick="logFunction('fetch_course_item')" href="../../_functions/fetch_course_item.html" onMouseOver="funcPopup(event,'fetch_course_item')">fetch_course_item</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l1792"><span class="linenum">1792</span></a>              if (!<a class="var it10010" onMouseOver="hilite(10010)" onMouseOut="lolite()" onClick="logVariable('course_item')" href="../../_variables/course_item.html">$course_item</a>-&gt;<a onClick="logVariable('needsupdate')" class="var it39609" onMouseOver="hilite(39609)" onMouseOut="lolite()" href="../../_variables/needsupdate.html">needsupdate</a>) {
<a name="l1793"><span class="linenum">1793</span></a>                  if (<a class="function" onClick="logFunction('grade_regrade_final_grades')" href="../../_functions/grade_regrade_final_grades.html" onMouseOver="funcPopup(event,'grade_regrade_final_grades')">grade_regrade_final_grades</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>) !== true) {
<a name="l1794"><span class="linenum">1794</span></a>                      <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('force_regrading')" href="../../_functions/force_regrading.html" onMouseOver="funcPopup(event,'force_regrading')">force_regrading</a>();
<a name="l1795"><span class="linenum">1795</span></a>                  }
<a name="l1796"><span class="linenum">1796</span></a>              }
<a name="l1797"><span class="linenum">1797</span></a>          }
<a name="l1798"><span class="linenum">1798</span></a>  
<a name="l1799"><span class="linenum">1799</span></a>          return <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l1800"><span class="linenum">1800</span></a>      }
<a name="l1801"><span class="linenum">1801</span></a>  
<a name="l1802"><span class="linenum">1802</span></a>      <span class="comment">/**</span>
<a name="l1803"><span class="linenum">1803</span></a>  <span class="comment">     * Calculates final grade values using the formula in the calculation property.</span>
<a name="l1804"><span class="linenum">1804</span></a>  <span class="comment">     * The parameters are taken from final grades of grade items in current course only.</span>
<a name="l1805"><span class="linenum">1805</span></a>  <span class="comment">     *</span>
<a name="l1806"><span class="linenum">1806</span></a>  <span class="comment">     * @param int $userid Supply a user ID to limit the calculations to the grades of a single user</span>
<a name="l1807"><span class="linenum">1807</span></a>  <span class="comment">     * @return bool false if error</span>
<a name="l1808"><span class="linenum">1808</span></a>  <span class="comment">     */</span>
<a name="l1809"><span class="linenum">1809</span></a>      public function <a class="function" onClick="logFunction('compute')" href="../../_functions/compute.html" onMouseOver="funcPopup(event,'compute')">compute</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>=null) {
<a name="l1810"><span class="linenum">1810</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1811"><span class="linenum">1811</span></a>  
<a name="l1812"><span class="linenum">1812</span></a>          if (!<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_calculated')" href="../../_functions/is_calculated.html" onMouseOver="funcPopup(event,'is_calculated')">is_calculated</a>()) {
<a name="l1813"><span class="linenum">1813</span></a>              return false;
<a name="l1814"><span class="linenum">1814</span></a>          }
<a name="l1815"><span class="linenum">1815</span></a>  
<a name="l1816"><span class="linenum">1816</span></a>          require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/mathslib.php');
<a name="l1817"><span class="linenum">1817</span></a>  
<a name="l1818"><span class="linenum">1818</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_locked')" href="../../_functions/is_locked.html" onMouseOver="funcPopup(event,'is_locked')">is_locked</a>()) {
<a name="l1819"><span class="linenum">1819</span></a>              return true; <span class="comment">// no need to recalculate locked items</span>
<a name="l1820"><span class="linenum">1820</span></a>          }
<a name="l1821"><span class="linenum">1821</span></a>  
<a name="l1822"><span class="linenum">1822</span></a>  <span class="comment">        // Precreate grades - we need them to exist</span>
<a name="l1823"><span class="linenum">1823</span></a>          if (<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) {
<a name="l1824"><span class="linenum">1824</span></a>              <a class="var it10027" onMouseOver="hilite(10027)" onMouseOut="lolite()" onClick="logVariable('missing')" href="../../_variables/missing.html">$missing</a> = array();
<a name="l1825"><span class="linenum">1825</span></a>              if (!<a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('grade_grades', array('itemid'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid'=&gt;<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>))) {
<a name="l1826"><span class="linenum">1826</span></a>                  <a class="var it1752" onMouseOver="hilite(1752)" onMouseOut="lolite()" onClick="logVariable('m')" href="../../_variables/m.html">$m</a> = new stdClass();
<a name="l1827"><span class="linenum">1827</span></a>                  <a class="var it1752" onMouseOver="hilite(1752)" onMouseOut="lolite()" onClick="logVariable('m')" href="../../_variables/m.html">$m</a>-&gt;<a onClick="logVariable('userid')" class="var it40071" onMouseOver="hilite(40071)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> = <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>;
<a name="l1828"><span class="linenum">1828</span></a>                  <a class="var it10027" onMouseOver="hilite(10027)" onMouseOut="lolite()" onClick="logVariable('missing')" href="../../_variables/missing.html">$missing</a>[] = <a class="var it1752" onMouseOver="hilite(1752)" onMouseOut="lolite()" onClick="logVariable('m')" href="../../_variables/m.html">$m</a>;
<a name="l1829"><span class="linenum">1829</span></a>              }
<a name="l1830"><span class="linenum">1830</span></a>          } else {
<a name="l1831"><span class="linenum">1831</span></a>  <span class="comment">            // Find any users who have grades for some but not all grade items in this course</span>
<a name="l1832"><span class="linenum">1832</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('gicourseid' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>, 'ggitemid' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1833"><span class="linenum">1833</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT gg.userid
<a name="l1834"><span class="linenum">1834</span></a>                        FROM {grade_grades} gg
<a name="l1835"><span class="linenum">1835</span></a>                             JOIN {grade_items} gi
<a name="l1836"><span class="linenum">1836</span></a>                             <a class="function" onClick="logFunction('ON')" href="../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (gi.id = gg.itemid AND gi.courseid = :gicourseid)
<a name="l1837"><span class="linenum">1837</span></a>                       GROUP BY gg.userid
<a name="l1838"><span class="linenum">1838</span></a>                       HAVING <a class="function" onClick="logFunction('SUM')" href="../../_functions/sum.html" onMouseOver="funcPopup(event,'sum')">SUM</a>(CASE WHEN gg.itemid = :ggitemid THEN 1 ELSE 0 END) = 0&quot;;
<a name="l1839"><span class="linenum">1839</span></a>              <a class="var it10027" onMouseOver="hilite(10027)" onMouseOut="lolite()" onClick="logVariable('missing')" href="../../_variables/missing.html">$missing</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l1840"><span class="linenum">1840</span></a>          }
<a name="l1841"><span class="linenum">1841</span></a>  
<a name="l1842"><span class="linenum">1842</span></a>          if (<a class="var it10027" onMouseOver="hilite(10027)" onMouseOut="lolite()" onClick="logVariable('missing')" href="../../_variables/missing.html">$missing</a>) {
<a name="l1843"><span class="linenum">1843</span></a>              foreach (<a class="var it10027" onMouseOver="hilite(10027)" onMouseOut="lolite()" onClick="logVariable('missing')" href="../../_variables/missing.html">$missing</a> as <a class="var it1752" onMouseOver="hilite(1752)" onMouseOut="lolite()" onClick="logVariable('m')" href="../../_variables/m.html">$m</a>) {
<a name="l1844"><span class="linenum">1844</span></a>                  <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = <span class="keyword">new </span><a class="class" onClick="logClass('grade_grade')" href="../../_classes/grade_grade.html" onMouseOver="classPopup(event,'grade_grade')">grade_grade</a>(array('itemid'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid'=&gt;<a class="var it1752" onMouseOver="hilite(1752)" onMouseOut="lolite()" onClick="logVariable('m')" href="../../_variables/m.html">$m</a>-&gt;<a onClick="logVariable('userid')" class="var it40071" onMouseOver="hilite(40071)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>), false);
<a name="l1845"><span class="linenum">1845</span></a>                  <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('grade_item')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/grade_item.html">grade_item</a> =&amp; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>;
<a name="l1846"><span class="linenum">1846</span></a>                  <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('insert')" href="../../_functions/insert.html" onMouseOver="funcPopup(event,'insert')">insert</a>('system');
<a name="l1847"><span class="linenum">1847</span></a>              }
<a name="l1848"><span class="linenum">1848</span></a>          }
<a name="l1849"><span class="linenum">1849</span></a>  
<a name="l1850"><span class="linenum">1850</span></a>  <span class="comment">        // get used items</span>
<a name="l1851"><span class="linenum">1851</span></a>          <a class="var it10028" onMouseOver="hilite(10028)" onMouseOut="lolite()" onClick="logVariable('useditems')" href="../../_variables/useditems.html">$useditems</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('depends_on')" href="../../_functions/depends_on.html" onMouseOver="funcPopup(event,'depends_on')">depends_on</a>();
<a name="l1852"><span class="linenum">1852</span></a>  
<a name="l1853"><span class="linenum">1853</span></a>  <span class="comment">        // prepare formula and init maths library</span>
<a name="l1854"><span class="linenum">1854</span></a>          <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a> = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>('/##(gi\d+)##/', '\1', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('calculation')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/calculation.html">calculation</a>);
<a name="l1855"><span class="linenum">1855</span></a>          if (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a>, '[[') !== false) {
<a name="l1856"><span class="linenum">1856</span></a>  <span class="comment">            // missing item</span>
<a name="l1857"><span class="linenum">1857</span></a>              return false;
<a name="l1858"><span class="linenum">1858</span></a>          }
<a name="l1859"><span class="linenum">1859</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('formula')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/formula.html">formula</a> = <span class="keyword">new </span><a class="class" onClick="logClass('calc_formula')" href="../../_classes/calc_formula.html" onMouseOver="classPopup(event,'calc_formula')">calc_formula</a>(<a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a>);
<a name="l1860"><span class="linenum">1860</span></a>  
<a name="l1861"><span class="linenum">1861</span></a>  <span class="comment">        // where to look for final grades?</span>
<a name="l1862"><span class="linenum">1862</span></a>  <span class="comment">        // this itemid is added so that we use only one query for source and final grades</span>
<a name="l1863"><span class="linenum">1863</span></a>          <a class="var it10029" onMouseOver="hilite(10029)" onMouseOut="lolite()" onClick="logVariable('gis')" href="../../_variables/gis.html">$gis</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it10028" onMouseOver="hilite(10028)" onMouseOut="lolite()" onClick="logVariable('useditems')" href="../../_variables/useditems.html">$useditems</a>, array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l1864"><span class="linenum">1864</span></a>          <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it2909" onMouseOver="hilite(2909)" onMouseOut="lolite()" onClick="logVariable('usql')" href="../../_variables/usql.html">$usql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it10029" onMouseOver="hilite(10029)" onMouseOut="lolite()" onClick="logVariable('gis')" href="../../_variables/gis.html">$gis</a>);
<a name="l1865"><span class="linenum">1865</span></a>  
<a name="l1866"><span class="linenum">1866</span></a>          if (<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) {
<a name="l1867"><span class="linenum">1867</span></a>              <a class="var it2971" onMouseOver="hilite(2971)" onMouseOut="lolite()" onClick="logVariable('usersql')" href="../../_variables/usersql.html">$usersql</a> = &quot;AND g.userid=?&quot;;
<a name="l1868"><span class="linenum">1868</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>;
<a name="l1869"><span class="linenum">1869</span></a>          } else {
<a name="l1870"><span class="linenum">1870</span></a>              <a class="var it2971" onMouseOver="hilite(2971)" onMouseOut="lolite()" onClick="logVariable('usersql')" href="../../_variables/usersql.html">$usersql</a> = &quot;&quot;;
<a name="l1871"><span class="linenum">1871</span></a>          }
<a name="l1872"><span class="linenum">1872</span></a>  
<a name="l1873"><span class="linenum">1873</span></a>          <a class="var it10004" onMouseOver="hilite(10004)" onMouseOut="lolite()" onClick="logVariable('grade_inst')" href="../../_variables/grade_inst.html">$grade_inst</a> = <span class="keyword">new </span><a class="class" onClick="logClass('grade_grade')" href="../../_classes/grade_grade.html" onMouseOver="classPopup(event,'grade_grade')">grade_grade</a>();
<a name="l1874"><span class="linenum">1874</span></a>          <a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a> = 'g.'.<a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',g.', <a class="var it10004" onMouseOver="hilite(10004)" onMouseOut="lolite()" onClick="logVariable('grade_inst')" href="../../_variables/grade_inst.html">$grade_inst</a>-&gt;<a onClick="logVariable('required_fields')" class="var it40061" onMouseOver="hilite(40061)" onMouseOut="lolite()" href="../../_variables/required_fields.html">required_fields</a>);
<a name="l1875"><span class="linenum">1875</span></a>  
<a name="l1876"><span class="linenum">1876</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>;
<a name="l1877"><span class="linenum">1877</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT <a class="var it399" onMouseOver="hilite(399)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a>
<a name="l1878"><span class="linenum">1878</span></a>                    FROM {grade_grades} g, {grade_items} gi
<a name="l1879"><span class="linenum">1879</span></a>                   WHERE gi.id = g.itemid AND gi.id <a class="var it2909" onMouseOver="hilite(2909)" onMouseOut="lolite()" onClick="logVariable('usql')" href="../../_variables/usql.html">$usql</a> <a class="var it2971" onMouseOver="hilite(2971)" onMouseOut="lolite()" onClick="logVariable('usersql')" href="../../_variables/usersql.html">$usersql</a> AND gi.courseid=?
<a name="l1880"><span class="linenum">1880</span></a>                   ORDER BY g.userid&quot;;
<a name="l1881"><span class="linenum">1881</span></a>  
<a name="l1882"><span class="linenum">1882</span></a>          <a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a> = true;
<a name="l1883"><span class="linenum">1883</span></a>  
<a name="l1884"><span class="linenum">1884</span></a>  <span class="comment">        // group the grades by userid and use formula on the group</span>
<a name="l1885"><span class="linenum">1885</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l1886"><span class="linenum">1886</span></a>          if (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('valid')" href="../../_functions/valid.html" onMouseOver="funcPopup(event,'valid')">valid</a>()) {
<a name="l1887"><span class="linenum">1887</span></a>              <a class="var it10030" onMouseOver="hilite(10030)" onMouseOut="lolite()" onClick="logVariable('prevuser')" href="../../_variables/prevuser.html">$prevuser</a> = 0;
<a name="l1888"><span class="linenum">1888</span></a>              <a class="var it10031" onMouseOver="hilite(10031)" onMouseOut="lolite()" onClick="logVariable('grade_records')" href="../../_variables/grade_records.html">$grade_records</a>   = array();
<a name="l1889"><span class="linenum">1889</span></a>              <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>    = null;
<a name="l1890"><span class="linenum">1890</span></a>              foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it4449" onMouseOver="hilite(4449)" onMouseOut="lolite()" onClick="logVariable('used')" href="../../_variables/used.html">$used</a>) {
<a name="l1891"><span class="linenum">1891</span></a>                  if (<a class="var it4449" onMouseOver="hilite(4449)" onMouseOut="lolite()" onClick="logVariable('used')" href="../../_variables/used.html">$used</a>-&gt;<a onClick="logVariable('userid')" class="var it40062" onMouseOver="hilite(40062)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> != <a class="var it10030" onMouseOver="hilite(10030)" onMouseOut="lolite()" onClick="logVariable('prevuser')" href="../../_variables/prevuser.html">$prevuser</a>) {
<a name="l1892"><span class="linenum">1892</span></a>                      if (!<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('use_formula')" href="../../_functions/use_formula.html" onMouseOver="funcPopup(event,'use_formula')">use_formula</a>(<a class="var it10030" onMouseOver="hilite(10030)" onMouseOut="lolite()" onClick="logVariable('prevuser')" href="../../_variables/prevuser.html">$prevuser</a>, <a class="var it10031" onMouseOver="hilite(10031)" onMouseOut="lolite()" onClick="logVariable('grade_records')" href="../../_variables/grade_records.html">$grade_records</a>, <a class="var it10028" onMouseOver="hilite(10028)" onMouseOut="lolite()" onClick="logVariable('useditems')" href="../../_variables/useditems.html">$useditems</a>, <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>)) {
<a name="l1893"><span class="linenum">1893</span></a>                          <a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a> = false;
<a name="l1894"><span class="linenum">1894</span></a>                      }
<a name="l1895"><span class="linenum">1895</span></a>                      <a class="var it10030" onMouseOver="hilite(10030)" onMouseOut="lolite()" onClick="logVariable('prevuser')" href="../../_variables/prevuser.html">$prevuser</a> = <a class="var it4449" onMouseOver="hilite(4449)" onMouseOut="lolite()" onClick="logVariable('used')" href="../../_variables/used.html">$used</a>-&gt;<a onClick="logVariable('userid')" class="var it40062" onMouseOver="hilite(40062)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>;
<a name="l1896"><span class="linenum">1896</span></a>                      <a class="var it10031" onMouseOver="hilite(10031)" onMouseOut="lolite()" onClick="logVariable('grade_records')" href="../../_variables/grade_records.html">$grade_records</a>   = array();
<a name="l1897"><span class="linenum">1897</span></a>                      <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>    = null;
<a name="l1898"><span class="linenum">1898</span></a>                  }
<a name="l1899"><span class="linenum">1899</span></a>                  if (<a class="var it4449" onMouseOver="hilite(4449)" onMouseOut="lolite()" onClick="logVariable('used')" href="../../_variables/used.html">$used</a>-&gt;<a onClick="logVariable('itemid')" class="var it40062" onMouseOver="hilite(40062)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a> == <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) {
<a name="l1900"><span class="linenum">1900</span></a>                      <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a> = <a class="var it4449" onMouseOver="hilite(4449)" onMouseOut="lolite()" onClick="logVariable('used')" href="../../_variables/used.html">$used</a>;
<a name="l1901"><span class="linenum">1901</span></a>                  }
<a name="l1902"><span class="linenum">1902</span></a>                  <a class="var it10031" onMouseOver="hilite(10031)" onMouseOut="lolite()" onClick="logVariable('grade_records')" href="../../_variables/grade_records.html">$grade_records</a>['gi'.<a class="var it4449" onMouseOver="hilite(4449)" onMouseOut="lolite()" onClick="logVariable('used')" href="../../_variables/used.html">$used</a>-&gt;<a onClick="logVariable('itemid')" class="var it40062" onMouseOver="hilite(40062)" onMouseOut="lolite()" href="../../_variables/itemid.html">itemid</a>] = <a class="var it4449" onMouseOver="hilite(4449)" onMouseOut="lolite()" onClick="logVariable('used')" href="../../_variables/used.html">$used</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it40062" onMouseOver="hilite(40062)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a>;
<a name="l1903"><span class="linenum">1903</span></a>              }
<a name="l1904"><span class="linenum">1904</span></a>              if (!<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('use_formula')" href="../../_functions/use_formula.html" onMouseOver="funcPopup(event,'use_formula')">use_formula</a>(<a class="var it10030" onMouseOver="hilite(10030)" onMouseOut="lolite()" onClick="logVariable('prevuser')" href="../../_variables/prevuser.html">$prevuser</a>, <a class="var it10031" onMouseOver="hilite(10031)" onMouseOut="lolite()" onClick="logVariable('grade_records')" href="../../_variables/grade_records.html">$grade_records</a>, <a class="var it10028" onMouseOver="hilite(10028)" onMouseOut="lolite()" onClick="logVariable('useditems')" href="../../_variables/useditems.html">$useditems</a>, <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>)) {
<a name="l1905"><span class="linenum">1905</span></a>                  <a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a> = false;
<a name="l1906"><span class="linenum">1906</span></a>              }
<a name="l1907"><span class="linenum">1907</span></a>          }
<a name="l1908"><span class="linenum">1908</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l1909"><span class="linenum">1909</span></a>  
<a name="l1910"><span class="linenum">1910</span></a>          return <a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../../_variables/return.html">$return</a>;
<a name="l1911"><span class="linenum">1911</span></a>      }
<a name="l1912"><span class="linenum">1912</span></a>  
<a name="l1913"><span class="linenum">1913</span></a>      <span class="comment">/**</span>
<a name="l1914"><span class="linenum">1914</span></a>  <span class="comment">     * Internal function that does the final grade calculation</span>
<a name="l1915"><span class="linenum">1915</span></a>  <span class="comment">     *</span>
<a name="l1916"><span class="linenum">1916</span></a>  <span class="comment">     * @param int $userid The user ID</span>
<a name="l1917"><span class="linenum">1917</span></a>  <span class="comment">     * @param array $params An array of grade items of the form {'gi'.$itemid]} =&gt; $finalgrade</span>
<a name="l1918"><span class="linenum">1918</span></a>  <span class="comment">     * @param array $useditems An array of grade item IDs that this grade item depends on plus its own ID</span>
<a name="l1919"><span class="linenum">1919</span></a>  <span class="comment">     * @param grade_grade $oldgrade A grade_grade instance containing the old values from the database</span>
<a name="l1920"><span class="linenum">1920</span></a>  <span class="comment">     * @return bool False if an error occurred</span>
<a name="l1921"><span class="linenum">1921</span></a>  <span class="comment">     */</span>
<a name="l1922"><span class="linenum">1922</span></a>      public function <a class="function" onClick="logFunction('use_formula')" href="../../_functions/use_formula.html" onMouseOver="funcPopup(event,'use_formula')">use_formula</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, <a class="var it10028" onMouseOver="hilite(10028)" onMouseOut="lolite()" onClick="logVariable('useditems')" href="../../_variables/useditems.html">$useditems</a>, <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>) {
<a name="l1923"><span class="linenum">1923</span></a>          if (empty(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>)) {
<a name="l1924"><span class="linenum">1924</span></a>              return true;
<a name="l1925"><span class="linenum">1925</span></a>          }
<a name="l1926"><span class="linenum">1926</span></a>  
<a name="l1927"><span class="linenum">1927</span></a>  <span class="comment">        // add missing final grade values</span>
<a name="l1928"><span class="linenum">1928</span></a>  <span class="comment">        // not graded (null) is counted as 0 - the spreadsheet way</span>
<a name="l1929"><span class="linenum">1929</span></a>          <a class="var it10032" onMouseOver="hilite(10032)" onMouseOut="lolite()" onClick="logVariable('allinputsnull')" href="../../_variables/allinputsnull.html">$allinputsnull</a> = true;
<a name="l1930"><span class="linenum">1930</span></a>          foreach(<a class="var it10028" onMouseOver="hilite(10028)" onMouseOut="lolite()" onClick="logVariable('useditems')" href="../../_variables/useditems.html">$useditems</a> as <a class="var it10033" onMouseOver="hilite(10033)" onMouseOut="lolite()" onClick="logVariable('gi')" href="../../_variables/gi.html">$gi</a>) {
<a name="l1931"><span class="linenum">1931</span></a>              if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>('gi'.<a class="var it10033" onMouseOver="hilite(10033)" onMouseOut="lolite()" onClick="logVariable('gi')" href="../../_variables/gi.html">$gi</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>) || <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['gi'.<a class="var it10033" onMouseOver="hilite(10033)" onMouseOut="lolite()" onClick="logVariable('gi')" href="../../_variables/gi.html">$gi</a>])) {
<a name="l1932"><span class="linenum">1932</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['gi'.<a class="var it10033" onMouseOver="hilite(10033)" onMouseOut="lolite()" onClick="logVariable('gi')" href="../../_variables/gi.html">$gi</a>] = 0;
<a name="l1933"><span class="linenum">1933</span></a>              } else {
<a name="l1934"><span class="linenum">1934</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['gi'.<a class="var it10033" onMouseOver="hilite(10033)" onMouseOut="lolite()" onClick="logVariable('gi')" href="../../_variables/gi.html">$gi</a>] = (float)<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['gi'.<a class="var it10033" onMouseOver="hilite(10033)" onMouseOut="lolite()" onClick="logVariable('gi')" href="../../_variables/gi.html">$gi</a>];
<a name="l1935"><span class="linenum">1935</span></a>                  if (<a class="var it10033" onMouseOver="hilite(10033)" onMouseOut="lolite()" onClick="logVariable('gi')" href="../../_variables/gi.html">$gi</a> != <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>) {
<a name="l1936"><span class="linenum">1936</span></a>                      <a class="var it10032" onMouseOver="hilite(10032)" onMouseOut="lolite()" onClick="logVariable('allinputsnull')" href="../../_variables/allinputsnull.html">$allinputsnull</a> = false;
<a name="l1937"><span class="linenum">1937</span></a>                  }
<a name="l1938"><span class="linenum">1938</span></a>              }
<a name="l1939"><span class="linenum">1939</span></a>          }
<a name="l1940"><span class="linenum">1940</span></a>  
<a name="l1941"><span class="linenum">1941</span></a>  <span class="comment">        // can not use own final grade during calculation</span>
<a name="l1942"><span class="linenum">1942</span></a>          unset(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['gi'.<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>]);
<a name="l1943"><span class="linenum">1943</span></a>  
<a name="l1944"><span class="linenum">1944</span></a>  <span class="comment">        // insert final grade - will be needed later anyway</span>
<a name="l1945"><span class="linenum">1945</span></a>          if (<a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>) {
<a name="l1946"><span class="linenum">1946</span></a>              <a class="var it10034" onMouseOver="hilite(10034)" onMouseOut="lolite()" onClick="logVariable('oldfinalgrade')" href="../../_variables/oldfinalgrade.html">$oldfinalgrade</a> = <a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it40063" onMouseOver="hilite(40063)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a>;
<a name="l1947"><span class="linenum">1947</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = <span class="keyword">new </span><a class="class" onClick="logClass('grade_grade')" href="../../_classes/grade_grade.html" onMouseOver="classPopup(event,'grade_grade')">grade_grade</a>(<a class="var it9477" onMouseOver="hilite(9477)" onMouseOut="lolite()" onClick="logVariable('oldgrade')" href="../../_variables/oldgrade.html">$oldgrade</a>, false); <span class="comment">// fetching from db is not needed</span>
<a name="l1948"><span class="linenum">1948</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('grade_item')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/grade_item.html">grade_item</a> =&amp; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>;
<a name="l1949"><span class="linenum">1949</span></a>  
<a name="l1950"><span class="linenum">1950</span></a>          } else {
<a name="l1951"><span class="linenum">1951</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = <span class="keyword">new </span><a class="class" onClick="logClass('grade_grade')" href="../../_classes/grade_grade.html" onMouseOver="classPopup(event,'grade_grade')">grade_grade</a>(array('itemid'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'userid'=&gt;<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>), false);
<a name="l1952"><span class="linenum">1952</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('grade_item')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/grade_item.html">grade_item</a> =&amp; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>;
<a name="l1953"><span class="linenum">1953</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('insert')" href="../../_functions/insert.html" onMouseOver="funcPopup(event,'insert')">insert</a>('system');
<a name="l1954"><span class="linenum">1954</span></a>              <a class="var it10034" onMouseOver="hilite(10034)" onMouseOut="lolite()" onClick="logVariable('oldfinalgrade')" href="../../_variables/oldfinalgrade.html">$oldfinalgrade</a> = null;
<a name="l1955"><span class="linenum">1955</span></a>          }
<a name="l1956"><span class="linenum">1956</span></a>  
<a name="l1957"><span class="linenum">1957</span></a>  <span class="comment">        // no need to recalculate locked or overridden grades</span>
<a name="l1958"><span class="linenum">1958</span></a>          if (<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('is_locked')" href="../../_functions/is_locked.html" onMouseOver="funcPopup(event,'is_locked')">is_locked</a>() or <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('is_overridden')" href="../../_functions/is_overridden.html" onMouseOver="funcPopup(event,'is_overridden')">is_overridden</a>()) {
<a name="l1959"><span class="linenum">1959</span></a>              return true;
<a name="l1960"><span class="linenum">1960</span></a>          }
<a name="l1961"><span class="linenum">1961</span></a>  
<a name="l1962"><span class="linenum">1962</span></a>          if (<a class="var it10032" onMouseOver="hilite(10032)" onMouseOut="lolite()" onClick="logVariable('allinputsnull')" href="../../_variables/allinputsnull.html">$allinputsnull</a>) {
<a name="l1963"><span class="linenum">1963</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a> = null;
<a name="l1964"><span class="linenum">1964</span></a>              <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = true;
<a name="l1965"><span class="linenum">1965</span></a>  
<a name="l1966"><span class="linenum">1966</span></a>          } else {
<a name="l1967"><span class="linenum">1967</span></a>  
<a name="l1968"><span class="linenum">1968</span></a>  <span class="comment">            // do the calculation</span>
<a name="l1969"><span class="linenum">1969</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('formula')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/formula.html">formula</a>-&gt;<a class="function" onClick="logFunction('set_params')" href="../../_functions/set_params.html" onMouseOver="funcPopup(event,'set_params')">set_params</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l1970"><span class="linenum">1970</span></a>              <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('formula')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/formula.html">formula</a>-&gt;<a class="function" onClick="logFunction('evaluate')" href="../../_functions/evaluate.html" onMouseOver="funcPopup(event,'evaluate')">evaluate</a>();
<a name="l1971"><span class="linenum">1971</span></a>  
<a name="l1972"><span class="linenum">1972</span></a>              if (<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> === false) {
<a name="l1973"><span class="linenum">1973</span></a>                  <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a> = null;
<a name="l1974"><span class="linenum">1974</span></a>  
<a name="l1975"><span class="linenum">1975</span></a>              } else {
<a name="l1976"><span class="linenum">1976</span></a>  <span class="comment">                // normalize</span>
<a name="l1977"><span class="linenum">1977</span></a>                  <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('bounded_grade')" href="../../_functions/bounded_grade.html" onMouseOver="funcPopup(event,'bounded_grade')">bounded_grade</a>(<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>);
<a name="l1978"><span class="linenum">1978</span></a>              }
<a name="l1979"><span class="linenum">1979</span></a>  
<a name="l1980"><span class="linenum">1980</span></a>          }
<a name="l1981"><span class="linenum">1981</span></a>  
<a name="l1982"><span class="linenum">1982</span></a>  <span class="comment">        // update in db if changed</span>
<a name="l1983"><span class="linenum">1983</span></a>          if (<a class="function" onClick="logFunction('grade_floats_different')" href="../../_functions/grade_floats_different.html" onMouseOver="funcPopup(event,'grade_floats_different')">grade_floats_different</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('finalgrade')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/finalgrade.html">finalgrade</a>, <a class="var it10034" onMouseOver="hilite(10034)" onMouseOut="lolite()" onClick="logVariable('oldfinalgrade')" href="../../_variables/oldfinalgrade.html">$oldfinalgrade</a>)) {
<a name="l1984"><span class="linenum">1984</span></a>              <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a onClick="logVariable('timemodified')" class="var it39944" onMouseOver="hilite(39944)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l1985"><span class="linenum">1985</span></a>              <a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a> = <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>('compute');
<a name="l1986"><span class="linenum">1986</span></a>  
<a name="l1987"><span class="linenum">1987</span></a>  <span class="comment">            // If successful trigger a user_graded event.</span>
<a name="l1988"><span class="linenum">1988</span></a>              if (<a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a>) {
<a name="l1989"><span class="linenum">1989</span></a>                  \core\event\<a class="class" onClick="logClass('user_graded')" href="../../_classes/user_graded.html" onMouseOver="classPopup(event,'user_graded')">user_graded</a>::<a class="function" onClick="logFunction('create_from_grade')" href="../../_functions/create_from_grade.html" onMouseOver="funcPopup(event,'create_from_grade')">create_from_grade</a>(<a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1990"><span class="linenum">1990</span></a>              }
<a name="l1991"><span class="linenum">1991</span></a>          }
<a name="l1992"><span class="linenum">1992</span></a>  
<a name="l1993"><span class="linenum">1993</span></a>          if (<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> !== false) {
<a name="l1994"><span class="linenum">1994</span></a>  <span class="comment">            //lock grade if needed</span>
<a name="l1995"><span class="linenum">1995</span></a>          }
<a name="l1996"><span class="linenum">1996</span></a>  
<a name="l1997"><span class="linenum">1997</span></a>          if (<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> === false) {
<a name="l1998"><span class="linenum">1998</span></a>              return false;
<a name="l1999"><span class="linenum">1999</span></a>          } else {
<a name="l2000"><span class="linenum">2000</span></a>              return true;
<a name="l2001"><span class="linenum">2001</span></a>          }
<a name="l2002"><span class="linenum">2002</span></a>  
<a name="l2003"><span class="linenum">2003</span></a>      }
<a name="l2004"><span class="linenum">2004</span></a>  
<a name="l2005"><span class="linenum">2005</span></a>      <span class="comment">/**</span>
<a name="l2006"><span class="linenum">2006</span></a>  <span class="comment">     * Validate the formula.</span>
<a name="l2007"><span class="linenum">2007</span></a>  <span class="comment">     *</span>
<a name="l2008"><span class="linenum">2008</span></a>  <span class="comment">     * @param string $formulastr</span>
<a name="l2009"><span class="linenum">2009</span></a>  <span class="comment">     * @return bool true if calculation possible, false otherwise</span>
<a name="l2010"><span class="linenum">2010</span></a>  <span class="comment">     */</span>
<a name="l2011"><span class="linenum">2011</span></a>      public function <a class="function" onClick="logFunction('validate_formula')" href="../../_functions/validate_formula.html" onMouseOver="funcPopup(event,'validate_formula')">validate_formula</a>(<a class="var it10035" onMouseOver="hilite(10035)" onMouseOut="lolite()" onClick="logVariable('formulastr')" href="../../_variables/formulastr.html">$formulastr</a>) {
<a name="l2012"><span class="linenum">2012</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2013"><span class="linenum">2013</span></a>          require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/libdir.html">libdir</a>.'/mathslib.php');
<a name="l2014"><span class="linenum">2014</span></a>  
<a name="l2015"><span class="linenum">2015</span></a>          <a class="var it10035" onMouseOver="hilite(10035)" onMouseOut="lolite()" onClick="logVariable('formulastr')" href="../../_variables/formulastr.html">$formulastr</a> = <a class="class" onClick="logClass('grade_item')" href="../../_classes/grade_item.html" onMouseOver="classPopup(event,'grade_item')">grade_item</a>::<a class="function" onClick="logFunction('normalize_formula')" href="../../_functions/normalize_formula.html" onMouseOver="funcPopup(event,'normalize_formula')">normalize_formula</a>(<a class="var it10035" onMouseOver="hilite(10035)" onMouseOut="lolite()" onClick="logVariable('formulastr')" href="../../_variables/formulastr.html">$formulastr</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l2016"><span class="linenum">2016</span></a>  
<a name="l2017"><span class="linenum">2017</span></a>          if (empty(<a class="var it10035" onMouseOver="hilite(10035)" onMouseOut="lolite()" onClick="logVariable('formulastr')" href="../../_variables/formulastr.html">$formulastr</a>)) {
<a name="l2018"><span class="linenum">2018</span></a>              return true;
<a name="l2019"><span class="linenum">2019</span></a>          }
<a name="l2020"><span class="linenum">2020</span></a>  
<a name="l2021"><span class="linenum">2021</span></a>          if (<a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>(<a class="var it10035" onMouseOver="hilite(10035)" onMouseOut="lolite()" onClick="logVariable('formulastr')" href="../../_variables/formulastr.html">$formulastr</a>, '=') !== 0) {
<a name="l2022"><span class="linenum">2022</span></a>              return <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('errorcalculationnoequal', 'grades');
<a name="l2023"><span class="linenum">2023</span></a>          }
<a name="l2024"><span class="linenum">2024</span></a>  
<a name="l2025"><span class="linenum">2025</span></a>  <span class="comment">        // get used items</span>
<a name="l2026"><span class="linenum">2026</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match_all')" href="../../_functions/preg_match_all.html" onMouseOver="phpfuncPopup(event,'preg_match_all')">preg_match_all</a>('/##gi(\d+)##/', <a class="var it10035" onMouseOver="hilite(10035)" onMouseOut="lolite()" onClick="logVariable('formulastr')" href="../../_variables/formulastr.html">$formulastr</a>, <a class="var it79" onMouseOver="hilite(79)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>)) {
<a name="l2027"><span class="linenum">2027</span></a>              <a class="var it10028" onMouseOver="hilite(10028)" onMouseOut="lolite()" onClick="logVariable('useditems')" href="../../_variables/useditems.html">$useditems</a> = <a class="phpfunction" onClick="logFunction('array_unique')" href="../../_functions/array_unique.html" onMouseOver="phpfuncPopup(event,'array_unique')">array_unique</a>(<a class="var it79" onMouseOver="hilite(79)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1]); <span class="comment">// remove duplicates</span>
<a name="l2028"><span class="linenum">2028</span></a>          } else {
<a name="l2029"><span class="linenum">2029</span></a>              <a class="var it10028" onMouseOver="hilite(10028)" onMouseOut="lolite()" onClick="logVariable('useditems')" href="../../_variables/useditems.html">$useditems</a> = array();
<a name="l2030"><span class="linenum">2030</span></a>          }
<a name="l2031"><span class="linenum">2031</span></a>  
<a name="l2032"><span class="linenum">2032</span></a>  <span class="comment">        // MDL-11902</span>
<a name="l2033"><span class="linenum">2033</span></a>  <span class="comment">        // unset the value if formula is trying to reference to itself</span>
<a name="l2034"><span class="linenum">2034</span></a>  <span class="comment">        // but array keys does not match itemid</span>
<a name="l2035"><span class="linenum">2035</span></a>          if (!empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l2036"><span class="linenum">2036</span></a>              <a class="var it10028" onMouseOver="hilite(10028)" onMouseOut="lolite()" onClick="logVariable('useditems')" href="../../_variables/useditems.html">$useditems</a> = <a class="phpfunction" onClick="logFunction('array_diff')" href="../../_functions/array_diff.html" onMouseOver="phpfuncPopup(event,'array_diff')">array_diff</a>(<a class="var it10028" onMouseOver="hilite(10028)" onMouseOut="lolite()" onClick="logVariable('useditems')" href="../../_variables/useditems.html">$useditems</a>, array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('id')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l2037"><span class="linenum">2037</span></a>  <span class="comment">            //unset($useditems[$this-&gt;id]);</span>
<a name="l2038"><span class="linenum">2038</span></a>          }
<a name="l2039"><span class="linenum">2039</span></a>  
<a name="l2040"><span class="linenum">2040</span></a>  <span class="comment">        // prepare formula and init maths library</span>
<a name="l2041"><span class="linenum">2041</span></a>          <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a> = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>('/##(gi\d+)##/', '\1', <a class="var it10035" onMouseOver="hilite(10035)" onMouseOut="lolite()" onClick="logVariable('formulastr')" href="../../_variables/formulastr.html">$formulastr</a>);
<a name="l2042"><span class="linenum">2042</span></a>          <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a> = <span class="keyword">new </span><a class="class" onClick="logClass('calc_formula')" href="../../_classes/calc_formula.html" onMouseOver="classPopup(event,'calc_formula')">calc_formula</a>(<a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a>);
<a name="l2043"><span class="linenum">2043</span></a>  
<a name="l2044"><span class="linenum">2044</span></a>  
<a name="l2045"><span class="linenum">2045</span></a>          if (empty(<a class="var it10028" onMouseOver="hilite(10028)" onMouseOut="lolite()" onClick="logVariable('useditems')" href="../../_variables/useditems.html">$useditems</a>)) {
<a name="l2046"><span class="linenum">2046</span></a>              <a class="var it6045" onMouseOver="hilite(6045)" onMouseOut="lolite()" onClick="logVariable('grade_items')" href="../../_variables/grade_items.html">$grade_items</a> = array();
<a name="l2047"><span class="linenum">2047</span></a>  
<a name="l2048"><span class="linenum">2048</span></a>          } else {
<a name="l2049"><span class="linenum">2049</span></a>              <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it2909" onMouseOver="hilite(2909)" onMouseOut="lolite()" onClick="logVariable('usql')" href="../../_variables/usql.html">$usql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it10028" onMouseOver="hilite(10028)" onMouseOut="lolite()" onClick="logVariable('useditems')" href="../../_variables/useditems.html">$useditems</a>);
<a name="l2050"><span class="linenum">2050</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>[] = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>;
<a name="l2051"><span class="linenum">2051</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT gi.*
<a name="l2052"><span class="linenum">2052</span></a>                        FROM {grade_items} gi
<a name="l2053"><span class="linenum">2053</span></a>                       WHERE gi.id <a class="var it2909" onMouseOver="hilite(2909)" onMouseOut="lolite()" onClick="logVariable('usql')" href="../../_variables/usql.html">$usql</a> and gi.courseid=?&quot;; <span class="comment">// from the same course only!</span>
<a name="l2054"><span class="linenum">2054</span></a>  
<a name="l2055"><span class="linenum">2055</span></a>              if (!<a class="var it6045" onMouseOver="hilite(6045)" onMouseOut="lolite()" onClick="logVariable('grade_items')" href="../../_variables/grade_items.html">$grade_items</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>)) {
<a name="l2056"><span class="linenum">2056</span></a>                  <a class="var it6045" onMouseOver="hilite(6045)" onMouseOut="lolite()" onClick="logVariable('grade_items')" href="../../_variables/grade_items.html">$grade_items</a> = array();
<a name="l2057"><span class="linenum">2057</span></a>              }
<a name="l2058"><span class="linenum">2058</span></a>          }
<a name="l2059"><span class="linenum">2059</span></a>  
<a name="l2060"><span class="linenum">2060</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array();
<a name="l2061"><span class="linenum">2061</span></a>          foreach (<a class="var it10028" onMouseOver="hilite(10028)" onMouseOut="lolite()" onClick="logVariable('useditems')" href="../../_variables/useditems.html">$useditems</a> as <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>) {
<a name="l2062"><span class="linenum">2062</span></a>  <span class="comment">            // make sure all grade items exist in this course</span>
<a name="l2063"><span class="linenum">2063</span></a>              if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it6045" onMouseOver="hilite(6045)" onMouseOut="lolite()" onClick="logVariable('grade_items')" href="../../_variables/grade_items.html">$grade_items</a>)) {
<a name="l2064"><span class="linenum">2064</span></a>                  return false;
<a name="l2065"><span class="linenum">2065</span></a>              }
<a name="l2066"><span class="linenum">2066</span></a>  <span class="comment">            // use max grade when testing formula, this should be ok in 99.9%</span>
<a name="l2067"><span class="linenum">2067</span></a>  <span class="comment">            // division by 0 is one of possible problems</span>
<a name="l2068"><span class="linenum">2068</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['gi'.<a class="var it6045" onMouseOver="hilite(6045)" onMouseOut="lolite()" onClick="logVariable('grade_items')" href="../../_variables/grade_items.html">$grade_items</a>[<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>]-&gt;id] = <a class="var it6045" onMouseOver="hilite(6045)" onMouseOut="lolite()" onClick="logVariable('grade_items')" href="../../_variables/grade_items.html">$grade_items</a>[<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>]-&gt;grademax;
<a name="l2069"><span class="linenum">2069</span></a>          }
<a name="l2070"><span class="linenum">2070</span></a>  
<a name="l2071"><span class="linenum">2071</span></a>  <span class="comment">        // do the calculation</span>
<a name="l2072"><span class="linenum">2072</span></a>          <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a>-&gt;<a class="function" onClick="logFunction('set_params')" href="../../_functions/set_params.html" onMouseOver="funcPopup(event,'set_params')">set_params</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l2073"><span class="linenum">2073</span></a>          <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it2113" onMouseOver="hilite(2113)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../_variables/formula.html">$formula</a>-&gt;<a class="function" onClick="logFunction('evaluate')" href="../../_functions/evaluate.html" onMouseOver="funcPopup(event,'evaluate')">evaluate</a>();
<a name="l2074"><span class="linenum">2074</span></a>  
<a name="l2075"><span class="linenum">2075</span></a>  <span class="comment">        // false as result indicates some problem</span>
<a name="l2076"><span class="linenum">2076</span></a>          if (<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> === false) {
<a name="l2077"><span class="linenum">2077</span></a>  <span class="comment">            // TODO: add more error hints</span>
<a name="l2078"><span class="linenum">2078</span></a>              return <a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('errorcalculationunknown', 'grades');
<a name="l2079"><span class="linenum">2079</span></a>          } else {
<a name="l2080"><span class="linenum">2080</span></a>              return true;
<a name="l2081"><span class="linenum">2081</span></a>          }
<a name="l2082"><span class="linenum">2082</span></a>      }
<a name="l2083"><span class="linenum">2083</span></a>  
<a name="l2084"><span class="linenum">2084</span></a>      <span class="comment">/**</span>
<a name="l2085"><span class="linenum">2085</span></a>  <span class="comment">     * Returns the value of the display type</span>
<a name="l2086"><span class="linenum">2086</span></a>  <span class="comment">     *</span>
<a name="l2087"><span class="linenum">2087</span></a>  <span class="comment">     * It can be set at 3 levels: grade_item, course setting and site. The lowest level overrides the higher ones.</span>
<a name="l2088"><span class="linenum">2088</span></a>  <span class="comment">     *</span>
<a name="l2089"><span class="linenum">2089</span></a>  <span class="comment">     * @return int Display type</span>
<a name="l2090"><span class="linenum">2090</span></a>  <span class="comment">     */</span>
<a name="l2091"><span class="linenum">2091</span></a>      public function <a class="function" onClick="logFunction('get_displaytype')" href="../../_functions/get_displaytype.html" onMouseOver="funcPopup(event,'get_displaytype')">get_displaytype</a>() {
<a name="l2092"><span class="linenum">2092</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l2093"><span class="linenum">2093</span></a>  
<a name="l2094"><span class="linenum">2094</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('display')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/display.html">display</a> == <a class="constant" onClick="logConstant('GRADE_DISPLAY_TYPE_DEFAULT')" href="../../_constants/GRADE_DISPLAY_TYPE_DEFAULT.html" onMouseOver="constPopup(event,'GRADE_DISPLAY_TYPE_DEFAULT')">GRADE_DISPLAY_TYPE_DEFAULT</a>) {
<a name="l2095"><span class="linenum">2095</span></a>              return <a class="function" onClick="logFunction('grade_get_setting')" href="../../_functions/grade_get_setting.html" onMouseOver="funcPopup(event,'grade_get_setting')">grade_get_setting</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>, 'displaytype', <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('grade_displaytype')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/grade_displaytype.html">grade_displaytype</a>);
<a name="l2096"><span class="linenum">2096</span></a>  
<a name="l2097"><span class="linenum">2097</span></a>          } else {
<a name="l2098"><span class="linenum">2098</span></a>              return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('display')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/display.html">display</a>;
<a name="l2099"><span class="linenum">2099</span></a>          }
<a name="l2100"><span class="linenum">2100</span></a>      }
<a name="l2101"><span class="linenum">2101</span></a>  
<a name="l2102"><span class="linenum">2102</span></a>      <span class="comment">/**</span>
<a name="l2103"><span class="linenum">2103</span></a>  <span class="comment">     * Returns the value of the decimals field</span>
<a name="l2104"><span class="linenum">2104</span></a>  <span class="comment">     *</span>
<a name="l2105"><span class="linenum">2105</span></a>  <span class="comment">     * It can be set at 3 levels: grade_item, course setting and site. The lowest level overrides the higher ones.</span>
<a name="l2106"><span class="linenum">2106</span></a>  <span class="comment">     *</span>
<a name="l2107"><span class="linenum">2107</span></a>  <span class="comment">     * @return int Decimals (0 - 5)</span>
<a name="l2108"><span class="linenum">2108</span></a>  <span class="comment">     */</span>
<a name="l2109"><span class="linenum">2109</span></a>      public function <a class="function" onClick="logFunction('get_decimals')" href="../../_functions/get_decimals.html" onMouseOver="funcPopup(event,'get_decimals')">get_decimals</a>() {
<a name="l2110"><span class="linenum">2110</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l2111"><span class="linenum">2111</span></a>  
<a name="l2112"><span class="linenum">2112</span></a>          if (<a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('decimals')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/decimals.html">decimals</a>)) {
<a name="l2113"><span class="linenum">2113</span></a>              return <a class="function" onClick="logFunction('grade_get_setting')" href="../../_functions/grade_get_setting.html" onMouseOver="funcPopup(event,'grade_get_setting')">grade_get_setting</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>, 'decimalpoints', <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('grade_decimalpoints')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/grade_decimalpoints.html">grade_decimalpoints</a>);
<a name="l2114"><span class="linenum">2114</span></a>  
<a name="l2115"><span class="linenum">2115</span></a>          } else {
<a name="l2116"><span class="linenum">2116</span></a>              return <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('decimals')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/decimals.html">decimals</a>;
<a name="l2117"><span class="linenum">2117</span></a>          }
<a name="l2118"><span class="linenum">2118</span></a>      }
<a name="l2119"><span class="linenum">2119</span></a>  
<a name="l2120"><span class="linenum">2120</span></a>      <span class="comment">/**</span>
<a name="l2121"><span class="linenum">2121</span></a>  <span class="comment">     * Returns a string representing the range of grademin - grademax for this grade item.</span>
<a name="l2122"><span class="linenum">2122</span></a>  <span class="comment">     *</span>
<a name="l2123"><span class="linenum">2123</span></a>  <span class="comment">     * @param int $rangesdisplaytype</span>
<a name="l2124"><span class="linenum">2124</span></a>  <span class="comment">     * @param int $rangesdecimalpoints</span>
<a name="l2125"><span class="linenum">2125</span></a>  <span class="comment">     * @return string</span>
<a name="l2126"><span class="linenum">2126</span></a>  <span class="comment">     */</span>
<a name="l2127"><span class="linenum">2127</span></a>      function <a class="function" onClick="logFunction('get_formatted_range')" href="../../_functions/get_formatted_range.html" onMouseOver="funcPopup(event,'get_formatted_range')">get_formatted_range</a>(<a class="var it10038" onMouseOver="hilite(10038)" onMouseOut="lolite()" onClick="logVariable('rangesdisplaytype')" href="../../_variables/rangesdisplaytype.html">$rangesdisplaytype</a>=null, <a class="var it10039" onMouseOver="hilite(10039)" onMouseOut="lolite()" onClick="logVariable('rangesdecimalpoints')" href="../../_variables/rangesdecimalpoints.html">$rangesdecimalpoints</a>=null) {
<a name="l2128"><span class="linenum">2128</span></a>  
<a name="l2129"><span class="linenum">2129</span></a>          global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l2130"><span class="linenum">2130</span></a>  
<a name="l2131"><span class="linenum">2131</span></a>  <span class="comment">        // Determine which display type to use for this average</span>
<a name="l2132"><span class="linenum">2132</span></a>          if (isset(<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('gradeediting')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../../_variables/gradeediting.html">gradeediting</a>) &amp;&amp; <a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('gradeediting')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../../_variables/gradeediting.html">gradeediting</a>) &amp;&amp; <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('gradeediting')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../../_variables/gradeediting.html">gradeediting</a>[<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>]) {
<a name="l2133"><span class="linenum">2133</span></a>              <a class="var it10041" onMouseOver="hilite(10041)" onMouseOut="lolite()" onClick="logVariable('displaytype')" href="../../_variables/displaytype.html">$displaytype</a> = <a class="constant" onClick="logConstant('GRADE_DISPLAY_TYPE_REAL')" href="../../_constants/GRADE_DISPLAY_TYPE_REAL.html" onMouseOver="constPopup(event,'GRADE_DISPLAY_TYPE_REAL')">GRADE_DISPLAY_TYPE_REAL</a>;
<a name="l2134"><span class="linenum">2134</span></a>  
<a name="l2135"><span class="linenum">2135</span></a>          } else if (<a class="var it10038" onMouseOver="hilite(10038)" onMouseOut="lolite()" onClick="logVariable('rangesdisplaytype')" href="../../_variables/rangesdisplaytype.html">$rangesdisplaytype</a> == <a class="constant" onClick="logConstant('GRADE_REPORT_PREFERENCE_INHERIT')" href="../../_constants/GRADE_REPORT_PREFERENCE_INHERIT.html" onMouseOver="constPopup(event,'GRADE_REPORT_PREFERENCE_INHERIT')">GRADE_REPORT_PREFERENCE_INHERIT</a>) { // no ==0 here, please resave report and user prefs
<a name="l2136"><span class="linenum">2136</span></a>              <a class="var it10041" onMouseOver="hilite(10041)" onMouseOut="lolite()" onClick="logVariable('displaytype')" href="../../_variables/displaytype.html">$displaytype</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_displaytype')" href="../../_functions/get_displaytype.html" onMouseOver="funcPopup(event,'get_displaytype')">get_displaytype</a>();
<a name="l2137"><span class="linenum">2137</span></a>  
<a name="l2138"><span class="linenum">2138</span></a>          } else {
<a name="l2139"><span class="linenum">2139</span></a>              <a class="var it10041" onMouseOver="hilite(10041)" onMouseOut="lolite()" onClick="logVariable('displaytype')" href="../../_variables/displaytype.html">$displaytype</a> = <a class="var it10038" onMouseOver="hilite(10038)" onMouseOut="lolite()" onClick="logVariable('rangesdisplaytype')" href="../../_variables/rangesdisplaytype.html">$rangesdisplaytype</a>;
<a name="l2140"><span class="linenum">2140</span></a>          }
<a name="l2141"><span class="linenum">2141</span></a>  
<a name="l2142"><span class="linenum">2142</span></a>  <span class="comment">        // Override grade_item setting if a display preference (not default) was set for the averages</span>
<a name="l2143"><span class="linenum">2143</span></a>          if (<a class="var it10039" onMouseOver="hilite(10039)" onMouseOut="lolite()" onClick="logVariable('rangesdecimalpoints')" href="../../_variables/rangesdecimalpoints.html">$rangesdecimalpoints</a> == <a class="constant" onClick="logConstant('GRADE_REPORT_PREFERENCE_INHERIT')" href="../../_constants/GRADE_REPORT_PREFERENCE_INHERIT.html" onMouseOver="constPopup(event,'GRADE_REPORT_PREFERENCE_INHERIT')">GRADE_REPORT_PREFERENCE_INHERIT</a>) {
<a name="l2144"><span class="linenum">2144</span></a>              <a class="var it10042" onMouseOver="hilite(10042)" onMouseOut="lolite()" onClick="logVariable('decimalpoints')" href="../../_variables/decimalpoints.html">$decimalpoints</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_decimals')" href="../../_functions/get_decimals.html" onMouseOver="funcPopup(event,'get_decimals')">get_decimals</a>();
<a name="l2145"><span class="linenum">2145</span></a>  
<a name="l2146"><span class="linenum">2146</span></a>          } else {
<a name="l2147"><span class="linenum">2147</span></a>              <a class="var it10042" onMouseOver="hilite(10042)" onMouseOut="lolite()" onClick="logVariable('decimalpoints')" href="../../_variables/decimalpoints.html">$decimalpoints</a> = <a class="var it10039" onMouseOver="hilite(10039)" onMouseOut="lolite()" onClick="logVariable('rangesdecimalpoints')" href="../../_variables/rangesdecimalpoints.html">$rangesdecimalpoints</a>;
<a name="l2148"><span class="linenum">2148</span></a>          }
<a name="l2149"><span class="linenum">2149</span></a>  
<a name="l2150"><span class="linenum">2150</span></a>          if (<a class="var it10041" onMouseOver="hilite(10041)" onMouseOut="lolite()" onClick="logVariable('displaytype')" href="../../_variables/displaytype.html">$displaytype</a> == <a class="constant" onClick="logConstant('GRADE_DISPLAY_TYPE_PERCENTAGE')" href="../../_constants/GRADE_DISPLAY_TYPE_PERCENTAGE.html" onMouseOver="constPopup(event,'GRADE_DISPLAY_TYPE_PERCENTAGE')">GRADE_DISPLAY_TYPE_PERCENTAGE</a>) {
<a name="l2151"><span class="linenum">2151</span></a>              <a class="var it5024" onMouseOver="hilite(5024)" onMouseOut="lolite()" onClick="logVariable('grademin')" href="../../_variables/grademin.html">$grademin</a> = &quot;0 %&quot;;
<a name="l2152"><span class="linenum">2152</span></a>              <a class="var it5025" onMouseOver="hilite(5025)" onMouseOut="lolite()" onClick="logVariable('grademax')" href="../../_variables/grademax.html">$grademax</a> = &quot;100 %&quot;;
<a name="l2153"><span class="linenum">2153</span></a>  
<a name="l2154"><span class="linenum">2154</span></a>          } else {
<a name="l2155"><span class="linenum">2155</span></a>              <a class="var it5024" onMouseOver="hilite(5024)" onMouseOut="lolite()" onClick="logVariable('grademin')" href="../../_variables/grademin.html">$grademin</a> = <a class="function" onClick="logFunction('grade_format_gradevalue')" href="../../_functions/grade_format_gradevalue.html" onMouseOver="funcPopup(event,'grade_format_gradevalue')">grade_format_gradevalue</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademin')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademin.html">grademin</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>, true, <a class="var it10041" onMouseOver="hilite(10041)" onMouseOut="lolite()" onClick="logVariable('displaytype')" href="../../_variables/displaytype.html">$displaytype</a>, <a class="var it10042" onMouseOver="hilite(10042)" onMouseOut="lolite()" onClick="logVariable('decimalpoints')" href="../../_variables/decimalpoints.html">$decimalpoints</a>);
<a name="l2156"><span class="linenum">2156</span></a>              <a class="var it5025" onMouseOver="hilite(5025)" onMouseOut="lolite()" onClick="logVariable('grademax')" href="../../_variables/grademax.html">$grademax</a> = <a class="function" onClick="logFunction('grade_format_gradevalue')" href="../../_functions/grade_format_gradevalue.html" onMouseOver="funcPopup(event,'grade_format_gradevalue')">grade_format_gradevalue</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grademax')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/grademax.html">grademax</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>, true, <a class="var it10041" onMouseOver="hilite(10041)" onMouseOut="lolite()" onClick="logVariable('displaytype')" href="../../_variables/displaytype.html">$displaytype</a>, <a class="var it10042" onMouseOver="hilite(10042)" onMouseOut="lolite()" onClick="logVariable('decimalpoints')" href="../../_variables/decimalpoints.html">$decimalpoints</a>);
<a name="l2157"><span class="linenum">2157</span></a>          }
<a name="l2158"><span class="linenum">2158</span></a>  
<a name="l2159"><span class="linenum">2159</span></a>          return <a class="var it5024" onMouseOver="hilite(5024)" onMouseOut="lolite()" onClick="logVariable('grademin')" href="../../_variables/grademin.html">$grademin</a>.'&amp;ndash;'. <a class="var it5025" onMouseOver="hilite(5025)" onMouseOut="lolite()" onClick="logVariable('grademax')" href="../../_variables/grademax.html">$grademax</a>;
<a name="l2160"><span class="linenum">2160</span></a>      }
<a name="l2161"><span class="linenum">2161</span></a>  
<a name="l2162"><span class="linenum">2162</span></a>      <span class="comment">/**</span>
<a name="l2163"><span class="linenum">2163</span></a>  <span class="comment">     * Queries parent categories recursively to find the aggregationcoef type that applies to this grade item.</span>
<a name="l2164"><span class="linenum">2164</span></a>  <span class="comment">     *</span>
<a name="l2165"><span class="linenum">2165</span></a>  <span class="comment">     * @return string|false Returns the coefficient string of false is no coefficient is being used</span>
<a name="l2166"><span class="linenum">2166</span></a>  <span class="comment">     */</span>
<a name="l2167"><span class="linenum">2167</span></a>      public function <a class="function" onClick="logFunction('get_coefstring')" href="../../_functions/get_coefstring.html" onMouseOver="funcPopup(event,'get_coefstring')">get_coefstring</a>() {
<a name="l2168"><span class="linenum">2168</span></a>          <a class="var it6486" onMouseOver="hilite(6486)" onMouseOut="lolite()" onClick="logVariable('parent_category')" href="../../_variables/parent_category.html">$parent_category</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('load_parent_category')" href="../../_functions/load_parent_category.html" onMouseOver="funcPopup(event,'load_parent_category')">load_parent_category</a>();
<a name="l2169"><span class="linenum">2169</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('is_category_item')" href="../../_functions/is_category_item.html" onMouseOver="funcPopup(event,'is_category_item')">is_category_item</a>()) {
<a name="l2170"><span class="linenum">2170</span></a>              <a class="var it6486" onMouseOver="hilite(6486)" onMouseOut="lolite()" onClick="logVariable('parent_category')" href="../../_variables/parent_category.html">$parent_category</a> = <a class="var it6486" onMouseOver="hilite(6486)" onMouseOut="lolite()" onClick="logVariable('parent_category')" href="../../_variables/parent_category.html">$parent_category</a>-&gt;<a class="function" onClick="logFunction('load_parent_category')" href="../../_functions/load_parent_category.html" onMouseOver="funcPopup(event,'load_parent_category')">load_parent_category</a>();
<a name="l2171"><span class="linenum">2171</span></a>          }
<a name="l2172"><span class="linenum">2172</span></a>  
<a name="l2173"><span class="linenum">2173</span></a>          if (<a class="var it6486" onMouseOver="hilite(6486)" onMouseOut="lolite()" onClick="logVariable('parent_category')" href="../../_variables/parent_category.html">$parent_category</a>-&gt;<a class="function" onClick="logFunction('is_aggregationcoef_used')" href="../../_functions/is_aggregationcoef_used.html" onMouseOver="funcPopup(event,'is_aggregationcoef_used')">is_aggregationcoef_used</a>()) {
<a name="l2174"><span class="linenum">2174</span></a>              return <a class="var it6486" onMouseOver="hilite(6486)" onMouseOut="lolite()" onClick="logVariable('parent_category')" href="../../_variables/parent_category.html">$parent_category</a>-&gt;<a class="function" onClick="logFunction('get_coefstring')" href="../../_functions/get_coefstring.html" onMouseOver="funcPopup(event,'get_coefstring')">get_coefstring</a>();
<a name="l2175"><span class="linenum">2175</span></a>          } else {
<a name="l2176"><span class="linenum">2176</span></a>              return false;
<a name="l2177"><span class="linenum">2177</span></a>          }
<a name="l2178"><span class="linenum">2178</span></a>      }
<a name="l2179"><span class="linenum">2179</span></a>  
<a name="l2180"><span class="linenum">2180</span></a>      <span class="comment">/**</span>
<a name="l2181"><span class="linenum">2181</span></a>  <span class="comment">     * Returns whether the grade item can control the visibility of the grades</span>
<a name="l2182"><span class="linenum">2182</span></a>  <span class="comment">     *</span>
<a name="l2183"><span class="linenum">2183</span></a>  <span class="comment">     * @return bool</span>
<a name="l2184"><span class="linenum">2184</span></a>  <span class="comment">     */</span>
<a name="l2185"><span class="linenum">2185</span></a>      public function <a class="function" onClick="logFunction('can_control_visibility')" href="../../_functions/can_control_visibility.html" onMouseOver="funcPopup(event,'can_control_visibility')">can_control_visibility</a>() {
<a name="l2186"><span class="linenum">2186</span></a>          if (<a class="class" onClick="logClass('core_component')" href="../../_classes/core_component.html" onMouseOver="classPopup(event,'core_component')">core_component</a>::<a class="function" onClick="logFunction('get_plugin_directory')" href="../../_functions/get_plugin_directory.html" onMouseOver="funcPopup(event,'get_plugin_directory')">get_plugin_directory</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemtype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemtype.html">itemtype</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemmodule')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemmodule.html">itemmodule</a>)) {
<a name="l2187"><span class="linenum">2187</span></a>              return !<a class="function" onClick="logFunction('plugin_supports')" href="../../_functions/plugin_supports.html" onMouseOver="funcPopup(event,'plugin_supports')">plugin_supports</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemtype')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemtype.html">itemtype</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('itemmodule')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/itemmodule.html">itemmodule</a>, <a class="constant" onClick="logConstant('FEATURE_CONTROLS_GRADE_VISIBILITY')" href="../../_constants/FEATURE_CONTROLS_GRADE_VISIBILITY.html" onMouseOver="constPopup(event,'FEATURE_CONTROLS_GRADE_VISIBILITY')">FEATURE_CONTROLS_GRADE_VISIBILITY</a>, false);
<a name="l2188"><span class="linenum">2188</span></a>          }
<a name="l2189"><span class="linenum">2189</span></a>          return parent::<a class="function" onClick="logFunction('can_control_visibility')" href="../../_functions/can_control_visibility.html" onMouseOver="funcPopup(event,'can_control_visibility')">can_control_visibility</a>();
<a name="l2190"><span class="linenum">2190</span></a>      }
<a name="l2191"><span class="linenum">2191</span></a>  
<a name="l2192"><span class="linenum">2192</span></a>      <span class="comment">/**</span>
<a name="l2193"><span class="linenum">2193</span></a>  <span class="comment">     * Used to notify the completion system (if necessary) that a user's grade</span>
<a name="l2194"><span class="linenum">2194</span></a>  <span class="comment">     * has changed, and clear up a possible score cache.</span>
<a name="l2195"><span class="linenum">2195</span></a>  <span class="comment">     *</span>
<a name="l2196"><span class="linenum">2196</span></a>  <span class="comment">     * @param bool $deleted True if grade was actually deleted</span>
<a name="l2197"><span class="linenum">2197</span></a>  <span class="comment">     */</span>
<a name="l2198"><span class="linenum">2198</span></a>      protected function <a class="function" onClick="logFunction('notify_changed')" href="../../_functions/notify_changed.html" onMouseOver="funcPopup(event,'notify_changed')">notify_changed</a>(<a class="var it2973" onMouseOver="hilite(2973)" onMouseOut="lolite()" onClick="logVariable('deleted')" href="../../_variables/deleted.html">$deleted</a>) {
<a name="l2199"><span class="linenum">2199</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l2200"><span class="linenum">2200</span></a>  
<a name="l2201"><span class="linenum">2201</span></a>  <span class="comment">        // Condition code may cache the grades for conditional availability of</span>
<a name="l2202"><span class="linenum">2202</span></a>  <span class="comment">        // modules or sections. (This code should use a hook for communication</span>
<a name="l2203"><span class="linenum">2203</span></a>  <span class="comment">        // with plugin, but hooks are not implemented at time of writing.)</span>
<a name="l2204"><span class="linenum">2204</span></a>          if (!empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enableavailability')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../../_variables/enableavailability.html">enableavailability</a>) &amp;&amp; <a class="phpfunction" onClick="logFunction('class_exists')" href="../../_functions/class_exists.html" onMouseOver="phpfuncPopup(event,'class_exists')">class_exists</a>('\availability_grade\callbacks')) {
<a name="l2205"><span class="linenum">2205</span></a>              \availability_grade\<a class="class" onClick="logClass('callbacks')" href="../../_classes/callbacks.html" onMouseOver="classPopup(event,'callbacks')">callbacks</a>::<a class="function" onClick="logFunction('grade_item_changed')" href="../../_functions/grade_item_changed.html" onMouseOver="funcPopup(event,'grade_item_changed')">grade_item_changed</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('courseid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l2206"><span class="linenum">2206</span></a>          }
<a name="l2207"><span class="linenum">2207</span></a>      }
<a name="l2208"><span class="linenum">2208</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'bounded_number': ['bounded_number', 'Used to make sure that $min <= $value <= $max ', [['lib','moodlelib.php',8547]], 3],
'is_aggregationcoef_used': ['is_aggregationcoef_used', 'Returns true if category uses special aggregation coefficient ', [['lib/grade','grade_category.php',1747]], 14],
'set_locked': ['set_locked', 'Locks or unlocks this grade_item and (optionally) all its associated final grades. ', [['lib/grade','grade_item.php',499],['lib/grade','grade_grade.php',412],['lib/grade','grade_category.php',2324]], 17],
'get_config': ['get_config', 'Get a configuration value for this plugin ', [['mod/assign','assignmentplugin.php',345],['lib/portfolio','plugin.php',546],['question/engine','bank.php',109],['lib','moodlelib.php',1404],['lib','enrollib.php',1141],['lib/editor/tinymce/classes','plugin.php',73],['admin/tool/log/classes/helper','store.php',63]], 847],
'is_locked': ['is_locked', 'Returns the locked state of this grade_item (if the grade_item is locked OR no specific $userid is given) or the locked state of a specific grade within this item if a specific $userid is given and the grade_item is unlocked. ', [['lib/grade','grade_item.php',476],['backup/util/settings','setting_dependency.class.php',187],['backup/util/settings','setting_dependency.class.php',340],['backup/util/settings','setting_dependency.class.php',534],['backup/util/settings','setting_dependency.class.php',598],['user/profile','lib.php',354],['lib/grade','grade_grade.php',265],['lib/grade','grade_category.php',2312],['lib','badgeslib.php',317]], 57],
'fix_duplicate_sortorder': ['fix_duplicate_sortorder', 'Detect duplicate grade item\'s sortorder and re-sort them. Note: Duplicate sortorder will be introduced while duplicating activities or merging two courses. ', [['lib/grade','grade_item.php',1238]], 2],
'grade_format_gradevalue': ['grade_format_gradevalue', 'Returns string representation of grade value ', [['lib','gradelib.php',646]], 20],
'where': ['where', 'Add where clause ', [['lib/zend/Zend/Service/WindowsAzure/Storage','TableEntityQuery.php',120],['question/classes/bank/search','category_condition.php',96],['question/classes/bank/search','hidden_condition.php',53],['question/engine','datalib.php',1882],['question/engine','datalib.php',1964]], 61],
'adjust_raw_grade': ['adjust_raw_grade', 'Given a float grade value or integer grade scale, applies a number of adjustment based on grade_item variables and returns the result. ', [['lib/grade','grade_item.php',739]], 9],
'get_coefstring': ['get_coefstring', 'Queries parent categories recursively to find the aggregationcoef type that applies to this grade item. ', [['lib/grade','grade_item.php',2162],['lib/grade','grade_category.php',1771]], 8],
'format_string': ['format_string', 'Given a simple string, this function returns the string processed by enabled string filters if $CFG->filterall is enabled ', [['lib','weblib.php',1318]], 854],
'create_from_grade': ['create_from_grade', 'Create instance of event. ', [['mod/assign/classes/event','feedback_viewed.php',44],['lib/classes/event','grade_deleted.php',61],['lib/classes/event','user_graded.php',52],['mod/assign/classes/event','submission_graded.php',44]], 15],
'trigger': ['trigger', '', [['lib/evalmath','evalmath.class.php',438],['lib/classes/event','base.php',682]], 778],
'fetch_all_helper': ['fetch_all_helper', 'Factory method which uses the parameters to retrieve all matching instances from the database ', [['lib/grade','grade_object.php',171],['completion','data_object.php',199]], 11],
'can_control_visibility': ['can_control_visibility', 'Returns whether the grade object can control the visibility of the grades. ', [['lib/grade','grade_object.php',455],['lib/grade','grade_item.php',2180]], 9],
'get_description': ['get_description', 'Returns description of what happened. ', [['report/log/classes/event','user_report_viewed.php',63],['mod/wiki/classes/event','page_deleted.php',63],['mod/forum/classes/message/inbound','reply_handler.php',41],['mod/chat/classes/event','sessions_viewed.php',45],['mod/glossary/classes/event','category_deleted.php',55],['mod/workshop/classes/event','assessment_evaluations_reset.php',55],['lib/classes/event','tag_updated.php',67],['lib/classes/event','course_resources_list_viewed.php',51],['mod/lesson/classes/event','content_page_viewed.php',66],['lib/classes/event','blog_association_created.php',65],['lib/classes/event','user_profile_viewed.php',65],['mod/feedback/classes/event','response_submitted.php',69],['lib/classes/event','badge_awarded.php',63],['report/outline/classes/event','report_viewed.php',63],['mod/assign/classes/event','extension_granted.php',67],['admin/tool/capability/classes/event','report_viewed.php',56],['lib/classes/event','message_viewed.php',72],['lib/classes/event','course_category_created.php',66],['mod/quiz/classes/event','group_override_updated.php',63],['mod/survey/classes/event','response_submitted.php',62],['lib/classes/event','blog_comment_created.php',47],['mod/book/tool/exportimscp/classes/event','book_exported.php',57],['report/loglive/classes/event','report_viewed.php',57],['mod/forum/classes/event','post_deleted.php',57],['mod/assign/classes/event','submission_duplicated.php',67],['mod/chat/classes/event','message_sent.php',38],['mod/workshop/classes/event','submission_created.php',53],['lib/classes/event','note_updated.php',65],['mod/lesson/classes/event','group_override_deleted.php',63],['mod/feedback/classes/event','response_deleted.php',66],['lib/classes/event','course_module_instance_list_viewed.php',65],['mod/assign/classes/event','submission_locked.php',68],['mod/lesson/classes/event','page_updated.php',90],['mod/forum/classes/event','discussion_subscription_deleted.php',56],['mod/quiz/classes/event','attempt_preview_started.php',63],['mod/assign/classes/event','batch_set_workflow_state_viewed.php',88],['mod/lesson/classes/event','user_override_updated.php',63],['mod/quiz/classes/event','report_viewed.php',65],['mod/lesson/classes/event','question_answered.php',72],['lib','authlib.php',519],['mod/forum/classes/event','discussion_viewed.php',50],['mod/workshop/classes/event','submission_viewed.php',53],['mod/data/classes/event','comment_created.php',46],['mod/workshop/classes/event','submission_reassessed.php',57],['mod/assign/submission/onlinetext/classes/event','submission_created.php',53],['mod/glossary/classes/event','entry_deleted.php',63],['mod/glossary/classes/event','comment_created.php',46],['lib/classes/event','user_created.php',57],['mod/data/classes/event','field_updated.php',66],['mod/data/classes/event','template_updated.php',65],['lib/classes/event','comment_created.php',67],['lib/classes/event','cohort_deleted.php',58],['lib/grade','grade_item.php',1305],['mod/scorm/classes/event','tracks_viewed.php',54],['lib/classes/event','course_viewed.php',56],['lib/classes/event','course_content_deleted.php',63],['mod/quiz/classes/event','attempt_abandoned.php',53],['mod/workshop/classes/event','phase_switched.php',55],['lib/classes/event','base.php',298],['lib/classes/event','content_viewed.php',89],['lib/classes/event','course_completion_updated.php',56],['report/completion/classes/event','report_viewed.php',58],['mod/forum/classes/event','discussion_updated.php',55],['lib/classes/event','course_reset_ended.php',44],['mod/choice/classes/event','answer_submitted.php',46],['mod/forum/classes/event','assessable_uploaded.php',46],['mod/wiki/classes/event','page_diff_viewed.php',64],['lib/classes/event','course_category_updated.php',69],['admin/tool/langimport/classes/event','langpack_updated.php',71],['lib/classes/event','webservice_service_created.php',44],['lib/classes/event','course_created.php',64],['mod/lesson/classes/event','lesson_started.php',66],['mod/assign/classes/event','grading_table_viewed.php',88],['lib/classes/event','calendar_event_deleted.php',67],['lib/classes/event','group_created.php',38],['mod/quiz/classes/event','user_override_created.php',62],['mod/glossary/classes/event','category_updated.php',55],['mod/assign/classes/event','submission_viewed.php',85],['mod/glossary/classes/event','entry_disapproved.php',55],['lib/classes/event','user_password_updated.php',79],['mod/assign/classes/event','all_submissions_downloaded.php',65],['lib/classes/event','role_deleted.php',64],['admin/tool/log/store/legacy/tests/fixtures','event.php',35],['lib/classes/event','user_loggedinas.php',66],['mod/assign/classes/event','submission_confirmation_form_viewed.php',88],['mod/lesson/classes/event','essay_attempt_viewed.php',67],['mod/forum/classes/event','discussion_moved.php',56],['mod/assign/submission/onlinetext/classes/event','assessable_uploaded.php',45],['mod/assign/classes/event','reveal_identities_confirmation_page_viewed.php',88],['mod/survey/classes/event','report_downloaded.php',64],['mod/wiki/classes/event','page_updated.php',63],['admin/tool/log/store/standard/tests/fixtures','event.php',35],['mod/assign/classes/event','submission_unlocked.php',68],['lib/classes/event','user_list_viewed.php',65],['mod/forum/classes/event','readtracking_disabled.php',54],['lib/classes/event','comments_viewed.php',60],['lib/classes/event','cohort_member_added.php',58],['lib/classes/event','grouping_created.php',38],['lib/classes/event','recent_activity_viewed.php',58],['lib/classes/event','role_allow_switch_updated.php',56],['mod/assign/submission/comments/classes/event','comment_deleted.php',46],['admin/tool/messageinbound/classes/message/inbound','invalid_recipient_handler.php',51],['lib/classes/event','user_login_failed.php',65],['lib/classes/event','message_contact_added.php',66],['mod/assign/submission/file/classes/event','submission_updated.php',53],['lib/classes/event','role_allow_assign_updated.php',56],['mod/quiz/classes/event','user_override_deleted.php',62],['mod/quiz/classes/event','edit_page_viewed.php',62],['lib/classes/event','email_failed.php',57],['lib/classes/event','tag_removed.php',67],['mod/lesson/classes/event','highscores_viewed.php',66],['report/stats/classes/event','user_report_viewed.php',57],['mod/quiz/classes/event','group_override_deleted.php',63],['mod/book/classes/event','chapter_updated.php',59],['lib/simplepie/library/SimplePie','Enclosure.php',434],['lib/classes/log','reader.php',39],['mod/lesson/classes/event','question_viewed.php',72],['lib/simplepie/library','SimplePie.php',2407],['mod/scorm/classes/event','interactions_viewed.php',53],['lib/classes/event','course_module_updated.php',66],['mod/forum/classes/event','discussion_subscription_created.php',56],['mod/quiz/classes/event','question_manually_graded.php',64],['lib/classes/event','mnet_access_control_created.php',75],['lib/classes/event','role_assigned.php',65],['calendar','lib.php',2116],['lib/classes/event','unknown_logged.php',47],['availability/condition/profile/classes','condition.php',187],['mod/scorm/classes/event','user_report_viewed.php',53],['admin/tool/monitor/classes/event','subscription_criteria_met.php',64],['report/participation/classes/event','report_viewed.php',67],['mod/data/classes/event','comment_deleted.php',46],['lib/classes/event','user_updated.php',57],['lib/classes/event','course_section_updated.php',65],['lib/classes/event','comment_deleted.php',67],['mod/assign/classes/event','marker_updated.php',79],['lib/classes/event','webservice_login_failed.php',53],['mod/assign/submission/file/classes/event','assessable_uploaded.php',46],['admin/tool/log/store/database/tests/fixtures','event.php',35],['mod/lti/classes/event','unknown_service_api_called.php',73],['lib/classes/event','cohort_updated.php',58],['mod/forum/classes/event','post_updated.php',57],['mod/book/classes/event','chapter_viewed.php',59],['lib/classes/event','note_deleted.php',65],['lib/classes/event','user_loggedout.php',63],['lib/classes/event','grade_report_viewed.php',63],['mod/assign/submission/onlinetext/classes/event','submission_updated.php',53],['mod/assign/classes/event','workflow_state_updated.php',78],['mod/book/classes/event','chapter_deleted.php',59],['lib/classes/event','course_deleted.php',65],['lib/classes/event','blog_entry_deleted.php',84],['admin/tool/log/store/legacy/classes/event','legacy_logged.php',39],['lib/classes/event','webservice_token_created.php',44],['mod/forum/classes/event','course_searched.php',55],['lib/classes/event','group_updated.php',38],['mod/quiz/classes/event','attempt_started.php',46],['mod/lesson/classes/event','group_override_updated.php',63],['lib/classes/event','course_module_viewed.php',52],['availability/condition/completion/classes','condition.php',154],['lib/classes/event','mnet_access_control_updated.php',75],['mod/wiki/classes/event','comments_viewed.php',48],['lib/classes/message/inbound','private_files_handler.php',47],['lib/tests/fixtures','event_fixtures.php',38],['lib/tests/fixtures','event_fixtures.php',263],['mod/assign/submission/file/classes/event','submission_created.php',53],['lib/simplepie/library/SimplePie','Item.php',308],['mod/quiz/classes/event','attempt_submitted.php',53],['mod/data/classes/event','field_created.php',67],['lib/classes/event','question_category_created.php',57],['admin/tool/monitor/classes/event','rule_deleted.php',59],['lib/classes/event','blog_comment_deleted.php',47],['mod/lesson/classes/event','group_override_created.php',64],['mod/workshop/classes/event','assessments_reset.php',54],['mod/wiki/classes/event','comment_created.php',47],['mod/lesson/classes/event','lesson_resumed.php',66],['mod/assign/classes/event','feedback_viewed.php',85],['lib/classes/event','blog_entry_updated.php',83],['report/questioninstances/classes/event','report_viewed.php',64],['mod/assign/classes/event','submission_form_viewed.php',91],['mod/folder/classes/event','folder_updated.php',57],['mod/assign/classes/event','statement_accepted.php',67],['lib/classes/event','grade_deleted.php',103],['lib/classes/event','role_capabilities_updated.php',60],['lib/classes/event','blog_entries_viewed.php',71],['lib/tests','messageinbound_test.php',172],['mod/wiki/classes/event','page_viewed.php',57],['lib/classes/event','group_deleted.php',38],['lib/classes/event','webservice_token_sent.php',38],['mod/quiz/classes/event','attempt_becameoverdue.php',56],['mod/quiz/classes/event','attempt_viewed.php',63],['mod/assign/classes/event','submission_status_updated.php',69],['mod/assign/classes/event','grading_form_viewed.php',91],['lib/classes/event','course_module_completion_updated.php',57],['mod/workshop/classes/event','assessment_evaluated.php',56],['report/log/classes/event','report_viewed.php',67],['lib/classes/event','course_module_deleted.php',65],['mod/book/classes/event','chapter_created.php',59],['mod/workshop/classes/event','submission_assessed.php',56],['lib/classes/event','cohort_created.php',58],['lib/classes/event','webservice_function_called.php',49],['mod/scorm/classes/event','sco_launched.php',54],['mod/wiki/classes/event','comment_deleted.php',47],['lib/classes/event','blog_entry_created.php',85],['lib/classes/event','user_enrolment_created.php',62],['mod/data/classes/event','record_created.php',65],['mod/quiz/classes/event','attempt_summary_viewed.php',65],['lib/classes/event','user_enrolment_updated.php',62],['mod/quiz/classes/event','attempt_reviewed.php',62],['mod/glossary/classes/event','comment_deleted.php',46],['mod/lesson/classes/event','page_moved.php',74],['mod/glossary/classes/event','category_created.php',55],['availability/condition/grouping/classes','condition.php',124],['mod/lesson/classes/event','page_created.php',72],['lib/classes/event','cohort_member_removed.php',59],['mod/wiki/classes/event','page_version_viewed.php',63],['lib/classes/event','role_allow_override_updated.php',56],['mod/workshop/classes/event','assessable_uploaded.php',46],['lib/classes/event','grouping_updated.php',38],['admin/tool/monitor/classes/event','rule_updated.php',59],['lib/classes/event','course_module_created.php',95],['lib/classes/event','tag_added.php',67],['admin/tool/langimport/classes/event','langpack_removed.php',71],['mod/assign/classes/event','assessable_submitted.php',74],['mod/workshop/classes/event','submission_updated.php',53],['mod/lesson/classes/event','page_deleted.php',72],['availability/condition/date/classes','condition.php',136],['lib/classes/event','grouping_deleted.php',45],['mod/assign/submission/comments/classes/event','comment_created.php',46],['lib/classes/event','tag_flagged.php',64],['mod/wiki/classes/event','page_history_viewed.php',57],['mod/survey/classes/event','report_viewed.php',64],['lib/classes/event','tag_created.php',64],['report/stats/classes/event','report_viewed.php',65],['lib/classes/event','note_created.php',65],['lib/classes/event','course_reset_started.php',44],['admin/tool/monitor/classes/event','subscription_created.php',59],['mod/book/tool/print/classes/event','book_printed.php',57],['lib/classes/event','webservice_service_user_removed.php',38],['mod/data/classes/event','record_deleted.php',65],['mod/choice/classes/event','answer_updated.php',46],['message/tests/fixtures','inbound_fixtures.php',35],['lib/classes/event','group_member_removed.php',38],['mod/glossary/classes/event','entry_viewed.php',57],['mod/forum/classes/event','user_report_viewed.php',55],['lib/classes/event','course_category_deleted.php',68],['mod/forum/classes/event','subscription_created.php',55],['lib/classes/event','calendar_event_created.php',67],['lib/classes/event','message_contact_blocked.php',66],['lib/classes/event','webservice_service_updated.php',38],['mod/wiki/classes/event','page_version_restored.php',63],['mod/data/classes/event','template_viewed.php',64],['lib/classes/event','course_user_report_viewed.php',56],['mod/data/classes/event','record_updated.php',65],['mod/wiki/classes/event','page_map_viewed.php',63],['mod/wiki/classes/event','page_locks_deleted.php',63],['lib/classes/event','webservice_service_deleted.php',38],['lib/grade','grade_category.php',2145],['mod/forum/classes/event','readtracking_enabled.php',54],['lib/classes/event','role_unassigned.php',62],['lib/classes/event','course_restored.php',67],['mod/choice/classes/event','report_viewed.php',56],['lib/classes/event','user_deleted.php',66],['lib/classes/event','user_enrolment_deleted.php',63],['mod/book/tool/print/classes/event','chapter_printed.php',59],['mod/assign/classes/event','identities_revealed.php',65],['lib/classes/event','user_graded.php',105],['lib/classes/event','course_updated.php',67],['admin/tool/log/classes/helper','reader.php',53],['mod/forum/classes/event','post_created.php',57],['mod/data/classes/event','field_deleted.php',66],['lib/classes/event','tag_deleted.php',64],['availability/condition/grade/classes','condition.php',123],['mod/glossary/classes/event','entry_created.php',61],['mod/forum/classes/event','discussion_created.php',55],['mod/forum/classes/event','discussion_deleted.php',56],['mod/scorm/classes/event','attempt_deleted.php',52],['mod/lesson/classes/event','lesson_ended.php',67],['lib/grade','grade_scale.php',331],['admin/tool/monitor/classes','subscription.php',133],['mod/forum/classes/event','subscribers_viewed.php',55],['mod/scorm/classes/event','report_viewed.php',53],['availability/tests/fixtures','mock_condition.php',82],['mod/lesson/classes/event','user_override_deleted.php',62],['report/completion/classes/event','user_report_viewed.php',58],['admin/tool/langimport/classes/event','langpack_imported.php',71],['mod/forum/classes/event','subscription_deleted.php',55],['mod/lesson/classes/event','highscore_added.php',74],['mod/lesson/classes/event','essay_assessed.php',57],['availability/condition/group/classes','condition.php',93],['lib/classes/event','message_sent.php',100],['lib/classes/event','message_contact_removed.php',66],['lib/classes/event','tag_unflagged.php',64],['mod/assign/classes/event','submission_graded.php',68],['mod/assign/classes/event','batch_set_marker_allocation_viewed.php',88],['report/outline/classes/event','activity_report_viewed.php',57],['lib/classes/event','calendar_event_updated.php',67],['mod/lesson/classes/event','user_override_created.php',62],['mod/workshop/classes/event','assessment_reevaluated.php',56],['lib/simplepie/library/SimplePie','Source.php',459],['mod/quiz/classes/event','user_override_updated.php',63],['lib/classes/event','webservice_service_user_added.php',38],['admin/tool/monitor/classes/event','subscription_deleted.php',59],['lib/classes/event','notes_viewed.php',58],['mod/glossary/classes/event','entry_updated.php',61],['admin/tool/monitor/classes/event','rule_created.php',59],['mod/wiki/classes/event','page_version_deleted.php',63],['lib/classes/event','course_completed.php',82],['mod/assign/classes/event','submission_status_viewed.php',90],['mod/glossary/classes/event','entry_approved.php',55],['mod/wiki/classes/event','page_created.php',57],['mod/quiz/classes/event','group_override_created.php',64],['lib/classes/event','group_member_added.php',45],['lib/classes/event','message_contact_unblocked.php',66],['mod/quiz/classes/event','attempt_deleted.php',56],['lib/classes/event','user_loggedin.php',45],['admin/tool/monitor/classes','rule.php',249],['mod/lesson/classes/event','lesson_restarted.php',66],['lib/grade','grade_outcome.php',291]], 70],
'on': ['on', '', [['lib/requirejs','require.js',506]], 3494],
'qualifies_for_regrading': ['qualifies_for_regrading', 'Compares the values held by this object with those of the matching record in DB, and returns whether or not these differences are sufficient to justify an update of all parent objects. This assumes that this object has an id number and a matching record in DB. If not, it will return false. ', [['lib/grade','grade_item.php',296],['lib/grade','grade_category.php',387]], 10],
'debugging': ['debugging', 'Standard Debugging Function ', [['lib','weblib.php',2854]], 853],
'fetch_helper': ['fetch_helper', 'Factory method which uses the parameters to retrieve matching instances from the database ', [['lib/grade','grade_object.php',151],['completion','data_object.php',178]], 16],
'set_params': ['set_params', 'Raplace parameters used in existing formula, parameter names must contain only lowercase [a-z] letters, no other characters are allowed! ', [['lib','mathslib.php',73]], 4],
'load_item_category': ['load_item_category', 'Calls upon the get_item_category method to retrieve the grade_category object from the DB and assigns it to $this->item_category. It also returns the object. ', [['lib/grade','grade_item.php',908]], 5],
'start_delegated_transaction': ['start_delegated_transaction', 'On DBs that support it, switch to transaction mode and begin a transaction you\'ll need to ensure you call allow_commit() on the returned object or your changes *will* be lost. ', [['lib/dml','moodle_database.php',2344]], 137],
'grade_regrade_final_grades': ['grade_regrade_final_grades', 'Updates all final grades in course. ', [['lib','gradelib.php',1008]], 27],
'allow_commit': ['allow_commit', 'Commit delegated transaction. The real database commit SQL is executed only after committing all delegated transactions. ', [['lib/dml','moodle_transaction.php',78]], 127],
'has_hidden_grades': ['has_hidden_grades', 'Returns the number of grades that are hidden ', [['lib/grade','grade_item.php',623]], 0],
'get_recordset': ['get_recordset', 'Get a number of records as a moodle_recordset where all the given conditions met. ', [['lib/dml','moodle_database.php',1113]], 95],
'set_calculation': ['set_calculation', 'Sets this item\'s calculation (creates it) if not yet set, or updates it if already set (in the DB). If no calculation is given, the calculation is removed. ', [['lib/grade','grade_item.php',1062]], 5],
'get_string': ['get_string', 'Return a core get_string() call ', [['lib/external','externallib.php',112],['lib','moodlelib.php',6538],['lib','moodlelib.php',9417],['lib/classes','string_manager_standard.php',280],['lib/classes','string_manager.php',38],['lib/classes','string_manager_install.php',95],['question/behaviour','behaviourbase.php',756]], 19235],
'get_recordset_sql': ['get_recordset_sql', 'Get a number of records as a moodle_recordset using a SQL statement. ', [['lib/dml','pgsql_native_moodle_database.php',688],['lib/dml','oci_native_moodle_database.php',1065],['lib/dml','sqlsrv_native_moodle_database.php',761],['lib/dml','mssql_native_moodle_database.php',687],['lib/dml','mysqli_native_moodle_database.php',985],['lib/dml/tests','dml_test.php',5423],['lib/dml','pdo_moodle_database.php',251]], 279],
'use_formula': ['use_formula', 'Internal function that does the final grade calculation ', [['lib/grade','grade_item.php',1913]], 2],
'grade_get_setting': ['grade_get_setting', 'Returns a  course gradebook setting ', [['lib','gradelib.php',557]], 29],
'get_plugin_directory': ['get_plugin_directory', 'Returns the exact absolute path to plugin directory. ', [['lib/classes','component.php',890],['lib','deprecatedlib.php',508]], 21],
'delete': ['delete', 'Deletes a key pair ', [['lib/zend/Zend/Service/Amazon/Ec2','Keypair.php',110],['lib/google/src/Google/Service','Reseller.php',440],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',1006],['lib/adodb','adodb-active-recordx.inc.php',949],['lib/zend/Zend/Service/Delicious','Post.php',236],['lib/grade','grade_object.php',270],['lib/zend/Zend/Gdata','Gapps.php',258],['lib/google/src/Google/Service','Fusiontables.php',644],['lib/google/src/Google/Service','Fusiontables.php',809],['lib/google/src/Google/Service','Fusiontables.php',934],['lib/google/src/Google/Service','Fusiontables.php',1127],['lib/google/src/Google/Service','Fusiontables.php',1188],['blog','locallib.php',325],['lib/google/src/Google/Service','Blogger.php',1051],['lib/google/src/Google/Service','Blogger.php',1212],['lib/google/src/Google/Service','Blogger.php',1434],['lib/portfolio','plugin.php',692],['lib/google/src/Google/Service','AdExchangeBuyer.php',605],['lib/google/src/Google/Service','Manager.php',240],['lib/google/src/Google/Service','Manager.php',320],['lib/zend/Zend/Service/Amazon/Ec2','Securitygroups.php',137],['lib','webdavlib.php',691],['lib/grade','grade_item.php',354],['lib/google/src/Google/Service','Gmail.php',686],['lib/google/src/Google/Service','Gmail.php',843],['lib/google/src/Google/Service','Gmail.php',936],['lib/google/src/Google/Service','Gmail.php',1146],['course','lib.php',3133],['lib/google/src/Google/Service','Mirror.php',424],['lib/google/src/Google/Service','Mirror.php',592],['lib/google/src/Google/Service','Mirror.php',660],['lib/google/src/Google/Service','Mirror.php',771],['lib/google/src/Google/Service','Genomics.php',632],['lib/google/src/Google/Service','Genomics.php',731],['lib/google/src/Google/Service','Genomics.php',963],['lib/google/src/Google/Service','Genomics.php',1327],['lib/google/src/Google/Service','Genomics.php',1399],['cache/classes','interfaces.php',161],['lib/google/src/Google/Service','Dfareporting.php',470],['lib/zend/Zend/Gdata/Gbase','ItemEntry.php',133],['lib/google/src/Google/Service','Licensing.php',221],['lib/google/src/Google/Service','Drive.php',1462],['lib/google/src/Google/Service','Drive.php',1536],['lib/google/src/Google/Service','Drive.php',1681],['lib/google/src/Google/Service','Drive.php',1932],['lib/google/src/Google/Service','Drive.php',2002],['lib/google/src/Google/Service','Drive.php',2131],['lib/google/src/Google/Service','Drive.php',2294],['lib/google/src/Google/Service','Drive.php',2414],['completion','data_object.php',272],['lib/google/src/Google/Service','Books.php',1804],['lib/zend/Zend/Gdata','App.php',914],['lib/google/src/Google/Cache','Memcache.php',142],['lib/google/src/Google/Service','Bigquery.php',512],['lib/google/src/Google/Service','Bigquery.php',822],['cache','disabledlib.php',102],['lib/zend/Zend/Server','Cache.php',132],['lib/zend/Zend/Gdata/App','Entry.php',212],['cache/stores/memcached','lib.php',368],['lib/google/src/Google/Service','YouTube.php',1470],['lib/google/src/Google/Service','YouTube.php',1979],['lib/google/src/Google/Service','YouTube.php',2277],['lib/google/src/Google/Service','YouTube.php',2510],['lib/google/src/Google/Service','YouTube.php',2657],['lib/google/src/Google/Service','YouTube.php',2998],['lib/google/src/Google/Service','YouTube.php',3196],['lib/google/src/Google/Service','Webmasters.php',298],['lib/google/src/Google/Service','Webmasters.php',388],['lib/google/src/Google/Service','Autoscaler.php',314],['lib/google/src/Google/Service','Autoscaler.php',428],['calendar','lib.php',2388],['lib/zend/Zend/Service/Amazon','Sqs.php',129],['lib/google/src/Google/Service','ShoppingContent.php',553],['lib/google/src/Google/Service','ShoppingContent.php',735],['lib/google/src/Google/Service','ShoppingContent.php',969],['mod/lesson','locallib.php',1039],['mod/lesson','locallib.php',2274],['lib/google/src/Google/Service','SQLAdmin.php',628],['lib/google/src/Google/Service','SQLAdmin.php',923],['lib/google/src/Google/Service','Fitness.php',458],['lib/google/src/Google/Service','Fitness.php',563],['lib/google/src/Google/Service','TagManager.php',1049],['lib/google/src/Google/Service','TagManager.php',1140],['lib/google/src/Google/Service','TagManager.php',1233],['lib/google/src/Google/Service','TagManager.php',1326],['lib/google/src/Google/Service','TagManager.php',1419],['lib/google/src/Google/Service','TagManager.php',1513],['lib/google/src/Google/Service','TagManager.php',1607],['lib/google/src/Google/Service','TagManager.php',1757],['lib/google/src/Google/Service','Directory.php',1300],['lib/google/src/Google/Service','Directory.php',1477],['lib/google/src/Google/Service','Directory.php',1587],['lib/google/src/Google/Service','Directory.php',1642],['lib/google/src/Google/Service','Directory.php',1769],['lib/google/src/Google/Service','Directory.php',1838],['lib/google/src/Google/Service','Directory.php',1935],['lib/google/src/Google/Service','Directory.php',2042],['lib/google/src/Google/Service','Directory.php',2144],['lib/google/src/Google/Service','Directory.php',2205],['lib/google/src/Google/Service','Directory.php',2405],['lib/google/src/Google/Service','Directory.php',2480],['cache/stores/static','lib.php',374],['lib/google/src/Google/Service','AppState.php',153],['lib/google/src/Google/Service','Taskqueue.php',292],['lib/google/src/Google/Service','Container.php',343],['lib/google/src/Google/Service','AndroidPublisher.php',1177],['lib/google/src/Google/Service','AndroidPublisher.php',1257],['lib/google/src/Google/Service','AndroidPublisher.php',1595],['lib/google/src/Google/Service','AndroidPublisher.php',1690],['lib/google/src/Google/Service','AndroidPublisher.php',1972],['repository','lib.php',427],['repository','lib.php',2012],['lib','accesslib.php',5529],['lib/google/src/Google/Service','AdSenseHost.php',733],['lib/google/src/Google/Service','AdSenseHost.php',1009],['lib/google/src/Google/Service','AdSenseHost.php',1167],['cache/stores/memcache','lib.php',401],['lib','filelib.php',3440],['lib/google/src/Google/Service','MapsEngine.php',1692],['lib/google/src/Google/Service','MapsEngine.php',1990],['lib/google/src/Google/Service','MapsEngine.php',2343],['lib/google/src/Google/Service','MapsEngine.php',2650],['lib/google/src/Google/Service','MapsEngine.php',2911],['lib/grade','grade_grade.php',955],['comment','lib.php',786],['lib/google/src/Google/Service','SiteVerification.php',138],['lib/google/src/Google/Service','Prediction.php',261],['cache/stores/session','lib.php',417],['cache/classes','dummystore.php',198],['lib/google/src/Google/Service','Compute.php',2812],['lib/google/src/Google/Service','Compute.php',2896],['lib/google/src/Google/Service','Compute.php',3139],['lib/google/src/Google/Service','Compute.php',3225],['lib/google/src/Google/Service','Compute.php',3361],['lib/google/src/Google/Service','Compute.php',3463],['lib/google/src/Google/Service','Compute.php',3543],['lib/google/src/Google/Service','Compute.php',3662],['lib/google/src/Google/Service','Compute.php',3725],['lib/google/src/Google/Service','Compute.php',3844],['lib/google/src/Google/Service','Compute.php',3941],['lib/google/src/Google/Service','Compute.php',4080],['lib/google/src/Google/Service','Compute.php',4406],['lib/google/src/Google/Service','Compute.php',4543],['lib/google/src/Google/Service','Compute.php',4660],['lib/google/src/Google/Service','Compute.php',4740],['lib/google/src/Google/Service','Compute.php',4806],['lib/google/src/Google/Service','Compute.php',4927],['lib/google/src/Google/Service','Compute.php',5069],['lib/google/src/Google/Service','Compute.php',5229],['lib/google/src/Google/Service','Compute.php',5360],['badges/criteria','award_criteria.php',330],['badges/criteria','award_criteria_manual.php',220],['lib/google/src/Google/Service','Calendar.php',886],['lib/google/src/Google/Service','Calendar.php',1040],['lib/google/src/Google/Service','Calendar.php',1228],['lib/google/src/Google/Service','Calendar.php',1362],['lib/google/src/Google/Service','Analytics.php',2068],['lib/google/src/Google/Service','Analytics.php',2211],['lib/google/src/Google/Service','Analytics.php',2293],['lib/google/src/Google/Service','Analytics.php',2414],['lib/google/src/Google/Service','Analytics.php',2631],['lib/google/src/Google/Service','Analytics.php',2760],['lib/google/src/Google/Service','Analytics.php',2851],['lib/google/src/Google/Service','Analytics.php',3181],['lib/google/src/Google/Service','Analytics.php',3406],['lib/google/src/Google/Service','Tasks.php',309],['lib/google/src/Google/Service','Tasks.php',427],['cache/classes','loaders.php',777],['cache/classes','loaders.php',1491],['cache/classes','loaders.php',1859],['cache/stores/mongodb','lib.php',361],['lib/grade','grade_category.php',259],['cache/stores/file','lib.php',392],['lib/google/src/Google/Service','Storage.php',945],['lib/google/src/Google/Service','Storage.php',1060],['lib/google/src/Google/Service','Storage.php',1227],['lib/google/src/Google/Service','Storage.php',1349],['lib/google/src/Google/Service','Storage.php',1565],['admin/tool/uploadcourse/classes','course.php',226],['lib/google/src/Google/Cache','Null.php',51],['lib/filestorage','stored_file.php',323],['lib/filebrowser','virtual_root_file.php',69],['lib/google/src/Google/Service','AdSense.php',1257],['lib/google/src/Google/Service','AdSense.php',1729],['lib/google/src/Google/Service','Pubsub.php',239],['lib/google/src/Google/Service','Pubsub.php',378],['lib/grade','grade_scale.php',136],['lib/filebrowser','file_info.php',418],['lib/google/src/Google/Cache','File.php',106],['lib/htmlpurifier/HTMLPurifier','Zipper.php',89],['lib/google/src/Google/Service','Dns.php',370],['lib/filebrowser','file_info_stored.php',631],['lib/google/src/Google/Service','Replicapool.php',374],['lib/google/src/Google/Service','Resourceviews.php',419],['lib','badgeslib.php',620],['lib/google/src/Google/Cache','Apc.php',103],['lib/adodb','adodb-active-record.inc.php',792],['mnet','peer.php',122],['lib/grade','grade_outcome.php',97]], 260],
'set_field_select': ['set_field_select', 'Set a single field in every table record which match a particular WHERE clause. ', [['lib/dml','pgsql_native_moodle_database.php',1192],['lib/dml','oci_native_moodle_database.php',1387],['lib/dml','sqlsrv_native_moodle_database.php',1111],['lib/dml','mssql_native_moodle_database.php',1033],['lib/dml','mysqli_native_moodle_database.php',1427],['lib/dml/tests','dml_test.php',5431],['lib/dml','pdo_moodle_database.php',491]], 78],
'get_records': ['get_records', 'Get a number of records as an array of objects where all the given conditions met. ', [['lib/dml','moodle_database.php',1236],['lib','coursecatlib.php',654],['question','category_class.php',63]], 860],
'is_raw_used': ['is_raw_used', 'Returns true if grade items uses raw grades ', [['lib/grade','grade_item.php',990]], 3],
'update': ['update', 'Update a customer resource if one it exists and is owned by the reseller. (customers.update) ', [['lib/google/src/Google/Service','Reseller.php',343],['mod/lesson/pagetypes','matching.php',308],['lib/adodb','adodb-active-recordx.inc.php',1047],['lib/grade','grade_object.php',238],['lib/google/src/Google/Service','Fusiontables.php',726],['lib/google/src/Google/Service','Fusiontables.php',889],['lib/google/src/Google/Service','Fusiontables.php',1095],['lib/google/src/Google/Service','Fusiontables.php',1269],['grade/grading/form','lib.php',905],['lib/google/src/Google/Service','Blogger.php',1332],['lib/google/src/Google/Service','Blogger.php',1630],['lib/google/src/Google/Service','Doubleclicksearch.php',325],['lib/google/src/Google/Service','AdExchangeBuyer.php',392],['lib/google/src/Google/Service','AdExchangeBuyer.php',684],['lib/grade','grade_item.php',260],['lib/google/src/Google/Service','Gmail.php',756],['lib/google/src/Google/Service','Gmail.php',908],['lib/google/src/Google/Service','Mirror.php',495],['lib/google/src/Google/Service','Mirror.php',633],['lib/google/src/Google/Service','Mirror.php',744],['lib/google/src/Google/Service','Genomics.php',690],['lib/google/src/Google/Service','Genomics.php',811],['lib/google/src/Google/Service','Genomics.php',1064],['lib/google/src/Google/Service','Genomics.php',1370],['lib/google/src/Google/Service','Genomics.php',1521],['lib/google/src/Google/Service','Dfareporting.php',570],['lib/google/src/Google/Service','PlusDomains.php',691],['lib/google/src/Google/Service','Licensing.php',332],['lib/google/src/Google/Service','Drive.php',1624],['lib/google/src/Google/Service','Drive.php',1859],['lib/google/src/Google/Service','Drive.php',2100],['lib/google/src/Google/Service','Drive.php',2211],['lib/google/src/Google/Service','Drive.php',2261],['lib/google/src/Google/Service','Drive.php',2385],['lib/google/src/Google/Service','Drive.php',2473],['completion','data_object.php',251],['lib/google/src/Google/Service','Books.php',1901],['lib/google/src/Google/Service','Bigquery.php',603],['lib/google/src/Google/Service','Bigquery.php',911],['lib/google/src/Google/Service','Groupssettings.php',137],['lib/google/src/Google/Service','YouTube.php',1596],['lib/google/src/Google/Service','YouTube.php',1697],['lib/google/src/Google/Service','YouTube.php',2201],['lib/google/src/Google/Service','YouTube.php',2439],['lib/google/src/Google/Service','YouTube.php',2613],['lib/google/src/Google/Service','YouTube.php',2809],['lib/google/src/Google/Service','YouTube.php',3419],['lib/google/src/Google/Service','Coordinate.php',568],['lib/google/src/Google/Service','Coordinate.php',680],['lib/google/src/Google/Service','Autoscaler.php',399],['calendar','lib.php',2171],['lib/google/src/Google/Service','ShoppingContent.php',633],['lib/google/src/Google/Service','ShoppingContent.php',815],['lib','weblib.php',3154],['mod/lesson','locallib.php',2682],['lib/google/src/Google/Service','SQLAdmin.php',843],['lib/google/src/Google/Service','Fitness.php',424],['lib/google/src/Google/Service','Fitness.php',607],['lib/google/src/Google/Service','TagManager.php',1004],['lib/google/src/Google/Service','TagManager.php',1093],['lib/google/src/Google/Service','TagManager.php',1186],['lib/google/src/Google/Service','TagManager.php',1279],['lib/google/src/Google/Service','TagManager.php',1372],['lib/google/src/Google/Service','TagManager.php',1466],['lib/google/src/Google/Service','TagManager.php',1560],['lib/google/src/Google/Service','TagManager.php',1711],['lib/google/src/Google/Service','TagManager.php',1804],['mod/lesson/pagetypes','truefalse.php',163],['lib/google/src/Google/Service','Directory.php',1446],['lib/google/src/Google/Service','Directory.php',1559],['lib/google/src/Google/Service','Directory.php',1724],['lib/google/src/Google/Service','Directory.php',1907],['lib/google/src/Google/Service','Directory.php',2014],['lib/google/src/Google/Service','Directory.php',2116],['lib/google/src/Google/Service','Directory.php',2337],['lib/google/src/Google/Service','Directory.php',2523],['lib/xhprof/xhprof_html/jquery','jquery.tooltip.js',200],['lib/google/src/Google/Service','AppState.php',201],['lib/google/src/Google/Service','Taskqueue.php',397],['lib/google/src/Google/Service','AndroidPublisher.php',1360],['lib/google/src/Google/Service','AndroidPublisher.php',1472],['lib/google/src/Google/Service','AndroidPublisher.php',1542],['lib/google/src/Google/Service','AndroidPublisher.php',1780],['lib/google/src/Google/Service','AndroidPublisher.php',1846],['lib/google/src/Google/Service','AndroidPublisher.php',1928],['lib/google/src/Google/Service','AndroidPublisher.php',2066],['mod/lesson/pagetypes','essay.php',158],['lib/google/src/Google/Service','AdSenseHost.php',845],['lib/google/src/Google/Service','AdSenseHost.php',1096],['lib/google/src/Google/Service','Games.php',1507],['lib/grade','grade_grade.php',940],['lib/google/src/Google/Service','SiteVerification.php',226],['lib/horde/framework/Horde/Support','Array.php',70],['lib/google/src/Google/Service','Prediction.php',338],['lib/google/src/Google/Service','Compute.php',2999],['lib/google/src/Google/Service','Compute.php',3310],['lib/google/src/Google/Service','Compute.php',3814],['lib/google/src/Google/Service','Compute.php',5314],['lib/google/src/Google/Service','Calendar.php',979],['lib/google/src/Google/Service','Calendar.php',1144],['lib/google/src/Google/Service','Calendar.php',1285],['lib/google/src/Google/Service','Calendar.php',1633],['lib/google/src/Google/Service','Analytics.php',2118],['lib/google/src/Google/Service','Analytics.php',2385],['lib/google/src/Google/Service','Analytics.php',2495],['lib/google/src/Google/Service','Analytics.php',2602],['lib/google/src/Google/Service','Analytics.php',2730],['lib/google/src/Google/Service','Analytics.php',2821],['lib/google/src/Google/Service','Analytics.php',2944],['lib/google/src/Google/Service','Analytics.php',3277],['lib/google/src/Google/Service','Analytics.php',3379],['lib/google/src/Google/Service','Analytics.php',3461],['lib/google/src/Google/Service','Tasks.php',385],['lib/google/src/Google/Service','Tasks.php',555],['lib/horde/framework/Horde/Imap/Client/Ids','Map.php',72],['grade/grading/form/guide','lib.php',826],['lib/grade','grade_category.php',204],['lib/google/src/Google/Service','Storage.php',1030],['lib/google/src/Google/Service','Storage.php',1165],['lib/google/src/Google/Service','Storage.php',1318],['lib/google/src/Google/Service','Storage.php',1454],['lib/google/src/Google/Service','Storage.php',1718],['lib/filestorage','stored_file.php',103],['grade/grading/form/rubric','lib.php',828],['lib/grade','grade_scale.php',125],['lib','coursecatlib.php',441],['lib/adodb','adodb-active-record.inc.php',878],['lib/grade','grade_outcome.php',144],['mod/lesson/pagetypes','branchtable.php',262]], 290],
'grade_update_mod_grades': ['grade_update_mod_grades', 'Force full update of module grades in central gradebook ', [['lib','gradelib.php',1196]], 6],
'update_final_grade': ['update_final_grade', 'Updates final grade value for given user, this is a only way to update final grades from gradebook and import because it logs the change in history table and deals with overridden flag. This flag is set to prevent later overriding from raw grades submitted from modules. ', [['lib/grade','grade_item.php',1521]], 14],
'bounded_grade': ['bounded_grade', 'Makes sure value is a valid grade value. ', [['lib/grade','grade_item.php',1354]], 18],
'fetch': ['fetch', 'Fetches the available update status from the remote site ', [['lib/classes/update','checker.php',113],['lib/minify/lib/Minify/Cache','XCache.php',86],['lib/grade','grade_object.php',126],['completion/criteria','completion_criteria_unenrol.php',43],['completion/criteria','completion_criteria_grade.php',45],['lib/grade','grade_item.php',332],['lib/minify/lib/Minify/Cache','Memcache.php',97],['lib/minify/lib/Minify/Cache','APC.php',91],['completion/criteria','completion_criteria_activity.php',45],['lib/horde/framework/Horde/Imap/Client','Base.php',2373],['completion','data_object.php',152],['completion/criteria','completion_criteria_course.php',46],['completion','completion_completion.php',70],['completion/criteria','completion_criteria_role.php',43],['completion','completion_criteria_completion.php',74],['lib/grade','grade_grade.php',576],['lib/minify/lib/Minify/Cache','ZendPlatform.php',97],['completion/criteria','completion_criteria_date.php',43],['lib/grade','grade_category.php',184],['completion/criteria','completion_criteria_self.php',43],['lib/grade','grade_scale.php',89],['lib/minify/lib/Minify/Cache','File.php',90],['completion','completion_aggregation.php',68],['completion/criteria','completion_criteria_duration.php',43],['lib/grade','grade_outcome.php',182]], 192],
'set_field': ['set_field', 'Sets the custom profile field used for testing. ', [['availability/condition/profile/tests','condition_test.php',349],['lib/dml','moodle_database.php',1688]], 462],
'load_scale': ['load_scale', 'Instantiates a grade_scale object from the DB if this item\'s scaleid variable is set ', [['lib/grade','grade_item.php',822],['lib/grade','grade_outcome.php',204]], 13],
'set_parent': ['set_parent', 'Set the parent of the optigroup and, at the same time, process all the condition params in all the childs ', [['backup/util/structure','base_optigroup.class.php',118],['lib/grade','grade_item.php',1318],['lib','listlib.php',183],['lib','listlib.php',624],['backup/util/structure','base_final_element.class.php',62],['backup/util/structure','backup_optigroup_element.class.php',184],['lib/grade','grade_category.php',2172],['lib','navigationlib.php',679]], 28],
'move_after_sortorder': ['move_after_sortorder', 'Update this grade item\'s sortorder so that it will appear after $sortorder ', [['lib/grade','grade_item.php',1220],['lib/grade','grade_category.php',2256]], 9],
'grade_floats_different': ['grade_floats_different', 'Compare two float numbers safely. Uses 5 decimals php precision using {@link grade_floatval()}. Nulls accepted too. Used for determining if a database update is required ', [['lib','gradelib.php',1450]], 26],
'get_parent_category': ['get_parent_category', 'Returns the grade_category object this grade_item belongs to (referenced by categoryid) or category attached to category item. ', [['lib/grade','grade_item.php',868],['lib/grade','grade_category.php',2114]], 28],
'get_record': ['get_record', 'Get a single database record as an object where all the given conditions met. ', [['lib/dml','moodle_database.php',1413]], 2960],
'load_grade_item': ['load_grade_item', 'Loads the grade_item object referenced by $this->itemid and saves it as $this->grade_item for easy access ', [['lib/grade','grade_grade.php',219],['lib/grade','grade_category.php',2051]], 52],
'load_items': ['load_items', 'Loads the scale\'s items into the $scale_items array. There are three ways to achieve this: 1. No argument given: The $scale string is already loaded and exploded to an array of items. 2. A string is given: A comma-separated list of items is exploded into an array of items. 3. An array of items is given and saved directly as the array of items for this scale. ', [['lib/grade','grade_scale.php',166]], 5],
'record_exists': ['record_exists', 'Test whether a record exists in a table where all the given conditions met. ', [['lib/dml','moodle_database.php',1768]], 735],
'get_field_sql': ['get_field_sql', 'Get a single field value (first field) using a SQL statement. ', [['lib/dml','moodle_database.php',1539]], 135],
'is_outcome_item': ['is_outcome_item', 'Is this an outcome item? ', [['lib/grade','grade_item.php',948]], 15],
'compute': ['compute', 'Calculates final grade values using the formula in the calculation property. The parameters are taken from final grades of grade items in current course only. ', [['lib/grade','grade_item.php',1802]], 7],
'is_overridable_item': ['is_overridable_item', 'Is the grade item overridable ', [['lib/grade','grade_item.php',966]], 5],
'get_displaytype': ['get_displaytype', 'Returns the value of the display type ', [['lib/grade','grade_item.php',2084]], 9],
'or': ['or', '', [['lib/tcpdf','LICENSE.TXT',69]], 552],
'get_final': ['get_final', 'Returns the final values for this grade item (as imported by module or other source). ', [['lib/grade','grade_item.php',1128],['lib/grade','grade_category.php',2209]], 12],
'get_decimals': ['get_decimals', 'Returns the value of the decimals field ', [['lib/grade','grade_item.php',2102]], 21],
'is_course_item': ['is_course_item', 'Is the grade item associated with course? ', [['lib/grade','grade_item.php',930]], 29],
'is_external_item': ['is_external_item', 'Is the grade item external - associated with module, plugin or something else? ', [['lib/grade','grade_item.php',957]], 7],
'evaluate': ['evaluate', '', [['lib/evalmath','evalmath.class.php',132],['lib','mathslib.php',83]], 276],
'set_locktime': ['set_locktime', 'Set the locktime for this grade item. ', [['lib/grade','grade_item.php',570],['lib/grade','grade_grade.php',474]], 4],
'generate_grades': ['generate_grades', 'Generates and saves final grades in associated category grade item. These immediate children must already have their own final grades. The category\'s aggregation method is used to generate final grades. ', [['lib/grade','grade_category.php',429]], 1],
'validate_formula': ['validate_formula', 'Validate the formula. ', [['lib/grade','grade_item.php',2005]], 1],
'delete_all_grades': ['delete_all_grades', 'Delete all grades ', [['lib/grade','grade_item.php',365]], 5],
'fetch_all': ['fetch_all', 'Finds and returns all grade_object instances based on $params. ', [['lib/grade','grade_object.php',138],['lib/grade','grade_item.php',343],['completion/criteria','completion_criteria.php',153],['completion','data_object.php',165],['completion','completion_criteria_completion.php',84],['lib/grade','grade_grade.php',586],['lib/grade','grade_category.php',194],['lib/grade','grade_scale.php',100],['completion','completion_aggregation.php',79],['lib/grade','grade_outcome.php',193]], 65],
'get_locktime': ['get_locktime', 'Set the locktime for this grade item. ', [['lib/grade','grade_item.php',581],['lib/grade','grade_grade.php',485]], 5],
'depends_on': ['depends_on', 'Finds out on which other items does this depend directly when doing calculation or category aggregation ', [['lib/grade','grade_item.php',1392]], 12],
'get_idnumber': ['get_idnumber', 'Returns the idnumber of this grade_item. This method is also available in grade_category, for cases where the object type is not know. ', [['lib/grade','grade_item.php',1186],['lib/grade','grade_category.php',2232]], 2],
'get_item_category': ['get_item_category', 'Returns the grade_category for a grade category grade item ', [['lib/grade','grade_item.php',896]], 10],
'denormalize_formula': ['denormalize_formula', 'Denormalizes the calculation formula to [idnumber] form ', [['lib/grade','grade_item.php',1076]], 2],
'get_name': ['get_name', 'Return localised event name. ', [['report/log/classes/event','user_report_viewed.php',54],['mod/wiki/classes/event','page_deleted.php',54],['mod/forum/classes/message/inbound','reply_handler.php',50],['mod/chat/classes/event','sessions_viewed.php',65],['mod/glossary/classes/event','category_deleted.php',46],['mod/workshop/classes/event','assessment_evaluations_reset.php',75],['lib/classes/event','tag_updated.php',58],['lib/classes/event','course_resources_list_viewed.php',60],['mod/lesson/classes/event','content_page_viewed.php',48],['lib/classes/event','blog_association_created.php',56],['lib/classes/event','user_profile_viewed.php',56],['mod/feedback/classes/event','response_submitted.php',60],['backup/util/plan','base_plan.class.php',50],['lib/classes/event','badge_awarded.php',54],['report/outline/classes/event','report_viewed.php',54],['question/classes/bank','checkbox_column.php',32],['mod/assign/classes/event','extension_granted.php',77],['admin/tool/capability/classes/event','report_viewed.php',47],['portfolio/picasa','lib.php',33],['lib/classes/event','message_viewed.php',54],['lib/classes/event','course_category_created.php',48],['mod/quiz/classes/event','group_override_updated.php',54],['lib/classes/task','context_cleanup_task.php',32],['mod/survey/classes/event','response_submitted.php',53],['mod/book/tool/exportimscp/classes/event','book_exported.php',76],['cache/classes','definition.php',604],['report/loglive/classes/event','report_viewed.php',48],['mod/forum/classes/event','post_deleted.php',67],['mod/assign/classes/event','submission_duplicated.php',77],['mod/chat/classes/event','message_sent.php',59],['mod/workshop/classes/event','submission_created.php',63],['lib/classes/event','note_updated.php',56],['mod/lesson/classes/event','group_override_deleted.php',54],['mod/feedback/classes/event','response_deleted.php',57],['lib/classes/event','course_module_instance_list_viewed.php',75],['mod/assign/classes/event','submission_locked.php',78],['enrol/imsenterprise/classes/task','cron_task.php',34],['mod/lesson/classes/event','page_updated.php',72],['admin/tool/messageinbound/classes/task','cleanup_task.php',38],['mod/forum/classes/event','discussion_subscription_deleted.php',66],['mod/quiz/classes/event','attempt_preview_started.php',54],['mod/assign/classes/event','batch_set_workflow_state_viewed.php',79],['mod/lesson/classes/event','user_override_updated.php',54],['lib/classes/task','calendar_cron_task.php',31],['mod/quiz/classes/event','report_viewed.php',56],['mod/lesson/classes/event','question_answered.php',54],['lib/portfolio','plugin.php',120],['mod/forum/classes/event','discussion_viewed.php',60],['mod/workshop/classes/event','submission_viewed.php',63],['lib/classes/task','registration_cron_task.php',31],['mod/assign/submission/file','locallib.php',44],['mod/assign/classes/event','submission_updated.php',57],['mod/workshop/classes/event','submission_reassessed.php',77],['mod/glossary/classes/event','entry_deleted.php',54],['lib/classes/task','portfolio_cron_task.php',31],['lib/classes/event','user_created.php',48],['question/classes/bank','preview_action_column.php',26],['mod/data/classes/event','field_updated.php',57],['mod/assign/submission/onlinetext','locallib.php',40],['mod/data/classes/event','template_updated.php',56],['lib/classes/event','comment_created.php',58],['lib/classes/event','cohort_deleted.php',49],['lib/grade','grade_item.php',1274],['mod/scorm/classes/event','tracks_viewed.php',64],['lib/classes/task','file_temp_cleanup_task.php',31],['lib/classes/event','course_viewed.php',75],['grade/report/overview/classes/event','grade_report_viewed.php',48],['lib/classes/task','stats_cron_task.php',31],['grade/report/user/classes/event','grade_report_viewed.php',48],['lib/classes/event','course_content_deleted.php',54],['lib/classes/task','backup_cleanup_task.php',31],['grade/report/singleview/classes/event','grade_report_viewed.php',39],['mod/quiz/classes/event','attempt_abandoned.php',63],['admin/tool/log/store/legacy/classes/task','cleanup_task.php',31],['mod/workshop/classes/event','phase_switched.php',75],['lib/classes/event','base.php',282],['grade/report/history/classes/event','grade_report_viewed.php',39],['lib/classes/event','content_viewed.php',80],['backup/util/ui','backup_ui.class.php',194],['lib/classes/event','course_completion_updated.php',47],['report/completion/classes/event','report_viewed.php',49],['lib/dml','pgsql_native_moodle_database.php',88],['backup/util/settings','base_setting.class.php',145],['lib/classes/task','messaging_cleanup_task.php',31],['question/classes/bank','modifier_name_column.php',27],['mod/forum/classes/event','discussion_updated.php',65],['lib/classes/event','course_reset_ended.php',53],['mod/choice/classes/event','answer_submitted.php',72],['mod/forum/classes/event','assessable_uploaded.php',86],['mod/wiki/classes/event','page_diff_viewed.php',55],['lib/classes/event','course_category_updated.php',51],['admin/tool/langimport/classes/event','langpack_updated.php',80],['lib/classes/task','session_cleanup_task.php',31],['lib/classes/task','completion_cron_task.php',31],['lib/classes/event','webservice_service_created.php',65],['lib/classes/event','course_created.php',55],['lib/dml','oci_native_moodle_database.php',94],['mod/lesson/classes/event','lesson_started.php',48],['mod/assign/classes/event','grading_table_viewed.php',79],['lib/classes/event','calendar_event_deleted.php',58],['backup/util/plan','base_task.class.php',58],['lib/classes/event','group_created.php',65],['mod/quiz/classes/event','user_override_created.php',53],['mod/glossary/classes/event','category_updated.php',46],['repository/coursefiles','lib.php',183],['mod/assign/classes/event','submission_viewed.php',76],['mod/glossary/classes/event','entry_disapproved.php',46],['lib/classes/event','user_password_updated.php',70],['mod/assign/classes/event','all_submissions_downloaded.php',75],['lib/dml','mariadb_native_moodle_database.php',41],['lib/classes/event','role_deleted.php',55],['admin/tool/log/store/legacy/tests/fixtures','event.php',31],['backup/util/ui','restore_ui.class.php',349],['lib/classes/event','user_loggedinas.php',57],['mod/assign/classes/event','submission_confirmation_form_viewed.php',79],['mod/assign/tests/fixtures','event_mod_assign_fixtures.php',62],['lib','modinfolib.php',1285],['mod/lesson/classes/event','essay_attempt_viewed.php',48],['mod/forum/classes/event','discussion_moved.php',66],['mod/assign/submission/onlinetext/classes/event','assessable_uploaded.php',83],['mod/assign/classes/event','reveal_identities_confirmation_page_viewed.php',79],['mod/survey/classes/event','report_downloaded.php',55],['mod/wiki/classes/event','page_updated.php',54],['admin/tool/log/store/standard/tests/fixtures','event.php',31],['mod/assign/classes/event','submission_unlocked.php',78],['lib/classes/event','user_list_viewed.php',56],['mod/forum/classes/event','readtracking_disabled.php',64],['lib/classes/event','comments_viewed.php',51],['lib/classes/event','cohort_member_added.php',49],['lib/classes/event','grouping_created.php',65],['lib/classes/event','recent_activity_viewed.php',49],['lib/classes/event','role_allow_switch_updated.php',47],['lib/dml','sqlsrv_native_moodle_database.php',102],['admin/tool/messageinbound/classes/message/inbound','invalid_recipient_handler.php',60],['mod/lti','OAuth.php',122],['mod/lti','OAuth.php',149],['mod/lti','OAuth.php',173],['question/classes/bank','question_name_column.php',28],['lib/classes/event','user_login_failed.php',56],['lib/classes/event','message_contact_added.php',48],['lib','enrollib.php',1075],['question/classes/bank','question_text_row.php',35],['lib/classes/event','role_allow_assign_updated.php',47],['mod/quiz/classes/event','user_override_deleted.php',53],['user/selector','lib.php',309],['mod/quiz/classes/event','edit_page_viewed.php',53],['lib/classes/event','email_failed.php',48],['portfolio/flickr','lib.php',41],['admin/tool/langimport/classes/task','update_langpacks_task.php',35],['lib/classes/event','tag_removed.php',58],['mod/lesson/classes/event','highscores_viewed.php',48],['report/stats/classes/event','user_report_viewed.php',48],['mod/quiz/classes/event','group_override_deleted.php',54],['mod/book/classes/event','chapter_updated.php',79],['lib/classes/log','reader.php',30],['mod/lesson/classes/event','question_viewed.php',54],['mod/scorm/classes/event','interactions_viewed.php',63],['lib/classes/event','course_module_updated.php',57],['mod/forum/classes/event','discussion_subscription_created.php',66],['lib/classes/task','plagiarism_cron_task.php',31],['mod/quiz/classes/event','question_manually_graded.php',55],['lib/classes/event','mnet_access_control_created.php',57],['lib/classes/event','role_assigned.php',56],['admin/tool/messageinbound/classes/task','pickup_task.php',38],['mod/lti/classes/local/ltiservice','service_base.php',87],['lib/classes/event','unknown_logged.php',43],['lib/simplepie/library/SimplePie','Author.php',106],['mod/scorm/classes/event','user_report_viewed.php',62],['admin/tool/monitor/classes/event','subscription_criteria_met.php',55],['mod/forum/classes/task','cron_task.php',30],['report/participation/classes/event','report_viewed.php',58],['lib/classes/event','user_updated.php',48],['backup/util/plan','base_step.class.php',49],['lib/classes/event','course_section_updated.php',56],['lib/classes/event','comment_deleted.php',58],['mod/assign/classes/event','marker_updated.php',89],['lib/classes/event','webservice_login_failed.php',71],['mod/assign/submission/file/classes/event','assessable_uploaded.php',85],['admin/tool/log/store/database/tests/fixtures','event.php',31],['mod/lti/classes/event','unknown_service_api_called.php',82],['lib/classes/event','cohort_updated.php',49],['mod/assign/submission/comments','locallib.php',39],['lib/editor/tinymce/classes','plugin.php',101],['mod/forum/classes/event','post_updated.php',67],['mod/book/classes/event','chapter_viewed.php',79],['portfolio/download','lib.php',9],['lib/classes/event','note_deleted.php',56],['lib/classes/event','user_loggedout.php',54],['lib/classes/event','grade_report_viewed.php',54],['lib/classes/task','file_trash_cleanup_task.php',31],['mod/assign/classes/event','workflow_state_updated.php',88],['mod/book/classes/event','chapter_deleted.php',79],['lib/classes/event','course_deleted.php',56],['lib/classes/event','blog_entry_deleted.php',53],['admin/tool/log/store/legacy/classes/event','legacy_logged.php',35],['question/classes/bank','copy_action_column.php',35],['mod/assign/feedback/editpdf','locallib.php',43],['lib/classes/event','webservice_token_created.php',65],['lib/tests/fixtures','task_fixtures.php',35],['lib/tests/fixtures','task_fixtures.php',44],['lib/tests/fixtures','task_fixtures.php',53],['mod/forum/classes/event','course_searched.php',66],['lib/classes/event','group_updated.php',65],['mod/quiz/classes/event','attempt_started.php',56],['mod/lesson/classes/event','group_override_updated.php',54],['lib/classes/event','course_module_viewed.php',62],['lib/classes/event','mnet_access_control_updated.php',57],['mod/quiz/classes/question/bank','add_action_column.php',45],['question/classes/bank','edit_action_column.php',35],['lib/classes/message/inbound','private_files_handler.php',56],['lib/tests/fixtures','event_fixtures.php',34],['lib/classes/task','password_reset_cleanup_task.php',31],['mod/quiz/classes/event','attempt_submitted.php',63],['mod/data/classes/event','field_created.php',58],['lib/classes/task','automated_backup_task.php',31],['lib/classes/event','question_category_created.php',48],['admin/tool/monitor/classes/event','rule_deleted.php',50],['backup/util/ui','restore_ui_stage.class.php',75],['backup/converter/moodle1','lib.php',1033],['mod/lesson/classes/event','group_override_created.php',55],['mod/workshop/classes/event','assessments_reset.php',74],['mod/lesson/classes/event','lesson_resumed.php',48],['mod/assign/classes/event','feedback_viewed.php',76],['grade/report/outcomes/classes/event','grade_report_viewed.php',39],['lib/classes/event','blog_entry_updated.php',74],['report/questioninstances/classes/event','report_viewed.php',55],['mod/assign/classes/event','submission_form_viewed.php',82],['mod/folder/classes/event','folder_updated.php',48],['mod/assign/classes/event','submission_created.php',57],['mod/assign/classes/event','statement_accepted.php',77],['lib/classes/event','grade_deleted.php',94],['lib/classes/event','role_capabilities_updated.php',51],['lib/classes/event','blog_entries_viewed.php',62],['lib/tests','messageinbound_test.php',170],['mod/wiki/classes/event','page_viewed.php',48],['lib/classes/event','group_deleted.php',65],['question/classes/bank','delete_action_column.php',36],['lib/classes/event','webservice_token_sent.php',56],['mod/quiz/classes/event','attempt_becameoverdue.php',66],['lib/classes/task','create_contexts_task.php',31],['mod/quiz/classes/event','attempt_viewed.php',54],['mod/assign/classes/event','submission_status_updated.php',79],['mod/assign/classes/event','grading_form_viewed.php',82],['calendar/tests','calendartype_test_example.php',32],['lib/classes/event','course_module_completion_updated.php',48],['mod/assign/feedback/file','locallib.php',45],['mod/workshop/classes/event','assessment_evaluated.php',66],['report/log/classes/event','report_viewed.php',58],['lib/classes/event','course_module_deleted.php',56],['lib/dml','mssql_native_moodle_database.php',83],['repository','lib.php',1884],['mod/book/classes/event','chapter_created.php',79],['mod/quiz/classes/question/bank','question_name_text_column.php',37],['mod/workshop/classes/event','submission_assessed.php',76],['lib/classes/event','cohort_created.php',49],['lib/classes/event','webservice_function_called.php',67],['mod/scorm/classes/event','sco_launched.php',64],['lib/classes/event','blog_entry_created.php',76],['lib/classes/event','user_enrolment_created.php',53],['mod/data/classes/event','record_created.php',56],['mod/quiz/classes/event','attempt_summary_viewed.php',56],['lib/classes/event','user_enrolment_updated.php',53],['admin/tool/log/store/standard/classes/task','cleanup_task.php',31],['mod/quiz/classes/event','attempt_reviewed.php',53],['lib/classes/task','cache_cleanup_task.php',31],['mod/lesson/classes/event','page_moved.php',56],['mod/glossary/classes/event','category_created.php',46],['mod/lesson/classes/event','page_created.php',54],['lib/classes/event','cohort_member_removed.php',50],['grade/report/singleview/classes/local/ui','unique_name.php',38],['mod/wiki/classes/event','page_version_viewed.php',54],['lib/classes/task','badges_cron_task.php',31],['lib/classes/event','role_allow_override_updated.php',47],['lib/classes/task','cache_cron_task.php',31],['mod/workshop/classes/event','assessable_uploaded.php',93],['lib/classes/event','grouping_updated.php',65],['admin/tool/monitor/classes/event','rule_updated.php',50],['lib/classes/event','course_module_created.php',86],['lib/classes/event','tag_added.php',58],['admin/tool/langimport/classes/event','langpack_removed.php',89],['mod/assign/classes/event','assessable_submitted.php',109],['mod/workshop/classes/event','submission_updated.php',63],['mod/lesson/classes/event','page_deleted.php',54],['lib/classes/event','grouping_deleted.php',72],['backup/util/ui','backup_ui_setting.class.php',86],['grade/report/singleview/classes/local/ui','grade_attribute_format.php',56],['backup/converter','convertlib.php',109],['lib/classes/event','tag_flagged.php',55],['mod/wiki/classes/event','page_history_viewed.php',48],['lib/classes/task','question_cron_task.php',31],['mod/survey/classes/event','report_viewed.php',55],['lib/classes/event','tag_created.php',55],['report/stats/classes/event','report_viewed.php',56],['lib/classes/event','note_created.php',56],['lib/simplepie/library/SimplePie','Credit.php',139],['lib/bennu','iCalendar_components.php',37],['lib/dml','mysqli_native_moodle_database.php',352],['lib/classes/event','course_reset_started.php',53],['admin/tool/monitor/classes/event','subscription_created.php',50],['mod/book/tool/print/classes/event','book_printed.php',76],['lib/classes/event','webservice_service_user_removed.php',59],['mod/data/classes/event','record_deleted.php',56],['mod/choice/classes/event','answer_updated.php',72],['message/tests/fixtures','inbound_fixtures.php',41],['lib/classes/event','group_member_removed.php',69],['mod/glossary/classes/event','entry_viewed.php',48],['mod/forum/classes/event','user_report_viewed.php',65],['lib/classes/event','course_category_deleted.php',59],['lib/classes/task','events_cron_task.php',31],['mod/forum/classes/event','subscription_created.php',65],['lib/classes/event','calendar_event_created.php',58],['lib/classes/event','message_contact_blocked.php',48],['lib/classes/event','webservice_service_updated.php',59],['backup/util/ui','base_ui_stage.class.php',110],['mod/wiki/classes/event','page_version_restored.php',54],['lib/classes/task','delete_unconfirmed_users_task.php',31],['mod/data/classes/event','template_viewed.php',55],['lib/classes/event','course_user_report_viewed.php',66],['mod/data/classes/event','record_updated.php',56],['mod/wiki/classes/event','page_map_viewed.php',54],['mod/wiki/classes/event','page_locks_deleted.php',54],['lib/classes/event','webservice_service_deleted.php',59],['lib/grade','grade_category.php',2128],['mod/forum/classes/event','readtracking_enabled.php',64],['mod/assign/feedback/comments','locallib.php',36],['question/behaviour','behaviourbase.php',83],['calendar/type/gregorian/classes','structure.php',29],['lib/classes/event','role_unassigned.php',53],['lib/classes/task','tag_cron_task.php',31],['lib/classes/task','blog_cron_task.php',31],['lib/classes/event','course_restored.php',58],['backup/util/structure','base_atom.class.php',71],['portfolio/boxnet','lib.php',14],['mod/choice/classes/event','report_viewed.php',47],['lib/classes/event','user_deleted.php',57],['lib/classes/event','user_enrolment_deleted.php',54],['lib/classes/task','send_failed_login_notifications_task.php',34],['mod/book/tool/print/classes/event','chapter_printed.php',79],['mod/assign/classes/event','identities_revealed.php',75],['lib/classes/event','user_graded.php',96],['lib/classes/event','course_updated.php',58],['admin/tool/log/classes/helper','reader.php',41],['mod/forum/classes/event','post_created.php',67],['mod/data/classes/event','field_deleted.php',57],['lib/classes/event','tag_deleted.php',55],['mod/glossary/classes/event','entry_created.php',52],['mod/forum/classes/event','discussion_created.php',65],['mod/forum/classes/event','discussion_deleted.php',66],['mod/scorm/classes/event','attempt_deleted.php',62],['mod/lesson/classes/event','lesson_ended.php',49],['lib/grade','grade_scale.php',156],['admin/tool/monitor/classes','subscription.php',123],['mod/forum/classes/event','subscribers_viewed.php',65],['backup/util/structure','restore_path_element.class.php',98],['mod/scorm/classes/event','report_viewed.php',63],['lib/classes/task','grade_cron_task.php',31],['grade/report/grader/classes/event','grade_report_viewed.php',39],['lib/dml/tests','dml_test.php',5409],['mod/lesson/classes/event','user_override_deleted.php',53],['report/completion/classes/event','user_report_viewed.php',49],['admin/tool/langimport/classes/event','langpack_imported.php',80],['mod/forum/classes/event','subscription_deleted.php',65],['mod/assign/feedback/offline','locallib.php',42],['mod/lesson/classes/event','highscore_added.php',56],['mod/lesson/classes/event','essay_assessed.php',78],['lib/classes/event','message_sent.php',82],['lib/classes/event','message_contact_removed.php',48],['lib/classes/event','tag_unflagged.php',55],['mod/assign/classes/event','submission_graded.php',78],['lib','csslib.php',2155],['lib','csslib.php',2283],['mod/assign/classes/event','batch_set_marker_allocation_viewed.php',79],['report/outline/classes/event','activity_report_viewed.php',48],['lib/classes/event','calendar_event_updated.php',58],['mod/lesson/classes/event','user_override_created.php',53],['lib/classes/task','legacy_plugin_cron_task.php',33],['portfolio/googledocs','lib.php',54],['mod/workshop/classes/event','assessment_reevaluated.php',76],['lib/dml','pdo_moodle_database.php',113],['lib','medialib.php',345],['mod/quiz/classes/event','user_override_updated.php',54],['lib/classes/event','webservice_service_user_added.php',59],['admin/tool/monitor/classes/event','subscription_deleted.php',50],['lib/classes/event','notes_viewed.php',49],['mod/glossary/classes/event','entry_updated.php',52],['admin/tool/monitor/classes/event','rule_created.php',50],['lib/classes/task','check_for_updates_task.php',31],['mod/wiki/classes/event','page_version_deleted.php',54],['lib/classes/event','course_completed.php',73],['mod/assign/classes/event','submission_status_viewed.php',81],['portfolio/mahara','lib.php',61],['mod/glossary/classes/event','entry_approved.php',46],['mod/wiki/classes/event','page_created.php',48],['mod/quiz/classes/event','group_override_created.php',55],['lib/classes/task','delete_incomplete_users_task.php',31],['question/classes/bank','creator_name_column.php',28],['lib/classes/event','group_member_added.php',78],['lib/classes/event','message_contact_unblocked.php',48],['mod/quiz/classes/event','attempt_deleted.php',47],['lib/classes/task','send_new_user_passwords_task.php',31],['lib/classes/event','user_loggedin.php',64],['admin/tool/monitor/classes/task','clean_events.php',32],['question/classes/bank','question_type_column.php',26],['admin/tool/monitor/classes','rule.php',239],['mod/lesson/classes/event','lesson_restarted.php',48],['lib/grade','grade_outcome.php',272]], 409],
'list': ['list', '', [['mod/data/preset/imagegallery','jstemplate.js',9]], 1891],
'get_coursemodule_from_instance': ['get_coursemodule_from_instance', 'Given an instance number of a module, finds the coursemodule description ', [['lib','datalib.php',1331]], 365],
'get_recordset_select': ['get_recordset_select', 'Get a number of records as a moodle_recordset which match a particular WHERE clause. ', [['lib/dml','moodle_database.php',1175]], 35],
'set_sortorder': ['set_sortorder', 'Sets the sortorder of this grade_item. This method is also available in grade_category, for cases where the object type is not know. ', [['lib/grade','grade_item.php',1206],['lib/grade','grade_category.php',2244],['lib/filestorage','stored_file.php',884]], 7],
'normalize_formula': ['normalize_formula', 'Normalizes the calculation formula to [#giXX#] form ', [['lib/grade','grade_item.php',1103]], 3],
'grade_floatval': ['grade_floatval', 'Convert a number to 5 decimal point float, an empty string or a null db compatible format (we need this to decide if db value changed) ', [['lib','gradelib.php',1434]], 53],
'get_grade': ['get_grade', 'Get user\'s course grade in this course ', [['completion/criteria','completion_criteria_grade.php',94],['lib/grade','grade_item.php',1155],['mod/assign','locallib.php',2935],['lib/classes/event','grade_deleted.php',81],['grade/grading/form/guide','lib.php',879],['lib/classes/event','user_graded.php',72],['grade/grading/form/rubric','lib.php',868]], 17],
'is_category_item': ['is_category_item', 'Is the grade item associated with category? ', [['lib/grade','grade_item.php',921]], 28],
'fetch_course_category': ['fetch_course_category', 'Return the course level grade_category object ', [['lib/grade','grade_category.php',2279]], 20],
'force_regrading': ['force_regrading', 'Sets this grade_item\'s needsupdate to true. Also marks the course item as needing update. ', [['lib/grade','grade_item.php',808],['lib/grade','grade_category.php',411]], 29],
'get_sortorder': ['get_sortorder', 'Returns the sortorder of this grade_item. This method is also available in grade_category, for cases where the object type is not know. ', [['lib/grade','grade_item.php',1176],['repository','lib.php',197],['lib/grade','grade_category.php',2220],['lib/filestorage','stored_file.php',875],['lib/filebrowser','virtual_root_file.php',344],['lib/filebrowser','file_info.php',330],['lib/filebrowser','file_info_stored.php',303]], 22],
'plugin_supports': ['plugin_supports', 'Checks whether a plugin supports a specified feature. ', [['lib','moodlelib.php',7193]], 59],
'refresh_grades': ['refresh_grades', 'Refetch grades from modules, plugins. ', [['lib/grade','grade_item.php',1488]], 6],
'load_parent_category': ['load_parent_category', 'Calls upon the get_parent_category method to retrieve the grade_category object from the DB and assigns it to $this->parent_category. It also returns the object. ', [['lib/grade','grade_item.php',883],['lib/grade','grade_category.php',2102]], 13],
'insert': ['insert', 'Creates a customer resource if one does not already exist. (customers.insert) ', [['lib/google/src/Google/Service','Reseller.php',309],['lib/google/src/Google/Service','Reseller.php',473],['lib/adodb','adodb-active-recordx.inc.php',899],['lib/grade','grade_object.php',325],['lib/google/src/Google/Service','Replicapoolupdater.php',294],['lib/google/src/Google/Service','Fusiontables.php',674],['lib/google/src/Google/Service','Fusiontables.php',838],['lib/google/src/Google/Service','Fusiontables.php',1012],['lib/google/src/Google/Service','Fusiontables.php',1217],['lib/google/src/Google/Service','Blogger.php',1243],['lib/google/src/Google/Service','Blogger.php',1493],['lib/google/src/Google/Service','Doubleclicksearch.php',285],['lib/google/src/Google/Service','AdExchangeBuyer.php',476],['lib/google/src/Google/Service','AdExchangeBuyer.php',635],['lib/google/src/Google/Service','Manager.php',271],['lib/google/src/Google/Service','Manager.php',349],['lib/grade','grade_item.php',385],['lib/google/src/Google/Service','Gmail.php',993],['lib/google/src/Google/Service','Plus.php',475],['lib/google/src/Google/Service','Mirror.php',393],['lib/google/src/Google/Service','Mirror.php',451],['lib/google/src/Google/Service','Mirror.php',605],['lib/google/src/Google/Service','Mirror.php',687],['lib/google/src/Google/Service','Mirror.php',801],['lib/google/src/Google/Service','Urlshortener.php',124],['lib/google/src/Google/Service','Dfareporting.php',499],['lib/google/src/Google/Service','PlusDomains.php',481],['lib/google/src/Google/Service','PlusDomains.php',606],['lib/google/src/Google/Service','PlusDomains.php',732],['lib/google/src/Google/Service','PlusDomains.php',781],['lib/google/src/Google/Service','GroupsMigration.php',85],['lib/google/src/Google/Service','Licensing.php',253],['lib/google/src/Google/Service','Drive.php',1491],['lib/google/src/Google/Service','Drive.php',1568],['lib/google/src/Google/Service','Drive.php',1727],['lib/google/src/Google/Service','Drive.php',1961],['lib/google/src/Google/Service','Drive.php',2045],['lib/google/src/Google/Service','Drive.php',2164],['lib/google/src/Google/Service','Drive.php',2328],['completion','data_object.php',316],['lib/google/src/Google/Service','Books.php',1835],['lib/google/src/Google/Service','Bigquery.php',548],['lib/google/src/Google/Service','Bigquery.php',672],['lib/google/src/Google/Service','Bigquery.php',856],['lib/google/src/Google/Service','YouTube.php',1323],['lib/google/src/Google/Service','YouTube.php',1423],['lib/google/src/Google/Service','YouTube.php',1498],['lib/google/src/Google/Service','YouTube.php',2025],['lib/google/src/Google/Service','YouTube.php',2323],['lib/google/src/Google/Service','YouTube.php',2525],['lib/google/src/Google/Service','YouTube.php',2685],['lib/google/src/Google/Service','YouTube.php',3013],['lib/google/src/Google/Service','YouTube.php',3254],['lib/google/src/Google/Service','Coordinate.php',491],['lib/google/src/Google/Service','Autoscaler.php',346],['lib/google/src/Google/Service','ShoppingContent.php',582],['lib/google/src/Google/Service','ShoppingContent.php',764],['lib/google/src/Google/Service','ShoppingContent.php',1000],['lib/google/src/Google/Service','SQLAdmin.php',698],['lib/google/src/Google/Service','SQLAdmin.php',959],['lib/google/src/Google/Service','Directory.php',1504],['lib/google/src/Google/Service','Directory.php',1601],['lib/google/src/Google/Service','Directory.php',1671],['lib/google/src/Google/Service','Directory.php',1964],['lib/google/src/Google/Service','Directory.php',2071],['lib/google/src/Google/Service','Directory.php',2239],['lib/google/src/Google/Service','Directory.php',2419],['lib/google/src/Google/Service','Taskqueue.php',323],['lib/google/src/Google/Service','AndroidPublisher.php',1211],['lib/google/src/Google/Service','AndroidPublisher.php',2002],['lib/google/src/Google/Service','AdSenseHost.php',786],['lib/google/src/Google/Service','AdSenseHost.php',1041],['lib/google/src/Google/Service','AdSenseHost.php',1182],['lib/google/src/Google/Service','MapsEngine.php',2780],['lib/google/src/Google/Service','MapsEngine.php',3184],['lib/grade','grade_grade.php',928],['lib/google/src/Google/Service','SiteVerification.php',180],['lib/google/src/Google/Service','Prediction.php',290],['lib/google/src/Google/Service','Compute.php',2844],['lib/google/src/Google/Service','Compute.php',2944],['lib/google/src/Google/Service','Compute.php',3171],['lib/google/src/Google/Service','Compute.php',3255],['lib/google/src/Google/Service','Compute.php',3393],['lib/google/src/Google/Service','Compute.php',3493],['lib/google/src/Google/Service','Compute.php',3573],['lib/google/src/Google/Service','Compute.php',3757],['lib/google/src/Google/Service','Compute.php',3891],['lib/google/src/Google/Service','Compute.php',3973],['lib/google/src/Google/Service','Compute.php',4165],['lib/google/src/Google/Service','Compute.php',4436],['lib/google/src/Google/Service','Compute.php',4690],['lib/google/src/Google/Service','Compute.php',4838],['lib/google/src/Google/Service','Compute.php',4959],['lib/google/src/Google/Service','Compute.php',5120],['lib/google/src/Google/Service','Compute.php',5259],['lib/google/src/Google/Service','Calendar.php',915],['lib/google/src/Google/Service','Calendar.php',1067],['lib/google/src/Google/Service','Calendar.php',1255],['lib/google/src/Google/Service','Calendar.php',1422],['lib/google/src/Google/Service','Analytics.php',2082],['lib/google/src/Google/Service','Analytics.php',2326],['lib/google/src/Google/Service','Analytics.php',2444],['lib/google/src/Google/Service','Analytics.php',2539],['lib/google/src/Google/Service','Analytics.php',2666],['lib/google/src/Google/Service','Analytics.php',2776],['lib/google/src/Google/Service','Analytics.php',2883],['lib/google/src/Google/Service','Analytics.php',3022],['lib/google/src/Google/Service','Analytics.php',3216],['lib/google/src/Google/Service','Analytics.php',3323],['lib/google/src/Google/Service','Analytics.php',3421],['lib/google/src/Google/Service','Tasks.php',336],['lib/google/src/Google/Service','Tasks.php',456],['lib/grade','grade_category.php',318],['lib/google/src/Google/Service','Storage.php',980],['lib/google/src/Google/Service','Storage.php',1100],['lib/google/src/Google/Service','Storage.php',1262],['lib/google/src/Google/Service','Storage.php',1392],['lib/google/src/Google/Service','Storage.php',1619],['lib/grade','grade_scale.php',111],['lib/google/src/Google/Service','Admin.php',87],['lib/google/src/Google/Service','Replicapool.php',434],['lib/google/src/Google/Service','Resourceviews.php',471],['lib/adodb','adodb-active-record.inc.php',742],['lib/grade','grade_outcome.php',120]], 459],
'is_overridable_item_feedback': ['is_overridable_item_feedback', 'Is the grade item feedback overridable ', [['lib/grade','grade_item.php',981]], 1],
'valid': ['valid', '', [['lib/tests','completionlib_test.php',884],['lib/adodb','adodb.inc.php',2798],['lib/adodb','adodb.inc.php',2874],['lib/google/src/Google','Collection.php',43],['lib/zend/Zend/Server','Definition.php',258],['lib/horde/framework/Horde/Imap/Client/Fetch','Query.php',378],['lib/horde/framework/Horde','Domhtml.php',331],['question/engine','questionusage.php',999],['lib/horde/framework/Horde/Imap/Client','Ids.php',419],['lib/dml','oci_native_moodle_recordset.php',76],['lib/horde/framework/Horde/Imap/Client','Tokenize.php',329],['lib/classes/dml','recordset_walk.php',127],['lib/horde/framework/Horde/Mail/Rfc822','List.php',439],['lib/zend/Zend/Service/Delicious','PostList.php',217],['backup/util/helper','backup_array_iterator.class.php',59],['lib/dml','mssql_native_moodle_recordset.php',83],['lib/dml','pgsql_native_moodle_recordset.php',100],['backup/cc/cc_lib','cc_version11.php',47],['lib/filestorage','zip_archive.php',514],['lib/zend/Zend/Service/Amazon','ResultSet.php',161],['lib/phpexcel/PHPExcel','WorksheetIterator.php',109],['question/engine/tests','helpers.php',1221],['lib/dml','mysqli_native_moodle_recordset.php',82],['lib/zend/Zend/Gdata/App','Feed.php',177],['lib/phpexcel/PHPExcel/Worksheet','RowIterator.php',140],['lib/zend/Zend/Service/Technorati','ResultSet.php',240],['lib/zend/Zend/Service/Flickr','ResultSet.php',178],['lib/zend/Zend/Uri','Http.php',270],['backup/cc/cc_lib','cc_asssesment.php',58],['backup/cc/cc_lib','cc_version1.php',47],['lib/horde/framework/Horde/Imap/Client/Data','AclRights.php',182],['lib/dml','sqlsrv_native_moodle_recordset.php',129],['question/engine','questionattempt.php',1624],['question/engine','questionattempt.php',1743],['lib/zend/Zend/Service/Yahoo','ResultSet.php',186],['backup/util/helper','backup_null_iterator.class.php',49],['lib/phpexcel/PHPExcel/Worksheet','CellIterator.php',119],['lib/dml','pdo_moodle_recordset.php',75]], 69],
'get_records_sql': ['get_records_sql', 'Get a number of records as an array of objects using a SQL statement. ', [['lib/dml','pgsql_native_moodle_database.php',732],['lib/dml','oci_native_moodle_database.php',1102],['lib/dml','sqlsrv_native_moodle_database.php',823],['lib/dml','mssql_native_moodle_database.php',741],['lib/dml','mysqli_native_moodle_database.php',1049],['lib/dml/tests','dml_test.php',5424],['lib/dml','pdo_moodle_database.php',308]], 678],
'check_locktime': ['check_locktime', 'Lock the grade if needed. Make sure this is called only when final grades are valid ', [['lib/grade','grade_item.php',556]], 1],
'is_calculated': ['is_calculated', 'Checks if grade calculated. Returns this object\'s calculation. ', [['lib/grade','grade_item.php',1024]], 14],
'update_raw_grade': ['update_raw_grade', 'Updates raw grade value for given user, this is a only way to update raw grades from external source (modules, etc.), because it logs the change in history table and deals with final grade recalculation. ', [['lib/grade','grade_item.php',1646]], 3],
'get_grade_item': ['get_grade_item', 'Returns this grade_item. This method is also available in grade_category, for cases where the object type is not know. ', [['lib/grade','grade_item.php',1196],['mod/assign','locallib.php',1185],['lib/classes','grades_external.php',284],['lib/grade','grade_category.php',2063]], 23],
'is_overridden': ['is_overridden', 'Checks if grade overridden ', [['lib/grade','grade_grade.php',281]], 12],
'execute': ['execute', 'Exceptionally override the execute method, so, based in the activity_included setting, we are able to skip the execution of one task completely ', [['backup/moodle2','backup_activity_task.class.php',205],['backup/converter/moodle1','backuplib.php',10],['filter/tex','latex.php',60],['backup/util/plan','base_plan.class.php',158],['mod/lti/service/toolsettings/classes/local/resource','systemsettings.php',61],['mod/lti/service/toolsettings/classes/local/resource','linksettings.php',63],['mod/lti/service/profile/classes/local/resource','profile.php',76],['webservice','lib.php',1772],['lib/classes/task','context_cleanup_task.php',41],['lib/adodb','adodb.inc.php',967],['enrol/imsenterprise/classes/task','cron_task.php',43],['admin/tool/messageinbound/classes/task','cleanup_task.php',47],['lib/classes/task','calendar_cron_task.php',40],['mod/workshop/allocation/random','lib.php',83],['lib/classes/task','registration_cron_task.php',40],['lib/classes/task','portfolio_cron_task.php',40],['lib/htmlpurifier/HTMLPurifier/Strategy','Composite.php',21],['lib/google/src/Google/Http','Batch.php',56],['backup/converter/imscc11','lib.php',85],['lib/classes/task','file_temp_cleanup_task.php',40],['filter/tex','texdebug.php',287],['admin/tool/monitor/classes','notification_task.php',39],['lib/classes/task','stats_cron_task.php',40],['lib/classes/task','backup_cleanup_task.php',40],['admin/tool/log/store/legacy/classes/task','cleanup_task.php',40],['backup/util/ui','backup_ui.class.php',122],['lib/dml','pgsql_native_moodle_database.php',665],['lib/classes/task','messaging_cleanup_task.php',40],['lib/zend/Zend/Service/WindowsAzure/RetryPolicy','RetryN.php',68],['lib/classes/task','session_cleanup_task.php',40],['lib/classes/task','completion_cron_task.php',40],['lib/dml','oci_native_moodle_database.php',1009],['backup/util/plan','base_task.class.php',162],['lib/adodb/drivers','adodb-pdo.inc.php',464],['backup/util/plan','backup_plan.class.php',112],['backup/util/ui','restore_ui.class.php',206],['backup/converter/imscc11','backuplib.php',42],['backup/moodle2','restore_activity_task.class.php',183],['','mdeploy.php',743],['lib/dml','sqlsrv_native_moodle_database.php',745],['lib/htmlpurifier/HTMLPurifier/Strategy','MakeWellFormed.php',66],['lib/google/src/Google/Http','REST.php',28],['admin/tool/langimport/classes/task','update_langpacks_task.php',44],['mod/lti/service/toolproxy/classes/local/resource','toolproxy.php',62],['lib/classes/task','plagiarism_cron_task.php',40],['admin/tool/messageinbound/classes/task','pickup_task.php',47],['backup/util/plan','backup_structure_step.class.php',50],['mod/forum/classes/task','cron_task.php',39],['mod/workshop/allocation/scheduled','lib.php',128],['lib/classes/task','file_trash_cleanup_task.php',40],['backup/util/plan','restore_execution_step.class.php',25],['lib/tests/fixtures','task_fixtures.php',30],['lib/tests/fixtures','task_fixtures.php',39],['lib/tests/fixtures','task_fixtures.php',48],['lib/tests/fixtures','task_fixtures.php',57],['admin/tool/installaddon/classes','validator.php',114],['backup/util/plan','backup_execution_step.class.php',25],['lib/classes/task','password_reset_cleanup_task.php',40],['lib/classes/task','automated_backup_task.php',40],['backup/converter/moodle1','lib.php',142],['lib/htmlpurifier/HTMLPurifier/Strategy','ValidateAttributes.php',16],['lib/classes/task','create_contexts_task.php',40],['backup/util/plan','restore_plan.class.php',159],['backup/converter/imscc1','lib.php',84],['lib/dml','mssql_native_moodle_database.php',662],['admin/tool/log/store/standard/classes/task','cleanup_task.php',40],['lib/classes/task','cache_cleanup_task.php',40],['lib/classes/task','badges_cron_task.php',40],['lib/classes/task','cache_cron_task.php',40],['backup/util/interfaces','executable.class.php',32],['lib/htmlpurifier/HTMLPurifier/Strategy','FixNesting.php',41],['lib/adodb/drivers','adodb-oci8po.inc.php',52],['lib/classes/task','question_cron_task.php',40],['lib/zend/Zend/Service/WindowsAzure/RetryPolicy','NoRetry.php',37],['lib/dml','mysqli_native_moodle_database.php',955],['lib/htmlpurifier/HTMLPurifier/Strategy','RemoveForeignElements.php',20],['backup/util/plan/tests/fixtures','plan_fixtures.php',47],['backup/util/plan/tests/fixtures','plan_fixtures.php',55],['lib/classes/task','events_cron_task.php',40],['lib/classes/task','delete_unconfirmed_users_task.php',40],['lib/adodb/drivers','adodb-oci8.inc.php',786],['backup/converter/imscc1','backuplib.php',10],['lib/classes/task','tag_cron_task.php',40],['lib/classes/task','blog_cron_task.php',40],['lib/classes/task','send_failed_login_notifications_task.php',43],['lib/classes/task','grade_cron_task.php',40],['lib/dml/tests','dml_test.php',5422],['admin/tool/uploadcourse/classes','processor.php',174],['backup/moodle2','restore_section_task.class.php',87],['mod/lti/service/toolsettings/classes/local/resource','contextsettings.php',62],['lib/google/src/Google','Client.php',545],['backup/util/plan','restore_structure_step.class.php',62],['lib/classes/task','legacy_plugin_cron_task.php',42],['lib/dml','pdo_moodle_database.php',226],['lib/classes/task','check_for_updates_task.php',40],['backup/util/helper','restore_decode_processor.class.php',73],['backup/moodle2','backup_section_task.class.php',97],['webservice/amf/testclient','AMFTester.mxml',282],['lib/classes/task','delete_incomplete_users_task.php',40],['mod/assign','adminlib.php',342],['lib/classes/task','send_new_user_passwords_task.php',40],['admin/tool/monitor/classes/task','clean_events.php',41]], 733],
'notify_changed': ['notify_changed', 'Called immediately after the object data has been inserted, updated, or deleted in the database. Default does nothing, can be overridden to hook in special behaviour. ', [['lib/grade','grade_object.php',405],['lib/grade','grade_item.php',2192],['completion','data_object.php',383],['lib/grade','grade_grade.php',973]], 6],
'get_formatted_range': ['get_formatted_range', 'Returns a string representing the range of grademin - grademax for this grade item. ', [['lib/grade','grade_item.php',2120]], 2],
'fetch_course_item': ['fetch_course_item', 'Returns the grade item associated with the course ', [['lib/grade','grade_item.php',999]], 16],
'standardise_score': ['standardise_score', 'Given a float value situated between a source minimum and a source maximum, converts it to the corresponding value situated between a target minimum and a target maximum. Thanks to Darlene for the formula :-) ', [['lib/grade','grade_grade.php',596]], 17],
'close': ['close', 'Close the connection to the server ', [['lib/zend/Zend/Http/Client/Adapter','Socket.php',486],['lib/tests','completionlib_test.php',888],['lib/adodb','adodb.inc.php',2164],['lib/adodb','adodb.inc.php',2844],['lib/adodb','adodb.inc.php',3536],['lib','webdavlib.php',176],['admin/tool/uploaduser','locallib.php',149],['lib/dml','oci_native_moodle_recordset.php',80],['lib/tcpdf','tcpdf.php',2943],['lib/horde/framework/Horde/Imap/Client','Base.php',1846],['lib','excellib.class.php',93],['lib/zend/Zend/Http/Client/Adapter','Test.php',187],['lib/classes/dml','recordset_walk.php',153],['mod/assign/feedback/offline','importgradeslib.php',178],['lib/pear/Net','GeoIP.php',556],['backup/util/helper','backup_array_iterator.class.php',63],['lib/zend/Zend/Gdata/App','LoggingHttpClientAdapterSocket.php',109],['lib/zend/Zend/Http/Client/Adapter','Proxy.php',266],['lib/dml','mssql_native_moodle_recordset.php',87],['lib/pear/Auth','RADIUS.php',542],['lib/pear/Auth','RADIUS.php',703],['lib/pear/Auth','RADIUS.php',824],['lib/phpmailer','class.smtp.php',507],['lib/phpexcel/PHPExcel/Shared','ZipArchive.php',80],['lib/phpunit/classes','event_sink.php',39],['lib/zend/Zend/Http/Client/Adapter','Interface.php',73],['lib/dml','pgsql_native_moodle_recordset.php',104],['auth/fc','fcFPP.php',72],['lib/filestorage','zip_archive.php',183],['lib','odslib.class.php',71],['lib/horde/framework/Horde/Socket','Client.php',135],['question/engine/tests','helpers.php',1225],['grade','lib.php',323],['lib/dml','mysqli_native_moodle_recordset.php',86],['lib','csvlib.class.php',256],['lib/google/src/Google/Logger','File.php',130],['lib/horde/framework/Horde','Stream.php',585],['lib/phpunit/classes','phpmailer_sink.php',41],['lib/phpunit/classes','message_sink.php',39],['lib/zend/Zend/Http/Client/Adapter','Curl.php',460],['lib/dml','sqlsrv_native_moodle_recordset.php',133],['lib/zend/Zend/Service/WindowsAzure','SessionHandler.php',109],['backup/util/helper','backup_null_iterator.class.php',53],['grade/export','lib.php',662],['lib/dml','pdo_moodle_recordset.php',79]], 1036],
'apply_forced_settings': ['apply_forced_settings', 'Applies forced settings on this category ', [['lib/grade','grade_category.php',2470]], 14],
'set_hidden': ['set_hidden', 'Set a grade object hidden status ', [['lib/grade','grade_object.php',444],['lib/grade','grade_item.php',590],['lib/grade','grade_grade.php',565],['lib/grade','grade_category.php',2403]], 32],
'sum': ['sum', '', [['lib/evalmath','evalmath.class.php',520],['lib/phpexcel/PHPExcel/Calculation','MathTrig.php',1111]], 90],
'get_in_or_equal': ['get_in_or_equal', 'Constructs \'IN()\' or \'=\' sql fragment ', [['lib/dml','oci_native_moodle_database.php',1583],['lib/dml','moodle_database.php',678]], 375],
'print_error': ['print_error', 'Abort execution by throwing of a general exception, default exception handler displays the error message in most cases. ', [['lib','setuplib.php',449]], 1560],
'is_editable': ['is_editable', 'Is grading object editable? ', [['lib/grade','grade_item.php',1015],['mod/workshop/form','assessment_form.php',115],['lib/grade','grade_grade.php',242],['lib/grade','grade_category.php',2303]], 6],
'get_field_select': ['get_field_select', 'Get a single field value from a table record which match a particular WHERE clause. ', [['lib/dml','moodle_database.php',1514]], 44],
'is_manual_item': ['is_manual_item', 'Is this a manually graded item? ', [['lib/grade','grade_item.php',939]], 2],
'add_idnumber': ['add_idnumber', 'Set idnumber of grade item, updates also course_modules table ', [['lib/grade','grade_item.php',441]], 1],
'grade_item_changed': ['grade_item_changed', 'A grade item has been updated in gradebook. ', [['availability/condition/grade/classes','callbacks.php',49]], 1],
'load_outcome': ['load_outcome', 'Instantiates a grade_outcome object from the DB if this item\'s outcomeid variable is set ', [['lib/grade','grade_item.php',856]], 0],
'regrading_finished': ['regrading_finished', 'Mark regrading as finished successfully. ', [['lib/grade','grade_item.php',640]], 1],
'regrade_final_grades': ['regrade_final_grades', 'Performs the necessary calculations on the grades_final referenced by this grade_item. Also resets the needsupdate flag once successfully performed. ', [['lib/grade','grade_item.php',650]], 2],
'get_calculation': ['get_calculation', 'Returns calculation string if grade calculated. ', [['lib/grade','grade_item.php',1048]], 1],
'array_key_exists': ['array_key_exists', '', [], 1539],
'max': ['max', '', [], 1096],
'strpos': ['strpos', '', [], 1623],
'array_merge': ['array_merge', '', [], 2320],
'count': ['count', '', [], 3984],
'class_exists': ['class_exists', '', [], 273],
'trim': ['trim', '', [], 1889],
'defined': ['defined', '', [], 4098],
'str_replace': ['str_replace', '', [], 1667],
'is_null': ['is_null', '', [], 1992],
'time': ['time', '', [], 1768],
'round': ['round', '', [], 903],
'array_keys': ['array_keys', '', [], 1152],
'preg_replace': ['preg_replace', '', [], 903],
'implode': ['implode', '', [], 1259],
'array_diff': ['array_diff', '', [], 93],
'array_unique': ['array_unique', '', [], 173],
'preg_match_all': ['preg_match_all', '', [], 159]};
CLASS_DATA={
'grade_outcome': ['grade_outcome', 'Class representing a grade outcome. ', [['lib/grade','grade_outcome.php',30]], 39],
'grade_item': ['grade_item', 'Class representing a grade item. ', [['lib/grade','grade_item.php',29]], 206],
'grade_scale': ['grade_scale', 'Class representing a grade scale. ', [['lib/grade','grade_scale.php',30]], 37],
'calc_formula': ['calc_formula', 'This class abstracts evaluation of spreadsheet formulas. See unit tests in lib/tests/mathslib_test.php for sample usage. ', [['lib','mathslib.php',30]], 50],
'callbacks': ['callbacks', 'Callbacks handling grade changes (to clear cache). ', [['availability/condition/grade/classes','callbacks.php',29]], 2],
'grade_grade': ['grade_grade', 'grade_grades is an object mapped to DB table {prefix}grade_grades ', [['lib/grade','grade_grade.php',30]], 129],
'core_component': ['core_component', 'Collection of components related methods. ', [['lib/classes','component.php',41]], 485],
'user_graded': ['user_graded', 'Event triggered after teacher edits manual grade or overrides activity/aggregated grade. ', [['lib/classes/event','user_graded.php',28]], 10],
'grade_category': ['grade_category', 'grade_category is an object mapped to DB table {prefix}grade_categories ', [['lib/grade','grade_category.php',29]], 144]};
CONST_DATA={
'GRADE_DISPLAY_TYPE_REAL': ['GRADE_DISPLAY_TYPE_REAL', '', [['lib/grade','constants.php',148]], 31],
'FORMAT_MOODLE': ['FORMAT_MOODLE', '', [['lib','weblib.php',42]], 378],
'GRADE_REPORT_PREFERENCE_INHERIT': ['GRADE_REPORT_PREFERENCE_INHERIT', '', [['lib/grade','constants.php',225]], 19],
'FEATURE_CONTROLS_GRADE_VISIBILITY': ['FEATURE_CONTROLS_GRADE_VISIBILITY', '', [['lib','moodlelib.php',400]], 4],
'GRADE_DISPLAY_TYPE_DEFAULT': ['GRADE_DISPLAY_TYPE_DEFAULT', '', [['lib/grade','constants.php',143]], 9],
'GRADE_AGGREGATE_WEIGHTED_MEAN2': ['GRADE_AGGREGATE_WEIGHTED_MEAN2', '', [['lib/grade','constants.php',63]], 27],
'GRADE_TYPE_NONE': ['GRADE_TYPE_NONE', '', [['lib/grade','constants.php',80]], 41],
'GRADE_TYPE_SCALE': ['GRADE_TYPE_SCALE', '', [['lib/grade','constants.php',90]], 63],
'GRADE_DISPLAY_TYPE_PERCENTAGE': ['GRADE_DISPLAY_TYPE_PERCENTAGE', '', [['lib/grade','constants.php',153]], 24],
'GRADE_TYPE_VALUE': ['GRADE_TYPE_VALUE', '', [['lib/grade','constants.php',85]], 71],
'GRADE_TYPE_TEXT': ['GRADE_TYPE_TEXT', '', [['lib/grade','constants.php',95]], 25],
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',138],['','install.php',93],['lib','setup.php',386]], 3532]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu May 28 19:17:31 2015</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
