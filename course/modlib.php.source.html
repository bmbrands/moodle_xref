<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /course/modlib.php source</title>
    <link rel="stylesheet" href="../sample.css" type="text/css">
    <link rel="stylesheet" href="../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu May 28 19:17:31 2015 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../';
subdir='course';
filename='modlib.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/course/</a> -> <a href="modlib.php.html">modlib.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="modlib.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="modlib.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * Library of functions specific to course/modedit.php and course API functions.</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> * The course API function calling them are course/lib.php:create_module() and update_module().</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * This file has been created has an alternative solution to a full refactor of course/modedit.php</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * in order to create the course API functions.</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> *</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @copyright 2013 Jerome Mouneyrac</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> * @package core_course</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment"> */</span>
<a name="l27"><span class="linenum">  27</span></a>  
<a name="l28"><span class="linenum">  28</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die;
<a name="l29"><span class="linenum">  29</span></a>  
<a name="l30"><span class="linenum">  30</span></a>  require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../course/lib.php.html">/course/lib.php</a>');
<a name="l31"><span class="linenum">  31</span></a>  
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment">/**</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment"> * Add course module.</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment"> *</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment"> * The function does not check user capabilities.</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment"> * The function creates course module, module instance, add the module to the correct section.</span>
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment"> * It also trigger common action that need to be done after adding/updating a module.</span>
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment"> *</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment"> * @param object $moduleinfo the moudle data</span>
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment"> * @param object $course the course of the module</span>
<a name="l41"><span class="linenum">  41</span></a>  <span class="comment"> * @param object $mform this is required by an existing hack to deal with files during MODULENAME_add_instance()</span>
<a name="l42"><span class="linenum">  42</span></a>  <span class="comment"> * @return object the updated module info</span>
<a name="l43"><span class="linenum">  43</span></a>  <span class="comment"> */</span>
<a name="l44"><span class="linenum">  44</span></a>  function <a class="function" onClick="logFunction('add_moduleinfo')" href="../_functions/add_moduleinfo.html" onMouseOver="funcPopup(event,'add_moduleinfo')">add_moduleinfo</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>, <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>, <a class="var it1037" onMouseOver="hilite(1037)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../_variables/mform.html">$mform</a> = null) {
<a name="l45"><span class="linenum">  45</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l46"><span class="linenum">  46</span></a>  
<a name="l47"><span class="linenum">  47</span></a>  <span class="comment">    // Attempt to include module library before we make any changes to DB.</span>
<a name="l48"><span class="linenum">  48</span></a>      <a class="function" onClick="logFunction('include_modulelib')" href="../_functions/include_modulelib.html" onMouseOver="funcPopup(event,'include_modulelib')">include_modulelib</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('modulename')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/modulename.html">modulename</a>);
<a name="l49"><span class="linenum">  49</span></a>  
<a name="l50"><span class="linenum">  50</span></a>      <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('course')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/course.html">course</a> = <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l51"><span class="linenum">  51</span></a>      <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a> = <a class="function" onClick="logFunction('set_moduleinfo_defaults')" href="../_functions/set_moduleinfo_defaults.html" onMouseOver="funcPopup(event,'set_moduleinfo_defaults')">set_moduleinfo_defaults</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>);
<a name="l52"><span class="linenum">  52</span></a>  
<a name="l53"><span class="linenum">  53</span></a>      if (!empty(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('groupmodeforce')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/groupmodeforce.html">groupmodeforce</a>) or !isset(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('groupmode')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/groupmode.html">groupmode</a>)) {
<a name="l54"><span class="linenum">  54</span></a>          <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('groupmode')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/groupmode.html">groupmode</a> = 0; <span class="comment">// Do not set groupmode.</span>
<a name="l55"><span class="linenum">  55</span></a>      }
<a name="l56"><span class="linenum">  56</span></a>  
<a name="l57"><span class="linenum">  57</span></a>  <span class="comment">    // First add course_module record because we need the context.</span>
<a name="l58"><span class="linenum">  58</span></a>      <a class="var it8381" onMouseOver="hilite(8381)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../_variables/newcm.html">$newcm</a> = new stdClass();
<a name="l59"><span class="linenum">  59</span></a>      <a class="var it8381" onMouseOver="hilite(8381)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../_variables/newcm.html">$newcm</a>-&gt;<a onClick="logVariable('course')" class="var it40705" onMouseOver="hilite(40705)" onMouseOut="lolite()" href="../_variables/course.html">course</a>           = <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l60"><span class="linenum">  60</span></a>      <a class="var it8381" onMouseOver="hilite(8381)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../_variables/newcm.html">$newcm</a>-&gt;<a onClick="logVariable('module')" class="var it40705" onMouseOver="hilite(40705)" onMouseOut="lolite()" href="../_variables/module.html">module</a>           = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('module')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/module.html">module</a>;
<a name="l61"><span class="linenum">  61</span></a>      <a class="var it8381" onMouseOver="hilite(8381)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../_variables/newcm.html">$newcm</a>-&gt;<a onClick="logVariable('instance')" class="var it40705" onMouseOver="hilite(40705)" onMouseOut="lolite()" href="../_variables/instance.html">instance</a>         = 0; <span class="comment">// Not known yet, will be updated later (this is similar to restore code).</span>
<a name="l62"><span class="linenum">  62</span></a>      <a class="var it8381" onMouseOver="hilite(8381)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../_variables/newcm.html">$newcm</a>-&gt;<a onClick="logVariable('visible')" class="var it40705" onMouseOver="hilite(40705)" onMouseOut="lolite()" href="../_variables/visible.html">visible</a>          = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('visible')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/visible.html">visible</a>;
<a name="l63"><span class="linenum">  63</span></a>      <a class="var it8381" onMouseOver="hilite(8381)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../_variables/newcm.html">$newcm</a>-&gt;<a onClick="logVariable('visibleold')" class="var it40705" onMouseOver="hilite(40705)" onMouseOut="lolite()" href="../_variables/visibleold.html">visibleold</a>       = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('visible')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/visible.html">visible</a>;
<a name="l64"><span class="linenum">  64</span></a>      if (isset(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('cmidnumber')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/cmidnumber.html">cmidnumber</a>)) {
<a name="l65"><span class="linenum">  65</span></a>          <a class="var it8381" onMouseOver="hilite(8381)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../_variables/newcm.html">$newcm</a>-&gt;<a onClick="logVariable('idnumber')" class="var it40705" onMouseOver="hilite(40705)" onMouseOut="lolite()" href="../_variables/idnumber.html">idnumber</a>         = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('cmidnumber')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/cmidnumber.html">cmidnumber</a>;
<a name="l66"><span class="linenum">  66</span></a>      }
<a name="l67"><span class="linenum">  67</span></a>      <a class="var it8381" onMouseOver="hilite(8381)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../_variables/newcm.html">$newcm</a>-&gt;<a onClick="logVariable('groupmode')" class="var it40705" onMouseOver="hilite(40705)" onMouseOut="lolite()" href="../_variables/groupmode.html">groupmode</a>        = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('groupmode')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/groupmode.html">groupmode</a>;
<a name="l68"><span class="linenum">  68</span></a>      <a class="var it8381" onMouseOver="hilite(8381)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../_variables/newcm.html">$newcm</a>-&gt;<a onClick="logVariable('groupingid')" class="var it40705" onMouseOver="hilite(40705)" onMouseOut="lolite()" href="../_variables/groupingid.html">groupingid</a>       = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('groupingid')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/groupingid.html">groupingid</a>;
<a name="l69"><span class="linenum">  69</span></a>      <a class="var it3863" onMouseOver="hilite(3863)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../_variables/completion.html">$completion</a> = <span class="keyword">new </span><a class="class" onClick="logClass('completion_info')" href="../_classes/completion_info.html" onMouseOver="classPopup(event,'completion_info')">completion_info</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>);
<a name="l70"><span class="linenum">  70</span></a>      if (<a class="var it3863" onMouseOver="hilite(3863)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../_variables/completion.html">$completion</a>-&gt;<a class="function" onClick="logFunction('is_enabled')" href="../_functions/is_enabled.html" onMouseOver="funcPopup(event,'is_enabled')">is_enabled</a>()) {
<a name="l71"><span class="linenum">  71</span></a>          <a class="var it8381" onMouseOver="hilite(8381)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../_variables/newcm.html">$newcm</a>-&gt;<a onClick="logVariable('completion')" class="var it40705" onMouseOver="hilite(40705)" onMouseOut="lolite()" href="../_variables/completion.html">completion</a>                = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('completion')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/completion.html">completion</a>;
<a name="l72"><span class="linenum">  72</span></a>          <a class="var it8381" onMouseOver="hilite(8381)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../_variables/newcm.html">$newcm</a>-&gt;<a onClick="logVariable('completiongradeitemnumber')" class="var it40705" onMouseOver="hilite(40705)" onMouseOut="lolite()" href="../_variables/completiongradeitemnumber.html">completiongradeitemnumber</a> = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('completiongradeitemnumber')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/completiongradeitemnumber.html">completiongradeitemnumber</a>;
<a name="l73"><span class="linenum">  73</span></a>          <a class="var it8381" onMouseOver="hilite(8381)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../_variables/newcm.html">$newcm</a>-&gt;<a onClick="logVariable('completionview')" class="var it40705" onMouseOver="hilite(40705)" onMouseOut="lolite()" href="../_variables/completionview.html">completionview</a>            = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('completionview')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/completionview.html">completionview</a>;
<a name="l74"><span class="linenum">  74</span></a>          <a class="var it8381" onMouseOver="hilite(8381)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../_variables/newcm.html">$newcm</a>-&gt;<a onClick="logVariable('completionexpected')" class="var it40705" onMouseOver="hilite(40705)" onMouseOut="lolite()" href="../_variables/completionexpected.html">completionexpected</a>        = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('completionexpected')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/completionexpected.html">completionexpected</a>;
<a name="l75"><span class="linenum">  75</span></a>      }
<a name="l76"><span class="linenum">  76</span></a>      if(!empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enableavailability')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/enableavailability.html">enableavailability</a>)) {
<a name="l77"><span class="linenum">  77</span></a>  <span class="comment">        // This code is used both when submitting the form, which uses a long</span>
<a name="l78"><span class="linenum">  78</span></a>  <span class="comment">        // name to avoid clashes, and by unit test code which uses the real</span>
<a name="l79"><span class="linenum">  79</span></a>  <span class="comment">        // name in the table.</span>
<a name="l80"><span class="linenum">  80</span></a>          <a class="var it8381" onMouseOver="hilite(8381)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../_variables/newcm.html">$newcm</a>-&gt;<a onClick="logVariable('availability')" class="var it40705" onMouseOver="hilite(40705)" onMouseOut="lolite()" href="../_variables/availability.html">availability</a> = null;
<a name="l81"><span class="linenum">  81</span></a>          if (property_exists(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>, 'availabilityconditionsjson')) {
<a name="l82"><span class="linenum">  82</span></a>              if (<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('availabilityconditionsjson')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/availabilityconditionsjson.html">availabilityconditionsjson</a> !== '') {
<a name="l83"><span class="linenum">  83</span></a>                  <a class="var it8381" onMouseOver="hilite(8381)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../_variables/newcm.html">$newcm</a>-&gt;<a onClick="logVariable('availability')" class="var it40705" onMouseOver="hilite(40705)" onMouseOut="lolite()" href="../_variables/availability.html">availability</a> = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('availabilityconditionsjson')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/availabilityconditionsjson.html">availabilityconditionsjson</a>;
<a name="l84"><span class="linenum">  84</span></a>              }
<a name="l85"><span class="linenum">  85</span></a>          } else if (property_exists(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>, 'availability')) {
<a name="l86"><span class="linenum">  86</span></a>              <a class="var it8381" onMouseOver="hilite(8381)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../_variables/newcm.html">$newcm</a>-&gt;<a onClick="logVariable('availability')" class="var it40705" onMouseOver="hilite(40705)" onMouseOut="lolite()" href="../_variables/availability.html">availability</a> = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('availability')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/availability.html">availability</a>;
<a name="l87"><span class="linenum">  87</span></a>          }
<a name="l88"><span class="linenum">  88</span></a>  <span class="comment">        // If there is any availability data, verify it.</span>
<a name="l89"><span class="linenum">  89</span></a>          if (<a class="var it8381" onMouseOver="hilite(8381)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../_variables/newcm.html">$newcm</a>-&gt;<a onClick="logVariable('availability')" class="var it40705" onMouseOver="hilite(40705)" onMouseOut="lolite()" href="../_variables/availability.html">availability</a>) {
<a name="l90"><span class="linenum">  90</span></a>              <a class="var it4476" onMouseOver="hilite(4476)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../_variables/tree.html">$tree</a> = new \core_availability\tree(json_decode(<a class="var it8381" onMouseOver="hilite(8381)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../_variables/newcm.html">$newcm</a>-&gt;<a onClick="logVariable('availability')" class="var it40705" onMouseOver="hilite(40705)" onMouseOut="lolite()" href="../_variables/availability.html">availability</a>));
<a name="l91"><span class="linenum">  91</span></a>  <span class="comment">            // Save time and database space by setting null if the only data</span>
<a name="l92"><span class="linenum">  92</span></a>  <span class="comment">            // is an empty tree.</span>
<a name="l93"><span class="linenum">  93</span></a>              if (<a class="var it4476" onMouseOver="hilite(4476)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../_variables/tree.html">$tree</a>-&gt;<a class="function" onClick="logFunction('is_empty')" href="../_functions/is_empty.html" onMouseOver="funcPopup(event,'is_empty')">is_empty</a>()) {
<a name="l94"><span class="linenum">  94</span></a>                  <a class="var it8381" onMouseOver="hilite(8381)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../_variables/newcm.html">$newcm</a>-&gt;<a onClick="logVariable('availability')" class="var it40705" onMouseOver="hilite(40705)" onMouseOut="lolite()" href="../_variables/availability.html">availability</a> = null;
<a name="l95"><span class="linenum">  95</span></a>              }
<a name="l96"><span class="linenum">  96</span></a>          }
<a name="l97"><span class="linenum">  97</span></a>      }
<a name="l98"><span class="linenum">  98</span></a>      if (isset(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('showdescription')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/showdescription.html">showdescription</a>)) {
<a name="l99"><span class="linenum">  99</span></a>          <a class="var it8381" onMouseOver="hilite(8381)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../_variables/newcm.html">$newcm</a>-&gt;<a onClick="logVariable('showdescription')" class="var it40705" onMouseOver="hilite(40705)" onMouseOut="lolite()" href="../_variables/showdescription.html">showdescription</a> = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('showdescription')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/showdescription.html">showdescription</a>;
<a name="l100"><span class="linenum"> 100</span></a>      } else {
<a name="l101"><span class="linenum"> 101</span></a>          <a class="var it8381" onMouseOver="hilite(8381)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../_variables/newcm.html">$newcm</a>-&gt;<a onClick="logVariable('showdescription')" class="var it40705" onMouseOver="hilite(40705)" onMouseOut="lolite()" href="../_variables/showdescription.html">showdescription</a> = 0;
<a name="l102"><span class="linenum"> 102</span></a>      }
<a name="l103"><span class="linenum"> 103</span></a>  
<a name="l104"><span class="linenum"> 104</span></a>  <span class="comment">    // From this point we make database changes, so start transaction.</span>
<a name="l105"><span class="linenum"> 105</span></a>      <a class="var it2929" onMouseOver="hilite(2929)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../_variables/transaction.html">$transaction</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l106"><span class="linenum"> 106</span></a>  
<a name="l107"><span class="linenum"> 107</span></a>      if (!<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/coursemodule.html">coursemodule</a> = <a class="function" onClick="logFunction('add_course_module')" href="../_functions/add_course_module.html" onMouseOver="funcPopup(event,'add_course_module')">add_course_module</a>(<a class="var it8381" onMouseOver="hilite(8381)" onMouseOut="lolite()" onClick="logVariable('newcm')" href="../_variables/newcm.html">$newcm</a>)) {
<a name="l108"><span class="linenum"> 108</span></a>          <a class="function" onClick="logFunction('print_error')" href="../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('cannotaddcoursemodule');
<a name="l109"><span class="linenum"> 109</span></a>      }
<a name="l110"><span class="linenum"> 110</span></a>  
<a name="l111"><span class="linenum"> 111</span></a>      if (<a class="function" onClick="logFunction('plugin_supports')" href="../_functions/plugin_supports.html" onMouseOver="funcPopup(event,'plugin_supports')">plugin_supports</a>('mod', <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('modulename')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/modulename.html">modulename</a>, <a class="constant" onClick="logConstant('FEATURE_MOD_INTRO')" href="../_constants/FEATURE_MOD_INTRO.html" onMouseOver="constPopup(event,'FEATURE_MOD_INTRO')">FEATURE_MOD_INTRO</a>, true) &amp;&amp;
<a name="l112"><span class="linenum"> 112</span></a>              isset(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('introeditor')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/introeditor.html">introeditor</a>)) {
<a name="l113"><span class="linenum"> 113</span></a>          <a class="var it8321" onMouseOver="hilite(8321)" onMouseOut="lolite()" onClick="logVariable('introeditor')" href="../_variables/introeditor.html">$introeditor</a> = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('introeditor')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/introeditor.html">introeditor</a>;
<a name="l114"><span class="linenum"> 114</span></a>          unset(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('introeditor')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/introeditor.html">introeditor</a>);
<a name="l115"><span class="linenum"> 115</span></a>          <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('intro')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/intro.html">intro</a>       = <a class="var it8321" onMouseOver="hilite(8321)" onMouseOut="lolite()" onClick="logVariable('introeditor')" href="../_variables/introeditor.html">$introeditor</a>['text'];
<a name="l116"><span class="linenum"> 116</span></a>          <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('introformat')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/introformat.html">introformat</a> = <a class="var it8321" onMouseOver="hilite(8321)" onMouseOut="lolite()" onClick="logVariable('introeditor')" href="../_variables/introeditor.html">$introeditor</a>['format'];
<a name="l117"><span class="linenum"> 117</span></a>      }
<a name="l118"><span class="linenum"> 118</span></a>  
<a name="l119"><span class="linenum"> 119</span></a>      <a class="var it29837" onMouseOver="hilite(29837)" onMouseOut="lolite()" onClick="logVariable('addinstancefunction')" href="../_variables/addinstancefunction.html">$addinstancefunction</a>    = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('modulename')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/modulename.html">modulename</a>.&quot;_add_instance&quot;;
<a name="l120"><span class="linenum"> 120</span></a>      try {
<a name="l121"><span class="linenum"> 121</span></a>          <a class="var it29838" onMouseOver="hilite(29838)" onMouseOut="lolite()" onClick="logVariable('returnfromfunc')" href="../_variables/returnfromfunc.html">$returnfromfunc</a> = <a class="var it29837" onMouseOver="hilite(29837)" onMouseOut="lolite()" onClick="logVariable('addinstancefunction')" href="../_variables/addinstancefunction.html">$addinstancefunction</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>, <a class="var it1037" onMouseOver="hilite(1037)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../_variables/mform.html">$mform</a>);
<a name="l122"><span class="linenum"> 122</span></a>      } catch (moodle_exception <a class="var it193" onMouseOver="hilite(193)" onMouseOut="lolite()" onClick="logVariable('e')" href="../_variables/e.html">$e</a>) {
<a name="l123"><span class="linenum"> 123</span></a>          <a class="var it29838" onMouseOver="hilite(29838)" onMouseOut="lolite()" onClick="logVariable('returnfromfunc')" href="../_variables/returnfromfunc.html">$returnfromfunc</a> = <a class="var it193" onMouseOver="hilite(193)" onMouseOut="lolite()" onClick="logVariable('e')" href="../_variables/e.html">$e</a>;
<a name="l124"><span class="linenum"> 124</span></a>      }
<a name="l125"><span class="linenum"> 125</span></a>      if (!<a class="var it29838" onMouseOver="hilite(29838)" onMouseOut="lolite()" onClick="logVariable('returnfromfunc')" href="../_variables/returnfromfunc.html">$returnfromfunc</a> or !<a class="function" onClick="logFunction('is_number')" href="../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>(<a class="var it29838" onMouseOver="hilite(29838)" onMouseOut="lolite()" onClick="logVariable('returnfromfunc')" href="../_variables/returnfromfunc.html">$returnfromfunc</a>)) {
<a name="l126"><span class="linenum"> 126</span></a>  <span class="comment">        // Undo everything we can. This is not necessary for databases which</span>
<a name="l127"><span class="linenum"> 127</span></a>  <span class="comment">        // support transactions, but improves consistency for other databases.</span>
<a name="l128"><span class="linenum"> 128</span></a>          <a class="var it1418" onMouseOver="hilite(1418)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/coursemodule.html">coursemodule</a>);
<a name="l129"><span class="linenum"> 129</span></a>          <a class="class" onClick="logClass('context_helper')" href="../_classes/context_helper.html" onMouseOver="classPopup(event,'context_helper')">context_helper</a>::<a class="function" onClick="logFunction('delete_instance')" href="../_functions/delete_instance.html" onMouseOver="funcPopup(event,'delete_instance')">delete_instance</a>(<a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>, <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/coursemodule.html">coursemodule</a>);
<a name="l130"><span class="linenum"> 130</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('course_modules', array('id'=&gt;<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/coursemodule.html">coursemodule</a>));
<a name="l131"><span class="linenum"> 131</span></a>  
<a name="l132"><span class="linenum"> 132</span></a>          if (<a class="var it193" onMouseOver="hilite(193)" onMouseOut="lolite()" onClick="logVariable('e')" href="../_variables/e.html">$e</a> instanceof moodle_exception) {
<a name="l133"><span class="linenum"> 133</span></a>              throw <a class="var it193" onMouseOver="hilite(193)" onMouseOut="lolite()" onClick="logVariable('e')" href="../_variables/e.html">$e</a>;
<a name="l134"><span class="linenum"> 134</span></a>          } else if (!<a class="function" onClick="logFunction('is_number')" href="../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>(<a class="var it29838" onMouseOver="hilite(29838)" onMouseOut="lolite()" onClick="logVariable('returnfromfunc')" href="../_variables/returnfromfunc.html">$returnfromfunc</a>)) {
<a name="l135"><span class="linenum"> 135</span></a>              <a class="function" onClick="logFunction('print_error')" href="../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('invalidfunction', '', <a class="function" onClick="logFunction('course_get_url')" href="../_functions/course_get_url.html" onMouseOver="funcPopup(event,'course_get_url')">course_get_url</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>, <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('section')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/section.html">section</a>));
<a name="l136"><span class="linenum"> 136</span></a>          } else {
<a name="l137"><span class="linenum"> 137</span></a>              <a class="function" onClick="logFunction('print_error')" href="../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('cannotaddnewmodule', '', <a class="function" onClick="logFunction('course_get_url')" href="../_functions/course_get_url.html" onMouseOver="funcPopup(event,'course_get_url')">course_get_url</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>, <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('section')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/section.html">section</a>), <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('modulename')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/modulename.html">modulename</a>);
<a name="l138"><span class="linenum"> 138</span></a>          }
<a name="l139"><span class="linenum"> 139</span></a>      }
<a name="l140"><span class="linenum"> 140</span></a>  
<a name="l141"><span class="linenum"> 141</span></a>      <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('instance')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/instance.html">instance</a> = <a class="var it29838" onMouseOver="hilite(29838)" onMouseOut="lolite()" onClick="logVariable('returnfromfunc')" href="../_variables/returnfromfunc.html">$returnfromfunc</a>;
<a name="l142"><span class="linenum"> 142</span></a>  
<a name="l143"><span class="linenum"> 143</span></a>      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('course_modules', 'instance', <a class="var it29838" onMouseOver="hilite(29838)" onMouseOut="lolite()" onClick="logVariable('returnfromfunc')" href="../_variables/returnfromfunc.html">$returnfromfunc</a>, array('id'=&gt;<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/coursemodule.html">coursemodule</a>));
<a name="l144"><span class="linenum"> 144</span></a>  
<a name="l145"><span class="linenum"> 145</span></a>  <span class="comment">    // Update embedded links and save files.</span>
<a name="l146"><span class="linenum"> 146</span></a>      <a class="var it1418" onMouseOver="hilite(1418)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/coursemodule.html">coursemodule</a>);
<a name="l147"><span class="linenum"> 147</span></a>      if (!empty(<a class="var it8321" onMouseOver="hilite(8321)" onMouseOut="lolite()" onClick="logVariable('introeditor')" href="../_variables/introeditor.html">$introeditor</a>)) {
<a name="l148"><span class="linenum"> 148</span></a>          <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('intro')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/intro.html">intro</a> = <a class="function" onClick="logFunction('file_save_draft_area_files')" href="../_functions/file_save_draft_area_files.html" onMouseOver="funcPopup(event,'file_save_draft_area_files')">file_save_draft_area_files</a>(<a class="var it8321" onMouseOver="hilite(8321)" onMouseOut="lolite()" onClick="logVariable('introeditor')" href="../_variables/introeditor.html">$introeditor</a>['itemid'], <a class="var it1418" onMouseOver="hilite(1418)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../_variables/modcontext.html">$modcontext</a>-&gt;<a onClick="logVariable('id')" class="var it39650" onMouseOver="hilite(39650)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l149"><span class="linenum"> 149</span></a>                                                        'mod_'.<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('modulename')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/modulename.html">modulename</a>, 'intro', 0,
<a name="l150"><span class="linenum"> 150</span></a>                                                        array('subdirs'=&gt;true), <a class="var it8321" onMouseOver="hilite(8321)" onMouseOut="lolite()" onClick="logVariable('introeditor')" href="../_variables/introeditor.html">$introeditor</a>['text']);
<a name="l151"><span class="linenum"> 151</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('modulename')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/modulename.html">modulename</a>, 'intro', <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('intro')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/intro.html">intro</a>, array('id'=&gt;<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('instance')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/instance.html">instance</a>));
<a name="l152"><span class="linenum"> 152</span></a>      }
<a name="l153"><span class="linenum"> 153</span></a>  
<a name="l154"><span class="linenum"> 154</span></a>  <span class="comment">    // Course_modules and course_sections each contain a reference to each other.</span>
<a name="l155"><span class="linenum"> 155</span></a>  <span class="comment">    // So we have to update one of them twice.</span>
<a name="l156"><span class="linenum"> 156</span></a>      <a class="var it556" onMouseOver="hilite(556)" onMouseOut="lolite()" onClick="logVariable('sectionid')" href="../_variables/sectionid.html">$sectionid</a> = <a class="function" onClick="logFunction('course_add_cm_to_section')" href="../_functions/course_add_cm_to_section.html" onMouseOver="funcPopup(event,'course_add_cm_to_section')">course_add_cm_to_section</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>, <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/coursemodule.html">coursemodule</a>, <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('section')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/section.html">section</a>);
<a name="l157"><span class="linenum"> 157</span></a>  
<a name="l158"><span class="linenum"> 158</span></a>  <span class="comment">    // Trigger event based on the action we did.</span>
<a name="l159"><span class="linenum"> 159</span></a>  <span class="comment">    // Api create_from_cm expects modname and id property, and we don't want to modify $moduleinfo since we are returning it.</span>
<a name="l160"><span class="linenum"> 160</span></a>      <a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a> = clone <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>;
<a name="l161"><span class="linenum"> 161</span></a>      <a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('modname')" class="var it39511" onMouseOver="hilite(39511)" onMouseOut="lolite()" href="../_variables/modname.html">modname</a> = <a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('modulename')" class="var it39511" onMouseOver="hilite(39511)" onMouseOut="lolite()" href="../_variables/modulename.html">modulename</a>;
<a name="l162"><span class="linenum"> 162</span></a>      <a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('id')" class="var it39511" onMouseOver="hilite(39511)" onMouseOut="lolite()" href="../_variables/id.html">id</a> = <a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it39511" onMouseOver="hilite(39511)" onMouseOut="lolite()" href="../_variables/coursemodule.html">coursemodule</a>;
<a name="l163"><span class="linenum"> 163</span></a>      <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('course_module_created')" href="../_classes/course_module_created.html" onMouseOver="classPopup(event,'course_module_created')">course_module_created</a>::<a class="function" onClick="logFunction('create_from_cm')" href="../_functions/create_from_cm.html" onMouseOver="funcPopup(event,'create_from_cm')">create_from_cm</a>(<a class="var it8012" onMouseOver="hilite(8012)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../_variables/eventdata.html">$eventdata</a>, <a class="var it1418" onMouseOver="hilite(1418)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../_variables/modcontext.html">$modcontext</a>);
<a name="l164"><span class="linenum"> 164</span></a>      <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l165"><span class="linenum"> 165</span></a>  
<a name="l166"><span class="linenum"> 166</span></a>      <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a> = <a class="function" onClick="logFunction('edit_module_post_actions')" href="../_functions/edit_module_post_actions.html" onMouseOver="funcPopup(event,'edit_module_post_actions')">edit_module_post_actions</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>, <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>);
<a name="l167"><span class="linenum"> 167</span></a>      <a class="var it2929" onMouseOver="hilite(2929)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l168"><span class="linenum"> 168</span></a>  
<a name="l169"><span class="linenum"> 169</span></a>      return <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>;
<a name="l170"><span class="linenum"> 170</span></a>  }
<a name="l171"><span class="linenum"> 171</span></a>  
<a name="l172"><span class="linenum"> 172</span></a>  
<a name="l173"><span class="linenum"> 173</span></a>  <span class="comment">/**</span>
<a name="l174"><span class="linenum"> 174</span></a>  <span class="comment"> * Common create/update module module actions that need to be processed as soon as a module is created/updaded.</span>
<a name="l175"><span class="linenum"> 175</span></a>  <span class="comment"> * For example:create grade parent category, add outcomes, rebuild caches, regrade, save plagiarism settings...</span>
<a name="l176"><span class="linenum"> 176</span></a>  <span class="comment"> * Please note this api does not trigger events as of MOODLE 2.6. Please trigger events before calling this api.</span>
<a name="l177"><span class="linenum"> 177</span></a>  <span class="comment"> *</span>
<a name="l178"><span class="linenum"> 178</span></a>  <span class="comment"> * @param object $moduleinfo the module info</span>
<a name="l179"><span class="linenum"> 179</span></a>  <span class="comment"> * @param object $course the course of the module</span>
<a name="l180"><span class="linenum"> 180</span></a>  <span class="comment"> *</span>
<a name="l181"><span class="linenum"> 181</span></a>  <span class="comment"> * @return object moduleinfo update with grading management info</span>
<a name="l182"><span class="linenum"> 182</span></a>  <span class="comment"> */</span>
<a name="l183"><span class="linenum"> 183</span></a>  function <a class="function" onClick="logFunction('edit_module_post_actions')" href="../_functions/edit_module_post_actions.html" onMouseOver="funcPopup(event,'edit_module_post_actions')">edit_module_post_actions</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>, <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>) {
<a name="l184"><span class="linenum"> 184</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l185"><span class="linenum"> 185</span></a>      require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/libdir.html">libdir</a>.'/gradelib.php');
<a name="l186"><span class="linenum"> 186</span></a>  
<a name="l187"><span class="linenum"> 187</span></a>      <a class="var it1418" onMouseOver="hilite(1418)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/coursemodule.html">coursemodule</a>);
<a name="l188"><span class="linenum"> 188</span></a>      <a class="var it29839" onMouseOver="hilite(29839)" onMouseOut="lolite()" onClick="logVariable('hasgrades')" href="../_variables/hasgrades.html">$hasgrades</a> = <a class="function" onClick="logFunction('plugin_supports')" href="../_functions/plugin_supports.html" onMouseOver="funcPopup(event,'plugin_supports')">plugin_supports</a>('mod', <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('modulename')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/modulename.html">modulename</a>, <a class="constant" onClick="logConstant('FEATURE_GRADE_HAS_GRADE')" href="../_constants/FEATURE_GRADE_HAS_GRADE.html" onMouseOver="constPopup(event,'FEATURE_GRADE_HAS_GRADE')">FEATURE_GRADE_HAS_GRADE</a>, false);
<a name="l189"><span class="linenum"> 189</span></a>      <a class="var it29840" onMouseOver="hilite(29840)" onMouseOut="lolite()" onClick="logVariable('hasoutcomes')" href="../_variables/hasoutcomes.html">$hasoutcomes</a> = <a class="function" onClick="logFunction('plugin_supports')" href="../_functions/plugin_supports.html" onMouseOver="funcPopup(event,'plugin_supports')">plugin_supports</a>('mod', <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('modulename')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/modulename.html">modulename</a>, <a class="constant" onClick="logConstant('FEATURE_GRADE_OUTCOMES')" href="../_constants/FEATURE_GRADE_OUTCOMES.html" onMouseOver="constPopup(event,'FEATURE_GRADE_OUTCOMES')">FEATURE_GRADE_OUTCOMES</a>, true);
<a name="l190"><span class="linenum"> 190</span></a>  
<a name="l191"><span class="linenum"> 191</span></a>  <span class="comment">    // Sync idnumber with grade_item.</span>
<a name="l192"><span class="linenum"> 192</span></a>      if (<a class="var it29839" onMouseOver="hilite(29839)" onMouseOut="lolite()" onClick="logVariable('hasgrades')" href="../_variables/hasgrades.html">$hasgrades</a> &amp;&amp; <a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../_variables/grade_item.html">$grade_item</a> = <a class="class" onClick="logClass('grade_item')" href="../_classes/grade_item.html" onMouseOver="classPopup(event,'grade_item')">grade_item</a>::<a class="function" onClick="logFunction('fetch')" href="../_functions/fetch.html" onMouseOver="funcPopup(event,'fetch')">fetch</a>(array('itemtype'=&gt;'mod', 'itemmodule'=&gt;<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('modulename')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/modulename.html">modulename</a>,
<a name="l193"><span class="linenum"> 193</span></a>                   'iteminstance'=&gt;<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('instance')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/instance.html">instance</a>, 'itemnumber'=&gt;0, 'courseid'=&gt;<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>))) {
<a name="l194"><span class="linenum"> 194</span></a>          <a class="var it29841" onMouseOver="hilite(29841)" onMouseOut="lolite()" onClick="logVariable('gradeupdate')" href="../_variables/gradeupdate.html">$gradeupdate</a> = false;
<a name="l195"><span class="linenum"> 195</span></a>          if (<a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../_variables/grade_item.html">$grade_item</a>-&gt;<a onClick="logVariable('idnumber')" class="var it39507" onMouseOver="hilite(39507)" onMouseOut="lolite()" href="../_variables/idnumber.html">idnumber</a> != <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('cmidnumber')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/cmidnumber.html">cmidnumber</a>) {
<a name="l196"><span class="linenum"> 196</span></a>              <a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../_variables/grade_item.html">$grade_item</a>-&gt;<a onClick="logVariable('idnumber')" class="var it39507" onMouseOver="hilite(39507)" onMouseOut="lolite()" href="../_variables/idnumber.html">idnumber</a> = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('cmidnumber')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/cmidnumber.html">cmidnumber</a>;
<a name="l197"><span class="linenum"> 197</span></a>              <a class="var it29841" onMouseOver="hilite(29841)" onMouseOut="lolite()" onClick="logVariable('gradeupdate')" href="../_variables/gradeupdate.html">$gradeupdate</a> = true;
<a name="l198"><span class="linenum"> 198</span></a>          }
<a name="l199"><span class="linenum"> 199</span></a>          if (isset(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('gradepass')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/gradepass.html">gradepass</a>) &amp;&amp; <a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../_variables/grade_item.html">$grade_item</a>-&gt;<a onClick="logVariable('gradepass')" class="var it39507" onMouseOver="hilite(39507)" onMouseOut="lolite()" href="../_variables/gradepass.html">gradepass</a> != <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('gradepass')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/gradepass.html">gradepass</a>) {
<a name="l200"><span class="linenum"> 200</span></a>              <a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../_variables/grade_item.html">$grade_item</a>-&gt;<a onClick="logVariable('gradepass')" class="var it39507" onMouseOver="hilite(39507)" onMouseOut="lolite()" href="../_variables/gradepass.html">gradepass</a> = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('gradepass')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/gradepass.html">gradepass</a>;
<a name="l201"><span class="linenum"> 201</span></a>              <a class="var it29841" onMouseOver="hilite(29841)" onMouseOut="lolite()" onClick="logVariable('gradeupdate')" href="../_variables/gradeupdate.html">$gradeupdate</a> = true;
<a name="l202"><span class="linenum"> 202</span></a>          }
<a name="l203"><span class="linenum"> 203</span></a>          if (<a class="var it29841" onMouseOver="hilite(29841)" onMouseOut="lolite()" onClick="logVariable('gradeupdate')" href="../_variables/gradeupdate.html">$gradeupdate</a>) {
<a name="l204"><span class="linenum"> 204</span></a>              <a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../_variables/grade_item.html">$grade_item</a>-&gt;<a class="function" onClick="logFunction('update')" href="../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l205"><span class="linenum"> 205</span></a>          }
<a name="l206"><span class="linenum"> 206</span></a>      }
<a name="l207"><span class="linenum"> 207</span></a>  
<a name="l208"><span class="linenum"> 208</span></a>      if (<a class="var it29839" onMouseOver="hilite(29839)" onMouseOut="lolite()" onClick="logVariable('hasgrades')" href="../_variables/hasgrades.html">$hasgrades</a>) {
<a name="l209"><span class="linenum"> 209</span></a>          <a class="var it135" onMouseOver="hilite(135)" onMouseOut="lolite()" onClick="logVariable('items')" href="../_variables/items.html">$items</a> = <a class="class" onClick="logClass('grade_item')" href="../_classes/grade_item.html" onMouseOver="classPopup(event,'grade_item')">grade_item</a>::<a class="function" onClick="logFunction('fetch_all')" href="../_functions/fetch_all.html" onMouseOver="funcPopup(event,'fetch_all')">fetch_all</a>(array('itemtype'=&gt;'mod', 'itemmodule'=&gt;<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('modulename')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/modulename.html">modulename</a>,
<a name="l210"><span class="linenum"> 210</span></a>                                           'iteminstance'=&gt;<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('instance')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/instance.html">instance</a>, 'courseid'=&gt;<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l211"><span class="linenum"> 211</span></a>      } else {
<a name="l212"><span class="linenum"> 212</span></a>          <a class="var it135" onMouseOver="hilite(135)" onMouseOut="lolite()" onClick="logVariable('items')" href="../_variables/items.html">$items</a> = array();
<a name="l213"><span class="linenum"> 213</span></a>      }
<a name="l214"><span class="linenum"> 214</span></a>  
<a name="l215"><span class="linenum"> 215</span></a>  <span class="comment">    // Create parent category if requested and move to correct parent category.</span>
<a name="l216"><span class="linenum"> 216</span></a>      if (<a class="var it135" onMouseOver="hilite(135)" onMouseOut="lolite()" onClick="logVariable('items')" href="../_variables/items.html">$items</a> and isset(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('gradecat')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/gradecat.html">gradecat</a>)) {
<a name="l217"><span class="linenum"> 217</span></a>          if (<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('gradecat')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/gradecat.html">gradecat</a> == -1) {
<a name="l218"><span class="linenum"> 218</span></a>              <a class="var it6050" onMouseOver="hilite(6050)" onMouseOut="lolite()" onClick="logVariable('grade_category')" href="../_variables/grade_category.html">$grade_category</a> = <span class="keyword">new </span><a class="class" onClick="logClass('grade_category')" href="../_classes/grade_category.html" onMouseOver="classPopup(event,'grade_category')">grade_category</a>();
<a name="l219"><span class="linenum"> 219</span></a>              <a class="var it6050" onMouseOver="hilite(6050)" onMouseOut="lolite()" onClick="logVariable('grade_category')" href="../_variables/grade_category.html">$grade_category</a>-&gt;<a onClick="logVariable('courseid')" class="var it40058" onMouseOver="hilite(40058)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a> = <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l220"><span class="linenum"> 220</span></a>              <a class="var it6050" onMouseOver="hilite(6050)" onMouseOut="lolite()" onClick="logVariable('grade_category')" href="../_variables/grade_category.html">$grade_category</a>-&gt;<a onClick="logVariable('fullname')" class="var it40058" onMouseOver="hilite(40058)" onMouseOut="lolite()" href="../_variables/fullname.html">fullname</a> = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('name')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/name.html">name</a>;
<a name="l221"><span class="linenum"> 221</span></a>              <a class="var it6050" onMouseOver="hilite(6050)" onMouseOut="lolite()" onClick="logVariable('grade_category')" href="../_variables/grade_category.html">$grade_category</a>-&gt;<a class="function" onClick="logFunction('insert')" href="../_functions/insert.html" onMouseOver="funcPopup(event,'insert')">insert</a>();
<a name="l222"><span class="linenum"> 222</span></a>              if (<a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../_variables/grade_item.html">$grade_item</a>) {
<a name="l223"><span class="linenum"> 223</span></a>                  <a class="var it75" onMouseOver="hilite(75)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../_variables/parent.html">$parent</a> = <a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../_variables/grade_item.html">$grade_item</a>-&gt;<a class="function" onClick="logFunction('get_parent_category')" href="../_functions/get_parent_category.html" onMouseOver="funcPopup(event,'get_parent_category')">get_parent_category</a>();
<a name="l224"><span class="linenum"> 224</span></a>                  <a class="var it6050" onMouseOver="hilite(6050)" onMouseOut="lolite()" onClick="logVariable('grade_category')" href="../_variables/grade_category.html">$grade_category</a>-&gt;<a class="function" onClick="logFunction('set_parent')" href="../_functions/set_parent.html" onMouseOver="funcPopup(event,'set_parent')">set_parent</a>(<a class="var it75" onMouseOver="hilite(75)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../_variables/parent.html">$parent</a>-&gt;<a onClick="logVariable('id')" class="var it39475" onMouseOver="hilite(39475)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l225"><span class="linenum"> 225</span></a>              }
<a name="l226"><span class="linenum"> 226</span></a>              <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('gradecat')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/gradecat.html">gradecat</a> = <a class="var it6050" onMouseOver="hilite(6050)" onMouseOut="lolite()" onClick="logVariable('grade_category')" href="../_variables/grade_category.html">$grade_category</a>-&gt;<a onClick="logVariable('id')" class="var it40058" onMouseOver="hilite(40058)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l227"><span class="linenum"> 227</span></a>          }
<a name="l228"><span class="linenum"> 228</span></a>  
<a name="l229"><span class="linenum"> 229</span></a>          foreach (<a class="var it135" onMouseOver="hilite(135)" onMouseOut="lolite()" onClick="logVariable('items')" href="../_variables/items.html">$items</a> as <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../_variables/itemid.html">$itemid</a>=&gt;<a class="var it1136" onMouseOver="hilite(1136)" onMouseOut="lolite()" onClick="logVariable('unused')" href="../_variables/unused.html">$unused</a>) {
<a name="l230"><span class="linenum"> 230</span></a>              <a class="var it135" onMouseOver="hilite(135)" onMouseOut="lolite()" onClick="logVariable('items')" href="../_variables/items.html">$items</a>[<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../_variables/itemid.html">$itemid</a>]-&gt;<a class="function" onClick="logFunction('set_parent')" href="../_functions/set_parent.html" onMouseOver="funcPopup(event,'set_parent')">set_parent</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('gradecat')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/gradecat.html">gradecat</a>);
<a name="l231"><span class="linenum"> 231</span></a>              if (<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../_variables/itemid.html">$itemid</a> == <a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../_variables/grade_item.html">$grade_item</a>-&gt;<a onClick="logVariable('id')" class="var it39507" onMouseOver="hilite(39507)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) {
<a name="l232"><span class="linenum"> 232</span></a>  <span class="comment">                // Use updated grade_item.</span>
<a name="l233"><span class="linenum"> 233</span></a>                  <a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../_variables/grade_item.html">$grade_item</a> = <a class="var it135" onMouseOver="hilite(135)" onMouseOut="lolite()" onClick="logVariable('items')" href="../_variables/items.html">$items</a>[<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../_variables/itemid.html">$itemid</a>];
<a name="l234"><span class="linenum"> 234</span></a>              }
<a name="l235"><span class="linenum"> 235</span></a>              <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('gradecategory')" href="../_variables/gradecategory.html">$gradecategory</a> = <a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../_variables/grade_item.html">$grade_item</a>-&gt;<a class="function" onClick="logFunction('get_parent_category')" href="../_functions/get_parent_category.html" onMouseOver="funcPopup(event,'get_parent_category')">get_parent_category</a>();
<a name="l236"><span class="linenum"> 236</span></a>              if (!empty(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('add')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/add.html">add</a>)) {
<a name="l237"><span class="linenum"> 237</span></a>                  if (<a class="class" onClick="logClass('grade_category')" href="../_classes/grade_category.html" onMouseOver="classPopup(event,'grade_category')">grade_category</a>::<a class="function" onClick="logFunction('aggregation_uses_aggregationcoef')" href="../_functions/aggregation_uses_aggregationcoef.html" onMouseOver="funcPopup(event,'aggregation_uses_aggregationcoef')">aggregation_uses_aggregationcoef</a>(<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('gradecategory')" href="../_variables/gradecategory.html">$gradecategory</a>-&gt;<a onClick="logVariable('aggregation')" class="var it39556" onMouseOver="hilite(39556)" onMouseOut="lolite()" href="../_variables/aggregation.html">aggregation</a>)) {
<a name="l238"><span class="linenum"> 238</span></a>                      if (<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('gradecategory')" href="../_variables/gradecategory.html">$gradecategory</a>-&gt;<a onClick="logVariable('aggregation')" class="var it39556" onMouseOver="hilite(39556)" onMouseOut="lolite()" href="../_variables/aggregation.html">aggregation</a> == <a class="constant" onClick="logConstant('GRADE_AGGREGATE_WEIGHTED_MEAN')" href="../_constants/GRADE_AGGREGATE_WEIGHTED_MEAN.html" onMouseOver="constPopup(event,'GRADE_AGGREGATE_WEIGHTED_MEAN')">GRADE_AGGREGATE_WEIGHTED_MEAN</a>) {
<a name="l239"><span class="linenum"> 239</span></a>                          <a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../_variables/grade_item.html">$grade_item</a>-&gt;<a onClick="logVariable('aggregationcoef')" class="var it39507" onMouseOver="hilite(39507)" onMouseOut="lolite()" href="../_variables/aggregationcoef.html">aggregationcoef</a> = 1;
<a name="l240"><span class="linenum"> 240</span></a>                      } else {
<a name="l241"><span class="linenum"> 241</span></a>                          <a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../_variables/grade_item.html">$grade_item</a>-&gt;<a onClick="logVariable('aggregationcoef')" class="var it39507" onMouseOver="hilite(39507)" onMouseOut="lolite()" href="../_variables/aggregationcoef.html">aggregationcoef</a> = 0;
<a name="l242"><span class="linenum"> 242</span></a>                      }
<a name="l243"><span class="linenum"> 243</span></a>                      <a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../_variables/grade_item.html">$grade_item</a>-&gt;<a class="function" onClick="logFunction('update')" href="../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l244"><span class="linenum"> 244</span></a>                  }
<a name="l245"><span class="linenum"> 245</span></a>              }
<a name="l246"><span class="linenum"> 246</span></a>          }
<a name="l247"><span class="linenum"> 247</span></a>      }
<a name="l248"><span class="linenum"> 248</span></a>  
<a name="l249"><span class="linenum"> 249</span></a>      require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/libdir.html">libdir</a>.'/grade/grade_outcome.php');
<a name="l250"><span class="linenum"> 250</span></a>  <span class="comment">    // Add outcomes if requested.</span>
<a name="l251"><span class="linenum"> 251</span></a>      if (<a class="var it29840" onMouseOver="hilite(29840)" onMouseOut="lolite()" onClick="logVariable('hasoutcomes')" href="../_variables/hasoutcomes.html">$hasoutcomes</a> &amp;&amp; <a class="var it3695" onMouseOver="hilite(3695)" onMouseOut="lolite()" onClick="logVariable('outcomes')" href="../_variables/outcomes.html">$outcomes</a> = <a class="class" onClick="logClass('grade_outcome')" href="../_classes/grade_outcome.html" onMouseOver="classPopup(event,'grade_outcome')">grade_outcome</a>::<a class="function" onClick="logFunction('fetch_all_available')" href="../_functions/fetch_all_available.html" onMouseOver="funcPopup(event,'fetch_all_available')">fetch_all_available</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>)) {
<a name="l252"><span class="linenum"> 252</span></a>          <a class="var it6045" onMouseOver="hilite(6045)" onMouseOut="lolite()" onClick="logVariable('grade_items')" href="../_variables/grade_items.html">$grade_items</a> = array();
<a name="l253"><span class="linenum"> 253</span></a>  
<a name="l254"><span class="linenum"> 254</span></a>  <span class="comment">        // Outcome grade_item.itemnumber start at 1000, there is nothing above outcomes.</span>
<a name="l255"><span class="linenum"> 255</span></a>          <a class="var it29842" onMouseOver="hilite(29842)" onMouseOut="lolite()" onClick="logVariable('max_itemnumber')" href="../_variables/max_itemnumber.html">$max_itemnumber</a> = 999;
<a name="l256"><span class="linenum"> 256</span></a>          if (<a class="var it135" onMouseOver="hilite(135)" onMouseOut="lolite()" onClick="logVariable('items')" href="../_variables/items.html">$items</a>) {
<a name="l257"><span class="linenum"> 257</span></a>              foreach(<a class="var it135" onMouseOver="hilite(135)" onMouseOut="lolite()" onClick="logVariable('items')" href="../_variables/items.html">$items</a> as <a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('item')" href="../_variables/item.html">$item</a>) {
<a name="l258"><span class="linenum"> 258</span></a>                  if (<a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('item')" href="../_variables/item.html">$item</a>-&gt;<a onClick="logVariable('itemnumber')" class="var it39599" onMouseOver="hilite(39599)" onMouseOut="lolite()" href="../_variables/itemnumber.html">itemnumber</a> &gt; <a class="var it29842" onMouseOver="hilite(29842)" onMouseOut="lolite()" onClick="logVariable('max_itemnumber')" href="../_variables/max_itemnumber.html">$max_itemnumber</a>) {
<a name="l259"><span class="linenum"> 259</span></a>                      <a class="var it29842" onMouseOver="hilite(29842)" onMouseOut="lolite()" onClick="logVariable('max_itemnumber')" href="../_variables/max_itemnumber.html">$max_itemnumber</a> = <a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('item')" href="../_variables/item.html">$item</a>-&gt;<a onClick="logVariable('itemnumber')" class="var it39599" onMouseOver="hilite(39599)" onMouseOut="lolite()" href="../_variables/itemnumber.html">itemnumber</a>;
<a name="l260"><span class="linenum"> 260</span></a>                  }
<a name="l261"><span class="linenum"> 261</span></a>              }
<a name="l262"><span class="linenum"> 262</span></a>          }
<a name="l263"><span class="linenum"> 263</span></a>  
<a name="l264"><span class="linenum"> 264</span></a>          foreach(<a class="var it3695" onMouseOver="hilite(3695)" onMouseOut="lolite()" onClick="logVariable('outcomes')" href="../_variables/outcomes.html">$outcomes</a> as <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../_variables/outcome.html">$outcome</a>) {
<a name="l265"><span class="linenum"> 265</span></a>              <a class="var it6422" onMouseOver="hilite(6422)" onMouseOut="lolite()" onClick="logVariable('elname')" href="../_variables/elname.html">$elname</a> = 'outcome_'.<a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../_variables/outcome.html">$outcome</a>-&gt;<a onClick="logVariable('id')" class="var it39893" onMouseOver="hilite(39893)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l266"><span class="linenum"> 266</span></a>  
<a name="l267"><span class="linenum"> 267</span></a>              if (property_exists(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>, <a class="var it6422" onMouseOver="hilite(6422)" onMouseOut="lolite()" onClick="logVariable('elname')" href="../_variables/elname.html">$elname</a>) and <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a class="var it6422" onMouseOver="hilite(6422)" onMouseOut="lolite()" onClick="logVariable('elname')" href="../_variables/elname.html">$elname</a>) {
<a name="l268"><span class="linenum"> 268</span></a>  <span class="comment">                // So we have a request for new outcome grade item?</span>
<a name="l269"><span class="linenum"> 269</span></a>                  if (<a class="var it135" onMouseOver="hilite(135)" onMouseOut="lolite()" onClick="logVariable('items')" href="../_variables/items.html">$items</a>) {
<a name="l270"><span class="linenum"> 270</span></a>                      <a class="var it29843" onMouseOver="hilite(29843)" onMouseOut="lolite()" onClick="logVariable('outcomeexists')" href="../_variables/outcomeexists.html">$outcomeexists</a> = false;
<a name="l271"><span class="linenum"> 271</span></a>                      foreach(<a class="var it135" onMouseOver="hilite(135)" onMouseOut="lolite()" onClick="logVariable('items')" href="../_variables/items.html">$items</a> as <a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('item')" href="../_variables/item.html">$item</a>) {
<a name="l272"><span class="linenum"> 272</span></a>                          if (<a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('item')" href="../_variables/item.html">$item</a>-&gt;<a onClick="logVariable('outcomeid')" class="var it39599" onMouseOver="hilite(39599)" onMouseOut="lolite()" href="../_variables/outcomeid.html">outcomeid</a> == <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../_variables/outcome.html">$outcome</a>-&gt;<a onClick="logVariable('id')" class="var it39893" onMouseOver="hilite(39893)" onMouseOut="lolite()" href="../_variables/id.html">id</a>) {
<a name="l273"><span class="linenum"> 273</span></a>                              <a class="var it29843" onMouseOver="hilite(29843)" onMouseOut="lolite()" onClick="logVariable('outcomeexists')" href="../_variables/outcomeexists.html">$outcomeexists</a> = true;
<a name="l274"><span class="linenum"> 274</span></a>                              break;
<a name="l275"><span class="linenum"> 275</span></a>                          }
<a name="l276"><span class="linenum"> 276</span></a>                      }
<a name="l277"><span class="linenum"> 277</span></a>                      if (<a class="var it29843" onMouseOver="hilite(29843)" onMouseOut="lolite()" onClick="logVariable('outcomeexists')" href="../_variables/outcomeexists.html">$outcomeexists</a>) {
<a name="l278"><span class="linenum"> 278</span></a>                          continue;
<a name="l279"><span class="linenum"> 279</span></a>                      }
<a name="l280"><span class="linenum"> 280</span></a>                  }
<a name="l281"><span class="linenum"> 281</span></a>  
<a name="l282"><span class="linenum"> 282</span></a>                  <a class="var it29842" onMouseOver="hilite(29842)" onMouseOut="lolite()" onClick="logVariable('max_itemnumber')" href="../_variables/max_itemnumber.html">$max_itemnumber</a>++;
<a name="l283"><span class="linenum"> 283</span></a>  
<a name="l284"><span class="linenum"> 284</span></a>                  <a class="var it29844" onMouseOver="hilite(29844)" onMouseOut="lolite()" onClick="logVariable('outcome_item')" href="../_variables/outcome_item.html">$outcome_item</a> = <span class="keyword">new </span><a class="class" onClick="logClass('grade_item')" href="../_classes/grade_item.html" onMouseOver="classPopup(event,'grade_item')">grade_item</a>();
<a name="l285"><span class="linenum"> 285</span></a>                  <a class="var it29844" onMouseOver="hilite(29844)" onMouseOut="lolite()" onClick="logVariable('outcome_item')" href="../_variables/outcome_item.html">$outcome_item</a>-&gt;<a onClick="logVariable('courseid')" class="var it41433" onMouseOver="hilite(41433)" onMouseOut="lolite()" href="../_variables/courseid.html">courseid</a>     = <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l286"><span class="linenum"> 286</span></a>                  <a class="var it29844" onMouseOver="hilite(29844)" onMouseOut="lolite()" onClick="logVariable('outcome_item')" href="../_variables/outcome_item.html">$outcome_item</a>-&gt;<a onClick="logVariable('itemtype')" class="var it41433" onMouseOver="hilite(41433)" onMouseOut="lolite()" href="../_variables/itemtype.html">itemtype</a>     = 'mod';
<a name="l287"><span class="linenum"> 287</span></a>                  <a class="var it29844" onMouseOver="hilite(29844)" onMouseOut="lolite()" onClick="logVariable('outcome_item')" href="../_variables/outcome_item.html">$outcome_item</a>-&gt;<a onClick="logVariable('itemmodule')" class="var it41433" onMouseOver="hilite(41433)" onMouseOut="lolite()" href="../_variables/itemmodule.html">itemmodule</a>   = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('modulename')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/modulename.html">modulename</a>;
<a name="l288"><span class="linenum"> 288</span></a>                  <a class="var it29844" onMouseOver="hilite(29844)" onMouseOut="lolite()" onClick="logVariable('outcome_item')" href="../_variables/outcome_item.html">$outcome_item</a>-&gt;<a onClick="logVariable('iteminstance')" class="var it41433" onMouseOver="hilite(41433)" onMouseOut="lolite()" href="../_variables/iteminstance.html">iteminstance</a> = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('instance')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/instance.html">instance</a>;
<a name="l289"><span class="linenum"> 289</span></a>                  <a class="var it29844" onMouseOver="hilite(29844)" onMouseOut="lolite()" onClick="logVariable('outcome_item')" href="../_variables/outcome_item.html">$outcome_item</a>-&gt;<a onClick="logVariable('itemnumber')" class="var it41433" onMouseOver="hilite(41433)" onMouseOut="lolite()" href="../_variables/itemnumber.html">itemnumber</a>   = <a class="var it29842" onMouseOver="hilite(29842)" onMouseOut="lolite()" onClick="logVariable('max_itemnumber')" href="../_variables/max_itemnumber.html">$max_itemnumber</a>;
<a name="l290"><span class="linenum"> 290</span></a>                  <a class="var it29844" onMouseOver="hilite(29844)" onMouseOut="lolite()" onClick="logVariable('outcome_item')" href="../_variables/outcome_item.html">$outcome_item</a>-&gt;<a onClick="logVariable('itemname')" class="var it41433" onMouseOver="hilite(41433)" onMouseOut="lolite()" href="../_variables/itemname.html">itemname</a>     = <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../_variables/outcome.html">$outcome</a>-&gt;<a onClick="logVariable('fullname')" class="var it39893" onMouseOver="hilite(39893)" onMouseOut="lolite()" href="../_variables/fullname.html">fullname</a>;
<a name="l291"><span class="linenum"> 291</span></a>                  <a class="var it29844" onMouseOver="hilite(29844)" onMouseOut="lolite()" onClick="logVariable('outcome_item')" href="../_variables/outcome_item.html">$outcome_item</a>-&gt;<a onClick="logVariable('outcomeid')" class="var it41433" onMouseOver="hilite(41433)" onMouseOut="lolite()" href="../_variables/outcomeid.html">outcomeid</a>    = <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../_variables/outcome.html">$outcome</a>-&gt;<a onClick="logVariable('id')" class="var it39893" onMouseOver="hilite(39893)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l292"><span class="linenum"> 292</span></a>                  <a class="var it29844" onMouseOver="hilite(29844)" onMouseOut="lolite()" onClick="logVariable('outcome_item')" href="../_variables/outcome_item.html">$outcome_item</a>-&gt;<a onClick="logVariable('gradetype')" class="var it41433" onMouseOver="hilite(41433)" onMouseOut="lolite()" href="../_variables/gradetype.html">gradetype</a>    = <a class="constant" onClick="logConstant('GRADE_TYPE_SCALE')" href="../_constants/GRADE_TYPE_SCALE.html" onMouseOver="constPopup(event,'GRADE_TYPE_SCALE')">GRADE_TYPE_SCALE</a>;
<a name="l293"><span class="linenum"> 293</span></a>                  <a class="var it29844" onMouseOver="hilite(29844)" onMouseOut="lolite()" onClick="logVariable('outcome_item')" href="../_variables/outcome_item.html">$outcome_item</a>-&gt;<a onClick="logVariable('scaleid')" class="var it41433" onMouseOver="hilite(41433)" onMouseOut="lolite()" href="../_variables/scaleid.html">scaleid</a>      = <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../_variables/outcome.html">$outcome</a>-&gt;<a onClick="logVariable('scaleid')" class="var it39893" onMouseOver="hilite(39893)" onMouseOut="lolite()" href="../_variables/scaleid.html">scaleid</a>;
<a name="l294"><span class="linenum"> 294</span></a>                  <a class="var it29844" onMouseOver="hilite(29844)" onMouseOut="lolite()" onClick="logVariable('outcome_item')" href="../_variables/outcome_item.html">$outcome_item</a>-&gt;<a class="function" onClick="logFunction('insert')" href="../_functions/insert.html" onMouseOver="funcPopup(event,'insert')">insert</a>();
<a name="l295"><span class="linenum"> 295</span></a>  
<a name="l296"><span class="linenum"> 296</span></a>  <span class="comment">                // Move the new outcome into correct category and fix sortorder if needed.</span>
<a name="l297"><span class="linenum"> 297</span></a>                  if (<a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../_variables/grade_item.html">$grade_item</a>) {
<a name="l298"><span class="linenum"> 298</span></a>                      <a class="var it29844" onMouseOver="hilite(29844)" onMouseOut="lolite()" onClick="logVariable('outcome_item')" href="../_variables/outcome_item.html">$outcome_item</a>-&gt;<a class="function" onClick="logFunction('set_parent')" href="../_functions/set_parent.html" onMouseOver="funcPopup(event,'set_parent')">set_parent</a>(<a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../_variables/grade_item.html">$grade_item</a>-&gt;<a onClick="logVariable('categoryid')" class="var it39507" onMouseOver="hilite(39507)" onMouseOut="lolite()" href="../_variables/categoryid.html">categoryid</a>);
<a name="l299"><span class="linenum"> 299</span></a>                      <a class="var it29844" onMouseOver="hilite(29844)" onMouseOut="lolite()" onClick="logVariable('outcome_item')" href="../_variables/outcome_item.html">$outcome_item</a>-&gt;<a class="function" onClick="logFunction('move_after_sortorder')" href="../_functions/move_after_sortorder.html" onMouseOver="funcPopup(event,'move_after_sortorder')">move_after_sortorder</a>(<a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('grade_item')" href="../_variables/grade_item.html">$grade_item</a>-&gt;<a onClick="logVariable('sortorder')" class="var it39507" onMouseOver="hilite(39507)" onMouseOut="lolite()" href="../_variables/sortorder.html">sortorder</a>);
<a name="l300"><span class="linenum"> 300</span></a>  
<a name="l301"><span class="linenum"> 301</span></a>                  } else if (isset(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('gradecat')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/gradecat.html">gradecat</a>)) {
<a name="l302"><span class="linenum"> 302</span></a>                      <a class="var it29844" onMouseOver="hilite(29844)" onMouseOut="lolite()" onClick="logVariable('outcome_item')" href="../_variables/outcome_item.html">$outcome_item</a>-&gt;<a class="function" onClick="logFunction('set_parent')" href="../_functions/set_parent.html" onMouseOver="funcPopup(event,'set_parent')">set_parent</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('gradecat')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/gradecat.html">gradecat</a>);
<a name="l303"><span class="linenum"> 303</span></a>                  }
<a name="l304"><span class="linenum"> 304</span></a>                  <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('gradecategory')" href="../_variables/gradecategory.html">$gradecategory</a> = <a class="var it29844" onMouseOver="hilite(29844)" onMouseOut="lolite()" onClick="logVariable('outcome_item')" href="../_variables/outcome_item.html">$outcome_item</a>-&gt;<a class="function" onClick="logFunction('get_parent_category')" href="../_functions/get_parent_category.html" onMouseOver="funcPopup(event,'get_parent_category')">get_parent_category</a>();
<a name="l305"><span class="linenum"> 305</span></a>                  if (<a class="var it29843" onMouseOver="hilite(29843)" onMouseOut="lolite()" onClick="logVariable('outcomeexists')" href="../_variables/outcomeexists.html">$outcomeexists</a> == false) {
<a name="l306"><span class="linenum"> 306</span></a>                      if (<a class="class" onClick="logClass('grade_category')" href="../_classes/grade_category.html" onMouseOver="classPopup(event,'grade_category')">grade_category</a>::<a class="function" onClick="logFunction('aggregation_uses_aggregationcoef')" href="../_functions/aggregation_uses_aggregationcoef.html" onMouseOver="funcPopup(event,'aggregation_uses_aggregationcoef')">aggregation_uses_aggregationcoef</a>(<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('gradecategory')" href="../_variables/gradecategory.html">$gradecategory</a>-&gt;<a onClick="logVariable('aggregation')" class="var it39556" onMouseOver="hilite(39556)" onMouseOut="lolite()" href="../_variables/aggregation.html">aggregation</a>)) {
<a name="l307"><span class="linenum"> 307</span></a>                          if (<a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('gradecategory')" href="../_variables/gradecategory.html">$gradecategory</a>-&gt;<a onClick="logVariable('aggregation')" class="var it39556" onMouseOver="hilite(39556)" onMouseOut="lolite()" href="../_variables/aggregation.html">aggregation</a> == <a class="constant" onClick="logConstant('GRADE_AGGREGATE_WEIGHTED_MEAN')" href="../_constants/GRADE_AGGREGATE_WEIGHTED_MEAN.html" onMouseOver="constPopup(event,'GRADE_AGGREGATE_WEIGHTED_MEAN')">GRADE_AGGREGATE_WEIGHTED_MEAN</a>) {
<a name="l308"><span class="linenum"> 308</span></a>                              <a class="var it29844" onMouseOver="hilite(29844)" onMouseOut="lolite()" onClick="logVariable('outcome_item')" href="../_variables/outcome_item.html">$outcome_item</a>-&gt;<a onClick="logVariable('aggregationcoef')" class="var it41433" onMouseOver="hilite(41433)" onMouseOut="lolite()" href="../_variables/aggregationcoef.html">aggregationcoef</a> = 1;
<a name="l309"><span class="linenum"> 309</span></a>                          } else {
<a name="l310"><span class="linenum"> 310</span></a>                              <a class="var it29844" onMouseOver="hilite(29844)" onMouseOut="lolite()" onClick="logVariable('outcome_item')" href="../_variables/outcome_item.html">$outcome_item</a>-&gt;<a onClick="logVariable('aggregationcoef')" class="var it41433" onMouseOver="hilite(41433)" onMouseOut="lolite()" href="../_variables/aggregationcoef.html">aggregationcoef</a> = 0;
<a name="l311"><span class="linenum"> 311</span></a>                          }
<a name="l312"><span class="linenum"> 312</span></a>                          <a class="var it29844" onMouseOver="hilite(29844)" onMouseOut="lolite()" onClick="logVariable('outcome_item')" href="../_variables/outcome_item.html">$outcome_item</a>-&gt;<a class="function" onClick="logFunction('update')" href="../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l313"><span class="linenum"> 313</span></a>                      }
<a name="l314"><span class="linenum"> 314</span></a>                  }
<a name="l315"><span class="linenum"> 315</span></a>              }
<a name="l316"><span class="linenum"> 316</span></a>          }
<a name="l317"><span class="linenum"> 317</span></a>      }
<a name="l318"><span class="linenum"> 318</span></a>  
<a name="l319"><span class="linenum"> 319</span></a>      if (<a class="function" onClick="logFunction('plugin_supports')" href="../_functions/plugin_supports.html" onMouseOver="funcPopup(event,'plugin_supports')">plugin_supports</a>('mod', <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('modulename')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/modulename.html">modulename</a>, <a class="constant" onClick="logConstant('FEATURE_ADVANCED_GRADING')" href="../_constants/FEATURE_ADVANCED_GRADING.html" onMouseOver="constPopup(event,'FEATURE_ADVANCED_GRADING')">FEATURE_ADVANCED_GRADING</a>, false)
<a name="l320"><span class="linenum"> 320</span></a>              and <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/grade:managegradingforms', <a class="var it1418" onMouseOver="hilite(1418)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../_variables/modcontext.html">$modcontext</a>)) {
<a name="l321"><span class="linenum"> 321</span></a>          require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>.'<a class="filename" href="../grade/grading/lib.php.html">/grade/grading/lib.php</a>');
<a name="l322"><span class="linenum"> 322</span></a>          <a class="var it10729" onMouseOver="hilite(10729)" onMouseOut="lolite()" onClick="logVariable('gradingman')" href="../_variables/gradingman.html">$gradingman</a> = <a class="function" onClick="logFunction('get_grading_manager')" href="../_functions/get_grading_manager.html" onMouseOver="funcPopup(event,'get_grading_manager')">get_grading_manager</a>(<a class="var it1418" onMouseOver="hilite(1418)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../_variables/modcontext.html">$modcontext</a>, 'mod_'.<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('modulename')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/modulename.html">modulename</a>);
<a name="l323"><span class="linenum"> 323</span></a>          <a class="var it10734" onMouseOver="hilite(10734)" onMouseOut="lolite()" onClick="logVariable('showgradingmanagement')" href="../_variables/showgradingmanagement.html">$showgradingmanagement</a> = false;
<a name="l324"><span class="linenum"> 324</span></a>          foreach (<a class="var it10729" onMouseOver="hilite(10729)" onMouseOut="lolite()" onClick="logVariable('gradingman')" href="../_variables/gradingman.html">$gradingman</a>-&gt;<a class="function" onClick="logFunction('get_available_areas')" href="../_functions/get_available_areas.html" onMouseOver="funcPopup(event,'get_available_areas')">get_available_areas</a>() as <a class="var it1604" onMouseOver="hilite(1604)" onMouseOut="lolite()" onClick="logVariable('areaname')" href="../_variables/areaname.html">$areaname</a> =&gt; <a class="var it29845" onMouseOver="hilite(29845)" onMouseOut="lolite()" onClick="logVariable('aretitle')" href="../_variables/aretitle.html">$aretitle</a>) {
<a name="l325"><span class="linenum"> 325</span></a>              <a class="var it10724" onMouseOver="hilite(10724)" onMouseOut="lolite()" onClick="logVariable('formfield')" href="../_variables/formfield.html">$formfield</a> = 'advancedgradingmethod_'.<a class="var it1604" onMouseOver="hilite(1604)" onMouseOut="lolite()" onClick="logVariable('areaname')" href="../_variables/areaname.html">$areaname</a>;
<a name="l326"><span class="linenum"> 326</span></a>              if (isset(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;{<a class="var it10724" onMouseOver="hilite(10724)" onMouseOut="lolite()" onClick="logVariable('formfield')" href="../_variables/formfield.html">$formfield</a>})) {
<a name="l327"><span class="linenum"> 327</span></a>                  <a class="var it10729" onMouseOver="hilite(10729)" onMouseOut="lolite()" onClick="logVariable('gradingman')" href="../_variables/gradingman.html">$gradingman</a>-&gt;<a class="function" onClick="logFunction('set_area')" href="../_functions/set_area.html" onMouseOver="funcPopup(event,'set_area')">set_area</a>(<a class="var it1604" onMouseOver="hilite(1604)" onMouseOut="lolite()" onClick="logVariable('areaname')" href="../_variables/areaname.html">$areaname</a>);
<a name="l328"><span class="linenum"> 328</span></a>                  <a class="var it29846" onMouseOver="hilite(29846)" onMouseOut="lolite()" onClick="logVariable('methodchanged')" href="../_variables/methodchanged.html">$methodchanged</a> = <a class="var it10729" onMouseOver="hilite(10729)" onMouseOut="lolite()" onClick="logVariable('gradingman')" href="../_variables/gradingman.html">$gradingman</a>-&gt;<a class="function" onClick="logFunction('set_active_method')" href="../_functions/set_active_method.html" onMouseOver="funcPopup(event,'set_active_method')">set_active_method</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;{<a class="var it10724" onMouseOver="hilite(10724)" onMouseOut="lolite()" onClick="logVariable('formfield')" href="../_variables/formfield.html">$formfield</a>});
<a name="l329"><span class="linenum"> 329</span></a>                  if (empty(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;{<a class="var it10724" onMouseOver="hilite(10724)" onMouseOut="lolite()" onClick="logVariable('formfield')" href="../_variables/formfield.html">$formfield</a>})) {
<a name="l330"><span class="linenum"> 330</span></a>  <span class="comment">                    // Going back to the simple direct grading is not a reason to open the management screen.</span>
<a name="l331"><span class="linenum"> 331</span></a>                      <a class="var it29846" onMouseOver="hilite(29846)" onMouseOut="lolite()" onClick="logVariable('methodchanged')" href="../_variables/methodchanged.html">$methodchanged</a> = false;
<a name="l332"><span class="linenum"> 332</span></a>                  }
<a name="l333"><span class="linenum"> 333</span></a>                  <a class="var it10734" onMouseOver="hilite(10734)" onMouseOut="lolite()" onClick="logVariable('showgradingmanagement')" href="../_variables/showgradingmanagement.html">$showgradingmanagement</a> = <a class="var it10734" onMouseOver="hilite(10734)" onMouseOut="lolite()" onClick="logVariable('showgradingmanagement')" href="../_variables/showgradingmanagement.html">$showgradingmanagement</a> || <a class="var it29846" onMouseOver="hilite(29846)" onMouseOut="lolite()" onClick="logVariable('methodchanged')" href="../_variables/methodchanged.html">$methodchanged</a>;
<a name="l334"><span class="linenum"> 334</span></a>              }
<a name="l335"><span class="linenum"> 335</span></a>          }
<a name="l336"><span class="linenum"> 336</span></a>  <span class="comment">        // Update grading management information.</span>
<a name="l337"><span class="linenum"> 337</span></a>          <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('gradingman')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/gradingman.html">gradingman</a> = <a class="var it10729" onMouseOver="hilite(10729)" onMouseOut="lolite()" onClick="logVariable('gradingman')" href="../_variables/gradingman.html">$gradingman</a>;
<a name="l338"><span class="linenum"> 338</span></a>          <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('showgradingmanagement')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/showgradingmanagement.html">showgradingmanagement</a> = <a class="var it10734" onMouseOver="hilite(10734)" onMouseOut="lolite()" onClick="logVariable('showgradingmanagement')" href="../_variables/showgradingmanagement.html">$showgradingmanagement</a>;
<a name="l339"><span class="linenum"> 339</span></a>      }
<a name="l340"><span class="linenum"> 340</span></a>  
<a name="l341"><span class="linenum"> 341</span></a>      <a class="function" onClick="logFunction('rebuild_course_cache')" href="../_functions/rebuild_course_cache.html" onMouseOver="funcPopup(event,'rebuild_course_cache')">rebuild_course_cache</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, true);
<a name="l342"><span class="linenum"> 342</span></a>      if (<a class="var it29839" onMouseOver="hilite(29839)" onMouseOut="lolite()" onClick="logVariable('hasgrades')" href="../_variables/hasgrades.html">$hasgrades</a>) {
<a name="l343"><span class="linenum"> 343</span></a>          <a class="function" onClick="logFunction('grade_regrade_final_grades')" href="../_functions/grade_regrade_final_grades.html" onMouseOver="funcPopup(event,'grade_regrade_final_grades')">grade_regrade_final_grades</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l344"><span class="linenum"> 344</span></a>      }
<a name="l345"><span class="linenum"> 345</span></a>      require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/libdir.html">libdir</a>.'/plagiarismlib.php');
<a name="l346"><span class="linenum"> 346</span></a>      <a class="function" onClick="logFunction('plagiarism_save_form_elements')" href="../_functions/plagiarism_save_form_elements.html" onMouseOver="funcPopup(event,'plagiarism_save_form_elements')">plagiarism_save_form_elements</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>);
<a name="l347"><span class="linenum"> 347</span></a>  
<a name="l348"><span class="linenum"> 348</span></a>      return <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>;
<a name="l349"><span class="linenum"> 349</span></a>  }
<a name="l350"><span class="linenum"> 350</span></a>  
<a name="l351"><span class="linenum"> 351</span></a>  
<a name="l352"><span class="linenum"> 352</span></a>  <span class="comment">/**</span>
<a name="l353"><span class="linenum"> 353</span></a>  <span class="comment"> * Set module info default values for the unset module attributs.</span>
<a name="l354"><span class="linenum"> 354</span></a>  <span class="comment"> *</span>
<a name="l355"><span class="linenum"> 355</span></a>  <span class="comment"> * @param object $moduleinfo the current known data of the module</span>
<a name="l356"><span class="linenum"> 356</span></a>  <span class="comment"> * @return object the completed module info</span>
<a name="l357"><span class="linenum"> 357</span></a>  <span class="comment"> */</span>
<a name="l358"><span class="linenum"> 358</span></a>  function <a class="function" onClick="logFunction('set_moduleinfo_defaults')" href="../_functions/set_moduleinfo_defaults.html" onMouseOver="funcPopup(event,'set_moduleinfo_defaults')">set_moduleinfo_defaults</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>) {
<a name="l359"><span class="linenum"> 359</span></a>  
<a name="l360"><span class="linenum"> 360</span></a>      if (empty(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/coursemodule.html">coursemodule</a>)) {
<a name="l361"><span class="linenum"> 361</span></a>  <span class="comment">        // Add.</span>
<a name="l362"><span class="linenum"> 362</span></a>          <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a> = null;
<a name="l363"><span class="linenum"> 363</span></a>          <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('instance')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/instance.html">instance</a>     = '';
<a name="l364"><span class="linenum"> 364</span></a>          <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/coursemodule.html">coursemodule</a> = '';
<a name="l365"><span class="linenum"> 365</span></a>      } else {
<a name="l366"><span class="linenum"> 366</span></a>  <span class="comment">        // Update.</span>
<a name="l367"><span class="linenum"> 367</span></a>          <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_id')" href="../_functions/get_coursemodule_from_id.html" onMouseOver="funcPopup(event,'get_coursemodule_from_id')">get_coursemodule_from_id</a>('', <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/coursemodule.html">coursemodule</a>, 0, false, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l368"><span class="linenum"> 368</span></a>          <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('instance')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/instance.html">instance</a>     = <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/instance.html">instance</a>;
<a name="l369"><span class="linenum"> 369</span></a>          <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/coursemodule.html">coursemodule</a> = <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l370"><span class="linenum"> 370</span></a>      }
<a name="l371"><span class="linenum"> 371</span></a>  <span class="comment">    // For safety.</span>
<a name="l372"><span class="linenum"> 372</span></a>      <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('modulename')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/modulename.html">modulename</a> = <a class="function" onClick="logFunction('clean_param')" href="../_functions/clean_param.html" onMouseOver="funcPopup(event,'clean_param')">clean_param</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('modulename')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/modulename.html">modulename</a>, <a class="constant" onClick="logConstant('PARAM_PLUGIN')" href="../_constants/PARAM_PLUGIN.html" onMouseOver="constPopup(event,'PARAM_PLUGIN')">PARAM_PLUGIN</a>);
<a name="l373"><span class="linenum"> 373</span></a>  
<a name="l374"><span class="linenum"> 374</span></a>      if (!isset(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('groupingid')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/groupingid.html">groupingid</a>)) {
<a name="l375"><span class="linenum"> 375</span></a>          <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('groupingid')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/groupingid.html">groupingid</a> = 0;
<a name="l376"><span class="linenum"> 376</span></a>      }
<a name="l377"><span class="linenum"> 377</span></a>  
<a name="l378"><span class="linenum"> 378</span></a>      if (!isset(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('name')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/name.html">name</a>)) { // Label.
<a name="l379"><span class="linenum"> 379</span></a>          <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('name')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/name.html">name</a> = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('modulename')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/modulename.html">modulename</a>;
<a name="l380"><span class="linenum"> 380</span></a>      }
<a name="l381"><span class="linenum"> 381</span></a>  
<a name="l382"><span class="linenum"> 382</span></a>      if (!isset(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('completion')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/completion.html">completion</a>)) {
<a name="l383"><span class="linenum"> 383</span></a>          <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('completion')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/completion.html">completion</a> = <a class="constant" onClick="logConstant('COMPLETION_DISABLED')" href="../_constants/COMPLETION_DISABLED.html" onMouseOver="constPopup(event,'COMPLETION_DISABLED')">COMPLETION_DISABLED</a>;
<a name="l384"><span class="linenum"> 384</span></a>      }
<a name="l385"><span class="linenum"> 385</span></a>      if (!isset(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('completionview')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/completionview.html">completionview</a>)) {
<a name="l386"><span class="linenum"> 386</span></a>          <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('completionview')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/completionview.html">completionview</a> = <a class="constant" onClick="logConstant('COMPLETION_VIEW_NOT_REQUIRED')" href="../_constants/COMPLETION_VIEW_NOT_REQUIRED.html" onMouseOver="constPopup(event,'COMPLETION_VIEW_NOT_REQUIRED')">COMPLETION_VIEW_NOT_REQUIRED</a>;
<a name="l387"><span class="linenum"> 387</span></a>      }
<a name="l388"><span class="linenum"> 388</span></a>      if (!isset(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('completionexpected')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/completionexpected.html">completionexpected</a>)) {
<a name="l389"><span class="linenum"> 389</span></a>          <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('completionexpected')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/completionexpected.html">completionexpected</a> = 0;
<a name="l390"><span class="linenum"> 390</span></a>      }
<a name="l391"><span class="linenum"> 391</span></a>  
<a name="l392"><span class="linenum"> 392</span></a>  <span class="comment">    // Convert the 'use grade' checkbox into a grade-item number: 0 if checked, null if not.</span>
<a name="l393"><span class="linenum"> 393</span></a>      if (isset(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('completionusegrade')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/completionusegrade.html">completionusegrade</a>) &amp;&amp; <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('completionusegrade')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/completionusegrade.html">completionusegrade</a>) {
<a name="l394"><span class="linenum"> 394</span></a>          <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('completiongradeitemnumber')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/completiongradeitemnumber.html">completiongradeitemnumber</a> = 0;
<a name="l395"><span class="linenum"> 395</span></a>      } else {
<a name="l396"><span class="linenum"> 396</span></a>          <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('completiongradeitemnumber')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/completiongradeitemnumber.html">completiongradeitemnumber</a> = null;
<a name="l397"><span class="linenum"> 397</span></a>      }
<a name="l398"><span class="linenum"> 398</span></a>  
<a name="l399"><span class="linenum"> 399</span></a>      if (!isset(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('conditiongradegroup')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/conditiongradegroup.html">conditiongradegroup</a>)) {
<a name="l400"><span class="linenum"> 400</span></a>          <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('conditiongradegroup')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/conditiongradegroup.html">conditiongradegroup</a> = array();
<a name="l401"><span class="linenum"> 401</span></a>      }
<a name="l402"><span class="linenum"> 402</span></a>      if (!isset(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('conditionfieldgroup')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/conditionfieldgroup.html">conditionfieldgroup</a>)) {
<a name="l403"><span class="linenum"> 403</span></a>          <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('conditionfieldgroup')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/conditionfieldgroup.html">conditionfieldgroup</a> = array();
<a name="l404"><span class="linenum"> 404</span></a>      }
<a name="l405"><span class="linenum"> 405</span></a>  
<a name="l406"><span class="linenum"> 406</span></a>      return <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>;
<a name="l407"><span class="linenum"> 407</span></a>  }
<a name="l408"><span class="linenum"> 408</span></a>  
<a name="l409"><span class="linenum"> 409</span></a>  <span class="comment">/**</span>
<a name="l410"><span class="linenum"> 410</span></a>  <span class="comment"> * Check that the user can add a module. Also returns some information like the module, context and course section info.</span>
<a name="l411"><span class="linenum"> 411</span></a>  <span class="comment"> * The fucntion create the course section if it doesn't exist.</span>
<a name="l412"><span class="linenum"> 412</span></a>  <span class="comment"> *</span>
<a name="l413"><span class="linenum"> 413</span></a>  <span class="comment"> * @param object $course the course of the module</span>
<a name="l414"><span class="linenum"> 414</span></a>  <span class="comment"> * @param object $modulename the module name</span>
<a name="l415"><span class="linenum"> 415</span></a>  <span class="comment"> * @param object $section the section of the module</span>
<a name="l416"><span class="linenum"> 416</span></a>  <span class="comment"> * @return array list containing module, context, course section.</span>
<a name="l417"><span class="linenum"> 417</span></a>  <span class="comment"> * @throws moodle_exception if user is not allowed to perform the action or module is not allowed in this course</span>
<a name="l418"><span class="linenum"> 418</span></a>  <span class="comment"> */</span>
<a name="l419"><span class="linenum"> 419</span></a>  function <a class="function" onClick="logFunction('can_add_moduleinfo')" href="../_functions/can_add_moduleinfo.html" onMouseOver="funcPopup(event,'can_add_moduleinfo')">can_add_moduleinfo</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>, <a class="var it557" onMouseOver="hilite(557)" onMouseOut="lolite()" onClick="logVariable('modulename')" href="../_variables/modulename.html">$modulename</a>, <a class="var it15" onMouseOver="hilite(15)" onMouseOut="lolite()" onClick="logVariable('section')" href="../_variables/section.html">$section</a>) {
<a name="l420"><span class="linenum"> 420</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l421"><span class="linenum"> 421</span></a>  
<a name="l422"><span class="linenum"> 422</span></a>      <a class="var it611" onMouseOver="hilite(611)" onMouseOut="lolite()" onClick="logVariable('module')" href="../_variables/module.html">$module</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('modules', array('name'=&gt;<a class="var it557" onMouseOver="hilite(557)" onMouseOut="lolite()" onClick="logVariable('modulename')" href="../_variables/modulename.html">$modulename</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l423"><span class="linenum"> 423</span></a>  
<a name="l424"><span class="linenum"> 424</span></a>      <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l425"><span class="linenum"> 425</span></a>      <a class="function" onClick="logFunction('require_capability')" href="../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/course:manageactivities', <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l426"><span class="linenum"> 426</span></a>  
<a name="l427"><span class="linenum"> 427</span></a>      <a class="function" onClick="logFunction('course_create_sections_if_missing')" href="../_functions/course_create_sections_if_missing.html" onMouseOver="funcPopup(event,'course_create_sections_if_missing')">course_create_sections_if_missing</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>, <a class="var it15" onMouseOver="hilite(15)" onMouseOut="lolite()" onClick="logVariable('section')" href="../_variables/section.html">$section</a>);
<a name="l428"><span class="linenum"> 428</span></a>      <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('cw')" href="../_variables/cw.html">$cw</a> = <a class="function" onClick="logFunction('get_fast_modinfo')" href="../_functions/get_fast_modinfo.html" onMouseOver="funcPopup(event,'get_fast_modinfo')">get_fast_modinfo</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>)-&gt;<a class="function" onClick="logFunction('get_section_info')" href="../_functions/get_section_info.html" onMouseOver="funcPopup(event,'get_section_info')">get_section_info</a>(<a class="var it15" onMouseOver="hilite(15)" onMouseOut="lolite()" onClick="logVariable('section')" href="../_variables/section.html">$section</a>);
<a name="l429"><span class="linenum"> 429</span></a>  
<a name="l430"><span class="linenum"> 430</span></a>      if (!<a class="function" onClick="logFunction('course_allowed_module')" href="../_functions/course_allowed_module.html" onMouseOver="funcPopup(event,'course_allowed_module')">course_allowed_module</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>, <a class="var it611" onMouseOver="hilite(611)" onMouseOut="lolite()" onClick="logVariable('module')" href="../_variables/module.html">$module</a>-&gt;<a onClick="logVariable('name')" class="var it39455" onMouseOver="hilite(39455)" onMouseOut="lolite()" href="../_variables/name.html">name</a>)) {
<a name="l431"><span class="linenum"> 431</span></a>          <a class="function" onClick="logFunction('print_error')" href="../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('moduledisable');
<a name="l432"><span class="linenum"> 432</span></a>      }
<a name="l433"><span class="linenum"> 433</span></a>  
<a name="l434"><span class="linenum"> 434</span></a>      return array(<a class="var it611" onMouseOver="hilite(611)" onMouseOut="lolite()" onClick="logVariable('module')" href="../_variables/module.html">$module</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('cw')" href="../_variables/cw.html">$cw</a>);
<a name="l435"><span class="linenum"> 435</span></a>  }
<a name="l436"><span class="linenum"> 436</span></a>  
<a name="l437"><span class="linenum"> 437</span></a>  <span class="comment">/**</span>
<a name="l438"><span class="linenum"> 438</span></a>  <span class="comment"> * Check if user is allowed to update module info and returns related item/data to the module.</span>
<a name="l439"><span class="linenum"> 439</span></a>  <span class="comment"> *</span>
<a name="l440"><span class="linenum"> 440</span></a>  <span class="comment"> * @param object $cm course module</span>
<a name="l441"><span class="linenum"> 441</span></a>  <span class="comment"> * @return array - list of course module, context, module, moduleinfo, and course section.</span>
<a name="l442"><span class="linenum"> 442</span></a>  <span class="comment"> * @throws moodle_exception if user is not allowed to perform the action</span>
<a name="l443"><span class="linenum"> 443</span></a>  <span class="comment"> */</span>
<a name="l444"><span class="linenum"> 444</span></a>  function <a class="function" onClick="logFunction('can_update_moduleinfo')" href="../_functions/can_update_moduleinfo.html" onMouseOver="funcPopup(event,'can_update_moduleinfo')">can_update_moduleinfo</a>(<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>) {
<a name="l445"><span class="linenum"> 445</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l446"><span class="linenum"> 446</span></a>  
<a name="l447"><span class="linenum"> 447</span></a>  <span class="comment">    // Check the $USER has the right capability.</span>
<a name="l448"><span class="linenum"> 448</span></a>      <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l449"><span class="linenum"> 449</span></a>      <a class="function" onClick="logFunction('require_capability')" href="../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/course:manageactivities', <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>);
<a name="l450"><span class="linenum"> 450</span></a>  
<a name="l451"><span class="linenum"> 451</span></a>  <span class="comment">    // Check module exists.</span>
<a name="l452"><span class="linenum"> 452</span></a>      <a class="var it611" onMouseOver="hilite(611)" onMouseOut="lolite()" onClick="logVariable('module')" href="../_variables/module.html">$module</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('modules', array('id'=&gt;<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('module')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/module.html">module</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l453"><span class="linenum"> 453</span></a>  
<a name="l454"><span class="linenum"> 454</span></a>  <span class="comment">    // Check the moduleinfo exists.</span>
<a name="l455"><span class="linenum"> 455</span></a>      <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(<a class="var it611" onMouseOver="hilite(611)" onMouseOut="lolite()" onClick="logVariable('module')" href="../_variables/module.html">$module</a>-&gt;<a onClick="logVariable('name')" class="var it39455" onMouseOver="hilite(39455)" onMouseOut="lolite()" href="../_variables/name.html">name</a>, array('id'=&gt;<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('instance')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/instance.html">instance</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l456"><span class="linenum"> 456</span></a>  
<a name="l457"><span class="linenum"> 457</span></a>  <span class="comment">    // Check the course section exists.</span>
<a name="l458"><span class="linenum"> 458</span></a>      <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('cw')" href="../_variables/cw.html">$cw</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course_sections', array('id'=&gt;<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('section')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/section.html">section</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l459"><span class="linenum"> 459</span></a>  
<a name="l460"><span class="linenum"> 460</span></a>      return array(<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>, <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('context')" href="../_variables/context.html">$context</a>, <a class="var it611" onMouseOver="hilite(611)" onMouseOut="lolite()" onClick="logVariable('module')" href="../_variables/module.html">$module</a>, <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('data')" href="../_variables/data.html">$data</a>, <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('cw')" href="../_variables/cw.html">$cw</a>);
<a name="l461"><span class="linenum"> 461</span></a>  }
<a name="l462"><span class="linenum"> 462</span></a>  
<a name="l463"><span class="linenum"> 463</span></a>  
<a name="l464"><span class="linenum"> 464</span></a>  <span class="comment">/**</span>
<a name="l465"><span class="linenum"> 465</span></a>  <span class="comment"> * Update the module info.</span>
<a name="l466"><span class="linenum"> 466</span></a>  <span class="comment"> * This function doesn't check the user capabilities. It updates the course module and the module instance.</span>
<a name="l467"><span class="linenum"> 467</span></a>  <span class="comment"> * Then execute common action to create/update module process (trigger event, rebuild cache, save plagiarism settings...).</span>
<a name="l468"><span class="linenum"> 468</span></a>  <span class="comment"> *</span>
<a name="l469"><span class="linenum"> 469</span></a>  <span class="comment"> * @param object $cm course module</span>
<a name="l470"><span class="linenum"> 470</span></a>  <span class="comment"> * @param object $moduleinfo module info</span>
<a name="l471"><span class="linenum"> 471</span></a>  <span class="comment"> * @param object $course course of the module</span>
<a name="l472"><span class="linenum"> 472</span></a>  <span class="comment"> * @param object $mform - the mform is required by some specific module in the function MODULE_update_instance(). This is due to a hack in this function.</span>
<a name="l473"><span class="linenum"> 473</span></a>  <span class="comment"> * @return array list of course module and module info.</span>
<a name="l474"><span class="linenum"> 474</span></a>  <span class="comment"> */</span>
<a name="l475"><span class="linenum"> 475</span></a>  function <a class="function" onClick="logFunction('update_moduleinfo')" href="../_functions/update_moduleinfo.html" onMouseOver="funcPopup(event,'update_moduleinfo')">update_moduleinfo</a>(<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>, <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>, <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>, <a class="var it1037" onMouseOver="hilite(1037)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../_variables/mform.html">$mform</a> = null) {
<a name="l476"><span class="linenum"> 476</span></a>      global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l477"><span class="linenum"> 477</span></a>  
<a name="l478"><span class="linenum"> 478</span></a>  <span class="comment">    // Attempt to include module library before we make any changes to DB.</span>
<a name="l479"><span class="linenum"> 479</span></a>      <a class="function" onClick="logFunction('include_modulelib')" href="../_functions/include_modulelib.html" onMouseOver="funcPopup(event,'include_modulelib')">include_modulelib</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('modulename')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/modulename.html">modulename</a>);
<a name="l480"><span class="linenum"> 480</span></a>  
<a name="l481"><span class="linenum"> 481</span></a>      <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('course')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/course.html">course</a> = <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l482"><span class="linenum"> 482</span></a>      <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a> = <a class="function" onClick="logFunction('set_moduleinfo_defaults')" href="../_functions/set_moduleinfo_defaults.html" onMouseOver="funcPopup(event,'set_moduleinfo_defaults')">set_moduleinfo_defaults</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>);
<a name="l483"><span class="linenum"> 483</span></a>  
<a name="l484"><span class="linenum"> 484</span></a>      if (!empty(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('groupmodeforce')" class="var it39506" onMouseOver="hilite(39506)" onMouseOut="lolite()" href="../_variables/groupmodeforce.html">groupmodeforce</a>) or !isset(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('groupmode')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/groupmode.html">groupmode</a>)) {
<a name="l485"><span class="linenum"> 485</span></a>          <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('groupmode')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/groupmode.html">groupmode</a> = <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('groupmode')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/groupmode.html">groupmode</a>; <span class="comment">// Keep original.</span>
<a name="l486"><span class="linenum"> 486</span></a>      }
<a name="l487"><span class="linenum"> 487</span></a>  
<a name="l488"><span class="linenum"> 488</span></a>  <span class="comment">    // Update course module first.</span>
<a name="l489"><span class="linenum"> 489</span></a>      <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('groupmode')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/groupmode.html">groupmode</a> = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('groupmode')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/groupmode.html">groupmode</a>;
<a name="l490"><span class="linenum"> 490</span></a>      if (isset(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('groupingid')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/groupingid.html">groupingid</a>)) {
<a name="l491"><span class="linenum"> 491</span></a>          <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('groupingid')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/groupingid.html">groupingid</a> = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('groupingid')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/groupingid.html">groupingid</a>;
<a name="l492"><span class="linenum"> 492</span></a>      }
<a name="l493"><span class="linenum"> 493</span></a>  
<a name="l494"><span class="linenum"> 494</span></a>      <a class="var it3863" onMouseOver="hilite(3863)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../_variables/completion.html">$completion</a> = <span class="keyword">new </span><a class="class" onClick="logClass('completion_info')" href="../_classes/completion_info.html" onMouseOver="classPopup(event,'completion_info')">completion_info</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>);
<a name="l495"><span class="linenum"> 495</span></a>      if (<a class="var it3863" onMouseOver="hilite(3863)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../_variables/completion.html">$completion</a>-&gt;<a class="function" onClick="logFunction('is_enabled')" href="../_functions/is_enabled.html" onMouseOver="funcPopup(event,'is_enabled')">is_enabled</a>()) {
<a name="l496"><span class="linenum"> 496</span></a>  <span class="comment">        // Completion settings that would affect users who have already completed</span>
<a name="l497"><span class="linenum"> 497</span></a>  <span class="comment">        // the activity may be locked; if so, these should not be updated.</span>
<a name="l498"><span class="linenum"> 498</span></a>          if (!empty(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('completionunlocked')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/completionunlocked.html">completionunlocked</a>)) {
<a name="l499"><span class="linenum"> 499</span></a>              <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('completion')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/completion.html">completion</a> = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('completion')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/completion.html">completion</a>;
<a name="l500"><span class="linenum"> 500</span></a>              <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('completiongradeitemnumber')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/completiongradeitemnumber.html">completiongradeitemnumber</a> = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('completiongradeitemnumber')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/completiongradeitemnumber.html">completiongradeitemnumber</a>;
<a name="l501"><span class="linenum"> 501</span></a>              <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('completionview')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/completionview.html">completionview</a> = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('completionview')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/completionview.html">completionview</a>;
<a name="l502"><span class="linenum"> 502</span></a>          }
<a name="l503"><span class="linenum"> 503</span></a>  <span class="comment">        // The expected date does not affect users who have completed the activity,</span>
<a name="l504"><span class="linenum"> 504</span></a>  <span class="comment">        // so it is safe to update it regardless of the lock status.</span>
<a name="l505"><span class="linenum"> 505</span></a>          <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('completionexpected')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/completionexpected.html">completionexpected</a> = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('completionexpected')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/completionexpected.html">completionexpected</a>;
<a name="l506"><span class="linenum"> 506</span></a>      }
<a name="l507"><span class="linenum"> 507</span></a>      if (!empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enableavailability')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/enableavailability.html">enableavailability</a>)) {
<a name="l508"><span class="linenum"> 508</span></a>  <span class="comment">        // This code is used both when submitting the form, which uses a long</span>
<a name="l509"><span class="linenum"> 509</span></a>  <span class="comment">        // name to avoid clashes, and by unit test code which uses the real</span>
<a name="l510"><span class="linenum"> 510</span></a>  <span class="comment">        // name in the table.</span>
<a name="l511"><span class="linenum"> 511</span></a>          if (property_exists(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>, 'availabilityconditionsjson')) {
<a name="l512"><span class="linenum"> 512</span></a>              if (<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('availabilityconditionsjson')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/availabilityconditionsjson.html">availabilityconditionsjson</a> !== '') {
<a name="l513"><span class="linenum"> 513</span></a>                  <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('availability')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/availability.html">availability</a> = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('availabilityconditionsjson')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/availabilityconditionsjson.html">availabilityconditionsjson</a>;
<a name="l514"><span class="linenum"> 514</span></a>              } else {
<a name="l515"><span class="linenum"> 515</span></a>                  <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('availability')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/availability.html">availability</a> = null;
<a name="l516"><span class="linenum"> 516</span></a>              }
<a name="l517"><span class="linenum"> 517</span></a>          } else if (property_exists(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>, 'availability')) {
<a name="l518"><span class="linenum"> 518</span></a>              <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('availability')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/availability.html">availability</a> = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('availability')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/availability.html">availability</a>;
<a name="l519"><span class="linenum"> 519</span></a>          }
<a name="l520"><span class="linenum"> 520</span></a>  <span class="comment">        // If there is any availability data, verify it.</span>
<a name="l521"><span class="linenum"> 521</span></a>          if (<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('availability')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/availability.html">availability</a>) {
<a name="l522"><span class="linenum"> 522</span></a>              <a class="var it4476" onMouseOver="hilite(4476)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../_variables/tree.html">$tree</a> = new \core_availability\tree(json_decode(<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('availability')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/availability.html">availability</a>));
<a name="l523"><span class="linenum"> 523</span></a>  <span class="comment">            // Save time and database space by setting null if the only data</span>
<a name="l524"><span class="linenum"> 524</span></a>  <span class="comment">            // is an empty tree.</span>
<a name="l525"><span class="linenum"> 525</span></a>              if (<a class="var it4476" onMouseOver="hilite(4476)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../_variables/tree.html">$tree</a>-&gt;<a class="function" onClick="logFunction('is_empty')" href="../_functions/is_empty.html" onMouseOver="funcPopup(event,'is_empty')">is_empty</a>()) {
<a name="l526"><span class="linenum"> 526</span></a>                  <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('availability')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/availability.html">availability</a> = null;
<a name="l527"><span class="linenum"> 527</span></a>              }
<a name="l528"><span class="linenum"> 528</span></a>          }
<a name="l529"><span class="linenum"> 529</span></a>      }
<a name="l530"><span class="linenum"> 530</span></a>      if (isset(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('showdescription')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/showdescription.html">showdescription</a>)) {
<a name="l531"><span class="linenum"> 531</span></a>          <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('showdescription')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/showdescription.html">showdescription</a> = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('showdescription')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/showdescription.html">showdescription</a>;
<a name="l532"><span class="linenum"> 532</span></a>      } else {
<a name="l533"><span class="linenum"> 533</span></a>          <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('showdescription')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/showdescription.html">showdescription</a> = 0;
<a name="l534"><span class="linenum"> 534</span></a>      }
<a name="l535"><span class="linenum"> 535</span></a>  
<a name="l536"><span class="linenum"> 536</span></a>      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('course_modules', <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>);
<a name="l537"><span class="linenum"> 537</span></a>  
<a name="l538"><span class="linenum"> 538</span></a>      <a class="var it1418" onMouseOver="hilite(1418)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../_variables/modcontext.html">$modcontext</a> = <a class="class" onClick="logClass('context_module')" href="../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/coursemodule.html">coursemodule</a>);
<a name="l539"><span class="linenum"> 539</span></a>  
<a name="l540"><span class="linenum"> 540</span></a>  <span class="comment">    // Update embedded links and save files.</span>
<a name="l541"><span class="linenum"> 541</span></a>      if (<a class="function" onClick="logFunction('plugin_supports')" href="../_functions/plugin_supports.html" onMouseOver="funcPopup(event,'plugin_supports')">plugin_supports</a>('mod', <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('modulename')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/modulename.html">modulename</a>, <a class="constant" onClick="logConstant('FEATURE_MOD_INTRO')" href="../_constants/FEATURE_MOD_INTRO.html" onMouseOver="constPopup(event,'FEATURE_MOD_INTRO')">FEATURE_MOD_INTRO</a>, true)) {
<a name="l542"><span class="linenum"> 542</span></a>          <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('intro')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/intro.html">intro</a> = <a class="function" onClick="logFunction('file_save_draft_area_files')" href="../_functions/file_save_draft_area_files.html" onMouseOver="funcPopup(event,'file_save_draft_area_files')">file_save_draft_area_files</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('introeditor')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/introeditor.html">introeditor</a>['itemid'], <a class="var it1418" onMouseOver="hilite(1418)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../_variables/modcontext.html">$modcontext</a>-&gt;<a onClick="logVariable('id')" class="var it39650" onMouseOver="hilite(39650)" onMouseOut="lolite()" href="../_variables/id.html">id</a>,
<a name="l543"><span class="linenum"> 543</span></a>                                                        'mod_'.<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('modulename')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/modulename.html">modulename</a>, 'intro', 0,
<a name="l544"><span class="linenum"> 544</span></a>                                                        array('subdirs'=&gt;true), <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('introeditor')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/introeditor.html">introeditor</a>['text']);
<a name="l545"><span class="linenum"> 545</span></a>          <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('introformat')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/introformat.html">introformat</a> = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('introeditor')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/introeditor.html">introeditor</a>['format'];
<a name="l546"><span class="linenum"> 546</span></a>          unset(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('introeditor')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/introeditor.html">introeditor</a>);
<a name="l547"><span class="linenum"> 547</span></a>      }
<a name="l548"><span class="linenum"> 548</span></a>      <a class="var it29847" onMouseOver="hilite(29847)" onMouseOut="lolite()" onClick="logVariable('updateinstancefunction')" href="../_variables/updateinstancefunction.html">$updateinstancefunction</a> = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('modulename')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/modulename.html">modulename</a>.&quot;_update_instance&quot;;
<a name="l549"><span class="linenum"> 549</span></a>      if (!<a class="var it29847" onMouseOver="hilite(29847)" onMouseOut="lolite()" onClick="logVariable('updateinstancefunction')" href="../_variables/updateinstancefunction.html">$updateinstancefunction</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>, <a class="var it1037" onMouseOver="hilite(1037)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../_variables/mform.html">$mform</a>)) {
<a name="l550"><span class="linenum"> 550</span></a>          <a class="function" onClick="logFunction('print_error')" href="../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('cannotupdatemod', '', <a class="function" onClick="logFunction('course_get_url')" href="../_functions/course_get_url.html" onMouseOver="funcPopup(event,'course_get_url')">course_get_url</a>(<a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>, <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('cw')" href="../_variables/cw.html">$cw</a>-&gt;<a onClick="logVariable('section')" class="var it41028" onMouseOver="hilite(41028)" onMouseOut="lolite()" href="../_variables/section.html">section</a>), <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('modulename')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/modulename.html">modulename</a>);
<a name="l551"><span class="linenum"> 551</span></a>      }
<a name="l552"><span class="linenum"> 552</span></a>  
<a name="l553"><span class="linenum"> 553</span></a>  <span class="comment">    // Make sure visibility is set correctly (in particular in calendar).</span>
<a name="l554"><span class="linenum"> 554</span></a>      if (<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:activityvisibility', <a class="var it1418" onMouseOver="hilite(1418)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../_variables/modcontext.html">$modcontext</a>)) {
<a name="l555"><span class="linenum"> 555</span></a>          <a class="function" onClick="logFunction('set_coursemodule_visible')" href="../_functions/set_coursemodule_visible.html" onMouseOver="funcPopup(event,'set_coursemodule_visible')">set_coursemodule_visible</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/coursemodule.html">coursemodule</a>, <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('visible')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/visible.html">visible</a>);
<a name="l556"><span class="linenum"> 556</span></a>      }
<a name="l557"><span class="linenum"> 557</span></a>  
<a name="l558"><span class="linenum"> 558</span></a>      if (isset(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('cmidnumber')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/cmidnumber.html">cmidnumber</a>)) { // Label.
<a name="l559"><span class="linenum"> 559</span></a>  <span class="comment">        // Set cm idnumber - uniqueness is already verified by form validation.</span>
<a name="l560"><span class="linenum"> 560</span></a>          <a class="function" onClick="logFunction('set_coursemodule_idnumber')" href="../_functions/set_coursemodule_idnumber.html" onMouseOver="funcPopup(event,'set_coursemodule_idnumber')">set_coursemodule_idnumber</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('coursemodule')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/coursemodule.html">coursemodule</a>, <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('cmidnumber')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/cmidnumber.html">cmidnumber</a>);
<a name="l561"><span class="linenum"> 561</span></a>      }
<a name="l562"><span class="linenum"> 562</span></a>  
<a name="l563"><span class="linenum"> 563</span></a>  <span class="comment">    // Now that module is fully updated, also update completion data if required.</span>
<a name="l564"><span class="linenum"> 564</span></a>  <span class="comment">    // (this will wipe all user completion data and recalculate it)</span>
<a name="l565"><span class="linenum"> 565</span></a>      if (<a class="var it3863" onMouseOver="hilite(3863)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../_variables/completion.html">$completion</a>-&gt;<a class="function" onClick="logFunction('is_enabled')" href="../_functions/is_enabled.html" onMouseOver="funcPopup(event,'is_enabled')">is_enabled</a>() &amp;&amp; !empty(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('completionunlocked')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/completionunlocked.html">completionunlocked</a>)) {
<a name="l566"><span class="linenum"> 566</span></a>          <a class="var it3863" onMouseOver="hilite(3863)" onMouseOut="lolite()" onClick="logVariable('completion')" href="../_variables/completion.html">$completion</a>-&gt;<a class="function" onClick="logFunction('reset_all_state')" href="../_functions/reset_all_state.html" onMouseOver="funcPopup(event,'reset_all_state')">reset_all_state</a>(<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>);
<a name="l567"><span class="linenum"> 567</span></a>      }
<a name="l568"><span class="linenum"> 568</span></a>      <a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('name')" class="var it39492" onMouseOver="hilite(39492)" onMouseOut="lolite()" href="../_variables/name.html">name</a> = <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>-&gt;<a onClick="logVariable('name')" class="var it41198" onMouseOver="hilite(41198)" onMouseOut="lolite()" href="../_variables/name.html">name</a>;
<a name="l569"><span class="linenum"> 569</span></a>      \core\event\<a class="class" onClick="logClass('course_module_updated')" href="../_classes/course_module_updated.html" onMouseOver="classPopup(event,'course_module_updated')">course_module_updated</a>::<a class="function" onClick="logFunction('create_from_cm')" href="../_functions/create_from_cm.html" onMouseOver="funcPopup(event,'create_from_cm')">create_from_cm</a>(<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>, <a class="var it1418" onMouseOver="hilite(1418)" onMouseOut="lolite()" onClick="logVariable('modcontext')" href="../_variables/modcontext.html">$modcontext</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l570"><span class="linenum"> 570</span></a>  
<a name="l571"><span class="linenum"> 571</span></a>      <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a> = <a class="function" onClick="logFunction('edit_module_post_actions')" href="../_functions/edit_module_post_actions.html" onMouseOver="funcPopup(event,'edit_module_post_actions')">edit_module_post_actions</a>(<a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>, <a class="var it101" onMouseOver="hilite(101)" onMouseOut="lolite()" onClick="logVariable('course')" href="../_variables/course.html">$course</a>);
<a name="l572"><span class="linenum"> 572</span></a>  
<a name="l573"><span class="linenum"> 573</span></a>      return array(<a class="var it170" onMouseOver="hilite(170)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../_variables/cm.html">$cm</a>, <a class="var it8280" onMouseOver="hilite(8280)" onMouseOut="lolite()" onClick="logVariable('moduleinfo')" href="../_variables/moduleinfo.html">$moduleinfo</a>);
<a name="l574"><span class="linenum"> 574</span></a>  }
<a name="l575"><span class="linenum"> 575</span></a>  
<a name="l576"><span class="linenum"> 576</span></a>  <span class="comment">/**</span>
<a name="l577"><span class="linenum"> 577</span></a>  <span class="comment"> * Include once the module lib file.</span>
<a name="l578"><span class="linenum"> 578</span></a>  <span class="comment"> *</span>
<a name="l579"><span class="linenum"> 579</span></a>  <span class="comment"> * @param string $modulename module name of the lib to include</span>
<a name="l580"><span class="linenum"> 580</span></a>  <span class="comment"> * @throws moodle_exception if lib.php file for the module does not exist</span>
<a name="l581"><span class="linenum"> 581</span></a>  <span class="comment"> */</span>
<a name="l582"><span class="linenum"> 582</span></a>  function <a class="function" onClick="logFunction('include_modulelib')" href="../_functions/include_modulelib.html" onMouseOver="funcPopup(event,'include_modulelib')">include_modulelib</a>(<a class="var it557" onMouseOver="hilite(557)" onMouseOut="lolite()" onClick="logVariable('modulename')" href="../_variables/modulename.html">$modulename</a>) {
<a name="l583"><span class="linenum"> 583</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l584"><span class="linenum"> 584</span></a>      <a class="var it10810" onMouseOver="hilite(10810)" onMouseOut="lolite()" onClick="logVariable('modlib')" href="../_variables/modlib.html">$modlib</a> = &quot;<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/dirroot.html">dirroot</a>/mod/<a class="var it557" onMouseOver="hilite(557)" onMouseOut="lolite()" onClick="logVariable('modulename')" href="../_variables/modulename.html">$modulename</a>/lib.php&quot;;
<a name="l585"><span class="linenum"> 585</span></a>      if (<a class="phpfunction" onClick="logFunction('file_exists')" href="../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>(<a class="var it10810" onMouseOver="hilite(10810)" onMouseOut="lolite()" onClick="logVariable('modlib')" href="../_variables/modlib.html">$modlib</a>)) {
<a name="l586"><span class="linenum"> 586</span></a>          include_once(<a class="var it10810" onMouseOver="hilite(10810)" onMouseOut="lolite()" onClick="logVariable('modlib')" href="../_variables/modlib.html">$modlib</a>);
<a name="l587"><span class="linenum"> 587</span></a>      } else {
<a name="l588"><span class="linenum"> 588</span></a>          throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('modulemissingcode', '', '', <a class="var it10810" onMouseOver="hilite(10810)" onMouseOut="lolite()" onClick="logVariable('modlib')" href="../_variables/modlib.html">$modlib</a>);
<a name="l589"><span class="linenum"> 589</span></a>      }
<a name="l590"><span class="linenum"> 590</span></a>  }
<a name="l591"><span class="linenum"> 591</span></a>  
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'reset_all_state': ['reset_all_state', 'Recalculates completion state related to an activity for all users. ', [['lib','completionlib.php',838]], 2],
'course_allowed_module': ['course_allowed_module', 'Is the user allowed to add this type of module to this course? ', [['course','lib.php',2280]], 6],
'set_coursemodule_idnumber': ['set_coursemodule_idnumber', '', [['course','lib.php',1547]], 1],
'update_moduleinfo': ['update_moduleinfo', 'Update the module info. This function doesn\'t check the user capabilities. It updates the course module and the module instance. Then execute common action to create/update module process (trigger event, rebuild cache, save plagiarism settings...). ', [['course','modlib.php',464]], 2],
'trigger': ['trigger', '', [['lib/evalmath','evalmath.class.php',438],['lib/classes/event','base.php',682]], 778],
'edit_module_post_actions': ['edit_module_post_actions', 'Common create/update module module actions that need to be processed as soon as a module is created/updaded. For example:create grade parent category, add outcomes, rebuild caches, regrade, save plagiarism settings... Please note this api does not trigger events as of MOODLE 2.6. Please trigger events before calling this api. ', [['course','modlib.php',173]], 3],
'create_from_cm': ['create_from_cm', 'Set data to create new event from course module. ', [['lib/classes/event','course_module_updated.php',140],['lib/classes/event','course_module_created.php',57]], 12],
'include_modulelib': ['include_modulelib', 'Include once the module lib file. ', [['course','modlib.php',576]], 2],
'start_delegated_transaction': ['start_delegated_transaction', 'On DBs that support it, switch to transaction mode and begin a transaction you\'ll need to ensure you call allow_commit() on the returned object or your changes *will* be lost. ', [['lib/dml','moodle_database.php',2344]], 137],
'grade_regrade_final_grades': ['grade_regrade_final_grades', 'Updates all final grades in course. ', [['lib','gradelib.php',1008]], 27],
'allow_commit': ['allow_commit', 'Commit delegated transaction. The real database commit SQL is executed only after committing all delegated transactions. ', [['lib/dml','moodle_transaction.php',78]], 127],
'has_capability': ['has_capability', 'Wrapper round the has_capability funciton that automatically passes in the quiz context. ', [['mod/quiz','attemptlib.php',299],['mod/quiz','attemptlib.php',884],['lib','accesslib.php',346]], 1929],
'get_section_info': ['get_section_info', 'Gets data about specific numbered section. ', [['lib','modinfolib.php',311]], 67],
'aggregation_uses_aggregationcoef': ['aggregation_uses_aggregationcoef', 'Returns true if aggregation uses aggregationcoef ', [['lib/grade','grade_category.php',1757]], 14],
'file_save_draft_area_files': ['file_save_draft_area_files', 'Saves files from a draft file area to a real one (merging the list of files). Can rewrite URLs in some content at the same time if desired. ', [['lib','filelib.php',772]], 53],
'delete_instance': ['delete_instance', 'The assignment has been deleted - remove the plugin specific data ', [['mod/assign','assignmentplugin.php',525],['mod/workshop/allocation/random','lib.php',243],['mod/assign/submission/file','locallib.php',447],['mod/assign/submission/onlinetext','locallib.php',538],['mod/workshop/form/accumulative','lib.php',375],['mod/workshop/form/rubric','lib.php',405],['mod/workshop/form/numerrors','lib.php',394],['lib','enrollib.php',1737],['mod/assign','locallib.php',677],['mod/workshop/form','lib.php',118],['mod/workshop/allocation/scheduled','lib.php',200],['mod/assign/feedback/editpdf','locallib.php',260],['mod/workshop/form/comments','lib.php',360],['mod/assign/feedback/file','locallib.php',256],['lib','accesslib.php',6060],['mod/workshop/eval','lib.php',59],['mod/workshop/allocation/manual','lib.php',349],['mod/assign/feedback/comments','locallib.php',458],['mod/workshop/eval/best','lib.php',125],['mod/workshop/allocation','lib.php',62]], 35],
'set_moduleinfo_defaults': ['set_moduleinfo_defaults', 'Set module info default values for the unset module attributs. ', [['course','modlib.php',352]], 2],
'update': ['update', 'Update a customer resource if one it exists and is owned by the reseller. (customers.update) ', [['lib/google/src/Google/Service','Reseller.php',343],['mod/lesson/pagetypes','matching.php',308],['lib/adodb','adodb-active-recordx.inc.php',1047],['lib/grade','grade_object.php',238],['lib/google/src/Google/Service','Fusiontables.php',726],['lib/google/src/Google/Service','Fusiontables.php',889],['lib/google/src/Google/Service','Fusiontables.php',1095],['lib/google/src/Google/Service','Fusiontables.php',1269],['grade/grading/form','lib.php',905],['lib/google/src/Google/Service','Blogger.php',1332],['lib/google/src/Google/Service','Blogger.php',1630],['lib/google/src/Google/Service','Doubleclicksearch.php',325],['lib/google/src/Google/Service','AdExchangeBuyer.php',392],['lib/google/src/Google/Service','AdExchangeBuyer.php',684],['lib/grade','grade_item.php',260],['lib/google/src/Google/Service','Gmail.php',756],['lib/google/src/Google/Service','Gmail.php',908],['lib/google/src/Google/Service','Mirror.php',495],['lib/google/src/Google/Service','Mirror.php',633],['lib/google/src/Google/Service','Mirror.php',744],['lib/google/src/Google/Service','Genomics.php',690],['lib/google/src/Google/Service','Genomics.php',811],['lib/google/src/Google/Service','Genomics.php',1064],['lib/google/src/Google/Service','Genomics.php',1370],['lib/google/src/Google/Service','Genomics.php',1521],['lib/google/src/Google/Service','Dfareporting.php',570],['lib/google/src/Google/Service','PlusDomains.php',691],['lib/google/src/Google/Service','Licensing.php',332],['lib/google/src/Google/Service','Drive.php',1624],['lib/google/src/Google/Service','Drive.php',1859],['lib/google/src/Google/Service','Drive.php',2100],['lib/google/src/Google/Service','Drive.php',2211],['lib/google/src/Google/Service','Drive.php',2261],['lib/google/src/Google/Service','Drive.php',2385],['lib/google/src/Google/Service','Drive.php',2473],['completion','data_object.php',251],['lib/google/src/Google/Service','Books.php',1901],['lib/google/src/Google/Service','Bigquery.php',603],['lib/google/src/Google/Service','Bigquery.php',911],['lib/google/src/Google/Service','Groupssettings.php',137],['lib/google/src/Google/Service','YouTube.php',1596],['lib/google/src/Google/Service','YouTube.php',1697],['lib/google/src/Google/Service','YouTube.php',2201],['lib/google/src/Google/Service','YouTube.php',2439],['lib/google/src/Google/Service','YouTube.php',2613],['lib/google/src/Google/Service','YouTube.php',2809],['lib/google/src/Google/Service','YouTube.php',3419],['lib/google/src/Google/Service','Coordinate.php',568],['lib/google/src/Google/Service','Coordinate.php',680],['lib/google/src/Google/Service','Autoscaler.php',399],['calendar','lib.php',2171],['lib/google/src/Google/Service','ShoppingContent.php',633],['lib/google/src/Google/Service','ShoppingContent.php',815],['lib','weblib.php',3154],['mod/lesson','locallib.php',2682],['lib/google/src/Google/Service','SQLAdmin.php',843],['lib/google/src/Google/Service','Fitness.php',424],['lib/google/src/Google/Service','Fitness.php',607],['lib/google/src/Google/Service','TagManager.php',1004],['lib/google/src/Google/Service','TagManager.php',1093],['lib/google/src/Google/Service','TagManager.php',1186],['lib/google/src/Google/Service','TagManager.php',1279],['lib/google/src/Google/Service','TagManager.php',1372],['lib/google/src/Google/Service','TagManager.php',1466],['lib/google/src/Google/Service','TagManager.php',1560],['lib/google/src/Google/Service','TagManager.php',1711],['lib/google/src/Google/Service','TagManager.php',1804],['mod/lesson/pagetypes','truefalse.php',163],['lib/google/src/Google/Service','Directory.php',1446],['lib/google/src/Google/Service','Directory.php',1559],['lib/google/src/Google/Service','Directory.php',1724],['lib/google/src/Google/Service','Directory.php',1907],['lib/google/src/Google/Service','Directory.php',2014],['lib/google/src/Google/Service','Directory.php',2116],['lib/google/src/Google/Service','Directory.php',2337],['lib/google/src/Google/Service','Directory.php',2523],['lib/xhprof/xhprof_html/jquery','jquery.tooltip.js',200],['lib/google/src/Google/Service','AppState.php',201],['lib/google/src/Google/Service','Taskqueue.php',397],['lib/google/src/Google/Service','AndroidPublisher.php',1360],['lib/google/src/Google/Service','AndroidPublisher.php',1472],['lib/google/src/Google/Service','AndroidPublisher.php',1542],['lib/google/src/Google/Service','AndroidPublisher.php',1780],['lib/google/src/Google/Service','AndroidPublisher.php',1846],['lib/google/src/Google/Service','AndroidPublisher.php',1928],['lib/google/src/Google/Service','AndroidPublisher.php',2066],['mod/lesson/pagetypes','essay.php',158],['lib/google/src/Google/Service','AdSenseHost.php',845],['lib/google/src/Google/Service','AdSenseHost.php',1096],['lib/google/src/Google/Service','Games.php',1507],['lib/grade','grade_grade.php',940],['lib/google/src/Google/Service','SiteVerification.php',226],['lib/horde/framework/Horde/Support','Array.php',70],['lib/google/src/Google/Service','Prediction.php',338],['lib/google/src/Google/Service','Compute.php',2999],['lib/google/src/Google/Service','Compute.php',3310],['lib/google/src/Google/Service','Compute.php',3814],['lib/google/src/Google/Service','Compute.php',5314],['lib/google/src/Google/Service','Calendar.php',979],['lib/google/src/Google/Service','Calendar.php',1144],['lib/google/src/Google/Service','Calendar.php',1285],['lib/google/src/Google/Service','Calendar.php',1633],['lib/google/src/Google/Service','Analytics.php',2118],['lib/google/src/Google/Service','Analytics.php',2385],['lib/google/src/Google/Service','Analytics.php',2495],['lib/google/src/Google/Service','Analytics.php',2602],['lib/google/src/Google/Service','Analytics.php',2730],['lib/google/src/Google/Service','Analytics.php',2821],['lib/google/src/Google/Service','Analytics.php',2944],['lib/google/src/Google/Service','Analytics.php',3277],['lib/google/src/Google/Service','Analytics.php',3379],['lib/google/src/Google/Service','Analytics.php',3461],['lib/google/src/Google/Service','Tasks.php',385],['lib/google/src/Google/Service','Tasks.php',555],['lib/horde/framework/Horde/Imap/Client/Ids','Map.php',72],['grade/grading/form/guide','lib.php',826],['lib/grade','grade_category.php',204],['lib/google/src/Google/Service','Storage.php',1030],['lib/google/src/Google/Service','Storage.php',1165],['lib/google/src/Google/Service','Storage.php',1318],['lib/google/src/Google/Service','Storage.php',1454],['lib/google/src/Google/Service','Storage.php',1718],['lib/filestorage','stored_file.php',103],['grade/grading/form/rubric','lib.php',828],['lib/grade','grade_scale.php',125],['lib','coursecatlib.php',441],['lib/adodb','adodb-active-record.inc.php',878],['lib/grade','grade_outcome.php',144],['mod/lesson/pagetypes','branchtable.php',262]], 290],
'fetch_all_available': ['fetch_all_available', 'Static method that returns all outcomes available in course ', [['lib/grade','grade_outcome.php',244]], 7],
'course_create_sections_if_missing': ['course_create_sections_if_missing', 'Creates missing course section(s) and rebuilds course cache ', [['course','lib.php',1434]], 16],
'fetch': ['fetch', 'Fetches the available update status from the remote site ', [['lib/classes/update','checker.php',113],['lib/minify/lib/Minify/Cache','XCache.php',86],['lib/grade','grade_object.php',126],['completion/criteria','completion_criteria_unenrol.php',43],['completion/criteria','completion_criteria_grade.php',45],['lib/grade','grade_item.php',332],['lib/minify/lib/Minify/Cache','Memcache.php',97],['lib/minify/lib/Minify/Cache','APC.php',91],['completion/criteria','completion_criteria_activity.php',45],['lib/horde/framework/Horde/Imap/Client','Base.php',2373],['completion','data_object.php',152],['completion/criteria','completion_criteria_course.php',46],['completion','completion_completion.php',70],['completion/criteria','completion_criteria_role.php',43],['completion','completion_criteria_completion.php',74],['lib/grade','grade_grade.php',576],['lib/minify/lib/Minify/Cache','ZendPlatform.php',97],['completion/criteria','completion_criteria_date.php',43],['lib/grade','grade_category.php',184],['completion/criteria','completion_criteria_self.php',43],['lib/grade','grade_scale.php',89],['lib/minify/lib/Minify/Cache','File.php',90],['completion','completion_aggregation.php',68],['completion/criteria','completion_criteria_duration.php',43],['lib/grade','grade_outcome.php',182]], 192],
'set_field': ['set_field', 'Sets the custom profile field used for testing. ', [['availability/condition/profile/tests','condition_test.php',349],['lib/dml','moodle_database.php',1688]], 462],
'set_parent': ['set_parent', 'Set the parent of the optigroup and, at the same time, process all the condition params in all the childs ', [['backup/util/structure','base_optigroup.class.php',118],['lib/grade','grade_item.php',1318],['lib','listlib.php',183],['lib','listlib.php',624],['backup/util/structure','base_final_element.class.php',62],['backup/util/structure','backup_optigroup_element.class.php',184],['lib/grade','grade_category.php',2172],['lib','navigationlib.php',679]], 28],
'move_after_sortorder': ['move_after_sortorder', 'Update this grade item\'s sortorder so that it will appear after $sortorder ', [['lib/grade','grade_item.php',1220],['lib/grade','grade_category.php',2256]], 9],
'get_parent_category': ['get_parent_category', 'Returns the grade_category object this grade_item belongs to (referenced by categoryid) or category attached to category item. ', [['lib/grade','grade_item.php',868],['lib/grade','grade_category.php',2114]], 28],
'get_record': ['get_record', 'Get a single database record as an object where all the given conditions met. ', [['lib/dml','moodle_database.php',1413]], 2960],
'require_capability': ['require_capability', 'Adds a required capability which all results will be checked against ', [['backup/util/ui','restore_ui_components.php',157],['mod/quiz','attemptlib.php',306],['mod/quiz','attemptlib.php',891],['lib','accesslib.php',764]], 628],
'is_empty': ['is_empty', 'Returns true or false, depending on whether this block has any content to display and whether the user has permission to view the block ', [['blocks','moodleblock.class.php',181],['blocks','moodleblock.class.php',706],['mod/assign','assignmentplugin.php',540],['mod/assign/submission/file','locallib.php',474],['mod/assign/submission/onlinetext','locallib.php',551],['mod/assign/submission/comments','locallib.php',78],['user/profile','lib.php',336],['mod/assign/feedback/editpdf','locallib.php',247],['mod/wiki/diff','difflib.php',354],['mod/assign/feedback/file','locallib.php',270],['mod/assign/feedback/comments','locallib.php',471],['mod/assign/feedback/offline','locallib.php',62],['availability/classes','tree.php',624]], 17],
'is_enabled': ['is_enabled', 'Allows hiding this plugin from the submission/feedback screen if it is not enabled. ', [['mod/assign','assignmentplugin.php',223],['lib/classes/plugininfo','orphaned.php',37],['lib','completionlib.php',269],['mod/assign/submission/comments','locallib.php',172],['mod/assign/feedback/editpdf','locallib.php',276],['lib/classes/plugininfo','base.php',371],['lib/classes/plugininfo','tool.php',39],['admin/tool/health','index.php',393],['admin/tool/log/classes/plugininfo','logstore.php',35],['lib/classes/message/inbound','manager.php',37],['lib/classes/plugininfo','mnetservice.php',33],['mod/assignment/classes/plugininfo','assignment.php',32],['lib','adminlib.php',1952],['mod/assign/feedback/offline','locallib.php',365],['lib','medialib.php',318],['lib','medialib.php',634],['lib','medialib.php',1265]], 200],
'get_available_areas': ['get_available_areas', 'Returns the list of gradable areas in the given context and component ', [['grade/grading','lib.php',305]], 5],
'rebuild_course_cache': ['rebuild_course_cache', 'Rebuilds or resets the cached list of course activities stored in MUC. ', [['lib','modinfolib.php',2203]], 40],
'can_update_moduleinfo': ['can_update_moduleinfo', 'Check if user is allowed to update module info and returns related item/data to the module. ', [['course','modlib.php',437]], 2],
'fetch_all': ['fetch_all', 'Finds and returns all grade_object instances based on $params. ', [['lib/grade','grade_object.php',138],['lib/grade','grade_item.php',343],['completion/criteria','completion_criteria.php',153],['completion','data_object.php',165],['completion','completion_criteria_completion.php',84],['lib/grade','grade_grade.php',586],['lib/grade','grade_category.php',194],['lib/grade','grade_scale.php',100],['completion','completion_aggregation.php',79],['lib/grade','grade_outcome.php',193]], 65],
'plagiarism_save_form_elements': ['plagiarism_save_form_elements', 'saves/updates plagiarism settings from a modules config page - called by course/modedit.php ', [['lib','plagiarismlib.php',81]], 1],
'get_fast_modinfo': ['get_fast_modinfo', 'Returns reference to full info about modules in course (including visibility). Cached and as fast as possible (0 or 1 db query). ', [['lib','modinfolib.php',2001]], 277],
'is_number': ['is_number', 'Return true if given value is integer or string with integer value ', [['lib','moodlelib.php',1286],['lib/phpexcel/PHPExcel/Calculation','Functions.php',440]], 65],
'set_coursemodule_visible': ['set_coursemodule_visible', 'Set the visibility of a module and inherent properties. ', [['course','lib.php',1557]], 24],
'plugin_supports': ['plugin_supports', 'Checks whether a plugin supports a specified feature. ', [['lib','moodlelib.php',7193]], 59],
'course_add_cm_to_section': ['course_add_cm_to_section', 'Adds an existing module to the section ', [['course','lib.php',1469]], 12],
'clean_param': ['clean_param', 'Used by {@link optional_param()} and {@link required_param()} to clean the variables and/or cast to specific types, based on an options field. <code> $course->format = clean_param($course->format, PARAM_ALPHA); $selectedgradeitem = clean_param($selectedgradeitem, PARAM_INT); </code> ', [['lib','moodlelib.php',768]], 607],
'insert': ['insert', 'Creates a customer resource if one does not already exist. (customers.insert) ', [['lib/google/src/Google/Service','Reseller.php',309],['lib/google/src/Google/Service','Reseller.php',473],['lib/adodb','adodb-active-recordx.inc.php',899],['lib/grade','grade_object.php',325],['lib/google/src/Google/Service','Replicapoolupdater.php',294],['lib/google/src/Google/Service','Fusiontables.php',674],['lib/google/src/Google/Service','Fusiontables.php',838],['lib/google/src/Google/Service','Fusiontables.php',1012],['lib/google/src/Google/Service','Fusiontables.php',1217],['lib/google/src/Google/Service','Blogger.php',1243],['lib/google/src/Google/Service','Blogger.php',1493],['lib/google/src/Google/Service','Doubleclicksearch.php',285],['lib/google/src/Google/Service','AdExchangeBuyer.php',476],['lib/google/src/Google/Service','AdExchangeBuyer.php',635],['lib/google/src/Google/Service','Manager.php',271],['lib/google/src/Google/Service','Manager.php',349],['lib/grade','grade_item.php',385],['lib/google/src/Google/Service','Gmail.php',993],['lib/google/src/Google/Service','Plus.php',475],['lib/google/src/Google/Service','Mirror.php',393],['lib/google/src/Google/Service','Mirror.php',451],['lib/google/src/Google/Service','Mirror.php',605],['lib/google/src/Google/Service','Mirror.php',687],['lib/google/src/Google/Service','Mirror.php',801],['lib/google/src/Google/Service','Urlshortener.php',124],['lib/google/src/Google/Service','Dfareporting.php',499],['lib/google/src/Google/Service','PlusDomains.php',481],['lib/google/src/Google/Service','PlusDomains.php',606],['lib/google/src/Google/Service','PlusDomains.php',732],['lib/google/src/Google/Service','PlusDomains.php',781],['lib/google/src/Google/Service','GroupsMigration.php',85],['lib/google/src/Google/Service','Licensing.php',253],['lib/google/src/Google/Service','Drive.php',1491],['lib/google/src/Google/Service','Drive.php',1568],['lib/google/src/Google/Service','Drive.php',1727],['lib/google/src/Google/Service','Drive.php',1961],['lib/google/src/Google/Service','Drive.php',2045],['lib/google/src/Google/Service','Drive.php',2164],['lib/google/src/Google/Service','Drive.php',2328],['completion','data_object.php',316],['lib/google/src/Google/Service','Books.php',1835],['lib/google/src/Google/Service','Bigquery.php',548],['lib/google/src/Google/Service','Bigquery.php',672],['lib/google/src/Google/Service','Bigquery.php',856],['lib/google/src/Google/Service','YouTube.php',1323],['lib/google/src/Google/Service','YouTube.php',1423],['lib/google/src/Google/Service','YouTube.php',1498],['lib/google/src/Google/Service','YouTube.php',2025],['lib/google/src/Google/Service','YouTube.php',2323],['lib/google/src/Google/Service','YouTube.php',2525],['lib/google/src/Google/Service','YouTube.php',2685],['lib/google/src/Google/Service','YouTube.php',3013],['lib/google/src/Google/Service','YouTube.php',3254],['lib/google/src/Google/Service','Coordinate.php',491],['lib/google/src/Google/Service','Autoscaler.php',346],['lib/google/src/Google/Service','ShoppingContent.php',582],['lib/google/src/Google/Service','ShoppingContent.php',764],['lib/google/src/Google/Service','ShoppingContent.php',1000],['lib/google/src/Google/Service','SQLAdmin.php',698],['lib/google/src/Google/Service','SQLAdmin.php',959],['lib/google/src/Google/Service','Directory.php',1504],['lib/google/src/Google/Service','Directory.php',1601],['lib/google/src/Google/Service','Directory.php',1671],['lib/google/src/Google/Service','Directory.php',1964],['lib/google/src/Google/Service','Directory.php',2071],['lib/google/src/Google/Service','Directory.php',2239],['lib/google/src/Google/Service','Directory.php',2419],['lib/google/src/Google/Service','Taskqueue.php',323],['lib/google/src/Google/Service','AndroidPublisher.php',1211],['lib/google/src/Google/Service','AndroidPublisher.php',2002],['lib/google/src/Google/Service','AdSenseHost.php',786],['lib/google/src/Google/Service','AdSenseHost.php',1041],['lib/google/src/Google/Service','AdSenseHost.php',1182],['lib/google/src/Google/Service','MapsEngine.php',2780],['lib/google/src/Google/Service','MapsEngine.php',3184],['lib/grade','grade_grade.php',928],['lib/google/src/Google/Service','SiteVerification.php',180],['lib/google/src/Google/Service','Prediction.php',290],['lib/google/src/Google/Service','Compute.php',2844],['lib/google/src/Google/Service','Compute.php',2944],['lib/google/src/Google/Service','Compute.php',3171],['lib/google/src/Google/Service','Compute.php',3255],['lib/google/src/Google/Service','Compute.php',3393],['lib/google/src/Google/Service','Compute.php',3493],['lib/google/src/Google/Service','Compute.php',3573],['lib/google/src/Google/Service','Compute.php',3757],['lib/google/src/Google/Service','Compute.php',3891],['lib/google/src/Google/Service','Compute.php',3973],['lib/google/src/Google/Service','Compute.php',4165],['lib/google/src/Google/Service','Compute.php',4436],['lib/google/src/Google/Service','Compute.php',4690],['lib/google/src/Google/Service','Compute.php',4838],['lib/google/src/Google/Service','Compute.php',4959],['lib/google/src/Google/Service','Compute.php',5120],['lib/google/src/Google/Service','Compute.php',5259],['lib/google/src/Google/Service','Calendar.php',915],['lib/google/src/Google/Service','Calendar.php',1067],['lib/google/src/Google/Service','Calendar.php',1255],['lib/google/src/Google/Service','Calendar.php',1422],['lib/google/src/Google/Service','Analytics.php',2082],['lib/google/src/Google/Service','Analytics.php',2326],['lib/google/src/Google/Service','Analytics.php',2444],['lib/google/src/Google/Service','Analytics.php',2539],['lib/google/src/Google/Service','Analytics.php',2666],['lib/google/src/Google/Service','Analytics.php',2776],['lib/google/src/Google/Service','Analytics.php',2883],['lib/google/src/Google/Service','Analytics.php',3022],['lib/google/src/Google/Service','Analytics.php',3216],['lib/google/src/Google/Service','Analytics.php',3323],['lib/google/src/Google/Service','Analytics.php',3421],['lib/google/src/Google/Service','Tasks.php',336],['lib/google/src/Google/Service','Tasks.php',456],['lib/grade','grade_category.php',318],['lib/google/src/Google/Service','Storage.php',980],['lib/google/src/Google/Service','Storage.php',1100],['lib/google/src/Google/Service','Storage.php',1262],['lib/google/src/Google/Service','Storage.php',1392],['lib/google/src/Google/Service','Storage.php',1619],['lib/grade','grade_scale.php',111],['lib/google/src/Google/Service','Admin.php',87],['lib/google/src/Google/Service','Replicapool.php',434],['lib/google/src/Google/Service','Resourceviews.php',471],['lib/adodb','adodb-active-record.inc.php',742],['lib/grade','grade_outcome.php',120]], 459],
'can_add_moduleinfo': ['can_add_moduleinfo', 'Check that the user can add a module. Also returns some information like the module, context and course section info. The fucntion create the course section if it doesn\'t exist. ', [['course','modlib.php',409]], 2],
'set_area': ['set_area', 'Sets the area the manager operates on ', [['grade/grading','lib.php',155]], 8],
'instance': ['instance', 'Retrieve sole instance of the registry. ', [['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29],['lib/classes','useragent.php',101],['backup/cc','validator.php',35],['lib/portfolio','exporter.php',251],['lib/tests','update_deployer_test.php',69],['lib/tests','string_manager_standard_test.php',124],['lib','modinfolib.php',373],['','mdeploy.php',96],['cache','disabledlib.php',171],['cache','disabledlib.php',296],['admin/tool/installaddon/classes','validator.php',85],['cache/classes','config.php',87],['course/format','lib.php',156],['lib','accesslib.php',6184],['lib','accesslib.php',6436],['lib','accesslib.php',6614],['lib','accesslib.php',6868],['lib','accesslib.php',7129],['lib','accesslib.php',7341],['cache','locallib.php',52],['lib/htmlpurifier','HTMLPurifier.php',251],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['cache/classes','helper.php',76],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['lib/classes','plugin_manager.php',83],['lib','filterlib.php',81],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/classes/update','deployer.php',54],['admin/tool/installaddon/classes','pluginfo_client.php',37],['admin/tool/installaddon/classes','installer.php',40],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443]], 3942],
'set_active_method': ['set_active_method', 'Sets the currently active grading method in the gradable area ', [['grade/grading','lib.php',360]], 6],
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pgsql_native_moodle_database.php',1137],['lib/dml','oci_native_moodle_database.php',1355],['lib/dml','sqlsrv_native_moodle_database.php',1081],['lib/dml','mssql_native_moodle_database.php',1003],['lib/dml','mysqli_native_moodle_database.php',1397],['lib/dml/tests','dml_test.php',5430],['lib/dml','pdo_moodle_database.php',460]], 565],
'add_moduleinfo': ['add_moduleinfo', 'Add course module. ', [['course','modlib.php',32]], 4],
'get_coursemodule_from_id': ['get_coursemodule_from_id', 'Given an id of a course module, finds the coursemodule description ', [['lib','datalib.php',1269]], 212],
'print_error': ['print_error', 'Abort execution by throwing of a general exception, default exception handler displays the error message in most cases. ', [['lib','setuplib.php',449]], 1560],
'get_grading_manager': ['get_grading_manager', 'Factory method returning an instance of the grading manager ', [['grade/grading','lib.php',27]], 37],
'course_get_url': ['course_get_url', 'The URL to use for the specified course (with section) ', [['course','lib.php',3375]], 42],
'delete_records': ['delete_records', 'Delete the records from a table where all the given conditions met. If conditions not specified, table is truncated. ', [['lib/dml','moodle_database.php',1815],['lib/dml','sqlite3_pdo_moodle_database.php',337]], 778],
'add_course_module': ['add_course_module', '', [['course','lib.php',1423]], 4],
'file_exists': ['file_exists', '', [], 873],
'defined': ['defined', '', [], 4098]};
CLASS_DATA={
'grade_outcome': ['grade_outcome', 'Class representing a grade outcome. ', [['lib/grade','grade_outcome.php',30]], 39],
'grade_item': ['grade_item', 'Class representing a grade item. ', [['lib/grade','grade_item.php',29]], 206],
'course_module_created': ['course_module_created', 'Class course_module_created ', [['lib/classes/event','course_module_created.php',28]], 6],
'context_course': ['context_course', 'Course context class ', [['lib','accesslib.php',6766]], 1197],
'course_module_updated': ['course_module_updated', 'Class course_module_updated ', [['lib/classes/event','course_module_updated.php',28]], 12],
'context_module': ['context_module', 'Course module context class ', [['lib','accesslib.php',6988]], 942],
'moodle_exception': ['moodle_exception', 'Base Moodle Exception class ', [['lib','setuplib.php',68]], 478],
'context_helper': ['context_helper', 'Context maintenance and helper methods. ', [['lib','accesslib.php',5824]], 210],
'completion_info': ['completion_info', 'Class represents completion information for a course. ', [['lib','completionlib.php',210]], 119],
'grade_category': ['grade_category', 'grade_category is an object mapped to DB table {prefix}grade_categories ', [['lib/grade','grade_category.php',29]], 144]};
CONST_DATA={
'COMPLETION_DISABLED': ['COMPLETION_DISABLED', '', [['lib','completionlib.php',47]], 15],
'FEATURE_MOD_INTRO': ['FEATURE_MOD_INTRO', '', [['lib','moodlelib.php',426]], 31],
'CONTEXT_MODULE': ['CONTEXT_MODULE', '', [['lib','accesslib.php',150]], 462],
'COMPLETION_VIEW_NOT_REQUIRED': ['COMPLETION_VIEW_NOT_REQUIRED', '', [['lib','completionlib.php',109]], 5],
'FEATURE_GRADE_HAS_GRADE': ['FEATURE_GRADE_HAS_GRADE', '', [['lib','moodlelib.php',394]], 29],
'GRADE_AGGREGATE_WEIGHTED_MEAN': ['GRADE_AGGREGATE_WEIGHTED_MEAN', '', [['lib/grade','constants.php',58]], 19],
'FEATURE_GRADE_OUTCOMES': ['FEATURE_GRADE_OUTCOMES', '', [['lib','moodlelib.php',396]], 23],
'MUST_EXIST': ['MUST_EXIST', '', [['lib','dmllib.php',52]], 1252],
'GRADE_TYPE_SCALE': ['GRADE_TYPE_SCALE', '', [['lib/grade','constants.php',90]], 63],
'PARAM_PLUGIN': ['PARAM_PLUGIN', '', [['lib','moodlelib.php',324]], 118],
'FEATURE_ADVANCED_GRADING': ['FEATURE_ADVANCED_GRADING', '', [['lib','moodlelib.php',398]], 9],
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',138],['','install.php',93],['lib','setup.php',386]], 3532]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu May 28 19:17:31 2015</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
