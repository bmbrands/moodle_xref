<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /question/type/calculated/questiontype.php source</title>
    <link rel="stylesheet" href="../../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../../';
subdir='question/type/calculated';
filename='questiontype.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/question/type/calculated/</a> -> <a href="questiontype.php.html">questiontype.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="questiontype.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="questiontype.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * Question type class for the calculated question type.</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * @package    qtype</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @subpackage calculated</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @copyright  1999 onwards Martin Dougiamas {@link http://moodle.com}</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> */</span>
<a name="l25"><span class="linenum">  25</span></a>  
<a name="l26"><span class="linenum">  26</span></a>  
<a name="l27"><span class="linenum">  27</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l28"><span class="linenum">  28</span></a>  
<a name="l29"><span class="linenum">  29</span></a>  require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/dirroot.html">dirroot</a> . '<a class="filename" href="../../../question/type/questiontypebase.php.html">/question/type/questiontypebase.php</a>');
<a name="l30"><span class="linenum">  30</span></a>  require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/dirroot.html">dirroot</a> . '<a class="filename" href="../../../question/type/questionbase.php.html">/question/type/questionbase.php</a>');
<a name="l31"><span class="linenum">  31</span></a>  require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/dirroot.html">dirroot</a> . '<a class="filename" href="../../../question/type/numerical/question.php.html">/question/type/numerical/question.php</a>');
<a name="l32"><span class="linenum">  32</span></a>  
<a name="l33"><span class="linenum">  33</span></a>  
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment">/**</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment"> * The calculated question type.</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment"> *</span>
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment"> * @copyright  1999 onwards Martin Dougiamas {@link http://moodle.com}</span>
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment"> */</span>
<a name="l40"><span class="linenum">  40</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('qtype_calculated')" href="../../../_classes/qtype_calculated.html" onMouseOver="classPopup(event,'qtype_calculated')">qtype_calculated</a> <span class="keyword">extends</span> <a class="class" onClick="logClass('question_type')" href="../../../_classes/question_type.html" onMouseOver="classPopup(event,'question_type')">question_type</a> {
<a name="l41"><span class="linenum">  41</span></a>  <span class="comment">    /** Regular expression that finds the formulas in content. */</span>
<a name="l42"><span class="linenum">  42</span></a>      const FORMULAS_IN_TEXT_REGEX = '~\{=([^{}]*(?:\{[^{}]+}[^{}]*)*)\}~';
<a name="l43"><span class="linenum">  43</span></a>  
<a name="l44"><span class="linenum">  44</span></a>      const MAX_DATASET_ITEMS = 100;
<a name="l45"><span class="linenum">  45</span></a>  
<a name="l46"><span class="linenum">  46</span></a>      public <a class="var it13024" onMouseOver="hilite(13024)" onMouseOut="lolite()" onClick="logVariable('wizardpagesnumber')" href="../../../_variables/wizardpagesnumber.html">$wizardpagesnumber</a> = 3;
<a name="l47"><span class="linenum">  47</span></a>  
<a name="l48"><span class="linenum">  48</span></a>      public function <a class="function" onClick="logFunction('get_question_options')" href="../../../_functions/get_question_options.html" onMouseOver="funcPopup(event,'get_question_options')">get_question_options</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>) {
<a name="l49"><span class="linenum">  49</span></a>  <span class="comment">        // First get the datasets and default options.</span>
<a name="l50"><span class="linenum">  50</span></a>  <span class="comment">        // The code is used for calculated, calculatedsimple and calculatedmulti qtypes.</span>
<a name="l51"><span class="linenum">  51</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l52"><span class="linenum">  52</span></a>          if (!<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('options')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('question_calculated_options',
<a name="l53"><span class="linenum">  53</span></a>                  array('question' =&gt; <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>))) {
<a name="l54"><span class="linenum">  54</span></a>              <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('options')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a> = new stdClass();
<a name="l55"><span class="linenum">  55</span></a>              <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('options')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;synchronize = 0;
<a name="l56"><span class="linenum">  56</span></a>              <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('options')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;single = 0;
<a name="l57"><span class="linenum">  57</span></a>              <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('options')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;answernumbering = 'abc';
<a name="l58"><span class="linenum">  58</span></a>              <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('options')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;shuffleanswers = 0;
<a name="l59"><span class="linenum">  59</span></a>              <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('options')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;correctfeedback = '';
<a name="l60"><span class="linenum">  60</span></a>              <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('options')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;partiallycorrectfeedback = '';
<a name="l61"><span class="linenum">  61</span></a>              <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('options')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;incorrectfeedback = '';
<a name="l62"><span class="linenum">  62</span></a>              <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('options')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;correctfeedbackformat = 0;
<a name="l63"><span class="linenum">  63</span></a>              <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('options')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;partiallycorrectfeedbackformat = 0;
<a name="l64"><span class="linenum">  64</span></a>              <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('options')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;incorrectfeedbackformat = 0;
<a name="l65"><span class="linenum">  65</span></a>          }
<a name="l66"><span class="linenum">  66</span></a>  
<a name="l67"><span class="linenum">  67</span></a>          if (!<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('options')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;answers = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(&quot;
<a name="l68"><span class="linenum">  68</span></a>              SELECT a.*, c.tolerance, c.tolerancetype, c.correctanswerlength, c.correctanswerformat
<a name="l69"><span class="linenum">  69</span></a>              FROM {question_answers} a,
<a name="l70"><span class="linenum">  70</span></a>                   {question_calculated} c
<a name="l71"><span class="linenum">  71</span></a>              WHERE a.question = ?
<a name="l72"><span class="linenum">  72</span></a>              AND   a.id = c.answer
<a name="l73"><span class="linenum">  73</span></a>              ORDER BY a.id ASC&quot;, array(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>))) {
<a name="l74"><span class="linenum">  74</span></a>                  return false;
<a name="l75"><span class="linenum">  75</span></a>          }
<a name="l76"><span class="linenum">  76</span></a>  
<a name="l77"><span class="linenum">  77</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_virtual_qtype')" href="../../../_functions/get_virtual_qtype.html" onMouseOver="funcPopup(event,'get_virtual_qtype')">get_virtual_qtype</a>()-&gt;<a class="phpfunction" onClick="logFunction('name')" href="../../../_functions/name.html" onMouseOver="phpfuncPopup(event,'name')">name</a>() == 'numerical') {
<a name="l78"><span class="linenum">  78</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_virtual_qtype')" href="../../../_functions/get_virtual_qtype.html" onMouseOver="funcPopup(event,'get_virtual_qtype')">get_virtual_qtype</a>()-&gt;<a class="function" onClick="logFunction('get_numerical_units')" href="../../../_functions/get_numerical_units.html" onMouseOver="funcPopup(event,'get_numerical_units')">get_numerical_units</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>);
<a name="l79"><span class="linenum">  79</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_virtual_qtype')" href="../../../_functions/get_virtual_qtype.html" onMouseOver="funcPopup(event,'get_virtual_qtype')">get_virtual_qtype</a>()-&gt;<a class="function" onClick="logFunction('get_numerical_options')" href="../../../_functions/get_numerical_options.html" onMouseOver="funcPopup(event,'get_numerical_options')">get_numerical_options</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>);
<a name="l80"><span class="linenum">  80</span></a>          }
<a name="l81"><span class="linenum">  81</span></a>  
<a name="l82"><span class="linenum">  82</span></a>          <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('hints')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/hints.html">hints</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('question_hints',
<a name="l83"><span class="linenum">  83</span></a>                  array('questionid' =&gt; <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>), 'id ASC');
<a name="l84"><span class="linenum">  84</span></a>  
<a name="l85"><span class="linenum">  85</span></a>          if (isset(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('export_process')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/export_process.html">export_process</a>)&amp;&amp;<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('export_process')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/export_process.html">export_process</a>) {
<a name="l86"><span class="linenum">  86</span></a>              <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('options')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;datasets = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_datasets_for_export')" href="../../../_functions/get_datasets_for_export.html" onMouseOver="funcPopup(event,'get_datasets_for_export')">get_datasets_for_export</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>);
<a name="l87"><span class="linenum">  87</span></a>          }
<a name="l88"><span class="linenum">  88</span></a>          return true;
<a name="l89"><span class="linenum">  89</span></a>      }
<a name="l90"><span class="linenum">  90</span></a>  
<a name="l91"><span class="linenum">  91</span></a>      public function <a class="function" onClick="logFunction('get_datasets_for_export')" href="../../../_functions/get_datasets_for_export.html" onMouseOver="funcPopup(event,'get_datasets_for_export')">get_datasets_for_export</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>) {
<a name="l92"><span class="linenum">  92</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>;
<a name="l93"><span class="linenum">  93</span></a>          <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a> = array();
<a name="l94"><span class="linenum">  94</span></a>          if (!empty(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>)) {
<a name="l95"><span class="linenum">  95</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = &quot;SELECT i.*
<a name="l96"><span class="linenum">  96</span></a>                        FROM {question_datasets} d, {question_dataset_definitions} i
<a name="l97"><span class="linenum">  97</span></a>                       WHERE d.question = ? AND d.datasetdefinition = i.id&quot;;
<a name="l98"><span class="linenum">  98</span></a>              if (<a class="var it988" onMouseOver="hilite(988)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../../_variables/records.html">$records</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>, array(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>))) {
<a name="l99"><span class="linenum">  99</span></a>                  foreach (<a class="var it988" onMouseOver="hilite(988)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../../_variables/records.html">$records</a> as <a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>) {
<a name="l100"><span class="linenum"> 100</span></a>                      <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a> = <a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>;
<a name="l101"><span class="linenum"> 101</span></a>                      if (<a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('category')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a> == '0') {
<a name="l102"><span class="linenum"> 102</span></a>                          <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('status')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a> = 'private';
<a name="l103"><span class="linenum"> 103</span></a>                      } else {
<a name="l104"><span class="linenum"> 104</span></a>                          <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('status')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a> = 'shared';
<a name="l105"><span class="linenum"> 105</span></a>                      }
<a name="l106"><span class="linenum"> 106</span></a>                      <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('type')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/type.html">type</a> = 'calculated';
<a name="l107"><span class="linenum"> 107</span></a>                      <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it13026" onMouseOver="hilite(13026)" onMouseOut="lolite()" onClick="logVariable('distribution')" href="../../../_variables/distribution.html">$distribution</a>, <a class="var it2299" onMouseOver="hilite(2299)" onMouseOut="lolite()" onClick="logVariable('min')" href="../../../_variables/min.html">$min</a>, <a class="var it536" onMouseOver="hilite(536)" onMouseOut="lolite()" onClick="logVariable('max')" href="../../../_variables/max.html">$max</a>, <a class="var it13027" onMouseOver="hilite(13027)" onMouseOut="lolite()" onClick="logVariable('dec')" href="../../../_variables/dec.html">$dec</a>) = <a class="phpfunction" onClick="logFunction('explode')" href="../../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(':', <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('options')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>, 4);
<a name="l108"><span class="linenum"> 108</span></a>                      <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('distribution')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/distribution.html">distribution</a> = <a class="var it13026" onMouseOver="hilite(13026)" onMouseOut="lolite()" onClick="logVariable('distribution')" href="../../../_variables/distribution.html">$distribution</a>;
<a name="l109"><span class="linenum"> 109</span></a>                      <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('minimum')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/minimum.html">minimum</a> = <a class="var it2299" onMouseOver="hilite(2299)" onMouseOut="lolite()" onClick="logVariable('min')" href="../../../_variables/min.html">$min</a>;
<a name="l110"><span class="linenum"> 110</span></a>                      <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('maximum')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/maximum.html">maximum</a> = <a class="var it536" onMouseOver="hilite(536)" onMouseOut="lolite()" onClick="logVariable('max')" href="../../../_variables/max.html">$max</a>;
<a name="l111"><span class="linenum"> 111</span></a>                      <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('decimals')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/decimals.html">decimals</a> = <a class="var it13027" onMouseOver="hilite(13027)" onMouseOut="lolite()" onClick="logVariable('dec')" href="../../../_variables/dec.html">$dec</a>;
<a name="l112"><span class="linenum"> 112</span></a>                      if (<a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('itemcount')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/itemcount.html">itemcount</a> &gt; 0) {
<a name="l113"><span class="linenum"> 113</span></a>  <span class="comment">                        // Get the datasetitems.</span>
<a name="l114"><span class="linenum"> 114</span></a>                          <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('items')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/items.html">items</a> = array();
<a name="l115"><span class="linenum"> 115</span></a>                          if (<a class="var it644" onMouseOver="hilite(644)" onMouseOut="lolite()" onClick="logVariable('items')" href="../../../_variables/items.html">$items</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_database_dataset_items')" href="../../../_functions/get_database_dataset_items.html" onMouseOver="funcPopup(event,'get_database_dataset_items')">get_database_dataset_items</a>(<a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('id')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>)) {
<a name="l116"><span class="linenum"> 116</span></a>                              <a class="var it2074" onMouseOver="hilite(2074)" onMouseOut="lolite()" onClick="logVariable('n')" href="../../../_variables/n.html">$n</a> = 0;
<a name="l117"><span class="linenum"> 117</span></a>                              foreach (<a class="var it644" onMouseOver="hilite(644)" onMouseOut="lolite()" onClick="logVariable('items')" href="../../../_variables/items.html">$items</a> as <a class="var it13028" onMouseOver="hilite(13028)" onMouseOut="lolite()" onClick="logVariable('ii')" href="../../../_variables/ii.html">$ii</a>) {
<a name="l118"><span class="linenum"> 118</span></a>                                  <a class="var it2074" onMouseOver="hilite(2074)" onMouseOut="lolite()" onClick="logVariable('n')" href="../../../_variables/n.html">$n</a>++;
<a name="l119"><span class="linenum"> 119</span></a>                                  <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('items')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/items.html">items</a>[<a class="var it2074" onMouseOver="hilite(2074)" onMouseOut="lolite()" onClick="logVariable('n')" href="../../../_variables/n.html">$n</a>] = new stdClass();
<a name="l120"><span class="linenum"> 120</span></a>                                  <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('items')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/items.html">items</a>[<a class="var it2074" onMouseOver="hilite(2074)" onMouseOut="lolite()" onClick="logVariable('n')" href="../../../_variables/n.html">$n</a>]-&gt;itemnumber = <a class="var it13028" onMouseOver="hilite(13028)" onMouseOut="lolite()" onClick="logVariable('ii')" href="../../../_variables/ii.html">$ii</a>-&gt;<a onClick="logVariable('itemnumber')" class="var it44017" onMouseOver="hilite(44017)" onMouseOut="lolite()" href="../../../_variables/itemnumber.html">itemnumber</a>;
<a name="l121"><span class="linenum"> 121</span></a>                                  <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('items')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/items.html">items</a>[<a class="var it2074" onMouseOver="hilite(2074)" onMouseOut="lolite()" onClick="logVariable('n')" href="../../../_variables/n.html">$n</a>]-&gt;value = <a class="var it13028" onMouseOver="hilite(13028)" onMouseOut="lolite()" onClick="logVariable('ii')" href="../../../_variables/ii.html">$ii</a>-&gt;<a onClick="logVariable('value')" class="var it44017" onMouseOver="hilite(44017)" onMouseOut="lolite()" href="../../../_variables/value.html">value</a>;
<a name="l122"><span class="linenum"> 122</span></a>                              }
<a name="l123"><span class="linenum"> 123</span></a>                              <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('number_of_items')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/number_of_items.html">number_of_items</a> = <a class="var it2074" onMouseOver="hilite(2074)" onMouseOut="lolite()" onClick="logVariable('n')" href="../../../_variables/n.html">$n</a>;
<a name="l124"><span class="linenum"> 124</span></a>                          }
<a name="l125"><span class="linenum"> 125</span></a>                      }
<a name="l126"><span class="linenum"> 126</span></a>                      <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>[&quot;1-{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('category')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>}-{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('name')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>}&quot;] = <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>;
<a name="l127"><span class="linenum"> 127</span></a>                  }
<a name="l128"><span class="linenum"> 128</span></a>              }
<a name="l129"><span class="linenum"> 129</span></a>          }
<a name="l130"><span class="linenum"> 130</span></a>          return <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>;
<a name="l131"><span class="linenum"> 131</span></a>      }
<a name="l132"><span class="linenum"> 132</span></a>  
<a name="l133"><span class="linenum"> 133</span></a>      public function <a class="function" onClick="logFunction('save_question_options')" href="../../../_functions/save_question_options.html" onMouseOver="funcPopup(event,'save_question_options')">save_question_options</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>) {
<a name="l134"><span class="linenum"> 134</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l135"><span class="linenum"> 135</span></a>  
<a name="l136"><span class="linenum"> 136</span></a>  <span class="comment">        // Make it impossible to save bad formulas anywhere.</span>
<a name="l137"><span class="linenum"> 137</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('validate_question_data')" href="../../../_functions/validate_question_data.html" onMouseOver="funcPopup(event,'validate_question_data')">validate_question_data</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>);
<a name="l138"><span class="linenum"> 138</span></a>  
<a name="l139"><span class="linenum"> 139</span></a>  <span class="comment">        // The code is used for calculated, calculatedsimple and calculatedmulti qtypes.</span>
<a name="l140"><span class="linenum"> 140</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a> = <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('context')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/context.html">context</a>;
<a name="l141"><span class="linenum"> 141</span></a>  
<a name="l142"><span class="linenum"> 142</span></a>  <span class="comment">        // Calculated options.</span>
<a name="l143"><span class="linenum"> 143</span></a>          <a class="var it2088" onMouseOver="hilite(2088)" onMouseOut="lolite()" onClick="logVariable('update')" href="../../../_variables/update.html">$update</a> = true;
<a name="l144"><span class="linenum"> 144</span></a>          <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('question_calculated_options',
<a name="l145"><span class="linenum"> 145</span></a>                  array('question' =&gt; <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l146"><span class="linenum"> 146</span></a>          if (!<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>) {
<a name="l147"><span class="linenum"> 147</span></a>              <a class="var it2088" onMouseOver="hilite(2088)" onMouseOut="lolite()" onClick="logVariable('update')" href="../../../_variables/update.html">$update</a> = false;
<a name="l148"><span class="linenum"> 148</span></a>              <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a> = new stdClass();
<a name="l149"><span class="linenum"> 149</span></a>              <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('question')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../../_variables/question.html">question</a> = <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l150"><span class="linenum"> 150</span></a>          }
<a name="l151"><span class="linenum"> 151</span></a>  <span class="comment">        // As used only by calculated.</span>
<a name="l152"><span class="linenum"> 152</span></a>          if (isset(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('synchronize')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/synchronize.html">synchronize</a>)) {
<a name="l153"><span class="linenum"> 153</span></a>              <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('synchronize')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../../_variables/synchronize.html">synchronize</a> = <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('synchronize')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/synchronize.html">synchronize</a>;
<a name="l154"><span class="linenum"> 154</span></a>          } else {
<a name="l155"><span class="linenum"> 155</span></a>              <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('synchronize')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../../_variables/synchronize.html">synchronize</a> = 0;
<a name="l156"><span class="linenum"> 156</span></a>          }
<a name="l157"><span class="linenum"> 157</span></a>          <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('single')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../../_variables/single.html">single</a> = 0;
<a name="l158"><span class="linenum"> 158</span></a>          <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('answernumbering')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../../_variables/answernumbering.html">answernumbering</a> =  <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('answernumbering')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/answernumbering.html">answernumbering</a>;
<a name="l159"><span class="linenum"> 159</span></a>          <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('shuffleanswers')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../../_variables/shuffleanswers.html">shuffleanswers</a> = <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('shuffleanswers')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/shuffleanswers.html">shuffleanswers</a>;
<a name="l160"><span class="linenum"> 160</span></a>  
<a name="l161"><span class="linenum"> 161</span></a>          foreach (array('correctfeedback', 'partiallycorrectfeedback',
<a name="l162"><span class="linenum"> 162</span></a>                  'incorrectfeedback') as <a class="var it9745" onMouseOver="hilite(9745)" onMouseOut="lolite()" onClick="logVariable('feedbackname')" href="../../../_variables/feedbackname.html">$feedbackname</a>) {
<a name="l163"><span class="linenum"> 163</span></a>              <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>-&gt;<a class="var it9745" onMouseOver="hilite(9745)" onMouseOut="lolite()" onClick="logVariable('feedbackname')" href="../../../_variables/feedbackname.html">$feedbackname</a> = '';
<a name="l164"><span class="linenum"> 164</span></a>              <a class="var it3519" onMouseOver="hilite(3519)" onMouseOut="lolite()" onClick="logVariable('feedbackformat')" href="../../../_variables/feedbackformat.html">$feedbackformat</a> = <a class="var it9745" onMouseOver="hilite(9745)" onMouseOut="lolite()" onClick="logVariable('feedbackname')" href="../../../_variables/feedbackname.html">$feedbackname</a> . 'format';
<a name="l165"><span class="linenum"> 165</span></a>              <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>-&gt;<a class="var it3519" onMouseOver="hilite(3519)" onMouseOut="lolite()" onClick="logVariable('feedbackformat')" href="../../../_variables/feedbackformat.html">$feedbackformat</a> = 0;
<a name="l166"><span class="linenum"> 166</span></a>          }
<a name="l167"><span class="linenum"> 167</span></a>  
<a name="l168"><span class="linenum"> 168</span></a>          if (<a class="var it2088" onMouseOver="hilite(2088)" onMouseOut="lolite()" onClick="logVariable('update')" href="../../../_variables/update.html">$update</a>) {
<a name="l169"><span class="linenum"> 169</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('question_calculated_options', <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>);
<a name="l170"><span class="linenum"> 170</span></a>          } else {
<a name="l171"><span class="linenum"> 171</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('question_calculated_options', <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>);
<a name="l172"><span class="linenum"> 172</span></a>          }
<a name="l173"><span class="linenum"> 173</span></a>  
<a name="l174"><span class="linenum"> 174</span></a>  <span class="comment">        // Get old versions of the objects.</span>
<a name="l175"><span class="linenum"> 175</span></a>          <a class="var it5938" onMouseOver="hilite(5938)" onMouseOut="lolite()" onClick="logVariable('oldanswers')" href="../../../_variables/oldanswers.html">$oldanswers</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('question_answers',
<a name="l176"><span class="linenum"> 176</span></a>                  array('question' =&gt; <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>), 'id ASC');
<a name="l177"><span class="linenum"> 177</span></a>  
<a name="l178"><span class="linenum"> 178</span></a>          <a class="var it13030" onMouseOver="hilite(13030)" onMouseOut="lolite()" onClick="logVariable('oldoptions')" href="../../../_variables/oldoptions.html">$oldoptions</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('question_calculated',
<a name="l179"><span class="linenum"> 179</span></a>                  array('question' =&gt; <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>), 'answer ASC');
<a name="l180"><span class="linenum"> 180</span></a>  
<a name="l181"><span class="linenum"> 181</span></a>  <span class="comment">        // Save the units.</span>
<a name="l182"><span class="linenum"> 182</span></a>          <a class="var it13031" onMouseOver="hilite(13031)" onMouseOut="lolite()" onClick="logVariable('virtualqtype')" href="../../../_variables/virtualqtype.html">$virtualqtype</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_virtual_qtype')" href="../../../_functions/get_virtual_qtype.html" onMouseOver="funcPopup(event,'get_virtual_qtype')">get_virtual_qtype</a>();
<a name="l183"><span class="linenum"> 183</span></a>  
<a name="l184"><span class="linenum"> 184</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = <a class="var it13031" onMouseOver="hilite(13031)" onMouseOut="lolite()" onClick="logVariable('virtualqtype')" href="../../../_variables/virtualqtype.html">$virtualqtype</a>-&gt;<a class="function" onClick="logFunction('save_units')" href="../../../_functions/save_units.html" onMouseOver="funcPopup(event,'save_units')">save_units</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>);
<a name="l185"><span class="linenum"> 185</span></a>          if (isset(<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('error')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../../../_variables/error.html">error</a>)) {
<a name="l186"><span class="linenum"> 186</span></a>              return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>;
<a name="l187"><span class="linenum"> 187</span></a>          } else {
<a name="l188"><span class="linenum"> 188</span></a>              <a class="var it6351" onMouseOver="hilite(6351)" onMouseOut="lolite()" onClick="logVariable('units')" href="../../../_variables/units.html">$units</a> = <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('units')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../../../_variables/units.html">units</a>;
<a name="l189"><span class="linenum"> 189</span></a>          }
<a name="l190"><span class="linenum"> 190</span></a>  
<a name="l191"><span class="linenum"> 191</span></a>          foreach (<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('answer')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a> =&gt; <a class="var it3046" onMouseOver="hilite(3046)" onMouseOut="lolite()" onClick="logVariable('answerdata')" href="../../../_variables/answerdata.html">$answerdata</a>) {
<a name="l192"><span class="linenum"> 192</span></a>              if (<a class="phpfunction" onClick="logFunction('trim')" href="../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it3046" onMouseOver="hilite(3046)" onMouseOut="lolite()" onClick="logVariable('answerdata')" href="../../../_variables/answerdata.html">$answerdata</a>) == '') {
<a name="l193"><span class="linenum"> 193</span></a>                  continue;
<a name="l194"><span class="linenum"> 194</span></a>              }
<a name="l195"><span class="linenum"> 195</span></a>  
<a name="l196"><span class="linenum"> 196</span></a>  <span class="comment">            // Update an existing answer if possible.</span>
<a name="l197"><span class="linenum"> 197</span></a>              <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a> = <a class="phpfunction" onClick="logFunction('array_shift')" href="../../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it5938" onMouseOver="hilite(5938)" onMouseOut="lolite()" onClick="logVariable('oldanswers')" href="../../../_variables/oldanswers.html">$oldanswers</a>);
<a name="l198"><span class="linenum"> 198</span></a>              if (!<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>) {
<a name="l199"><span class="linenum"> 199</span></a>                  <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a> = new stdClass();
<a name="l200"><span class="linenum"> 200</span></a>                  <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('question')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/question.html">question</a> = <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l201"><span class="linenum"> 201</span></a>                  <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('answer')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a>   = '';
<a name="l202"><span class="linenum"> 202</span></a>                  <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('feedback')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/feedback.html">feedback</a> = '';
<a name="l203"><span class="linenum"> 203</span></a>                  <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('id')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>       = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('question_answers', <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>);
<a name="l204"><span class="linenum"> 204</span></a>              }
<a name="l205"><span class="linenum"> 205</span></a>  
<a name="l206"><span class="linenum"> 206</span></a>              <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('answer')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a>   = <a class="phpfunction" onClick="logFunction('trim')" href="../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it3046" onMouseOver="hilite(3046)" onMouseOut="lolite()" onClick="logVariable('answerdata')" href="../../../_variables/answerdata.html">$answerdata</a>);
<a name="l207"><span class="linenum"> 207</span></a>              <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('fraction')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/fraction.html">fraction</a> = <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('fraction')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/fraction.html">fraction</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>];
<a name="l208"><span class="linenum"> 208</span></a>              <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('feedback')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/feedback.html">feedback</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('import_or_save_files')" href="../../../_functions/import_or_save_files.html" onMouseOver="funcPopup(event,'import_or_save_files')">import_or_save_files</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('feedback')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/feedback.html">feedback</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>],
<a name="l209"><span class="linenum"> 209</span></a>                      <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../../_variables/context.html">$context</a>, 'question', 'answerfeedback', <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('id')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>);
<a name="l210"><span class="linenum"> 210</span></a>              <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('feedbackformat')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/feedbackformat.html">feedbackformat</a> = <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('feedback')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/feedback.html">feedback</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>]['format'];
<a name="l211"><span class="linenum"> 211</span></a>  
<a name="l212"><span class="linenum"> 212</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>(&quot;question_answers&quot;, <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>);
<a name="l213"><span class="linenum"> 213</span></a>  
<a name="l214"><span class="linenum"> 214</span></a>  <span class="comment">            // Set up the options object.</span>
<a name="l215"><span class="linenum"> 215</span></a>              if (!<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a> = <a class="phpfunction" onClick="logFunction('array_shift')" href="../../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it13030" onMouseOver="hilite(13030)" onMouseOut="lolite()" onClick="logVariable('oldoptions')" href="../../../_variables/oldoptions.html">$oldoptions</a>)) {
<a name="l216"><span class="linenum"> 216</span></a>                  <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a> = new stdClass();
<a name="l217"><span class="linenum"> 217</span></a>              }
<a name="l218"><span class="linenum"> 218</span></a>              <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('question')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../../_variables/question.html">question</a>            = <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l219"><span class="linenum"> 219</span></a>              <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('answer')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a>              = <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('id')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l220"><span class="linenum"> 220</span></a>              <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('tolerance')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../../_variables/tolerance.html">tolerance</a>           = <a class="phpfunction" onClick="logFunction('trim')" href="../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('tolerance')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/tolerance.html">tolerance</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>]);
<a name="l221"><span class="linenum"> 221</span></a>              <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('tolerancetype')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../../_variables/tolerancetype.html">tolerancetype</a>       = <a class="phpfunction" onClick="logFunction('trim')" href="../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('tolerancetype')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/tolerancetype.html">tolerancetype</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>]);
<a name="l222"><span class="linenum"> 222</span></a>              <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('correctanswerlength')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../../_variables/correctanswerlength.html">correctanswerlength</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('correctanswerlength')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/correctanswerlength.html">correctanswerlength</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>]);
<a name="l223"><span class="linenum"> 223</span></a>              <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('correctanswerformat')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../../_variables/correctanswerformat.html">correctanswerformat</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('correctanswerformat')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/correctanswerformat.html">correctanswerformat</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>]);
<a name="l224"><span class="linenum"> 224</span></a>  
<a name="l225"><span class="linenum"> 225</span></a>  <span class="comment">            // Save options.</span>
<a name="l226"><span class="linenum"> 226</span></a>              if (isset(<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('id')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>)) {
<a name="l227"><span class="linenum"> 227</span></a>  <span class="comment">                // Reusing existing record.</span>
<a name="l228"><span class="linenum"> 228</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('question_calculated', <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>);
<a name="l229"><span class="linenum"> 229</span></a>              } else {
<a name="l230"><span class="linenum"> 230</span></a>  <span class="comment">                // New options.</span>
<a name="l231"><span class="linenum"> 231</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('question_calculated', <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>);
<a name="l232"><span class="linenum"> 232</span></a>              }
<a name="l233"><span class="linenum"> 233</span></a>          }
<a name="l234"><span class="linenum"> 234</span></a>  
<a name="l235"><span class="linenum"> 235</span></a>  <span class="comment">        // Delete old answer records.</span>
<a name="l236"><span class="linenum"> 236</span></a>          if (!empty(<a class="var it5938" onMouseOver="hilite(5938)" onMouseOut="lolite()" onClick="logVariable('oldanswers')" href="../../../_variables/oldanswers.html">$oldanswers</a>)) {
<a name="l237"><span class="linenum"> 237</span></a>              foreach (<a class="var it5938" onMouseOver="hilite(5938)" onMouseOut="lolite()" onClick="logVariable('oldanswers')" href="../../../_variables/oldanswers.html">$oldanswers</a> as <a class="var it13032" onMouseOver="hilite(13032)" onMouseOut="lolite()" onClick="logVariable('oa')" href="../../../_variables/oa.html">$oa</a>) {
<a name="l238"><span class="linenum"> 238</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('question_answers', array('id' =&gt; <a class="var it13032" onMouseOver="hilite(13032)" onMouseOut="lolite()" onClick="logVariable('oa')" href="../../../_variables/oa.html">$oa</a>-&gt;<a onClick="logVariable('id')" class="var it43201" onMouseOver="hilite(43201)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l239"><span class="linenum"> 239</span></a>              }
<a name="l240"><span class="linenum"> 240</span></a>          }
<a name="l241"><span class="linenum"> 241</span></a>  
<a name="l242"><span class="linenum"> 242</span></a>  <span class="comment">        // Delete old answer records.</span>
<a name="l243"><span class="linenum"> 243</span></a>          if (!empty(<a class="var it13030" onMouseOver="hilite(13030)" onMouseOut="lolite()" onClick="logVariable('oldoptions')" href="../../../_variables/oldoptions.html">$oldoptions</a>)) {
<a name="l244"><span class="linenum"> 244</span></a>              foreach (<a class="var it13030" onMouseOver="hilite(13030)" onMouseOut="lolite()" onClick="logVariable('oldoptions')" href="../../../_variables/oldoptions.html">$oldoptions</a> as <a class="var it13033" onMouseOver="hilite(13033)" onMouseOut="lolite()" onClick="logVariable('oo')" href="../../../_variables/oo.html">$oo</a>) {
<a name="l245"><span class="linenum"> 245</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('question_calculated', array('id' =&gt; <a class="var it13033" onMouseOver="hilite(13033)" onMouseOut="lolite()" onClick="logVariable('oo')" href="../../../_variables/oo.html">$oo</a>-&gt;<a onClick="logVariable('id')" class="var it43202" onMouseOver="hilite(43202)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l246"><span class="linenum"> 246</span></a>              }
<a name="l247"><span class="linenum"> 247</span></a>          }
<a name="l248"><span class="linenum"> 248</span></a>  
<a name="l249"><span class="linenum"> 249</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = <a class="var it13031" onMouseOver="hilite(13031)" onMouseOut="lolite()" onClick="logVariable('virtualqtype')" href="../../../_variables/virtualqtype.html">$virtualqtype</a>-&gt;<a class="function" onClick="logFunction('save_unit_options')" href="../../../_functions/save_unit_options.html" onMouseOver="funcPopup(event,'save_unit_options')">save_unit_options</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>);
<a name="l250"><span class="linenum"> 250</span></a>          if (isset(<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('error')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../../../_variables/error.html">error</a>)) {
<a name="l251"><span class="linenum"> 251</span></a>              return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>;
<a name="l252"><span class="linenum"> 252</span></a>          }
<a name="l253"><span class="linenum"> 253</span></a>  
<a name="l254"><span class="linenum"> 254</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('save_hints')" href="../../../_functions/save_hints.html" onMouseOver="funcPopup(event,'save_hints')">save_hints</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>);
<a name="l255"><span class="linenum"> 255</span></a>  
<a name="l256"><span class="linenum"> 256</span></a>          if (isset(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('import_process')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/import_process.html">import_process</a>)&amp;&amp;<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('import_process')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/import_process.html">import_process</a>) {
<a name="l257"><span class="linenum"> 257</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('import_datasets')" href="../../../_functions/import_datasets.html" onMouseOver="funcPopup(event,'import_datasets')">import_datasets</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>);
<a name="l258"><span class="linenum"> 258</span></a>          }
<a name="l259"><span class="linenum"> 259</span></a>  <span class="comment">        // Report any problems.</span>
<a name="l260"><span class="linenum"> 260</span></a>          if (!empty(<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>-&gt;<a onClick="logVariable('notice')" class="var it43057" onMouseOver="hilite(43057)" onMouseOut="lolite()" href="../../../_variables/notice.html">notice</a>)) {
<a name="l261"><span class="linenum"> 261</span></a>              return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>;
<a name="l262"><span class="linenum"> 262</span></a>          }
<a name="l263"><span class="linenum"> 263</span></a>          return true;
<a name="l264"><span class="linenum"> 264</span></a>      }
<a name="l265"><span class="linenum"> 265</span></a>  
<a name="l266"><span class="linenum"> 266</span></a>      public function <a class="function" onClick="logFunction('import_datasets')" href="../../../_functions/import_datasets.html" onMouseOver="funcPopup(event,'import_datasets')">import_datasets</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>) {
<a name="l267"><span class="linenum"> 267</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l268"><span class="linenum"> 268</span></a>          <a class="var it2074" onMouseOver="hilite(2074)" onMouseOut="lolite()" onClick="logVariable('n')" href="../../../_variables/n.html">$n</a> = <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('dataset')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/dataset.html">dataset</a>);
<a name="l269"><span class="linenum"> 269</span></a>          foreach (<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('dataset')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/dataset.html">dataset</a> as <a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>) {
<a name="l270"><span class="linenum"> 270</span></a>  <span class="comment">            // Name, type, option.</span>
<a name="l271"><span class="linenum"> 271</span></a>              <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a> = new stdClass();
<a name="l272"><span class="linenum"> 272</span></a>              <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('name')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a> = <a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>-&gt;<a onClick="logVariable('name')" class="var it44018" onMouseOver="hilite(44018)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>;
<a name="l273"><span class="linenum"> 273</span></a>              <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('type')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/type.html">type</a> = 1;
<a name="l274"><span class="linenum"> 274</span></a>              <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('options')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a> =  <a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>-&gt;<a onClick="logVariable('distribution')" class="var it44018" onMouseOver="hilite(44018)" onMouseOut="lolite()" href="../../../_variables/distribution.html">distribution</a> . ':' . <a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>-&gt;<a onClick="logVariable('min')" class="var it44018" onMouseOver="hilite(44018)" onMouseOut="lolite()" href="../../../_variables/min.html">min</a> . ':' .
<a name="l275"><span class="linenum"> 275</span></a>                      <a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>-&gt;<a onClick="logVariable('max')" class="var it44018" onMouseOver="hilite(44018)" onMouseOut="lolite()" href="../../../_variables/max.html">max</a> . ':' . <a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>-&gt;<a onClick="logVariable('length')" class="var it44018" onMouseOver="hilite(44018)" onMouseOut="lolite()" href="../../../_variables/length.html">length</a>;
<a name="l276"><span class="linenum"> 276</span></a>              <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('itemcount')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/itemcount.html">itemcount</a> = <a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>-&gt;<a onClick="logVariable('itemcount')" class="var it44018" onMouseOver="hilite(44018)" onMouseOut="lolite()" href="../../../_variables/itemcount.html">itemcount</a>;
<a name="l277"><span class="linenum"> 277</span></a>              if (<a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>-&gt;<a onClick="logVariable('status')" class="var it44018" onMouseOver="hilite(44018)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a> == 'private') {
<a name="l278"><span class="linenum"> 278</span></a>                  <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('category')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a> = 0;
<a name="l279"><span class="linenum"> 279</span></a>                  <a class="var it761" onMouseOver="hilite(761)" onMouseOut="lolite()" onClick="logVariable('todo')" href="../../../_variables/todo.html">$todo</a> = 'create';
<a name="l280"><span class="linenum"> 280</span></a>              } else if (<a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>-&gt;<a onClick="logVariable('status')" class="var it44018" onMouseOver="hilite(44018)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a> == 'shared') {
<a name="l281"><span class="linenum"> 281</span></a>                  if (<a class="var it13035" onMouseOver="hilite(13035)" onMouseOut="lolite()" onClick="logVariable('sharedatasetdefs')" href="../../../_variables/sharedatasetdefs.html">$sharedatasetdefs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_select')" href="../../../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>(
<a name="l282"><span class="linenum"> 282</span></a>                      'question_dataset_definitions',
<a name="l283"><span class="linenum"> 283</span></a>                      &quot;type = '1'
<a name="l284"><span class="linenum"> 284</span></a>                      AND name = ?
<a name="l285"><span class="linenum"> 285</span></a>                      AND category = ?
<a name="l286"><span class="linenum"> 286</span></a>                      ORDER BY id DESC &quot;, array(<a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>-&gt;<a onClick="logVariable('name')" class="var it44018" onMouseOver="hilite(44018)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>, <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('category')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>)
<a name="l287"><span class="linenum"> 287</span></a>                  )) { // So there is at least one.
<a name="l288"><span class="linenum"> 288</span></a>                      <a class="var it13036" onMouseOver="hilite(13036)" onMouseOut="lolite()" onClick="logVariable('sharedatasetdef')" href="../../../_variables/sharedatasetdef.html">$sharedatasetdef</a> = <a class="phpfunction" onClick="logFunction('array_shift')" href="../../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it13035" onMouseOver="hilite(13035)" onMouseOut="lolite()" onClick="logVariable('sharedatasetdefs')" href="../../../_variables/sharedatasetdefs.html">$sharedatasetdefs</a>);
<a name="l289"><span class="linenum"> 289</span></a>                      if (<a class="var it13036" onMouseOver="hilite(13036)" onMouseOut="lolite()" onClick="logVariable('sharedatasetdef')" href="../../../_variables/sharedatasetdef.html">$sharedatasetdef</a>-&gt;<a onClick="logVariable('options')" class="var it44019" onMouseOver="hilite(44019)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a> ==  <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('options')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>) {// Identical so use it.
<a name="l290"><span class="linenum"> 290</span></a>                          <a class="var it761" onMouseOver="hilite(761)" onMouseOut="lolite()" onClick="logVariable('todo')" href="../../../_variables/todo.html">$todo</a> = 'useit';
<a name="l291"><span class="linenum"> 291</span></a>                          <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a> = <a class="var it13036" onMouseOver="hilite(13036)" onMouseOut="lolite()" onClick="logVariable('sharedatasetdef')" href="../../../_variables/sharedatasetdef.html">$sharedatasetdef</a>;
<a name="l292"><span class="linenum"> 292</span></a>                      } else { // Different so create a private one.
<a name="l293"><span class="linenum"> 293</span></a>                          <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('category')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a> = 0;
<a name="l294"><span class="linenum"> 294</span></a>                          <a class="var it761" onMouseOver="hilite(761)" onMouseOut="lolite()" onClick="logVariable('todo')" href="../../../_variables/todo.html">$todo</a> = 'create';
<a name="l295"><span class="linenum"> 295</span></a>                      }
<a name="l296"><span class="linenum"> 296</span></a>                  } else { // No so create one.
<a name="l297"><span class="linenum"> 297</span></a>                      <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('category')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a> = <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('category')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>;
<a name="l298"><span class="linenum"> 298</span></a>                      <a class="var it761" onMouseOver="hilite(761)" onMouseOut="lolite()" onClick="logVariable('todo')" href="../../../_variables/todo.html">$todo</a> = 'create';
<a name="l299"><span class="linenum"> 299</span></a>                  }
<a name="l300"><span class="linenum"> 300</span></a>              }
<a name="l301"><span class="linenum"> 301</span></a>              if (<a class="var it761" onMouseOver="hilite(761)" onMouseOut="lolite()" onClick="logVariable('todo')" href="../../../_variables/todo.html">$todo</a> == 'create') {
<a name="l302"><span class="linenum"> 302</span></a>                  <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('question_dataset_definitions', <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>);
<a name="l303"><span class="linenum"> 303</span></a>              }
<a name="l304"><span class="linenum"> 304</span></a>  <span class="comment">            // Create relation to the dataset.</span>
<a name="l305"><span class="linenum"> 305</span></a>              <a class="var it10193" onMouseOver="hilite(10193)" onMouseOut="lolite()" onClick="logVariable('questiondataset')" href="../../../_variables/questiondataset.html">$questiondataset</a> = new stdClass();
<a name="l306"><span class="linenum"> 306</span></a>              <a class="var it10193" onMouseOver="hilite(10193)" onMouseOut="lolite()" onClick="logVariable('questiondataset')" href="../../../_variables/questiondataset.html">$questiondataset</a>-&gt;<a onClick="logVariable('question')" class="var it43203" onMouseOver="hilite(43203)" onMouseOut="lolite()" href="../../../_variables/question.html">question</a> = <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l307"><span class="linenum"> 307</span></a>              <a class="var it10193" onMouseOver="hilite(10193)" onMouseOut="lolite()" onClick="logVariable('questiondataset')" href="../../../_variables/questiondataset.html">$questiondataset</a>-&gt;<a onClick="logVariable('datasetdefinition')" class="var it43203" onMouseOver="hilite(43203)" onMouseOut="lolite()" href="../../../_variables/datasetdefinition.html">datasetdefinition</a> = <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l308"><span class="linenum"> 308</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('question_datasets', <a class="var it10193" onMouseOver="hilite(10193)" onMouseOut="lolite()" onClick="logVariable('questiondataset')" href="../../../_variables/questiondataset.html">$questiondataset</a>);
<a name="l309"><span class="linenum"> 309</span></a>              if (<a class="var it761" onMouseOver="hilite(761)" onMouseOut="lolite()" onClick="logVariable('todo')" href="../../../_variables/todo.html">$todo</a> == 'create') {
<a name="l310"><span class="linenum"> 310</span></a>  <span class="comment">                // Add the items.</span>
<a name="l311"><span class="linenum"> 311</span></a>                  foreach (<a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>-&gt;<a onClick="logVariable('datasetitem')" class="var it44018" onMouseOver="hilite(44018)" onMouseOut="lolite()" href="../../../_variables/datasetitem.html">datasetitem</a> as <a class="var it13037" onMouseOver="hilite(13037)" onMouseOut="lolite()" onClick="logVariable('dataitem')" href="../../../_variables/dataitem.html">$dataitem</a>) {
<a name="l312"><span class="linenum"> 312</span></a>                      <a class="var it13038" onMouseOver="hilite(13038)" onMouseOut="lolite()" onClick="logVariable('datasetitem')" href="../../../_variables/datasetitem.html">$datasetitem</a> = new stdClass();
<a name="l313"><span class="linenum"> 313</span></a>                      <a class="var it13038" onMouseOver="hilite(13038)" onMouseOut="lolite()" onClick="logVariable('datasetitem')" href="../../../_variables/datasetitem.html">$datasetitem</a>-&gt;<a onClick="logVariable('definition')" class="var it43198" onMouseOver="hilite(43198)" onMouseOut="lolite()" href="../../../_variables/definition.html">definition</a> = <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l314"><span class="linenum"> 314</span></a>                      <a class="var it13038" onMouseOver="hilite(13038)" onMouseOut="lolite()" onClick="logVariable('datasetitem')" href="../../../_variables/datasetitem.html">$datasetitem</a>-&gt;<a onClick="logVariable('itemnumber')" class="var it43198" onMouseOver="hilite(43198)" onMouseOut="lolite()" href="../../../_variables/itemnumber.html">itemnumber</a> = <a class="var it13037" onMouseOver="hilite(13037)" onMouseOut="lolite()" onClick="logVariable('dataitem')" href="../../../_variables/dataitem.html">$dataitem</a>-&gt;<a onClick="logVariable('itemnumber')" class="var it44020" onMouseOver="hilite(44020)" onMouseOut="lolite()" href="../../../_variables/itemnumber.html">itemnumber</a>;
<a name="l315"><span class="linenum"> 315</span></a>                      <a class="var it13038" onMouseOver="hilite(13038)" onMouseOut="lolite()" onClick="logVariable('datasetitem')" href="../../../_variables/datasetitem.html">$datasetitem</a>-&gt;<a onClick="logVariable('value')" class="var it43198" onMouseOver="hilite(43198)" onMouseOut="lolite()" href="../../../_variables/value.html">value</a> = <a class="var it13037" onMouseOver="hilite(13037)" onMouseOut="lolite()" onClick="logVariable('dataitem')" href="../../../_variables/dataitem.html">$dataitem</a>-&gt;<a onClick="logVariable('value')" class="var it44020" onMouseOver="hilite(44020)" onMouseOut="lolite()" href="../../../_variables/value.html">value</a>;
<a name="l316"><span class="linenum"> 316</span></a>                      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('question_dataset_items', <a class="var it13038" onMouseOver="hilite(13038)" onMouseOut="lolite()" onClick="logVariable('datasetitem')" href="../../../_variables/datasetitem.html">$datasetitem</a>);
<a name="l317"><span class="linenum"> 317</span></a>                  }
<a name="l318"><span class="linenum"> 318</span></a>              }
<a name="l319"><span class="linenum"> 319</span></a>          }
<a name="l320"><span class="linenum"> 320</span></a>      }
<a name="l321"><span class="linenum"> 321</span></a>  
<a name="l322"><span class="linenum"> 322</span></a>      protected function <a class="function" onClick="logFunction('initialise_question_instance')" href="../../../_functions/initialise_question_instance.html" onMouseOver="funcPopup(event,'initialise_question_instance')">initialise_question_instance</a>(question_definition <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>, <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('questiondata')" href="../../../_variables/questiondata.html">$questiondata</a>) {
<a name="l323"><span class="linenum"> 323</span></a>          parent::<a class="function" onClick="logFunction('initialise_question_instance')" href="../../../_functions/initialise_question_instance.html" onMouseOver="funcPopup(event,'initialise_question_instance')">initialise_question_instance</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>, <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('questiondata')" href="../../../_variables/questiondata.html">$questiondata</a>);
<a name="l324"><span class="linenum"> 324</span></a>  
<a name="l325"><span class="linenum"> 325</span></a>          question_bank::<a class="function" onClick="logFunction('get_qtype')" href="../../../_functions/get_qtype.html" onMouseOver="funcPopup(event,'get_qtype')">get_qtype</a>('numerical')-&gt;<a class="function" onClick="logFunction('initialise_numerical_answers')" href="../../../_functions/initialise_numerical_answers.html" onMouseOver="funcPopup(event,'initialise_numerical_answers')">initialise_numerical_answers</a>(
<a name="l326"><span class="linenum"> 326</span></a>                  <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>, <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('questiondata')" href="../../../_variables/questiondata.html">$questiondata</a>);
<a name="l327"><span class="linenum"> 327</span></a>          foreach (<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('questiondata')" href="../../../_variables/questiondata.html">$questiondata</a>-&gt;<a onClick="logVariable('options')" class="var it43218" onMouseOver="hilite(43218)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;answers as <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../../_variables/a.html">$a</a>) {
<a name="l328"><span class="linenum"> 328</span></a>              <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('answers')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/answers.html">answers</a>[<a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('id')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>]-&gt;tolerancetype = <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('tolerancetype')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../../_variables/tolerancetype.html">tolerancetype</a>;
<a name="l329"><span class="linenum"> 329</span></a>              <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('answers')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/answers.html">answers</a>[<a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('id')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>]-&gt;correctanswerlength = <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('correctanswerlength')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../../_variables/correctanswerlength.html">correctanswerlength</a>;
<a name="l330"><span class="linenum"> 330</span></a>              <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('answers')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/answers.html">answers</a>[<a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('id')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>]-&gt;correctanswerformat = <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('correctanswerformat')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../../_variables/correctanswerformat.html">correctanswerformat</a>;
<a name="l331"><span class="linenum"> 331</span></a>          }
<a name="l332"><span class="linenum"> 332</span></a>  
<a name="l333"><span class="linenum"> 333</span></a>          <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('synchronised')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/synchronised.html">synchronised</a> = <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('questiondata')" href="../../../_variables/questiondata.html">$questiondata</a>-&gt;<a onClick="logVariable('options')" class="var it43218" onMouseOver="hilite(43218)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;synchronize;
<a name="l334"><span class="linenum"> 334</span></a>  
<a name="l335"><span class="linenum"> 335</span></a>          <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('unitdisplay')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/unitdisplay.html">unitdisplay</a> = <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('questiondata')" href="../../../_variables/questiondata.html">$questiondata</a>-&gt;<a onClick="logVariable('options')" class="var it43218" onMouseOver="hilite(43218)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;showunits;
<a name="l336"><span class="linenum"> 336</span></a>          <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('unitgradingtype')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/unitgradingtype.html">unitgradingtype</a> = <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('questiondata')" href="../../../_variables/questiondata.html">$questiondata</a>-&gt;<a onClick="logVariable('options')" class="var it43218" onMouseOver="hilite(43218)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;unitgradingtype;
<a name="l337"><span class="linenum"> 337</span></a>          <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('unitpenalty')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/unitpenalty.html">unitpenalty</a> = <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('questiondata')" href="../../../_variables/questiondata.html">$questiondata</a>-&gt;<a onClick="logVariable('options')" class="var it43218" onMouseOver="hilite(43218)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;unitpenalty;
<a name="l338"><span class="linenum"> 338</span></a>          <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('ap')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/ap.html">ap</a> = question_bank::<a class="function" onClick="logFunction('get_qtype')" href="../../../_functions/get_qtype.html" onMouseOver="funcPopup(event,'get_qtype')">get_qtype</a>(
<a name="l339"><span class="linenum"> 339</span></a>                  'numerical')-&gt;<a class="function" onClick="logFunction('make_answer_processor')" href="../../../_functions/make_answer_processor.html" onMouseOver="funcPopup(event,'make_answer_processor')">make_answer_processor</a>(
<a name="l340"><span class="linenum"> 340</span></a>                  <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('questiondata')" href="../../../_variables/questiondata.html">$questiondata</a>-&gt;<a onClick="logVariable('options')" class="var it43218" onMouseOver="hilite(43218)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;units, <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('questiondata')" href="../../../_variables/questiondata.html">$questiondata</a>-&gt;<a onClick="logVariable('options')" class="var it43218" onMouseOver="hilite(43218)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;unitsleft);
<a name="l341"><span class="linenum"> 341</span></a>  
<a name="l342"><span class="linenum"> 342</span></a>          <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('datasetloader')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/datasetloader.html">datasetloader</a> = <span class="keyword">new </span><a class="class" onClick="logClass('qtype_calculated_dataset_loader')" href="../../../_classes/qtype_calculated_dataset_loader.html" onMouseOver="classPopup(event,'qtype_calculated_dataset_loader')">qtype_calculated_dataset_loader</a>(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('questiondata')" href="../../../_variables/questiondata.html">$questiondata</a>-&gt;<a onClick="logVariable('id')" class="var it43218" onMouseOver="hilite(43218)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>);
<a name="l343"><span class="linenum"> 343</span></a>      }
<a name="l344"><span class="linenum"> 344</span></a>  
<a name="l345"><span class="linenum"> 345</span></a>      public function <a class="function" onClick="logFunction('finished_edit_wizard')" href="../../../_functions/finished_edit_wizard.html" onMouseOver="funcPopup(event,'finished_edit_wizard')">finished_edit_wizard</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>) {
<a name="l346"><span class="linenum"> 346</span></a>          return isset(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('savechanges')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/savechanges.html">savechanges</a>);
<a name="l347"><span class="linenum"> 347</span></a>      }
<a name="l348"><span class="linenum"> 348</span></a>      public function <a class="function" onClick="logFunction('wizardpagesnumber')" href="../../../_functions/wizardpagesnumber.html" onMouseOver="funcPopup(event,'wizardpagesnumber')">wizardpagesnumber</a>() {
<a name="l349"><span class="linenum"> 349</span></a>          return 3;
<a name="l350"><span class="linenum"> 350</span></a>      }
<a name="l351"><span class="linenum"> 351</span></a>  <span class="comment">    // This gets called by editquestion.php after the standard question is saved.</span>
<a name="l352"><span class="linenum"> 352</span></a>      public function <a class="function" onClick="logFunction('print_next_wizard_page')" href="../../../_functions/print_next_wizard_page.html" onMouseOver="funcPopup(event,'print_next_wizard_page')">print_next_wizard_page</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>, <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../../_variables/course.html">$course</a>) {
<a name="l353"><span class="linenum"> 353</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>, <a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../../_variables/SESSION.html">$SESSION</a>, <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../../_variables/COURSE.html">$COURSE</a>;
<a name="l354"><span class="linenum"> 354</span></a>  
<a name="l355"><span class="linenum"> 355</span></a>  <span class="comment">        // Catch invalid navigation &amp; reloads.</span>
<a name="l356"><span class="linenum"> 356</span></a>          if (empty(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>) &amp;&amp; empty(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('calculated')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../../../_variables/calculated.html">calculated</a>)) {
<a name="l357"><span class="linenum"> 357</span></a>              <a class="function" onClick="logFunction('redirect')" href="../../../_functions/redirect.html" onMouseOver="funcPopup(event,'redirect')">redirect</a>('edit.php?courseid='.<a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../../_variables/COURSE.html">$COURSE</a>-&gt;<a onClick="logVariable('id')" class="var it43316" onMouseOver="hilite(43316)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, 'The page you are loading has expired.', 3);
<a name="l358"><span class="linenum"> 358</span></a>          }
<a name="l359"><span class="linenum"> 359</span></a>  
<a name="l360"><span class="linenum"> 360</span></a>  <span class="comment">        // See where we're coming from.</span>
<a name="l361"><span class="linenum"> 361</span></a>          switch(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('wizardpage')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/wizardpage.html">wizardpage</a>) {
<a name="l362"><span class="linenum"> 362</span></a>              case 'question':
<a name="l363"><span class="linenum"> 363</span></a>                  <a class="function" onClick="logFunction('require')" href="../../../_functions/require.html" onMouseOver="funcPopup(event,'require')">require</a>(&quot;{<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/dirroot.html">dirroot</a>}/question/type/calculated/datasetdefinitions.php&quot;);
<a name="l364"><span class="linenum"> 364</span></a>                  break;
<a name="l365"><span class="linenum"> 365</span></a>              case 'datasetdefinitions':
<a name="l366"><span class="linenum"> 366</span></a>              case 'datasetitems':
<a name="l367"><span class="linenum"> 367</span></a>                  <a class="function" onClick="logFunction('require')" href="../../../_functions/require.html" onMouseOver="funcPopup(event,'require')">require</a>(&quot;{<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/dirroot.html">dirroot</a>}/question/type/calculated/datasetitems.php&quot;);
<a name="l368"><span class="linenum"> 368</span></a>                  break;
<a name="l369"><span class="linenum"> 369</span></a>              default:
<a name="l370"><span class="linenum"> 370</span></a>                  <a class="function" onClick="logFunction('print_error')" href="../../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('invalidwizardpage', 'question');
<a name="l371"><span class="linenum"> 371</span></a>                  break;
<a name="l372"><span class="linenum"> 372</span></a>          }
<a name="l373"><span class="linenum"> 373</span></a>      }
<a name="l374"><span class="linenum"> 374</span></a>  
<a name="l375"><span class="linenum"> 375</span></a>  <span class="comment">    // This gets called by question2.php after the standard question is saved.</span>
<a name="l376"><span class="linenum"> 376</span></a>      public function &amp;<a class="function" onClick="logFunction('next_wizard_form')" href="../../../_functions/next_wizard_form.html" onMouseOver="funcPopup(event,'next_wizard_form')">next_wizard_form</a>(<a class="var it5929" onMouseOver="hilite(5929)" onMouseOut="lolite()" onClick="logVariable('submiturl')" href="../../../_variables/submiturl.html">$submiturl</a>, <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>, <a class="var it5932" onMouseOver="hilite(5932)" onMouseOut="lolite()" onClick="logVariable('wizardnow')" href="../../../_variables/wizardnow.html">$wizardnow</a>) {
<a name="l377"><span class="linenum"> 377</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>, <a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../../_variables/SESSION.html">$SESSION</a>, <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../../_variables/COURSE.html">$COURSE</a>;
<a name="l378"><span class="linenum"> 378</span></a>  
<a name="l379"><span class="linenum"> 379</span></a>  <span class="comment">        // Catch invalid navigation &amp; reloads.</span>
<a name="l380"><span class="linenum"> 380</span></a>          if (empty(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>) &amp;&amp; empty(<a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('calculated')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../../../_variables/calculated.html">calculated</a>)) {
<a name="l381"><span class="linenum"> 381</span></a>              <a class="function" onClick="logFunction('redirect')" href="../../../_functions/redirect.html" onMouseOver="funcPopup(event,'redirect')">redirect</a>('edit.php?courseid=' . <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('COURSE')" href="../../../_variables/COURSE.html">$COURSE</a>-&gt;<a onClick="logVariable('id')" class="var it43316" onMouseOver="hilite(43316)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>,
<a name="l382"><span class="linenum"> 382</span></a>                      'The page you are loading has expired. Cannot get next wizard form.', 3);
<a name="l383"><span class="linenum"> 383</span></a>          }
<a name="l384"><span class="linenum"> 384</span></a>          if (empty(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>)) {
<a name="l385"><span class="linenum"> 385</span></a>              <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a> = <a class="var it355" onMouseOver="hilite(355)" onMouseOut="lolite()" onClick="logVariable('SESSION')" href="../../../_variables/SESSION.html">$SESSION</a>-&gt;<a onClick="logVariable('calculated')" class="var it42907" onMouseOver="hilite(42907)" onMouseOut="lolite()" href="../../../_variables/calculated.html">calculated</a>-&gt;questionform;
<a name="l386"><span class="linenum"> 386</span></a>          }
<a name="l387"><span class="linenum"> 387</span></a>  
<a name="l388"><span class="linenum"> 388</span></a>  <span class="comment">        // See where we're coming from.</span>
<a name="l389"><span class="linenum"> 389</span></a>          switch(<a class="var it5932" onMouseOver="hilite(5932)" onMouseOut="lolite()" onClick="logVariable('wizardnow')" href="../../../_variables/wizardnow.html">$wizardnow</a>) {
<a name="l390"><span class="linenum"> 390</span></a>              case 'datasetdefinitions':
<a name="l391"><span class="linenum"> 391</span></a>                  <a class="function" onClick="logFunction('require')" href="../../../_functions/require.html" onMouseOver="funcPopup(event,'require')">require</a>(&quot;{<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/dirroot.html">dirroot</a>}/question/type/calculated/datasetdefinitions_form.php&quot;);
<a name="l392"><span class="linenum"> 392</span></a>                  <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../../_variables/mform.html">$mform</a> = <span class="keyword">new </span><a class="class" onClick="logClass('question_dataset_dependent_definitions_form')" href="../../../_classes/question_dataset_dependent_definitions_form.html" onMouseOver="classPopup(event,'question_dataset_dependent_definitions_form')">question_dataset_dependent_definitions_form</a>(
<a name="l393"><span class="linenum"> 393</span></a>                          &quot;{<a class="var it5929" onMouseOver="hilite(5929)" onMouseOut="lolite()" onClick="logVariable('submiturl')" href="../../../_variables/submiturl.html">$submiturl</a>}?wizardnow=datasetdefinitions&quot;, <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>);
<a name="l394"><span class="linenum"> 394</span></a>                  break;
<a name="l395"><span class="linenum"> 395</span></a>              case 'datasetitems':
<a name="l396"><span class="linenum"> 396</span></a>                  <a class="function" onClick="logFunction('require')" href="../../../_functions/require.html" onMouseOver="funcPopup(event,'require')">require</a>(&quot;{<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../../_variables/dirroot.html">dirroot</a>}/question/type/calculated/datasetitems_form.php&quot;);
<a name="l397"><span class="linenum"> 397</span></a>                  <a class="var it13040" onMouseOver="hilite(13040)" onMouseOut="lolite()" onClick="logVariable('regenerate')" href="../../../_variables/regenerate.html">$regenerate</a> = <a class="function" onClick="logFunction('optional_param')" href="../../../_functions/optional_param.html" onMouseOver="funcPopup(event,'optional_param')">optional_param</a>('forceregeneration', false, <a class="constant" onClick="logConstant('PARAM_BOOL')" href="../../../_constants/PARAM_BOOL.html" onMouseOver="constPopup(event,'PARAM_BOOL')">PARAM_BOOL</a>);
<a name="l398"><span class="linenum"> 398</span></a>                  <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../../_variables/mform.html">$mform</a> = <span class="keyword">new </span><a class="class" onClick="logClass('question_dataset_dependent_items_form')" href="../../../_classes/question_dataset_dependent_items_form.html" onMouseOver="classPopup(event,'question_dataset_dependent_items_form')">question_dataset_dependent_items_form</a>(
<a name="l399"><span class="linenum"> 399</span></a>                          &quot;{<a class="var it5929" onMouseOver="hilite(5929)" onMouseOut="lolite()" onClick="logVariable('submiturl')" href="../../../_variables/submiturl.html">$submiturl</a>}?wizardnow=datasetitems&quot;, <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>, <a class="var it13040" onMouseOver="hilite(13040)" onMouseOut="lolite()" onClick="logVariable('regenerate')" href="../../../_variables/regenerate.html">$regenerate</a>);
<a name="l400"><span class="linenum"> 400</span></a>                  break;
<a name="l401"><span class="linenum"> 401</span></a>              default:
<a name="l402"><span class="linenum"> 402</span></a>                  <a class="function" onClick="logFunction('print_error')" href="../../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('invalidwizardpage', 'question');
<a name="l403"><span class="linenum"> 403</span></a>                  break;
<a name="l404"><span class="linenum"> 404</span></a>          }
<a name="l405"><span class="linenum"> 405</span></a>  
<a name="l406"><span class="linenum"> 406</span></a>          return <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../../_variables/mform.html">$mform</a>;
<a name="l407"><span class="linenum"> 407</span></a>      }
<a name="l408"><span class="linenum"> 408</span></a>  
<a name="l409"><span class="linenum"> 409</span></a>      <span class="comment">/**</span>
<a name="l410"><span class="linenum"> 410</span></a>  <span class="comment">     * This method should be overriden if you want to include a special heading or some other</span>
<a name="l411"><span class="linenum"> 411</span></a>  <span class="comment">     * html on a question editing page besides the question editing form.</span>
<a name="l412"><span class="linenum"> 412</span></a>  <span class="comment">     *</span>
<a name="l413"><span class="linenum"> 413</span></a>  <span class="comment">     * @param question_edit_form $mform a child of question_edit_form</span>
<a name="l414"><span class="linenum"> 414</span></a>  <span class="comment">     * @param object $question</span>
<a name="l415"><span class="linenum"> 415</span></a>  <span class="comment">     * @param string $wizardnow is '' for first page.</span>
<a name="l416"><span class="linenum"> 416</span></a>  <span class="comment">     */</span>
<a name="l417"><span class="linenum"> 417</span></a>      public function <a class="function" onClick="logFunction('display_question_editing_page')" href="../../../_functions/display_question_editing_page.html" onMouseOver="funcPopup(event,'display_question_editing_page')">display_question_editing_page</a>(<a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../../_variables/mform.html">$mform</a>, <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>, <a class="var it5932" onMouseOver="hilite(5932)" onMouseOut="lolite()" onClick="logVariable('wizardnow')" href="../../../_variables/wizardnow.html">$wizardnow</a>) {
<a name="l418"><span class="linenum"> 418</span></a>          global <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l419"><span class="linenum"> 419</span></a>          switch (<a class="var it5932" onMouseOver="hilite(5932)" onMouseOut="lolite()" onClick="logVariable('wizardnow')" href="../../../_variables/wizardnow.html">$wizardnow</a>) {
<a name="l420"><span class="linenum"> 420</span></a>              case '':
<a name="l421"><span class="linenum"> 421</span></a>  <span class="comment">                // On the first page, the default display is fine.</span>
<a name="l422"><span class="linenum"> 422</span></a>                  parent::<a class="function" onClick="logFunction('display_question_editing_page')" href="../../../_functions/display_question_editing_page.html" onMouseOver="funcPopup(event,'display_question_editing_page')">display_question_editing_page</a>(<a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../../_variables/mform.html">$mform</a>, <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>, <a class="var it5932" onMouseOver="hilite(5932)" onMouseOut="lolite()" onClick="logVariable('wizardnow')" href="../../../_variables/wizardnow.html">$wizardnow</a>);
<a name="l423"><span class="linenum"> 423</span></a>                  return;
<a name="l424"><span class="linenum"> 424</span></a>  
<a name="l425"><span class="linenum"> 425</span></a>              case 'datasetdefinitions':
<a name="l426"><span class="linenum"> 426</span></a>                  echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('heading_with_help')" href="../../../_functions/heading_with_help.html" onMouseOver="funcPopup(event,'heading_with_help')">heading_with_help</a>(
<a name="l427"><span class="linenum"> 427</span></a>                          <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('choosedatasetproperties', 'qtype_calculated'),
<a name="l428"><span class="linenum"> 428</span></a>                          'questiondatasets', 'qtype_calculated');
<a name="l429"><span class="linenum"> 429</span></a>                  break;
<a name="l430"><span class="linenum"> 430</span></a>  
<a name="l431"><span class="linenum"> 431</span></a>              case 'datasetitems':
<a name="l432"><span class="linenum"> 432</span></a>                  echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('heading_with_help')" href="../../../_functions/heading_with_help.html" onMouseOver="funcPopup(event,'heading_with_help')">heading_with_help</a>(<a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('editdatasets', 'qtype_calculated'),
<a name="l433"><span class="linenum"> 433</span></a>                          'questiondatasets', 'qtype_calculated');
<a name="l434"><span class="linenum"> 434</span></a>                  break;
<a name="l435"><span class="linenum"> 435</span></a>          }
<a name="l436"><span class="linenum"> 436</span></a>  
<a name="l437"><span class="linenum"> 437</span></a>          <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('display')" href="../../../_functions/display.html" onMouseOver="funcPopup(event,'display')">display</a>();
<a name="l438"><span class="linenum"> 438</span></a>      }
<a name="l439"><span class="linenum"> 439</span></a>  
<a name="l440"><span class="linenum"> 440</span></a>      <span class="comment">/**</span>
<a name="l441"><span class="linenum"> 441</span></a>  <span class="comment">     * Verify that the equations in part of the question are OK.</span>
<a name="l442"><span class="linenum"> 442</span></a>  <span class="comment">     * We throw an exception here because this should have already been validated</span>
<a name="l443"><span class="linenum"> 443</span></a>  <span class="comment">     * by the form. This is just a last line of defence to prevent a question</span>
<a name="l444"><span class="linenum"> 444</span></a>  <span class="comment">     * being stored in the database if it has bad formulas. This saves us from,</span>
<a name="l445"><span class="linenum"> 445</span></a>  <span class="comment">     * for example, malicious imports.</span>
<a name="l446"><span class="linenum"> 446</span></a>  <span class="comment">     * @param string $text containing equations.</span>
<a name="l447"><span class="linenum"> 447</span></a>  <span class="comment">     */</span>
<a name="l448"><span class="linenum"> 448</span></a>      protected function <a class="function" onClick="logFunction('validate_text')" href="../../../_functions/validate_text.html" onMouseOver="funcPopup(event,'validate_text')">validate_text</a>(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a>) {
<a name="l449"><span class="linenum"> 449</span></a>          <a class="var it275" onMouseOver="hilite(275)" onMouseOut="lolite()" onClick="logVariable('error')" href="../../../_variables/error.html">$error</a> = <a class="function" onClick="logFunction('qtype_calculated_find_formula_errors_in_text')" href="../../../_functions/qtype_calculated_find_formula_errors_in_text.html" onMouseOver="funcPopup(event,'qtype_calculated_find_formula_errors_in_text')">qtype_calculated_find_formula_errors_in_text</a>(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a>);
<a name="l450"><span class="linenum"> 450</span></a>          if (<a class="var it275" onMouseOver="hilite(275)" onMouseOut="lolite()" onClick="logVariable('error')" href="../../../_variables/error.html">$error</a>) {
<a name="l451"><span class="linenum"> 451</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>(<a class="var it275" onMouseOver="hilite(275)" onMouseOut="lolite()" onClick="logVariable('error')" href="../../../_variables/error.html">$error</a>);
<a name="l452"><span class="linenum"> 452</span></a>          }
<a name="l453"><span class="linenum"> 453</span></a>      }
<a name="l454"><span class="linenum"> 454</span></a>  
<a name="l455"><span class="linenum"> 455</span></a>      <span class="comment">/**</span>
<a name="l456"><span class="linenum"> 456</span></a>  <span class="comment">     * Verify that an answer is OK.</span>
<a name="l457"><span class="linenum"> 457</span></a>  <span class="comment">     * We throw an exception here because this should have already been validated</span>
<a name="l458"><span class="linenum"> 458</span></a>  <span class="comment">     * by the form. This is just a last line of defence to prevent a question</span>
<a name="l459"><span class="linenum"> 459</span></a>  <span class="comment">     * being stored in the database if it has bad formulas. This saves us from,</span>
<a name="l460"><span class="linenum"> 460</span></a>  <span class="comment">     * for example, malicious imports.</span>
<a name="l461"><span class="linenum"> 461</span></a>  <span class="comment">     * @param string $text containing equations.</span>
<a name="l462"><span class="linenum"> 462</span></a>  <span class="comment">     */</span>
<a name="l463"><span class="linenum"> 463</span></a>      protected function <a class="function" onClick="logFunction('validate_answer')" href="../../../_functions/validate_answer.html" onMouseOver="funcPopup(event,'validate_answer')">validate_answer</a>(<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>) {
<a name="l464"><span class="linenum"> 464</span></a>          <a class="var it275" onMouseOver="hilite(275)" onMouseOut="lolite()" onClick="logVariable('error')" href="../../../_variables/error.html">$error</a> = <a class="function" onClick="logFunction('qtype_calculated_find_formula_errors')" href="../../../_functions/qtype_calculated_find_formula_errors.html" onMouseOver="funcPopup(event,'qtype_calculated_find_formula_errors')">qtype_calculated_find_formula_errors</a>(<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>);
<a name="l465"><span class="linenum"> 465</span></a>          if (<a class="var it275" onMouseOver="hilite(275)" onMouseOut="lolite()" onClick="logVariable('error')" href="../../../_variables/error.html">$error</a>) {
<a name="l466"><span class="linenum"> 466</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>(<a class="var it275" onMouseOver="hilite(275)" onMouseOut="lolite()" onClick="logVariable('error')" href="../../../_variables/error.html">$error</a>);
<a name="l467"><span class="linenum"> 467</span></a>          }
<a name="l468"><span class="linenum"> 468</span></a>      }
<a name="l469"><span class="linenum"> 469</span></a>  
<a name="l470"><span class="linenum"> 470</span></a>      <span class="comment">/**</span>
<a name="l471"><span class="linenum"> 471</span></a>  <span class="comment">     * Validate data before save.</span>
<a name="l472"><span class="linenum"> 472</span></a>  <span class="comment">     * @param stdClass $question data from the form / import file.</span>
<a name="l473"><span class="linenum"> 473</span></a>  <span class="comment">     */</span>
<a name="l474"><span class="linenum"> 474</span></a>      protected function <a class="function" onClick="logFunction('validate_question_data')" href="../../../_functions/validate_question_data.html" onMouseOver="funcPopup(event,'validate_question_data')">validate_question_data</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>) {
<a name="l475"><span class="linenum"> 475</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('validate_text')" href="../../../_functions/validate_text.html" onMouseOver="funcPopup(event,'validate_text')">validate_text</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('questiontext')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/questiontext.html">questiontext</a>); <span class="comment">// Yes, really no ['text'].</span>
<a name="l476"><span class="linenum"> 476</span></a>  
<a name="l477"><span class="linenum"> 477</span></a>          if (isset(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('generalfeedback')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/generalfeedback.html">generalfeedback</a>['text'])) {
<a name="l478"><span class="linenum"> 478</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('validate_text')" href="../../../_functions/validate_text.html" onMouseOver="funcPopup(event,'validate_text')">validate_text</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('generalfeedback')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/generalfeedback.html">generalfeedback</a>['text']);
<a name="l479"><span class="linenum"> 479</span></a>          } else if (isset(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('generalfeedback')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/generalfeedback.html">generalfeedback</a>)) {
<a name="l480"><span class="linenum"> 480</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('validate_text')" href="../../../_functions/validate_text.html" onMouseOver="funcPopup(event,'validate_text')">validate_text</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('generalfeedback')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/generalfeedback.html">generalfeedback</a>); <span class="comment">// Because question import is weird.</span>
<a name="l481"><span class="linenum"> 481</span></a>          }
<a name="l482"><span class="linenum"> 482</span></a>  
<a name="l483"><span class="linenum"> 483</span></a>          foreach (<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('answer')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a> =&gt; <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>) {
<a name="l484"><span class="linenum"> 484</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('validate_answer')" href="../../../_functions/validate_answer.html" onMouseOver="funcPopup(event,'validate_answer')">validate_answer</a>(<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>);
<a name="l485"><span class="linenum"> 485</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('validate_text')" href="../../../_functions/validate_text.html" onMouseOver="funcPopup(event,'validate_text')">validate_text</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('feedback')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/feedback.html">feedback</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>]['text']);
<a name="l486"><span class="linenum"> 486</span></a>          }
<a name="l487"><span class="linenum"> 487</span></a>      }
<a name="l488"><span class="linenum"> 488</span></a>  
<a name="l489"><span class="linenum"> 489</span></a>      <span class="comment">/**</span>
<a name="l490"><span class="linenum"> 490</span></a>  <span class="comment">     * This method prepare the $datasets in a format similar to dadatesetdefinitions_form.php</span>
<a name="l491"><span class="linenum"> 491</span></a>  <span class="comment">     * so that they can be saved</span>
<a name="l492"><span class="linenum"> 492</span></a>  <span class="comment">     * using the function save_dataset_definitions($form)</span>
<a name="l493"><span class="linenum"> 493</span></a>  <span class="comment">     * when creating a new calculated question or</span>
<a name="l494"><span class="linenum"> 494</span></a>  <span class="comment">     * when editing an already existing calculated question</span>
<a name="l495"><span class="linenum"> 495</span></a>  <span class="comment">     * or by  function save_as_new_dataset_definitions($form, $initialid)</span>
<a name="l496"><span class="linenum"> 496</span></a>  <span class="comment">     * when saving as new an already existing calculated question.</span>
<a name="l497"><span class="linenum"> 497</span></a>  <span class="comment">     *</span>
<a name="l498"><span class="linenum"> 498</span></a>  <span class="comment">     * @param object $form</span>
<a name="l499"><span class="linenum"> 499</span></a>  <span class="comment">     * @param int $questionfromid default = '0'</span>
<a name="l500"><span class="linenum"> 500</span></a>  <span class="comment">     */</span>
<a name="l501"><span class="linenum"> 501</span></a>      public function <a class="function" onClick="logFunction('preparedatasets')" href="../../../_functions/preparedatasets.html" onMouseOver="funcPopup(event,'preparedatasets')">preparedatasets</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>, <a class="var it13041" onMouseOver="hilite(13041)" onMouseOut="lolite()" onClick="logVariable('questionfromid')" href="../../../_variables/questionfromid.html">$questionfromid</a> = '0') {
<a name="l502"><span class="linenum"> 502</span></a>  
<a name="l503"><span class="linenum"> 503</span></a>  <span class="comment">        // The dataset names present in the edit_question_form and edit_calculated_form</span>
<a name="l504"><span class="linenum"> 504</span></a>  <span class="comment">        // are retrieved.</span>
<a name="l505"><span class="linenum"> 505</span></a>          <a class="var it11519" onMouseOver="hilite(11519)" onMouseOut="lolite()" onClick="logVariable('possibledatasets')" href="../../../_variables/possibledatasets.html">$possibledatasets</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('find_dataset_names')" href="../../../_functions/find_dataset_names.html" onMouseOver="funcPopup(event,'find_dataset_names')">find_dataset_names</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('questiontext')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/questiontext.html">questiontext</a>);
<a name="l506"><span class="linenum"> 506</span></a>          <a class="var it11520" onMouseOver="hilite(11520)" onMouseOut="lolite()" onClick="logVariable('mandatorydatasets')" href="../../../_variables/mandatorydatasets.html">$mandatorydatasets</a> = array();
<a name="l507"><span class="linenum"> 507</span></a>          foreach (<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('answer')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a> =&gt; <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>) {
<a name="l508"><span class="linenum"> 508</span></a>              <a class="var it11520" onMouseOver="hilite(11520)" onMouseOut="lolite()" onClick="logVariable('mandatorydatasets')" href="../../../_variables/mandatorydatasets.html">$mandatorydatasets</a> += <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('find_dataset_names')" href="../../../_functions/find_dataset_names.html" onMouseOver="funcPopup(event,'find_dataset_names')">find_dataset_names</a>(<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>);
<a name="l509"><span class="linenum"> 509</span></a>          }
<a name="l510"><span class="linenum"> 510</span></a>  <span class="comment">        // If there are identical datasetdefs already saved in the original question</span>
<a name="l511"><span class="linenum"> 511</span></a>  <span class="comment">        // either when editing a question or saving as new,</span>
<a name="l512"><span class="linenum"> 512</span></a>  <span class="comment">        // they are retrieved using $questionfromid.</span>
<a name="l513"><span class="linenum"> 513</span></a>          if (<a class="var it13041" onMouseOver="hilite(13041)" onMouseOut="lolite()" onClick="logVariable('questionfromid')" href="../../../_variables/questionfromid.html">$questionfromid</a> != '0') {
<a name="l514"><span class="linenum"> 514</span></a>              <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('id')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a> = <a class="var it13041" onMouseOver="hilite(13041)" onMouseOut="lolite()" onClick="logVariable('questionfromid')" href="../../../_variables/questionfromid.html">$questionfromid</a>;
<a name="l515"><span class="linenum"> 515</span></a>          }
<a name="l516"><span class="linenum"> 516</span></a>          <a class="var it11895" onMouseOver="hilite(11895)" onMouseOut="lolite()" onClick="logVariable('datasets')" href="../../../_variables/datasets.html">$datasets</a> = array();
<a name="l517"><span class="linenum"> 517</span></a>          <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a> = 0;
<a name="l518"><span class="linenum"> 518</span></a>  <span class="comment">        // Always prepare the mandatorydatasets present in the answers.</span>
<a name="l519"><span class="linenum"> 519</span></a>  <span class="comment">        // The $options are not used here.</span>
<a name="l520"><span class="linenum"> 520</span></a>          foreach (<a class="var it11520" onMouseOver="hilite(11520)" onMouseOut="lolite()" onClick="logVariable('mandatorydatasets')" href="../../../_variables/mandatorydatasets.html">$mandatorydatasets</a> as <a class="var it11894" onMouseOver="hilite(11894)" onMouseOut="lolite()" onClick="logVariable('datasetname')" href="../../../_variables/datasetname.html">$datasetname</a>) {
<a name="l521"><span class="linenum"> 521</span></a>              if (!isset(<a class="var it11895" onMouseOver="hilite(11895)" onMouseOut="lolite()" onClick="logVariable('datasets')" href="../../../_variables/datasets.html">$datasets</a>[<a class="var it11894" onMouseOver="hilite(11894)" onMouseOut="lolite()" onClick="logVariable('datasetname')" href="../../../_variables/datasetname.html">$datasetname</a>])) {
<a name="l522"><span class="linenum"> 522</span></a>                  <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>, <a class="var it569" onMouseOver="hilite(569)" onMouseOut="lolite()" onClick="logVariable('selected')" href="../../../_variables/selected.html">$selected</a>) =
<a name="l523"><span class="linenum"> 523</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dataset_options')" href="../../../_functions/dataset_options.html" onMouseOver="funcPopup(event,'dataset_options')">dataset_options</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>, <a class="var it11894" onMouseOver="hilite(11894)" onMouseOut="lolite()" onClick="logVariable('datasetname')" href="../../../_variables/datasetname.html">$datasetname</a>);
<a name="l524"><span class="linenum"> 524</span></a>                  <a class="var it11895" onMouseOver="hilite(11895)" onMouseOut="lolite()" onClick="logVariable('datasets')" href="../../../_variables/datasets.html">$datasets</a>[<a class="var it11894" onMouseOver="hilite(11894)" onMouseOut="lolite()" onClick="logVariable('datasetname')" href="../../../_variables/datasetname.html">$datasetname</a>] = '';
<a name="l525"><span class="linenum"> 525</span></a>                  <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('dataset')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/dataset.html">dataset</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] = <a class="var it569" onMouseOver="hilite(569)" onMouseOut="lolite()" onClick="logVariable('selected')" href="../../../_variables/selected.html">$selected</a>;
<a name="l526"><span class="linenum"> 526</span></a>                  <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>++;
<a name="l527"><span class="linenum"> 527</span></a>              }
<a name="l528"><span class="linenum"> 528</span></a>          }
<a name="l529"><span class="linenum"> 529</span></a>  <span class="comment">        // Do not prepare possibledatasets when creating a question.</span>
<a name="l530"><span class="linenum"> 530</span></a>  <span class="comment">        // They will defined and stored with datasetdefinitions_form.php.</span>
<a name="l531"><span class="linenum"> 531</span></a>  <span class="comment">        // The $options are not used here.</span>
<a name="l532"><span class="linenum"> 532</span></a>          if (<a class="var it13041" onMouseOver="hilite(13041)" onMouseOut="lolite()" onClick="logVariable('questionfromid')" href="../../../_variables/questionfromid.html">$questionfromid</a> != '0') {
<a name="l533"><span class="linenum"> 533</span></a>  
<a name="l534"><span class="linenum"> 534</span></a>              foreach (<a class="var it11519" onMouseOver="hilite(11519)" onMouseOut="lolite()" onClick="logVariable('possibledatasets')" href="../../../_variables/possibledatasets.html">$possibledatasets</a> as <a class="var it11894" onMouseOver="hilite(11894)" onMouseOut="lolite()" onClick="logVariable('datasetname')" href="../../../_variables/datasetname.html">$datasetname</a>) {
<a name="l535"><span class="linenum"> 535</span></a>                  if (!isset(<a class="var it11895" onMouseOver="hilite(11895)" onMouseOut="lolite()" onClick="logVariable('datasets')" href="../../../_variables/datasets.html">$datasets</a>[<a class="var it11894" onMouseOver="hilite(11894)" onMouseOut="lolite()" onClick="logVariable('datasetname')" href="../../../_variables/datasetname.html">$datasetname</a>])) {
<a name="l536"><span class="linenum"> 536</span></a>                      <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>, <a class="var it569" onMouseOver="hilite(569)" onMouseOut="lolite()" onClick="logVariable('selected')" href="../../../_variables/selected.html">$selected</a>) =
<a name="l537"><span class="linenum"> 537</span></a>                          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dataset_options')" href="../../../_functions/dataset_options.html" onMouseOver="funcPopup(event,'dataset_options')">dataset_options</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>, <a class="var it11894" onMouseOver="hilite(11894)" onMouseOut="lolite()" onClick="logVariable('datasetname')" href="../../../_variables/datasetname.html">$datasetname</a>, false);
<a name="l538"><span class="linenum"> 538</span></a>                      <a class="var it11895" onMouseOver="hilite(11895)" onMouseOut="lolite()" onClick="logVariable('datasets')" href="../../../_variables/datasets.html">$datasets</a>[<a class="var it11894" onMouseOver="hilite(11894)" onMouseOut="lolite()" onClick="logVariable('datasetname')" href="../../../_variables/datasetname.html">$datasetname</a>] = '';
<a name="l539"><span class="linenum"> 539</span></a>                      <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('dataset')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/dataset.html">dataset</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] = <a class="var it569" onMouseOver="hilite(569)" onMouseOut="lolite()" onClick="logVariable('selected')" href="../../../_variables/selected.html">$selected</a>;
<a name="l540"><span class="linenum"> 540</span></a>                      <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>++;
<a name="l541"><span class="linenum"> 541</span></a>                  }
<a name="l542"><span class="linenum"> 542</span></a>              }
<a name="l543"><span class="linenum"> 543</span></a>          }
<a name="l544"><span class="linenum"> 544</span></a>          return <a class="var it11895" onMouseOver="hilite(11895)" onMouseOut="lolite()" onClick="logVariable('datasets')" href="../../../_variables/datasets.html">$datasets</a>;
<a name="l545"><span class="linenum"> 545</span></a>      }
<a name="l546"><span class="linenum"> 546</span></a>      public function <a class="function" onClick="logFunction('addnamecategory')" href="../../../_functions/addnamecategory.html" onMouseOver="funcPopup(event,'addnamecategory')">addnamecategory</a>(&amp;<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>) {
<a name="l547"><span class="linenum"> 547</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l548"><span class="linenum"> 548</span></a>          <a class="var it13042" onMouseOver="hilite(13042)" onMouseOut="lolite()" onClick="logVariable('categorydatasetdefs')" href="../../../_variables/categorydatasetdefs.html">$categorydatasetdefs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(
<a name="l549"><span class="linenum"> 549</span></a>              &quot;SELECT  a.*
<a name="l550"><span class="linenum"> 550</span></a>                 FROM {question_datasets} b, {question_dataset_definitions} a
<a name="l551"><span class="linenum"> 551</span></a>                WHERE a.id = b.datasetdefinition
<a name="l552"><span class="linenum"> 552</span></a>                  AND a.type = '1'
<a name="l553"><span class="linenum"> 553</span></a>                  AND a.category != 0
<a name="l554"><span class="linenum"> 554</span></a>                  AND b.question = ?
<a name="l555"><span class="linenum"> 555</span></a>             ORDER BY a.name &quot;, array(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l556"><span class="linenum"> 556</span></a>          <a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('questionname')" href="../../../_variables/questionname.html">$questionname</a> = <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('name')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>;
<a name="l557"><span class="linenum"> 557</span></a>          <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>= array();
<a name="l558"><span class="linenum"> 558</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('~#\{([^[:space:]]*)#~', <a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('questionname')" href="../../../_variables/questionname.html">$questionname</a> , <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>)) {
<a name="l559"><span class="linenum"> 559</span></a>              <a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('questionname')" href="../../../_variables/questionname.html">$questionname</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>(<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[0], '', <a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('questionname')" href="../../../_variables/questionname.html">$questionname</a>);
<a name="l560"><span class="linenum"> 560</span></a>          };
<a name="l561"><span class="linenum"> 561</span></a>  
<a name="l562"><span class="linenum"> 562</span></a>          if (!empty(<a class="var it13042" onMouseOver="hilite(13042)" onMouseOut="lolite()" onClick="logVariable('categorydatasetdefs')" href="../../../_variables/categorydatasetdefs.html">$categorydatasetdefs</a>)) {
<a name="l563"><span class="linenum"> 563</span></a>  <span class="comment">            // There is at least one with the same name.</span>
<a name="l564"><span class="linenum"> 564</span></a>              <a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('questionname')" href="../../../_variables/questionname.html">$questionname</a> = '#' . <a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('questionname')" href="../../../_variables/questionname.html">$questionname</a>;
<a name="l565"><span class="linenum"> 565</span></a>              foreach (<a class="var it13042" onMouseOver="hilite(13042)" onMouseOut="lolite()" onClick="logVariable('categorydatasetdefs')" href="../../../_variables/categorydatasetdefs.html">$categorydatasetdefs</a> as <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>) {
<a name="l566"><span class="linenum"> 566</span></a>                  if (<a class="function" onClick="logFunction('strlen')" href="../../../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('name')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>) + <a class="function" onClick="logFunction('strlen')" href="../../../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('questionname')" href="../../../_variables/questionname.html">$questionname</a>) &lt; 250) {
<a name="l567"><span class="linenum"> 567</span></a>                      <a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('questionname')" href="../../../_variables/questionname.html">$questionname</a> = '{' . <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('name')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a> . '}' . <a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('questionname')" href="../../../_variables/questionname.html">$questionname</a>;
<a name="l568"><span class="linenum"> 568</span></a>                  }
<a name="l569"><span class="linenum"> 569</span></a>              }
<a name="l570"><span class="linenum"> 570</span></a>              <a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('questionname')" href="../../../_variables/questionname.html">$questionname</a> = '#' . <a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('questionname')" href="../../../_variables/questionname.html">$questionname</a>;
<a name="l571"><span class="linenum"> 571</span></a>          }
<a name="l572"><span class="linenum"> 572</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('question', 'name', <a class="var it546" onMouseOver="hilite(546)" onMouseOut="lolite()" onClick="logVariable('questionname')" href="../../../_variables/questionname.html">$questionname</a>, array('id' =&gt; <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l573"><span class="linenum"> 573</span></a>      }
<a name="l574"><span class="linenum"> 574</span></a>  
<a name="l575"><span class="linenum"> 575</span></a>      <span class="comment">/**</span>
<a name="l576"><span class="linenum"> 576</span></a>  <span class="comment">     * this version save the available data at the different steps of the question editing process</span>
<a name="l577"><span class="linenum"> 577</span></a>  <span class="comment">     * without using global $SESSION as storage between steps</span>
<a name="l578"><span class="linenum"> 578</span></a>  <span class="comment">     * at the first step $wizardnow = 'question'</span>
<a name="l579"><span class="linenum"> 579</span></a>  <span class="comment">     *  when creating a new question</span>
<a name="l580"><span class="linenum"> 580</span></a>  <span class="comment">     *  when modifying a question</span>
<a name="l581"><span class="linenum"> 581</span></a>  <span class="comment">     *  when copying as a new question</span>
<a name="l582"><span class="linenum"> 582</span></a>  <span class="comment">     *  the general parameters and answers are saved using parent::save_question</span>
<a name="l583"><span class="linenum"> 583</span></a>  <span class="comment">     *  then the datasets are prepared and saved</span>
<a name="l584"><span class="linenum"> 584</span></a>  <span class="comment">     * at the second step $wizardnow = 'datasetdefinitions'</span>
<a name="l585"><span class="linenum"> 585</span></a>  <span class="comment">     *  the datadefs final type are defined as private, category or not a datadef</span>
<a name="l586"><span class="linenum"> 586</span></a>  <span class="comment">     * at the third step $wizardnow = 'datasetitems'</span>
<a name="l587"><span class="linenum"> 587</span></a>  <span class="comment">     *  the datadefs parameters and the data items are created or defined</span>
<a name="l588"><span class="linenum"> 588</span></a>  <span class="comment">     *</span>
<a name="l589"><span class="linenum"> 589</span></a>  <span class="comment">     * @param object question</span>
<a name="l590"><span class="linenum"> 590</span></a>  <span class="comment">     * @param object $form</span>
<a name="l591"><span class="linenum"> 591</span></a>  <span class="comment">     * @param int $course</span>
<a name="l592"><span class="linenum"> 592</span></a>  <span class="comment">     * @param PARAM_ALPHA $wizardnow should be added as we are coming from question2.php</span>
<a name="l593"><span class="linenum"> 593</span></a>  <span class="comment">     */</span>
<a name="l594"><span class="linenum"> 594</span></a>      public function <a class="function" onClick="logFunction('save_question')" href="../../../_functions/save_question.html" onMouseOver="funcPopup(event,'save_question')">save_question</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>, <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>) {
<a name="l595"><span class="linenum"> 595</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l596"><span class="linenum"> 596</span></a>  
<a name="l597"><span class="linenum"> 597</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('wizardpagesnumber')" href="../../../_functions/wizardpagesnumber.html" onMouseOver="funcPopup(event,'wizardpagesnumber')">wizardpagesnumber</a>() == 1 || <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('qtype')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/qtype.html">qtype</a> == 'calculatedsimple') {
<a name="l598"><span class="linenum"> 598</span></a>              <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a> = parent::<a class="function" onClick="logFunction('save_question')" href="../../../_functions/save_question.html" onMouseOver="funcPopup(event,'save_question')">save_question</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>, <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>);
<a name="l599"><span class="linenum"> 599</span></a>              return <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>;
<a name="l600"><span class="linenum"> 600</span></a>          }
<a name="l601"><span class="linenum"> 601</span></a>  
<a name="l602"><span class="linenum"> 602</span></a>          <a class="var it5932" onMouseOver="hilite(5932)" onMouseOut="lolite()" onClick="logVariable('wizardnow')" href="../../../_variables/wizardnow.html">$wizardnow</a> =  <a class="function" onClick="logFunction('optional_param')" href="../../../_functions/optional_param.html" onMouseOver="funcPopup(event,'optional_param')">optional_param</a>('wizardnow', '', <a class="constant" onClick="logConstant('PARAM_ALPHA')" href="../../../_constants/PARAM_ALPHA.html" onMouseOver="constPopup(event,'PARAM_ALPHA')">PARAM_ALPHA</a>);
<a name="l603"><span class="linenum"> 603</span></a>          <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../../_variables/id.html">$id</a> = <a class="function" onClick="logFunction('optional_param')" href="../../../_functions/optional_param.html" onMouseOver="funcPopup(event,'optional_param')">optional_param</a>('id', 0, <a class="constant" onClick="logConstant('PARAM_INT')" href="../../../_constants/PARAM_INT.html" onMouseOver="constPopup(event,'PARAM_INT')">PARAM_INT</a>); <span class="comment">// Question id.</span>
<a name="l604"><span class="linenum"> 604</span></a>  <span class="comment">        // In case 'question':</span>
<a name="l605"><span class="linenum"> 605</span></a>  <span class="comment">        // For a new question $form-&gt;id is empty</span>
<a name="l606"><span class="linenum"> 606</span></a>  <span class="comment">        // when saving as new question.</span>
<a name="l607"><span class="linenum"> 607</span></a>  <span class="comment">        // The $question-&gt;id = 0, $form is $data from question2.php</span>
<a name="l608"><span class="linenum"> 608</span></a>  <span class="comment">        // and $data-&gt;makecopy is defined as $data-&gt;id is the initial question id.</span>
<a name="l609"><span class="linenum"> 609</span></a>  <span class="comment">        // Edit case. If it is a new question we don't necessarily need to</span>
<a name="l610"><span class="linenum"> 610</span></a>  <span class="comment">        // return a valid question object.</span>
<a name="l611"><span class="linenum"> 611</span></a>  
<a name="l612"><span class="linenum"> 612</span></a>  <span class="comment">        // See where we're coming from.</span>
<a name="l613"><span class="linenum"> 613</span></a>          switch(<a class="var it5932" onMouseOver="hilite(5932)" onMouseOut="lolite()" onClick="logVariable('wizardnow')" href="../../../_variables/wizardnow.html">$wizardnow</a>) {
<a name="l614"><span class="linenum"> 614</span></a>              case '' :
<a name="l615"><span class="linenum"> 615</span></a>              case 'question': // Coming from the first page, creating the second.
<a name="l616"><span class="linenum"> 616</span></a>                  if (empty(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('id')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>)) { // or a new question <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('id')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a> is empty.
<a name="l617"><span class="linenum"> 617</span></a>                      <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a> = parent::<a class="function" onClick="logFunction('save_question')" href="../../../_functions/save_question.html" onMouseOver="funcPopup(event,'save_question')">save_question</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>, <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>);
<a name="l618"><span class="linenum"> 618</span></a>  <span class="comment">                    // Prepare the datasets using default $questionfromid.</span>
<a name="l619"><span class="linenum"> 619</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('preparedatasets')" href="../../../_functions/preparedatasets.html" onMouseOver="funcPopup(event,'preparedatasets')">preparedatasets</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>);
<a name="l620"><span class="linenum"> 620</span></a>                      <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('id')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a> = <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l621"><span class="linenum"> 621</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('save_dataset_definitions')" href="../../../_functions/save_dataset_definitions.html" onMouseOver="funcPopup(event,'save_dataset_definitions')">save_dataset_definitions</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>);
<a name="l622"><span class="linenum"> 622</span></a>                      if (isset(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('synchronize')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/synchronize.html">synchronize</a>) &amp;&amp; <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('synchronize')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/synchronize.html">synchronize</a> == 2) {
<a name="l623"><span class="linenum"> 623</span></a>                          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('addnamecategory')" href="../../../_functions/addnamecategory.html" onMouseOver="funcPopup(event,'addnamecategory')">addnamecategory</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>);
<a name="l624"><span class="linenum"> 624</span></a>                      }
<a name="l625"><span class="linenum"> 625</span></a>                  } else if (!empty(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('makecopy')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/makecopy.html">makecopy</a>)) {
<a name="l626"><span class="linenum"> 626</span></a>                      <a class="var it13041" onMouseOver="hilite(13041)" onMouseOut="lolite()" onClick="logVariable('questionfromid')" href="../../../_variables/questionfromid.html">$questionfromid</a> =  <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('id')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l627"><span class="linenum"> 627</span></a>                      <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a> = parent::<a class="function" onClick="logFunction('save_question')" href="../../../_functions/save_question.html" onMouseOver="funcPopup(event,'save_question')">save_question</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>, <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>);
<a name="l628"><span class="linenum"> 628</span></a>  <span class="comment">                    // Prepare the datasets.</span>
<a name="l629"><span class="linenum"> 629</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('preparedatasets')" href="../../../_functions/preparedatasets.html" onMouseOver="funcPopup(event,'preparedatasets')">preparedatasets</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>, <a class="var it13041" onMouseOver="hilite(13041)" onMouseOut="lolite()" onClick="logVariable('questionfromid')" href="../../../_variables/questionfromid.html">$questionfromid</a>);
<a name="l630"><span class="linenum"> 630</span></a>                      <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('id')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a> = <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l631"><span class="linenum"> 631</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('save_as_new_dataset_definitions')" href="../../../_functions/save_as_new_dataset_definitions.html" onMouseOver="funcPopup(event,'save_as_new_dataset_definitions')">save_as_new_dataset_definitions</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>, <a class="var it13041" onMouseOver="hilite(13041)" onMouseOut="lolite()" onClick="logVariable('questionfromid')" href="../../../_variables/questionfromid.html">$questionfromid</a>);
<a name="l632"><span class="linenum"> 632</span></a>                      if (isset(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('synchronize')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/synchronize.html">synchronize</a>) &amp;&amp; <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('synchronize')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/synchronize.html">synchronize</a> == 2) {
<a name="l633"><span class="linenum"> 633</span></a>                          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('addnamecategory')" href="../../../_functions/addnamecategory.html" onMouseOver="funcPopup(event,'addnamecategory')">addnamecategory</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>);
<a name="l634"><span class="linenum"> 634</span></a>                      }
<a name="l635"><span class="linenum"> 635</span></a>                  } else {
<a name="l636"><span class="linenum"> 636</span></a>  <span class="comment">                    // Editing a question.</span>
<a name="l637"><span class="linenum"> 637</span></a>                      <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a> = parent::<a class="function" onClick="logFunction('save_question')" href="../../../_functions/save_question.html" onMouseOver="funcPopup(event,'save_question')">save_question</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>, <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>);
<a name="l638"><span class="linenum"> 638</span></a>  <span class="comment">                    // Prepare the datasets.</span>
<a name="l639"><span class="linenum"> 639</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('preparedatasets')" href="../../../_functions/preparedatasets.html" onMouseOver="funcPopup(event,'preparedatasets')">preparedatasets</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>, <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>);
<a name="l640"><span class="linenum"> 640</span></a>                      <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('id')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a> = <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l641"><span class="linenum"> 641</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('save_dataset_definitions')" href="../../../_functions/save_dataset_definitions.html" onMouseOver="funcPopup(event,'save_dataset_definitions')">save_dataset_definitions</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>);
<a name="l642"><span class="linenum"> 642</span></a>                      if (isset(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('synchronize')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/synchronize.html">synchronize</a>) &amp;&amp; <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('synchronize')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/synchronize.html">synchronize</a> == 2) {
<a name="l643"><span class="linenum"> 643</span></a>                          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('addnamecategory')" href="../../../_functions/addnamecategory.html" onMouseOver="funcPopup(event,'addnamecategory')">addnamecategory</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>);
<a name="l644"><span class="linenum"> 644</span></a>                      }
<a name="l645"><span class="linenum"> 645</span></a>                  }
<a name="l646"><span class="linenum"> 646</span></a>                  break;
<a name="l647"><span class="linenum"> 647</span></a>              case 'datasetdefinitions':
<a name="l648"><span class="linenum"> 648</span></a>  <span class="comment">                // Calculated options.</span>
<a name="l649"><span class="linenum"> 649</span></a>  <span class="comment">                // It cannot go here without having done the first page,</span>
<a name="l650"><span class="linenum"> 650</span></a>  <span class="comment">                // so the question_calculated_options should exist.</span>
<a name="l651"><span class="linenum"> 651</span></a>  <span class="comment">                // We only need to update the synchronize field.</span>
<a name="l652"><span class="linenum"> 652</span></a>                  if (isset(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('synchronize')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/synchronize.html">synchronize</a>)) {
<a name="l653"><span class="linenum"> 653</span></a>                      <a class="var it13044" onMouseOver="hilite(13044)" onMouseOut="lolite()" onClick="logVariable('optionssynchronize')" href="../../../_variables/optionssynchronize.html">$optionssynchronize</a> = <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('synchronize')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/synchronize.html">synchronize</a>;
<a name="l654"><span class="linenum"> 654</span></a>                  } else {
<a name="l655"><span class="linenum"> 655</span></a>                      <a class="var it13044" onMouseOver="hilite(13044)" onMouseOut="lolite()" onClick="logVariable('optionssynchronize')" href="../../../_variables/optionssynchronize.html">$optionssynchronize</a> = 0;
<a name="l656"><span class="linenum"> 656</span></a>                  }
<a name="l657"><span class="linenum"> 657</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('question_calculated_options', 'synchronize', <a class="var it13044" onMouseOver="hilite(13044)" onMouseOut="lolite()" onClick="logVariable('optionssynchronize')" href="../../../_variables/optionssynchronize.html">$optionssynchronize</a>,
<a name="l658"><span class="linenum"> 658</span></a>                          array('question' =&gt; <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l659"><span class="linenum"> 659</span></a>                  if (isset(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('synchronize')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/synchronize.html">synchronize</a>) &amp;&amp; <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('synchronize')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/synchronize.html">synchronize</a> == 2) {
<a name="l660"><span class="linenum"> 660</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('addnamecategory')" href="../../../_functions/addnamecategory.html" onMouseOver="funcPopup(event,'addnamecategory')">addnamecategory</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>);
<a name="l661"><span class="linenum"> 661</span></a>                  }
<a name="l662"><span class="linenum"> 662</span></a>  
<a name="l663"><span class="linenum"> 663</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('save_dataset_definitions')" href="../../../_functions/save_dataset_definitions.html" onMouseOver="funcPopup(event,'save_dataset_definitions')">save_dataset_definitions</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>);
<a name="l664"><span class="linenum"> 664</span></a>                  break;
<a name="l665"><span class="linenum"> 665</span></a>              case 'datasetitems':
<a name="l666"><span class="linenum"> 666</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('save_dataset_items')" href="../../../_functions/save_dataset_items.html" onMouseOver="funcPopup(event,'save_dataset_items')">save_dataset_items</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>, <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>);
<a name="l667"><span class="linenum"> 667</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('save_question_calculated')" href="../../../_functions/save_question_calculated.html" onMouseOver="funcPopup(event,'save_question_calculated')">save_question_calculated</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>, <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>);
<a name="l668"><span class="linenum"> 668</span></a>                  break;
<a name="l669"><span class="linenum"> 669</span></a>              default:
<a name="l670"><span class="linenum"> 670</span></a>                  <a class="function" onClick="logFunction('print_error')" href="../../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('invalidwizardpage', 'question');
<a name="l671"><span class="linenum"> 671</span></a>                  break;
<a name="l672"><span class="linenum"> 672</span></a>          }
<a name="l673"><span class="linenum"> 673</span></a>          return <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>;
<a name="l674"><span class="linenum"> 674</span></a>      }
<a name="l675"><span class="linenum"> 675</span></a>  
<a name="l676"><span class="linenum"> 676</span></a>      public function <a class="function" onClick="logFunction('delete_question')" href="../../../_functions/delete_question.html" onMouseOver="funcPopup(event,'delete_question')">delete_question</a>(<a class="var it530" onMouseOver="hilite(530)" onMouseOut="lolite()" onClick="logVariable('questionid')" href="../../../_variables/questionid.html">$questionid</a>, <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../_variables/contextid.html">$contextid</a>) {
<a name="l677"><span class="linenum"> 677</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l678"><span class="linenum"> 678</span></a>  
<a name="l679"><span class="linenum"> 679</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('question_calculated', array('question' =&gt; <a class="var it530" onMouseOver="hilite(530)" onMouseOut="lolite()" onClick="logVariable('questionid')" href="../../../_variables/questionid.html">$questionid</a>));
<a name="l680"><span class="linenum"> 680</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('question_calculated_options', array('question' =&gt; <a class="var it530" onMouseOver="hilite(530)" onMouseOut="lolite()" onClick="logVariable('questionid')" href="../../../_variables/questionid.html">$questionid</a>));
<a name="l681"><span class="linenum"> 681</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('question_numerical_units', array('question' =&gt; <a class="var it530" onMouseOver="hilite(530)" onMouseOut="lolite()" onClick="logVariable('questionid')" href="../../../_variables/questionid.html">$questionid</a>));
<a name="l682"><span class="linenum"> 682</span></a>          if (<a class="var it11895" onMouseOver="hilite(11895)" onMouseOut="lolite()" onClick="logVariable('datasets')" href="../../../_variables/datasets.html">$datasets</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('question_datasets', array('question' =&gt; <a class="var it530" onMouseOver="hilite(530)" onMouseOut="lolite()" onClick="logVariable('questionid')" href="../../../_variables/questionid.html">$questionid</a>))) {
<a name="l683"><span class="linenum"> 683</span></a>              foreach (<a class="var it11895" onMouseOver="hilite(11895)" onMouseOut="lolite()" onClick="logVariable('datasets')" href="../../../_variables/datasets.html">$datasets</a> as <a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>) {
<a name="l684"><span class="linenum"> 684</span></a>                  if (!<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_select')" href="../../../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>('question_datasets',
<a name="l685"><span class="linenum"> 685</span></a>                          &quot;question != ? AND datasetdefinition = ? &quot;,
<a name="l686"><span class="linenum"> 686</span></a>                          array(<a class="var it530" onMouseOver="hilite(530)" onMouseOut="lolite()" onClick="logVariable('questionid')" href="../../../_variables/questionid.html">$questionid</a>, <a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>-&gt;<a onClick="logVariable('datasetdefinition')" class="var it44018" onMouseOver="hilite(44018)" onMouseOut="lolite()" href="../../../_variables/datasetdefinition.html">datasetdefinition</a>))) {
<a name="l687"><span class="linenum"> 687</span></a>                      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('question_dataset_definitions',
<a name="l688"><span class="linenum"> 688</span></a>                              array('id' =&gt; <a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>-&gt;<a onClick="logVariable('datasetdefinition')" class="var it44018" onMouseOver="hilite(44018)" onMouseOut="lolite()" href="../../../_variables/datasetdefinition.html">datasetdefinition</a>));
<a name="l689"><span class="linenum"> 689</span></a>                      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('question_dataset_items',
<a name="l690"><span class="linenum"> 690</span></a>                              array('definition' =&gt; <a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>-&gt;<a onClick="logVariable('datasetdefinition')" class="var it44018" onMouseOver="hilite(44018)" onMouseOut="lolite()" href="../../../_variables/datasetdefinition.html">datasetdefinition</a>));
<a name="l691"><span class="linenum"> 691</span></a>                  }
<a name="l692"><span class="linenum"> 692</span></a>              }
<a name="l693"><span class="linenum"> 693</span></a>          }
<a name="l694"><span class="linenum"> 694</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('question_datasets', array('question' =&gt; <a class="var it530" onMouseOver="hilite(530)" onMouseOut="lolite()" onClick="logVariable('questionid')" href="../../../_variables/questionid.html">$questionid</a>));
<a name="l695"><span class="linenum"> 695</span></a>  
<a name="l696"><span class="linenum"> 696</span></a>          parent::<a class="function" onClick="logFunction('delete_question')" href="../../../_functions/delete_question.html" onMouseOver="funcPopup(event,'delete_question')">delete_question</a>(<a class="var it530" onMouseOver="hilite(530)" onMouseOut="lolite()" onClick="logVariable('questionid')" href="../../../_variables/questionid.html">$questionid</a>, <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../_variables/contextid.html">$contextid</a>);
<a name="l697"><span class="linenum"> 697</span></a>      }
<a name="l698"><span class="linenum"> 698</span></a>  
<a name="l699"><span class="linenum"> 699</span></a>      public function <a class="function" onClick="logFunction('get_random_guess_score')" href="../../../_functions/get_random_guess_score.html" onMouseOver="funcPopup(event,'get_random_guess_score')">get_random_guess_score</a>(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('questiondata')" href="../../../_variables/questiondata.html">$questiondata</a>) {
<a name="l700"><span class="linenum"> 700</span></a>          foreach (<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('questiondata')" href="../../../_variables/questiondata.html">$questiondata</a>-&gt;<a onClick="logVariable('options')" class="var it43218" onMouseOver="hilite(43218)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;answers as <a class="var it186" onMouseOver="hilite(186)" onMouseOut="lolite()" onClick="logVariable('aid')" href="../../../_variables/aid.html">$aid</a> =&gt; <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>) {
<a name="l701"><span class="linenum"> 701</span></a>              if ('*' == <a class="phpfunction" onClick="logFunction('trim')" href="../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('answer')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a>)) {
<a name="l702"><span class="linenum"> 702</span></a>                  return <a class="phpfunction" onClick="logFunction('max')" href="../../../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">max</a>(<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('fraction')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/fraction.html">fraction</a> - <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('questiondata')" href="../../../_variables/questiondata.html">$questiondata</a>-&gt;<a onClick="logVariable('options')" class="var it43218" onMouseOver="hilite(43218)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;unitpenalty, 0);
<a name="l703"><span class="linenum"> 703</span></a>              }
<a name="l704"><span class="linenum"> 704</span></a>          }
<a name="l705"><span class="linenum"> 705</span></a>          return 0;
<a name="l706"><span class="linenum"> 706</span></a>      }
<a name="l707"><span class="linenum"> 707</span></a>  
<a name="l708"><span class="linenum"> 708</span></a>      public function <a class="function" onClick="logFunction('supports_dataset_item_generation')" href="../../../_functions/supports_dataset_item_generation.html" onMouseOver="funcPopup(event,'supports_dataset_item_generation')">supports_dataset_item_generation</a>() {
<a name="l709"><span class="linenum"> 709</span></a>  <span class="comment">        // Calculated support generation of randomly distributed number data.</span>
<a name="l710"><span class="linenum"> 710</span></a>          return true;
<a name="l711"><span class="linenum"> 711</span></a>      }
<a name="l712"><span class="linenum"> 712</span></a>  
<a name="l713"><span class="linenum"> 713</span></a>      public function <a class="function" onClick="logFunction('custom_generator_tools_part')" href="../../../_functions/custom_generator_tools_part.html" onMouseOver="funcPopup(event,'custom_generator_tools_part')">custom_generator_tools_part</a>(<a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../../_variables/mform.html">$mform</a>, <a class="var it1677" onMouseOver="hilite(1677)" onMouseOut="lolite()" onClick="logVariable('idx')" href="../../../_variables/idx.html">$idx</a>, <a class="var it162" onMouseOver="hilite(162)" onMouseOut="lolite()" onClick="logVariable('j')" href="../../../_variables/j.html">$j</a>) {
<a name="l714"><span class="linenum"> 714</span></a>  
<a name="l715"><span class="linenum"> 715</span></a>          <a class="var it13045" onMouseOver="hilite(13045)" onMouseOut="lolite()" onClick="logVariable('minmaxgrp')" href="../../../_variables/minmaxgrp.html">$minmaxgrp</a> = array();
<a name="l716"><span class="linenum"> 716</span></a>          <a class="var it13045" onMouseOver="hilite(13045)" onMouseOut="lolite()" onClick="logVariable('minmaxgrp')" href="../../../_variables/minmaxgrp.html">$minmaxgrp</a>[] = <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('createElement')" href="../../../_functions/createelement.html" onMouseOver="funcPopup(event,'createelement')">createElement</a>('text', &quot;calcmin[{<a class="var it1677" onMouseOver="hilite(1677)" onMouseOut="lolite()" onClick="logVariable('idx')" href="../../../_variables/idx.html">$idx</a>}]&quot;,
<a name="l717"><span class="linenum"> 717</span></a>                  <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('calcmin', 'qtype_calculated'));
<a name="l718"><span class="linenum"> 718</span></a>          <a class="var it13045" onMouseOver="hilite(13045)" onMouseOut="lolite()" onClick="logVariable('minmaxgrp')" href="../../../_variables/minmaxgrp.html">$minmaxgrp</a>[] = <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('createElement')" href="../../../_functions/createelement.html" onMouseOver="funcPopup(event,'createelement')">createElement</a>('text', &quot;calcmax[{<a class="var it1677" onMouseOver="hilite(1677)" onMouseOut="lolite()" onClick="logVariable('idx')" href="../../../_variables/idx.html">$idx</a>}]&quot;,
<a name="l719"><span class="linenum"> 719</span></a>                  <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('calcmax', 'qtype_calculated'));
<a name="l720"><span class="linenum"> 720</span></a>          <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('addGroup')" href="../../../_functions/addgroup.html" onMouseOver="funcPopup(event,'addgroup')">addGroup</a>(<a class="var it13045" onMouseOver="hilite(13045)" onMouseOut="lolite()" onClick="logVariable('minmaxgrp')" href="../../../_variables/minmaxgrp.html">$minmaxgrp</a>, 'minmaxgrp',
<a name="l721"><span class="linenum"> 721</span></a>                  <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('minmax', 'qtype_calculated'), ' - ', false);
<a name="l722"><span class="linenum"> 722</span></a>          <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../../_variables/mform.html">$mform</a>-&gt;<a class="phpfunction" onClick="logFunction('setType')" href="../../../_functions/settype.html" onMouseOver="phpfuncPopup(event,'settype')">setType</a>(&quot;calcmin[{<a class="var it1677" onMouseOver="hilite(1677)" onMouseOut="lolite()" onClick="logVariable('idx')" href="../../../_variables/idx.html">$idx</a>}]&quot;, <a class="constant" onClick="logConstant('PARAM_FLOAT')" href="../../../_constants/PARAM_FLOAT.html" onMouseOver="constPopup(event,'PARAM_FLOAT')">PARAM_FLOAT</a>);
<a name="l723"><span class="linenum"> 723</span></a>          <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../../_variables/mform.html">$mform</a>-&gt;<a class="phpfunction" onClick="logFunction('setType')" href="../../../_functions/settype.html" onMouseOver="phpfuncPopup(event,'settype')">setType</a>(&quot;calcmax[{<a class="var it1677" onMouseOver="hilite(1677)" onMouseOut="lolite()" onClick="logVariable('idx')" href="../../../_variables/idx.html">$idx</a>}]&quot;, <a class="constant" onClick="logConstant('PARAM_FLOAT')" href="../../../_constants/PARAM_FLOAT.html" onMouseOver="constPopup(event,'PARAM_FLOAT')">PARAM_FLOAT</a>);
<a name="l724"><span class="linenum"> 724</span></a>  
<a name="l725"><span class="linenum"> 725</span></a>          <a class="var it13046" onMouseOver="hilite(13046)" onMouseOut="lolite()" onClick="logVariable('precisionoptions')" href="../../../_variables/precisionoptions.html">$precisionoptions</a> = <a class="phpfunction" onClick="logFunction('range')" href="../../../_functions/range.html" onMouseOver="phpfuncPopup(event,'range')">range</a>(0, 10);
<a name="l726"><span class="linenum"> 726</span></a>          <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('addElement')" href="../../../_functions/addelement.html" onMouseOver="funcPopup(event,'addelement')">addElement</a>('select', &quot;calclength[{<a class="var it1677" onMouseOver="hilite(1677)" onMouseOut="lolite()" onClick="logVariable('idx')" href="../../../_variables/idx.html">$idx</a>}]&quot;,
<a name="l727"><span class="linenum"> 727</span></a>                  <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('calclength', 'qtype_calculated'), <a class="var it13046" onMouseOver="hilite(13046)" onMouseOut="lolite()" onClick="logVariable('precisionoptions')" href="../../../_variables/precisionoptions.html">$precisionoptions</a>);
<a name="l728"><span class="linenum"> 728</span></a>  
<a name="l729"><span class="linenum"> 729</span></a>          <a class="var it13047" onMouseOver="hilite(13047)" onMouseOut="lolite()" onClick="logVariable('distriboptions')" href="../../../_variables/distriboptions.html">$distriboptions</a> = array('uniform' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('uniform', 'qtype_calculated'),
<a name="l730"><span class="linenum"> 730</span></a>                  'loguniform' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('loguniform', 'qtype_calculated'));
<a name="l731"><span class="linenum"> 731</span></a>          <a class="var it219" onMouseOver="hilite(219)" onMouseOut="lolite()" onClick="logVariable('mform')" href="../../../_variables/mform.html">$mform</a>-&gt;<a class="function" onClick="logFunction('addElement')" href="../../../_functions/addelement.html" onMouseOver="funcPopup(event,'addelement')">addElement</a>('select', &quot;calcdistribution[{<a class="var it1677" onMouseOver="hilite(1677)" onMouseOut="lolite()" onClick="logVariable('idx')" href="../../../_variables/idx.html">$idx</a>}]&quot;,
<a name="l732"><span class="linenum"> 732</span></a>                  <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('calcdistribution', 'qtype_calculated'), <a class="var it13047" onMouseOver="hilite(13047)" onMouseOut="lolite()" onClick="logVariable('distriboptions')" href="../../../_variables/distriboptions.html">$distriboptions</a>);
<a name="l733"><span class="linenum"> 733</span></a>      }
<a name="l734"><span class="linenum"> 734</span></a>  
<a name="l735"><span class="linenum"> 735</span></a>      public function <a class="function" onClick="logFunction('custom_generator_set_data')" href="../../../_functions/custom_generator_set_data.html" onMouseOver="funcPopup(event,'custom_generator_set_data')">custom_generator_set_data</a>(<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>, <a class="var it466" onMouseOver="hilite(466)" onMouseOut="lolite()" onClick="logVariable('formdata')" href="../../../_variables/formdata.html">$formdata</a>) {
<a name="l736"><span class="linenum"> 736</span></a>          <a class="var it1677" onMouseOver="hilite(1677)" onMouseOut="lolite()" onClick="logVariable('idx')" href="../../../_variables/idx.html">$idx</a> = 1;
<a name="l737"><span class="linenum"> 737</span></a>          foreach (<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a> as <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>) {
<a name="l738"><span class="linenum"> 738</span></a>              if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('~^(uniform|loguniform):([^:]*):([^:]*):([0-9]*)$~',
<a name="l739"><span class="linenum"> 739</span></a>                      <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('options')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>, <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>)) {
<a name="l740"><span class="linenum"> 740</span></a>                  <a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a> = &quot;{<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('type')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/type.html">type</a>}-{<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('category')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>}-{<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('name')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>}&quot;;
<a name="l741"><span class="linenum"> 741</span></a>                  <a class="var it466" onMouseOver="hilite(466)" onMouseOut="lolite()" onClick="logVariable('formdata')" href="../../../_variables/formdata.html">$formdata</a>[&quot;calcdistribution[{<a class="var it1677" onMouseOver="hilite(1677)" onMouseOut="lolite()" onClick="logVariable('idx')" href="../../../_variables/idx.html">$idx</a>}]&quot;] = <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[1];
<a name="l742"><span class="linenum"> 742</span></a>                  <a class="var it466" onMouseOver="hilite(466)" onMouseOut="lolite()" onClick="logVariable('formdata')" href="../../../_variables/formdata.html">$formdata</a>[&quot;calcmin[{<a class="var it1677" onMouseOver="hilite(1677)" onMouseOut="lolite()" onClick="logVariable('idx')" href="../../../_variables/idx.html">$idx</a>}]&quot;] = <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[2];
<a name="l743"><span class="linenum"> 743</span></a>                  <a class="var it466" onMouseOver="hilite(466)" onMouseOut="lolite()" onClick="logVariable('formdata')" href="../../../_variables/formdata.html">$formdata</a>[&quot;calcmax[{<a class="var it1677" onMouseOver="hilite(1677)" onMouseOut="lolite()" onClick="logVariable('idx')" href="../../../_variables/idx.html">$idx</a>}]&quot;] = <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[3];
<a name="l744"><span class="linenum"> 744</span></a>                  <a class="var it466" onMouseOver="hilite(466)" onMouseOut="lolite()" onClick="logVariable('formdata')" href="../../../_variables/formdata.html">$formdata</a>[&quot;calclength[{<a class="var it1677" onMouseOver="hilite(1677)" onMouseOut="lolite()" onClick="logVariable('idx')" href="../../../_variables/idx.html">$idx</a>}]&quot;] = <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[4];
<a name="l745"><span class="linenum"> 745</span></a>              }
<a name="l746"><span class="linenum"> 746</span></a>              <a class="var it1677" onMouseOver="hilite(1677)" onMouseOut="lolite()" onClick="logVariable('idx')" href="../../../_variables/idx.html">$idx</a>++;
<a name="l747"><span class="linenum"> 747</span></a>          }
<a name="l748"><span class="linenum"> 748</span></a>          return <a class="var it466" onMouseOver="hilite(466)" onMouseOut="lolite()" onClick="logVariable('formdata')" href="../../../_variables/formdata.html">$formdata</a>;
<a name="l749"><span class="linenum"> 749</span></a>      }
<a name="l750"><span class="linenum"> 750</span></a>  
<a name="l751"><span class="linenum"> 751</span></a>      public function <a class="function" onClick="logFunction('custom_generator_tools')" href="../../../_functions/custom_generator_tools.html" onMouseOver="funcPopup(event,'custom_generator_tools')">custom_generator_tools</a>(<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>) {
<a name="l752"><span class="linenum"> 752</span></a>          global <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l753"><span class="linenum"> 753</span></a>          if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('~^(uniform|loguniform):([^:]*):([^:]*):([0-9]*)$~',
<a name="l754"><span class="linenum"> 754</span></a>                  <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('options')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>, <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>)) {
<a name="l755"><span class="linenum"> 755</span></a>              <a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a> = &quot;{<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('type')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/type.html">type</a>}-{<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('category')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>}-{<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('name')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>}&quot;;
<a name="l756"><span class="linenum"> 756</span></a>              for (<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../_variables/i.html">$i</a> = 0; <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../_variables/i.html">$i</a>&lt;10; ++<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../_variables/i.html">$i</a>) {
<a name="l757"><span class="linenum"> 757</span></a>                  <a class="var it13048" onMouseOver="hilite(13048)" onMouseOut="lolite()" onClick="logVariable('lengthoptions')" href="../../../_variables/lengthoptions.html">$lengthoptions</a>[<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../_variables/i.html">$i</a>] = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>((<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[1] == 'uniform'
<a name="l758"><span class="linenum"> 758</span></a>                      ? 'decimals'
<a name="l759"><span class="linenum"> 759</span></a>                      : 'significantfigures'), 'qtype_calculated', <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../_variables/i.html">$i</a>);
<a name="l760"><span class="linenum"> 760</span></a>              }
<a name="l761"><span class="linenum"> 761</span></a>              <a class="var it13049" onMouseOver="hilite(13049)" onMouseOut="lolite()" onClick="logVariable('menu1')" href="../../../_variables/menu1.html">$menu1</a> = <a class="class" onClick="logClass('html_writer')" href="../../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('label')" href="../../../_functions/label.html" onMouseOver="funcPopup(event,'label')">label</a>(<a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('lengthoption', 'qtype_calculated'),
<a name="l762"><span class="linenum"> 762</span></a>                  'menucalclength', false, array('class' =&gt; 'accesshide'));
<a name="l763"><span class="linenum"> 763</span></a>              <a class="var it13049" onMouseOver="hilite(13049)" onMouseOut="lolite()" onClick="logVariable('menu1')" href="../../../_variables/menu1.html">$menu1</a> .= <a class="class" onClick="logClass('html_writer')" href="../../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('select')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">select</a>(<a class="var it13048" onMouseOver="hilite(13048)" onMouseOut="lolite()" onClick="logVariable('lengthoptions')" href="../../../_variables/lengthoptions.html">$lengthoptions</a>, 'calclength[]', <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[4], null);
<a name="l764"><span class="linenum"> 764</span></a>  
<a name="l765"><span class="linenum"> 765</span></a>              <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a> = array('uniform' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('uniformbit', 'qtype_calculated'),
<a name="l766"><span class="linenum"> 766</span></a>                  'loguniform' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('loguniformbit', 'qtype_calculated'));
<a name="l767"><span class="linenum"> 767</span></a>              <a class="var it13050" onMouseOver="hilite(13050)" onMouseOut="lolite()" onClick="logVariable('menu2')" href="../../../_variables/menu2.html">$menu2</a> = <a class="class" onClick="logClass('html_writer')" href="../../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('label')" href="../../../_functions/label.html" onMouseOver="funcPopup(event,'label')">label</a>(<a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('distributionoption', 'qtype_calculated'),
<a name="l768"><span class="linenum"> 768</span></a>                  'menucalcdistribution', false, array('class' =&gt; 'accesshide'));
<a name="l769"><span class="linenum"> 769</span></a>              <a class="var it13050" onMouseOver="hilite(13050)" onMouseOut="lolite()" onClick="logVariable('menu2')" href="../../../_variables/menu2.html">$menu2</a> .= <a class="class" onClick="logClass('html_writer')" href="../../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('select')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">select</a>(<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>, 'calcdistribution[]', <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[1], null);
<a name="l770"><span class="linenum"> 770</span></a>              return '&lt;input type=&quot;submit&quot; onclick=&quot;'
<a name="l771"><span class="linenum"> 771</span></a>                  . &quot;getElementById('addform').regenerateddefid.value='{<a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a>}'; return true;&quot;
<a name="l772"><span class="linenum"> 772</span></a>                  .'&quot; value=&quot;'. <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('generatevalue', 'qtype_calculated') . '&quot;/&gt;&lt;br/&gt;'
<a name="l773"><span class="linenum"> 773</span></a>                  . '&lt;input type=&quot;text&quot; size=&quot;3&quot; name=&quot;calcmin[]&quot; '
<a name="l774"><span class="linenum"> 774</span></a>                  . &quot; value=\&quot;{<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[2]}\&quot;/&gt; &amp;amp; &lt;input name=\&quot;calcmax[]\&quot; &quot;
<a name="l775"><span class="linenum"> 775</span></a>                  . ' type=&quot;text&quot; size=&quot;3&quot; value=&quot;' . <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[3] .'&quot;/&gt; '
<a name="l776"><span class="linenum"> 776</span></a>                  . <a class="var it13049" onMouseOver="hilite(13049)" onMouseOut="lolite()" onClick="logVariable('menu1')" href="../../../_variables/menu1.html">$menu1</a> . '&lt;br/&gt;'
<a name="l777"><span class="linenum"> 777</span></a>                  . <a class="var it13050" onMouseOver="hilite(13050)" onMouseOut="lolite()" onClick="logVariable('menu2')" href="../../../_variables/menu2.html">$menu2</a>;
<a name="l778"><span class="linenum"> 778</span></a>          } else {
<a name="l779"><span class="linenum"> 779</span></a>              return '';
<a name="l780"><span class="linenum"> 780</span></a>          }
<a name="l781"><span class="linenum"> 781</span></a>      }
<a name="l782"><span class="linenum"> 782</span></a>  
<a name="l783"><span class="linenum"> 783</span></a>  
<a name="l784"><span class="linenum"> 784</span></a>      public function <a class="function" onClick="logFunction('update_dataset_options')" href="../../../_functions/update_dataset_options.html" onMouseOver="funcPopup(event,'update_dataset_options')">update_dataset_options</a>(<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>, <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>) {
<a name="l785"><span class="linenum"> 785</span></a>          global <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l786"><span class="linenum"> 786</span></a>  <span class="comment">        // Do we have information about new options ?</span>
<a name="l787"><span class="linenum"> 787</span></a>          if (empty(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('definition')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/definition.html">definition</a>) || empty(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('calcmin')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/calcmin.html">calcmin</a>)
<a name="l788"><span class="linenum"> 788</span></a>                  ||empty(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('calcmax')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/calcmax.html">calcmax</a>) || empty(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('calclength')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/calclength.html">calclength</a>)
<a name="l789"><span class="linenum"> 789</span></a>                  || empty(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('calcdistribution')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/calcdistribution.html">calcdistribution</a>)) {
<a name="l790"><span class="linenum"> 790</span></a>  <span class="comment">            // I guess not.</span>
<a name="l791"><span class="linenum"> 791</span></a>  
<a name="l792"><span class="linenum"> 792</span></a>          } else {
<a name="l793"><span class="linenum"> 793</span></a>  <span class="comment">            // Looks like we just could have some new information here.</span>
<a name="l794"><span class="linenum"> 794</span></a>              <a class="var it13055" onMouseOver="hilite(13055)" onMouseOut="lolite()" onClick="logVariable('uniquedefs')" href="../../../_variables/uniquedefs.html">$uniquedefs</a> = <a class="phpfunction" onClick="logFunction('array_values')" href="../../../_functions/array_values.html" onMouseOver="phpfuncPopup(event,'array_values')">array_values</a>(<a class="phpfunction" onClick="logFunction('array_unique')" href="../../../_functions/array_unique.html" onMouseOver="phpfuncPopup(event,'array_unique')">array_unique</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('definition')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/definition.html">definition</a>));
<a name="l795"><span class="linenum"> 795</span></a>              foreach (<a class="var it13055" onMouseOver="hilite(13055)" onMouseOut="lolite()" onClick="logVariable('uniquedefs')" href="../../../_variables/uniquedefs.html">$uniquedefs</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a> =&gt; <a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a>) {
<a name="l796"><span class="linenum"> 796</span></a>                  if (isset(<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>[<a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a>])
<a name="l797"><span class="linenum"> 797</span></a>                          &amp;&amp; <a class="phpfunction" onClick="logFunction('is_numeric')" href="../../../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('calcmin')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/calcmin.html">calcmin</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>+1])
<a name="l798"><span class="linenum"> 798</span></a>                          &amp;&amp; <a class="phpfunction" onClick="logFunction('is_numeric')" href="../../../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('calcmax')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/calcmax.html">calcmax</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>+1])
<a name="l799"><span class="linenum"> 799</span></a>                          &amp;&amp; <a class="phpfunction" onClick="logFunction('is_numeric')" href="../../../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('calclength')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/calclength.html">calclength</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>+1])) {
<a name="l800"><span class="linenum"> 800</span></a>                      switch     (<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('calcdistribution')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/calcdistribution.html">calcdistribution</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>+1]) {
<a name="l801"><span class="linenum"> 801</span></a>                          case 'uniform': case 'loguniform':
<a name="l802"><span class="linenum"> 802</span></a>                              <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>[<a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a>]-&gt;options =
<a name="l803"><span class="linenum"> 803</span></a>                                  <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('calcdistribution')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/calcdistribution.html">calcdistribution</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>+1] . ':'
<a name="l804"><span class="linenum"> 804</span></a>                                  . <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('calcmin')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/calcmin.html">calcmin</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>+1] . ':'
<a name="l805"><span class="linenum"> 805</span></a>                                  . <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('calcmax')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/calcmax.html">calcmax</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>+1] . ':'
<a name="l806"><span class="linenum"> 806</span></a>                                  . <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('calclength')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/calclength.html">calclength</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>+1];
<a name="l807"><span class="linenum"> 807</span></a>                              break;
<a name="l808"><span class="linenum"> 808</span></a>                          default:
<a name="l809"><span class="linenum"> 809</span></a>                              echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('notification')" href="../../../_functions/notification.html" onMouseOver="funcPopup(event,'notification')">notification</a>(
<a name="l810"><span class="linenum"> 810</span></a>                                      &quot;Unexpected distribution &quot;.<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('calcdistribution')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/calcdistribution.html">calcdistribution</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>+1]);
<a name="l811"><span class="linenum"> 811</span></a>                      }
<a name="l812"><span class="linenum"> 812</span></a>                  }
<a name="l813"><span class="linenum"> 813</span></a>              }
<a name="l814"><span class="linenum"> 814</span></a>          }
<a name="l815"><span class="linenum"> 815</span></a>  
<a name="l816"><span class="linenum"> 816</span></a>  <span class="comment">        // Look for empty options, on which we set default values.</span>
<a name="l817"><span class="linenum"> 817</span></a>          foreach (<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a> as <a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a> =&gt; <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>) {
<a name="l818"><span class="linenum"> 818</span></a>              if (empty(<a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('options')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>)) {
<a name="l819"><span class="linenum"> 819</span></a>                  <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>[<a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a>]-&gt;options = 'uniform:1.0:10.0:1';
<a name="l820"><span class="linenum"> 820</span></a>              }
<a name="l821"><span class="linenum"> 821</span></a>          }
<a name="l822"><span class="linenum"> 822</span></a>          return <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>;
<a name="l823"><span class="linenum"> 823</span></a>      }
<a name="l824"><span class="linenum"> 824</span></a>  
<a name="l825"><span class="linenum"> 825</span></a>      public function <a class="function" onClick="logFunction('save_question_calculated')" href="../../../_functions/save_question_calculated.html" onMouseOver="funcPopup(event,'save_question_calculated')">save_question_calculated</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>, <a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../../_variables/fromform.html">$fromform</a>) {
<a name="l826"><span class="linenum"> 826</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l827"><span class="linenum"> 827</span></a>  
<a name="l828"><span class="linenum"> 828</span></a>          foreach (<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('options')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;answers as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a> =&gt; <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>) {
<a name="l829"><span class="linenum"> 829</span></a>              if (<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('question_calculated', array('answer' =&gt; <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>))) {
<a name="l830"><span class="linenum"> 830</span></a>                  <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('tolerance')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../../_variables/tolerance.html">tolerance</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../../_variables/fromform.html">$fromform</a>-&gt;<a onClick="logVariable('tolerance')" class="var it43020" onMouseOver="hilite(43020)" onMouseOut="lolite()" href="../../../_variables/tolerance.html">tolerance</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>]);
<a name="l831"><span class="linenum"> 831</span></a>                  <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('tolerancetype')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../../_variables/tolerancetype.html">tolerancetype</a>  = <a class="phpfunction" onClick="logFunction('trim')" href="../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../../_variables/fromform.html">$fromform</a>-&gt;<a onClick="logVariable('tolerancetype')" class="var it43020" onMouseOver="hilite(43020)" onMouseOut="lolite()" href="../../../_variables/tolerancetype.html">tolerancetype</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>]);
<a name="l832"><span class="linenum"> 832</span></a>                  <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('correctanswerlength')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../../_variables/correctanswerlength.html">correctanswerlength</a>  = <a class="phpfunction" onClick="logFunction('trim')" href="../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../../_variables/fromform.html">$fromform</a>-&gt;<a onClick="logVariable('correctanswerlength')" class="var it43020" onMouseOver="hilite(43020)" onMouseOut="lolite()" href="../../../_variables/correctanswerlength.html">correctanswerlength</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>]);
<a name="l833"><span class="linenum"> 833</span></a>                  <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('correctanswerformat')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../../_variables/correctanswerformat.html">correctanswerformat</a>  = <a class="phpfunction" onClick="logFunction('trim')" href="../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../../_variables/fromform.html">$fromform</a>-&gt;<a onClick="logVariable('correctanswerformat')" class="var it43020" onMouseOver="hilite(43020)" onMouseOut="lolite()" href="../../../_variables/correctanswerformat.html">correctanswerformat</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>]);
<a name="l834"><span class="linenum"> 834</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('question_calculated', <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>);
<a name="l835"><span class="linenum"> 835</span></a>              }
<a name="l836"><span class="linenum"> 836</span></a>          }
<a name="l837"><span class="linenum"> 837</span></a>      }
<a name="l838"><span class="linenum"> 838</span></a>  
<a name="l839"><span class="linenum"> 839</span></a>      <span class="comment">/**</span>
<a name="l840"><span class="linenum"> 840</span></a>  <span class="comment">     * This function get the dataset items using id as unique parameter and return an</span>
<a name="l841"><span class="linenum"> 841</span></a>  <span class="comment">     * array with itemnumber as index sorted ascendant</span>
<a name="l842"><span class="linenum"> 842</span></a>  <span class="comment">     * If the multiple records with the same itemnumber exist, only the newest one</span>
<a name="l843"><span class="linenum"> 843</span></a>  <span class="comment">     * i.e with the greatest id is used, the others are ignored but not deleted.</span>
<a name="l844"><span class="linenum"> 844</span></a>  <span class="comment">     * MDL-19210</span>
<a name="l845"><span class="linenum"> 845</span></a>  <span class="comment">     */</span>
<a name="l846"><span class="linenum"> 846</span></a>      public function <a class="function" onClick="logFunction('get_database_dataset_items')" href="../../../_functions/get_database_dataset_items.html" onMouseOver="funcPopup(event,'get_database_dataset_items')">get_database_dataset_items</a>(<a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('definition')" href="../../../_variables/definition.html">$definition</a>) {
<a name="l847"><span class="linenum"> 847</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l848"><span class="linenum"> 848</span></a>          <a class="var it13056" onMouseOver="hilite(13056)" onMouseOut="lolite()" onClick="logVariable('databasedataitems')" href="../../../_variables/databasedataitems.html">$databasedataitems</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(// Use number as key!!
<a name="l849"><span class="linenum"> 849</span></a>              &quot; SELECT id , itemnumber, definition,  value
<a name="l850"><span class="linenum"> 850</span></a>              FROM {question_dataset_items}
<a name="l851"><span class="linenum"> 851</span></a>              WHERE definition = <a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('definition')" href="../../../_variables/definition.html">$definition</a> order by id DESC &quot;, array(<a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('definition')" href="../../../_variables/definition.html">$definition</a>));
<a name="l852"><span class="linenum"> 852</span></a>          <a class="var it13057" onMouseOver="hilite(13057)" onMouseOut="lolite()" onClick="logVariable('dataitems')" href="../../../_variables/dataitems.html">$dataitems</a> = Array();
<a name="l853"><span class="linenum"> 853</span></a>          foreach (<a class="var it13056" onMouseOver="hilite(13056)" onMouseOut="lolite()" onClick="logVariable('databasedataitems')" href="../../../_variables/databasedataitems.html">$databasedataitems</a> as <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../../_variables/id.html">$id</a> =&gt; <a class="var it13037" onMouseOver="hilite(13037)" onMouseOut="lolite()" onClick="logVariable('dataitem')" href="../../../_variables/dataitem.html">$dataitem</a>) {
<a name="l854"><span class="linenum"> 854</span></a>              if (!isset(<a class="var it13057" onMouseOver="hilite(13057)" onMouseOut="lolite()" onClick="logVariable('dataitems')" href="../../../_variables/dataitems.html">$dataitems</a>[<a class="var it13037" onMouseOver="hilite(13037)" onMouseOut="lolite()" onClick="logVariable('dataitem')" href="../../../_variables/dataitem.html">$dataitem</a>-&gt;<a onClick="logVariable('itemnumber')" class="var it44020" onMouseOver="hilite(44020)" onMouseOut="lolite()" href="../../../_variables/itemnumber.html">itemnumber</a>])) {
<a name="l855"><span class="linenum"> 855</span></a>                  <a class="var it13057" onMouseOver="hilite(13057)" onMouseOut="lolite()" onClick="logVariable('dataitems')" href="../../../_variables/dataitems.html">$dataitems</a>[<a class="var it13037" onMouseOver="hilite(13037)" onMouseOut="lolite()" onClick="logVariable('dataitem')" href="../../../_variables/dataitem.html">$dataitem</a>-&gt;<a onClick="logVariable('itemnumber')" class="var it44020" onMouseOver="hilite(44020)" onMouseOut="lolite()" href="../../../_variables/itemnumber.html">itemnumber</a>] = <a class="var it13037" onMouseOver="hilite(13037)" onMouseOut="lolite()" onClick="logVariable('dataitem')" href="../../../_variables/dataitem.html">$dataitem</a>;
<a name="l856"><span class="linenum"> 856</span></a>              }
<a name="l857"><span class="linenum"> 857</span></a>          }
<a name="l858"><span class="linenum"> 858</span></a>          <a class="phpfunction" onClick="logFunction('ksort')" href="../../../_functions/ksort.html" onMouseOver="phpfuncPopup(event,'ksort')">ksort</a>(<a class="var it13057" onMouseOver="hilite(13057)" onMouseOut="lolite()" onClick="logVariable('dataitems')" href="../../../_variables/dataitems.html">$dataitems</a>);
<a name="l859"><span class="linenum"> 859</span></a>          return <a class="var it13057" onMouseOver="hilite(13057)" onMouseOut="lolite()" onClick="logVariable('dataitems')" href="../../../_variables/dataitems.html">$dataitems</a>;
<a name="l860"><span class="linenum"> 860</span></a>      }
<a name="l861"><span class="linenum"> 861</span></a>  
<a name="l862"><span class="linenum"> 862</span></a>      public function <a class="function" onClick="logFunction('save_dataset_items')" href="../../../_functions/save_dataset_items.html" onMouseOver="funcPopup(event,'save_dataset_items')">save_dataset_items</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>, <a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../../_variables/fromform.html">$fromform</a>) {
<a name="l863"><span class="linenum"> 863</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l864"><span class="linenum"> 864</span></a>          <a class="var it2964" onMouseOver="hilite(2964)" onMouseOut="lolite()" onClick="logVariable('synchronize')" href="../../../_variables/synchronize.html">$synchronize</a> = false;
<a name="l865"><span class="linenum"> 865</span></a>          if (isset(<a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../../_variables/fromform.html">$fromform</a>-&gt;<a onClick="logVariable('nextpageparam')" class="var it43020" onMouseOver="hilite(43020)" onMouseOut="lolite()" href="../../../_variables/nextpageparam.html">nextpageparam</a>['forceregeneration'])) {
<a name="l866"><span class="linenum"> 866</span></a>              <a class="var it13040" onMouseOver="hilite(13040)" onMouseOut="lolite()" onClick="logVariable('regenerate')" href="../../../_variables/regenerate.html">$regenerate</a> = <a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../../_variables/fromform.html">$fromform</a>-&gt;<a onClick="logVariable('nextpageparam')" class="var it43020" onMouseOver="hilite(43020)" onMouseOut="lolite()" href="../../../_variables/nextpageparam.html">nextpageparam</a>['forceregeneration'];
<a name="l867"><span class="linenum"> 867</span></a>          } else {
<a name="l868"><span class="linenum"> 868</span></a>              <a class="var it13040" onMouseOver="hilite(13040)" onMouseOut="lolite()" onClick="logVariable('regenerate')" href="../../../_variables/regenerate.html">$regenerate</a> = 0;
<a name="l869"><span class="linenum"> 869</span></a>          }
<a name="l870"><span class="linenum"> 870</span></a>          if (empty(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('options')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>)) {
<a name="l871"><span class="linenum"> 871</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_question_options')" href="../../../_functions/get_question_options.html" onMouseOver="funcPopup(event,'get_question_options')">get_question_options</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>);
<a name="l872"><span class="linenum"> 872</span></a>          }
<a name="l873"><span class="linenum"> 873</span></a>          if (!empty(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('options')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;synchronize)) {
<a name="l874"><span class="linenum"> 874</span></a>              <a class="var it2964" onMouseOver="hilite(2964)" onMouseOut="lolite()" onClick="logVariable('synchronize')" href="../../../_variables/synchronize.html">$synchronize</a> = true;
<a name="l875"><span class="linenum"> 875</span></a>          }
<a name="l876"><span class="linenum"> 876</span></a>  
<a name="l877"><span class="linenum"> 877</span></a>  <span class="comment">        // Get the old datasets for this question.</span>
<a name="l878"><span class="linenum"> 878</span></a>          <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_dataset_definitions')" href="../../../_functions/get_dataset_definitions.html" onMouseOver="funcPopup(event,'get_dataset_definitions')">get_dataset_definitions</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, array());
<a name="l879"><span class="linenum"> 879</span></a>  <span class="comment">        // Handle generator options...</span>
<a name="l880"><span class="linenum"> 880</span></a>          <a class="var it13059" onMouseOver="hilite(13059)" onMouseOut="lolite()" onClick="logVariable('olddatasetdefs')" href="../../../_variables/olddatasetdefs.html">$olddatasetdefs</a> = <a class="function" onClick="logFunction('fullclone')" href="../../../_functions/fullclone.html" onMouseOver="funcPopup(event,'fullclone')">fullclone</a>(<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>);
<a name="l881"><span class="linenum"> 881</span></a>          <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('update_dataset_options')" href="../../../_functions/update_dataset_options.html" onMouseOver="funcPopup(event,'update_dataset_options')">update_dataset_options</a>(<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>, <a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../../_variables/fromform.html">$fromform</a>);
<a name="l882"><span class="linenum"> 882</span></a>          <a class="var it13060" onMouseOver="hilite(13060)" onMouseOut="lolite()" onClick="logVariable('maxnumber')" href="../../../_variables/maxnumber.html">$maxnumber</a> = -1;
<a name="l883"><span class="linenum"> 883</span></a>          foreach (<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a> as <a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a> =&gt; <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>) {
<a name="l884"><span class="linenum"> 884</span></a>              if (isset(<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>)
<a name="l885"><span class="linenum"> 885</span></a>                      &amp;&amp; <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('options')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a> != <a class="var it13059" onMouseOver="hilite(13059)" onMouseOut="lolite()" onClick="logVariable('olddatasetdefs')" href="../../../_variables/olddatasetdefs.html">$olddatasetdefs</a>[<a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a>]-&gt;options) {
<a name="l886"><span class="linenum"> 886</span></a>  <span class="comment">                // Save the new value for options.</span>
<a name="l887"><span class="linenum"> 887</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('question_dataset_definitions', <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>);
<a name="l888"><span class="linenum"> 888</span></a>  
<a name="l889"><span class="linenum"> 889</span></a>              }
<a name="l890"><span class="linenum"> 890</span></a>  <span class="comment">            // Get maxnumber.</span>
<a name="l891"><span class="linenum"> 891</span></a>              if (<a class="var it13060" onMouseOver="hilite(13060)" onMouseOut="lolite()" onClick="logVariable('maxnumber')" href="../../../_variables/maxnumber.html">$maxnumber</a> == -1 || <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('itemcount')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/itemcount.html">itemcount</a> &lt; <a class="var it13060" onMouseOver="hilite(13060)" onMouseOut="lolite()" onClick="logVariable('maxnumber')" href="../../../_variables/maxnumber.html">$maxnumber</a>) {
<a name="l892"><span class="linenum"> 892</span></a>                  <a class="var it13060" onMouseOver="hilite(13060)" onMouseOut="lolite()" onClick="logVariable('maxnumber')" href="../../../_variables/maxnumber.html">$maxnumber</a> = <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('itemcount')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/itemcount.html">itemcount</a>;
<a name="l893"><span class="linenum"> 893</span></a>              }
<a name="l894"><span class="linenum"> 894</span></a>          }
<a name="l895"><span class="linenum"> 895</span></a>  <span class="comment">        // Handle adding and removing of dataset items.</span>
<a name="l896"><span class="linenum"> 896</span></a>          <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../_variables/i.html">$i</a> = 1;
<a name="l897"><span class="linenum"> 897</span></a>          if (<a class="var it13060" onMouseOver="hilite(13060)" onMouseOut="lolite()" onClick="logVariable('maxnumber')" href="../../../_variables/maxnumber.html">$maxnumber</a> &gt; self::MAX_DATASET_ITEMS) {
<a name="l898"><span class="linenum"> 898</span></a>              <a class="var it13060" onMouseOver="hilite(13060)" onMouseOut="lolite()" onClick="logVariable('maxnumber')" href="../../../_variables/maxnumber.html">$maxnumber</a> = self::MAX_DATASET_ITEMS;
<a name="l899"><span class="linenum"> 899</span></a>          }
<a name="l900"><span class="linenum"> 900</span></a>  
<a name="l901"><span class="linenum"> 901</span></a>          <a class="phpfunction" onClick="logFunction('ksort')" href="../../../_functions/ksort.html" onMouseOver="phpfuncPopup(event,'ksort')">ksort</a>(<a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../../_variables/fromform.html">$fromform</a>-&gt;<a onClick="logVariable('definition')" class="var it43020" onMouseOver="hilite(43020)" onMouseOut="lolite()" href="../../../_variables/definition.html">definition</a>);
<a name="l902"><span class="linenum"> 902</span></a>          foreach (<a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../../_variables/fromform.html">$fromform</a>-&gt;<a onClick="logVariable('definition')" class="var it43020" onMouseOver="hilite(43020)" onMouseOut="lolite()" href="../../../_variables/definition.html">definition</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a> =&gt; <a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a>) {
<a name="l903"><span class="linenum"> 903</span></a>  <span class="comment">            // If the delete button has not been pressed then skip the datasetitems</span>
<a name="l904"><span class="linenum"> 904</span></a>  <span class="comment">            // in the 'add item' part of the form.</span>
<a name="l905"><span class="linenum"> 905</span></a>              if (<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../_variables/i.html">$i</a> &gt; <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>)*<a class="var it13060" onMouseOver="hilite(13060)" onMouseOut="lolite()" onClick="logVariable('maxnumber')" href="../../../_variables/maxnumber.html">$maxnumber</a>) {
<a name="l906"><span class="linenum"> 906</span></a>                  break;
<a name="l907"><span class="linenum"> 907</span></a>              }
<a name="l908"><span class="linenum"> 908</span></a>              <a class="var it13061" onMouseOver="hilite(13061)" onMouseOut="lolite()" onClick="logVariable('addeditem')" href="../../../_variables/addeditem.html">$addeditem</a> = new stdClass();
<a name="l909"><span class="linenum"> 909</span></a>              <a class="var it13061" onMouseOver="hilite(13061)" onMouseOut="lolite()" onClick="logVariable('addeditem')" href="../../../_variables/addeditem.html">$addeditem</a>-&gt;<a onClick="logVariable('definition')" class="var it43199" onMouseOver="hilite(43199)" onMouseOut="lolite()" href="../../../_variables/definition.html">definition</a> = <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>[<a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a>]-&gt;id;
<a name="l910"><span class="linenum"> 910</span></a>              <a class="var it13061" onMouseOver="hilite(13061)" onMouseOut="lolite()" onClick="logVariable('addeditem')" href="../../../_variables/addeditem.html">$addeditem</a>-&gt;<a onClick="logVariable('value')" class="var it43199" onMouseOver="hilite(43199)" onMouseOut="lolite()" href="../../../_variables/value.html">value</a> = <a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../../_variables/fromform.html">$fromform</a>-&gt;<a onClick="logVariable('number')" class="var it43020" onMouseOver="hilite(43020)" onMouseOut="lolite()" href="../../../_variables/number.html">number</a>[<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../_variables/i.html">$i</a>];
<a name="l911"><span class="linenum"> 911</span></a>              <a class="var it13061" onMouseOver="hilite(13061)" onMouseOut="lolite()" onClick="logVariable('addeditem')" href="../../../_variables/addeditem.html">$addeditem</a>-&gt;<a onClick="logVariable('itemnumber')" class="var it43199" onMouseOver="hilite(43199)" onMouseOut="lolite()" href="../../../_variables/itemnumber.html">itemnumber</a> = <a class="phpfunction" onClick="logFunction('ceil')" href="../../../_functions/ceil.html" onMouseOver="phpfuncPopup(event,'ceil')">ceil</a>(<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../_variables/i.html">$i</a> / <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>));
<a name="l912"><span class="linenum"> 912</span></a>  
<a name="l913"><span class="linenum"> 913</span></a>              if (<a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../../_variables/fromform.html">$fromform</a>-&gt;<a onClick="logVariable('itemid')" class="var it43020" onMouseOver="hilite(43020)" onMouseOut="lolite()" href="../../../_variables/itemid.html">itemid</a>[<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../_variables/i.html">$i</a>]) {
<a name="l914"><span class="linenum"> 914</span></a>  <span class="comment">                // Reuse any previously used record.</span>
<a name="l915"><span class="linenum"> 915</span></a>                  <a class="var it13061" onMouseOver="hilite(13061)" onMouseOut="lolite()" onClick="logVariable('addeditem')" href="../../../_variables/addeditem.html">$addeditem</a>-&gt;<a onClick="logVariable('id')" class="var it43199" onMouseOver="hilite(43199)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a> = <a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../../_variables/fromform.html">$fromform</a>-&gt;<a onClick="logVariable('itemid')" class="var it43020" onMouseOver="hilite(43020)" onMouseOut="lolite()" href="../../../_variables/itemid.html">itemid</a>[<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../_variables/i.html">$i</a>];
<a name="l916"><span class="linenum"> 916</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('question_dataset_items', <a class="var it13061" onMouseOver="hilite(13061)" onMouseOut="lolite()" onClick="logVariable('addeditem')" href="../../../_variables/addeditem.html">$addeditem</a>);
<a name="l917"><span class="linenum"> 917</span></a>              } else {
<a name="l918"><span class="linenum"> 918</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('question_dataset_items', <a class="var it13061" onMouseOver="hilite(13061)" onMouseOut="lolite()" onClick="logVariable('addeditem')" href="../../../_variables/addeditem.html">$addeditem</a>);
<a name="l919"><span class="linenum"> 919</span></a>              }
<a name="l920"><span class="linenum"> 920</span></a>  
<a name="l921"><span class="linenum"> 921</span></a>              <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../_variables/i.html">$i</a>++;
<a name="l922"><span class="linenum"> 922</span></a>          }
<a name="l923"><span class="linenum"> 923</span></a>          if (isset(<a class="var it13061" onMouseOver="hilite(13061)" onMouseOut="lolite()" onClick="logVariable('addeditem')" href="../../../_variables/addeditem.html">$addeditem</a>-&gt;<a onClick="logVariable('itemnumber')" class="var it43199" onMouseOver="hilite(43199)" onMouseOut="lolite()" href="../../../_variables/itemnumber.html">itemnumber</a>) &amp;&amp; <a class="var it13060" onMouseOver="hilite(13060)" onMouseOut="lolite()" onClick="logVariable('maxnumber')" href="../../../_variables/maxnumber.html">$maxnumber</a> &lt; <a class="var it13061" onMouseOver="hilite(13061)" onMouseOut="lolite()" onClick="logVariable('addeditem')" href="../../../_variables/addeditem.html">$addeditem</a>-&gt;itemnumber
<a name="l924"><span class="linenum"> 924</span></a>                  &amp;&amp; <a class="var it13061" onMouseOver="hilite(13061)" onMouseOut="lolite()" onClick="logVariable('addeditem')" href="../../../_variables/addeditem.html">$addeditem</a>-&gt;<a onClick="logVariable('itemnumber')" class="var it43199" onMouseOver="hilite(43199)" onMouseOut="lolite()" href="../../../_variables/itemnumber.html">itemnumber</a> &lt; self::MAX_DATASET_ITEMS) {
<a name="l925"><span class="linenum"> 925</span></a>              <a class="var it13060" onMouseOver="hilite(13060)" onMouseOut="lolite()" onClick="logVariable('maxnumber')" href="../../../_variables/maxnumber.html">$maxnumber</a> = <a class="var it13061" onMouseOver="hilite(13061)" onMouseOut="lolite()" onClick="logVariable('addeditem')" href="../../../_variables/addeditem.html">$addeditem</a>-&gt;<a onClick="logVariable('itemnumber')" class="var it43199" onMouseOver="hilite(43199)" onMouseOut="lolite()" href="../../../_variables/itemnumber.html">itemnumber</a>;
<a name="l926"><span class="linenum"> 926</span></a>              foreach (<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a> =&gt; <a class="var it13062" onMouseOver="hilite(13062)" onMouseOut="lolite()" onClick="logVariable('newdef')" href="../../../_variables/newdef.html">$newdef</a>) {
<a name="l927"><span class="linenum"> 927</span></a>                  if (isset(<a class="var it13062" onMouseOver="hilite(13062)" onMouseOut="lolite()" onClick="logVariable('newdef')" href="../../../_variables/newdef.html">$newdef</a>-&gt;<a onClick="logVariable('id')" class="var it43204" onMouseOver="hilite(43204)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>) &amp;&amp; <a class="var it13062" onMouseOver="hilite(13062)" onMouseOut="lolite()" onClick="logVariable('newdef')" href="../../../_variables/newdef.html">$newdef</a>-&gt;<a onClick="logVariable('itemcount')" class="var it43204" onMouseOver="hilite(43204)" onMouseOut="lolite()" href="../../../_variables/itemcount.html">itemcount</a> &lt;= <a class="var it13060" onMouseOver="hilite(13060)" onMouseOut="lolite()" onClick="logVariable('maxnumber')" href="../../../_variables/maxnumber.html">$maxnumber</a>) {
<a name="l928"><span class="linenum"> 928</span></a>                      <a class="var it13062" onMouseOver="hilite(13062)" onMouseOut="lolite()" onClick="logVariable('newdef')" href="../../../_variables/newdef.html">$newdef</a>-&gt;<a onClick="logVariable('itemcount')" class="var it43204" onMouseOver="hilite(43204)" onMouseOut="lolite()" href="../../../_variables/itemcount.html">itemcount</a> = <a class="var it13060" onMouseOver="hilite(13060)" onMouseOut="lolite()" onClick="logVariable('maxnumber')" href="../../../_variables/maxnumber.html">$maxnumber</a>;
<a name="l929"><span class="linenum"> 929</span></a>  <span class="comment">                    // Save the new value for options.</span>
<a name="l930"><span class="linenum"> 930</span></a>                      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('question_dataset_definitions', <a class="var it13062" onMouseOver="hilite(13062)" onMouseOut="lolite()" onClick="logVariable('newdef')" href="../../../_variables/newdef.html">$newdef</a>);
<a name="l931"><span class="linenum"> 931</span></a>                  }
<a name="l932"><span class="linenum"> 932</span></a>              }
<a name="l933"><span class="linenum"> 933</span></a>          }
<a name="l934"><span class="linenum"> 934</span></a>  <span class="comment">        // Adding supplementary items.</span>
<a name="l935"><span class="linenum"> 935</span></a>          <a class="var it13063" onMouseOver="hilite(13063)" onMouseOut="lolite()" onClick="logVariable('numbertoadd')" href="../../../_variables/numbertoadd.html">$numbertoadd</a> = 0;
<a name="l936"><span class="linenum"> 936</span></a>          if (isset(<a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../../_variables/fromform.html">$fromform</a>-&gt;<a onClick="logVariable('addbutton')" class="var it43020" onMouseOver="hilite(43020)" onMouseOut="lolite()" href="../../../_variables/addbutton.html">addbutton</a>) &amp;&amp; <a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../../_variables/fromform.html">$fromform</a>-&gt;<a onClick="logVariable('selectadd')" class="var it43020" onMouseOver="hilite(43020)" onMouseOut="lolite()" href="../../../_variables/selectadd.html">selectadd</a> &gt; 0 &amp;&amp;
<a name="l937"><span class="linenum"> 937</span></a>                  <a class="var it13060" onMouseOver="hilite(13060)" onMouseOut="lolite()" onClick="logVariable('maxnumber')" href="../../../_variables/maxnumber.html">$maxnumber</a> &lt; self::MAX_DATASET_ITEMS) {
<a name="l938"><span class="linenum"> 938</span></a>              <a class="var it13063" onMouseOver="hilite(13063)" onMouseOut="lolite()" onClick="logVariable('numbertoadd')" href="../../../_variables/numbertoadd.html">$numbertoadd</a> = <a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../../_variables/fromform.html">$fromform</a>-&gt;<a onClick="logVariable('selectadd')" class="var it43020" onMouseOver="hilite(43020)" onMouseOut="lolite()" href="../../../_variables/selectadd.html">selectadd</a>;
<a name="l939"><span class="linenum"> 939</span></a>              if (self::MAX_DATASET_ITEMS - <a class="var it13060" onMouseOver="hilite(13060)" onMouseOut="lolite()" onClick="logVariable('maxnumber')" href="../../../_variables/maxnumber.html">$maxnumber</a> &lt; <a class="var it13063" onMouseOver="hilite(13063)" onMouseOut="lolite()" onClick="logVariable('numbertoadd')" href="../../../_variables/numbertoadd.html">$numbertoadd</a>) {
<a name="l940"><span class="linenum"> 940</span></a>                  <a class="var it13063" onMouseOver="hilite(13063)" onMouseOut="lolite()" onClick="logVariable('numbertoadd')" href="../../../_variables/numbertoadd.html">$numbertoadd</a> = self::MAX_DATASET_ITEMS - <a class="var it13060" onMouseOver="hilite(13060)" onMouseOut="lolite()" onClick="logVariable('maxnumber')" href="../../../_variables/maxnumber.html">$maxnumber</a>;
<a name="l941"><span class="linenum"> 941</span></a>              }
<a name="l942"><span class="linenum"> 942</span></a>  <span class="comment">            // Add the other items.</span>
<a name="l943"><span class="linenum"> 943</span></a>  <span class="comment">            // Generate a new dataset item (or reuse an old one).</span>
<a name="l944"><span class="linenum"> 944</span></a>              foreach (<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a> as <a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a> =&gt; <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>) {
<a name="l945"><span class="linenum"> 945</span></a>  <span class="comment">                // In case that for category datasets some new items has been added,</span>
<a name="l946"><span class="linenum"> 946</span></a>  <span class="comment">                // get actual values.</span>
<a name="l947"><span class="linenum"> 947</span></a>  <span class="comment">                // Fix regenerate for this datadefs.</span>
<a name="l948"><span class="linenum"> 948</span></a>                  <a class="var it13066" onMouseOver="hilite(13066)" onMouseOut="lolite()" onClick="logVariable('defregenerate')" href="../../../_variables/defregenerate.html">$defregenerate</a> = 0;
<a name="l949"><span class="linenum"> 949</span></a>                  if (<a class="var it2964" onMouseOver="hilite(2964)" onMouseOut="lolite()" onClick="logVariable('synchronize')" href="../../../_variables/synchronize.html">$synchronize</a> &amp;&amp;
<a name="l950"><span class="linenum"> 950</span></a>                          !empty (<a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../../_variables/fromform.html">$fromform</a>-&gt;<a onClick="logVariable('nextpageparam')" class="var it43020" onMouseOver="hilite(43020)" onMouseOut="lolite()" href="../../../_variables/nextpageparam.html">nextpageparam</a>[&quot;datasetregenerate[{<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('name')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>}&quot;])) {
<a name="l951"><span class="linenum"> 951</span></a>                      <a class="var it13066" onMouseOver="hilite(13066)" onMouseOut="lolite()" onClick="logVariable('defregenerate')" href="../../../_variables/defregenerate.html">$defregenerate</a> = 1;
<a name="l952"><span class="linenum"> 952</span></a>                  } else if (!<a class="var it2964" onMouseOver="hilite(2964)" onMouseOut="lolite()" onClick="logVariable('synchronize')" href="../../../_variables/synchronize.html">$synchronize</a> &amp;&amp;
<a name="l953"><span class="linenum"> 953</span></a>                          ((<a class="var it13040" onMouseOver="hilite(13040)" onMouseOut="lolite()" onClick="logVariable('regenerate')" href="../../../_variables/regenerate.html">$regenerate</a> == 1 &amp;&amp; <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('category')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a> == 0) ||<a class="var it13040" onMouseOver="hilite(13040)" onMouseOut="lolite()" onClick="logVariable('regenerate')" href="../../../_variables/regenerate.html">$regenerate</a> == 2)) {
<a name="l954"><span class="linenum"> 954</span></a>                      <a class="var it13066" onMouseOver="hilite(13066)" onMouseOut="lolite()" onClick="logVariable('defregenerate')" href="../../../_variables/defregenerate.html">$defregenerate</a> = 1;
<a name="l955"><span class="linenum"> 955</span></a>                  }
<a name="l956"><span class="linenum"> 956</span></a>                  if (isset(<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>)) {
<a name="l957"><span class="linenum"> 957</span></a>                      <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>[<a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a>]-&gt;items =
<a name="l958"><span class="linenum"> 958</span></a>                              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_database_dataset_items')" href="../../../_functions/get_database_dataset_items.html" onMouseOver="funcPopup(event,'get_database_dataset_items')">get_database_dataset_items</a>(<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>);
<a name="l959"><span class="linenum"> 959</span></a>                  }
<a name="l960"><span class="linenum"> 960</span></a>                  for (<a class="var it13067" onMouseOver="hilite(13067)" onMouseOut="lolite()" onClick="logVariable('numberadded')" href="../../../_variables/numberadded.html">$numberadded</a> = <a class="var it13060" onMouseOver="hilite(13060)" onMouseOut="lolite()" onClick="logVariable('maxnumber')" href="../../../_variables/maxnumber.html">$maxnumber</a>+1; <a class="var it13067" onMouseOver="hilite(13067)" onMouseOut="lolite()" onClick="logVariable('numberadded')" href="../../../_variables/numberadded.html">$numberadded</a> &lt;= <a class="var it13060" onMouseOver="hilite(13060)" onMouseOut="lolite()" onClick="logVariable('maxnumber')" href="../../../_variables/maxnumber.html">$maxnumber</a> + <a class="var it13063" onMouseOver="hilite(13063)" onMouseOut="lolite()" onClick="logVariable('numbertoadd')" href="../../../_variables/numbertoadd.html">$numbertoadd</a>; <a class="var it13067" onMouseOver="hilite(13067)" onMouseOut="lolite()" onClick="logVariable('numberadded')" href="../../../_variables/numberadded.html">$numberadded</a>++) {
<a name="l961"><span class="linenum"> 961</span></a>                      if (isset(<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>[<a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a>]-&gt;items[<a class="var it13067" onMouseOver="hilite(13067)" onMouseOut="lolite()" onClick="logVariable('numberadded')" href="../../../_variables/numberadded.html">$numberadded</a>])) {
<a name="l962"><span class="linenum"> 962</span></a>  <span class="comment">                        // In case of regenerate it modifies the already existing record.</span>
<a name="l963"><span class="linenum"> 963</span></a>                          if (<a class="var it13066" onMouseOver="hilite(13066)" onMouseOut="lolite()" onClick="logVariable('defregenerate')" href="../../../_variables/defregenerate.html">$defregenerate</a>) {
<a name="l964"><span class="linenum"> 964</span></a>                              <a class="var it13038" onMouseOver="hilite(13038)" onMouseOut="lolite()" onClick="logVariable('datasetitem')" href="../../../_variables/datasetitem.html">$datasetitem</a> = new stdClass();
<a name="l965"><span class="linenum"> 965</span></a>                              <a class="var it13038" onMouseOver="hilite(13038)" onMouseOut="lolite()" onClick="logVariable('datasetitem')" href="../../../_variables/datasetitem.html">$datasetitem</a>-&gt;<a onClick="logVariable('id')" class="var it43198" onMouseOver="hilite(43198)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a> = <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>[<a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a>]-&gt;items[<a class="var it13067" onMouseOver="hilite(13067)" onMouseOut="lolite()" onClick="logVariable('numberadded')" href="../../../_variables/numberadded.html">$numberadded</a>]-&gt;id;
<a name="l966"><span class="linenum"> 966</span></a>                              <a class="var it13038" onMouseOver="hilite(13038)" onMouseOut="lolite()" onClick="logVariable('datasetitem')" href="../../../_variables/datasetitem.html">$datasetitem</a>-&gt;<a onClick="logVariable('definition')" class="var it43198" onMouseOver="hilite(43198)" onMouseOut="lolite()" href="../../../_variables/definition.html">definition</a> = <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l967"><span class="linenum"> 967</span></a>                              <a class="var it13038" onMouseOver="hilite(13038)" onMouseOut="lolite()" onClick="logVariable('datasetitem')" href="../../../_variables/datasetitem.html">$datasetitem</a>-&gt;<a onClick="logVariable('itemnumber')" class="var it43198" onMouseOver="hilite(43198)" onMouseOut="lolite()" href="../../../_variables/itemnumber.html">itemnumber</a> = <a class="var it13067" onMouseOver="hilite(13067)" onMouseOut="lolite()" onClick="logVariable('numberadded')" href="../../../_variables/numberadded.html">$numberadded</a>;
<a name="l968"><span class="linenum"> 968</span></a>                              <a class="var it13038" onMouseOver="hilite(13038)" onMouseOut="lolite()" onClick="logVariable('datasetitem')" href="../../../_variables/datasetitem.html">$datasetitem</a>-&gt;<a onClick="logVariable('value')" class="var it43198" onMouseOver="hilite(43198)" onMouseOut="lolite()" href="../../../_variables/value.html">value</a> =
<a name="l969"><span class="linenum"> 969</span></a>                                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('generate_dataset_item')" href="../../../_functions/generate_dataset_item.html" onMouseOver="funcPopup(event,'generate_dataset_item')">generate_dataset_item</a>(<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('options')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>);
<a name="l970"><span class="linenum"> 970</span></a>                              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('question_dataset_items', <a class="var it13038" onMouseOver="hilite(13038)" onMouseOut="lolite()" onClick="logVariable('datasetitem')" href="../../../_variables/datasetitem.html">$datasetitem</a>);
<a name="l971"><span class="linenum"> 971</span></a>                          }
<a name="l972"><span class="linenum"> 972</span></a>  <span class="comment">                        // If not regenerate do nothing as there is already a record.</span>
<a name="l973"><span class="linenum"> 973</span></a>                      } else {
<a name="l974"><span class="linenum"> 974</span></a>                          <a class="var it13038" onMouseOver="hilite(13038)" onMouseOut="lolite()" onClick="logVariable('datasetitem')" href="../../../_variables/datasetitem.html">$datasetitem</a> = new stdClass();
<a name="l975"><span class="linenum"> 975</span></a>                          <a class="var it13038" onMouseOver="hilite(13038)" onMouseOut="lolite()" onClick="logVariable('datasetitem')" href="../../../_variables/datasetitem.html">$datasetitem</a>-&gt;<a onClick="logVariable('definition')" class="var it43198" onMouseOver="hilite(43198)" onMouseOut="lolite()" href="../../../_variables/definition.html">definition</a> = <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l976"><span class="linenum"> 976</span></a>                          <a class="var it13038" onMouseOver="hilite(13038)" onMouseOut="lolite()" onClick="logVariable('datasetitem')" href="../../../_variables/datasetitem.html">$datasetitem</a>-&gt;<a onClick="logVariable('itemnumber')" class="var it43198" onMouseOver="hilite(43198)" onMouseOut="lolite()" href="../../../_variables/itemnumber.html">itemnumber</a> = <a class="var it13067" onMouseOver="hilite(13067)" onMouseOut="lolite()" onClick="logVariable('numberadded')" href="../../../_variables/numberadded.html">$numberadded</a>;
<a name="l977"><span class="linenum"> 977</span></a>                          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('supports_dataset_item_generation')" href="../../../_functions/supports_dataset_item_generation.html" onMouseOver="funcPopup(event,'supports_dataset_item_generation')">supports_dataset_item_generation</a>()) {
<a name="l978"><span class="linenum"> 978</span></a>                              <a class="var it13038" onMouseOver="hilite(13038)" onMouseOut="lolite()" onClick="logVariable('datasetitem')" href="../../../_variables/datasetitem.html">$datasetitem</a>-&gt;<a onClick="logVariable('value')" class="var it43198" onMouseOver="hilite(43198)" onMouseOut="lolite()" href="../../../_variables/value.html">value</a> =
<a name="l979"><span class="linenum"> 979</span></a>                                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('generate_dataset_item')" href="../../../_functions/generate_dataset_item.html" onMouseOver="funcPopup(event,'generate_dataset_item')">generate_dataset_item</a>(<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('options')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>);
<a name="l980"><span class="linenum"> 980</span></a>                          } else {
<a name="l981"><span class="linenum"> 981</span></a>                              <a class="var it13038" onMouseOver="hilite(13038)" onMouseOut="lolite()" onClick="logVariable('datasetitem')" href="../../../_variables/datasetitem.html">$datasetitem</a>-&gt;<a onClick="logVariable('value')" class="var it43198" onMouseOver="hilite(43198)" onMouseOut="lolite()" href="../../../_variables/value.html">value</a> = '';
<a name="l982"><span class="linenum"> 982</span></a>                          }
<a name="l983"><span class="linenum"> 983</span></a>                          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('question_dataset_items', <a class="var it13038" onMouseOver="hilite(13038)" onMouseOut="lolite()" onClick="logVariable('datasetitem')" href="../../../_variables/datasetitem.html">$datasetitem</a>);
<a name="l984"><span class="linenum"> 984</span></a>                      }
<a name="l985"><span class="linenum"> 985</span></a>                  }<span class="comment">// For number added.</span>
<a name="l986"><span class="linenum"> 986</span></a>              }<span class="comment">// Datasetsdefs end.</span>
<a name="l987"><span class="linenum"> 987</span></a>              <a class="var it13060" onMouseOver="hilite(13060)" onMouseOut="lolite()" onClick="logVariable('maxnumber')" href="../../../_variables/maxnumber.html">$maxnumber</a> += <a class="var it13063" onMouseOver="hilite(13063)" onMouseOut="lolite()" onClick="logVariable('numbertoadd')" href="../../../_variables/numbertoadd.html">$numbertoadd</a>;
<a name="l988"><span class="linenum"> 988</span></a>              foreach (<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a> =&gt; <a class="var it13062" onMouseOver="hilite(13062)" onMouseOut="lolite()" onClick="logVariable('newdef')" href="../../../_variables/newdef.html">$newdef</a>) {
<a name="l989"><span class="linenum"> 989</span></a>                  if (isset(<a class="var it13062" onMouseOver="hilite(13062)" onMouseOut="lolite()" onClick="logVariable('newdef')" href="../../../_variables/newdef.html">$newdef</a>-&gt;<a onClick="logVariable('id')" class="var it43204" onMouseOver="hilite(43204)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>) &amp;&amp; <a class="var it13062" onMouseOver="hilite(13062)" onMouseOut="lolite()" onClick="logVariable('newdef')" href="../../../_variables/newdef.html">$newdef</a>-&gt;<a onClick="logVariable('itemcount')" class="var it43204" onMouseOver="hilite(43204)" onMouseOut="lolite()" href="../../../_variables/itemcount.html">itemcount</a> &lt;= <a class="var it13060" onMouseOver="hilite(13060)" onMouseOut="lolite()" onClick="logVariable('maxnumber')" href="../../../_variables/maxnumber.html">$maxnumber</a>) {
<a name="l990"><span class="linenum"> 990</span></a>                      <a class="var it13062" onMouseOver="hilite(13062)" onMouseOut="lolite()" onClick="logVariable('newdef')" href="../../../_variables/newdef.html">$newdef</a>-&gt;<a onClick="logVariable('itemcount')" class="var it43204" onMouseOver="hilite(43204)" onMouseOut="lolite()" href="../../../_variables/itemcount.html">itemcount</a> = <a class="var it13060" onMouseOver="hilite(13060)" onMouseOut="lolite()" onClick="logVariable('maxnumber')" href="../../../_variables/maxnumber.html">$maxnumber</a>;
<a name="l991"><span class="linenum"> 991</span></a>  <span class="comment">                    // Save the new value for options.</span>
<a name="l992"><span class="linenum"> 992</span></a>                      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('question_dataset_definitions', <a class="var it13062" onMouseOver="hilite(13062)" onMouseOut="lolite()" onClick="logVariable('newdef')" href="../../../_variables/newdef.html">$newdef</a>);
<a name="l993"><span class="linenum"> 993</span></a>                  }
<a name="l994"><span class="linenum"> 994</span></a>              }
<a name="l995"><span class="linenum"> 995</span></a>          }
<a name="l996"><span class="linenum"> 996</span></a>  
<a name="l997"><span class="linenum"> 997</span></a>          if (isset(<a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../../_variables/fromform.html">$fromform</a>-&gt;<a onClick="logVariable('deletebutton')" class="var it43020" onMouseOver="hilite(43020)" onMouseOut="lolite()" href="../../../_variables/deletebutton.html">deletebutton</a>)) {
<a name="l998"><span class="linenum"> 998</span></a>              if (isset(<a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../../_variables/fromform.html">$fromform</a>-&gt;<a onClick="logVariable('selectdelete')" class="var it43020" onMouseOver="hilite(43020)" onMouseOut="lolite()" href="../../../_variables/selectdelete.html">selectdelete</a>)) {
<a name="l999"><span class="linenum"> 999</span></a>                  <a class="var it13070" onMouseOver="hilite(13070)" onMouseOut="lolite()" onClick="logVariable('newmaxnumber')" href="../../../_variables/newmaxnumber.html">$newmaxnumber</a> = <a class="var it13060" onMouseOver="hilite(13060)" onMouseOut="lolite()" onClick="logVariable('maxnumber')" href="../../../_variables/maxnumber.html">$maxnumber</a>-<a class="var it431" onMouseOver="hilite(431)" onMouseOut="lolite()" onClick="logVariable('fromform')" href="../../../_variables/fromform.html">$fromform</a>-&gt;<a onClick="logVariable('selectdelete')" class="var it43020" onMouseOver="hilite(43020)" onMouseOut="lolite()" href="../../../_variables/selectdelete.html">selectdelete</a>;
<a name="l1000"><span class="linenum">1000</span></a>              } else {
<a name="l1001"><span class="linenum">1001</span></a>                  <a class="var it13070" onMouseOver="hilite(13070)" onMouseOut="lolite()" onClick="logVariable('newmaxnumber')" href="../../../_variables/newmaxnumber.html">$newmaxnumber</a> = <a class="var it13060" onMouseOver="hilite(13060)" onMouseOut="lolite()" onClick="logVariable('maxnumber')" href="../../../_variables/maxnumber.html">$maxnumber</a>-1;
<a name="l1002"><span class="linenum">1002</span></a>              }
<a name="l1003"><span class="linenum">1003</span></a>              if (<a class="var it13070" onMouseOver="hilite(13070)" onMouseOut="lolite()" onClick="logVariable('newmaxnumber')" href="../../../_variables/newmaxnumber.html">$newmaxnumber</a> &lt; 0) {
<a name="l1004"><span class="linenum">1004</span></a>                  <a class="var it13070" onMouseOver="hilite(13070)" onMouseOut="lolite()" onClick="logVariable('newmaxnumber')" href="../../../_variables/newmaxnumber.html">$newmaxnumber</a> = 0;
<a name="l1005"><span class="linenum">1005</span></a>              }
<a name="l1006"><span class="linenum">1006</span></a>              foreach (<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a> as <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>) {
<a name="l1007"><span class="linenum">1007</span></a>                  if (<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('itemcount')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/itemcount.html">itemcount</a> == <a class="var it13060" onMouseOver="hilite(13060)" onMouseOut="lolite()" onClick="logVariable('maxnumber')" href="../../../_variables/maxnumber.html">$maxnumber</a>) {
<a name="l1008"><span class="linenum">1008</span></a>                      <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('itemcount')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/itemcount.html">itemcount</a>= <a class="var it13070" onMouseOver="hilite(13070)" onMouseOut="lolite()" onClick="logVariable('newmaxnumber')" href="../../../_variables/newmaxnumber.html">$newmaxnumber</a>;
<a name="l1009"><span class="linenum">1009</span></a>                      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('question_dataset_definitions', <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>);
<a name="l1010"><span class="linenum">1010</span></a>                  }
<a name="l1011"><span class="linenum">1011</span></a>              }
<a name="l1012"><span class="linenum">1012</span></a>          }
<a name="l1013"><span class="linenum">1013</span></a>      }
<a name="l1014"><span class="linenum">1014</span></a>      public function <a class="function" onClick="logFunction('generate_dataset_item')" href="../../../_functions/generate_dataset_item.html" onMouseOver="funcPopup(event,'generate_dataset_item')">generate_dataset_item</a>(<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>) {
<a name="l1015"><span class="linenum">1015</span></a>          if (!<a class="phpfunction" onClick="logFunction('preg_match')" href="../../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('~^(uniform|loguniform):([^:]*):([^:]*):([0-9]*)$~',
<a name="l1016"><span class="linenum">1016</span></a>                  <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>, <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>)) {
<a name="l1017"><span class="linenum">1017</span></a>  <span class="comment">            // Unknown options...</span>
<a name="l1018"><span class="linenum">1018</span></a>              return false;
<a name="l1019"><span class="linenum">1019</span></a>          }
<a name="l1020"><span class="linenum">1020</span></a>          if (<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[1] == 'uniform') {
<a name="l1021"><span class="linenum">1021</span></a>              <a class="var it13071" onMouseOver="hilite(13071)" onMouseOut="lolite()" onClick="logVariable('nbr')" href="../../../_variables/nbr.html">$nbr</a> = <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[2] + (<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[3]-<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[2])*<a class="phpfunction" onClick="logFunction('mt_rand')" href="../../../_functions/mt_rand.html" onMouseOver="phpfuncPopup(event,'mt_rand')">mt_rand</a>()/<a class="phpfunction" onClick="logFunction('mt_getrandmax')" href="../../../_functions/mt_getrandmax.html" onMouseOver="phpfuncPopup(event,'mt_getrandmax')">mt_getrandmax</a>();
<a name="l1022"><span class="linenum">1022</span></a>              return sprintf(&quot;%.&quot;.<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[4].'f', <a class="var it13071" onMouseOver="hilite(13071)" onMouseOut="lolite()" onClick="logVariable('nbr')" href="../../../_variables/nbr.html">$nbr</a>);
<a name="l1023"><span class="linenum">1023</span></a>  
<a name="l1024"><span class="linenum">1024</span></a>          } else if (<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[1] == 'loguniform') {
<a name="l1025"><span class="linenum">1025</span></a>              <a class="var it13072" onMouseOver="hilite(13072)" onMouseOut="lolite()" onClick="logVariable('log0')" href="../../../_variables/log0.html">$log0</a> = <a class="phpfunction" onClick="logFunction('log')" href="../../../_functions/log.html" onMouseOver="phpfuncPopup(event,'log')">log</a>(<a class="phpfunction" onClick="logFunction('abs')" href="../../../_functions/abs.html" onMouseOver="phpfuncPopup(event,'abs')">abs</a>(<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[2])); <span class="comment">// It would have worked the other way to.</span>
<a name="l1026"><span class="linenum">1026</span></a>              <a class="var it13071" onMouseOver="hilite(13071)" onMouseOut="lolite()" onClick="logVariable('nbr')" href="../../../_variables/nbr.html">$nbr</a> = <a class="phpfunction" onClick="logFunction('exp')" href="../../../_functions/exp.html" onMouseOver="phpfuncPopup(event,'exp')">exp</a>(<a class="var it13072" onMouseOver="hilite(13072)" onMouseOut="lolite()" onClick="logVariable('log0')" href="../../../_variables/log0.html">$log0</a> + (<a class="phpfunction" onClick="logFunction('log')" href="../../../_functions/log.html" onMouseOver="phpfuncPopup(event,'log')">log</a>(<a class="phpfunction" onClick="logFunction('abs')" href="../../../_functions/abs.html" onMouseOver="phpfuncPopup(event,'abs')">abs</a>(<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[3])) - <a class="var it13072" onMouseOver="hilite(13072)" onMouseOut="lolite()" onClick="logVariable('log0')" href="../../../_variables/log0.html">$log0</a>)*<a class="phpfunction" onClick="logFunction('mt_rand')" href="../../../_functions/mt_rand.html" onMouseOver="phpfuncPopup(event,'mt_rand')">mt_rand</a>()/<a class="phpfunction" onClick="logFunction('mt_getrandmax')" href="../../../_functions/mt_getrandmax.html" onMouseOver="phpfuncPopup(event,'mt_getrandmax')">mt_getrandmax</a>());
<a name="l1027"><span class="linenum">1027</span></a>              return sprintf(&quot;%.&quot;.<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[4].'f', <a class="var it13071" onMouseOver="hilite(13071)" onMouseOut="lolite()" onClick="logVariable('nbr')" href="../../../_variables/nbr.html">$nbr</a>);
<a name="l1028"><span class="linenum">1028</span></a>  
<a name="l1029"><span class="linenum">1029</span></a>          } else {
<a name="l1030"><span class="linenum">1030</span></a>              <a class="function" onClick="logFunction('print_error')" href="../../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('disterror', 'question', '', <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[1]);
<a name="l1031"><span class="linenum">1031</span></a>          }
<a name="l1032"><span class="linenum">1032</span></a>          return '';
<a name="l1033"><span class="linenum">1033</span></a>      }
<a name="l1034"><span class="linenum">1034</span></a>  
<a name="l1035"><span class="linenum">1035</span></a>      public function <a class="function" onClick="logFunction('comment_header')" href="../../../_functions/comment_header.html" onMouseOver="funcPopup(event,'comment_header')">comment_header</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>) {
<a name="l1036"><span class="linenum">1036</span></a>          <a class="var it13073" onMouseOver="hilite(13073)" onMouseOut="lolite()" onClick="logVariable('strheader')" href="../../../_variables/strheader.html">$strheader</a> = '';
<a name="l1037"><span class="linenum">1037</span></a>          <a class="var it5614" onMouseOver="hilite(5614)" onMouseOut="lolite()" onClick="logVariable('delimiter')" href="../../../_variables/delimiter.html">$delimiter</a> = '';
<a name="l1038"><span class="linenum">1038</span></a>  
<a name="l1039"><span class="linenum">1039</span></a>          <a class="var it454" onMouseOver="hilite(454)" onMouseOut="lolite()" onClick="logVariable('answers')" href="../../../_variables/answers.html">$answers</a> = <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('options')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;answers;
<a name="l1040"><span class="linenum">1040</span></a>  
<a name="l1041"><span class="linenum">1041</span></a>          foreach (<a class="var it454" onMouseOver="hilite(454)" onMouseOut="lolite()" onClick="logVariable('answers')" href="../../../_variables/answers.html">$answers</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a> =&gt; <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>) {
<a name="l1042"><span class="linenum">1042</span></a>              <a class="var it3173" onMouseOver="hilite(3173)" onMouseOut="lolite()" onClick="logVariable('ans')" href="../../../_variables/ans.html">$ans</a> = <a class="function" onClick="logFunction('shorten_text')" href="../../../_functions/shorten_text.html" onMouseOver="funcPopup(event,'shorten_text')">shorten_text</a>(<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('answer')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a>, 17, true);
<a name="l1043"><span class="linenum">1043</span></a>              <a class="var it13073" onMouseOver="hilite(13073)" onMouseOut="lolite()" onClick="logVariable('strheader')" href="../../../_variables/strheader.html">$strheader</a> .= <a class="var it5614" onMouseOver="hilite(5614)" onMouseOut="lolite()" onClick="logVariable('delimiter')" href="../../../_variables/delimiter.html">$delimiter</a>.<a class="var it3173" onMouseOver="hilite(3173)" onMouseOut="lolite()" onClick="logVariable('ans')" href="../../../_variables/ans.html">$ans</a>;
<a name="l1044"><span class="linenum">1044</span></a>              <a class="var it5614" onMouseOver="hilite(5614)" onMouseOut="lolite()" onClick="logVariable('delimiter')" href="../../../_variables/delimiter.html">$delimiter</a> = '&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;';
<a name="l1045"><span class="linenum">1045</span></a>          }
<a name="l1046"><span class="linenum">1046</span></a>          return <a class="var it13073" onMouseOver="hilite(13073)" onMouseOut="lolite()" onClick="logVariable('strheader')" href="../../../_variables/strheader.html">$strheader</a>;
<a name="l1047"><span class="linenum">1047</span></a>      }
<a name="l1048"><span class="linenum">1048</span></a>  
<a name="l1049"><span class="linenum">1049</span></a>      public function <a class="function" onClick="logFunction('comment_on_datasetitems')" href="../../../_functions/comment_on_datasetitems.html" onMouseOver="funcPopup(event,'comment_on_datasetitems')">comment_on_datasetitems</a>(<a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('qtypeobj')" href="../../../_variables/qtypeobj.html">$qtypeobj</a>, <a class="var it530" onMouseOver="hilite(530)" onMouseOut="lolite()" onClick="logVariable('questionid')" href="../../../_variables/questionid.html">$questionid</a>, <a class="var it446" onMouseOver="hilite(446)" onMouseOut="lolite()" onClick="logVariable('questiontext')" href="../../../_variables/questiontext.html">$questiontext</a>,
<a name="l1050"><span class="linenum">1050</span></a>              <a class="var it454" onMouseOver="hilite(454)" onMouseOut="lolite()" onClick="logVariable('answers')" href="../../../_variables/answers.html">$answers</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../_variables/data.html">$data</a>, <a class="var it548" onMouseOver="hilite(548)" onMouseOut="lolite()" onClick="logVariable('number')" href="../../../_variables/number.html">$number</a>) {
<a name="l1051"><span class="linenum">1051</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1052"><span class="linenum">1052</span></a>          <a class="var it298" onMouseOver="hilite(298)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../../_variables/comment.html">$comment</a> = new stdClass();
<a name="l1053"><span class="linenum">1053</span></a>          <a class="var it298" onMouseOver="hilite(298)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../../_variables/comment.html">$comment</a>-&gt;<a onClick="logVariable('stranswers')" class="var it43200" onMouseOver="hilite(43200)" onMouseOut="lolite()" href="../../../_variables/stranswers.html">stranswers</a> = array();
<a name="l1054"><span class="linenum">1054</span></a>          <a class="var it298" onMouseOver="hilite(298)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../../_variables/comment.html">$comment</a>-&gt;<a onClick="logVariable('outsidelimit')" class="var it43200" onMouseOver="hilite(43200)" onMouseOut="lolite()" href="../../../_variables/outsidelimit.html">outsidelimit</a> = false;
<a name="l1055"><span class="linenum">1055</span></a>          <a class="var it298" onMouseOver="hilite(298)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../../_variables/comment.html">$comment</a>-&gt;<a onClick="logVariable('answers')" class="var it43200" onMouseOver="hilite(43200)" onMouseOut="lolite()" href="../../../_variables/answers.html">answers</a> = array();
<a name="l1056"><span class="linenum">1056</span></a>  <span class="comment">        // Find a default unit.</span>
<a name="l1057"><span class="linenum">1057</span></a>          if (!empty(<a class="var it530" onMouseOver="hilite(530)" onMouseOut="lolite()" onClick="logVariable('questionid')" href="../../../_variables/questionid.html">$questionid</a>) &amp;&amp; <a class="var it4171" onMouseOver="hilite(4171)" onMouseOut="lolite()" onClick="logVariable('unit')" href="../../../_variables/unit.html">$unit</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('question_numerical_units',
<a name="l1058"><span class="linenum">1058</span></a>                  array('question' =&gt; <a class="var it530" onMouseOver="hilite(530)" onMouseOut="lolite()" onClick="logVariable('questionid')" href="../../../_variables/questionid.html">$questionid</a>, 'multiplier' =&gt; 1.0))) {
<a name="l1059"><span class="linenum">1059</span></a>              <a class="var it4171" onMouseOver="hilite(4171)" onMouseOut="lolite()" onClick="logVariable('unit')" href="../../../_variables/unit.html">$unit</a> = <a class="var it4171" onMouseOver="hilite(4171)" onMouseOut="lolite()" onClick="logVariable('unit')" href="../../../_variables/unit.html">$unit</a>-&gt;<a onClick="logVariable('unit')" class="var it43332" onMouseOver="hilite(43332)" onMouseOut="lolite()" href="../../../_variables/unit.html">unit</a>;
<a name="l1060"><span class="linenum">1060</span></a>          } else {
<a name="l1061"><span class="linenum">1061</span></a>              <a class="var it4171" onMouseOver="hilite(4171)" onMouseOut="lolite()" onClick="logVariable('unit')" href="../../../_variables/unit.html">$unit</a> = '';
<a name="l1062"><span class="linenum">1062</span></a>          }
<a name="l1063"><span class="linenum">1063</span></a>  
<a name="l1064"><span class="linenum">1064</span></a>          <a class="var it454" onMouseOver="hilite(454)" onMouseOut="lolite()" onClick="logVariable('answers')" href="../../../_variables/answers.html">$answers</a> = <a class="function" onClick="logFunction('fullclone')" href="../../../_functions/fullclone.html" onMouseOver="funcPopup(event,'fullclone')">fullclone</a>(<a class="var it454" onMouseOver="hilite(454)" onMouseOut="lolite()" onClick="logVariable('answers')" href="../../../_variables/answers.html">$answers</a>);
<a name="l1065"><span class="linenum">1065</span></a>          <a class="var it5614" onMouseOver="hilite(5614)" onMouseOut="lolite()" onClick="logVariable('delimiter')" href="../../../_variables/delimiter.html">$delimiter</a> = ': ';
<a name="l1066"><span class="linenum">1066</span></a>          <a class="var it13031" onMouseOver="hilite(13031)" onMouseOut="lolite()" onClick="logVariable('virtualqtype')" href="../../../_variables/virtualqtype.html">$virtualqtype</a> =  <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('qtypeobj')" href="../../../_variables/qtypeobj.html">$qtypeobj</a>-&gt;<a class="function" onClick="logFunction('get_virtual_qtype')" href="../../../_functions/get_virtual_qtype.html" onMouseOver="funcPopup(event,'get_virtual_qtype')">get_virtual_qtype</a>();
<a name="l1067"><span class="linenum">1067</span></a>          foreach (<a class="var it454" onMouseOver="hilite(454)" onMouseOut="lolite()" onClick="logVariable('answers')" href="../../../_variables/answers.html">$answers</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a> =&gt; <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>) {
<a name="l1068"><span class="linenum">1068</span></a>              <a class="var it275" onMouseOver="hilite(275)" onMouseOut="lolite()" onClick="logVariable('error')" href="../../../_variables/error.html">$error</a> = <a class="function" onClick="logFunction('qtype_calculated_find_formula_errors')" href="../../../_functions/qtype_calculated_find_formula_errors.html" onMouseOver="funcPopup(event,'qtype_calculated_find_formula_errors')">qtype_calculated_find_formula_errors</a>(<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('answer')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a>);
<a name="l1069"><span class="linenum">1069</span></a>              if (<a class="var it275" onMouseOver="hilite(275)" onMouseOut="lolite()" onClick="logVariable('error')" href="../../../_variables/error.html">$error</a>) {
<a name="l1070"><span class="linenum">1070</span></a>                  <a class="var it298" onMouseOver="hilite(298)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../../_variables/comment.html">$comment</a>-&gt;<a onClick="logVariable('stranswers')" class="var it43200" onMouseOver="hilite(43200)" onMouseOut="lolite()" href="../../../_variables/stranswers.html">stranswers</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] = <a class="var it275" onMouseOver="hilite(275)" onMouseOut="lolite()" onClick="logVariable('error')" href="../../../_variables/error.html">$error</a>;
<a name="l1071"><span class="linenum">1071</span></a>                  continue;
<a name="l1072"><span class="linenum">1072</span></a>              }
<a name="l1073"><span class="linenum">1073</span></a>              <a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('substitute_variables')" href="../../../_functions/substitute_variables.html" onMouseOver="funcPopup(event,'substitute_variables')">substitute_variables</a>(<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('answer')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../_variables/data.html">$data</a>);
<a name="l1074"><span class="linenum">1074</span></a>              <a class="var it13076" onMouseOver="hilite(13076)" onMouseOut="lolite()" onClick="logVariable('formattedanswer')" href="../../../_variables/formattedanswer.html">$formattedanswer</a> = <a class="function" onClick="logFunction('qtype_calculated_calculate_answer')" href="../../../_functions/qtype_calculated_calculate_answer.html" onMouseOver="funcPopup(event,'qtype_calculated_calculate_answer')">qtype_calculated_calculate_answer</a>(
<a name="l1075"><span class="linenum">1075</span></a>                  <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('answer')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../_variables/data.html">$data</a>, <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('tolerance')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/tolerance.html">tolerance</a>,
<a name="l1076"><span class="linenum">1076</span></a>                  <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('tolerancetype')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/tolerancetype.html">tolerancetype</a>, <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('correctanswerlength')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/correctanswerlength.html">correctanswerlength</a>,
<a name="l1077"><span class="linenum">1077</span></a>                  <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('correctanswerformat')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/correctanswerformat.html">correctanswerformat</a>, <a class="var it4171" onMouseOver="hilite(4171)" onMouseOut="lolite()" onClick="logVariable('unit')" href="../../../_variables/unit.html">$unit</a>);
<a name="l1078"><span class="linenum">1078</span></a>              if (<a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a> === '*') {
<a name="l1079"><span class="linenum">1079</span></a>                  <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('min')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/min.html">min</a> = ' ';
<a name="l1080"><span class="linenum">1080</span></a>                  <a class="var it13076" onMouseOver="hilite(13076)" onMouseOut="lolite()" onClick="logVariable('formattedanswer')" href="../../../_variables/formattedanswer.html">$formattedanswer</a>-&gt;<a onClick="logVariable('answer')" class="var it44021" onMouseOver="hilite(44021)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a> = <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('answer')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a>;
<a name="l1081"><span class="linenum">1081</span></a>              } else {
<a name="l1082"><span class="linenum">1082</span></a>                  eval('<a class="var it12170" onMouseOver="hilite(12170)" onMouseOut="lolite()" onClick="logVariable('ansvalue')" href="../../../_variables/ansvalue.html">$ansvalue</a> = '.<a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a>.';');
<a name="l1083"><span class="linenum">1083</span></a>                  <a class="var it3173" onMouseOver="hilite(3173)" onMouseOut="lolite()" onClick="logVariable('ans')" href="../../../_variables/ans.html">$ans</a> = <span class="keyword">new </span><a class="class" onClick="logClass('qtype_numerical_answer')" href="../../../_classes/qtype_numerical_answer.html" onMouseOver="classPopup(event,'qtype_numerical_answer')">qtype_numerical_answer</a>(0, <a class="var it12170" onMouseOver="hilite(12170)" onMouseOut="lolite()" onClick="logVariable('ansvalue')" href="../../../_variables/ansvalue.html">$ansvalue</a>, 0, '', 0, <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('tolerance')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/tolerance.html">tolerance</a>);
<a name="l1084"><span class="linenum">1084</span></a>                  <a class="var it3173" onMouseOver="hilite(3173)" onMouseOut="lolite()" onClick="logVariable('ans')" href="../../../_variables/ans.html">$ans</a>-&gt;<a onClick="logVariable('tolerancetype')" class="var it43333" onMouseOver="hilite(43333)" onMouseOut="lolite()" href="../../../_variables/tolerancetype.html">tolerancetype</a> = <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('tolerancetype')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/tolerancetype.html">tolerancetype</a>;
<a name="l1085"><span class="linenum">1085</span></a>                  <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('min')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/min.html">min</a>, <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('max')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/max.html">max</a>) = <a class="var it3173" onMouseOver="hilite(3173)" onMouseOut="lolite()" onClick="logVariable('ans')" href="../../../_variables/ans.html">$ans</a>-&gt;<a class="function" onClick="logFunction('get_tolerance_interval')" href="../../../_functions/get_tolerance_interval.html" onMouseOver="funcPopup(event,'get_tolerance_interval')">get_tolerance_interval</a>(<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>);
<a name="l1086"><span class="linenum">1086</span></a>              }
<a name="l1087"><span class="linenum">1087</span></a>              if (<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('min')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/min.html">min</a> === '') {
<a name="l1088"><span class="linenum">1088</span></a>  <span class="comment">                // This should mean that something is wrong.</span>
<a name="l1089"><span class="linenum">1089</span></a>                  <a class="var it298" onMouseOver="hilite(298)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../../_variables/comment.html">$comment</a>-&gt;<a onClick="logVariable('stranswers')" class="var it43200" onMouseOver="hilite(43200)" onMouseOut="lolite()" href="../../../_variables/stranswers.html">stranswers</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] = &quot; {<a class="var it13076" onMouseOver="hilite(13076)" onMouseOut="lolite()" onClick="logVariable('formattedanswer')" href="../../../_variables/formattedanswer.html">$formattedanswer</a>-&gt;<a onClick="logVariable('answer')" class="var it44021" onMouseOver="hilite(44021)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a>}&quot;.'&lt;br/&gt;&lt;br/&gt;';
<a name="l1090"><span class="linenum">1090</span></a>              } else if (<a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a> === '*') {
<a name="l1091"><span class="linenum">1091</span></a>                  <a class="var it298" onMouseOver="hilite(298)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../../_variables/comment.html">$comment</a>-&gt;<a onClick="logVariable('stranswers')" class="var it43200" onMouseOver="hilite(43200)" onMouseOut="lolite()" href="../../../_variables/stranswers.html">stranswers</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] = <a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a> . ' = ' .
<a name="l1092"><span class="linenum">1092</span></a>                          <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('anyvalue', 'qtype_calculated') . '&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;';
<a name="l1093"><span class="linenum">1093</span></a>              } else {
<a name="l1094"><span class="linenum">1094</span></a>                  <a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a> = <a class="function" onClick="logFunction('shorten_text')" href="../../../_functions/shorten_text.html" onMouseOver="funcPopup(event,'shorten_text')">shorten_text</a>(<a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a>, 57, true);
<a name="l1095"><span class="linenum">1095</span></a>                  <a class="var it298" onMouseOver="hilite(298)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../../_variables/comment.html">$comment</a>-&gt;<a onClick="logVariable('stranswers')" class="var it43200" onMouseOver="hilite(43200)" onMouseOut="lolite()" href="../../../_variables/stranswers.html">stranswers</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] = <a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a> . ' = ' . <a class="var it13076" onMouseOver="hilite(13076)" onMouseOut="lolite()" onClick="logVariable('formattedanswer')" href="../../../_variables/formattedanswer.html">$formattedanswer</a>-&gt;<a onClick="logVariable('answer')" class="var it44021" onMouseOver="hilite(44021)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a> . '&lt;br/&gt;';
<a name="l1096"><span class="linenum">1096</span></a>                  <a class="var it13077" onMouseOver="hilite(13077)" onMouseOut="lolite()" onClick="logVariable('correcttrue')" href="../../../_variables/correcttrue.html">$correcttrue</a> = new stdClass();
<a name="l1097"><span class="linenum">1097</span></a>                  <a class="var it13077" onMouseOver="hilite(13077)" onMouseOut="lolite()" onClick="logVariable('correcttrue')" href="../../../_variables/correcttrue.html">$correcttrue</a>-&gt;<a onClick="logVariable('correct')" class="var it44022" onMouseOver="hilite(44022)" onMouseOut="lolite()" href="../../../_variables/correct.html">correct</a> = <a class="var it13076" onMouseOver="hilite(13076)" onMouseOut="lolite()" onClick="logVariable('formattedanswer')" href="../../../_variables/formattedanswer.html">$formattedanswer</a>-&gt;<a onClick="logVariable('answer')" class="var it44021" onMouseOver="hilite(44021)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a>;
<a name="l1098"><span class="linenum">1098</span></a>                  <a class="var it13077" onMouseOver="hilite(13077)" onMouseOut="lolite()" onClick="logVariable('correcttrue')" href="../../../_variables/correcttrue.html">$correcttrue</a>-&gt;<a onClick="logVariable('true')" class="var it44022" onMouseOver="hilite(44022)" onMouseOut="lolite()" href="../../../_variables/true.html">true</a> = '';
<a name="l1099"><span class="linenum">1099</span></a>                  if (<a class="var it13076" onMouseOver="hilite(13076)" onMouseOut="lolite()" onClick="logVariable('formattedanswer')" href="../../../_variables/formattedanswer.html">$formattedanswer</a>-&gt;<a onClick="logVariable('answer')" class="var it44021" onMouseOver="hilite(44021)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a> &lt; <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('min')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/min.html">min</a> ||
<a name="l1100"><span class="linenum">1100</span></a>                          <a class="var it13076" onMouseOver="hilite(13076)" onMouseOut="lolite()" onClick="logVariable('formattedanswer')" href="../../../_variables/formattedanswer.html">$formattedanswer</a>-&gt;<a onClick="logVariable('answer')" class="var it44021" onMouseOver="hilite(44021)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a> &gt; <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('max')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/max.html">max</a>) {
<a name="l1101"><span class="linenum">1101</span></a>                      <a class="var it298" onMouseOver="hilite(298)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../../_variables/comment.html">$comment</a>-&gt;<a onClick="logVariable('outsidelimit')" class="var it43200" onMouseOver="hilite(43200)" onMouseOut="lolite()" href="../../../_variables/outsidelimit.html">outsidelimit</a> = true;
<a name="l1102"><span class="linenum">1102</span></a>                      <a class="var it298" onMouseOver="hilite(298)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../../_variables/comment.html">$comment</a>-&gt;<a onClick="logVariable('answers')" class="var it43200" onMouseOver="hilite(43200)" onMouseOut="lolite()" href="../../../_variables/answers.html">answers</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] = <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>;
<a name="l1103"><span class="linenum">1103</span></a>                      <a class="var it298" onMouseOver="hilite(298)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../../_variables/comment.html">$comment</a>-&gt;<a onClick="logVariable('stranswers')" class="var it43200" onMouseOver="hilite(43200)" onMouseOut="lolite()" href="../../../_variables/stranswers.html">stranswers</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] .=
<a name="l1104"><span class="linenum">1104</span></a>                              <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('trueansweroutsidelimits', 'qtype_calculated', <a class="var it13077" onMouseOver="hilite(13077)" onMouseOut="lolite()" onClick="logVariable('correcttrue')" href="../../../_variables/correcttrue.html">$correcttrue</a>);
<a name="l1105"><span class="linenum">1105</span></a>                  } else {
<a name="l1106"><span class="linenum">1106</span></a>                      <a class="var it298" onMouseOver="hilite(298)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../../_variables/comment.html">$comment</a>-&gt;<a onClick="logVariable('stranswers')" class="var it43200" onMouseOver="hilite(43200)" onMouseOut="lolite()" href="../../../_variables/stranswers.html">stranswers</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] .=
<a name="l1107"><span class="linenum">1107</span></a>                              <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('trueanswerinsidelimits', 'qtype_calculated', <a class="var it13077" onMouseOver="hilite(13077)" onMouseOut="lolite()" onClick="logVariable('correcttrue')" href="../../../_variables/correcttrue.html">$correcttrue</a>);
<a name="l1108"><span class="linenum">1108</span></a>                  }
<a name="l1109"><span class="linenum">1109</span></a>                  <a class="var it298" onMouseOver="hilite(298)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../../_variables/comment.html">$comment</a>-&gt;<a onClick="logVariable('stranswers')" class="var it43200" onMouseOver="hilite(43200)" onMouseOut="lolite()" href="../../../_variables/stranswers.html">stranswers</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] .= '&lt;br/&gt;';
<a name="l1110"><span class="linenum">1110</span></a>                  <a class="var it298" onMouseOver="hilite(298)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../../_variables/comment.html">$comment</a>-&gt;<a onClick="logVariable('stranswers')" class="var it43200" onMouseOver="hilite(43200)" onMouseOut="lolite()" href="../../../_variables/stranswers.html">stranswers</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] .= <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('min', 'qtype_calculated') .
<a name="l1111"><span class="linenum">1111</span></a>                          <a class="var it5614" onMouseOver="hilite(5614)" onMouseOut="lolite()" onClick="logVariable('delimiter')" href="../../../_variables/delimiter.html">$delimiter</a> . <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('min')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/min.html">min</a> . ' --- ';
<a name="l1112"><span class="linenum">1112</span></a>                  <a class="var it298" onMouseOver="hilite(298)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../../_variables/comment.html">$comment</a>-&gt;<a onClick="logVariable('stranswers')" class="var it43200" onMouseOver="hilite(43200)" onMouseOut="lolite()" href="../../../_variables/stranswers.html">stranswers</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] .= <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('max', 'qtype_calculated') .
<a name="l1113"><span class="linenum">1113</span></a>                          <a class="var it5614" onMouseOver="hilite(5614)" onMouseOut="lolite()" onClick="logVariable('delimiter')" href="../../../_variables/delimiter.html">$delimiter</a> . <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('max')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/max.html">max</a>;
<a name="l1114"><span class="linenum">1114</span></a>              }
<a name="l1115"><span class="linenum">1115</span></a>          }
<a name="l1116"><span class="linenum">1116</span></a>          return <a class="function" onClick="logFunction('fullclone')" href="../../../_functions/fullclone.html" onMouseOver="funcPopup(event,'fullclone')">fullclone</a>(<a class="var it298" onMouseOver="hilite(298)" onMouseOut="lolite()" onClick="logVariable('comment')" href="../../../_variables/comment.html">$comment</a>);
<a name="l1117"><span class="linenum">1117</span></a>      }
<a name="l1118"><span class="linenum">1118</span></a>  
<a name="l1119"><span class="linenum">1119</span></a>      public function <a class="function" onClick="logFunction('tolerance_types')" href="../../../_functions/tolerance_types.html" onMouseOver="funcPopup(event,'tolerance_types')">tolerance_types</a>() {
<a name="l1120"><span class="linenum">1120</span></a>          return array(
<a name="l1121"><span class="linenum">1121</span></a>              '1' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('relative', 'qtype_numerical'),
<a name="l1122"><span class="linenum">1122</span></a>              '2' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('nominal', 'qtype_numerical'),
<a name="l1123"><span class="linenum">1123</span></a>              '3' =&gt; <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('geometric', 'qtype_numerical')
<a name="l1124"><span class="linenum">1124</span></a>          );
<a name="l1125"><span class="linenum">1125</span></a>      }
<a name="l1126"><span class="linenum">1126</span></a>  
<a name="l1127"><span class="linenum">1127</span></a>      public function <a class="function" onClick="logFunction('dataset_options')" href="../../../_functions/dataset_options.html" onMouseOver="funcPopup(event,'dataset_options')">dataset_options</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>, <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../../_variables/name.html">$name</a>, <a class="var it13078" onMouseOver="hilite(13078)" onMouseOut="lolite()" onClick="logVariable('mandatory')" href="../../../_variables/mandatory.html">$mandatory</a> = true,
<a name="l1128"><span class="linenum">1128</span></a>              <a class="var it13079" onMouseOver="hilite(13079)" onMouseOut="lolite()" onClick="logVariable('renameabledatasets')" href="../../../_variables/renameabledatasets.html">$renameabledatasets</a> = false) {
<a name="l1129"><span class="linenum">1129</span></a>  <span class="comment">        // Takes datasets from the parent implementation but</span>
<a name="l1130"><span class="linenum">1130</span></a>  <span class="comment">        // filters options that are currently not accepted by calculated.</span>
<a name="l1131"><span class="linenum">1131</span></a>  <span class="comment">        // It also determines a default selection.</span>
<a name="l1132"><span class="linenum">1132</span></a>  <span class="comment">        // Param $renameabledatasets not implemented anywhere.</span>
<a name="l1133"><span class="linenum">1133</span></a>  
<a name="l1134"><span class="linenum">1134</span></a>          <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>, <a class="var it569" onMouseOver="hilite(569)" onMouseOut="lolite()" onClick="logVariable('selected')" href="../../../_variables/selected.html">$selected</a>) = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dataset_options_from_database')" href="../../../_functions/dataset_options_from_database.html" onMouseOver="funcPopup(event,'dataset_options_from_database')">dataset_options_from_database</a>(
<a name="l1135"><span class="linenum">1135</span></a>                  <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>, <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../../_variables/name.html">$name</a>, '', 'qtype_calculated');
<a name="l1136"><span class="linenum">1136</span></a>  
<a name="l1137"><span class="linenum">1137</span></a>          foreach (<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a> =&gt; <a class="var it13080" onMouseOver="hilite(13080)" onMouseOut="lolite()" onClick="logVariable('whatever')" href="../../../_variables/whatever.html">$whatever</a>) {
<a name="l1138"><span class="linenum">1138</span></a>              if (!<a class="phpfunction" onClick="logFunction('preg_match')" href="../../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('~^1-~', <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>) &amp;&amp; <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a> != '0') {
<a name="l1139"><span class="linenum">1139</span></a>                  unset(<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>]);
<a name="l1140"><span class="linenum">1140</span></a>              }
<a name="l1141"><span class="linenum">1141</span></a>          }
<a name="l1142"><span class="linenum">1142</span></a>          if (!<a class="var it569" onMouseOver="hilite(569)" onMouseOut="lolite()" onClick="logVariable('selected')" href="../../../_variables/selected.html">$selected</a>) {
<a name="l1143"><span class="linenum">1143</span></a>              if (<a class="var it13078" onMouseOver="hilite(13078)" onMouseOut="lolite()" onClick="logVariable('mandatory')" href="../../../_variables/mandatory.html">$mandatory</a>) {
<a name="l1144"><span class="linenum">1144</span></a>                  <a class="var it569" onMouseOver="hilite(569)" onMouseOut="lolite()" onClick="logVariable('selected')" href="../../../_variables/selected.html">$selected</a> =  &quot;1-0-{<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../../_variables/name.html">$name</a>}&quot;; <span class="comment">// Default.</span>
<a name="l1145"><span class="linenum">1145</span></a>              } else {
<a name="l1146"><span class="linenum">1146</span></a>                  <a class="var it569" onMouseOver="hilite(569)" onMouseOut="lolite()" onClick="logVariable('selected')" href="../../../_variables/selected.html">$selected</a> = '0'; <span class="comment">// Default.</span>
<a name="l1147"><span class="linenum">1147</span></a>              }
<a name="l1148"><span class="linenum">1148</span></a>          }
<a name="l1149"><span class="linenum">1149</span></a>          return array(<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>, <a class="var it569" onMouseOver="hilite(569)" onMouseOut="lolite()" onClick="logVariable('selected')" href="../../../_variables/selected.html">$selected</a>);
<a name="l1150"><span class="linenum">1150</span></a>      }
<a name="l1151"><span class="linenum">1151</span></a>  
<a name="l1152"><span class="linenum">1152</span></a>      public function <a class="function" onClick="logFunction('construct_dataset_menus')" href="../../../_functions/construct_dataset_menus.html" onMouseOver="funcPopup(event,'construct_dataset_menus')">construct_dataset_menus</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>, <a class="var it11520" onMouseOver="hilite(11520)" onMouseOut="lolite()" onClick="logVariable('mandatorydatasets')" href="../../../_variables/mandatorydatasets.html">$mandatorydatasets</a>,
<a name="l1153"><span class="linenum">1153</span></a>              <a class="var it13081" onMouseOver="hilite(13081)" onMouseOut="lolite()" onClick="logVariable('optionaldatasets')" href="../../../_variables/optionaldatasets.html">$optionaldatasets</a>) {
<a name="l1154"><span class="linenum">1154</span></a>          global <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l1155"><span class="linenum">1155</span></a>          <a class="var it11892" onMouseOver="hilite(11892)" onMouseOut="lolite()" onClick="logVariable('datasetmenus')" href="../../../_variables/datasetmenus.html">$datasetmenus</a> = array();
<a name="l1156"><span class="linenum">1156</span></a>          foreach (<a class="var it11520" onMouseOver="hilite(11520)" onMouseOut="lolite()" onClick="logVariable('mandatorydatasets')" href="../../../_variables/mandatorydatasets.html">$mandatorydatasets</a> as <a class="var it11894" onMouseOver="hilite(11894)" onMouseOut="lolite()" onClick="logVariable('datasetname')" href="../../../_variables/datasetname.html">$datasetname</a>) {
<a name="l1157"><span class="linenum">1157</span></a>              if (!isset(<a class="var it11892" onMouseOver="hilite(11892)" onMouseOut="lolite()" onClick="logVariable('datasetmenus')" href="../../../_variables/datasetmenus.html">$datasetmenus</a>[<a class="var it11894" onMouseOver="hilite(11894)" onMouseOut="lolite()" onClick="logVariable('datasetname')" href="../../../_variables/datasetname.html">$datasetname</a>])) {
<a name="l1158"><span class="linenum">1158</span></a>                  <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>, <a class="var it569" onMouseOver="hilite(569)" onMouseOut="lolite()" onClick="logVariable('selected')" href="../../../_variables/selected.html">$selected</a>) =
<a name="l1159"><span class="linenum">1159</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dataset_options')" href="../../../_functions/dataset_options.html" onMouseOver="funcPopup(event,'dataset_options')">dataset_options</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>, <a class="var it11894" onMouseOver="hilite(11894)" onMouseOut="lolite()" onClick="logVariable('datasetname')" href="../../../_variables/datasetname.html">$datasetname</a>);
<a name="l1160"><span class="linenum">1160</span></a>                  unset(<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>['0']); <span class="comment">// Mandatory...</span>
<a name="l1161"><span class="linenum">1161</span></a>                  <a class="var it11892" onMouseOver="hilite(11892)" onMouseOut="lolite()" onClick="logVariable('datasetmenus')" href="../../../_variables/datasetmenus.html">$datasetmenus</a>[<a class="var it11894" onMouseOver="hilite(11894)" onMouseOut="lolite()" onClick="logVariable('datasetname')" href="../../../_variables/datasetname.html">$datasetname</a>] = <a class="class" onClick="logClass('html_writer')" href="../../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('select')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">select</a>(
<a name="l1162"><span class="linenum">1162</span></a>                          <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>, 'dataset[]', <a class="var it569" onMouseOver="hilite(569)" onMouseOut="lolite()" onClick="logVariable('selected')" href="../../../_variables/selected.html">$selected</a>, null);
<a name="l1163"><span class="linenum">1163</span></a>              }
<a name="l1164"><span class="linenum">1164</span></a>          }
<a name="l1165"><span class="linenum">1165</span></a>          foreach (<a class="var it13081" onMouseOver="hilite(13081)" onMouseOut="lolite()" onClick="logVariable('optionaldatasets')" href="../../../_variables/optionaldatasets.html">$optionaldatasets</a> as <a class="var it11894" onMouseOver="hilite(11894)" onMouseOut="lolite()" onClick="logVariable('datasetname')" href="../../../_variables/datasetname.html">$datasetname</a>) {
<a name="l1166"><span class="linenum">1166</span></a>              if (!isset(<a class="var it11892" onMouseOver="hilite(11892)" onMouseOut="lolite()" onClick="logVariable('datasetmenus')" href="../../../_variables/datasetmenus.html">$datasetmenus</a>[<a class="var it11894" onMouseOver="hilite(11894)" onMouseOut="lolite()" onClick="logVariable('datasetname')" href="../../../_variables/datasetname.html">$datasetname</a>])) {
<a name="l1167"><span class="linenum">1167</span></a>                  <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>, <a class="var it569" onMouseOver="hilite(569)" onMouseOut="lolite()" onClick="logVariable('selected')" href="../../../_variables/selected.html">$selected</a>) =
<a name="l1168"><span class="linenum">1168</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dataset_options')" href="../../../_functions/dataset_options.html" onMouseOver="funcPopup(event,'dataset_options')">dataset_options</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>, <a class="var it11894" onMouseOver="hilite(11894)" onMouseOut="lolite()" onClick="logVariable('datasetname')" href="../../../_variables/datasetname.html">$datasetname</a>);
<a name="l1169"><span class="linenum">1169</span></a>                  <a class="var it11892" onMouseOver="hilite(11892)" onMouseOut="lolite()" onClick="logVariable('datasetmenus')" href="../../../_variables/datasetmenus.html">$datasetmenus</a>[<a class="var it11894" onMouseOver="hilite(11894)" onMouseOut="lolite()" onClick="logVariable('datasetname')" href="../../../_variables/datasetname.html">$datasetname</a>] = <a class="class" onClick="logClass('html_writer')" href="../../../_classes/html_writer.html" onMouseOver="classPopup(event,'html_writer')">html_writer</a>::<a class="function" onClick="logFunction('select')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">select</a>(
<a name="l1170"><span class="linenum">1170</span></a>                          <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>, 'dataset[]', <a class="var it569" onMouseOver="hilite(569)" onMouseOut="lolite()" onClick="logVariable('selected')" href="../../../_variables/selected.html">$selected</a>, null);
<a name="l1171"><span class="linenum">1171</span></a>              }
<a name="l1172"><span class="linenum">1172</span></a>          }
<a name="l1173"><span class="linenum">1173</span></a>          return <a class="var it11892" onMouseOver="hilite(11892)" onMouseOut="lolite()" onClick="logVariable('datasetmenus')" href="../../../_variables/datasetmenus.html">$datasetmenus</a>;
<a name="l1174"><span class="linenum">1174</span></a>      }
<a name="l1175"><span class="linenum">1175</span></a>  
<a name="l1176"><span class="linenum">1176</span></a>      public function <a class="function" onClick="logFunction('substitute_variables')" href="../../../_functions/substitute_variables.html" onMouseOver="funcPopup(event,'substitute_variables')">substitute_variables</a>(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../../_variables/str.html">$str</a>, <a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>) {
<a name="l1177"><span class="linenum">1177</span></a>          global <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../../_variables/OUTPUT.html">$OUTPUT</a>;
<a name="l1178"><span class="linenum">1178</span></a>  <span class="comment">        // Testing for wrong numerical values.</span>
<a name="l1179"><span class="linenum">1179</span></a>  <span class="comment">        // All calculations used this function so testing here should be OK.</span>
<a name="l1180"><span class="linenum">1180</span></a>  
<a name="l1181"><span class="linenum">1181</span></a>          foreach (<a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a> as <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../../_variables/name.html">$name</a> =&gt; <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../../_variables/value.html">$value</a>) {
<a name="l1182"><span class="linenum">1182</span></a>              <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('val')" href="../../../_variables/val.html">$val</a> = <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../../_variables/value.html">$value</a>;
<a name="l1183"><span class="linenum">1183</span></a>              if (! <a class="phpfunction" onClick="logFunction('is_numeric')" href="../../../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('val')" href="../../../_variables/val.html">$val</a>)) {
<a name="l1184"><span class="linenum">1184</span></a>                  <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../../_variables/a.html">$a</a> = new stdClass();
<a name="l1185"><span class="linenum">1185</span></a>                  <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('name')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a> = '{'.<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../../_variables/name.html">$name</a>.'}';
<a name="l1186"><span class="linenum">1186</span></a>                  <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('value')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../../_variables/value.html">value</a> = <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../../_variables/value.html">$value</a>;
<a name="l1187"><span class="linenum">1187</span></a>                  echo <a class="var it212" onMouseOver="hilite(212)" onMouseOut="lolite()" onClick="logVariable('OUTPUT')" href="../../../_variables/OUTPUT.html">$OUTPUT</a>-&gt;<a class="function" onClick="logFunction('notification')" href="../../../_functions/notification.html" onMouseOver="funcPopup(event,'notification')">notification</a>(<a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('notvalidnumber', 'qtype_calculated', <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../../_variables/a.html">$a</a>));
<a name="l1188"><span class="linenum">1188</span></a>                  <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('val')" href="../../../_variables/val.html">$val</a> = 1.0;
<a name="l1189"><span class="linenum">1189</span></a>              }
<a name="l1190"><span class="linenum">1190</span></a>              if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('val')" href="../../../_variables/val.html">$val</a> &lt;= 0) { // MDL-36025 Use parentheses for &quot;-0&quot; .
<a name="l1191"><span class="linenum">1191</span></a>                  <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../../_variables/str.html">$str</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('{'.<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../../_variables/name.html">$name</a>.'}', '('.<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('val')" href="../../../_variables/val.html">$val</a>.')', <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../../_variables/str.html">$str</a>);
<a name="l1192"><span class="linenum">1192</span></a>              } else {
<a name="l1193"><span class="linenum">1193</span></a>                  <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../../_variables/str.html">$str</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>('{'.<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../../_variables/name.html">$name</a>.'}', <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('val')" href="../../../_variables/val.html">$val</a>, <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../../_variables/str.html">$str</a>);
<a name="l1194"><span class="linenum">1194</span></a>              }
<a name="l1195"><span class="linenum">1195</span></a>          }
<a name="l1196"><span class="linenum">1196</span></a>          return <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../../_variables/str.html">$str</a>;
<a name="l1197"><span class="linenum">1197</span></a>      }
<a name="l1198"><span class="linenum">1198</span></a>  
<a name="l1199"><span class="linenum">1199</span></a>      public function <a class="function" onClick="logFunction('evaluate_equations')" href="../../../_functions/evaluate_equations.html" onMouseOver="funcPopup(event,'evaluate_equations')">evaluate_equations</a>(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../../_variables/str.html">$str</a>, <a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>) {
<a name="l1200"><span class="linenum">1200</span></a>          <a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('substitute_variables')" href="../../../_functions/substitute_variables.html" onMouseOver="funcPopup(event,'substitute_variables')">substitute_variables</a>(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../../_variables/str.html">$str</a>, <a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>);
<a name="l1201"><span class="linenum">1201</span></a>          if (<a class="var it275" onMouseOver="hilite(275)" onMouseOut="lolite()" onClick="logVariable('error')" href="../../../_variables/error.html">$error</a> = <a class="function" onClick="logFunction('qtype_calculated_find_formula_errors')" href="../../../_functions/qtype_calculated_find_formula_errors.html" onMouseOver="funcPopup(event,'qtype_calculated_find_formula_errors')">qtype_calculated_find_formula_errors</a>(<a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a>)) {
<a name="l1202"><span class="linenum">1202</span></a>              return <a class="var it275" onMouseOver="hilite(275)" onMouseOut="lolite()" onClick="logVariable('error')" href="../../../_variables/error.html">$error</a>;
<a name="l1203"><span class="linenum">1203</span></a>          }
<a name="l1204"><span class="linenum">1204</span></a>          return <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../../_variables/str.html">$str</a>;
<a name="l1205"><span class="linenum">1205</span></a>      }
<a name="l1206"><span class="linenum">1206</span></a>  
<a name="l1207"><span class="linenum">1207</span></a>      public function <a class="function" onClick="logFunction('substitute_variables_and_eval')" href="../../../_functions/substitute_variables_and_eval.html" onMouseOver="funcPopup(event,'substitute_variables_and_eval')">substitute_variables_and_eval</a>(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../../_variables/str.html">$str</a>, <a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>) {
<a name="l1208"><span class="linenum">1208</span></a>          <a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('substitute_variables')" href="../../../_functions/substitute_variables.html" onMouseOver="funcPopup(event,'substitute_variables')">substitute_variables</a>(<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../../_variables/str.html">$str</a>, <a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>);
<a name="l1209"><span class="linenum">1209</span></a>          if (<a class="var it275" onMouseOver="hilite(275)" onMouseOut="lolite()" onClick="logVariable('error')" href="../../../_variables/error.html">$error</a> = <a class="function" onClick="logFunction('qtype_calculated_find_formula_errors')" href="../../../_functions/qtype_calculated_find_formula_errors.html" onMouseOver="funcPopup(event,'qtype_calculated_find_formula_errors')">qtype_calculated_find_formula_errors</a>(<a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a>)) {
<a name="l1210"><span class="linenum">1210</span></a>              return <a class="var it275" onMouseOver="hilite(275)" onMouseOut="lolite()" onClick="logVariable('error')" href="../../../_variables/error.html">$error</a>;
<a name="l1211"><span class="linenum">1211</span></a>          }
<a name="l1212"><span class="linenum">1212</span></a>  <span class="comment">        // Calculate the correct answer.</span>
<a name="l1213"><span class="linenum">1213</span></a>          if (empty(<a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a>)) {
<a name="l1214"><span class="linenum">1214</span></a>              <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../../_variables/str.html">$str</a> = '';
<a name="l1215"><span class="linenum">1215</span></a>          } else if (<a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a> === '*') {
<a name="l1216"><span class="linenum">1216</span></a>              <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../../_variables/str.html">$str</a> = '*';
<a name="l1217"><span class="linenum">1217</span></a>          } else {
<a name="l1218"><span class="linenum">1218</span></a>              <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../../_variables/str.html">$str</a> = null;
<a name="l1219"><span class="linenum">1219</span></a>              eval('<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../../_variables/str.html">$str</a> = '.<a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a>.';');
<a name="l1220"><span class="linenum">1220</span></a>          }
<a name="l1221"><span class="linenum">1221</span></a>          return <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('str')" href="../../../_variables/str.html">$str</a>;
<a name="l1222"><span class="linenum">1222</span></a>      }
<a name="l1223"><span class="linenum">1223</span></a>  
<a name="l1224"><span class="linenum">1224</span></a>      public function <a class="function" onClick="logFunction('get_dataset_definitions')" href="../../../_functions/get_dataset_definitions.html" onMouseOver="funcPopup(event,'get_dataset_definitions')">get_dataset_definitions</a>(<a class="var it530" onMouseOver="hilite(530)" onMouseOut="lolite()" onClick="logVariable('questionid')" href="../../../_variables/questionid.html">$questionid</a>, <a class="var it13082" onMouseOver="hilite(13082)" onMouseOut="lolite()" onClick="logVariable('newdatasets')" href="../../../_variables/newdatasets.html">$newdatasets</a>) {
<a name="l1225"><span class="linenum">1225</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1226"><span class="linenum">1226</span></a>  <span class="comment">        // Get the existing datasets for this question.</span>
<a name="l1227"><span class="linenum">1227</span></a>          <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a> = array();
<a name="l1228"><span class="linenum">1228</span></a>          if (!empty(<a class="var it530" onMouseOver="hilite(530)" onMouseOut="lolite()" onClick="logVariable('questionid')" href="../../../_variables/questionid.html">$questionid</a>)) {
<a name="l1229"><span class="linenum">1229</span></a>              global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>;
<a name="l1230"><span class="linenum">1230</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = &quot;SELECT i.*
<a name="l1231"><span class="linenum">1231</span></a>                        FROM {question_datasets} d, {question_dataset_definitions} i
<a name="l1232"><span class="linenum">1232</span></a>                       WHERE d.question = ? AND d.datasetdefinition = i.id
<a name="l1233"><span class="linenum">1233</span></a>                    ORDER BY i.id&quot;;
<a name="l1234"><span class="linenum">1234</span></a>              if (<a class="var it988" onMouseOver="hilite(988)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../../_variables/records.html">$records</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>, array(<a class="var it530" onMouseOver="hilite(530)" onMouseOut="lolite()" onClick="logVariable('questionid')" href="../../../_variables/questionid.html">$questionid</a>))) {
<a name="l1235"><span class="linenum">1235</span></a>                  foreach (<a class="var it988" onMouseOver="hilite(988)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../../_variables/records.html">$records</a> as <a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>) {
<a name="l1236"><span class="linenum">1236</span></a>                      <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>[&quot;{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('type')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/type.html">type</a>}-{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('category')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>}-{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('name')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>}&quot;] = <a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>;
<a name="l1237"><span class="linenum">1237</span></a>                  }
<a name="l1238"><span class="linenum">1238</span></a>              }
<a name="l1239"><span class="linenum">1239</span></a>          }
<a name="l1240"><span class="linenum">1240</span></a>  
<a name="l1241"><span class="linenum">1241</span></a>          foreach (<a class="var it13082" onMouseOver="hilite(13082)" onMouseOut="lolite()" onClick="logVariable('newdatasets')" href="../../../_variables/newdatasets.html">$newdatasets</a> as <a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>) {
<a name="l1242"><span class="linenum">1242</span></a>              if (!<a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>) {
<a name="l1243"><span class="linenum">1243</span></a>                  continue; <span class="comment">// The no dataset case...</span>
<a name="l1244"><span class="linenum">1244</span></a>              }
<a name="l1245"><span class="linenum">1245</span></a>  
<a name="l1246"><span class="linenum">1246</span></a>              if (!isset(<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>[<a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>])) {
<a name="l1247"><span class="linenum">1247</span></a>  <span class="comment">                // Make new datasetdef.</span>
<a name="l1248"><span class="linenum">1248</span></a>                  <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a>, <a class="var it261" onMouseOver="hilite(261)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../../_variables/category.html">$category</a>, <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../../_variables/name.html">$name</a>) = <a class="phpfunction" onClick="logFunction('explode')" href="../../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>('-', <a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>, 3);
<a name="l1249"><span class="linenum">1249</span></a>                  <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a> = new stdClass();
<a name="l1250"><span class="linenum">1250</span></a>                  <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('type')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/type.html">type</a> = <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a>;
<a name="l1251"><span class="linenum">1251</span></a>                  <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('name')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a> = <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../../_variables/name.html">$name</a>;
<a name="l1252"><span class="linenum">1252</span></a>                  <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('category')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>  = <a class="var it261" onMouseOver="hilite(261)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../../_variables/category.html">$category</a>;
<a name="l1253"><span class="linenum">1253</span></a>                  <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('itemcount')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/itemcount.html">itemcount</a> = 0;
<a name="l1254"><span class="linenum">1254</span></a>                  <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('options')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>   = 'uniform:1.0:10.0:1';
<a name="l1255"><span class="linenum">1255</span></a>                  <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>[<a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>] = <a class="function" onClick="logFunction('clone')" href="../../../_functions/clone.html" onMouseOver="funcPopup(event,'clone')">clone</a>(<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>);
<a name="l1256"><span class="linenum">1256</span></a>              }
<a name="l1257"><span class="linenum">1257</span></a>          }
<a name="l1258"><span class="linenum">1258</span></a>          return <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>;
<a name="l1259"><span class="linenum">1259</span></a>      }
<a name="l1260"><span class="linenum">1260</span></a>  
<a name="l1261"><span class="linenum">1261</span></a>      public function <a class="function" onClick="logFunction('save_dataset_definitions')" href="../../../_functions/save_dataset_definitions.html" onMouseOver="funcPopup(event,'save_dataset_definitions')">save_dataset_definitions</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>) {
<a name="l1262"><span class="linenum">1262</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1263"><span class="linenum">1263</span></a>  <span class="comment">        // Save synchronize.</span>
<a name="l1264"><span class="linenum">1264</span></a>  
<a name="l1265"><span class="linenum">1265</span></a>          if (empty(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('dataset')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/dataset.html">dataset</a>)) {
<a name="l1266"><span class="linenum">1266</span></a>              <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('dataset')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/dataset.html">dataset</a> = array();
<a name="l1267"><span class="linenum">1267</span></a>          }
<a name="l1268"><span class="linenum">1268</span></a>  <span class="comment">        // Save datasets.</span>
<a name="l1269"><span class="linenum">1269</span></a>          <a class="var it13083" onMouseOver="hilite(13083)" onMouseOut="lolite()" onClick="logVariable('datasetdefinitions')" href="../../../_variables/datasetdefinitions.html">$datasetdefinitions</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_dataset_definitions')" href="../../../_functions/get_dataset_definitions.html" onMouseOver="funcPopup(event,'get_dataset_definitions')">get_dataset_definitions</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('id')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('dataset')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/dataset.html">dataset</a>);
<a name="l1270"><span class="linenum">1270</span></a>          <a class="var it13084" onMouseOver="hilite(13084)" onMouseOut="lolite()" onClick="logVariable('tmpdatasets')" href="../../../_variables/tmpdatasets.html">$tmpdatasets</a> = <a class="phpfunction" onClick="logFunction('array_flip')" href="../../../_functions/array_flip.html" onMouseOver="phpfuncPopup(event,'array_flip')">array_flip</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('dataset')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/dataset.html">dataset</a>);
<a name="l1271"><span class="linenum">1271</span></a>          <a class="var it13085" onMouseOver="hilite(13085)" onMouseOut="lolite()" onClick="logVariable('defids')" href="../../../_variables/defids.html">$defids</a> = <a class="phpfunction" onClick="logFunction('array_keys')" href="../../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it13083" onMouseOver="hilite(13083)" onMouseOut="lolite()" onClick="logVariable('datasetdefinitions')" href="../../../_variables/datasetdefinitions.html">$datasetdefinitions</a>);
<a name="l1272"><span class="linenum">1272</span></a>          foreach (<a class="var it13085" onMouseOver="hilite(13085)" onMouseOut="lolite()" onClick="logVariable('defids')" href="../../../_variables/defids.html">$defids</a> as <a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a>) {
<a name="l1273"><span class="linenum">1273</span></a>              <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a> = &amp;<a class="var it13083" onMouseOver="hilite(13083)" onMouseOut="lolite()" onClick="logVariable('datasetdefinitions')" href="../../../_variables/datasetdefinitions.html">$datasetdefinitions</a>[<a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a>];
<a name="l1274"><span class="linenum">1274</span></a>              if (isset(<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>)) {
<a name="l1275"><span class="linenum">1275</span></a>                  if (!isset(<a class="var it13084" onMouseOver="hilite(13084)" onMouseOut="lolite()" onClick="logVariable('tmpdatasets')" href="../../../_variables/tmpdatasets.html">$tmpdatasets</a>[<a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a>])) {
<a name="l1276"><span class="linenum">1276</span></a>  <span class="comment">                    // This dataset is not used any more, delete it.</span>
<a name="l1277"><span class="linenum">1277</span></a>                      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('question_datasets',
<a name="l1278"><span class="linenum">1278</span></a>                              array('question' =&gt; <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('id')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, 'datasetdefinition' =&gt; <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l1279"><span class="linenum">1279</span></a>                      if (<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('category')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a> == 0) {
<a name="l1280"><span class="linenum">1280</span></a>  <span class="comment">                        // Question local dataset.</span>
<a name="l1281"><span class="linenum">1281</span></a>                          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('question_dataset_definitions',
<a name="l1282"><span class="linenum">1282</span></a>                                  array('id' =&gt; <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l1283"><span class="linenum">1283</span></a>                          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('question_dataset_items',
<a name="l1284"><span class="linenum">1284</span></a>                                  array('definition' =&gt; <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l1285"><span class="linenum">1285</span></a>                      }
<a name="l1286"><span class="linenum">1286</span></a>                  }
<a name="l1287"><span class="linenum">1287</span></a>  <span class="comment">                // This has already been saved or just got deleted.</span>
<a name="l1288"><span class="linenum">1288</span></a>                  unset(<a class="var it13083" onMouseOver="hilite(13083)" onMouseOut="lolite()" onClick="logVariable('datasetdefinitions')" href="../../../_variables/datasetdefinitions.html">$datasetdefinitions</a>[<a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a>]);
<a name="l1289"><span class="linenum">1289</span></a>                  continue;
<a name="l1290"><span class="linenum">1290</span></a>              }
<a name="l1291"><span class="linenum">1291</span></a>  
<a name="l1292"><span class="linenum">1292</span></a>              <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('question_dataset_definitions', <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>);
<a name="l1293"><span class="linenum">1293</span></a>  
<a name="l1294"><span class="linenum">1294</span></a>              if (0 != <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('category')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>) {
<a name="l1295"><span class="linenum">1295</span></a>  <span class="comment">                // We need to look for already existing datasets in the category.</span>
<a name="l1296"><span class="linenum">1296</span></a>  <span class="comment">                // First creating the datasetdefinition above</span>
<a name="l1297"><span class="linenum">1297</span></a>  <span class="comment">                // then we can manage to automatically take care of some possible realtime concurrence.</span>
<a name="l1298"><span class="linenum">1298</span></a>  
<a name="l1299"><span class="linenum">1299</span></a>                  if (<a class="var it13086" onMouseOver="hilite(13086)" onMouseOut="lolite()" onClick="logVariable('olderdatasetdefs')" href="../../../_variables/olderdatasetdefs.html">$olderdatasetdefs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_select')" href="../../../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>('question_dataset_definitions',
<a name="l1300"><span class="linenum">1300</span></a>                          'type = ? AND name = ? AND category = ? AND id &lt; ?
<a name="l1301"><span class="linenum">1301</span></a>                          ORDER BY id DESC',
<a name="l1302"><span class="linenum">1302</span></a>                          array(<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('type')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/type.html">type</a>, <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('name')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>,
<a name="l1303"><span class="linenum">1303</span></a>                                  <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('category')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>, <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>))) {
<a name="l1304"><span class="linenum">1304</span></a>  
<a name="l1305"><span class="linenum">1305</span></a>                      while (<a class="var it13087" onMouseOver="hilite(13087)" onMouseOut="lolite()" onClick="logVariable('olderdatasetdef')" href="../../../_variables/olderdatasetdef.html">$olderdatasetdef</a> = <a class="phpfunction" onClick="logFunction('array_shift')" href="../../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it13086" onMouseOver="hilite(13086)" onMouseOut="lolite()" onClick="logVariable('olderdatasetdefs')" href="../../../_variables/olderdatasetdefs.html">$olderdatasetdefs</a>)) {
<a name="l1306"><span class="linenum">1306</span></a>                          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('question_dataset_definitions',
<a name="l1307"><span class="linenum">1307</span></a>                                  array('id' =&gt; <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l1308"><span class="linenum">1308</span></a>                          <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a> = <a class="var it13087" onMouseOver="hilite(13087)" onMouseOut="lolite()" onClick="logVariable('olderdatasetdef')" href="../../../_variables/olderdatasetdef.html">$olderdatasetdef</a>;
<a name="l1309"><span class="linenum">1309</span></a>                      }
<a name="l1310"><span class="linenum">1310</span></a>                  }
<a name="l1311"><span class="linenum">1311</span></a>              }
<a name="l1312"><span class="linenum">1312</span></a>  
<a name="l1313"><span class="linenum">1313</span></a>  <span class="comment">            // Create relation to this dataset.</span>
<a name="l1314"><span class="linenum">1314</span></a>              <a class="var it10193" onMouseOver="hilite(10193)" onMouseOut="lolite()" onClick="logVariable('questiondataset')" href="../../../_variables/questiondataset.html">$questiondataset</a> = new stdClass();
<a name="l1315"><span class="linenum">1315</span></a>              <a class="var it10193" onMouseOver="hilite(10193)" onMouseOut="lolite()" onClick="logVariable('questiondataset')" href="../../../_variables/questiondataset.html">$questiondataset</a>-&gt;<a onClick="logVariable('question')" class="var it43203" onMouseOver="hilite(43203)" onMouseOut="lolite()" href="../../../_variables/question.html">question</a> = <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('id')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l1316"><span class="linenum">1316</span></a>              <a class="var it10193" onMouseOver="hilite(10193)" onMouseOut="lolite()" onClick="logVariable('questiondataset')" href="../../../_variables/questiondataset.html">$questiondataset</a>-&gt;<a onClick="logVariable('datasetdefinition')" class="var it43203" onMouseOver="hilite(43203)" onMouseOut="lolite()" href="../../../_variables/datasetdefinition.html">datasetdefinition</a> = <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l1317"><span class="linenum">1317</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('question_datasets', <a class="var it10193" onMouseOver="hilite(10193)" onMouseOut="lolite()" onClick="logVariable('questiondataset')" href="../../../_variables/questiondataset.html">$questiondataset</a>);
<a name="l1318"><span class="linenum">1318</span></a>              unset(<a class="var it13083" onMouseOver="hilite(13083)" onMouseOut="lolite()" onClick="logVariable('datasetdefinitions')" href="../../../_variables/datasetdefinitions.html">$datasetdefinitions</a>[<a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a>]);
<a name="l1319"><span class="linenum">1319</span></a>          }
<a name="l1320"><span class="linenum">1320</span></a>  
<a name="l1321"><span class="linenum">1321</span></a>  <span class="comment">        // Remove local obsolete datasets as well as relations</span>
<a name="l1322"><span class="linenum">1322</span></a>  <span class="comment">        // to datasets in other categories.</span>
<a name="l1323"><span class="linenum">1323</span></a>          if (!empty(<a class="var it13083" onMouseOver="hilite(13083)" onMouseOut="lolite()" onClick="logVariable('datasetdefinitions')" href="../../../_variables/datasetdefinitions.html">$datasetdefinitions</a>)) {
<a name="l1324"><span class="linenum">1324</span></a>              foreach (<a class="var it13083" onMouseOver="hilite(13083)" onMouseOut="lolite()" onClick="logVariable('datasetdefinitions')" href="../../../_variables/datasetdefinitions.html">$datasetdefinitions</a> as <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>) {
<a name="l1325"><span class="linenum">1325</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('question_datasets',
<a name="l1326"><span class="linenum">1326</span></a>                          array('question' =&gt; <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('id')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, 'datasetdefinition' =&gt; <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('id')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l1327"><span class="linenum">1327</span></a>  
<a name="l1328"><span class="linenum">1328</span></a>                  if (<a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('category')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a> == 0) { // Question local dataset.
<a name="l1329"><span class="linenum">1329</span></a>                      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('question_dataset_definitions',
<a name="l1330"><span class="linenum">1330</span></a>                              array('id' =&gt; <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('id')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l1331"><span class="linenum">1331</span></a>                      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('question_dataset_items',
<a name="l1332"><span class="linenum">1332</span></a>                              array('definition' =&gt; <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('id')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l1333"><span class="linenum">1333</span></a>                  }
<a name="l1334"><span class="linenum">1334</span></a>              }
<a name="l1335"><span class="linenum">1335</span></a>          }
<a name="l1336"><span class="linenum">1336</span></a>      }
<a name="l1337"><span class="linenum">1337</span></a>      <span class="comment">/** This function create a copy of the datasets (definition and dataitems)</span>
<a name="l1338"><span class="linenum">1338</span></a>  <span class="comment">     * from the preceding question if they remain in the new question</span>
<a name="l1339"><span class="linenum">1339</span></a>  <span class="comment">     * otherwise its create the datasets that have been added as in the</span>
<a name="l1340"><span class="linenum">1340</span></a>  <span class="comment">     * save_dataset_definitions()</span>
<a name="l1341"><span class="linenum">1341</span></a>  <span class="comment">     */</span>
<a name="l1342"><span class="linenum">1342</span></a>      public function <a class="function" onClick="logFunction('save_as_new_dataset_definitions')" href="../../../_functions/save_as_new_dataset_definitions.html" onMouseOver="funcPopup(event,'save_as_new_dataset_definitions')">save_as_new_dataset_definitions</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>, <a class="var it13088" onMouseOver="hilite(13088)" onMouseOut="lolite()" onClick="logVariable('initialid')" href="../../../_variables/initialid.html">$initialid</a>) {
<a name="l1343"><span class="linenum">1343</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1344"><span class="linenum">1344</span></a>  <span class="comment">        // Get the datasets from the intial question.</span>
<a name="l1345"><span class="linenum">1345</span></a>          <a class="var it13083" onMouseOver="hilite(13083)" onMouseOut="lolite()" onClick="logVariable('datasetdefinitions')" href="../../../_variables/datasetdefinitions.html">$datasetdefinitions</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_dataset_definitions')" href="../../../_functions/get_dataset_definitions.html" onMouseOver="funcPopup(event,'get_dataset_definitions')">get_dataset_definitions</a>(<a class="var it13088" onMouseOver="hilite(13088)" onMouseOut="lolite()" onClick="logVariable('initialid')" href="../../../_variables/initialid.html">$initialid</a>, <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('dataset')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/dataset.html">dataset</a>);
<a name="l1346"><span class="linenum">1346</span></a>  <span class="comment">        // Param $tmpdatasets contains those of the new question.</span>
<a name="l1347"><span class="linenum">1347</span></a>          <a class="var it13084" onMouseOver="hilite(13084)" onMouseOut="lolite()" onClick="logVariable('tmpdatasets')" href="../../../_variables/tmpdatasets.html">$tmpdatasets</a> = <a class="phpfunction" onClick="logFunction('array_flip')" href="../../../_functions/array_flip.html" onMouseOver="phpfuncPopup(event,'array_flip')">array_flip</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('dataset')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/dataset.html">dataset</a>);
<a name="l1348"><span class="linenum">1348</span></a>          <a class="var it13085" onMouseOver="hilite(13085)" onMouseOut="lolite()" onClick="logVariable('defids')" href="../../../_variables/defids.html">$defids</a> = <a class="phpfunction" onClick="logFunction('array_keys')" href="../../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it13083" onMouseOver="hilite(13083)" onMouseOut="lolite()" onClick="logVariable('datasetdefinitions')" href="../../../_variables/datasetdefinitions.html">$datasetdefinitions</a>);<span class="comment">// New datasets.</span>
<a name="l1349"><span class="linenum">1349</span></a>          foreach (<a class="var it13085" onMouseOver="hilite(13085)" onMouseOut="lolite()" onClick="logVariable('defids')" href="../../../_variables/defids.html">$defids</a> as <a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a>) {
<a name="l1350"><span class="linenum">1350</span></a>              <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a> = &amp;<a class="var it13083" onMouseOver="hilite(13083)" onMouseOut="lolite()" onClick="logVariable('datasetdefinitions')" href="../../../_variables/datasetdefinitions.html">$datasetdefinitions</a>[<a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a>];
<a name="l1351"><span class="linenum">1351</span></a>              if (isset(<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>)) {
<a name="l1352"><span class="linenum">1352</span></a>  <span class="comment">                // This dataset exist in the initial question.</span>
<a name="l1353"><span class="linenum">1353</span></a>                  if (!isset(<a class="var it13084" onMouseOver="hilite(13084)" onMouseOut="lolite()" onClick="logVariable('tmpdatasets')" href="../../../_variables/tmpdatasets.html">$tmpdatasets</a>[<a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a>])) {
<a name="l1354"><span class="linenum">1354</span></a>  <span class="comment">                    // Do not exist in the new question so ignore.</span>
<a name="l1355"><span class="linenum">1355</span></a>                      unset(<a class="var it13083" onMouseOver="hilite(13083)" onMouseOut="lolite()" onClick="logVariable('datasetdefinitions')" href="../../../_variables/datasetdefinitions.html">$datasetdefinitions</a>[<a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a>]);
<a name="l1356"><span class="linenum">1356</span></a>                      continue;
<a name="l1357"><span class="linenum">1357</span></a>                  }
<a name="l1358"><span class="linenum">1358</span></a>  <span class="comment">                // Create a copy but not for category one.</span>
<a name="l1359"><span class="linenum">1359</span></a>                  if (0 == <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('category')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>) {
<a name="l1360"><span class="linenum">1360</span></a>                      <a class="var it13089" onMouseOver="hilite(13089)" onMouseOut="lolite()" onClick="logVariable('olddatasetid')" href="../../../_variables/olddatasetid.html">$olddatasetid</a> = <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l1361"><span class="linenum">1361</span></a>                      <a class="var it13090" onMouseOver="hilite(13090)" onMouseOut="lolite()" onClick="logVariable('olditemcount')" href="../../../_variables/olditemcount.html">$olditemcount</a> = <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('itemcount')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/itemcount.html">itemcount</a>;
<a name="l1362"><span class="linenum">1362</span></a>                      <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('itemcount')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/itemcount.html">itemcount</a> = 0;
<a name="l1363"><span class="linenum">1363</span></a>                      <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('question_dataset_definitions',
<a name="l1364"><span class="linenum">1364</span></a>                              <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>);
<a name="l1365"><span class="linenum">1365</span></a>  <span class="comment">                    // Copy the dataitems.</span>
<a name="l1366"><span class="linenum">1366</span></a>                      <a class="var it13091" onMouseOver="hilite(13091)" onMouseOut="lolite()" onClick="logVariable('olditems')" href="../../../_variables/olditems.html">$olditems</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_database_dataset_items')" href="../../../_functions/get_database_dataset_items.html" onMouseOver="funcPopup(event,'get_database_dataset_items')">get_database_dataset_items</a>(<a class="var it13089" onMouseOver="hilite(13089)" onMouseOut="lolite()" onClick="logVariable('olddatasetid')" href="../../../_variables/olddatasetid.html">$olddatasetid</a>);
<a name="l1367"><span class="linenum">1367</span></a>                      if (<a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it13091" onMouseOver="hilite(13091)" onMouseOut="lolite()" onClick="logVariable('olditems')" href="../../../_variables/olditems.html">$olditems</a>) &gt; 0) {
<a name="l1368"><span class="linenum">1368</span></a>                          <a class="var it10192" onMouseOver="hilite(10192)" onMouseOut="lolite()" onClick="logVariable('itemcount')" href="../../../_variables/itemcount.html">$itemcount</a> = 0;
<a name="l1369"><span class="linenum">1369</span></a>                          foreach (<a class="var it13091" onMouseOver="hilite(13091)" onMouseOut="lolite()" onClick="logVariable('olditems')" href="../../../_variables/olditems.html">$olditems</a> as <a class="var it749" onMouseOver="hilite(749)" onMouseOut="lolite()" onClick="logVariable('item')" href="../../../_variables/item.html">$item</a>) {
<a name="l1370"><span class="linenum">1370</span></a>                              <a class="var it749" onMouseOver="hilite(749)" onMouseOut="lolite()" onClick="logVariable('item')" href="../../../_variables/item.html">$item</a>-&gt;<a onClick="logVariable('definition')" class="var it42962" onMouseOver="hilite(42962)" onMouseOut="lolite()" href="../../../_variables/definition.html">definition</a> = <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l1371"><span class="linenum">1371</span></a>                              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('question_dataset_items', <a class="var it749" onMouseOver="hilite(749)" onMouseOut="lolite()" onClick="logVariable('item')" href="../../../_variables/item.html">$item</a>);
<a name="l1372"><span class="linenum">1372</span></a>                              <a class="var it10192" onMouseOver="hilite(10192)" onMouseOut="lolite()" onClick="logVariable('itemcount')" href="../../../_variables/itemcount.html">$itemcount</a>++;
<a name="l1373"><span class="linenum">1373</span></a>                          }
<a name="l1374"><span class="linenum">1374</span></a>  <span class="comment">                        // Update item count to olditemcount if</span>
<a name="l1375"><span class="linenum">1375</span></a>  <span class="comment">                        // at least this number of items has been recover from the database.</span>
<a name="l1376"><span class="linenum">1376</span></a>                          if (<a class="var it13090" onMouseOver="hilite(13090)" onMouseOut="lolite()" onClick="logVariable('olditemcount')" href="../../../_variables/olditemcount.html">$olditemcount</a> &lt;= <a class="var it10192" onMouseOver="hilite(10192)" onMouseOut="lolite()" onClick="logVariable('itemcount')" href="../../../_variables/itemcount.html">$itemcount</a>) {
<a name="l1377"><span class="linenum">1377</span></a>                              <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('itemcount')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/itemcount.html">itemcount</a> = <a class="var it13090" onMouseOver="hilite(13090)" onMouseOut="lolite()" onClick="logVariable('olditemcount')" href="../../../_variables/olditemcount.html">$olditemcount</a>;
<a name="l1378"><span class="linenum">1378</span></a>                          } else {
<a name="l1379"><span class="linenum">1379</span></a>                              <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('itemcount')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/itemcount.html">itemcount</a> = <a class="var it10192" onMouseOver="hilite(10192)" onMouseOut="lolite()" onClick="logVariable('itemcount')" href="../../../_variables/itemcount.html">$itemcount</a>;
<a name="l1380"><span class="linenum">1380</span></a>                          }
<a name="l1381"><span class="linenum">1381</span></a>                          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../../../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('question_dataset_definitions', <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>);
<a name="l1382"><span class="linenum">1382</span></a>                      } <span class="comment">// End of  copy the dataitems.</span>
<a name="l1383"><span class="linenum">1383</span></a>                  }<span class="comment">// End of  copy the datasetdef.</span>
<a name="l1384"><span class="linenum">1384</span></a>  <span class="comment">                // Create relation to the new question with this</span>
<a name="l1385"><span class="linenum">1385</span></a>  <span class="comment">                // copy as new datasetdef from the initial question.</span>
<a name="l1386"><span class="linenum">1386</span></a>                  <a class="var it10193" onMouseOver="hilite(10193)" onMouseOut="lolite()" onClick="logVariable('questiondataset')" href="../../../_variables/questiondataset.html">$questiondataset</a> = new stdClass();
<a name="l1387"><span class="linenum">1387</span></a>                  <a class="var it10193" onMouseOver="hilite(10193)" onMouseOut="lolite()" onClick="logVariable('questiondataset')" href="../../../_variables/questiondataset.html">$questiondataset</a>-&gt;<a onClick="logVariable('question')" class="var it43203" onMouseOver="hilite(43203)" onMouseOut="lolite()" href="../../../_variables/question.html">question</a> = <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('id')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l1388"><span class="linenum">1388</span></a>                  <a class="var it10193" onMouseOver="hilite(10193)" onMouseOut="lolite()" onClick="logVariable('questiondataset')" href="../../../_variables/questiondataset.html">$questiondataset</a>-&gt;<a onClick="logVariable('datasetdefinition')" class="var it43203" onMouseOver="hilite(43203)" onMouseOut="lolite()" href="../../../_variables/datasetdefinition.html">datasetdefinition</a> = <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l1389"><span class="linenum">1389</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('question_datasets', <a class="var it10193" onMouseOver="hilite(10193)" onMouseOut="lolite()" onClick="logVariable('questiondataset')" href="../../../_variables/questiondataset.html">$questiondataset</a>);
<a name="l1390"><span class="linenum">1390</span></a>                  unset(<a class="var it13083" onMouseOver="hilite(13083)" onMouseOut="lolite()" onClick="logVariable('datasetdefinitions')" href="../../../_variables/datasetdefinitions.html">$datasetdefinitions</a>[<a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a>]);
<a name="l1391"><span class="linenum">1391</span></a>                  continue;
<a name="l1392"><span class="linenum">1392</span></a>              }<span class="comment">// End of datasetdefs from the initial question.</span>
<a name="l1393"><span class="linenum">1393</span></a>  <span class="comment">            // Really new one code similar to save_dataset_definitions().</span>
<a name="l1394"><span class="linenum">1394</span></a>              <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('question_dataset_definitions', <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>);
<a name="l1395"><span class="linenum">1395</span></a>  
<a name="l1396"><span class="linenum">1396</span></a>              if (0 != <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('category')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>) {
<a name="l1397"><span class="linenum">1397</span></a>  <span class="comment">                // We need to look for already existing</span>
<a name="l1398"><span class="linenum">1398</span></a>  <span class="comment">                // datasets in the category.</span>
<a name="l1399"><span class="linenum">1399</span></a>  <span class="comment">                // By first creating the datasetdefinition above we</span>
<a name="l1400"><span class="linenum">1400</span></a>  <span class="comment">                // can manage to automatically take care of</span>
<a name="l1401"><span class="linenum">1401</span></a>  <span class="comment">                // some possible realtime concurrence.</span>
<a name="l1402"><span class="linenum">1402</span></a>                  if (<a class="var it13086" onMouseOver="hilite(13086)" onMouseOut="lolite()" onClick="logVariable('olderdatasetdefs')" href="../../../_variables/olderdatasetdefs.html">$olderdatasetdefs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_select')" href="../../../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>('question_dataset_definitions',
<a name="l1403"><span class="linenum">1403</span></a>                          &quot;type = ? AND name = ? AND category = ? AND id &lt; ?
<a name="l1404"><span class="linenum">1404</span></a>                          ORDER BY id DESC&quot;,
<a name="l1405"><span class="linenum">1405</span></a>                          array(<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('type')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/type.html">type</a>, <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('name')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>,
<a name="l1406"><span class="linenum">1406</span></a>                                  <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('category')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>, <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>))) {
<a name="l1407"><span class="linenum">1407</span></a>  
<a name="l1408"><span class="linenum">1408</span></a>                      while (<a class="var it13087" onMouseOver="hilite(13087)" onMouseOut="lolite()" onClick="logVariable('olderdatasetdef')" href="../../../_variables/olderdatasetdef.html">$olderdatasetdef</a> = <a class="phpfunction" onClick="logFunction('array_shift')" href="../../../_functions/array_shift.html" onMouseOver="phpfuncPopup(event,'array_shift')">array_shift</a>(<a class="var it13086" onMouseOver="hilite(13086)" onMouseOut="lolite()" onClick="logVariable('olderdatasetdefs')" href="../../../_variables/olderdatasetdefs.html">$olderdatasetdefs</a>)) {
<a name="l1409"><span class="linenum">1409</span></a>                          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('question_dataset_definitions',
<a name="l1410"><span class="linenum">1410</span></a>                                  array('id' =&gt; <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l1411"><span class="linenum">1411</span></a>                          <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a> = <a class="var it13087" onMouseOver="hilite(13087)" onMouseOut="lolite()" onClick="logVariable('olderdatasetdef')" href="../../../_variables/olderdatasetdef.html">$olderdatasetdef</a>;
<a name="l1412"><span class="linenum">1412</span></a>                      }
<a name="l1413"><span class="linenum">1413</span></a>                  }
<a name="l1414"><span class="linenum">1414</span></a>              }
<a name="l1415"><span class="linenum">1415</span></a>  
<a name="l1416"><span class="linenum">1416</span></a>  <span class="comment">            // Create relation to this dataset.</span>
<a name="l1417"><span class="linenum">1417</span></a>              <a class="var it10193" onMouseOver="hilite(10193)" onMouseOut="lolite()" onClick="logVariable('questiondataset')" href="../../../_variables/questiondataset.html">$questiondataset</a> = new stdClass();
<a name="l1418"><span class="linenum">1418</span></a>              <a class="var it10193" onMouseOver="hilite(10193)" onMouseOut="lolite()" onClick="logVariable('questiondataset')" href="../../../_variables/questiondataset.html">$questiondataset</a>-&gt;<a onClick="logVariable('question')" class="var it43203" onMouseOver="hilite(43203)" onMouseOut="lolite()" href="../../../_variables/question.html">question</a> = <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('id')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l1419"><span class="linenum">1419</span></a>              <a class="var it10193" onMouseOver="hilite(10193)" onMouseOut="lolite()" onClick="logVariable('questiondataset')" href="../../../_variables/questiondataset.html">$questiondataset</a>-&gt;<a onClick="logVariable('datasetdefinition')" class="var it43203" onMouseOver="hilite(43203)" onMouseOut="lolite()" href="../../../_variables/datasetdefinition.html">datasetdefinition</a> = <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('id')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l1420"><span class="linenum">1420</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('question_datasets', <a class="var it10193" onMouseOver="hilite(10193)" onMouseOut="lolite()" onClick="logVariable('questiondataset')" href="../../../_variables/questiondataset.html">$questiondataset</a>);
<a name="l1421"><span class="linenum">1421</span></a>              unset(<a class="var it13083" onMouseOver="hilite(13083)" onMouseOut="lolite()" onClick="logVariable('datasetdefinitions')" href="../../../_variables/datasetdefinitions.html">$datasetdefinitions</a>[<a class="var it8147" onMouseOver="hilite(8147)" onMouseOut="lolite()" onClick="logVariable('defid')" href="../../../_variables/defid.html">$defid</a>]);
<a name="l1422"><span class="linenum">1422</span></a>          }
<a name="l1423"><span class="linenum">1423</span></a>  
<a name="l1424"><span class="linenum">1424</span></a>  <span class="comment">        // Remove local obsolete datasets as well as relations</span>
<a name="l1425"><span class="linenum">1425</span></a>  <span class="comment">        // to datasets in other categories.</span>
<a name="l1426"><span class="linenum">1426</span></a>          if (!empty(<a class="var it13083" onMouseOver="hilite(13083)" onMouseOut="lolite()" onClick="logVariable('datasetdefinitions')" href="../../../_variables/datasetdefinitions.html">$datasetdefinitions</a>)) {
<a name="l1427"><span class="linenum">1427</span></a>              foreach (<a class="var it13083" onMouseOver="hilite(13083)" onMouseOut="lolite()" onClick="logVariable('datasetdefinitions')" href="../../../_variables/datasetdefinitions.html">$datasetdefinitions</a> as <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>) {
<a name="l1428"><span class="linenum">1428</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('question_datasets',
<a name="l1429"><span class="linenum">1429</span></a>                          array('question' =&gt; <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('id')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, 'datasetdefinition' =&gt; <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('id')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l1430"><span class="linenum">1430</span></a>  
<a name="l1431"><span class="linenum">1431</span></a>                  if (<a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('category')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a> == 0) { // Question local dataset.
<a name="l1432"><span class="linenum">1432</span></a>                      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('question_dataset_definitions',
<a name="l1433"><span class="linenum">1433</span></a>                              array('id' =&gt; <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('id')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l1434"><span class="linenum">1434</span></a>                      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('question_dataset_items',
<a name="l1435"><span class="linenum">1435</span></a>                              array('definition' =&gt; <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../../_variables/def.html">$def</a>-&gt;<a onClick="logVariable('id')" class="var it43059" onMouseOver="hilite(43059)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l1436"><span class="linenum">1436</span></a>                  }
<a name="l1437"><span class="linenum">1437</span></a>              }
<a name="l1438"><span class="linenum">1438</span></a>          }
<a name="l1439"><span class="linenum">1439</span></a>      }
<a name="l1440"><span class="linenum">1440</span></a>  
<a name="l1441"><span class="linenum">1441</span></a>  <span class="comment">    // Dataset functionality.</span>
<a name="l1442"><span class="linenum">1442</span></a>      public function <a class="function" onClick="logFunction('pick_question_dataset')" href="../../../_functions/pick_question_dataset.html" onMouseOver="funcPopup(event,'pick_question_dataset')">pick_question_dataset</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>, <a class="var it13038" onMouseOver="hilite(13038)" onMouseOut="lolite()" onClick="logVariable('datasetitem')" href="../../../_variables/datasetitem.html">$datasetitem</a>) {
<a name="l1443"><span class="linenum">1443</span></a>  <span class="comment">        // Select a dataset in the following format:</span>
<a name="l1444"><span class="linenum">1444</span></a>  <span class="comment">        // an array indexed by the variable names (d.name) pointing to the value</span>
<a name="l1445"><span class="linenum">1445</span></a>  <span class="comment">        // to be substituted.</span>
<a name="l1446"><span class="linenum">1446</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1447"><span class="linenum">1447</span></a>          if (!<a class="var it13057" onMouseOver="hilite(13057)" onMouseOut="lolite()" onClick="logVariable('dataitems')" href="../../../_variables/dataitems.html">$dataitems</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(
<a name="l1448"><span class="linenum">1448</span></a>                  &quot;SELECT i.id, d.name, i.value
<a name="l1449"><span class="linenum">1449</span></a>                     FROM {question_dataset_definitions} d,
<a name="l1450"><span class="linenum">1450</span></a>                          {question_dataset_items} i,
<a name="l1451"><span class="linenum">1451</span></a>                          {question_datasets} q
<a name="l1452"><span class="linenum">1452</span></a>                    WHERE q.question = ?
<a name="l1453"><span class="linenum">1453</span></a>                      AND q.datasetdefinition = d.id
<a name="l1454"><span class="linenum">1454</span></a>                      AND d.id = i.definition
<a name="l1455"><span class="linenum">1455</span></a>                      AND i.itemnumber = ?
<a name="l1456"><span class="linenum">1456</span></a>                 ORDER BY i.id DESC &quot;, array(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, <a class="var it13038" onMouseOver="hilite(13038)" onMouseOut="lolite()" onClick="logVariable('datasetitem')" href="../../../_variables/datasetitem.html">$datasetitem</a>))) {
<a name="l1457"><span class="linenum">1457</span></a>              <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../../_variables/a.html">$a</a> = new stdClass();
<a name="l1458"><span class="linenum">1458</span></a>              <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('id')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a> = <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('id')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>;
<a name="l1459"><span class="linenum">1459</span></a>              <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('item')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../../_variables/item.html">item</a> = <a class="var it13038" onMouseOver="hilite(13038)" onMouseOut="lolite()" onClick="logVariable('datasetitem')" href="../../../_variables/datasetitem.html">$datasetitem</a>;
<a name="l1460"><span class="linenum">1460</span></a>              <a class="function" onClick="logFunction('print_error')" href="../../../_functions/print_error.html" onMouseOver="funcPopup(event,'print_error')">print_error</a>('cannotgetdsfordependent', 'question', '', <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../../_variables/a.html">$a</a>);
<a name="l1461"><span class="linenum">1461</span></a>          }
<a name="l1462"><span class="linenum">1462</span></a>          <a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a> = Array();
<a name="l1463"><span class="linenum">1463</span></a>          foreach (<a class="var it13057" onMouseOver="hilite(13057)" onMouseOut="lolite()" onClick="logVariable('dataitems')" href="../../../_variables/dataitems.html">$dataitems</a> as <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../../_variables/id.html">$id</a> =&gt; <a class="var it13037" onMouseOver="hilite(13037)" onMouseOut="lolite()" onClick="logVariable('dataitem')" href="../../../_variables/dataitem.html">$dataitem</a>) {
<a name="l1464"><span class="linenum">1464</span></a>              if (!isset(<a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>[<a class="var it13037" onMouseOver="hilite(13037)" onMouseOut="lolite()" onClick="logVariable('dataitem')" href="../../../_variables/dataitem.html">$dataitem</a>-&gt;<a onClick="logVariable('name')" class="var it44020" onMouseOver="hilite(44020)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>])) {
<a name="l1465"><span class="linenum">1465</span></a>                  <a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>[<a class="var it13037" onMouseOver="hilite(13037)" onMouseOut="lolite()" onClick="logVariable('dataitem')" href="../../../_variables/dataitem.html">$dataitem</a>-&gt;<a onClick="logVariable('name')" class="var it44020" onMouseOver="hilite(44020)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>] = <a class="var it13037" onMouseOver="hilite(13037)" onMouseOut="lolite()" onClick="logVariable('dataitem')" href="../../../_variables/dataitem.html">$dataitem</a>-&gt;<a onClick="logVariable('value')" class="var it44020" onMouseOver="hilite(44020)" onMouseOut="lolite()" href="../../../_variables/value.html">value</a>;
<a name="l1466"><span class="linenum">1466</span></a>              }
<a name="l1467"><span class="linenum">1467</span></a>          }
<a name="l1468"><span class="linenum">1468</span></a>          return <a class="var it1104" onMouseOver="hilite(1104)" onMouseOut="lolite()" onClick="logVariable('dataset')" href="../../../_variables/dataset.html">$dataset</a>;
<a name="l1469"><span class="linenum">1469</span></a>      }
<a name="l1470"><span class="linenum">1470</span></a>  
<a name="l1471"><span class="linenum">1471</span></a>      public function <a class="function" onClick="logFunction('dataset_options_from_database')" href="../../../_functions/dataset_options_from_database.html" onMouseOver="funcPopup(event,'dataset_options_from_database')">dataset_options_from_database</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>, <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../../_variables/name.html">$name</a>, <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../_variables/prefix.html">$prefix</a> = '',
<a name="l1472"><span class="linenum">1472</span></a>              <a class="var it9734" onMouseOver="hilite(9734)" onMouseOut="lolite()" onClick="logVariable('langfile')" href="../../../_variables/langfile.html">$langfile</a> = 'qtype_calculated') {
<a name="l1473"><span class="linenum">1473</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1474"><span class="linenum">1474</span></a>          <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a> = 1; <span class="comment">// Only type = 1 (i.e. old 'LITERAL') has ever been used.</span>
<a name="l1475"><span class="linenum">1475</span></a>  <span class="comment">        // First options - it is not a dataset...</span>
<a name="l1476"><span class="linenum">1476</span></a>          <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>['0'] = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(<a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../_variables/prefix.html">$prefix</a>.'nodataset', <a class="var it9734" onMouseOver="hilite(9734)" onMouseOut="lolite()" onClick="logVariable('langfile')" href="../../../_variables/langfile.html">$langfile</a>);
<a name="l1477"><span class="linenum">1477</span></a>  <span class="comment">        // New question no local.</span>
<a name="l1478"><span class="linenum">1478</span></a>          if (!isset(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('id')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>) || <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('id')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a> == 0) {
<a name="l1479"><span class="linenum">1479</span></a>              <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a> = &quot;{<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a>}-0-{<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../../_variables/name.html">$name</a>}&quot;;
<a name="l1480"><span class="linenum">1480</span></a>              <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(<a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../_variables/prefix.html">$prefix</a>.&quot;newlocal{<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a>}&quot;, <a class="var it9734" onMouseOver="hilite(9734)" onMouseOut="lolite()" onClick="logVariable('langfile')" href="../../../_variables/langfile.html">$langfile</a>);
<a name="l1481"><span class="linenum">1481</span></a>              <a class="var it13092" onMouseOver="hilite(13092)" onMouseOut="lolite()" onClick="logVariable('currentdatasetdef')" href="../../../_variables/currentdatasetdef.html">$currentdatasetdef</a> = new stdClass();
<a name="l1482"><span class="linenum">1482</span></a>              <a class="var it13092" onMouseOver="hilite(13092)" onMouseOut="lolite()" onClick="logVariable('currentdatasetdef')" href="../../../_variables/currentdatasetdef.html">$currentdatasetdef</a>-&gt;<a onClick="logVariable('type')" class="var it44023" onMouseOver="hilite(44023)" onMouseOut="lolite()" href="../../../_variables/type.html">type</a> = '0';
<a name="l1483"><span class="linenum">1483</span></a>          } else {
<a name="l1484"><span class="linenum">1484</span></a>  <span class="comment">            // Construct question local options.</span>
<a name="l1485"><span class="linenum">1485</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = &quot;SELECT a.*
<a name="l1486"><span class="linenum">1486</span></a>                  FROM {question_dataset_definitions} a, {question_datasets} b
<a name="l1487"><span class="linenum">1487</span></a>                 WHERE a.id = b.datasetdefinition AND a.type = '1' AND b.question = ? AND a.name = ?&quot;;
<a name="l1488"><span class="linenum">1488</span></a>              <a class="var it13092" onMouseOver="hilite(13092)" onMouseOut="lolite()" onClick="logVariable('currentdatasetdef')" href="../../../_variables/currentdatasetdef.html">$currentdatasetdef</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../../../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>, array(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('id')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>, <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../../_variables/name.html">$name</a>));
<a name="l1489"><span class="linenum">1489</span></a>              if (!<a class="var it13092" onMouseOver="hilite(13092)" onMouseOut="lolite()" onClick="logVariable('currentdatasetdef')" href="../../../_variables/currentdatasetdef.html">$currentdatasetdef</a>) {
<a name="l1490"><span class="linenum">1490</span></a>                  <a class="var it13092" onMouseOver="hilite(13092)" onMouseOut="lolite()" onClick="logVariable('currentdatasetdef')" href="../../../_variables/currentdatasetdef.html">$currentdatasetdef</a> = new stdClass();
<a name="l1491"><span class="linenum">1491</span></a>                  <a class="var it13092" onMouseOver="hilite(13092)" onMouseOut="lolite()" onClick="logVariable('currentdatasetdef')" href="../../../_variables/currentdatasetdef.html">$currentdatasetdef</a>-&gt;<a onClick="logVariable('type')" class="var it44023" onMouseOver="hilite(44023)" onMouseOut="lolite()" href="../../../_variables/type.html">type</a> = '0';
<a name="l1492"><span class="linenum">1492</span></a>              }
<a name="l1493"><span class="linenum">1493</span></a>              <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a> = &quot;{<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a>}-0-{<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../../_variables/name.html">$name</a>}&quot;;
<a name="l1494"><span class="linenum">1494</span></a>              if (<a class="var it13092" onMouseOver="hilite(13092)" onMouseOut="lolite()" onClick="logVariable('currentdatasetdef')" href="../../../_variables/currentdatasetdef.html">$currentdatasetdef</a>-&gt;<a onClick="logVariable('type')" class="var it44023" onMouseOver="hilite(44023)" onMouseOut="lolite()" href="../../../_variables/type.html">type</a> == <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a>
<a name="l1495"><span class="linenum">1495</span></a>                      and <a class="var it13092" onMouseOver="hilite(13092)" onMouseOut="lolite()" onClick="logVariable('currentdatasetdef')" href="../../../_variables/currentdatasetdef.html">$currentdatasetdef</a>-&gt;<a onClick="logVariable('category')" class="var it44023" onMouseOver="hilite(44023)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a> == 0) {
<a name="l1496"><span class="linenum">1496</span></a>                  <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(<a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../_variables/prefix.html">$prefix</a>.&quot;keptlocal{<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a>}&quot;, <a class="var it9734" onMouseOver="hilite(9734)" onMouseOut="lolite()" onClick="logVariable('langfile')" href="../../../_variables/langfile.html">$langfile</a>);
<a name="l1497"><span class="linenum">1497</span></a>              } else {
<a name="l1498"><span class="linenum">1498</span></a>                  <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(<a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../_variables/prefix.html">$prefix</a>.&quot;newlocal{<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a>}&quot;, <a class="var it9734" onMouseOver="hilite(9734)" onMouseOut="lolite()" onClick="logVariable('langfile')" href="../../../_variables/langfile.html">$langfile</a>);
<a name="l1499"><span class="linenum">1499</span></a>              }
<a name="l1500"><span class="linenum">1500</span></a>          }
<a name="l1501"><span class="linenum">1501</span></a>  <span class="comment">        // Construct question category options.</span>
<a name="l1502"><span class="linenum">1502</span></a>          <a class="var it13042" onMouseOver="hilite(13042)" onMouseOut="lolite()" onClick="logVariable('categorydatasetdefs')" href="../../../_variables/categorydatasetdefs.html">$categorydatasetdefs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(
<a name="l1503"><span class="linenum">1503</span></a>              &quot;SELECT b.question, a.*
<a name="l1504"><span class="linenum">1504</span></a>              FROM {question_datasets} b,
<a name="l1505"><span class="linenum">1505</span></a>              {question_dataset_definitions} a
<a name="l1506"><span class="linenum">1506</span></a>              WHERE a.id = b.datasetdefinition
<a name="l1507"><span class="linenum">1507</span></a>              AND a.type = '1'
<a name="l1508"><span class="linenum">1508</span></a>              AND a.category = ?
<a name="l1509"><span class="linenum">1509</span></a>              AND a.name = ?&quot;, array(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('category')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>, <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../../_variables/name.html">$name</a>));
<a name="l1510"><span class="linenum">1510</span></a>          <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a> = 1;
<a name="l1511"><span class="linenum">1511</span></a>          <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a> = &quot;{<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a>}-{<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('category')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>}-{<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../../_variables/name.html">$name</a>}&quot;;
<a name="l1512"><span class="linenum">1512</span></a>          if (!empty(<a class="var it13042" onMouseOver="hilite(13042)" onMouseOut="lolite()" onClick="logVariable('categorydatasetdefs')" href="../../../_variables/categorydatasetdefs.html">$categorydatasetdefs</a>)) {
<a name="l1513"><span class="linenum">1513</span></a>  <span class="comment">            // There is at least one with the same name.</span>
<a name="l1514"><span class="linenum">1514</span></a>              if (isset(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('id')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>) &amp;&amp; isset(<a class="var it13042" onMouseOver="hilite(13042)" onMouseOut="lolite()" onClick="logVariable('categorydatasetdefs')" href="../../../_variables/categorydatasetdefs.html">$categorydatasetdefs</a>[<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('id')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>])) {
<a name="l1515"><span class="linenum">1515</span></a>  <span class="comment">                // It is already used by this question.</span>
<a name="l1516"><span class="linenum">1516</span></a>                  <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(<a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../_variables/prefix.html">$prefix</a>.&quot;keptcategory{<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a>}&quot;, <a class="var it9734" onMouseOver="hilite(9734)" onMouseOut="lolite()" onClick="logVariable('langfile')" href="../../../_variables/langfile.html">$langfile</a>);
<a name="l1517"><span class="linenum">1517</span></a>              } else {
<a name="l1518"><span class="linenum">1518</span></a>                  <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(<a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../_variables/prefix.html">$prefix</a>.&quot;existingcategory{<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a>}&quot;, <a class="var it9734" onMouseOver="hilite(9734)" onMouseOut="lolite()" onClick="logVariable('langfile')" href="../../../_variables/langfile.html">$langfile</a>);
<a name="l1519"><span class="linenum">1519</span></a>              }
<a name="l1520"><span class="linenum">1520</span></a>          } else {
<a name="l1521"><span class="linenum">1521</span></a>              <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>(<a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../_variables/prefix.html">$prefix</a>.&quot;newcategory{<a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a>}&quot;, <a class="var it9734" onMouseOver="hilite(9734)" onMouseOut="lolite()" onClick="logVariable('langfile')" href="../../../_variables/langfile.html">$langfile</a>);
<a name="l1522"><span class="linenum">1522</span></a>          }
<a name="l1523"><span class="linenum">1523</span></a>  <span class="comment">        // All done!</span>
<a name="l1524"><span class="linenum">1524</span></a>          return array(<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>, <a class="var it13092" onMouseOver="hilite(13092)" onMouseOut="lolite()" onClick="logVariable('currentdatasetdef')" href="../../../_variables/currentdatasetdef.html">$currentdatasetdef</a>-&gt;type
<a name="l1525"><span class="linenum">1525</span></a>              ? &quot;{<a class="var it13092" onMouseOver="hilite(13092)" onMouseOut="lolite()" onClick="logVariable('currentdatasetdef')" href="../../../_variables/currentdatasetdef.html">$currentdatasetdef</a>-&gt;<a onClick="logVariable('type')" class="var it44023" onMouseOver="hilite(44023)" onMouseOut="lolite()" href="../../../_variables/type.html">type</a>}-{<a class="var it13092" onMouseOver="hilite(13092)" onMouseOut="lolite()" onClick="logVariable('currentdatasetdef')" href="../../../_variables/currentdatasetdef.html">$currentdatasetdef</a>-&gt;<a onClick="logVariable('category')" class="var it44023" onMouseOver="hilite(44023)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>}-{<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../../_variables/name.html">$name</a>}&quot;
<a name="l1526"><span class="linenum">1526</span></a>              : '');
<a name="l1527"><span class="linenum">1527</span></a>      }
<a name="l1528"><span class="linenum">1528</span></a>  
<a name="l1529"><span class="linenum">1529</span></a>      public function <a class="function" onClick="logFunction('find_dataset_names')" href="../../../_functions/find_dataset_names.html" onMouseOver="funcPopup(event,'find_dataset_names')">find_dataset_names</a>(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a>) {
<a name="l1530"><span class="linenum">1530</span></a>  <span class="comment">        // Returns the possible dataset names found in the text as an array.</span>
<a name="l1531"><span class="linenum">1531</span></a>  <span class="comment">        // The array has the dataset name for both key and value.</span>
<a name="l1532"><span class="linenum">1532</span></a>          <a class="var it13093" onMouseOver="hilite(13093)" onMouseOut="lolite()" onClick="logVariable('datasetnames')" href="../../../_variables/datasetnames.html">$datasetnames</a> = array();
<a name="l1533"><span class="linenum">1533</span></a>          while (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('~\\{([[:alpha:]][^&gt;} &lt;{&quot;\']*)\\}~', <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a>, <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>)) {
<a name="l1534"><span class="linenum">1534</span></a>              <a class="var it13093" onMouseOver="hilite(13093)" onMouseOut="lolite()" onClick="logVariable('datasetnames')" href="../../../_variables/datasetnames.html">$datasetnames</a>[<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[1]] = <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[1];
<a name="l1535"><span class="linenum">1535</span></a>              <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>(<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[0], '', <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a>);
<a name="l1536"><span class="linenum">1536</span></a>          }
<a name="l1537"><span class="linenum">1537</span></a>          return <a class="var it13093" onMouseOver="hilite(13093)" onMouseOut="lolite()" onClick="logVariable('datasetnames')" href="../../../_variables/datasetnames.html">$datasetnames</a>;
<a name="l1538"><span class="linenum">1538</span></a>      }
<a name="l1539"><span class="linenum">1539</span></a>  
<a name="l1540"><span class="linenum">1540</span></a>      <span class="comment">/**</span>
<a name="l1541"><span class="linenum">1541</span></a>  <span class="comment">     * This function retrieve the item count of the available category shareable</span>
<a name="l1542"><span class="linenum">1542</span></a>  <span class="comment">     * wild cards that is added as a comment displayed when a wild card with</span>
<a name="l1543"><span class="linenum">1543</span></a>  <span class="comment">     * the same name is displayed in datasetdefinitions_form.php</span>
<a name="l1544"><span class="linenum">1544</span></a>  <span class="comment">     */</span>
<a name="l1545"><span class="linenum">1545</span></a>      public function <a class="function" onClick="logFunction('get_dataset_definitions_category')" href="../../../_functions/get_dataset_definitions_category.html" onMouseOver="funcPopup(event,'get_dataset_definitions_category')">get_dataset_definitions_category</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>) {
<a name="l1546"><span class="linenum">1546</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1547"><span class="linenum">1547</span></a>          <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a> = array();
<a name="l1548"><span class="linenum">1548</span></a>          <a class="var it13094" onMouseOver="hilite(13094)" onMouseOut="lolite()" onClick="logVariable('lnamemax')" href="../../../_variables/lnamemax.html">$lnamemax</a> = 30;
<a name="l1549"><span class="linenum">1549</span></a>          if (!empty(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('category')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>)) {
<a name="l1550"><span class="linenum">1550</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = &quot;SELECT i.*, d.*
<a name="l1551"><span class="linenum">1551</span></a>                        FROM {question_datasets} d, {question_dataset_definitions} i
<a name="l1552"><span class="linenum">1552</span></a>                       WHERE i.id = d.datasetdefinition AND i.category = ?&quot;;
<a name="l1553"><span class="linenum">1553</span></a>              if (<a class="var it988" onMouseOver="hilite(988)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../../_variables/records.html">$records</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>, array(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('category')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>))) {
<a name="l1554"><span class="linenum">1554</span></a>                  foreach (<a class="var it988" onMouseOver="hilite(988)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../../_variables/records.html">$records</a> as <a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>) {
<a name="l1555"><span class="linenum">1555</span></a>                      if (!isset (<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>[&quot;{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('name')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>}&quot;])) {
<a name="l1556"><span class="linenum">1556</span></a>                          <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>[&quot;{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('name')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>}&quot;] = <a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('itemcount')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/itemcount.html">itemcount</a>;
<a name="l1557"><span class="linenum">1557</span></a>                      }
<a name="l1558"><span class="linenum">1558</span></a>                  }
<a name="l1559"><span class="linenum">1559</span></a>              }
<a name="l1560"><span class="linenum">1560</span></a>          }
<a name="l1561"><span class="linenum">1561</span></a>          return <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>;
<a name="l1562"><span class="linenum">1562</span></a>      }
<a name="l1563"><span class="linenum">1563</span></a>  
<a name="l1564"><span class="linenum">1564</span></a>      <span class="comment">/**</span>
<a name="l1565"><span class="linenum">1565</span></a>  <span class="comment">     * This function build a table showing the available category shareable</span>
<a name="l1566"><span class="linenum">1566</span></a>  <span class="comment">     * wild cards, their name, their definition (Min, Max, Decimal) , the item count</span>
<a name="l1567"><span class="linenum">1567</span></a>  <span class="comment">     * and the name of the question where they are used.</span>
<a name="l1568"><span class="linenum">1568</span></a>  <span class="comment">     * This table is intended to be add before the question text to help the user use</span>
<a name="l1569"><span class="linenum">1569</span></a>  <span class="comment">     * these wild cards</span>
<a name="l1570"><span class="linenum">1570</span></a>  <span class="comment">     */</span>
<a name="l1571"><span class="linenum">1571</span></a>      public function <a class="function" onClick="logFunction('print_dataset_definitions_category')" href="../../../_functions/print_dataset_definitions_category.html" onMouseOver="funcPopup(event,'print_dataset_definitions_category')">print_dataset_definitions_category</a>(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>) {
<a name="l1572"><span class="linenum">1572</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1573"><span class="linenum">1573</span></a>          <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a> = array();
<a name="l1574"><span class="linenum">1574</span></a>          <a class="var it13094" onMouseOver="hilite(13094)" onMouseOut="lolite()" onClick="logVariable('lnamemax')" href="../../../_variables/lnamemax.html">$lnamemax</a> = 22;
<a name="l1575"><span class="linenum">1575</span></a>          <a class="var it8610" onMouseOver="hilite(8610)" onMouseOut="lolite()" onClick="logVariable('namestr')" href="../../../_variables/namestr.html">$namestr</a>          = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('name');
<a name="l1576"><span class="linenum">1576</span></a>          <a class="var it13095" onMouseOver="hilite(13095)" onMouseOut="lolite()" onClick="logVariable('rangeofvaluestr')" href="../../../_variables/rangeofvaluestr.html">$rangeofvaluestr</a>  = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('minmax', 'qtype_calculated');
<a name="l1577"><span class="linenum">1577</span></a>          <a class="var it13096" onMouseOver="hilite(13096)" onMouseOut="lolite()" onClick="logVariable('questionusingstr')" href="../../../_variables/questionusingstr.html">$questionusingstr</a> = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('usedinquestion', 'qtype_calculated');
<a name="l1578"><span class="linenum">1578</span></a>          <a class="var it13097" onMouseOver="hilite(13097)" onMouseOut="lolite()" onClick="logVariable('itemscountstr')" href="../../../_variables/itemscountstr.html">$itemscountstr</a>    = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('itemscount', 'qtype_calculated');
<a name="l1579"><span class="linenum">1579</span></a>          <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> = '';
<a name="l1580"><span class="linenum">1580</span></a>          if (!empty(<a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('category')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>)) {
<a name="l1581"><span class="linenum">1581</span></a>              <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it261" onMouseOver="hilite(261)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../../_variables/category.html">$category</a>) = <a class="phpfunction" onClick="logFunction('explode')" href="../../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it371" onMouseOver="hilite(371)" onMouseOut="lolite()" onClick="logVariable('form')" href="../../../_variables/form.html">$form</a>-&gt;<a onClick="logVariable('category')" class="var it43215" onMouseOver="hilite(43215)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>);
<a name="l1582"><span class="linenum">1582</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = &quot;SELECT i.*, d.*
<a name="l1583"><span class="linenum">1583</span></a>                  FROM {question_datasets} d,
<a name="l1584"><span class="linenum">1584</span></a>          {question_dataset_definitions} i
<a name="l1585"><span class="linenum">1585</span></a>          WHERE i.id = d.datasetdefinition
<a name="l1586"><span class="linenum">1586</span></a>          AND i.category = ?&quot;;
<a name="l1587"><span class="linenum">1587</span></a>              if (<a class="var it988" onMouseOver="hilite(988)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../../_variables/records.html">$records</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>, array(<a class="var it261" onMouseOver="hilite(261)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../../_variables/category.html">$category</a>))) {
<a name="l1588"><span class="linenum">1588</span></a>                  foreach (<a class="var it988" onMouseOver="hilite(988)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../../_variables/records.html">$records</a> as <a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>) {
<a name="l1589"><span class="linenum">1589</span></a>                      <a class="var it13098" onMouseOver="hilite(13098)" onMouseOut="lolite()" onClick="logVariable('sql1')" href="../../../_variables/sql1.html">$sql1</a> = &quot;SELECT q.*
<a name="l1590"><span class="linenum">1590</span></a>                                 FROM {question} q
<a name="l1591"><span class="linenum">1591</span></a>                                WHERE q.id = ?&quot;;
<a name="l1592"><span class="linenum">1592</span></a>                      if (!isset (<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>[&quot;{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('type')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/type.html">type</a>}-{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('category')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>}-{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('name')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>}&quot;])) {
<a name="l1593"><span class="linenum">1593</span></a>                          <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>[&quot;{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('type')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/type.html">type</a>}-{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('category')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>}-{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('name')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>}&quot;] = <a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>;
<a name="l1594"><span class="linenum">1594</span></a>                      }
<a name="l1595"><span class="linenum">1595</span></a>                      if (<a class="var it13099" onMouseOver="hilite(13099)" onMouseOut="lolite()" onClick="logVariable('questionb')" href="../../../_variables/questionb.html">$questionb</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it13098" onMouseOver="hilite(13098)" onMouseOut="lolite()" onClick="logVariable('sql1')" href="../../../_variables/sql1.html">$sql1</a>, array(<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('question')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/question.html">question</a>))) {
<a name="l1596"><span class="linenum">1596</span></a>                          if (!isset (<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>[&quot;{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('type')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/type.html">type</a>}-{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('category')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>}-{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('name')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>}&quot;]-&gt;questions[<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('question')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/question.html">question</a>])) {
<a name="l1597"><span class="linenum">1597</span></a>                              <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>[&quot;{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('type')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/type.html">type</a>}-{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('category')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>}-{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('name')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>}&quot;]-&gt;questions[<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('question')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/question.html">question</a>] = new stdClass();
<a name="l1598"><span class="linenum">1598</span></a>                          }
<a name="l1599"><span class="linenum">1599</span></a>                          <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>[&quot;{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('type')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/type.html">type</a>}-{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('category')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>}-{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('name')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>}&quot;]-&gt;questions[
<a name="l1600"><span class="linenum">1600</span></a>                                  <a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('question')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/question.html">question</a>]-&gt;name = <a class="var it13099" onMouseOver="hilite(13099)" onMouseOut="lolite()" onClick="logVariable('questionb')" href="../../../_variables/questionb.html">$questionb</a>[<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('question')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/question.html">question</a>]-&gt;name;
<a name="l1601"><span class="linenum">1601</span></a>                      }
<a name="l1602"><span class="linenum">1602</span></a>                  }
<a name="l1603"><span class="linenum">1603</span></a>              }
<a name="l1604"><span class="linenum">1604</span></a>          }
<a name="l1605"><span class="linenum">1605</span></a>          if (!empty (<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>)) {
<a name="l1606"><span class="linenum">1606</span></a>  
<a name="l1607"><span class="linenum">1607</span></a>              <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> = &quot;&lt;table width=\&quot;100%\&quot; border=\&quot;1\&quot;&gt;&lt;tr&gt;
<a name="l1608"><span class="linenum">1608</span></a>                      &lt;th style=\&quot;white-space:nowrap;\&quot; class=\&quot;header\&quot;
<a name="l1609"><span class="linenum">1609</span></a>                              scope=\&quot;col\&quot;&gt;{<a class="var it8610" onMouseOver="hilite(8610)" onMouseOut="lolite()" onClick="logVariable('namestr')" href="../../../_variables/namestr.html">$namestr</a>}&lt;/th&gt;
<a name="l1610"><span class="linenum">1610</span></a>                      &lt;th style=\&quot;white-space:nowrap;\&quot; class=\&quot;header\&quot;
<a name="l1611"><span class="linenum">1611</span></a>                              scope=\&quot;col\&quot;&gt;{<a class="var it13095" onMouseOver="hilite(13095)" onMouseOut="lolite()" onClick="logVariable('rangeofvaluestr')" href="../../../_variables/rangeofvaluestr.html">$rangeofvaluestr</a>}&lt;/th&gt;
<a name="l1612"><span class="linenum">1612</span></a>                      &lt;th style=\&quot;white-space:nowrap;\&quot; class=\&quot;header\&quot;
<a name="l1613"><span class="linenum">1613</span></a>                              scope=\&quot;col\&quot;&gt;{<a class="var it13097" onMouseOver="hilite(13097)" onMouseOut="lolite()" onClick="logVariable('itemscountstr')" href="../../../_variables/itemscountstr.html">$itemscountstr</a>}&lt;/th&gt;
<a name="l1614"><span class="linenum">1614</span></a>                      &lt;th style=\&quot;white-space:nowrap;\&quot; class=\&quot;header\&quot;
<a name="l1615"><span class="linenum">1615</span></a>                              scope=\&quot;col\&quot;&gt;{<a class="var it13096" onMouseOver="hilite(13096)" onMouseOut="lolite()" onClick="logVariable('questionusingstr')" href="../../../_variables/questionusingstr.html">$questionusingstr</a>}&lt;/th&gt;
<a name="l1616"><span class="linenum">1616</span></a>                      &lt;/tr&gt;&quot;;
<a name="l1617"><span class="linenum">1617</span></a>              foreach (<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a> as <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>) {
<a name="l1618"><span class="linenum">1618</span></a>                  <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it13026" onMouseOver="hilite(13026)" onMouseOut="lolite()" onClick="logVariable('distribution')" href="../../../_variables/distribution.html">$distribution</a>, <a class="var it2299" onMouseOver="hilite(2299)" onMouseOut="lolite()" onClick="logVariable('min')" href="../../../_variables/min.html">$min</a>, <a class="var it536" onMouseOver="hilite(536)" onMouseOut="lolite()" onClick="logVariable('max')" href="../../../_variables/max.html">$max</a>, <a class="var it13027" onMouseOver="hilite(13027)" onMouseOut="lolite()" onClick="logVariable('dec')" href="../../../_variables/dec.html">$dec</a>) = <a class="phpfunction" onClick="logFunction('explode')" href="../../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(':', <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('options')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>, 4);
<a name="l1619"><span class="linenum">1619</span></a>                  <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> .= &quot;&lt;tr&gt;
<a name="l1620"><span class="linenum">1620</span></a>                          &lt;td valign=\&quot;top\&quot; align=\&quot;center\&quot;&gt;{<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('name')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>}&lt;/td&gt;
<a name="l1621"><span class="linenum">1621</span></a>                          &lt;td align=\&quot;center\&quot; valign=\&quot;top\&quot;&gt;{<a class="var it2299" onMouseOver="hilite(2299)" onMouseOut="lolite()" onClick="logVariable('min')" href="../../../_variables/min.html">$min</a>} &lt;strong&gt;-&lt;/strong&gt; <a class="var it536" onMouseOver="hilite(536)" onMouseOut="lolite()" onClick="logVariable('max')" href="../../../_variables/max.html">$max</a>&lt;/td&gt;
<a name="l1622"><span class="linenum">1622</span></a>                          &lt;td align=\&quot;right\&quot; valign=\&quot;top\&quot;&gt;{<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('itemcount')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/itemcount.html">itemcount</a>}&amp;nbsp;&amp;nbsp;&lt;/td&gt;
<a name="l1623"><span class="linenum">1623</span></a>                          &lt;td align=\&quot;left\&quot;&gt;&quot;;
<a name="l1624"><span class="linenum">1624</span></a>                  foreach (<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('questions')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/questions.html">questions</a> as <a class="var it13100" onMouseOver="hilite(13100)" onMouseOut="lolite()" onClick="logVariable('qu')" href="../../../_variables/qu.html">$qu</a>) {
<a name="l1625"><span class="linenum">1625</span></a>  <span class="comment">                    // Limit the name length displayed.</span>
<a name="l1626"><span class="linenum">1626</span></a>                      if (!empty(<a class="var it13100" onMouseOver="hilite(13100)" onMouseOut="lolite()" onClick="logVariable('qu')" href="../../../_variables/qu.html">$qu</a>-&gt;<a onClick="logVariable('name')" class="var it44024" onMouseOver="hilite(44024)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>)) {
<a name="l1627"><span class="linenum">1627</span></a>                          <a class="var it13100" onMouseOver="hilite(13100)" onMouseOut="lolite()" onClick="logVariable('qu')" href="../../../_variables/qu.html">$qu</a>-&gt;<a onClick="logVariable('name')" class="var it44024" onMouseOver="hilite(44024)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a> = (<a class="function" onClick="logFunction('strlen')" href="../../../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it13100" onMouseOver="hilite(13100)" onMouseOut="lolite()" onClick="logVariable('qu')" href="../../../_variables/qu.html">$qu</a>-&gt;<a onClick="logVariable('name')" class="var it44024" onMouseOver="hilite(44024)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>) &gt; <a class="var it13094" onMouseOver="hilite(13094)" onMouseOut="lolite()" onClick="logVariable('lnamemax')" href="../../../_variables/lnamemax.html">$lnamemax</a>) ?
<a name="l1628"><span class="linenum">1628</span></a>                              <a class="phpfunction" onClick="logFunction('substr')" href="../../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it13100" onMouseOver="hilite(13100)" onMouseOut="lolite()" onClick="logVariable('qu')" href="../../../_variables/qu.html">$qu</a>-&gt;<a onClick="logVariable('name')" class="var it44024" onMouseOver="hilite(44024)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>, 0, <a class="var it13094" onMouseOver="hilite(13094)" onMouseOut="lolite()" onClick="logVariable('lnamemax')" href="../../../_variables/lnamemax.html">$lnamemax</a>).'...' : <a class="var it13100" onMouseOver="hilite(13100)" onMouseOut="lolite()" onClick="logVariable('qu')" href="../../../_variables/qu.html">$qu</a>-&gt;<a onClick="logVariable('name')" class="var it44024" onMouseOver="hilite(44024)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>;
<a name="l1629"><span class="linenum">1629</span></a>                      } else {
<a name="l1630"><span class="linenum">1630</span></a>                          <a class="var it13100" onMouseOver="hilite(13100)" onMouseOut="lolite()" onClick="logVariable('qu')" href="../../../_variables/qu.html">$qu</a>-&gt;<a onClick="logVariable('name')" class="var it44024" onMouseOver="hilite(44024)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a> = '';
<a name="l1631"><span class="linenum">1631</span></a>                      }
<a name="l1632"><span class="linenum">1632</span></a>                      <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> .= &quot; &amp;nbsp;&amp;nbsp; {<a class="var it13100" onMouseOver="hilite(13100)" onMouseOut="lolite()" onClick="logVariable('qu')" href="../../../_variables/qu.html">$qu</a>-&gt;<a onClick="logVariable('name')" class="var it44024" onMouseOver="hilite(44024)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>} &lt;br/&gt;&quot;;
<a name="l1633"><span class="linenum">1633</span></a>                  }
<a name="l1634"><span class="linenum">1634</span></a>                  <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> .= &quot;&lt;/td&gt;&lt;/tr&gt;&quot;;
<a name="l1635"><span class="linenum">1635</span></a>              }
<a name="l1636"><span class="linenum">1636</span></a>              <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> .= &quot;&lt;/table&gt;&quot;;
<a name="l1637"><span class="linenum">1637</span></a>          } else {
<a name="l1638"><span class="linenum">1638</span></a>              <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> .= <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('nosharedwildcard', 'qtype_calculated');
<a name="l1639"><span class="linenum">1639</span></a>          }
<a name="l1640"><span class="linenum">1640</span></a>          return <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a>;
<a name="l1641"><span class="linenum">1641</span></a>      }
<a name="l1642"><span class="linenum">1642</span></a>  
<a name="l1643"><span class="linenum">1643</span></a>      <span class="comment">/**</span>
<a name="l1644"><span class="linenum">1644</span></a>  <span class="comment">     * This function build a table showing the available category shareable</span>
<a name="l1645"><span class="linenum">1645</span></a>  <span class="comment">     * wild cards, their name, their definition (Min, Max, Decimal) , the item count</span>
<a name="l1646"><span class="linenum">1646</span></a>  <span class="comment">     * and the name of the question where they are used.</span>
<a name="l1647"><span class="linenum">1647</span></a>  <span class="comment">     * This table is intended to be add before the question text to help the user use</span>
<a name="l1648"><span class="linenum">1648</span></a>  <span class="comment">     * these wild cards</span>
<a name="l1649"><span class="linenum">1649</span></a>  <span class="comment">     */</span>
<a name="l1650"><span class="linenum">1650</span></a>  
<a name="l1651"><span class="linenum">1651</span></a>      public function <a class="function" onClick="logFunction('print_dataset_definitions_category_shared')" href="../../../_functions/print_dataset_definitions_category_shared.html" onMouseOver="funcPopup(event,'print_dataset_definitions_category_shared')">print_dataset_definitions_category_shared</a>(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>, <a class="var it13101" onMouseOver="hilite(13101)" onMouseOut="lolite()" onClick="logVariable('datasetdefsq')" href="../../../_variables/datasetdefsq.html">$datasetdefsq</a>) {
<a name="l1652"><span class="linenum">1652</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1653"><span class="linenum">1653</span></a>          <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a> = array();
<a name="l1654"><span class="linenum">1654</span></a>          <a class="var it13094" onMouseOver="hilite(13094)" onMouseOut="lolite()" onClick="logVariable('lnamemax')" href="../../../_variables/lnamemax.html">$lnamemax</a> = 22;
<a name="l1655"><span class="linenum">1655</span></a>          <a class="var it8610" onMouseOver="hilite(8610)" onMouseOut="lolite()" onClick="logVariable('namestr')" href="../../../_variables/namestr.html">$namestr</a>          = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('name', 'quiz');
<a name="l1656"><span class="linenum">1656</span></a>          <a class="var it13095" onMouseOver="hilite(13095)" onMouseOut="lolite()" onClick="logVariable('rangeofvaluestr')" href="../../../_variables/rangeofvaluestr.html">$rangeofvaluestr</a>  = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('minmax', 'qtype_calculated');
<a name="l1657"><span class="linenum">1657</span></a>          <a class="var it13096" onMouseOver="hilite(13096)" onMouseOut="lolite()" onClick="logVariable('questionusingstr')" href="../../../_variables/questionusingstr.html">$questionusingstr</a> = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('usedinquestion', 'qtype_calculated');
<a name="l1658"><span class="linenum">1658</span></a>          <a class="var it13097" onMouseOver="hilite(13097)" onMouseOut="lolite()" onClick="logVariable('itemscountstr')" href="../../../_variables/itemscountstr.html">$itemscountstr</a>    = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('itemscount', 'qtype_calculated');
<a name="l1659"><span class="linenum">1659</span></a>          <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> = '';
<a name="l1660"><span class="linenum">1660</span></a>          if (!empty(<a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('category')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>)) {
<a name="l1661"><span class="linenum">1661</span></a>              <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it261" onMouseOver="hilite(261)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../../_variables/category.html">$category</a>) = <a class="phpfunction" onClick="logFunction('explode')" href="../../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it259" onMouseOver="hilite(259)" onMouseOut="lolite()" onClick="logVariable('question')" href="../../../_variables/question.html">$question</a>-&gt;<a onClick="logVariable('category')" class="var it43018" onMouseOver="hilite(43018)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>);
<a name="l1662"><span class="linenum">1662</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = &quot;SELECT i.*, d.*
<a name="l1663"><span class="linenum">1663</span></a>                        FROM {question_datasets} d, {question_dataset_definitions} i
<a name="l1664"><span class="linenum">1664</span></a>                       WHERE i.id = d.datasetdefinition AND i.category = ?&quot;;
<a name="l1665"><span class="linenum">1665</span></a>              if (<a class="var it988" onMouseOver="hilite(988)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../../_variables/records.html">$records</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>, array(<a class="var it261" onMouseOver="hilite(261)" onMouseOut="lolite()" onClick="logVariable('category')" href="../../../_variables/category.html">$category</a>))) {
<a name="l1666"><span class="linenum">1666</span></a>                  foreach (<a class="var it988" onMouseOver="hilite(988)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../../_variables/records.html">$records</a> as <a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>) {
<a name="l1667"><span class="linenum">1667</span></a>                      <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a> = &quot;{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('type')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/type.html">type</a>}-{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('category')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/category.html">category</a>}-{<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('name')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>}&quot;;
<a name="l1668"><span class="linenum">1668</span></a>                      <a class="var it13098" onMouseOver="hilite(13098)" onMouseOut="lolite()" onClick="logVariable('sql1')" href="../../../_variables/sql1.html">$sql1</a> = &quot;SELECT q.*
<a name="l1669"><span class="linenum">1669</span></a>                                 FROM {question} q
<a name="l1670"><span class="linenum">1670</span></a>                                WHERE q.id = ?&quot;;
<a name="l1671"><span class="linenum">1671</span></a>                      if (!isset(<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>])) {
<a name="l1672"><span class="linenum">1672</span></a>                          <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>] = <a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>;
<a name="l1673"><span class="linenum">1673</span></a>                      }
<a name="l1674"><span class="linenum">1674</span></a>                      if (<a class="var it13099" onMouseOver="hilite(13099)" onMouseOut="lolite()" onClick="logVariable('questionb')" href="../../../_variables/questionb.html">$questionb</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../../../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it13098" onMouseOver="hilite(13098)" onMouseOut="lolite()" onClick="logVariable('sql1')" href="../../../_variables/sql1.html">$sql1</a>, array(<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('question')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/question.html">question</a>))) {
<a name="l1675"><span class="linenum">1675</span></a>                          <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>]-&gt;questions[<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('question')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/question.html">question</a>] = new stdClass();
<a name="l1676"><span class="linenum">1676</span></a>                          <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>]-&gt;questions[<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('question')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/question.html">question</a>]-&gt;name =
<a name="l1677"><span class="linenum">1677</span></a>                                  <a class="var it13099" onMouseOver="hilite(13099)" onMouseOut="lolite()" onClick="logVariable('questionb')" href="../../../_variables/questionb.html">$questionb</a>[<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('question')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/question.html">question</a>]-&gt;name;
<a name="l1678"><span class="linenum">1678</span></a>                          <a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>]-&gt;questions[<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('question')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/question.html">question</a>]-&gt;id =
<a name="l1679"><span class="linenum">1679</span></a>                                  <a class="var it13099" onMouseOver="hilite(13099)" onMouseOut="lolite()" onClick="logVariable('questionb')" href="../../../_variables/questionb.html">$questionb</a>[<a class="var it1024" onMouseOver="hilite(1024)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>-&gt;<a onClick="logVariable('question')" class="var it43412" onMouseOver="hilite(43412)" onMouseOut="lolite()" href="../../../_variables/question.html">question</a>]-&gt;id;
<a name="l1680"><span class="linenum">1680</span></a>                      }
<a name="l1681"><span class="linenum">1681</span></a>                  }
<a name="l1682"><span class="linenum">1682</span></a>              }
<a name="l1683"><span class="linenum">1683</span></a>          }
<a name="l1684"><span class="linenum">1684</span></a>          if (!empty (<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a>)) {
<a name="l1685"><span class="linenum">1685</span></a>  
<a name="l1686"><span class="linenum">1686</span></a>              <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a>  = &quot;&lt;table width=\&quot;100%\&quot; border=\&quot;1\&quot;&gt;&lt;tr&gt;
<a name="l1687"><span class="linenum">1687</span></a>                      &lt;th style=\&quot;white-space:nowrap;\&quot; class=\&quot;header\&quot;
<a name="l1688"><span class="linenum">1688</span></a>                              scope=\&quot;col\&quot;&gt;{<a class="var it8610" onMouseOver="hilite(8610)" onMouseOut="lolite()" onClick="logVariable('namestr')" href="../../../_variables/namestr.html">$namestr</a>}&lt;/th&gt;&quot;;
<a name="l1689"><span class="linenum">1689</span></a>              <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> .= &quot;&lt;th style=\&quot;white-space:nowrap;\&quot; class=\&quot;header\&quot;
<a name="l1690"><span class="linenum">1690</span></a>                      scope=\&quot;col\&quot;&gt;{<a class="var it13097" onMouseOver="hilite(13097)" onMouseOut="lolite()" onClick="logVariable('itemscountstr')" href="../../../_variables/itemscountstr.html">$itemscountstr</a>}&lt;/th&gt;&quot;;
<a name="l1691"><span class="linenum">1691</span></a>              <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> .= &quot;&lt;th style=\&quot;white-space:nowrap;\&quot; class=\&quot;header\&quot;
<a name="l1692"><span class="linenum">1692</span></a>                      scope=\&quot;col\&quot;&gt;&amp;nbsp;&amp;nbsp;{<a class="var it13096" onMouseOver="hilite(13096)" onMouseOut="lolite()" onClick="logVariable('questionusingstr')" href="../../../_variables/questionusingstr.html">$questionusingstr</a>} &amp;nbsp;&amp;nbsp;&lt;/th&gt;&quot;;
<a name="l1693"><span class="linenum">1693</span></a>              <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> .= &quot;&lt;th style=\&quot;white-space:nowrap;\&quot; class=\&quot;header\&quot;
<a name="l1694"><span class="linenum">1694</span></a>                      scope=\&quot;col\&quot;&gt;Quiz&lt;/th&gt;&quot;;
<a name="l1695"><span class="linenum">1695</span></a>              <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> .= &quot;&lt;th style=\&quot;white-space:nowrap;\&quot; class=\&quot;header\&quot;
<a name="l1696"><span class="linenum">1696</span></a>                      scope=\&quot;col\&quot;&gt;Attempts&lt;/th&gt;&lt;/tr&gt;&quot;;
<a name="l1697"><span class="linenum">1697</span></a>              foreach (<a class="var it13025" onMouseOver="hilite(13025)" onMouseOut="lolite()" onClick="logVariable('datasetdefs')" href="../../../_variables/datasetdefs.html">$datasetdefs</a> as <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>) {
<a name="l1698"><span class="linenum">1698</span></a>                  <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it13026" onMouseOver="hilite(13026)" onMouseOut="lolite()" onClick="logVariable('distribution')" href="../../../_variables/distribution.html">$distribution</a>, <a class="var it2299" onMouseOver="hilite(2299)" onMouseOut="lolite()" onClick="logVariable('min')" href="../../../_variables/min.html">$min</a>, <a class="var it536" onMouseOver="hilite(536)" onMouseOut="lolite()" onClick="logVariable('max')" href="../../../_variables/max.html">$max</a>, <a class="var it13027" onMouseOver="hilite(13027)" onMouseOut="lolite()" onClick="logVariable('dec')" href="../../../_variables/dec.html">$dec</a>) = <a class="phpfunction" onClick="logFunction('explode')" href="../../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(':', <a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('options')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>, 4);
<a name="l1699"><span class="linenum">1699</span></a>                  <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../../_variables/count.html">$count</a> = <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('questions')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/questions.html">questions</a>);
<a name="l1700"><span class="linenum">1700</span></a>                  <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> .= &quot;&lt;tr&gt;
<a name="l1701"><span class="linenum">1701</span></a>                          &lt;td style=\&quot;white-space:nowrap;\&quot; valign=\&quot;top\&quot;
<a name="l1702"><span class="linenum">1702</span></a>                                  align=\&quot;center\&quot; rowspan=\&quot;{<a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../../_variables/count.html">$count</a>}\&quot;&gt; {<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('name')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>} &lt;/td&gt;
<a name="l1703"><span class="linenum">1703</span></a>                          &lt;td align=\&quot;right\&quot; valign=\&quot;top\&quot;
<a name="l1704"><span class="linenum">1704</span></a>                                  rowspan=\&quot;{<a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../../_variables/count.html">$count</a>}\&quot;&gt;{<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('itemcount')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/itemcount.html">itemcount</a>}&lt;/td&gt;&quot;;
<a name="l1705"><span class="linenum">1705</span></a>                  <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('line')" href="../../../_variables/line.html">$line</a> = 0;
<a name="l1706"><span class="linenum">1706</span></a>                  foreach (<a class="var it13034" onMouseOver="hilite(13034)" onMouseOut="lolite()" onClick="logVariable('datasetdef')" href="../../../_variables/datasetdef.html">$datasetdef</a>-&gt;<a onClick="logVariable('questions')" class="var it43196" onMouseOver="hilite(43196)" onMouseOut="lolite()" href="../../../_variables/questions.html">questions</a> as <a class="var it13100" onMouseOver="hilite(13100)" onMouseOut="lolite()" onClick="logVariable('qu')" href="../../../_variables/qu.html">$qu</a>) {
<a name="l1707"><span class="linenum">1707</span></a>  <span class="comment">                    // Limit the name length displayed.</span>
<a name="l1708"><span class="linenum">1708</span></a>                      if (!empty(<a class="var it13100" onMouseOver="hilite(13100)" onMouseOut="lolite()" onClick="logVariable('qu')" href="../../../_variables/qu.html">$qu</a>-&gt;<a onClick="logVariable('name')" class="var it44024" onMouseOver="hilite(44024)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>)) {
<a name="l1709"><span class="linenum">1709</span></a>                          <a class="var it13100" onMouseOver="hilite(13100)" onMouseOut="lolite()" onClick="logVariable('qu')" href="../../../_variables/qu.html">$qu</a>-&gt;<a onClick="logVariable('name')" class="var it44024" onMouseOver="hilite(44024)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a> = (<a class="function" onClick="logFunction('strlen')" href="../../../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it13100" onMouseOver="hilite(13100)" onMouseOut="lolite()" onClick="logVariable('qu')" href="../../../_variables/qu.html">$qu</a>-&gt;<a onClick="logVariable('name')" class="var it44024" onMouseOver="hilite(44024)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>) &gt; <a class="var it13094" onMouseOver="hilite(13094)" onMouseOut="lolite()" onClick="logVariable('lnamemax')" href="../../../_variables/lnamemax.html">$lnamemax</a>) ?
<a name="l1710"><span class="linenum">1710</span></a>                              <a class="phpfunction" onClick="logFunction('substr')" href="../../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it13100" onMouseOver="hilite(13100)" onMouseOut="lolite()" onClick="logVariable('qu')" href="../../../_variables/qu.html">$qu</a>-&gt;<a onClick="logVariable('name')" class="var it44024" onMouseOver="hilite(44024)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>, 0, <a class="var it13094" onMouseOver="hilite(13094)" onMouseOut="lolite()" onClick="logVariable('lnamemax')" href="../../../_variables/lnamemax.html">$lnamemax</a>).'...' : <a class="var it13100" onMouseOver="hilite(13100)" onMouseOut="lolite()" onClick="logVariable('qu')" href="../../../_variables/qu.html">$qu</a>-&gt;<a onClick="logVariable('name')" class="var it44024" onMouseOver="hilite(44024)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>;
<a name="l1711"><span class="linenum">1711</span></a>                      } else {
<a name="l1712"><span class="linenum">1712</span></a>                          <a class="var it13100" onMouseOver="hilite(13100)" onMouseOut="lolite()" onClick="logVariable('qu')" href="../../../_variables/qu.html">$qu</a>-&gt;<a onClick="logVariable('name')" class="var it44024" onMouseOver="hilite(44024)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a> = '';
<a name="l1713"><span class="linenum">1713</span></a>                      }
<a name="l1714"><span class="linenum">1714</span></a>                      if (<a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('line')" href="../../../_variables/line.html">$line</a>) {
<a name="l1715"><span class="linenum">1715</span></a>                          <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> .= &quot;&lt;tr&gt;&quot;;
<a name="l1716"><span class="linenum">1716</span></a>                      }
<a name="l1717"><span class="linenum">1717</span></a>                      <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('line')" href="../../../_variables/line.html">$line</a>++;
<a name="l1718"><span class="linenum">1718</span></a>                      <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> .= &quot;&lt;td align=\&quot;left\&quot; style=\&quot;white-space:nowrap;\&quot;&gt;{<a class="var it13100" onMouseOver="hilite(13100)" onMouseOut="lolite()" onClick="logVariable('qu')" href="../../../_variables/qu.html">$qu</a>-&gt;<a onClick="logVariable('name')" class="var it44024" onMouseOver="hilite(44024)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>}&lt;/td&gt;&quot;;
<a name="l1719"><span class="linenum">1719</span></a>  <span class="comment">                    // TODO MDL-43779 should not have quiz-specific code here.</span>
<a name="l1720"><span class="linenum">1720</span></a>                      <a class="var it13102" onMouseOver="hilite(13102)" onMouseOut="lolite()" onClick="logVariable('nbofquiz')" href="../../../_variables/nbofquiz.html">$nbofquiz</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records')" href="../../../_functions/count_records.html" onMouseOver="funcPopup(event,'count_records')">count_records</a>('quiz_slots', array('questionid' =&gt; <a class="var it13100" onMouseOver="hilite(13100)" onMouseOut="lolite()" onClick="logVariable('qu')" href="../../../_variables/qu.html">$qu</a>-&gt;<a onClick="logVariable('id')" class="var it44024" onMouseOver="hilite(44024)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l1721"><span class="linenum">1721</span></a>                      <a class="var it13103" onMouseOver="hilite(13103)" onMouseOut="lolite()" onClick="logVariable('nbofattempts')" href="../../../_variables/nbofattempts.html">$nbofattempts</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records_sql')" href="../../../_functions/count_records_sql.html" onMouseOver="funcPopup(event,'count_records_sql')">count_records_sql</a>(&quot;
<a name="l1722"><span class="linenum">1722</span></a>                              SELECT <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(1)
<a name="l1723"><span class="linenum">1723</span></a>                                FROM {quiz_slots} slot
<a name="l1724"><span class="linenum">1724</span></a>                                JOIN {quiz_attempts} quiza ON quiza.quiz = slot.quizid
<a name="l1725"><span class="linenum">1725</span></a>                               WHERE slot.questionid = ?
<a name="l1726"><span class="linenum">1726</span></a>                                 AND quiza.preview = 0&quot;, array(<a class="var it13100" onMouseOver="hilite(13100)" onMouseOut="lolite()" onClick="logVariable('qu')" href="../../../_variables/qu.html">$qu</a>-&gt;<a onClick="logVariable('id')" class="var it44024" onMouseOver="hilite(44024)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a>));
<a name="l1727"><span class="linenum">1727</span></a>                      if (<a class="var it13102" onMouseOver="hilite(13102)" onMouseOut="lolite()" onClick="logVariable('nbofquiz')" href="../../../_variables/nbofquiz.html">$nbofquiz</a> &gt; 0) {
<a name="l1728"><span class="linenum">1728</span></a>                          <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> .= &quot;&lt;td align=\&quot;center\&quot;&gt;{<a class="var it13102" onMouseOver="hilite(13102)" onMouseOut="lolite()" onClick="logVariable('nbofquiz')" href="../../../_variables/nbofquiz.html">$nbofquiz</a>}&lt;/td&gt;&quot;;
<a name="l1729"><span class="linenum">1729</span></a>                          <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> .= &quot;&lt;td align=\&quot;center\&quot;&gt;{<a class="var it13103" onMouseOver="hilite(13103)" onMouseOut="lolite()" onClick="logVariable('nbofattempts')" href="../../../_variables/nbofattempts.html">$nbofattempts</a>}&quot;;
<a name="l1730"><span class="linenum">1730</span></a>                      } else {
<a name="l1731"><span class="linenum">1731</span></a>                          <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> .= &quot;&lt;td align=\&quot;center\&quot;&gt;0&lt;/td&gt;&quot;;
<a name="l1732"><span class="linenum">1732</span></a>                          <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> .= &quot;&lt;td align=\&quot;left\&quot;&gt;&lt;br/&gt;&quot;;
<a name="l1733"><span class="linenum">1733</span></a>                      }
<a name="l1734"><span class="linenum">1734</span></a>  
<a name="l1735"><span class="linenum">1735</span></a>                      <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> .= &quot;&lt;/td&gt;&lt;/tr&gt;&quot;;
<a name="l1736"><span class="linenum">1736</span></a>                  }
<a name="l1737"><span class="linenum">1737</span></a>              }
<a name="l1738"><span class="linenum">1738</span></a>              <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> .= &quot;&lt;/table&gt;&quot;;
<a name="l1739"><span class="linenum">1739</span></a>          } else {
<a name="l1740"><span class="linenum">1740</span></a>              <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> .= <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('nosharedwildcard', 'qtype_calculated');
<a name="l1741"><span class="linenum">1741</span></a>          }
<a name="l1742"><span class="linenum">1742</span></a>          return <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a>;
<a name="l1743"><span class="linenum">1743</span></a>      }
<a name="l1744"><span class="linenum">1744</span></a>  
<a name="l1745"><span class="linenum">1745</span></a>      public function <a class="function" onClick="logFunction('find_math_equations')" href="../../../_functions/find_math_equations.html" onMouseOver="funcPopup(event,'find_math_equations')">find_math_equations</a>(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a>) {
<a name="l1746"><span class="linenum">1746</span></a>  <span class="comment">        // Returns the possible dataset names found in the text as an array.</span>
<a name="l1747"><span class="linenum">1747</span></a>  <span class="comment">        // The array has the dataset name for both key and value.</span>
<a name="l1748"><span class="linenum">1748</span></a>          <a class="var it13104" onMouseOver="hilite(13104)" onMouseOut="lolite()" onClick="logVariable('equations')" href="../../../_variables/equations.html">$equations</a> = array();
<a name="l1749"><span class="linenum">1749</span></a>          while (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('~\{=([^[:space:]}]*)}~', <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a>, <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>)) {
<a name="l1750"><span class="linenum">1750</span></a>              <a class="var it13104" onMouseOver="hilite(13104)" onMouseOut="lolite()" onClick="logVariable('equations')" href="../../../_variables/equations.html">$equations</a>[] = <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[1];
<a name="l1751"><span class="linenum">1751</span></a>              <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>(<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[0], '', <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a>);
<a name="l1752"><span class="linenum">1752</span></a>          }
<a name="l1753"><span class="linenum">1753</span></a>          return <a class="var it13104" onMouseOver="hilite(13104)" onMouseOut="lolite()" onClick="logVariable('equations')" href="../../../_variables/equations.html">$equations</a>;
<a name="l1754"><span class="linenum">1754</span></a>      }
<a name="l1755"><span class="linenum">1755</span></a>  
<a name="l1756"><span class="linenum">1756</span></a>      public function <a class="function" onClick="logFunction('get_virtual_qtype')" href="../../../_functions/get_virtual_qtype.html" onMouseOver="funcPopup(event,'get_virtual_qtype')">get_virtual_qtype</a>() {
<a name="l1757"><span class="linenum">1757</span></a>          return question_bank::<a class="function" onClick="logFunction('get_qtype')" href="../../../_functions/get_qtype.html" onMouseOver="funcPopup(event,'get_qtype')">get_qtype</a>('numerical');
<a name="l1758"><span class="linenum">1758</span></a>      }
<a name="l1759"><span class="linenum">1759</span></a>  
<a name="l1760"><span class="linenum">1760</span></a>      public function <a class="function" onClick="logFunction('get_possible_responses')" href="../../../_functions/get_possible_responses.html" onMouseOver="funcPopup(event,'get_possible_responses')">get_possible_responses</a>(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('questiondata')" href="../../../_variables/questiondata.html">$questiondata</a>) {
<a name="l1761"><span class="linenum">1761</span></a>          <a class="var it4437" onMouseOver="hilite(4437)" onMouseOut="lolite()" onClick="logVariable('responses')" href="../../../_variables/responses.html">$responses</a> = array();
<a name="l1762"><span class="linenum">1762</span></a>  
<a name="l1763"><span class="linenum">1763</span></a>          <a class="var it13031" onMouseOver="hilite(13031)" onMouseOut="lolite()" onClick="logVariable('virtualqtype')" href="../../../_variables/virtualqtype.html">$virtualqtype</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_virtual_qtype')" href="../../../_functions/get_virtual_qtype.html" onMouseOver="funcPopup(event,'get_virtual_qtype')">get_virtual_qtype</a>();
<a name="l1764"><span class="linenum">1764</span></a>          <a class="var it4171" onMouseOver="hilite(4171)" onMouseOut="lolite()" onClick="logVariable('unit')" href="../../../_variables/unit.html">$unit</a> = <a class="var it13031" onMouseOver="hilite(13031)" onMouseOut="lolite()" onClick="logVariable('virtualqtype')" href="../../../_variables/virtualqtype.html">$virtualqtype</a>-&gt;<a class="function" onClick="logFunction('get_default_numerical_unit')" href="../../../_functions/get_default_numerical_unit.html" onMouseOver="funcPopup(event,'get_default_numerical_unit')">get_default_numerical_unit</a>(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('questiondata')" href="../../../_variables/questiondata.html">$questiondata</a>);
<a name="l1765"><span class="linenum">1765</span></a>  
<a name="l1766"><span class="linenum">1766</span></a>          <a class="var it13105" onMouseOver="hilite(13105)" onMouseOut="lolite()" onClick="logVariable('tolerancetypes')" href="../../../_variables/tolerancetypes.html">$tolerancetypes</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('tolerance_types')" href="../../../_functions/tolerance_types.html" onMouseOver="funcPopup(event,'tolerance_types')">tolerance_types</a>();
<a name="l1767"><span class="linenum">1767</span></a>  
<a name="l1768"><span class="linenum">1768</span></a>          <a class="var it13106" onMouseOver="hilite(13106)" onMouseOut="lolite()" onClick="logVariable('starfound')" href="../../../_variables/starfound.html">$starfound</a> = false;
<a name="l1769"><span class="linenum">1769</span></a>          foreach (<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('questiondata')" href="../../../_variables/questiondata.html">$questiondata</a>-&gt;<a onClick="logVariable('options')" class="var it43218" onMouseOver="hilite(43218)" onMouseOut="lolite()" href="../../../_variables/options.html">options</a>-&gt;answers as <a class="var it186" onMouseOver="hilite(186)" onMouseOut="lolite()" onClick="logVariable('aid')" href="../../../_variables/aid.html">$aid</a> =&gt; <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>) {
<a name="l1770"><span class="linenum">1770</span></a>              <a class="var it3828" onMouseOver="hilite(3828)" onMouseOut="lolite()" onClick="logVariable('responseclass')" href="../../../_variables/responseclass.html">$responseclass</a> = <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('answer')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a>;
<a name="l1771"><span class="linenum">1771</span></a>  
<a name="l1772"><span class="linenum">1772</span></a>              if (<a class="var it3828" onMouseOver="hilite(3828)" onMouseOut="lolite()" onClick="logVariable('responseclass')" href="../../../_variables/responseclass.html">$responseclass</a> === '*') {
<a name="l1773"><span class="linenum">1773</span></a>                  <a class="var it13106" onMouseOver="hilite(13106)" onMouseOut="lolite()" onClick="logVariable('starfound')" href="../../../_variables/starfound.html">$starfound</a> = true;
<a name="l1774"><span class="linenum">1774</span></a>              } else {
<a name="l1775"><span class="linenum">1775</span></a>                  <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../../_variables/a.html">$a</a> = new stdClass();
<a name="l1776"><span class="linenum">1776</span></a>                  <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('answer')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a> = <a class="var it13031" onMouseOver="hilite(13031)" onMouseOut="lolite()" onClick="logVariable('virtualqtype')" href="../../../_variables/virtualqtype.html">$virtualqtype</a>-&gt;<a class="function" onClick="logFunction('add_unit')" href="../../../_functions/add_unit.html" onMouseOver="funcPopup(event,'add_unit')">add_unit</a>(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('questiondata')" href="../../../_variables/questiondata.html">$questiondata</a>, <a class="var it3828" onMouseOver="hilite(3828)" onMouseOut="lolite()" onClick="logVariable('responseclass')" href="../../../_variables/responseclass.html">$responseclass</a>, <a class="var it4171" onMouseOver="hilite(4171)" onMouseOut="lolite()" onClick="logVariable('unit')" href="../../../_variables/unit.html">$unit</a>);
<a name="l1777"><span class="linenum">1777</span></a>                  <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('tolerance')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../../_variables/tolerance.html">tolerance</a> = <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('tolerance')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/tolerance.html">tolerance</a>;
<a name="l1778"><span class="linenum">1778</span></a>                  <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../../_variables/a.html">$a</a>-&gt;<a onClick="logVariable('tolerancetype')" class="var it42992" onMouseOver="hilite(42992)" onMouseOut="lolite()" href="../../../_variables/tolerancetype.html">tolerancetype</a> = <a class="var it13105" onMouseOver="hilite(13105)" onMouseOut="lolite()" onClick="logVariable('tolerancetypes')" href="../../../_variables/tolerancetypes.html">$tolerancetypes</a>[<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('tolerancetype')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/tolerancetype.html">tolerancetype</a>];
<a name="l1779"><span class="linenum">1779</span></a>  
<a name="l1780"><span class="linenum">1780</span></a>                  <a class="var it3828" onMouseOver="hilite(3828)" onMouseOut="lolite()" onClick="logVariable('responseclass')" href="../../../_variables/responseclass.html">$responseclass</a> = <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('answerwithtolerance', 'qtype_calculated', <a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../../../_variables/a.html">$a</a>);
<a name="l1781"><span class="linenum">1781</span></a>              }
<a name="l1782"><span class="linenum">1782</span></a>  
<a name="l1783"><span class="linenum">1783</span></a>              <a class="var it4437" onMouseOver="hilite(4437)" onMouseOut="lolite()" onClick="logVariable('responses')" href="../../../_variables/responses.html">$responses</a>[<a class="var it186" onMouseOver="hilite(186)" onMouseOut="lolite()" onClick="logVariable('aid')" href="../../../_variables/aid.html">$aid</a>] = <span class="keyword">new </span><a class="class" onClick="logClass('question_possible_response')" href="../../../_classes/question_possible_response.html" onMouseOver="classPopup(event,'question_possible_response')">question_possible_response</a>(<a class="var it3828" onMouseOver="hilite(3828)" onMouseOut="lolite()" onClick="logVariable('responseclass')" href="../../../_variables/responseclass.html">$responseclass</a>,
<a name="l1784"><span class="linenum">1784</span></a>                      <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>-&gt;<a onClick="logVariable('fraction')" class="var it43027" onMouseOver="hilite(43027)" onMouseOut="lolite()" href="../../../_variables/fraction.html">fraction</a>);
<a name="l1785"><span class="linenum">1785</span></a>          }
<a name="l1786"><span class="linenum">1786</span></a>  
<a name="l1787"><span class="linenum">1787</span></a>          if (!<a class="var it13106" onMouseOver="hilite(13106)" onMouseOut="lolite()" onClick="logVariable('starfound')" href="../../../_variables/starfound.html">$starfound</a>) {
<a name="l1788"><span class="linenum">1788</span></a>              <a class="var it4437" onMouseOver="hilite(4437)" onMouseOut="lolite()" onClick="logVariable('responses')" href="../../../_variables/responses.html">$responses</a>[0] = <span class="keyword">new </span><a class="class" onClick="logClass('question_possible_response')" href="../../../_classes/question_possible_response.html" onMouseOver="classPopup(event,'question_possible_response')">question_possible_response</a>(
<a name="l1789"><span class="linenum">1789</span></a>              <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('didnotmatchanyanswer', 'question'), 0);
<a name="l1790"><span class="linenum">1790</span></a>          }
<a name="l1791"><span class="linenum">1791</span></a>  
<a name="l1792"><span class="linenum">1792</span></a>          <a class="var it4437" onMouseOver="hilite(4437)" onMouseOut="lolite()" onClick="logVariable('responses')" href="../../../_variables/responses.html">$responses</a>[null] = <a class="class" onClick="logClass('question_possible_response')" href="../../../_classes/question_possible_response.html" onMouseOver="classPopup(event,'question_possible_response')">question_possible_response</a>::<a class="function" onClick="logFunction('no_response')" href="../../../_functions/no_response.html" onMouseOver="funcPopup(event,'no_response')">no_response</a>();
<a name="l1793"><span class="linenum">1793</span></a>  
<a name="l1794"><span class="linenum">1794</span></a>          return array(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('questiondata')" href="../../../_variables/questiondata.html">$questiondata</a>-&gt;<a onClick="logVariable('id')" class="var it43218" onMouseOver="hilite(43218)" onMouseOut="lolite()" href="../../../_variables/id.html">id</a> =&gt; <a class="var it4437" onMouseOver="hilite(4437)" onMouseOut="lolite()" onClick="logVariable('responses')" href="../../../_variables/responses.html">$responses</a>);
<a name="l1795"><span class="linenum">1795</span></a>      }
<a name="l1796"><span class="linenum">1796</span></a>  
<a name="l1797"><span class="linenum">1797</span></a>      public function <a class="function" onClick="logFunction('move_files')" href="../../../_functions/move_files.html" onMouseOver="funcPopup(event,'move_files')">move_files</a>(<a class="var it530" onMouseOver="hilite(530)" onMouseOut="lolite()" onClick="logVariable('questionid')" href="../../../_variables/questionid.html">$questionid</a>, <a class="var it5968" onMouseOver="hilite(5968)" onMouseOut="lolite()" onClick="logVariable('oldcontextid')" href="../../../_variables/oldcontextid.html">$oldcontextid</a>, <a class="var it5969" onMouseOver="hilite(5969)" onMouseOut="lolite()" onClick="logVariable('newcontextid')" href="../../../_variables/newcontextid.html">$newcontextid</a>) {
<a name="l1798"><span class="linenum">1798</span></a>          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l1799"><span class="linenum">1799</span></a>  
<a name="l1800"><span class="linenum">1800</span></a>          parent::<a class="function" onClick="logFunction('move_files')" href="../../../_functions/move_files.html" onMouseOver="funcPopup(event,'move_files')">move_files</a>(<a class="var it530" onMouseOver="hilite(530)" onMouseOut="lolite()" onClick="logVariable('questionid')" href="../../../_variables/questionid.html">$questionid</a>, <a class="var it5968" onMouseOver="hilite(5968)" onMouseOut="lolite()" onClick="logVariable('oldcontextid')" href="../../../_variables/oldcontextid.html">$oldcontextid</a>, <a class="var it5969" onMouseOver="hilite(5969)" onMouseOut="lolite()" onClick="logVariable('newcontextid')" href="../../../_variables/newcontextid.html">$newcontextid</a>);
<a name="l1801"><span class="linenum">1801</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('move_files_in_answers')" href="../../../_functions/move_files_in_answers.html" onMouseOver="funcPopup(event,'move_files_in_answers')">move_files_in_answers</a>(<a class="var it530" onMouseOver="hilite(530)" onMouseOut="lolite()" onClick="logVariable('questionid')" href="../../../_variables/questionid.html">$questionid</a>, <a class="var it5968" onMouseOver="hilite(5968)" onMouseOut="lolite()" onClick="logVariable('oldcontextid')" href="../../../_variables/oldcontextid.html">$oldcontextid</a>, <a class="var it5969" onMouseOver="hilite(5969)" onMouseOut="lolite()" onClick="logVariable('newcontextid')" href="../../../_variables/newcontextid.html">$newcontextid</a>);
<a name="l1802"><span class="linenum">1802</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('move_files_in_hints')" href="../../../_functions/move_files_in_hints.html" onMouseOver="funcPopup(event,'move_files_in_hints')">move_files_in_hints</a>(<a class="var it530" onMouseOver="hilite(530)" onMouseOut="lolite()" onClick="logVariable('questionid')" href="../../../_variables/questionid.html">$questionid</a>, <a class="var it5968" onMouseOver="hilite(5968)" onMouseOut="lolite()" onClick="logVariable('oldcontextid')" href="../../../_variables/oldcontextid.html">$oldcontextid</a>, <a class="var it5969" onMouseOver="hilite(5969)" onMouseOut="lolite()" onClick="logVariable('newcontextid')" href="../../../_variables/newcontextid.html">$newcontextid</a>);
<a name="l1803"><span class="linenum">1803</span></a>      }
<a name="l1804"><span class="linenum">1804</span></a>  
<a name="l1805"><span class="linenum">1805</span></a>      protected function <a class="function" onClick="logFunction('delete_files')" href="../../../_functions/delete_files.html" onMouseOver="funcPopup(event,'delete_files')">delete_files</a>(<a class="var it530" onMouseOver="hilite(530)" onMouseOut="lolite()" onClick="logVariable('questionid')" href="../../../_variables/questionid.html">$questionid</a>, <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../_variables/contextid.html">$contextid</a>) {
<a name="l1806"><span class="linenum">1806</span></a>          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l1807"><span class="linenum">1807</span></a>  
<a name="l1808"><span class="linenum">1808</span></a>          parent::<a class="function" onClick="logFunction('delete_files')" href="../../../_functions/delete_files.html" onMouseOver="funcPopup(event,'delete_files')">delete_files</a>(<a class="var it530" onMouseOver="hilite(530)" onMouseOut="lolite()" onClick="logVariable('questionid')" href="../../../_variables/questionid.html">$questionid</a>, <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../_variables/contextid.html">$contextid</a>);
<a name="l1809"><span class="linenum">1809</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('delete_files_in_answers')" href="../../../_functions/delete_files_in_answers.html" onMouseOver="funcPopup(event,'delete_files_in_answers')">delete_files_in_answers</a>(<a class="var it530" onMouseOver="hilite(530)" onMouseOut="lolite()" onClick="logVariable('questionid')" href="../../../_variables/questionid.html">$questionid</a>, <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../_variables/contextid.html">$contextid</a>);
<a name="l1810"><span class="linenum">1810</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('delete_files_in_hints')" href="../../../_functions/delete_files_in_hints.html" onMouseOver="funcPopup(event,'delete_files_in_hints')">delete_files_in_hints</a>(<a class="var it530" onMouseOver="hilite(530)" onMouseOut="lolite()" onClick="logVariable('questionid')" href="../../../_variables/questionid.html">$questionid</a>, <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../../_variables/contextid.html">$contextid</a>);
<a name="l1811"><span class="linenum">1811</span></a>      }
<a name="l1812"><span class="linenum">1812</span></a>  }
<a name="l1813"><span class="linenum">1813</span></a>  
<a name="l1814"><span class="linenum">1814</span></a>  
<a name="l1815"><span class="linenum">1815</span></a>  function <a class="function" onClick="logFunction('qtype_calculated_calculate_answer')" href="../../../_functions/qtype_calculated_calculate_answer.html" onMouseOver="funcPopup(event,'qtype_calculated_calculate_answer')">qtype_calculated_calculate_answer</a>(<a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a>, <a class="var it13107" onMouseOver="hilite(13107)" onMouseOut="lolite()" onClick="logVariable('individualdata')" href="../../../_variables/individualdata.html">$individualdata</a>,
<a name="l1816"><span class="linenum">1816</span></a>      <a class="var it2966" onMouseOver="hilite(2966)" onMouseOut="lolite()" onClick="logVariable('tolerance')" href="../../../_variables/tolerance.html">$tolerance</a>, <a class="var it2967" onMouseOver="hilite(2967)" onMouseOut="lolite()" onClick="logVariable('tolerancetype')" href="../../../_variables/tolerancetype.html">$tolerancetype</a>, <a class="var it13108" onMouseOver="hilite(13108)" onMouseOut="lolite()" onClick="logVariable('answerlength')" href="../../../_variables/answerlength.html">$answerlength</a>, <a class="var it3042" onMouseOver="hilite(3042)" onMouseOut="lolite()" onClick="logVariable('answerformat')" href="../../../_variables/answerformat.html">$answerformat</a> = '1', <a class="var it4171" onMouseOver="hilite(4171)" onMouseOut="lolite()" onClick="logVariable('unit')" href="../../../_variables/unit.html">$unit</a> = '') {
<a name="l1817"><span class="linenum">1817</span></a>  <span class="comment">    // The return value has these properties: .</span>
<a name="l1818"><span class="linenum">1818</span></a>  <span class="comment">    // -&gt;answer    the correct answer</span>
<a name="l1819"><span class="linenum">1819</span></a>  <span class="comment">    // -&gt;min       the lower bound for an acceptable response</span>
<a name="l1820"><span class="linenum">1820</span></a>  <span class="comment">    // -&gt;max       the upper bound for an accetpable response.</span>
<a name="l1821"><span class="linenum">1821</span></a>      <a class="var it11890" onMouseOver="hilite(11890)" onMouseOut="lolite()" onClick="logVariable('calculated')" href="../../../_variables/calculated.html">$calculated</a> = new stdClass();
<a name="l1822"><span class="linenum">1822</span></a>  <span class="comment">    // Exchange formula variables with the correct values...</span>
<a name="l1823"><span class="linenum">1823</span></a>      <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a> = question_bank::<a class="function" onClick="logFunction('get_qtype')" href="../../../_functions/get_qtype.html" onMouseOver="funcPopup(event,'get_qtype')">get_qtype</a>('calculated')-&gt;<a class="function" onClick="logFunction('substitute_variables_and_eval')" href="../../../_functions/substitute_variables_and_eval.html" onMouseOver="funcPopup(event,'substitute_variables_and_eval')">substitute_variables_and_eval</a>(
<a name="l1824"><span class="linenum">1824</span></a>              <a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a>, <a class="var it13107" onMouseOver="hilite(13107)" onMouseOut="lolite()" onClick="logVariable('individualdata')" href="../../../_variables/individualdata.html">$individualdata</a>);
<a name="l1825"><span class="linenum">1825</span></a>      if (!<a class="phpfunction" onClick="logFunction('is_numeric')" href="../../../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>)) {
<a name="l1826"><span class="linenum">1826</span></a>  <span class="comment">        // Something went wrong, so just return NaN.</span>
<a name="l1827"><span class="linenum">1827</span></a>          <a class="var it11890" onMouseOver="hilite(11890)" onMouseOut="lolite()" onClick="logVariable('calculated')" href="../../../_variables/calculated.html">$calculated</a>-&gt;<a onClick="logVariable('answer')" class="var it44025" onMouseOver="hilite(44025)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a> = NAN;
<a name="l1828"><span class="linenum">1828</span></a>          return <a class="var it11890" onMouseOver="hilite(11890)" onMouseOut="lolite()" onClick="logVariable('calculated')" href="../../../_variables/calculated.html">$calculated</a>;
<a name="l1829"><span class="linenum">1829</span></a>      }
<a name="l1830"><span class="linenum">1830</span></a>      if ('1' == <a class="var it3042" onMouseOver="hilite(3042)" onMouseOut="lolite()" onClick="logVariable('answerformat')" href="../../../_variables/answerformat.html">$answerformat</a>) { // Answer is to have <a class="var it13108" onMouseOver="hilite(13108)" onMouseOut="lolite()" onClick="logVariable('answerlength')" href="../../../_variables/answerlength.html">$answerlength</a> decimals.
<a name="l1831"><span class="linenum">1831</span></a>  <span class="comment">        // Decimal places.</span>
<a name="l1832"><span class="linenum">1832</span></a>          <a class="var it11890" onMouseOver="hilite(11890)" onMouseOut="lolite()" onClick="logVariable('calculated')" href="../../../_variables/calculated.html">$calculated</a>-&gt;<a onClick="logVariable('answer')" class="var it44025" onMouseOver="hilite(44025)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a> = sprintf('%.' . <a class="var it13108" onMouseOver="hilite(13108)" onMouseOut="lolite()" onClick="logVariable('answerlength')" href="../../../_variables/answerlength.html">$answerlength</a> . 'F', <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>);
<a name="l1833"><span class="linenum">1833</span></a>  
<a name="l1834"><span class="linenum">1834</span></a>      } else if (<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>) { // Significant figures does only apply if the result is non-zero.
<a name="l1835"><span class="linenum">1835</span></a>  
<a name="l1836"><span class="linenum">1836</span></a>  <span class="comment">        // Convert to positive answer...</span>
<a name="l1837"><span class="linenum">1837</span></a>          if (<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a> &lt; 0) {
<a name="l1838"><span class="linenum">1838</span></a>              <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a> = -<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>;
<a name="l1839"><span class="linenum">1839</span></a>              <a class="var it7253" onMouseOver="hilite(7253)" onMouseOut="lolite()" onClick="logVariable('sign')" href="../../../_variables/sign.html">$sign</a> = '-';
<a name="l1840"><span class="linenum">1840</span></a>          } else {
<a name="l1841"><span class="linenum">1841</span></a>              <a class="var it7253" onMouseOver="hilite(7253)" onMouseOut="lolite()" onClick="logVariable('sign')" href="../../../_variables/sign.html">$sign</a> = '';
<a name="l1842"><span class="linenum">1842</span></a>          }
<a name="l1843"><span class="linenum">1843</span></a>  
<a name="l1844"><span class="linenum">1844</span></a>  <span class="comment">        // Determine the format 0.[1-9][0-9]* for the answer...</span>
<a name="l1845"><span class="linenum">1845</span></a>          <a class="var it13109" onMouseOver="hilite(13109)" onMouseOut="lolite()" onClick="logVariable('p10')" href="../../../_variables/p10.html">$p10</a> = 0;
<a name="l1846"><span class="linenum">1846</span></a>          while (<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a> &lt; 1) {
<a name="l1847"><span class="linenum">1847</span></a>              --<a class="var it13109" onMouseOver="hilite(13109)" onMouseOut="lolite()" onClick="logVariable('p10')" href="../../../_variables/p10.html">$p10</a>;
<a name="l1848"><span class="linenum">1848</span></a>              <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a> *= 10;
<a name="l1849"><span class="linenum">1849</span></a>          }
<a name="l1850"><span class="linenum">1850</span></a>          while (<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a> &gt;= 1) {
<a name="l1851"><span class="linenum">1851</span></a>              ++<a class="var it13109" onMouseOver="hilite(13109)" onMouseOut="lolite()" onClick="logVariable('p10')" href="../../../_variables/p10.html">$p10</a>;
<a name="l1852"><span class="linenum">1852</span></a>              <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a> /= 10;
<a name="l1853"><span class="linenum">1853</span></a>          }
<a name="l1854"><span class="linenum">1854</span></a>  <span class="comment">        // ... and have the answer rounded of to the correct length.</span>
<a name="l1855"><span class="linenum">1855</span></a>          <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a> = <a class="phpfunction" onClick="logFunction('round')" href="../../../_functions/round.html" onMouseOver="phpfuncPopup(event,'round')">round</a>(<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>, <a class="var it13108" onMouseOver="hilite(13108)" onMouseOut="lolite()" onClick="logVariable('answerlength')" href="../../../_variables/answerlength.html">$answerlength</a>);
<a name="l1856"><span class="linenum">1856</span></a>  
<a name="l1857"><span class="linenum">1857</span></a>  <span class="comment">        // If we rounded up to 1.0, place the answer back into 0.[1-9][0-9]* format.</span>
<a name="l1858"><span class="linenum">1858</span></a>          if (<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a> &gt;= 1) {
<a name="l1859"><span class="linenum">1859</span></a>              ++<a class="var it13109" onMouseOver="hilite(13109)" onMouseOut="lolite()" onClick="logVariable('p10')" href="../../../_variables/p10.html">$p10</a>;
<a name="l1860"><span class="linenum">1860</span></a>              <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a> /= 10;
<a name="l1861"><span class="linenum">1861</span></a>          }
<a name="l1862"><span class="linenum">1862</span></a>  
<a name="l1863"><span class="linenum">1863</span></a>  <span class="comment">        // Have the answer written on a suitable format:</span>
<a name="l1864"><span class="linenum">1864</span></a>  <span class="comment">        // either scientific or plain numeric.</span>
<a name="l1865"><span class="linenum">1865</span></a>          if (-2 &gt; <a class="var it13109" onMouseOver="hilite(13109)" onMouseOut="lolite()" onClick="logVariable('p10')" href="../../../_variables/p10.html">$p10</a> || 4 &lt; <a class="var it13109" onMouseOver="hilite(13109)" onMouseOut="lolite()" onClick="logVariable('p10')" href="../../../_variables/p10.html">$p10</a>) {
<a name="l1866"><span class="linenum">1866</span></a>  <span class="comment">            // Use scientific format.</span>
<a name="l1867"><span class="linenum">1867</span></a>              <a class="var it13110" onMouseOver="hilite(13110)" onMouseOut="lolite()" onClick="logVariable('exponent')" href="../../../_variables/exponent.html">$exponent</a> = 'e'.--<a class="var it13109" onMouseOver="hilite(13109)" onMouseOut="lolite()" onClick="logVariable('p10')" href="../../../_variables/p10.html">$p10</a>;
<a name="l1868"><span class="linenum">1868</span></a>              <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a> *= 10;
<a name="l1869"><span class="linenum">1869</span></a>              if (1 == <a class="var it13108" onMouseOver="hilite(13108)" onMouseOut="lolite()" onClick="logVariable('answerlength')" href="../../../_variables/answerlength.html">$answerlength</a>) {
<a name="l1870"><span class="linenum">1870</span></a>                  <a class="var it11890" onMouseOver="hilite(11890)" onMouseOut="lolite()" onClick="logVariable('calculated')" href="../../../_variables/calculated.html">$calculated</a>-&gt;<a onClick="logVariable('answer')" class="var it44025" onMouseOver="hilite(44025)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a> = <a class="var it7253" onMouseOver="hilite(7253)" onMouseOut="lolite()" onClick="logVariable('sign')" href="../../../_variables/sign.html">$sign</a>.<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>.<a class="var it13110" onMouseOver="hilite(13110)" onMouseOut="lolite()" onClick="logVariable('exponent')" href="../../../_variables/exponent.html">$exponent</a>;
<a name="l1871"><span class="linenum">1871</span></a>              } else {
<a name="l1872"><span class="linenum">1872</span></a>  <span class="comment">                // Attach additional zeros at the end of $answer.</span>
<a name="l1873"><span class="linenum">1873</span></a>                  <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a> .= (1 == <a class="function" onClick="logFunction('strlen')" href="../../../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>) ? '.' : '')
<a name="l1874"><span class="linenum">1874</span></a>                      . '00000000000000000000000000000000000000000x';
<a name="l1875"><span class="linenum">1875</span></a>                  <a class="var it11890" onMouseOver="hilite(11890)" onMouseOut="lolite()" onClick="logVariable('calculated')" href="../../../_variables/calculated.html">$calculated</a>-&gt;<a onClick="logVariable('answer')" class="var it44025" onMouseOver="hilite(44025)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a> = <a class="var it7253" onMouseOver="hilite(7253)" onMouseOut="lolite()" onClick="logVariable('sign')" href="../../../_variables/sign.html">$sign</a>
<a name="l1876"><span class="linenum">1876</span></a>                      .<a class="phpfunction" onClick="logFunction('substr')" href="../../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>, 0, <a class="var it13108" onMouseOver="hilite(13108)" onMouseOut="lolite()" onClick="logVariable('answerlength')" href="../../../_variables/answerlength.html">$answerlength</a> +1).<a class="var it13110" onMouseOver="hilite(13110)" onMouseOut="lolite()" onClick="logVariable('exponent')" href="../../../_variables/exponent.html">$exponent</a>;
<a name="l1877"><span class="linenum">1877</span></a>              }
<a name="l1878"><span class="linenum">1878</span></a>          } else {
<a name="l1879"><span class="linenum">1879</span></a>  <span class="comment">            // Stick to plain numeric format.</span>
<a name="l1880"><span class="linenum">1880</span></a>              <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a> *= &quot;1e{<a class="var it13109" onMouseOver="hilite(13109)" onMouseOut="lolite()" onClick="logVariable('p10')" href="../../../_variables/p10.html">$p10</a>}&quot;;
<a name="l1881"><span class="linenum">1881</span></a>              if (0.1 &lt;= <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a> / &quot;1e{<a class="var it13108" onMouseOver="hilite(13108)" onMouseOut="lolite()" onClick="logVariable('answerlength')" href="../../../_variables/answerlength.html">$answerlength</a>}&quot;) {
<a name="l1882"><span class="linenum">1882</span></a>                  <a class="var it11890" onMouseOver="hilite(11890)" onMouseOut="lolite()" onClick="logVariable('calculated')" href="../../../_variables/calculated.html">$calculated</a>-&gt;<a onClick="logVariable('answer')" class="var it44025" onMouseOver="hilite(44025)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a> = <a class="var it7253" onMouseOver="hilite(7253)" onMouseOut="lolite()" onClick="logVariable('sign')" href="../../../_variables/sign.html">$sign</a>.<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>;
<a name="l1883"><span class="linenum">1883</span></a>              } else {
<a name="l1884"><span class="linenum">1884</span></a>  <span class="comment">                // Could be an idea to add some zeros here.</span>
<a name="l1885"><span class="linenum">1885</span></a>                  <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a> .= (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('~^[0-9]*$~', <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>) ? '.' : '')
<a name="l1886"><span class="linenum">1886</span></a>                      . '00000000000000000000000000000000000000000x';
<a name="l1887"><span class="linenum">1887</span></a>                  <a class="var it13111" onMouseOver="hilite(13111)" onMouseOut="lolite()" onClick="logVariable('oklen')" href="../../../_variables/oklen.html">$oklen</a> = <a class="var it13108" onMouseOver="hilite(13108)" onMouseOut="lolite()" onClick="logVariable('answerlength')" href="../../../_variables/answerlength.html">$answerlength</a> + (<a class="var it13109" onMouseOver="hilite(13109)" onMouseOut="lolite()" onClick="logVariable('p10')" href="../../../_variables/p10.html">$p10</a> &lt; 1 ? 2-<a class="var it13109" onMouseOver="hilite(13109)" onMouseOut="lolite()" onClick="logVariable('p10')" href="../../../_variables/p10.html">$p10</a> : 1);
<a name="l1888"><span class="linenum">1888</span></a>                  <a class="var it11890" onMouseOver="hilite(11890)" onMouseOut="lolite()" onClick="logVariable('calculated')" href="../../../_variables/calculated.html">$calculated</a>-&gt;<a onClick="logVariable('answer')" class="var it44025" onMouseOver="hilite(44025)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a> = <a class="var it7253" onMouseOver="hilite(7253)" onMouseOut="lolite()" onClick="logVariable('sign')" href="../../../_variables/sign.html">$sign</a>.<a class="phpfunction" onClick="logFunction('substr')" href="../../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('answer')" href="../../../_variables/answer.html">$answer</a>, 0, <a class="var it13111" onMouseOver="hilite(13111)" onMouseOut="lolite()" onClick="logVariable('oklen')" href="../../../_variables/oklen.html">$oklen</a>);
<a name="l1889"><span class="linenum">1889</span></a>              }
<a name="l1890"><span class="linenum">1890</span></a>          }
<a name="l1891"><span class="linenum">1891</span></a>  
<a name="l1892"><span class="linenum">1892</span></a>      } else {
<a name="l1893"><span class="linenum">1893</span></a>          <a class="var it11890" onMouseOver="hilite(11890)" onMouseOut="lolite()" onClick="logVariable('calculated')" href="../../../_variables/calculated.html">$calculated</a>-&gt;<a onClick="logVariable('answer')" class="var it44025" onMouseOver="hilite(44025)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a> = 0.0;
<a name="l1894"><span class="linenum">1894</span></a>      }
<a name="l1895"><span class="linenum">1895</span></a>      if (<a class="var it4171" onMouseOver="hilite(4171)" onMouseOut="lolite()" onClick="logVariable('unit')" href="../../../_variables/unit.html">$unit</a> != '') {
<a name="l1896"><span class="linenum">1896</span></a>              <a class="var it11890" onMouseOver="hilite(11890)" onMouseOut="lolite()" onClick="logVariable('calculated')" href="../../../_variables/calculated.html">$calculated</a>-&gt;<a onClick="logVariable('answer')" class="var it44025" onMouseOver="hilite(44025)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a> = <a class="var it11890" onMouseOver="hilite(11890)" onMouseOut="lolite()" onClick="logVariable('calculated')" href="../../../_variables/calculated.html">$calculated</a>-&gt;<a onClick="logVariable('answer')" class="var it44025" onMouseOver="hilite(44025)" onMouseOut="lolite()" href="../../../_variables/answer.html">answer</a> . ' ' . <a class="var it4171" onMouseOver="hilite(4171)" onMouseOut="lolite()" onClick="logVariable('unit')" href="../../../_variables/unit.html">$unit</a>;
<a name="l1897"><span class="linenum">1897</span></a>      }
<a name="l1898"><span class="linenum">1898</span></a>  
<a name="l1899"><span class="linenum">1899</span></a>  <span class="comment">    // Return the result.</span>
<a name="l1900"><span class="linenum">1900</span></a>      return <a class="var it11890" onMouseOver="hilite(11890)" onMouseOut="lolite()" onClick="logVariable('calculated')" href="../../../_variables/calculated.html">$calculated</a>;
<a name="l1901"><span class="linenum">1901</span></a>  }
<a name="l1902"><span class="linenum">1902</span></a>  
<a name="l1903"><span class="linenum">1903</span></a>  
<a name="l1904"><span class="linenum">1904</span></a>  <span class="comment">/**</span>
<a name="l1905"><span class="linenum">1905</span></a>  <span class="comment"> * Validate a forumula.</span>
<a name="l1906"><span class="linenum">1906</span></a>  <span class="comment"> * @param string $formula the formula to validate.</span>
<a name="l1907"><span class="linenum">1907</span></a>  <span class="comment"> * @return string|boolean false if there are no problems. Otherwise a string error message.</span>
<a name="l1908"><span class="linenum">1908</span></a>  <span class="comment"> */</span>
<a name="l1909"><span class="linenum">1909</span></a>  function <a class="function" onClick="logFunction('qtype_calculated_find_formula_errors')" href="../../../_functions/qtype_calculated_find_formula_errors.html" onMouseOver="funcPopup(event,'qtype_calculated_find_formula_errors')">qtype_calculated_find_formula_errors</a>(<a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a>) {
<a name="l1910"><span class="linenum">1910</span></a>  <span class="comment">    // Validates the formula submitted from the question edit page.</span>
<a name="l1911"><span class="linenum">1911</span></a>  <span class="comment">    // Returns false if everything is alright</span>
<a name="l1912"><span class="linenum">1912</span></a>  <span class="comment">    // otherwise it constructs an error message.</span>
<a name="l1913"><span class="linenum">1913</span></a>  <span class="comment">    // Strip away dataset names.</span>
<a name="l1914"><span class="linenum">1914</span></a>      while (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('~\\{[[:alpha:]][^&gt;} &lt;{&quot;\']*\\}~', <a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a>, <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>)) {
<a name="l1915"><span class="linenum">1915</span></a>          <a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>(<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[0], '1', <a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a>);
<a name="l1916"><span class="linenum">1916</span></a>      }
<a name="l1917"><span class="linenum">1917</span></a>  
<a name="l1918"><span class="linenum">1918</span></a>  <span class="comment">    // Strip away empty space and lowercase it.</span>
<a name="l1919"><span class="linenum">1919</span></a>      <a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a> = <a class="phpfunction" onClick="logFunction('strtolower')" href="../../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="phpfunction" onClick="logFunction('str_replace')" href="../../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>(' ', '', <a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a>));
<a name="l1920"><span class="linenum">1920</span></a>  
<a name="l1921"><span class="linenum">1921</span></a>      <a class="var it13112" onMouseOver="hilite(13112)" onMouseOut="lolite()" onClick="logVariable('safeoperatorchar')" href="../../../_variables/safeoperatorchar.html">$safeoperatorchar</a> = '-+<span class="comment">/*%&gt;:^\~&lt;?=&amp;|!'; /* */</span>
<a name="l1922"><span class="linenum">1922</span></a>      <a class="var it13113" onMouseOver="hilite(13113)" onMouseOut="lolite()" onClick="logVariable('operatorornumber')" href="../../../_variables/operatorornumber.html">$operatorornumber</a> = &quot;[{<a class="var it13112" onMouseOver="hilite(13112)" onMouseOut="lolite()" onClick="logVariable('safeoperatorchar')" href="../../../_variables/safeoperatorchar.html">$safeoperatorchar</a>}.0-9eE]&quot;;
<a name="l1923"><span class="linenum">1923</span></a>  
<a name="l1924"><span class="linenum">1924</span></a>      while (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>(&quot;~(^|[{<a class="var it13112" onMouseOver="hilite(13112)" onMouseOut="lolite()" onClick="logVariable('safeoperatorchar')" href="../../../_variables/safeoperatorchar.html">$safeoperatorchar</a>},(])([a-z0-9_]*)&quot; .
<a name="l1925"><span class="linenum">1925</span></a>              &quot;\\(({<a class="var it13113" onMouseOver="hilite(13113)" onMouseOut="lolite()" onClick="logVariable('operatorornumber')" href="../../../_variables/operatorornumber.html">$operatorornumber</a>}+(,{<a class="var it13113" onMouseOver="hilite(13113)" onMouseOut="lolite()" onClick="logVariable('operatorornumber')" href="../../../_variables/operatorornumber.html">$operatorornumber</a>}+((,{<a class="var it13113" onMouseOver="hilite(13113)" onMouseOut="lolite()" onClick="logVariable('operatorornumber')" href="../../../_variables/operatorornumber.html">$operatorornumber</a>}+)+)?)?)?\\)~&quot;,
<a name="l1926"><span class="linenum">1926</span></a>              <a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a>, <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>)) {
<a name="l1927"><span class="linenum">1927</span></a>          switch (<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[2]) {
<a name="l1928"><span class="linenum">1928</span></a>  <span class="comment">            // Simple parenthesis.</span>
<a name="l1929"><span class="linenum">1929</span></a>              case '':
<a name="l1930"><span class="linenum">1930</span></a>                  if ((isset(<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[4]) &amp;&amp; <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[4]) || <a class="function" onClick="logFunction('strlen')" href="../../../_functions/strlen.html" onMouseOver="funcPopup(event,'strlen')">strlen</a>(<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[3]) == 0) {
<a name="l1931"><span class="linenum">1931</span></a>                      return <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('illegalformulasyntax', 'qtype_calculated', <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[0]);
<a name="l1932"><span class="linenum">1932</span></a>                  }
<a name="l1933"><span class="linenum">1933</span></a>                  break;
<a name="l1934"><span class="linenum">1934</span></a>  
<a name="l1935"><span class="linenum">1935</span></a>  <span class="comment">                // Zero argument functions.</span>
<a name="l1936"><span class="linenum">1936</span></a>              case 'pi':
<a name="l1937"><span class="linenum">1937</span></a>                  if (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(3, <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>)) {
<a name="l1938"><span class="linenum">1938</span></a>                      return <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('functiontakesnoargs', 'qtype_calculated', <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[2]);
<a name="l1939"><span class="linenum">1939</span></a>                  }
<a name="l1940"><span class="linenum">1940</span></a>                  break;
<a name="l1941"><span class="linenum">1941</span></a>  
<a name="l1942"><span class="linenum">1942</span></a>  <span class="comment">                // Single argument functions (the most common case).</span>
<a name="l1943"><span class="linenum">1943</span></a>              case 'abs': case 'acos': case 'acosh': case 'asin': case 'asinh':
<a name="l1944"><span class="linenum">1944</span></a>              case 'atan': case 'atanh': case 'bindec': case 'ceil': case 'cos':
<a name="l1945"><span class="linenum">1945</span></a>              case 'cosh': case 'decbin': case 'decoct': case 'deg2rad':
<a name="l1946"><span class="linenum">1946</span></a>              case 'exp': case 'expm1': case 'floor': case 'is_finite':
<a name="l1947"><span class="linenum">1947</span></a>              case 'is_infinite': case 'is_nan': case 'log10': case 'log1p':
<a name="l1948"><span class="linenum">1948</span></a>              case 'octdec': case 'rad2deg': case 'sin': case 'sinh': case 'sqrt':
<a name="l1949"><span class="linenum">1949</span></a>              case 'tan': case 'tanh':
<a name="l1950"><span class="linenum">1950</span></a>                  if (!empty(<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[4]) || empty(<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[3])) {
<a name="l1951"><span class="linenum">1951</span></a>                      return <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('functiontakesonearg', 'qtype_calculated', <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[2]);
<a name="l1952"><span class="linenum">1952</span></a>                  }
<a name="l1953"><span class="linenum">1953</span></a>                  break;
<a name="l1954"><span class="linenum">1954</span></a>  
<a name="l1955"><span class="linenum">1955</span></a>  <span class="comment">                // Functions that take one or two arguments.</span>
<a name="l1956"><span class="linenum">1956</span></a>              case 'log': case 'round':
<a name="l1957"><span class="linenum">1957</span></a>                  if (!empty(<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[5]) || empty(<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[3])) {
<a name="l1958"><span class="linenum">1958</span></a>                      return <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('functiontakesoneortwoargs', 'qtype_calculated', <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[2]);
<a name="l1959"><span class="linenum">1959</span></a>                  }
<a name="l1960"><span class="linenum">1960</span></a>                  break;
<a name="l1961"><span class="linenum">1961</span></a>  
<a name="l1962"><span class="linenum">1962</span></a>  <span class="comment">                // Functions that must have two arguments.</span>
<a name="l1963"><span class="linenum">1963</span></a>              case 'atan2': case 'fmod': case 'pow':
<a name="l1964"><span class="linenum">1964</span></a>                  if (!empty(<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[5]) || empty(<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[4])) {
<a name="l1965"><span class="linenum">1965</span></a>                      return <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('functiontakestwoargs', 'qtype_calculated', <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[2]);
<a name="l1966"><span class="linenum">1966</span></a>                  }
<a name="l1967"><span class="linenum">1967</span></a>                  break;
<a name="l1968"><span class="linenum">1968</span></a>  
<a name="l1969"><span class="linenum">1969</span></a>  <span class="comment">                // Functions that take two or more arguments.</span>
<a name="l1970"><span class="linenum">1970</span></a>              case 'min': case 'max':
<a name="l1971"><span class="linenum">1971</span></a>                  if (empty(<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[4])) {
<a name="l1972"><span class="linenum">1972</span></a>                      return <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('functiontakesatleasttwo', 'qtype_calculated', <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[2]);
<a name="l1973"><span class="linenum">1973</span></a>                  }
<a name="l1974"><span class="linenum">1974</span></a>                  break;
<a name="l1975"><span class="linenum">1975</span></a>  
<a name="l1976"><span class="linenum">1976</span></a>              default:
<a name="l1977"><span class="linenum">1977</span></a>                  return <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('unsupportedformulafunction', 'qtype_calculated', <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[2]);
<a name="l1978"><span class="linenum">1978</span></a>          }
<a name="l1979"><span class="linenum">1979</span></a>  
<a name="l1980"><span class="linenum">1980</span></a>  <span class="comment">        // Exchange the function call with '1' and then check for</span>
<a name="l1981"><span class="linenum">1981</span></a>  <span class="comment">        // another function call...</span>
<a name="l1982"><span class="linenum">1982</span></a>          if (<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[1]) {
<a name="l1983"><span class="linenum">1983</span></a>  <span class="comment">            // The function call is proceeded by an operator.</span>
<a name="l1984"><span class="linenum">1984</span></a>              <a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>(<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[0], <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[1] . '1', <a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a>);
<a name="l1985"><span class="linenum">1985</span></a>          } else {
<a name="l1986"><span class="linenum">1986</span></a>  <span class="comment">            // The function call starts the formula.</span>
<a name="l1987"><span class="linenum">1987</span></a>              <a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a> = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>(&quot;~^{<a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[2]}\\([^)]*\\)~&quot;, '1', <a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a>);
<a name="l1988"><span class="linenum">1988</span></a>          }
<a name="l1989"><span class="linenum">1989</span></a>      }
<a name="l1990"><span class="linenum">1990</span></a>  
<a name="l1991"><span class="linenum">1991</span></a>      if (<a class="phpfunction" onClick="logFunction('preg_match')" href="../../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>(&quot;~[^{<a class="var it13112" onMouseOver="hilite(13112)" onMouseOut="lolite()" onClick="logVariable('safeoperatorchar')" href="../../../_variables/safeoperatorchar.html">$safeoperatorchar</a>}.0-9eE]+~&quot;, <a class="var it1617" onMouseOver="hilite(1617)" onMouseOut="lolite()" onClick="logVariable('formula')" href="../../../_variables/formula.html">$formula</a>, <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>)) {
<a name="l1992"><span class="linenum">1992</span></a>          return <a class="function" onClick="logFunction('get_string')" href="../../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('illegalformulasyntax', 'qtype_calculated', <a class="var it9610" onMouseOver="hilite(9610)" onMouseOut="lolite()" onClick="logVariable('regs')" href="../../../_variables/regs.html">$regs</a>[0]);
<a name="l1993"><span class="linenum">1993</span></a>      } else {
<a name="l1994"><span class="linenum">1994</span></a>  <span class="comment">        // Formula just might be valid.</span>
<a name="l1995"><span class="linenum">1995</span></a>          return false;
<a name="l1996"><span class="linenum">1996</span></a>      }
<a name="l1997"><span class="linenum">1997</span></a>  }
<a name="l1998"><span class="linenum">1998</span></a>  
<a name="l1999"><span class="linenum">1999</span></a>  <span class="comment">/**</span>
<a name="l2000"><span class="linenum">2000</span></a>  <span class="comment"> * Validate all the forumulas in a bit of text.</span>
<a name="l2001"><span class="linenum">2001</span></a>  <span class="comment"> * @param string $text the text in which to validate the formulas.</span>
<a name="l2002"><span class="linenum">2002</span></a>  <span class="comment"> * @return string|boolean false if there are no problems. Otherwise a string error message.</span>
<a name="l2003"><span class="linenum">2003</span></a>  <span class="comment"> */</span>
<a name="l2004"><span class="linenum">2004</span></a>  function <a class="function" onClick="logFunction('qtype_calculated_find_formula_errors_in_text')" href="../../../_functions/qtype_calculated_find_formula_errors_in_text.html" onMouseOver="funcPopup(event,'qtype_calculated_find_formula_errors_in_text')">qtype_calculated_find_formula_errors_in_text</a>(<a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a>) {
<a name="l2005"><span class="linenum">2005</span></a>      <a class="phpfunction" onClick="logFunction('preg_match_all')" href="../../../_functions/preg_match_all.html" onMouseOver="phpfuncPopup(event,'preg_match_all')">preg_match_all</a>(<a class="class" onClick="logClass('qtype_calculated')" href="../../../_classes/qtype_calculated.html" onMouseOver="classPopup(event,'qtype_calculated')">qtype_calculated</a>::FORMULAS_IN_TEXT_REGEX, <a class="var it151" onMouseOver="hilite(151)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a>, <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../../_variables/matches.html">$matches</a>);
<a name="l2006"><span class="linenum">2006</span></a>  
<a name="l2007"><span class="linenum">2007</span></a>      <a class="var it224" onMouseOver="hilite(224)" onMouseOut="lolite()" onClick="logVariable('errors')" href="../../../_variables/errors.html">$errors</a> = array();
<a name="l2008"><span class="linenum">2008</span></a>      foreach (<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../../_variables/matches.html">$matches</a>[1] as <a class="var it149" onMouseOver="hilite(149)" onMouseOut="lolite()" onClick="logVariable('match')" href="../../../_variables/match.html">$match</a>) {
<a name="l2009"><span class="linenum">2009</span></a>          <a class="var it275" onMouseOver="hilite(275)" onMouseOut="lolite()" onClick="logVariable('error')" href="../../../_variables/error.html">$error</a> = <a class="function" onClick="logFunction('qtype_calculated_find_formula_errors')" href="../../../_functions/qtype_calculated_find_formula_errors.html" onMouseOver="funcPopup(event,'qtype_calculated_find_formula_errors')">qtype_calculated_find_formula_errors</a>(<a class="var it149" onMouseOver="hilite(149)" onMouseOut="lolite()" onClick="logVariable('match')" href="../../../_variables/match.html">$match</a>);
<a name="l2010"><span class="linenum">2010</span></a>          if (<a class="var it275" onMouseOver="hilite(275)" onMouseOut="lolite()" onClick="logVariable('error')" href="../../../_variables/error.html">$error</a>) {
<a name="l2011"><span class="linenum">2011</span></a>              <a class="var it224" onMouseOver="hilite(224)" onMouseOut="lolite()" onClick="logVariable('errors')" href="../../../_variables/errors.html">$errors</a>[] = <a class="var it275" onMouseOver="hilite(275)" onMouseOut="lolite()" onClick="logVariable('error')" href="../../../_variables/error.html">$error</a>;
<a name="l2012"><span class="linenum">2012</span></a>          }
<a name="l2013"><span class="linenum">2013</span></a>      }
<a name="l2014"><span class="linenum">2014</span></a>  
<a name="l2015"><span class="linenum">2015</span></a>      if (<a class="var it224" onMouseOver="hilite(224)" onMouseOut="lolite()" onClick="logVariable('errors')" href="../../../_variables/errors.html">$errors</a>) {
<a name="l2016"><span class="linenum">2016</span></a>          return <a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(' ', <a class="var it224" onMouseOver="hilite(224)" onMouseOut="lolite()" onClick="logVariable('errors')" href="../../../_variables/errors.html">$errors</a>);
<a name="l2017"><span class="linenum">2017</span></a>      }
<a name="l2018"><span class="linenum">2018</span></a>  
<a name="l2019"><span class="linenum">2019</span></a>      return false;
<a name="l2020"><span class="linenum">2020</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'get_question_options': ['get_question_options', 'Loads the question type specific options for the question. ', [['question/type','questiontypebase.php',743],['question/type/calculated','questiontype.php',48],['question/type/multianswer','questiontype.php',44],['question/type/numerical','questiontype.php',55],['lib','questionlib.php',798],['question/type/multichoice','questiontype.php',40],['question/type/ddimageortext','questiontypebase.php',49],['question/type/truefalse','questiontype.php',111],['question/type/random','questiontype.php',118],['question/type/match','questiontype.php',40],['question/type/gapselect','questiontypebase.php',106],['question/type/randomsamatch','questiontype.php',54],['question/type/essay','questiontype.php',47]], 19],
'validate_question_data': ['validate_question_data', 'Validate data before save. ', [['question/type/calculated','questiontype.php',470],['question/type/calculatedmulti','questiontype.php',166]], 4],
'next_wizard_form': ['next_wizard_form', '', [['question/type/calculated','questiontype.php',376]], 1],
'set_field': ['set_field', 'Set a single field in every table record where all the given conditions met. ', [['lib/dml','moodle_database.php',1737],['availability/condition/profile/tests','condition_test.php',349]], 485],
'get_tolerance_interval': ['get_tolerance_interval', '', [['question/type/numerical','question.php',328]], 3],
'print_error': ['print_error', 'Abort execution by throwing of a general exception, default exception handler displays the error message in most cases. ', [['lib','setuplib.php',481]], 1488],
'heading_with_help': ['heading_with_help', 'Centered heading with attached help button (same title text) and optional icon attached. ', [['lib','outputrenderers.php',2305]], 39],
'display_question_editing_page': ['display_question_editing_page', 'This method should be overriden if you want to include a special heading or some other html on a question editing page besides the question editing form. ', [['question/type','questiontypebase.php',236],['question/type/calculated','questiontype.php',409],['question/type/missingtype','questiontype.php',91]], 2],
'get_possible_responses': ['get_possible_responses', 'This method should return all the possible types of response that are recognised for this question. ', [['question/type','questiontypebase.php',1018],['question/type/calculated','questiontype.php',1760],['question/type/numerical','questiontype.php',419],['question/type/multichoice','questiontype.php',203],['question/type/ddimageortext','questiontypebase.php',174],['question/type/truefalse','questiontype.php',173],['question/type/match','questiontype.php',159],['question/type/shortanswer','questiontype.php',101],['question/type/gapselect','questiontypebase.php',296],['question/type/calculatedmulti','questiontype.php',273]], 20],
'notification': ['notification', 'Output a notification (that is, a status message about something that has just happened). ', [['lib','outputrenderers.php',2849],['lib','outputrenderers.php',4412],['lib','outputrenderers.php',4496]], 540],
'delete_question': ['delete_question', 'Deletes the question-type specific data when a question is deleted. ', [['question/type','questiontypebase.php',951],['question/type/calculated','questiontype.php',676],['question/type/multianswer','questiontype.php',189],['question/type/numerical','questiontype.php',378],['question/type/multichoice','questiontype.php',182],['question/type/ddimageortext','questiontypebase.php',197],['question/type/truefalse','questiontype.php',152],['question/type/match','questiontype.php',146],['question/type/gapselect','questiontypebase.php',113],['question/type/randomsamatch','questiontype.php',100],['question/type/essay','questiontype.php',91]], 11],
'print_dataset_definitions_category_shared': ['print_dataset_definitions_category_shared', 'This function build a table showing the available category shareable wild cards, their name, their definition (Min, Max, Decimal) , the item count and the name of the question where they are used. This table is intended to be add before the question text to help the user use these wild cards ', [['question/type/calculated','questiontype.php',1643]], 1],
'save_question_options': ['save_question_options', 'Saves question-type specific options ', [['question/type','questiontypebase.php',412],['question/type/calculated','questiontype.php',133],['question/type/multianswer','questiontype.php',80],['question/type/numerical','questiontype.php',149],['question/type/multichoice','questiontype.php',47],['question/type/truefalse','questiontype.php',39],['question/type/random','questiontype.php',161],['question/type/match','questiontype.php',50],['question/type/ddmarker','questiontype.php',88],['question/type/shortanswer','questiontype.php',57],['question/type/calculatedsimple','questiontype.php',43],['question/type/gapselect','questiontypebase.php',39],['question/type/ddimageortext','questiontype.php',58],['question/type/randomsamatch','questiontype.php',64],['question/type/calculatedmulti','questiontype.php',41],['question/type/essay','questiontype.php',54]], 3],
'validate_answer': ['validate_answer', 'Verify that an answer is OK. We throw an exception here because this should have already been validated by the form. This is just a last line of defence to prevent a question being stored in the database if it has bad formulas. This saves us from, for example, malicious imports. ', [['question/type/calculated','questiontype.php',455],['question/type/calculatedmulti','questiontype.php',159]], 1],
'count_records': ['count_records', 'Count a list of records. ', [['competency/classes','persistent.php',815],['mod/glossary/classes','entry_query_builder.php',152],['lib/dml','moodle_database.php',1766]], 1630],
'delete_files_in_hints': ['delete_files_in_hints', 'Delete all the files belonging to this question\'s hints. ', [['question/type','questiontypebase.php',1363]], 11],
'get_file_storage': ['get_file_storage', 'Returns local file storage instance ', [['lib','moodlelib.php',6144]], 546],
'get_records_select': ['get_records_select', 'Load a list of records based on a select query. ', [['competency/classes','persistent.php',751],['lib/dml','moodle_database.php',1332]], 166],
'finished_edit_wizard': ['finished_edit_wizard', 'Returns true if the editing wizard is finished, false otherwise. ', [['question/type','questiontypebase.php',1068],['question/type/calculated','questiontype.php',345],['question/type/calculatedsimple','questiontype.php',230]], 1],
'optional_param': ['optional_param', 'Returns a particular value for the named variable, taken from POST or GET, otherwise returning a given default. ', [['lib','moodlelib.php',609]], 2210],
'save_hints': ['save_hints', '', [['question/type','questiontypebase.php',602],['question/type/ddmarker','questiontype.php',164]], 13],
'require': ['require', '', [['lib/yuilib/3.17.2/timers','timers.js',27],['lib/yuilib/3.17.2/timers','timers-debug.js',27]], 615],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'comment_on_datasetitems': ['comment_on_datasetitems', '', [['question/type/calculated','questiontype.php',1049],['question/type/calculatedmulti','questiontype.php',232]], 3],
'save_dataset_items': ['save_dataset_items', '', [['question/type/calculated','questiontype.php',862]], 1],
'save_units': ['save_units', '', [['question/type/numerical','questiontype.php',309]], 3],
'custom_generator_tools_part': ['custom_generator_tools_part', '', [['question/type/calculated','questiontype.php',713],['question/type/calculatedsimple','questiontype.php',238]], 2],
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pdo_moodle_database.php',461],['lib/dml','oci_native_moodle_database.php',1404],['lib/dml','pgsql_native_moodle_database.php',1089],['lib/dml','mssql_native_moodle_database.php',1067],['lib/dml','mysqli_native_moodle_database.php',1405],['lib/dml','sqlsrv_native_moodle_database.php',1148],['lib/dml/tests','dml_test.php',5551]], 650],
'get_records_sql': ['get_records_sql', 'Get a number of records as an array of objects. ', [['lib/dml','pdo_moodle_database.php',309],['lib/dml','oci_native_moodle_database.php',1145],['lib/dml','pgsql_native_moodle_database.php',732],['lib/dml','mssql_native_moodle_database.php',805],['lib/dml','mysqli_native_moodle_database.php',1057],['lib/dml','sqlsrv_native_moodle_database.php',890],['lib/dml/tests','dml_test.php',5545]], 700],
'redirect': ['redirect', '', [['enrol/lti/ims-blti','blti.php',230],['lib','weblib.php',2659]], 999],
'save_unit_options': ['save_unit_options', 'The numerical options control the display and the grading of the unit part of the numerical question and related types (calculateds) Questions previous to 2.0 do not have this table as multianswer questions in all versions including 2.0. The default values are set to give the same grade as old question. ', [['question/type/numerical','questiontype.php',245]], 3],
'fullclone': ['fullclone', 'This function will make a complete copy of anything it\'s given, regardless of whether it\'s an object or not. ', [['lib','moodlelib.php',8726]], 26],
'generate_dataset_item': ['generate_dataset_item', '', [['question/type/calculated','questiontype.php',1014]], 4],
'print_dataset_definitions_category': ['print_dataset_definitions_category', 'This function build a table showing the available category shareable wild cards, their name, their definition (Min, Max, Decimal) , the item count and the name of the question where they are used. This table is intended to be add before the question text to help the user use these wild cards ', [['question/type/calculated','questiontype.php',1564]], 1],
'get_virtual_qtype': ['get_virtual_qtype', '', [['question/type/calculated','questiontype.php',1756],['question/type/calculatedmulti','questiontype.php',269]], 7],
'get_dataset_definitions_category': ['get_dataset_definitions_category', 'This function retrieve the item count of the available category shareable wild cards that is added as a comment displayed when a wild card with the same name is displayed in datasetdefinitions_form.php ', [['question/type/calculated','questiontype.php',1540]], 1],
'tolerance_types': ['tolerance_types', '', [['question/type/calculated','questiontype.php',1119],['question/type/calculatedsimple','questiontype.php',272]], 3],
'find_math_equations': ['find_math_equations', '', [['question/type/calculated','questiontype.php',1745]], 1],
'list': ['list', '', [['mod/data/preset/imagegallery','jstemplate.js',9]], 2229],
'make_answer_processor': ['make_answer_processor', '', [['question/type/numerical','questiontype.php',365]], 3],
'delete_records': ['delete_records', 'Delete the records from a table where all the given conditions met. If conditions not specified, table is truncated. ', [['lib/dml','sqlite3_pdo_moodle_database.php',345],['lib/dml','moodle_database.php',1864]], 773],
'move_files_in_answers': ['move_files_in_answers', 'Move all the files belonging to this question\'s answers when the question is moved from one context to another. ', [['question/type','questiontypebase.php',1262]], 6],
'addnamecategory': ['addnamecategory', '', [['question/type/calculated','questiontype.php',546]], 4],
'preparedatasets': ['preparedatasets', 'This method prepare the $datasets in a format similar to dadatesetdefinitions_form.php so that they can be saved using the function save_dataset_definitions($form) when creating a new calculated question or when editing an already existing calculated question or by  function save_as_new_dataset_definitions($form, $initialid) when saving as new an already existing calculated question. ', [['question/type/calculated','questiontype.php',489]], 3],
'display': ['display', 'Displays the form ', [['backup/util/ui','base_moodleform.class.php',365],['mod/feedback/classes','complete_form.php',536],['lib/minify/lib/Minify/Cache','APC.php',79],['mod/lesson/pagetypes','numerical.php',50],['mod/scorm/report/interactions/classes','report.php',31],['mod/scorm/report/basic/classes','report.php',30],['backup/util/ui','restore_ui.class.php',375],['mod/scorm/report/objectives/classes','report.php',37],['mod/lesson/pagetypes','endofcluster.php',39],['mod/lesson/pagetypes','matching.php',50],['mod/feedback/classes','responses_table.php',344],['user/selector','lib.php',205],['lib/minify/lib/Minify/Cache','File.php',72],['lib','formslib.php',935],['backup/util/ui','base_ui.class.php',169],['mod/lesson/pagetypes','multichoice.php',87],['question/classes/bank','column_base.php',164],['cohort','upload_form.php',316],['mod/quiz/report/statistics','report.php',51],['admin/roles/classes','capability_table_with_risks.php',131],['mod/lesson/pagetypes','truefalse.php',50],['admin/roles/classes','capability_table_base.php',71],['mod/quiz/report/overview','report.php',42],['mod/feedback/classes','templates_table.php',62],['lib/minify/lib/Minify/Cache','ZendPlatform.php',84],['mod/lesson/pagetypes','endofbranch.php',39],['mod/scorm/classes','report.php',39],['backup/util/ui','import_extensions.php',154],['question/classes/bank','view.php',451],['backup/util/ui','backup_ui_stage.class.php',545],['backup/util/ui','backup_ui_stage.class.php',588],['mod/quiz/report/grading','report.php',51],['mod/lesson/pagetypes','shortanswer.php',50],['lib/pear/HTML','Common.php',438],['mod/lesson/pagetypes','essay.php',67],['lib/minify/lib/Minify/Cache','Memcache.php',85],['backup/util/ui','base_ui_stage.class.php',126],['mod/scorm/report/graphs/classes','report.php',127],['mod/lesson/pagetypes','branchtable.php',105],['repository/flickr_public','image.php',149],['admin/roles/classes','define_role_table_advanced.php',612],['mod/quiz/report/responses','report.php',51],['mod/lesson/pagetypes','cluster.php',39],['lib/minify/lib/Minify/Cache','WinCache.php',79],['lib/minify/lib/Minify/Cache','XCache.php',74],['course/format/singleactivity','renderer.php',36],['backup/util/ui','restore_ui_stage.class.php',355],['backup/util/ui','restore_ui_stage.class.php',497],['backup/util/ui','restore_ui_stage.class.php',1025],['backup/util/ui','restore_ui_stage.class.php',1112]], 320],
'addelement': ['addelement', 'Adds a custom element to your HTML definition ', [['lib/htmlpurifier/HTMLPurifier','HTMLDefinition.php',124],['lib/htmlpurifier/HTMLPurifier','HTMLModule.php',130],['lib/pear/HTML','QuickForm.php',592]], 3302],
'delete_files_in_answers': ['delete_files_in_answers', 'Delete all the files belonging to this question\'s answers. ', [['question/type','questiontypebase.php',1342]], 6],
'update_dataset_options': ['update_dataset_options', '', [['question/type/calculated','questiontype.php',784]], 1],
'move_files_in_hints': ['move_files_in_hints', 'Move all the files belonging to this question\'s hints when the question is moved from one context to another. ', [['question/type','questiontypebase.php',1288]], 11],
'save_as_new_dataset_definitions': ['save_as_new_dataset_definitions', '', [['question/type/calculated','questiontype.php',1342]], 1],
'qtype_calculated_calculate_answer': ['qtype_calculated_calculate_answer', '', [['question/type/calculated','questiontype.php',1815]], 1],
'custom_generator_set_data': ['custom_generator_set_data', '', [['question/type/calculated','questiontype.php',735]], 2],
'evaluate_equations': ['evaluate_equations', '', [['question/type/calculated','questiontype.php',1199]], 0],
'addgroup': ['addgroup', 'Adds an element group ', [['lib/pear/HTML','QuickForm.php',717]], 111],
'qtype_calculated_find_formula_errors': ['qtype_calculated_find_formula_errors', 'Validate a forumula. ', [['question/type/calculated','questiontype.php',1904]], 42],
'supports_dataset_item_generation': ['supports_dataset_item_generation', '', [['question/type/calculated','questiontype.php',708]], 3],
'find_dataset_names': ['find_dataset_names', '', [['question/type/calculated','questiontype.php',1529]], 10],
'initialise_numerical_answers': ['initialise_numerical_answers', '', [['question/type/numerical','questiontype.php',354]], 2],
'get_string': ['get_string', 'Get String returns a requested string ', [['lib/classes','string_manager_install.php',95],['lib','moodlelib.php',6735],['lib','moodlelib.php',9695],['lib/external','externallib.php',102],['question/behaviour','behaviourbase.php',770],['lib/classes','string_manager_standard.php',280],['lib/classes','string_manager.php',38]], 20134],
'comment_header': ['comment_header', '', [['question/type/calculated','questiontype.php',1035],['question/type/calculatedsimple','questiontype.php',260],['question/type/calculatedmulti','questiontype.php',218]], 2],
'clone': ['clone', '', [['lib/editor/tinymce/tiny_mce/3.5.11/plugins/media/js','media.js',11]], 370],
'get_numerical_options': ['get_numerical_options', '', [['question/type/numerical','questiontype.php',125]], 2],
'qtype_calculated_find_formula_errors_in_text': ['qtype_calculated_find_formula_errors_in_text', 'Validate all the forumulas in a bit of text. ', [['question/type/calculated','questiontype.php',1999]], 10],
'get_record_sql': ['get_record_sql', 'Get a single database record as an object using a SQL statement. ', [['lib/dml','oci_native_moodle_database.php',1076],['lib/dml','moodle_database.php',1506]], 157],
'get_numerical_units': ['get_numerical_units', '', [['question/type/numerical','questiontype.php',98]], 2],
'save_question': ['save_question', 'Saves (creates or updates) a question. ', [['question/type','questiontypebase.php',277],['question/type/calculated','questiontype.php',575],['question/type/multianswer','questiontype.php',170],['question/type/random','questiontype.php',145],['question/type/description','questiontype.php',51]], 20],
'substitute_variables': ['substitute_variables', '', [['question/type/calculated','questiontype.php',1176]], 5],
'initialise_question_instance': ['initialise_question_instance', 'Initialise the common question_definition fields. ', [['question/type','questiontypebase.php',832],['question/type/calculated','questiontype.php',322],['question/type/multianswer','questiontype.php',196],['question/type/numerical','questiontype.php',344],['question/type/multichoice','questiontype.php',163],['question/type/ddimageortext','questiontypebase.php',61],['question/type/truefalse','questiontype.php',134],['question/type/match','questiontype.php',116],['question/type/shortanswer','questiontype.php',87],['question/type/gapselect','questiontypebase.php',119],['question/type/randomsamatch','questiontype.php',121],['question/type/calculatedmulti','questiontype.php',183],['question/type/essay','questiontype.php',78]], 13],
'wizardpagesnumber': ['wizardpagesnumber', '', [['question/type/calculated','questiontype.php',348]], 1],
'construct_dataset_menus': ['construct_dataset_menus', '', [['question/type/calculated','questiontype.php',1152]], 0],
'dataset_options_from_database': ['dataset_options_from_database', '', [['question/type/calculated','questiontype.php',1471]], 2],
'get_database_dataset_items': ['get_database_dataset_items', 'This function get the dataset items using id as unique parameter and return an array with itemnumber as index sorted ascendant If the multiple records with the same itemnumber exist, only the newest one i.e with the greatest id is used, the others are ignored but not deleted. MDL-19210 ', [['question/type/calculated','questiontype.php',839]], 5],
'import_or_save_files': ['import_or_save_files', 'Save the file belonging to one text field. ', [['question/type','questiontypebase.php',1218]], 17],
'get_records': ['get_records', 'Load a list of records. ', [['competency/classes','persistent.php',709],['mod/glossary/classes','entry_query_builder.php',295],['lib/dml','moodle_database.php',1285],['lib','coursecatlib.php',651],['question','category_class.php',63]], 965],
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'no_response': ['no_response', '', [['question/type','questiontypebase.php',1453],['question/type','questionbase.php',543]], 53],
'delete_files': ['delete_files', 'Delete all the files belonging to this question. ', [['question/type','questiontypebase.php',1331],['question/type/calculated','questiontype.php',1805],['question/type/multianswer','questiontype.php',241],['question/type/numerical','questiontype.php',479],['question/type/multichoice','questiontype.php',250],['question/type/truefalse','questiontype.php',164],['question/type/match','questiontype.php',197],['question/type/ddmarker','questiontype.php',264],['question/type/shortanswer','questiontype.php',51],['question/type/gapselect','questiontypebase.php',322],['question/type/ddimageortext','questiontype.php',164],['question/type/randomsamatch','questiontype.php',114],['question/type/calculatedmulti','questiontype.php',311],['question/type/essay','questiontype.php',165]], 14],
'select': ['select', '', [['lib/jquery/ui-1.11.4/external/jquery','jquery.js',2845],['lib','outputcomponents.php',1265]], 591],
'count_records_sql': ['count_records_sql', 'Get the result of a SQL SELECT COUNT(...) query. ', [['lib/dml','moodle_database.php',1796]], 155],
'add_unit': ['add_unit', 'Add a unit to a response for display. ', [['question/type/numerical','questiontype.php',396],['question/type/numerical','questiontype.php',689]], 8],
'substitute_variables_and_eval': ['substitute_variables_and_eval', '', [['question/type/calculated','questiontype.php',1207]], 1],
'import_datasets': ['import_datasets', '', [['question/type/calculated','questiontype.php',266]], 3],
'shorten_text': ['shorten_text', 'Given some text (which may contain HTML) and an ideal length, this function truncates the text neatly on a word boundary if possible ', [['lib','moodlelib.php',7822]], 87],
'custom_generator_tools': ['custom_generator_tools', '', [['question/type/calculated','questiontype.php',751]], 0],
'createelement': ['createelement', 'Create an element, set its class name and optionally install the element to its parent. ', [['lib/yuilib/2in3/2.9.0/build/yui2-carousel','yui2-carousel-debug.js',299],['theme/bootstrapbase/javascript','html5shiv.js',120],['lib/pear/HTML','QuickForm.php',533],['lib/yuilib/2in3/2.9.0/build/yui2-carousel','yui2-carousel.js',298]], 1944],
'save_dataset_definitions': ['save_dataset_definitions', '', [['question/type/calculated','questiontype.php',1261]], 4],
'save_question_calculated': ['save_question_calculated', '', [['question/type/calculated','questiontype.php',825]], 2],
'pick_question_dataset': ['pick_question_dataset', '', [['question/type/calculated','questiontype.php',1442]], 0],
'get_random_guess_score': ['get_random_guess_score', '', [['question/type','questiontypebase.php',1004],['question/classes/statistics/questions','calculator.php',460],['question/type/gapselect','questionbase.php',161],['question/type/calculated','questiontype.php',699],['question/type/multianswer','questiontype.php',225],['question/type/numerical','questiontype.php',387],['question/type/multichoice','questiontype.php',189],['question/type/missingtype','questiontype.php',87],['question/type/ddimageortext','questiontypebase.php',193],['question/type/ddmarker','question.php',393],['question/type/truefalse','questiontype.php',169],['question/type/random','questiontype.php',255],['mod/quiz/report/statistics/tests','statistics_test.php',64],['question/type/match','questiontype.php',154],['question/type/ddmarker','questiontype.php',374],['question/type/shortanswer','questiontype.php',92],['question/type/description','questiontype.php',66],['question/type/gapselect','questiontypebase.php',179],['question/type/randomsamatch','questiontype.php',168],['question/type/ddimageortext','questionbase.php',136]], 30],
'label': ['label', 'Renders form element label ', [['lib','outputcomponents.php',1741]], 107],
'move_files': ['move_files', 'Move all the files belonging to this question from one context to another. ', [['question/type','questiontypebase.php',1248],['question/type/calculated','questiontype.php',1797],['question/type/multianswer','questiontype.php',236],['question/type/numerical','questiontype.php',471],['question/type/multichoice','questiontype.php',243],['question/type/truefalse','questiontype.php',159],['question/type/match','questiontype.php',180],['question/type/ddmarker','questiontype.php',252],['question/type/shortanswer','questiontype.php',45],['question/type/gapselect','questiontypebase.php',316],['backup/cc','entities.class.php',200],['question/type/ddimageortext','questiontype.php',146],['question/type/randomsamatch','questiontype.php',107],['question/type/calculatedmulti','questiontype.php',296],['question/type/essay','questiontype.php',158]], 16],
'dataset_options': ['dataset_options', '', [['question/type/calculated','questiontype.php',1127],['question/type/calculatedsimple','questiontype.php',279]], 6],
'print_next_wizard_page': ['print_next_wizard_page', '', [['question/type/calculated','questiontype.php',352]], 0],
'get_qtype': ['get_qtype', 'Get the question type class for a particular question type. ', [['question/engine','bank.php',80],['question/format/xml','format.php',1009]], 113],
'get_datasets_for_export': ['get_datasets_for_export', '', [['question/type/calculated','questiontype.php',91]], 1],
'strlen': ['strlen', 'Counts the number of characters. Unit-tested by Kasper (single byte charsets only) ', [['lib/typo3','class.t3lib_cs.php',1520],['lib/classes','text.php',305]], 1649],
'get_default_numerical_unit': ['get_default_numerical_unit', '', [['question/type/numerical','questiontype.php',114]], 6],
'validate_text': ['validate_text', 'Validate the equations in the some question content. ', [['question/type/calculatedmulti','edit_calculatedmulti_form.php',235],['question/type/calculated','questiontype.php',440],['question/type/calculated','edit_calculated_form.php',219]], 17],
'get_dataset_definitions': ['get_dataset_definitions', '', [['question/type/calculated','questiontype.php',1224]], 8],
'array_unique': ['array_unique', '', [], 171],
'preg_match': ['preg_match', '', [], 1286],
'mt_rand': ['mt_rand', '', [], 47],
'str_replace': ['str_replace', '', [], 1648],
'array_keys': ['array_keys', '', [], 1256],
'substr': ['substr', '', [], 2823],
'array_shift': ['array_shift', '', [], 700],
'range': ['range', '', [], 82],
'abs': ['abs', '', [], 560],
'name': ['name', '', [], 118],
'settype': ['settype', '', [], 1429],
'array_key_exists': ['array_key_exists', '', [], 1445],
'ksort': ['ksort', '', [], 153],
'explode': ['explode', '', [], 1572],
'preg_replace': ['preg_replace', '', [], 917],
'strtolower': ['strtolower', '', [], 817],
'max': ['max', '', [], 1266],
'array_values': ['array_values', '', [], 342],
'trim': ['trim', '', [], 1948],
'array_flip': ['array_flip', '', [], 131],
'is_numeric': ['is_numeric', '', [], 672],
'count': ['count', '', [], 4095],
'defined': ['defined', '', [], 4731],
'exp': ['exp', '', [], 31],
'preg_match_all': ['preg_match_all', '', [], 161],
'implode': ['implode', '', [], 1281],
'ceil': ['ceil', '', [], 236],
'log': ['log', '', [], 2031],
'round': ['round', '', [], 1002],
'mt_getrandmax': ['mt_getrandmax', '', [], 3]};
CLASS_DATA={
'question_type': ['question_type', 'This is the base class for Moodle question types. ', [['question/type','questiontypebase.php',32]], 15],
'html_writer': ['html_writer', 'Simple html output class ', [['lib','outputcomponents.php',1062]], 5120],
'qtype_numerical_answer': ['qtype_numerical_answer', 'Subclass of {@link question_answer} with the extra information required by the numerical question type. ', [['question/type/numerical','question.php',310]], 37],
'qtype_calculated_dataset_loader': ['qtype_calculated_dataset_loader', 'This class is responsible for loading the dataset that a question needs from the database. ', [['question/type/calculated','question.php',174]], 4],
'question_possible_response': ['question_possible_response', 'This class is used in the return value from {@link question_type::get_possible_responses()}. ', [['question/type','questiontypebase.php',1424]], 84],
'question_dataset_dependent_items_form': ['question_dataset_dependent_items_form', 'Calculated question data set items editing form definition. ', [['question/type/calculated','datasetitems_form.php',32]], 1],
'coding_exception': ['coding_exception', 'Exception indicating programming error, must be fixed by a programer. For example a core API might throw this type of exception if a plugin calls it incorrectly. ', [['lib','setuplib.php',239]], 1200],
'question_dataset_dependent_definitions_form': ['question_dataset_dependent_definitions_form', 'Calculated question data set definitions editing form definition. ', [['question/type/calculated','datasetdefinitions_form.php',32]], 1],
'qtype_calculated': ['qtype_calculated', 'The calculated question type. ', [['question/type/calculated','questiontype.php',34]], 5]};
CONST_DATA={
'PARAM_ALPHA': ['PARAM_ALPHA', '', [['lib','moodlelib.php',77]], 398],
'PARAM_INT': ['PARAM_INT', '', [['lib','moodlelib.php',156]], 3812],
'PARAM_FLOAT': ['PARAM_FLOAT', '', [['lib','moodlelib.php',146]], 103],
'PARAM_BOOL': ['PARAM_BOOL', '', [['lib','moodlelib.php',108]], 802],
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',140],['','install.php',93],['lib','setup.php',391]], 4153]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
