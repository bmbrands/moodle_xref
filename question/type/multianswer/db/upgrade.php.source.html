<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /question/type/multianswer/db/upgrade.php source</title>
    <link rel="stylesheet" href="../../../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../../../';
subdir='question/type/multianswer/db';
filename='upgrade.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/question/type/multianswer/db/</a> -> <a href="upgrade.php.html">upgrade.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="upgrade.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="upgrade.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * Multi-answer question type upgrade code.</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * @package    qtype</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @subpackage multianswer</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @copyright  1999 onwards Martin Dougiamas {@link http://moodle.com}</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> */</span>
<a name="l25"><span class="linenum">  25</span></a>  
<a name="l26"><span class="linenum">  26</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l27"><span class="linenum">  27</span></a>  
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment">/**</span>
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment"> * Upgrade code for the multi-answer question type.</span>
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment"> * @param int $oldversion the version we are upgrading from.</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> */</span>
<a name="l32"><span class="linenum">  32</span></a>  function <a class="function" onClick="logFunction('xmldb_qtype_multianswer_upgrade')" href="../../../../_functions/xmldb_qtype_multianswer_upgrade.html" onMouseOver="funcPopup(event,'xmldb_qtype_multianswer_upgrade')">xmldb_qtype_multianswer_upgrade</a>(<a class="var it443" onMouseOver="hilite(443)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../../../_variables/oldversion.html">$oldversion</a>) {
<a name="l33"><span class="linenum">  33</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../../../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>;
<a name="l34"><span class="linenum">  34</span></a>  
<a name="l35"><span class="linenum">  35</span></a>      <a class="var it826" onMouseOver="hilite(826)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../../../_variables/dbman.html">$dbman</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_manager')" href="../../../../_functions/get_manager.html" onMouseOver="funcPopup(event,'get_manager')">get_manager</a>();
<a name="l36"><span class="linenum">  36</span></a>  
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment">    // Moodle v2.8.0 release upgrade line.</span>
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment">    // Put any upgrade step following this.</span>
<a name="l39"><span class="linenum">  39</span></a>  
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment">    // Moodle v2.9.0 release upgrade line.</span>
<a name="l41"><span class="linenum">  41</span></a>  <span class="comment">    // Put any upgrade step following this.</span>
<a name="l42"><span class="linenum">  42</span></a>  
<a name="l43"><span class="linenum">  43</span></a>      if (<a class="var it443" onMouseOver="hilite(443)" onMouseOut="lolite()" onClick="logVariable('oldversion')" href="../../../../_variables/oldversion.html">$oldversion</a> &lt; 2015100201) {
<a name="l44"><span class="linenum">  44</span></a>  
<a name="l45"><span class="linenum">  45</span></a>  <span class="comment">        // Upgrade steps need to be isolated from our APIs, so we should prevent using constants that</span>
<a name="l46"><span class="linenum">  46</span></a>  <span class="comment">        // can change over time. This is a simple copy &amp; paste from question/type/multianswer/questiontype.php</span>
<a name="l47"><span class="linenum">  47</span></a>  <span class="comment">        // with the following changes, the idea is to prevent regressions as much as possible.</span>
<a name="l48"><span class="linenum">  48</span></a>  <span class="comment">        // * All constants prefixed with UPGRADE_2015100201_</span>
<a name="l49"><span class="linenum">  49</span></a>  <span class="comment">        // * Removed all constants not required by UPGRADE_2015100201_ANSWER_REGEX</span>
<a name="l50"><span class="linenum">  50</span></a>          if (!<a class="phpfunction" onClick="logFunction('defined')" href="../../../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('UPGRADE_2015100201_ANSWER_REGEX')" href="../../../../_constants/UPGRADE_2015100201_ANSWER_REGEX.html" onMouseOver="constPopup(event,'UPGRADE_2015100201_ANSWER_REGEX')">UPGRADE_2015100201_ANSWER_REGEX</a>')) {
<a name="l51"><span class="linenum">  51</span></a>              <a class="phpfunction" onClick="logFunction('define')" href="../../../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('UPGRADE_2015100201_ANSWER_ALTERNATIVE_FRACTION_REGEX',
<a name="l52"><span class="linenum">  52</span></a>                     '=|%(-?[0-9]+)%');
<a name="l53"><span class="linenum">  53</span></a>              <a class="phpfunction" onClick="logFunction('define')" href="../../../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('UPGRADE_2015100201_ANSWER_ALTERNATIVE_ANSWER_REGEX',
<a name="l54"><span class="linenum">  54</span></a>                      '.+?(?&lt;!\\\\|&amp;|&amp;amp;)(?=[~#}]|$)');
<a name="l55"><span class="linenum">  55</span></a>              <a class="phpfunction" onClick="logFunction('define')" href="../../../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('UPGRADE_2015100201_ANSWER_ALTERNATIVE_FEEDBACK_REGEX',
<a name="l56"><span class="linenum">  56</span></a>                      '.*?(?&lt;!\\\\)(?=[~}]|$)');
<a name="l57"><span class="linenum">  57</span></a>              <a class="phpfunction" onClick="logFunction('define')" href="../../../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('UPGRADE_2015100201_ANSWER_ALTERNATIVE_REGEX',
<a name="l58"><span class="linenum">  58</span></a>                     '(' . UPGRADE_2015100201_ANSWER_ALTERNATIVE_FRACTION_REGEX .')?' .
<a name="l59"><span class="linenum">  59</span></a>                     '(' . UPGRADE_2015100201_ANSWER_ALTERNATIVE_ANSWER_REGEX . ')' .
<a name="l60"><span class="linenum">  60</span></a>                     '(#(' . UPGRADE_2015100201_ANSWER_ALTERNATIVE_FEEDBACK_REGEX .'))?');
<a name="l61"><span class="linenum">  61</span></a>  
<a name="l62"><span class="linenum">  62</span></a>  <span class="comment">            // Remaining ANSWER regexes.</span>
<a name="l63"><span class="linenum">  63</span></a>              <a class="phpfunction" onClick="logFunction('define')" href="../../../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('UPGRADE_2015100201_ANSWER_TYPE_DEF_REGEX')" href="../../../../_constants/UPGRADE_2015100201_ANSWER_TYPE_DEF_REGEX.html" onMouseOver="constPopup(event,'UPGRADE_2015100201_ANSWER_TYPE_DEF_REGEX')">UPGRADE_2015100201_ANSWER_TYPE_DEF_REGEX</a>',
<a name="l64"><span class="linenum">  64</span></a>                      '(NUMERICAL|NM)|(MULTICHOICE|MC)|(MULTICHOICE_V|MCV)|(MULTICHOICE_H|MCH)|' .
<a name="l65"><span class="linenum">  65</span></a>                      '(SHORTANSWER|SA|MW)|(SHORTANSWER_C|SAC|MWC)|' .
<a name="l66"><span class="linenum">  66</span></a>                      '(MULTICHOICE_S|MCS)|(MULTICHOICE_VS|MCVS)|(MULTICHOICE_HS|MCHS)');
<a name="l67"><span class="linenum">  67</span></a>              <a class="phpfunction" onClick="logFunction('define')" href="../../../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('UPGRADE_2015100201_ANSWER_START_REGEX')" href="../../../../_constants/UPGRADE_2015100201_ANSWER_START_REGEX.html" onMouseOver="constPopup(event,'UPGRADE_2015100201_ANSWER_START_REGEX')">UPGRADE_2015100201_ANSWER_START_REGEX</a>',
<a name="l68"><span class="linenum">  68</span></a>                     '\{([0-9]*):(' . <a class="constant" onClick="logConstant('UPGRADE_2015100201_ANSWER_TYPE_DEF_REGEX')" href="../../../../_constants/UPGRADE_2015100201_ANSWER_TYPE_DEF_REGEX.html" onMouseOver="constPopup(event,'UPGRADE_2015100201_ANSWER_TYPE_DEF_REGEX')">UPGRADE_2015100201_ANSWER_TYPE_DEF_REGEX</a> . '):');
<a name="l69"><span class="linenum">  69</span></a>  
<a name="l70"><span class="linenum">  70</span></a>              <a class="phpfunction" onClick="logFunction('define')" href="../../../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('UPGRADE_2015100201_ANSWER_REGEX')" href="../../../../_constants/UPGRADE_2015100201_ANSWER_REGEX.html" onMouseOver="constPopup(event,'UPGRADE_2015100201_ANSWER_REGEX')">UPGRADE_2015100201_ANSWER_REGEX</a>',
<a name="l71"><span class="linenum">  71</span></a>                      <a class="constant" onClick="logConstant('UPGRADE_2015100201_ANSWER_START_REGEX')" href="../../../../_constants/UPGRADE_2015100201_ANSWER_START_REGEX.html" onMouseOver="constPopup(event,'UPGRADE_2015100201_ANSWER_START_REGEX')">UPGRADE_2015100201_ANSWER_START_REGEX</a>
<a name="l72"><span class="linenum">  72</span></a>                      . '(' . UPGRADE_2015100201_ANSWER_ALTERNATIVE_REGEX
<a name="l73"><span class="linenum">  73</span></a>                      . '(~'
<a name="l74"><span class="linenum">  74</span></a>                      . UPGRADE_2015100201_ANSWER_ALTERNATIVE_REGEX
<a name="l75"><span class="linenum">  75</span></a>                      . ')*)\}');
<a name="l76"><span class="linenum">  76</span></a>  
<a name="l77"><span class="linenum">  77</span></a>              <a class="phpfunction" onClick="logFunction('define')" href="../../../../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('UPGRADE_2015100201_ANSWER_REGEX_ANSWER_TYPE_MULTICHOICE', 4);
<a name="l78"><span class="linenum">  78</span></a>          }
<a name="l79"><span class="linenum">  79</span></a>  
<a name="l80"><span class="linenum">  80</span></a>  <span class="comment">        // Detect the exact table/field we want to use, coz can be different</span>
<a name="l81"><span class="linenum">  81</span></a>  <span class="comment">        // depending of the version we are upgrading from. See MDL-52291 and MDL-52298.</span>
<a name="l82"><span class="linenum">  82</span></a>          <a class="var it6384" onMouseOver="hilite(6384)" onMouseOut="lolite()" onClick="logVariable('multichoicetable')" href="../../../../_variables/multichoicetable.html">$multichoicetable</a> = 'qtype_multichoice_options';
<a name="l83"><span class="linenum">  83</span></a>          <a class="var it6385" onMouseOver="hilite(6385)" onMouseOut="lolite()" onClick="logVariable('multichoicefield')" href="../../../../_variables/multichoicefield.html">$multichoicefield</a> = 'questionid';
<a name="l84"><span class="linenum">  84</span></a>          if (!<a class="var it826" onMouseOver="hilite(826)" onMouseOut="lolite()" onClick="logVariable('dbman')" href="../../../../_variables/dbman.html">$dbman</a>-&gt;<a class="function" onClick="logFunction('table_exists')" href="../../../../_functions/table_exists.html" onMouseOver="funcPopup(event,'table_exists')">table_exists</a>(<a class="var it6384" onMouseOver="hilite(6384)" onMouseOut="lolite()" onClick="logVariable('multichoicetable')" href="../../../../_variables/multichoicetable.html">$multichoicetable</a>)) {
<a name="l85"><span class="linenum">  85</span></a>  <span class="comment">            // Multichoice not upgraded yet, let's use old names.</span>
<a name="l86"><span class="linenum">  86</span></a>              <a class="var it6384" onMouseOver="hilite(6384)" onMouseOut="lolite()" onClick="logVariable('multichoicetable')" href="../../../../_variables/multichoicetable.html">$multichoicetable</a> = 'question_multichoice';
<a name="l87"><span class="linenum">  87</span></a>              <a class="var it6385" onMouseOver="hilite(6385)" onMouseOut="lolite()" onClick="logVariable('multichoicefield')" href="../../../../_variables/multichoicefield.html">$multichoicefield</a> = 'question';
<a name="l88"><span class="linenum">  88</span></a>          }
<a name="l89"><span class="linenum">  89</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../../_variables/rs.html">$rs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(&quot;SELECT q.id, q.category, qma.sequence
<a name="l90"><span class="linenum">  90</span></a>                   FROM {question} q
<a name="l91"><span class="linenum">  91</span></a>                   JOIN {question_multianswer} qma ON q.id = qma.question&quot;);
<a name="l92"><span class="linenum">  92</span></a>          foreach (<a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../../_variables/rs.html">$rs</a> as <a class="var it445" onMouseOver="hilite(445)" onMouseOut="lolite()" onClick="logVariable('q')" href="../../../../_variables/q.html">$q</a>) {
<a name="l93"><span class="linenum">  93</span></a>              <a class="var it5341" onMouseOver="hilite(5341)" onMouseOut="lolite()" onClick="logVariable('sequence')" href="../../../../_variables/sequence.html">$sequence</a> = <a class="phpfunction" onClick="logFunction('preg_split')" href="../../../../_functions/preg_split.html" onMouseOver="phpfuncPopup(event,'preg_split')">preg_split</a>('/,/', <a class="var it445" onMouseOver="hilite(445)" onMouseOut="lolite()" onClick="logVariable('q')" href="../../../../_variables/q.html">$q</a>-&gt;<a onClick="logVariable('sequence')" class="var it43090" onMouseOver="hilite(43090)" onMouseOut="lolite()" href="../../../../_variables/sequence.html">sequence</a>, -1, PREG_SPLIT_NO_EMPTY);
<a name="l94"><span class="linenum">  94</span></a>              if (<a class="var it5341" onMouseOver="hilite(5341)" onMouseOut="lolite()" onClick="logVariable('sequence')" href="../../../../_variables/sequence.html">$sequence</a>) {
<a name="l95"><span class="linenum">  95</span></a>  <span class="comment">                // Get relevant data indexed by positionkey from the multianswers table.</span>
<a name="l96"><span class="linenum">  96</span></a>                  <a class="var it6386" onMouseOver="hilite(6386)" onMouseOut="lolite()" onClick="logVariable('wrappedquestions')" href="../../../../_variables/wrappedquestions.html">$wrappedquestions</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_list')" href="../../../../_functions/get_records_list.html" onMouseOver="funcPopup(event,'get_records_list')">get_records_list</a>('question', 'id', <a class="var it5341" onMouseOver="hilite(5341)" onMouseOut="lolite()" onClick="logVariable('sequence')" href="../../../../_variables/sequence.html">$sequence</a>, 'id ASC');
<a name="l97"><span class="linenum">  97</span></a>                  foreach (<a class="var it6386" onMouseOver="hilite(6386)" onMouseOut="lolite()" onClick="logVariable('wrappedquestions')" href="../../../../_variables/wrappedquestions.html">$wrappedquestions</a> as <a class="var it147" onMouseOver="hilite(147)" onMouseOut="lolite()" onClick="logVariable('wrapped')" href="../../../../_variables/wrapped.html">$wrapped</a>) {
<a name="l98"><span class="linenum">  98</span></a>                      if (<a class="var it147" onMouseOver="hilite(147)" onMouseOut="lolite()" onClick="logVariable('wrapped')" href="../../../../_variables/wrapped.html">$wrapped</a>-&gt;<a onClick="logVariable('qtype')" class="var it43762" onMouseOver="hilite(43762)" onMouseOut="lolite()" href="../../../../_variables/qtype.html">qtype</a> == 'multichoice') {
<a name="l99"><span class="linenum">  99</span></a>                          <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../../_variables/options.html">$options</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(<a class="var it6384" onMouseOver="hilite(6384)" onMouseOut="lolite()" onClick="logVariable('multichoicetable')" href="../../../../_variables/multichoicetable.html">$multichoicetable</a>, array(<a class="var it6385" onMouseOver="hilite(6385)" onMouseOut="lolite()" onClick="logVariable('multichoicefield')" href="../../../../_variables/multichoicefield.html">$multichoicefield</a> =&gt; <a class="var it147" onMouseOver="hilite(147)" onMouseOut="lolite()" onClick="logVariable('wrapped')" href="../../../../_variables/wrapped.html">$wrapped</a>-&gt;<a onClick="logVariable('id')" class="var it43762" onMouseOver="hilite(43762)" onMouseOut="lolite()" href="../../../../_variables/id.html">id</a>), '*');
<a name="l100"><span class="linenum"> 100</span></a>                          if (isset(<a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('shuffleanswers')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../../../_variables/shuffleanswers.html">shuffleanswers</a>)) {
<a name="l101"><span class="linenum"> 101</span></a>                              <a class="phpfunction" onClick="logFunction('preg_match')" href="../../../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('/'.<a class="constant" onClick="logConstant('UPGRADE_2015100201_ANSWER_REGEX')" href="../../../../_constants/UPGRADE_2015100201_ANSWER_REGEX.html" onMouseOver="constPopup(event,'UPGRADE_2015100201_ANSWER_REGEX')">UPGRADE_2015100201_ANSWER_REGEX</a>.'/s', <a class="var it147" onMouseOver="hilite(147)" onMouseOut="lolite()" onClick="logVariable('wrapped')" href="../../../../_variables/wrapped.html">$wrapped</a>-&gt;<a onClick="logVariable('questiontext')" class="var it43762" onMouseOver="hilite(43762)" onMouseOut="lolite()" href="../../../../_variables/questiontext.html">questiontext</a>, <a class="var it6387" onMouseOver="hilite(6387)" onMouseOut="lolite()" onClick="logVariable('answerregs')" href="../../../../_variables/answerregs.html">$answerregs</a>);
<a name="l102"><span class="linenum"> 102</span></a>                              if (isset(<a class="var it6387" onMouseOver="hilite(6387)" onMouseOut="lolite()" onClick="logVariable('answerregs')" href="../../../../_variables/answerregs.html">$answerregs</a>[UPGRADE_2015100201_ANSWER_REGEX_ANSWER_TYPE_MULTICHOICE]) &amp;&amp;
<a name="l103"><span class="linenum"> 103</span></a>                                      <a class="var it6387" onMouseOver="hilite(6387)" onMouseOut="lolite()" onClick="logVariable('answerregs')" href="../../../../_variables/answerregs.html">$answerregs</a>[UPGRADE_2015100201_ANSWER_REGEX_ANSWER_TYPE_MULTICHOICE] !== '') {
<a name="l104"><span class="linenum"> 104</span></a>                                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../../../../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>(<a class="var it6384" onMouseOver="hilite(6384)" onMouseOut="lolite()" onClick="logVariable('multichoicetable')" href="../../../../_variables/multichoicetable.html">$multichoicetable</a>, 'shuffleanswers', '0',
<a name="l105"><span class="linenum"> 105</span></a>                                          array('id' =&gt; <a class="var it27" onMouseOver="hilite(27)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../../_variables/options.html">$options</a>-&gt;<a onClick="logVariable('id')" class="var it42909" onMouseOver="hilite(42909)" onMouseOut="lolite()" href="../../../../_variables/id.html">id</a>) );
<a name="l106"><span class="linenum"> 106</span></a>                              }
<a name="l107"><span class="linenum"> 107</span></a>                          } else {
<a name="l108"><span class="linenum"> 108</span></a>                              <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../../../_variables/newrecord.html">$newrecord</a> = new stdClass();
<a name="l109"><span class="linenum"> 109</span></a>                              <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../../../_variables/newrecord.html">$newrecord</a>-&gt;<a class="var it6385" onMouseOver="hilite(6385)" onMouseOut="lolite()" onClick="logVariable('multichoicefield')" href="../../../../_variables/multichoicefield.html">$multichoicefield</a> = <a class="var it147" onMouseOver="hilite(147)" onMouseOut="lolite()" onClick="logVariable('wrapped')" href="../../../../_variables/wrapped.html">$wrapped</a>-&gt;<a onClick="logVariable('id')" class="var it43762" onMouseOver="hilite(43762)" onMouseOut="lolite()" href="../../../../_variables/id.html">id</a>;
<a name="l110"><span class="linenum"> 110</span></a>                              <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('correctfeedback')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../../../_variables/correctfeedback.html">correctfeedback</a> = '';
<a name="l111"><span class="linenum"> 111</span></a>                              <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('partiallycorrectfeedback')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../../../_variables/partiallycorrectfeedback.html">partiallycorrectfeedback</a> = '';
<a name="l112"><span class="linenum"> 112</span></a>                              <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../../../_variables/newrecord.html">$newrecord</a>-&gt;<a onClick="logVariable('incorrectfeedback')" class="var it43086" onMouseOver="hilite(43086)" onMouseOut="lolite()" href="../../../../_variables/incorrectfeedback.html">incorrectfeedback</a> = '';
<a name="l113"><span class="linenum"> 113</span></a>                              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../../../../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>(<a class="var it6384" onMouseOver="hilite(6384)" onMouseOut="lolite()" onClick="logVariable('multichoicetable')" href="../../../../_variables/multichoicetable.html">$multichoicetable</a>, <a class="var it6388" onMouseOver="hilite(6388)" onMouseOut="lolite()" onClick="logVariable('newrecord')" href="../../../../_variables/newrecord.html">$newrecord</a>);
<a name="l114"><span class="linenum"> 114</span></a>                          }
<a name="l115"><span class="linenum"> 115</span></a>                      }
<a name="l116"><span class="linenum"> 116</span></a>                  }
<a name="l117"><span class="linenum"> 117</span></a>              }
<a name="l118"><span class="linenum"> 118</span></a>          }
<a name="l119"><span class="linenum"> 119</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l120"><span class="linenum"> 120</span></a>  <span class="comment">        // Multianswer savepoint reached.</span>
<a name="l121"><span class="linenum"> 121</span></a>          <a class="function" onClick="logFunction('upgrade_plugin_savepoint')" href="../../../../_functions/upgrade_plugin_savepoint.html" onMouseOver="funcPopup(event,'upgrade_plugin_savepoint')">upgrade_plugin_savepoint</a>(true, 2015100201, 'qtype', 'multianswer');
<a name="l122"><span class="linenum"> 122</span></a>      }
<a name="l123"><span class="linenum"> 123</span></a>  
<a name="l124"><span class="linenum"> 124</span></a>  <span class="comment">    // Moodle v3.0.0 release upgrade line.</span>
<a name="l125"><span class="linenum"> 125</span></a>  <span class="comment">    // Put any upgrade step following this.</span>
<a name="l126"><span class="linenum"> 126</span></a>  
<a name="l127"><span class="linenum"> 127</span></a>  <span class="comment">    // Moodle v3.1.0 release upgrade line.</span>
<a name="l128"><span class="linenum"> 128</span></a>  <span class="comment">    // Put any upgrade step following this.</span>
<a name="l129"><span class="linenum"> 129</span></a>  
<a name="l130"><span class="linenum"> 130</span></a>      return true;
<a name="l131"><span class="linenum"> 131</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'close': ['close', 'Close archive, write changes to disk. ', [['lib/filestorage','zip_archive.php',183],['lib/dml','mssql_native_moodle_recordset.php',87],['auth/fc','fcFPP.php',78],['lib/dml','mysqli_native_moodle_recordset.php',86],['lib/spout/src/Spout/Reader','ReaderInterface.php',30],['lib/spout/src/Spout/Writer/ODS/Internal','Workbook.php',81],['lib/dml','pdo_moodle_recordset.php',79],['lib','csvlib.class.php',256],['lib/horde/framework/Horde/Socket','Client.php',135],['backup/util/helper','backup_null_iterator.class.php',53],['admin/tool/uploaduser','locallib.php',149],['lib/tcpdf','tcpdf.php',2943],['lib/phpunit/classes','phpmailer_sink.php',41],['lib/phpmailer','class.smtp.php',582],['lib/dml','sqlsrv_native_moodle_recordset.php',133],['lib/classes/dml','recordset_walk.php',153],['lib/spout/src/Spout/Writer/XLSX/Helper','SharedStringsHelper.php',84],['grade/export','lib.php',689],['lib','excellib.class.php',93],['backup/util/loggers','file_logger.class.php',69],['grade','lib.php',324],['backup/util/helper','backup_array_iterator.class.php',63],['lib/horde/framework/Horde/Imap/Client','Base.php',1846],['mod/assign/feedback/offline','importgradeslib.php',204],['lib/dml','oci_native_moodle_recordset.php',80],['lib/adodb','adodb.inc.php',2361],['lib/adodb','adodb.inc.php',3090],['lib/adodb','adodb.inc.php',3870],['lib/google/src/Google/Logger','File.php',132],['lib/phpunit/classes','event_sink.php',39],['lib/horde/framework/Horde','Stream.php',585],['backup/util/loggers','base_logger.class.php',89],['lib/phpexcel/PHPExcel/Shared','ZipArchive.php',71],['question/engine/tests','helpers.php',1241],['lib/spout/src/Spout/Writer','AbstractWriter.php',312],['lib','odslib.class.php',71],['lib/spout/src/Spout/Writer/Common/Internal','WorksheetInterface.php',34],['lib/spout/src/Spout/Writer/ODS/Internal','Worksheet.php',214],['lib/spout/src/Spout/Writer','WriterInterface.php',84],['lib/spout/src/Spout/Writer/XLSX/Internal','Worksheet.php',174],['lib/spout/src/Spout/Reader','AbstractReader.php',183],['lib/phpunit/classes','message_sink.php',39],['lib/spout/src/Spout/Writer/Common/Internal','WorkbookInterface.php',65],['lib/spout/src/Spout/Writer/XLSX/Internal','Workbook.php',95],['lib/pear/Net','GeoIP.php',556],['lib/tests','completionlib_test.php',907],['lib/pear/Auth','RADIUS.php',550],['lib/pear/Auth','RADIUS.php',710],['lib/pear/Auth','RADIUS.php',829],['lib','webdavlib.php',176],['lib/dml','pgsql_native_moodle_recordset.php',107]], 1128],
'get_records_list': ['get_records_list', 'Get a number of records as an array of objects where one field match one list of values. ', [['lib/dml','moodle_database.php',1310]], 34],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'table_exists': ['table_exists', 'Given one xmldb_table, checks if it exists in DB (true/false). ', [['lib/ddl','sql_generator.php',215],['lib/ddl','database_manager.php',90]], 131],
'xmldb_qtype_multianswer_upgrade': ['xmldb_qtype_multianswer_upgrade', 'Upgrade code for the multi-answer question type. ', [['question/type/multianswer/db','upgrade.php',28]], 0],
'upgrade_plugin_savepoint': ['upgrade_plugin_savepoint', 'Plugins upgrade savepoint, marks end of blocks upgrade blocks It stores plugin version, resets upgrade timeout and abort upgrade if user cancels page loading. ', [['lib','upgradelib.php',321]], 23],
'get_recordset_sql': ['get_recordset_sql', 'Get a number of records as an moodle_recordset.  $sql must be a complete SQL query. Since this method is a little less readable, use of it should be restricted to code where it\'s possible there might be large datasets being returned.  For known small datasets use get_records_sql - it leads to simpler code. ', [['lib/dml','pdo_moodle_database.php',252],['lib/dml','oci_native_moodle_database.php',1106],['lib/dml','pgsql_native_moodle_database.php',688],['lib/dml','mssql_native_moodle_database.php',736],['lib/dml','mysqli_native_moodle_database.php',993],['lib/dml','sqlsrv_native_moodle_database.php',811],['lib/dml/tests','dml_test.php',5544]], 283],
'get_manager': ['get_manager', 'Returns the sql generator used for db manipulation. Used mostly in upgrade.php scripts. ', [['lib/dml','moodle_database.php',1080]], 229],
'set_field': ['set_field', 'Set a single field in every table record where all the given conditions met. ', [['lib/dml','moodle_database.php',1737],['availability/condition/profile/tests','condition_test.php',349]], 485],
'preg_split': ['preg_split', '', [], 146],
'define': ['define', '', [], 2373],
'defined': ['defined', '', [], 4731],
'preg_match': ['preg_match', '', [], 1286]};
CLASS_DATA={
};
CONST_DATA={
'UPGRADE_2015100201_ANSWER_START_REGEX': ['UPGRADE_2015100201_ANSWER_START_REGEX', '', [['question/type/multianswer/db','upgrade.php',67]], 2],
'UPGRADE_2015100201_ANSWER_TYPE_DEF_REGEX': ['UPGRADE_2015100201_ANSWER_TYPE_DEF_REGEX', '', [['question/type/multianswer/db','upgrade.php',63]], 2],
'UPGRADE_2015100201_ANSWER_REGEX': ['UPGRADE_2015100201_ANSWER_REGEX', '', [['question/type/multianswer/db','upgrade.php',70]], 3],
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',140],['','install.php',93],['lib','setup.php',391]], 4153]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
