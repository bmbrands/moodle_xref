<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : Detail view of datalib.php</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='question/engine';
filename='datalib.php.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="details-heading"><a href="./index.html">/question/engine/</a> -> <a href="datalib.php.source.html">datalib.php</a> (summary)</h2>
<div class="details-summary">
<p class="viewlinks">[<a href="datalib.php.source.html">Source view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="../../_stats.html">Project Stats</a>]</p>
<p><b>Code for loading and saving question attempts to and from the database. Note that many of the methods of this class should be considered private to the question engine. They should be accessed through the {@link question_engine} class. For example, you should call {@link question_engine::save_questions_usage_by_activity()} rather than {@link question_engine_data_mapper::insert_questions_usage_by_activity()}. The exception to this is some of the reporting methods, like {@link question_engine_data_mapper::load_attempts_at_question()}.</b></p>
<table>
<tr><td align="right">Copyright: </td><td>2009 The Open University</td></tr>
<tr><td align="right">License: </td><td><a href="http://www.gnu.org/copyleft/gpl.html" target="_blank">http://www.gnu.org/copyleft/gpl.html</a> GNU GPL v3 or later</td></tr>
<tr><td align="right">File Size: </td><td>1980 lines (72 kb)</td></tr>
<tr><td align="right">Included or required: </td><td><a href="datalib.php.xref.html">1 time</a></td></tr>
<tr><td align="right" valign="top">Referenced: </td><td>0 times</td></tr>
<tr><td align="right" valign="top">Includes or requires: </td><td>0 files</td></tr>
</table>
<h3>Defines 7 classes</h3>
<div class="inset">
<p><b>question_engine_data_mapper::</b> (35 methods):<br>
&nbsp;&nbsp;<a href="#__construct">__construct</a>()<br>
&nbsp;&nbsp;<a href="#insert_questions_usage_by_activity">insert_questions_usage_by_activity</a>()<br>
&nbsp;&nbsp;<a href="#insert_question_attempt">insert_question_attempt</a>()<br>
&nbsp;&nbsp;<a href="#make_step_record">make_step_record</a>()<br>
&nbsp;&nbsp;<a href="#prepare_step_data">prepare_step_data</a>()<br>
&nbsp;&nbsp;<a href="#insert_all_step_data">insert_all_step_data</a>()<br>
&nbsp;&nbsp;<a href="#insert_question_attempt_step">insert_question_attempt_step</a>()<br>
&nbsp;&nbsp;<a href="#update_question_attempt_step">update_question_attempt_step</a>()<br>
&nbsp;&nbsp;<a href="#insert_question_attempt_metadata">insert_question_attempt_metadata</a>()<br>
&nbsp;&nbsp;<a href="#update_question_attempt_metadata">update_question_attempt_metadata</a>()<br>
&nbsp;&nbsp;<a href="#load_question_attempt_step">load_question_attempt_step</a>()<br>
&nbsp;&nbsp;<a href="#load_question_attempt">load_question_attempt</a>()<br>
&nbsp;&nbsp;<a href="#load_questions_usage_by_activity">load_questions_usage_by_activity</a>()<br>
&nbsp;&nbsp;<a href="#load_questions_usages_by_activity">load_questions_usages_by_activity</a>()<br>
&nbsp;&nbsp;<a href="#load_questions_usages_latest_steps">load_questions_usages_latest_steps</a>()<br>
&nbsp;&nbsp;<a href="#load_questions_usages_question_state_summary">load_questions_usages_question_state_summary</a>()<br>
&nbsp;&nbsp;<a href="#load_questions_usages_where_question_in_state">load_questions_usages_where_question_in_state</a>()<br>
&nbsp;&nbsp;<a href="#load_average_marks">load_average_marks</a>()<br>
&nbsp;&nbsp;<a href="#load_attempts_at_question">load_attempts_at_question</a>()<br>
&nbsp;&nbsp;<a href="#update_questions_usage_by_activity">update_questions_usage_by_activity</a>()<br>
&nbsp;&nbsp;<a href="#update_question_attempt">update_question_attempt</a>()<br>
&nbsp;&nbsp;<a href="#delete_questions_usage_by_activities">delete_questions_usage_by_activities</a>()<br>
&nbsp;&nbsp;<a href="#delete_usage_records_for_mysql">delete_usage_records_for_mysql</a>()<br>
&nbsp;&nbsp;<a href="#delete_steps">delete_steps</a>()<br>
&nbsp;&nbsp;<a href="#delete_response_files">delete_response_files</a>()<br>
&nbsp;&nbsp;<a href="#delete_previews">delete_previews</a>()<br>
&nbsp;&nbsp;<a href="#update_question_attempt_flag">update_question_attempt_flag</a>()<br>
&nbsp;&nbsp;<a href="#full_states_to_summary_state_sql">full_states_to_summary_state_sql</a>()<br>
&nbsp;&nbsp;<a href="#in_summary_state_test">in_summary_state_test</a>()<br>
&nbsp;&nbsp;<a href="#set_max_mark_in_attempts">set_max_mark_in_attempts</a>()<br>
&nbsp;&nbsp;<a href="#sum_usage_marks_subquery">sum_usage_marks_subquery</a>()<br>
&nbsp;&nbsp;<a href="#question_attempt_latest_state_view">question_attempt_latest_state_view</a>()<br>
&nbsp;&nbsp;<a href="#latest_step_for_qa_subquery">latest_step_for_qa_subquery</a>()<br>
&nbsp;&nbsp;<a href="#questions_in_use">questions_in_use</a>()<br>
&nbsp;&nbsp;<a href="#load_used_variants">load_used_variants</a>()<br>
</p>
<p><b>question_engine_unit_of_work::</b> (14 methods):<br>
&nbsp;&nbsp;<a href="#__construct">__construct</a>()<br>
&nbsp;&nbsp;<a href="#notify_modified">notify_modified</a>()<br>
&nbsp;&nbsp;<a href="#notify_attempt_added">notify_attempt_added</a>()<br>
&nbsp;&nbsp;<a href="#notify_attempt_modified">notify_attempt_modified</a>()<br>
&nbsp;&nbsp;<a href="#notify_attempt_moved">notify_attempt_moved</a>()<br>
&nbsp;&nbsp;<a href="#notify_step_added">notify_step_added</a>()<br>
&nbsp;&nbsp;<a href="#notify_step_modified">notify_step_modified</a>()<br>
&nbsp;&nbsp;<a href="#notify_step_deleted">notify_step_deleted</a>()<br>
&nbsp;&nbsp;<a href="#notify_metadata_added">notify_metadata_added</a>()<br>
&nbsp;&nbsp;<a href="#notify_metadata_modified">notify_metadata_modified</a>()<br>
&nbsp;&nbsp;<a href="#is_step_added">is_step_added</a>()<br>
&nbsp;&nbsp;<a href="#is_step_modified">is_step_modified</a>()<br>
&nbsp;&nbsp;<a href="#is_step_deleted">is_step_deleted</a>()<br>
&nbsp;&nbsp;<a href="#save">save</a>()<br>
</p>
<p><b>question_response_files::</b> (1 method):<br>
&nbsp;&nbsp;<a href="#get_files">get_files</a>()<br>
</p>
<p><b>question_file_saver::</b> (5 methods):<br>
&nbsp;&nbsp;<a href="#__construct">__construct</a>()<br>
&nbsp;&nbsp;<a href="#compute_value">compute_value</a>()<br>
&nbsp;&nbsp;<a href="#__tostring">__toString</a>()<br>
&nbsp;&nbsp;<a href="#save_files">save_files</a>()<br>
&nbsp;&nbsp;<a href="#get_files">get_files</a>()<br>
</p>
<p><b>question_file_loader::</b> (5 methods):<br>
&nbsp;&nbsp;<a href="#__construct">__construct</a>()<br>
&nbsp;&nbsp;<a href="#__tostring">__toString</a>()<br>
&nbsp;&nbsp;<a href="#get_files">get_files</a>()<br>
&nbsp;&nbsp;<a href="#get_question_file_saver">get_question_file_saver</a>()<br>
&nbsp;&nbsp;<a href="#get_hash_code">get_hash_code</a>()<br>
</p>
<p><b>qubaid_list::</b> (6 methods):<br>
&nbsp;&nbsp;<a href="#__construct">__construct</a>()<br>
&nbsp;&nbsp;<a href="#from_question_attempts">from_question_attempts</a>()<br>
&nbsp;&nbsp;<a href="#where">where</a>()<br>
&nbsp;&nbsp;<a href="#from_where_params">from_where_params</a>()<br>
&nbsp;&nbsp;<a href="#usage_id_in">usage_id_in</a>()<br>
&nbsp;&nbsp;<a href="#usage_id_in_params">usage_id_in_params</a>()<br>
</p>
<p><b>qubaid_join::</b> (6 methods):<br>
&nbsp;&nbsp;<a href="#__construct">__construct</a>()<br>
&nbsp;&nbsp;<a href="#from_question_attempts">from_question_attempts</a>()<br>
&nbsp;&nbsp;<a href="#where">where</a>()<br>
&nbsp;&nbsp;<a href="#from_where_params">from_where_params</a>()<br>
&nbsp;&nbsp;<a href="#usage_id_in">usage_id_in</a>()<br>
&nbsp;&nbsp;<a href="#usage_id_in_params">usage_id_in_params</a>()<br>
</p>
</div>
</div>
<br><div class="details-funclist">
<div class="details-classinfo">
<p class="details-classtitle">Class: <a name="question_engine_data_mapper"><b>question_engine_data_mapper</b></a>&nbsp;&nbsp;- <a href="../../_classes/question_engine_data_mapper.html"><small>X-Ref</small></a>
</p>
<b>This class controls the loading and saving of question engine data to and from<BR>
the database.<BR>
</b><br>
<div class="inset"><table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="__construct" onClick="logFunction('__construct', 'datalib.php.source.html#l68')" href="datalib.php.source.html#l68">__construct</a>(moodle_database <a href="../../_variables/db.html">$db</a> = null)&nbsp;&nbsp;
<a href="../../_functions/__construct.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b></b><BR><b>param:</b> moodle_database $db a database connectoin. Defaults to global $DB.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="insert_questions_usage_by_activity" onClick="logFunction('insert_questions_usage_by_activity', 'datalib.php.source.html#l77')" href="datalib.php.source.html#l77">insert_questions_usage_by_activity</a>(question_usage_by_activity <a href="../../_variables/quba.html">$quba</a>)&nbsp;&nbsp;
<a href="../../_functions/insert_questions_usage_by_activity.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Store an entire {@link question_usage_by_activity} in the database,<BR>
including all the question_attempts that comprise it.<BR>
</b><BR>You should not call this method directly. You should use<BR>
<b>param:</b> question_usage_by_activity $quba the usage to store.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="insert_question_attempt" onClick="logFunction('insert_question_attempt', 'datalib.php.source.html#l109')" href="datalib.php.source.html#l109">insert_question_attempt</a>(question_attempt <a href="../../_variables/qa.html">$qa</a>, <a href="../../_variables/context.html">$context</a>)&nbsp;&nbsp;
<a href="../../_functions/insert_question_attempt.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Store an entire {@link question_attempt} in the database,<BR>
including all the question_attempt_steps that comprise it.<BR>
</b><BR>You should not call this method directly. You should use<BR>
<b>param:</b> question_attempt $qa the question attempt to store.<br>
<b>param:</b> context $context the context of the owning question_usage_by_activity.<br>
<b>return:</b> array of question_attempt_step_data rows, that still need to be inserted.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="make_step_record" onClick="logFunction('make_step_record', 'datalib.php.source.html#l154')" href="datalib.php.source.html#l154">make_step_record</a>(question_attempt_step <a href="../../_variables/step.html">$step</a>, <a href="../../_variables/questionattemptid.html">$questionattemptid</a>, <a href="../../_variables/seq.html">$seq</a>)&nbsp;&nbsp;
<a href="../../_functions/make_step_record.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Helper method used by insert_question_attempt_step and update_question_attempt_step<BR>
</b><BR><b>param:</b> question_attempt_step $step the step to store.<br>
<b>param:</b> int $questionattemptid the question attept id this step belongs to.<br>
<b>param:</b> int $seq the sequence number of this stop.<br>
<b>return:</b> stdClass data to insert into the database.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="prepare_step_data" onClick="logFunction('prepare_step_data', 'datalib.php.source.html#l172')" href="datalib.php.source.html#l172">prepare_step_data</a>(question_attempt_step <a href="../../_variables/step.html">$step</a>, <a href="../../_variables/stepid.html">$stepid</a>, <a href="../../_variables/context.html">$context</a>)&nbsp;&nbsp;
<a href="../../_functions/prepare_step_data.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Helper method used by insert_question_attempt_step and update_question_attempt_step<BR>
</b><BR><b>param:</b> question_attempt_step $step the step to store.<br>
<b>param:</b> int $stepid the id of the step.<br>
<b>param:</b> context $context the context of the owning question_usage_by_activity.<br>
<b>return:</b> array of question_attempt_step_data rows, that still need to be inserted.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="insert_all_step_data" onClick="logFunction('insert_all_step_data', 'datalib.php.source.html#l198')" href="datalib.php.source.html#l198">insert_all_step_data</a>(array <a href="../../_variables/rows.html">$rows</a>)&nbsp;&nbsp;
<a href="../../_functions/insert_all_step_data.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Insert a lot of records into question_attempt_step_data in one go.<BR>
</b><BR>Private method, only for use by other parts of the question engine.<BR>
<BR>
<b>param:</b> array $rows the rows to insert.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="insert_question_attempt_step" onClick="logFunction('insert_question_attempt_step', 'datalib.php.source.html#l212')" href="datalib.php.source.html#l212">insert_question_attempt_step</a>(question_attempt_step <a href="../../_variables/step.html">$step</a>,<a href="../../_variables/questionattemptid.html">$questionattemptid</a>, <a href="../../_variables/seq.html">$seq</a>, <a href="../../_variables/context.html">$context</a>)&nbsp;&nbsp;
<a href="../../_functions/insert_question_attempt_step.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Store a {@link question_attempt_step} in the database.<BR>
</b><BR>Private method, only for use by other parts of the question engine.<BR>
<BR>
<b>param:</b> question_attempt_step $step the step to store.<br>
<b>param:</b> int $questionattemptid the question attept id this step belongs to.<br>
<b>param:</b> int $seq the sequence number of this stop.<br>
<b>param:</b> context $context the context of the owning question_usage_by_activity.<br>
<b>return:</b> array of question_attempt_step_data rows, that still need to be inserted.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="update_question_attempt_step" onClick="logFunction('update_question_attempt_step', 'datalib.php.source.html#l232')" href="datalib.php.source.html#l232">update_question_attempt_step</a>(question_attempt_step <a href="../../_variables/step.html">$step</a>,<a href="../../_variables/questionattemptid.html">$questionattemptid</a>, <a href="../../_variables/seq.html">$seq</a>, <a href="../../_variables/context.html">$context</a>)&nbsp;&nbsp;
<a href="../../_functions/update_question_attempt_step.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Update a {@link question_attempt_step} in the database.<BR>
</b><BR>Private method, only for use by other parts of the question engine.<BR>
<BR>
<b>param:</b> question_attempt_step $qa the step to store.<br>
<b>param:</b> int $questionattemptid the question attept id this step belongs to.<br>
<b>param:</b> int $seq the sequence number of this stop.<br>
<b>param:</b> context $context the context of the owning question_usage_by_activity.<br>
<b>return:</b> array of question_attempt_step_data rows, that still need to be inserted.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="insert_question_attempt_metadata" onClick="logFunction('insert_question_attempt_metadata', 'datalib.php.source.html#l255')" href="datalib.php.source.html#l255">insert_question_attempt_metadata</a>(question_attempt <a href="../../_variables/qa.html">$qa</a>, array <a href="../../_variables/names.html">$names</a>)&nbsp;&nbsp;
<a href="../../_functions/insert_question_attempt_metadata.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Store new metadata for an existing {@link question_attempt} in the database.<BR>
</b><BR>Private method, only for use by other parts of the question engine.<BR>
<BR>
<b>param:</b> question_attempt $qa the question attempt to store meta data for.<br>
<b>param:</b> array $names the names of the metadata variables to store.<br>
<b>return:</b> array of question_attempt_step_data rows, that still need to be inserted.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="update_question_attempt_metadata" onClick="logFunction('update_question_attempt_metadata', 'datalib.php.source.html#l279')" href="datalib.php.source.html#l279">update_question_attempt_metadata</a>(question_attempt <a href="../../_variables/qa.html">$qa</a>, array <a href="../../_variables/names.html">$names</a>)&nbsp;&nbsp;
<a href="../../_functions/update_question_attempt_metadata.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Updates existing metadata for an existing {@link question_attempt} in the database.<BR>
</b><BR>Private method, only for use by other parts of the question engine.<BR>
<BR>
<b>param:</b> question_attempt $qa the question attempt to store meta data for.<br>
<b>param:</b> array $names the names of the metadata variables to store.<br>
<b>return:</b> array of question_attempt_step_data rows, that still need to be inserted.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="load_question_attempt_step" onClick="logFunction('load_question_attempt_step', 'datalib.php.source.html#l297')" href="datalib.php.source.html#l297">load_question_attempt_step</a>(<a href="../../_variables/stepid.html">$stepid</a>)&nbsp;&nbsp;
<a href="../../_functions/load_question_attempt_step.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Load a {@link question_attempt_step} from the database.<BR>
</b><BR>Private method, only for use by other parts of the question engine.<BR>
<BR>
<b>param:</b> int $stepid the id of the step to load.<br>
<b>param:</b> question_attempt_step the step that was loaded.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="load_question_attempt" onClick="logFunction('load_question_attempt', 'datalib.php.source.html#l340')" href="datalib.php.source.html#l340">load_question_attempt</a>(<a href="../../_variables/questionattemptid.html">$questionattemptid</a>)&nbsp;&nbsp;
<a href="../../_functions/load_question_attempt.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Load a {@link question_attempt} from the database, including all its<BR>
steps.<BR>
</b><BR>Normally, you should use {@link question_engine::load_questions_usage_by_activity()}<BR>
but there may be rare occasions where for performance reasons, you only<BR>
wish to load one qa, in which case you may call this method.<BR>
<BR>
<b>param:</b> int $questionattemptid the id of the question attempt to load.<br>
<b>param:</b> question_attempt the question attempt that was loaded.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="load_questions_usage_by_activity" onClick="logFunction('load_questions_usage_by_activity', 'datalib.php.source.html#l403')" href="datalib.php.source.html#l403">load_questions_usage_by_activity</a>(<a href="../../_variables/qubaid.html">$qubaid</a>)&nbsp;&nbsp;
<a href="../../_functions/load_questions_usage_by_activity.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Load a {@link question_usage_by_activity} from the database, including<BR>
all its {@link question_attempt}s and all their steps.<BR>
</b><BR>You should call {@link question_engine::load_questions_usage_by_activity()}<BR>
rather than calling this method directly.<BR>
<BR>
<b>param:</b> int $qubaid the id of the usage to load.<br>
<b>param:</b> question_usage_by_activity the usage that was loaded.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="load_questions_usages_by_activity" onClick="logFunction('load_questions_usages_by_activity', 'datalib.php.source.html#l466')" href="datalib.php.source.html#l466">load_questions_usages_by_activity</a>(<a href="../../_variables/qubaids.html">$qubaids</a>)&nbsp;&nbsp;
<a href="../../_functions/load_questions_usages_by_activity.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Load all {@link question_usage_by_activity} from the database for one qubaid_condition<BR>
Include all its {@link question_attempt}s and all their steps.<BR>
</b><BR>This method may be called publicly.<BR>
<BR>
<b>param:</b> qubaid_condition $qubaids the condition that tells us which usages to load.<br>
<b>return:</b> question_usage_by_activity[] the usages that were loaded.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="load_questions_usages_latest_steps" onClick="logFunction('load_questions_usages_latest_steps', 'datalib.php.source.html#l534')" href="datalib.php.source.html#l534">load_questions_usages_latest_steps</a>(qubaid_condition <a href="../../_variables/qubaids.html">$qubaids</a>, <a href="../../_variables/slots.html">$slots</a>, <a href="../../_variables/fields.html">$fields</a> = null)&nbsp;&nbsp;
<a href="../../_functions/load_questions_usages_latest_steps.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Load information about the latest state of each question from the database.<BR>
</b><BR>This method may be called publicly.<BR>
<BR>
<b>param:</b> qubaid_condition $qubaids used to restrict which usages are included<br>
<b>param:</b> array&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$slots&nbsp;&nbsp;&nbsp;A list of slots for the questions you want to know about.<br>
<b>param:</b> string|null&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$fields<br>
<b>return:</b> array of records. See the SQL in this function to see the fields available.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="load_questions_usages_question_state_summary" onClick="logFunction('load_questions_usages_question_state_summary', 'datalib.php.source.html#l589')" href="datalib.php.source.html#l589">load_questions_usages_question_state_summary</a>(qubaid_condition <a href="../../_variables/qubaids.html">$qubaids</a>, <a href="../../_variables/slots.html">$slots</a>)&nbsp;&nbsp;
<a href="../../_functions/load_questions_usages_question_state_summary.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Load summary information about the state of each question in a group of<BR>
attempts. This is used, for example, by the quiz manual grading report,<BR>
to show how many attempts at each question need to be graded.<BR>
</b><BR>This method may be called publicly.<BR>
<BR>
<b>param:</b> qubaid_condition $qubaids used to restrict which usages are included<br>
<b>param:</b> array $slots A list of slots for the questions you want to konw about.<br>
<b>return:</b> array The array keys are slot,qestionid. The values are objects with<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="load_questions_usages_where_question_in_state" onClick="logFunction('load_questions_usages_where_question_in_state', 'datalib.php.source.html#l667')" href="datalib.php.source.html#l667">load_questions_usages_where_question_in_state</a>(qubaid_condition <a href="../../_variables/qubaids.html">$qubaids</a>, <a href="../../_variables/summarystate.html">$summarystate</a>, <a href="../../_variables/slot.html">$slot</a>, <a href="../../_variables/questionid.html">$questionid</a> = null,<a href="../../_variables/orderby.html">$orderby</a> = 'random', <a href="../../_variables/params.html">$params</a> = array()&nbsp;&nbsp;
<a href="../../_functions/load_questions_usages_where_question_in_state.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Get a list of usage ids where the question with slot $slot, and optionally<BR>
also with question id $questionid, is in summary state $summarystate. Also<BR>
return the total count of such states.<BR>
</b><BR>Only a subset of the ids can be returned by using $orderby, $limitfrom and<BR>
$limitnum. A special value 'random' can be passed as $orderby, in which case<BR>
$limitfrom is ignored.<BR>
<BR>
This method may be called publicly.<BR>
<BR>
<b>param:</b> qubaid_condition $qubaids used to restrict which usages are included<br>
<b>param:</b> int $slot The slot for the questions you want to konw about.<br>
<b>param:</b> int $questionid (optional) Only return attempts that were of this specific question.<br>
<b>param:</b> string $summarystate the summary state of interest, or 'all'.<br>
<b>param:</b> string $orderby the column to order by.<br>
<b>param:</b> array $params any params required by any of the SQL fragments.<br>
<b>param:</b> int $limitfrom implements paging of the results.<br>
<b>param:</b> int $limitnum implements paging of the results. null = all.<br>
<b>return:</b> array with two elements, an array of usage ids, and a count of the total number.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="load_average_marks" onClick="logFunction('load_average_marks', 'datalib.php.source.html#l756')" href="datalib.php.source.html#l756">load_average_marks</a>(qubaid_condition <a href="../../_variables/qubaids.html">$qubaids</a>, <a href="../../_variables/slots.html">$slots</a> = null)&nbsp;&nbsp;
<a href="../../_functions/load_average_marks.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Load the average mark, and number of attempts, for each slot in a set of<BR>
question usages..<BR>
</b><BR>This method may be called publicly.<BR>
<BR>
<b>param:</b> qubaid_condition $qubaids used to restrict which usages are included<br>
<b>param:</b> array $slots if null, load info for all quesitions, otherwise only<br>
<b>return:</b> array of objects with fields -&gt;slot, -&gt;averagefraction and -&gt;numaveraged.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="load_attempts_at_question" onClick="logFunction('load_attempts_at_question', 'datalib.php.source.html#l809')" href="datalib.php.source.html#l809">load_attempts_at_question</a>(<a href="../../_variables/questionid.html">$questionid</a>, qubaid_condition <a href="../../_variables/qubaids.html">$qubaids</a>)&nbsp;&nbsp;
<a href="../../_functions/load_attempts_at_question.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Load all the attempts at a given queston from a set of question_usages.<BR>
steps.<BR>
</b><BR>This method may be called publicly.<BR>
<BR>
<b>param:</b> int $questionid the question to load all the attempts fors.<br>
<b>param:</b> qubaid_condition $qubaids used to restrict which usages are included<br>
<b>return:</b> question_attempt[] array of question_attempts that were loaded.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="update_questions_usage_by_activity" onClick="logFunction('update_questions_usage_by_activity', 'datalib.php.source.html#l881')" href="datalib.php.source.html#l881">update_questions_usage_by_activity</a>(question_usage_by_activity <a href="../../_variables/quba.html">$quba</a>)&nbsp;&nbsp;
<a href="../../_functions/update_questions_usage_by_activity.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Update a question_usages row to refect any changes in a usage (but not<BR>
any of its question_attempts.<BR>
</b><BR>You should not call this method directly. You should use<BR>
<b>param:</b> question_usage_by_activity $quba the usage that has changed.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="update_question_attempt" onClick="logFunction('update_question_attempt', 'datalib.php.source.html#l900')" href="datalib.php.source.html#l900">update_question_attempt</a>(question_attempt <a href="../../_variables/qa.html">$qa</a>)&nbsp;&nbsp;
<a href="../../_functions/update_question_attempt.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Update a question_attempts row to refect any changes in a question_attempt<BR>
(but not any of its steps).<BR>
</b><BR>You should not call this method directly. You should use<BR>
<b>param:</b> question_attempt $qa the question attempt that has changed.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="delete_questions_usage_by_activities" onClick="logFunction('delete_questions_usage_by_activities', 'datalib.php.source.html#l926')" href="datalib.php.source.html#l926">delete_questions_usage_by_activities</a>(qubaid_condition <a href="../../_variables/qubaids.html">$qubaids</a>)&nbsp;&nbsp;
<a href="../../_functions/delete_questions_usage_by_activities.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Delete a question_usage_by_activity and all its associated<BR>
</b><BR>You should not call this method directly. You should use<BR>
<b>param:</b> qubaid_condition $qubaids identifies which question useages to delete.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="delete_usage_records_for_mysql" onClick="logFunction('delete_usage_records_for_mysql', 'datalib.php.source.html#l976')" href="datalib.php.source.html#l976">delete_usage_records_for_mysql</a>(qubaid_condition <a href="../../_variables/qubaids.html">$qubaids</a>)&nbsp;&nbsp;
<a href="../../_functions/delete_usage_records_for_mysql.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>This function is a work-around for poor MySQL performance with<BR>
DELETE FROM x WHERE id IN (SELECT ...). We have to use a non-standard<BR>
syntax to get good performance. See MDL-29520.<BR>
</b><BR><b>param:</b> qubaid_condition $qubaids identifies which question useages to delete.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="delete_steps" onClick="logFunction('delete_steps', 'datalib.php.source.html#l1003')" href="datalib.php.source.html#l1003">delete_steps</a>(<a href="../../_variables/stepids.html">$stepids</a>, <a href="../../_variables/context.html">$context</a>)&nbsp;&nbsp;
<a href="../../_functions/delete_steps.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Delete all the steps for a question attempt.<BR>
</b><BR>Private method, only for use by other parts of the question engine.<BR>
<BR>
<b>param:</b> int $qaids question_attempt id.<br>
<b>param:</b> context $context the context that the $quba belongs to.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="delete_response_files" onClick="logFunction('delete_response_files', 'datalib.php.source.html#l1025')" href="datalib.php.source.html#l1025">delete_response_files</a>(<a href="../../_variables/contextid.html">$contextid</a>, <a href="../../_variables/itemidstest.html">$itemidstest</a>, <a href="../../_variables/params.html">$params</a>)&nbsp;&nbsp;
<a href="../../_functions/delete_response_files.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Delete all the files belonging to the response variables in the gives<BR>
question attempt steps.<BR>
</b><BR><b>param:</b> int $contextid the context these attempts belong to.<br>
<b>param:</b> string $itemidstest a bit of SQL that can be used in a<br>
<b>param:</b> array $params any query parameters used in $itemidstest.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="delete_previews" onClick="logFunction('delete_previews', 'datalib.php.source.html#l1041')" href="datalib.php.source.html#l1041">delete_previews</a>(<a href="../../_variables/questionid.html">$questionid</a>)&nbsp;&nbsp;
<a href="../../_functions/delete_previews.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Delete all the previews for a given question.<BR>
</b><BR>Private method, only for use by other parts of the question engine.<BR>
<BR>
<b>param:</b> int $questionid question id.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="update_question_attempt_flag" onClick="logFunction('update_question_attempt_flag', 'datalib.php.source.html#l1061')" href="datalib.php.source.html#l1061">update_question_attempt_flag</a>(<a href="../../_variables/qubaid.html">$qubaid</a>, <a href="../../_variables/questionid.html">$questionid</a>, <a href="../../_variables/qaid.html">$qaid</a>, <a href="../../_variables/slot.html">$slot</a>, <a href="../../_variables/newstate.html">$newstate</a>)&nbsp;&nbsp;
<a href="../../_functions/update_question_attempt_flag.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Update the flagged state of a question in the database.<BR>
</b><BR>You should call {@link question_engine::update_flag()()}<BR>
rather than calling this method directly.<BR>
<BR>
<b>param:</b> int $qubaid the question usage id.<br>
<b>param:</b> int $questionid the question id.<br>
<b>param:</b> int $sessionid the question_attempt id.<br>
<b>param:</b> bool $newstate the new state of the flag. true = flagged.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="full_states_to_summary_state_sql" onClick="logFunction('full_states_to_summary_state_sql', 'datalib.php.source.html#l1081')" href="datalib.php.source.html#l1081">full_states_to_summary_state_sql</a>()&nbsp;&nbsp;
<a href="../../_functions/full_states_to_summary_state_sql.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Get all the WHEN 'x' THEN 'y' terms needed to convert the question_attempt_steps.state<BR>
column to a summary state. Use this like<BR>
CASE qas.state {$this-&gt;full_states_to_summary_state_sql()} END AS summarystate,<BR>
</b><BR><b>param:</b> string SQL fragment.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="in_summary_state_test" onClick="logFunction('in_summary_state_test', 'datalib.php.source.html#l1095')" href="datalib.php.source.html#l1095">in_summary_state_test</a>(<a href="../../_variables/summarystate.html">$summarystate</a>, <a href="../../_variables/equal.html">$equal</a> = true, <a href="../../_variables/prefix.html">$prefix</a> = 'summarystates')&nbsp;&nbsp;
<a href="../../_functions/in_summary_state_test.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Get the SQL needed to test that question_attempt_steps.state is in a<BR>
state corresponding to $summarystate.<BR>
</b><BR>This method may be called publicly.<BR>
<BR>
<b>param:</b> string $summarystate one of<br>
<b>param:</b> bool $equal if false, do a NOT IN test. Default true.<br>
<b>return:</b> string SQL fragment.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="set_max_mark_in_attempts" onClick="logFunction('set_max_mark_in_attempts', 'datalib.php.source.html#l1112')" href="datalib.php.source.html#l1112">set_max_mark_in_attempts</a>(qubaid_condition <a href="../../_variables/qubaids.html">$qubaids</a>, <a href="../../_variables/slot.html">$slot</a>, <a href="../../_variables/newmaxmark.html">$newmaxmark</a>)&nbsp;&nbsp;
<a href="../../_functions/set_max_mark_in_attempts.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Change the maxmark for the question_attempt with number in usage $slot<BR>
for all the specified question_attempts.<BR>
</b><BR>You should call {@link question_engine::set_max_mark_in_attempts()}<BR>
rather than calling this method directly.<BR>
<BR>
<b>param:</b> qubaid_condition $qubaids Selects which usages are updated.<br>
<b>param:</b> int $slot the number is usage to affect.<br>
<b>param:</b> number $newmaxmark the new max mark to set.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="sum_usage_marks_subquery" onClick="logFunction('sum_usage_marks_subquery', 'datalib.php.source.html#l1143')" href="datalib.php.source.html#l1143">sum_usage_marks_subquery</a>(<a href="../../_variables/qubaid.html">$qubaid</a>)&nbsp;&nbsp;
<a href="../../_functions/sum_usage_marks_subquery.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Return a subquery that computes the sum of the marks for all the questions<BR>
in a usage. Which useage to compute the sum for is controlled bu the $qubaid<BR>
parameter.<BR>
</b><BR>See {@link quiz_update_all_attempt_sumgrades()} for an example of the usage of<BR>
this method.<BR>
<BR>
This method may be called publicly.<BR>
<BR>
<b>param:</b> string $qubaid SQL fragment that controls which usage is summed.<br>
<b>return:</b> string SQL code for the subquery.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="question_attempt_latest_state_view" onClick="logFunction('question_attempt_latest_state_view', 'datalib.php.source.html#l1178')" href="datalib.php.source.html#l1178">question_attempt_latest_state_view</a>(<a href="../../_variables/alias.html">$alias</a>, qubaid_condition <a href="../../_variables/qubaids.html">$qubaids</a>)&nbsp;&nbsp;
<a href="../../_functions/question_attempt_latest_state_view.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Get a subquery that returns the latest step of every qa in some qubas.<BR>
Currently, this is only used by the quiz reports. See<BR>
{@link quiz_attempts_report_table::add_latest_state_join()}.<BR>
</b><BR>This method may be called publicly.<BR>
<BR>
<b>param:</b> string $alias alias to use for this inline-view.<br>
<b>param:</b> qubaid_condition $qubaids restriction on which question_usages we<br>
<b>return:</b> array with two elements, the SQL fragment and any params requried.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="latest_step_for_qa_subquery" onClick="logFunction('latest_step_for_qa_subquery', 'datalib.php.source.html#l1220')" href="datalib.php.source.html#l1220">latest_step_for_qa_subquery</a>(<a href="../../_variables/questionattemptid.html">$questionattemptid</a> = 'qa.id')&nbsp;&nbsp;
<a href="../../_functions/latest_step_for_qa_subquery.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><i>No description</i></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="questions_in_use" onClick="logFunction('questions_in_use', 'datalib.php.source.html#l1228')" href="datalib.php.source.html#l1228">questions_in_use</a>(array <a href="../../_variables/questionids.html">$questionids</a>, qubaid_condition <a href="../../_variables/qubaids.html">$qubaids</a>)&nbsp;&nbsp;
<a href="../../_functions/questions_in_use.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Are any of these questions are currently in use?<BR>
</b><BR>You should call {@link question_engine::questions_in_use()}<BR>
rather than calling this method directly.<BR>
<BR>
<b>param:</b> array $questionids of question ids.<br>
<b>param:</b> qubaid_condition $qubaids ids of the usages to consider.<br>
<b>return:</b> bool whether any of these questions are being used by any of<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="load_used_variants" onClick="logFunction('load_used_variants', 'datalib.php.source.html#l1246')" href="datalib.php.source.html#l1246">load_used_variants</a>(array <a href="../../_variables/questionids.html">$questionids</a>, qubaid_condition <a href="../../_variables/qubaids.html">$qubaids</a>)&nbsp;&nbsp;
<a href="../../_functions/load_used_variants.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Get the number of times each variant has been used for each question in a list<BR>
in a set of usages.<BR>
</b><BR><b>param:</b> array $questionids of question ids.<br>
<b>param:</b> qubaid_condition $qubaids ids of the usages to consider.<br>
<b>return:</b> array questionid =&gt; variant number =&gt; num uses.<br>
</td></tr></table>

<br>
</div>
</div>
<div class="details-classinfo">
<p class="details-classtitle">Class: <a name="question_engine_unit_of_work"><b>question_engine_unit_of_work</b></a>&nbsp;&nbsp;- <a href="../../_classes/question_engine_unit_of_work.html"><small>X-Ref</small></a>
</p>
<b>Implementation of the unit of work pattern for the question engine.<BR>
</b><br>
See http://martinfowler.com/eaaCatalog/unitOfWork.html. This tracks all the<BR>
changes to a {@link question_usage_by_activity}, and its constituent parts,<BR>
so that the changes can be saved to the database when {@link save()} is called.<BR>
<BR>
<div class="inset"><table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="__construct" onClick="logFunction('__construct', 'datalib.php.source.html#l1331')" href="datalib.php.source.html#l1331">__construct</a>(question_usage_by_activity <a href="../../_variables/quba.html">$quba</a>)&nbsp;&nbsp;
<a href="../../_functions/__construct.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Constructor.<BR>
</b><BR><b>param:</b> question_usage_by_activity $quba the usage to track.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="notify_modified" onClick="logFunction('notify_modified', 'datalib.php.source.html#l1339')" href="datalib.php.source.html#l1339">notify_modified</a>()&nbsp;&nbsp;
<a href="../../_functions/notify_modified.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><i>No description</i></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="notify_attempt_added" onClick="logFunction('notify_attempt_added', 'datalib.php.source.html#l1343')" href="datalib.php.source.html#l1343">notify_attempt_added</a>(question_attempt <a href="../../_variables/qa.html">$qa</a>)&nbsp;&nbsp;
<a href="../../_functions/notify_attempt_added.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><i>No description</i></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="notify_attempt_modified" onClick="logFunction('notify_attempt_modified', 'datalib.php.source.html#l1347')" href="datalib.php.source.html#l1347">notify_attempt_modified</a>(question_attempt <a href="../../_variables/qa.html">$qa</a>)&nbsp;&nbsp;
<a href="../../_functions/notify_attempt_modified.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><i>No description</i></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="notify_attempt_moved" onClick="logFunction('notify_attempt_moved', 'datalib.php.source.html#l1354')" href="datalib.php.source.html#l1354">notify_attempt_moved</a>(question_attempt <a href="../../_variables/qa.html">$qa</a>, <a href="../../_variables/oldslot.html">$oldslot</a>)&nbsp;&nbsp;
<a href="../../_functions/notify_attempt_moved.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><i>No description</i></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="notify_step_added" onClick="logFunction('notify_step_added', 'datalib.php.source.html#l1378')" href="datalib.php.source.html#l1378">notify_step_added</a>(question_attempt_step <a href="../../_variables/step.html">$step</a>, question_attempt <a href="../../_variables/qa.html">$qa</a>, <a href="../../_variables/seq.html">$seq</a>)&nbsp;&nbsp;
<a href="../../_functions/notify_step_added.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><i>No description</i></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="notify_step_modified" onClick="logFunction('notify_step_modified', 'datalib.php.source.html#l1409')" href="datalib.php.source.html#l1409">notify_step_modified</a>(question_attempt_step <a href="../../_variables/step.html">$step</a>, question_attempt <a href="../../_variables/qa.html">$qa</a>, <a href="../../_variables/seq.html">$seq</a>)&nbsp;&nbsp;
<a href="../../_functions/notify_step_modified.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><i>No description</i></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="notify_step_deleted" onClick="logFunction('notify_step_deleted', 'datalib.php.source.html#l1430')" href="datalib.php.source.html#l1430">notify_step_deleted</a>(question_attempt_step <a href="../../_variables/step.html">$step</a>, question_attempt <a href="../../_variables/qa.html">$qa</a>)&nbsp;&nbsp;
<a href="../../_functions/notify_step_deleted.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><i>No description</i></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="notify_metadata_added" onClick="logFunction('notify_metadata_added', 'datalib.php.source.html#l1452')" href="datalib.php.source.html#l1452">notify_metadata_added</a>(question_attempt <a href="../../_variables/qa.html">$qa</a>, <a href="../../_variables/name.html">$name</a>)&nbsp;&nbsp;
<a href="../../_functions/notify_metadata_added.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><i>No description</i></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="notify_metadata_modified" onClick="logFunction('notify_metadata_modified', 'datalib.php.source.html#l1468')" href="datalib.php.source.html#l1468">notify_metadata_modified</a>(question_attempt <a href="../../_variables/qa.html">$qa</a>, <a href="../../_variables/name.html">$name</a>)&nbsp;&nbsp;
<a href="../../_functions/notify_metadata_modified.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><i>No description</i></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="is_step_added" onClick="logFunction('is_step_added', 'datalib.php.source.html#l1493')" href="datalib.php.source.html#l1493">is_step_added</a>(question_attempt_step <a href="../../_variables/step.html">$step</a>)&nbsp;&nbsp;
<a href="../../_functions/is_step_added.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b></b><BR><b>param:</b> question_attempt_step $step a step<br>
<b>return:</b> int|false if the step is in the list of steps to be added, return<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="is_step_modified" onClick="logFunction('is_step_modified', 'datalib.php.source.html#l1508')" href="datalib.php.source.html#l1508">is_step_modified</a>(question_attempt_step <a href="../../_variables/step.html">$step</a>)&nbsp;&nbsp;
<a href="../../_functions/is_step_modified.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b></b><BR><b>param:</b> question_attempt_step $step a step<br>
<b>return:</b> int|false if the step is in the list of steps to be modified, return<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="is_step_deleted" onClick="logFunction('is_step_deleted', 'datalib.php.source.html#l1522')" href="datalib.php.source.html#l1522">is_step_deleted</a>(question_attempt_step <a href="../../_variables/step.html">$step</a>)&nbsp;&nbsp;
<a href="../../_functions/is_step_deleted.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b></b><BR><b>param:</b> question_attempt_step $step a step<br>
<b>return:</b> bool whether the step is in the list of steps to be deleted.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="save" onClick="logFunction('save', 'datalib.php.source.html#l1531')" href="datalib.php.source.html#l1531">save</a>(question_engine_data_mapper <a href="../../_variables/dm.html">$dm</a>)&nbsp;&nbsp;
<a href="../../_functions/save.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Write all the changes we have recorded to the database.<BR>
</b><BR><b>param:</b> question_engine_data_mapper $dm the mapper to use to update the database.<br>
</td></tr></table>

<br>
</div>
</div>
<div class="details-classinfo">
<p class="details-classtitle">Interface: <a name="question_response_files"><b>question_response_files</b></a>&nbsp;&nbsp;- <a href="../../_classes/question_response_files.html"><small>X-Ref</small></a>
</p>
<b>The interface implemented by {@link question_file_saver} and {@link question_file_loader}.<BR>
</b><br>
<div class="inset"><table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_files" onClick="logFunction('get_files', 'datalib.php.source.html#l1599')" href="datalib.php.source.html#l1599">get_files</a>()&nbsp;&nbsp;
<a href="../../_functions/get_files.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Get the files that were submitted.<BR>
</b><BR><b>return:</b> array of stored_files objects.<br>
</td></tr></table>

<br>
</div>
</div>
<div class="details-classinfo">
<p class="details-classtitle">Class: <a name="question_file_saver"><b>question_file_saver</b></a>&nbsp;&nbsp;- <a href="../../_classes/question_file_saver.html"><small>X-Ref</small></a>
</p>
<b>This class represents the promise to save some files from a particular draft<BR>
file area into a particular file area. It is used beause the necessary<BR>
information about what to save is to hand in the<BR>
{@link question_attempt::process_response_files()} method, but we don't know<BR>
if this question attempt will actually be saved in the database until later,<BR>
when the {@link question_engine_unit_of_work} is saved, if it is.<BR>
</b><br>
<div class="inset"><table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="__construct" onClick="logFunction('__construct', 'datalib.php.source.html#l1632')" href="datalib.php.source.html#l1632">__construct</a>(<a href="../../_variables/draftitemid.html">$draftitemid</a>, <a href="../../_variables/component.html">$component</a>, <a href="../../_variables/filearea.html">$filearea</a>, <a href="../../_variables/text.html">$text</a> = null)&nbsp;&nbsp;
<a href="../../_functions/__construct.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Constuctor.<BR>
</b><BR><b>param:</b> int $draftitemid the draft area to save the files from.<br>
<b>param:</b> string $component the component for the file area to save into.<br>
<b>param:</b> string $filearea the name of the file area to save into.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="compute_value" onClick="logFunction('compute_value', 'datalib.php.source.html#l1645')" href="datalib.php.source.html#l1645">compute_value</a>(<a href="../../_variables/draftitemid.html">$draftitemid</a>, <a href="../../_variables/text.html">$text</a>)&nbsp;&nbsp;
<a href="../../_functions/compute_value.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Compute the value that should be stored in the question_attempt_step_data<BR>
table. Contains a hash that (almost) uniquely encodes all the files.<BR>
</b><BR><b>param:</b> int $draftitemid the draft file area itemid.<br>
<b>param:</b> string $text optional content containing file links.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="__tostring" onClick="logFunction('__tostring', 'datalib.php.source.html#l1687')" href="datalib.php.source.html#l1687">__toString</a>()&nbsp;&nbsp;
<a href="../../_functions/__tostring.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><i>No description</i></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="save_files" onClick="logFunction('save_files', 'datalib.php.source.html#l1691')" href="datalib.php.source.html#l1691">save_files</a>(<a href="../../_variables/itemid.html">$itemid</a>, <a href="../../_variables/context.html">$context</a>)&nbsp;&nbsp;
<a href="../../_functions/save_files.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Actually save the files.<BR>
</b><BR><b>param:</b> integer $itemid the item id for the file area to save into.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_files" onClick="logFunction('get_files', 'datalib.php.source.html#l1700')" href="datalib.php.source.html#l1700">get_files</a>()&nbsp;&nbsp;
<a href="../../_functions/get_files.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Get the files that were submitted.<BR>
</b><BR><b>return:</b> array of stored_files objects.<br>
</td></tr></table>

<br>
</div>
</div>
<div class="details-classinfo">
<p class="details-classtitle">Class: <a name="question_file_loader"><b>question_file_loader</b></a>&nbsp;&nbsp;- <a href="../../_classes/question_file_loader.html"><small>X-Ref</small></a>
</p>
<b>This class is the mirror image of {@link question_file_saver}. It allows<BR>
files to be accessed again later (e.g. when re-grading) using that same<BR>
API as when doing the original grading.<BR>
</b><br>
<div class="inset"><table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="__construct" onClick="logFunction('__construct', 'datalib.php.source.html#l1740')" href="datalib.php.source.html#l1740">__construct</a>(question_attempt_step <a href="../../_variables/step.html">$step</a>, <a href="../../_variables/name.html">$name</a>, <a href="../../_variables/value.html">$value</a>, <a href="../../_variables/contextid.html">$contextid</a>)&nbsp;&nbsp;
<a href="../../_functions/__construct.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Constuctor.<BR>
</b><BR><b>param:</b> question_attempt_step $step the step that these files belong to.<br>
<b>param:</b> string $name string the field name for these files - which is used to construct the file area name.<br>
<b>param:</b> string $value the value to stored in the question_attempt_step_data to<br>
<b>param:</b> int $contextid the context id that the files belong to.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="__tostring" onClick="logFunction('__tostring', 'datalib.php.source.html#l1755')" href="datalib.php.source.html#l1755">__toString</a>()&nbsp;&nbsp;
<a href="../../_functions/__tostring.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><i>No description</i></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_files" onClick="logFunction('get_files', 'datalib.php.source.html#l1759')" href="datalib.php.source.html#l1759">get_files</a>()&nbsp;&nbsp;
<a href="../../_functions/get_files.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Get the files that were submitted.<BR>
</b><BR><b>return:</b> array of stored_files objects.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_question_file_saver" onClick="logFunction('get_question_file_saver', 'datalib.php.source.html#l1767')" href="datalib.php.source.html#l1767">get_question_file_saver</a>()&nbsp;&nbsp;
<a href="../../_functions/get_question_file_saver.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Copy these files into a draft area, and return the corresponding<BR>
{@link question_file_saver} that can save them again.<BR>
</b><BR>This is used by {@link question_attempt::start_based_on()}, which is used<BR>
(for example) by the quizzes 'Each attempt builds on last' feature.<BR>
<BR>
<b>return:</b> question_file_saver that can re-save these files again.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="get_hash_code" onClick="logFunction('get_hash_code', 'datalib.php.source.html#l1851')" href="datalib.php.source.html#l1851">get_hash_code</a>()&nbsp;&nbsp;
<a href="../../_functions/get_hash_code.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b></b><BR><b>return:</b> string 40-character hash code that uniquely identifies the combination of properties and class name of this qubaid<br>
</td></tr></table>

<br>
</div>
</div>
<div class="details-classinfo">
<p class="details-classtitle">Class: <a name="qubaid_list"><b>qubaid_list</b></a>&nbsp;&nbsp;- <a href="../../_classes/qubaid_list.html"><small>X-Ref</small></a>
</p>
<b>This class represents a restriction on the set of question_usage ids to include<BR>
in a larger database query based on an explicit list of ids.<BR>
</b><br>
<div class="inset"><table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="__construct" onClick="logFunction('__construct', 'datalib.php.source.html#l1870')" href="datalib.php.source.html#l1870">__construct</a>(array <a href="../../_variables/qubaids.html">$qubaids</a>)&nbsp;&nbsp;
<a href="../../_functions/__construct.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Constructor.<BR>
</b><BR><b>param:</b> array $qubaids of question usage ids.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="from_question_attempts" onClick="logFunction('from_question_attempts', 'datalib.php.source.html#l1878')" href="datalib.php.source.html#l1878">from_question_attempts</a>(<a href="../../_variables/alias.html">$alias</a>)&nbsp;&nbsp;
<a href="../../_functions/from_question_attempts.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><i>No description</i></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="where" onClick="logFunction('where', 'datalib.php.source.html#l1883')" href="datalib.php.source.html#l1883">where</a>()&nbsp;&nbsp;
<a href="../../_functions/where.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><i>No description</i></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="from_where_params" onClick="logFunction('from_where_params', 'datalib.php.source.html#l1897')" href="datalib.php.source.html#l1897">from_where_params</a>()&nbsp;&nbsp;
<a href="../../_functions/from_where_params.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><i>No description</i></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="usage_id_in" onClick="logFunction('usage_id_in', 'datalib.php.source.html#l1901')" href="datalib.php.source.html#l1901">usage_id_in</a>()&nbsp;&nbsp;
<a href="../../_functions/usage_id_in.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><i>No description</i></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="usage_id_in_params" onClick="logFunction('usage_id_in_params', 'datalib.php.source.html#l1913')" href="datalib.php.source.html#l1913">usage_id_in_params</a>()&nbsp;&nbsp;
<a href="../../_functions/usage_id_in_params.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><i>No description</i></td></tr></table>

<br>
</div>
</div>
<div class="details-classinfo">
<p class="details-classtitle">Class: <a name="qubaid_join"><b>qubaid_join</b></a>&nbsp;&nbsp;- <a href="../../_classes/qubaid_join.html"><small>X-Ref</small></a>
</p>
<b>This class represents a restriction on the set of question_usage ids to include<BR>
in a larger database query based on JOINing to some other tables.<BR>
</b><br>
The general form of the query is something like<BR>
<BR>
SELECT qa.id, qa.maxmark<BR>
FROM $from<BR>
JOIN {question_attempts} qa ON qa.questionusageid = $usageidcolumn<BR>
WHERE $where AND qa.slot = 1<BR>
<BR>
where $from, $usageidcolumn and $where are the arguments to the constructor.<BR>
<BR>
<div class="inset"><table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="__construct" onClick="logFunction('__construct', 'datalib.php.source.html#l1941')" href="datalib.php.source.html#l1941">__construct</a>(<a href="../../_variables/from.html">$from</a>, <a href="../../_variables/usageidcolumn.html">$usageidcolumn</a>, <a href="../../_variables/where.html">$where</a> = '', <a href="../../_variables/params.html">$params</a> = array()&nbsp;&nbsp;
<a href="../../_functions/__construct.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><b>Constructor. The meaning of the arguments is explained in the class comment.<BR>
</b><BR><b>param:</b> string $from SQL fragemnt to go in the FROM clause.<br>
<b>param:</b> string $usageidcolumn the column in $from that should be<br>
<b>param:</b> string $where SQL fragment to go in the where clause.<br>
<b>param:</b> array $params required by the SQL. You must use named parameters.<br>
</td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="from_question_attempts" onClick="logFunction('from_question_attempts', 'datalib.php.source.html#l1959')" href="datalib.php.source.html#l1959">from_question_attempts</a>(<a href="../../_variables/alias.html">$alias</a>)&nbsp;&nbsp;
<a href="../../_functions/from_question_attempts.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><i>No description</i></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="where" onClick="logFunction('where', 'datalib.php.source.html#l1965')" href="datalib.php.source.html#l1965">where</a>()&nbsp;&nbsp;
<a href="../../_functions/where.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><i>No description</i></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="from_where_params" onClick="logFunction('from_where_params', 'datalib.php.source.html#l1969')" href="datalib.php.source.html#l1969">from_where_params</a>()&nbsp;&nbsp;
<a href="../../_functions/from_where_params.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><i>No description</i></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="usage_id_in" onClick="logFunction('usage_id_in', 'datalib.php.source.html#l1973')" href="datalib.php.source.html#l1973">usage_id_in</a>()&nbsp;&nbsp;
<a href="../../_functions/usage_id_in.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><i>No description</i></td></tr></table>

<br>
<table border="0" width="80%" class="funcinfo"><tr class="funcinfo-title"><td>
<a name="usage_id_in_params" onClick="logFunction('usage_id_in_params', 'datalib.php.source.html#l1977')" href="datalib.php.source.html#l1977">usage_id_in_params</a>()&nbsp;&nbsp;
<a href="../../_functions/usage_id_in_params.html"><small>X-Ref</small></a>
</td></tr><tr class="funcinfo-body"><td><i>No description</i></td></tr></table>

<br>
</div>
</div>

</div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
