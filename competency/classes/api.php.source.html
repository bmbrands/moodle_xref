<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /competency/classes/api.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='competency/classes';
filename='api.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/competency/classes/</a> -> <a href="api.php.html">api.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="api.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="api.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment">/**</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * Class for loading/storing competency frameworks from the DB.</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * @package    core_competency</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @copyright  2015 Damyon Wiese</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> */</span>
<a name="l24"><span class="linenum">  24</span></a>  namespace core_competency;
<a name="l25"><span class="linenum">  25</span></a>  <a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('MOODLE_INTERNAL')" href="../../_constants/MOODLE_INTERNAL.html" onMouseOver="constPopup(event,'MOODLE_INTERNAL')">MOODLE_INTERNAL</a>') || die();
<a name="l26"><span class="linenum">  26</span></a>  
<a name="l27"><span class="linenum">  27</span></a>  use stdClass;
<a name="l28"><span class="linenum">  28</span></a>  use cm_info;
<a name="l29"><span class="linenum">  29</span></a>  use context;
<a name="l30"><span class="linenum">  30</span></a>  use context_helper;
<a name="l31"><span class="linenum">  31</span></a>  use context_system;
<a name="l32"><span class="linenum">  32</span></a>  use context_course;
<a name="l33"><span class="linenum">  33</span></a>  use context_module;
<a name="l34"><span class="linenum">  34</span></a>  use context_user;
<a name="l35"><span class="linenum">  35</span></a>  use coding_exception;
<a name="l36"><span class="linenum">  36</span></a>  use require_login_exception;
<a name="l37"><span class="linenum">  37</span></a>  use moodle_exception;
<a name="l38"><span class="linenum">  38</span></a>  use moodle_url;
<a name="l39"><span class="linenum">  39</span></a>  use required_capability_exception;
<a name="l40"><span class="linenum">  40</span></a>  
<a name="l41"><span class="linenum">  41</span></a>  <span class="comment">/**</span>
<a name="l42"><span class="linenum">  42</span></a>  <span class="comment"> * Class for doing things with competency frameworks.</span>
<a name="l43"><span class="linenum">  43</span></a>  <span class="comment"> *</span>
<a name="l44"><span class="linenum">  44</span></a>  <span class="comment"> * @copyright  2015 Damyon Wiese</span>
<a name="l45"><span class="linenum">  45</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l46"><span class="linenum">  46</span></a>  <span class="comment"> */</span>
<a name="l47"><span class="linenum">  47</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('api')" href="../../_classes/api.html" onMouseOver="classPopup(event,'api')">api</a> {
<a name="l48"><span class="linenum">  48</span></a>  
<a name="l49"><span class="linenum">  49</span></a>      <span class="comment">/**</span>
<a name="l50"><span class="linenum">  50</span></a>  <span class="comment">     * Returns whether competencies are enabled.</span>
<a name="l51"><span class="linenum">  51</span></a>  <span class="comment">     *</span>
<a name="l52"><span class="linenum">  52</span></a>  <span class="comment">     * This method should never do more than checking the config setting, the reason</span>
<a name="l53"><span class="linenum">  53</span></a>  <span class="comment">     * being that some other code could be checking the config value directly</span>
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment">     * to avoid having to load this entire file into memory.</span>
<a name="l55"><span class="linenum">  55</span></a>  <span class="comment">     *</span>
<a name="l56"><span class="linenum">  56</span></a>  <span class="comment">     * @return boolean True when enabled.</span>
<a name="l57"><span class="linenum">  57</span></a>  <span class="comment">     */</span>
<a name="l58"><span class="linenum">  58</span></a>      public static function <a class="function" onClick="logFunction('is_enabled')" href="../../_functions/is_enabled.html" onMouseOver="funcPopup(event,'is_enabled')">is_enabled</a>() {
<a name="l59"><span class="linenum">  59</span></a>          return <a class="function" onClick="logFunction('get_config')" href="../../_functions/get_config.html" onMouseOver="funcPopup(event,'get_config')">get_config</a>('core_competency', 'enabled');
<a name="l60"><span class="linenum">  60</span></a>      }
<a name="l61"><span class="linenum">  61</span></a>  
<a name="l62"><span class="linenum">  62</span></a>      <span class="comment">/**</span>
<a name="l63"><span class="linenum">  63</span></a>  <span class="comment">     * Throws an exception if competencies are not enabled.</span>
<a name="l64"><span class="linenum">  64</span></a>  <span class="comment">     *</span>
<a name="l65"><span class="linenum">  65</span></a>  <span class="comment">     * @return void</span>
<a name="l66"><span class="linenum">  66</span></a>  <span class="comment">     * @throws moodle_exception</span>
<a name="l67"><span class="linenum">  67</span></a>  <span class="comment">     */</span>
<a name="l68"><span class="linenum">  68</span></a>      public static function <a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>() {
<a name="l69"><span class="linenum">  69</span></a>          if (!static::<a class="function" onClick="logFunction('is_enabled')" href="../../_functions/is_enabled.html" onMouseOver="funcPopup(event,'is_enabled')">is_enabled</a>()) {
<a name="l70"><span class="linenum">  70</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('competenciesarenotenabled', 'core_competency');
<a name="l71"><span class="linenum">  71</span></a>          }
<a name="l72"><span class="linenum">  72</span></a>      }
<a name="l73"><span class="linenum">  73</span></a>  
<a name="l74"><span class="linenum">  74</span></a>      <span class="comment">/**</span>
<a name="l75"><span class="linenum">  75</span></a>  <span class="comment">     * Checks whether a scale is used anywhere in the plugin.</span>
<a name="l76"><span class="linenum">  76</span></a>  <span class="comment">     *</span>
<a name="l77"><span class="linenum">  77</span></a>  <span class="comment">     * This public API has two exceptions:</span>
<a name="l78"><span class="linenum">  78</span></a>  <span class="comment">     * - It MUST NOT perform any capability checks.</span>
<a name="l79"><span class="linenum">  79</span></a>  <span class="comment">     * - It MUST ignore whether competencies are enabled or not ({@link self::is_enabled()}).</span>
<a name="l80"><span class="linenum">  80</span></a>  <span class="comment">     *</span>
<a name="l81"><span class="linenum">  81</span></a>  <span class="comment">     * @param int $scaleid The scale ID.</span>
<a name="l82"><span class="linenum">  82</span></a>  <span class="comment">     * @return bool</span>
<a name="l83"><span class="linenum">  83</span></a>  <span class="comment">     */</span>
<a name="l84"><span class="linenum">  84</span></a>      public static function <a class="function" onClick="logFunction('is_scale_used_anywhere')" href="../../_functions/is_scale_used_anywhere.html" onMouseOver="funcPopup(event,'is_scale_used_anywhere')">is_scale_used_anywhere</a>(<a class="var it973" onMouseOver="hilite(973)" onMouseOut="lolite()" onClick="logVariable('scaleid')" href="../../_variables/scaleid.html">$scaleid</a>) {
<a name="l85"><span class="linenum">  85</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l86"><span class="linenum">  86</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;SELECT s.id
<a name="l87"><span class="linenum">  87</span></a>                    FROM {scale} s
<a name="l88"><span class="linenum">  88</span></a>               LEFT JOIN {&quot; . <a class="class" onClick="logClass('competency_framework')" href="../../_classes/competency_framework.html" onMouseOver="classPopup(event,'competency_framework')">competency_framework</a>::TABLE .&quot;} f
<a name="l89"><span class="linenum">  89</span></a>                      ON f.scaleid = :scaleid1
<a name="l90"><span class="linenum">  90</span></a>               LEFT JOIN {&quot; . <a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>::TABLE .&quot;} c
<a name="l91"><span class="linenum">  91</span></a>                      ON c.scaleid = :scaleid2
<a name="l92"><span class="linenum">  92</span></a>                   WHERE f.id IS NOT NULL
<a name="l93"><span class="linenum">  93</span></a>                      OR c.id IS NOT NULL&quot;;
<a name="l94"><span class="linenum">  94</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists_sql')" href="../../_functions/record_exists_sql.html" onMouseOver="funcPopup(event,'record_exists_sql')">record_exists_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, ['scaleid1' =&gt; <a class="var it973" onMouseOver="hilite(973)" onMouseOut="lolite()" onClick="logVariable('scaleid')" href="../../_variables/scaleid.html">$scaleid</a>, 'scaleid2' =&gt; <a class="var it973" onMouseOver="hilite(973)" onMouseOut="lolite()" onClick="logVariable('scaleid')" href="../../_variables/scaleid.html">$scaleid</a>]);
<a name="l95"><span class="linenum">  95</span></a>      }
<a name="l96"><span class="linenum">  96</span></a>  
<a name="l97"><span class="linenum">  97</span></a>      <span class="comment">/**</span>
<a name="l98"><span class="linenum">  98</span></a>  <span class="comment">     * Validate if current user have acces to the course_module if hidden.</span>
<a name="l99"><span class="linenum">  99</span></a>  <span class="comment">     *</span>
<a name="l100"><span class="linenum"> 100</span></a>  <span class="comment">     * @param mixed $cmmixed The cm_info class, course module record or its ID.</span>
<a name="l101"><span class="linenum"> 101</span></a>  <span class="comment">     * @param bool $throwexception Throw an exception or not.</span>
<a name="l102"><span class="linenum"> 102</span></a>  <span class="comment">     * @return bool</span>
<a name="l103"><span class="linenum"> 103</span></a>  <span class="comment">     */</span>
<a name="l104"><span class="linenum"> 104</span></a>      protected static function <a class="function" onClick="logFunction('validate_course_module')" href="../../_functions/validate_course_module.html" onMouseOver="funcPopup(event,'validate_course_module')">validate_course_module</a>(<a class="var it30417" onMouseOver="hilite(30417)" onMouseOut="lolite()" onClick="logVariable('cmmixed')" href="../../_variables/cmmixed.html">$cmmixed</a>, <a class="var it30418" onMouseOver="hilite(30418)" onMouseOut="lolite()" onClick="logVariable('throwexception')" href="../../_variables/throwexception.html">$throwexception</a> = true) {
<a name="l105"><span class="linenum"> 105</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="var it30417" onMouseOver="hilite(30417)" onMouseOut="lolite()" onClick="logVariable('cmmixed')" href="../../_variables/cmmixed.html">$cmmixed</a>;
<a name="l106"><span class="linenum"> 106</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>)) {
<a name="l107"><span class="linenum"> 107</span></a>              <a class="var it12523" onMouseOver="hilite(12523)" onMouseOut="lolite()" onClick="logVariable('cmrecord')" href="../../_variables/cmrecord.html">$cmrecord</a> = <a class="function" onClick="logFunction('get_coursemodule_from_id')" href="../../_functions/get_coursemodule_from_id.html" onMouseOver="funcPopup(event,'get_coursemodule_from_id')">get_coursemodule_from_id</a>(null, <a class="var it30417" onMouseOver="hilite(30417)" onMouseOut="lolite()" onClick="logVariable('cmmixed')" href="../../_variables/cmmixed.html">$cmmixed</a>);
<a name="l108"><span class="linenum"> 108</span></a>              <a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a> = <a class="function" onClick="logFunction('get_fast_modinfo')" href="../../_functions/get_fast_modinfo.html" onMouseOver="funcPopup(event,'get_fast_modinfo')">get_fast_modinfo</a>(<a class="var it12523" onMouseOver="hilite(12523)" onMouseOut="lolite()" onClick="logVariable('cmrecord')" href="../../_variables/cmrecord.html">$cmrecord</a>-&gt;<a onClick="logVariable('course')" class="var it43742" onMouseOver="hilite(43742)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>);
<a name="l109"><span class="linenum"> 109</span></a>              <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a>-&gt;<a class="function" onClick="logFunction('get_cm')" href="../../_functions/get_cm.html" onMouseOver="funcPopup(event,'get_cm')">get_cm</a>(<a class="var it30417" onMouseOver="hilite(30417)" onMouseOut="lolite()" onClick="logVariable('cmmixed')" href="../../_variables/cmmixed.html">$cmmixed</a>);
<a name="l110"><span class="linenum"> 110</span></a>          } else if (!<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> instanceof cm_info) {
<a name="l111"><span class="linenum"> 111</span></a>  <span class="comment">            // Assume we got a course module record.</span>
<a name="l112"><span class="linenum"> 112</span></a>              <a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a> = <a class="function" onClick="logFunction('get_fast_modinfo')" href="../../_functions/get_fast_modinfo.html" onMouseOver="funcPopup(event,'get_fast_modinfo')">get_fast_modinfo</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('course')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>);
<a name="l113"><span class="linenum"> 113</span></a>              <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="var it697" onMouseOver="hilite(697)" onMouseOut="lolite()" onClick="logVariable('modinfo')" href="../../_variables/modinfo.html">$modinfo</a>-&gt;<a class="function" onClick="logFunction('get_cm')" href="../../_functions/get_cm.html" onMouseOver="funcPopup(event,'get_cm')">get_cm</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l114"><span class="linenum"> 114</span></a>          }
<a name="l115"><span class="linenum"> 115</span></a>  
<a name="l116"><span class="linenum"> 116</span></a>          if (!<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('uservisible')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/uservisible.html">uservisible</a>) {
<a name="l117"><span class="linenum"> 117</span></a>              if (<a class="var it30418" onMouseOver="hilite(30418)" onMouseOut="lolite()" onClick="logVariable('throwexception')" href="../../_variables/throwexception.html">$throwexception</a>) {
<a name="l118"><span class="linenum"> 118</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('require_login_exception')" href="../../_classes/require_login_exception.html" onMouseOver="classPopup(event,'require_login_exception')">require_login_exception</a>('Course module is hidden');
<a name="l119"><span class="linenum"> 119</span></a>              } else {
<a name="l120"><span class="linenum"> 120</span></a>                  return false;
<a name="l121"><span class="linenum"> 121</span></a>              }
<a name="l122"><span class="linenum"> 122</span></a>          }
<a name="l123"><span class="linenum"> 123</span></a>  
<a name="l124"><span class="linenum"> 124</span></a>          return true;
<a name="l125"><span class="linenum"> 125</span></a>      }
<a name="l126"><span class="linenum"> 126</span></a>  
<a name="l127"><span class="linenum"> 127</span></a>      <span class="comment">/**</span>
<a name="l128"><span class="linenum"> 128</span></a>  <span class="comment">     * Validate if current user have acces to the course if hidden.</span>
<a name="l129"><span class="linenum"> 129</span></a>  <span class="comment">     *</span>
<a name="l130"><span class="linenum"> 130</span></a>  <span class="comment">     * @param mixed $courseorid The course or it ID.</span>
<a name="l131"><span class="linenum"> 131</span></a>  <span class="comment">     * @param bool $throwexception Throw an exception or not.</span>
<a name="l132"><span class="linenum"> 132</span></a>  <span class="comment">     * @return bool</span>
<a name="l133"><span class="linenum"> 133</span></a>  <span class="comment">     */</span>
<a name="l134"><span class="linenum"> 134</span></a>      protected static function <a class="function" onClick="logFunction('validate_course')" href="../../_functions/validate_course.html" onMouseOver="funcPopup(event,'validate_course')">validate_course</a>(<a class="var it11871" onMouseOver="hilite(11871)" onMouseOut="lolite()" onClick="logVariable('courseorid')" href="../../_variables/courseorid.html">$courseorid</a>, <a class="var it30418" onMouseOver="hilite(30418)" onMouseOut="lolite()" onClick="logVariable('throwexception')" href="../../_variables/throwexception.html">$throwexception</a> = true) {
<a name="l135"><span class="linenum"> 135</span></a>          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a> = <a class="var it11871" onMouseOver="hilite(11871)" onMouseOut="lolite()" onClick="logVariable('courseorid')" href="../../_variables/courseorid.html">$courseorid</a>;
<a name="l136"><span class="linenum"> 136</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>)) {
<a name="l137"><span class="linenum"> 137</span></a>              <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a> = <a class="function" onClick="logFunction('get_course')" href="../../_functions/get_course.html" onMouseOver="funcPopup(event,'get_course')">get_course</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l138"><span class="linenum"> 138</span></a>          }
<a name="l139"><span class="linenum"> 139</span></a>  
<a name="l140"><span class="linenum"> 140</span></a>          <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l141"><span class="linenum"> 141</span></a>          if (!<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('visible')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/visible.html">visible</a> and !<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/course:viewhiddencourses', <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a>)) {
<a name="l142"><span class="linenum"> 142</span></a>              if (<a class="var it30418" onMouseOver="hilite(30418)" onMouseOut="lolite()" onClick="logVariable('throwexception')" href="../../_variables/throwexception.html">$throwexception</a>) {
<a name="l143"><span class="linenum"> 143</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('require_login_exception')" href="../../_classes/require_login_exception.html" onMouseOver="classPopup(event,'require_login_exception')">require_login_exception</a>('Course is hidden');
<a name="l144"><span class="linenum"> 144</span></a>              } else {
<a name="l145"><span class="linenum"> 145</span></a>                  return false;
<a name="l146"><span class="linenum"> 146</span></a>              }
<a name="l147"><span class="linenum"> 147</span></a>          }
<a name="l148"><span class="linenum"> 148</span></a>  
<a name="l149"><span class="linenum"> 149</span></a>          return true;
<a name="l150"><span class="linenum"> 150</span></a>      }
<a name="l151"><span class="linenum"> 151</span></a>  
<a name="l152"><span class="linenum"> 152</span></a>      <span class="comment">/**</span>
<a name="l153"><span class="linenum"> 153</span></a>  <span class="comment">     * Create a competency from a record containing all the data for the class.</span>
<a name="l154"><span class="linenum"> 154</span></a>  <span class="comment">     *</span>
<a name="l155"><span class="linenum"> 155</span></a>  <span class="comment">     * Requires moodle/competency:competencymanage capability at the system context.</span>
<a name="l156"><span class="linenum"> 156</span></a>  <span class="comment">     *</span>
<a name="l157"><span class="linenum"> 157</span></a>  <span class="comment">     * @param stdClass $record Record containing all the data for an instance of the class.</span>
<a name="l158"><span class="linenum"> 158</span></a>  <span class="comment">     * @return competency</span>
<a name="l159"><span class="linenum"> 159</span></a>  <span class="comment">     */</span>
<a name="l160"><span class="linenum"> 160</span></a>      public static function <a class="function" onClick="logFunction('create_competency')" href="../../_functions/create_competency.html" onMouseOver="funcPopup(event,'create_competency')">create_competency</a>(stdClass <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>) {
<a name="l161"><span class="linenum"> 161</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l162"><span class="linenum"> 162</span></a>          <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>(0, <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>);
<a name="l163"><span class="linenum"> 163</span></a>  
<a name="l164"><span class="linenum"> 164</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l165"><span class="linenum"> 165</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:competencymanage', <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>());
<a name="l166"><span class="linenum"> 166</span></a>  
<a name="l167"><span class="linenum"> 167</span></a>  <span class="comment">        // Reset the sortorder, use reorder instead.</span>
<a name="l168"><span class="linenum"> 168</span></a>          <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('set_sortorder')" href="../../_functions/set_sortorder.html" onMouseOver="funcPopup(event,'set_sortorder')">set_sortorder</a>(null);
<a name="l169"><span class="linenum"> 169</span></a>          <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l170"><span class="linenum"> 170</span></a>  
<a name="l171"><span class="linenum"> 171</span></a>          \core\event\<a class="class" onClick="logClass('competency_created')" href="../../_classes/competency_created.html" onMouseOver="classPopup(event,'competency_created')">competency_created</a>::<a class="function" onClick="logFunction('create_from_competency')" href="../../_functions/create_from_competency.html" onMouseOver="funcPopup(event,'create_from_competency')">create_from_competency</a>(<a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l172"><span class="linenum"> 172</span></a>  
<a name="l173"><span class="linenum"> 173</span></a>  <span class="comment">        // Reset the rule of the parent.</span>
<a name="l174"><span class="linenum"> 174</span></a>          <a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a> = <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_parent')" href="../../_functions/get_parent.html" onMouseOver="funcPopup(event,'get_parent')">get_parent</a>();
<a name="l175"><span class="linenum"> 175</span></a>          if (<a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>) {
<a name="l176"><span class="linenum"> 176</span></a>              <a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>-&gt;<a class="function" onClick="logFunction('reset_rule')" href="../../_functions/reset_rule.html" onMouseOver="funcPopup(event,'reset_rule')">reset_rule</a>();
<a name="l177"><span class="linenum"> 177</span></a>              <a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l178"><span class="linenum"> 178</span></a>          }
<a name="l179"><span class="linenum"> 179</span></a>  
<a name="l180"><span class="linenum"> 180</span></a>          return <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>;
<a name="l181"><span class="linenum"> 181</span></a>      }
<a name="l182"><span class="linenum"> 182</span></a>  
<a name="l183"><span class="linenum"> 183</span></a>      <span class="comment">/**</span>
<a name="l184"><span class="linenum"> 184</span></a>  <span class="comment">     * Delete a competency by id.</span>
<a name="l185"><span class="linenum"> 185</span></a>  <span class="comment">     *</span>
<a name="l186"><span class="linenum"> 186</span></a>  <span class="comment">     * Requires moodle/competency:competencymanage capability at the system context.</span>
<a name="l187"><span class="linenum"> 187</span></a>  <span class="comment">     *</span>
<a name="l188"><span class="linenum"> 188</span></a>  <span class="comment">     * @param int $id The record to delete. This will delete alot of related data - you better be sure.</span>
<a name="l189"><span class="linenum"> 189</span></a>  <span class="comment">     * @return boolean</span>
<a name="l190"><span class="linenum"> 190</span></a>  <span class="comment">     */</span>
<a name="l191"><span class="linenum"> 191</span></a>      public static function <a class="function" onClick="logFunction('delete_competency')" href="../../_functions/delete_competency.html" onMouseOver="funcPopup(event,'delete_competency')">delete_competency</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>) {
<a name="l192"><span class="linenum"> 192</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l193"><span class="linenum"> 193</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l194"><span class="linenum"> 194</span></a>          <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);
<a name="l195"><span class="linenum"> 195</span></a>  
<a name="l196"><span class="linenum"> 196</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l197"><span class="linenum"> 197</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:competencymanage', <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>());
<a name="l198"><span class="linenum"> 198</span></a>  
<a name="l199"><span class="linenum"> 199</span></a>          <a class="var it837" onMouseOver="hilite(837)" onMouseOut="lolite()" onClick="logVariable('events')" href="../../_variables/events.html">$events</a> = array();
<a name="l200"><span class="linenum"> 200</span></a>          <a class="var it8529" onMouseOver="hilite(8529)" onMouseOut="lolite()" onClick="logVariable('competencyids')" href="../../_variables/competencyids.html">$competencyids</a> = array(<a class="phpfunction" onClick="logFunction('intval')" href="../../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>(<a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>()));
<a name="l201"><span class="linenum"> 201</span></a>          <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a> = <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>()-&gt;id;
<a name="l202"><span class="linenum"> 202</span></a>          <a class="var it8529" onMouseOver="hilite(8529)" onMouseOut="lolite()" onClick="logVariable('competencyids')" href="../../_variables/competencyids.html">$competencyids</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>::<a class="function" onClick="logFunction('get_descendants_ids')" href="../../_functions/get_descendants_ids.html" onMouseOver="funcPopup(event,'get_descendants_ids')">get_descendants_ids</a>(<a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>), <a class="var it8529" onMouseOver="hilite(8529)" onMouseOut="lolite()" onClick="logVariable('competencyids')" href="../../_variables/competencyids.html">$competencyids</a>);
<a name="l203"><span class="linenum"> 203</span></a>          if (!<a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>::<a class="function" onClick="logFunction('can_all_be_deleted')" href="../../_functions/can_all_be_deleted.html" onMouseOver="funcPopup(event,'can_all_be_deleted')">can_all_be_deleted</a>(<a class="var it8529" onMouseOver="hilite(8529)" onMouseOut="lolite()" onClick="logVariable('competencyids')" href="../../_variables/competencyids.html">$competencyids</a>)) {
<a name="l204"><span class="linenum"> 204</span></a>              return false;
<a name="l205"><span class="linenum"> 205</span></a>          }
<a name="l206"><span class="linenum"> 206</span></a>          <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l207"><span class="linenum"> 207</span></a>  
<a name="l208"><span class="linenum"> 208</span></a>          try {
<a name="l209"><span class="linenum"> 209</span></a>  
<a name="l210"><span class="linenum"> 210</span></a>  <span class="comment">            // Reset the rule of the parent.</span>
<a name="l211"><span class="linenum"> 211</span></a>              <a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a> = <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_parent')" href="../../_functions/get_parent.html" onMouseOver="funcPopup(event,'get_parent')">get_parent</a>();
<a name="l212"><span class="linenum"> 212</span></a>              if (<a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>) {
<a name="l213"><span class="linenum"> 213</span></a>                  <a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>-&gt;<a class="function" onClick="logFunction('reset_rule')" href="../../_functions/reset_rule.html" onMouseOver="funcPopup(event,'reset_rule')">reset_rule</a>();
<a name="l214"><span class="linenum"> 214</span></a>                  <a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l215"><span class="linenum"> 215</span></a>              }
<a name="l216"><span class="linenum"> 216</span></a>  
<a name="l217"><span class="linenum"> 217</span></a>  <span class="comment">            // Delete the competency separately so the after_delete event can be triggered.</span>
<a name="l218"><span class="linenum"> 218</span></a>              <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l219"><span class="linenum"> 219</span></a>  
<a name="l220"><span class="linenum"> 220</span></a>  <span class="comment">            // Delete the competencies.</span>
<a name="l221"><span class="linenum"> 221</span></a>              <a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>::<a class="function" onClick="logFunction('delete_multiple')" href="../../_functions/delete_multiple.html" onMouseOver="funcPopup(event,'delete_multiple')">delete_multiple</a>(<a class="var it8529" onMouseOver="hilite(8529)" onMouseOut="lolite()" onClick="logVariable('competencyids')" href="../../_variables/competencyids.html">$competencyids</a>);
<a name="l222"><span class="linenum"> 222</span></a>  
<a name="l223"><span class="linenum"> 223</span></a>  <span class="comment">            // Delete the competencies relation.</span>
<a name="l224"><span class="linenum"> 224</span></a>              <a class="class" onClick="logClass('related_competency')" href="../../_classes/related_competency.html" onMouseOver="classPopup(event,'related_competency')">related_competency</a>::<a class="function" onClick="logFunction('delete_multiple_relations')" href="../../_functions/delete_multiple_relations.html" onMouseOver="funcPopup(event,'delete_multiple_relations')">delete_multiple_relations</a>(<a class="var it8529" onMouseOver="hilite(8529)" onMouseOut="lolite()" onClick="logVariable('competencyids')" href="../../_variables/competencyids.html">$competencyids</a>);
<a name="l225"><span class="linenum"> 225</span></a>  
<a name="l226"><span class="linenum"> 226</span></a>  <span class="comment">            // Delete competency evidences.</span>
<a name="l227"><span class="linenum"> 227</span></a>              <a class="class" onClick="logClass('user_evidence_competency')" href="../../_classes/user_evidence_competency.html" onMouseOver="classPopup(event,'user_evidence_competency')">user_evidence_competency</a>::<a class="function" onClick="logFunction('delete_by_competencyids')" href="../../_functions/delete_by_competencyids.html" onMouseOver="funcPopup(event,'delete_by_competencyids')">delete_by_competencyids</a>(<a class="var it8529" onMouseOver="hilite(8529)" onMouseOut="lolite()" onClick="logVariable('competencyids')" href="../../_variables/competencyids.html">$competencyids</a>);
<a name="l228"><span class="linenum"> 228</span></a>  
<a name="l229"><span class="linenum"> 229</span></a>  <span class="comment">            // Register the competencies deleted events.</span>
<a name="l230"><span class="linenum"> 230</span></a>              <a class="var it837" onMouseOver="hilite(837)" onMouseOut="lolite()" onClick="logVariable('events')" href="../../_variables/events.html">$events</a> = \core\event\<a class="class" onClick="logClass('competency_deleted')" href="../../_classes/competency_deleted.html" onMouseOver="classPopup(event,'competency_deleted')">competency_deleted</a>::<a class="function" onClick="logFunction('create_multiple_from_competencyids')" href="../../_functions/create_multiple_from_competencyids.html" onMouseOver="funcPopup(event,'create_multiple_from_competencyids')">create_multiple_from_competencyids</a>(<a class="var it8529" onMouseOver="hilite(8529)" onMouseOut="lolite()" onClick="logVariable('competencyids')" href="../../_variables/competencyids.html">$competencyids</a>, <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>);
<a name="l231"><span class="linenum"> 231</span></a>  
<a name="l232"><span class="linenum"> 232</span></a>          } catch (\Exception <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>) {
<a name="l233"><span class="linenum"> 233</span></a>              <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('rollback')" href="../../_functions/rollback.html" onMouseOver="funcPopup(event,'rollback')">rollback</a>(<a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>);
<a name="l234"><span class="linenum"> 234</span></a>          }
<a name="l235"><span class="linenum"> 235</span></a>  
<a name="l236"><span class="linenum"> 236</span></a>          <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l237"><span class="linenum"> 237</span></a>  <span class="comment">        // Trigger events.</span>
<a name="l238"><span class="linenum"> 238</span></a>          foreach (<a class="var it837" onMouseOver="hilite(837)" onMouseOut="lolite()" onClick="logVariable('events')" href="../../_variables/events.html">$events</a> as <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>) {
<a name="l239"><span class="linenum"> 239</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l240"><span class="linenum"> 240</span></a>          }
<a name="l241"><span class="linenum"> 241</span></a>  
<a name="l242"><span class="linenum"> 242</span></a>          return true;
<a name="l243"><span class="linenum"> 243</span></a>      }
<a name="l244"><span class="linenum"> 244</span></a>  
<a name="l245"><span class="linenum"> 245</span></a>      <span class="comment">/**</span>
<a name="l246"><span class="linenum"> 246</span></a>  <span class="comment">     * Reorder this competency.</span>
<a name="l247"><span class="linenum"> 247</span></a>  <span class="comment">     *</span>
<a name="l248"><span class="linenum"> 248</span></a>  <span class="comment">     * Requires moodle/competency:competencymanage capability at the system context.</span>
<a name="l249"><span class="linenum"> 249</span></a>  <span class="comment">     *</span>
<a name="l250"><span class="linenum"> 250</span></a>  <span class="comment">     * @param int $id The id of the competency to move.</span>
<a name="l251"><span class="linenum"> 251</span></a>  <span class="comment">     * @return boolean</span>
<a name="l252"><span class="linenum"> 252</span></a>  <span class="comment">     */</span>
<a name="l253"><span class="linenum"> 253</span></a>      public static function <a class="function" onClick="logFunction('move_down_competency')" href="../../_functions/move_down_competency.html" onMouseOver="funcPopup(event,'move_down_competency')">move_down_competency</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>) {
<a name="l254"><span class="linenum"> 254</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l255"><span class="linenum"> 255</span></a>          <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);
<a name="l256"><span class="linenum"> 256</span></a>  
<a name="l257"><span class="linenum"> 257</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l258"><span class="linenum"> 258</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:competencymanage', <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>());
<a name="l259"><span class="linenum"> 259</span></a>  
<a name="l260"><span class="linenum"> 260</span></a>          <a class="var it536" onMouseOver="hilite(536)" onMouseOut="lolite()" onClick="logVariable('max')" href="../../_variables/max.html">$max</a> = self::<a class="function" onClick="logFunction('count_competencies')" href="../../_functions/count_competencies.html" onMouseOver="funcPopup(event,'count_competencies')">count_competencies</a>(array('parentid' =&gt; <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;get_parentid(),
<a name="l261"><span class="linenum"> 261</span></a>                                                'competencyframeworkid' =&gt; <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;get_competencyframeworkid()));
<a name="l262"><span class="linenum"> 262</span></a>          if (<a class="var it536" onMouseOver="hilite(536)" onMouseOut="lolite()" onClick="logVariable('max')" href="../../_variables/max.html">$max</a> &gt; 0) {
<a name="l263"><span class="linenum"> 263</span></a>              <a class="var it536" onMouseOver="hilite(536)" onMouseOut="lolite()" onClick="logVariable('max')" href="../../_variables/max.html">$max</a>--;
<a name="l264"><span class="linenum"> 264</span></a>          }
<a name="l265"><span class="linenum"> 265</span></a>  
<a name="l266"><span class="linenum"> 266</span></a>          <a class="var it3515" onMouseOver="hilite(3515)" onMouseOut="lolite()" onClick="logVariable('sortorder')" href="../../_variables/sortorder.html">$sortorder</a> = <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>();
<a name="l267"><span class="linenum"> 267</span></a>          if (<a class="var it3515" onMouseOver="hilite(3515)" onMouseOut="lolite()" onClick="logVariable('sortorder')" href="../../_variables/sortorder.html">$sortorder</a> &gt;= <a class="var it536" onMouseOver="hilite(536)" onMouseOut="lolite()" onClick="logVariable('max')" href="../../_variables/max.html">$max</a>) {
<a name="l268"><span class="linenum"> 268</span></a>              return false;
<a name="l269"><span class="linenum"> 269</span></a>          }
<a name="l270"><span class="linenum"> 270</span></a>          <a class="var it3515" onMouseOver="hilite(3515)" onMouseOut="lolite()" onClick="logVariable('sortorder')" href="../../_variables/sortorder.html">$sortorder</a> = <a class="var it3515" onMouseOver="hilite(3515)" onMouseOut="lolite()" onClick="logVariable('sortorder')" href="../../_variables/sortorder.html">$sortorder</a> + 1;
<a name="l271"><span class="linenum"> 271</span></a>          <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a class="function" onClick="logFunction('set_sortorder')" href="../../_functions/set_sortorder.html" onMouseOver="funcPopup(event,'set_sortorder')">set_sortorder</a>(<a class="var it3515" onMouseOver="hilite(3515)" onMouseOut="lolite()" onClick="logVariable('sortorder')" href="../../_variables/sortorder.html">$sortorder</a>);
<a name="l272"><span class="linenum"> 272</span></a>  
<a name="l273"><span class="linenum"> 273</span></a>          <a class="var it655" onMouseOver="hilite(655)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a> = array('parentid' =&gt; <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;get_parentid(),
<a name="l274"><span class="linenum"> 274</span></a>                           'competencyframeworkid' =&gt; <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;get_competencyframeworkid(),
<a name="l275"><span class="linenum"> 275</span></a>                           'sortorder' =&gt; <a class="var it3515" onMouseOver="hilite(3515)" onMouseOut="lolite()" onClick="logVariable('sortorder')" href="../../_variables/sortorder.html">$sortorder</a>);
<a name="l276"><span class="linenum"> 276</span></a>          <a class="var it922" onMouseOver="hilite(922)" onMouseOut="lolite()" onClick="logVariable('children')" href="../../_variables/children.html">$children</a> = self::<a class="function" onClick="logFunction('list_competencies')" href="../../_functions/list_competencies.html" onMouseOver="funcPopup(event,'list_competencies')">list_competencies</a>(<a class="var it655" onMouseOver="hilite(655)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a>, 'id');
<a name="l277"><span class="linenum"> 277</span></a>          foreach (<a class="var it922" onMouseOver="hilite(922)" onMouseOut="lolite()" onClick="logVariable('children')" href="../../_variables/children.html">$children</a> as <a class="var it30419" onMouseOver="hilite(30419)" onMouseOut="lolite()" onClick="logVariable('needtoswap')" href="../../_variables/needtoswap.html">$needtoswap</a>) {
<a name="l278"><span class="linenum"> 278</span></a>              <a class="var it30419" onMouseOver="hilite(30419)" onMouseOut="lolite()" onClick="logVariable('needtoswap')" href="../../_variables/needtoswap.html">$needtoswap</a>-&gt;<a class="function" onClick="logFunction('set_sortorder')" href="../../_functions/set_sortorder.html" onMouseOver="funcPopup(event,'set_sortorder')">set_sortorder</a>(<a class="var it3515" onMouseOver="hilite(3515)" onMouseOut="lolite()" onClick="logVariable('sortorder')" href="../../_variables/sortorder.html">$sortorder</a> - 1);
<a name="l279"><span class="linenum"> 279</span></a>              <a class="var it30419" onMouseOver="hilite(30419)" onMouseOut="lolite()" onClick="logVariable('needtoswap')" href="../../_variables/needtoswap.html">$needtoswap</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l280"><span class="linenum"> 280</span></a>          }
<a name="l281"><span class="linenum"> 281</span></a>  
<a name="l282"><span class="linenum"> 282</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l283"><span class="linenum"> 283</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l284"><span class="linenum"> 284</span></a>  
<a name="l285"><span class="linenum"> 285</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l286"><span class="linenum"> 286</span></a>      }
<a name="l287"><span class="linenum"> 287</span></a>  
<a name="l288"><span class="linenum"> 288</span></a>      <span class="comment">/**</span>
<a name="l289"><span class="linenum"> 289</span></a>  <span class="comment">     * Reorder this competency.</span>
<a name="l290"><span class="linenum"> 290</span></a>  <span class="comment">     *</span>
<a name="l291"><span class="linenum"> 291</span></a>  <span class="comment">     * Requires moodle/competency:competencymanage capability at the system context.</span>
<a name="l292"><span class="linenum"> 292</span></a>  <span class="comment">     *</span>
<a name="l293"><span class="linenum"> 293</span></a>  <span class="comment">     * @param int $id The id of the competency to move.</span>
<a name="l294"><span class="linenum"> 294</span></a>  <span class="comment">     * @return boolean</span>
<a name="l295"><span class="linenum"> 295</span></a>  <span class="comment">     */</span>
<a name="l296"><span class="linenum"> 296</span></a>      public static function <a class="function" onClick="logFunction('move_up_competency')" href="../../_functions/move_up_competency.html" onMouseOver="funcPopup(event,'move_up_competency')">move_up_competency</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>) {
<a name="l297"><span class="linenum"> 297</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l298"><span class="linenum"> 298</span></a>          <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);
<a name="l299"><span class="linenum"> 299</span></a>  
<a name="l300"><span class="linenum"> 300</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l301"><span class="linenum"> 301</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:competencymanage', <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>());
<a name="l302"><span class="linenum"> 302</span></a>  
<a name="l303"><span class="linenum"> 303</span></a>          <a class="var it3515" onMouseOver="hilite(3515)" onMouseOut="lolite()" onClick="logVariable('sortorder')" href="../../_variables/sortorder.html">$sortorder</a> = <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>();
<a name="l304"><span class="linenum"> 304</span></a>          if (<a class="var it3515" onMouseOver="hilite(3515)" onMouseOut="lolite()" onClick="logVariable('sortorder')" href="../../_variables/sortorder.html">$sortorder</a> == 0) {
<a name="l305"><span class="linenum"> 305</span></a>              return false;
<a name="l306"><span class="linenum"> 306</span></a>          }
<a name="l307"><span class="linenum"> 307</span></a>  
<a name="l308"><span class="linenum"> 308</span></a>          <a class="var it3515" onMouseOver="hilite(3515)" onMouseOut="lolite()" onClick="logVariable('sortorder')" href="../../_variables/sortorder.html">$sortorder</a> = <a class="var it3515" onMouseOver="hilite(3515)" onMouseOut="lolite()" onClick="logVariable('sortorder')" href="../../_variables/sortorder.html">$sortorder</a> - 1;
<a name="l309"><span class="linenum"> 309</span></a>          <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a class="function" onClick="logFunction('set_sortorder')" href="../../_functions/set_sortorder.html" onMouseOver="funcPopup(event,'set_sortorder')">set_sortorder</a>(<a class="var it3515" onMouseOver="hilite(3515)" onMouseOut="lolite()" onClick="logVariable('sortorder')" href="../../_variables/sortorder.html">$sortorder</a>);
<a name="l310"><span class="linenum"> 310</span></a>  
<a name="l311"><span class="linenum"> 311</span></a>          <a class="var it655" onMouseOver="hilite(655)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a> = array('parentid' =&gt; <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;get_parentid(),
<a name="l312"><span class="linenum"> 312</span></a>                           'competencyframeworkid' =&gt; <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;get_competencyframeworkid(),
<a name="l313"><span class="linenum"> 313</span></a>                           'sortorder' =&gt; <a class="var it3515" onMouseOver="hilite(3515)" onMouseOut="lolite()" onClick="logVariable('sortorder')" href="../../_variables/sortorder.html">$sortorder</a>);
<a name="l314"><span class="linenum"> 314</span></a>          <a class="var it922" onMouseOver="hilite(922)" onMouseOut="lolite()" onClick="logVariable('children')" href="../../_variables/children.html">$children</a> = self::<a class="function" onClick="logFunction('list_competencies')" href="../../_functions/list_competencies.html" onMouseOver="funcPopup(event,'list_competencies')">list_competencies</a>(<a class="var it655" onMouseOver="hilite(655)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a>, 'id');
<a name="l315"><span class="linenum"> 315</span></a>          foreach (<a class="var it922" onMouseOver="hilite(922)" onMouseOut="lolite()" onClick="logVariable('children')" href="../../_variables/children.html">$children</a> as <a class="var it30419" onMouseOver="hilite(30419)" onMouseOut="lolite()" onClick="logVariable('needtoswap')" href="../../_variables/needtoswap.html">$needtoswap</a>) {
<a name="l316"><span class="linenum"> 316</span></a>              <a class="var it30419" onMouseOver="hilite(30419)" onMouseOut="lolite()" onClick="logVariable('needtoswap')" href="../../_variables/needtoswap.html">$needtoswap</a>-&gt;<a class="function" onClick="logFunction('set_sortorder')" href="../../_functions/set_sortorder.html" onMouseOver="funcPopup(event,'set_sortorder')">set_sortorder</a>(<a class="var it3515" onMouseOver="hilite(3515)" onMouseOut="lolite()" onClick="logVariable('sortorder')" href="../../_variables/sortorder.html">$sortorder</a> + 1);
<a name="l317"><span class="linenum"> 317</span></a>              <a class="var it30419" onMouseOver="hilite(30419)" onMouseOut="lolite()" onClick="logVariable('needtoswap')" href="../../_variables/needtoswap.html">$needtoswap</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l318"><span class="linenum"> 318</span></a>          }
<a name="l319"><span class="linenum"> 319</span></a>  
<a name="l320"><span class="linenum"> 320</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l321"><span class="linenum"> 321</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l322"><span class="linenum"> 322</span></a>  
<a name="l323"><span class="linenum"> 323</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l324"><span class="linenum"> 324</span></a>      }
<a name="l325"><span class="linenum"> 325</span></a>  
<a name="l326"><span class="linenum"> 326</span></a>      <span class="comment">/**</span>
<a name="l327"><span class="linenum"> 327</span></a>  <span class="comment">     * Move this competency so it sits in a new parent.</span>
<a name="l328"><span class="linenum"> 328</span></a>  <span class="comment">     *</span>
<a name="l329"><span class="linenum"> 329</span></a>  <span class="comment">     * Requires moodle/competency:competencymanage capability at the system context.</span>
<a name="l330"><span class="linenum"> 330</span></a>  <span class="comment">     *</span>
<a name="l331"><span class="linenum"> 331</span></a>  <span class="comment">     * @param int $id The id of the competency to move.</span>
<a name="l332"><span class="linenum"> 332</span></a>  <span class="comment">     * @param int $newparentid The new parent id for the competency.</span>
<a name="l333"><span class="linenum"> 333</span></a>  <span class="comment">     * @return boolean</span>
<a name="l334"><span class="linenum"> 334</span></a>  <span class="comment">     */</span>
<a name="l335"><span class="linenum"> 335</span></a>      public static function <a class="function" onClick="logFunction('set_parent_competency')" href="../../_functions/set_parent_competency.html" onMouseOver="funcPopup(event,'set_parent_competency')">set_parent_competency</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>, <a class="var it2601" onMouseOver="hilite(2601)" onMouseOut="lolite()" onClick="logVariable('newparentid')" href="../../_variables/newparentid.html">$newparentid</a>) {
<a name="l336"><span class="linenum"> 336</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l337"><span class="linenum"> 337</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l338"><span class="linenum"> 338</span></a>          <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);
<a name="l339"><span class="linenum"> 339</span></a>  
<a name="l340"><span class="linenum"> 340</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l341"><span class="linenum"> 341</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:competencymanage', <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>());
<a name="l342"><span class="linenum"> 342</span></a>          if (<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a> == <a class="var it2601" onMouseOver="hilite(2601)" onMouseOut="lolite()" onClick="logVariable('newparentid')" href="../../_variables/newparentid.html">$newparentid</a>) {
<a name="l343"><span class="linenum"> 343</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Can not set a competency as a parent of itself.');
<a name="l344"><span class="linenum"> 344</span></a>          } if (<a class="var it2601" onMouseOver="hilite(2601)" onMouseOut="lolite()" onClick="logVariable('newparentid')" href="../../_variables/newparentid.html">$newparentid</a> == <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;get_parentid()) {
<a name="l345"><span class="linenum"> 345</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Can not move a competency to the same location.');
<a name="l346"><span class="linenum"> 346</span></a>          }
<a name="l347"><span class="linenum"> 347</span></a>  
<a name="l348"><span class="linenum"> 348</span></a>  <span class="comment">        // Some great variable assignment right here.</span>
<a name="l349"><span class="linenum"> 349</span></a>          <a class="var it5310" onMouseOver="hilite(5310)" onMouseOut="lolite()" onClick="logVariable('currentparent')" href="../../_variables/currentparent.html">$currentparent</a> = <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a class="function" onClick="logFunction('get_parent')" href="../../_functions/get_parent.html" onMouseOver="funcPopup(event,'get_parent')">get_parent</a>();
<a name="l350"><span class="linenum"> 350</span></a>          <a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a> = !empty(<a class="var it2601" onMouseOver="hilite(2601)" onMouseOut="lolite()" onClick="logVariable('newparentid')" href="../../_variables/newparentid.html">$newparentid</a>) ? <span class="keyword">new </span><a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>(<a class="var it2601" onMouseOver="hilite(2601)" onMouseOut="lolite()" onClick="logVariable('newparentid')" href="../../_variables/newparentid.html">$newparentid</a>) : null;
<a name="l351"><span class="linenum"> 351</span></a>          <a class="var it3391" onMouseOver="hilite(3391)" onMouseOut="lolite()" onClick="logVariable('parentpath')" href="../../_variables/parentpath.html">$parentpath</a> = !empty(<a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>) ? <a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>-&gt;<a class="function" onClick="logFunction('get_path')" href="../../_functions/get_path.html" onMouseOver="funcPopup(event,'get_path')">get_path</a>() : '/0/';
<a name="l352"><span class="linenum"> 352</span></a>  
<a name="l353"><span class="linenum"> 353</span></a>  <span class="comment">        // We're going to change quite a few things.</span>
<a name="l354"><span class="linenum"> 354</span></a>          <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l355"><span class="linenum"> 355</span></a>  
<a name="l356"><span class="linenum"> 356</span></a>  <span class="comment">        // If we are moving a node to a child of itself:</span>
<a name="l357"><span class="linenum"> 357</span></a>  <span class="comment">        // - promote all the child nodes by one level.</span>
<a name="l358"><span class="linenum"> 358</span></a>  <span class="comment">        // - remove the rule on self.</span>
<a name="l359"><span class="linenum"> 359</span></a>  <span class="comment">        // - re-read the parent.</span>
<a name="l360"><span class="linenum"> 360</span></a>          <a class="var it6470" onMouseOver="hilite(6470)" onMouseOut="lolite()" onClick="logVariable('newparents')" href="../../_variables/newparents.html">$newparents</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>('/', <a class="var it3391" onMouseOver="hilite(3391)" onMouseOut="lolite()" onClick="logVariable('parentpath')" href="../../_variables/parentpath.html">$parentpath</a>);
<a name="l361"><span class="linenum"> 361</span></a>          if (<a class="phpfunction" onClick="logFunction('in_array')" href="../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(), <a class="var it6470" onMouseOver="hilite(6470)" onMouseOut="lolite()" onClick="logVariable('newparents')" href="../../_variables/newparents.html">$newparents</a>)) {
<a name="l362"><span class="linenum"> 362</span></a>              <a class="var it922" onMouseOver="hilite(922)" onMouseOut="lolite()" onClick="logVariable('children')" href="../../_variables/children.html">$children</a> = <a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>::<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(array('parentid' =&gt; <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>()), 'id');
<a name="l363"><span class="linenum"> 363</span></a>              foreach (<a class="var it922" onMouseOver="hilite(922)" onMouseOut="lolite()" onClick="logVariable('children')" href="../../_variables/children.html">$children</a> as <a class="var it3285" onMouseOver="hilite(3285)" onMouseOut="lolite()" onClick="logVariable('child')" href="../../_variables/child.html">$child</a>) {
<a name="l364"><span class="linenum"> 364</span></a>                  <a class="var it3285" onMouseOver="hilite(3285)" onMouseOut="lolite()" onClick="logVariable('child')" href="../../_variables/child.html">$child</a>-&gt;set_parentid(<a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;get_parentid());
<a name="l365"><span class="linenum"> 365</span></a>                  <a class="var it3285" onMouseOver="hilite(3285)" onMouseOut="lolite()" onClick="logVariable('child')" href="../../_variables/child.html">$child</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l366"><span class="linenum"> 366</span></a>              }
<a name="l367"><span class="linenum"> 367</span></a>  
<a name="l368"><span class="linenum"> 368</span></a>  <span class="comment">            // Reset the rule on self as our children have changed.</span>
<a name="l369"><span class="linenum"> 369</span></a>              <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a class="function" onClick="logFunction('reset_rule')" href="../../_functions/reset_rule.html" onMouseOver="funcPopup(event,'reset_rule')">reset_rule</a>();
<a name="l370"><span class="linenum"> 370</span></a>  
<a name="l371"><span class="linenum"> 371</span></a>  <span class="comment">            // The destination parent is one of our descendants, we need to re-fetch its values (path, parentid).</span>
<a name="l372"><span class="linenum"> 372</span></a>              <a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>-&gt;<a class="function" onClick="logFunction('read')" href="../../_functions/read.html" onMouseOver="funcPopup(event,'read')">read</a>();
<a name="l373"><span class="linenum"> 373</span></a>          }
<a name="l374"><span class="linenum"> 374</span></a>  
<a name="l375"><span class="linenum"> 375</span></a>  <span class="comment">        // Reset the rules of initial parent and destination.</span>
<a name="l376"><span class="linenum"> 376</span></a>          if (!empty(<a class="var it5310" onMouseOver="hilite(5310)" onMouseOut="lolite()" onClick="logVariable('currentparent')" href="../../_variables/currentparent.html">$currentparent</a>)) {
<a name="l377"><span class="linenum"> 377</span></a>              <a class="var it5310" onMouseOver="hilite(5310)" onMouseOut="lolite()" onClick="logVariable('currentparent')" href="../../_variables/currentparent.html">$currentparent</a>-&gt;<a class="function" onClick="logFunction('reset_rule')" href="../../_functions/reset_rule.html" onMouseOver="funcPopup(event,'reset_rule')">reset_rule</a>();
<a name="l378"><span class="linenum"> 378</span></a>              <a class="var it5310" onMouseOver="hilite(5310)" onMouseOut="lolite()" onClick="logVariable('currentparent')" href="../../_variables/currentparent.html">$currentparent</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l379"><span class="linenum"> 379</span></a>          }
<a name="l380"><span class="linenum"> 380</span></a>          if (!empty(<a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>)) {
<a name="l381"><span class="linenum"> 381</span></a>              <a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>-&gt;<a class="function" onClick="logFunction('reset_rule')" href="../../_functions/reset_rule.html" onMouseOver="funcPopup(event,'reset_rule')">reset_rule</a>();
<a name="l382"><span class="linenum"> 382</span></a>              <a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l383"><span class="linenum"> 383</span></a>          }
<a name="l384"><span class="linenum"> 384</span></a>  
<a name="l385"><span class="linenum"> 385</span></a>  <span class="comment">        // Do the actual move.</span>
<a name="l386"><span class="linenum"> 386</span></a>          <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;set_parentid(<a class="var it2601" onMouseOver="hilite(2601)" onMouseOut="lolite()" onClick="logVariable('newparentid')" href="../../_variables/newparentid.html">$newparentid</a>);
<a name="l387"><span class="linenum"> 387</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it397" onMouseOver="hilite(397)" onMouseOut="lolite()" onClick="logVariable('current')" href="../../_variables/current.html">$current</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l388"><span class="linenum"> 388</span></a>  
<a name="l389"><span class="linenum"> 389</span></a>  <span class="comment">        // All right, let's commit this.</span>
<a name="l390"><span class="linenum"> 390</span></a>          <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l391"><span class="linenum"> 391</span></a>  
<a name="l392"><span class="linenum"> 392</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l393"><span class="linenum"> 393</span></a>      }
<a name="l394"><span class="linenum"> 394</span></a>  
<a name="l395"><span class="linenum"> 395</span></a>      <span class="comment">/**</span>
<a name="l396"><span class="linenum"> 396</span></a>  <span class="comment">     * Update the details for a competency.</span>
<a name="l397"><span class="linenum"> 397</span></a>  <span class="comment">     *</span>
<a name="l398"><span class="linenum"> 398</span></a>  <span class="comment">     * Requires moodle/competency:competencymanage capability at the system context.</span>
<a name="l399"><span class="linenum"> 399</span></a>  <span class="comment">     *</span>
<a name="l400"><span class="linenum"> 400</span></a>  <span class="comment">     * @param stdClass $record The new details for the competency.</span>
<a name="l401"><span class="linenum"> 401</span></a>  <span class="comment">     *                         Note - must contain an id that points to the competency to update.</span>
<a name="l402"><span class="linenum"> 402</span></a>  <span class="comment">     *</span>
<a name="l403"><span class="linenum"> 403</span></a>  <span class="comment">     * @return boolean</span>
<a name="l404"><span class="linenum"> 404</span></a>  <span class="comment">     */</span>
<a name="l405"><span class="linenum"> 405</span></a>      public static function <a class="function" onClick="logFunction('update_competency')" href="../../_functions/update_competency.html" onMouseOver="funcPopup(event,'update_competency')">update_competency</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>) {
<a name="l406"><span class="linenum"> 406</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l407"><span class="linenum"> 407</span></a>          <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l408"><span class="linenum"> 408</span></a>  
<a name="l409"><span class="linenum"> 409</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l410"><span class="linenum"> 410</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:competencymanage', <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>());
<a name="l411"><span class="linenum"> 411</span></a>  
<a name="l412"><span class="linenum"> 412</span></a>  <span class="comment">        // Some things should not be changed in an update - they should use a more specific method.</span>
<a name="l413"><span class="linenum"> 413</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('sortorder')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a> = <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>();
<a name="l414"><span class="linenum"> 414</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('parentid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/parentid.html">parentid</a> = <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;get_parentid();
<a name="l415"><span class="linenum"> 415</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('competencyframeworkid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/competencyframeworkid.html">competencyframeworkid</a> = <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;get_competencyframeworkid();
<a name="l416"><span class="linenum"> 416</span></a>  
<a name="l417"><span class="linenum"> 417</span></a>          <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('from_record')" href="../../_functions/from_record.html" onMouseOver="funcPopup(event,'from_record')">from_record</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>);
<a name="l418"><span class="linenum"> 418</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:competencymanage', <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>());
<a name="l419"><span class="linenum"> 419</span></a>  
<a name="l420"><span class="linenum"> 420</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l421"><span class="linenum"> 421</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l422"><span class="linenum"> 422</span></a>  
<a name="l423"><span class="linenum"> 423</span></a>  <span class="comment">        // Trigger the update event.</span>
<a name="l424"><span class="linenum"> 424</span></a>          \core\event\<a class="class" onClick="logClass('competency_updated')" href="../../_classes/competency_updated.html" onMouseOver="classPopup(event,'competency_updated')">competency_updated</a>::<a class="function" onClick="logFunction('create_from_competency')" href="../../_functions/create_from_competency.html" onMouseOver="funcPopup(event,'create_from_competency')">create_from_competency</a>(<a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l425"><span class="linenum"> 425</span></a>  
<a name="l426"><span class="linenum"> 426</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l427"><span class="linenum"> 427</span></a>      }
<a name="l428"><span class="linenum"> 428</span></a>  
<a name="l429"><span class="linenum"> 429</span></a>      <span class="comment">/**</span>
<a name="l430"><span class="linenum"> 430</span></a>  <span class="comment">     * Read a the details for a single competency and return a record.</span>
<a name="l431"><span class="linenum"> 431</span></a>  <span class="comment">     *</span>
<a name="l432"><span class="linenum"> 432</span></a>  <span class="comment">     * Requires moodle/competency:competencyview capability at the system context.</span>
<a name="l433"><span class="linenum"> 433</span></a>  <span class="comment">     *</span>
<a name="l434"><span class="linenum"> 434</span></a>  <span class="comment">     * @param int $id The id of the competency to read.</span>
<a name="l435"><span class="linenum"> 435</span></a>  <span class="comment">     * @param bool $includerelated Include related tags or not.</span>
<a name="l436"><span class="linenum"> 436</span></a>  <span class="comment">     * @return stdClass</span>
<a name="l437"><span class="linenum"> 437</span></a>  <span class="comment">     */</span>
<a name="l438"><span class="linenum"> 438</span></a>      public static function <a class="function" onClick="logFunction('read_competency')" href="../../_functions/read_competency.html" onMouseOver="funcPopup(event,'read_competency')">read_competency</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>, <a class="var it25424" onMouseOver="hilite(25424)" onMouseOut="lolite()" onClick="logVariable('includerelated')" href="../../_variables/includerelated.html">$includerelated</a> = false) {
<a name="l439"><span class="linenum"> 439</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l440"><span class="linenum"> 440</span></a>          <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);
<a name="l441"><span class="linenum"> 441</span></a>  
<a name="l442"><span class="linenum"> 442</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l443"><span class="linenum"> 443</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>();
<a name="l444"><span class="linenum"> 444</span></a>          if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(array('moodle/competency:competencyview', 'moodle/competency:competencymanage'), <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l445"><span class="linenum"> 445</span></a>               throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:competencyview', 'nopermissions', '');
<a name="l446"><span class="linenum"> 446</span></a>          }
<a name="l447"><span class="linenum"> 447</span></a>  
<a name="l448"><span class="linenum"> 448</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l449"><span class="linenum"> 449</span></a>          if (<a class="var it25424" onMouseOver="hilite(25424)" onMouseOut="lolite()" onClick="logVariable('includerelated')" href="../../_variables/includerelated.html">$includerelated</a>) {
<a name="l450"><span class="linenum"> 450</span></a>              <a class="var it30420" onMouseOver="hilite(30420)" onMouseOut="lolite()" onClick="logVariable('relatedcompetency')" href="../../_variables/relatedcompetency.html">$relatedcompetency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('related_competency')" href="../../_classes/related_competency.html" onMouseOver="classPopup(event,'related_competency')">related_competency</a>();
<a name="l451"><span class="linenum"> 451</span></a>              if (<a class="var it3553" onMouseOver="hilite(3553)" onMouseOut="lolite()" onClick="logVariable('related')" href="../../_variables/related.html">$related</a> = <a class="var it30420" onMouseOver="hilite(30420)" onMouseOut="lolite()" onClick="logVariable('relatedcompetency')" href="../../_variables/relatedcompetency.html">$relatedcompetency</a>-&gt;list_relations(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>)) {
<a name="l452"><span class="linenum"> 452</span></a>                  <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a onClick="logVariable('relatedcompetencies')" class="var it43070" onMouseOver="hilite(43070)" onMouseOut="lolite()" href="../../_variables/relatedcompetencies.html">relatedcompetencies</a> = <a class="var it3553" onMouseOver="hilite(3553)" onMouseOut="lolite()" onClick="logVariable('related')" href="../../_variables/related.html">$related</a>;
<a name="l453"><span class="linenum"> 453</span></a>              }
<a name="l454"><span class="linenum"> 454</span></a>          }
<a name="l455"><span class="linenum"> 455</span></a>  
<a name="l456"><span class="linenum"> 456</span></a>          return <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>;
<a name="l457"><span class="linenum"> 457</span></a>      }
<a name="l458"><span class="linenum"> 458</span></a>  
<a name="l459"><span class="linenum"> 459</span></a>      <span class="comment">/**</span>
<a name="l460"><span class="linenum"> 460</span></a>  <span class="comment">     * Perform a text search based and return all results and their parents.</span>
<a name="l461"><span class="linenum"> 461</span></a>  <span class="comment">     *</span>
<a name="l462"><span class="linenum"> 462</span></a>  <span class="comment">     * Requires moodle/competency:competencyview capability at the framework context.</span>
<a name="l463"><span class="linenum"> 463</span></a>  <span class="comment">     *</span>
<a name="l464"><span class="linenum"> 464</span></a>  <span class="comment">     * @param string $textsearch A string to search for.</span>
<a name="l465"><span class="linenum"> 465</span></a>  <span class="comment">     * @param int $competencyframeworkid The id of the framework to limit the search.</span>
<a name="l466"><span class="linenum"> 466</span></a>  <span class="comment">     * @return array of competencies</span>
<a name="l467"><span class="linenum"> 467</span></a>  <span class="comment">     */</span>
<a name="l468"><span class="linenum"> 468</span></a>      public static function <a class="function" onClick="logFunction('search_competencies')" href="../../_functions/search_competencies.html" onMouseOver="funcPopup(event,'search_competencies')">search_competencies</a>(<a class="var it30421" onMouseOver="hilite(30421)" onMouseOut="lolite()" onClick="logVariable('textsearch')" href="../../_variables/textsearch.html">$textsearch</a>, <a class="var it10070" onMouseOver="hilite(10070)" onMouseOut="lolite()" onClick="logVariable('competencyframeworkid')" href="../../_variables/competencyframeworkid.html">$competencyframeworkid</a>) {
<a name="l469"><span class="linenum"> 469</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l470"><span class="linenum"> 470</span></a>          <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency_framework')" href="../../_classes/competency_framework.html" onMouseOver="classPopup(event,'competency_framework')">competency_framework</a>(<a class="var it10070" onMouseOver="hilite(10070)" onMouseOut="lolite()" onClick="logVariable('competencyframeworkid')" href="../../_variables/competencyframeworkid.html">$competencyframeworkid</a>);
<a name="l471"><span class="linenum"> 471</span></a>  
<a name="l472"><span class="linenum"> 472</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l473"><span class="linenum"> 473</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>();
<a name="l474"><span class="linenum"> 474</span></a>          if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(array('moodle/competency:competencyview', 'moodle/competency:competencymanage'), <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l475"><span class="linenum"> 475</span></a>               throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:competencyview', 'nopermissions', '');
<a name="l476"><span class="linenum"> 476</span></a>          }
<a name="l477"><span class="linenum"> 477</span></a>  
<a name="l478"><span class="linenum"> 478</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l479"><span class="linenum"> 479</span></a>          <a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a> = <a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>::<a class="function" onClick="logFunction('search')" href="../../_functions/search.html" onMouseOver="funcPopup(event,'search')">search</a>(<a class="var it30421" onMouseOver="hilite(30421)" onMouseOut="lolite()" onClick="logVariable('textsearch')" href="../../_variables/textsearch.html">$textsearch</a>, <a class="var it10070" onMouseOver="hilite(10070)" onMouseOut="lolite()" onClick="logVariable('competencyframeworkid')" href="../../_variables/competencyframeworkid.html">$competencyframeworkid</a>);
<a name="l480"><span class="linenum"> 480</span></a>          return <a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a>;
<a name="l481"><span class="linenum"> 481</span></a>      }
<a name="l482"><span class="linenum"> 482</span></a>  
<a name="l483"><span class="linenum"> 483</span></a>      <span class="comment">/**</span>
<a name="l484"><span class="linenum"> 484</span></a>  <span class="comment">     * Perform a search based on the provided filters and return a paginated list of records.</span>
<a name="l485"><span class="linenum"> 485</span></a>  <span class="comment">     *</span>
<a name="l486"><span class="linenum"> 486</span></a>  <span class="comment">     * Requires moodle/competency:competencyview capability at some context.</span>
<a name="l487"><span class="linenum"> 487</span></a>  <span class="comment">     *</span>
<a name="l488"><span class="linenum"> 488</span></a>  <span class="comment">     * @param array $filters A list of filters to apply to the list.</span>
<a name="l489"><span class="linenum"> 489</span></a>  <span class="comment">     * @param string $sort The column to sort on</span>
<a name="l490"><span class="linenum"> 490</span></a>  <span class="comment">     * @param string $order ('ASC' or 'DESC')</span>
<a name="l491"><span class="linenum"> 491</span></a>  <span class="comment">     * @param int $skip Number of records to skip (pagination)</span>
<a name="l492"><span class="linenum"> 492</span></a>  <span class="comment">     * @param int $limit Max of records to return (pagination)</span>
<a name="l493"><span class="linenum"> 493</span></a>  <span class="comment">     * @return array of competencies</span>
<a name="l494"><span class="linenum"> 494</span></a>  <span class="comment">     */</span>
<a name="l495"><span class="linenum"> 495</span></a>      public static function <a class="function" onClick="logFunction('list_competencies')" href="../../_functions/list_competencies.html" onMouseOver="funcPopup(event,'list_competencies')">list_competencies</a>(<a class="var it655" onMouseOver="hilite(655)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a>, <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> = '', <a class="var it6270" onMouseOver="hilite(6270)" onMouseOut="lolite()" onClick="logVariable('order')" href="../../_variables/order.html">$order</a> = 'ASC', <a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('skip')" href="../../_variables/skip.html">$skip</a> = 0, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a> = 0) {
<a name="l496"><span class="linenum"> 496</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l497"><span class="linenum"> 497</span></a>          if (!isset(<a class="var it655" onMouseOver="hilite(655)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a>['competencyframeworkid'])) {
<a name="l498"><span class="linenum"> 498</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l499"><span class="linenum"> 499</span></a>          } else {
<a name="l500"><span class="linenum"> 500</span></a>              <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency_framework')" href="../../_classes/competency_framework.html" onMouseOver="classPopup(event,'competency_framework')">competency_framework</a>(<a class="var it655" onMouseOver="hilite(655)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a>['competencyframeworkid']);
<a name="l501"><span class="linenum"> 501</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>();
<a name="l502"><span class="linenum"> 502</span></a>          }
<a name="l503"><span class="linenum"> 503</span></a>  
<a name="l504"><span class="linenum"> 504</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l505"><span class="linenum"> 505</span></a>          if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(array('moodle/competency:competencyview', 'moodle/competency:competencymanage'), <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l506"><span class="linenum"> 506</span></a>               throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:competencyview', 'nopermissions', '');
<a name="l507"><span class="linenum"> 507</span></a>          }
<a name="l508"><span class="linenum"> 508</span></a>  
<a name="l509"><span class="linenum"> 509</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l510"><span class="linenum"> 510</span></a>          return <a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>::<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(<a class="var it655" onMouseOver="hilite(655)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a>, <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a>, <a class="var it6270" onMouseOver="hilite(6270)" onMouseOut="lolite()" onClick="logVariable('order')" href="../../_variables/order.html">$order</a>, <a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('skip')" href="../../_variables/skip.html">$skip</a>, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a>);
<a name="l511"><span class="linenum"> 511</span></a>      }
<a name="l512"><span class="linenum"> 512</span></a>  
<a name="l513"><span class="linenum"> 513</span></a>      <span class="comment">/**</span>
<a name="l514"><span class="linenum"> 514</span></a>  <span class="comment">     * Perform a search based on the provided filters and return a paginated list of records.</span>
<a name="l515"><span class="linenum"> 515</span></a>  <span class="comment">     *</span>
<a name="l516"><span class="linenum"> 516</span></a>  <span class="comment">     * Requires moodle/competency:competencyview capability at some context.</span>
<a name="l517"><span class="linenum"> 517</span></a>  <span class="comment">     *</span>
<a name="l518"><span class="linenum"> 518</span></a>  <span class="comment">     * @param array $filters A list of filters to apply to the list.</span>
<a name="l519"><span class="linenum"> 519</span></a>  <span class="comment">     * @return int</span>
<a name="l520"><span class="linenum"> 520</span></a>  <span class="comment">     */</span>
<a name="l521"><span class="linenum"> 521</span></a>      public static function <a class="function" onClick="logFunction('count_competencies')" href="../../_functions/count_competencies.html" onMouseOver="funcPopup(event,'count_competencies')">count_competencies</a>(<a class="var it655" onMouseOver="hilite(655)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a>) {
<a name="l522"><span class="linenum"> 522</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l523"><span class="linenum"> 523</span></a>          if (!isset(<a class="var it655" onMouseOver="hilite(655)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a>['competencyframeworkid'])) {
<a name="l524"><span class="linenum"> 524</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l525"><span class="linenum"> 525</span></a>          } else {
<a name="l526"><span class="linenum"> 526</span></a>              <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency_framework')" href="../../_classes/competency_framework.html" onMouseOver="classPopup(event,'competency_framework')">competency_framework</a>(<a class="var it655" onMouseOver="hilite(655)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a>['competencyframeworkid']);
<a name="l527"><span class="linenum"> 527</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>();
<a name="l528"><span class="linenum"> 528</span></a>          }
<a name="l529"><span class="linenum"> 529</span></a>  
<a name="l530"><span class="linenum"> 530</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l531"><span class="linenum"> 531</span></a>          if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(array('moodle/competency:competencyview', 'moodle/competency:competencymanage'), <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l532"><span class="linenum"> 532</span></a>               throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:competencyview', 'nopermissions', '');
<a name="l533"><span class="linenum"> 533</span></a>          }
<a name="l534"><span class="linenum"> 534</span></a>  
<a name="l535"><span class="linenum"> 535</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l536"><span class="linenum"> 536</span></a>          return <a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>::<a class="function" onClick="logFunction('count_records')" href="../../_functions/count_records.html" onMouseOver="funcPopup(event,'count_records')">count_records</a>(<a class="var it655" onMouseOver="hilite(655)" onMouseOut="lolite()" onClick="logVariable('filters')" href="../../_variables/filters.html">$filters</a>);
<a name="l537"><span class="linenum"> 537</span></a>      }
<a name="l538"><span class="linenum"> 538</span></a>  
<a name="l539"><span class="linenum"> 539</span></a>      <span class="comment">/**</span>
<a name="l540"><span class="linenum"> 540</span></a>  <span class="comment">     * Create a competency framework from a record containing all the data for the class.</span>
<a name="l541"><span class="linenum"> 541</span></a>  <span class="comment">     *</span>
<a name="l542"><span class="linenum"> 542</span></a>  <span class="comment">     * Requires moodle/competency:competencymanage capability at the system context.</span>
<a name="l543"><span class="linenum"> 543</span></a>  <span class="comment">     *</span>
<a name="l544"><span class="linenum"> 544</span></a>  <span class="comment">     * @param stdClass $record Record containing all the data for an instance of the class.</span>
<a name="l545"><span class="linenum"> 545</span></a>  <span class="comment">     * @return competency_framework</span>
<a name="l546"><span class="linenum"> 546</span></a>  <span class="comment">     */</span>
<a name="l547"><span class="linenum"> 547</span></a>      public static function <a class="function" onClick="logFunction('create_framework')" href="../../_functions/create_framework.html" onMouseOver="funcPopup(event,'create_framework')">create_framework</a>(stdClass <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>) {
<a name="l548"><span class="linenum"> 548</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l549"><span class="linenum"> 549</span></a>          <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency_framework')" href="../../_classes/competency_framework.html" onMouseOver="classPopup(event,'competency_framework')">competency_framework</a>(0, <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>);
<a name="l550"><span class="linenum"> 550</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:competencymanage', <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>());
<a name="l551"><span class="linenum"> 551</span></a>  
<a name="l552"><span class="linenum"> 552</span></a>  <span class="comment">        // Account for different formats of taxonomies.</span>
<a name="l553"><span class="linenum"> 553</span></a>          if (isset(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('taxonomies')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/taxonomies.html">taxonomies</a>)) {
<a name="l554"><span class="linenum"> 554</span></a>              <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;<a class="function" onClick="logFunction('set_taxonomies')" href="../../_functions/set_taxonomies.html" onMouseOver="funcPopup(event,'set_taxonomies')">set_taxonomies</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('taxonomies')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/taxonomies.html">taxonomies</a>);
<a name="l555"><span class="linenum"> 555</span></a>          }
<a name="l556"><span class="linenum"> 556</span></a>  
<a name="l557"><span class="linenum"> 557</span></a>          <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a> = <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l558"><span class="linenum"> 558</span></a>  
<a name="l559"><span class="linenum"> 559</span></a>  <span class="comment">        // Trigger a competency framework created event.</span>
<a name="l560"><span class="linenum"> 560</span></a>          \core\event\<a class="class" onClick="logClass('competency_framework_created')" href="../../_classes/competency_framework_created.html" onMouseOver="classPopup(event,'competency_framework_created')">competency_framework_created</a>::<a class="function" onClick="logFunction('create_from_framework')" href="../../_functions/create_from_framework.html" onMouseOver="funcPopup(event,'create_from_framework')">create_from_framework</a>(<a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l561"><span class="linenum"> 561</span></a>  
<a name="l562"><span class="linenum"> 562</span></a>          return <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>;
<a name="l563"><span class="linenum"> 563</span></a>      }
<a name="l564"><span class="linenum"> 564</span></a>  
<a name="l565"><span class="linenum"> 565</span></a>      <span class="comment">/**</span>
<a name="l566"><span class="linenum"> 566</span></a>  <span class="comment">     * Duplicate a competency framework by id.</span>
<a name="l567"><span class="linenum"> 567</span></a>  <span class="comment">     *</span>
<a name="l568"><span class="linenum"> 568</span></a>  <span class="comment">     * Requires moodle/competency:competencymanage capability at the system context.</span>
<a name="l569"><span class="linenum"> 569</span></a>  <span class="comment">     *</span>
<a name="l570"><span class="linenum"> 570</span></a>  <span class="comment">     * @param int $id The record to duplicate. All competencies associated and related will be duplicated.</span>
<a name="l571"><span class="linenum"> 571</span></a>  <span class="comment">     * @return competency_framework the framework duplicated</span>
<a name="l572"><span class="linenum"> 572</span></a>  <span class="comment">     */</span>
<a name="l573"><span class="linenum"> 573</span></a>      public static function <a class="function" onClick="logFunction('duplicate_framework')" href="../../_functions/duplicate_framework.html" onMouseOver="funcPopup(event,'duplicate_framework')">duplicate_framework</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>) {
<a name="l574"><span class="linenum"> 574</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l575"><span class="linenum"> 575</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l576"><span class="linenum"> 576</span></a>  
<a name="l577"><span class="linenum"> 577</span></a>          <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency_framework')" href="../../_classes/competency_framework.html" onMouseOver="classPopup(event,'competency_framework')">competency_framework</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);
<a name="l578"><span class="linenum"> 578</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:competencymanage', <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>());
<a name="l579"><span class="linenum"> 579</span></a>  <span class="comment">        // Starting transaction.</span>
<a name="l580"><span class="linenum"> 580</span></a>          <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l581"><span class="linenum"> 581</span></a>  
<a name="l582"><span class="linenum"> 582</span></a>          try {
<a name="l583"><span class="linenum"> 583</span></a>  <span class="comment">            // Get a uniq idnumber based on the origin framework.</span>
<a name="l584"><span class="linenum"> 584</span></a>              <a class="var it312" onMouseOver="hilite(312)" onMouseOut="lolite()" onClick="logVariable('idnumber')" href="../../_variables/idnumber.html">$idnumber</a> = <a class="class" onClick="logClass('competency_framework')" href="../../_classes/competency_framework.html" onMouseOver="classPopup(event,'competency_framework')">competency_framework</a>::<a class="function" onClick="logFunction('get_unused_idnumber')" href="../../_functions/get_unused_idnumber.html" onMouseOver="funcPopup(event,'get_unused_idnumber')">get_unused_idnumber</a>(<a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;<a class="function" onClick="logFunction('get_idnumber')" href="../../_functions/get_idnumber.html" onMouseOver="funcPopup(event,'get_idnumber')">get_idnumber</a>());
<a name="l585"><span class="linenum"> 585</span></a>              <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;set_idnumber(<a class="var it312" onMouseOver="hilite(312)" onMouseOut="lolite()" onClick="logVariable('idnumber')" href="../../_variables/idnumber.html">$idnumber</a>);
<a name="l586"><span class="linenum"> 586</span></a>  <span class="comment">            // Adding the suffix copy to the shortname.</span>
<a name="l587"><span class="linenum"> 587</span></a>              <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;set_shortname(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('duplicateditemname', 'core_competency', <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;<a class="function" onClick="logFunction('get_shortname')" href="../../_functions/get_shortname.html" onMouseOver="funcPopup(event,'get_shortname')">get_shortname</a>()));
<a name="l588"><span class="linenum"> 588</span></a>              <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;<a class="function" onClick="logFunction('set_id')" href="../../_functions/set_id.html" onMouseOver="funcPopup(event,'set_id')">set_id</a>(0);
<a name="l589"><span class="linenum"> 589</span></a>              <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a> = <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l590"><span class="linenum"> 590</span></a>  
<a name="l591"><span class="linenum"> 591</span></a>  <span class="comment">            // Array that match the old competencies ids with the new one to use when copying related competencies.</span>
<a name="l592"><span class="linenum"> 592</span></a>              <a class="var it30423" onMouseOver="hilite(30423)" onMouseOut="lolite()" onClick="logVariable('frameworkcompetency')" href="../../_variables/frameworkcompetency.html">$frameworkcompetency</a> = <a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>::<a class="function" onClick="logFunction('get_framework_tree')" href="../../_functions/get_framework_tree.html" onMouseOver="funcPopup(event,'get_framework_tree')">get_framework_tree</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);
<a name="l593"><span class="linenum"> 593</span></a>              <a class="var it23844" onMouseOver="hilite(23844)" onMouseOut="lolite()" onClick="logVariable('matchids')" href="../../_variables/matchids.html">$matchids</a> = self::<a class="function" onClick="logFunction('duplicate_competency_tree')" href="../../_functions/duplicate_competency_tree.html" onMouseOver="funcPopup(event,'duplicate_competency_tree')">duplicate_competency_tree</a>(<a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(), <a class="var it30423" onMouseOver="hilite(30423)" onMouseOut="lolite()" onClick="logVariable('frameworkcompetency')" href="../../_variables/frameworkcompetency.html">$frameworkcompetency</a>, 0, 0);
<a name="l594"><span class="linenum"> 594</span></a>  
<a name="l595"><span class="linenum"> 595</span></a>  <span class="comment">            // Copy the related competencies.</span>
<a name="l596"><span class="linenum"> 596</span></a>              <a class="var it30424" onMouseOver="hilite(30424)" onMouseOut="lolite()" onClick="logVariable('relcomps')" href="../../_variables/relcomps.html">$relcomps</a> = <a class="class" onClick="logClass('related_competency')" href="../../_classes/related_competency.html" onMouseOver="classPopup(event,'related_competency')">related_competency</a>::<a class="function" onClick="logFunction('get_multiple_relations')" href="../../_functions/get_multiple_relations.html" onMouseOver="funcPopup(event,'get_multiple_relations')">get_multiple_relations</a>(<a class="phpfunction" onClick="logFunction('array_keys')" href="../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it23844" onMouseOver="hilite(23844)" onMouseOut="lolite()" onClick="logVariable('matchids')" href="../../_variables/matchids.html">$matchids</a>));
<a name="l597"><span class="linenum"> 597</span></a>  
<a name="l598"><span class="linenum"> 598</span></a>              foreach (<a class="var it30424" onMouseOver="hilite(30424)" onMouseOut="lolite()" onClick="logVariable('relcomps')" href="../../_variables/relcomps.html">$relcomps</a> as <a class="var it30425" onMouseOver="hilite(30425)" onMouseOut="lolite()" onClick="logVariable('relcomp')" href="../../_variables/relcomp.html">$relcomp</a>) {
<a name="l599"><span class="linenum"> 599</span></a>                  <a class="var it25410" onMouseOver="hilite(25410)" onMouseOut="lolite()" onClick="logVariable('compid')" href="../../_variables/compid.html">$compid</a> = <a class="var it30425" onMouseOver="hilite(30425)" onMouseOut="lolite()" onClick="logVariable('relcomp')" href="../../_variables/relcomp.html">$relcomp</a>-&gt;get_competencyid();
<a name="l600"><span class="linenum"> 600</span></a>                  <a class="var it30426" onMouseOver="hilite(30426)" onMouseOut="lolite()" onClick="logVariable('relcompid')" href="../../_variables/relcompid.html">$relcompid</a> = <a class="var it30425" onMouseOver="hilite(30425)" onMouseOut="lolite()" onClick="logVariable('relcomp')" href="../../_variables/relcomp.html">$relcomp</a>-&gt;get_relatedcompetencyid();
<a name="l601"><span class="linenum"> 601</span></a>                  if (isset(<a class="var it23844" onMouseOver="hilite(23844)" onMouseOut="lolite()" onClick="logVariable('matchids')" href="../../_variables/matchids.html">$matchids</a>[<a class="var it25410" onMouseOver="hilite(25410)" onMouseOut="lolite()" onClick="logVariable('compid')" href="../../_variables/compid.html">$compid</a>]) &amp;&amp; isset(<a class="var it23844" onMouseOver="hilite(23844)" onMouseOut="lolite()" onClick="logVariable('matchids')" href="../../_variables/matchids.html">$matchids</a>[<a class="var it30426" onMouseOver="hilite(30426)" onMouseOut="lolite()" onClick="logVariable('relcompid')" href="../../_variables/relcompid.html">$relcompid</a>])) {
<a name="l602"><span class="linenum"> 602</span></a>                      <a class="var it30427" onMouseOver="hilite(30427)" onMouseOut="lolite()" onClick="logVariable('newcompid')" href="../../_variables/newcompid.html">$newcompid</a> = <a class="var it23844" onMouseOver="hilite(23844)" onMouseOut="lolite()" onClick="logVariable('matchids')" href="../../_variables/matchids.html">$matchids</a>[<a class="var it25410" onMouseOver="hilite(25410)" onMouseOut="lolite()" onClick="logVariable('compid')" href="../../_variables/compid.html">$compid</a>]-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>();
<a name="l603"><span class="linenum"> 603</span></a>                      <a class="var it30428" onMouseOver="hilite(30428)" onMouseOut="lolite()" onClick="logVariable('newrelcompid')" href="../../_variables/newrelcompid.html">$newrelcompid</a> = <a class="var it23844" onMouseOver="hilite(23844)" onMouseOut="lolite()" onClick="logVariable('matchids')" href="../../_variables/matchids.html">$matchids</a>[<a class="var it30426" onMouseOver="hilite(30426)" onMouseOut="lolite()" onClick="logVariable('relcompid')" href="../../_variables/relcompid.html">$relcompid</a>]-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>();
<a name="l604"><span class="linenum"> 604</span></a>                      if (<a class="var it30427" onMouseOver="hilite(30427)" onMouseOut="lolite()" onClick="logVariable('newcompid')" href="../../_variables/newcompid.html">$newcompid</a> &lt; <a class="var it30428" onMouseOver="hilite(30428)" onMouseOut="lolite()" onClick="logVariable('newrelcompid')" href="../../_variables/newrelcompid.html">$newrelcompid</a>) {
<a name="l605"><span class="linenum"> 605</span></a>                          <a class="var it30425" onMouseOver="hilite(30425)" onMouseOut="lolite()" onClick="logVariable('relcomp')" href="../../_variables/relcomp.html">$relcomp</a>-&gt;set_competencyid(<a class="var it30427" onMouseOver="hilite(30427)" onMouseOut="lolite()" onClick="logVariable('newcompid')" href="../../_variables/newcompid.html">$newcompid</a>);
<a name="l606"><span class="linenum"> 606</span></a>                          <a class="var it30425" onMouseOver="hilite(30425)" onMouseOut="lolite()" onClick="logVariable('relcomp')" href="../../_variables/relcomp.html">$relcomp</a>-&gt;set_relatedcompetencyid(<a class="var it30428" onMouseOver="hilite(30428)" onMouseOut="lolite()" onClick="logVariable('newrelcompid')" href="../../_variables/newrelcompid.html">$newrelcompid</a>);
<a name="l607"><span class="linenum"> 607</span></a>                      } else {
<a name="l608"><span class="linenum"> 608</span></a>                          <a class="var it30425" onMouseOver="hilite(30425)" onMouseOut="lolite()" onClick="logVariable('relcomp')" href="../../_variables/relcomp.html">$relcomp</a>-&gt;set_competencyid(<a class="var it30428" onMouseOver="hilite(30428)" onMouseOut="lolite()" onClick="logVariable('newrelcompid')" href="../../_variables/newrelcompid.html">$newrelcompid</a>);
<a name="l609"><span class="linenum"> 609</span></a>                          <a class="var it30425" onMouseOver="hilite(30425)" onMouseOut="lolite()" onClick="logVariable('relcomp')" href="../../_variables/relcomp.html">$relcomp</a>-&gt;set_relatedcompetencyid(<a class="var it30427" onMouseOver="hilite(30427)" onMouseOut="lolite()" onClick="logVariable('newcompid')" href="../../_variables/newcompid.html">$newcompid</a>);
<a name="l610"><span class="linenum"> 610</span></a>                      }
<a name="l611"><span class="linenum"> 611</span></a>                      <a class="var it30425" onMouseOver="hilite(30425)" onMouseOut="lolite()" onClick="logVariable('relcomp')" href="../../_variables/relcomp.html">$relcomp</a>-&gt;<a class="function" onClick="logFunction('set_id')" href="../../_functions/set_id.html" onMouseOver="funcPopup(event,'set_id')">set_id</a>(0);
<a name="l612"><span class="linenum"> 612</span></a>                      <a class="var it30425" onMouseOver="hilite(30425)" onMouseOut="lolite()" onClick="logVariable('relcomp')" href="../../_variables/relcomp.html">$relcomp</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l613"><span class="linenum"> 613</span></a>                  } else {
<a name="l614"><span class="linenum"> 614</span></a>  <span class="comment">                    // Debugging message when there is no match found.</span>
<a name="l615"><span class="linenum"> 615</span></a>                      <a class="function" onClick="logFunction('debugging')" href="../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('related competency id not found');
<a name="l616"><span class="linenum"> 616</span></a>                  }
<a name="l617"><span class="linenum"> 617</span></a>              }
<a name="l618"><span class="linenum"> 618</span></a>  
<a name="l619"><span class="linenum"> 619</span></a>  <span class="comment">            // Setting rules on duplicated competencies.</span>
<a name="l620"><span class="linenum"> 620</span></a>              self::<a class="function" onClick="logFunction('migrate_competency_tree_rules')" href="../../_functions/migrate_competency_tree_rules.html" onMouseOver="funcPopup(event,'migrate_competency_tree_rules')">migrate_competency_tree_rules</a>(<a class="var it30423" onMouseOver="hilite(30423)" onMouseOut="lolite()" onClick="logVariable('frameworkcompetency')" href="../../_variables/frameworkcompetency.html">$frameworkcompetency</a>, <a class="var it23844" onMouseOver="hilite(23844)" onMouseOut="lolite()" onClick="logVariable('matchids')" href="../../_variables/matchids.html">$matchids</a>);
<a name="l621"><span class="linenum"> 621</span></a>  
<a name="l622"><span class="linenum"> 622</span></a>              <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l623"><span class="linenum"> 623</span></a>  
<a name="l624"><span class="linenum"> 624</span></a>          } catch (\Exception <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>) {
<a name="l625"><span class="linenum"> 625</span></a>              <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('rollback')" href="../../_functions/rollback.html" onMouseOver="funcPopup(event,'rollback')">rollback</a>(<a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>);
<a name="l626"><span class="linenum"> 626</span></a>          }
<a name="l627"><span class="linenum"> 627</span></a>  
<a name="l628"><span class="linenum"> 628</span></a>  <span class="comment">        // Trigger a competency framework created event.</span>
<a name="l629"><span class="linenum"> 629</span></a>          \core\event\<a class="class" onClick="logClass('competency_framework_created')" href="../../_classes/competency_framework_created.html" onMouseOver="classPopup(event,'competency_framework_created')">competency_framework_created</a>::<a class="function" onClick="logFunction('create_from_framework')" href="../../_functions/create_from_framework.html" onMouseOver="funcPopup(event,'create_from_framework')">create_from_framework</a>(<a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l630"><span class="linenum"> 630</span></a>  
<a name="l631"><span class="linenum"> 631</span></a>          return <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>;
<a name="l632"><span class="linenum"> 632</span></a>      }
<a name="l633"><span class="linenum"> 633</span></a>  
<a name="l634"><span class="linenum"> 634</span></a>      <span class="comment">/**</span>
<a name="l635"><span class="linenum"> 635</span></a>  <span class="comment">     * Delete a competency framework by id.</span>
<a name="l636"><span class="linenum"> 636</span></a>  <span class="comment">     *</span>
<a name="l637"><span class="linenum"> 637</span></a>  <span class="comment">     * Requires moodle/competency:competencymanage capability at the system context.</span>
<a name="l638"><span class="linenum"> 638</span></a>  <span class="comment">     *</span>
<a name="l639"><span class="linenum"> 639</span></a>  <span class="comment">     * @param int $id The record to delete. This will delete alot of related data - you better be sure.</span>
<a name="l640"><span class="linenum"> 640</span></a>  <span class="comment">     * @return boolean</span>
<a name="l641"><span class="linenum"> 641</span></a>  <span class="comment">     */</span>
<a name="l642"><span class="linenum"> 642</span></a>      public static function <a class="function" onClick="logFunction('delete_framework')" href="../../_functions/delete_framework.html" onMouseOver="funcPopup(event,'delete_framework')">delete_framework</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>) {
<a name="l643"><span class="linenum"> 643</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l644"><span class="linenum"> 644</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l645"><span class="linenum"> 645</span></a>          <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency_framework')" href="../../_classes/competency_framework.html" onMouseOver="classPopup(event,'competency_framework')">competency_framework</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);
<a name="l646"><span class="linenum"> 646</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:competencymanage', <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>());
<a name="l647"><span class="linenum"> 647</span></a>  
<a name="l648"><span class="linenum"> 648</span></a>          <a class="var it837" onMouseOver="hilite(837)" onMouseOut="lolite()" onClick="logVariable('events')" href="../../_variables/events.html">$events</a> = array();
<a name="l649"><span class="linenum"> 649</span></a>          <a class="var it30429" onMouseOver="hilite(30429)" onMouseOut="lolite()" onClick="logVariable('competenciesid')" href="../../_variables/competenciesid.html">$competenciesid</a> = <a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>::<a class="function" onClick="logFunction('get_ids_by_frameworkid')" href="../../_functions/get_ids_by_frameworkid.html" onMouseOver="funcPopup(event,'get_ids_by_frameworkid')">get_ids_by_frameworkid</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);
<a name="l650"><span class="linenum"> 650</span></a>          <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a> = <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;<a class="function" onClick="logFunction('get_contextid')" href="../../_functions/get_contextid.html" onMouseOver="funcPopup(event,'get_contextid')">get_contextid</a>();
<a name="l651"><span class="linenum"> 651</span></a>          if (!<a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>::<a class="function" onClick="logFunction('can_all_be_deleted')" href="../../_functions/can_all_be_deleted.html" onMouseOver="funcPopup(event,'can_all_be_deleted')">can_all_be_deleted</a>(<a class="var it30429" onMouseOver="hilite(30429)" onMouseOut="lolite()" onClick="logVariable('competenciesid')" href="../../_variables/competenciesid.html">$competenciesid</a>)) {
<a name="l652"><span class="linenum"> 652</span></a>              return false;
<a name="l653"><span class="linenum"> 653</span></a>          }
<a name="l654"><span class="linenum"> 654</span></a>          <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l655"><span class="linenum"> 655</span></a>          try {
<a name="l656"><span class="linenum"> 656</span></a>              if (!empty(<a class="var it30429" onMouseOver="hilite(30429)" onMouseOut="lolite()" onClick="logVariable('competenciesid')" href="../../_variables/competenciesid.html">$competenciesid</a>)) {
<a name="l657"><span class="linenum"> 657</span></a>  <span class="comment">                // Delete competencies.</span>
<a name="l658"><span class="linenum"> 658</span></a>                  <a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>::<a class="function" onClick="logFunction('delete_by_frameworkid')" href="../../_functions/delete_by_frameworkid.html" onMouseOver="funcPopup(event,'delete_by_frameworkid')">delete_by_frameworkid</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);
<a name="l659"><span class="linenum"> 659</span></a>  
<a name="l660"><span class="linenum"> 660</span></a>  <span class="comment">                // Delete the related competencies.</span>
<a name="l661"><span class="linenum"> 661</span></a>                  <a class="class" onClick="logClass('related_competency')" href="../../_classes/related_competency.html" onMouseOver="classPopup(event,'related_competency')">related_competency</a>::<a class="function" onClick="logFunction('delete_multiple_relations')" href="../../_functions/delete_multiple_relations.html" onMouseOver="funcPopup(event,'delete_multiple_relations')">delete_multiple_relations</a>(<a class="var it30429" onMouseOver="hilite(30429)" onMouseOut="lolite()" onClick="logVariable('competenciesid')" href="../../_variables/competenciesid.html">$competenciesid</a>);
<a name="l662"><span class="linenum"> 662</span></a>  
<a name="l663"><span class="linenum"> 663</span></a>  <span class="comment">                // Delete the evidences for competencies.</span>
<a name="l664"><span class="linenum"> 664</span></a>                  <a class="class" onClick="logClass('user_evidence_competency')" href="../../_classes/user_evidence_competency.html" onMouseOver="classPopup(event,'user_evidence_competency')">user_evidence_competency</a>::<a class="function" onClick="logFunction('delete_by_competencyids')" href="../../_functions/delete_by_competencyids.html" onMouseOver="funcPopup(event,'delete_by_competencyids')">delete_by_competencyids</a>(<a class="var it30429" onMouseOver="hilite(30429)" onMouseOut="lolite()" onClick="logVariable('competenciesid')" href="../../_variables/competenciesid.html">$competenciesid</a>);
<a name="l665"><span class="linenum"> 665</span></a>              }
<a name="l666"><span class="linenum"> 666</span></a>  
<a name="l667"><span class="linenum"> 667</span></a>  <span class="comment">            // Create a competency framework deleted event.</span>
<a name="l668"><span class="linenum"> 668</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('competency_framework_deleted')" href="../../_classes/competency_framework_deleted.html" onMouseOver="classPopup(event,'competency_framework_deleted')">competency_framework_deleted</a>::<a class="function" onClick="logFunction('create_from_framework')" href="../../_functions/create_from_framework.html" onMouseOver="funcPopup(event,'create_from_framework')">create_from_framework</a>(<a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>);
<a name="l669"><span class="linenum"> 669</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l670"><span class="linenum"> 670</span></a>  
<a name="l671"><span class="linenum"> 671</span></a>  <span class="comment">            // Register the deleted events competencies.</span>
<a name="l672"><span class="linenum"> 672</span></a>              <a class="var it837" onMouseOver="hilite(837)" onMouseOut="lolite()" onClick="logVariable('events')" href="../../_variables/events.html">$events</a> = \core\event\<a class="class" onClick="logClass('competency_deleted')" href="../../_classes/competency_deleted.html" onMouseOver="classPopup(event,'competency_deleted')">competency_deleted</a>::<a class="function" onClick="logFunction('create_multiple_from_competencyids')" href="../../_functions/create_multiple_from_competencyids.html" onMouseOver="funcPopup(event,'create_multiple_from_competencyids')">create_multiple_from_competencyids</a>(<a class="var it30429" onMouseOver="hilite(30429)" onMouseOut="lolite()" onClick="logVariable('competenciesid')" href="../../_variables/competenciesid.html">$competenciesid</a>, <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>);
<a name="l673"><span class="linenum"> 673</span></a>  
<a name="l674"><span class="linenum"> 674</span></a>          } catch (\Exception <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>) {
<a name="l675"><span class="linenum"> 675</span></a>              <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('rollback')" href="../../_functions/rollback.html" onMouseOver="funcPopup(event,'rollback')">rollback</a>(<a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>);
<a name="l676"><span class="linenum"> 676</span></a>          }
<a name="l677"><span class="linenum"> 677</span></a>  
<a name="l678"><span class="linenum"> 678</span></a>  <span class="comment">        // Commit the transaction.</span>
<a name="l679"><span class="linenum"> 679</span></a>          <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l680"><span class="linenum"> 680</span></a>  
<a name="l681"><span class="linenum"> 681</span></a>  <span class="comment">        // If all operations are successfull then trigger the delete event.</span>
<a name="l682"><span class="linenum"> 682</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l683"><span class="linenum"> 683</span></a>  
<a name="l684"><span class="linenum"> 684</span></a>  <span class="comment">        // Trigger deleted event competencies.</span>
<a name="l685"><span class="linenum"> 685</span></a>          foreach (<a class="var it837" onMouseOver="hilite(837)" onMouseOut="lolite()" onClick="logVariable('events')" href="../../_variables/events.html">$events</a> as <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>) {
<a name="l686"><span class="linenum"> 686</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l687"><span class="linenum"> 687</span></a>          }
<a name="l688"><span class="linenum"> 688</span></a>  
<a name="l689"><span class="linenum"> 689</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l690"><span class="linenum"> 690</span></a>      }
<a name="l691"><span class="linenum"> 691</span></a>  
<a name="l692"><span class="linenum"> 692</span></a>      <span class="comment">/**</span>
<a name="l693"><span class="linenum"> 693</span></a>  <span class="comment">     * Update the details for a competency framework.</span>
<a name="l694"><span class="linenum"> 694</span></a>  <span class="comment">     *</span>
<a name="l695"><span class="linenum"> 695</span></a>  <span class="comment">     * Requires moodle/competency:competencymanage capability at the system context.</span>
<a name="l696"><span class="linenum"> 696</span></a>  <span class="comment">     *</span>
<a name="l697"><span class="linenum"> 697</span></a>  <span class="comment">     * @param stdClass $record The new details for the framework. Note - must contain an id that points to the framework to update.</span>
<a name="l698"><span class="linenum"> 698</span></a>  <span class="comment">     * @return boolean</span>
<a name="l699"><span class="linenum"> 699</span></a>  <span class="comment">     */</span>
<a name="l700"><span class="linenum"> 700</span></a>      public static function <a class="function" onClick="logFunction('update_framework')" href="../../_functions/update_framework.html" onMouseOver="funcPopup(event,'update_framework')">update_framework</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>) {
<a name="l701"><span class="linenum"> 701</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l702"><span class="linenum"> 702</span></a>          <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency_framework')" href="../../_classes/competency_framework.html" onMouseOver="classPopup(event,'competency_framework')">competency_framework</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l703"><span class="linenum"> 703</span></a>  
<a name="l704"><span class="linenum"> 704</span></a>  <span class="comment">        // Check the permissions before update.</span>
<a name="l705"><span class="linenum"> 705</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:competencymanage', <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>());
<a name="l706"><span class="linenum"> 706</span></a>  
<a name="l707"><span class="linenum"> 707</span></a>  <span class="comment">        // Account for different formats of taxonomies.</span>
<a name="l708"><span class="linenum"> 708</span></a>          <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;<a class="function" onClick="logFunction('from_record')" href="../../_functions/from_record.html" onMouseOver="funcPopup(event,'from_record')">from_record</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>);
<a name="l709"><span class="linenum"> 709</span></a>          if (isset(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('taxonomies')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/taxonomies.html">taxonomies</a>)) {
<a name="l710"><span class="linenum"> 710</span></a>              <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;<a class="function" onClick="logFunction('set_taxonomies')" href="../../_functions/set_taxonomies.html" onMouseOver="funcPopup(event,'set_taxonomies')">set_taxonomies</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('taxonomies')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/taxonomies.html">taxonomies</a>);
<a name="l711"><span class="linenum"> 711</span></a>          }
<a name="l712"><span class="linenum"> 712</span></a>  
<a name="l713"><span class="linenum"> 713</span></a>  <span class="comment">        // Trigger a competency framework updated event.</span>
<a name="l714"><span class="linenum"> 714</span></a>          \core\event\<a class="class" onClick="logClass('competency_framework_updated')" href="../../_classes/competency_framework_updated.html" onMouseOver="classPopup(event,'competency_framework_updated')">competency_framework_updated</a>::<a class="function" onClick="logFunction('create_from_framework')" href="../../_functions/create_from_framework.html" onMouseOver="funcPopup(event,'create_from_framework')">create_from_framework</a>(<a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l715"><span class="linenum"> 715</span></a>  
<a name="l716"><span class="linenum"> 716</span></a>          return <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l717"><span class="linenum"> 717</span></a>      }
<a name="l718"><span class="linenum"> 718</span></a>  
<a name="l719"><span class="linenum"> 719</span></a>      <span class="comment">/**</span>
<a name="l720"><span class="linenum"> 720</span></a>  <span class="comment">     * Read a the details for a single competency framework and return a record.</span>
<a name="l721"><span class="linenum"> 721</span></a>  <span class="comment">     *</span>
<a name="l722"><span class="linenum"> 722</span></a>  <span class="comment">     * Requires moodle/competency:competencyview capability at the system context.</span>
<a name="l723"><span class="linenum"> 723</span></a>  <span class="comment">     *</span>
<a name="l724"><span class="linenum"> 724</span></a>  <span class="comment">     * @param int $id The id of the framework to read.</span>
<a name="l725"><span class="linenum"> 725</span></a>  <span class="comment">     * @return competency_framework</span>
<a name="l726"><span class="linenum"> 726</span></a>  <span class="comment">     */</span>
<a name="l727"><span class="linenum"> 727</span></a>      public static function <a class="function" onClick="logFunction('read_framework')" href="../../_functions/read_framework.html" onMouseOver="funcPopup(event,'read_framework')">read_framework</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>) {
<a name="l728"><span class="linenum"> 728</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l729"><span class="linenum"> 729</span></a>          <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency_framework')" href="../../_classes/competency_framework.html" onMouseOver="classPopup(event,'competency_framework')">competency_framework</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);
<a name="l730"><span class="linenum"> 730</span></a>          if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(array('moodle/competency:competencyview', 'moodle/competency:competencymanage'),
<a name="l731"><span class="linenum"> 731</span></a>                  <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>())) {
<a name="l732"><span class="linenum"> 732</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:competencyview',
<a name="l733"><span class="linenum"> 733</span></a>                  'nopermissions', '');
<a name="l734"><span class="linenum"> 734</span></a>          }
<a name="l735"><span class="linenum"> 735</span></a>          return <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>;
<a name="l736"><span class="linenum"> 736</span></a>      }
<a name="l737"><span class="linenum"> 737</span></a>  
<a name="l738"><span class="linenum"> 738</span></a>      <span class="comment">/**</span>
<a name="l739"><span class="linenum"> 739</span></a>  <span class="comment">     * Logg the competency framework viewed event.</span>
<a name="l740"><span class="linenum"> 740</span></a>  <span class="comment">     *</span>
<a name="l741"><span class="linenum"> 741</span></a>  <span class="comment">     * @param competency_framework|int $frameworkorid The competency_framework object or competency framework id</span>
<a name="l742"><span class="linenum"> 742</span></a>  <span class="comment">     * @return bool</span>
<a name="l743"><span class="linenum"> 743</span></a>  <span class="comment">     */</span>
<a name="l744"><span class="linenum"> 744</span></a>      public static function <a class="function" onClick="logFunction('competency_framework_viewed')" href="../../_functions/competency_framework_viewed.html" onMouseOver="funcPopup(event,'competency_framework_viewed')">competency_framework_viewed</a>(<a class="var it30430" onMouseOver="hilite(30430)" onMouseOut="lolite()" onClick="logVariable('frameworkorid')" href="../../_variables/frameworkorid.html">$frameworkorid</a>) {
<a name="l745"><span class="linenum"> 745</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l746"><span class="linenum"> 746</span></a>          <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a> = <a class="var it30430" onMouseOver="hilite(30430)" onMouseOut="lolite()" onClick="logVariable('frameworkorid')" href="../../_variables/frameworkorid.html">$frameworkorid</a>;
<a name="l747"><span class="linenum"> 747</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>)) {
<a name="l748"><span class="linenum"> 748</span></a>              <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency_framework')" href="../../_classes/competency_framework.html" onMouseOver="classPopup(event,'competency_framework')">competency_framework</a>(<a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>);
<a name="l749"><span class="linenum"> 749</span></a>          }
<a name="l750"><span class="linenum"> 750</span></a>          if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(array('moodle/competency:competencyview', 'moodle/competency:competencymanage'),
<a name="l751"><span class="linenum"> 751</span></a>                  <a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>())) {
<a name="l752"><span class="linenum"> 752</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:competencyview',
<a name="l753"><span class="linenum"> 753</span></a>                  'nopermissions', '');
<a name="l754"><span class="linenum"> 754</span></a>          }
<a name="l755"><span class="linenum"> 755</span></a>          \core\event\<a class="class" onClick="logClass('competency_framework_viewed')" href="../../_classes/competency_framework_viewed.html" onMouseOver="classPopup(event,'competency_framework_viewed')">competency_framework_viewed</a>::<a class="function" onClick="logFunction('create_from_framework')" href="../../_functions/create_from_framework.html" onMouseOver="funcPopup(event,'create_from_framework')">create_from_framework</a>(<a class="var it2285" onMouseOver="hilite(2285)" onMouseOut="lolite()" onClick="logVariable('framework')" href="../../_variables/framework.html">$framework</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l756"><span class="linenum"> 756</span></a>          return true;
<a name="l757"><span class="linenum"> 757</span></a>      }
<a name="l758"><span class="linenum"> 758</span></a>  
<a name="l759"><span class="linenum"> 759</span></a>      <span class="comment">/**</span>
<a name="l760"><span class="linenum"> 760</span></a>  <span class="comment">     * Logg the competency viewed event.</span>
<a name="l761"><span class="linenum"> 761</span></a>  <span class="comment">     *</span>
<a name="l762"><span class="linenum"> 762</span></a>  <span class="comment">     * @param competency|int $competencyorid The competency object or competency id</span>
<a name="l763"><span class="linenum"> 763</span></a>  <span class="comment">     * @return bool</span>
<a name="l764"><span class="linenum"> 764</span></a>  <span class="comment">     */</span>
<a name="l765"><span class="linenum"> 765</span></a>      public static function <a class="function" onClick="logFunction('competency_viewed')" href="../../_functions/competency_viewed.html" onMouseOver="funcPopup(event,'competency_viewed')">competency_viewed</a>(<a class="var it30431" onMouseOver="hilite(30431)" onMouseOut="lolite()" onClick="logVariable('competencyorid')" href="../../_variables/competencyorid.html">$competencyorid</a>) {
<a name="l766"><span class="linenum"> 766</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l767"><span class="linenum"> 767</span></a>          <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <a class="var it30431" onMouseOver="hilite(30431)" onMouseOut="lolite()" onClick="logVariable('competencyorid')" href="../../_variables/competencyorid.html">$competencyorid</a>;
<a name="l768"><span class="linenum"> 768</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>)) {
<a name="l769"><span class="linenum"> 769</span></a>              <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>(<a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>);
<a name="l770"><span class="linenum"> 770</span></a>          }
<a name="l771"><span class="linenum"> 771</span></a>  
<a name="l772"><span class="linenum"> 772</span></a>          if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(array('moodle/competency:competencyview', 'moodle/competency:competencymanage'),
<a name="l773"><span class="linenum"> 773</span></a>                  <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>())) {
<a name="l774"><span class="linenum"> 774</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:competencyview',
<a name="l775"><span class="linenum"> 775</span></a>                  'nopermissions', '');
<a name="l776"><span class="linenum"> 776</span></a>          }
<a name="l777"><span class="linenum"> 777</span></a>  
<a name="l778"><span class="linenum"> 778</span></a>          \core\event\<a class="class" onClick="logClass('competency_viewed')" href="../../_classes/competency_viewed.html" onMouseOver="classPopup(event,'competency_viewed')">competency_viewed</a>::<a class="function" onClick="logFunction('create_from_competency')" href="../../_functions/create_from_competency.html" onMouseOver="funcPopup(event,'create_from_competency')">create_from_competency</a>(<a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l779"><span class="linenum"> 779</span></a>          return true;
<a name="l780"><span class="linenum"> 780</span></a>      }
<a name="l781"><span class="linenum"> 781</span></a>  
<a name="l782"><span class="linenum"> 782</span></a>      <span class="comment">/**</span>
<a name="l783"><span class="linenum"> 783</span></a>  <span class="comment">     * Perform a search based on the provided filters and return a paginated list of records.</span>
<a name="l784"><span class="linenum"> 784</span></a>  <span class="comment">     *</span>
<a name="l785"><span class="linenum"> 785</span></a>  <span class="comment">     * Requires moodle/competency:competencyview capability at the system context.</span>
<a name="l786"><span class="linenum"> 786</span></a>  <span class="comment">     *</span>
<a name="l787"><span class="linenum"> 787</span></a>  <span class="comment">     * @param string $sort The column to sort on</span>
<a name="l788"><span class="linenum"> 788</span></a>  <span class="comment">     * @param string $order ('ASC' or 'DESC')</span>
<a name="l789"><span class="linenum"> 789</span></a>  <span class="comment">     * @param int $skip Number of records to skip (pagination)</span>
<a name="l790"><span class="linenum"> 790</span></a>  <span class="comment">     * @param int $limit Max of records to return (pagination)</span>
<a name="l791"><span class="linenum"> 791</span></a>  <span class="comment">     * @param context $context The parent context of the frameworks.</span>
<a name="l792"><span class="linenum"> 792</span></a>  <span class="comment">     * @param string $includes Defines what other contexts to fetch frameworks from.</span>
<a name="l793"><span class="linenum"> 793</span></a>  <span class="comment">     *                         Accepted values are:</span>
<a name="l794"><span class="linenum"> 794</span></a>  <span class="comment">     *                          - children: All descendants</span>
<a name="l795"><span class="linenum"> 795</span></a>  <span class="comment">     *                          - parents: All parents, grand parents, etc...</span>
<a name="l796"><span class="linenum"> 796</span></a>  <span class="comment">     *                          - self: Context passed only.</span>
<a name="l797"><span class="linenum"> 797</span></a>  <span class="comment">     * @param bool $onlyvisible If true return only visible frameworks</span>
<a name="l798"><span class="linenum"> 798</span></a>  <span class="comment">     * @param string $query A string to use to filter down the frameworks.</span>
<a name="l799"><span class="linenum"> 799</span></a>  <span class="comment">     * @return array of competency_framework</span>
<a name="l800"><span class="linenum"> 800</span></a>  <span class="comment">     */</span>
<a name="l801"><span class="linenum"> 801</span></a>      public static function <a class="function" onClick="logFunction('list_frameworks')" href="../../_functions/list_frameworks.html" onMouseOver="funcPopup(event,'list_frameworks')">list_frameworks</a>(<a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a>, <a class="var it6270" onMouseOver="hilite(6270)" onMouseOut="lolite()" onClick="logVariable('order')" href="../../_variables/order.html">$order</a>, <a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('skip')" href="../../_variables/skip.html">$skip</a>, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it30432" onMouseOver="hilite(30432)" onMouseOut="lolite()" onClick="logVariable('includes')" href="../../_variables/includes.html">$includes</a> = 'children',
<a name="l802"><span class="linenum"> 802</span></a>                                             <a class="var it4855" onMouseOver="hilite(4855)" onMouseOut="lolite()" onClick="logVariable('onlyvisible')" href="../../_variables/onlyvisible.html">$onlyvisible</a> = false, <a class="var it249" onMouseOver="hilite(249)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = '') {
<a name="l803"><span class="linenum"> 803</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l804"><span class="linenum"> 804</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l805"><span class="linenum"> 805</span></a>  
<a name="l806"><span class="linenum"> 806</span></a>  <span class="comment">        // Get all the relevant contexts.</span>
<a name="l807"><span class="linenum"> 807</span></a>          <a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a> = self::<a class="function" onClick="logFunction('get_related_contexts')" href="../../_functions/get_related_contexts.html" onMouseOver="funcPopup(event,'get_related_contexts')">get_related_contexts</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it30432" onMouseOver="hilite(30432)" onMouseOut="lolite()" onClick="logVariable('includes')" href="../../_variables/includes.html">$includes</a>,
<a name="l808"><span class="linenum"> 808</span></a>              array('moodle/competency:competencyview', 'moodle/competency:competencymanage'));
<a name="l809"><span class="linenum"> 809</span></a>  
<a name="l810"><span class="linenum"> 810</span></a>          if (empty(<a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a>)) {
<a name="l811"><span class="linenum"> 811</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:competencyview', 'nopermissions', '');
<a name="l812"><span class="linenum"> 812</span></a>          }
<a name="l813"><span class="linenum"> 813</span></a>  
<a name="l814"><span class="linenum"> 814</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l815"><span class="linenum"> 815</span></a>          <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it1041" onMouseOver="hilite(1041)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../../_variables/insql.html">$insql</a>, <a class="var it4859" onMouseOver="hilite(4859)" onMouseOut="lolite()" onClick="logVariable('inparams')" href="../../_variables/inparams.html">$inparams</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="phpfunction" onClick="logFunction('array_keys')" href="../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a>), <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>);
<a name="l816"><span class="linenum"> 816</span></a>          <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> = &quot;contextid <a class="var it1041" onMouseOver="hilite(1041)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../../_variables/insql.html">$insql</a>&quot;;
<a name="l817"><span class="linenum"> 817</span></a>          if (<a class="var it4855" onMouseOver="hilite(4855)" onMouseOut="lolite()" onClick="logVariable('onlyvisible')" href="../../_variables/onlyvisible.html">$onlyvisible</a>) {
<a name="l818"><span class="linenum"> 818</span></a>              <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> .= &quot; AND visible = :visible&quot;;
<a name="l819"><span class="linenum"> 819</span></a>              <a class="var it4859" onMouseOver="hilite(4859)" onMouseOut="lolite()" onClick="logVariable('inparams')" href="../../_variables/inparams.html">$inparams</a>['visible'] = 1;
<a name="l820"><span class="linenum"> 820</span></a>          }
<a name="l821"><span class="linenum"> 821</span></a>  
<a name="l822"><span class="linenum"> 822</span></a>          if (!empty(<a class="var it249" onMouseOver="hilite(249)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a>) || <a class="phpfunction" onClick="logFunction('is_numeric')" href="../../_functions/is_numeric.html" onMouseOver="phpfuncPopup(event,'is_numeric')">is_numeric</a>(<a class="var it249" onMouseOver="hilite(249)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a>)) {
<a name="l823"><span class="linenum"> 823</span></a>              <a class="var it30433" onMouseOver="hilite(30433)" onMouseOut="lolite()" onClick="logVariable('sqlnamelike')" href="../../_variables/sqlnamelike.html">$sqlnamelike</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_like')" href="../../_functions/sql_like.html" onMouseOver="funcPopup(event,'sql_like')">sql_like</a>('shortname', ':namelike', false);
<a name="l824"><span class="linenum"> 824</span></a>              <a class="var it30434" onMouseOver="hilite(30434)" onMouseOut="lolite()" onClick="logVariable('sqlidnlike')" href="../../_variables/sqlidnlike.html">$sqlidnlike</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_like')" href="../../_functions/sql_like.html" onMouseOver="funcPopup(event,'sql_like')">sql_like</a>('idnumber', ':idnlike', false);
<a name="l825"><span class="linenum"> 825</span></a>  
<a name="l826"><span class="linenum"> 826</span></a>              <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> .= &quot; AND (<a class="var it30433" onMouseOver="hilite(30433)" onMouseOut="lolite()" onClick="logVariable('sqlnamelike')" href="../../_variables/sqlnamelike.html">$sqlnamelike</a> OR <a class="var it30434" onMouseOver="hilite(30434)" onMouseOut="lolite()" onClick="logVariable('sqlidnlike')" href="../../_variables/sqlidnlike.html">$sqlidnlike</a>) &quot;;
<a name="l827"><span class="linenum"> 827</span></a>              <a class="var it4859" onMouseOver="hilite(4859)" onMouseOut="lolite()" onClick="logVariable('inparams')" href="../../_variables/inparams.html">$inparams</a>['namelike'] = '%' . <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_like_escape')" href="../../_functions/sql_like_escape.html" onMouseOver="funcPopup(event,'sql_like_escape')">sql_like_escape</a>(<a class="var it249" onMouseOver="hilite(249)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a>) . '%';
<a name="l828"><span class="linenum"> 828</span></a>              <a class="var it4859" onMouseOver="hilite(4859)" onMouseOut="lolite()" onClick="logVariable('inparams')" href="../../_variables/inparams.html">$inparams</a>['idnlike'] = '%' . <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_like_escape')" href="../../_functions/sql_like_escape.html" onMouseOver="funcPopup(event,'sql_like_escape')">sql_like_escape</a>(<a class="var it249" onMouseOver="hilite(249)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a>) . '%';
<a name="l829"><span class="linenum"> 829</span></a>          }
<a name="l830"><span class="linenum"> 830</span></a>  
<a name="l831"><span class="linenum"> 831</span></a>          return <a class="class" onClick="logClass('competency_framework')" href="../../_classes/competency_framework.html" onMouseOver="classPopup(event,'competency_framework')">competency_framework</a>::<a class="function" onClick="logFunction('get_records_select')" href="../../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>(<a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a>, <a class="var it4859" onMouseOver="hilite(4859)" onMouseOut="lolite()" onClick="logVariable('inparams')" href="../../_variables/inparams.html">$inparams</a>, <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> . ' ' . <a class="var it6270" onMouseOver="hilite(6270)" onMouseOut="lolite()" onClick="logVariable('order')" href="../../_variables/order.html">$order</a>, '*', <a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('skip')" href="../../_variables/skip.html">$skip</a>, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a>);
<a name="l832"><span class="linenum"> 832</span></a>      }
<a name="l833"><span class="linenum"> 833</span></a>  
<a name="l834"><span class="linenum"> 834</span></a>      <span class="comment">/**</span>
<a name="l835"><span class="linenum"> 835</span></a>  <span class="comment">     * Perform a search based on the provided filters and return a paginated list of records.</span>
<a name="l836"><span class="linenum"> 836</span></a>  <span class="comment">     *</span>
<a name="l837"><span class="linenum"> 837</span></a>  <span class="comment">     * Requires moodle/competency:competencyview capability at the system context.</span>
<a name="l838"><span class="linenum"> 838</span></a>  <span class="comment">     *</span>
<a name="l839"><span class="linenum"> 839</span></a>  <span class="comment">     * @param context $context The parent context of the frameworks.</span>
<a name="l840"><span class="linenum"> 840</span></a>  <span class="comment">     * @param string $includes Defines what other contexts to fetch frameworks from.</span>
<a name="l841"><span class="linenum"> 841</span></a>  <span class="comment">     *                         Accepted values are:</span>
<a name="l842"><span class="linenum"> 842</span></a>  <span class="comment">     *                          - children: All descendants</span>
<a name="l843"><span class="linenum"> 843</span></a>  <span class="comment">     *                          - parents: All parents, grand parents, etc...</span>
<a name="l844"><span class="linenum"> 844</span></a>  <span class="comment">     *                          - self: Context passed only.</span>
<a name="l845"><span class="linenum"> 845</span></a>  <span class="comment">     * @return int</span>
<a name="l846"><span class="linenum"> 846</span></a>  <span class="comment">     */</span>
<a name="l847"><span class="linenum"> 847</span></a>      public static function <a class="function" onClick="logFunction('count_frameworks')" href="../../_functions/count_frameworks.html" onMouseOver="funcPopup(event,'count_frameworks')">count_frameworks</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it30432" onMouseOver="hilite(30432)" onMouseOut="lolite()" onClick="logVariable('includes')" href="../../_variables/includes.html">$includes</a>) {
<a name="l848"><span class="linenum"> 848</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l849"><span class="linenum"> 849</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l850"><span class="linenum"> 850</span></a>  
<a name="l851"><span class="linenum"> 851</span></a>  <span class="comment">        // Get all the relevant contexts.</span>
<a name="l852"><span class="linenum"> 852</span></a>          <a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a> = self::<a class="function" onClick="logFunction('get_related_contexts')" href="../../_functions/get_related_contexts.html" onMouseOver="funcPopup(event,'get_related_contexts')">get_related_contexts</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it30432" onMouseOver="hilite(30432)" onMouseOut="lolite()" onClick="logVariable('includes')" href="../../_variables/includes.html">$includes</a>,
<a name="l853"><span class="linenum"> 853</span></a>              array('moodle/competency:competencyview', 'moodle/competency:competencymanage'));
<a name="l854"><span class="linenum"> 854</span></a>  
<a name="l855"><span class="linenum"> 855</span></a>          if (empty(<a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a>)) {
<a name="l856"><span class="linenum"> 856</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:competencyview', 'nopermissions', '');
<a name="l857"><span class="linenum"> 857</span></a>          }
<a name="l858"><span class="linenum"> 858</span></a>  
<a name="l859"><span class="linenum"> 859</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l860"><span class="linenum"> 860</span></a>          <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it1041" onMouseOver="hilite(1041)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../../_variables/insql.html">$insql</a>, <a class="var it4859" onMouseOver="hilite(4859)" onMouseOut="lolite()" onClick="logVariable('inparams')" href="../../_variables/inparams.html">$inparams</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="phpfunction" onClick="logFunction('array_keys')" href="../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a>), <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>);
<a name="l861"><span class="linenum"> 861</span></a>          return <a class="class" onClick="logClass('competency_framework')" href="../../_classes/competency_framework.html" onMouseOver="classPopup(event,'competency_framework')">competency_framework</a>::<a class="function" onClick="logFunction('count_records_select')" href="../../_functions/count_records_select.html" onMouseOver="funcPopup(event,'count_records_select')">count_records_select</a>(&quot;contextid <a class="var it1041" onMouseOver="hilite(1041)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../../_variables/insql.html">$insql</a>&quot;, <a class="var it4859" onMouseOver="hilite(4859)" onMouseOut="lolite()" onClick="logVariable('inparams')" href="../../_variables/inparams.html">$inparams</a>);
<a name="l862"><span class="linenum"> 862</span></a>      }
<a name="l863"><span class="linenum"> 863</span></a>  
<a name="l864"><span class="linenum"> 864</span></a>      <span class="comment">/**</span>
<a name="l865"><span class="linenum"> 865</span></a>  <span class="comment">     * Fetches all the relevant contexts.</span>
<a name="l866"><span class="linenum"> 866</span></a>  <span class="comment">     *</span>
<a name="l867"><span class="linenum"> 867</span></a>  <span class="comment">     * Note: This currently only supports system, category and user contexts. However user contexts</span>
<a name="l868"><span class="linenum"> 868</span></a>  <span class="comment">     * behave a bit differently and will fallback on the system context. This is what makes the most</span>
<a name="l869"><span class="linenum"> 869</span></a>  <span class="comment">     * sense because a user context does not have descendants, and only has system as a parent.</span>
<a name="l870"><span class="linenum"> 870</span></a>  <span class="comment">     *</span>
<a name="l871"><span class="linenum"> 871</span></a>  <span class="comment">     * @param context $context The context to start from.</span>
<a name="l872"><span class="linenum"> 872</span></a>  <span class="comment">     * @param string $includes Defines what other contexts to find.</span>
<a name="l873"><span class="linenum"> 873</span></a>  <span class="comment">     *                         Accepted values are:</span>
<a name="l874"><span class="linenum"> 874</span></a>  <span class="comment">     *                          - children: All descendants</span>
<a name="l875"><span class="linenum"> 875</span></a>  <span class="comment">     *                          - parents: All parents, grand parents, etc...</span>
<a name="l876"><span class="linenum"> 876</span></a>  <span class="comment">     *                          - self: Context passed only.</span>
<a name="l877"><span class="linenum"> 877</span></a>  <span class="comment">     * @param array $hasanycapability Array of capabilities passed to {@link has_any_capability()} in each context.</span>
<a name="l878"><span class="linenum"> 878</span></a>  <span class="comment">     * @return context[] An array of contexts where keys are context IDs.</span>
<a name="l879"><span class="linenum"> 879</span></a>  <span class="comment">     */</span>
<a name="l880"><span class="linenum"> 880</span></a>      public static function <a class="function" onClick="logFunction('get_related_contexts')" href="../../_functions/get_related_contexts.html" onMouseOver="funcPopup(event,'get_related_contexts')">get_related_contexts</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it30432" onMouseOver="hilite(30432)" onMouseOut="lolite()" onClick="logVariable('includes')" href="../../_variables/includes.html">$includes</a>, array <a class="var it30435" onMouseOver="hilite(30435)" onMouseOut="lolite()" onClick="logVariable('hasanycapability')" href="../../_variables/hasanycapability.html">$hasanycapability</a> = null) {
<a name="l881"><span class="linenum"> 881</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l882"><span class="linenum"> 882</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l883"><span class="linenum"> 883</span></a>  
<a name="l884"><span class="linenum"> 884</span></a>          if (!<a class="phpfunction" onClick="logFunction('in_array')" href="../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it30432" onMouseOver="hilite(30432)" onMouseOut="lolite()" onClick="logVariable('includes')" href="../../_variables/includes.html">$includes</a>, array('children', 'parents', 'self'))) {
<a name="l885"><span class="linenum"> 885</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Invalid parameter value for \'includes\'.');
<a name="l886"><span class="linenum"> 886</span></a>          }
<a name="l887"><span class="linenum"> 887</span></a>  
<a name="l888"><span class="linenum"> 888</span></a>  <span class="comment">        // If context user swap it for the context_system.</span>
<a name="l889"><span class="linenum"> 889</span></a>          if (<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/contextlevel.html">contextlevel</a> == <a class="constant" onClick="logConstant('CONTEXT_USER')" href="../../_constants/CONTEXT_USER.html" onMouseOver="constPopup(event,'CONTEXT_USER')">CONTEXT_USER</a>) {
<a name="l890"><span class="linenum"> 890</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l891"><span class="linenum"> 891</span></a>          }
<a name="l892"><span class="linenum"> 892</span></a>  
<a name="l893"><span class="linenum"> 893</span></a>          <a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a> = array(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a> =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l894"><span class="linenum"> 894</span></a>  
<a name="l895"><span class="linenum"> 895</span></a>          if (<a class="var it30432" onMouseOver="hilite(30432)" onMouseOut="lolite()" onClick="logVariable('includes')" href="../../_variables/includes.html">$includes</a> == 'children') {
<a name="l896"><span class="linenum"> 896</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('coursecatlevel' =&gt; <a class="constant" onClick="logConstant('CONTEXT_COURSECAT')" href="../../_constants/CONTEXT_COURSECAT.html" onMouseOver="constPopup(event,'CONTEXT_COURSECAT')">CONTEXT_COURSECAT</a>, 'path' =&gt; <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('path')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/path.html">path</a> . '/%');
<a name="l897"><span class="linenum"> 897</span></a>              <a class="var it30436" onMouseOver="hilite(30436)" onMouseOut="lolite()" onClick="logVariable('pathlike')" href="../../_variables/pathlike.html">$pathlike</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('sql_like')" href="../../_functions/sql_like.html" onMouseOver="funcPopup(event,'sql_like')">sql_like</a>('path', ':path');
<a name="l898"><span class="linenum"> 898</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;contextlevel = :coursecatlevel AND <a class="var it30436" onMouseOver="hilite(30436)" onMouseOut="lolite()" onClick="logVariable('pathlike')" href="../../_variables/pathlike.html">$pathlike</a>&quot;;
<a name="l899"><span class="linenum"> 899</span></a>              <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_select')" href="../../_functions/get_recordset_select.html" onMouseOver="funcPopup(event,'get_recordset_select')">get_recordset_select</a>('context', <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l900"><span class="linenum"> 900</span></a>              foreach (<a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a> as <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>) {
<a name="l901"><span class="linenum"> 901</span></a>                  <a class="var it5403" onMouseOver="hilite(5403)" onMouseOut="lolite()" onClick="logVariable('ctxid')" href="../../_variables/ctxid.html">$ctxid</a> = <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l902"><span class="linenum"> 902</span></a>                  <a class="class" onClick="logClass('context_helper')" href="../../_classes/context_helper.html" onMouseOver="classPopup(event,'context_helper')">context_helper</a>::<a class="function" onClick="logFunction('preload_from_record')" href="../../_functions/preload_from_record.html" onMouseOver="funcPopup(event,'preload_from_record')">preload_from_record</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>);
<a name="l903"><span class="linenum"> 903</span></a>                  <a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a>[<a class="var it5403" onMouseOver="hilite(5403)" onMouseOut="lolite()" onClick="logVariable('ctxid')" href="../../_variables/ctxid.html">$ctxid</a>] = context::<a class="function" onClick="logFunction('instance_by_id')" href="../../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>(<a class="var it5403" onMouseOver="hilite(5403)" onMouseOut="lolite()" onClick="logVariable('ctxid')" href="../../_variables/ctxid.html">$ctxid</a>);
<a name="l904"><span class="linenum"> 904</span></a>              }
<a name="l905"><span class="linenum"> 905</span></a>              <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l906"><span class="linenum"> 906</span></a>  
<a name="l907"><span class="linenum"> 907</span></a>          } else if (<a class="var it30432" onMouseOver="hilite(30432)" onMouseOut="lolite()" onClick="logVariable('includes')" href="../../_variables/includes.html">$includes</a> == 'parents') {
<a name="l908"><span class="linenum"> 908</span></a>              <a class="var it922" onMouseOver="hilite(922)" onMouseOut="lolite()" onClick="logVariable('children')" href="../../_variables/children.html">$children</a> = <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_parent_contexts')" href="../../_functions/get_parent_contexts.html" onMouseOver="funcPopup(event,'get_parent_contexts')">get_parent_contexts</a>();
<a name="l909"><span class="linenum"> 909</span></a>              foreach (<a class="var it922" onMouseOver="hilite(922)" onMouseOut="lolite()" onClick="logVariable('children')" href="../../_variables/children.html">$children</a> as <a class="var it1068" onMouseOver="hilite(1068)" onMouseOut="lolite()" onClick="logVariable('ctx')" href="../../_variables/ctx.html">$ctx</a>) {
<a name="l910"><span class="linenum"> 910</span></a>                  <a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a>[<a class="var it1068" onMouseOver="hilite(1068)" onMouseOut="lolite()" onClick="logVariable('ctx')" href="../../_variables/ctx.html">$ctx</a>-&gt;<a onClick="logVariable('id')" class="var it43401" onMouseOver="hilite(43401)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>] = <a class="var it1068" onMouseOver="hilite(1068)" onMouseOut="lolite()" onClick="logVariable('ctx')" href="../../_variables/ctx.html">$ctx</a>;
<a name="l911"><span class="linenum"> 911</span></a>              }
<a name="l912"><span class="linenum"> 912</span></a>          }
<a name="l913"><span class="linenum"> 913</span></a>  
<a name="l914"><span class="linenum"> 914</span></a>  <span class="comment">        // Filter according to the capabilities required.</span>
<a name="l915"><span class="linenum"> 915</span></a>          if (!empty(<a class="var it30435" onMouseOver="hilite(30435)" onMouseOut="lolite()" onClick="logVariable('hasanycapability')" href="../../_variables/hasanycapability.html">$hasanycapability</a>)) {
<a name="l916"><span class="linenum"> 916</span></a>              foreach (<a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> =&gt; <a class="var it1068" onMouseOver="hilite(1068)" onMouseOut="lolite()" onClick="logVariable('ctx')" href="../../_variables/ctx.html">$ctx</a>) {
<a name="l917"><span class="linenum"> 917</span></a>                  if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(<a class="var it30435" onMouseOver="hilite(30435)" onMouseOut="lolite()" onClick="logVariable('hasanycapability')" href="../../_variables/hasanycapability.html">$hasanycapability</a>, <a class="var it1068" onMouseOver="hilite(1068)" onMouseOut="lolite()" onClick="logVariable('ctx')" href="../../_variables/ctx.html">$ctx</a>)) {
<a name="l918"><span class="linenum"> 918</span></a>                      unset(<a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a>[<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>]);
<a name="l919"><span class="linenum"> 919</span></a>                  }
<a name="l920"><span class="linenum"> 920</span></a>              }
<a name="l921"><span class="linenum"> 921</span></a>          }
<a name="l922"><span class="linenum"> 922</span></a>  
<a name="l923"><span class="linenum"> 923</span></a>          return <a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a>;
<a name="l924"><span class="linenum"> 924</span></a>      }
<a name="l925"><span class="linenum"> 925</span></a>  
<a name="l926"><span class="linenum"> 926</span></a>      <span class="comment">/**</span>
<a name="l927"><span class="linenum"> 927</span></a>  <span class="comment">     * Count all the courses using a competency.</span>
<a name="l928"><span class="linenum"> 928</span></a>  <span class="comment">     *</span>
<a name="l929"><span class="linenum"> 929</span></a>  <span class="comment">     * @param int $competencyid The id of the competency to check.</span>
<a name="l930"><span class="linenum"> 930</span></a>  <span class="comment">     * @return int</span>
<a name="l931"><span class="linenum"> 931</span></a>  <span class="comment">     */</span>
<a name="l932"><span class="linenum"> 932</span></a>      public static function <a class="function" onClick="logFunction('count_courses_using_competency')" href="../../_functions/count_courses_using_competency.html" onMouseOver="funcPopup(event,'count_courses_using_competency')">count_courses_using_competency</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>) {
<a name="l933"><span class="linenum"> 933</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l934"><span class="linenum"> 934</span></a>  
<a name="l935"><span class="linenum"> 935</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l936"><span class="linenum"> 936</span></a>          <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> = <a class="class" onClick="logClass('course_competency')" href="../../_classes/course_competency.html" onMouseOver="classPopup(event,'course_competency')">course_competency</a>::<a class="function" onClick="logFunction('list_courses_min')" href="../../_functions/list_courses_min.html" onMouseOver="funcPopup(event,'list_courses_min')">list_courses_min</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l937"><span class="linenum"> 937</span></a>          <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> = 0;
<a name="l938"><span class="linenum"> 938</span></a>  
<a name="l939"><span class="linenum"> 939</span></a>  <span class="comment">        // Now check permissions on each course.</span>
<a name="l940"><span class="linenum"> 940</span></a>          foreach (<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> as <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) {
<a name="l941"><span class="linenum"> 941</span></a>              if (!self::<a class="function" onClick="logFunction('validate_course')" href="../../_functions/validate_course.html" onMouseOver="funcPopup(event,'validate_course')">validate_course</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, false)) {
<a name="l942"><span class="linenum"> 942</span></a>                  continue;
<a name="l943"><span class="linenum"> 943</span></a>              }
<a name="l944"><span class="linenum"> 944</span></a>  
<a name="l945"><span class="linenum"> 945</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l946"><span class="linenum"> 946</span></a>              <a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a> = array('moodle/competency:coursecompetencyview', 'moodle/competency:coursecompetencymanage');
<a name="l947"><span class="linenum"> 947</span></a>              if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(<a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l948"><span class="linenum"> 948</span></a>                  continue;
<a name="l949"><span class="linenum"> 949</span></a>              }
<a name="l950"><span class="linenum"> 950</span></a>  
<a name="l951"><span class="linenum"> 951</span></a>              <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a>++;
<a name="l952"><span class="linenum"> 952</span></a>          }
<a name="l953"><span class="linenum"> 953</span></a>  
<a name="l954"><span class="linenum"> 954</span></a>          return <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a>;
<a name="l955"><span class="linenum"> 955</span></a>      }
<a name="l956"><span class="linenum"> 956</span></a>  
<a name="l957"><span class="linenum"> 957</span></a>      <span class="comment">/**</span>
<a name="l958"><span class="linenum"> 958</span></a>  <span class="comment">     * List all the courses modules using a competency in a course.</span>
<a name="l959"><span class="linenum"> 959</span></a>  <span class="comment">     *</span>
<a name="l960"><span class="linenum"> 960</span></a>  <span class="comment">     * @param int $competencyid The id of the competency to check.</span>
<a name="l961"><span class="linenum"> 961</span></a>  <span class="comment">     * @param int $courseid The id of the course to check.</span>
<a name="l962"><span class="linenum"> 962</span></a>  <span class="comment">     * @return array[int] Array of course modules ids.</span>
<a name="l963"><span class="linenum"> 963</span></a>  <span class="comment">     */</span>
<a name="l964"><span class="linenum"> 964</span></a>      public static function <a class="function" onClick="logFunction('list_course_modules_using_competency')" href="../../_functions/list_course_modules_using_competency.html" onMouseOver="funcPopup(event,'list_course_modules_using_competency')">list_course_modules_using_competency</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>) {
<a name="l965"><span class="linenum"> 965</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l966"><span class="linenum"> 966</span></a>  
<a name="l967"><span class="linenum"> 967</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = array();
<a name="l968"><span class="linenum"> 968</span></a>          self::<a class="function" onClick="logFunction('validate_course')" href="../../_functions/validate_course.html" onMouseOver="funcPopup(event,'validate_course')">validate_course</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l969"><span class="linenum"> 969</span></a>  
<a name="l970"><span class="linenum"> 970</span></a>          <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l971"><span class="linenum"> 971</span></a>  
<a name="l972"><span class="linenum"> 972</span></a>  <span class="comment">        // We will not check each module - course permissions should be enough.</span>
<a name="l973"><span class="linenum"> 973</span></a>          <a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a> = array('moodle/competency:coursecompetencyview', 'moodle/competency:coursecompetencymanage');
<a name="l974"><span class="linenum"> 974</span></a>          if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(<a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a>, <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a>)) {
<a name="l975"><span class="linenum"> 975</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a>, 'moodle/competency:coursecompetencyview', 'nopermissions', '');
<a name="l976"><span class="linenum"> 976</span></a>          }
<a name="l977"><span class="linenum"> 977</span></a>  
<a name="l978"><span class="linenum"> 978</span></a>          <a class="var it28419" onMouseOver="hilite(28419)" onMouseOut="lolite()" onClick="logVariable('cmlist')" href="../../_variables/cmlist.html">$cmlist</a> = <a class="class" onClick="logClass('course_module_competency')" href="../../_classes/course_module_competency.html" onMouseOver="classPopup(event,'course_module_competency')">course_module_competency</a>::<a class="function" onClick="logFunction('list_course_modules')" href="../../_functions/list_course_modules.html" onMouseOver="funcPopup(event,'list_course_modules')">list_course_modules</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l979"><span class="linenum"> 979</span></a>          foreach (<a class="var it28419" onMouseOver="hilite(28419)" onMouseOut="lolite()" onClick="logVariable('cmlist')" href="../../_variables/cmlist.html">$cmlist</a> as <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a>) {
<a name="l980"><span class="linenum"> 980</span></a>              if (self::<a class="function" onClick="logFunction('validate_course_module')" href="../../_functions/validate_course_module.html" onMouseOver="funcPopup(event,'validate_course_module')">validate_course_module</a>(<a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a>, false)) {
<a name="l981"><span class="linenum"> 981</span></a>                  <a class="phpfunction" onClick="logFunction('array_push')" href="../../_functions/array_push.html" onMouseOver="phpfuncPopup(event,'array_push')">array_push</a>(<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>, <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('cmid')" href="../../_variables/cmid.html">$cmid</a>);
<a name="l982"><span class="linenum"> 982</span></a>              }
<a name="l983"><span class="linenum"> 983</span></a>          }
<a name="l984"><span class="linenum"> 984</span></a>  
<a name="l985"><span class="linenum"> 985</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l986"><span class="linenum"> 986</span></a>      }
<a name="l987"><span class="linenum"> 987</span></a>  
<a name="l988"><span class="linenum"> 988</span></a>      <span class="comment">/**</span>
<a name="l989"><span class="linenum"> 989</span></a>  <span class="comment">     * List all the competencies linked to a course module.</span>
<a name="l990"><span class="linenum"> 990</span></a>  <span class="comment">     *</span>
<a name="l991"><span class="linenum"> 991</span></a>  <span class="comment">     * @param mixed $cmorid The course module, or its ID.</span>
<a name="l992"><span class="linenum"> 992</span></a>  <span class="comment">     * @return array[competency] Array of competency records.</span>
<a name="l993"><span class="linenum"> 993</span></a>  <span class="comment">     */</span>
<a name="l994"><span class="linenum"> 994</span></a>      public static function <a class="function" onClick="logFunction('list_course_module_competencies_in_course_module')" href="../../_functions/list_course_module_competencies_in_course_module.html" onMouseOver="funcPopup(event,'list_course_module_competencies_in_course_module')">list_course_module_competencies_in_course_module</a>(<a class="var it9151" onMouseOver="hilite(9151)" onMouseOut="lolite()" onClick="logVariable('cmorid')" href="../../_variables/cmorid.html">$cmorid</a>) {
<a name="l995"><span class="linenum"> 995</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l996"><span class="linenum"> 996</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="var it9151" onMouseOver="hilite(9151)" onMouseOut="lolite()" onClick="logVariable('cmorid')" href="../../_variables/cmorid.html">$cmorid</a>;
<a name="l997"><span class="linenum"> 997</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it9151" onMouseOver="hilite(9151)" onMouseOut="lolite()" onClick="logVariable('cmorid')" href="../../_variables/cmorid.html">$cmorid</a>)) {
<a name="l998"><span class="linenum"> 998</span></a>              <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_id')" href="../../_functions/get_coursemodule_from_id.html" onMouseOver="funcPopup(event,'get_coursemodule_from_id')">get_coursemodule_from_id</a>('', <a class="var it9151" onMouseOver="hilite(9151)" onMouseOut="lolite()" onClick="logVariable('cmorid')" href="../../_variables/cmorid.html">$cmorid</a>, 0, true, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l999"><span class="linenum"> 999</span></a>          }
<a name="l1000"><span class="linenum">1000</span></a>  
<a name="l1001"><span class="linenum">1001</span></a>  <span class="comment">        // Check the user have access to the course module.</span>
<a name="l1002"><span class="linenum">1002</span></a>          self::<a class="function" onClick="logFunction('validate_course_module')" href="../../_functions/validate_course_module.html" onMouseOver="funcPopup(event,'validate_course_module')">validate_course_module</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l1003"><span class="linenum">1003</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1004"><span class="linenum">1004</span></a>  
<a name="l1005"><span class="linenum">1005</span></a>          <a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a> = array('moodle/competency:coursecompetencyview', 'moodle/competency:coursecompetencymanage');
<a name="l1006"><span class="linenum">1006</span></a>          if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(<a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l1007"><span class="linenum">1007</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:coursecompetencyview', 'nopermissions', '');
<a name="l1008"><span class="linenum">1008</span></a>          }
<a name="l1009"><span class="linenum">1009</span></a>  
<a name="l1010"><span class="linenum">1010</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = array();
<a name="l1011"><span class="linenum">1011</span></a>  
<a name="l1012"><span class="linenum">1012</span></a>          <a class="var it30437" onMouseOver="hilite(30437)" onMouseOut="lolite()" onClick="logVariable('cmclist')" href="../../_variables/cmclist.html">$cmclist</a> = <a class="class" onClick="logClass('course_module_competency')" href="../../_classes/course_module_competency.html" onMouseOver="classPopup(event,'course_module_competency')">course_module_competency</a>::<a class="function" onClick="logFunction('list_course_module_competencies')" href="../../_functions/list_course_module_competencies.html" onMouseOver="funcPopup(event,'list_course_module_competencies')">list_course_module_competencies</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1013"><span class="linenum">1013</span></a>          foreach (<a class="var it30437" onMouseOver="hilite(30437)" onMouseOut="lolite()" onClick="logVariable('cmclist')" href="../../_variables/cmclist.html">$cmclist</a> as <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a> =&gt; <a class="var it29660" onMouseOver="hilite(29660)" onMouseOut="lolite()" onClick="logVariable('cmc')" href="../../_variables/cmc.html">$cmc</a>) {
<a name="l1014"><span class="linenum">1014</span></a>              <a class="phpfunction" onClick="logFunction('array_push')" href="../../_functions/array_push.html" onMouseOver="phpfuncPopup(event,'array_push')">array_push</a>(<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>, <a class="var it29660" onMouseOver="hilite(29660)" onMouseOut="lolite()" onClick="logVariable('cmc')" href="../../_variables/cmc.html">$cmc</a>);
<a name="l1015"><span class="linenum">1015</span></a>          }
<a name="l1016"><span class="linenum">1016</span></a>  
<a name="l1017"><span class="linenum">1017</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l1018"><span class="linenum">1018</span></a>      }
<a name="l1019"><span class="linenum">1019</span></a>  
<a name="l1020"><span class="linenum">1020</span></a>      <span class="comment">/**</span>
<a name="l1021"><span class="linenum">1021</span></a>  <span class="comment">     * List all the courses using a competency.</span>
<a name="l1022"><span class="linenum">1022</span></a>  <span class="comment">     *</span>
<a name="l1023"><span class="linenum">1023</span></a>  <span class="comment">     * @param int $competencyid The id of the competency to check.</span>
<a name="l1024"><span class="linenum">1024</span></a>  <span class="comment">     * @return array[stdClass] Array of stdClass containing id and shortname.</span>
<a name="l1025"><span class="linenum">1025</span></a>  <span class="comment">     */</span>
<a name="l1026"><span class="linenum">1026</span></a>      public static function <a class="function" onClick="logFunction('list_courses_using_competency')" href="../../_functions/list_courses_using_competency.html" onMouseOver="funcPopup(event,'list_courses_using_competency')">list_courses_using_competency</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>) {
<a name="l1027"><span class="linenum">1027</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1028"><span class="linenum">1028</span></a>  
<a name="l1029"><span class="linenum">1029</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l1030"><span class="linenum">1030</span></a>          <a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> = <a class="class" onClick="logClass('course_competency')" href="../../_classes/course_competency.html" onMouseOver="classPopup(event,'course_competency')">course_competency</a>::<a class="function" onClick="logFunction('list_courses')" href="../../_functions/list_courses.html" onMouseOver="funcPopup(event,'list_courses')">list_courses</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l1031"><span class="linenum">1031</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = array();
<a name="l1032"><span class="linenum">1032</span></a>  
<a name="l1033"><span class="linenum">1033</span></a>  <span class="comment">        // Now check permissions on each course.</span>
<a name="l1034"><span class="linenum">1034</span></a>          foreach (<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a> as <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a> =&gt; <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) {
<a name="l1035"><span class="linenum">1035</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1036"><span class="linenum">1036</span></a>              <a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a> = array('moodle/competency:coursecompetencyview', 'moodle/competency:coursecompetencymanage');
<a name="l1037"><span class="linenum">1037</span></a>              if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(<a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l1038"><span class="linenum">1038</span></a>                  unset(<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>[<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>]);
<a name="l1039"><span class="linenum">1039</span></a>                  continue;
<a name="l1040"><span class="linenum">1040</span></a>              }
<a name="l1041"><span class="linenum">1041</span></a>              if (!self::<a class="function" onClick="logFunction('validate_course')" href="../../_functions/validate_course.html" onMouseOver="funcPopup(event,'validate_course')">validate_course</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>, false)) {
<a name="l1042"><span class="linenum">1042</span></a>                  unset(<a class="var it566" onMouseOver="hilite(566)" onMouseOut="lolite()" onClick="logVariable('courses')" href="../../_variables/courses.html">$courses</a>[<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>]);
<a name="l1043"><span class="linenum">1043</span></a>                  continue;
<a name="l1044"><span class="linenum">1044</span></a>              }
<a name="l1045"><span class="linenum">1045</span></a>              <a class="phpfunction" onClick="logFunction('array_push')" href="../../_functions/array_push.html" onMouseOver="phpfuncPopup(event,'array_push')">array_push</a>(<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l1046"><span class="linenum">1046</span></a>          }
<a name="l1047"><span class="linenum">1047</span></a>  
<a name="l1048"><span class="linenum">1048</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l1049"><span class="linenum">1049</span></a>      }
<a name="l1050"><span class="linenum">1050</span></a>  
<a name="l1051"><span class="linenum">1051</span></a>      <span class="comment">/**</span>
<a name="l1052"><span class="linenum">1052</span></a>  <span class="comment">     * Count the proficient competencies in a course for one user.</span>
<a name="l1053"><span class="linenum">1053</span></a>  <span class="comment">     *</span>
<a name="l1054"><span class="linenum">1054</span></a>  <span class="comment">     * @param int $courseid The id of the course to check.</span>
<a name="l1055"><span class="linenum">1055</span></a>  <span class="comment">     * @param int $userid The id of the user to check.</span>
<a name="l1056"><span class="linenum">1056</span></a>  <span class="comment">     * @return int</span>
<a name="l1057"><span class="linenum">1057</span></a>  <span class="comment">     */</span>
<a name="l1058"><span class="linenum">1058</span></a>      public static function <a class="function" onClick="logFunction('count_proficient_competencies_in_course_for_user')" href="../../_functions/count_proficient_competencies_in_course_for_user.html" onMouseOver="funcPopup(event,'count_proficient_competencies_in_course_for_user')">count_proficient_competencies_in_course_for_user</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) {
<a name="l1059"><span class="linenum">1059</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1060"><span class="linenum">1060</span></a>  <span class="comment">        // Check the user have access to the course.</span>
<a name="l1061"><span class="linenum">1061</span></a>          self::<a class="function" onClick="logFunction('validate_course')" href="../../_functions/validate_course.html" onMouseOver="funcPopup(event,'validate_course')">validate_course</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l1062"><span class="linenum">1062</span></a>  
<a name="l1063"><span class="linenum">1063</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l1064"><span class="linenum">1064</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l1065"><span class="linenum">1065</span></a>  
<a name="l1066"><span class="linenum">1066</span></a>          <a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a> = array('moodle/competency:coursecompetencyview', 'moodle/competency:coursecompetencymanage');
<a name="l1067"><span class="linenum">1067</span></a>          if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(<a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l1068"><span class="linenum">1068</span></a>               throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:coursecompetencyview', 'nopermissions', '');
<a name="l1069"><span class="linenum">1069</span></a>          }
<a name="l1070"><span class="linenum">1070</span></a>  
<a name="l1071"><span class="linenum">1071</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l1072"><span class="linenum">1072</span></a>          return <a class="class" onClick="logClass('user_competency_course')" href="../../_classes/user_competency_course.html" onMouseOver="classPopup(event,'user_competency_course')">user_competency_course</a>::<a class="function" onClick="logFunction('count_proficient_competencies')" href="../../_functions/count_proficient_competencies.html" onMouseOver="funcPopup(event,'count_proficient_competencies')">count_proficient_competencies</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>);
<a name="l1073"><span class="linenum">1073</span></a>      }
<a name="l1074"><span class="linenum">1074</span></a>  
<a name="l1075"><span class="linenum">1075</span></a>      <span class="comment">/**</span>
<a name="l1076"><span class="linenum">1076</span></a>  <span class="comment">     * Count all the competencies in a course.</span>
<a name="l1077"><span class="linenum">1077</span></a>  <span class="comment">     *</span>
<a name="l1078"><span class="linenum">1078</span></a>  <span class="comment">     * @param int $courseid The id of the course to check.</span>
<a name="l1079"><span class="linenum">1079</span></a>  <span class="comment">     * @return int</span>
<a name="l1080"><span class="linenum">1080</span></a>  <span class="comment">     */</span>
<a name="l1081"><span class="linenum">1081</span></a>      public static function <a class="function" onClick="logFunction('count_competencies_in_course')" href="../../_functions/count_competencies_in_course.html" onMouseOver="funcPopup(event,'count_competencies_in_course')">count_competencies_in_course</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>) {
<a name="l1082"><span class="linenum">1082</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1083"><span class="linenum">1083</span></a>  <span class="comment">        // Check the user have access to the course.</span>
<a name="l1084"><span class="linenum">1084</span></a>          self::<a class="function" onClick="logFunction('validate_course')" href="../../_functions/validate_course.html" onMouseOver="funcPopup(event,'validate_course')">validate_course</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l1085"><span class="linenum">1085</span></a>  
<a name="l1086"><span class="linenum">1086</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l1087"><span class="linenum">1087</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l1088"><span class="linenum">1088</span></a>  
<a name="l1089"><span class="linenum">1089</span></a>          <a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a> = array('moodle/competency:coursecompetencyview', 'moodle/competency:coursecompetencymanage');
<a name="l1090"><span class="linenum">1090</span></a>          if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(<a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l1091"><span class="linenum">1091</span></a>               throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:coursecompetencyview', 'nopermissions', '');
<a name="l1092"><span class="linenum">1092</span></a>          }
<a name="l1093"><span class="linenum">1093</span></a>  
<a name="l1094"><span class="linenum">1094</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l1095"><span class="linenum">1095</span></a>          return <a class="class" onClick="logClass('course_competency')" href="../../_classes/course_competency.html" onMouseOver="classPopup(event,'course_competency')">course_competency</a>::<a class="function" onClick="logFunction('count_competencies')" href="../../_functions/count_competencies.html" onMouseOver="funcPopup(event,'count_competencies')">count_competencies</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l1096"><span class="linenum">1096</span></a>      }
<a name="l1097"><span class="linenum">1097</span></a>  
<a name="l1098"><span class="linenum">1098</span></a>      <span class="comment">/**</span>
<a name="l1099"><span class="linenum">1099</span></a>  <span class="comment">     * List the competencies associated to a course.</span>
<a name="l1100"><span class="linenum">1100</span></a>  <span class="comment">     *</span>
<a name="l1101"><span class="linenum">1101</span></a>  <span class="comment">     * @param mixed $courseorid The course, or its ID.</span>
<a name="l1102"><span class="linenum">1102</span></a>  <span class="comment">     * @return array( array(</span>
<a name="l1103"><span class="linenum">1103</span></a>  <span class="comment">     *                   'competency' =&gt; \core_competency\competency,</span>
<a name="l1104"><span class="linenum">1104</span></a>  <span class="comment">     *                   'coursecompetency' =&gt; \core_competency\course_competency</span>
<a name="l1105"><span class="linenum">1105</span></a>  <span class="comment">     *              ))</span>
<a name="l1106"><span class="linenum">1106</span></a>  <span class="comment">     */</span>
<a name="l1107"><span class="linenum">1107</span></a>      public static function <a class="function" onClick="logFunction('list_course_competencies')" href="../../_functions/list_course_competencies.html" onMouseOver="funcPopup(event,'list_course_competencies')">list_course_competencies</a>(<a class="var it11871" onMouseOver="hilite(11871)" onMouseOut="lolite()" onClick="logVariable('courseorid')" href="../../_variables/courseorid.html">$courseorid</a>) {
<a name="l1108"><span class="linenum">1108</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1109"><span class="linenum">1109</span></a>          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a> = <a class="var it11871" onMouseOver="hilite(11871)" onMouseOut="lolite()" onClick="logVariable('courseorid')" href="../../_variables/courseorid.html">$courseorid</a>;
<a name="l1110"><span class="linenum">1110</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it11871" onMouseOver="hilite(11871)" onMouseOut="lolite()" onClick="logVariable('courseorid')" href="../../_variables/courseorid.html">$courseorid</a>)) {
<a name="l1111"><span class="linenum">1111</span></a>              <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a> = <a class="function" onClick="logFunction('get_course')" href="../../_functions/get_course.html" onMouseOver="funcPopup(event,'get_course')">get_course</a>(<a class="var it11871" onMouseOver="hilite(11871)" onMouseOut="lolite()" onClick="logVariable('courseorid')" href="../../_variables/courseorid.html">$courseorid</a>);
<a name="l1112"><span class="linenum">1112</span></a>          }
<a name="l1113"><span class="linenum">1113</span></a>  
<a name="l1114"><span class="linenum">1114</span></a>  <span class="comment">        // Check the user have access to the course.</span>
<a name="l1115"><span class="linenum">1115</span></a>          self::<a class="function" onClick="logFunction('validate_course')" href="../../_functions/validate_course.html" onMouseOver="funcPopup(event,'validate_course')">validate_course</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>);
<a name="l1116"><span class="linenum">1116</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1117"><span class="linenum">1117</span></a>  
<a name="l1118"><span class="linenum">1118</span></a>          <a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a> = array('moodle/competency:coursecompetencyview', 'moodle/competency:coursecompetencymanage');
<a name="l1119"><span class="linenum">1119</span></a>          if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(<a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l1120"><span class="linenum">1120</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:coursecompetencyview', 'nopermissions', '');
<a name="l1121"><span class="linenum">1121</span></a>          }
<a name="l1122"><span class="linenum">1122</span></a>  
<a name="l1123"><span class="linenum">1123</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = array();
<a name="l1124"><span class="linenum">1124</span></a>  
<a name="l1125"><span class="linenum">1125</span></a>  <span class="comment">        // TODO We could improve the performance of this into one single query.</span>
<a name="l1126"><span class="linenum">1126</span></a>          <a class="var it9650" onMouseOver="hilite(9650)" onMouseOut="lolite()" onClick="logVariable('coursecompetencies')" href="../../_variables/coursecompetencies.html">$coursecompetencies</a> = <a class="class" onClick="logClass('course_competency')" href="../../_classes/course_competency.html" onMouseOver="classPopup(event,'course_competency')">course_competency</a>::<a class="function" onClick="logFunction('list_course_competencies')" href="../../_functions/list_course_competencies.html" onMouseOver="funcPopup(event,'list_course_competencies')">list_course_competencies</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1127"><span class="linenum">1127</span></a>          <a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a> = <a class="class" onClick="logClass('course_competency')" href="../../_classes/course_competency.html" onMouseOver="classPopup(event,'course_competency')">course_competency</a>::<a class="function" onClick="logFunction('list_competencies')" href="../../_functions/list_competencies.html" onMouseOver="funcPopup(event,'list_competencies')">list_competencies</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1128"><span class="linenum">1128</span></a>  
<a name="l1129"><span class="linenum">1129</span></a>  <span class="comment">        // Build the return values.</span>
<a name="l1130"><span class="linenum">1130</span></a>          foreach (<a class="var it9650" onMouseOver="hilite(9650)" onMouseOut="lolite()" onClick="logVariable('coursecompetencies')" href="../../_variables/coursecompetencies.html">$coursecompetencies</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> =&gt; <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>) {
<a name="l1131"><span class="linenum">1131</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>[] = array(
<a name="l1132"><span class="linenum">1132</span></a>                  'competency' =&gt; <a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a>[<a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>-&gt;get_competencyid()],
<a name="l1133"><span class="linenum">1133</span></a>                  'coursecompetency' =&gt; <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>
<a name="l1134"><span class="linenum">1134</span></a>              );
<a name="l1135"><span class="linenum">1135</span></a>          }
<a name="l1136"><span class="linenum">1136</span></a>  
<a name="l1137"><span class="linenum">1137</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l1138"><span class="linenum">1138</span></a>      }
<a name="l1139"><span class="linenum">1139</span></a>  
<a name="l1140"><span class="linenum">1140</span></a>      <span class="comment">/**</span>
<a name="l1141"><span class="linenum">1141</span></a>  <span class="comment">     * Get a user competency.</span>
<a name="l1142"><span class="linenum">1142</span></a>  <span class="comment">     *</span>
<a name="l1143"><span class="linenum">1143</span></a>  <span class="comment">     * @param int $userid The user ID.</span>
<a name="l1144"><span class="linenum">1144</span></a>  <span class="comment">     * @param int $competencyid The competency ID.</span>
<a name="l1145"><span class="linenum">1145</span></a>  <span class="comment">     * @return user_competency</span>
<a name="l1146"><span class="linenum">1146</span></a>  <span class="comment">     */</span>
<a name="l1147"><span class="linenum">1147</span></a>      public static function <a class="function" onClick="logFunction('get_user_competency')" href="../../_functions/get_user_competency.html" onMouseOver="funcPopup(event,'get_user_competency')">get_user_competency</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>) {
<a name="l1148"><span class="linenum">1148</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1149"><span class="linenum">1149</span></a>          <a class="var it10898" onMouseOver="hilite(10898)" onMouseOut="lolite()" onClick="logVariable('existing')" href="../../_variables/existing.html">$existing</a> = <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('get_multiple')" href="../../_functions/get_multiple.html" onMouseOver="funcPopup(event,'get_multiple')">get_multiple</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, array(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>));
<a name="l1150"><span class="linenum">1150</span></a>          <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> = <a class="phpfunction" onClick="logFunction('array_pop')" href="../../_functions/array_pop.html" onMouseOver="phpfuncPopup(event,'array_pop')">array_pop</a>(<a class="var it10898" onMouseOver="hilite(10898)" onMouseOut="lolite()" onClick="logVariable('existing')" href="../../_variables/existing.html">$existing</a>);
<a name="l1151"><span class="linenum">1151</span></a>  
<a name="l1152"><span class="linenum">1152</span></a>          if (!<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>) {
<a name="l1153"><span class="linenum">1153</span></a>              <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> = <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('create_relation')" href="../../_functions/create_relation.html" onMouseOver="funcPopup(event,'create_relation')">create_relation</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l1154"><span class="linenum">1154</span></a>              <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l1155"><span class="linenum">1155</span></a>          }
<a name="l1156"><span class="linenum">1156</span></a>  
<a name="l1157"><span class="linenum">1157</span></a>          if (!<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l1158"><span class="linenum">1158</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:usercompetencyview',
<a name="l1159"><span class="linenum">1159</span></a>                  'nopermissions', '');
<a name="l1160"><span class="linenum">1160</span></a>          }
<a name="l1161"><span class="linenum">1161</span></a>          return <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>;
<a name="l1162"><span class="linenum">1162</span></a>      }
<a name="l1163"><span class="linenum">1163</span></a>  
<a name="l1164"><span class="linenum">1164</span></a>      <span class="comment">/**</span>
<a name="l1165"><span class="linenum">1165</span></a>  <span class="comment">     * Get a user competency by ID.</span>
<a name="l1166"><span class="linenum">1166</span></a>  <span class="comment">     *</span>
<a name="l1167"><span class="linenum">1167</span></a>  <span class="comment">     * @param int $usercompetencyid The user competency ID.</span>
<a name="l1168"><span class="linenum">1168</span></a>  <span class="comment">     * @return user_competency</span>
<a name="l1169"><span class="linenum">1169</span></a>  <span class="comment">     */</span>
<a name="l1170"><span class="linenum">1170</span></a>      public static function <a class="function" onClick="logFunction('get_user_competency_by_id')" href="../../_functions/get_user_competency_by_id.html" onMouseOver="funcPopup(event,'get_user_competency_by_id')">get_user_competency_by_id</a>(<a class="var it9776" onMouseOver="hilite(9776)" onMouseOut="lolite()" onClick="logVariable('usercompetencyid')" href="../../_variables/usercompetencyid.html">$usercompetencyid</a>) {
<a name="l1171"><span class="linenum">1171</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1172"><span class="linenum">1172</span></a>          <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> = <span class="keyword">new </span><a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>(<a class="var it9776" onMouseOver="hilite(9776)" onMouseOut="lolite()" onClick="logVariable('usercompetencyid')" href="../../_variables/usercompetencyid.html">$usercompetencyid</a>);
<a name="l1173"><span class="linenum">1173</span></a>          if (!<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l1174"><span class="linenum">1174</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:usercompetencyview',
<a name="l1175"><span class="linenum">1175</span></a>                  'nopermissions', '');
<a name="l1176"><span class="linenum">1176</span></a>          }
<a name="l1177"><span class="linenum">1177</span></a>          return <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>;
<a name="l1178"><span class="linenum">1178</span></a>      }
<a name="l1179"><span class="linenum">1179</span></a>  
<a name="l1180"><span class="linenum">1180</span></a>      <span class="comment">/**</span>
<a name="l1181"><span class="linenum">1181</span></a>  <span class="comment">     * List the competencies associated to a course module.</span>
<a name="l1182"><span class="linenum">1182</span></a>  <span class="comment">     *</span>
<a name="l1183"><span class="linenum">1183</span></a>  <span class="comment">     * @param mixed $cmorid The course module, or its ID.</span>
<a name="l1184"><span class="linenum">1184</span></a>  <span class="comment">     * @return array( array(</span>
<a name="l1185"><span class="linenum">1185</span></a>  <span class="comment">     *                   'competency' =&gt; \core_competency\competency,</span>
<a name="l1186"><span class="linenum">1186</span></a>  <span class="comment">     *                   'coursemodulecompetency' =&gt; \core_competency\course_module_competency</span>
<a name="l1187"><span class="linenum">1187</span></a>  <span class="comment">     *              ))</span>
<a name="l1188"><span class="linenum">1188</span></a>  <span class="comment">     */</span>
<a name="l1189"><span class="linenum">1189</span></a>      public static function <a class="function" onClick="logFunction('list_course_module_competencies')" href="../../_functions/list_course_module_competencies.html" onMouseOver="funcPopup(event,'list_course_module_competencies')">list_course_module_competencies</a>(<a class="var it9151" onMouseOver="hilite(9151)" onMouseOut="lolite()" onClick="logVariable('cmorid')" href="../../_variables/cmorid.html">$cmorid</a>) {
<a name="l1190"><span class="linenum">1190</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1191"><span class="linenum">1191</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="var it9151" onMouseOver="hilite(9151)" onMouseOut="lolite()" onClick="logVariable('cmorid')" href="../../_variables/cmorid.html">$cmorid</a>;
<a name="l1192"><span class="linenum">1192</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it9151" onMouseOver="hilite(9151)" onMouseOut="lolite()" onClick="logVariable('cmorid')" href="../../_variables/cmorid.html">$cmorid</a>)) {
<a name="l1193"><span class="linenum">1193</span></a>              <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_id')" href="../../_functions/get_coursemodule_from_id.html" onMouseOver="funcPopup(event,'get_coursemodule_from_id')">get_coursemodule_from_id</a>('', <a class="var it9151" onMouseOver="hilite(9151)" onMouseOut="lolite()" onClick="logVariable('cmorid')" href="../../_variables/cmorid.html">$cmorid</a>, 0, true, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l1194"><span class="linenum">1194</span></a>          }
<a name="l1195"><span class="linenum">1195</span></a>  
<a name="l1196"><span class="linenum">1196</span></a>  <span class="comment">        // Check the user have access to the course module.</span>
<a name="l1197"><span class="linenum">1197</span></a>          self::<a class="function" onClick="logFunction('validate_course_module')" href="../../_functions/validate_course_module.html" onMouseOver="funcPopup(event,'validate_course_module')">validate_course_module</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l1198"><span class="linenum">1198</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1199"><span class="linenum">1199</span></a>  
<a name="l1200"><span class="linenum">1200</span></a>          <a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a> = array('moodle/competency:coursecompetencyview', 'moodle/competency:coursecompetencymanage');
<a name="l1201"><span class="linenum">1201</span></a>          if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(<a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l1202"><span class="linenum">1202</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:coursecompetencyview', 'nopermissions', '');
<a name="l1203"><span class="linenum">1203</span></a>          }
<a name="l1204"><span class="linenum">1204</span></a>  
<a name="l1205"><span class="linenum">1205</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = array();
<a name="l1206"><span class="linenum">1206</span></a>  
<a name="l1207"><span class="linenum">1207</span></a>  <span class="comment">        // TODO We could improve the performance of this into one single query.</span>
<a name="l1208"><span class="linenum">1208</span></a>          <a class="var it30438" onMouseOver="hilite(30438)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetencies')" href="../../_variables/coursemodulecompetencies.html">$coursemodulecompetencies</a> = <a class="class" onClick="logClass('course_competency')" href="../../_classes/course_competency.html" onMouseOver="classPopup(event,'course_competency')">course_competency</a>::<a class="function" onClick="logFunction('list_course_module_competencies')" href="../../_functions/list_course_module_competencies.html" onMouseOver="funcPopup(event,'list_course_module_competencies')">list_course_module_competencies</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1209"><span class="linenum">1209</span></a>          <a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a> = <a class="class" onClick="logClass('course_module_competency')" href="../../_classes/course_module_competency.html" onMouseOver="classPopup(event,'course_module_competency')">course_module_competency</a>::<a class="function" onClick="logFunction('list_competencies')" href="../../_functions/list_competencies.html" onMouseOver="funcPopup(event,'list_competencies')">list_competencies</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1210"><span class="linenum">1210</span></a>  
<a name="l1211"><span class="linenum">1211</span></a>  <span class="comment">        // Build the return values.</span>
<a name="l1212"><span class="linenum">1212</span></a>          foreach (<a class="var it30438" onMouseOver="hilite(30438)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetencies')" href="../../_variables/coursemodulecompetencies.html">$coursemodulecompetencies</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> =&gt; <a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a>) {
<a name="l1213"><span class="linenum">1213</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>[] = array(
<a name="l1214"><span class="linenum">1214</span></a>                  'competency' =&gt; <a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a>[<a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a>-&gt;get_competencyid()],
<a name="l1215"><span class="linenum">1215</span></a>                  'coursemodulecompetency' =&gt; <a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a>
<a name="l1216"><span class="linenum">1216</span></a>              );
<a name="l1217"><span class="linenum">1217</span></a>          }
<a name="l1218"><span class="linenum">1218</span></a>  
<a name="l1219"><span class="linenum">1219</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l1220"><span class="linenum">1220</span></a>      }
<a name="l1221"><span class="linenum">1221</span></a>  
<a name="l1222"><span class="linenum">1222</span></a>      <span class="comment">/**</span>
<a name="l1223"><span class="linenum">1223</span></a>  <span class="comment">     * Get a user competency in a course.</span>
<a name="l1224"><span class="linenum">1224</span></a>  <span class="comment">     *</span>
<a name="l1225"><span class="linenum">1225</span></a>  <span class="comment">     * @param int $courseid The id of the course to check.</span>
<a name="l1226"><span class="linenum">1226</span></a>  <span class="comment">     * @param int $userid The id of the course to check.</span>
<a name="l1227"><span class="linenum">1227</span></a>  <span class="comment">     * @param int $competencyid The id of the competency.</span>
<a name="l1228"><span class="linenum">1228</span></a>  <span class="comment">     * @return user_competency_course</span>
<a name="l1229"><span class="linenum">1229</span></a>  <span class="comment">     */</span>
<a name="l1230"><span class="linenum">1230</span></a>      public static function <a class="function" onClick="logFunction('get_user_competency_in_course')" href="../../_functions/get_user_competency_in_course.html" onMouseOver="funcPopup(event,'get_user_competency_in_course')">get_user_competency_in_course</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>) {
<a name="l1231"><span class="linenum">1231</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1232"><span class="linenum">1232</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l1233"><span class="linenum">1233</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l1234"><span class="linenum">1234</span></a>  
<a name="l1235"><span class="linenum">1235</span></a>          <a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a> = array('moodle/competency:coursecompetencyview', 'moodle/competency:coursecompetencymanage');
<a name="l1236"><span class="linenum">1236</span></a>          if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(<a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l1237"><span class="linenum">1237</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:coursecompetencyview', 'nopermissions', '');
<a name="l1238"><span class="linenum">1238</span></a>          } else if (!<a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('can_read_user_in_course')" href="../../_functions/can_read_user_in_course.html" onMouseOver="funcPopup(event,'can_read_user_in_course')">can_read_user_in_course</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>)) {
<a name="l1239"><span class="linenum">1239</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:usercompetencyview', 'nopermissions', '');
<a name="l1240"><span class="linenum">1240</span></a>          }
<a name="l1241"><span class="linenum">1241</span></a>  
<a name="l1242"><span class="linenum">1242</span></a>  <span class="comment">        // This will throw an exception if the competency does not belong to the course.</span>
<a name="l1243"><span class="linenum">1243</span></a>          <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <a class="class" onClick="logClass('course_competency')" href="../../_classes/course_competency.html" onMouseOver="classPopup(event,'course_competency')">course_competency</a>::<a class="function" onClick="logFunction('get_competency')" href="../../_functions/get_competency.html" onMouseOver="funcPopup(event,'get_competency')">get_competency</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l1244"><span class="linenum">1244</span></a>  
<a name="l1245"><span class="linenum">1245</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('courseid' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, 'userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, 'competencyid' =&gt; <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l1246"><span class="linenum">1246</span></a>          <a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a> = <a class="class" onClick="logClass('user_competency_course')" href="../../_classes/user_competency_course.html" onMouseOver="classPopup(event,'user_competency_course')">user_competency_course</a>::<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l1247"><span class="linenum">1247</span></a>  <span class="comment">        // Create missing.</span>
<a name="l1248"><span class="linenum">1248</span></a>          if (<a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a>) {
<a name="l1249"><span class="linenum">1249</span></a>              <a class="var it30439" onMouseOver="hilite(30439)" onMouseOut="lolite()" onClick="logVariable('ucc')" href="../../_variables/ucc.html">$ucc</a> = <a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a>;
<a name="l1250"><span class="linenum">1250</span></a>          } else {
<a name="l1251"><span class="linenum">1251</span></a>              <a class="var it30439" onMouseOver="hilite(30439)" onMouseOut="lolite()" onClick="logVariable('ucc')" href="../../_variables/ucc.html">$ucc</a> = <a class="class" onClick="logClass('user_competency_course')" href="../../_classes/user_competency_course.html" onMouseOver="classPopup(event,'user_competency_course')">user_competency_course</a>::<a class="function" onClick="logFunction('create_relation')" href="../../_functions/create_relation.html" onMouseOver="funcPopup(event,'create_relation')">create_relation</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(), <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l1252"><span class="linenum">1252</span></a>              <a class="var it30439" onMouseOver="hilite(30439)" onMouseOut="lolite()" onClick="logVariable('ucc')" href="../../_variables/ucc.html">$ucc</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l1253"><span class="linenum">1253</span></a>          }
<a name="l1254"><span class="linenum">1254</span></a>  
<a name="l1255"><span class="linenum">1255</span></a>          return <a class="var it30439" onMouseOver="hilite(30439)" onMouseOut="lolite()" onClick="logVariable('ucc')" href="../../_variables/ucc.html">$ucc</a>;
<a name="l1256"><span class="linenum">1256</span></a>      }
<a name="l1257"><span class="linenum">1257</span></a>  
<a name="l1258"><span class="linenum">1258</span></a>      <span class="comment">/**</span>
<a name="l1259"><span class="linenum">1259</span></a>  <span class="comment">     * List all the user competencies in a course.</span>
<a name="l1260"><span class="linenum">1260</span></a>  <span class="comment">     *</span>
<a name="l1261"><span class="linenum">1261</span></a>  <span class="comment">     * @param int $courseid The id of the course to check.</span>
<a name="l1262"><span class="linenum">1262</span></a>  <span class="comment">     * @param int $userid The id of the course to check.</span>
<a name="l1263"><span class="linenum">1263</span></a>  <span class="comment">     * @return array of user_competency_course objects</span>
<a name="l1264"><span class="linenum">1264</span></a>  <span class="comment">     */</span>
<a name="l1265"><span class="linenum">1265</span></a>      public static function <a class="function" onClick="logFunction('list_user_competencies_in_course')" href="../../_functions/list_user_competencies_in_course.html" onMouseOver="funcPopup(event,'list_user_competencies_in_course')">list_user_competencies_in_course</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) {
<a name="l1266"><span class="linenum">1266</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1267"><span class="linenum">1267</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l1268"><span class="linenum">1268</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l1269"><span class="linenum">1269</span></a>          <a class="var it4855" onMouseOver="hilite(4855)" onMouseOut="lolite()" onClick="logVariable('onlyvisible')" href="../../_variables/onlyvisible.html">$onlyvisible</a> = 1;
<a name="l1270"><span class="linenum">1270</span></a>  
<a name="l1271"><span class="linenum">1271</span></a>          <a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a> = array('moodle/competency:coursecompetencyview', 'moodle/competency:coursecompetencymanage');
<a name="l1272"><span class="linenum">1272</span></a>          if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(<a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l1273"><span class="linenum">1273</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:coursecompetencyview', 'nopermissions', '');
<a name="l1274"><span class="linenum">1274</span></a>          } else if (!<a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('can_read_user_in_course')" href="../../_functions/can_read_user_in_course.html" onMouseOver="funcPopup(event,'can_read_user_in_course')">can_read_user_in_course</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>)) {
<a name="l1275"><span class="linenum">1275</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:usercompetencyview', 'nopermissions', '');
<a name="l1276"><span class="linenum">1276</span></a>          }
<a name="l1277"><span class="linenum">1277</span></a>  
<a name="l1278"><span class="linenum">1278</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l1279"><span class="linenum">1279</span></a>          <a class="var it30440" onMouseOver="hilite(30440)" onMouseOut="lolite()" onClick="logVariable('competencylist')" href="../../_variables/competencylist.html">$competencylist</a> = <a class="class" onClick="logClass('course_competency')" href="../../_classes/course_competency.html" onMouseOver="classPopup(event,'course_competency')">course_competency</a>::<a class="function" onClick="logFunction('list_competencies')" href="../../_functions/list_competencies.html" onMouseOver="funcPopup(event,'list_competencies')">list_competencies</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, false);
<a name="l1280"><span class="linenum">1280</span></a>  
<a name="l1281"><span class="linenum">1281</span></a>          <a class="var it10898" onMouseOver="hilite(10898)" onMouseOut="lolite()" onClick="logVariable('existing')" href="../../_variables/existing.html">$existing</a> = <a class="class" onClick="logClass('user_competency_course')" href="../../_classes/user_competency_course.html" onMouseOver="classPopup(event,'user_competency_course')">user_competency_course</a>::<a class="function" onClick="logFunction('get_multiple')" href="../../_functions/get_multiple.html" onMouseOver="funcPopup(event,'get_multiple')">get_multiple</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it30440" onMouseOver="hilite(30440)" onMouseOut="lolite()" onClick="logVariable('competencylist')" href="../../_variables/competencylist.html">$competencylist</a>);
<a name="l1282"><span class="linenum">1282</span></a>  <span class="comment">        // Create missing.</span>
<a name="l1283"><span class="linenum">1283</span></a>          <a class="var it30441" onMouseOver="hilite(30441)" onMouseOut="lolite()" onClick="logVariable('orderedusercompetencycourses')" href="../../_variables/orderedusercompetencycourses.html">$orderedusercompetencycourses</a> = array();
<a name="l1284"><span class="linenum">1284</span></a>  
<a name="l1285"><span class="linenum">1285</span></a>          <a class="var it30442" onMouseOver="hilite(30442)" onMouseOut="lolite()" onClick="logVariable('somemissing')" href="../../_variables/somemissing.html">$somemissing</a> = false;
<a name="l1286"><span class="linenum">1286</span></a>          foreach (<a class="var it30440" onMouseOver="hilite(30440)" onMouseOut="lolite()" onClick="logVariable('competencylist')" href="../../_variables/competencylist.html">$competencylist</a> as <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>) {
<a name="l1287"><span class="linenum">1287</span></a>              <a class="var it811" onMouseOver="hilite(811)" onMouseOut="lolite()" onClick="logVariable('found')" href="../../_variables/found.html">$found</a> = false;
<a name="l1288"><span class="linenum">1288</span></a>              foreach (<a class="var it10898" onMouseOver="hilite(10898)" onMouseOut="lolite()" onClick="logVariable('existing')" href="../../_variables/existing.html">$existing</a> as <a class="var it9652" onMouseOver="hilite(9652)" onMouseOut="lolite()" onClick="logVariable('usercompetencycourse')" href="../../_variables/usercompetencycourse.html">$usercompetencycourse</a>) {
<a name="l1289"><span class="linenum">1289</span></a>                  if (<a class="var it9652" onMouseOver="hilite(9652)" onMouseOut="lolite()" onClick="logVariable('usercompetencycourse')" href="../../_variables/usercompetencycourse.html">$usercompetencycourse</a>-&gt;get_competencyid() == <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>()) {
<a name="l1290"><span class="linenum">1290</span></a>                      <a class="var it811" onMouseOver="hilite(811)" onMouseOut="lolite()" onClick="logVariable('found')" href="../../_variables/found.html">$found</a> = true;
<a name="l1291"><span class="linenum">1291</span></a>                      <a class="var it30441" onMouseOver="hilite(30441)" onMouseOut="lolite()" onClick="logVariable('orderedusercompetencycourses')" href="../../_variables/orderedusercompetencycourses.html">$orderedusercompetencycourses</a>[<a class="var it9652" onMouseOver="hilite(9652)" onMouseOut="lolite()" onClick="logVariable('usercompetencycourse')" href="../../_variables/usercompetencycourse.html">$usercompetencycourse</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>()] = <a class="var it9652" onMouseOver="hilite(9652)" onMouseOut="lolite()" onClick="logVariable('usercompetencycourse')" href="../../_variables/usercompetencycourse.html">$usercompetencycourse</a>;
<a name="l1292"><span class="linenum">1292</span></a>                      break;
<a name="l1293"><span class="linenum">1293</span></a>                  }
<a name="l1294"><span class="linenum">1294</span></a>              }
<a name="l1295"><span class="linenum">1295</span></a>              if (!<a class="var it811" onMouseOver="hilite(811)" onMouseOut="lolite()" onClick="logVariable('found')" href="../../_variables/found.html">$found</a>) {
<a name="l1296"><span class="linenum">1296</span></a>                  <a class="var it30439" onMouseOver="hilite(30439)" onMouseOut="lolite()" onClick="logVariable('ucc')" href="../../_variables/ucc.html">$ucc</a> = <a class="class" onClick="logClass('user_competency_course')" href="../../_classes/user_competency_course.html" onMouseOver="classPopup(event,'user_competency_course')">user_competency_course</a>::<a class="function" onClick="logFunction('create_relation')" href="../../_functions/create_relation.html" onMouseOver="funcPopup(event,'create_relation')">create_relation</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(), <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l1297"><span class="linenum">1297</span></a>                  <a class="var it30439" onMouseOver="hilite(30439)" onMouseOut="lolite()" onClick="logVariable('ucc')" href="../../_variables/ucc.html">$ucc</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l1298"><span class="linenum">1298</span></a>                  <a class="var it30441" onMouseOver="hilite(30441)" onMouseOut="lolite()" onClick="logVariable('orderedusercompetencycourses')" href="../../_variables/orderedusercompetencycourses.html">$orderedusercompetencycourses</a>[<a class="var it30439" onMouseOver="hilite(30439)" onMouseOut="lolite()" onClick="logVariable('ucc')" href="../../_variables/ucc.html">$ucc</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>()] = <a class="var it30439" onMouseOver="hilite(30439)" onMouseOut="lolite()" onClick="logVariable('ucc')" href="../../_variables/ucc.html">$ucc</a>;
<a name="l1299"><span class="linenum">1299</span></a>              }
<a name="l1300"><span class="linenum">1300</span></a>          }
<a name="l1301"><span class="linenum">1301</span></a>  
<a name="l1302"><span class="linenum">1302</span></a>          return <a class="var it30441" onMouseOver="hilite(30441)" onMouseOut="lolite()" onClick="logVariable('orderedusercompetencycourses')" href="../../_variables/orderedusercompetencycourses.html">$orderedusercompetencycourses</a>;
<a name="l1303"><span class="linenum">1303</span></a>      }
<a name="l1304"><span class="linenum">1304</span></a>  
<a name="l1305"><span class="linenum">1305</span></a>      <span class="comment">/**</span>
<a name="l1306"><span class="linenum">1306</span></a>  <span class="comment">     * List the user competencies to review.</span>
<a name="l1307"><span class="linenum">1307</span></a>  <span class="comment">     *</span>
<a name="l1308"><span class="linenum">1308</span></a>  <span class="comment">     * The method returns values in this format:</span>
<a name="l1309"><span class="linenum">1309</span></a>  <span class="comment">     *</span>
<a name="l1310"><span class="linenum">1310</span></a>  <span class="comment">     * array(</span>
<a name="l1311"><span class="linenum">1311</span></a>  <span class="comment">     *     'competencies' =&gt; array(</span>
<a name="l1312"><span class="linenum">1312</span></a>  <span class="comment">     *         (stdClass)(</span>
<a name="l1313"><span class="linenum">1313</span></a>  <span class="comment">     *             'usercompetency' =&gt; (user_competency),</span>
<a name="l1314"><span class="linenum">1314</span></a>  <span class="comment">     *             'competency' =&gt; (competency),</span>
<a name="l1315"><span class="linenum">1315</span></a>  <span class="comment">     *             'user' =&gt; (user)</span>
<a name="l1316"><span class="linenum">1316</span></a>  <span class="comment">     *         )</span>
<a name="l1317"><span class="linenum">1317</span></a>  <span class="comment">     *     ),</span>
<a name="l1318"><span class="linenum">1318</span></a>  <span class="comment">     *     'count' =&gt; (int)</span>
<a name="l1319"><span class="linenum">1319</span></a>  <span class="comment">     * )</span>
<a name="l1320"><span class="linenum">1320</span></a>  <span class="comment">     *</span>
<a name="l1321"><span class="linenum">1321</span></a>  <span class="comment">     * @param int $skip The number of records to skip.</span>
<a name="l1322"><span class="linenum">1322</span></a>  <span class="comment">     * @param int $limit The number of results to return.</span>
<a name="l1323"><span class="linenum">1323</span></a>  <span class="comment">     * @param int $userid The user we're getting the competencies to review for.</span>
<a name="l1324"><span class="linenum">1324</span></a>  <span class="comment">     * @return array Containing the keys 'count', and 'competencies'. The 'competencies' key contains an object</span>
<a name="l1325"><span class="linenum">1325</span></a>  <span class="comment">     *               which contains 'competency', 'usercompetency' and 'user'.</span>
<a name="l1326"><span class="linenum">1326</span></a>  <span class="comment">     */</span>
<a name="l1327"><span class="linenum">1327</span></a>      public static function <a class="function" onClick="logFunction('list_user_competencies_to_review')" href="../../_functions/list_user_competencies_to_review.html" onMouseOver="funcPopup(event,'list_user_competencies_to_review')">list_user_competencies_to_review</a>(<a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('skip')" href="../../_variables/skip.html">$skip</a> = 0, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a> = 50, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> = null) {
<a name="l1328"><span class="linenum">1328</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l1329"><span class="linenum">1329</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1330"><span class="linenum">1330</span></a>          if (<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> === null) {
<a name="l1331"><span class="linenum">1331</span></a>              <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l1332"><span class="linenum">1332</span></a>          }
<a name="l1333"><span class="linenum">1333</span></a>  
<a name="l1334"><span class="linenum">1334</span></a>          <a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a> = 'moodle/competency:usercompetencyreview';
<a name="l1335"><span class="linenum">1335</span></a>          <a class="var it30443" onMouseOver="hilite(30443)" onMouseOut="lolite()" onClick="logVariable('ucfields')" href="../../_variables/ucfields.html">$ucfields</a> = <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('get_sql_fields')" href="../../_functions/get_sql_fields.html" onMouseOver="funcPopup(event,'get_sql_fields')">get_sql_fields</a>('uc', 'uc_');
<a name="l1336"><span class="linenum">1336</span></a>          <a class="var it30444" onMouseOver="hilite(30444)" onMouseOut="lolite()" onClick="logVariable('compfields')" href="../../_variables/compfields.html">$compfields</a> = <a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>::<a class="function" onClick="logFunction('get_sql_fields')" href="../../_functions/get_sql_fields.html" onMouseOver="funcPopup(event,'get_sql_fields')">get_sql_fields</a>('c', 'c_');
<a name="l1337"><span class="linenum">1337</span></a>          <a class="var it30445" onMouseOver="hilite(30445)" onMouseOut="lolite()" onClick="logVariable('usercols')" href="../../_variables/usercols.html">$usercols</a> = array('id') + <a class="function" onClick="logFunction('get_user_fieldnames')" href="../../_functions/get_user_fieldnames.html" onMouseOver="funcPopup(event,'get_user_fieldnames')">get_user_fieldnames</a>();
<a name="l1338"><span class="linenum">1338</span></a>          <a class="var it4004" onMouseOver="hilite(4004)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a> = array();
<a name="l1339"><span class="linenum">1339</span></a>          foreach (<a class="var it30445" onMouseOver="hilite(30445)" onMouseOut="lolite()" onClick="logVariable('usercols')" href="../../_variables/usercols.html">$usercols</a> as <a class="var it59" onMouseOver="hilite(59)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>) {
<a name="l1340"><span class="linenum">1340</span></a>              <a class="var it4004" onMouseOver="hilite(4004)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a>[] = &quot;u.&quot; . <a class="var it59" onMouseOver="hilite(59)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> . &quot; AS usr_&quot; . <a class="var it59" onMouseOver="hilite(59)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>;
<a name="l1341"><span class="linenum">1341</span></a>          }
<a name="l1342"><span class="linenum">1342</span></a>          <a class="var it4004" onMouseOver="hilite(4004)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',', <a class="var it4004" onMouseOver="hilite(4004)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a>);
<a name="l1343"><span class="linenum">1343</span></a>  
<a name="l1344"><span class="linenum">1344</span></a>          <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> = &quot;SELECT <a class="var it30443" onMouseOver="hilite(30443)" onMouseOut="lolite()" onClick="logVariable('ucfields')" href="../../_variables/ucfields.html">$ucfields</a>, <a class="var it30444" onMouseOver="hilite(30444)" onMouseOut="lolite()" onClick="logVariable('compfields')" href="../../_variables/compfields.html">$compfields</a>, <a class="var it4004" onMouseOver="hilite(4004)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a>&quot;;
<a name="l1345"><span class="linenum">1345</span></a>          <a class="var it30446" onMouseOver="hilite(30446)" onMouseOut="lolite()" onClick="logVariable('countselect')" href="../../_variables/countselect.html">$countselect</a> = &quot;SELECT <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>('x')&quot;;
<a name="l1346"><span class="linenum">1346</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;  FROM {&quot; . <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::TABLE . &quot;} uc
<a name="l1347"><span class="linenum">1347</span></a>                    JOIN {&quot; . <a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>::TABLE . &quot;} c
<a name="l1348"><span class="linenum">1348</span></a>                      ON c.id = uc.competencyid
<a name="l1349"><span class="linenum">1349</span></a>                    JOIN {user} u
<a name="l1350"><span class="linenum">1350</span></a>                      ON u.id = uc.userid
<a name="l1351"><span class="linenum">1351</span></a>                   <a class="function" onClick="logFunction('WHERE')" href="../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a> (uc.status = :waitingforreview
<a name="l1352"><span class="linenum">1352</span></a>                      <a class="function" onClick="logFunction('OR')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (uc.status = :inreview AND uc.reviewerid = :reviewerid))&quot;;
<a name="l1353"><span class="linenum">1353</span></a>          <a class="var it12570" onMouseOver="hilite(12570)" onMouseOut="lolite()" onClick="logVariable('ordersql')" href="../../_variables/ordersql.html">$ordersql</a> = &quot; ORDER BY c.shortname ASC&quot;;
<a name="l1354"><span class="linenum">1354</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(
<a name="l1355"><span class="linenum">1355</span></a>              'inreview' =&gt; <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::STATUS_IN_REVIEW,
<a name="l1356"><span class="linenum">1356</span></a>              'reviewerid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>,
<a name="l1357"><span class="linenum">1357</span></a>              'waitingforreview' =&gt; <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::STATUS_WAITING_FOR_REVIEW,
<a name="l1358"><span class="linenum">1358</span></a>          );
<a name="l1359"><span class="linenum">1359</span></a>          <a class="var it5529" onMouseOver="hilite(5529)" onMouseOut="lolite()" onClick="logVariable('countsql')" href="../../_variables/countsql.html">$countsql</a> = <a class="var it30446" onMouseOver="hilite(30446)" onMouseOut="lolite()" onClick="logVariable('countselect')" href="../../_variables/countselect.html">$countselect</a> . <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>;
<a name="l1360"><span class="linenum">1360</span></a>  
<a name="l1361"><span class="linenum">1361</span></a>  <span class="comment">        // Primary check to avoid the hard work of getting the users in which the user has permission.</span>
<a name="l1362"><span class="linenum">1362</span></a>          <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records_sql')" href="../../_functions/count_records_sql.html" onMouseOver="funcPopup(event,'count_records_sql')">count_records_sql</a>(<a class="var it30446" onMouseOver="hilite(30446)" onMouseOut="lolite()" onClick="logVariable('countselect')" href="../../_variables/countselect.html">$countselect</a> . <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l1363"><span class="linenum">1363</span></a>          if (<a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> &lt; 1) {
<a name="l1364"><span class="linenum">1364</span></a>              return array('count' =&gt; 0, 'competencies' =&gt; array());
<a name="l1365"><span class="linenum">1365</span></a>          }
<a name="l1366"><span class="linenum">1366</span></a>  
<a name="l1367"><span class="linenum">1367</span></a>  <span class="comment">        // TODO MDL-52243 Use core function.</span>
<a name="l1368"><span class="linenum">1368</span></a>          <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it1041" onMouseOver="hilite(1041)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../../_variables/insql.html">$insql</a>, <a class="var it4859" onMouseOver="hilite(4859)" onMouseOut="lolite()" onClick="logVariable('inparams')" href="../../_variables/inparams.html">$inparams</a>) = self::<a class="function" onClick="logFunction('filter_users_with_capability_on_user_context_sql')" href="../../_functions/filter_users_with_capability_on_user_context_sql.html" onMouseOver="funcPopup(event,'filter_users_with_capability_on_user_context_sql')">filter_users_with_capability_on_user_context_sql</a>(
<a name="l1369"><span class="linenum">1369</span></a>              <a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>);
<a name="l1370"><span class="linenum">1370</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> += <a class="var it4859" onMouseOver="hilite(4859)" onMouseOut="lolite()" onClick="logVariable('inparams')" href="../../_variables/inparams.html">$inparams</a>;
<a name="l1371"><span class="linenum">1371</span></a>          <a class="var it5529" onMouseOver="hilite(5529)" onMouseOut="lolite()" onClick="logVariable('countsql')" href="../../_variables/countsql.html">$countsql</a> = <a class="var it30446" onMouseOver="hilite(30446)" onMouseOut="lolite()" onClick="logVariable('countselect')" href="../../_variables/countselect.html">$countselect</a> . <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> . &quot; AND uc.userid <a class="var it1041" onMouseOver="hilite(1041)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../../_variables/insql.html">$insql</a>&quot;;
<a name="l1372"><span class="linenum">1372</span></a>          <a class="var it30447" onMouseOver="hilite(30447)" onMouseOut="lolite()" onClick="logVariable('getsql')" href="../../_variables/getsql.html">$getsql</a> = <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> . <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> . &quot; AND uc.userid <a class="var it1041" onMouseOver="hilite(1041)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../../_variables/insql.html">$insql</a> &quot; . <a class="var it12570" onMouseOver="hilite(12570)" onMouseOut="lolite()" onClick="logVariable('ordersql')" href="../../_variables/ordersql.html">$ordersql</a>;
<a name="l1373"><span class="linenum">1373</span></a>  
<a name="l1374"><span class="linenum">1374</span></a>  <span class="comment">        // Extracting the results.</span>
<a name="l1375"><span class="linenum">1375</span></a>          <a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a> = array();
<a name="l1376"><span class="linenum">1376</span></a>          <a class="var it988" onMouseOver="hilite(988)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../_variables/records.html">$records</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it30447" onMouseOver="hilite(30447)" onMouseOut="lolite()" onClick="logVariable('getsql')" href="../../_variables/getsql.html">$getsql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, <a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('skip')" href="../../_variables/skip.html">$skip</a>, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a>);
<a name="l1377"><span class="linenum">1377</span></a>          foreach (<a class="var it988" onMouseOver="hilite(988)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../_variables/records.html">$records</a> as <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>) {
<a name="l1378"><span class="linenum">1378</span></a>              <a class="var it2204" onMouseOver="hilite(2204)" onMouseOut="lolite()" onClick="logVariable('objects')" href="../../_variables/objects.html">$objects</a> = (object) array(
<a name="l1379"><span class="linenum">1379</span></a>                  'usercompetency' =&gt; <span class="keyword">new </span><a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>(0, <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('extract_record')" href="../../_functions/extract_record.html" onMouseOver="funcPopup(event,'extract_record')">extract_record</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>, 'uc_')),
<a name="l1380"><span class="linenum">1380</span></a>                  'competency' =&gt; <span class="keyword">new </span><a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>(0, <a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>::<a class="function" onClick="logFunction('extract_record')" href="../../_functions/extract_record.html" onMouseOver="funcPopup(event,'extract_record')">extract_record</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>, 'c_')),
<a name="l1381"><span class="linenum">1381</span></a>                  'user' =&gt; persistent::<a class="function" onClick="logFunction('extract_record')" href="../../_functions/extract_record.html" onMouseOver="funcPopup(event,'extract_record')">extract_record</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>, 'usr_'),
<a name="l1382"><span class="linenum">1382</span></a>              );
<a name="l1383"><span class="linenum">1383</span></a>              <a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a>[] = <a class="var it2204" onMouseOver="hilite(2204)" onMouseOut="lolite()" onClick="logVariable('objects')" href="../../_variables/objects.html">$objects</a>;
<a name="l1384"><span class="linenum">1384</span></a>          }
<a name="l1385"><span class="linenum">1385</span></a>          <a class="var it988" onMouseOver="hilite(988)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../_variables/records.html">$records</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l1386"><span class="linenum">1386</span></a>  
<a name="l1387"><span class="linenum">1387</span></a>          return array(
<a name="l1388"><span class="linenum">1388</span></a>              'count' =&gt; <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records_sql')" href="../../_functions/count_records_sql.html" onMouseOver="funcPopup(event,'count_records_sql')">count_records_sql</a>(<a class="var it5529" onMouseOver="hilite(5529)" onMouseOut="lolite()" onClick="logVariable('countsql')" href="../../_variables/countsql.html">$countsql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>),
<a name="l1389"><span class="linenum">1389</span></a>              'competencies' =&gt; <a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a>
<a name="l1390"><span class="linenum">1390</span></a>          );
<a name="l1391"><span class="linenum">1391</span></a>      }
<a name="l1392"><span class="linenum">1392</span></a>  
<a name="l1393"><span class="linenum">1393</span></a>      <span class="comment">/**</span>
<a name="l1394"><span class="linenum">1394</span></a>  <span class="comment">     * Add a competency to this course module.</span>
<a name="l1395"><span class="linenum">1395</span></a>  <span class="comment">     *</span>
<a name="l1396"><span class="linenum">1396</span></a>  <span class="comment">     * @param mixed $cmorid The course module, or id of the course module</span>
<a name="l1397"><span class="linenum">1397</span></a>  <span class="comment">     * @param int $competencyid The id of the competency</span>
<a name="l1398"><span class="linenum">1398</span></a>  <span class="comment">     * @return bool</span>
<a name="l1399"><span class="linenum">1399</span></a>  <span class="comment">     */</span>
<a name="l1400"><span class="linenum">1400</span></a>      public static function <a class="function" onClick="logFunction('add_competency_to_course_module')" href="../../_functions/add_competency_to_course_module.html" onMouseOver="funcPopup(event,'add_competency_to_course_module')">add_competency_to_course_module</a>(<a class="var it9151" onMouseOver="hilite(9151)" onMouseOut="lolite()" onClick="logVariable('cmorid')" href="../../_variables/cmorid.html">$cmorid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>) {
<a name="l1401"><span class="linenum">1401</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1402"><span class="linenum">1402</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="var it9151" onMouseOver="hilite(9151)" onMouseOut="lolite()" onClick="logVariable('cmorid')" href="../../_variables/cmorid.html">$cmorid</a>;
<a name="l1403"><span class="linenum">1403</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it9151" onMouseOver="hilite(9151)" onMouseOut="lolite()" onClick="logVariable('cmorid')" href="../../_variables/cmorid.html">$cmorid</a>)) {
<a name="l1404"><span class="linenum">1404</span></a>              <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_id')" href="../../_functions/get_coursemodule_from_id.html" onMouseOver="funcPopup(event,'get_coursemodule_from_id')">get_coursemodule_from_id</a>('', <a class="var it9151" onMouseOver="hilite(9151)" onMouseOut="lolite()" onClick="logVariable('cmorid')" href="../../_variables/cmorid.html">$cmorid</a>, 0, true, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l1405"><span class="linenum">1405</span></a>          }
<a name="l1406"><span class="linenum">1406</span></a>  
<a name="l1407"><span class="linenum">1407</span></a>  <span class="comment">        // Check the user have access to the course module.</span>
<a name="l1408"><span class="linenum">1408</span></a>          self::<a class="function" onClick="logFunction('validate_course_module')" href="../../_functions/validate_course_module.html" onMouseOver="funcPopup(event,'validate_course_module')">validate_course_module</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l1409"><span class="linenum">1409</span></a>  
<a name="l1410"><span class="linenum">1410</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l1411"><span class="linenum">1411</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1412"><span class="linenum">1412</span></a>  
<a name="l1413"><span class="linenum">1413</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:coursecompetencymanage', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l1414"><span class="linenum">1414</span></a>  
<a name="l1415"><span class="linenum">1415</span></a>  <span class="comment">        // Check that the competency belongs to the course.</span>
<a name="l1416"><span class="linenum">1416</span></a>          <a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a> = <a class="class" onClick="logClass('course_competency')" href="../../_classes/course_competency.html" onMouseOver="classPopup(event,'course_competency')">course_competency</a>::<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(array('courseid' =&gt; <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('course')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>, 'competencyid' =&gt; <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>));
<a name="l1417"><span class="linenum">1417</span></a>          if (!<a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a>) {
<a name="l1418"><span class="linenum">1418</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Cannot add a competency to a module if it does not belong to the course');
<a name="l1419"><span class="linenum">1419</span></a>          }
<a name="l1420"><span class="linenum">1420</span></a>  
<a name="l1421"><span class="linenum">1421</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a> = new stdClass();
<a name="l1422"><span class="linenum">1422</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('cmid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/cmid.html">cmid</a> = <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l1423"><span class="linenum">1423</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('competencyid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/competencyid.html">competencyid</a> = <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>;
<a name="l1424"><span class="linenum">1424</span></a>  
<a name="l1425"><span class="linenum">1425</span></a>          <a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('course_module_competency')" href="../../_classes/course_module_competency.html" onMouseOver="classPopup(event,'course_module_competency')">course_module_competency</a>();
<a name="l1426"><span class="linenum">1426</span></a>          <a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a> = <a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(array('cmid' =&gt; <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'competencyid' =&gt; <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>));
<a name="l1427"><span class="linenum">1427</span></a>          if (!<a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a>) {
<a name="l1428"><span class="linenum">1428</span></a>              <a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a>-&gt;<a class="function" onClick="logFunction('from_record')" href="../../_functions/from_record.html" onMouseOver="funcPopup(event,'from_record')">from_record</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>);
<a name="l1429"><span class="linenum">1429</span></a>              if (<a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>()) {
<a name="l1430"><span class="linenum">1430</span></a>                  return true;
<a name="l1431"><span class="linenum">1431</span></a>              }
<a name="l1432"><span class="linenum">1432</span></a>          }
<a name="l1433"><span class="linenum">1433</span></a>          return false;
<a name="l1434"><span class="linenum">1434</span></a>      }
<a name="l1435"><span class="linenum">1435</span></a>  
<a name="l1436"><span class="linenum">1436</span></a>      <span class="comment">/**</span>
<a name="l1437"><span class="linenum">1437</span></a>  <span class="comment">     * Remove a competency from this course module.</span>
<a name="l1438"><span class="linenum">1438</span></a>  <span class="comment">     *</span>
<a name="l1439"><span class="linenum">1439</span></a>  <span class="comment">     * @param mixed $cmorid The course module, or id of the course module</span>
<a name="l1440"><span class="linenum">1440</span></a>  <span class="comment">     * @param int $competencyid The id of the competency</span>
<a name="l1441"><span class="linenum">1441</span></a>  <span class="comment">     * @return bool</span>
<a name="l1442"><span class="linenum">1442</span></a>  <span class="comment">     */</span>
<a name="l1443"><span class="linenum">1443</span></a>      public static function <a class="function" onClick="logFunction('remove_competency_from_course_module')" href="../../_functions/remove_competency_from_course_module.html" onMouseOver="funcPopup(event,'remove_competency_from_course_module')">remove_competency_from_course_module</a>(<a class="var it9151" onMouseOver="hilite(9151)" onMouseOut="lolite()" onClick="logVariable('cmorid')" href="../../_variables/cmorid.html">$cmorid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>) {
<a name="l1444"><span class="linenum">1444</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1445"><span class="linenum">1445</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="var it9151" onMouseOver="hilite(9151)" onMouseOut="lolite()" onClick="logVariable('cmorid')" href="../../_variables/cmorid.html">$cmorid</a>;
<a name="l1446"><span class="linenum">1446</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it9151" onMouseOver="hilite(9151)" onMouseOut="lolite()" onClick="logVariable('cmorid')" href="../../_variables/cmorid.html">$cmorid</a>)) {
<a name="l1447"><span class="linenum">1447</span></a>              <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_id')" href="../../_functions/get_coursemodule_from_id.html" onMouseOver="funcPopup(event,'get_coursemodule_from_id')">get_coursemodule_from_id</a>('', <a class="var it9151" onMouseOver="hilite(9151)" onMouseOut="lolite()" onClick="logVariable('cmorid')" href="../../_variables/cmorid.html">$cmorid</a>, 0, true, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l1448"><span class="linenum">1448</span></a>          }
<a name="l1449"><span class="linenum">1449</span></a>  <span class="comment">        // Check the user have access to the course module.</span>
<a name="l1450"><span class="linenum">1450</span></a>          self::<a class="function" onClick="logFunction('validate_course_module')" href="../../_functions/validate_course_module.html" onMouseOver="funcPopup(event,'validate_course_module')">validate_course_module</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l1451"><span class="linenum">1451</span></a>  
<a name="l1452"><span class="linenum">1452</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l1453"><span class="linenum">1453</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1454"><span class="linenum">1454</span></a>  
<a name="l1455"><span class="linenum">1455</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:coursecompetencymanage', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l1456"><span class="linenum">1456</span></a>  
<a name="l1457"><span class="linenum">1457</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a> = new stdClass();
<a name="l1458"><span class="linenum">1458</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('cmid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/cmid.html">cmid</a> = <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l1459"><span class="linenum">1459</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('competencyid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/competencyid.html">competencyid</a> = <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>;
<a name="l1460"><span class="linenum">1460</span></a>  
<a name="l1461"><span class="linenum">1461</span></a>          <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l1462"><span class="linenum">1462</span></a>          <a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a> = <a class="class" onClick="logClass('course_module_competency')" href="../../_classes/course_module_competency.html" onMouseOver="classPopup(event,'course_module_competency')">course_module_competency</a>::<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(array('cmid' =&gt; <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'competencyid' =&gt; <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>));
<a name="l1463"><span class="linenum">1463</span></a>          if (<a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a>) {
<a name="l1464"><span class="linenum">1464</span></a>              return <a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l1465"><span class="linenum">1465</span></a>          }
<a name="l1466"><span class="linenum">1466</span></a>          return false;
<a name="l1467"><span class="linenum">1467</span></a>      }
<a name="l1468"><span class="linenum">1468</span></a>  
<a name="l1469"><span class="linenum">1469</span></a>      <span class="comment">/**</span>
<a name="l1470"><span class="linenum">1470</span></a>  <span class="comment">     * Move the course module competency up or down in the display list.</span>
<a name="l1471"><span class="linenum">1471</span></a>  <span class="comment">     *</span>
<a name="l1472"><span class="linenum">1472</span></a>  <span class="comment">     * Requires moodle/competency:coursecompetencymanage capability at the course module context.</span>
<a name="l1473"><span class="linenum">1473</span></a>  <span class="comment">     *</span>
<a name="l1474"><span class="linenum">1474</span></a>  <span class="comment">     * @param mixed $cmorid The course module, or id of the course module</span>
<a name="l1475"><span class="linenum">1475</span></a>  <span class="comment">     * @param int $competencyidfrom The id of the competency we are moving.</span>
<a name="l1476"><span class="linenum">1476</span></a>  <span class="comment">     * @param int $competencyidto The id of the competency we are moving to.</span>
<a name="l1477"><span class="linenum">1477</span></a>  <span class="comment">     * @return boolean</span>
<a name="l1478"><span class="linenum">1478</span></a>  <span class="comment">     */</span>
<a name="l1479"><span class="linenum">1479</span></a>      public static function <a class="function" onClick="logFunction('reorder_course_module_competency')" href="../../_functions/reorder_course_module_competency.html" onMouseOver="funcPopup(event,'reorder_course_module_competency')">reorder_course_module_competency</a>(<a class="var it9151" onMouseOver="hilite(9151)" onMouseOut="lolite()" onClick="logVariable('cmorid')" href="../../_variables/cmorid.html">$cmorid</a>, <a class="var it30448" onMouseOver="hilite(30448)" onMouseOut="lolite()" onClick="logVariable('competencyidfrom')" href="../../_variables/competencyidfrom.html">$competencyidfrom</a>, <a class="var it30449" onMouseOver="hilite(30449)" onMouseOut="lolite()" onClick="logVariable('competencyidto')" href="../../_variables/competencyidto.html">$competencyidto</a>) {
<a name="l1480"><span class="linenum">1480</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1481"><span class="linenum">1481</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="var it9151" onMouseOver="hilite(9151)" onMouseOut="lolite()" onClick="logVariable('cmorid')" href="../../_variables/cmorid.html">$cmorid</a>;
<a name="l1482"><span class="linenum">1482</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it9151" onMouseOver="hilite(9151)" onMouseOut="lolite()" onClick="logVariable('cmorid')" href="../../_variables/cmorid.html">$cmorid</a>)) {
<a name="l1483"><span class="linenum">1483</span></a>              <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_id')" href="../../_functions/get_coursemodule_from_id.html" onMouseOver="funcPopup(event,'get_coursemodule_from_id')">get_coursemodule_from_id</a>('', <a class="var it9151" onMouseOver="hilite(9151)" onMouseOut="lolite()" onClick="logVariable('cmorid')" href="../../_variables/cmorid.html">$cmorid</a>, 0, true, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l1484"><span class="linenum">1484</span></a>          }
<a name="l1485"><span class="linenum">1485</span></a>  <span class="comment">        // Check the user have access to the course module.</span>
<a name="l1486"><span class="linenum">1486</span></a>          self::<a class="function" onClick="logFunction('validate_course_module')" href="../../_functions/validate_course_module.html" onMouseOver="funcPopup(event,'validate_course_module')">validate_course_module</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l1487"><span class="linenum">1487</span></a>  
<a name="l1488"><span class="linenum">1488</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l1489"><span class="linenum">1489</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1490"><span class="linenum">1490</span></a>  
<a name="l1491"><span class="linenum">1491</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:coursecompetencymanage', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l1492"><span class="linenum">1492</span></a>  
<a name="l1493"><span class="linenum">1493</span></a>          <a class="var it11446" onMouseOver="hilite(11446)" onMouseOut="lolite()" onClick="logVariable('down')" href="../../_variables/down.html">$down</a> = true;
<a name="l1494"><span class="linenum">1494</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = <a class="class" onClick="logClass('course_module_competency')" href="../../_classes/course_module_competency.html" onMouseOver="classPopup(event,'course_module_competency')">course_module_competency</a>::<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(array('cmid' =&gt; <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'competencyid' =&gt; <a class="var it30448" onMouseOver="hilite(30448)" onMouseOut="lolite()" onClick="logVariable('competencyidfrom')" href="../../_variables/competencyidfrom.html">$competencyidfrom</a>));
<a name="l1495"><span class="linenum">1495</span></a>          if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>) == 0) {
<a name="l1496"><span class="linenum">1496</span></a>               throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('The link does not exist');
<a name="l1497"><span class="linenum">1497</span></a>          }
<a name="l1498"><span class="linenum">1498</span></a>  
<a name="l1499"><span class="linenum">1499</span></a>          <a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a> = <a class="phpfunction" onClick="logFunction('array_pop')" href="../../_functions/array_pop.html" onMouseOver="phpfuncPopup(event,'array_pop')">array_pop</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>);
<a name="l1500"><span class="linenum">1500</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = <a class="class" onClick="logClass('course_module_competency')" href="../../_classes/course_module_competency.html" onMouseOver="classPopup(event,'course_module_competency')">course_module_competency</a>::<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(array('cmid' =&gt; <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'competencyid' =&gt; <a class="var it30449" onMouseOver="hilite(30449)" onMouseOut="lolite()" onClick="logVariable('competencyidto')" href="../../_variables/competencyidto.html">$competencyidto</a>));
<a name="l1501"><span class="linenum">1501</span></a>          if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>) == 0) {
<a name="l1502"><span class="linenum">1502</span></a>               throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('The link does not exist');
<a name="l1503"><span class="linenum">1503</span></a>          }
<a name="l1504"><span class="linenum">1504</span></a>  
<a name="l1505"><span class="linenum">1505</span></a>          <a class="var it30451" onMouseOver="hilite(30451)" onMouseOut="lolite()" onClick="logVariable('competencyto')" href="../../_variables/competencyto.html">$competencyto</a> = <a class="phpfunction" onClick="logFunction('array_pop')" href="../../_functions/array_pop.html" onMouseOver="phpfuncPopup(event,'array_pop')">array_pop</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>);
<a name="l1506"><span class="linenum">1506</span></a>  
<a name="l1507"><span class="linenum">1507</span></a>          <a class="var it5375" onMouseOver="hilite(5375)" onMouseOut="lolite()" onClick="logVariable('all')" href="../../_variables/all.html">$all</a> = <a class="class" onClick="logClass('course_module_competency')" href="../../_classes/course_module_competency.html" onMouseOver="classPopup(event,'course_module_competency')">course_module_competency</a>::<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(array('cmid' =&gt; <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>), 'sortorder', 'ASC', 0, 0);
<a name="l1508"><span class="linenum">1508</span></a>  
<a name="l1509"><span class="linenum">1509</span></a>          if (<a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>() &gt; <a class="var it30451" onMouseOver="hilite(30451)" onMouseOut="lolite()" onClick="logVariable('competencyto')" href="../../_variables/competencyto.html">$competencyto</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>()) {
<a name="l1510"><span class="linenum">1510</span></a>  <span class="comment">            // We are moving up, so put it before the &quot;to&quot; item.</span>
<a name="l1511"><span class="linenum">1511</span></a>              <a class="var it11446" onMouseOver="hilite(11446)" onMouseOut="lolite()" onClick="logVariable('down')" href="../../_variables/down.html">$down</a> = false;
<a name="l1512"><span class="linenum">1512</span></a>          }
<a name="l1513"><span class="linenum">1513</span></a>  
<a name="l1514"><span class="linenum">1514</span></a>          foreach (<a class="var it5375" onMouseOver="hilite(5375)" onMouseOut="lolite()" onClick="logVariable('all')" href="../../_variables/all.html">$all</a> as <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a> =&gt; <a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a>) {
<a name="l1515"><span class="linenum">1515</span></a>              <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> = <a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>();
<a name="l1516"><span class="linenum">1516</span></a>              if (<a class="var it11446" onMouseOver="hilite(11446)" onMouseOut="lolite()" onClick="logVariable('down')" href="../../_variables/down.html">$down</a> &amp;&amp; <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> &gt; <a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>() &amp;&amp; <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> &lt;= <a class="var it30451" onMouseOver="hilite(30451)" onMouseOut="lolite()" onClick="logVariable('competencyto')" href="../../_variables/competencyto.html">$competencyto</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>()) {
<a name="l1517"><span class="linenum">1517</span></a>                  <a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a>-&gt;<a class="function" onClick="logFunction('set_sortorder')" href="../../_functions/set_sortorder.html" onMouseOver="funcPopup(event,'set_sortorder')">set_sortorder</a>(<a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>() - 1);
<a name="l1518"><span class="linenum">1518</span></a>                  <a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l1519"><span class="linenum">1519</span></a>              } else if (!<a class="var it11446" onMouseOver="hilite(11446)" onMouseOut="lolite()" onClick="logVariable('down')" href="../../_variables/down.html">$down</a> &amp;&amp; <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> &gt;= <a class="var it30451" onMouseOver="hilite(30451)" onMouseOut="lolite()" onClick="logVariable('competencyto')" href="../../_variables/competencyto.html">$competencyto</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>() &amp;&amp; <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> &lt; <a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>()) {
<a name="l1520"><span class="linenum">1520</span></a>                  <a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a>-&gt;<a class="function" onClick="logFunction('set_sortorder')" href="../../_functions/set_sortorder.html" onMouseOver="funcPopup(event,'set_sortorder')">set_sortorder</a>(<a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>() + 1);
<a name="l1521"><span class="linenum">1521</span></a>                  <a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l1522"><span class="linenum">1522</span></a>              }
<a name="l1523"><span class="linenum">1523</span></a>          }
<a name="l1524"><span class="linenum">1524</span></a>          <a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a>-&gt;<a class="function" onClick="logFunction('set_sortorder')" href="../../_functions/set_sortorder.html" onMouseOver="funcPopup(event,'set_sortorder')">set_sortorder</a>(<a class="var it30451" onMouseOver="hilite(30451)" onMouseOut="lolite()" onClick="logVariable('competencyto')" href="../../_variables/competencyto.html">$competencyto</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>());
<a name="l1525"><span class="linenum">1525</span></a>          return <a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l1526"><span class="linenum">1526</span></a>      }
<a name="l1527"><span class="linenum">1527</span></a>  
<a name="l1528"><span class="linenum">1528</span></a>      <span class="comment">/**</span>
<a name="l1529"><span class="linenum">1529</span></a>  <span class="comment">     * Update ruleoutcome value for a course module competency.</span>
<a name="l1530"><span class="linenum">1530</span></a>  <span class="comment">     *</span>
<a name="l1531"><span class="linenum">1531</span></a>  <span class="comment">     * @param int|course_module_competency $coursemodulecompetencyorid The course_module_competency, or its ID.</span>
<a name="l1532"><span class="linenum">1532</span></a>  <span class="comment">     * @param int $ruleoutcome The value of ruleoutcome.</span>
<a name="l1533"><span class="linenum">1533</span></a>  <span class="comment">     * @return bool True on success.</span>
<a name="l1534"><span class="linenum">1534</span></a>  <span class="comment">     */</span>
<a name="l1535"><span class="linenum">1535</span></a>      public static function <a class="function" onClick="logFunction('set_course_module_competency_ruleoutcome')" href="../../_functions/set_course_module_competency_ruleoutcome.html" onMouseOver="funcPopup(event,'set_course_module_competency_ruleoutcome')">set_course_module_competency_ruleoutcome</a>(<a class="var it30452" onMouseOver="hilite(30452)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetencyorid')" href="../../_variables/coursemodulecompetencyorid.html">$coursemodulecompetencyorid</a>, <a class="var it8527" onMouseOver="hilite(8527)" onMouseOut="lolite()" onClick="logVariable('ruleoutcome')" href="../../_variables/ruleoutcome.html">$ruleoutcome</a>) {
<a name="l1536"><span class="linenum">1536</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1537"><span class="linenum">1537</span></a>          <a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a> = <a class="var it30452" onMouseOver="hilite(30452)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetencyorid')" href="../../_variables/coursemodulecompetencyorid.html">$coursemodulecompetencyorid</a>;
<a name="l1538"><span class="linenum">1538</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a>)) {
<a name="l1539"><span class="linenum">1539</span></a>              <a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('course_module_competency')" href="../../_classes/course_module_competency.html" onMouseOver="classPopup(event,'course_module_competency')">course_module_competency</a>(<a class="var it30452" onMouseOver="hilite(30452)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetencyorid')" href="../../_variables/coursemodulecompetencyorid.html">$coursemodulecompetencyorid</a>);
<a name="l1540"><span class="linenum">1540</span></a>          }
<a name="l1541"><span class="linenum">1541</span></a>  
<a name="l1542"><span class="linenum">1542</span></a>          <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_id')" href="../../_functions/get_coursemodule_from_id.html" onMouseOver="funcPopup(event,'get_coursemodule_from_id')">get_coursemodule_from_id</a>('', <a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a>-&gt;<a class="function" onClick="logFunction('get_cmid')" href="../../_functions/get_cmid.html" onMouseOver="funcPopup(event,'get_cmid')">get_cmid</a>(), 0, true, <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l1543"><span class="linenum">1543</span></a>  
<a name="l1544"><span class="linenum">1544</span></a>          self::<a class="function" onClick="logFunction('validate_course_module')" href="../../_functions/validate_course_module.html" onMouseOver="funcPopup(event,'validate_course_module')">validate_course_module</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>);
<a name="l1545"><span class="linenum">1545</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_module')" href="../../_classes/context_module.html" onMouseOver="classPopup(event,'context_module')">context_module</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1546"><span class="linenum">1546</span></a>  
<a name="l1547"><span class="linenum">1547</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:coursecompetencymanage', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l1548"><span class="linenum">1548</span></a>  
<a name="l1549"><span class="linenum">1549</span></a>          <a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a>-&gt;set_ruleoutcome(<a class="var it8527" onMouseOver="hilite(8527)" onMouseOut="lolite()" onClick="logVariable('ruleoutcome')" href="../../_variables/ruleoutcome.html">$ruleoutcome</a>);
<a name="l1550"><span class="linenum">1550</span></a>          return <a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l1551"><span class="linenum">1551</span></a>      }
<a name="l1552"><span class="linenum">1552</span></a>  
<a name="l1553"><span class="linenum">1553</span></a>      <span class="comment">/**</span>
<a name="l1554"><span class="linenum">1554</span></a>  <span class="comment">     * Add a competency to this course.</span>
<a name="l1555"><span class="linenum">1555</span></a>  <span class="comment">     *</span>
<a name="l1556"><span class="linenum">1556</span></a>  <span class="comment">     * @param int $courseid The id of the course</span>
<a name="l1557"><span class="linenum">1557</span></a>  <span class="comment">     * @param int $competencyid The id of the competency</span>
<a name="l1558"><span class="linenum">1558</span></a>  <span class="comment">     * @return bool</span>
<a name="l1559"><span class="linenum">1559</span></a>  <span class="comment">     */</span>
<a name="l1560"><span class="linenum">1560</span></a>      public static function <a class="function" onClick="logFunction('add_competency_to_course')" href="../../_functions/add_competency_to_course.html" onMouseOver="funcPopup(event,'add_competency_to_course')">add_competency_to_course</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>) {
<a name="l1561"><span class="linenum">1561</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1562"><span class="linenum">1562</span></a>  <span class="comment">        // Check the user have access to the course.</span>
<a name="l1563"><span class="linenum">1563</span></a>          self::<a class="function" onClick="logFunction('validate_course')" href="../../_functions/validate_course.html" onMouseOver="funcPopup(event,'validate_course')">validate_course</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l1564"><span class="linenum">1564</span></a>  
<a name="l1565"><span class="linenum">1565</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l1566"><span class="linenum">1566</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l1567"><span class="linenum">1567</span></a>  
<a name="l1568"><span class="linenum">1568</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:coursecompetencymanage', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l1569"><span class="linenum">1569</span></a>  
<a name="l1570"><span class="linenum">1570</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a> = new stdClass();
<a name="l1571"><span class="linenum">1571</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('courseid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a> = <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>;
<a name="l1572"><span class="linenum">1572</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('competencyid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/competencyid.html">competencyid</a> = <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>;
<a name="l1573"><span class="linenum">1573</span></a>  
<a name="l1574"><span class="linenum">1574</span></a>          <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l1575"><span class="linenum">1575</span></a>  
<a name="l1576"><span class="linenum">1576</span></a>  <span class="comment">        // Can not add a competency that belong to a hidden framework.</span>
<a name="l1577"><span class="linenum">1577</span></a>          if (<a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_framework')" href="../../_functions/get_framework.html" onMouseOver="funcPopup(event,'get_framework')">get_framework</a>()-&gt;<a class="function" onClick="logFunction('get_visible')" href="../../_functions/get_visible.html" onMouseOver="funcPopup(event,'get_visible')">get_visible</a>() == false) {
<a name="l1578"><span class="linenum">1578</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('A competency belonging to hidden framework can not be linked to course');
<a name="l1579"><span class="linenum">1579</span></a>          }
<a name="l1580"><span class="linenum">1580</span></a>  
<a name="l1581"><span class="linenum">1581</span></a>          <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('course_competency')" href="../../_classes/course_competency.html" onMouseOver="classPopup(event,'course_competency')">course_competency</a>();
<a name="l1582"><span class="linenum">1582</span></a>          <a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a> = <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(array('courseid' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, 'competencyid' =&gt; <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>));
<a name="l1583"><span class="linenum">1583</span></a>          if (!<a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a>) {
<a name="l1584"><span class="linenum">1584</span></a>              <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>-&gt;<a class="function" onClick="logFunction('from_record')" href="../../_functions/from_record.html" onMouseOver="funcPopup(event,'from_record')">from_record</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>);
<a name="l1585"><span class="linenum">1585</span></a>              if (<a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>()) {
<a name="l1586"><span class="linenum">1586</span></a>                  return true;
<a name="l1587"><span class="linenum">1587</span></a>              }
<a name="l1588"><span class="linenum">1588</span></a>          }
<a name="l1589"><span class="linenum">1589</span></a>          return false;
<a name="l1590"><span class="linenum">1590</span></a>      }
<a name="l1591"><span class="linenum">1591</span></a>  
<a name="l1592"><span class="linenum">1592</span></a>      <span class="comment">/**</span>
<a name="l1593"><span class="linenum">1593</span></a>  <span class="comment">     * Remove a competency from this course.</span>
<a name="l1594"><span class="linenum">1594</span></a>  <span class="comment">     *</span>
<a name="l1595"><span class="linenum">1595</span></a>  <span class="comment">     * @param int $courseid The id of the course</span>
<a name="l1596"><span class="linenum">1596</span></a>  <span class="comment">     * @param int $competencyid The id of the competency</span>
<a name="l1597"><span class="linenum">1597</span></a>  <span class="comment">     * @return bool</span>
<a name="l1598"><span class="linenum">1598</span></a>  <span class="comment">     */</span>
<a name="l1599"><span class="linenum">1599</span></a>      public static function <a class="function" onClick="logFunction('remove_competency_from_course')" href="../../_functions/remove_competency_from_course.html" onMouseOver="funcPopup(event,'remove_competency_from_course')">remove_competency_from_course</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>) {
<a name="l1600"><span class="linenum">1600</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1601"><span class="linenum">1601</span></a>  <span class="comment">        // Check the user have access to the course.</span>
<a name="l1602"><span class="linenum">1602</span></a>          self::<a class="function" onClick="logFunction('validate_course')" href="../../_functions/validate_course.html" onMouseOver="funcPopup(event,'validate_course')">validate_course</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l1603"><span class="linenum">1603</span></a>  
<a name="l1604"><span class="linenum">1604</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l1605"><span class="linenum">1605</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l1606"><span class="linenum">1606</span></a>  
<a name="l1607"><span class="linenum">1607</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:coursecompetencymanage', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l1608"><span class="linenum">1608</span></a>  
<a name="l1609"><span class="linenum">1609</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a> = new stdClass();
<a name="l1610"><span class="linenum">1610</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('courseid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a> = <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>;
<a name="l1611"><span class="linenum">1611</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('competencyid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/competencyid.html">competencyid</a> = <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>;
<a name="l1612"><span class="linenum">1612</span></a>  
<a name="l1613"><span class="linenum">1613</span></a>          <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('course_competency')" href="../../_classes/course_competency.html" onMouseOver="classPopup(event,'course_competency')">course_competency</a>();
<a name="l1614"><span class="linenum">1614</span></a>          <a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a> = <a class="class" onClick="logClass('course_competency')" href="../../_classes/course_competency.html" onMouseOver="classPopup(event,'course_competency')">course_competency</a>::<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(array('courseid' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, 'competencyid' =&gt; <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>));
<a name="l1615"><span class="linenum">1615</span></a>          if (<a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a>) {
<a name="l1616"><span class="linenum">1616</span></a>  <span class="comment">            // Delete all course_module_competencies for this competency in this course.</span>
<a name="l1617"><span class="linenum">1617</span></a>              <a class="var it25945" onMouseOver="hilite(25945)" onMouseOut="lolite()" onClick="logVariable('cmcs')" href="../../_variables/cmcs.html">$cmcs</a> = <a class="class" onClick="logClass('course_module_competency')" href="../../_classes/course_module_competency.html" onMouseOver="classPopup(event,'course_module_competency')">course_module_competency</a>::<a class="function" onClick="logFunction('get_records_by_competencyid_in_course')" href="../../_functions/get_records_by_competencyid_in_course.html" onMouseOver="funcPopup(event,'get_records_by_competencyid_in_course')">get_records_by_competencyid_in_course</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l1618"><span class="linenum">1618</span></a>              foreach (<a class="var it25945" onMouseOver="hilite(25945)" onMouseOut="lolite()" onClick="logVariable('cmcs')" href="../../_variables/cmcs.html">$cmcs</a> as <a class="var it29660" onMouseOver="hilite(29660)" onMouseOut="lolite()" onClick="logVariable('cmc')" href="../../_variables/cmc.html">$cmc</a>) {
<a name="l1619"><span class="linenum">1619</span></a>                  <a class="var it29660" onMouseOver="hilite(29660)" onMouseOut="lolite()" onClick="logVariable('cmc')" href="../../_variables/cmc.html">$cmc</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l1620"><span class="linenum">1620</span></a>              }
<a name="l1621"><span class="linenum">1621</span></a>              return <a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l1622"><span class="linenum">1622</span></a>          }
<a name="l1623"><span class="linenum">1623</span></a>          return false;
<a name="l1624"><span class="linenum">1624</span></a>      }
<a name="l1625"><span class="linenum">1625</span></a>  
<a name="l1626"><span class="linenum">1626</span></a>      <span class="comment">/**</span>
<a name="l1627"><span class="linenum">1627</span></a>  <span class="comment">     * Move the course competency up or down in the display list.</span>
<a name="l1628"><span class="linenum">1628</span></a>  <span class="comment">     *</span>
<a name="l1629"><span class="linenum">1629</span></a>  <span class="comment">     * Requires moodle/competency:coursecompetencymanage capability at the course context.</span>
<a name="l1630"><span class="linenum">1630</span></a>  <span class="comment">     *</span>
<a name="l1631"><span class="linenum">1631</span></a>  <span class="comment">     * @param int $courseid The course</span>
<a name="l1632"><span class="linenum">1632</span></a>  <span class="comment">     * @param int $competencyidfrom The id of the competency we are moving.</span>
<a name="l1633"><span class="linenum">1633</span></a>  <span class="comment">     * @param int $competencyidto The id of the competency we are moving to.</span>
<a name="l1634"><span class="linenum">1634</span></a>  <span class="comment">     * @return boolean</span>
<a name="l1635"><span class="linenum">1635</span></a>  <span class="comment">     */</span>
<a name="l1636"><span class="linenum">1636</span></a>      public static function <a class="function" onClick="logFunction('reorder_course_competency')" href="../../_functions/reorder_course_competency.html" onMouseOver="funcPopup(event,'reorder_course_competency')">reorder_course_competency</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it30448" onMouseOver="hilite(30448)" onMouseOut="lolite()" onClick="logVariable('competencyidfrom')" href="../../_variables/competencyidfrom.html">$competencyidfrom</a>, <a class="var it30449" onMouseOver="hilite(30449)" onMouseOut="lolite()" onClick="logVariable('competencyidto')" href="../../_variables/competencyidto.html">$competencyidto</a>) {
<a name="l1637"><span class="linenum">1637</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1638"><span class="linenum">1638</span></a>  <span class="comment">        // Check the user have access to the course.</span>
<a name="l1639"><span class="linenum">1639</span></a>          self::<a class="function" onClick="logFunction('validate_course')" href="../../_functions/validate_course.html" onMouseOver="funcPopup(event,'validate_course')">validate_course</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l1640"><span class="linenum">1640</span></a>  
<a name="l1641"><span class="linenum">1641</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l1642"><span class="linenum">1642</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l1643"><span class="linenum">1643</span></a>  
<a name="l1644"><span class="linenum">1644</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:coursecompetencymanage', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l1645"><span class="linenum">1645</span></a>  
<a name="l1646"><span class="linenum">1646</span></a>          <a class="var it11446" onMouseOver="hilite(11446)" onMouseOut="lolite()" onClick="logVariable('down')" href="../../_variables/down.html">$down</a> = true;
<a name="l1647"><span class="linenum">1647</span></a>          <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('course_competency')" href="../../_classes/course_competency.html" onMouseOver="classPopup(event,'course_competency')">course_competency</a>();
<a name="l1648"><span class="linenum">1648</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(array('courseid' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, 'competencyid' =&gt; <a class="var it30448" onMouseOver="hilite(30448)" onMouseOut="lolite()" onClick="logVariable('competencyidfrom')" href="../../_variables/competencyidfrom.html">$competencyidfrom</a>));
<a name="l1649"><span class="linenum">1649</span></a>          if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>) == 0) {
<a name="l1650"><span class="linenum">1650</span></a>               throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('The link does not exist');
<a name="l1651"><span class="linenum">1651</span></a>          }
<a name="l1652"><span class="linenum">1652</span></a>  
<a name="l1653"><span class="linenum">1653</span></a>          <a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a> = <a class="phpfunction" onClick="logFunction('array_pop')" href="../../_functions/array_pop.html" onMouseOver="phpfuncPopup(event,'array_pop')">array_pop</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>);
<a name="l1654"><span class="linenum">1654</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(array('courseid' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, 'competencyid' =&gt; <a class="var it30449" onMouseOver="hilite(30449)" onMouseOut="lolite()" onClick="logVariable('competencyidto')" href="../../_variables/competencyidto.html">$competencyidto</a>));
<a name="l1655"><span class="linenum">1655</span></a>          if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>) == 0) {
<a name="l1656"><span class="linenum">1656</span></a>               throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('The link does not exist');
<a name="l1657"><span class="linenum">1657</span></a>          }
<a name="l1658"><span class="linenum">1658</span></a>  
<a name="l1659"><span class="linenum">1659</span></a>          <a class="var it30451" onMouseOver="hilite(30451)" onMouseOut="lolite()" onClick="logVariable('competencyto')" href="../../_variables/competencyto.html">$competencyto</a> = <a class="phpfunction" onClick="logFunction('array_pop')" href="../../_functions/array_pop.html" onMouseOver="phpfuncPopup(event,'array_pop')">array_pop</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>);
<a name="l1660"><span class="linenum">1660</span></a>  
<a name="l1661"><span class="linenum">1661</span></a>          <a class="var it5375" onMouseOver="hilite(5375)" onMouseOut="lolite()" onClick="logVariable('all')" href="../../_variables/all.html">$all</a> = <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(array('courseid' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>), 'sortorder', 'ASC', 0, 0);
<a name="l1662"><span class="linenum">1662</span></a>  
<a name="l1663"><span class="linenum">1663</span></a>          if (<a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>() &gt; <a class="var it30451" onMouseOver="hilite(30451)" onMouseOut="lolite()" onClick="logVariable('competencyto')" href="../../_variables/competencyto.html">$competencyto</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>()) {
<a name="l1664"><span class="linenum">1664</span></a>  <span class="comment">            // We are moving up, so put it before the &quot;to&quot; item.</span>
<a name="l1665"><span class="linenum">1665</span></a>              <a class="var it11446" onMouseOver="hilite(11446)" onMouseOut="lolite()" onClick="logVariable('down')" href="../../_variables/down.html">$down</a> = false;
<a name="l1666"><span class="linenum">1666</span></a>          }
<a name="l1667"><span class="linenum">1667</span></a>  
<a name="l1668"><span class="linenum">1668</span></a>          foreach (<a class="var it5375" onMouseOver="hilite(5375)" onMouseOut="lolite()" onClick="logVariable('all')" href="../../_variables/all.html">$all</a> as <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a> =&gt; <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>) {
<a name="l1669"><span class="linenum">1669</span></a>              <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> = <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>();
<a name="l1670"><span class="linenum">1670</span></a>              if (<a class="var it11446" onMouseOver="hilite(11446)" onMouseOut="lolite()" onClick="logVariable('down')" href="../../_variables/down.html">$down</a> &amp;&amp; <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> &gt; <a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>() &amp;&amp; <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> &lt;= <a class="var it30451" onMouseOver="hilite(30451)" onMouseOut="lolite()" onClick="logVariable('competencyto')" href="../../_variables/competencyto.html">$competencyto</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>()) {
<a name="l1671"><span class="linenum">1671</span></a>                  <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>-&gt;<a class="function" onClick="logFunction('set_sortorder')" href="../../_functions/set_sortorder.html" onMouseOver="funcPopup(event,'set_sortorder')">set_sortorder</a>(<a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>() - 1);
<a name="l1672"><span class="linenum">1672</span></a>                  <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l1673"><span class="linenum">1673</span></a>              } else if (!<a class="var it11446" onMouseOver="hilite(11446)" onMouseOut="lolite()" onClick="logVariable('down')" href="../../_variables/down.html">$down</a> &amp;&amp; <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> &gt;= <a class="var it30451" onMouseOver="hilite(30451)" onMouseOut="lolite()" onClick="logVariable('competencyto')" href="../../_variables/competencyto.html">$competencyto</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>() &amp;&amp; <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> &lt; <a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>()) {
<a name="l1674"><span class="linenum">1674</span></a>                  <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>-&gt;<a class="function" onClick="logFunction('set_sortorder')" href="../../_functions/set_sortorder.html" onMouseOver="funcPopup(event,'set_sortorder')">set_sortorder</a>(<a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>() + 1);
<a name="l1675"><span class="linenum">1675</span></a>                  <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l1676"><span class="linenum">1676</span></a>              }
<a name="l1677"><span class="linenum">1677</span></a>          }
<a name="l1678"><span class="linenum">1678</span></a>          <a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a>-&gt;<a class="function" onClick="logFunction('set_sortorder')" href="../../_functions/set_sortorder.html" onMouseOver="funcPopup(event,'set_sortorder')">set_sortorder</a>(<a class="var it30451" onMouseOver="hilite(30451)" onMouseOut="lolite()" onClick="logVariable('competencyto')" href="../../_variables/competencyto.html">$competencyto</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>());
<a name="l1679"><span class="linenum">1679</span></a>          return <a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l1680"><span class="linenum">1680</span></a>      }
<a name="l1681"><span class="linenum">1681</span></a>  
<a name="l1682"><span class="linenum">1682</span></a>      <span class="comment">/**</span>
<a name="l1683"><span class="linenum">1683</span></a>  <span class="comment">     * Update ruleoutcome value for a course competency.</span>
<a name="l1684"><span class="linenum">1684</span></a>  <span class="comment">     *</span>
<a name="l1685"><span class="linenum">1685</span></a>  <span class="comment">     * @param int|course_competency $coursecompetencyorid The course_competency, or its ID.</span>
<a name="l1686"><span class="linenum">1686</span></a>  <span class="comment">     * @param int $ruleoutcome The value of ruleoutcome.</span>
<a name="l1687"><span class="linenum">1687</span></a>  <span class="comment">     * @return bool True on success.</span>
<a name="l1688"><span class="linenum">1688</span></a>  <span class="comment">     */</span>
<a name="l1689"><span class="linenum">1689</span></a>      public static function <a class="function" onClick="logFunction('set_course_competency_ruleoutcome')" href="../../_functions/set_course_competency_ruleoutcome.html" onMouseOver="funcPopup(event,'set_course_competency_ruleoutcome')">set_course_competency_ruleoutcome</a>(<a class="var it30453" onMouseOver="hilite(30453)" onMouseOut="lolite()" onClick="logVariable('coursecompetencyorid')" href="../../_variables/coursecompetencyorid.html">$coursecompetencyorid</a>, <a class="var it8527" onMouseOver="hilite(8527)" onMouseOut="lolite()" onClick="logVariable('ruleoutcome')" href="../../_variables/ruleoutcome.html">$ruleoutcome</a>) {
<a name="l1690"><span class="linenum">1690</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1691"><span class="linenum">1691</span></a>          <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a> = <a class="var it30453" onMouseOver="hilite(30453)" onMouseOut="lolite()" onClick="logVariable('coursecompetencyorid')" href="../../_variables/coursecompetencyorid.html">$coursecompetencyorid</a>;
<a name="l1692"><span class="linenum">1692</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>)) {
<a name="l1693"><span class="linenum">1693</span></a>              <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('course_competency')" href="../../_classes/course_competency.html" onMouseOver="classPopup(event,'course_competency')">course_competency</a>(<a class="var it30453" onMouseOver="hilite(30453)" onMouseOut="lolite()" onClick="logVariable('coursecompetencyorid')" href="../../_variables/coursecompetencyorid.html">$coursecompetencyorid</a>);
<a name="l1694"><span class="linenum">1694</span></a>          }
<a name="l1695"><span class="linenum">1695</span></a>  
<a name="l1696"><span class="linenum">1696</span></a>          <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> = <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>-&gt;<a class="function" onClick="logFunction('get_courseid')" href="../../_functions/get_courseid.html" onMouseOver="funcPopup(event,'get_courseid')">get_courseid</a>();
<a name="l1697"><span class="linenum">1697</span></a>          self::<a class="function" onClick="logFunction('validate_course')" href="../../_functions/validate_course.html" onMouseOver="funcPopup(event,'validate_course')">validate_course</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l1698"><span class="linenum">1698</span></a>          <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l1699"><span class="linenum">1699</span></a>  
<a name="l1700"><span class="linenum">1700</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:coursecompetencymanage', <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a>);
<a name="l1701"><span class="linenum">1701</span></a>  
<a name="l1702"><span class="linenum">1702</span></a>          <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>-&gt;set_ruleoutcome(<a class="var it8527" onMouseOver="hilite(8527)" onMouseOut="lolite()" onClick="logVariable('ruleoutcome')" href="../../_variables/ruleoutcome.html">$ruleoutcome</a>);
<a name="l1703"><span class="linenum">1703</span></a>          return <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l1704"><span class="linenum">1704</span></a>      }
<a name="l1705"><span class="linenum">1705</span></a>  
<a name="l1706"><span class="linenum">1706</span></a>      <span class="comment">/**</span>
<a name="l1707"><span class="linenum">1707</span></a>  <span class="comment">     * Create a learning plan template from a record containing all the data for the class.</span>
<a name="l1708"><span class="linenum">1708</span></a>  <span class="comment">     *</span>
<a name="l1709"><span class="linenum">1709</span></a>  <span class="comment">     * Requires moodle/competency:templatemanage capability.</span>
<a name="l1710"><span class="linenum">1710</span></a>  <span class="comment">     *</span>
<a name="l1711"><span class="linenum">1711</span></a>  <span class="comment">     * @param stdClass $record Record containing all the data for an instance of the class.</span>
<a name="l1712"><span class="linenum">1712</span></a>  <span class="comment">     * @return template</span>
<a name="l1713"><span class="linenum">1713</span></a>  <span class="comment">     */</span>
<a name="l1714"><span class="linenum">1714</span></a>      public static function <a class="function" onClick="logFunction('create_template')" href="../../_functions/create_template.html" onMouseOver="funcPopup(event,'create_template')">create_template</a>(stdClass <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>) {
<a name="l1715"><span class="linenum">1715</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1716"><span class="linenum">1716</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>(0, <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>);
<a name="l1717"><span class="linenum">1717</span></a>  
<a name="l1718"><span class="linenum">1718</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l1719"><span class="linenum">1719</span></a>          if (!<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l1720"><span class="linenum">1720</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:templatemanage',
<a name="l1721"><span class="linenum">1721</span></a>                  'nopermissions', '');
<a name="l1722"><span class="linenum">1722</span></a>          }
<a name="l1723"><span class="linenum">1723</span></a>  
<a name="l1724"><span class="linenum">1724</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l1725"><span class="linenum">1725</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l1726"><span class="linenum">1726</span></a>  
<a name="l1727"><span class="linenum">1727</span></a>  <span class="comment">        // Trigger a template created event.</span>
<a name="l1728"><span class="linenum">1728</span></a>          \core\event\<a class="class" onClick="logClass('competency_template_created')" href="../../_classes/competency_template_created.html" onMouseOver="classPopup(event,'competency_template_created')">competency_template_created</a>::<a class="function" onClick="logFunction('create_from_template')" href="../../_functions/create_from_template.html" onMouseOver="funcPopup(event,'create_from_template')">create_from_template</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1729"><span class="linenum">1729</span></a>  
<a name="l1730"><span class="linenum">1730</span></a>          return <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>;
<a name="l1731"><span class="linenum">1731</span></a>      }
<a name="l1732"><span class="linenum">1732</span></a>  
<a name="l1733"><span class="linenum">1733</span></a>      <span class="comment">/**</span>
<a name="l1734"><span class="linenum">1734</span></a>  <span class="comment">     * Duplicate a learning plan template.</span>
<a name="l1735"><span class="linenum">1735</span></a>  <span class="comment">     *</span>
<a name="l1736"><span class="linenum">1736</span></a>  <span class="comment">     * Requires moodle/competency:templatemanage capability at the template context.</span>
<a name="l1737"><span class="linenum">1737</span></a>  <span class="comment">     *</span>
<a name="l1738"><span class="linenum">1738</span></a>  <span class="comment">     * @param int $id the template id.</span>
<a name="l1739"><span class="linenum">1739</span></a>  <span class="comment">     * @return template</span>
<a name="l1740"><span class="linenum">1740</span></a>  <span class="comment">     */</span>
<a name="l1741"><span class="linenum">1741</span></a>      public static function <a class="function" onClick="logFunction('duplicate_template')" href="../../_functions/duplicate_template.html" onMouseOver="funcPopup(event,'duplicate_template')">duplicate_template</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>) {
<a name="l1742"><span class="linenum">1742</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1743"><span class="linenum">1743</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);
<a name="l1744"><span class="linenum">1744</span></a>  
<a name="l1745"><span class="linenum">1745</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l1746"><span class="linenum">1746</span></a>          if (!<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l1747"><span class="linenum">1747</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:templatemanage',
<a name="l1748"><span class="linenum">1748</span></a>                  'nopermissions', '');
<a name="l1749"><span class="linenum">1749</span></a>          }
<a name="l1750"><span class="linenum">1750</span></a>  
<a name="l1751"><span class="linenum">1751</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l1752"><span class="linenum">1752</span></a>          <a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a> = <a class="class" onClick="logClass('template_competency')" href="../../_classes/template_competency.html" onMouseOver="classPopup(event,'template_competency')">template_competency</a>::<a class="function" onClick="logFunction('list_competencies')" href="../../_functions/list_competencies.html" onMouseOver="funcPopup(event,'list_competencies')">list_competencies</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>, false);
<a name="l1753"><span class="linenum">1753</span></a>  
<a name="l1754"><span class="linenum">1754</span></a>  <span class="comment">        // Adding the suffix copy.</span>
<a name="l1755"><span class="linenum">1755</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;set_shortname(<a class="function" onClick="logFunction('get_string')" href="../../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('duplicateditemname', 'core_competency', <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_shortname')" href="../../_functions/get_shortname.html" onMouseOver="funcPopup(event,'get_shortname')">get_shortname</a>()));
<a name="l1756"><span class="linenum">1756</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('set_id')" href="../../_functions/set_id.html" onMouseOver="funcPopup(event,'set_id')">set_id</a>(0);
<a name="l1757"><span class="linenum">1757</span></a>  
<a name="l1758"><span class="linenum">1758</span></a>          <a class="var it23646" onMouseOver="hilite(23646)" onMouseOut="lolite()" onClick="logVariable('duplicatedtemplate')" href="../../_variables/duplicatedtemplate.html">$duplicatedtemplate</a> = <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l1759"><span class="linenum">1759</span></a>  
<a name="l1760"><span class="linenum">1760</span></a>  <span class="comment">        // Associate each competency for the duplicated template.</span>
<a name="l1761"><span class="linenum">1761</span></a>          foreach (<a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a> as <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>) {
<a name="l1762"><span class="linenum">1762</span></a>              self::<a class="function" onClick="logFunction('add_competency_to_template')" href="../../_functions/add_competency_to_template.html" onMouseOver="funcPopup(event,'add_competency_to_template')">add_competency_to_template</a>(<a class="var it23646" onMouseOver="hilite(23646)" onMouseOut="lolite()" onClick="logVariable('duplicatedtemplate')" href="../../_variables/duplicatedtemplate.html">$duplicatedtemplate</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(), <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>());
<a name="l1763"><span class="linenum">1763</span></a>          }
<a name="l1764"><span class="linenum">1764</span></a>  
<a name="l1765"><span class="linenum">1765</span></a>  <span class="comment">        // Trigger a template created event.</span>
<a name="l1766"><span class="linenum">1766</span></a>          \core\event\<a class="class" onClick="logClass('competency_template_created')" href="../../_classes/competency_template_created.html" onMouseOver="classPopup(event,'competency_template_created')">competency_template_created</a>::<a class="function" onClick="logFunction('create_from_template')" href="../../_functions/create_from_template.html" onMouseOver="funcPopup(event,'create_from_template')">create_from_template</a>(<a class="var it23646" onMouseOver="hilite(23646)" onMouseOut="lolite()" onClick="logVariable('duplicatedtemplate')" href="../../_variables/duplicatedtemplate.html">$duplicatedtemplate</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1767"><span class="linenum">1767</span></a>  
<a name="l1768"><span class="linenum">1768</span></a>          return <a class="var it23646" onMouseOver="hilite(23646)" onMouseOut="lolite()" onClick="logVariable('duplicatedtemplate')" href="../../_variables/duplicatedtemplate.html">$duplicatedtemplate</a>;
<a name="l1769"><span class="linenum">1769</span></a>      }
<a name="l1770"><span class="linenum">1770</span></a>  
<a name="l1771"><span class="linenum">1771</span></a>      <span class="comment">/**</span>
<a name="l1772"><span class="linenum">1772</span></a>  <span class="comment">     * Delete a learning plan template by id.</span>
<a name="l1773"><span class="linenum">1773</span></a>  <span class="comment">     * If the learning plan template has associated cohorts they will be deleted.</span>
<a name="l1774"><span class="linenum">1774</span></a>  <span class="comment">     *</span>
<a name="l1775"><span class="linenum">1775</span></a>  <span class="comment">     * Requires moodle/competency:templatemanage capability.</span>
<a name="l1776"><span class="linenum">1776</span></a>  <span class="comment">     *</span>
<a name="l1777"><span class="linenum">1777</span></a>  <span class="comment">     * @param int $id The record to delete.</span>
<a name="l1778"><span class="linenum">1778</span></a>  <span class="comment">     * @param boolean $deleteplans True to delete plans associaated to template, false to unlink them.</span>
<a name="l1779"><span class="linenum">1779</span></a>  <span class="comment">     * @return boolean</span>
<a name="l1780"><span class="linenum">1780</span></a>  <span class="comment">     */</span>
<a name="l1781"><span class="linenum">1781</span></a>      public static function <a class="function" onClick="logFunction('delete_template')" href="../../_functions/delete_template.html" onMouseOver="funcPopup(event,'delete_template')">delete_template</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>, <a class="var it30454" onMouseOver="hilite(30454)" onMouseOut="lolite()" onClick="logVariable('deleteplans')" href="../../_variables/deleteplans.html">$deleteplans</a> = true) {
<a name="l1782"><span class="linenum">1782</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1783"><span class="linenum">1783</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1784"><span class="linenum">1784</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);
<a name="l1785"><span class="linenum">1785</span></a>  
<a name="l1786"><span class="linenum">1786</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l1787"><span class="linenum">1787</span></a>          if (!<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l1788"><span class="linenum">1788</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:templatemanage',
<a name="l1789"><span class="linenum">1789</span></a>                  'nopermissions', '');
<a name="l1790"><span class="linenum">1790</span></a>          }
<a name="l1791"><span class="linenum">1791</span></a>  
<a name="l1792"><span class="linenum">1792</span></a>          <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l1793"><span class="linenum">1793</span></a>          <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a> = true;
<a name="l1794"><span class="linenum">1794</span></a>  
<a name="l1795"><span class="linenum">1795</span></a>  <span class="comment">        // Check if there are cohorts associated.</span>
<a name="l1796"><span class="linenum">1796</span></a>          <a class="var it30455" onMouseOver="hilite(30455)" onMouseOut="lolite()" onClick="logVariable('templatecohorts')" href="../../_variables/templatecohorts.html">$templatecohorts</a> = <a class="class" onClick="logClass('template_cohort')" href="../../_classes/template_cohort.html" onMouseOver="classPopup(event,'template_cohort')">template_cohort</a>::<a class="function" onClick="logFunction('get_relations_by_templateid')" href="../../_functions/get_relations_by_templateid.html" onMouseOver="funcPopup(event,'get_relations_by_templateid')">get_relations_by_templateid</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>());
<a name="l1797"><span class="linenum">1797</span></a>          foreach (<a class="var it30455" onMouseOver="hilite(30455)" onMouseOut="lolite()" onClick="logVariable('templatecohorts')" href="../../_variables/templatecohorts.html">$templatecohorts</a> as <a class="var it27820" onMouseOver="hilite(27820)" onMouseOut="lolite()" onClick="logVariable('templatecohort')" href="../../_variables/templatecohort.html">$templatecohort</a>) {
<a name="l1798"><span class="linenum">1798</span></a>              <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a> = <a class="var it27820" onMouseOver="hilite(27820)" onMouseOut="lolite()" onClick="logVariable('templatecohort')" href="../../_variables/templatecohort.html">$templatecohort</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l1799"><span class="linenum">1799</span></a>              if (!<a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a>) {
<a name="l1800"><span class="linenum">1800</span></a>                  break;
<a name="l1801"><span class="linenum">1801</span></a>              }
<a name="l1802"><span class="linenum">1802</span></a>          }
<a name="l1803"><span class="linenum">1803</span></a>  
<a name="l1804"><span class="linenum">1804</span></a>  <span class="comment">        // Still OK, delete or unlink the plans from the template.</span>
<a name="l1805"><span class="linenum">1805</span></a>          if (<a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a>) {
<a name="l1806"><span class="linenum">1806</span></a>              <a class="var it4622" onMouseOver="hilite(4622)" onMouseOut="lolite()" onClick="logVariable('plans')" href="../../_variables/plans.html">$plans</a> = <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(array('templateid' =&gt; <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>()));
<a name="l1807"><span class="linenum">1807</span></a>              foreach (<a class="var it4622" onMouseOver="hilite(4622)" onMouseOut="lolite()" onClick="logVariable('plans')" href="../../_variables/plans.html">$plans</a> as <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>) {
<a name="l1808"><span class="linenum">1808</span></a>                  <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a> = <a class="var it30454" onMouseOver="hilite(30454)" onMouseOut="lolite()" onClick="logVariable('deleteplans')" href="../../_variables/deleteplans.html">$deleteplans</a> ? self::<a class="function" onClick="logFunction('delete_plan')" href="../../_functions/delete_plan.html" onMouseOver="funcPopup(event,'delete_plan')">delete_plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>()) : self::<a class="function" onClick="logFunction('unlink_plan_from_template')" href="../../_functions/unlink_plan_from_template.html" onMouseOver="funcPopup(event,'unlink_plan_from_template')">unlink_plan_from_template</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>);
<a name="l1809"><span class="linenum">1809</span></a>                  if (!<a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a>) {
<a name="l1810"><span class="linenum">1810</span></a>                      break;
<a name="l1811"><span class="linenum">1811</span></a>                  }
<a name="l1812"><span class="linenum">1812</span></a>              }
<a name="l1813"><span class="linenum">1813</span></a>          }
<a name="l1814"><span class="linenum">1814</span></a>  
<a name="l1815"><span class="linenum">1815</span></a>  <span class="comment">        // Still OK, delete the template comptencies.</span>
<a name="l1816"><span class="linenum">1816</span></a>          if (<a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a>) {
<a name="l1817"><span class="linenum">1817</span></a>              <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a> = <a class="class" onClick="logClass('template_competency')" href="../../_classes/template_competency.html" onMouseOver="classPopup(event,'template_competency')">template_competency</a>::<a class="function" onClick="logFunction('delete_by_templateid')" href="../../_functions/delete_by_templateid.html" onMouseOver="funcPopup(event,'delete_by_templateid')">delete_by_templateid</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>());
<a name="l1818"><span class="linenum">1818</span></a>          }
<a name="l1819"><span class="linenum">1819</span></a>  
<a name="l1820"><span class="linenum">1820</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l1821"><span class="linenum">1821</span></a>          if (<a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a>) {
<a name="l1822"><span class="linenum">1822</span></a>  <span class="comment">            // Create a template deleted event.</span>
<a name="l1823"><span class="linenum">1823</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('competency_template_deleted')" href="../../_classes/competency_template_deleted.html" onMouseOver="classPopup(event,'competency_template_deleted')">competency_template_deleted</a>::<a class="function" onClick="logFunction('create_from_template')" href="../../_functions/create_from_template.html" onMouseOver="funcPopup(event,'create_from_template')">create_from_template</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>);
<a name="l1824"><span class="linenum">1824</span></a>  
<a name="l1825"><span class="linenum">1825</span></a>              <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a> = <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l1826"><span class="linenum">1826</span></a>          }
<a name="l1827"><span class="linenum">1827</span></a>  
<a name="l1828"><span class="linenum">1828</span></a>          if (<a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a>) {
<a name="l1829"><span class="linenum">1829</span></a>  <span class="comment">            // Trigger a template deleted event.</span>
<a name="l1830"><span class="linenum">1830</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1831"><span class="linenum">1831</span></a>  
<a name="l1832"><span class="linenum">1832</span></a>  <span class="comment">            // Commit the transaction.</span>
<a name="l1833"><span class="linenum">1833</span></a>              <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l1834"><span class="linenum">1834</span></a>          } else {
<a name="l1835"><span class="linenum">1835</span></a>              <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('rollback')" href="../../_functions/rollback.html" onMouseOver="funcPopup(event,'rollback')">rollback</a>(<span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('Error while deleting the template.'));
<a name="l1836"><span class="linenum">1836</span></a>          }
<a name="l1837"><span class="linenum">1837</span></a>  
<a name="l1838"><span class="linenum">1838</span></a>          return <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a>;
<a name="l1839"><span class="linenum">1839</span></a>      }
<a name="l1840"><span class="linenum">1840</span></a>  
<a name="l1841"><span class="linenum">1841</span></a>      <span class="comment">/**</span>
<a name="l1842"><span class="linenum">1842</span></a>  <span class="comment">     * Update the details for a learning plan template.</span>
<a name="l1843"><span class="linenum">1843</span></a>  <span class="comment">     *</span>
<a name="l1844"><span class="linenum">1844</span></a>  <span class="comment">     * Requires moodle/competency:templatemanage capability.</span>
<a name="l1845"><span class="linenum">1845</span></a>  <span class="comment">     *</span>
<a name="l1846"><span class="linenum">1846</span></a>  <span class="comment">     * @param stdClass $record The new details for the template. Note - must contain an id that points to the template to update.</span>
<a name="l1847"><span class="linenum">1847</span></a>  <span class="comment">     * @return boolean</span>
<a name="l1848"><span class="linenum">1848</span></a>  <span class="comment">     */</span>
<a name="l1849"><span class="linenum">1849</span></a>      public static function <a class="function" onClick="logFunction('update_template')" href="../../_functions/update_template.html" onMouseOver="funcPopup(event,'update_template')">update_template</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>) {
<a name="l1850"><span class="linenum">1850</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1851"><span class="linenum">1851</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1852"><span class="linenum">1852</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l1853"><span class="linenum">1853</span></a>  
<a name="l1854"><span class="linenum">1854</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l1855"><span class="linenum">1855</span></a>          if (!<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l1856"><span class="linenum">1856</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:templatemanage',
<a name="l1857"><span class="linenum">1857</span></a>                  'nopermissions', '');
<a name="l1858"><span class="linenum">1858</span></a>  
<a name="l1859"><span class="linenum">1859</span></a>          } else if (isset(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>) &amp;&amp; <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a> != <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_contextid')" href="../../_functions/get_contextid.html" onMouseOver="funcPopup(event,'get_contextid')">get_contextid</a>()) {
<a name="l1860"><span class="linenum">1860</span></a>  <span class="comment">            // We can never change the context of a template.</span>
<a name="l1861"><span class="linenum">1861</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Changing the context of an existing tempalte is forbidden.');
<a name="l1862"><span class="linenum">1862</span></a>  
<a name="l1863"><span class="linenum">1863</span></a>          }
<a name="l1864"><span class="linenum">1864</span></a>  
<a name="l1865"><span class="linenum">1865</span></a>          <a class="var it30456" onMouseOver="hilite(30456)" onMouseOut="lolite()" onClick="logVariable('updateplans')" href="../../_variables/updateplans.html">$updateplans</a> = false;
<a name="l1866"><span class="linenum">1866</span></a>          <a class="var it6505" onMouseOver="hilite(6505)" onMouseOut="lolite()" onClick="logVariable('before')" href="../../_variables/before.html">$before</a> = <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('to_record')" href="../../_functions/to_record.html" onMouseOver="funcPopup(event,'to_record')">to_record</a>();
<a name="l1867"><span class="linenum">1867</span></a>  
<a name="l1868"><span class="linenum">1868</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('from_record')" href="../../_functions/from_record.html" onMouseOver="funcPopup(event,'from_record')">from_record</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>);
<a name="l1869"><span class="linenum">1869</span></a>          <a class="var it6083" onMouseOver="hilite(6083)" onMouseOut="lolite()" onClick="logVariable('after')" href="../../_variables/after.html">$after</a> = <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('to_record')" href="../../_functions/to_record.html" onMouseOver="funcPopup(event,'to_record')">to_record</a>();
<a name="l1870"><span class="linenum">1870</span></a>  
<a name="l1871"><span class="linenum">1871</span></a>  <span class="comment">        // Should we update the related plans?</span>
<a name="l1872"><span class="linenum">1872</span></a>          if (<a class="var it6505" onMouseOver="hilite(6505)" onMouseOut="lolite()" onClick="logVariable('before')" href="../../_variables/before.html">$before</a>-&gt;<a onClick="logVariable('duedate')" class="var it43743" onMouseOver="hilite(43743)" onMouseOut="lolite()" href="../../_variables/duedate.html">duedate</a> != <a class="var it6083" onMouseOver="hilite(6083)" onMouseOut="lolite()" onClick="logVariable('after')" href="../../_variables/after.html">$after</a>-&gt;<a onClick="logVariable('duedate')" class="var it43222" onMouseOver="hilite(43222)" onMouseOut="lolite()" href="../../_variables/duedate.html">duedate</a> ||
<a name="l1873"><span class="linenum">1873</span></a>                  <a class="var it6505" onMouseOver="hilite(6505)" onMouseOut="lolite()" onClick="logVariable('before')" href="../../_variables/before.html">$before</a>-&gt;<a onClick="logVariable('shortname')" class="var it43743" onMouseOver="hilite(43743)" onMouseOut="lolite()" href="../../_variables/shortname.html">shortname</a> != <a class="var it6083" onMouseOver="hilite(6083)" onMouseOut="lolite()" onClick="logVariable('after')" href="../../_variables/after.html">$after</a>-&gt;<a onClick="logVariable('shortname')" class="var it43222" onMouseOver="hilite(43222)" onMouseOut="lolite()" href="../../_variables/shortname.html">shortname</a> ||
<a name="l1874"><span class="linenum">1874</span></a>                  <a class="var it6505" onMouseOver="hilite(6505)" onMouseOut="lolite()" onClick="logVariable('before')" href="../../_variables/before.html">$before</a>-&gt;<a onClick="logVariable('description')" class="var it43743" onMouseOver="hilite(43743)" onMouseOut="lolite()" href="../../_variables/description.html">description</a> != <a class="var it6083" onMouseOver="hilite(6083)" onMouseOut="lolite()" onClick="logVariable('after')" href="../../_variables/after.html">$after</a>-&gt;<a onClick="logVariable('description')" class="var it43222" onMouseOver="hilite(43222)" onMouseOut="lolite()" href="../../_variables/description.html">description</a> ||
<a name="l1875"><span class="linenum">1875</span></a>                  <a class="var it6505" onMouseOver="hilite(6505)" onMouseOut="lolite()" onClick="logVariable('before')" href="../../_variables/before.html">$before</a>-&gt;<a onClick="logVariable('descriptionformat')" class="var it43743" onMouseOver="hilite(43743)" onMouseOut="lolite()" href="../../_variables/descriptionformat.html">descriptionformat</a> != <a class="var it6083" onMouseOver="hilite(6083)" onMouseOut="lolite()" onClick="logVariable('after')" href="../../_variables/after.html">$after</a>-&gt;<a onClick="logVariable('descriptionformat')" class="var it43222" onMouseOver="hilite(43222)" onMouseOut="lolite()" href="../../_variables/descriptionformat.html">descriptionformat</a>) {
<a name="l1876"><span class="linenum">1876</span></a>              <a class="var it30456" onMouseOver="hilite(30456)" onMouseOut="lolite()" onClick="logVariable('updateplans')" href="../../_variables/updateplans.html">$updateplans</a> = true;
<a name="l1877"><span class="linenum">1877</span></a>          }
<a name="l1878"><span class="linenum">1878</span></a>  
<a name="l1879"><span class="linenum">1879</span></a>          <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l1880"><span class="linenum">1880</span></a>          <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a> = <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l1881"><span class="linenum">1881</span></a>  
<a name="l1882"><span class="linenum">1882</span></a>          if (!<a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a>) {
<a name="l1883"><span class="linenum">1883</span></a>              <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('rollback')" href="../../_functions/rollback.html" onMouseOver="funcPopup(event,'rollback')">rollback</a>(<span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('Error while updating the template.'));
<a name="l1884"><span class="linenum">1884</span></a>              return <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a>;
<a name="l1885"><span class="linenum">1885</span></a>          }
<a name="l1886"><span class="linenum">1886</span></a>  
<a name="l1887"><span class="linenum">1887</span></a>  <span class="comment">        // Trigger a template updated event.</span>
<a name="l1888"><span class="linenum">1888</span></a>          \core\event\<a class="class" onClick="logClass('competency_template_updated')" href="../../_classes/competency_template_updated.html" onMouseOver="classPopup(event,'competency_template_updated')">competency_template_updated</a>::<a class="function" onClick="logFunction('create_from_template')" href="../../_functions/create_from_template.html" onMouseOver="funcPopup(event,'create_from_template')">create_from_template</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1889"><span class="linenum">1889</span></a>  
<a name="l1890"><span class="linenum">1890</span></a>          if (<a class="var it30456" onMouseOver="hilite(30456)" onMouseOut="lolite()" onClick="logVariable('updateplans')" href="../../_variables/updateplans.html">$updateplans</a>) {
<a name="l1891"><span class="linenum">1891</span></a>              <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::<a class="function" onClick="logFunction('update_multiple_from_template')" href="../../_functions/update_multiple_from_template.html" onMouseOver="funcPopup(event,'update_multiple_from_template')">update_multiple_from_template</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>);
<a name="l1892"><span class="linenum">1892</span></a>          }
<a name="l1893"><span class="linenum">1893</span></a>  
<a name="l1894"><span class="linenum">1894</span></a>          <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l1895"><span class="linenum">1895</span></a>  
<a name="l1896"><span class="linenum">1896</span></a>          return <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a>;
<a name="l1897"><span class="linenum">1897</span></a>      }
<a name="l1898"><span class="linenum">1898</span></a>  
<a name="l1899"><span class="linenum">1899</span></a>      <span class="comment">/**</span>
<a name="l1900"><span class="linenum">1900</span></a>  <span class="comment">     * Read a the details for a single learning plan template and return a record.</span>
<a name="l1901"><span class="linenum">1901</span></a>  <span class="comment">     *</span>
<a name="l1902"><span class="linenum">1902</span></a>  <span class="comment">     * Requires moodle/competency:templateview capability at the system context.</span>
<a name="l1903"><span class="linenum">1903</span></a>  <span class="comment">     *</span>
<a name="l1904"><span class="linenum">1904</span></a>  <span class="comment">     * @param int $id The id of the template to read.</span>
<a name="l1905"><span class="linenum">1905</span></a>  <span class="comment">     * @return template</span>
<a name="l1906"><span class="linenum">1906</span></a>  <span class="comment">     */</span>
<a name="l1907"><span class="linenum">1907</span></a>      public static function <a class="function" onClick="logFunction('read_template')" href="../../_functions/read_template.html" onMouseOver="funcPopup(event,'read_template')">read_template</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>) {
<a name="l1908"><span class="linenum">1908</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1909"><span class="linenum">1909</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);
<a name="l1910"><span class="linenum">1910</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>();
<a name="l1911"><span class="linenum">1911</span></a>  
<a name="l1912"><span class="linenum">1912</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l1913"><span class="linenum">1913</span></a>          if (!<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l1914"><span class="linenum">1914</span></a>               throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:templateview',
<a name="l1915"><span class="linenum">1915</span></a>                  'nopermissions', '');
<a name="l1916"><span class="linenum">1916</span></a>          }
<a name="l1917"><span class="linenum">1917</span></a>  
<a name="l1918"><span class="linenum">1918</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l1919"><span class="linenum">1919</span></a>          return <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>;
<a name="l1920"><span class="linenum">1920</span></a>      }
<a name="l1921"><span class="linenum">1921</span></a>  
<a name="l1922"><span class="linenum">1922</span></a>      <span class="comment">/**</span>
<a name="l1923"><span class="linenum">1923</span></a>  <span class="comment">     * Perform a search based on the provided filters and return a paginated list of records.</span>
<a name="l1924"><span class="linenum">1924</span></a>  <span class="comment">     *</span>
<a name="l1925"><span class="linenum">1925</span></a>  <span class="comment">     * Requires moodle/competency:templateview capability at the system context.</span>
<a name="l1926"><span class="linenum">1926</span></a>  <span class="comment">     *</span>
<a name="l1927"><span class="linenum">1927</span></a>  <span class="comment">     * @param string $sort The column to sort on</span>
<a name="l1928"><span class="linenum">1928</span></a>  <span class="comment">     * @param string $order ('ASC' or 'DESC')</span>
<a name="l1929"><span class="linenum">1929</span></a>  <span class="comment">     * @param int $skip Number of records to skip (pagination)</span>
<a name="l1930"><span class="linenum">1930</span></a>  <span class="comment">     * @param int $limit Max of records to return (pagination)</span>
<a name="l1931"><span class="linenum">1931</span></a>  <span class="comment">     * @param context $context The parent context of the frameworks.</span>
<a name="l1932"><span class="linenum">1932</span></a>  <span class="comment">     * @param string $includes Defines what other contexts to fetch frameworks from.</span>
<a name="l1933"><span class="linenum">1933</span></a>  <span class="comment">     *                         Accepted values are:</span>
<a name="l1934"><span class="linenum">1934</span></a>  <span class="comment">     *                          - children: All descendants</span>
<a name="l1935"><span class="linenum">1935</span></a>  <span class="comment">     *                          - parents: All parents, grand parents, etc...</span>
<a name="l1936"><span class="linenum">1936</span></a>  <span class="comment">     *                          - self: Context passed only.</span>
<a name="l1937"><span class="linenum">1937</span></a>  <span class="comment">     * @param bool $onlyvisible If should list only visible templates</span>
<a name="l1938"><span class="linenum">1938</span></a>  <span class="comment">     * @return array of competency_framework</span>
<a name="l1939"><span class="linenum">1939</span></a>  <span class="comment">     */</span>
<a name="l1940"><span class="linenum">1940</span></a>      public static function <a class="function" onClick="logFunction('list_templates')" href="../../_functions/list_templates.html" onMouseOver="funcPopup(event,'list_templates')">list_templates</a>(<a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a>, <a class="var it6270" onMouseOver="hilite(6270)" onMouseOut="lolite()" onClick="logVariable('order')" href="../../_variables/order.html">$order</a>, <a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('skip')" href="../../_variables/skip.html">$skip</a>, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it30432" onMouseOver="hilite(30432)" onMouseOut="lolite()" onClick="logVariable('includes')" href="../../_variables/includes.html">$includes</a> = 'children', <a class="var it4855" onMouseOver="hilite(4855)" onMouseOut="lolite()" onClick="logVariable('onlyvisible')" href="../../_variables/onlyvisible.html">$onlyvisible</a> = false) {
<a name="l1941"><span class="linenum">1941</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1942"><span class="linenum">1942</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1943"><span class="linenum">1943</span></a>  
<a name="l1944"><span class="linenum">1944</span></a>  <span class="comment">        // Get all the relevant contexts.</span>
<a name="l1945"><span class="linenum">1945</span></a>          <a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a> = self::<a class="function" onClick="logFunction('get_related_contexts')" href="../../_functions/get_related_contexts.html" onMouseOver="funcPopup(event,'get_related_contexts')">get_related_contexts</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it30432" onMouseOver="hilite(30432)" onMouseOut="lolite()" onClick="logVariable('includes')" href="../../_variables/includes.html">$includes</a>,
<a name="l1946"><span class="linenum">1946</span></a>              array('moodle/competency:templateview', 'moodle/competency:templatemanage'));
<a name="l1947"><span class="linenum">1947</span></a>  
<a name="l1948"><span class="linenum">1948</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l1949"><span class="linenum">1949</span></a>          if (empty(<a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a>)) {
<a name="l1950"><span class="linenum">1950</span></a>               throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:templateview', 'nopermissions', '');
<a name="l1951"><span class="linenum">1951</span></a>          }
<a name="l1952"><span class="linenum">1952</span></a>  
<a name="l1953"><span class="linenum">1953</span></a>  <span class="comment">        // Make the order by.</span>
<a name="l1954"><span class="linenum">1954</span></a>          <a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../../_variables/orderby.html">$orderby</a> = '';
<a name="l1955"><span class="linenum">1955</span></a>          if (!empty(<a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a>)) {
<a name="l1956"><span class="linenum">1956</span></a>              <a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../../_variables/orderby.html">$orderby</a> = <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> . ' ' . <a class="var it6270" onMouseOver="hilite(6270)" onMouseOut="lolite()" onClick="logVariable('order')" href="../../_variables/order.html">$order</a>;
<a name="l1957"><span class="linenum">1957</span></a>          }
<a name="l1958"><span class="linenum">1958</span></a>  
<a name="l1959"><span class="linenum">1959</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l1960"><span class="linenum">1960</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>();
<a name="l1961"><span class="linenum">1961</span></a>          <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it1041" onMouseOver="hilite(1041)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../../_variables/insql.html">$insql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="phpfunction" onClick="logFunction('array_keys')" href="../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a>), <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>);
<a name="l1962"><span class="linenum">1962</span></a>          <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> = &quot;contextid <a class="var it1041" onMouseOver="hilite(1041)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../../_variables/insql.html">$insql</a>&quot;;
<a name="l1963"><span class="linenum">1963</span></a>  
<a name="l1964"><span class="linenum">1964</span></a>          if (<a class="var it4855" onMouseOver="hilite(4855)" onMouseOut="lolite()" onClick="logVariable('onlyvisible')" href="../../_variables/onlyvisible.html">$onlyvisible</a>) {
<a name="l1965"><span class="linenum">1965</span></a>              <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> .= &quot; AND visible = :visible&quot;;
<a name="l1966"><span class="linenum">1966</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['visible'] = 1;
<a name="l1967"><span class="linenum">1967</span></a>          }
<a name="l1968"><span class="linenum">1968</span></a>          return <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_records_select')" href="../../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>(<a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, <a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../../_variables/orderby.html">$orderby</a>, '*', <a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('skip')" href="../../_variables/skip.html">$skip</a>, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a>);
<a name="l1969"><span class="linenum">1969</span></a>      }
<a name="l1970"><span class="linenum">1970</span></a>  
<a name="l1971"><span class="linenum">1971</span></a>      <span class="comment">/**</span>
<a name="l1972"><span class="linenum">1972</span></a>  <span class="comment">     * Perform a search based on the provided filters and return how many results there are.</span>
<a name="l1973"><span class="linenum">1973</span></a>  <span class="comment">     *</span>
<a name="l1974"><span class="linenum">1974</span></a>  <span class="comment">     * Requires moodle/competency:templateview capability at the system context.</span>
<a name="l1975"><span class="linenum">1975</span></a>  <span class="comment">     *</span>
<a name="l1976"><span class="linenum">1976</span></a>  <span class="comment">     * @param context $context The parent context of the frameworks.</span>
<a name="l1977"><span class="linenum">1977</span></a>  <span class="comment">     * @param string $includes Defines what other contexts to fetch frameworks from.</span>
<a name="l1978"><span class="linenum">1978</span></a>  <span class="comment">     *                         Accepted values are:</span>
<a name="l1979"><span class="linenum">1979</span></a>  <span class="comment">     *                          - children: All descendants</span>
<a name="l1980"><span class="linenum">1980</span></a>  <span class="comment">     *                          - parents: All parents, grand parents, etc...</span>
<a name="l1981"><span class="linenum">1981</span></a>  <span class="comment">     *                          - self: Context passed only.</span>
<a name="l1982"><span class="linenum">1982</span></a>  <span class="comment">     * @return int</span>
<a name="l1983"><span class="linenum">1983</span></a>  <span class="comment">     */</span>
<a name="l1984"><span class="linenum">1984</span></a>      public static function <a class="function" onClick="logFunction('count_templates')" href="../../_functions/count_templates.html" onMouseOver="funcPopup(event,'count_templates')">count_templates</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it30432" onMouseOver="hilite(30432)" onMouseOut="lolite()" onClick="logVariable('includes')" href="../../_variables/includes.html">$includes</a>) {
<a name="l1985"><span class="linenum">1985</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l1986"><span class="linenum">1986</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l1987"><span class="linenum">1987</span></a>  
<a name="l1988"><span class="linenum">1988</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l1989"><span class="linenum">1989</span></a>          <a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a> = self::<a class="function" onClick="logFunction('get_related_contexts')" href="../../_functions/get_related_contexts.html" onMouseOver="funcPopup(event,'get_related_contexts')">get_related_contexts</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it30432" onMouseOver="hilite(30432)" onMouseOut="lolite()" onClick="logVariable('includes')" href="../../_variables/includes.html">$includes</a>,
<a name="l1990"><span class="linenum">1990</span></a>              array('moodle/competency:templateview', 'moodle/competency:templatemanage'));
<a name="l1991"><span class="linenum">1991</span></a>  
<a name="l1992"><span class="linenum">1992</span></a>          if (empty(<a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a>)) {
<a name="l1993"><span class="linenum">1993</span></a>               throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:templateview', 'nopermissions', '');
<a name="l1994"><span class="linenum">1994</span></a>          }
<a name="l1995"><span class="linenum">1995</span></a>  
<a name="l1996"><span class="linenum">1996</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l1997"><span class="linenum">1997</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>();
<a name="l1998"><span class="linenum">1998</span></a>          <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it1041" onMouseOver="hilite(1041)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../../_variables/insql.html">$insql</a>, <a class="var it4859" onMouseOver="hilite(4859)" onMouseOut="lolite()" onClick="logVariable('inparams')" href="../../_variables/inparams.html">$inparams</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="phpfunction" onClick="logFunction('array_keys')" href="../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>(<a class="var it2537" onMouseOver="hilite(2537)" onMouseOut="lolite()" onClick="logVariable('contexts')" href="../../_variables/contexts.html">$contexts</a>), <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>);
<a name="l1999"><span class="linenum">1999</span></a>          return <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('count_records_select')" href="../../_functions/count_records_select.html" onMouseOver="funcPopup(event,'count_records_select')">count_records_select</a>(&quot;contextid <a class="var it1041" onMouseOver="hilite(1041)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../../_variables/insql.html">$insql</a>&quot;, <a class="var it4859" onMouseOver="hilite(4859)" onMouseOut="lolite()" onClick="logVariable('inparams')" href="../../_variables/inparams.html">$inparams</a>);
<a name="l2000"><span class="linenum">2000</span></a>      }
<a name="l2001"><span class="linenum">2001</span></a>  
<a name="l2002"><span class="linenum">2002</span></a>      <span class="comment">/**</span>
<a name="l2003"><span class="linenum">2003</span></a>  <span class="comment">     * Count all the templates using a competency.</span>
<a name="l2004"><span class="linenum">2004</span></a>  <span class="comment">     *</span>
<a name="l2005"><span class="linenum">2005</span></a>  <span class="comment">     * @param int $competencyid The id of the competency to check.</span>
<a name="l2006"><span class="linenum">2006</span></a>  <span class="comment">     * @return int</span>
<a name="l2007"><span class="linenum">2007</span></a>  <span class="comment">     */</span>
<a name="l2008"><span class="linenum">2008</span></a>      public static function <a class="function" onClick="logFunction('count_templates_using_competency')" href="../../_functions/count_templates_using_competency.html" onMouseOver="funcPopup(event,'count_templates_using_competency')">count_templates_using_competency</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>) {
<a name="l2009"><span class="linenum">2009</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2010"><span class="linenum">2010</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l2011"><span class="linenum">2011</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l2012"><span class="linenum">2012</span></a>          <a class="var it4855" onMouseOver="hilite(4855)" onMouseOut="lolite()" onClick="logVariable('onlyvisible')" href="../../_variables/onlyvisible.html">$onlyvisible</a> = 1;
<a name="l2013"><span class="linenum">2013</span></a>  
<a name="l2014"><span class="linenum">2014</span></a>          <a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a> = array('moodle/competency:templateview', 'moodle/competency:templatemanage');
<a name="l2015"><span class="linenum">2015</span></a>          if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(<a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l2016"><span class="linenum">2016</span></a>               throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:templateview', 'nopermissions', '');
<a name="l2017"><span class="linenum">2017</span></a>          }
<a name="l2018"><span class="linenum">2018</span></a>  
<a name="l2019"><span class="linenum">2019</span></a>          if (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/competency:templatemanage', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l2020"><span class="linenum">2020</span></a>              <a class="var it4855" onMouseOver="hilite(4855)" onMouseOut="lolite()" onClick="logVariable('onlyvisible')" href="../../_variables/onlyvisible.html">$onlyvisible</a> = 0;
<a name="l2021"><span class="linenum">2021</span></a>          }
<a name="l2022"><span class="linenum">2022</span></a>  
<a name="l2023"><span class="linenum">2023</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l2024"><span class="linenum">2024</span></a>          return <a class="class" onClick="logClass('template_competency')" href="../../_classes/template_competency.html" onMouseOver="classPopup(event,'template_competency')">template_competency</a>::<a class="function" onClick="logFunction('count_templates')" href="../../_functions/count_templates.html" onMouseOver="funcPopup(event,'count_templates')">count_templates</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>, <a class="var it4855" onMouseOver="hilite(4855)" onMouseOut="lolite()" onClick="logVariable('onlyvisible')" href="../../_variables/onlyvisible.html">$onlyvisible</a>);
<a name="l2025"><span class="linenum">2025</span></a>      }
<a name="l2026"><span class="linenum">2026</span></a>  
<a name="l2027"><span class="linenum">2027</span></a>      <span class="comment">/**</span>
<a name="l2028"><span class="linenum">2028</span></a>  <span class="comment">     * List all the learning plan templatesd using a competency.</span>
<a name="l2029"><span class="linenum">2029</span></a>  <span class="comment">     *</span>
<a name="l2030"><span class="linenum">2030</span></a>  <span class="comment">     * @param int $competencyid The id of the competency to check.</span>
<a name="l2031"><span class="linenum">2031</span></a>  <span class="comment">     * @return array[stdClass] Array of stdClass containing id and shortname.</span>
<a name="l2032"><span class="linenum">2032</span></a>  <span class="comment">     */</span>
<a name="l2033"><span class="linenum">2033</span></a>      public static function <a class="function" onClick="logFunction('list_templates_using_competency')" href="../../_functions/list_templates_using_competency.html" onMouseOver="funcPopup(event,'list_templates_using_competency')">list_templates_using_competency</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>) {
<a name="l2034"><span class="linenum">2034</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2035"><span class="linenum">2035</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l2036"><span class="linenum">2036</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l2037"><span class="linenum">2037</span></a>          <a class="var it4855" onMouseOver="hilite(4855)" onMouseOut="lolite()" onClick="logVariable('onlyvisible')" href="../../_variables/onlyvisible.html">$onlyvisible</a> = 1;
<a name="l2038"><span class="linenum">2038</span></a>  
<a name="l2039"><span class="linenum">2039</span></a>          <a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a> = array('moodle/competency:templateview', 'moodle/competency:templatemanage');
<a name="l2040"><span class="linenum">2040</span></a>          if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(<a class="var it279" onMouseOver="hilite(279)" onMouseOut="lolite()" onClick="logVariable('capabilities')" href="../../_variables/capabilities.html">$capabilities</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l2041"><span class="linenum">2041</span></a>               throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:templateview', 'nopermissions', '');
<a name="l2042"><span class="linenum">2042</span></a>          }
<a name="l2043"><span class="linenum">2043</span></a>  
<a name="l2044"><span class="linenum">2044</span></a>          if (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/competency:templatemanage', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>)) {
<a name="l2045"><span class="linenum">2045</span></a>              <a class="var it4855" onMouseOver="hilite(4855)" onMouseOut="lolite()" onClick="logVariable('onlyvisible')" href="../../_variables/onlyvisible.html">$onlyvisible</a> = 0;
<a name="l2046"><span class="linenum">2046</span></a>          }
<a name="l2047"><span class="linenum">2047</span></a>  
<a name="l2048"><span class="linenum">2048</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l2049"><span class="linenum">2049</span></a>          return <a class="class" onClick="logClass('template_competency')" href="../../_classes/template_competency.html" onMouseOver="classPopup(event,'template_competency')">template_competency</a>::<a class="function" onClick="logFunction('list_templates')" href="../../_functions/list_templates.html" onMouseOver="funcPopup(event,'list_templates')">list_templates</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>, <a class="var it4855" onMouseOver="hilite(4855)" onMouseOut="lolite()" onClick="logVariable('onlyvisible')" href="../../_variables/onlyvisible.html">$onlyvisible</a>);
<a name="l2050"><span class="linenum">2050</span></a>  
<a name="l2051"><span class="linenum">2051</span></a>      }
<a name="l2052"><span class="linenum">2052</span></a>  
<a name="l2053"><span class="linenum">2053</span></a>      <span class="comment">/**</span>
<a name="l2054"><span class="linenum">2054</span></a>  <span class="comment">     * Count all the competencies in a learning plan template.</span>
<a name="l2055"><span class="linenum">2055</span></a>  <span class="comment">     *</span>
<a name="l2056"><span class="linenum">2056</span></a>  <span class="comment">     * @param  template|int $templateorid The template or its ID.</span>
<a name="l2057"><span class="linenum">2057</span></a>  <span class="comment">     * @return int</span>
<a name="l2058"><span class="linenum">2058</span></a>  <span class="comment">     */</span>
<a name="l2059"><span class="linenum">2059</span></a>      public static function <a class="function" onClick="logFunction('count_competencies_in_template')" href="../../_functions/count_competencies_in_template.html" onMouseOver="funcPopup(event,'count_competencies_in_template')">count_competencies_in_template</a>(<a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>) {
<a name="l2060"><span class="linenum">2060</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2061"><span class="linenum">2061</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l2062"><span class="linenum">2062</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>;
<a name="l2063"><span class="linenum">2063</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>)) {
<a name="l2064"><span class="linenum">2064</span></a>              <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>);
<a name="l2065"><span class="linenum">2065</span></a>          }
<a name="l2066"><span class="linenum">2066</span></a>  
<a name="l2067"><span class="linenum">2067</span></a>          if (!<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l2068"><span class="linenum">2068</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:templateview',
<a name="l2069"><span class="linenum">2069</span></a>                  'nopermissions', '');
<a name="l2070"><span class="linenum">2070</span></a>          }
<a name="l2071"><span class="linenum">2071</span></a>  
<a name="l2072"><span class="linenum">2072</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l2073"><span class="linenum">2073</span></a>          return <a class="class" onClick="logClass('template_competency')" href="../../_classes/template_competency.html" onMouseOver="classPopup(event,'template_competency')">template_competency</a>::<a class="function" onClick="logFunction('count_competencies')" href="../../_functions/count_competencies.html" onMouseOver="funcPopup(event,'count_competencies')">count_competencies</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>());
<a name="l2074"><span class="linenum">2074</span></a>      }
<a name="l2075"><span class="linenum">2075</span></a>  
<a name="l2076"><span class="linenum">2076</span></a>      <span class="comment">/**</span>
<a name="l2077"><span class="linenum">2077</span></a>  <span class="comment">     * Count all the competencies in a learning plan template with no linked courses.</span>
<a name="l2078"><span class="linenum">2078</span></a>  <span class="comment">     *</span>
<a name="l2079"><span class="linenum">2079</span></a>  <span class="comment">     * @param  template|int $templateorid The template or its ID.</span>
<a name="l2080"><span class="linenum">2080</span></a>  <span class="comment">     * @return int</span>
<a name="l2081"><span class="linenum">2081</span></a>  <span class="comment">     */</span>
<a name="l2082"><span class="linenum">2082</span></a>      public static function <a class="function" onClick="logFunction('count_competencies_in_template_with_no_courses')" href="../../_functions/count_competencies_in_template_with_no_courses.html" onMouseOver="funcPopup(event,'count_competencies_in_template_with_no_courses')">count_competencies_in_template_with_no_courses</a>(<a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>) {
<a name="l2083"><span class="linenum">2083</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l2084"><span class="linenum">2084</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>;
<a name="l2085"><span class="linenum">2085</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>)) {
<a name="l2086"><span class="linenum">2086</span></a>              <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>);
<a name="l2087"><span class="linenum">2087</span></a>          }
<a name="l2088"><span class="linenum">2088</span></a>  
<a name="l2089"><span class="linenum">2089</span></a>          if (!<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l2090"><span class="linenum">2090</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:templateview',
<a name="l2091"><span class="linenum">2091</span></a>                  'nopermissions', '');
<a name="l2092"><span class="linenum">2092</span></a>          }
<a name="l2093"><span class="linenum">2093</span></a>  
<a name="l2094"><span class="linenum">2094</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l2095"><span class="linenum">2095</span></a>          return <a class="class" onClick="logClass('template_competency')" href="../../_classes/template_competency.html" onMouseOver="classPopup(event,'template_competency')">template_competency</a>::<a class="function" onClick="logFunction('count_competencies_with_no_courses')" href="../../_functions/count_competencies_with_no_courses.html" onMouseOver="funcPopup(event,'count_competencies_with_no_courses')">count_competencies_with_no_courses</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>());
<a name="l2096"><span class="linenum">2096</span></a>      }
<a name="l2097"><span class="linenum">2097</span></a>  
<a name="l2098"><span class="linenum">2098</span></a>      <span class="comment">/**</span>
<a name="l2099"><span class="linenum">2099</span></a>  <span class="comment">     * List all the competencies in a template.</span>
<a name="l2100"><span class="linenum">2100</span></a>  <span class="comment">     *</span>
<a name="l2101"><span class="linenum">2101</span></a>  <span class="comment">     * @param  template|int $templateorid The template or its ID.</span>
<a name="l2102"><span class="linenum">2102</span></a>  <span class="comment">     * @return array of competencies</span>
<a name="l2103"><span class="linenum">2103</span></a>  <span class="comment">     */</span>
<a name="l2104"><span class="linenum">2104</span></a>      public static function <a class="function" onClick="logFunction('list_competencies_in_template')" href="../../_functions/list_competencies_in_template.html" onMouseOver="funcPopup(event,'list_competencies_in_template')">list_competencies_in_template</a>(<a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>) {
<a name="l2105"><span class="linenum">2105</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2106"><span class="linenum">2106</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l2107"><span class="linenum">2107</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>;
<a name="l2108"><span class="linenum">2108</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>)) {
<a name="l2109"><span class="linenum">2109</span></a>              <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>);
<a name="l2110"><span class="linenum">2110</span></a>          }
<a name="l2111"><span class="linenum">2111</span></a>  
<a name="l2112"><span class="linenum">2112</span></a>          if (!<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l2113"><span class="linenum">2113</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:templateview',
<a name="l2114"><span class="linenum">2114</span></a>                  'nopermissions', '');
<a name="l2115"><span class="linenum">2115</span></a>          }
<a name="l2116"><span class="linenum">2116</span></a>  
<a name="l2117"><span class="linenum">2117</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l2118"><span class="linenum">2118</span></a>          return <a class="class" onClick="logClass('template_competency')" href="../../_classes/template_competency.html" onMouseOver="classPopup(event,'template_competency')">template_competency</a>::<a class="function" onClick="logFunction('list_competencies')" href="../../_functions/list_competencies.html" onMouseOver="funcPopup(event,'list_competencies')">list_competencies</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>());
<a name="l2119"><span class="linenum">2119</span></a>      }
<a name="l2120"><span class="linenum">2120</span></a>  
<a name="l2121"><span class="linenum">2121</span></a>      <span class="comment">/**</span>
<a name="l2122"><span class="linenum">2122</span></a>  <span class="comment">     * Add a competency to this template.</span>
<a name="l2123"><span class="linenum">2123</span></a>  <span class="comment">     *</span>
<a name="l2124"><span class="linenum">2124</span></a>  <span class="comment">     * @param int $templateid The id of the template</span>
<a name="l2125"><span class="linenum">2125</span></a>  <span class="comment">     * @param int $competencyid The id of the competency</span>
<a name="l2126"><span class="linenum">2126</span></a>  <span class="comment">     * @return bool</span>
<a name="l2127"><span class="linenum">2127</span></a>  <span class="comment">     */</span>
<a name="l2128"><span class="linenum">2128</span></a>      public static function <a class="function" onClick="logFunction('add_competency_to_template')" href="../../_functions/add_competency_to_template.html" onMouseOver="funcPopup(event,'add_competency_to_template')">add_competency_to_template</a>(<a class="var it7511" onMouseOver="hilite(7511)" onMouseOut="lolite()" onClick="logVariable('templateid')" href="../../_variables/templateid.html">$templateid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>) {
<a name="l2129"><span class="linenum">2129</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2130"><span class="linenum">2130</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l2131"><span class="linenum">2131</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>(<a class="var it7511" onMouseOver="hilite(7511)" onMouseOut="lolite()" onClick="logVariable('templateid')" href="../../_variables/templateid.html">$templateid</a>);
<a name="l2132"><span class="linenum">2132</span></a>          if (!<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l2133"><span class="linenum">2133</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:templatemanage',
<a name="l2134"><span class="linenum">2134</span></a>                  'nopermissions', '');
<a name="l2135"><span class="linenum">2135</span></a>          }
<a name="l2136"><span class="linenum">2136</span></a>  
<a name="l2137"><span class="linenum">2137</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a> = new stdClass();
<a name="l2138"><span class="linenum">2138</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('templateid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/templateid.html">templateid</a> = <a class="var it7511" onMouseOver="hilite(7511)" onMouseOut="lolite()" onClick="logVariable('templateid')" href="../../_variables/templateid.html">$templateid</a>;
<a name="l2139"><span class="linenum">2139</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('competencyid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/competencyid.html">competencyid</a> = <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>;
<a name="l2140"><span class="linenum">2140</span></a>  
<a name="l2141"><span class="linenum">2141</span></a>          <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l2142"><span class="linenum">2142</span></a>  
<a name="l2143"><span class="linenum">2143</span></a>  <span class="comment">        // Can not add a competency that belong to a hidden framework.</span>
<a name="l2144"><span class="linenum">2144</span></a>          if (<a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_framework')" href="../../_functions/get_framework.html" onMouseOver="funcPopup(event,'get_framework')">get_framework</a>()-&gt;<a class="function" onClick="logFunction('get_visible')" href="../../_functions/get_visible.html" onMouseOver="funcPopup(event,'get_visible')">get_visible</a>() == false) {
<a name="l2145"><span class="linenum">2145</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('A competency belonging to hidden framework can not be added');
<a name="l2146"><span class="linenum">2146</span></a>          }
<a name="l2147"><span class="linenum">2147</span></a>  
<a name="l2148"><span class="linenum">2148</span></a>          <a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a> = <a class="class" onClick="logClass('template_competency')" href="../../_classes/template_competency.html" onMouseOver="classPopup(event,'template_competency')">template_competency</a>::<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(array('templateid' =&gt; <a class="var it7511" onMouseOver="hilite(7511)" onMouseOut="lolite()" onClick="logVariable('templateid')" href="../../_variables/templateid.html">$templateid</a>, 'competencyid' =&gt; <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>));
<a name="l2149"><span class="linenum">2149</span></a>          if (!<a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a>) {
<a name="l2150"><span class="linenum">2150</span></a>              <a class="var it30458" onMouseOver="hilite(30458)" onMouseOut="lolite()" onClick="logVariable('templatecompetency')" href="../../_variables/templatecompetency.html">$templatecompetency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template_competency')" href="../../_classes/template_competency.html" onMouseOver="classPopup(event,'template_competency')">template_competency</a>(0, <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>);
<a name="l2151"><span class="linenum">2151</span></a>              <a class="var it30458" onMouseOver="hilite(30458)" onMouseOut="lolite()" onClick="logVariable('templatecompetency')" href="../../_variables/templatecompetency.html">$templatecompetency</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l2152"><span class="linenum">2152</span></a>              return true;
<a name="l2153"><span class="linenum">2153</span></a>          }
<a name="l2154"><span class="linenum">2154</span></a>          return false;
<a name="l2155"><span class="linenum">2155</span></a>      }
<a name="l2156"><span class="linenum">2156</span></a>  
<a name="l2157"><span class="linenum">2157</span></a>      <span class="comment">/**</span>
<a name="l2158"><span class="linenum">2158</span></a>  <span class="comment">     * Remove a competency from this template.</span>
<a name="l2159"><span class="linenum">2159</span></a>  <span class="comment">     *</span>
<a name="l2160"><span class="linenum">2160</span></a>  <span class="comment">     * @param int $templateid The id of the template</span>
<a name="l2161"><span class="linenum">2161</span></a>  <span class="comment">     * @param int $competencyid The id of the competency</span>
<a name="l2162"><span class="linenum">2162</span></a>  <span class="comment">     * @return bool</span>
<a name="l2163"><span class="linenum">2163</span></a>  <span class="comment">     */</span>
<a name="l2164"><span class="linenum">2164</span></a>      public static function <a class="function" onClick="logFunction('remove_competency_from_template')" href="../../_functions/remove_competency_from_template.html" onMouseOver="funcPopup(event,'remove_competency_from_template')">remove_competency_from_template</a>(<a class="var it7511" onMouseOver="hilite(7511)" onMouseOut="lolite()" onClick="logVariable('templateid')" href="../../_variables/templateid.html">$templateid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>) {
<a name="l2165"><span class="linenum">2165</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2166"><span class="linenum">2166</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l2167"><span class="linenum">2167</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>(<a class="var it7511" onMouseOver="hilite(7511)" onMouseOut="lolite()" onClick="logVariable('templateid')" href="../../_variables/templateid.html">$templateid</a>);
<a name="l2168"><span class="linenum">2168</span></a>          if (!<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l2169"><span class="linenum">2169</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:templatemanage',
<a name="l2170"><span class="linenum">2170</span></a>                  'nopermissions', '');
<a name="l2171"><span class="linenum">2171</span></a>          }
<a name="l2172"><span class="linenum">2172</span></a>  
<a name="l2173"><span class="linenum">2173</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a> = new stdClass();
<a name="l2174"><span class="linenum">2174</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('templateid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/templateid.html">templateid</a> = <a class="var it7511" onMouseOver="hilite(7511)" onMouseOut="lolite()" onClick="logVariable('templateid')" href="../../_variables/templateid.html">$templateid</a>;
<a name="l2175"><span class="linenum">2175</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('competencyid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/competencyid.html">competencyid</a> = <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>;
<a name="l2176"><span class="linenum">2176</span></a>  
<a name="l2177"><span class="linenum">2177</span></a>          <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l2178"><span class="linenum">2178</span></a>  
<a name="l2179"><span class="linenum">2179</span></a>          <a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a> = <a class="class" onClick="logClass('template_competency')" href="../../_classes/template_competency.html" onMouseOver="classPopup(event,'template_competency')">template_competency</a>::<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(array('templateid' =&gt; <a class="var it7511" onMouseOver="hilite(7511)" onMouseOut="lolite()" onClick="logVariable('templateid')" href="../../_variables/templateid.html">$templateid</a>, 'competencyid' =&gt; <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>));
<a name="l2180"><span class="linenum">2180</span></a>          if (<a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a>) {
<a name="l2181"><span class="linenum">2181</span></a>              <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a> = <a class="phpfunction" onClick="logFunction('array_pop')" href="../../_functions/array_pop.html" onMouseOver="phpfuncPopup(event,'array_pop')">array_pop</a>(<a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a>);
<a name="l2182"><span class="linenum">2182</span></a>              return <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l2183"><span class="linenum">2183</span></a>          }
<a name="l2184"><span class="linenum">2184</span></a>          return false;
<a name="l2185"><span class="linenum">2185</span></a>      }
<a name="l2186"><span class="linenum">2186</span></a>  
<a name="l2187"><span class="linenum">2187</span></a>      <span class="comment">/**</span>
<a name="l2188"><span class="linenum">2188</span></a>  <span class="comment">     * Move the template competency up or down in the display list.</span>
<a name="l2189"><span class="linenum">2189</span></a>  <span class="comment">     *</span>
<a name="l2190"><span class="linenum">2190</span></a>  <span class="comment">     * Requires moodle/competency:templatemanage capability at the system context.</span>
<a name="l2191"><span class="linenum">2191</span></a>  <span class="comment">     *</span>
<a name="l2192"><span class="linenum">2192</span></a>  <span class="comment">     * @param int $templateid The template id</span>
<a name="l2193"><span class="linenum">2193</span></a>  <span class="comment">     * @param int $competencyidfrom The id of the competency we are moving.</span>
<a name="l2194"><span class="linenum">2194</span></a>  <span class="comment">     * @param int $competencyidto The id of the competency we are moving to.</span>
<a name="l2195"><span class="linenum">2195</span></a>  <span class="comment">     * @return boolean</span>
<a name="l2196"><span class="linenum">2196</span></a>  <span class="comment">     */</span>
<a name="l2197"><span class="linenum">2197</span></a>      public static function <a class="function" onClick="logFunction('reorder_template_competency')" href="../../_functions/reorder_template_competency.html" onMouseOver="funcPopup(event,'reorder_template_competency')">reorder_template_competency</a>(<a class="var it7511" onMouseOver="hilite(7511)" onMouseOut="lolite()" onClick="logVariable('templateid')" href="../../_variables/templateid.html">$templateid</a>, <a class="var it30448" onMouseOver="hilite(30448)" onMouseOut="lolite()" onClick="logVariable('competencyidfrom')" href="../../_variables/competencyidfrom.html">$competencyidfrom</a>, <a class="var it30449" onMouseOver="hilite(30449)" onMouseOut="lolite()" onClick="logVariable('competencyidto')" href="../../_variables/competencyidto.html">$competencyidto</a>) {
<a name="l2198"><span class="linenum">2198</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2199"><span class="linenum">2199</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l2200"><span class="linenum">2200</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l2201"><span class="linenum">2201</span></a>  
<a name="l2202"><span class="linenum">2202</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:templatemanage', <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>);
<a name="l2203"><span class="linenum">2203</span></a>  
<a name="l2204"><span class="linenum">2204</span></a>          <a class="var it11446" onMouseOver="hilite(11446)" onMouseOut="lolite()" onClick="logVariable('down')" href="../../_variables/down.html">$down</a> = true;
<a name="l2205"><span class="linenum">2205</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = <a class="class" onClick="logClass('template_competency')" href="../../_classes/template_competency.html" onMouseOver="classPopup(event,'template_competency')">template_competency</a>::<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(array('templateid' =&gt; <a class="var it7511" onMouseOver="hilite(7511)" onMouseOut="lolite()" onClick="logVariable('templateid')" href="../../_variables/templateid.html">$templateid</a>, 'competencyid' =&gt; <a class="var it30448" onMouseOver="hilite(30448)" onMouseOut="lolite()" onClick="logVariable('competencyidfrom')" href="../../_variables/competencyidfrom.html">$competencyidfrom</a>));
<a name="l2206"><span class="linenum">2206</span></a>          if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>) == 0) {
<a name="l2207"><span class="linenum">2207</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('The link does not exist');
<a name="l2208"><span class="linenum">2208</span></a>          }
<a name="l2209"><span class="linenum">2209</span></a>  
<a name="l2210"><span class="linenum">2210</span></a>          <a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a> = <a class="phpfunction" onClick="logFunction('array_pop')" href="../../_functions/array_pop.html" onMouseOver="phpfuncPopup(event,'array_pop')">array_pop</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>);
<a name="l2211"><span class="linenum">2211</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = <a class="class" onClick="logClass('template_competency')" href="../../_classes/template_competency.html" onMouseOver="classPopup(event,'template_competency')">template_competency</a>::<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(array('templateid' =&gt; <a class="var it7511" onMouseOver="hilite(7511)" onMouseOut="lolite()" onClick="logVariable('templateid')" href="../../_variables/templateid.html">$templateid</a>, 'competencyid' =&gt; <a class="var it30449" onMouseOver="hilite(30449)" onMouseOut="lolite()" onClick="logVariable('competencyidto')" href="../../_variables/competencyidto.html">$competencyidto</a>));
<a name="l2212"><span class="linenum">2212</span></a>          if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>) == 0) {
<a name="l2213"><span class="linenum">2213</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('The link does not exist');
<a name="l2214"><span class="linenum">2214</span></a>          }
<a name="l2215"><span class="linenum">2215</span></a>  
<a name="l2216"><span class="linenum">2216</span></a>          <a class="var it30451" onMouseOver="hilite(30451)" onMouseOut="lolite()" onClick="logVariable('competencyto')" href="../../_variables/competencyto.html">$competencyto</a> = <a class="phpfunction" onClick="logFunction('array_pop')" href="../../_functions/array_pop.html" onMouseOver="phpfuncPopup(event,'array_pop')">array_pop</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>);
<a name="l2217"><span class="linenum">2217</span></a>  
<a name="l2218"><span class="linenum">2218</span></a>          <a class="var it5375" onMouseOver="hilite(5375)" onMouseOut="lolite()" onClick="logVariable('all')" href="../../_variables/all.html">$all</a> = <a class="class" onClick="logClass('template_competency')" href="../../_classes/template_competency.html" onMouseOver="classPopup(event,'template_competency')">template_competency</a>::<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(array('templateid' =&gt; <a class="var it7511" onMouseOver="hilite(7511)" onMouseOut="lolite()" onClick="logVariable('templateid')" href="../../_variables/templateid.html">$templateid</a>), 'sortorder', 'ASC', 0, 0);
<a name="l2219"><span class="linenum">2219</span></a>  
<a name="l2220"><span class="linenum">2220</span></a>          if (<a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>() &gt; <a class="var it30451" onMouseOver="hilite(30451)" onMouseOut="lolite()" onClick="logVariable('competencyto')" href="../../_variables/competencyto.html">$competencyto</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>()) {
<a name="l2221"><span class="linenum">2221</span></a>  <span class="comment">            // We are moving up, so put it before the &quot;to&quot; item.</span>
<a name="l2222"><span class="linenum">2222</span></a>              <a class="var it11446" onMouseOver="hilite(11446)" onMouseOut="lolite()" onClick="logVariable('down')" href="../../_variables/down.html">$down</a> = false;
<a name="l2223"><span class="linenum">2223</span></a>          }
<a name="l2224"><span class="linenum">2224</span></a>  
<a name="l2225"><span class="linenum">2225</span></a>          foreach (<a class="var it5375" onMouseOver="hilite(5375)" onMouseOut="lolite()" onClick="logVariable('all')" href="../../_variables/all.html">$all</a> as <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a> =&gt; <a class="var it30458" onMouseOver="hilite(30458)" onMouseOut="lolite()" onClick="logVariable('templatecompetency')" href="../../_variables/templatecompetency.html">$templatecompetency</a>) {
<a name="l2226"><span class="linenum">2226</span></a>              <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> = <a class="var it30458" onMouseOver="hilite(30458)" onMouseOut="lolite()" onClick="logVariable('templatecompetency')" href="../../_variables/templatecompetency.html">$templatecompetency</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>();
<a name="l2227"><span class="linenum">2227</span></a>              if (<a class="var it11446" onMouseOver="hilite(11446)" onMouseOut="lolite()" onClick="logVariable('down')" href="../../_variables/down.html">$down</a> &amp;&amp; <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> &gt; <a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>() &amp;&amp; <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> &lt;= <a class="var it30451" onMouseOver="hilite(30451)" onMouseOut="lolite()" onClick="logVariable('competencyto')" href="../../_variables/competencyto.html">$competencyto</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>()) {
<a name="l2228"><span class="linenum">2228</span></a>                  <a class="var it30458" onMouseOver="hilite(30458)" onMouseOut="lolite()" onClick="logVariable('templatecompetency')" href="../../_variables/templatecompetency.html">$templatecompetency</a>-&gt;<a class="function" onClick="logFunction('set_sortorder')" href="../../_functions/set_sortorder.html" onMouseOver="funcPopup(event,'set_sortorder')">set_sortorder</a>(<a class="var it30458" onMouseOver="hilite(30458)" onMouseOut="lolite()" onClick="logVariable('templatecompetency')" href="../../_variables/templatecompetency.html">$templatecompetency</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>() - 1);
<a name="l2229"><span class="linenum">2229</span></a>                  <a class="var it30458" onMouseOver="hilite(30458)" onMouseOut="lolite()" onClick="logVariable('templatecompetency')" href="../../_variables/templatecompetency.html">$templatecompetency</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l2230"><span class="linenum">2230</span></a>              } else if (!<a class="var it11446" onMouseOver="hilite(11446)" onMouseOut="lolite()" onClick="logVariable('down')" href="../../_variables/down.html">$down</a> &amp;&amp; <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> &gt;= <a class="var it30451" onMouseOver="hilite(30451)" onMouseOut="lolite()" onClick="logVariable('competencyto')" href="../../_variables/competencyto.html">$competencyto</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>() &amp;&amp; <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> &lt; <a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>()) {
<a name="l2231"><span class="linenum">2231</span></a>                  <a class="var it30458" onMouseOver="hilite(30458)" onMouseOut="lolite()" onClick="logVariable('templatecompetency')" href="../../_variables/templatecompetency.html">$templatecompetency</a>-&gt;<a class="function" onClick="logFunction('set_sortorder')" href="../../_functions/set_sortorder.html" onMouseOver="funcPopup(event,'set_sortorder')">set_sortorder</a>(<a class="var it30458" onMouseOver="hilite(30458)" onMouseOut="lolite()" onClick="logVariable('templatecompetency')" href="../../_variables/templatecompetency.html">$templatecompetency</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>() + 1);
<a name="l2232"><span class="linenum">2232</span></a>                  <a class="var it30458" onMouseOver="hilite(30458)" onMouseOut="lolite()" onClick="logVariable('templatecompetency')" href="../../_variables/templatecompetency.html">$templatecompetency</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l2233"><span class="linenum">2233</span></a>              }
<a name="l2234"><span class="linenum">2234</span></a>          }
<a name="l2235"><span class="linenum">2235</span></a>          <a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a>-&gt;<a class="function" onClick="logFunction('set_sortorder')" href="../../_functions/set_sortorder.html" onMouseOver="funcPopup(event,'set_sortorder')">set_sortorder</a>(<a class="var it30451" onMouseOver="hilite(30451)" onMouseOut="lolite()" onClick="logVariable('competencyto')" href="../../_variables/competencyto.html">$competencyto</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>());
<a name="l2236"><span class="linenum">2236</span></a>          return <a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l2237"><span class="linenum">2237</span></a>      }
<a name="l2238"><span class="linenum">2238</span></a>  
<a name="l2239"><span class="linenum">2239</span></a>      <span class="comment">/**</span>
<a name="l2240"><span class="linenum">2240</span></a>  <span class="comment">     * Create a relation between a template and a cohort.</span>
<a name="l2241"><span class="linenum">2241</span></a>  <span class="comment">     *</span>
<a name="l2242"><span class="linenum">2242</span></a>  <span class="comment">     * This silently ignores when the relation already existed.</span>
<a name="l2243"><span class="linenum">2243</span></a>  <span class="comment">     *</span>
<a name="l2244"><span class="linenum">2244</span></a>  <span class="comment">     * @param  template|int $templateorid The template or its ID.</span>
<a name="l2245"><span class="linenum">2245</span></a>  <span class="comment">     * @param  stdClass|int $cohortorid   The cohort ot its ID.</span>
<a name="l2246"><span class="linenum">2246</span></a>  <span class="comment">     * @return template_cohort</span>
<a name="l2247"><span class="linenum">2247</span></a>  <span class="comment">     */</span>
<a name="l2248"><span class="linenum">2248</span></a>      public static function <a class="function" onClick="logFunction('create_template_cohort')" href="../../_functions/create_template_cohort.html" onMouseOver="funcPopup(event,'create_template_cohort')">create_template_cohort</a>(<a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>, <a class="var it7774" onMouseOver="hilite(7774)" onMouseOut="lolite()" onClick="logVariable('cohortorid')" href="../../_variables/cohortorid.html">$cohortorid</a>) {
<a name="l2249"><span class="linenum">2249</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2250"><span class="linenum">2250</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2251"><span class="linenum">2251</span></a>  
<a name="l2252"><span class="linenum">2252</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>;
<a name="l2253"><span class="linenum">2253</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>)) {
<a name="l2254"><span class="linenum">2254</span></a>              <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>);
<a name="l2255"><span class="linenum">2255</span></a>          }
<a name="l2256"><span class="linenum">2256</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:templatemanage', <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>());
<a name="l2257"><span class="linenum">2257</span></a>  
<a name="l2258"><span class="linenum">2258</span></a>          <a class="var it7758" onMouseOver="hilite(7758)" onMouseOut="lolite()" onClick="logVariable('cohort')" href="../../_variables/cohort.html">$cohort</a> = <a class="var it7774" onMouseOver="hilite(7774)" onMouseOut="lolite()" onClick="logVariable('cohortorid')" href="../../_variables/cohortorid.html">$cohortorid</a>;
<a name="l2259"><span class="linenum">2259</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it7758" onMouseOver="hilite(7758)" onMouseOut="lolite()" onClick="logVariable('cohort')" href="../../_variables/cohort.html">$cohort</a>)) {
<a name="l2260"><span class="linenum">2260</span></a>              <a class="var it7758" onMouseOver="hilite(7758)" onMouseOut="lolite()" onClick="logVariable('cohort')" href="../../_variables/cohort.html">$cohort</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('cohort', array('id' =&gt; <a class="var it7758" onMouseOver="hilite(7758)" onMouseOut="lolite()" onClick="logVariable('cohort')" href="../../_variables/cohort.html">$cohort</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l2261"><span class="linenum">2261</span></a>          }
<a name="l2262"><span class="linenum">2262</span></a>  
<a name="l2263"><span class="linenum">2263</span></a>  <span class="comment">        // Replicate logic in cohort_can_view_cohort() because we can't use it directly as we don't have a course context.</span>
<a name="l2264"><span class="linenum">2264</span></a>          <a class="var it7775" onMouseOver="hilite(7775)" onMouseOut="lolite()" onClick="logVariable('cohortcontext')" href="../../_variables/cohortcontext.html">$cohortcontext</a> = context::<a class="function" onClick="logFunction('instance_by_id')" href="../../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>(<a class="var it7758" onMouseOver="hilite(7758)" onMouseOut="lolite()" onClick="logVariable('cohort')" href="../../_variables/cohort.html">$cohort</a>-&gt;<a onClick="logVariable('contextid')" class="var it43123" onMouseOver="hilite(43123)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>);
<a name="l2265"><span class="linenum">2265</span></a>          if (!<a class="var it7758" onMouseOver="hilite(7758)" onMouseOut="lolite()" onClick="logVariable('cohort')" href="../../_variables/cohort.html">$cohort</a>-&gt;<a onClick="logVariable('visible')" class="var it43123" onMouseOver="hilite(43123)" onMouseOut="lolite()" href="../../_variables/visible.html">visible</a> &amp;&amp; !<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/cohort:view', <a class="var it7775" onMouseOver="hilite(7775)" onMouseOut="lolite()" onClick="logVariable('cohortcontext')" href="../../_variables/cohortcontext.html">$cohortcontext</a>)) {
<a name="l2266"><span class="linenum">2266</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it7775" onMouseOver="hilite(7775)" onMouseOut="lolite()" onClick="logVariable('cohortcontext')" href="../../_variables/cohortcontext.html">$cohortcontext</a>, 'moodle/cohort:view', 'nopermissions', '');
<a name="l2267"><span class="linenum">2267</span></a>          }
<a name="l2268"><span class="linenum">2268</span></a>  
<a name="l2269"><span class="linenum">2269</span></a>          <a class="var it10075" onMouseOver="hilite(10075)" onMouseOut="lolite()" onClick="logVariable('tplcohort')" href="../../_variables/tplcohort.html">$tplcohort</a> = <a class="class" onClick="logClass('template_cohort')" href="../../_classes/template_cohort.html" onMouseOver="classPopup(event,'template_cohort')">template_cohort</a>::<a class="function" onClick="logFunction('get_relation')" href="../../_functions/get_relation.html" onMouseOver="funcPopup(event,'get_relation')">get_relation</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(), <a class="var it7758" onMouseOver="hilite(7758)" onMouseOut="lolite()" onClick="logVariable('cohort')" href="../../_variables/cohort.html">$cohort</a>-&gt;<a onClick="logVariable('id')" class="var it43123" onMouseOver="hilite(43123)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l2270"><span class="linenum">2270</span></a>          if (!<a class="var it10075" onMouseOver="hilite(10075)" onMouseOut="lolite()" onClick="logVariable('tplcohort')" href="../../_variables/tplcohort.html">$tplcohort</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>()) {
<a name="l2271"><span class="linenum">2271</span></a>              <a class="var it10075" onMouseOver="hilite(10075)" onMouseOut="lolite()" onClick="logVariable('tplcohort')" href="../../_variables/tplcohort.html">$tplcohort</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l2272"><span class="linenum">2272</span></a>          }
<a name="l2273"><span class="linenum">2273</span></a>  
<a name="l2274"><span class="linenum">2274</span></a>          return <a class="var it10075" onMouseOver="hilite(10075)" onMouseOut="lolite()" onClick="logVariable('tplcohort')" href="../../_variables/tplcohort.html">$tplcohort</a>;
<a name="l2275"><span class="linenum">2275</span></a>      }
<a name="l2276"><span class="linenum">2276</span></a>  
<a name="l2277"><span class="linenum">2277</span></a>      <span class="comment">/**</span>
<a name="l2278"><span class="linenum">2278</span></a>  <span class="comment">     * Remove a relation between a template and a cohort.</span>
<a name="l2279"><span class="linenum">2279</span></a>  <span class="comment">     *</span>
<a name="l2280"><span class="linenum">2280</span></a>  <span class="comment">     * @param  template|int $templateorid The template or its ID.</span>
<a name="l2281"><span class="linenum">2281</span></a>  <span class="comment">     * @param  stdClass|int $cohortorid   The cohort ot its ID.</span>
<a name="l2282"><span class="linenum">2282</span></a>  <span class="comment">     * @return boolean True on success or when the relation did not exist.</span>
<a name="l2283"><span class="linenum">2283</span></a>  <span class="comment">     */</span>
<a name="l2284"><span class="linenum">2284</span></a>      public static function <a class="function" onClick="logFunction('delete_template_cohort')" href="../../_functions/delete_template_cohort.html" onMouseOver="funcPopup(event,'delete_template_cohort')">delete_template_cohort</a>(<a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>, <a class="var it7774" onMouseOver="hilite(7774)" onMouseOut="lolite()" onClick="logVariable('cohortorid')" href="../../_variables/cohortorid.html">$cohortorid</a>) {
<a name="l2285"><span class="linenum">2285</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2286"><span class="linenum">2286</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2287"><span class="linenum">2287</span></a>  
<a name="l2288"><span class="linenum">2288</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>;
<a name="l2289"><span class="linenum">2289</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>)) {
<a name="l2290"><span class="linenum">2290</span></a>              <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>);
<a name="l2291"><span class="linenum">2291</span></a>          }
<a name="l2292"><span class="linenum">2292</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:templatemanage', <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>());
<a name="l2293"><span class="linenum">2293</span></a>  
<a name="l2294"><span class="linenum">2294</span></a>          <a class="var it7758" onMouseOver="hilite(7758)" onMouseOut="lolite()" onClick="logVariable('cohort')" href="../../_variables/cohort.html">$cohort</a> = <a class="var it7774" onMouseOver="hilite(7774)" onMouseOut="lolite()" onClick="logVariable('cohortorid')" href="../../_variables/cohortorid.html">$cohortorid</a>;
<a name="l2295"><span class="linenum">2295</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it7758" onMouseOver="hilite(7758)" onMouseOut="lolite()" onClick="logVariable('cohort')" href="../../_variables/cohort.html">$cohort</a>)) {
<a name="l2296"><span class="linenum">2296</span></a>              <a class="var it7758" onMouseOver="hilite(7758)" onMouseOut="lolite()" onClick="logVariable('cohort')" href="../../_variables/cohort.html">$cohort</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('cohort', array('id' =&gt; <a class="var it7758" onMouseOver="hilite(7758)" onMouseOut="lolite()" onClick="logVariable('cohort')" href="../../_variables/cohort.html">$cohort</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l2297"><span class="linenum">2297</span></a>          }
<a name="l2298"><span class="linenum">2298</span></a>  
<a name="l2299"><span class="linenum">2299</span></a>          <a class="var it10075" onMouseOver="hilite(10075)" onMouseOut="lolite()" onClick="logVariable('tplcohort')" href="../../_variables/tplcohort.html">$tplcohort</a> = <a class="class" onClick="logClass('template_cohort')" href="../../_classes/template_cohort.html" onMouseOver="classPopup(event,'template_cohort')">template_cohort</a>::<a class="function" onClick="logFunction('get_relation')" href="../../_functions/get_relation.html" onMouseOver="funcPopup(event,'get_relation')">get_relation</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(), <a class="var it7758" onMouseOver="hilite(7758)" onMouseOut="lolite()" onClick="logVariable('cohort')" href="../../_variables/cohort.html">$cohort</a>-&gt;<a onClick="logVariable('id')" class="var it43123" onMouseOver="hilite(43123)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l2300"><span class="linenum">2300</span></a>          if (!<a class="var it10075" onMouseOver="hilite(10075)" onMouseOut="lolite()" onClick="logVariable('tplcohort')" href="../../_variables/tplcohort.html">$tplcohort</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>()) {
<a name="l2301"><span class="linenum">2301</span></a>              return true;
<a name="l2302"><span class="linenum">2302</span></a>          }
<a name="l2303"><span class="linenum">2303</span></a>  
<a name="l2304"><span class="linenum">2304</span></a>          return <a class="var it10075" onMouseOver="hilite(10075)" onMouseOut="lolite()" onClick="logVariable('tplcohort')" href="../../_variables/tplcohort.html">$tplcohort</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l2305"><span class="linenum">2305</span></a>      }
<a name="l2306"><span class="linenum">2306</span></a>  
<a name="l2307"><span class="linenum">2307</span></a>      <span class="comment">/**</span>
<a name="l2308"><span class="linenum">2308</span></a>  <span class="comment">     * Lists user plans.</span>
<a name="l2309"><span class="linenum">2309</span></a>  <span class="comment">     *</span>
<a name="l2310"><span class="linenum">2310</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l2311"><span class="linenum">2311</span></a>  <span class="comment">     * @return \core_competency\plan[]</span>
<a name="l2312"><span class="linenum">2312</span></a>  <span class="comment">     */</span>
<a name="l2313"><span class="linenum">2313</span></a>      public static function <a class="function" onClick="logFunction('list_user_plans')" href="../../_functions/list_user_plans.html" onMouseOver="funcPopup(event,'list_user_plans')">list_user_plans</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) {
<a name="l2314"><span class="linenum">2314</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l2315"><span class="linenum">2315</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2316"><span class="linenum">2316</span></a>          <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> = 'userid = :userid';
<a name="l2317"><span class="linenum">2317</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>);
<a name="l2318"><span class="linenum">2318</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_user')" href="../../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>);
<a name="l2319"><span class="linenum">2319</span></a>  
<a name="l2320"><span class="linenum">2320</span></a>  <span class="comment">        // Check that we can read something here.</span>
<a name="l2321"><span class="linenum">2321</span></a>          if (!<a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::<a class="function" onClick="logFunction('can_read_user')" href="../../_functions/can_read_user.html" onMouseOver="funcPopup(event,'can_read_user')">can_read_user</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) &amp;&amp; !<a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::<a class="function" onClick="logFunction('can_read_user_draft')" href="../../_functions/can_read_user_draft.html" onMouseOver="funcPopup(event,'can_read_user_draft')">can_read_user_draft</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>)) {
<a name="l2322"><span class="linenum">2322</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:planview', 'nopermissions', '');
<a name="l2323"><span class="linenum">2323</span></a>          }
<a name="l2324"><span class="linenum">2324</span></a>  
<a name="l2325"><span class="linenum">2325</span></a>  <span class="comment">        // The user cannot view the drafts.</span>
<a name="l2326"><span class="linenum">2326</span></a>          if (!<a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::<a class="function" onClick="logFunction('can_read_user_draft')" href="../../_functions/can_read_user_draft.html" onMouseOver="funcPopup(event,'can_read_user_draft')">can_read_user_draft</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>)) {
<a name="l2327"><span class="linenum">2327</span></a>              <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it1041" onMouseOver="hilite(1041)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../../_variables/insql.html">$insql</a>, <a class="var it4859" onMouseOver="hilite(4859)" onMouseOut="lolite()" onClick="logVariable('inparams')" href="../../_variables/inparams.html">$inparams</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::<a class="function" onClick="logFunction('get_draft_statuses')" href="../../_functions/get_draft_statuses.html" onMouseOver="funcPopup(event,'get_draft_statuses')">get_draft_statuses</a>(), <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'param', false);
<a name="l2328"><span class="linenum">2328</span></a>              <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> .= &quot; AND status <a class="var it1041" onMouseOver="hilite(1041)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../../_variables/insql.html">$insql</a>&quot;;
<a name="l2329"><span class="linenum">2329</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> += <a class="var it4859" onMouseOver="hilite(4859)" onMouseOut="lolite()" onClick="logVariable('inparams')" href="../../_variables/inparams.html">$inparams</a>;
<a name="l2330"><span class="linenum">2330</span></a>          }
<a name="l2331"><span class="linenum">2331</span></a>  <span class="comment">        // The user cannot view the non-drafts.</span>
<a name="l2332"><span class="linenum">2332</span></a>          if (!<a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::<a class="function" onClick="logFunction('can_read_user')" href="../../_functions/can_read_user.html" onMouseOver="funcPopup(event,'can_read_user')">can_read_user</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>)) {
<a name="l2333"><span class="linenum">2333</span></a>              <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it1041" onMouseOver="hilite(1041)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../../_variables/insql.html">$insql</a>, <a class="var it4859" onMouseOver="hilite(4859)" onMouseOut="lolite()" onClick="logVariable('inparams')" href="../../_variables/inparams.html">$inparams</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(array(<a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_ACTIVE, <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_COMPLETE),
<a name="l2334"><span class="linenum">2334</span></a>                  <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>, 'param', false);
<a name="l2335"><span class="linenum">2335</span></a>              <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> .= &quot; AND status <a class="var it1041" onMouseOver="hilite(1041)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../../_variables/insql.html">$insql</a>&quot;;
<a name="l2336"><span class="linenum">2336</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> += <a class="var it4859" onMouseOver="hilite(4859)" onMouseOut="lolite()" onClick="logVariable('inparams')" href="../../_variables/inparams.html">$inparams</a>;
<a name="l2337"><span class="linenum">2337</span></a>          }
<a name="l2338"><span class="linenum">2338</span></a>  
<a name="l2339"><span class="linenum">2339</span></a>          return <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::<a class="function" onClick="logFunction('get_records_select')" href="../../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>(<a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, 'name ASC');
<a name="l2340"><span class="linenum">2340</span></a>      }
<a name="l2341"><span class="linenum">2341</span></a>  
<a name="l2342"><span class="linenum">2342</span></a>      <span class="comment">/**</span>
<a name="l2343"><span class="linenum">2343</span></a>  <span class="comment">     * List the plans to review.</span>
<a name="l2344"><span class="linenum">2344</span></a>  <span class="comment">     *</span>
<a name="l2345"><span class="linenum">2345</span></a>  <span class="comment">     * The method returns values in this format:</span>
<a name="l2346"><span class="linenum">2346</span></a>  <span class="comment">     *</span>
<a name="l2347"><span class="linenum">2347</span></a>  <span class="comment">     * array(</span>
<a name="l2348"><span class="linenum">2348</span></a>  <span class="comment">     *     'plans' =&gt; array(</span>
<a name="l2349"><span class="linenum">2349</span></a>  <span class="comment">     *         (stdClass)(</span>
<a name="l2350"><span class="linenum">2350</span></a>  <span class="comment">     *             'plan' =&gt; (plan),</span>
<a name="l2351"><span class="linenum">2351</span></a>  <span class="comment">     *             'template' =&gt; (template),</span>
<a name="l2352"><span class="linenum">2352</span></a>  <span class="comment">     *             'owner' =&gt; (stdClass)</span>
<a name="l2353"><span class="linenum">2353</span></a>  <span class="comment">     *         )</span>
<a name="l2354"><span class="linenum">2354</span></a>  <span class="comment">     *     ),</span>
<a name="l2355"><span class="linenum">2355</span></a>  <span class="comment">     *     'count' =&gt; (int)</span>
<a name="l2356"><span class="linenum">2356</span></a>  <span class="comment">     * )</span>
<a name="l2357"><span class="linenum">2357</span></a>  <span class="comment">     *</span>
<a name="l2358"><span class="linenum">2358</span></a>  <span class="comment">     * @param int $skip The number of records to skip.</span>
<a name="l2359"><span class="linenum">2359</span></a>  <span class="comment">     * @param int $limit The number of results to return.</span>
<a name="l2360"><span class="linenum">2360</span></a>  <span class="comment">     * @param int $userid The user we're getting the plans to review for.</span>
<a name="l2361"><span class="linenum">2361</span></a>  <span class="comment">     * @return array Containing the keys 'count', and 'plans'. The 'plans' key contains an object</span>
<a name="l2362"><span class="linenum">2362</span></a>  <span class="comment">     *               which contains 'plan', 'template' and 'owner'.</span>
<a name="l2363"><span class="linenum">2363</span></a>  <span class="comment">     */</span>
<a name="l2364"><span class="linenum">2364</span></a>      public static function <a class="function" onClick="logFunction('list_plans_to_review')" href="../../_functions/list_plans_to_review.html" onMouseOver="funcPopup(event,'list_plans_to_review')">list_plans_to_review</a>(<a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('skip')" href="../../_variables/skip.html">$skip</a> = 0, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a> = 100, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> = null) {
<a name="l2365"><span class="linenum">2365</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l2366"><span class="linenum">2366</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2367"><span class="linenum">2367</span></a>  
<a name="l2368"><span class="linenum">2368</span></a>          if (<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> === null) {
<a name="l2369"><span class="linenum">2369</span></a>              <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l2370"><span class="linenum">2370</span></a>          }
<a name="l2371"><span class="linenum">2371</span></a>  
<a name="l2372"><span class="linenum">2372</span></a>          <a class="var it30459" onMouseOver="hilite(30459)" onMouseOut="lolite()" onClick="logVariable('planfields')" href="../../_variables/planfields.html">$planfields</a> = <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::<a class="function" onClick="logFunction('get_sql_fields')" href="../../_functions/get_sql_fields.html" onMouseOver="funcPopup(event,'get_sql_fields')">get_sql_fields</a>('p', 'plan_');
<a name="l2373"><span class="linenum">2373</span></a>          <a class="var it30460" onMouseOver="hilite(30460)" onMouseOut="lolite()" onClick="logVariable('tplfields')" href="../../_variables/tplfields.html">$tplfields</a> = <a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>::<a class="function" onClick="logFunction('get_sql_fields')" href="../../_functions/get_sql_fields.html" onMouseOver="funcPopup(event,'get_sql_fields')">get_sql_fields</a>('t', 'tpl_');
<a name="l2374"><span class="linenum">2374</span></a>          <a class="var it30445" onMouseOver="hilite(30445)" onMouseOut="lolite()" onClick="logVariable('usercols')" href="../../_variables/usercols.html">$usercols</a> = array('id') + <a class="function" onClick="logFunction('get_user_fieldnames')" href="../../_functions/get_user_fieldnames.html" onMouseOver="funcPopup(event,'get_user_fieldnames')">get_user_fieldnames</a>();
<a name="l2375"><span class="linenum">2375</span></a>          <a class="var it4004" onMouseOver="hilite(4004)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a> = array();
<a name="l2376"><span class="linenum">2376</span></a>          foreach (<a class="var it30445" onMouseOver="hilite(30445)" onMouseOut="lolite()" onClick="logVariable('usercols')" href="../../_variables/usercols.html">$usercols</a> as <a class="var it59" onMouseOver="hilite(59)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>) {
<a name="l2377"><span class="linenum">2377</span></a>              <a class="var it4004" onMouseOver="hilite(4004)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a>[] = &quot;u.&quot; . <a class="var it59" onMouseOver="hilite(59)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a> . &quot; AS usr_&quot; . <a class="var it59" onMouseOver="hilite(59)" onMouseOut="lolite()" onClick="logVariable('field')" href="../../_variables/field.html">$field</a>;
<a name="l2378"><span class="linenum">2378</span></a>          }
<a name="l2379"><span class="linenum">2379</span></a>          <a class="var it4004" onMouseOver="hilite(4004)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',', <a class="var it4004" onMouseOver="hilite(4004)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a>);
<a name="l2380"><span class="linenum">2380</span></a>  
<a name="l2381"><span class="linenum">2381</span></a>          <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> = &quot;SELECT <a class="var it30459" onMouseOver="hilite(30459)" onMouseOut="lolite()" onClick="logVariable('planfields')" href="../../_variables/planfields.html">$planfields</a>, <a class="var it30460" onMouseOver="hilite(30460)" onMouseOut="lolite()" onClick="logVariable('tplfields')" href="../../_variables/tplfields.html">$tplfields</a>, <a class="var it4004" onMouseOver="hilite(4004)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a>&quot;;
<a name="l2382"><span class="linenum">2382</span></a>          <a class="var it30446" onMouseOver="hilite(30446)" onMouseOut="lolite()" onClick="logVariable('countselect')" href="../../_variables/countselect.html">$countselect</a> = &quot;SELECT <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>('x')&quot;;
<a name="l2383"><span class="linenum">2383</span></a>  
<a name="l2384"><span class="linenum">2384</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = &quot;  FROM {&quot; . <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::TABLE . &quot;} p
<a name="l2385"><span class="linenum">2385</span></a>                    JOIN {user} u
<a name="l2386"><span class="linenum">2386</span></a>                      ON u.id = p.userid
<a name="l2387"><span class="linenum">2387</span></a>               LEFT JOIN {&quot; . <a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>::TABLE . &quot;} t
<a name="l2388"><span class="linenum">2388</span></a>                      ON t.id = p.templateid
<a name="l2389"><span class="linenum">2389</span></a>                   <a class="function" onClick="logFunction('WHERE')" href="../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a> (p.status = :waitingforreview
<a name="l2390"><span class="linenum">2390</span></a>                      <a class="function" onClick="logFunction('OR')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">OR</a> (p.status = :inreview AND p.reviewerid = :reviewerid))
<a name="l2391"><span class="linenum">2391</span></a>                     AND p.userid != :userid&quot;;
<a name="l2392"><span class="linenum">2392</span></a>  
<a name="l2393"><span class="linenum">2393</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(
<a name="l2394"><span class="linenum">2394</span></a>              'waitingforreview' =&gt; <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_WAITING_FOR_REVIEW,
<a name="l2395"><span class="linenum">2395</span></a>              'inreview' =&gt; <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_IN_REVIEW,
<a name="l2396"><span class="linenum">2396</span></a>              'reviewerid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>,
<a name="l2397"><span class="linenum">2397</span></a>              'userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>
<a name="l2398"><span class="linenum">2398</span></a>          );
<a name="l2399"><span class="linenum">2399</span></a>  
<a name="l2400"><span class="linenum">2400</span></a>  <span class="comment">        // Primary check to avoid the hard work of getting the users in which the user has permission.</span>
<a name="l2401"><span class="linenum">2401</span></a>          <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records_sql')" href="../../_functions/count_records_sql.html" onMouseOver="funcPopup(event,'count_records_sql')">count_records_sql</a>(<a class="var it30446" onMouseOver="hilite(30446)" onMouseOut="lolite()" onClick="logVariable('countselect')" href="../../_variables/countselect.html">$countselect</a> . <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l2402"><span class="linenum">2402</span></a>          if (<a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('count')" href="../../_variables/count.html">$count</a> &lt; 1) {
<a name="l2403"><span class="linenum">2403</span></a>              return array('count' =&gt; 0, 'plans' =&gt; array());
<a name="l2404"><span class="linenum">2404</span></a>          }
<a name="l2405"><span class="linenum">2405</span></a>  
<a name="l2406"><span class="linenum">2406</span></a>  <span class="comment">        // TODO MDL-52243 Use core function.</span>
<a name="l2407"><span class="linenum">2407</span></a>          <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it1041" onMouseOver="hilite(1041)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../../_variables/insql.html">$insql</a>, <a class="var it4859" onMouseOver="hilite(4859)" onMouseOut="lolite()" onClick="logVariable('inparams')" href="../../_variables/inparams.html">$inparams</a>) = self::<a class="function" onClick="logFunction('filter_users_with_capability_on_user_context_sql')" href="../../_functions/filter_users_with_capability_on_user_context_sql.html" onMouseOver="funcPopup(event,'filter_users_with_capability_on_user_context_sql')">filter_users_with_capability_on_user_context_sql</a>('moodle/competency:planreview',
<a name="l2408"><span class="linenum">2408</span></a>              <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>);
<a name="l2409"><span class="linenum">2409</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> .= &quot; AND p.userid <a class="var it1041" onMouseOver="hilite(1041)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../../_variables/insql.html">$insql</a>&quot;;
<a name="l2410"><span class="linenum">2410</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> += <a class="var it4859" onMouseOver="hilite(4859)" onMouseOut="lolite()" onClick="logVariable('inparams')" href="../../_variables/inparams.html">$inparams</a>;
<a name="l2411"><span class="linenum">2411</span></a>  
<a name="l2412"><span class="linenum">2412</span></a>  <span class="comment">        // Order by ID just to have some ordering in place.</span>
<a name="l2413"><span class="linenum">2413</span></a>          <a class="var it12570" onMouseOver="hilite(12570)" onMouseOut="lolite()" onClick="logVariable('ordersql')" href="../../_variables/ordersql.html">$ordersql</a> = &quot; ORDER BY p.id ASC&quot;;
<a name="l2414"><span class="linenum">2414</span></a>  
<a name="l2415"><span class="linenum">2415</span></a>          <a class="var it4622" onMouseOver="hilite(4622)" onMouseOut="lolite()" onClick="logVariable('plans')" href="../../_variables/plans.html">$plans</a> = array();
<a name="l2416"><span class="linenum">2416</span></a>          <a class="var it988" onMouseOver="hilite(988)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../_variables/records.html">$records</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> . <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> . <a class="var it12570" onMouseOver="hilite(12570)" onMouseOut="lolite()" onClick="logVariable('ordersql')" href="../../_variables/ordersql.html">$ordersql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, <a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('skip')" href="../../_variables/skip.html">$skip</a>, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a>);
<a name="l2417"><span class="linenum">2417</span></a>          foreach (<a class="var it988" onMouseOver="hilite(988)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../_variables/records.html">$records</a> as <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>) {
<a name="l2418"><span class="linenum">2418</span></a>              <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(0, <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::<a class="function" onClick="logFunction('extract_record')" href="../../_functions/extract_record.html" onMouseOver="funcPopup(event,'extract_record')">extract_record</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>, 'plan_'));
<a name="l2419"><span class="linenum">2419</span></a>              <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = null;
<a name="l2420"><span class="linenum">2420</span></a>  
<a name="l2421"><span class="linenum">2421</span></a>              if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('is_based_on_template')" href="../../_functions/is_based_on_template.html" onMouseOver="funcPopup(event,'is_based_on_template')">is_based_on_template</a>()) {
<a name="l2422"><span class="linenum">2422</span></a>                  <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>(0, <a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>::<a class="function" onClick="logFunction('extract_record')" href="../../_functions/extract_record.html" onMouseOver="funcPopup(event,'extract_record')">extract_record</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>, 'tpl_'));
<a name="l2423"><span class="linenum">2423</span></a>              }
<a name="l2424"><span class="linenum">2424</span></a>  
<a name="l2425"><span class="linenum">2425</span></a>              <a class="var it4622" onMouseOver="hilite(4622)" onMouseOut="lolite()" onClick="logVariable('plans')" href="../../_variables/plans.html">$plans</a>[] = (object) array(
<a name="l2426"><span class="linenum">2426</span></a>                  'plan' =&gt; <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>,
<a name="l2427"><span class="linenum">2427</span></a>                  'template' =&gt; <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>,
<a name="l2428"><span class="linenum">2428</span></a>                  'owner' =&gt; persistent::<a class="function" onClick="logFunction('extract_record')" href="../../_functions/extract_record.html" onMouseOver="funcPopup(event,'extract_record')">extract_record</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>, 'usr_'),
<a name="l2429"><span class="linenum">2429</span></a>              );
<a name="l2430"><span class="linenum">2430</span></a>          }
<a name="l2431"><span class="linenum">2431</span></a>          <a class="var it988" onMouseOver="hilite(988)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../_variables/records.html">$records</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l2432"><span class="linenum">2432</span></a>  
<a name="l2433"><span class="linenum">2433</span></a>          return array(
<a name="l2434"><span class="linenum">2434</span></a>              'count' =&gt; <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('count_records_sql')" href="../../_functions/count_records_sql.html" onMouseOver="funcPopup(event,'count_records_sql')">count_records_sql</a>(<a class="var it30446" onMouseOver="hilite(30446)" onMouseOut="lolite()" onClick="logVariable('countselect')" href="../../_variables/countselect.html">$countselect</a> . <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>),
<a name="l2435"><span class="linenum">2435</span></a>              'plans' =&gt; <a class="var it4622" onMouseOver="hilite(4622)" onMouseOut="lolite()" onClick="logVariable('plans')" href="../../_variables/plans.html">$plans</a>
<a name="l2436"><span class="linenum">2436</span></a>          );
<a name="l2437"><span class="linenum">2437</span></a>      }
<a name="l2438"><span class="linenum">2438</span></a>  
<a name="l2439"><span class="linenum">2439</span></a>      <span class="comment">/**</span>
<a name="l2440"><span class="linenum">2440</span></a>  <span class="comment">     * Creates a learning plan based on the provided data.</span>
<a name="l2441"><span class="linenum">2441</span></a>  <span class="comment">     *</span>
<a name="l2442"><span class="linenum">2442</span></a>  <span class="comment">     * @param stdClass $record</span>
<a name="l2443"><span class="linenum">2443</span></a>  <span class="comment">     * @return \core_competency\plan</span>
<a name="l2444"><span class="linenum">2444</span></a>  <span class="comment">     */</span>
<a name="l2445"><span class="linenum">2445</span></a>      public static function <a class="function" onClick="logFunction('create_plan')" href="../../_functions/create_plan.html" onMouseOver="funcPopup(event,'create_plan')">create_plan</a>(stdClass <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>) {
<a name="l2446"><span class="linenum">2446</span></a>          global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l2447"><span class="linenum">2447</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2448"><span class="linenum">2448</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(0, <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>);
<a name="l2449"><span class="linenum">2449</span></a>  
<a name="l2450"><span class="linenum">2450</span></a>          if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('is_based_on_template')" href="../../_functions/is_based_on_template.html" onMouseOver="funcPopup(event,'is_based_on_template')">is_based_on_template</a>()) {
<a name="l2451"><span class="linenum">2451</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('To create a plan from a template use <a class="class" onClick="logClass('api')" href="../../_classes/api.html" onMouseOver="classPopup(event,'api')">api</a>::<a class="function" onClick="logFunction('create_plan_from_template')" href="../../_functions/create_plan_from_template.html" onMouseOver="funcPopup(event,'create_plan_from_template')">create_plan_from_template</a>().');
<a name="l2452"><span class="linenum">2452</span></a>          } else if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() == <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_COMPLETE) {
<a name="l2453"><span class="linenum">2453</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('A plan cannot be created as complete.');
<a name="l2454"><span class="linenum">2454</span></a>          }
<a name="l2455"><span class="linenum">2455</span></a>  
<a name="l2456"><span class="linenum">2456</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l2457"><span class="linenum">2457</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_user')" href="../../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>());
<a name="l2458"><span class="linenum">2458</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:planmanage', 'nopermissions', '');
<a name="l2459"><span class="linenum">2459</span></a>          }
<a name="l2460"><span class="linenum">2460</span></a>  
<a name="l2461"><span class="linenum">2461</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l2462"><span class="linenum">2462</span></a>  
<a name="l2463"><span class="linenum">2463</span></a>  <span class="comment">        // Trigger created event.</span>
<a name="l2464"><span class="linenum">2464</span></a>          \core\event\<a class="class" onClick="logClass('competency_plan_created')" href="../../_classes/competency_plan_created.html" onMouseOver="classPopup(event,'competency_plan_created')">competency_plan_created</a>::<a class="function" onClick="logFunction('create_from_plan')" href="../../_functions/create_from_plan.html" onMouseOver="funcPopup(event,'create_from_plan')">create_from_plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l2465"><span class="linenum">2465</span></a>          return <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>;
<a name="l2466"><span class="linenum">2466</span></a>      }
<a name="l2467"><span class="linenum">2467</span></a>  
<a name="l2468"><span class="linenum">2468</span></a>      <span class="comment">/**</span>
<a name="l2469"><span class="linenum">2469</span></a>  <span class="comment">     * Create a learning plan from a template.</span>
<a name="l2470"><span class="linenum">2470</span></a>  <span class="comment">     *</span>
<a name="l2471"><span class="linenum">2471</span></a>  <span class="comment">     * @param  mixed $templateorid The template object or ID.</span>
<a name="l2472"><span class="linenum">2472</span></a>  <span class="comment">     * @param  int $userid</span>
<a name="l2473"><span class="linenum">2473</span></a>  <span class="comment">     * @return false|\core_competency\plan Returns false when the plan already exists.</span>
<a name="l2474"><span class="linenum">2474</span></a>  <span class="comment">     */</span>
<a name="l2475"><span class="linenum">2475</span></a>      public static function <a class="function" onClick="logFunction('create_plan_from_template')" href="../../_functions/create_plan_from_template.html" onMouseOver="funcPopup(event,'create_plan_from_template')">create_plan_from_template</a>(<a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) {
<a name="l2476"><span class="linenum">2476</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2477"><span class="linenum">2477</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>;
<a name="l2478"><span class="linenum">2478</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>)) {
<a name="l2479"><span class="linenum">2479</span></a>              <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>);
<a name="l2480"><span class="linenum">2480</span></a>          }
<a name="l2481"><span class="linenum">2481</span></a>  
<a name="l2482"><span class="linenum">2482</span></a>  <span class="comment">        // The user must be able to view the template to use it as a base for a plan.</span>
<a name="l2483"><span class="linenum">2483</span></a>          if (!<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l2484"><span class="linenum">2484</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:templateview',
<a name="l2485"><span class="linenum">2485</span></a>                  'nopermissions', '');
<a name="l2486"><span class="linenum">2486</span></a>          }
<a name="l2487"><span class="linenum">2487</span></a>  <span class="comment">        // Can not create plan from a hidden template.</span>
<a name="l2488"><span class="linenum">2488</span></a>          if (<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_visible')" href="../../_functions/get_visible.html" onMouseOver="funcPopup(event,'get_visible')">get_visible</a>() == false) {
<a name="l2489"><span class="linenum">2489</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('A plan can not be created from a hidden template');
<a name="l2490"><span class="linenum">2490</span></a>          }
<a name="l2491"><span class="linenum">2491</span></a>  
<a name="l2492"><span class="linenum">2492</span></a>  <span class="comment">        // Convert the template to a plan.</span>
<a name="l2493"><span class="linenum">2493</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a> = <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('to_record')" href="../../_functions/to_record.html" onMouseOver="funcPopup(event,'to_record')">to_record</a>();
<a name="l2494"><span class="linenum">2494</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('templateid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/templateid.html">templateid</a> = <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l2495"><span class="linenum">2495</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('userid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>;
<a name="l2496"><span class="linenum">2496</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('name')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/name.html">name</a> = <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('shortname')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/shortname.html">shortname</a>;
<a name="l2497"><span class="linenum">2497</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('status')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/status.html">status</a> = <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_ACTIVE;
<a name="l2498"><span class="linenum">2498</span></a>  
<a name="l2499"><span class="linenum">2499</span></a>          unset(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l2500"><span class="linenum">2500</span></a>          unset(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a>);
<a name="l2501"><span class="linenum">2501</span></a>          unset(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('timemodified')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a>);
<a name="l2502"><span class="linenum">2502</span></a>          unset(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('usermodified')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/usermodified.html">usermodified</a>);
<a name="l2503"><span class="linenum">2503</span></a>  
<a name="l2504"><span class="linenum">2504</span></a>  <span class="comment">        // Remove extra keys.</span>
<a name="l2505"><span class="linenum">2505</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('properties')" href="../../_variables/properties.html">$properties</a> = <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::<a class="function" onClick="logFunction('properties_definition')" href="../../_functions/properties_definition.html" onMouseOver="funcPopup(event,'properties_definition')">properties_definition</a>();
<a name="l2506"><span class="linenum">2506</span></a>          foreach (<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> =&gt; <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>) {
<a name="l2507"><span class="linenum">2507</span></a>              if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('properties')" href="../../_variables/properties.html">$properties</a>)) {
<a name="l2508"><span class="linenum">2508</span></a>                  unset(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>);
<a name="l2509"><span class="linenum">2509</span></a>              }
<a name="l2510"><span class="linenum">2510</span></a>          }
<a name="l2511"><span class="linenum">2511</span></a>  
<a name="l2512"><span class="linenum">2512</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(0, <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>);
<a name="l2513"><span class="linenum">2513</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l2514"><span class="linenum">2514</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:planmanage',
<a name="l2515"><span class="linenum">2515</span></a>                  'nopermissions', '');
<a name="l2516"><span class="linenum">2516</span></a>          }
<a name="l2517"><span class="linenum">2517</span></a>  
<a name="l2518"><span class="linenum">2518</span></a>  <span class="comment">        // We first apply the permission checks as we wouldn't want to leak information by returning early that</span>
<a name="l2519"><span class="linenum">2519</span></a>  <span class="comment">        // the plan already exists.</span>
<a name="l2520"><span class="linenum">2520</span></a>          if (<a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::<a class="function" onClick="logFunction('record_exists_select')" href="../../_functions/record_exists_select.html" onMouseOver="funcPopup(event,'record_exists_select')">record_exists_select</a>('templateid = :templateid AND userid = :userid', array(
<a name="l2521"><span class="linenum">2521</span></a>                  'templateid' =&gt; <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(), 'userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>))) {
<a name="l2522"><span class="linenum">2522</span></a>              return false;
<a name="l2523"><span class="linenum">2523</span></a>          }
<a name="l2524"><span class="linenum">2524</span></a>  
<a name="l2525"><span class="linenum">2525</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l2526"><span class="linenum">2526</span></a>  
<a name="l2527"><span class="linenum">2527</span></a>  <span class="comment">        // Trigger created event.</span>
<a name="l2528"><span class="linenum">2528</span></a>          \core\event\<a class="class" onClick="logClass('competency_plan_created')" href="../../_classes/competency_plan_created.html" onMouseOver="classPopup(event,'competency_plan_created')">competency_plan_created</a>::<a class="function" onClick="logFunction('create_from_plan')" href="../../_functions/create_from_plan.html" onMouseOver="funcPopup(event,'create_from_plan')">create_from_plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l2529"><span class="linenum">2529</span></a>          return <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>;
<a name="l2530"><span class="linenum">2530</span></a>      }
<a name="l2531"><span class="linenum">2531</span></a>  
<a name="l2532"><span class="linenum">2532</span></a>      <span class="comment">/**</span>
<a name="l2533"><span class="linenum">2533</span></a>  <span class="comment">     * Create learning plans from a template and cohort.</span>
<a name="l2534"><span class="linenum">2534</span></a>  <span class="comment">     *</span>
<a name="l2535"><span class="linenum">2535</span></a>  <span class="comment">     * @param  mixed $templateorid The template object or ID.</span>
<a name="l2536"><span class="linenum">2536</span></a>  <span class="comment">     * @param  int $cohortid The cohort ID.</span>
<a name="l2537"><span class="linenum">2537</span></a>  <span class="comment">     * @param  bool $recreateunlinked When true the plans that were unlinked from this template will be re-created.</span>
<a name="l2538"><span class="linenum">2538</span></a>  <span class="comment">     * @return int The number of plans created.</span>
<a name="l2539"><span class="linenum">2539</span></a>  <span class="comment">     */</span>
<a name="l2540"><span class="linenum">2540</span></a>      public static function <a class="function" onClick="logFunction('create_plans_from_template_cohort')" href="../../_functions/create_plans_from_template_cohort.html" onMouseOver="funcPopup(event,'create_plans_from_template_cohort')">create_plans_from_template_cohort</a>(<a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>, <a class="var it2629" onMouseOver="hilite(2629)" onMouseOut="lolite()" onClick="logVariable('cohortid')" href="../../_variables/cohortid.html">$cohortid</a>, <a class="var it30461" onMouseOver="hilite(30461)" onMouseOut="lolite()" onClick="logVariable('recreateunlinked')" href="../../_variables/recreateunlinked.html">$recreateunlinked</a> = false) {
<a name="l2541"><span class="linenum">2541</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>;
<a name="l2542"><span class="linenum">2542</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2543"><span class="linenum">2543</span></a>          require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('dirroot')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../../_variables/dirroot.html">dirroot</a> . '<a class="filename" href="../../cohort/lib.php.html">/cohort/lib.php</a>');
<a name="l2544"><span class="linenum">2544</span></a>  
<a name="l2545"><span class="linenum">2545</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>;
<a name="l2546"><span class="linenum">2546</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>)) {
<a name="l2547"><span class="linenum">2547</span></a>              <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>);
<a name="l2548"><span class="linenum">2548</span></a>          }
<a name="l2549"><span class="linenum">2549</span></a>  
<a name="l2550"><span class="linenum">2550</span></a>  <span class="comment">        // The user must be able to view the template to use it as a base for a plan.</span>
<a name="l2551"><span class="linenum">2551</span></a>          if (!<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l2552"><span class="linenum">2552</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:templateview',
<a name="l2553"><span class="linenum">2553</span></a>                  'nopermissions', '');
<a name="l2554"><span class="linenum">2554</span></a>          }
<a name="l2555"><span class="linenum">2555</span></a>  
<a name="l2556"><span class="linenum">2556</span></a>  <span class="comment">        // Can not create plan from a hidden template.</span>
<a name="l2557"><span class="linenum">2557</span></a>          if (<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_visible')" href="../../_functions/get_visible.html" onMouseOver="funcPopup(event,'get_visible')">get_visible</a>() == false) {
<a name="l2558"><span class="linenum">2558</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('A plan can not be created from a hidden template');
<a name="l2559"><span class="linenum">2559</span></a>          }
<a name="l2560"><span class="linenum">2560</span></a>  
<a name="l2561"><span class="linenum">2561</span></a>  <span class="comment">        // Replicate logic in cohort_can_view_cohort() because we can't use it directly as we don't have a course context.</span>
<a name="l2562"><span class="linenum">2562</span></a>          <a class="var it7758" onMouseOver="hilite(7758)" onMouseOut="lolite()" onClick="logVariable('cohort')" href="../../_variables/cohort.html">$cohort</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('cohort', array('id' =&gt; <a class="var it2629" onMouseOver="hilite(2629)" onMouseOut="lolite()" onClick="logVariable('cohortid')" href="../../_variables/cohortid.html">$cohortid</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l2563"><span class="linenum">2563</span></a>          <a class="var it7775" onMouseOver="hilite(7775)" onMouseOut="lolite()" onClick="logVariable('cohortcontext')" href="../../_variables/cohortcontext.html">$cohortcontext</a> = context::<a class="function" onClick="logFunction('instance_by_id')" href="../../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>(<a class="var it7758" onMouseOver="hilite(7758)" onMouseOut="lolite()" onClick="logVariable('cohort')" href="../../_variables/cohort.html">$cohort</a>-&gt;<a onClick="logVariable('contextid')" class="var it43123" onMouseOver="hilite(43123)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>);
<a name="l2564"><span class="linenum">2564</span></a>          if (!<a class="var it7758" onMouseOver="hilite(7758)" onMouseOut="lolite()" onClick="logVariable('cohort')" href="../../_variables/cohort.html">$cohort</a>-&gt;<a onClick="logVariable('visible')" class="var it43123" onMouseOver="hilite(43123)" onMouseOut="lolite()" href="../../_variables/visible.html">visible</a> &amp;&amp; !<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/cohort:view', <a class="var it7775" onMouseOver="hilite(7775)" onMouseOut="lolite()" onClick="logVariable('cohortcontext')" href="../../_variables/cohortcontext.html">$cohortcontext</a>)) {
<a name="l2565"><span class="linenum">2565</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it7775" onMouseOver="hilite(7775)" onMouseOut="lolite()" onClick="logVariable('cohortcontext')" href="../../_variables/cohortcontext.html">$cohortcontext</a>, 'moodle/cohort:view', 'nopermissions', '');
<a name="l2566"><span class="linenum">2566</span></a>          }
<a name="l2567"><span class="linenum">2567</span></a>  
<a name="l2568"><span class="linenum">2568</span></a>  <span class="comment">        // Convert the template to a plan.</span>
<a name="l2569"><span class="linenum">2569</span></a>          <a class="var it30462" onMouseOver="hilite(30462)" onMouseOut="lolite()" onClick="logVariable('recordbase')" href="../../_variables/recordbase.html">$recordbase</a> = <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('to_record')" href="../../_functions/to_record.html" onMouseOver="funcPopup(event,'to_record')">to_record</a>();
<a name="l2570"><span class="linenum">2570</span></a>          <a class="var it30462" onMouseOver="hilite(30462)" onMouseOut="lolite()" onClick="logVariable('recordbase')" href="../../_variables/recordbase.html">$recordbase</a>-&gt;<a onClick="logVariable('templateid')" class="var it43744" onMouseOver="hilite(43744)" onMouseOut="lolite()" href="../../_variables/templateid.html">templateid</a> = <a class="var it30462" onMouseOver="hilite(30462)" onMouseOut="lolite()" onClick="logVariable('recordbase')" href="../../_variables/recordbase.html">$recordbase</a>-&gt;<a onClick="logVariable('id')" class="var it43744" onMouseOver="hilite(43744)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l2571"><span class="linenum">2571</span></a>          <a class="var it30462" onMouseOver="hilite(30462)" onMouseOut="lolite()" onClick="logVariable('recordbase')" href="../../_variables/recordbase.html">$recordbase</a>-&gt;<a onClick="logVariable('name')" class="var it43744" onMouseOver="hilite(43744)" onMouseOut="lolite()" href="../../_variables/name.html">name</a> = <a class="var it30462" onMouseOver="hilite(30462)" onMouseOut="lolite()" onClick="logVariable('recordbase')" href="../../_variables/recordbase.html">$recordbase</a>-&gt;<a onClick="logVariable('shortname')" class="var it43744" onMouseOver="hilite(43744)" onMouseOut="lolite()" href="../../_variables/shortname.html">shortname</a>;
<a name="l2572"><span class="linenum">2572</span></a>          <a class="var it30462" onMouseOver="hilite(30462)" onMouseOut="lolite()" onClick="logVariable('recordbase')" href="../../_variables/recordbase.html">$recordbase</a>-&gt;<a onClick="logVariable('status')" class="var it43744" onMouseOver="hilite(43744)" onMouseOut="lolite()" href="../../_variables/status.html">status</a> = <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_ACTIVE;
<a name="l2573"><span class="linenum">2573</span></a>  
<a name="l2574"><span class="linenum">2574</span></a>          unset(<a class="var it30462" onMouseOver="hilite(30462)" onMouseOut="lolite()" onClick="logVariable('recordbase')" href="../../_variables/recordbase.html">$recordbase</a>-&gt;<a onClick="logVariable('id')" class="var it43744" onMouseOver="hilite(43744)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l2575"><span class="linenum">2575</span></a>          unset(<a class="var it30462" onMouseOver="hilite(30462)" onMouseOut="lolite()" onClick="logVariable('recordbase')" href="../../_variables/recordbase.html">$recordbase</a>-&gt;<a onClick="logVariable('timecreated')" class="var it43744" onMouseOver="hilite(43744)" onMouseOut="lolite()" href="../../_variables/timecreated.html">timecreated</a>);
<a name="l2576"><span class="linenum">2576</span></a>          unset(<a class="var it30462" onMouseOver="hilite(30462)" onMouseOut="lolite()" onClick="logVariable('recordbase')" href="../../_variables/recordbase.html">$recordbase</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43744" onMouseOver="hilite(43744)" onMouseOut="lolite()" href="../../_variables/timemodified.html">timemodified</a>);
<a name="l2577"><span class="linenum">2577</span></a>          unset(<a class="var it30462" onMouseOver="hilite(30462)" onMouseOut="lolite()" onClick="logVariable('recordbase')" href="../../_variables/recordbase.html">$recordbase</a>-&gt;<a onClick="logVariable('usermodified')" class="var it43744" onMouseOver="hilite(43744)" onMouseOut="lolite()" href="../../_variables/usermodified.html">usermodified</a>);
<a name="l2578"><span class="linenum">2578</span></a>  
<a name="l2579"><span class="linenum">2579</span></a>  <span class="comment">        // Remove extra keys.</span>
<a name="l2580"><span class="linenum">2580</span></a>          <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('properties')" href="../../_variables/properties.html">$properties</a> = <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::<a class="function" onClick="logFunction('properties_definition')" href="../../_functions/properties_definition.html" onMouseOver="funcPopup(event,'properties_definition')">properties_definition</a>();
<a name="l2581"><span class="linenum">2581</span></a>          foreach (<a class="var it30462" onMouseOver="hilite(30462)" onMouseOut="lolite()" onClick="logVariable('recordbase')" href="../../_variables/recordbase.html">$recordbase</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> =&gt; <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>) {
<a name="l2582"><span class="linenum">2582</span></a>              if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>, <a class="var it1464" onMouseOver="hilite(1464)" onMouseOut="lolite()" onClick="logVariable('properties')" href="../../_variables/properties.html">$properties</a>)) {
<a name="l2583"><span class="linenum">2583</span></a>                  unset(<a class="var it30462" onMouseOver="hilite(30462)" onMouseOut="lolite()" onClick="logVariable('recordbase')" href="../../_variables/recordbase.html">$recordbase</a>-&gt;<a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>);
<a name="l2584"><span class="linenum">2584</span></a>              }
<a name="l2585"><span class="linenum">2585</span></a>          }
<a name="l2586"><span class="linenum">2586</span></a>  
<a name="l2587"><span class="linenum">2587</span></a>  <span class="comment">        // Create the plans.</span>
<a name="l2588"><span class="linenum">2588</span></a>          <a class="var it1964" onMouseOver="hilite(1964)" onMouseOut="lolite()" onClick="logVariable('created')" href="../../_variables/created.html">$created</a> = 0;
<a name="l2589"><span class="linenum">2589</span></a>          <a class="var it4024" onMouseOver="hilite(4024)" onMouseOut="lolite()" onClick="logVariable('userids')" href="../../_variables/userids.html">$userids</a> = <a class="class" onClick="logClass('template_cohort')" href="../../_classes/template_cohort.html" onMouseOver="classPopup(event,'template_cohort')">template_cohort</a>::<a class="function" onClick="logFunction('get_missing_plans')" href="../../_functions/get_missing_plans.html" onMouseOver="funcPopup(event,'get_missing_plans')">get_missing_plans</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(), <a class="var it2629" onMouseOver="hilite(2629)" onMouseOut="lolite()" onClick="logVariable('cohortid')" href="../../_variables/cohortid.html">$cohortid</a>, <a class="var it30461" onMouseOver="hilite(30461)" onMouseOut="lolite()" onClick="logVariable('recreateunlinked')" href="../../_variables/recreateunlinked.html">$recreateunlinked</a>);
<a name="l2590"><span class="linenum">2590</span></a>          foreach (<a class="var it4024" onMouseOver="hilite(4024)" onMouseOut="lolite()" onClick="logVariable('userids')" href="../../_variables/userids.html">$userids</a> as <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) {
<a name="l2591"><span class="linenum">2591</span></a>              <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a> = (object) (array) <a class="var it30462" onMouseOver="hilite(30462)" onMouseOut="lolite()" onClick="logVariable('recordbase')" href="../../_variables/recordbase.html">$recordbase</a>;
<a name="l2592"><span class="linenum">2592</span></a>              <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('userid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>;
<a name="l2593"><span class="linenum">2593</span></a>  
<a name="l2594"><span class="linenum">2594</span></a>              <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(0, <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>);
<a name="l2595"><span class="linenum">2595</span></a>              if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l2596"><span class="linenum">2596</span></a>  <span class="comment">                // Silently skip members where permissions are lacking.</span>
<a name="l2597"><span class="linenum">2597</span></a>                  continue;
<a name="l2598"><span class="linenum">2598</span></a>              }
<a name="l2599"><span class="linenum">2599</span></a>  
<a name="l2600"><span class="linenum">2600</span></a>              <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l2601"><span class="linenum">2601</span></a>  <span class="comment">            // Trigger created event.</span>
<a name="l2602"><span class="linenum">2602</span></a>              \core\event\<a class="class" onClick="logClass('competency_plan_created')" href="../../_classes/competency_plan_created.html" onMouseOver="classPopup(event,'competency_plan_created')">competency_plan_created</a>::<a class="function" onClick="logFunction('create_from_plan')" href="../../_functions/create_from_plan.html" onMouseOver="funcPopup(event,'create_from_plan')">create_from_plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l2603"><span class="linenum">2603</span></a>              <a class="var it1964" onMouseOver="hilite(1964)" onMouseOut="lolite()" onClick="logVariable('created')" href="../../_variables/created.html">$created</a>++;
<a name="l2604"><span class="linenum">2604</span></a>          }
<a name="l2605"><span class="linenum">2605</span></a>  
<a name="l2606"><span class="linenum">2606</span></a>          return <a class="var it1964" onMouseOver="hilite(1964)" onMouseOut="lolite()" onClick="logVariable('created')" href="../../_variables/created.html">$created</a>;
<a name="l2607"><span class="linenum">2607</span></a>      }
<a name="l2608"><span class="linenum">2608</span></a>  
<a name="l2609"><span class="linenum">2609</span></a>      <span class="comment">/**</span>
<a name="l2610"><span class="linenum">2610</span></a>  <span class="comment">     * Unlink a plan from its template.</span>
<a name="l2611"><span class="linenum">2611</span></a>  <span class="comment">     *</span>
<a name="l2612"><span class="linenum">2612</span></a>  <span class="comment">     * @param  \core_competency\plan|int $planorid The plan or its ID.</span>
<a name="l2613"><span class="linenum">2613</span></a>  <span class="comment">     * @return bool</span>
<a name="l2614"><span class="linenum">2614</span></a>  <span class="comment">     */</span>
<a name="l2615"><span class="linenum">2615</span></a>      public static function <a class="function" onClick="logFunction('unlink_plan_from_template')" href="../../_functions/unlink_plan_from_template.html" onMouseOver="funcPopup(event,'unlink_plan_from_template')">unlink_plan_from_template</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>) {
<a name="l2616"><span class="linenum">2616</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2617"><span class="linenum">2617</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2618"><span class="linenum">2618</span></a>  
<a name="l2619"><span class="linenum">2619</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>;
<a name="l2620"><span class="linenum">2620</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>)) {
<a name="l2621"><span class="linenum">2621</span></a>              <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>);
<a name="l2622"><span class="linenum">2622</span></a>          }
<a name="l2623"><span class="linenum">2623</span></a>  
<a name="l2624"><span class="linenum">2624</span></a>  <span class="comment">        // The user must be allowed to manage the plans of the user, nothing about the template.</span>
<a name="l2625"><span class="linenum">2625</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l2626"><span class="linenum">2626</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:planmanage', 'nopermissions', '');
<a name="l2627"><span class="linenum">2627</span></a>          }
<a name="l2628"><span class="linenum">2628</span></a>  
<a name="l2629"><span class="linenum">2629</span></a>  <span class="comment">        // Only plan with status DRAFT or ACTIVE can be unliked..</span>
<a name="l2630"><span class="linenum">2630</span></a>          if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() == <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_COMPLETE) {
<a name="l2631"><span class="linenum">2631</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Only draft or active plan can be unliked from a template');
<a name="l2632"><span class="linenum">2632</span></a>          }
<a name="l2633"><span class="linenum">2633</span></a>  
<a name="l2634"><span class="linenum">2634</span></a>  <span class="comment">        // Early exit, it's already done...</span>
<a name="l2635"><span class="linenum">2635</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('is_based_on_template')" href="../../_functions/is_based_on_template.html" onMouseOver="funcPopup(event,'is_based_on_template')">is_based_on_template</a>()) {
<a name="l2636"><span class="linenum">2636</span></a>              return true;
<a name="l2637"><span class="linenum">2637</span></a>          }
<a name="l2638"><span class="linenum">2638</span></a>  
<a name="l2639"><span class="linenum">2639</span></a>  <span class="comment">        // Fetch the template.</span>
<a name="l2640"><span class="linenum">2640</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_templateid')" href="../../_functions/get_templateid.html" onMouseOver="funcPopup(event,'get_templateid')">get_templateid</a>());
<a name="l2641"><span class="linenum">2641</span></a>  
<a name="l2642"><span class="linenum">2642</span></a>  <span class="comment">        // Now, proceed by copying all competencies to the plan, then update the plan.</span>
<a name="l2643"><span class="linenum">2643</span></a>          <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l2644"><span class="linenum">2644</span></a>          <a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a> = <a class="class" onClick="logClass('template_competency')" href="../../_classes/template_competency.html" onMouseOver="classPopup(event,'template_competency')">template_competency</a>::<a class="function" onClick="logFunction('list_competencies')" href="../../_functions/list_competencies.html" onMouseOver="funcPopup(event,'list_competencies')">list_competencies</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(), false);
<a name="l2645"><span class="linenum">2645</span></a>          <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> = 0;
<a name="l2646"><span class="linenum">2646</span></a>          foreach (<a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a> as <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>) {
<a name="l2647"><span class="linenum">2647</span></a>              <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a> = (object) array(
<a name="l2648"><span class="linenum">2648</span></a>                  'planid' =&gt; <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(),
<a name="l2649"><span class="linenum">2649</span></a>                  'competencyid' =&gt; <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(),
<a name="l2650"><span class="linenum">2650</span></a>                  'sortorder' =&gt; <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>++
<a name="l2651"><span class="linenum">2651</span></a>              );
<a name="l2652"><span class="linenum">2652</span></a>              <a class="var it8869" onMouseOver="hilite(8869)" onMouseOut="lolite()" onClick="logVariable('pc')" href="../../_variables/pc.html">$pc</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan_competency')" href="../../_classes/plan_competency.html" onMouseOver="classPopup(event,'plan_competency')">plan_competency</a>(null, <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>);
<a name="l2653"><span class="linenum">2653</span></a>              <a class="var it8869" onMouseOver="hilite(8869)" onMouseOut="lolite()" onClick="logVariable('pc')" href="../../_variables/pc.html">$pc</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l2654"><span class="linenum">2654</span></a>          }
<a name="l2655"><span class="linenum">2655</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;set_origtemplateid(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>());
<a name="l2656"><span class="linenum">2656</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;set_templateid(null);
<a name="l2657"><span class="linenum">2657</span></a>          <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a> = <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l2658"><span class="linenum">2658</span></a>          <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l2659"><span class="linenum">2659</span></a>  
<a name="l2660"><span class="linenum">2660</span></a>  <span class="comment">        // Trigger unlinked event.</span>
<a name="l2661"><span class="linenum">2661</span></a>          \core\event\<a class="class" onClick="logClass('competency_plan_unlinked')" href="../../_classes/competency_plan_unlinked.html" onMouseOver="classPopup(event,'competency_plan_unlinked')">competency_plan_unlinked</a>::<a class="function" onClick="logFunction('create_from_plan')" href="../../_functions/create_from_plan.html" onMouseOver="funcPopup(event,'create_from_plan')">create_from_plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l2662"><span class="linenum">2662</span></a>  
<a name="l2663"><span class="linenum">2663</span></a>          return <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a>;
<a name="l2664"><span class="linenum">2664</span></a>      }
<a name="l2665"><span class="linenum">2665</span></a>  
<a name="l2666"><span class="linenum">2666</span></a>      <span class="comment">/**</span>
<a name="l2667"><span class="linenum">2667</span></a>  <span class="comment">     * Updates a plan.</span>
<a name="l2668"><span class="linenum">2668</span></a>  <span class="comment">     *</span>
<a name="l2669"><span class="linenum">2669</span></a>  <span class="comment">     * @param stdClass $record</span>
<a name="l2670"><span class="linenum">2670</span></a>  <span class="comment">     * @return \core_competency\plan</span>
<a name="l2671"><span class="linenum">2671</span></a>  <span class="comment">     */</span>
<a name="l2672"><span class="linenum">2672</span></a>      public static function <a class="function" onClick="logFunction('update_plan')" href="../../_functions/update_plan.html" onMouseOver="funcPopup(event,'update_plan')">update_plan</a>(stdClass <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>) {
<a name="l2673"><span class="linenum">2673</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2674"><span class="linenum">2674</span></a>  
<a name="l2675"><span class="linenum">2675</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('id')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l2676"><span class="linenum">2676</span></a>  
<a name="l2677"><span class="linenum">2677</span></a>  <span class="comment">        // Validate that the plan as it is can be managed.</span>
<a name="l2678"><span class="linenum">2678</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l2679"><span class="linenum">2679</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:planmanage', 'nopermissions', '');
<a name="l2680"><span class="linenum">2680</span></a>  
<a name="l2681"><span class="linenum">2681</span></a>          } else if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() == <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_COMPLETE) {
<a name="l2682"><span class="linenum">2682</span></a>  <span class="comment">            // A completed plan cannot be edited.</span>
<a name="l2683"><span class="linenum">2683</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Completed plan cannot be edited.');
<a name="l2684"><span class="linenum">2684</span></a>  
<a name="l2685"><span class="linenum">2685</span></a>          } else if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('is_based_on_template')" href="../../_functions/is_based_on_template.html" onMouseOver="funcPopup(event,'is_based_on_template')">is_based_on_template</a>()) {
<a name="l2686"><span class="linenum">2686</span></a>  <span class="comment">            // Prevent a plan based on a template to be edited.</span>
<a name="l2687"><span class="linenum">2687</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Cannot update a plan that is based on a template.');
<a name="l2688"><span class="linenum">2688</span></a>  
<a name="l2689"><span class="linenum">2689</span></a>          } else if (isset(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('templateid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/templateid.html">templateid</a>) &amp;&amp; <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_templateid')" href="../../_functions/get_templateid.html" onMouseOver="funcPopup(event,'get_templateid')">get_templateid</a>() != <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('templateid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/templateid.html">templateid</a>) {
<a name="l2690"><span class="linenum">2690</span></a>  <span class="comment">            // Prevent a plan to be based on a template.</span>
<a name="l2691"><span class="linenum">2691</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Cannot base a plan on a template.');
<a name="l2692"><span class="linenum">2692</span></a>  
<a name="l2693"><span class="linenum">2693</span></a>          } else if (isset(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('userid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>) &amp;&amp; <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>() != <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('userid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a>) {
<a name="l2694"><span class="linenum">2694</span></a>  <span class="comment">            // Prevent change of ownership as the capabilities are checked against that.</span>
<a name="l2695"><span class="linenum">2695</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('A plan cannot be transfered to another user');
<a name="l2696"><span class="linenum">2696</span></a>  
<a name="l2697"><span class="linenum">2697</span></a>          } else if (isset(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('status')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/status.html">status</a>) &amp;&amp; <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() != <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('status')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/status.html">status</a>) {
<a name="l2698"><span class="linenum">2698</span></a>  <span class="comment">            // Prevent change of status.</span>
<a name="l2699"><span class="linenum">2699</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('To change the status of a plan use the appropriate methods.');
<a name="l2700"><span class="linenum">2700</span></a>  
<a name="l2701"><span class="linenum">2701</span></a>          }
<a name="l2702"><span class="linenum">2702</span></a>  
<a name="l2703"><span class="linenum">2703</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('from_record')" href="../../_functions/from_record.html" onMouseOver="funcPopup(event,'from_record')">from_record</a>(<a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>);
<a name="l2704"><span class="linenum">2704</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l2705"><span class="linenum">2705</span></a>  
<a name="l2706"><span class="linenum">2706</span></a>  <span class="comment">        // Trigger updated event.</span>
<a name="l2707"><span class="linenum">2707</span></a>          \core\event\<a class="class" onClick="logClass('competency_plan_updated')" href="../../_classes/competency_plan_updated.html" onMouseOver="classPopup(event,'competency_plan_updated')">competency_plan_updated</a>::<a class="function" onClick="logFunction('create_from_plan')" href="../../_functions/create_from_plan.html" onMouseOver="funcPopup(event,'create_from_plan')">create_from_plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l2708"><span class="linenum">2708</span></a>  
<a name="l2709"><span class="linenum">2709</span></a>          return <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>;
<a name="l2710"><span class="linenum">2710</span></a>      }
<a name="l2711"><span class="linenum">2711</span></a>  
<a name="l2712"><span class="linenum">2712</span></a>      <span class="comment">/**</span>
<a name="l2713"><span class="linenum">2713</span></a>  <span class="comment">     * Returns a plan data.</span>
<a name="l2714"><span class="linenum">2714</span></a>  <span class="comment">     *</span>
<a name="l2715"><span class="linenum">2715</span></a>  <span class="comment">     * @param int $id</span>
<a name="l2716"><span class="linenum">2716</span></a>  <span class="comment">     * @return \core_competency\plan</span>
<a name="l2717"><span class="linenum">2717</span></a>  <span class="comment">     */</span>
<a name="l2718"><span class="linenum">2718</span></a>      public static function <a class="function" onClick="logFunction('read_plan')" href="../../_functions/read_plan.html" onMouseOver="funcPopup(event,'read_plan')">read_plan</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>) {
<a name="l2719"><span class="linenum">2719</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2720"><span class="linenum">2720</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);
<a name="l2721"><span class="linenum">2721</span></a>  
<a name="l2722"><span class="linenum">2722</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l2723"><span class="linenum">2723</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_user')" href="../../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>());
<a name="l2724"><span class="linenum">2724</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:planview', 'nopermissions', '');
<a name="l2725"><span class="linenum">2725</span></a>          }
<a name="l2726"><span class="linenum">2726</span></a>  
<a name="l2727"><span class="linenum">2727</span></a>          return <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>;
<a name="l2728"><span class="linenum">2728</span></a>      }
<a name="l2729"><span class="linenum">2729</span></a>  
<a name="l2730"><span class="linenum">2730</span></a>      <span class="comment">/**</span>
<a name="l2731"><span class="linenum">2731</span></a>  <span class="comment">     * Plan event viewed.</span>
<a name="l2732"><span class="linenum">2732</span></a>  <span class="comment">     *</span>
<a name="l2733"><span class="linenum">2733</span></a>  <span class="comment">     * @param mixed $planorid The id or the plan.</span>
<a name="l2734"><span class="linenum">2734</span></a>  <span class="comment">     * @return boolean</span>
<a name="l2735"><span class="linenum">2735</span></a>  <span class="comment">     */</span>
<a name="l2736"><span class="linenum">2736</span></a>      public static function <a class="function" onClick="logFunction('plan_viewed')" href="../../_functions/plan_viewed.html" onMouseOver="funcPopup(event,'plan_viewed')">plan_viewed</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>) {
<a name="l2737"><span class="linenum">2737</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2738"><span class="linenum">2738</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>;
<a name="l2739"><span class="linenum">2739</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>)) {
<a name="l2740"><span class="linenum">2740</span></a>              <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>);
<a name="l2741"><span class="linenum">2741</span></a>          }
<a name="l2742"><span class="linenum">2742</span></a>  
<a name="l2743"><span class="linenum">2743</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l2744"><span class="linenum">2744</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l2745"><span class="linenum">2745</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_user')" href="../../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>());
<a name="l2746"><span class="linenum">2746</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:planview', 'nopermissions', '');
<a name="l2747"><span class="linenum">2747</span></a>          }
<a name="l2748"><span class="linenum">2748</span></a>  
<a name="l2749"><span class="linenum">2749</span></a>  <span class="comment">        // Trigger a template viewed event.</span>
<a name="l2750"><span class="linenum">2750</span></a>          \core\event\<a class="class" onClick="logClass('competency_plan_viewed')" href="../../_classes/competency_plan_viewed.html" onMouseOver="classPopup(event,'competency_plan_viewed')">competency_plan_viewed</a>::<a class="function" onClick="logFunction('create_from_plan')" href="../../_functions/create_from_plan.html" onMouseOver="funcPopup(event,'create_from_plan')">create_from_plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l2751"><span class="linenum">2751</span></a>  
<a name="l2752"><span class="linenum">2752</span></a>          return true;
<a name="l2753"><span class="linenum">2753</span></a>      }
<a name="l2754"><span class="linenum">2754</span></a>  
<a name="l2755"><span class="linenum">2755</span></a>      <span class="comment">/**</span>
<a name="l2756"><span class="linenum">2756</span></a>  <span class="comment">     * Deletes a plan.</span>
<a name="l2757"><span class="linenum">2757</span></a>  <span class="comment">     *</span>
<a name="l2758"><span class="linenum">2758</span></a>  <span class="comment">     * Plans based on a template can be removed just like any other one.</span>
<a name="l2759"><span class="linenum">2759</span></a>  <span class="comment">     *</span>
<a name="l2760"><span class="linenum">2760</span></a>  <span class="comment">     * @param int $id</span>
<a name="l2761"><span class="linenum">2761</span></a>  <span class="comment">     * @return bool Success?</span>
<a name="l2762"><span class="linenum">2762</span></a>  <span class="comment">     */</span>
<a name="l2763"><span class="linenum">2763</span></a>      public static function <a class="function" onClick="logFunction('delete_plan')" href="../../_functions/delete_plan.html" onMouseOver="funcPopup(event,'delete_plan')">delete_plan</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>) {
<a name="l2764"><span class="linenum">2764</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l2765"><span class="linenum">2765</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2766"><span class="linenum">2766</span></a>  
<a name="l2767"><span class="linenum">2767</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);
<a name="l2768"><span class="linenum">2768</span></a>  
<a name="l2769"><span class="linenum">2769</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l2770"><span class="linenum">2770</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_user')" href="../../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>());
<a name="l2771"><span class="linenum">2771</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:planmanage', 'nopermissions', '');
<a name="l2772"><span class="linenum">2772</span></a>          }
<a name="l2773"><span class="linenum">2773</span></a>  
<a name="l2774"><span class="linenum">2774</span></a>  <span class="comment">        // Wrap the suppression in a DB transaction.</span>
<a name="l2775"><span class="linenum">2775</span></a>          <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l2776"><span class="linenum">2776</span></a>  
<a name="l2777"><span class="linenum">2777</span></a>  <span class="comment">        // Delete plan competencies.</span>
<a name="l2778"><span class="linenum">2778</span></a>          <a class="var it30464" onMouseOver="hilite(30464)" onMouseOut="lolite()" onClick="logVariable('plancomps')" href="../../_variables/plancomps.html">$plancomps</a> = <a class="class" onClick="logClass('plan_competency')" href="../../_classes/plan_competency.html" onMouseOver="classPopup(event,'plan_competency')">plan_competency</a>::<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(array('planid' =&gt; <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>()));
<a name="l2779"><span class="linenum">2779</span></a>          foreach (<a class="var it30464" onMouseOver="hilite(30464)" onMouseOut="lolite()" onClick="logVariable('plancomps')" href="../../_variables/plancomps.html">$plancomps</a> as <a class="var it30465" onMouseOver="hilite(30465)" onMouseOut="lolite()" onClick="logVariable('plancomp')" href="../../_variables/plancomp.html">$plancomp</a>) {
<a name="l2780"><span class="linenum">2780</span></a>              <a class="var it30465" onMouseOver="hilite(30465)" onMouseOut="lolite()" onClick="logVariable('plancomp')" href="../../_variables/plancomp.html">$plancomp</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l2781"><span class="linenum">2781</span></a>          }
<a name="l2782"><span class="linenum">2782</span></a>  
<a name="l2783"><span class="linenum">2783</span></a>  <span class="comment">        // Delete archive user competencies if the status of the plan is complete.</span>
<a name="l2784"><span class="linenum">2784</span></a>          if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() == <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_COMPLETE) {
<a name="l2785"><span class="linenum">2785</span></a>              self::<a class="function" onClick="logFunction('remove_archived_user_competencies_in_plan')" href="../../_functions/remove_archived_user_competencies_in_plan.html" onMouseOver="funcPopup(event,'remove_archived_user_competencies_in_plan')">remove_archived_user_competencies_in_plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>);
<a name="l2786"><span class="linenum">2786</span></a>          }
<a name="l2787"><span class="linenum">2787</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('competency_plan_deleted')" href="../../_classes/competency_plan_deleted.html" onMouseOver="classPopup(event,'competency_plan_deleted')">competency_plan_deleted</a>::<a class="function" onClick="logFunction('create_from_plan')" href="../../_functions/create_from_plan.html" onMouseOver="funcPopup(event,'create_from_plan')">create_from_plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>);
<a name="l2788"><span class="linenum">2788</span></a>          <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a> = <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l2789"><span class="linenum">2789</span></a>  
<a name="l2790"><span class="linenum">2790</span></a>          <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l2791"><span class="linenum">2791</span></a>  
<a name="l2792"><span class="linenum">2792</span></a>  <span class="comment">        // Trigger deleted event.</span>
<a name="l2793"><span class="linenum">2793</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l2794"><span class="linenum">2794</span></a>  
<a name="l2795"><span class="linenum">2795</span></a>          return <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a>;
<a name="l2796"><span class="linenum">2796</span></a>      }
<a name="l2797"><span class="linenum">2797</span></a>  
<a name="l2798"><span class="linenum">2798</span></a>      <span class="comment">/**</span>
<a name="l2799"><span class="linenum">2799</span></a>  <span class="comment">     * Cancel the review of a plan.</span>
<a name="l2800"><span class="linenum">2800</span></a>  <span class="comment">     *</span>
<a name="l2801"><span class="linenum">2801</span></a>  <span class="comment">     * @param int|plan $planorid The plan, or its ID.</span>
<a name="l2802"><span class="linenum">2802</span></a>  <span class="comment">     * @return bool</span>
<a name="l2803"><span class="linenum">2803</span></a>  <span class="comment">     */</span>
<a name="l2804"><span class="linenum">2804</span></a>      public static function <a class="function" onClick="logFunction('plan_cancel_review_request')" href="../../_functions/plan_cancel_review_request.html" onMouseOver="funcPopup(event,'plan_cancel_review_request')">plan_cancel_review_request</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>) {
<a name="l2805"><span class="linenum">2805</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2806"><span class="linenum">2806</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>;
<a name="l2807"><span class="linenum">2807</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>)) {
<a name="l2808"><span class="linenum">2808</span></a>              <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>);
<a name="l2809"><span class="linenum">2809</span></a>          }
<a name="l2810"><span class="linenum">2810</span></a>  
<a name="l2811"><span class="linenum">2811</span></a>  <span class="comment">        // We need to be able to view the plan at least.</span>
<a name="l2812"><span class="linenum">2812</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l2813"><span class="linenum">2813</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:planview', 'nopermissions', '');
<a name="l2814"><span class="linenum">2814</span></a>          }
<a name="l2815"><span class="linenum">2815</span></a>  
<a name="l2816"><span class="linenum">2816</span></a>          if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('is_based_on_template')" href="../../_functions/is_based_on_template.html" onMouseOver="funcPopup(event,'is_based_on_template')">is_based_on_template</a>()) {
<a name="l2817"><span class="linenum">2817</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Template plans cannot be reviewed.');   <span class="comment">// This should never happen.</span>
<a name="l2818"><span class="linenum">2818</span></a>          } else if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() != <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_WAITING_FOR_REVIEW) {
<a name="l2819"><span class="linenum">2819</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('The plan review cannot be cancelled at this stage.');
<a name="l2820"><span class="linenum">2820</span></a>          } else if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_request_review')" href="../../_functions/can_request_review.html" onMouseOver="funcPopup(event,'can_request_review')">can_request_review</a>()) {
<a name="l2821"><span class="linenum">2821</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:planmanage', 'nopermissions', '');
<a name="l2822"><span class="linenum">2822</span></a>          }
<a name="l2823"><span class="linenum">2823</span></a>  
<a name="l2824"><span class="linenum">2824</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('set_status')" href="../../_functions/set_status.html" onMouseOver="funcPopup(event,'set_status')">set_status</a>(<a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_DRAFT);
<a name="l2825"><span class="linenum">2825</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l2826"><span class="linenum">2826</span></a>  
<a name="l2827"><span class="linenum">2827</span></a>  <span class="comment">        // Trigger review request cancelled event.</span>
<a name="l2828"><span class="linenum">2828</span></a>          \core\event\<a class="class" onClick="logClass('competency_plan_review_request_cancelled')" href="../../_classes/competency_plan_review_request_cancelled.html" onMouseOver="classPopup(event,'competency_plan_review_request_cancelled')">competency_plan_review_request_cancelled</a>::<a class="function" onClick="logFunction('create_from_plan')" href="../../_functions/create_from_plan.html" onMouseOver="funcPopup(event,'create_from_plan')">create_from_plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l2829"><span class="linenum">2829</span></a>  
<a name="l2830"><span class="linenum">2830</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l2831"><span class="linenum">2831</span></a>      }
<a name="l2832"><span class="linenum">2832</span></a>  
<a name="l2833"><span class="linenum">2833</span></a>      <span class="comment">/**</span>
<a name="l2834"><span class="linenum">2834</span></a>  <span class="comment">     * Request the review of a plan.</span>
<a name="l2835"><span class="linenum">2835</span></a>  <span class="comment">     *</span>
<a name="l2836"><span class="linenum">2836</span></a>  <span class="comment">     * @param int|plan $planorid The plan, or its ID.</span>
<a name="l2837"><span class="linenum">2837</span></a>  <span class="comment">     * @return bool</span>
<a name="l2838"><span class="linenum">2838</span></a>  <span class="comment">     */</span>
<a name="l2839"><span class="linenum">2839</span></a>      public static function <a class="function" onClick="logFunction('plan_request_review')" href="../../_functions/plan_request_review.html" onMouseOver="funcPopup(event,'plan_request_review')">plan_request_review</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>) {
<a name="l2840"><span class="linenum">2840</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2841"><span class="linenum">2841</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>;
<a name="l2842"><span class="linenum">2842</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>)) {
<a name="l2843"><span class="linenum">2843</span></a>              <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>);
<a name="l2844"><span class="linenum">2844</span></a>          }
<a name="l2845"><span class="linenum">2845</span></a>  
<a name="l2846"><span class="linenum">2846</span></a>  <span class="comment">        // We need to be able to view the plan at least.</span>
<a name="l2847"><span class="linenum">2847</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l2848"><span class="linenum">2848</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:planview', 'nopermissions', '');
<a name="l2849"><span class="linenum">2849</span></a>          }
<a name="l2850"><span class="linenum">2850</span></a>  
<a name="l2851"><span class="linenum">2851</span></a>          if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('is_based_on_template')" href="../../_functions/is_based_on_template.html" onMouseOver="funcPopup(event,'is_based_on_template')">is_based_on_template</a>()) {
<a name="l2852"><span class="linenum">2852</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Template plans cannot be reviewed.');   <span class="comment">// This should never happen.</span>
<a name="l2853"><span class="linenum">2853</span></a>          } else if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() != <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_DRAFT) {
<a name="l2854"><span class="linenum">2854</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('The plan cannot be sent for review at this stage.');
<a name="l2855"><span class="linenum">2855</span></a>          } else if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_request_review')" href="../../_functions/can_request_review.html" onMouseOver="funcPopup(event,'can_request_review')">can_request_review</a>()) {
<a name="l2856"><span class="linenum">2856</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:planmanage', 'nopermissions', '');
<a name="l2857"><span class="linenum">2857</span></a>          }
<a name="l2858"><span class="linenum">2858</span></a>  
<a name="l2859"><span class="linenum">2859</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('set_status')" href="../../_functions/set_status.html" onMouseOver="funcPopup(event,'set_status')">set_status</a>(<a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_WAITING_FOR_REVIEW);
<a name="l2860"><span class="linenum">2860</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l2861"><span class="linenum">2861</span></a>  
<a name="l2862"><span class="linenum">2862</span></a>  <span class="comment">        // Trigger review requested event.</span>
<a name="l2863"><span class="linenum">2863</span></a>          \core\event\<a class="class" onClick="logClass('competency_plan_review_requested')" href="../../_classes/competency_plan_review_requested.html" onMouseOver="classPopup(event,'competency_plan_review_requested')">competency_plan_review_requested</a>::<a class="function" onClick="logFunction('create_from_plan')" href="../../_functions/create_from_plan.html" onMouseOver="funcPopup(event,'create_from_plan')">create_from_plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l2864"><span class="linenum">2864</span></a>  
<a name="l2865"><span class="linenum">2865</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l2866"><span class="linenum">2866</span></a>      }
<a name="l2867"><span class="linenum">2867</span></a>  
<a name="l2868"><span class="linenum">2868</span></a>      <span class="comment">/**</span>
<a name="l2869"><span class="linenum">2869</span></a>  <span class="comment">     * Start the review of a plan.</span>
<a name="l2870"><span class="linenum">2870</span></a>  <span class="comment">     *</span>
<a name="l2871"><span class="linenum">2871</span></a>  <span class="comment">     * @param int|plan $planorid The plan, or its ID.</span>
<a name="l2872"><span class="linenum">2872</span></a>  <span class="comment">     * @return bool</span>
<a name="l2873"><span class="linenum">2873</span></a>  <span class="comment">     */</span>
<a name="l2874"><span class="linenum">2874</span></a>      public static function <a class="function" onClick="logFunction('plan_start_review')" href="../../_functions/plan_start_review.html" onMouseOver="funcPopup(event,'plan_start_review')">plan_start_review</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>) {
<a name="l2875"><span class="linenum">2875</span></a>          global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l2876"><span class="linenum">2876</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2877"><span class="linenum">2877</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>;
<a name="l2878"><span class="linenum">2878</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>)) {
<a name="l2879"><span class="linenum">2879</span></a>              <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>);
<a name="l2880"><span class="linenum">2880</span></a>          }
<a name="l2881"><span class="linenum">2881</span></a>  
<a name="l2882"><span class="linenum">2882</span></a>  <span class="comment">        // We need to be able to view the plan at least.</span>
<a name="l2883"><span class="linenum">2883</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l2884"><span class="linenum">2884</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:planview', 'nopermissions', '');
<a name="l2885"><span class="linenum">2885</span></a>          }
<a name="l2886"><span class="linenum">2886</span></a>  
<a name="l2887"><span class="linenum">2887</span></a>          if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('is_based_on_template')" href="../../_functions/is_based_on_template.html" onMouseOver="funcPopup(event,'is_based_on_template')">is_based_on_template</a>()) {
<a name="l2888"><span class="linenum">2888</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Template plans cannot be reviewed.');   <span class="comment">// This should never happen.</span>
<a name="l2889"><span class="linenum">2889</span></a>          } else if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() != <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_WAITING_FOR_REVIEW) {
<a name="l2890"><span class="linenum">2890</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('The plan review cannot be started at this stage.');
<a name="l2891"><span class="linenum">2891</span></a>          } else if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_review')" href="../../_functions/can_review.html" onMouseOver="funcPopup(event,'can_review')">can_review</a>()) {
<a name="l2892"><span class="linenum">2892</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:planmanage', 'nopermissions', '');
<a name="l2893"><span class="linenum">2893</span></a>          }
<a name="l2894"><span class="linenum">2894</span></a>  
<a name="l2895"><span class="linenum">2895</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('set_status')" href="../../_functions/set_status.html" onMouseOver="funcPopup(event,'set_status')">set_status</a>(<a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_IN_REVIEW);
<a name="l2896"><span class="linenum">2896</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;set_reviewerid(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l2897"><span class="linenum">2897</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l2898"><span class="linenum">2898</span></a>  
<a name="l2899"><span class="linenum">2899</span></a>  <span class="comment">        // Trigger review started event.</span>
<a name="l2900"><span class="linenum">2900</span></a>          \core\event\<a class="class" onClick="logClass('competency_plan_review_started')" href="../../_classes/competency_plan_review_started.html" onMouseOver="classPopup(event,'competency_plan_review_started')">competency_plan_review_started</a>::<a class="function" onClick="logFunction('create_from_plan')" href="../../_functions/create_from_plan.html" onMouseOver="funcPopup(event,'create_from_plan')">create_from_plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l2901"><span class="linenum">2901</span></a>  
<a name="l2902"><span class="linenum">2902</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l2903"><span class="linenum">2903</span></a>      }
<a name="l2904"><span class="linenum">2904</span></a>  
<a name="l2905"><span class="linenum">2905</span></a>      <span class="comment">/**</span>
<a name="l2906"><span class="linenum">2906</span></a>  <span class="comment">     * Stop reviewing a plan.</span>
<a name="l2907"><span class="linenum">2907</span></a>  <span class="comment">     *</span>
<a name="l2908"><span class="linenum">2908</span></a>  <span class="comment">     * @param  int|plan $planorid The plan, or its ID.</span>
<a name="l2909"><span class="linenum">2909</span></a>  <span class="comment">     * @return bool</span>
<a name="l2910"><span class="linenum">2910</span></a>  <span class="comment">     */</span>
<a name="l2911"><span class="linenum">2911</span></a>      public static function <a class="function" onClick="logFunction('plan_stop_review')" href="../../_functions/plan_stop_review.html" onMouseOver="funcPopup(event,'plan_stop_review')">plan_stop_review</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>) {
<a name="l2912"><span class="linenum">2912</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2913"><span class="linenum">2913</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>;
<a name="l2914"><span class="linenum">2914</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>)) {
<a name="l2915"><span class="linenum">2915</span></a>              <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>);
<a name="l2916"><span class="linenum">2916</span></a>          }
<a name="l2917"><span class="linenum">2917</span></a>  
<a name="l2918"><span class="linenum">2918</span></a>  <span class="comment">        // We need to be able to view the plan at least.</span>
<a name="l2919"><span class="linenum">2919</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l2920"><span class="linenum">2920</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:planview', 'nopermissions', '');
<a name="l2921"><span class="linenum">2921</span></a>          }
<a name="l2922"><span class="linenum">2922</span></a>  
<a name="l2923"><span class="linenum">2923</span></a>          if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('is_based_on_template')" href="../../_functions/is_based_on_template.html" onMouseOver="funcPopup(event,'is_based_on_template')">is_based_on_template</a>()) {
<a name="l2924"><span class="linenum">2924</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Template plans cannot be reviewed.');   <span class="comment">// This should never happen.</span>
<a name="l2925"><span class="linenum">2925</span></a>          } else if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() != <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_IN_REVIEW) {
<a name="l2926"><span class="linenum">2926</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('The plan review cannot be stopped at this stage.');
<a name="l2927"><span class="linenum">2927</span></a>          } else if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_review')" href="../../_functions/can_review.html" onMouseOver="funcPopup(event,'can_review')">can_review</a>()) {
<a name="l2928"><span class="linenum">2928</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:planmanage', 'nopermissions', '');
<a name="l2929"><span class="linenum">2929</span></a>          }
<a name="l2930"><span class="linenum">2930</span></a>  
<a name="l2931"><span class="linenum">2931</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('set_status')" href="../../_functions/set_status.html" onMouseOver="funcPopup(event,'set_status')">set_status</a>(<a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_DRAFT);
<a name="l2932"><span class="linenum">2932</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;set_reviewerid(null);
<a name="l2933"><span class="linenum">2933</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l2934"><span class="linenum">2934</span></a>  
<a name="l2935"><span class="linenum">2935</span></a>  <span class="comment">        // Trigger review stopped event.</span>
<a name="l2936"><span class="linenum">2936</span></a>          \core\event\<a class="class" onClick="logClass('competency_plan_review_stopped')" href="../../_classes/competency_plan_review_stopped.html" onMouseOver="classPopup(event,'competency_plan_review_stopped')">competency_plan_review_stopped</a>::<a class="function" onClick="logFunction('create_from_plan')" href="../../_functions/create_from_plan.html" onMouseOver="funcPopup(event,'create_from_plan')">create_from_plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l2937"><span class="linenum">2937</span></a>  
<a name="l2938"><span class="linenum">2938</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l2939"><span class="linenum">2939</span></a>      }
<a name="l2940"><span class="linenum">2940</span></a>  
<a name="l2941"><span class="linenum">2941</span></a>      <span class="comment">/**</span>
<a name="l2942"><span class="linenum">2942</span></a>  <span class="comment">     * Approve a plan.</span>
<a name="l2943"><span class="linenum">2943</span></a>  <span class="comment">     *</span>
<a name="l2944"><span class="linenum">2944</span></a>  <span class="comment">     * This means making the plan active.</span>
<a name="l2945"><span class="linenum">2945</span></a>  <span class="comment">     *</span>
<a name="l2946"><span class="linenum">2946</span></a>  <span class="comment">     * @param  int|plan $planorid The plan, or its ID.</span>
<a name="l2947"><span class="linenum">2947</span></a>  <span class="comment">     * @return bool</span>
<a name="l2948"><span class="linenum">2948</span></a>  <span class="comment">     */</span>
<a name="l2949"><span class="linenum">2949</span></a>      public static function <a class="function" onClick="logFunction('approve_plan')" href="../../_functions/approve_plan.html" onMouseOver="funcPopup(event,'approve_plan')">approve_plan</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>) {
<a name="l2950"><span class="linenum">2950</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2951"><span class="linenum">2951</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>;
<a name="l2952"><span class="linenum">2952</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>)) {
<a name="l2953"><span class="linenum">2953</span></a>              <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>);
<a name="l2954"><span class="linenum">2954</span></a>          }
<a name="l2955"><span class="linenum">2955</span></a>  
<a name="l2956"><span class="linenum">2956</span></a>  <span class="comment">        // We need to be able to view the plan at least.</span>
<a name="l2957"><span class="linenum">2957</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l2958"><span class="linenum">2958</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:planview', 'nopermissions', '');
<a name="l2959"><span class="linenum">2959</span></a>          }
<a name="l2960"><span class="linenum">2960</span></a>  
<a name="l2961"><span class="linenum">2961</span></a>  <span class="comment">        // We can approve a plan that is either a draft, in review, or waiting for review.</span>
<a name="l2962"><span class="linenum">2962</span></a>          if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('is_based_on_template')" href="../../_functions/is_based_on_template.html" onMouseOver="funcPopup(event,'is_based_on_template')">is_based_on_template</a>()) {
<a name="l2963"><span class="linenum">2963</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Template plans are already approved.');   <span class="comment">// This should never happen.</span>
<a name="l2964"><span class="linenum">2964</span></a>          } else if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('is_draft')" href="../../_functions/is_draft.html" onMouseOver="funcPopup(event,'is_draft')">is_draft</a>()) {
<a name="l2965"><span class="linenum">2965</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('The plan cannot be approved at this stage.');
<a name="l2966"><span class="linenum">2966</span></a>          } else if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_review')" href="../../_functions/can_review.html" onMouseOver="funcPopup(event,'can_review')">can_review</a>()) {
<a name="l2967"><span class="linenum">2967</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:planmanage', 'nopermissions', '');
<a name="l2968"><span class="linenum">2968</span></a>          }
<a name="l2969"><span class="linenum">2969</span></a>  
<a name="l2970"><span class="linenum">2970</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('set_status')" href="../../_functions/set_status.html" onMouseOver="funcPopup(event,'set_status')">set_status</a>(<a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_ACTIVE);
<a name="l2971"><span class="linenum">2971</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;set_reviewerid(null);
<a name="l2972"><span class="linenum">2972</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l2973"><span class="linenum">2973</span></a>  
<a name="l2974"><span class="linenum">2974</span></a>  <span class="comment">        // Trigger approved event.</span>
<a name="l2975"><span class="linenum">2975</span></a>          \core\event\<a class="class" onClick="logClass('competency_plan_approved')" href="../../_classes/competency_plan_approved.html" onMouseOver="classPopup(event,'competency_plan_approved')">competency_plan_approved</a>::<a class="function" onClick="logFunction('create_from_plan')" href="../../_functions/create_from_plan.html" onMouseOver="funcPopup(event,'create_from_plan')">create_from_plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l2976"><span class="linenum">2976</span></a>  
<a name="l2977"><span class="linenum">2977</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l2978"><span class="linenum">2978</span></a>      }
<a name="l2979"><span class="linenum">2979</span></a>  
<a name="l2980"><span class="linenum">2980</span></a>      <span class="comment">/**</span>
<a name="l2981"><span class="linenum">2981</span></a>  <span class="comment">     * Unapprove a plan.</span>
<a name="l2982"><span class="linenum">2982</span></a>  <span class="comment">     *</span>
<a name="l2983"><span class="linenum">2983</span></a>  <span class="comment">     * This means making the plan draft.</span>
<a name="l2984"><span class="linenum">2984</span></a>  <span class="comment">     *</span>
<a name="l2985"><span class="linenum">2985</span></a>  <span class="comment">     * @param  int|plan $planorid The plan, or its ID.</span>
<a name="l2986"><span class="linenum">2986</span></a>  <span class="comment">     * @return bool</span>
<a name="l2987"><span class="linenum">2987</span></a>  <span class="comment">     */</span>
<a name="l2988"><span class="linenum">2988</span></a>      public static function <a class="function" onClick="logFunction('unapprove_plan')" href="../../_functions/unapprove_plan.html" onMouseOver="funcPopup(event,'unapprove_plan')">unapprove_plan</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>) {
<a name="l2989"><span class="linenum">2989</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l2990"><span class="linenum">2990</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>;
<a name="l2991"><span class="linenum">2991</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>)) {
<a name="l2992"><span class="linenum">2992</span></a>              <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>);
<a name="l2993"><span class="linenum">2993</span></a>          }
<a name="l2994"><span class="linenum">2994</span></a>  
<a name="l2995"><span class="linenum">2995</span></a>  <span class="comment">        // We need to be able to view the plan at least.</span>
<a name="l2996"><span class="linenum">2996</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l2997"><span class="linenum">2997</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:planview', 'nopermissions', '');
<a name="l2998"><span class="linenum">2998</span></a>          }
<a name="l2999"><span class="linenum">2999</span></a>  
<a name="l3000"><span class="linenum">3000</span></a>          if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('is_based_on_template')" href="../../_functions/is_based_on_template.html" onMouseOver="funcPopup(event,'is_based_on_template')">is_based_on_template</a>()) {
<a name="l3001"><span class="linenum">3001</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Template plans are always approved.');   <span class="comment">// This should never happen.</span>
<a name="l3002"><span class="linenum">3002</span></a>          } else if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() != <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_ACTIVE) {
<a name="l3003"><span class="linenum">3003</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('The plan cannot be sent back to draft at this stage.');
<a name="l3004"><span class="linenum">3004</span></a>          } else if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_review')" href="../../_functions/can_review.html" onMouseOver="funcPopup(event,'can_review')">can_review</a>()) {
<a name="l3005"><span class="linenum">3005</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:planmanage', 'nopermissions', '');
<a name="l3006"><span class="linenum">3006</span></a>          }
<a name="l3007"><span class="linenum">3007</span></a>  
<a name="l3008"><span class="linenum">3008</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('set_status')" href="../../_functions/set_status.html" onMouseOver="funcPopup(event,'set_status')">set_status</a>(<a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_DRAFT);
<a name="l3009"><span class="linenum">3009</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l3010"><span class="linenum">3010</span></a>  
<a name="l3011"><span class="linenum">3011</span></a>  <span class="comment">        // Trigger unapproved event.</span>
<a name="l3012"><span class="linenum">3012</span></a>          \core\event\<a class="class" onClick="logClass('competency_plan_unapproved')" href="../../_classes/competency_plan_unapproved.html" onMouseOver="classPopup(event,'competency_plan_unapproved')">competency_plan_unapproved</a>::<a class="function" onClick="logFunction('create_from_plan')" href="../../_functions/create_from_plan.html" onMouseOver="funcPopup(event,'create_from_plan')">create_from_plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l3013"><span class="linenum">3013</span></a>  
<a name="l3014"><span class="linenum">3014</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l3015"><span class="linenum">3015</span></a>      }
<a name="l3016"><span class="linenum">3016</span></a>  
<a name="l3017"><span class="linenum">3017</span></a>      <span class="comment">/**</span>
<a name="l3018"><span class="linenum">3018</span></a>  <span class="comment">     * Complete a plan.</span>
<a name="l3019"><span class="linenum">3019</span></a>  <span class="comment">     *</span>
<a name="l3020"><span class="linenum">3020</span></a>  <span class="comment">     * @param int|plan $planorid The plan, or its ID.</span>
<a name="l3021"><span class="linenum">3021</span></a>  <span class="comment">     * @return bool</span>
<a name="l3022"><span class="linenum">3022</span></a>  <span class="comment">     */</span>
<a name="l3023"><span class="linenum">3023</span></a>      public static function <a class="function" onClick="logFunction('complete_plan')" href="../../_functions/complete_plan.html" onMouseOver="funcPopup(event,'complete_plan')">complete_plan</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>) {
<a name="l3024"><span class="linenum">3024</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l3025"><span class="linenum">3025</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3026"><span class="linenum">3026</span></a>  
<a name="l3027"><span class="linenum">3027</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>;
<a name="l3028"><span class="linenum">3028</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>)) {
<a name="l3029"><span class="linenum">3029</span></a>              <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>);
<a name="l3030"><span class="linenum">3030</span></a>          }
<a name="l3031"><span class="linenum">3031</span></a>  
<a name="l3032"><span class="linenum">3032</span></a>  <span class="comment">        // Validate that the plan can be managed.</span>
<a name="l3033"><span class="linenum">3033</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l3034"><span class="linenum">3034</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:planmanage', 'nopermissions', '');
<a name="l3035"><span class="linenum">3035</span></a>          }
<a name="l3036"><span class="linenum">3036</span></a>  
<a name="l3037"><span class="linenum">3037</span></a>  <span class="comment">        // Check if the plan was already completed.</span>
<a name="l3038"><span class="linenum">3038</span></a>          if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() == <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_COMPLETE) {
<a name="l3039"><span class="linenum">3039</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('The plan is already completed.');
<a name="l3040"><span class="linenum">3040</span></a>          }
<a name="l3041"><span class="linenum">3041</span></a>  
<a name="l3042"><span class="linenum">3042</span></a>          <a class="var it15412" onMouseOver="hilite(15412)" onMouseOut="lolite()" onClick="logVariable('originalstatus')" href="../../_variables/originalstatus.html">$originalstatus</a> = <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>();
<a name="l3043"><span class="linenum">3043</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('set_status')" href="../../_functions/set_status.html" onMouseOver="funcPopup(event,'set_status')">set_status</a>(<a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_COMPLETE);
<a name="l3044"><span class="linenum">3044</span></a>  
<a name="l3045"><span class="linenum">3045</span></a>  <span class="comment">        // The user should also be able to manage the plan when it's completed.</span>
<a name="l3046"><span class="linenum">3046</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l3047"><span class="linenum">3047</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:planmanage', 'nopermissions', '');
<a name="l3048"><span class="linenum">3048</span></a>          }
<a name="l3049"><span class="linenum">3049</span></a>  
<a name="l3050"><span class="linenum">3050</span></a>  <span class="comment">        // Put back original status because archive needs it to extract competencies from the right table.</span>
<a name="l3051"><span class="linenum">3051</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('set_status')" href="../../_functions/set_status.html" onMouseOver="funcPopup(event,'set_status')">set_status</a>(<a class="var it15412" onMouseOver="hilite(15412)" onMouseOut="lolite()" onClick="logVariable('originalstatus')" href="../../_variables/originalstatus.html">$originalstatus</a>);
<a name="l3052"><span class="linenum">3052</span></a>  
<a name="l3053"><span class="linenum">3053</span></a>  <span class="comment">        // Do the things.</span>
<a name="l3054"><span class="linenum">3054</span></a>          <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l3055"><span class="linenum">3055</span></a>          self::<a class="function" onClick="logFunction('archive_user_competencies_in_plan')" href="../../_functions/archive_user_competencies_in_plan.html" onMouseOver="funcPopup(event,'archive_user_competencies_in_plan')">archive_user_competencies_in_plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>);
<a name="l3056"><span class="linenum">3056</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('set_status')" href="../../_functions/set_status.html" onMouseOver="funcPopup(event,'set_status')">set_status</a>(<a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_COMPLETE);
<a name="l3057"><span class="linenum">3057</span></a>          <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a> = <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l3058"><span class="linenum">3058</span></a>  
<a name="l3059"><span class="linenum">3059</span></a>          if (!<a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a>) {
<a name="l3060"><span class="linenum">3060</span></a>              <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('rollback')" href="../../_functions/rollback.html" onMouseOver="funcPopup(event,'rollback')">rollback</a>(<span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('The plan could not be updated.'));
<a name="l3061"><span class="linenum">3061</span></a>              return <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a>;
<a name="l3062"><span class="linenum">3062</span></a>          }
<a name="l3063"><span class="linenum">3063</span></a>  
<a name="l3064"><span class="linenum">3064</span></a>          <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l3065"><span class="linenum">3065</span></a>  
<a name="l3066"><span class="linenum">3066</span></a>  <span class="comment">        // Trigger updated event.</span>
<a name="l3067"><span class="linenum">3067</span></a>          \core\event\<a class="class" onClick="logClass('competency_plan_completed')" href="../../_classes/competency_plan_completed.html" onMouseOver="classPopup(event,'competency_plan_completed')">competency_plan_completed</a>::<a class="function" onClick="logFunction('create_from_plan')" href="../../_functions/create_from_plan.html" onMouseOver="funcPopup(event,'create_from_plan')">create_from_plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l3068"><span class="linenum">3068</span></a>  
<a name="l3069"><span class="linenum">3069</span></a>          return <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a>;
<a name="l3070"><span class="linenum">3070</span></a>      }
<a name="l3071"><span class="linenum">3071</span></a>  
<a name="l3072"><span class="linenum">3072</span></a>      <span class="comment">/**</span>
<a name="l3073"><span class="linenum">3073</span></a>  <span class="comment">     * Reopen a plan.</span>
<a name="l3074"><span class="linenum">3074</span></a>  <span class="comment">     *</span>
<a name="l3075"><span class="linenum">3075</span></a>  <span class="comment">     * @param int|plan $planorid The plan, or its ID.</span>
<a name="l3076"><span class="linenum">3076</span></a>  <span class="comment">     * @return bool</span>
<a name="l3077"><span class="linenum">3077</span></a>  <span class="comment">     */</span>
<a name="l3078"><span class="linenum">3078</span></a>      public static function <a class="function" onClick="logFunction('reopen_plan')" href="../../_functions/reopen_plan.html" onMouseOver="funcPopup(event,'reopen_plan')">reopen_plan</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>) {
<a name="l3079"><span class="linenum">3079</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l3080"><span class="linenum">3080</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3081"><span class="linenum">3081</span></a>  
<a name="l3082"><span class="linenum">3082</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>;
<a name="l3083"><span class="linenum">3083</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>)) {
<a name="l3084"><span class="linenum">3084</span></a>              <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>);
<a name="l3085"><span class="linenum">3085</span></a>          }
<a name="l3086"><span class="linenum">3086</span></a>  
<a name="l3087"><span class="linenum">3087</span></a>  <span class="comment">        // Validate that the plan as it is can be managed.</span>
<a name="l3088"><span class="linenum">3088</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l3089"><span class="linenum">3089</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_user')" href="../../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>());
<a name="l3090"><span class="linenum">3090</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:planmanage', 'nopermissions', '');
<a name="l3091"><span class="linenum">3091</span></a>          }
<a name="l3092"><span class="linenum">3092</span></a>  
<a name="l3093"><span class="linenum">3093</span></a>          <a class="var it15541" onMouseOver="hilite(15541)" onMouseOut="lolite()" onClick="logVariable('beforestatus')" href="../../_variables/beforestatus.html">$beforestatus</a> = <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>();
<a name="l3094"><span class="linenum">3094</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('set_status')" href="../../_functions/set_status.html" onMouseOver="funcPopup(event,'set_status')">set_status</a>(<a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_ACTIVE);
<a name="l3095"><span class="linenum">3095</span></a>  
<a name="l3096"><span class="linenum">3096</span></a>  <span class="comment">        // Validate if status can be changed.</span>
<a name="l3097"><span class="linenum">3097</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l3098"><span class="linenum">3098</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_user')" href="../../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>());
<a name="l3099"><span class="linenum">3099</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:planmanage', 'nopermissions', '');
<a name="l3100"><span class="linenum">3100</span></a>          }
<a name="l3101"><span class="linenum">3101</span></a>  
<a name="l3102"><span class="linenum">3102</span></a>  <span class="comment">        // Wrap the updates in a DB transaction.</span>
<a name="l3103"><span class="linenum">3103</span></a>          <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('start_delegated_transaction')" href="../../_functions/start_delegated_transaction.html" onMouseOver="funcPopup(event,'start_delegated_transaction')">start_delegated_transaction</a>();
<a name="l3104"><span class="linenum">3104</span></a>  
<a name="l3105"><span class="linenum">3105</span></a>  <span class="comment">        // Delete archived user competencies if the status of the plan is changed from complete to another status.</span>
<a name="l3106"><span class="linenum">3106</span></a>          <a class="var it30466" onMouseOver="hilite(30466)" onMouseOut="lolite()" onClick="logVariable('mustremovearchivedcompetencies')" href="../../_variables/mustremovearchivedcompetencies.html">$mustremovearchivedcompetencies</a> = (<a class="var it15541" onMouseOver="hilite(15541)" onMouseOut="lolite()" onClick="logVariable('beforestatus')" href="../../_variables/beforestatus.html">$beforestatus</a> == <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_COMPLETE &amp;&amp; <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() != <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_COMPLETE);
<a name="l3107"><span class="linenum">3107</span></a>          if (<a class="var it30466" onMouseOver="hilite(30466)" onMouseOut="lolite()" onClick="logVariable('mustremovearchivedcompetencies')" href="../../_variables/mustremovearchivedcompetencies.html">$mustremovearchivedcompetencies</a>) {
<a name="l3108"><span class="linenum">3108</span></a>              self::<a class="function" onClick="logFunction('remove_archived_user_competencies_in_plan')" href="../../_functions/remove_archived_user_competencies_in_plan.html" onMouseOver="funcPopup(event,'remove_archived_user_competencies_in_plan')">remove_archived_user_competencies_in_plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>);
<a name="l3109"><span class="linenum">3109</span></a>          }
<a name="l3110"><span class="linenum">3110</span></a>  
<a name="l3111"><span class="linenum">3111</span></a>  <span class="comment">        // If duedate less than or equal to duedate_threshold unset it.</span>
<a name="l3112"><span class="linenum">3112</span></a>          if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;get_duedate() &lt;= <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() + <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::DUEDATE_THRESHOLD) {
<a name="l3113"><span class="linenum">3113</span></a>              <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;set_duedate(0);
<a name="l3114"><span class="linenum">3114</span></a>          }
<a name="l3115"><span class="linenum">3115</span></a>  
<a name="l3116"><span class="linenum">3116</span></a>          <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a> = <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l3117"><span class="linenum">3117</span></a>  
<a name="l3118"><span class="linenum">3118</span></a>          if (!<a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a>) {
<a name="l3119"><span class="linenum">3119</span></a>              <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('rollback')" href="../../_functions/rollback.html" onMouseOver="funcPopup(event,'rollback')">rollback</a>(<span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('The plan could not be updated.'));
<a name="l3120"><span class="linenum">3120</span></a>              return <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a>;
<a name="l3121"><span class="linenum">3121</span></a>          }
<a name="l3122"><span class="linenum">3122</span></a>  
<a name="l3123"><span class="linenum">3123</span></a>          <a class="var it4224" onMouseOver="hilite(4224)" onMouseOut="lolite()" onClick="logVariable('transaction')" href="../../_variables/transaction.html">$transaction</a>-&gt;<a class="function" onClick="logFunction('allow_commit')" href="../../_functions/allow_commit.html" onMouseOver="funcPopup(event,'allow_commit')">allow_commit</a>();
<a name="l3124"><span class="linenum">3124</span></a>  
<a name="l3125"><span class="linenum">3125</span></a>  <span class="comment">        // Trigger reopened event.</span>
<a name="l3126"><span class="linenum">3126</span></a>          \core\event\<a class="class" onClick="logClass('competency_plan_reopened')" href="../../_classes/competency_plan_reopened.html" onMouseOver="classPopup(event,'competency_plan_reopened')">competency_plan_reopened</a>::<a class="function" onClick="logFunction('create_from_plan')" href="../../_functions/create_from_plan.html" onMouseOver="funcPopup(event,'create_from_plan')">create_from_plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l3127"><span class="linenum">3127</span></a>  
<a name="l3128"><span class="linenum">3128</span></a>          return <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a>;
<a name="l3129"><span class="linenum">3129</span></a>      }
<a name="l3130"><span class="linenum">3130</span></a>  
<a name="l3131"><span class="linenum">3131</span></a>      <span class="comment">/**</span>
<a name="l3132"><span class="linenum">3132</span></a>  <span class="comment">     * Get a single competency from the user plan.</span>
<a name="l3133"><span class="linenum">3133</span></a>  <span class="comment">     *</span>
<a name="l3134"><span class="linenum">3134</span></a>  <span class="comment">     * @param  int $planorid The plan, or its ID.</span>
<a name="l3135"><span class="linenum">3135</span></a>  <span class="comment">     * @param  int $competencyid The competency id.</span>
<a name="l3136"><span class="linenum">3136</span></a>  <span class="comment">     * @return (object) array(</span>
<a name="l3137"><span class="linenum">3137</span></a>  <span class="comment">     *                      'competency' =&gt; \core_competency\competency,</span>
<a name="l3138"><span class="linenum">3138</span></a>  <span class="comment">     *                      'usercompetency' =&gt; \core_competency\user_competency</span>
<a name="l3139"><span class="linenum">3139</span></a>  <span class="comment">     *                      'usercompetencyplan' =&gt; \core_competency\user_competency_plan</span>
<a name="l3140"><span class="linenum">3140</span></a>  <span class="comment">     *                  )</span>
<a name="l3141"><span class="linenum">3141</span></a>  <span class="comment">     *         The values of of keys usercompetency and usercompetencyplan cannot be defined at the same time.</span>
<a name="l3142"><span class="linenum">3142</span></a>  <span class="comment">     */</span>
<a name="l3143"><span class="linenum">3143</span></a>      public static function <a class="function" onClick="logFunction('get_plan_competency')" href="../../_functions/get_plan_competency.html" onMouseOver="funcPopup(event,'get_plan_competency')">get_plan_competency</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>) {
<a name="l3144"><span class="linenum">3144</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3145"><span class="linenum">3145</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>;
<a name="l3146"><span class="linenum">3146</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>)) {
<a name="l3147"><span class="linenum">3147</span></a>              <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>);
<a name="l3148"><span class="linenum">3148</span></a>          }
<a name="l3149"><span class="linenum">3149</span></a>  
<a name="l3150"><span class="linenum">3150</span></a>          if (!<a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('can_read_user')" href="../../_functions/can_read_user.html" onMouseOver="funcPopup(event,'can_read_user')">can_read_user</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>())) {
<a name="l3151"><span class="linenum">3151</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:usercompetencyview',
<a name="l3152"><span class="linenum">3152</span></a>                  'nopermissions', '');
<a name="l3153"><span class="linenum">3153</span></a>          }
<a name="l3154"><span class="linenum">3154</span></a>  
<a name="l3155"><span class="linenum">3155</span></a>          <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_competency')" href="../../_functions/get_competency.html" onMouseOver="funcPopup(event,'get_competency')">get_competency</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l3156"><span class="linenum">3156</span></a>  
<a name="l3157"><span class="linenum">3157</span></a>  <span class="comment">        // Get user competencies from user_competency_plan if the plan status is set to complete.</span>
<a name="l3158"><span class="linenum">3158</span></a>          <a class="var it30467" onMouseOver="hilite(30467)" onMouseOut="lolite()" onClick="logVariable('iscompletedplan')" href="../../_variables/iscompletedplan.html">$iscompletedplan</a> = <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() == <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_COMPLETE;
<a name="l3159"><span class="linenum">3159</span></a>          if (<a class="var it30467" onMouseOver="hilite(30467)" onMouseOut="lolite()" onClick="logVariable('iscompletedplan')" href="../../_variables/iscompletedplan.html">$iscompletedplan</a>) {
<a name="l3160"><span class="linenum">3160</span></a>              <a class="var it9647" onMouseOver="hilite(9647)" onMouseOut="lolite()" onClick="logVariable('usercompetencies')" href="../../_variables/usercompetencies.html">$usercompetencies</a> = <a class="class" onClick="logClass('user_competency_plan')" href="../../_classes/user_competency_plan.html" onMouseOver="classPopup(event,'user_competency_plan')">user_competency_plan</a>::<a class="function" onClick="logFunction('get_multiple')" href="../../_functions/get_multiple.html" onMouseOver="funcPopup(event,'get_multiple')">get_multiple</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>(), <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(), array(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>));
<a name="l3161"><span class="linenum">3161</span></a>              <a class="var it30468" onMouseOver="hilite(30468)" onMouseOut="lolite()" onClick="logVariable('ucresultkey')" href="../../_variables/ucresultkey.html">$ucresultkey</a> = 'usercompetencyplan';
<a name="l3162"><span class="linenum">3162</span></a>          } else {
<a name="l3163"><span class="linenum">3163</span></a>              <a class="var it9647" onMouseOver="hilite(9647)" onMouseOut="lolite()" onClick="logVariable('usercompetencies')" href="../../_variables/usercompetencies.html">$usercompetencies</a> = <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('get_multiple')" href="../../_functions/get_multiple.html" onMouseOver="funcPopup(event,'get_multiple')">get_multiple</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>(), array(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>));
<a name="l3164"><span class="linenum">3164</span></a>              <a class="var it30468" onMouseOver="hilite(30468)" onMouseOut="lolite()" onClick="logVariable('ucresultkey')" href="../../_variables/ucresultkey.html">$ucresultkey</a> = 'usercompetency';
<a name="l3165"><span class="linenum">3165</span></a>          }
<a name="l3166"><span class="linenum">3166</span></a>  
<a name="l3167"><span class="linenum">3167</span></a>          <a class="var it811" onMouseOver="hilite(811)" onMouseOut="lolite()" onClick="logVariable('found')" href="../../_variables/found.html">$found</a> = <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it9647" onMouseOver="hilite(9647)" onMouseOut="lolite()" onClick="logVariable('usercompetencies')" href="../../_variables/usercompetencies.html">$usercompetencies</a>);
<a name="l3168"><span class="linenum">3168</span></a>  
<a name="l3169"><span class="linenum">3169</span></a>          if (<a class="var it811" onMouseOver="hilite(811)" onMouseOut="lolite()" onClick="logVariable('found')" href="../../_variables/found.html">$found</a>) {
<a name="l3170"><span class="linenum">3170</span></a>              <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> = <a class="phpfunction" onClick="logFunction('array_pop')" href="../../_functions/array_pop.html" onMouseOver="phpfuncPopup(event,'array_pop')">array_pop</a>(<a class="var it9647" onMouseOver="hilite(9647)" onMouseOut="lolite()" onClick="logVariable('usercompetencies')" href="../../_variables/usercompetencies.html">$usercompetencies</a>);
<a name="l3171"><span class="linenum">3171</span></a>          } else {
<a name="l3172"><span class="linenum">3172</span></a>              if (<a class="var it30467" onMouseOver="hilite(30467)" onMouseOut="lolite()" onClick="logVariable('iscompletedplan')" href="../../_variables/iscompletedplan.html">$iscompletedplan</a>) {
<a name="l3173"><span class="linenum">3173</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('A user competency plan is missing');
<a name="l3174"><span class="linenum">3174</span></a>              } else {
<a name="l3175"><span class="linenum">3175</span></a>                  <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> = <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('create_relation')" href="../../_functions/create_relation.html" onMouseOver="funcPopup(event,'create_relation')">create_relation</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>(), <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>());
<a name="l3176"><span class="linenum">3176</span></a>                  <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l3177"><span class="linenum">3177</span></a>              }
<a name="l3178"><span class="linenum">3178</span></a>          }
<a name="l3179"><span class="linenum">3179</span></a>  
<a name="l3180"><span class="linenum">3180</span></a>          <a class="var it10074" onMouseOver="hilite(10074)" onMouseOut="lolite()" onClick="logVariable('plancompetency')" href="../../_variables/plancompetency.html">$plancompetency</a> = (object) array(
<a name="l3181"><span class="linenum">3181</span></a>              'competency' =&gt; <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>,
<a name="l3182"><span class="linenum">3182</span></a>              'usercompetency' =&gt; null,
<a name="l3183"><span class="linenum">3183</span></a>              'usercompetencyplan' =&gt; null
<a name="l3184"><span class="linenum">3184</span></a>          );
<a name="l3185"><span class="linenum">3185</span></a>          <a class="var it10074" onMouseOver="hilite(10074)" onMouseOut="lolite()" onClick="logVariable('plancompetency')" href="../../_variables/plancompetency.html">$plancompetency</a>-&gt;<a class="var it30468" onMouseOver="hilite(30468)" onMouseOut="lolite()" onClick="logVariable('ucresultkey')" href="../../_variables/ucresultkey.html">$ucresultkey</a> = <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>;
<a name="l3186"><span class="linenum">3186</span></a>  
<a name="l3187"><span class="linenum">3187</span></a>          return <a class="var it10074" onMouseOver="hilite(10074)" onMouseOut="lolite()" onClick="logVariable('plancompetency')" href="../../_variables/plancompetency.html">$plancompetency</a>;
<a name="l3188"><span class="linenum">3188</span></a>      }
<a name="l3189"><span class="linenum">3189</span></a>  
<a name="l3190"><span class="linenum">3190</span></a>      <span class="comment">/**</span>
<a name="l3191"><span class="linenum">3191</span></a>  <span class="comment">     * List the competencies in a user plan.</span>
<a name="l3192"><span class="linenum">3192</span></a>  <span class="comment">     *</span>
<a name="l3193"><span class="linenum">3193</span></a>  <span class="comment">     * @param  int $planorid The plan, or its ID.</span>
<a name="l3194"><span class="linenum">3194</span></a>  <span class="comment">     * @return array((object) array(</span>
<a name="l3195"><span class="linenum">3195</span></a>  <span class="comment">     *                            'competency' =&gt; \core_competency\competency,</span>
<a name="l3196"><span class="linenum">3196</span></a>  <span class="comment">     *                            'usercompetency' =&gt; \core_competency\user_competency</span>
<a name="l3197"><span class="linenum">3197</span></a>  <span class="comment">     *                            'usercompetencyplan' =&gt; \core_competency\user_competency_plan</span>
<a name="l3198"><span class="linenum">3198</span></a>  <span class="comment">     *                        ))</span>
<a name="l3199"><span class="linenum">3199</span></a>  <span class="comment">     *         The values of of keys usercompetency and usercompetencyplan cannot be defined at the same time.</span>
<a name="l3200"><span class="linenum">3200</span></a>  <span class="comment">     */</span>
<a name="l3201"><span class="linenum">3201</span></a>      public static function <a class="function" onClick="logFunction('list_plan_competencies')" href="../../_functions/list_plan_competencies.html" onMouseOver="funcPopup(event,'list_plan_competencies')">list_plan_competencies</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>) {
<a name="l3202"><span class="linenum">3202</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3203"><span class="linenum">3203</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>;
<a name="l3204"><span class="linenum">3204</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>)) {
<a name="l3205"><span class="linenum">3205</span></a>              <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>);
<a name="l3206"><span class="linenum">3206</span></a>          }
<a name="l3207"><span class="linenum">3207</span></a>  
<a name="l3208"><span class="linenum">3208</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l3209"><span class="linenum">3209</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_user')" href="../../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>());
<a name="l3210"><span class="linenum">3210</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:planview', 'nopermissions', '');
<a name="l3211"><span class="linenum">3211</span></a>          }
<a name="l3212"><span class="linenum">3212</span></a>  
<a name="l3213"><span class="linenum">3213</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = array();
<a name="l3214"><span class="linenum">3214</span></a>          <a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a> = <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_competencies')" href="../../_functions/get_competencies.html" onMouseOver="funcPopup(event,'get_competencies')">get_competencies</a>();
<a name="l3215"><span class="linenum">3215</span></a>  
<a name="l3216"><span class="linenum">3216</span></a>  <span class="comment">        // Get user competencies from user_competency_plan if the plan status is set to complete.</span>
<a name="l3217"><span class="linenum">3217</span></a>          <a class="var it30467" onMouseOver="hilite(30467)" onMouseOut="lolite()" onClick="logVariable('iscompletedplan')" href="../../_variables/iscompletedplan.html">$iscompletedplan</a> = <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() == <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_COMPLETE;
<a name="l3218"><span class="linenum">3218</span></a>          if (<a class="var it30467" onMouseOver="hilite(30467)" onMouseOut="lolite()" onClick="logVariable('iscompletedplan')" href="../../_variables/iscompletedplan.html">$iscompletedplan</a>) {
<a name="l3219"><span class="linenum">3219</span></a>              <a class="var it9647" onMouseOver="hilite(9647)" onMouseOut="lolite()" onClick="logVariable('usercompetencies')" href="../../_variables/usercompetencies.html">$usercompetencies</a> = <a class="class" onClick="logClass('user_competency_plan')" href="../../_classes/user_competency_plan.html" onMouseOver="classPopup(event,'user_competency_plan')">user_competency_plan</a>::<a class="function" onClick="logFunction('get_multiple')" href="../../_functions/get_multiple.html" onMouseOver="funcPopup(event,'get_multiple')">get_multiple</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>(), <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(), <a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a>);
<a name="l3220"><span class="linenum">3220</span></a>              <a class="var it30468" onMouseOver="hilite(30468)" onMouseOut="lolite()" onClick="logVariable('ucresultkey')" href="../../_variables/ucresultkey.html">$ucresultkey</a> = 'usercompetencyplan';
<a name="l3221"><span class="linenum">3221</span></a>          } else {
<a name="l3222"><span class="linenum">3222</span></a>              <a class="var it9647" onMouseOver="hilite(9647)" onMouseOut="lolite()" onClick="logVariable('usercompetencies')" href="../../_variables/usercompetencies.html">$usercompetencies</a> = <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('get_multiple')" href="../../_functions/get_multiple.html" onMouseOver="funcPopup(event,'get_multiple')">get_multiple</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>(), <a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a>);
<a name="l3223"><span class="linenum">3223</span></a>              <a class="var it30468" onMouseOver="hilite(30468)" onMouseOut="lolite()" onClick="logVariable('ucresultkey')" href="../../_variables/ucresultkey.html">$ucresultkey</a> = 'usercompetency';
<a name="l3224"><span class="linenum">3224</span></a>          }
<a name="l3225"><span class="linenum">3225</span></a>  
<a name="l3226"><span class="linenum">3226</span></a>  <span class="comment">        // Build the return values.</span>
<a name="l3227"><span class="linenum">3227</span></a>          foreach (<a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a> as <a class="var it118" onMouseOver="hilite(118)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> =&gt; <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>) {
<a name="l3228"><span class="linenum">3228</span></a>              <a class="var it811" onMouseOver="hilite(811)" onMouseOut="lolite()" onClick="logVariable('found')" href="../../_variables/found.html">$found</a> = false;
<a name="l3229"><span class="linenum">3229</span></a>  
<a name="l3230"><span class="linenum">3230</span></a>              foreach (<a class="var it9647" onMouseOver="hilite(9647)" onMouseOut="lolite()" onClick="logVariable('usercompetencies')" href="../../_variables/usercompetencies.html">$usercompetencies</a> as <a class="var it30469" onMouseOver="hilite(30469)" onMouseOut="lolite()" onClick="logVariable('uckey')" href="../../_variables/uckey.html">$uckey</a> =&gt; <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>) {
<a name="l3231"><span class="linenum">3231</span></a>                  if (<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;get_competencyid() == <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>()) {
<a name="l3232"><span class="linenum">3232</span></a>                      <a class="var it811" onMouseOver="hilite(811)" onMouseOut="lolite()" onClick="logVariable('found')" href="../../_variables/found.html">$found</a> = true;
<a name="l3233"><span class="linenum">3233</span></a>                      unset(<a class="var it9647" onMouseOver="hilite(9647)" onMouseOut="lolite()" onClick="logVariable('usercompetencies')" href="../../_variables/usercompetencies.html">$usercompetencies</a>[<a class="var it30469" onMouseOver="hilite(30469)" onMouseOut="lolite()" onClick="logVariable('uckey')" href="../../_variables/uckey.html">$uckey</a>]);
<a name="l3234"><span class="linenum">3234</span></a>                      break;
<a name="l3235"><span class="linenum">3235</span></a>                  }
<a name="l3236"><span class="linenum">3236</span></a>              }
<a name="l3237"><span class="linenum">3237</span></a>  
<a name="l3238"><span class="linenum">3238</span></a>              if (!<a class="var it811" onMouseOver="hilite(811)" onMouseOut="lolite()" onClick="logVariable('found')" href="../../_variables/found.html">$found</a>) {
<a name="l3239"><span class="linenum">3239</span></a>                  if (<a class="var it30467" onMouseOver="hilite(30467)" onMouseOut="lolite()" onClick="logVariable('iscompletedplan')" href="../../_variables/iscompletedplan.html">$iscompletedplan</a>) {
<a name="l3240"><span class="linenum">3240</span></a>                      throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('A user competency plan is missing');
<a name="l3241"><span class="linenum">3241</span></a>                  } else {
<a name="l3242"><span class="linenum">3242</span></a>                      <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> = <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('create_relation')" href="../../_functions/create_relation.html" onMouseOver="funcPopup(event,'create_relation')">create_relation</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>(), <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>());
<a name="l3243"><span class="linenum">3243</span></a>                  }
<a name="l3244"><span class="linenum">3244</span></a>              }
<a name="l3245"><span class="linenum">3245</span></a>  
<a name="l3246"><span class="linenum">3246</span></a>              <a class="var it10074" onMouseOver="hilite(10074)" onMouseOut="lolite()" onClick="logVariable('plancompetency')" href="../../_variables/plancompetency.html">$plancompetency</a> = (object) array(
<a name="l3247"><span class="linenum">3247</span></a>                  'competency' =&gt; <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>,
<a name="l3248"><span class="linenum">3248</span></a>                  'usercompetency' =&gt; null,
<a name="l3249"><span class="linenum">3249</span></a>                  'usercompetencyplan' =&gt; null
<a name="l3250"><span class="linenum">3250</span></a>              );
<a name="l3251"><span class="linenum">3251</span></a>              <a class="var it10074" onMouseOver="hilite(10074)" onMouseOut="lolite()" onClick="logVariable('plancompetency')" href="../../_variables/plancompetency.html">$plancompetency</a>-&gt;<a class="var it30468" onMouseOver="hilite(30468)" onMouseOut="lolite()" onClick="logVariable('ucresultkey')" href="../../_variables/ucresultkey.html">$ucresultkey</a> = <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>;
<a name="l3252"><span class="linenum">3252</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>[] = <a class="var it10074" onMouseOver="hilite(10074)" onMouseOut="lolite()" onClick="logVariable('plancompetency')" href="../../_variables/plancompetency.html">$plancompetency</a>;
<a name="l3253"><span class="linenum">3253</span></a>          }
<a name="l3254"><span class="linenum">3254</span></a>  
<a name="l3255"><span class="linenum">3255</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l3256"><span class="linenum">3256</span></a>      }
<a name="l3257"><span class="linenum">3257</span></a>  
<a name="l3258"><span class="linenum">3258</span></a>      <span class="comment">/**</span>
<a name="l3259"><span class="linenum">3259</span></a>  <span class="comment">     * Add a competency to a plan.</span>
<a name="l3260"><span class="linenum">3260</span></a>  <span class="comment">     *</span>
<a name="l3261"><span class="linenum">3261</span></a>  <span class="comment">     * @param int $planid The id of the plan</span>
<a name="l3262"><span class="linenum">3262</span></a>  <span class="comment">     * @param int $competencyid The id of the competency</span>
<a name="l3263"><span class="linenum">3263</span></a>  <span class="comment">     * @return bool</span>
<a name="l3264"><span class="linenum">3264</span></a>  <span class="comment">     */</span>
<a name="l3265"><span class="linenum">3265</span></a>      public static function <a class="function" onClick="logFunction('add_competency_to_plan')" href="../../_functions/add_competency_to_plan.html" onMouseOver="funcPopup(event,'add_competency_to_plan')">add_competency_to_plan</a>(<a class="var it5441" onMouseOver="hilite(5441)" onMouseOut="lolite()" onClick="logVariable('planid')" href="../../_variables/planid.html">$planid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>) {
<a name="l3266"><span class="linenum">3266</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3267"><span class="linenum">3267</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(<a class="var it5441" onMouseOver="hilite(5441)" onMouseOut="lolite()" onClick="logVariable('planid')" href="../../_variables/planid.html">$planid</a>);
<a name="l3268"><span class="linenum">3268</span></a>  
<a name="l3269"><span class="linenum">3269</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l3270"><span class="linenum">3270</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l3271"><span class="linenum">3271</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:planmanage', 'nopermissions', '');
<a name="l3272"><span class="linenum">3272</span></a>  
<a name="l3273"><span class="linenum">3273</span></a>          } else if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('is_based_on_template')" href="../../_functions/is_based_on_template.html" onMouseOver="funcPopup(event,'is_based_on_template')">is_based_on_template</a>()) {
<a name="l3274"><span class="linenum">3274</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('A competency can not be added to a learning plan based on a template');
<a name="l3275"><span class="linenum">3275</span></a>          }
<a name="l3276"><span class="linenum">3276</span></a>  
<a name="l3277"><span class="linenum">3277</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_be_edited')" href="../../_functions/can_be_edited.html" onMouseOver="funcPopup(event,'can_be_edited')">can_be_edited</a>()) {
<a name="l3278"><span class="linenum">3278</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('A competency can not be added to a learning plan completed');
<a name="l3279"><span class="linenum">3279</span></a>          }
<a name="l3280"><span class="linenum">3280</span></a>  
<a name="l3281"><span class="linenum">3281</span></a>          <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l3282"><span class="linenum">3282</span></a>  
<a name="l3283"><span class="linenum">3283</span></a>  <span class="comment">        // Can not add a competency that belong to a hidden framework.</span>
<a name="l3284"><span class="linenum">3284</span></a>          if (<a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_framework')" href="../../_functions/get_framework.html" onMouseOver="funcPopup(event,'get_framework')">get_framework</a>()-&gt;<a class="function" onClick="logFunction('get_visible')" href="../../_functions/get_visible.html" onMouseOver="funcPopup(event,'get_visible')">get_visible</a>() == false) {
<a name="l3285"><span class="linenum">3285</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('A competency belonging to hidden framework can not be added');
<a name="l3286"><span class="linenum">3286</span></a>          }
<a name="l3287"><span class="linenum">3287</span></a>  
<a name="l3288"><span class="linenum">3288</span></a>          <a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a> = <a class="class" onClick="logClass('plan_competency')" href="../../_classes/plan_competency.html" onMouseOver="classPopup(event,'plan_competency')">plan_competency</a>::<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(array('planid' =&gt; <a class="var it5441" onMouseOver="hilite(5441)" onMouseOut="lolite()" onClick="logVariable('planid')" href="../../_variables/planid.html">$planid</a>, 'competencyid' =&gt; <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>));
<a name="l3289"><span class="linenum">3289</span></a>          if (!<a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a>) {
<a name="l3290"><span class="linenum">3290</span></a>              <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a> = new stdClass();
<a name="l3291"><span class="linenum">3291</span></a>              <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('planid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/planid.html">planid</a> = <a class="var it5441" onMouseOver="hilite(5441)" onMouseOut="lolite()" onClick="logVariable('planid')" href="../../_variables/planid.html">$planid</a>;
<a name="l3292"><span class="linenum">3292</span></a>              <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('competencyid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/competencyid.html">competencyid</a> = <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>;
<a name="l3293"><span class="linenum">3293</span></a>              <a class="var it10074" onMouseOver="hilite(10074)" onMouseOut="lolite()" onClick="logVariable('plancompetency')" href="../../_variables/plancompetency.html">$plancompetency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan_competency')" href="../../_classes/plan_competency.html" onMouseOver="classPopup(event,'plan_competency')">plan_competency</a>(0, <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>);
<a name="l3294"><span class="linenum">3294</span></a>              <a class="var it10074" onMouseOver="hilite(10074)" onMouseOut="lolite()" onClick="logVariable('plancompetency')" href="../../_variables/plancompetency.html">$plancompetency</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l3295"><span class="linenum">3295</span></a>          }
<a name="l3296"><span class="linenum">3296</span></a>  
<a name="l3297"><span class="linenum">3297</span></a>          return true;
<a name="l3298"><span class="linenum">3298</span></a>      }
<a name="l3299"><span class="linenum">3299</span></a>  
<a name="l3300"><span class="linenum">3300</span></a>      <span class="comment">/**</span>
<a name="l3301"><span class="linenum">3301</span></a>  <span class="comment">     * Remove a competency from a plan.</span>
<a name="l3302"><span class="linenum">3302</span></a>  <span class="comment">     *</span>
<a name="l3303"><span class="linenum">3303</span></a>  <span class="comment">     * @param int $planid The plan id</span>
<a name="l3304"><span class="linenum">3304</span></a>  <span class="comment">     * @param int $competencyid The id of the competency</span>
<a name="l3305"><span class="linenum">3305</span></a>  <span class="comment">     * @return bool</span>
<a name="l3306"><span class="linenum">3306</span></a>  <span class="comment">     */</span>
<a name="l3307"><span class="linenum">3307</span></a>      public static function <a class="function" onClick="logFunction('remove_competency_from_plan')" href="../../_functions/remove_competency_from_plan.html" onMouseOver="funcPopup(event,'remove_competency_from_plan')">remove_competency_from_plan</a>(<a class="var it5441" onMouseOver="hilite(5441)" onMouseOut="lolite()" onClick="logVariable('planid')" href="../../_variables/planid.html">$planid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>) {
<a name="l3308"><span class="linenum">3308</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3309"><span class="linenum">3309</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(<a class="var it5441" onMouseOver="hilite(5441)" onMouseOut="lolite()" onClick="logVariable('planid')" href="../../_variables/planid.html">$planid</a>);
<a name="l3310"><span class="linenum">3310</span></a>  
<a name="l3311"><span class="linenum">3311</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l3312"><span class="linenum">3312</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l3313"><span class="linenum">3313</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_user')" href="../../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>());
<a name="l3314"><span class="linenum">3314</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:planmanage', 'nopermissions', '');
<a name="l3315"><span class="linenum">3315</span></a>  
<a name="l3316"><span class="linenum">3316</span></a>          } else if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('is_based_on_template')" href="../../_functions/is_based_on_template.html" onMouseOver="funcPopup(event,'is_based_on_template')">is_based_on_template</a>()) {
<a name="l3317"><span class="linenum">3317</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('A competency can not be removed from a learning plan based on a template');
<a name="l3318"><span class="linenum">3318</span></a>          }
<a name="l3319"><span class="linenum">3319</span></a>  
<a name="l3320"><span class="linenum">3320</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_be_edited')" href="../../_functions/can_be_edited.html" onMouseOver="funcPopup(event,'can_be_edited')">can_be_edited</a>()) {
<a name="l3321"><span class="linenum">3321</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('A competency can not be removed from a learning plan completed');
<a name="l3322"><span class="linenum">3322</span></a>          }
<a name="l3323"><span class="linenum">3323</span></a>  
<a name="l3324"><span class="linenum">3324</span></a>          <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a> = <a class="class" onClick="logClass('plan_competency')" href="../../_classes/plan_competency.html" onMouseOver="classPopup(event,'plan_competency')">plan_competency</a>::<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(array('planid' =&gt; <a class="var it5441" onMouseOver="hilite(5441)" onMouseOut="lolite()" onClick="logVariable('planid')" href="../../_variables/planid.html">$planid</a>, 'competencyid' =&gt; <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>));
<a name="l3325"><span class="linenum">3325</span></a>          if (<a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a>) {
<a name="l3326"><span class="linenum">3326</span></a>              return <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l3327"><span class="linenum">3327</span></a>          }
<a name="l3328"><span class="linenum">3328</span></a>          return false;
<a name="l3329"><span class="linenum">3329</span></a>      }
<a name="l3330"><span class="linenum">3330</span></a>  
<a name="l3331"><span class="linenum">3331</span></a>      <span class="comment">/**</span>
<a name="l3332"><span class="linenum">3332</span></a>  <span class="comment">     * Move the plan competency up or down in the display list.</span>
<a name="l3333"><span class="linenum">3333</span></a>  <span class="comment">     *</span>
<a name="l3334"><span class="linenum">3334</span></a>  <span class="comment">     * Requires moodle/competency:planmanage capability at the system context.</span>
<a name="l3335"><span class="linenum">3335</span></a>  <span class="comment">     *</span>
<a name="l3336"><span class="linenum">3336</span></a>  <span class="comment">     * @param int $planid The plan  id</span>
<a name="l3337"><span class="linenum">3337</span></a>  <span class="comment">     * @param int $competencyidfrom The id of the competency we are moving.</span>
<a name="l3338"><span class="linenum">3338</span></a>  <span class="comment">     * @param int $competencyidto The id of the competency we are moving to.</span>
<a name="l3339"><span class="linenum">3339</span></a>  <span class="comment">     * @return boolean</span>
<a name="l3340"><span class="linenum">3340</span></a>  <span class="comment">     */</span>
<a name="l3341"><span class="linenum">3341</span></a>      public static function <a class="function" onClick="logFunction('reorder_plan_competency')" href="../../_functions/reorder_plan_competency.html" onMouseOver="funcPopup(event,'reorder_plan_competency')">reorder_plan_competency</a>(<a class="var it5441" onMouseOver="hilite(5441)" onMouseOut="lolite()" onClick="logVariable('planid')" href="../../_variables/planid.html">$planid</a>, <a class="var it30448" onMouseOver="hilite(30448)" onMouseOut="lolite()" onClick="logVariable('competencyidfrom')" href="../../_variables/competencyidfrom.html">$competencyidfrom</a>, <a class="var it30449" onMouseOver="hilite(30449)" onMouseOut="lolite()" onClick="logVariable('competencyidto')" href="../../_variables/competencyidto.html">$competencyidto</a>) {
<a name="l3342"><span class="linenum">3342</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3343"><span class="linenum">3343</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(<a class="var it5441" onMouseOver="hilite(5441)" onMouseOut="lolite()" onClick="logVariable('planid')" href="../../_variables/planid.html">$planid</a>);
<a name="l3344"><span class="linenum">3344</span></a>  
<a name="l3345"><span class="linenum">3345</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l3346"><span class="linenum">3346</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l3347"><span class="linenum">3347</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_user')" href="../../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>());
<a name="l3348"><span class="linenum">3348</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:planmanage', 'nopermissions', '');
<a name="l3349"><span class="linenum">3349</span></a>  
<a name="l3350"><span class="linenum">3350</span></a>          } else if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('is_based_on_template')" href="../../_functions/is_based_on_template.html" onMouseOver="funcPopup(event,'is_based_on_template')">is_based_on_template</a>()) {
<a name="l3351"><span class="linenum">3351</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('A competency can not be reordered in a learning plan based on a template');
<a name="l3352"><span class="linenum">3352</span></a>          }
<a name="l3353"><span class="linenum">3353</span></a>  
<a name="l3354"><span class="linenum">3354</span></a>          if (!<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('can_be_edited')" href="../../_functions/can_be_edited.html" onMouseOver="funcPopup(event,'can_be_edited')">can_be_edited</a>()) {
<a name="l3355"><span class="linenum">3355</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('A competency can not be reordered in a learning plan completed');
<a name="l3356"><span class="linenum">3356</span></a>          }
<a name="l3357"><span class="linenum">3357</span></a>  
<a name="l3358"><span class="linenum">3358</span></a>          <a class="var it11446" onMouseOver="hilite(11446)" onMouseOut="lolite()" onClick="logVariable('down')" href="../../_variables/down.html">$down</a> = true;
<a name="l3359"><span class="linenum">3359</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = <a class="class" onClick="logClass('plan_competency')" href="../../_classes/plan_competency.html" onMouseOver="classPopup(event,'plan_competency')">plan_competency</a>::<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(array('planid' =&gt; <a class="var it5441" onMouseOver="hilite(5441)" onMouseOut="lolite()" onClick="logVariable('planid')" href="../../_variables/planid.html">$planid</a>, 'competencyid' =&gt; <a class="var it30448" onMouseOver="hilite(30448)" onMouseOut="lolite()" onClick="logVariable('competencyidfrom')" href="../../_variables/competencyidfrom.html">$competencyidfrom</a>));
<a name="l3360"><span class="linenum">3360</span></a>          if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>) == 0) {
<a name="l3361"><span class="linenum">3361</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('The link does not exist');
<a name="l3362"><span class="linenum">3362</span></a>          }
<a name="l3363"><span class="linenum">3363</span></a>  
<a name="l3364"><span class="linenum">3364</span></a>          <a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a> = <a class="phpfunction" onClick="logFunction('array_pop')" href="../../_functions/array_pop.html" onMouseOver="phpfuncPopup(event,'array_pop')">array_pop</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>);
<a name="l3365"><span class="linenum">3365</span></a>          <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = <a class="class" onClick="logClass('plan_competency')" href="../../_classes/plan_competency.html" onMouseOver="classPopup(event,'plan_competency')">plan_competency</a>::<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(array('planid' =&gt; <a class="var it5441" onMouseOver="hilite(5441)" onMouseOut="lolite()" onClick="logVariable('planid')" href="../../_variables/planid.html">$planid</a>, 'competencyid' =&gt; <a class="var it30449" onMouseOver="hilite(30449)" onMouseOut="lolite()" onClick="logVariable('competencyidto')" href="../../_variables/competencyidto.html">$competencyidto</a>));
<a name="l3366"><span class="linenum">3366</span></a>          if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>) == 0) {
<a name="l3367"><span class="linenum">3367</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('The link does not exist');
<a name="l3368"><span class="linenum">3368</span></a>          }
<a name="l3369"><span class="linenum">3369</span></a>  
<a name="l3370"><span class="linenum">3370</span></a>          <a class="var it30451" onMouseOver="hilite(30451)" onMouseOut="lolite()" onClick="logVariable('competencyto')" href="../../_variables/competencyto.html">$competencyto</a> = <a class="phpfunction" onClick="logFunction('array_pop')" href="../../_functions/array_pop.html" onMouseOver="phpfuncPopup(event,'array_pop')">array_pop</a>(<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>);
<a name="l3371"><span class="linenum">3371</span></a>  
<a name="l3372"><span class="linenum">3372</span></a>          <a class="var it5375" onMouseOver="hilite(5375)" onMouseOut="lolite()" onClick="logVariable('all')" href="../../_variables/all.html">$all</a> = <a class="class" onClick="logClass('plan_competency')" href="../../_classes/plan_competency.html" onMouseOver="classPopup(event,'plan_competency')">plan_competency</a>::<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(array('planid' =&gt; <a class="var it5441" onMouseOver="hilite(5441)" onMouseOut="lolite()" onClick="logVariable('planid')" href="../../_variables/planid.html">$planid</a>), 'sortorder', 'ASC', 0, 0);
<a name="l3373"><span class="linenum">3373</span></a>  
<a name="l3374"><span class="linenum">3374</span></a>          if (<a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>() &gt; <a class="var it30451" onMouseOver="hilite(30451)" onMouseOut="lolite()" onClick="logVariable('competencyto')" href="../../_variables/competencyto.html">$competencyto</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>()) {
<a name="l3375"><span class="linenum">3375</span></a>  <span class="comment">            // We are moving up, so put it before the &quot;to&quot; item.</span>
<a name="l3376"><span class="linenum">3376</span></a>              <a class="var it11446" onMouseOver="hilite(11446)" onMouseOut="lolite()" onClick="logVariable('down')" href="../../_variables/down.html">$down</a> = false;
<a name="l3377"><span class="linenum">3377</span></a>          }
<a name="l3378"><span class="linenum">3378</span></a>  
<a name="l3379"><span class="linenum">3379</span></a>          foreach (<a class="var it5375" onMouseOver="hilite(5375)" onMouseOut="lolite()" onClick="logVariable('all')" href="../../_variables/all.html">$all</a> as <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a> =&gt; <a class="var it10074" onMouseOver="hilite(10074)" onMouseOut="lolite()" onClick="logVariable('plancompetency')" href="../../_variables/plancompetency.html">$plancompetency</a>) {
<a name="l3380"><span class="linenum">3380</span></a>              <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> = <a class="var it10074" onMouseOver="hilite(10074)" onMouseOut="lolite()" onClick="logVariable('plancompetency')" href="../../_variables/plancompetency.html">$plancompetency</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>();
<a name="l3381"><span class="linenum">3381</span></a>              if (<a class="var it11446" onMouseOver="hilite(11446)" onMouseOut="lolite()" onClick="logVariable('down')" href="../../_variables/down.html">$down</a> &amp;&amp; <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> &gt; <a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>() &amp;&amp; <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> &lt;= <a class="var it30451" onMouseOver="hilite(30451)" onMouseOut="lolite()" onClick="logVariable('competencyto')" href="../../_variables/competencyto.html">$competencyto</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>()) {
<a name="l3382"><span class="linenum">3382</span></a>                  <a class="var it10074" onMouseOver="hilite(10074)" onMouseOut="lolite()" onClick="logVariable('plancompetency')" href="../../_variables/plancompetency.html">$plancompetency</a>-&gt;<a class="function" onClick="logFunction('set_sortorder')" href="../../_functions/set_sortorder.html" onMouseOver="funcPopup(event,'set_sortorder')">set_sortorder</a>(<a class="var it10074" onMouseOver="hilite(10074)" onMouseOut="lolite()" onClick="logVariable('plancompetency')" href="../../_variables/plancompetency.html">$plancompetency</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>() - 1);
<a name="l3383"><span class="linenum">3383</span></a>                  <a class="var it10074" onMouseOver="hilite(10074)" onMouseOut="lolite()" onClick="logVariable('plancompetency')" href="../../_variables/plancompetency.html">$plancompetency</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l3384"><span class="linenum">3384</span></a>              } else if (!<a class="var it11446" onMouseOver="hilite(11446)" onMouseOut="lolite()" onClick="logVariable('down')" href="../../_variables/down.html">$down</a> &amp;&amp; <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> &gt;= <a class="var it30451" onMouseOver="hilite(30451)" onMouseOut="lolite()" onClick="logVariable('competencyto')" href="../../_variables/competencyto.html">$competencyto</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>() &amp;&amp; <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> &lt; <a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>()) {
<a name="l3385"><span class="linenum">3385</span></a>                  <a class="var it10074" onMouseOver="hilite(10074)" onMouseOut="lolite()" onClick="logVariable('plancompetency')" href="../../_variables/plancompetency.html">$plancompetency</a>-&gt;<a class="function" onClick="logFunction('set_sortorder')" href="../../_functions/set_sortorder.html" onMouseOver="funcPopup(event,'set_sortorder')">set_sortorder</a>(<a class="var it10074" onMouseOver="hilite(10074)" onMouseOut="lolite()" onClick="logVariable('plancompetency')" href="../../_variables/plancompetency.html">$plancompetency</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>() + 1);
<a name="l3386"><span class="linenum">3386</span></a>                  <a class="var it10074" onMouseOver="hilite(10074)" onMouseOut="lolite()" onClick="logVariable('plancompetency')" href="../../_variables/plancompetency.html">$plancompetency</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l3387"><span class="linenum">3387</span></a>              }
<a name="l3388"><span class="linenum">3388</span></a>          }
<a name="l3389"><span class="linenum">3389</span></a>          <a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a>-&gt;<a class="function" onClick="logFunction('set_sortorder')" href="../../_functions/set_sortorder.html" onMouseOver="funcPopup(event,'set_sortorder')">set_sortorder</a>(<a class="var it30451" onMouseOver="hilite(30451)" onMouseOut="lolite()" onClick="logVariable('competencyto')" href="../../_variables/competencyto.html">$competencyto</a>-&gt;<a class="function" onClick="logFunction('get_sortorder')" href="../../_functions/get_sortorder.html" onMouseOver="funcPopup(event,'get_sortorder')">get_sortorder</a>());
<a name="l3390"><span class="linenum">3390</span></a>          return <a class="var it30450" onMouseOver="hilite(30450)" onMouseOut="lolite()" onClick="logVariable('competencyfrom')" href="../../_variables/competencyfrom.html">$competencyfrom</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l3391"><span class="linenum">3391</span></a>      }
<a name="l3392"><span class="linenum">3392</span></a>  
<a name="l3393"><span class="linenum">3393</span></a>      <span class="comment">/**</span>
<a name="l3394"><span class="linenum">3394</span></a>  <span class="comment">     * Cancel a user competency review request.</span>
<a name="l3395"><span class="linenum">3395</span></a>  <span class="comment">     *</span>
<a name="l3396"><span class="linenum">3396</span></a>  <span class="comment">     * @param  int $userid       The user ID.</span>
<a name="l3397"><span class="linenum">3397</span></a>  <span class="comment">     * @param  int $competencyid The competency ID.</span>
<a name="l3398"><span class="linenum">3398</span></a>  <span class="comment">     * @return bool</span>
<a name="l3399"><span class="linenum">3399</span></a>  <span class="comment">     */</span>
<a name="l3400"><span class="linenum">3400</span></a>      public static function <a class="function" onClick="logFunction('user_competency_cancel_review_request')" href="../../_functions/user_competency_cancel_review_request.html" onMouseOver="funcPopup(event,'user_competency_cancel_review_request')">user_competency_cancel_review_request</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>) {
<a name="l3401"><span class="linenum">3401</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3402"><span class="linenum">3402</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_user')" href="../../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>);
<a name="l3403"><span class="linenum">3403</span></a>          <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> = <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, 'competencyid' =&gt; <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>));
<a name="l3404"><span class="linenum">3404</span></a>          if (!<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> || !<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l3405"><span class="linenum">3405</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:usercompetencyview', 'nopermissions', '');
<a name="l3406"><span class="linenum">3406</span></a>          } else if (<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() != <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::STATUS_WAITING_FOR_REVIEW) {
<a name="l3407"><span class="linenum">3407</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('The competency can not be cancel review request at this stage.');
<a name="l3408"><span class="linenum">3408</span></a>          } else if (!<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('can_request_review')" href="../../_functions/can_request_review.html" onMouseOver="funcPopup(event,'can_request_review')">can_request_review</a>()) {
<a name="l3409"><span class="linenum">3409</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:usercompetencyrequestreview', 'nopermissions', '');
<a name="l3410"><span class="linenum">3410</span></a>          }
<a name="l3411"><span class="linenum">3411</span></a>  
<a name="l3412"><span class="linenum">3412</span></a>          <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('set_status')" href="../../_functions/set_status.html" onMouseOver="funcPopup(event,'set_status')">set_status</a>(<a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::STATUS_IDLE);
<a name="l3413"><span class="linenum">3413</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l3414"><span class="linenum">3414</span></a>          if (<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>) {
<a name="l3415"><span class="linenum">3415</span></a>              \core\event\<a class="class" onClick="logClass('competency_user_competency_review_request_cancelled')" href="../../_classes/competency_user_competency_review_request_cancelled.html" onMouseOver="classPopup(event,'competency_user_competency_review_request_cancelled')">competency_user_competency_review_request_cancelled</a>::<a class="function" onClick="logFunction('create_from_user_competency')" href="../../_functions/create_from_user_competency.html" onMouseOver="funcPopup(event,'create_from_user_competency')">create_from_user_competency</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l3416"><span class="linenum">3416</span></a>          }
<a name="l3417"><span class="linenum">3417</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l3418"><span class="linenum">3418</span></a>      }
<a name="l3419"><span class="linenum">3419</span></a>  
<a name="l3420"><span class="linenum">3420</span></a>      <span class="comment">/**</span>
<a name="l3421"><span class="linenum">3421</span></a>  <span class="comment">     * Request a user competency review.</span>
<a name="l3422"><span class="linenum">3422</span></a>  <span class="comment">     *</span>
<a name="l3423"><span class="linenum">3423</span></a>  <span class="comment">     * @param  int $userid       The user ID.</span>
<a name="l3424"><span class="linenum">3424</span></a>  <span class="comment">     * @param  int $competencyid The competency ID.</span>
<a name="l3425"><span class="linenum">3425</span></a>  <span class="comment">     * @return bool</span>
<a name="l3426"><span class="linenum">3426</span></a>  <span class="comment">     */</span>
<a name="l3427"><span class="linenum">3427</span></a>      public static function <a class="function" onClick="logFunction('user_competency_request_review')" href="../../_functions/user_competency_request_review.html" onMouseOver="funcPopup(event,'user_competency_request_review')">user_competency_request_review</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>) {
<a name="l3428"><span class="linenum">3428</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3429"><span class="linenum">3429</span></a>          <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> = <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, 'competencyid' =&gt; <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>));
<a name="l3430"><span class="linenum">3430</span></a>          if (!<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>) {
<a name="l3431"><span class="linenum">3431</span></a>              <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> = <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('create_relation')" href="../../_functions/create_relation.html" onMouseOver="funcPopup(event,'create_relation')">create_relation</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l3432"><span class="linenum">3432</span></a>              <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l3433"><span class="linenum">3433</span></a>          }
<a name="l3434"><span class="linenum">3434</span></a>  
<a name="l3435"><span class="linenum">3435</span></a>          if (!<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l3436"><span class="linenum">3436</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:usercompetencyview',
<a name="l3437"><span class="linenum">3437</span></a>                  'nopermissions', '');
<a name="l3438"><span class="linenum">3438</span></a>          } else if (<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() != <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::STATUS_IDLE) {
<a name="l3439"><span class="linenum">3439</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('The competency can not be sent for review at this stage.');
<a name="l3440"><span class="linenum">3440</span></a>          } else if (!<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('can_request_review')" href="../../_functions/can_request_review.html" onMouseOver="funcPopup(event,'can_request_review')">can_request_review</a>()) {
<a name="l3441"><span class="linenum">3441</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:usercompetencyrequestreview',
<a name="l3442"><span class="linenum">3442</span></a>                  'nopermissions', '');
<a name="l3443"><span class="linenum">3443</span></a>          }
<a name="l3444"><span class="linenum">3444</span></a>  
<a name="l3445"><span class="linenum">3445</span></a>          <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('set_status')" href="../../_functions/set_status.html" onMouseOver="funcPopup(event,'set_status')">set_status</a>(<a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::STATUS_WAITING_FOR_REVIEW);
<a name="l3446"><span class="linenum">3446</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l3447"><span class="linenum">3447</span></a>          if (<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>) {
<a name="l3448"><span class="linenum">3448</span></a>              \core\event\<a class="class" onClick="logClass('competency_user_competency_review_requested')" href="../../_classes/competency_user_competency_review_requested.html" onMouseOver="classPopup(event,'competency_user_competency_review_requested')">competency_user_competency_review_requested</a>::<a class="function" onClick="logFunction('create_from_user_competency')" href="../../_functions/create_from_user_competency.html" onMouseOver="funcPopup(event,'create_from_user_competency')">create_from_user_competency</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l3449"><span class="linenum">3449</span></a>          }
<a name="l3450"><span class="linenum">3450</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l3451"><span class="linenum">3451</span></a>      }
<a name="l3452"><span class="linenum">3452</span></a>  
<a name="l3453"><span class="linenum">3453</span></a>      <span class="comment">/**</span>
<a name="l3454"><span class="linenum">3454</span></a>  <span class="comment">     * Start a user competency review.</span>
<a name="l3455"><span class="linenum">3455</span></a>  <span class="comment">     *</span>
<a name="l3456"><span class="linenum">3456</span></a>  <span class="comment">     * @param  int $userid       The user ID.</span>
<a name="l3457"><span class="linenum">3457</span></a>  <span class="comment">     * @param  int $competencyid The competency ID.</span>
<a name="l3458"><span class="linenum">3458</span></a>  <span class="comment">     * @return bool</span>
<a name="l3459"><span class="linenum">3459</span></a>  <span class="comment">     */</span>
<a name="l3460"><span class="linenum">3460</span></a>      public static function <a class="function" onClick="logFunction('user_competency_start_review')" href="../../_functions/user_competency_start_review.html" onMouseOver="funcPopup(event,'user_competency_start_review')">user_competency_start_review</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>) {
<a name="l3461"><span class="linenum">3461</span></a>          global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l3462"><span class="linenum">3462</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3463"><span class="linenum">3463</span></a>  
<a name="l3464"><span class="linenum">3464</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_user')" href="../../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>);
<a name="l3465"><span class="linenum">3465</span></a>          <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> = <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, 'competencyid' =&gt; <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>));
<a name="l3466"><span class="linenum">3466</span></a>          if (!<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> || !<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l3467"><span class="linenum">3467</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:usercompetencyview', 'nopermissions', '');
<a name="l3468"><span class="linenum">3468</span></a>          } else if (<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() != <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::STATUS_WAITING_FOR_REVIEW) {
<a name="l3469"><span class="linenum">3469</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('The competency review can not be started at this stage.');
<a name="l3470"><span class="linenum">3470</span></a>          } else if (!<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('can_review')" href="../../_functions/can_review.html" onMouseOver="funcPopup(event,'can_review')">can_review</a>()) {
<a name="l3471"><span class="linenum">3471</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:usercompetencyreview', 'nopermissions', '');
<a name="l3472"><span class="linenum">3472</span></a>          }
<a name="l3473"><span class="linenum">3473</span></a>  
<a name="l3474"><span class="linenum">3474</span></a>          <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('set_status')" href="../../_functions/set_status.html" onMouseOver="funcPopup(event,'set_status')">set_status</a>(<a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::STATUS_IN_REVIEW);
<a name="l3475"><span class="linenum">3475</span></a>          <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;set_reviewerid(<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l3476"><span class="linenum">3476</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l3477"><span class="linenum">3477</span></a>          if (<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>) {
<a name="l3478"><span class="linenum">3478</span></a>              \core\event\<a class="class" onClick="logClass('competency_user_competency_review_started')" href="../../_classes/competency_user_competency_review_started.html" onMouseOver="classPopup(event,'competency_user_competency_review_started')">competency_user_competency_review_started</a>::<a class="function" onClick="logFunction('create_from_user_competency')" href="../../_functions/create_from_user_competency.html" onMouseOver="funcPopup(event,'create_from_user_competency')">create_from_user_competency</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l3479"><span class="linenum">3479</span></a>          }
<a name="l3480"><span class="linenum">3480</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l3481"><span class="linenum">3481</span></a>      }
<a name="l3482"><span class="linenum">3482</span></a>  
<a name="l3483"><span class="linenum">3483</span></a>      <span class="comment">/**</span>
<a name="l3484"><span class="linenum">3484</span></a>  <span class="comment">     * Stop a user competency review.</span>
<a name="l3485"><span class="linenum">3485</span></a>  <span class="comment">     *</span>
<a name="l3486"><span class="linenum">3486</span></a>  <span class="comment">     * @param  int $userid       The user ID.</span>
<a name="l3487"><span class="linenum">3487</span></a>  <span class="comment">     * @param  int $competencyid The competency ID.</span>
<a name="l3488"><span class="linenum">3488</span></a>  <span class="comment">     * @return bool</span>
<a name="l3489"><span class="linenum">3489</span></a>  <span class="comment">     */</span>
<a name="l3490"><span class="linenum">3490</span></a>      public static function <a class="function" onClick="logFunction('user_competency_stop_review')" href="../../_functions/user_competency_stop_review.html" onMouseOver="funcPopup(event,'user_competency_stop_review')">user_competency_stop_review</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>) {
<a name="l3491"><span class="linenum">3491</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3492"><span class="linenum">3492</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_user')" href="../../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>);
<a name="l3493"><span class="linenum">3493</span></a>          <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> = <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, 'competencyid' =&gt; <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>));
<a name="l3494"><span class="linenum">3494</span></a>          if (!<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> || !<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l3495"><span class="linenum">3495</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:usercompetencyview', 'nopermissions', '');
<a name="l3496"><span class="linenum">3496</span></a>          } else if (<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() != <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::STATUS_IN_REVIEW) {
<a name="l3497"><span class="linenum">3497</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('The competency review can not be stopped at this stage.');
<a name="l3498"><span class="linenum">3498</span></a>          } else if (!<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('can_review')" href="../../_functions/can_review.html" onMouseOver="funcPopup(event,'can_review')">can_review</a>()) {
<a name="l3499"><span class="linenum">3499</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:usercompetencyreview', 'nopermissions', '');
<a name="l3500"><span class="linenum">3500</span></a>          }
<a name="l3501"><span class="linenum">3501</span></a>  
<a name="l3502"><span class="linenum">3502</span></a>          <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('set_status')" href="../../_functions/set_status.html" onMouseOver="funcPopup(event,'set_status')">set_status</a>(<a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::STATUS_IDLE);
<a name="l3503"><span class="linenum">3503</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l3504"><span class="linenum">3504</span></a>          if (<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>) {
<a name="l3505"><span class="linenum">3505</span></a>              \core\event\<a class="class" onClick="logClass('competency_user_competency_review_stopped')" href="../../_classes/competency_user_competency_review_stopped.html" onMouseOver="classPopup(event,'competency_user_competency_review_stopped')">competency_user_competency_review_stopped</a>::<a class="function" onClick="logFunction('create_from_user_competency')" href="../../_functions/create_from_user_competency.html" onMouseOver="funcPopup(event,'create_from_user_competency')">create_from_user_competency</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l3506"><span class="linenum">3506</span></a>          }
<a name="l3507"><span class="linenum">3507</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l3508"><span class="linenum">3508</span></a>      }
<a name="l3509"><span class="linenum">3509</span></a>  
<a name="l3510"><span class="linenum">3510</span></a>      <span class="comment">/**</span>
<a name="l3511"><span class="linenum">3511</span></a>  <span class="comment">     * Log user competency viewed event.</span>
<a name="l3512"><span class="linenum">3512</span></a>  <span class="comment">     *</span>
<a name="l3513"><span class="linenum">3513</span></a>  <span class="comment">     * @param user_competency|int $usercompetencyorid The user competency object or user competency id</span>
<a name="l3514"><span class="linenum">3514</span></a>  <span class="comment">     * @return bool</span>
<a name="l3515"><span class="linenum">3515</span></a>  <span class="comment">     */</span>
<a name="l3516"><span class="linenum">3516</span></a>      public static function <a class="function" onClick="logFunction('user_competency_viewed')" href="../../_functions/user_competency_viewed.html" onMouseOver="funcPopup(event,'user_competency_viewed')">user_competency_viewed</a>(<a class="var it30470" onMouseOver="hilite(30470)" onMouseOut="lolite()" onClick="logVariable('usercompetencyorid')" href="../../_variables/usercompetencyorid.html">$usercompetencyorid</a>) {
<a name="l3517"><span class="linenum">3517</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3518"><span class="linenum">3518</span></a>          <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> = <a class="var it30470" onMouseOver="hilite(30470)" onMouseOut="lolite()" onClick="logVariable('usercompetencyorid')" href="../../_variables/usercompetencyorid.html">$usercompetencyorid</a>;
<a name="l3519"><span class="linenum">3519</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>)) {
<a name="l3520"><span class="linenum">3520</span></a>              <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> = <span class="keyword">new </span><a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>);
<a name="l3521"><span class="linenum">3521</span></a>          }
<a name="l3522"><span class="linenum">3522</span></a>  
<a name="l3523"><span class="linenum">3523</span></a>          if (!<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> || !<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l3524"><span class="linenum">3524</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:usercompetencyview',
<a name="l3525"><span class="linenum">3525</span></a>                  'nopermissions', '');
<a name="l3526"><span class="linenum">3526</span></a>          }
<a name="l3527"><span class="linenum">3527</span></a>  
<a name="l3528"><span class="linenum">3528</span></a>          \core\event\<a class="class" onClick="logClass('competency_user_competency_viewed')" href="../../_classes/competency_user_competency_viewed.html" onMouseOver="classPopup(event,'competency_user_competency_viewed')">competency_user_competency_viewed</a>::<a class="function" onClick="logFunction('create_from_user_competency_viewed')" href="../../_functions/create_from_user_competency_viewed.html" onMouseOver="funcPopup(event,'create_from_user_competency_viewed')">create_from_user_competency_viewed</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l3529"><span class="linenum">3529</span></a>          return true;
<a name="l3530"><span class="linenum">3530</span></a>      }
<a name="l3531"><span class="linenum">3531</span></a>  
<a name="l3532"><span class="linenum">3532</span></a>      <span class="comment">/**</span>
<a name="l3533"><span class="linenum">3533</span></a>  <span class="comment">     * Log user competency viewed in plan event.</span>
<a name="l3534"><span class="linenum">3534</span></a>  <span class="comment">     *</span>
<a name="l3535"><span class="linenum">3535</span></a>  <span class="comment">     * @param user_competency|int $usercompetencyorid The user competency object or user competency id</span>
<a name="l3536"><span class="linenum">3536</span></a>  <span class="comment">     * @param int $planid The plan ID</span>
<a name="l3537"><span class="linenum">3537</span></a>  <span class="comment">     * @return bool</span>
<a name="l3538"><span class="linenum">3538</span></a>  <span class="comment">     */</span>
<a name="l3539"><span class="linenum">3539</span></a>      public static function <a class="function" onClick="logFunction('user_competency_viewed_in_plan')" href="../../_functions/user_competency_viewed_in_plan.html" onMouseOver="funcPopup(event,'user_competency_viewed_in_plan')">user_competency_viewed_in_plan</a>(<a class="var it30470" onMouseOver="hilite(30470)" onMouseOut="lolite()" onClick="logVariable('usercompetencyorid')" href="../../_variables/usercompetencyorid.html">$usercompetencyorid</a>, <a class="var it5441" onMouseOver="hilite(5441)" onMouseOut="lolite()" onClick="logVariable('planid')" href="../../_variables/planid.html">$planid</a>) {
<a name="l3540"><span class="linenum">3540</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3541"><span class="linenum">3541</span></a>          <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> = <a class="var it30470" onMouseOver="hilite(30470)" onMouseOut="lolite()" onClick="logVariable('usercompetencyorid')" href="../../_variables/usercompetencyorid.html">$usercompetencyorid</a>;
<a name="l3542"><span class="linenum">3542</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>)) {
<a name="l3543"><span class="linenum">3543</span></a>              <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> = <span class="keyword">new </span><a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>);
<a name="l3544"><span class="linenum">3544</span></a>          }
<a name="l3545"><span class="linenum">3545</span></a>  
<a name="l3546"><span class="linenum">3546</span></a>          if (!<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> || !<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l3547"><span class="linenum">3547</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:usercompetencyview',
<a name="l3548"><span class="linenum">3548</span></a>                  'nopermissions', '');
<a name="l3549"><span class="linenum">3549</span></a>          }
<a name="l3550"><span class="linenum">3550</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(<a class="var it5441" onMouseOver="hilite(5441)" onMouseOut="lolite()" onClick="logVariable('planid')" href="../../_variables/planid.html">$planid</a>);
<a name="l3551"><span class="linenum">3551</span></a>          if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() == <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_COMPLETE) {
<a name="l3552"><span class="linenum">3552</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('To log the user competency in completed plan use user_competency_plan_viewed method.');
<a name="l3553"><span class="linenum">3553</span></a>          }
<a name="l3554"><span class="linenum">3554</span></a>  
<a name="l3555"><span class="linenum">3555</span></a>          \core\event\<a class="class" onClick="logClass('competency_user_competency_viewed_in_plan')" href="../../_classes/competency_user_competency_viewed_in_plan.html" onMouseOver="classPopup(event,'competency_user_competency_viewed_in_plan')">competency_user_competency_viewed_in_plan</a>::<a class="function" onClick="logFunction('create_from_user_competency_viewed_in_plan')" href="../../_functions/create_from_user_competency_viewed_in_plan.html" onMouseOver="funcPopup(event,'create_from_user_competency_viewed_in_plan')">create_from_user_competency_viewed_in_plan</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>, <a class="var it5441" onMouseOver="hilite(5441)" onMouseOut="lolite()" onClick="logVariable('planid')" href="../../_variables/planid.html">$planid</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l3556"><span class="linenum">3556</span></a>          return true;
<a name="l3557"><span class="linenum">3557</span></a>      }
<a name="l3558"><span class="linenum">3558</span></a>  
<a name="l3559"><span class="linenum">3559</span></a>      <span class="comment">/**</span>
<a name="l3560"><span class="linenum">3560</span></a>  <span class="comment">     * Log user competency viewed in course event.</span>
<a name="l3561"><span class="linenum">3561</span></a>  <span class="comment">     *</span>
<a name="l3562"><span class="linenum">3562</span></a>  <span class="comment">     * @param user_competency_course|int $usercoursecompetencyorid The user competency course object or its ID.</span>
<a name="l3563"><span class="linenum">3563</span></a>  <span class="comment">     * @param int $courseid The course ID</span>
<a name="l3564"><span class="linenum">3564</span></a>  <span class="comment">     * @return bool</span>
<a name="l3565"><span class="linenum">3565</span></a>  <span class="comment">     */</span>
<a name="l3566"><span class="linenum">3566</span></a>      public static function <a class="function" onClick="logFunction('user_competency_viewed_in_course')" href="../../_functions/user_competency_viewed_in_course.html" onMouseOver="funcPopup(event,'user_competency_viewed_in_course')">user_competency_viewed_in_course</a>(<a class="var it30471" onMouseOver="hilite(30471)" onMouseOut="lolite()" onClick="logVariable('usercoursecompetencyorid')" href="../../_variables/usercoursecompetencyorid.html">$usercoursecompetencyorid</a>) {
<a name="l3567"><span class="linenum">3567</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3568"><span class="linenum">3568</span></a>          <a class="var it30439" onMouseOver="hilite(30439)" onMouseOut="lolite()" onClick="logVariable('ucc')" href="../../_variables/ucc.html">$ucc</a> = <a class="var it30471" onMouseOver="hilite(30471)" onMouseOut="lolite()" onClick="logVariable('usercoursecompetencyorid')" href="../../_variables/usercoursecompetencyorid.html">$usercoursecompetencyorid</a>;
<a name="l3569"><span class="linenum">3569</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it30439" onMouseOver="hilite(30439)" onMouseOut="lolite()" onClick="logVariable('ucc')" href="../../_variables/ucc.html">$ucc</a>)) {
<a name="l3570"><span class="linenum">3570</span></a>              <a class="var it30439" onMouseOver="hilite(30439)" onMouseOut="lolite()" onClick="logVariable('ucc')" href="../../_variables/ucc.html">$ucc</a> = <span class="keyword">new </span><a class="class" onClick="logClass('user_competency_course')" href="../../_classes/user_competency_course.html" onMouseOver="classPopup(event,'user_competency_course')">user_competency_course</a>(<a class="var it30439" onMouseOver="hilite(30439)" onMouseOut="lolite()" onClick="logVariable('ucc')" href="../../_variables/ucc.html">$ucc</a>);
<a name="l3571"><span class="linenum">3571</span></a>          }
<a name="l3572"><span class="linenum">3572</span></a>  
<a name="l3573"><span class="linenum">3573</span></a>          if (!<a class="var it30439" onMouseOver="hilite(30439)" onMouseOut="lolite()" onClick="logVariable('ucc')" href="../../_variables/ucc.html">$ucc</a> || !<a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('can_read_user_in_course')" href="../../_functions/can_read_user_in_course.html" onMouseOver="funcPopup(event,'can_read_user_in_course')">can_read_user_in_course</a>(<a class="var it30439" onMouseOver="hilite(30439)" onMouseOut="lolite()" onClick="logVariable('ucc')" href="../../_variables/ucc.html">$ucc</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>(), <a class="var it30439" onMouseOver="hilite(30439)" onMouseOut="lolite()" onClick="logVariable('ucc')" href="../../_variables/ucc.html">$ucc</a>-&gt;<a class="function" onClick="logFunction('get_courseid')" href="../../_functions/get_courseid.html" onMouseOver="funcPopup(event,'get_courseid')">get_courseid</a>())) {
<a name="l3574"><span class="linenum">3574</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it30439" onMouseOver="hilite(30439)" onMouseOut="lolite()" onClick="logVariable('ucc')" href="../../_variables/ucc.html">$ucc</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:usercompetencyview',
<a name="l3575"><span class="linenum">3575</span></a>                  'nopermissions', '');
<a name="l3576"><span class="linenum">3576</span></a>          }
<a name="l3577"><span class="linenum">3577</span></a>  
<a name="l3578"><span class="linenum">3578</span></a>  <span class="comment">        // Validate the course, this will throw an exception if not valid.</span>
<a name="l3579"><span class="linenum">3579</span></a>          self::<a class="function" onClick="logFunction('validate_course')" href="../../_functions/validate_course.html" onMouseOver="funcPopup(event,'validate_course')">validate_course</a>(<a class="var it30439" onMouseOver="hilite(30439)" onMouseOut="lolite()" onClick="logVariable('ucc')" href="../../_variables/ucc.html">$ucc</a>-&gt;<a class="function" onClick="logFunction('get_courseid')" href="../../_functions/get_courseid.html" onMouseOver="funcPopup(event,'get_courseid')">get_courseid</a>());
<a name="l3580"><span class="linenum">3580</span></a>  
<a name="l3581"><span class="linenum">3581</span></a>          \core\event\<a class="class" onClick="logClass('competency_user_competency_viewed_in_course')" href="../../_classes/competency_user_competency_viewed_in_course.html" onMouseOver="classPopup(event,'competency_user_competency_viewed_in_course')">competency_user_competency_viewed_in_course</a>::<a class="function" onClick="logFunction('create_from_user_competency_viewed_in_course')" href="../../_functions/create_from_user_competency_viewed_in_course.html" onMouseOver="funcPopup(event,'create_from_user_competency_viewed_in_course')">create_from_user_competency_viewed_in_course</a>(<a class="var it30439" onMouseOver="hilite(30439)" onMouseOut="lolite()" onClick="logVariable('ucc')" href="../../_variables/ucc.html">$ucc</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l3582"><span class="linenum">3582</span></a>          return true;
<a name="l3583"><span class="linenum">3583</span></a>      }
<a name="l3584"><span class="linenum">3584</span></a>  
<a name="l3585"><span class="linenum">3585</span></a>      <span class="comment">/**</span>
<a name="l3586"><span class="linenum">3586</span></a>  <span class="comment">     * Log user competency plan viewed event.</span>
<a name="l3587"><span class="linenum">3587</span></a>  <span class="comment">     *</span>
<a name="l3588"><span class="linenum">3588</span></a>  <span class="comment">     * @param user_competency_plan|int $usercompetencyplanorid The user competency plan object or user competency plan id</span>
<a name="l3589"><span class="linenum">3589</span></a>  <span class="comment">     * @return bool</span>
<a name="l3590"><span class="linenum">3590</span></a>  <span class="comment">     */</span>
<a name="l3591"><span class="linenum">3591</span></a>      public static function <a class="function" onClick="logFunction('user_competency_plan_viewed')" href="../../_functions/user_competency_plan_viewed.html" onMouseOver="funcPopup(event,'user_competency_plan_viewed')">user_competency_plan_viewed</a>(<a class="var it30472" onMouseOver="hilite(30472)" onMouseOut="lolite()" onClick="logVariable('usercompetencyplanorid')" href="../../_variables/usercompetencyplanorid.html">$usercompetencyplanorid</a>) {
<a name="l3592"><span class="linenum">3592</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3593"><span class="linenum">3593</span></a>          <a class="var it2288" onMouseOver="hilite(2288)" onMouseOut="lolite()" onClick="logVariable('ucp')" href="../../_variables/ucp.html">$ucp</a> = <a class="var it30472" onMouseOver="hilite(30472)" onMouseOut="lolite()" onClick="logVariable('usercompetencyplanorid')" href="../../_variables/usercompetencyplanorid.html">$usercompetencyplanorid</a>;
<a name="l3594"><span class="linenum">3594</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it2288" onMouseOver="hilite(2288)" onMouseOut="lolite()" onClick="logVariable('ucp')" href="../../_variables/ucp.html">$ucp</a>)) {
<a name="l3595"><span class="linenum">3595</span></a>              <a class="var it2288" onMouseOver="hilite(2288)" onMouseOut="lolite()" onClick="logVariable('ucp')" href="../../_variables/ucp.html">$ucp</a> = <span class="keyword">new </span><a class="class" onClick="logClass('user_competency_plan')" href="../../_classes/user_competency_plan.html" onMouseOver="classPopup(event,'user_competency_plan')">user_competency_plan</a>(<a class="var it2288" onMouseOver="hilite(2288)" onMouseOut="lolite()" onClick="logVariable('ucp')" href="../../_variables/ucp.html">$ucp</a>);
<a name="l3596"><span class="linenum">3596</span></a>          }
<a name="l3597"><span class="linenum">3597</span></a>  
<a name="l3598"><span class="linenum">3598</span></a>          if (!<a class="var it2288" onMouseOver="hilite(2288)" onMouseOut="lolite()" onClick="logVariable('ucp')" href="../../_variables/ucp.html">$ucp</a> || !<a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('can_read_user')" href="../../_functions/can_read_user.html" onMouseOver="funcPopup(event,'can_read_user')">can_read_user</a>(<a class="var it2288" onMouseOver="hilite(2288)" onMouseOut="lolite()" onClick="logVariable('ucp')" href="../../_variables/ucp.html">$ucp</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>())) {
<a name="l3599"><span class="linenum">3599</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it2288" onMouseOver="hilite(2288)" onMouseOut="lolite()" onClick="logVariable('ucp')" href="../../_variables/ucp.html">$ucp</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:usercompetencyview',
<a name="l3600"><span class="linenum">3600</span></a>                  'nopermissions', '');
<a name="l3601"><span class="linenum">3601</span></a>          }
<a name="l3602"><span class="linenum">3602</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(<a class="var it2288" onMouseOver="hilite(2288)" onMouseOut="lolite()" onClick="logVariable('ucp')" href="../../_variables/ucp.html">$ucp</a>-&gt;get_planid());
<a name="l3603"><span class="linenum">3603</span></a>          if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() != <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_COMPLETE) {
<a name="l3604"><span class="linenum">3604</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('To log the user competency in non-completed plan use '
<a name="l3605"><span class="linenum">3605</span></a>                  . 'user_competency_viewed_in_plan method.');
<a name="l3606"><span class="linenum">3606</span></a>          }
<a name="l3607"><span class="linenum">3607</span></a>  
<a name="l3608"><span class="linenum">3608</span></a>          \core\event\<a class="class" onClick="logClass('competency_user_competency_plan_viewed')" href="../../_classes/competency_user_competency_plan_viewed.html" onMouseOver="classPopup(event,'competency_user_competency_plan_viewed')">competency_user_competency_plan_viewed</a>::<a class="function" onClick="logFunction('create_from_user_competency_plan')" href="../../_functions/create_from_user_competency_plan.html" onMouseOver="funcPopup(event,'create_from_user_competency_plan')">create_from_user_competency_plan</a>(<a class="var it2288" onMouseOver="hilite(2288)" onMouseOut="lolite()" onClick="logVariable('ucp')" href="../../_variables/ucp.html">$ucp</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l3609"><span class="linenum">3609</span></a>          return true;
<a name="l3610"><span class="linenum">3610</span></a>      }
<a name="l3611"><span class="linenum">3611</span></a>  
<a name="l3612"><span class="linenum">3612</span></a>      <span class="comment">/**</span>
<a name="l3613"><span class="linenum">3613</span></a>  <span class="comment">     * Check if template has related data.</span>
<a name="l3614"><span class="linenum">3614</span></a>  <span class="comment">     *</span>
<a name="l3615"><span class="linenum">3615</span></a>  <span class="comment">     * @param int $templateid The id of the template to check.</span>
<a name="l3616"><span class="linenum">3616</span></a>  <span class="comment">     * @return boolean</span>
<a name="l3617"><span class="linenum">3617</span></a>  <span class="comment">     */</span>
<a name="l3618"><span class="linenum">3618</span></a>      public static function <a class="function" onClick="logFunction('template_has_related_data')" href="../../_functions/template_has_related_data.html" onMouseOver="funcPopup(event,'template_has_related_data')">template_has_related_data</a>(<a class="var it7511" onMouseOver="hilite(7511)" onMouseOut="lolite()" onClick="logVariable('templateid')" href="../../_variables/templateid.html">$templateid</a>) {
<a name="l3619"><span class="linenum">3619</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3620"><span class="linenum">3620</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l3621"><span class="linenum">3621</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>(<a class="var it7511" onMouseOver="hilite(7511)" onMouseOut="lolite()" onClick="logVariable('templateid')" href="../../_variables/templateid.html">$templateid</a>);
<a name="l3622"><span class="linenum">3622</span></a>  
<a name="l3623"><span class="linenum">3623</span></a>          if (!<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l3624"><span class="linenum">3624</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:templateview',
<a name="l3625"><span class="linenum">3625</span></a>                  'nopermissions', '');
<a name="l3626"><span class="linenum">3626</span></a>          }
<a name="l3627"><span class="linenum">3627</span></a>  
<a name="l3628"><span class="linenum">3628</span></a>  <span class="comment">        // OK - all set.</span>
<a name="l3629"><span class="linenum">3629</span></a>          return <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('has_plans')" href="../../_functions/has_plans.html" onMouseOver="funcPopup(event,'has_plans')">has_plans</a>();
<a name="l3630"><span class="linenum">3630</span></a>      }
<a name="l3631"><span class="linenum">3631</span></a>  
<a name="l3632"><span class="linenum">3632</span></a>      <span class="comment">/**</span>
<a name="l3633"><span class="linenum">3633</span></a>  <span class="comment">     * List all the related competencies.</span>
<a name="l3634"><span class="linenum">3634</span></a>  <span class="comment">     *</span>
<a name="l3635"><span class="linenum">3635</span></a>  <span class="comment">     * @param int $competencyid The id of the competency to check.</span>
<a name="l3636"><span class="linenum">3636</span></a>  <span class="comment">     * @return competency[]</span>
<a name="l3637"><span class="linenum">3637</span></a>  <span class="comment">     */</span>
<a name="l3638"><span class="linenum">3638</span></a>      public static function <a class="function" onClick="logFunction('list_related_competencies')" href="../../_functions/list_related_competencies.html" onMouseOver="funcPopup(event,'list_related_competencies')">list_related_competencies</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>) {
<a name="l3639"><span class="linenum">3639</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3640"><span class="linenum">3640</span></a>          <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l3641"><span class="linenum">3641</span></a>  
<a name="l3642"><span class="linenum">3642</span></a>          if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(array('moodle/competency:competencyview', 'moodle/competency:competencymanage'),
<a name="l3643"><span class="linenum">3643</span></a>                  <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>())) {
<a name="l3644"><span class="linenum">3644</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:competencyview',
<a name="l3645"><span class="linenum">3645</span></a>                  'nopermissions', '');
<a name="l3646"><span class="linenum">3646</span></a>          }
<a name="l3647"><span class="linenum">3647</span></a>  
<a name="l3648"><span class="linenum">3648</span></a>          return <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_related_competencies')" href="../../_functions/get_related_competencies.html" onMouseOver="funcPopup(event,'get_related_competencies')">get_related_competencies</a>();
<a name="l3649"><span class="linenum">3649</span></a>      }
<a name="l3650"><span class="linenum">3650</span></a>  
<a name="l3651"><span class="linenum">3651</span></a>      <span class="comment">/**</span>
<a name="l3652"><span class="linenum">3652</span></a>  <span class="comment">     * Add a related competency.</span>
<a name="l3653"><span class="linenum">3653</span></a>  <span class="comment">     *</span>
<a name="l3654"><span class="linenum">3654</span></a>  <span class="comment">     * @param int $competencyid The id of the competency</span>
<a name="l3655"><span class="linenum">3655</span></a>  <span class="comment">     * @param int $relatedcompetencyid The id of the related competency.</span>
<a name="l3656"><span class="linenum">3656</span></a>  <span class="comment">     * @return bool False when create failed, true on success, or if the relation already existed.</span>
<a name="l3657"><span class="linenum">3657</span></a>  <span class="comment">     */</span>
<a name="l3658"><span class="linenum">3658</span></a>      public static function <a class="function" onClick="logFunction('add_related_competency')" href="../../_functions/add_related_competency.html" onMouseOver="funcPopup(event,'add_related_competency')">add_related_competency</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>, <a class="var it10072" onMouseOver="hilite(10072)" onMouseOut="lolite()" onClick="logVariable('relatedcompetencyid')" href="../../_variables/relatedcompetencyid.html">$relatedcompetencyid</a>) {
<a name="l3659"><span class="linenum">3659</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3660"><span class="linenum">3660</span></a>          <a class="var it23638" onMouseOver="hilite(23638)" onMouseOut="lolite()" onClick="logVariable('competency1')" href="../../_variables/competency1.html">$competency1</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l3661"><span class="linenum">3661</span></a>          <a class="var it23639" onMouseOver="hilite(23639)" onMouseOut="lolite()" onClick="logVariable('competency2')" href="../../_variables/competency2.html">$competency2</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>(<a class="var it10072" onMouseOver="hilite(10072)" onMouseOut="lolite()" onClick="logVariable('relatedcompetencyid')" href="../../_variables/relatedcompetencyid.html">$relatedcompetencyid</a>);
<a name="l3662"><span class="linenum">3662</span></a>  
<a name="l3663"><span class="linenum">3663</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:competencymanage', <a class="var it23638" onMouseOver="hilite(23638)" onMouseOut="lolite()" onClick="logVariable('competency1')" href="../../_variables/competency1.html">$competency1</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>());
<a name="l3664"><span class="linenum">3664</span></a>  
<a name="l3665"><span class="linenum">3665</span></a>          <a class="var it30420" onMouseOver="hilite(30420)" onMouseOut="lolite()" onClick="logVariable('relatedcompetency')" href="../../_variables/relatedcompetency.html">$relatedcompetency</a> = <a class="class" onClick="logClass('related_competency')" href="../../_classes/related_competency.html" onMouseOver="classPopup(event,'related_competency')">related_competency</a>::<a class="function" onClick="logFunction('get_relation')" href="../../_functions/get_relation.html" onMouseOver="funcPopup(event,'get_relation')">get_relation</a>(<a class="var it23638" onMouseOver="hilite(23638)" onMouseOut="lolite()" onClick="logVariable('competency1')" href="../../_variables/competency1.html">$competency1</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(), <a class="var it23639" onMouseOver="hilite(23639)" onMouseOut="lolite()" onClick="logVariable('competency2')" href="../../_variables/competency2.html">$competency2</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>());
<a name="l3666"><span class="linenum">3666</span></a>          if (!<a class="var it30420" onMouseOver="hilite(30420)" onMouseOut="lolite()" onClick="logVariable('relatedcompetency')" href="../../_variables/relatedcompetency.html">$relatedcompetency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>()) {
<a name="l3667"><span class="linenum">3667</span></a>              <a class="var it30420" onMouseOver="hilite(30420)" onMouseOut="lolite()" onClick="logVariable('relatedcompetency')" href="../../_variables/relatedcompetency.html">$relatedcompetency</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l3668"><span class="linenum">3668</span></a>              return true;
<a name="l3669"><span class="linenum">3669</span></a>          }
<a name="l3670"><span class="linenum">3670</span></a>  
<a name="l3671"><span class="linenum">3671</span></a>          return true;
<a name="l3672"><span class="linenum">3672</span></a>      }
<a name="l3673"><span class="linenum">3673</span></a>  
<a name="l3674"><span class="linenum">3674</span></a>      <span class="comment">/**</span>
<a name="l3675"><span class="linenum">3675</span></a>  <span class="comment">     * Remove a related competency.</span>
<a name="l3676"><span class="linenum">3676</span></a>  <span class="comment">     *</span>
<a name="l3677"><span class="linenum">3677</span></a>  <span class="comment">     * @param int $competencyid The id of the competency.</span>
<a name="l3678"><span class="linenum">3678</span></a>  <span class="comment">     * @param int $relatedcompetencyid The id of the related competency.</span>
<a name="l3679"><span class="linenum">3679</span></a>  <span class="comment">     * @return bool True when it was deleted, false when it wasn't or the relation doesn't exist.</span>
<a name="l3680"><span class="linenum">3680</span></a>  <span class="comment">     */</span>
<a name="l3681"><span class="linenum">3681</span></a>      public static function <a class="function" onClick="logFunction('remove_related_competency')" href="../../_functions/remove_related_competency.html" onMouseOver="funcPopup(event,'remove_related_competency')">remove_related_competency</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>, <a class="var it10072" onMouseOver="hilite(10072)" onMouseOut="lolite()" onClick="logVariable('relatedcompetencyid')" href="../../_variables/relatedcompetencyid.html">$relatedcompetencyid</a>) {
<a name="l3682"><span class="linenum">3682</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3683"><span class="linenum">3683</span></a>          <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l3684"><span class="linenum">3684</span></a>  
<a name="l3685"><span class="linenum">3685</span></a>  <span class="comment">        // This only check if we have the permission in either competency because both competencies</span>
<a name="l3686"><span class="linenum">3686</span></a>  <span class="comment">        // should belong to the same framework.</span>
<a name="l3687"><span class="linenum">3687</span></a>          <a class="function" onClick="logFunction('require_capability')" href="../../_functions/require_capability.html" onMouseOver="funcPopup(event,'require_capability')">require_capability</a>('moodle/competency:competencymanage', <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>());
<a name="l3688"><span class="linenum">3688</span></a>  
<a name="l3689"><span class="linenum">3689</span></a>          <a class="var it30420" onMouseOver="hilite(30420)" onMouseOut="lolite()" onClick="logVariable('relatedcompetency')" href="../../_variables/relatedcompetency.html">$relatedcompetency</a> = <a class="class" onClick="logClass('related_competency')" href="../../_classes/related_competency.html" onMouseOver="classPopup(event,'related_competency')">related_competency</a>::<a class="function" onClick="logFunction('get_relation')" href="../../_functions/get_relation.html" onMouseOver="funcPopup(event,'get_relation')">get_relation</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>, <a class="var it10072" onMouseOver="hilite(10072)" onMouseOut="lolite()" onClick="logVariable('relatedcompetencyid')" href="../../_variables/relatedcompetencyid.html">$relatedcompetencyid</a>);
<a name="l3690"><span class="linenum">3690</span></a>          if (<a class="var it30420" onMouseOver="hilite(30420)" onMouseOut="lolite()" onClick="logVariable('relatedcompetency')" href="../../_variables/relatedcompetency.html">$relatedcompetency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>()) {
<a name="l3691"><span class="linenum">3691</span></a>              return <a class="var it30420" onMouseOver="hilite(30420)" onMouseOut="lolite()" onClick="logVariable('relatedcompetency')" href="../../_variables/relatedcompetency.html">$relatedcompetency</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l3692"><span class="linenum">3692</span></a>          }
<a name="l3693"><span class="linenum">3693</span></a>  
<a name="l3694"><span class="linenum">3694</span></a>          return false;
<a name="l3695"><span class="linenum">3695</span></a>      }
<a name="l3696"><span class="linenum">3696</span></a>  
<a name="l3697"><span class="linenum">3697</span></a>      <span class="comment">/**</span>
<a name="l3698"><span class="linenum">3698</span></a>  <span class="comment">     * Read a user evidence.</span>
<a name="l3699"><span class="linenum">3699</span></a>  <span class="comment">     *</span>
<a name="l3700"><span class="linenum">3700</span></a>  <span class="comment">     * @param int $id</span>
<a name="l3701"><span class="linenum">3701</span></a>  <span class="comment">     * @return user_evidence</span>
<a name="l3702"><span class="linenum">3702</span></a>  <span class="comment">     */</span>
<a name="l3703"><span class="linenum">3703</span></a>      public static function <a class="function" onClick="logFunction('read_user_evidence')" href="../../_functions/read_user_evidence.html" onMouseOver="funcPopup(event,'read_user_evidence')">read_user_evidence</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>) {
<a name="l3704"><span class="linenum">3704</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3705"><span class="linenum">3705</span></a>          <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a> = <span class="keyword">new </span><a class="class" onClick="logClass('user_evidence')" href="../../_classes/user_evidence.html" onMouseOver="classPopup(event,'user_evidence')">user_evidence</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);
<a name="l3706"><span class="linenum">3706</span></a>  
<a name="l3707"><span class="linenum">3707</span></a>          if (!<a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l3708"><span class="linenum">3708</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>();
<a name="l3709"><span class="linenum">3709</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:userevidenceview', 'nopermissions', '');
<a name="l3710"><span class="linenum">3710</span></a>          }
<a name="l3711"><span class="linenum">3711</span></a>  
<a name="l3712"><span class="linenum">3712</span></a>          return <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>;
<a name="l3713"><span class="linenum">3713</span></a>      }
<a name="l3714"><span class="linenum">3714</span></a>  
<a name="l3715"><span class="linenum">3715</span></a>      <span class="comment">/**</span>
<a name="l3716"><span class="linenum">3716</span></a>  <span class="comment">     * Create a new user evidence.</span>
<a name="l3717"><span class="linenum">3717</span></a>  <span class="comment">     *</span>
<a name="l3718"><span class="linenum">3718</span></a>  <span class="comment">     * @param  object $data        The data.</span>
<a name="l3719"><span class="linenum">3719</span></a>  <span class="comment">     * @param  int    $draftitemid The draft ID in which files have been saved.</span>
<a name="l3720"><span class="linenum">3720</span></a>  <span class="comment">     * @return user_evidence</span>
<a name="l3721"><span class="linenum">3721</span></a>  <span class="comment">     */</span>
<a name="l3722"><span class="linenum">3722</span></a>      public static function <a class="function" onClick="logFunction('create_user_evidence')" href="../../_functions/create_user_evidence.html" onMouseOver="funcPopup(event,'create_user_evidence')">create_user_evidence</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>, <a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('draftitemid')" href="../../_variables/draftitemid.html">$draftitemid</a> = null) {
<a name="l3723"><span class="linenum">3723</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3724"><span class="linenum">3724</span></a>          <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a> = <span class="keyword">new </span><a class="class" onClick="logClass('user_evidence')" href="../../_classes/user_evidence.html" onMouseOver="classPopup(event,'user_evidence')">user_evidence</a>(null, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l3725"><span class="linenum">3725</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>();
<a name="l3726"><span class="linenum">3726</span></a>  
<a name="l3727"><span class="linenum">3727</span></a>          if (!<a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l3728"><span class="linenum">3728</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:userevidencemanage', 'nopermissions', '');
<a name="l3729"><span class="linenum">3729</span></a>          }
<a name="l3730"><span class="linenum">3730</span></a>  
<a name="l3731"><span class="linenum">3731</span></a>          <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l3732"><span class="linenum">3732</span></a>          if (!empty(<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('draftitemid')" href="../../_variables/draftitemid.html">$draftitemid</a>)) {
<a name="l3733"><span class="linenum">3733</span></a>              <a class="var it30473" onMouseOver="hilite(30473)" onMouseOut="lolite()" onClick="logVariable('fileareaoptions')" href="../../_variables/fileareaoptions.html">$fileareaoptions</a> = array('subdirs' =&gt; true);
<a name="l3734"><span class="linenum">3734</span></a>              <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a> = <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>();
<a name="l3735"><span class="linenum">3735</span></a>              <a class="function" onClick="logFunction('file_save_draft_area_files')" href="../../_functions/file_save_draft_area_files.html" onMouseOver="funcPopup(event,'file_save_draft_area_files')">file_save_draft_area_files</a>(<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('draftitemid')" href="../../_variables/draftitemid.html">$draftitemid</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'core_competency', 'userevidence', <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it30473" onMouseOver="hilite(30473)" onMouseOut="lolite()" onClick="logVariable('fileareaoptions')" href="../../_variables/fileareaoptions.html">$fileareaoptions</a>);
<a name="l3736"><span class="linenum">3736</span></a>          }
<a name="l3737"><span class="linenum">3737</span></a>  
<a name="l3738"><span class="linenum">3738</span></a>  <span class="comment">        // Trigger an evidence of prior learning created event.</span>
<a name="l3739"><span class="linenum">3739</span></a>          \core\event\<a class="class" onClick="logClass('competency_user_evidence_created')" href="../../_classes/competency_user_evidence_created.html" onMouseOver="classPopup(event,'competency_user_evidence_created')">competency_user_evidence_created</a>::<a class="function" onClick="logFunction('create_from_user_evidence')" href="../../_functions/create_from_user_evidence.html" onMouseOver="funcPopup(event,'create_from_user_evidence')">create_from_user_evidence</a>(<a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l3740"><span class="linenum">3740</span></a>  
<a name="l3741"><span class="linenum">3741</span></a>          return <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>;
<a name="l3742"><span class="linenum">3742</span></a>      }
<a name="l3743"><span class="linenum">3743</span></a>  
<a name="l3744"><span class="linenum">3744</span></a>      <span class="comment">/**</span>
<a name="l3745"><span class="linenum">3745</span></a>  <span class="comment">     * Create a new user evidence.</span>
<a name="l3746"><span class="linenum">3746</span></a>  <span class="comment">     *</span>
<a name="l3747"><span class="linenum">3747</span></a>  <span class="comment">     * @param  object $data        The data.</span>
<a name="l3748"><span class="linenum">3748</span></a>  <span class="comment">     * @param  int    $draftitemid The draft ID in which files have been saved.</span>
<a name="l3749"><span class="linenum">3749</span></a>  <span class="comment">     * @return user_evidence</span>
<a name="l3750"><span class="linenum">3750</span></a>  <span class="comment">     */</span>
<a name="l3751"><span class="linenum">3751</span></a>      public static function <a class="function" onClick="logFunction('update_user_evidence')" href="../../_functions/update_user_evidence.html" onMouseOver="funcPopup(event,'update_user_evidence')">update_user_evidence</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>, <a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('draftitemid')" href="../../_variables/draftitemid.html">$draftitemid</a> = null) {
<a name="l3752"><span class="linenum">3752</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3753"><span class="linenum">3753</span></a>          <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a> = <span class="keyword">new </span><a class="class" onClick="logClass('user_evidence')" href="../../_classes/user_evidence.html" onMouseOver="classPopup(event,'user_evidence')">user_evidence</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('id')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l3754"><span class="linenum">3754</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>();
<a name="l3755"><span class="linenum">3755</span></a>  
<a name="l3756"><span class="linenum">3756</span></a>          if (!<a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l3757"><span class="linenum">3757</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:userevidencemanage', 'nopermissions', '');
<a name="l3758"><span class="linenum">3758</span></a>  
<a name="l3759"><span class="linenum">3759</span></a>          } else if (<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>('userid', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>) &amp;&amp; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>-&gt;<a onClick="logVariable('userid')" class="var it42917" onMouseOver="hilite(42917)" onMouseOut="lolite()" href="../../_variables/userid.html">userid</a> != <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>()) {
<a name="l3760"><span class="linenum">3760</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Can not change the userid of a user evidence.');
<a name="l3761"><span class="linenum">3761</span></a>          }
<a name="l3762"><span class="linenum">3762</span></a>  
<a name="l3763"><span class="linenum">3763</span></a>          <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('from_record')" href="../../_functions/from_record.html" onMouseOver="funcPopup(event,'from_record')">from_record</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l3764"><span class="linenum">3764</span></a>          <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l3765"><span class="linenum">3765</span></a>  
<a name="l3766"><span class="linenum">3766</span></a>          if (!empty(<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('draftitemid')" href="../../_variables/draftitemid.html">$draftitemid</a>)) {
<a name="l3767"><span class="linenum">3767</span></a>              <a class="var it30473" onMouseOver="hilite(30473)" onMouseOut="lolite()" onClick="logVariable('fileareaoptions')" href="../../_variables/fileareaoptions.html">$fileareaoptions</a> = array('subdirs' =&gt; true);
<a name="l3768"><span class="linenum">3768</span></a>              <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a> = <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>();
<a name="l3769"><span class="linenum">3769</span></a>              <a class="function" onClick="logFunction('file_save_draft_area_files')" href="../../_functions/file_save_draft_area_files.html" onMouseOver="funcPopup(event,'file_save_draft_area_files')">file_save_draft_area_files</a>(<a class="var it637" onMouseOver="hilite(637)" onMouseOut="lolite()" onClick="logVariable('draftitemid')" href="../../_variables/draftitemid.html">$draftitemid</a>, <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'core_competency', 'userevidence', <a class="var it868" onMouseOver="hilite(868)" onMouseOut="lolite()" onClick="logVariable('itemid')" href="../../_variables/itemid.html">$itemid</a>, <a class="var it30473" onMouseOver="hilite(30473)" onMouseOut="lolite()" onClick="logVariable('fileareaoptions')" href="../../_variables/fileareaoptions.html">$fileareaoptions</a>);
<a name="l3770"><span class="linenum">3770</span></a>          }
<a name="l3771"><span class="linenum">3771</span></a>  
<a name="l3772"><span class="linenum">3772</span></a>  <span class="comment">        // Trigger an evidence of prior learning updated event.</span>
<a name="l3773"><span class="linenum">3773</span></a>          \core\event\<a class="class" onClick="logClass('competency_user_evidence_updated')" href="../../_classes/competency_user_evidence_updated.html" onMouseOver="classPopup(event,'competency_user_evidence_updated')">competency_user_evidence_updated</a>::<a class="function" onClick="logFunction('create_from_user_evidence')" href="../../_functions/create_from_user_evidence.html" onMouseOver="funcPopup(event,'create_from_user_evidence')">create_from_user_evidence</a>(<a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l3774"><span class="linenum">3774</span></a>  
<a name="l3775"><span class="linenum">3775</span></a>          return <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>;
<a name="l3776"><span class="linenum">3776</span></a>      }
<a name="l3777"><span class="linenum">3777</span></a>  
<a name="l3778"><span class="linenum">3778</span></a>      <span class="comment">/**</span>
<a name="l3779"><span class="linenum">3779</span></a>  <span class="comment">     * Delete a user evidence.</span>
<a name="l3780"><span class="linenum">3780</span></a>  <span class="comment">     *</span>
<a name="l3781"><span class="linenum">3781</span></a>  <span class="comment">     * @param  int $id The user evidence ID.</span>
<a name="l3782"><span class="linenum">3782</span></a>  <span class="comment">     * @return bool</span>
<a name="l3783"><span class="linenum">3783</span></a>  <span class="comment">     */</span>
<a name="l3784"><span class="linenum">3784</span></a>      public static function <a class="function" onClick="logFunction('delete_user_evidence')" href="../../_functions/delete_user_evidence.html" onMouseOver="funcPopup(event,'delete_user_evidence')">delete_user_evidence</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>) {
<a name="l3785"><span class="linenum">3785</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3786"><span class="linenum">3786</span></a>          <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a> = <span class="keyword">new </span><a class="class" onClick="logClass('user_evidence')" href="../../_classes/user_evidence.html" onMouseOver="classPopup(event,'user_evidence')">user_evidence</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);
<a name="l3787"><span class="linenum">3787</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>();
<a name="l3788"><span class="linenum">3788</span></a>  
<a name="l3789"><span class="linenum">3789</span></a>          if (!<a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l3790"><span class="linenum">3790</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:userevidencemanage', 'nopermissions', '');
<a name="l3791"><span class="linenum">3791</span></a>          }
<a name="l3792"><span class="linenum">3792</span></a>  
<a name="l3793"><span class="linenum">3793</span></a>  <span class="comment">        // Delete the user evidence.</span>
<a name="l3794"><span class="linenum">3794</span></a>          <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l3795"><span class="linenum">3795</span></a>  
<a name="l3796"><span class="linenum">3796</span></a>  <span class="comment">        // Delete associated files.</span>
<a name="l3797"><span class="linenum">3797</span></a>          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a> = <a class="function" onClick="logFunction('get_file_storage')" href="../../_functions/get_file_storage.html" onMouseOver="funcPopup(event,'get_file_storage')">get_file_storage</a>();
<a name="l3798"><span class="linenum">3798</span></a>          <a class="var it640" onMouseOver="hilite(640)" onMouseOut="lolite()" onClick="logVariable('fs')" href="../../_variables/fs.html">$fs</a>-&gt;<a class="function" onClick="logFunction('delete_area_files')" href="../../_functions/delete_area_files.html" onMouseOver="funcPopup(event,'delete_area_files')">delete_area_files</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, 'core_competency', 'userevidence', <a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);
<a name="l3799"><span class="linenum">3799</span></a>  
<a name="l3800"><span class="linenum">3800</span></a>  <span class="comment">        // Delete relation between evidence and competencies.</span>
<a name="l3801"><span class="linenum">3801</span></a>          <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('set_id')" href="../../_functions/set_id.html" onMouseOver="funcPopup(event,'set_id')">set_id</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);     <span class="comment">// Restore the ID to fully mock the object.</span>
<a name="l3802"><span class="linenum">3802</span></a>          <a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a> = <a class="class" onClick="logClass('user_evidence_competency')" href="../../_classes/user_evidence_competency.html" onMouseOver="classPopup(event,'user_evidence_competency')">user_evidence_competency</a>::<a class="function" onClick="logFunction('get_competencies_by_userevidenceid')" href="../../_functions/get_competencies_by_userevidenceid.html" onMouseOver="funcPopup(event,'get_competencies_by_userevidenceid')">get_competencies_by_userevidenceid</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);
<a name="l3803"><span class="linenum">3803</span></a>          foreach (<a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a> as <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>) {
<a name="l3804"><span class="linenum">3804</span></a>              static::<a class="function" onClick="logFunction('delete_user_evidence_competency')" href="../../_functions/delete_user_evidence_competency.html" onMouseOver="funcPopup(event,'delete_user_evidence_competency')">delete_user_evidence_competency</a>(<a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>, <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>());
<a name="l3805"><span class="linenum">3805</span></a>          }
<a name="l3806"><span class="linenum">3806</span></a>  
<a name="l3807"><span class="linenum">3807</span></a>  <span class="comment">        // Trigger an evidence of prior learning deleted event.</span>
<a name="l3808"><span class="linenum">3808</span></a>          \core\event\<a class="class" onClick="logClass('competency_user_evidence_deleted')" href="../../_classes/competency_user_evidence_deleted.html" onMouseOver="classPopup(event,'competency_user_evidence_deleted')">competency_user_evidence_deleted</a>::<a class="function" onClick="logFunction('create_from_user_evidence')" href="../../_functions/create_from_user_evidence.html" onMouseOver="funcPopup(event,'create_from_user_evidence')">create_from_user_evidence</a>(<a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l3809"><span class="linenum">3809</span></a>  
<a name="l3810"><span class="linenum">3810</span></a>          <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('set_id')" href="../../_functions/set_id.html" onMouseOver="funcPopup(event,'set_id')">set_id</a>(0);       <span class="comment">// Restore the object.</span>
<a name="l3811"><span class="linenum">3811</span></a>  
<a name="l3812"><span class="linenum">3812</span></a>          return true;
<a name="l3813"><span class="linenum">3813</span></a>      }
<a name="l3814"><span class="linenum">3814</span></a>  
<a name="l3815"><span class="linenum">3815</span></a>      <span class="comment">/**</span>
<a name="l3816"><span class="linenum">3816</span></a>  <span class="comment">     * List the user evidence of a user.</span>
<a name="l3817"><span class="linenum">3817</span></a>  <span class="comment">     *</span>
<a name="l3818"><span class="linenum">3818</span></a>  <span class="comment">     * @param  int $userid The user ID.</span>
<a name="l3819"><span class="linenum">3819</span></a>  <span class="comment">     * @return user_evidence[]</span>
<a name="l3820"><span class="linenum">3820</span></a>  <span class="comment">     */</span>
<a name="l3821"><span class="linenum">3821</span></a>      public static function <a class="function" onClick="logFunction('list_user_evidence')" href="../../_functions/list_user_evidence.html" onMouseOver="funcPopup(event,'list_user_evidence')">list_user_evidence</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) {
<a name="l3822"><span class="linenum">3822</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3823"><span class="linenum">3823</span></a>          if (!<a class="class" onClick="logClass('user_evidence')" href="../../_classes/user_evidence.html" onMouseOver="classPopup(event,'user_evidence')">user_evidence</a>::<a class="function" onClick="logFunction('can_read_user')" href="../../_functions/can_read_user.html" onMouseOver="funcPopup(event,'can_read_user')">can_read_user</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>)) {
<a name="l3824"><span class="linenum">3824</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_user')" href="../../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>);
<a name="l3825"><span class="linenum">3825</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:userevidenceview', 'nopermissions', '');
<a name="l3826"><span class="linenum">3826</span></a>          }
<a name="l3827"><span class="linenum">3827</span></a>  
<a name="l3828"><span class="linenum">3828</span></a>          <a class="var it10078" onMouseOver="hilite(10078)" onMouseOut="lolite()" onClick="logVariable('evidence')" href="../../_variables/evidence.html">$evidence</a> = <a class="class" onClick="logClass('user_evidence')" href="../../_classes/user_evidence.html" onMouseOver="classPopup(event,'user_evidence')">user_evidence</a>::<a class="function" onClick="logFunction('get_records')" href="../../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>(array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>), 'name');
<a name="l3829"><span class="linenum">3829</span></a>          return <a class="var it10078" onMouseOver="hilite(10078)" onMouseOut="lolite()" onClick="logVariable('evidence')" href="../../_variables/evidence.html">$evidence</a>;
<a name="l3830"><span class="linenum">3830</span></a>      }
<a name="l3831"><span class="linenum">3831</span></a>  
<a name="l3832"><span class="linenum">3832</span></a>      <span class="comment">/**</span>
<a name="l3833"><span class="linenum">3833</span></a>  <span class="comment">     * Link a user evidence with a competency.</span>
<a name="l3834"><span class="linenum">3834</span></a>  <span class="comment">     *</span>
<a name="l3835"><span class="linenum">3835</span></a>  <span class="comment">     * @param  user_evidence|int $userevidenceorid User evidence or its ID.</span>
<a name="l3836"><span class="linenum">3836</span></a>  <span class="comment">     * @param  int $competencyid Competency ID.</span>
<a name="l3837"><span class="linenum">3837</span></a>  <span class="comment">     * @return user_evidence_competency</span>
<a name="l3838"><span class="linenum">3838</span></a>  <span class="comment">     */</span>
<a name="l3839"><span class="linenum">3839</span></a>      public static function <a class="function" onClick="logFunction('create_user_evidence_competency')" href="../../_functions/create_user_evidence_competency.html" onMouseOver="funcPopup(event,'create_user_evidence_competency')">create_user_evidence_competency</a>(<a class="var it30474" onMouseOver="hilite(30474)" onMouseOut="lolite()" onClick="logVariable('userevidenceorid')" href="../../_variables/userevidenceorid.html">$userevidenceorid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>) {
<a name="l3840"><span class="linenum">3840</span></a>          global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l3841"><span class="linenum">3841</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3842"><span class="linenum">3842</span></a>  
<a name="l3843"><span class="linenum">3843</span></a>          <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a> = <a class="var it30474" onMouseOver="hilite(30474)" onMouseOut="lolite()" onClick="logVariable('userevidenceorid')" href="../../_variables/userevidenceorid.html">$userevidenceorid</a>;
<a name="l3844"><span class="linenum">3844</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>)) {
<a name="l3845"><span class="linenum">3845</span></a>              <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a> = self::<a class="function" onClick="logFunction('read_user_evidence')" href="../../_functions/read_user_evidence.html" onMouseOver="funcPopup(event,'read_user_evidence')">read_user_evidence</a>(<a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>);
<a name="l3846"><span class="linenum">3846</span></a>          }
<a name="l3847"><span class="linenum">3847</span></a>  
<a name="l3848"><span class="linenum">3848</span></a>  <span class="comment">        // Perform user evidence capability checks.</span>
<a name="l3849"><span class="linenum">3849</span></a>          if (!<a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l3850"><span class="linenum">3850</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>();
<a name="l3851"><span class="linenum">3851</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:userevidencemanage', 'nopermissions', '');
<a name="l3852"><span class="linenum">3852</span></a>          }
<a name="l3853"><span class="linenum">3853</span></a>  
<a name="l3854"><span class="linenum">3854</span></a>  <span class="comment">        // Perform competency capability checks.</span>
<a name="l3855"><span class="linenum">3855</span></a>          <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = self::<a class="function" onClick="logFunction('read_competency')" href="../../_functions/read_competency.html" onMouseOver="funcPopup(event,'read_competency')">read_competency</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l3856"><span class="linenum">3856</span></a>  
<a name="l3857"><span class="linenum">3857</span></a>  <span class="comment">        // Get (and create) the relation.</span>
<a name="l3858"><span class="linenum">3858</span></a>          <a class="var it2290" onMouseOver="hilite(2290)" onMouseOut="lolite()" onClick="logVariable('relation')" href="../../_variables/relation.html">$relation</a> = <a class="class" onClick="logClass('user_evidence_competency')" href="../../_classes/user_evidence_competency.html" onMouseOver="classPopup(event,'user_evidence_competency')">user_evidence_competency</a>::<a class="function" onClick="logFunction('get_relation')" href="../../_functions/get_relation.html" onMouseOver="funcPopup(event,'get_relation')">get_relation</a>(<a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(), <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>());
<a name="l3859"><span class="linenum">3859</span></a>          if (!<a class="var it2290" onMouseOver="hilite(2290)" onMouseOut="lolite()" onClick="logVariable('relation')" href="../../_variables/relation.html">$relation</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>()) {
<a name="l3860"><span class="linenum">3860</span></a>              <a class="var it2290" onMouseOver="hilite(2290)" onMouseOut="lolite()" onClick="logVariable('relation')" href="../../_variables/relation.html">$relation</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l3861"><span class="linenum">3861</span></a>  
<a name="l3862"><span class="linenum">3862</span></a>              <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a> = <a class="class" onClick="logClass('url')" href="../../_classes/url.html" onMouseOver="classPopup(event,'url')">url</a>::<a class="function" onClick="logFunction('user_evidence')" href="../../_functions/user_evidence.html" onMouseOver="funcPopup(event,'user_evidence')">user_evidence</a>(<a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>());
<a name="l3863"><span class="linenum">3863</span></a>              self::<a class="function" onClick="logFunction('add_evidence')" href="../../_functions/add_evidence.html" onMouseOver="funcPopup(event,'add_evidence')">add_evidence</a>(
<a name="l3864"><span class="linenum">3864</span></a>                  <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>(),
<a name="l3865"><span class="linenum">3865</span></a>                  <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>,
<a name="l3866"><span class="linenum">3866</span></a>                  <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(),
<a name="l3867"><span class="linenum">3867</span></a>                  <a class="class" onClick="logClass('evidence')" href="../../_classes/evidence.html" onMouseOver="classPopup(event,'evidence')">evidence</a>::ACTION_LOG,
<a name="l3868"><span class="linenum">3868</span></a>                  'evidence_evidenceofpriorlearninglinked',
<a name="l3869"><span class="linenum">3869</span></a>                  'core_competency',
<a name="l3870"><span class="linenum">3870</span></a>                  <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>(),
<a name="l3871"><span class="linenum">3871</span></a>                  false,
<a name="l3872"><span class="linenum">3872</span></a>                  <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../_variables/link.html">$link</a>-&gt;<a class="function" onClick="logFunction('out')" href="../../_functions/out.html" onMouseOver="funcPopup(event,'out')">out</a>(false),
<a name="l3873"><span class="linenum">3873</span></a>                  null,
<a name="l3874"><span class="linenum">3874</span></a>                  <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;id
<a name="l3875"><span class="linenum">3875</span></a>              );
<a name="l3876"><span class="linenum">3876</span></a>          }
<a name="l3877"><span class="linenum">3877</span></a>  
<a name="l3878"><span class="linenum">3878</span></a>          return <a class="var it2290" onMouseOver="hilite(2290)" onMouseOut="lolite()" onClick="logVariable('relation')" href="../../_variables/relation.html">$relation</a>;
<a name="l3879"><span class="linenum">3879</span></a>      }
<a name="l3880"><span class="linenum">3880</span></a>  
<a name="l3881"><span class="linenum">3881</span></a>      <span class="comment">/**</span>
<a name="l3882"><span class="linenum">3882</span></a>  <span class="comment">     * Delete a relationship between a user evidence and a competency.</span>
<a name="l3883"><span class="linenum">3883</span></a>  <span class="comment">     *</span>
<a name="l3884"><span class="linenum">3884</span></a>  <span class="comment">     * @param  user_evidence|int $userevidenceorid User evidence or its ID.</span>
<a name="l3885"><span class="linenum">3885</span></a>  <span class="comment">     * @param  int $competencyid Competency ID.</span>
<a name="l3886"><span class="linenum">3886</span></a>  <span class="comment">     * @return bool</span>
<a name="l3887"><span class="linenum">3887</span></a>  <span class="comment">     */</span>
<a name="l3888"><span class="linenum">3888</span></a>      public static function <a class="function" onClick="logFunction('delete_user_evidence_competency')" href="../../_functions/delete_user_evidence_competency.html" onMouseOver="funcPopup(event,'delete_user_evidence_competency')">delete_user_evidence_competency</a>(<a class="var it30474" onMouseOver="hilite(30474)" onMouseOut="lolite()" onClick="logVariable('userevidenceorid')" href="../../_variables/userevidenceorid.html">$userevidenceorid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>) {
<a name="l3889"><span class="linenum">3889</span></a>          global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l3890"><span class="linenum">3890</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l3891"><span class="linenum">3891</span></a>  
<a name="l3892"><span class="linenum">3892</span></a>          <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a> = <a class="var it30474" onMouseOver="hilite(30474)" onMouseOut="lolite()" onClick="logVariable('userevidenceorid')" href="../../_variables/userevidenceorid.html">$userevidenceorid</a>;
<a name="l3893"><span class="linenum">3893</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>)) {
<a name="l3894"><span class="linenum">3894</span></a>              <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a> = self::<a class="function" onClick="logFunction('read_user_evidence')" href="../../_functions/read_user_evidence.html" onMouseOver="funcPopup(event,'read_user_evidence')">read_user_evidence</a>(<a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>);
<a name="l3895"><span class="linenum">3895</span></a>          }
<a name="l3896"><span class="linenum">3896</span></a>  
<a name="l3897"><span class="linenum">3897</span></a>  <span class="comment">        // Perform user evidence capability checks.</span>
<a name="l3898"><span class="linenum">3898</span></a>          if (!<a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l3899"><span class="linenum">3899</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>();
<a name="l3900"><span class="linenum">3900</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:userevidencemanage', 'nopermissions', '');
<a name="l3901"><span class="linenum">3901</span></a>          }
<a name="l3902"><span class="linenum">3902</span></a>  
<a name="l3903"><span class="linenum">3903</span></a>  <span class="comment">        // Get (and delete) the relation.</span>
<a name="l3904"><span class="linenum">3904</span></a>          <a class="var it2290" onMouseOver="hilite(2290)" onMouseOut="lolite()" onClick="logVariable('relation')" href="../../_variables/relation.html">$relation</a> = <a class="class" onClick="logClass('user_evidence_competency')" href="../../_classes/user_evidence_competency.html" onMouseOver="classPopup(event,'user_evidence_competency')">user_evidence_competency</a>::<a class="function" onClick="logFunction('get_relation')" href="../../_functions/get_relation.html" onMouseOver="funcPopup(event,'get_relation')">get_relation</a>(<a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(), <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l3905"><span class="linenum">3905</span></a>          if (!<a class="var it2290" onMouseOver="hilite(2290)" onMouseOut="lolite()" onClick="logVariable('relation')" href="../../_variables/relation.html">$relation</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>()) {
<a name="l3906"><span class="linenum">3906</span></a>              return true;
<a name="l3907"><span class="linenum">3907</span></a>          }
<a name="l3908"><span class="linenum">3908</span></a>  
<a name="l3909"><span class="linenum">3909</span></a>          <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a> = <a class="var it2290" onMouseOver="hilite(2290)" onMouseOut="lolite()" onClick="logVariable('relation')" href="../../_variables/relation.html">$relation</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l3910"><span class="linenum">3910</span></a>          if (<a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a>) {
<a name="l3911"><span class="linenum">3911</span></a>              self::<a class="function" onClick="logFunction('add_evidence')" href="../../_functions/add_evidence.html" onMouseOver="funcPopup(event,'add_evidence')">add_evidence</a>(
<a name="l3912"><span class="linenum">3912</span></a>                  <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>(),
<a name="l3913"><span class="linenum">3913</span></a>                  <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>,
<a name="l3914"><span class="linenum">3914</span></a>                  <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(),
<a name="l3915"><span class="linenum">3915</span></a>                  <a class="class" onClick="logClass('evidence')" href="../../_classes/evidence.html" onMouseOver="classPopup(event,'evidence')">evidence</a>::ACTION_LOG,
<a name="l3916"><span class="linenum">3916</span></a>                  'evidence_evidenceofpriorlearningunlinked',
<a name="l3917"><span class="linenum">3917</span></a>                  'core_competency',
<a name="l3918"><span class="linenum">3918</span></a>                  <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>(),
<a name="l3919"><span class="linenum">3919</span></a>                  false,
<a name="l3920"><span class="linenum">3920</span></a>                  null,
<a name="l3921"><span class="linenum">3921</span></a>                  null,
<a name="l3922"><span class="linenum">3922</span></a>                  <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;id
<a name="l3923"><span class="linenum">3923</span></a>              );
<a name="l3924"><span class="linenum">3924</span></a>          }
<a name="l3925"><span class="linenum">3925</span></a>  
<a name="l3926"><span class="linenum">3926</span></a>          return <a class="var it432" onMouseOver="hilite(432)" onMouseOut="lolite()" onClick="logVariable('success')" href="../../_variables/success.html">$success</a>;
<a name="l3927"><span class="linenum">3927</span></a>      }
<a name="l3928"><span class="linenum">3928</span></a>  
<a name="l3929"><span class="linenum">3929</span></a>      <span class="comment">/**</span>
<a name="l3930"><span class="linenum">3930</span></a>  <span class="comment">     * Send request review for user evidence competencies.</span>
<a name="l3931"><span class="linenum">3931</span></a>  <span class="comment">     *</span>
<a name="l3932"><span class="linenum">3932</span></a>  <span class="comment">     * @param  int $id The user evidence ID.</span>
<a name="l3933"><span class="linenum">3933</span></a>  <span class="comment">     * @return bool</span>
<a name="l3934"><span class="linenum">3934</span></a>  <span class="comment">     */</span>
<a name="l3935"><span class="linenum">3935</span></a>      public static function <a class="function" onClick="logFunction('request_review_of_user_evidence_linked_competencies')" href="../../_functions/request_review_of_user_evidence_linked_competencies.html" onMouseOver="funcPopup(event,'request_review_of_user_evidence_linked_competencies')">request_review_of_user_evidence_linked_competencies</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>) {
<a name="l3936"><span class="linenum">3936</span></a>          <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a> = <span class="keyword">new </span><a class="class" onClick="logClass('user_evidence')" href="../../_classes/user_evidence.html" onMouseOver="classPopup(event,'user_evidence')">user_evidence</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);
<a name="l3937"><span class="linenum">3937</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>();
<a name="l3938"><span class="linenum">3938</span></a>          <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> = <a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>();
<a name="l3939"><span class="linenum">3939</span></a>  
<a name="l3940"><span class="linenum">3940</span></a>          if (!<a class="var it4291" onMouseOver="hilite(4291)" onMouseOut="lolite()" onClick="logVariable('userevidence')" href="../../_variables/userevidence.html">$userevidence</a>-&gt;<a class="function" onClick="logFunction('can_manage')" href="../../_functions/can_manage.html" onMouseOver="funcPopup(event,'can_manage')">can_manage</a>()) {
<a name="l3941"><span class="linenum">3941</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:userevidencemanage', 'nopermissions', '');
<a name="l3942"><span class="linenum">3942</span></a>          }
<a name="l3943"><span class="linenum">3943</span></a>  
<a name="l3944"><span class="linenum">3944</span></a>          <a class="var it9647" onMouseOver="hilite(9647)" onMouseOut="lolite()" onClick="logVariable('usercompetencies')" href="../../_variables/usercompetencies.html">$usercompetencies</a> = <a class="class" onClick="logClass('user_evidence_competency')" href="../../_classes/user_evidence_competency.html" onMouseOver="classPopup(event,'user_evidence_competency')">user_evidence_competency</a>::<a class="function" onClick="logFunction('get_user_competencies_by_userevidenceid')" href="../../_functions/get_user_competencies_by_userevidenceid.html" onMouseOver="funcPopup(event,'get_user_competencies_by_userevidenceid')">get_user_competencies_by_userevidenceid</a>(<a class="var it7" onMouseOver="hilite(7)" onMouseOut="lolite()" onClick="logVariable('id')" href="../../_variables/id.html">$id</a>);
<a name="l3945"><span class="linenum">3945</span></a>          foreach (<a class="var it9647" onMouseOver="hilite(9647)" onMouseOut="lolite()" onClick="logVariable('usercompetencies')" href="../../_variables/usercompetencies.html">$usercompetencies</a> as <a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>) {
<a name="l3946"><span class="linenum">3946</span></a>              if (<a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() == <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::STATUS_IDLE) {
<a name="l3947"><span class="linenum">3947</span></a>                  static::<a class="function" onClick="logFunction('user_competency_request_review')" href="../../_functions/user_competency_request_review.html" onMouseOver="funcPopup(event,'user_competency_request_review')">user_competency_request_review</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>-&gt;get_competencyid());
<a name="l3948"><span class="linenum">3948</span></a>              }
<a name="l3949"><span class="linenum">3949</span></a>          }
<a name="l3950"><span class="linenum">3950</span></a>  
<a name="l3951"><span class="linenum">3951</span></a>          return true;
<a name="l3952"><span class="linenum">3952</span></a>      }
<a name="l3953"><span class="linenum">3953</span></a>  
<a name="l3954"><span class="linenum">3954</span></a>      <span class="comment">/**</span>
<a name="l3955"><span class="linenum">3955</span></a>  <span class="comment">     * Recursively duplicate competencies from a tree, we start duplicating from parents to children to have a correct path.</span>
<a name="l3956"><span class="linenum">3956</span></a>  <span class="comment">     * This method does not copy the related competencies.</span>
<a name="l3957"><span class="linenum">3957</span></a>  <span class="comment">     *</span>
<a name="l3958"><span class="linenum">3958</span></a>  <span class="comment">     * @param int $frameworkid - framework id</span>
<a name="l3959"><span class="linenum">3959</span></a>  <span class="comment">     * @param competency[] $tree - array of competencies object</span>
<a name="l3960"><span class="linenum">3960</span></a>  <span class="comment">     * @param int $oldparent - old parent id</span>
<a name="l3961"><span class="linenum">3961</span></a>  <span class="comment">     * @param int $newparent - new parent id</span>
<a name="l3962"><span class="linenum">3962</span></a>  <span class="comment">     * @return competency[] $matchids - List of old competencies ids matched with new competencies object.</span>
<a name="l3963"><span class="linenum">3963</span></a>  <span class="comment">     */</span>
<a name="l3964"><span class="linenum">3964</span></a>      protected static function <a class="function" onClick="logFunction('duplicate_competency_tree')" href="../../_functions/duplicate_competency_tree.html" onMouseOver="funcPopup(event,'duplicate_competency_tree')">duplicate_competency_tree</a>(<a class="var it11569" onMouseOver="hilite(11569)" onMouseOut="lolite()" onClick="logVariable('frameworkid')" href="../../_variables/frameworkid.html">$frameworkid</a>, <a class="var it2105" onMouseOver="hilite(2105)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>, <a class="var it30475" onMouseOver="hilite(30475)" onMouseOut="lolite()" onClick="logVariable('oldparent')" href="../../_variables/oldparent.html">$oldparent</a> = 0, <a class="var it315" onMouseOver="hilite(315)" onMouseOut="lolite()" onClick="logVariable('newparent')" href="../../_variables/newparent.html">$newparent</a> = 0) {
<a name="l3965"><span class="linenum">3965</span></a>          <a class="var it23844" onMouseOver="hilite(23844)" onMouseOut="lolite()" onClick="logVariable('matchids')" href="../../_variables/matchids.html">$matchids</a> = array();
<a name="l3966"><span class="linenum">3966</span></a>          foreach (<a class="var it2105" onMouseOver="hilite(2105)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a> as <a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a>) {
<a name="l3967"><span class="linenum">3967</span></a>              if (<a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a>-&gt;<a onClick="logVariable('competency')" class="var it43037" onMouseOver="hilite(43037)" onMouseOut="lolite()" href="../../_variables/competency.html">competency</a>-&gt;get_parentid() == <a class="var it30475" onMouseOver="hilite(30475)" onMouseOut="lolite()" onClick="logVariable('oldparent')" href="../../_variables/oldparent.html">$oldparent</a>) {
<a name="l3968"><span class="linenum">3968</span></a>                  <a class="var it2605" onMouseOver="hilite(2605)" onMouseOut="lolite()" onClick="logVariable('parentid')" href="../../_variables/parentid.html">$parentid</a> = <a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a>-&gt;<a onClick="logVariable('competency')" class="var it43037" onMouseOver="hilite(43037)" onMouseOut="lolite()" href="../../_variables/competency.html">competency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>();
<a name="l3969"><span class="linenum">3969</span></a>  
<a name="l3970"><span class="linenum">3970</span></a>  <span class="comment">                // Create the competency.</span>
<a name="l3971"><span class="linenum">3971</span></a>                  <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>(0, <a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a>-&gt;<a onClick="logVariable('competency')" class="var it43037" onMouseOver="hilite(43037)" onMouseOut="lolite()" href="../../_variables/competency.html">competency</a>-&gt;<a class="function" onClick="logFunction('to_record')" href="../../_functions/to_record.html" onMouseOver="funcPopup(event,'to_record')">to_record</a>());
<a name="l3972"><span class="linenum">3972</span></a>                  <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;set_competencyframeworkid(<a class="var it11569" onMouseOver="hilite(11569)" onMouseOut="lolite()" onClick="logVariable('frameworkid')" href="../../_variables/frameworkid.html">$frameworkid</a>);
<a name="l3973"><span class="linenum">3973</span></a>                  <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;set_parentid(<a class="var it315" onMouseOver="hilite(315)" onMouseOut="lolite()" onClick="logVariable('newparent')" href="../../_variables/newparent.html">$newparent</a>);
<a name="l3974"><span class="linenum">3974</span></a>                  <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('set_path')" href="../../_functions/set_path.html" onMouseOver="funcPopup(event,'set_path')">set_path</a>('');
<a name="l3975"><span class="linenum">3975</span></a>                  <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('set_id')" href="../../_functions/set_id.html" onMouseOver="funcPopup(event,'set_id')">set_id</a>(0);
<a name="l3976"><span class="linenum">3976</span></a>                  <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('reset_rule')" href="../../_functions/reset_rule.html" onMouseOver="funcPopup(event,'reset_rule')">reset_rule</a>();
<a name="l3977"><span class="linenum">3977</span></a>                  <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l3978"><span class="linenum">3978</span></a>  
<a name="l3979"><span class="linenum">3979</span></a>  <span class="comment">                // Trigger the created event competency.</span>
<a name="l3980"><span class="linenum">3980</span></a>                  \core\event\<a class="class" onClick="logClass('competency_created')" href="../../_classes/competency_created.html" onMouseOver="classPopup(event,'competency_created')">competency_created</a>::<a class="function" onClick="logFunction('create_from_competency')" href="../../_functions/create_from_competency.html" onMouseOver="funcPopup(event,'create_from_competency')">create_from_competency</a>(<a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l3981"><span class="linenum">3981</span></a>  
<a name="l3982"><span class="linenum">3982</span></a>  <span class="comment">                // Match the old id with the new one.</span>
<a name="l3983"><span class="linenum">3983</span></a>                  <a class="var it23844" onMouseOver="hilite(23844)" onMouseOut="lolite()" onClick="logVariable('matchids')" href="../../_variables/matchids.html">$matchids</a>[<a class="var it2605" onMouseOver="hilite(2605)" onMouseOut="lolite()" onClick="logVariable('parentid')" href="../../_variables/parentid.html">$parentid</a>] = <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>;
<a name="l3984"><span class="linenum">3984</span></a>  
<a name="l3985"><span class="linenum">3985</span></a>                  if (!empty(<a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a>-&gt;<a onClick="logVariable('children')" class="var it43037" onMouseOver="hilite(43037)" onMouseOut="lolite()" href="../../_variables/children.html">children</a>)) {
<a name="l3986"><span class="linenum">3986</span></a>  <span class="comment">                    // Duplicate children competency.</span>
<a name="l3987"><span class="linenum">3987</span></a>                      <a class="var it30476" onMouseOver="hilite(30476)" onMouseOut="lolite()" onClick="logVariable('childrenids')" href="../../_variables/childrenids.html">$childrenids</a> = self::<a class="function" onClick="logFunction('duplicate_competency_tree')" href="../../_functions/duplicate_competency_tree.html" onMouseOver="funcPopup(event,'duplicate_competency_tree')">duplicate_competency_tree</a>(<a class="var it11569" onMouseOver="hilite(11569)" onMouseOut="lolite()" onClick="logVariable('frameworkid')" href="../../_variables/frameworkid.html">$frameworkid</a>, <a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a>-&gt;<a onClick="logVariable('children')" class="var it43037" onMouseOver="hilite(43037)" onMouseOut="lolite()" href="../../_variables/children.html">children</a>, <a class="var it2605" onMouseOver="hilite(2605)" onMouseOut="lolite()" onClick="logVariable('parentid')" href="../../_variables/parentid.html">$parentid</a>, <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>());
<a name="l3988"><span class="linenum">3988</span></a>  <span class="comment">                    // Array_merge does not keep keys when merging so we use the + operator.</span>
<a name="l3989"><span class="linenum">3989</span></a>                      <a class="var it23844" onMouseOver="hilite(23844)" onMouseOut="lolite()" onClick="logVariable('matchids')" href="../../_variables/matchids.html">$matchids</a> = <a class="var it23844" onMouseOver="hilite(23844)" onMouseOut="lolite()" onClick="logVariable('matchids')" href="../../_variables/matchids.html">$matchids</a> + <a class="var it30476" onMouseOver="hilite(30476)" onMouseOut="lolite()" onClick="logVariable('childrenids')" href="../../_variables/childrenids.html">$childrenids</a>;
<a name="l3990"><span class="linenum">3990</span></a>                  }
<a name="l3991"><span class="linenum">3991</span></a>              }
<a name="l3992"><span class="linenum">3992</span></a>          }
<a name="l3993"><span class="linenum">3993</span></a>          return <a class="var it23844" onMouseOver="hilite(23844)" onMouseOut="lolite()" onClick="logVariable('matchids')" href="../../_variables/matchids.html">$matchids</a>;
<a name="l3994"><span class="linenum">3994</span></a>      }
<a name="l3995"><span class="linenum">3995</span></a>  
<a name="l3996"><span class="linenum">3996</span></a>      <span class="comment">/**</span>
<a name="l3997"><span class="linenum">3997</span></a>  <span class="comment">     * Recursively migrate competency rules.</span>
<a name="l3998"><span class="linenum">3998</span></a>  <span class="comment">     *</span>
<a name="l3999"><span class="linenum">3999</span></a>  <span class="comment">     * @param competency[] $tree - array of competencies object</span>
<a name="l4000"><span class="linenum">4000</span></a>  <span class="comment">     * @param competency[] $matchids - List of old competencies ids matched with new competencies object</span>
<a name="l4001"><span class="linenum">4001</span></a>  <span class="comment">     */</span>
<a name="l4002"><span class="linenum">4002</span></a>      protected static function <a class="function" onClick="logFunction('migrate_competency_tree_rules')" href="../../_functions/migrate_competency_tree_rules.html" onMouseOver="funcPopup(event,'migrate_competency_tree_rules')">migrate_competency_tree_rules</a>(<a class="var it2105" onMouseOver="hilite(2105)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a>, <a class="var it23844" onMouseOver="hilite(23844)" onMouseOut="lolite()" onClick="logVariable('matchids')" href="../../_variables/matchids.html">$matchids</a>) {
<a name="l4003"><span class="linenum">4003</span></a>  
<a name="l4004"><span class="linenum">4004</span></a>          foreach (<a class="var it2105" onMouseOver="hilite(2105)" onMouseOut="lolite()" onClick="logVariable('tree')" href="../../_variables/tree.html">$tree</a> as <a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a>) {
<a name="l4005"><span class="linenum">4005</span></a>              <a class="var it30477" onMouseOver="hilite(30477)" onMouseOut="lolite()" onClick="logVariable('oldcompid')" href="../../_variables/oldcompid.html">$oldcompid</a> = <a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a>-&gt;<a onClick="logVariable('competency')" class="var it43037" onMouseOver="hilite(43037)" onMouseOut="lolite()" href="../../_variables/competency.html">competency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>();
<a name="l4006"><span class="linenum">4006</span></a>              if (<a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a>-&gt;<a onClick="logVariable('competency')" class="var it43037" onMouseOver="hilite(43037)" onMouseOut="lolite()" href="../../_variables/competency.html">competency</a>-&gt;get_ruletype() &amp;&amp; <a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it30477" onMouseOver="hilite(30477)" onMouseOut="lolite()" onClick="logVariable('oldcompid')" href="../../_variables/oldcompid.html">$oldcompid</a>, <a class="var it23844" onMouseOver="hilite(23844)" onMouseOut="lolite()" onClick="logVariable('matchids')" href="../../_variables/matchids.html">$matchids</a>)) {
<a name="l4007"><span class="linenum">4007</span></a>                  try {
<a name="l4008"><span class="linenum">4008</span></a>  <span class="comment">                    // Get the new competency.</span>
<a name="l4009"><span class="linenum">4009</span></a>                      <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <a class="var it23844" onMouseOver="hilite(23844)" onMouseOut="lolite()" onClick="logVariable('matchids')" href="../../_variables/matchids.html">$matchids</a>[<a class="var it30477" onMouseOver="hilite(30477)" onMouseOut="lolite()" onClick="logVariable('oldcompid')" href="../../_variables/oldcompid.html">$oldcompid</a>];
<a name="l4010"><span class="linenum">4010</span></a>                      <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../_variables/class.html">$class</a> = <a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a>-&gt;<a onClick="logVariable('competency')" class="var it43037" onMouseOver="hilite(43037)" onMouseOut="lolite()" href="../../_variables/competency.html">competency</a>-&gt;get_ruletype();
<a name="l4011"><span class="linenum">4011</span></a>                      <a class="var it30478" onMouseOver="hilite(30478)" onMouseOut="lolite()" onClick="logVariable('newruleconfig')" href="../../_variables/newruleconfig.html">$newruleconfig</a> = <a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../_variables/class.html">$class</a>::<a class="function" onClick="logFunction('migrate_config')" href="../../_functions/migrate_config.html" onMouseOver="funcPopup(event,'migrate_config')">migrate_config</a>(<a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a>-&gt;<a onClick="logVariable('competency')" class="var it43037" onMouseOver="hilite(43037)" onMouseOut="lolite()" href="../../_variables/competency.html">competency</a>-&gt;get_ruleconfig(), <a class="var it23844" onMouseOver="hilite(23844)" onMouseOut="lolite()" onClick="logVariable('matchids')" href="../../_variables/matchids.html">$matchids</a>);
<a name="l4012"><span class="linenum">4012</span></a>                      <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;set_ruleconfig(<a class="var it30478" onMouseOver="hilite(30478)" onMouseOut="lolite()" onClick="logVariable('newruleconfig')" href="../../_variables/newruleconfig.html">$newruleconfig</a>);
<a name="l4013"><span class="linenum">4013</span></a>                      <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;set_ruletype(<a class="var it185" onMouseOver="hilite(185)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../_variables/class.html">$class</a>);
<a name="l4014"><span class="linenum">4014</span></a>                      <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;set_ruleoutcome(<a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a>-&gt;<a onClick="logVariable('competency')" class="var it43037" onMouseOver="hilite(43037)" onMouseOut="lolite()" href="../../_variables/competency.html">competency</a>-&gt;get_ruleoutcome());
<a name="l4015"><span class="linenum">4015</span></a>                      <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l4016"><span class="linenum">4016</span></a>                  } catch (\Exception <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>) {
<a name="l4017"><span class="linenum">4017</span></a>                      <a class="function" onClick="logFunction('debugging')" href="../../_functions/debugging.html" onMouseOver="funcPopup(event,'debugging')">debugging</a>('Could not migrate competency rule from: ' . <a class="var it30477" onMouseOver="hilite(30477)" onMouseOut="lolite()" onClick="logVariable('oldcompid')" href="../../_variables/oldcompid.html">$oldcompid</a> . ' to: ' . <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>() . '.' .
<a name="l4018"><span class="linenum">4018</span></a>                          ' Exception: ' . <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('e')" href="../../_variables/e.html">$e</a>-&gt;<a class="function" onClick="logFunction('getMessage')" href="../../_functions/getmessage.html" onMouseOver="funcPopup(event,'getmessage')">getMessage</a>(), <a class="constant" onClick="logConstant('DEBUG_DEVELOPER')" href="../../_constants/DEBUG_DEVELOPER.html" onMouseOver="constPopup(event,'DEBUG_DEVELOPER')">DEBUG_DEVELOPER</a>);
<a name="l4019"><span class="linenum">4019</span></a>                      <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('reset_rule')" href="../../_functions/reset_rule.html" onMouseOver="funcPopup(event,'reset_rule')">reset_rule</a>();
<a name="l4020"><span class="linenum">4020</span></a>                  }
<a name="l4021"><span class="linenum">4021</span></a>              }
<a name="l4022"><span class="linenum">4022</span></a>  
<a name="l4023"><span class="linenum">4023</span></a>              if (!empty(<a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a>-&gt;<a onClick="logVariable('children')" class="var it43037" onMouseOver="hilite(43037)" onMouseOut="lolite()" href="../../_variables/children.html">children</a>)) {
<a name="l4024"><span class="linenum">4024</span></a>                  self::<a class="function" onClick="logFunction('migrate_competency_tree_rules')" href="../../_functions/migrate_competency_tree_rules.html" onMouseOver="funcPopup(event,'migrate_competency_tree_rules')">migrate_competency_tree_rules</a>(<a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('node')" href="../../_variables/node.html">$node</a>-&gt;<a onClick="logVariable('children')" class="var it43037" onMouseOver="hilite(43037)" onMouseOut="lolite()" href="../../_variables/children.html">children</a>, <a class="var it23844" onMouseOver="hilite(23844)" onMouseOut="lolite()" onClick="logVariable('matchids')" href="../../_variables/matchids.html">$matchids</a>);
<a name="l4025"><span class="linenum">4025</span></a>              }
<a name="l4026"><span class="linenum">4026</span></a>          }
<a name="l4027"><span class="linenum">4027</span></a>      }
<a name="l4028"><span class="linenum">4028</span></a>  
<a name="l4029"><span class="linenum">4029</span></a>      <span class="comment">/**</span>
<a name="l4030"><span class="linenum">4030</span></a>  <span class="comment">     * Archive user competencies in a plan.</span>
<a name="l4031"><span class="linenum">4031</span></a>  <span class="comment">     *</span>
<a name="l4032"><span class="linenum">4032</span></a>  <span class="comment">     * @param int $plan The plan object.</span>
<a name="l4033"><span class="linenum">4033</span></a>  <span class="comment">     * @return void</span>
<a name="l4034"><span class="linenum">4034</span></a>  <span class="comment">     */</span>
<a name="l4035"><span class="linenum">4035</span></a>      protected static function <a class="function" onClick="logFunction('archive_user_competencies_in_plan')" href="../../_functions/archive_user_competencies_in_plan.html" onMouseOver="funcPopup(event,'archive_user_competencies_in_plan')">archive_user_competencies_in_plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>) {
<a name="l4036"><span class="linenum">4036</span></a>  
<a name="l4037"><span class="linenum">4037</span></a>  <span class="comment">        // Check if the plan was already completed.</span>
<a name="l4038"><span class="linenum">4038</span></a>          if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() == <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_COMPLETE) {
<a name="l4039"><span class="linenum">4039</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('The plan is already completed.');
<a name="l4040"><span class="linenum">4040</span></a>          }
<a name="l4041"><span class="linenum">4041</span></a>  
<a name="l4042"><span class="linenum">4042</span></a>          <a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a> = <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_competencies')" href="../../_functions/get_competencies.html" onMouseOver="funcPopup(event,'get_competencies')">get_competencies</a>();
<a name="l4043"><span class="linenum">4043</span></a>          <a class="var it9647" onMouseOver="hilite(9647)" onMouseOut="lolite()" onClick="logVariable('usercompetencies')" href="../../_variables/usercompetencies.html">$usercompetencies</a> = <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('get_multiple')" href="../../_functions/get_multiple.html" onMouseOver="funcPopup(event,'get_multiple')">get_multiple</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>(), <a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a>);
<a name="l4044"><span class="linenum">4044</span></a>  
<a name="l4045"><span class="linenum">4045</span></a>          <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> = 0;
<a name="l4046"><span class="linenum">4046</span></a>          foreach (<a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a> as <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>) {
<a name="l4047"><span class="linenum">4047</span></a>              <a class="var it811" onMouseOver="hilite(811)" onMouseOut="lolite()" onClick="logVariable('found')" href="../../_variables/found.html">$found</a> = false;
<a name="l4048"><span class="linenum">4048</span></a>  
<a name="l4049"><span class="linenum">4049</span></a>              foreach (<a class="var it9647" onMouseOver="hilite(9647)" onMouseOut="lolite()" onClick="logVariable('usercompetencies')" href="../../_variables/usercompetencies.html">$usercompetencies</a> as <a class="var it30469" onMouseOver="hilite(30469)" onMouseOut="lolite()" onClick="logVariable('uckey')" href="../../_variables/uckey.html">$uckey</a> =&gt; <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>) {
<a name="l4050"><span class="linenum">4050</span></a>                  if (<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;get_competencyid() == <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>()) {
<a name="l4051"><span class="linenum">4051</span></a>                      <a class="var it811" onMouseOver="hilite(811)" onMouseOut="lolite()" onClick="logVariable('found')" href="../../_variables/found.html">$found</a> = true;
<a name="l4052"><span class="linenum">4052</span></a>  
<a name="l4053"><span class="linenum">4053</span></a>                      <a class="var it30479" onMouseOver="hilite(30479)" onMouseOut="lolite()" onClick="logVariable('ucprecord')" href="../../_variables/ucprecord.html">$ucprecord</a> = <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('to_record')" href="../../_functions/to_record.html" onMouseOver="funcPopup(event,'to_record')">to_record</a>();
<a name="l4054"><span class="linenum">4054</span></a>                      <a class="var it30479" onMouseOver="hilite(30479)" onMouseOut="lolite()" onClick="logVariable('ucprecord')" href="../../_variables/ucprecord.html">$ucprecord</a>-&gt;<a onClick="logVariable('planid')" class="var it43745" onMouseOver="hilite(43745)" onMouseOut="lolite()" href="../../_variables/planid.html">planid</a> = <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>();
<a name="l4055"><span class="linenum">4055</span></a>                      <a class="var it30479" onMouseOver="hilite(30479)" onMouseOut="lolite()" onClick="logVariable('ucprecord')" href="../../_variables/ucprecord.html">$ucprecord</a>-&gt;<a onClick="logVariable('sortorder')" class="var it43745" onMouseOver="hilite(43745)" onMouseOut="lolite()" href="../../_variables/sortorder.html">sortorder</a> = <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>;
<a name="l4056"><span class="linenum">4056</span></a>                      unset(<a class="var it30479" onMouseOver="hilite(30479)" onMouseOut="lolite()" onClick="logVariable('ucprecord')" href="../../_variables/ucprecord.html">$ucprecord</a>-&gt;<a onClick="logVariable('id')" class="var it43745" onMouseOver="hilite(43745)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l4057"><span class="linenum">4057</span></a>                      unset(<a class="var it30479" onMouseOver="hilite(30479)" onMouseOut="lolite()" onClick="logVariable('ucprecord')" href="../../_variables/ucprecord.html">$ucprecord</a>-&gt;<a onClick="logVariable('status')" class="var it43745" onMouseOver="hilite(43745)" onMouseOut="lolite()" href="../../_variables/status.html">status</a>);
<a name="l4058"><span class="linenum">4058</span></a>                      unset(<a class="var it30479" onMouseOver="hilite(30479)" onMouseOut="lolite()" onClick="logVariable('ucprecord')" href="../../_variables/ucprecord.html">$ucprecord</a>-&gt;<a onClick="logVariable('reviewerid')" class="var it43745" onMouseOver="hilite(43745)" onMouseOut="lolite()" href="../../_variables/reviewerid.html">reviewerid</a>);
<a name="l4059"><span class="linenum">4059</span></a>  
<a name="l4060"><span class="linenum">4060</span></a>                      <a class="var it10073" onMouseOver="hilite(10073)" onMouseOut="lolite()" onClick="logVariable('usercompetencyplan')" href="../../_variables/usercompetencyplan.html">$usercompetencyplan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('user_competency_plan')" href="../../_classes/user_competency_plan.html" onMouseOver="classPopup(event,'user_competency_plan')">user_competency_plan</a>(0, <a class="var it30479" onMouseOver="hilite(30479)" onMouseOut="lolite()" onClick="logVariable('ucprecord')" href="../../_variables/ucprecord.html">$ucprecord</a>);
<a name="l4061"><span class="linenum">4061</span></a>                      <a class="var it10073" onMouseOver="hilite(10073)" onMouseOut="lolite()" onClick="logVariable('usercompetencyplan')" href="../../_variables/usercompetencyplan.html">$usercompetencyplan</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l4062"><span class="linenum">4062</span></a>  
<a name="l4063"><span class="linenum">4063</span></a>                      unset(<a class="var it9647" onMouseOver="hilite(9647)" onMouseOut="lolite()" onClick="logVariable('usercompetencies')" href="../../_variables/usercompetencies.html">$usercompetencies</a>[<a class="var it30469" onMouseOver="hilite(30469)" onMouseOut="lolite()" onClick="logVariable('uckey')" href="../../_variables/uckey.html">$uckey</a>]);
<a name="l4064"><span class="linenum">4064</span></a>                      break;
<a name="l4065"><span class="linenum">4065</span></a>                  }
<a name="l4066"><span class="linenum">4066</span></a>              }
<a name="l4067"><span class="linenum">4067</span></a>  
<a name="l4068"><span class="linenum">4068</span></a>  <span class="comment">            // If the user competency doesn't exist, we create a new relation in user_competency_plan.</span>
<a name="l4069"><span class="linenum">4069</span></a>              if (!<a class="var it811" onMouseOver="hilite(811)" onMouseOut="lolite()" onClick="logVariable('found')" href="../../_variables/found.html">$found</a>) {
<a name="l4070"><span class="linenum">4070</span></a>                  <a class="var it10073" onMouseOver="hilite(10073)" onMouseOut="lolite()" onClick="logVariable('usercompetencyplan')" href="../../_variables/usercompetencyplan.html">$usercompetencyplan</a> = <a class="class" onClick="logClass('user_competency_plan')" href="../../_classes/user_competency_plan.html" onMouseOver="classPopup(event,'user_competency_plan')">user_competency_plan</a>::<a class="function" onClick="logFunction('create_relation')" href="../../_functions/create_relation.html" onMouseOver="funcPopup(event,'create_relation')">create_relation</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>(), <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(),
<a name="l4071"><span class="linenum">4071</span></a>                          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>());
<a name="l4072"><span class="linenum">4072</span></a>                  <a class="var it10073" onMouseOver="hilite(10073)" onMouseOut="lolite()" onClick="logVariable('usercompetencyplan')" href="../../_variables/usercompetencyplan.html">$usercompetencyplan</a>-&gt;<a class="function" onClick="logFunction('set_sortorder')" href="../../_functions/set_sortorder.html" onMouseOver="funcPopup(event,'set_sortorder')">set_sortorder</a>(<a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>);
<a name="l4073"><span class="linenum">4073</span></a>                  <a class="var it10073" onMouseOver="hilite(10073)" onMouseOut="lolite()" onClick="logVariable('usercompetencyplan')" href="../../_variables/usercompetencyplan.html">$usercompetencyplan</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l4074"><span class="linenum">4074</span></a>              }
<a name="l4075"><span class="linenum">4075</span></a>              <a class="var it107" onMouseOver="hilite(107)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>++;
<a name="l4076"><span class="linenum">4076</span></a>          }
<a name="l4077"><span class="linenum">4077</span></a>      }
<a name="l4078"><span class="linenum">4078</span></a>  
<a name="l4079"><span class="linenum">4079</span></a>      <span class="comment">/**</span>
<a name="l4080"><span class="linenum">4080</span></a>  <span class="comment">     * Delete archived user competencies in a plan.</span>
<a name="l4081"><span class="linenum">4081</span></a>  <span class="comment">     *</span>
<a name="l4082"><span class="linenum">4082</span></a>  <span class="comment">     * @param int $plan The plan object.</span>
<a name="l4083"><span class="linenum">4083</span></a>  <span class="comment">     * @return void</span>
<a name="l4084"><span class="linenum">4084</span></a>  <span class="comment">     */</span>
<a name="l4085"><span class="linenum">4085</span></a>      protected static function <a class="function" onClick="logFunction('remove_archived_user_competencies_in_plan')" href="../../_functions/remove_archived_user_competencies_in_plan.html" onMouseOver="funcPopup(event,'remove_archived_user_competencies_in_plan')">remove_archived_user_competencies_in_plan</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>) {
<a name="l4086"><span class="linenum">4086</span></a>          <a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a> = <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_competencies')" href="../../_functions/get_competencies.html" onMouseOver="funcPopup(event,'get_competencies')">get_competencies</a>();
<a name="l4087"><span class="linenum">4087</span></a>          <a class="var it27787" onMouseOver="hilite(27787)" onMouseOut="lolite()" onClick="logVariable('usercompetenciesplan')" href="../../_variables/usercompetenciesplan.html">$usercompetenciesplan</a> = <a class="class" onClick="logClass('user_competency_plan')" href="../../_classes/user_competency_plan.html" onMouseOver="classPopup(event,'user_competency_plan')">user_competency_plan</a>::<a class="function" onClick="logFunction('get_multiple')" href="../../_functions/get_multiple.html" onMouseOver="funcPopup(event,'get_multiple')">get_multiple</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>(), <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(), <a class="var it7473" onMouseOver="hilite(7473)" onMouseOut="lolite()" onClick="logVariable('competencies')" href="../../_variables/competencies.html">$competencies</a>);
<a name="l4088"><span class="linenum">4088</span></a>  
<a name="l4089"><span class="linenum">4089</span></a>          foreach (<a class="var it27787" onMouseOver="hilite(27787)" onMouseOut="lolite()" onClick="logVariable('usercompetenciesplan')" href="../../_variables/usercompetenciesplan.html">$usercompetenciesplan</a> as <a class="var it30480" onMouseOver="hilite(30480)" onMouseOut="lolite()" onClick="logVariable('ucpkey')" href="../../_variables/ucpkey.html">$ucpkey</a> =&gt; <a class="var it2288" onMouseOver="hilite(2288)" onMouseOut="lolite()" onClick="logVariable('ucp')" href="../../_variables/ucp.html">$ucp</a>) {
<a name="l4090"><span class="linenum">4090</span></a>              <a class="var it2288" onMouseOver="hilite(2288)" onMouseOut="lolite()" onClick="logVariable('ucp')" href="../../_variables/ucp.html">$ucp</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l4091"><span class="linenum">4091</span></a>          }
<a name="l4092"><span class="linenum">4092</span></a>      }
<a name="l4093"><span class="linenum">4093</span></a>  
<a name="l4094"><span class="linenum">4094</span></a>      <span class="comment">/**</span>
<a name="l4095"><span class="linenum">4095</span></a>  <span class="comment">     * List all the evidence for a user competency.</span>
<a name="l4096"><span class="linenum">4096</span></a>  <span class="comment">     *</span>
<a name="l4097"><span class="linenum">4097</span></a>  <span class="comment">     * @param int $userid The user id - only used if usercompetencyid is 0.</span>
<a name="l4098"><span class="linenum">4098</span></a>  <span class="comment">     * @param int $competencyid The competency id - only used it usercompetencyid is 0.</span>
<a name="l4099"><span class="linenum">4099</span></a>  <span class="comment">     * @param int $planid The plan id - not used yet - but can be used to only list archived evidence if a plan is completed.</span>
<a name="l4100"><span class="linenum">4100</span></a>  <span class="comment">     * @param string $sort The field to sort the evidence by.</span>
<a name="l4101"><span class="linenum">4101</span></a>  <span class="comment">     * @param string $order The ordering of the sorting.</span>
<a name="l4102"><span class="linenum">4102</span></a>  <span class="comment">     * @param int $skip Number of records to skip.</span>
<a name="l4103"><span class="linenum">4103</span></a>  <span class="comment">     * @param int $limit Number of records to return.</span>
<a name="l4104"><span class="linenum">4104</span></a>  <span class="comment">     * @return \core_competency\evidence[]</span>
<a name="l4105"><span class="linenum">4105</span></a>  <span class="comment">     * @return array of \core_competency\evidence</span>
<a name="l4106"><span class="linenum">4106</span></a>  <span class="comment">     */</span>
<a name="l4107"><span class="linenum">4107</span></a>      public static function <a class="function" onClick="logFunction('list_evidence')" href="../../_functions/list_evidence.html" onMouseOver="funcPopup(event,'list_evidence')">list_evidence</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> = 0, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a> = 0, <a class="var it5441" onMouseOver="hilite(5441)" onMouseOut="lolite()" onClick="logVariable('planid')" href="../../_variables/planid.html">$planid</a> = 0, <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> = 'timecreated',
<a name="l4108"><span class="linenum">4108</span></a>                                           <a class="var it6270" onMouseOver="hilite(6270)" onMouseOut="lolite()" onClick="logVariable('order')" href="../../_variables/order.html">$order</a> = 'DESC', <a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('skip')" href="../../_variables/skip.html">$skip</a> = 0, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a> = 0) {
<a name="l4109"><span class="linenum">4109</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l4110"><span class="linenum">4110</span></a>  
<a name="l4111"><span class="linenum">4111</span></a>          if (!<a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('can_read_user')" href="../../_functions/can_read_user.html" onMouseOver="funcPopup(event,'can_read_user')">can_read_user</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>)) {
<a name="l4112"><span class="linenum">4112</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_user')" href="../../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>);
<a name="l4113"><span class="linenum">4113</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:usercompetencyview', 'nopermissions', '');
<a name="l4114"><span class="linenum">4114</span></a>          }
<a name="l4115"><span class="linenum">4115</span></a>  
<a name="l4116"><span class="linenum">4116</span></a>          <a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a> = <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, 'competencyid' =&gt; <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>));
<a name="l4117"><span class="linenum">4117</span></a>          if (!<a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>) {
<a name="l4118"><span class="linenum">4118</span></a>              return array();
<a name="l4119"><span class="linenum">4119</span></a>          }
<a name="l4120"><span class="linenum">4120</span></a>  
<a name="l4121"><span class="linenum">4121</span></a>          <a class="var it30481" onMouseOver="hilite(30481)" onMouseOut="lolite()" onClick="logVariable('plancompleted')" href="../../_variables/plancompleted.html">$plancompleted</a> = false;
<a name="l4122"><span class="linenum">4122</span></a>          if (<a class="var it5441" onMouseOver="hilite(5441)" onMouseOut="lolite()" onClick="logVariable('planid')" href="../../_variables/planid.html">$planid</a> != 0) {
<a name="l4123"><span class="linenum">4123</span></a>              <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(<a class="var it5441" onMouseOver="hilite(5441)" onMouseOut="lolite()" onClick="logVariable('planid')" href="../../_variables/planid.html">$planid</a>);
<a name="l4124"><span class="linenum">4124</span></a>              if (<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() == <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::STATUS_COMPLETE) {
<a name="l4125"><span class="linenum">4125</span></a>                  <a class="var it30481" onMouseOver="hilite(30481)" onMouseOut="lolite()" onClick="logVariable('plancompleted')" href="../../_variables/plancompleted.html">$plancompleted</a> = true;
<a name="l4126"><span class="linenum">4126</span></a>              }
<a name="l4127"><span class="linenum">4127</span></a>          }
<a name="l4128"><span class="linenum">4128</span></a>  
<a name="l4129"><span class="linenum">4129</span></a>          <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> = 'usercompetencyid = :usercompetencyid';
<a name="l4130"><span class="linenum">4130</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array('usercompetencyid' =&gt; <a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>());
<a name="l4131"><span class="linenum">4131</span></a>          if (<a class="var it30481" onMouseOver="hilite(30481)" onMouseOut="lolite()" onClick="logVariable('plancompleted')" href="../../_variables/plancompleted.html">$plancompleted</a>) {
<a name="l4132"><span class="linenum">4132</span></a>              <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a> .= ' AND timecreated &lt;= :timecompleted';
<a name="l4133"><span class="linenum">4133</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['timecompleted'] = <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_timemodified')" href="../../_functions/get_timemodified.html" onMouseOver="funcPopup(event,'get_timemodified')">get_timemodified</a>();
<a name="l4134"><span class="linenum">4134</span></a>          }
<a name="l4135"><span class="linenum">4135</span></a>  
<a name="l4136"><span class="linenum">4136</span></a>          <a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../../_variables/orderby.html">$orderby</a> = <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> . ' ' . <a class="var it6270" onMouseOver="hilite(6270)" onMouseOut="lolite()" onClick="logVariable('order')" href="../../_variables/order.html">$order</a>;
<a name="l4137"><span class="linenum">4137</span></a>          <a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../../_variables/orderby.html">$orderby</a> .= !empty(<a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../../_variables/orderby.html">$orderby</a>) ? ', id DESC' : 'id DESC'; <span class="comment">// Prevent random ordering.</span>
<a name="l4138"><span class="linenum">4138</span></a>  
<a name="l4139"><span class="linenum">4139</span></a>          <a class="var it10078" onMouseOver="hilite(10078)" onMouseOut="lolite()" onClick="logVariable('evidence')" href="../../_variables/evidence.html">$evidence</a> = <a class="class" onClick="logClass('evidence')" href="../../_classes/evidence.html" onMouseOver="classPopup(event,'evidence')">evidence</a>::<a class="function" onClick="logFunction('get_records_select')" href="../../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>(<a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../../_variables/select.html">$select</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>, <a class="var it5076" onMouseOver="hilite(5076)" onMouseOut="lolite()" onClick="logVariable('orderby')" href="../../_variables/orderby.html">$orderby</a>, '*', <a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('skip')" href="../../_variables/skip.html">$skip</a>, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a>);
<a name="l4140"><span class="linenum">4140</span></a>          return <a class="var it10078" onMouseOver="hilite(10078)" onMouseOut="lolite()" onClick="logVariable('evidence')" href="../../_variables/evidence.html">$evidence</a>;
<a name="l4141"><span class="linenum">4141</span></a>      }
<a name="l4142"><span class="linenum">4142</span></a>  
<a name="l4143"><span class="linenum">4143</span></a>      <span class="comment">/**</span>
<a name="l4144"><span class="linenum">4144</span></a>  <span class="comment">     * List all the evidence for a user competency in a course.</span>
<a name="l4145"><span class="linenum">4145</span></a>  <span class="comment">     *</span>
<a name="l4146"><span class="linenum">4146</span></a>  <span class="comment">     * @param int $userid The user ID.</span>
<a name="l4147"><span class="linenum">4147</span></a>  <span class="comment">     * @param int $courseid The course ID.</span>
<a name="l4148"><span class="linenum">4148</span></a>  <span class="comment">     * @param int $competencyid The competency ID.</span>
<a name="l4149"><span class="linenum">4149</span></a>  <span class="comment">     * @param string $sort The field to sort the evidence by.</span>
<a name="l4150"><span class="linenum">4150</span></a>  <span class="comment">     * @param string $order The ordering of the sorting.</span>
<a name="l4151"><span class="linenum">4151</span></a>  <span class="comment">     * @param int $skip Number of records to skip.</span>
<a name="l4152"><span class="linenum">4152</span></a>  <span class="comment">     * @param int $limit Number of records to return.</span>
<a name="l4153"><span class="linenum">4153</span></a>  <span class="comment">     * @return \core_competency\evidence[]</span>
<a name="l4154"><span class="linenum">4154</span></a>  <span class="comment">     */</span>
<a name="l4155"><span class="linenum">4155</span></a>      public static function <a class="function" onClick="logFunction('list_evidence_in_course')" href="../../_functions/list_evidence_in_course.html" onMouseOver="funcPopup(event,'list_evidence_in_course')">list_evidence_in_course</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> = 0, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> = 0, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a> = 0, <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a> = 'timecreated',
<a name="l4156"><span class="linenum">4156</span></a>                                                     <a class="var it6270" onMouseOver="hilite(6270)" onMouseOut="lolite()" onClick="logVariable('order')" href="../../_variables/order.html">$order</a> = 'DESC', <a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('skip')" href="../../_variables/skip.html">$skip</a> = 0, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a> = 0) {
<a name="l4157"><span class="linenum">4157</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l4158"><span class="linenum">4158</span></a>  
<a name="l4159"><span class="linenum">4159</span></a>          if (!<a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('can_read_user_in_course')" href="../../_functions/can_read_user_in_course.html" onMouseOver="funcPopup(event,'can_read_user_in_course')">can_read_user_in_course</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>)) {
<a name="l4160"><span class="linenum">4160</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_user')" href="../../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>);
<a name="l4161"><span class="linenum">4161</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:usercompetencyview', 'nopermissions', '');
<a name="l4162"><span class="linenum">4162</span></a>          }
<a name="l4163"><span class="linenum">4163</span></a>  
<a name="l4164"><span class="linenum">4164</span></a>          <a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a> = <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, 'competencyid' =&gt; <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>));
<a name="l4165"><span class="linenum">4165</span></a>          if (!<a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>) {
<a name="l4166"><span class="linenum">4166</span></a>              return array();
<a name="l4167"><span class="linenum">4167</span></a>          }
<a name="l4168"><span class="linenum">4168</span></a>  
<a name="l4169"><span class="linenum">4169</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l4170"><span class="linenum">4170</span></a>          return <a class="class" onClick="logClass('evidence')" href="../../_classes/evidence.html" onMouseOver="classPopup(event,'evidence')">evidence</a>::<a class="function" onClick="logFunction('get_records_for_usercompetency')" href="../../_functions/get_records_for_usercompetency.html" onMouseOver="funcPopup(event,'get_records_for_usercompetency')">get_records_for_usercompetency</a>(<a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(), <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it1015" onMouseOver="hilite(1015)" onMouseOut="lolite()" onClick="logVariable('sort')" href="../../_variables/sort.html">$sort</a>, <a class="var it6270" onMouseOver="hilite(6270)" onMouseOut="lolite()" onClick="logVariable('order')" href="../../_variables/order.html">$order</a>, <a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('skip')" href="../../_variables/skip.html">$skip</a>, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a>);
<a name="l4171"><span class="linenum">4171</span></a>      }
<a name="l4172"><span class="linenum">4172</span></a>  
<a name="l4173"><span class="linenum">4173</span></a>      <span class="comment">/**</span>
<a name="l4174"><span class="linenum">4174</span></a>  <span class="comment">     * Create an evidence from a list of parameters.</span>
<a name="l4175"><span class="linenum">4175</span></a>  <span class="comment">     *</span>
<a name="l4176"><span class="linenum">4176</span></a>  <span class="comment">     * Requires no capability because evidence can be added in many situations under any user.</span>
<a name="l4177"><span class="linenum">4177</span></a>  <span class="comment">     *</span>
<a name="l4178"><span class="linenum">4178</span></a>  <span class="comment">     * @param int $userid The user id for which evidence is added.</span>
<a name="l4179"><span class="linenum">4179</span></a>  <span class="comment">     * @param competency|int $competencyorid The competency, or its id for which evidence is added.</span>
<a name="l4180"><span class="linenum">4180</span></a>  <span class="comment">     * @param context|int $contextorid The context in which the evidence took place.</span>
<a name="l4181"><span class="linenum">4181</span></a>  <span class="comment">     * @param int $action The type of action to take on the competency. \core_competency\evidence::ACTION_*.</span>
<a name="l4182"><span class="linenum">4182</span></a>  <span class="comment">     * @param string $descidentifier The strings identifier.</span>
<a name="l4183"><span class="linenum">4183</span></a>  <span class="comment">     * @param string $desccomponent The strings component.</span>
<a name="l4184"><span class="linenum">4184</span></a>  <span class="comment">     * @param mixed $desca Any arguments the string requires.</span>
<a name="l4185"><span class="linenum">4185</span></a>  <span class="comment">     * @param bool $recommend When true, the user competency will be sent for review.</span>
<a name="l4186"><span class="linenum">4186</span></a>  <span class="comment">     * @param string $url The url the evidence may link to.</span>
<a name="l4187"><span class="linenum">4187</span></a>  <span class="comment">     * @param int $grade The grade, or scale ID item.</span>
<a name="l4188"><span class="linenum">4188</span></a>  <span class="comment">     * @param int $actionuserid The ID of the user who took the action of adding the evidence. Null when system.</span>
<a name="l4189"><span class="linenum">4189</span></a>  <span class="comment">     *                          This should be used when the action was taken by a real person, this will allow</span>
<a name="l4190"><span class="linenum">4190</span></a>  <span class="comment">     *                          to keep track of all the evidence given by a certain person.</span>
<a name="l4191"><span class="linenum">4191</span></a>  <span class="comment">     * @param string $note A note to attach to the evidence.</span>
<a name="l4192"><span class="linenum">4192</span></a>  <span class="comment">     * @return evidence</span>
<a name="l4193"><span class="linenum">4193</span></a>  <span class="comment">     * @throws coding_exception</span>
<a name="l4194"><span class="linenum">4194</span></a>  <span class="comment">     * @throws invalid_persistent_exception</span>
<a name="l4195"><span class="linenum">4195</span></a>  <span class="comment">     * @throws moodle_exception</span>
<a name="l4196"><span class="linenum">4196</span></a>  <span class="comment">     */</span>
<a name="l4197"><span class="linenum">4197</span></a>      public static function <a class="function" onClick="logFunction('add_evidence')" href="../../_functions/add_evidence.html" onMouseOver="funcPopup(event,'add_evidence')">add_evidence</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it30431" onMouseOver="hilite(30431)" onMouseOut="lolite()" onClick="logVariable('competencyorid')" href="../../_variables/competencyorid.html">$competencyorid</a>, <a class="var it30482" onMouseOver="hilite(30482)" onMouseOut="lolite()" onClick="logVariable('contextorid')" href="../../_variables/contextorid.html">$contextorid</a>, <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a>, <a class="var it10076" onMouseOver="hilite(10076)" onMouseOut="lolite()" onClick="logVariable('descidentifier')" href="../../_variables/descidentifier.html">$descidentifier</a>, <a class="var it10077" onMouseOver="hilite(10077)" onMouseOut="lolite()" onClick="logVariable('desccomponent')" href="../../_variables/desccomponent.html">$desccomponent</a>,
<a name="l4198"><span class="linenum">4198</span></a>                                          <a class="var it30483" onMouseOver="hilite(30483)" onMouseOut="lolite()" onClick="logVariable('desca')" href="../../_variables/desca.html">$desca</a> = null, <a class="var it25028" onMouseOver="hilite(25028)" onMouseOut="lolite()" onClick="logVariable('recommend')" href="../../_variables/recommend.html">$recommend</a> = false, <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = null, <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> = null, <a class="var it10465" onMouseOver="hilite(10465)" onMouseOut="lolite()" onClick="logVariable('actionuserid')" href="../../_variables/actionuserid.html">$actionuserid</a> = null,
<a name="l4199"><span class="linenum">4199</span></a>                                          <a class="var it6990" onMouseOver="hilite(6990)" onMouseOut="lolite()" onClick="logVariable('note')" href="../../_variables/note.html">$note</a> = null) {
<a name="l4200"><span class="linenum">4200</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l4201"><span class="linenum">4201</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l4202"><span class="linenum">4202</span></a>  
<a name="l4203"><span class="linenum">4203</span></a>  <span class="comment">        // Some clearly important variable assignments right there.</span>
<a name="l4204"><span class="linenum">4204</span></a>          <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a> = <a class="var it30431" onMouseOver="hilite(30431)" onMouseOut="lolite()" onClick="logVariable('competencyorid')" href="../../_variables/competencyorid.html">$competencyorid</a>;
<a name="l4205"><span class="linenum">4205</span></a>          <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = null;
<a name="l4206"><span class="linenum">4206</span></a>          if (<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>)) {
<a name="l4207"><span class="linenum">4207</span></a>              <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>;
<a name="l4208"><span class="linenum">4208</span></a>              <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a> = <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>();
<a name="l4209"><span class="linenum">4209</span></a>          }
<a name="l4210"><span class="linenum">4210</span></a>          <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a> = <a class="var it30482" onMouseOver="hilite(30482)" onMouseOut="lolite()" onClick="logVariable('contextorid')" href="../../_variables/contextorid.html">$contextorid</a>;
<a name="l4211"><span class="linenum">4211</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="var it30482" onMouseOver="hilite(30482)" onMouseOut="lolite()" onClick="logVariable('contextorid')" href="../../_variables/contextorid.html">$contextorid</a>;
<a name="l4212"><span class="linenum">4212</span></a>          if (<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it30482" onMouseOver="hilite(30482)" onMouseOut="lolite()" onClick="logVariable('contextorid')" href="../../_variables/contextorid.html">$contextorid</a>)) {
<a name="l4213"><span class="linenum">4213</span></a>              <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a> = <a class="var it30482" onMouseOver="hilite(30482)" onMouseOut="lolite()" onClick="logVariable('contextorid')" href="../../_variables/contextorid.html">$contextorid</a>-&gt;<a onClick="logVariable('id')" class="var it43746" onMouseOver="hilite(43746)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l4214"><span class="linenum">4214</span></a>          } else {
<a name="l4215"><span class="linenum">4215</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = context::<a class="function" onClick="logFunction('instance_by_id')" href="../../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>(<a class="var it30482" onMouseOver="hilite(30482)" onMouseOut="lolite()" onClick="logVariable('contextorid')" href="../../_variables/contextorid.html">$contextorid</a>);
<a name="l4216"><span class="linenum">4216</span></a>          }
<a name="l4217"><span class="linenum">4217</span></a>          <a class="var it30484" onMouseOver="hilite(30484)" onMouseOut="lolite()" onClick="logVariable('setucgrade')" href="../../_variables/setucgrade.html">$setucgrade</a> = false;
<a name="l4218"><span class="linenum">4218</span></a>          <a class="var it30485" onMouseOver="hilite(30485)" onMouseOut="lolite()" onClick="logVariable('ucgrade')" href="../../_variables/ucgrade.html">$ucgrade</a> = null;
<a name="l4219"><span class="linenum">4219</span></a>          <a class="var it30486" onMouseOver="hilite(30486)" onMouseOut="lolite()" onClick="logVariable('ucproficiency')" href="../../_variables/ucproficiency.html">$ucproficiency</a> = null;
<a name="l4220"><span class="linenum">4220</span></a>          <a class="var it9652" onMouseOver="hilite(9652)" onMouseOut="lolite()" onClick="logVariable('usercompetencycourse')" href="../../_variables/usercompetencycourse.html">$usercompetencycourse</a> = null;
<a name="l4221"><span class="linenum">4221</span></a>  
<a name="l4222"><span class="linenum">4222</span></a>  <span class="comment">        // Fetch or create the user competency.</span>
<a name="l4223"><span class="linenum">4223</span></a>          <a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a> = <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, 'competencyid' =&gt; <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>));
<a name="l4224"><span class="linenum">4224</span></a>          if (!<a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>) {
<a name="l4225"><span class="linenum">4225</span></a>              <a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a> = <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('create_relation')" href="../../_functions/create_relation.html" onMouseOver="funcPopup(event,'create_relation')">create_relation</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l4226"><span class="linenum">4226</span></a>              <a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l4227"><span class="linenum">4227</span></a>          }
<a name="l4228"><span class="linenum">4228</span></a>  
<a name="l4229"><span class="linenum">4229</span></a>  <span class="comment">        // What should we be doing?</span>
<a name="l4230"><span class="linenum">4230</span></a>          switch (<a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a>) {
<a name="l4231"><span class="linenum">4231</span></a>  
<a name="l4232"><span class="linenum">4232</span></a>  <span class="comment">            // Completing a competency.</span>
<a name="l4233"><span class="linenum">4233</span></a>              case <a class="class" onClick="logClass('evidence')" href="../../_classes/evidence.html" onMouseOver="classPopup(event,'evidence')">evidence</a>::ACTION_COMPLETE:
<a name="l4234"><span class="linenum">4234</span></a>  <span class="comment">                // The logic here goes like this:</span>
<a name="l4235"><span class="linenum">4235</span></a>  <span class="comment">                //</span>
<a name="l4236"><span class="linenum">4236</span></a>  <span class="comment">                // if rating outside a course</span>
<a name="l4237"><span class="linenum">4237</span></a>  <span class="comment">                // - set the default grade and proficiency ONLY if there is no current grade</span>
<a name="l4238"><span class="linenum">4238</span></a>  <span class="comment">                // else we are in a course</span>
<a name="l4239"><span class="linenum">4239</span></a>  <span class="comment">                // - set the defautl grade and proficiency in the course ONLY if there is no current grade in the course</span>
<a name="l4240"><span class="linenum">4240</span></a>  <span class="comment">                // - then check the course settings to see if we should push the rating outside the course</span>
<a name="l4241"><span class="linenum">4241</span></a>  <span class="comment">                // - if we should push it</span>
<a name="l4242"><span class="linenum">4242</span></a>  <span class="comment">                // --- push it only if the user_competency (outside the course) has no grade</span>
<a name="l4243"><span class="linenum">4243</span></a>  <span class="comment">                // Done.</span>
<a name="l4244"><span class="linenum">4244</span></a>  
<a name="l4245"><span class="linenum">4245</span></a>                  if (<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> !== null) {
<a name="l4246"><span class="linenum">4246</span></a>                      throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>(&quot;The grade MUST NOT be set with a 'completing' evidence.&quot;);
<a name="l4247"><span class="linenum">4247</span></a>                  }
<a name="l4248"><span class="linenum">4248</span></a>  
<a name="l4249"><span class="linenum">4249</span></a>  <span class="comment">                // Fetch the default grade to attach to the evidence.</span>
<a name="l4250"><span class="linenum">4250</span></a>                  if (empty(<a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>)) {
<a name="l4251"><span class="linenum">4251</span></a>                      <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l4252"><span class="linenum">4252</span></a>                  }
<a name="l4253"><span class="linenum">4253</span></a>                  <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>, <a class="var it11570" onMouseOver="hilite(11570)" onMouseOut="lolite()" onClick="logVariable('proficiency')" href="../../_variables/proficiency.html">$proficiency</a>) = <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_default_grade')" href="../../_functions/get_default_grade.html" onMouseOver="funcPopup(event,'get_default_grade')">get_default_grade</a>();
<a name="l4254"><span class="linenum">4254</span></a>  
<a name="l4255"><span class="linenum">4255</span></a>  <span class="comment">                // Add user_competency_course record when in a course or module.</span>
<a name="l4256"><span class="linenum">4256</span></a>                  if (<a class="phpfunction" onClick="logFunction('in_array')" href="../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/contextlevel.html">contextlevel</a>, array(<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>, <a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>))) {
<a name="l4257"><span class="linenum">4257</span></a>                      <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a> = <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_course_context')" href="../../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>();
<a name="l4258"><span class="linenum">4258</span></a>                      <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> = <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('instanceid')" class="var it43118" onMouseOver="hilite(43118)" onMouseOut="lolite()" href="../../_variables/instanceid.html">instanceid</a>;
<a name="l4259"><span class="linenum">4259</span></a>                      <a class="var it3110" onMouseOver="hilite(3110)" onMouseOut="lolite()" onClick="logVariable('filterparams')" href="../../_variables/filterparams.html">$filterparams</a> = array(
<a name="l4260"><span class="linenum">4260</span></a>                          'userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>,
<a name="l4261"><span class="linenum">4261</span></a>                          'competencyid' =&gt; <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>,
<a name="l4262"><span class="linenum">4262</span></a>                          'courseid' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>
<a name="l4263"><span class="linenum">4263</span></a>                      );
<a name="l4264"><span class="linenum">4264</span></a>  <span class="comment">                    // Fetch or create user competency course.</span>
<a name="l4265"><span class="linenum">4265</span></a>                      <a class="var it9652" onMouseOver="hilite(9652)" onMouseOut="lolite()" onClick="logVariable('usercompetencycourse')" href="../../_variables/usercompetencycourse.html">$usercompetencycourse</a> = <a class="class" onClick="logClass('user_competency_course')" href="../../_classes/user_competency_course.html" onMouseOver="classPopup(event,'user_competency_course')">user_competency_course</a>::<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(<a class="var it3110" onMouseOver="hilite(3110)" onMouseOut="lolite()" onClick="logVariable('filterparams')" href="../../_variables/filterparams.html">$filterparams</a>);
<a name="l4266"><span class="linenum">4266</span></a>                      if (!<a class="var it9652" onMouseOver="hilite(9652)" onMouseOut="lolite()" onClick="logVariable('usercompetencycourse')" href="../../_variables/usercompetencycourse.html">$usercompetencycourse</a>) {
<a name="l4267"><span class="linenum">4267</span></a>                          <a class="var it9652" onMouseOver="hilite(9652)" onMouseOut="lolite()" onClick="logVariable('usercompetencycourse')" href="../../_variables/usercompetencycourse.html">$usercompetencycourse</a> = <a class="class" onClick="logClass('user_competency_course')" href="../../_classes/user_competency_course.html" onMouseOver="classPopup(event,'user_competency_course')">user_competency_course</a>::<a class="function" onClick="logFunction('create_relation')" href="../../_functions/create_relation.html" onMouseOver="funcPopup(event,'create_relation')">create_relation</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l4268"><span class="linenum">4268</span></a>                          <a class="var it9652" onMouseOver="hilite(9652)" onMouseOut="lolite()" onClick="logVariable('usercompetencycourse')" href="../../_variables/usercompetencycourse.html">$usercompetencycourse</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l4269"><span class="linenum">4269</span></a>                      }
<a name="l4270"><span class="linenum">4270</span></a>  <span class="comment">                    // Only update the grade and proficiency if there is not already a grade.</span>
<a name="l4271"><span class="linenum">4271</span></a>                      if (<a class="var it9652" onMouseOver="hilite(9652)" onMouseOut="lolite()" onClick="logVariable('usercompetencycourse')" href="../../_variables/usercompetencycourse.html">$usercompetencycourse</a>-&gt;<a class="function" onClick="logFunction('get_grade')" href="../../_functions/get_grade.html" onMouseOver="funcPopup(event,'get_grade')">get_grade</a>() === null) {
<a name="l4272"><span class="linenum">4272</span></a>  <span class="comment">                        // Set grade.</span>
<a name="l4273"><span class="linenum">4273</span></a>                          <a class="var it9652" onMouseOver="hilite(9652)" onMouseOut="lolite()" onClick="logVariable('usercompetencycourse')" href="../../_variables/usercompetencycourse.html">$usercompetencycourse</a>-&gt;<a class="function" onClick="logFunction('set_grade')" href="../../_functions/set_grade.html" onMouseOver="funcPopup(event,'set_grade')">set_grade</a>(<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>);
<a name="l4274"><span class="linenum">4274</span></a>  <span class="comment">                        // Set proficiency.</span>
<a name="l4275"><span class="linenum">4275</span></a>                          <a class="var it9652" onMouseOver="hilite(9652)" onMouseOut="lolite()" onClick="logVariable('usercompetencycourse')" href="../../_variables/usercompetencycourse.html">$usercompetencycourse</a>-&gt;set_proficiency(<a class="var it11570" onMouseOver="hilite(11570)" onMouseOut="lolite()" onClick="logVariable('proficiency')" href="../../_variables/proficiency.html">$proficiency</a>);
<a name="l4276"><span class="linenum">4276</span></a>                      }
<a name="l4277"><span class="linenum">4277</span></a>  
<a name="l4278"><span class="linenum">4278</span></a>  <span class="comment">                    // Check the course settings to see if we should push to user plans.</span>
<a name="l4279"><span class="linenum">4279</span></a>                      <a class="var it3109" onMouseOver="hilite(3109)" onMouseOut="lolite()" onClick="logVariable('coursesettings')" href="../../_variables/coursesettings.html">$coursesettings</a> = <a class="class" onClick="logClass('course_competency_settings')" href="../../_classes/course_competency_settings.html" onMouseOver="classPopup(event,'course_competency_settings')">course_competency_settings</a>::<a class="function" onClick="logFunction('get_by_courseid')" href="../../_functions/get_by_courseid.html" onMouseOver="funcPopup(event,'get_by_courseid')">get_by_courseid</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l4280"><span class="linenum">4280</span></a>                      <a class="var it30484" onMouseOver="hilite(30484)" onMouseOut="lolite()" onClick="logVariable('setucgrade')" href="../../_variables/setucgrade.html">$setucgrade</a> = <a class="var it3109" onMouseOver="hilite(3109)" onMouseOut="lolite()" onClick="logVariable('coursesettings')" href="../../_variables/coursesettings.html">$coursesettings</a>-&gt;get_pushratingstouserplans();
<a name="l4281"><span class="linenum">4281</span></a>  
<a name="l4282"><span class="linenum">4282</span></a>                      if (<a class="var it30484" onMouseOver="hilite(30484)" onMouseOut="lolite()" onClick="logVariable('setucgrade')" href="../../_variables/setucgrade.html">$setucgrade</a>) {
<a name="l4283"><span class="linenum">4283</span></a>  <span class="comment">                        // Only push to user plans if there is not already a grade.</span>
<a name="l4284"><span class="linenum">4284</span></a>                          if (<a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>-&gt;<a class="function" onClick="logFunction('get_grade')" href="../../_functions/get_grade.html" onMouseOver="funcPopup(event,'get_grade')">get_grade</a>() !== null) {
<a name="l4285"><span class="linenum">4285</span></a>                              <a class="var it30484" onMouseOver="hilite(30484)" onMouseOut="lolite()" onClick="logVariable('setucgrade')" href="../../_variables/setucgrade.html">$setucgrade</a> = false;
<a name="l4286"><span class="linenum">4286</span></a>                          } else {
<a name="l4287"><span class="linenum">4287</span></a>                              <a class="var it30485" onMouseOver="hilite(30485)" onMouseOut="lolite()" onClick="logVariable('ucgrade')" href="../../_variables/ucgrade.html">$ucgrade</a> = <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>;
<a name="l4288"><span class="linenum">4288</span></a>                              <a class="var it30486" onMouseOver="hilite(30486)" onMouseOut="lolite()" onClick="logVariable('ucproficiency')" href="../../_variables/ucproficiency.html">$ucproficiency</a> = <a class="var it11570" onMouseOver="hilite(11570)" onMouseOut="lolite()" onClick="logVariable('proficiency')" href="../../_variables/proficiency.html">$proficiency</a>;
<a name="l4289"><span class="linenum">4289</span></a>                          }
<a name="l4290"><span class="linenum">4290</span></a>                      }
<a name="l4291"><span class="linenum">4291</span></a>                  } else {
<a name="l4292"><span class="linenum">4292</span></a>  
<a name="l4293"><span class="linenum">4293</span></a>  <span class="comment">                    // When completing the competency we fetch the default grade from the competency. But we only mark</span>
<a name="l4294"><span class="linenum">4294</span></a>  <span class="comment">                    // the user competency when a grade has not been set yet. Complete is an action to use with automated systems.</span>
<a name="l4295"><span class="linenum">4295</span></a>                      if (<a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>-&gt;<a class="function" onClick="logFunction('get_grade')" href="../../_functions/get_grade.html" onMouseOver="funcPopup(event,'get_grade')">get_grade</a>() === null) {
<a name="l4296"><span class="linenum">4296</span></a>                          <a class="var it30484" onMouseOver="hilite(30484)" onMouseOut="lolite()" onClick="logVariable('setucgrade')" href="../../_variables/setucgrade.html">$setucgrade</a> = true;
<a name="l4297"><span class="linenum">4297</span></a>                          <a class="var it30485" onMouseOver="hilite(30485)" onMouseOut="lolite()" onClick="logVariable('ucgrade')" href="../../_variables/ucgrade.html">$ucgrade</a> = <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>;
<a name="l4298"><span class="linenum">4298</span></a>                          <a class="var it30486" onMouseOver="hilite(30486)" onMouseOut="lolite()" onClick="logVariable('ucproficiency')" href="../../_variables/ucproficiency.html">$ucproficiency</a> = <a class="var it11570" onMouseOver="hilite(11570)" onMouseOut="lolite()" onClick="logVariable('proficiency')" href="../../_variables/proficiency.html">$proficiency</a>;
<a name="l4299"><span class="linenum">4299</span></a>                      }
<a name="l4300"><span class="linenum">4300</span></a>                  }
<a name="l4301"><span class="linenum">4301</span></a>  
<a name="l4302"><span class="linenum">4302</span></a>                  break;
<a name="l4303"><span class="linenum">4303</span></a>  
<a name="l4304"><span class="linenum">4304</span></a>  <span class="comment">            // We override the grade, even overriding back to not set.</span>
<a name="l4305"><span class="linenum">4305</span></a>              case <a class="class" onClick="logClass('evidence')" href="../../_classes/evidence.html" onMouseOver="classPopup(event,'evidence')">evidence</a>::ACTION_OVERRIDE:
<a name="l4306"><span class="linenum">4306</span></a>                  <a class="var it30484" onMouseOver="hilite(30484)" onMouseOut="lolite()" onClick="logVariable('setucgrade')" href="../../_variables/setucgrade.html">$setucgrade</a> = true;
<a name="l4307"><span class="linenum">4307</span></a>                  <a class="var it30485" onMouseOver="hilite(30485)" onMouseOut="lolite()" onClick="logVariable('ucgrade')" href="../../_variables/ucgrade.html">$ucgrade</a> = <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>;
<a name="l4308"><span class="linenum">4308</span></a>                  if (empty(<a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>)) {
<a name="l4309"><span class="linenum">4309</span></a>                      <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l4310"><span class="linenum">4310</span></a>                  }
<a name="l4311"><span class="linenum">4311</span></a>                  if (<a class="var it30485" onMouseOver="hilite(30485)" onMouseOut="lolite()" onClick="logVariable('ucgrade')" href="../../_variables/ucgrade.html">$ucgrade</a> !== null) {
<a name="l4312"><span class="linenum">4312</span></a>                      <a class="var it30486" onMouseOver="hilite(30486)" onMouseOut="lolite()" onClick="logVariable('ucproficiency')" href="../../_variables/ucproficiency.html">$ucproficiency</a> = <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_proficiency_of_grade')" href="../../_functions/get_proficiency_of_grade.html" onMouseOver="funcPopup(event,'get_proficiency_of_grade')">get_proficiency_of_grade</a>(<a class="var it30485" onMouseOver="hilite(30485)" onMouseOut="lolite()" onClick="logVariable('ucgrade')" href="../../_variables/ucgrade.html">$ucgrade</a>);
<a name="l4313"><span class="linenum">4313</span></a>                  }
<a name="l4314"><span class="linenum">4314</span></a>  
<a name="l4315"><span class="linenum">4315</span></a>  <span class="comment">                // Add user_competency_course record when in a course or module.</span>
<a name="l4316"><span class="linenum">4316</span></a>                  if (<a class="phpfunction" onClick="logFunction('in_array')" href="../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('contextlevel')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/contextlevel.html">contextlevel</a>, array(<a class="constant" onClick="logConstant('CONTEXT_COURSE')" href="../../_constants/CONTEXT_COURSE.html" onMouseOver="constPopup(event,'CONTEXT_COURSE')">CONTEXT_COURSE</a>, <a class="constant" onClick="logConstant('CONTEXT_MODULE')" href="../../_constants/CONTEXT_MODULE.html" onMouseOver="constPopup(event,'CONTEXT_MODULE')">CONTEXT_MODULE</a>))) {
<a name="l4317"><span class="linenum">4317</span></a>                      <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a> = <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_course_context')" href="../../_functions/get_course_context.html" onMouseOver="funcPopup(event,'get_course_context')">get_course_context</a>();
<a name="l4318"><span class="linenum">4318</span></a>                      <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a> = <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a>-&gt;<a onClick="logVariable('instanceid')" class="var it43118" onMouseOver="hilite(43118)" onMouseOut="lolite()" href="../../_variables/instanceid.html">instanceid</a>;
<a name="l4319"><span class="linenum">4319</span></a>                      <a class="var it3110" onMouseOver="hilite(3110)" onMouseOut="lolite()" onClick="logVariable('filterparams')" href="../../_variables/filterparams.html">$filterparams</a> = array(
<a name="l4320"><span class="linenum">4320</span></a>                          'userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>,
<a name="l4321"><span class="linenum">4321</span></a>                          'competencyid' =&gt; <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>,
<a name="l4322"><span class="linenum">4322</span></a>                          'courseid' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>
<a name="l4323"><span class="linenum">4323</span></a>                      );
<a name="l4324"><span class="linenum">4324</span></a>  <span class="comment">                    // Fetch or create user competency course.</span>
<a name="l4325"><span class="linenum">4325</span></a>                      <a class="var it9652" onMouseOver="hilite(9652)" onMouseOut="lolite()" onClick="logVariable('usercompetencycourse')" href="../../_variables/usercompetencycourse.html">$usercompetencycourse</a> = <a class="class" onClick="logClass('user_competency_course')" href="../../_classes/user_competency_course.html" onMouseOver="classPopup(event,'user_competency_course')">user_competency_course</a>::<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(<a class="var it3110" onMouseOver="hilite(3110)" onMouseOut="lolite()" onClick="logVariable('filterparams')" href="../../_variables/filterparams.html">$filterparams</a>);
<a name="l4326"><span class="linenum">4326</span></a>                      if (!<a class="var it9652" onMouseOver="hilite(9652)" onMouseOut="lolite()" onClick="logVariable('usercompetencycourse')" href="../../_variables/usercompetencycourse.html">$usercompetencycourse</a>) {
<a name="l4327"><span class="linenum">4327</span></a>                          <a class="var it9652" onMouseOver="hilite(9652)" onMouseOut="lolite()" onClick="logVariable('usercompetencycourse')" href="../../_variables/usercompetencycourse.html">$usercompetencycourse</a> = <a class="class" onClick="logClass('user_competency_course')" href="../../_classes/user_competency_course.html" onMouseOver="classPopup(event,'user_competency_course')">user_competency_course</a>::<a class="function" onClick="logFunction('create_relation')" href="../../_functions/create_relation.html" onMouseOver="funcPopup(event,'create_relation')">create_relation</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>, <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l4328"><span class="linenum">4328</span></a>                          <a class="var it9652" onMouseOver="hilite(9652)" onMouseOut="lolite()" onClick="logVariable('usercompetencycourse')" href="../../_variables/usercompetencycourse.html">$usercompetencycourse</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l4329"><span class="linenum">4329</span></a>                      }
<a name="l4330"><span class="linenum">4330</span></a>  <span class="comment">                    // Get proficiency.</span>
<a name="l4331"><span class="linenum">4331</span></a>                      <a class="var it11570" onMouseOver="hilite(11570)" onMouseOut="lolite()" onClick="logVariable('proficiency')" href="../../_variables/proficiency.html">$proficiency</a> = <a class="var it30486" onMouseOver="hilite(30486)" onMouseOut="lolite()" onClick="logVariable('ucproficiency')" href="../../_variables/ucproficiency.html">$ucproficiency</a>;
<a name="l4332"><span class="linenum">4332</span></a>                      if (<a class="var it11570" onMouseOver="hilite(11570)" onMouseOut="lolite()" onClick="logVariable('proficiency')" href="../../_variables/proficiency.html">$proficiency</a> === null) {
<a name="l4333"><span class="linenum">4333</span></a>                          if (empty(<a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>)) {
<a name="l4334"><span class="linenum">4334</span></a>                              <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <span class="keyword">new </span><a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l4335"><span class="linenum">4335</span></a>                          }
<a name="l4336"><span class="linenum">4336</span></a>                          <a class="var it11570" onMouseOver="hilite(11570)" onMouseOut="lolite()" onClick="logVariable('proficiency')" href="../../_variables/proficiency.html">$proficiency</a> = <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_proficiency_of_grade')" href="../../_functions/get_proficiency_of_grade.html" onMouseOver="funcPopup(event,'get_proficiency_of_grade')">get_proficiency_of_grade</a>(<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>);
<a name="l4337"><span class="linenum">4337</span></a>                      }
<a name="l4338"><span class="linenum">4338</span></a>  <span class="comment">                    // Set grade.</span>
<a name="l4339"><span class="linenum">4339</span></a>                      <a class="var it9652" onMouseOver="hilite(9652)" onMouseOut="lolite()" onClick="logVariable('usercompetencycourse')" href="../../_variables/usercompetencycourse.html">$usercompetencycourse</a>-&gt;<a class="function" onClick="logFunction('set_grade')" href="../../_functions/set_grade.html" onMouseOver="funcPopup(event,'set_grade')">set_grade</a>(<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>);
<a name="l4340"><span class="linenum">4340</span></a>  <span class="comment">                    // Set proficiency.</span>
<a name="l4341"><span class="linenum">4341</span></a>                      <a class="var it9652" onMouseOver="hilite(9652)" onMouseOut="lolite()" onClick="logVariable('usercompetencycourse')" href="../../_variables/usercompetencycourse.html">$usercompetencycourse</a>-&gt;set_proficiency(<a class="var it11570" onMouseOver="hilite(11570)" onMouseOut="lolite()" onClick="logVariable('proficiency')" href="../../_variables/proficiency.html">$proficiency</a>);
<a name="l4342"><span class="linenum">4342</span></a>  
<a name="l4343"><span class="linenum">4343</span></a>                      <a class="var it3109" onMouseOver="hilite(3109)" onMouseOut="lolite()" onClick="logVariable('coursesettings')" href="../../_variables/coursesettings.html">$coursesettings</a> = <a class="class" onClick="logClass('course_competency_settings')" href="../../_classes/course_competency_settings.html" onMouseOver="classPopup(event,'course_competency_settings')">course_competency_settings</a>::<a class="function" onClick="logFunction('get_by_courseid')" href="../../_functions/get_by_courseid.html" onMouseOver="funcPopup(event,'get_by_courseid')">get_by_courseid</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l4344"><span class="linenum">4344</span></a>                      if (!<a class="var it3109" onMouseOver="hilite(3109)" onMouseOut="lolite()" onClick="logVariable('coursesettings')" href="../../_variables/coursesettings.html">$coursesettings</a>-&gt;get_pushratingstouserplans()) {
<a name="l4345"><span class="linenum">4345</span></a>                          <a class="var it30484" onMouseOver="hilite(30484)" onMouseOut="lolite()" onClick="logVariable('setucgrade')" href="../../_variables/setucgrade.html">$setucgrade</a> = false;
<a name="l4346"><span class="linenum">4346</span></a>                      }
<a name="l4347"><span class="linenum">4347</span></a>                  }
<a name="l4348"><span class="linenum">4348</span></a>  
<a name="l4349"><span class="linenum">4349</span></a>                  break;
<a name="l4350"><span class="linenum">4350</span></a>  
<a name="l4351"><span class="linenum">4351</span></a>  <span class="comment">            // Simply logging an evidence.</span>
<a name="l4352"><span class="linenum">4352</span></a>              case <a class="class" onClick="logClass('evidence')" href="../../_classes/evidence.html" onMouseOver="classPopup(event,'evidence')">evidence</a>::ACTION_LOG:
<a name="l4353"><span class="linenum">4353</span></a>                  if (<a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a> !== null) {
<a name="l4354"><span class="linenum">4354</span></a>                      throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>(&quot;The grade MUST NOT be set when 'logging' an evidence.&quot;);
<a name="l4355"><span class="linenum">4355</span></a>                  }
<a name="l4356"><span class="linenum">4356</span></a>                  break;
<a name="l4357"><span class="linenum">4357</span></a>  
<a name="l4358"><span class="linenum">4358</span></a>  <span class="comment">            // Whoops, this is not expected.</span>
<a name="l4359"><span class="linenum">4359</span></a>              default:
<a name="l4360"><span class="linenum">4360</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Unexpected action parameter when registering an evidence.');
<a name="l4361"><span class="linenum">4361</span></a>                  break;
<a name="l4362"><span class="linenum">4362</span></a>          }
<a name="l4363"><span class="linenum">4363</span></a>  
<a name="l4364"><span class="linenum">4364</span></a>  <span class="comment">        // Should we recommend?</span>
<a name="l4365"><span class="linenum">4365</span></a>          if (<a class="var it25028" onMouseOver="hilite(25028)" onMouseOut="lolite()" onClick="logVariable('recommend')" href="../../_variables/recommend.html">$recommend</a> &amp;&amp; <a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>-&gt;<a class="function" onClick="logFunction('get_status')" href="../../_functions/get_status.html" onMouseOver="funcPopup(event,'get_status')">get_status</a>() == <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::STATUS_IDLE) {
<a name="l4366"><span class="linenum">4366</span></a>              <a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>-&gt;<a class="function" onClick="logFunction('set_status')" href="../../_functions/set_status.html" onMouseOver="funcPopup(event,'set_status')">set_status</a>(<a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::STATUS_WAITING_FOR_REVIEW);
<a name="l4367"><span class="linenum">4367</span></a>          }
<a name="l4368"><span class="linenum">4368</span></a>  
<a name="l4369"><span class="linenum">4369</span></a>  <span class="comment">        // Setting the grade and proficiency for the user competency.</span>
<a name="l4370"><span class="linenum">4370</span></a>          <a class="var it30487" onMouseOver="hilite(30487)" onMouseOut="lolite()" onClick="logVariable('wascompleted')" href="../../_variables/wascompleted.html">$wascompleted</a> = false;
<a name="l4371"><span class="linenum">4371</span></a>          if (<a class="var it30484" onMouseOver="hilite(30484)" onMouseOut="lolite()" onClick="logVariable('setucgrade')" href="../../_variables/setucgrade.html">$setucgrade</a> == true) {
<a name="l4372"><span class="linenum">4372</span></a>              if (!<a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>-&gt;get_proficiency() &amp;&amp; <a class="var it30486" onMouseOver="hilite(30486)" onMouseOut="lolite()" onClick="logVariable('ucproficiency')" href="../../_variables/ucproficiency.html">$ucproficiency</a>) {
<a name="l4373"><span class="linenum">4373</span></a>                  <a class="var it30487" onMouseOver="hilite(30487)" onMouseOut="lolite()" onClick="logVariable('wascompleted')" href="../../_variables/wascompleted.html">$wascompleted</a> = true;
<a name="l4374"><span class="linenum">4374</span></a>              }
<a name="l4375"><span class="linenum">4375</span></a>              <a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>-&gt;<a class="function" onClick="logFunction('set_grade')" href="../../_functions/set_grade.html" onMouseOver="funcPopup(event,'set_grade')">set_grade</a>(<a class="var it30485" onMouseOver="hilite(30485)" onMouseOut="lolite()" onClick="logVariable('ucgrade')" href="../../_variables/ucgrade.html">$ucgrade</a>);
<a name="l4376"><span class="linenum">4376</span></a>              <a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>-&gt;set_proficiency(<a class="var it30486" onMouseOver="hilite(30486)" onMouseOut="lolite()" onClick="logVariable('ucproficiency')" href="../../_variables/ucproficiency.html">$ucproficiency</a>);
<a name="l4377"><span class="linenum">4377</span></a>          }
<a name="l4378"><span class="linenum">4378</span></a>  
<a name="l4379"><span class="linenum">4379</span></a>  <span class="comment">        // Prepare the evidence.</span>
<a name="l4380"><span class="linenum">4380</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a> = new stdClass();
<a name="l4381"><span class="linenum">4381</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('usercompetencyid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/usercompetencyid.html">usercompetencyid</a> = <a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>();
<a name="l4382"><span class="linenum">4382</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('contextid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a> = <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('contextid')" href="../../_variables/contextid.html">$contextid</a>;
<a name="l4383"><span class="linenum">4383</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('action')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/action.html">action</a> = <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a>;
<a name="l4384"><span class="linenum">4384</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('descidentifier')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/descidentifier.html">descidentifier</a> = <a class="var it10076" onMouseOver="hilite(10076)" onMouseOut="lolite()" onClick="logVariable('descidentifier')" href="../../_variables/descidentifier.html">$descidentifier</a>;
<a name="l4385"><span class="linenum">4385</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('desccomponent')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/desccomponent.html">desccomponent</a> = <a class="var it10077" onMouseOver="hilite(10077)" onMouseOut="lolite()" onClick="logVariable('desccomponent')" href="../../_variables/desccomponent.html">$desccomponent</a>;
<a name="l4386"><span class="linenum">4386</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('grade')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/grade.html">grade</a> = <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>;
<a name="l4387"><span class="linenum">4387</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('actionuserid')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/actionuserid.html">actionuserid</a> = <a class="var it10465" onMouseOver="hilite(10465)" onMouseOut="lolite()" onClick="logVariable('actionuserid')" href="../../_variables/actionuserid.html">$actionuserid</a>;
<a name="l4388"><span class="linenum">4388</span></a>          <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>-&gt;<a onClick="logVariable('note')" class="var it42976" onMouseOver="hilite(42976)" onMouseOut="lolite()" href="../../_variables/note.html">note</a> = <a class="var it6990" onMouseOver="hilite(6990)" onMouseOut="lolite()" onClick="logVariable('note')" href="../../_variables/note.html">$note</a>;
<a name="l4389"><span class="linenum">4389</span></a>          <a class="var it10078" onMouseOver="hilite(10078)" onMouseOut="lolite()" onClick="logVariable('evidence')" href="../../_variables/evidence.html">$evidence</a> = <span class="keyword">new </span><a class="class" onClick="logClass('evidence')" href="../../_classes/evidence.html" onMouseOver="classPopup(event,'evidence')">evidence</a>(0, <a class="var it699" onMouseOver="hilite(699)" onMouseOut="lolite()" onClick="logVariable('record')" href="../../_variables/record.html">$record</a>);
<a name="l4390"><span class="linenum">4390</span></a>          <a class="var it10078" onMouseOver="hilite(10078)" onMouseOut="lolite()" onClick="logVariable('evidence')" href="../../_variables/evidence.html">$evidence</a>-&gt;<a class="function" onClick="logFunction('set_desca')" href="../../_functions/set_desca.html" onMouseOver="funcPopup(event,'set_desca')">set_desca</a>(<a class="var it30483" onMouseOver="hilite(30483)" onMouseOut="lolite()" onClick="logVariable('desca')" href="../../_variables/desca.html">$desca</a>);
<a name="l4391"><span class="linenum">4391</span></a>          <a class="var it10078" onMouseOver="hilite(10078)" onMouseOut="lolite()" onClick="logVariable('evidence')" href="../../_variables/evidence.html">$evidence</a>-&gt;<a class="function" onClick="logFunction('set_url')" href="../../_functions/set_url.html" onMouseOver="funcPopup(event,'set_url')">set_url</a>(<a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>);
<a name="l4392"><span class="linenum">4392</span></a>  
<a name="l4393"><span class="linenum">4393</span></a>  <span class="comment">        // Validate both models, we should not operate on one if the other will not save.</span>
<a name="l4394"><span class="linenum">4394</span></a>          if (!<a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>-&gt;<a class="function" onClick="logFunction('is_valid')" href="../../_functions/is_valid.html" onMouseOver="funcPopup(event,'is_valid')">is_valid</a>()) {
<a name="l4395"><span class="linenum">4395</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('invalid_persistent_exception')" href="../../_classes/invalid_persistent_exception.html" onMouseOver="classPopup(event,'invalid_persistent_exception')">invalid_persistent_exception</a>(<a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>-&gt;<a class="function" onClick="logFunction('get_errors')" href="../../_functions/get_errors.html" onMouseOver="funcPopup(event,'get_errors')">get_errors</a>());
<a name="l4396"><span class="linenum">4396</span></a>          } else if (!<a class="var it10078" onMouseOver="hilite(10078)" onMouseOut="lolite()" onClick="logVariable('evidence')" href="../../_variables/evidence.html">$evidence</a>-&gt;<a class="function" onClick="logFunction('is_valid')" href="../../_functions/is_valid.html" onMouseOver="funcPopup(event,'is_valid')">is_valid</a>()) {
<a name="l4397"><span class="linenum">4397</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('invalid_persistent_exception')" href="../../_classes/invalid_persistent_exception.html" onMouseOver="classPopup(event,'invalid_persistent_exception')">invalid_persistent_exception</a>(<a class="var it10078" onMouseOver="hilite(10078)" onMouseOut="lolite()" onClick="logVariable('evidence')" href="../../_variables/evidence.html">$evidence</a>-&gt;<a class="function" onClick="logFunction('get_errors')" href="../../_functions/get_errors.html" onMouseOver="funcPopup(event,'get_errors')">get_errors</a>());
<a name="l4398"><span class="linenum">4398</span></a>          }
<a name="l4399"><span class="linenum">4399</span></a>  
<a name="l4400"><span class="linenum">4400</span></a>  <span class="comment">        // Save the user_competency_course record.</span>
<a name="l4401"><span class="linenum">4401</span></a>          if (<a class="var it9652" onMouseOver="hilite(9652)" onMouseOut="lolite()" onClick="logVariable('usercompetencycourse')" href="../../_variables/usercompetencycourse.html">$usercompetencycourse</a> !== null) {
<a name="l4402"><span class="linenum">4402</span></a>  <span class="comment">            // Validate and update.</span>
<a name="l4403"><span class="linenum">4403</span></a>              if (!<a class="var it9652" onMouseOver="hilite(9652)" onMouseOut="lolite()" onClick="logVariable('usercompetencycourse')" href="../../_variables/usercompetencycourse.html">$usercompetencycourse</a>-&gt;<a class="function" onClick="logFunction('is_valid')" href="../../_functions/is_valid.html" onMouseOver="funcPopup(event,'is_valid')">is_valid</a>()) {
<a name="l4404"><span class="linenum">4404</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('invalid_persistent_exception')" href="../../_classes/invalid_persistent_exception.html" onMouseOver="classPopup(event,'invalid_persistent_exception')">invalid_persistent_exception</a>(<a class="var it9652" onMouseOver="hilite(9652)" onMouseOut="lolite()" onClick="logVariable('usercompetencycourse')" href="../../_variables/usercompetencycourse.html">$usercompetencycourse</a>-&gt;<a class="function" onClick="logFunction('get_errors')" href="../../_functions/get_errors.html" onMouseOver="funcPopup(event,'get_errors')">get_errors</a>());
<a name="l4405"><span class="linenum">4405</span></a>              }
<a name="l4406"><span class="linenum">4406</span></a>              <a class="var it9652" onMouseOver="hilite(9652)" onMouseOut="lolite()" onClick="logVariable('usercompetencycourse')" href="../../_variables/usercompetencycourse.html">$usercompetencycourse</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l4407"><span class="linenum">4407</span></a>          }
<a name="l4408"><span class="linenum">4408</span></a>  
<a name="l4409"><span class="linenum">4409</span></a>  <span class="comment">        // Finally save. Pheww!</span>
<a name="l4410"><span class="linenum">4410</span></a>          <a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l4411"><span class="linenum">4411</span></a>          <a class="var it10078" onMouseOver="hilite(10078)" onMouseOut="lolite()" onClick="logVariable('evidence')" href="../../_variables/evidence.html">$evidence</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l4412"><span class="linenum">4412</span></a>  
<a name="l4413"><span class="linenum">4413</span></a>  <span class="comment">        // Trigger the evidence_created event.</span>
<a name="l4414"><span class="linenum">4414</span></a>          \core\event\<a class="class" onClick="logClass('competency_evidence_created')" href="../../_classes/competency_evidence_created.html" onMouseOver="classPopup(event,'competency_evidence_created')">competency_evidence_created</a>::<a class="function" onClick="logFunction('create_from_evidence')" href="../../_functions/create_from_evidence.html" onMouseOver="funcPopup(event,'create_from_evidence')">create_from_evidence</a>(<a class="var it10078" onMouseOver="hilite(10078)" onMouseOut="lolite()" onClick="logVariable('evidence')" href="../../_variables/evidence.html">$evidence</a>, <a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>, <a class="var it25028" onMouseOver="hilite(25028)" onMouseOut="lolite()" onClick="logVariable('recommend')" href="../../_variables/recommend.html">$recommend</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l4415"><span class="linenum">4415</span></a>  
<a name="l4416"><span class="linenum">4416</span></a>  <span class="comment">        // The competency was marked as completed, apply the rules.</span>
<a name="l4417"><span class="linenum">4417</span></a>          if (<a class="var it30487" onMouseOver="hilite(30487)" onMouseOut="lolite()" onClick="logVariable('wascompleted')" href="../../_variables/wascompleted.html">$wascompleted</a>) {
<a name="l4418"><span class="linenum">4418</span></a>              self::<a class="function" onClick="logFunction('apply_competency_rules_from_usercompetency')" href="../../_functions/apply_competency_rules_from_usercompetency.html" onMouseOver="funcPopup(event,'apply_competency_rules_from_usercompetency')">apply_competency_rules_from_usercompetency</a>(<a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>, <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>);
<a name="l4419"><span class="linenum">4419</span></a>          }
<a name="l4420"><span class="linenum">4420</span></a>  
<a name="l4421"><span class="linenum">4421</span></a>          return <a class="var it10078" onMouseOver="hilite(10078)" onMouseOut="lolite()" onClick="logVariable('evidence')" href="../../_variables/evidence.html">$evidence</a>;
<a name="l4422"><span class="linenum">4422</span></a>      }
<a name="l4423"><span class="linenum">4423</span></a>  
<a name="l4424"><span class="linenum">4424</span></a>      <span class="comment">/**</span>
<a name="l4425"><span class="linenum">4425</span></a>  <span class="comment">     * Read an evidence.</span>
<a name="l4426"><span class="linenum">4426</span></a>  <span class="comment">     * @param int $evidenceid The evidence ID.</span>
<a name="l4427"><span class="linenum">4427</span></a>  <span class="comment">     * @return evidence</span>
<a name="l4428"><span class="linenum">4428</span></a>  <span class="comment">     */</span>
<a name="l4429"><span class="linenum">4429</span></a>      public static function <a class="function" onClick="logFunction('read_evidence')" href="../../_functions/read_evidence.html" onMouseOver="funcPopup(event,'read_evidence')">read_evidence</a>(<a class="var it30488" onMouseOver="hilite(30488)" onMouseOut="lolite()" onClick="logVariable('evidenceid')" href="../../_variables/evidenceid.html">$evidenceid</a>) {
<a name="l4430"><span class="linenum">4430</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l4431"><span class="linenum">4431</span></a>  
<a name="l4432"><span class="linenum">4432</span></a>          <a class="var it10078" onMouseOver="hilite(10078)" onMouseOut="lolite()" onClick="logVariable('evidence')" href="../../_variables/evidence.html">$evidence</a> = <span class="keyword">new </span><a class="class" onClick="logClass('evidence')" href="../../_classes/evidence.html" onMouseOver="classPopup(event,'evidence')">evidence</a>(<a class="var it30488" onMouseOver="hilite(30488)" onMouseOut="lolite()" onClick="logVariable('evidenceid')" href="../../_variables/evidenceid.html">$evidenceid</a>);
<a name="l4433"><span class="linenum">4433</span></a>          <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> = <span class="keyword">new </span><a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>(<a class="var it10078" onMouseOver="hilite(10078)" onMouseOut="lolite()" onClick="logVariable('evidence')" href="../../_variables/evidence.html">$evidence</a>-&gt;get_usercompetencyid());
<a name="l4434"><span class="linenum">4434</span></a>          if (!<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l4435"><span class="linenum">4435</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:usercompetencyview',
<a name="l4436"><span class="linenum">4436</span></a>                  'nopermissions', '');
<a name="l4437"><span class="linenum">4437</span></a>          }
<a name="l4438"><span class="linenum">4438</span></a>  
<a name="l4439"><span class="linenum">4439</span></a>          return <a class="var it10078" onMouseOver="hilite(10078)" onMouseOut="lolite()" onClick="logVariable('evidence')" href="../../_variables/evidence.html">$evidence</a>;
<a name="l4440"><span class="linenum">4440</span></a>      }
<a name="l4441"><span class="linenum">4441</span></a>  
<a name="l4442"><span class="linenum">4442</span></a>      <span class="comment">/**</span>
<a name="l4443"><span class="linenum">4443</span></a>  <span class="comment">     * Delete an evidence.</span>
<a name="l4444"><span class="linenum">4444</span></a>  <span class="comment">     *</span>
<a name="l4445"><span class="linenum">4445</span></a>  <span class="comment">     * @param evidence|int $evidenceorid The evidence, or its ID.</span>
<a name="l4446"><span class="linenum">4446</span></a>  <span class="comment">     * @return bool</span>
<a name="l4447"><span class="linenum">4447</span></a>  <span class="comment">     */</span>
<a name="l4448"><span class="linenum">4448</span></a>      public static function <a class="function" onClick="logFunction('delete_evidence')" href="../../_functions/delete_evidence.html" onMouseOver="funcPopup(event,'delete_evidence')">delete_evidence</a>(<a class="var it30489" onMouseOver="hilite(30489)" onMouseOut="lolite()" onClick="logVariable('evidenceorid')" href="../../_variables/evidenceorid.html">$evidenceorid</a>) {
<a name="l4449"><span class="linenum">4449</span></a>          <a class="var it10078" onMouseOver="hilite(10078)" onMouseOut="lolite()" onClick="logVariable('evidence')" href="../../_variables/evidence.html">$evidence</a> = <a class="var it30489" onMouseOver="hilite(30489)" onMouseOut="lolite()" onClick="logVariable('evidenceorid')" href="../../_variables/evidenceorid.html">$evidenceorid</a>;
<a name="l4450"><span class="linenum">4450</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it10078" onMouseOver="hilite(10078)" onMouseOut="lolite()" onClick="logVariable('evidence')" href="../../_variables/evidence.html">$evidence</a>)) {
<a name="l4451"><span class="linenum">4451</span></a>              <a class="var it10078" onMouseOver="hilite(10078)" onMouseOut="lolite()" onClick="logVariable('evidence')" href="../../_variables/evidence.html">$evidence</a> = <span class="keyword">new </span><a class="class" onClick="logClass('evidence')" href="../../_classes/evidence.html" onMouseOver="classPopup(event,'evidence')">evidence</a>(<a class="var it30489" onMouseOver="hilite(30489)" onMouseOut="lolite()" onClick="logVariable('evidenceorid')" href="../../_variables/evidenceorid.html">$evidenceorid</a>);
<a name="l4452"><span class="linenum">4452</span></a>          }
<a name="l4453"><span class="linenum">4453</span></a>  
<a name="l4454"><span class="linenum">4454</span></a>          <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> = <span class="keyword">new </span><a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>(<a class="var it10078" onMouseOver="hilite(10078)" onMouseOut="lolite()" onClick="logVariable('evidence')" href="../../_variables/evidence.html">$evidence</a>-&gt;get_usercompetencyid());
<a name="l4455"><span class="linenum">4455</span></a>          if (!<a class="class" onClick="logClass('evidence')" href="../../_classes/evidence.html" onMouseOver="classPopup(event,'evidence')">evidence</a>::<a class="function" onClick="logFunction('can_delete_user')" href="../../_functions/can_delete_user.html" onMouseOver="funcPopup(event,'can_delete_user')">can_delete_user</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>())) {
<a name="l4456"><span class="linenum">4456</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:evidencedelete', 'nopermissions', '');
<a name="l4457"><span class="linenum">4457</span></a>          }
<a name="l4458"><span class="linenum">4458</span></a>  
<a name="l4459"><span class="linenum">4459</span></a>          return <a class="var it10078" onMouseOver="hilite(10078)" onMouseOut="lolite()" onClick="logVariable('evidence')" href="../../_variables/evidence.html">$evidence</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>();
<a name="l4460"><span class="linenum">4460</span></a>      }
<a name="l4461"><span class="linenum">4461</span></a>  
<a name="l4462"><span class="linenum">4462</span></a>      <span class="comment">/**</span>
<a name="l4463"><span class="linenum">4463</span></a>  <span class="comment">     * Apply the competency rules from a user competency.</span>
<a name="l4464"><span class="linenum">4464</span></a>  <span class="comment">     *</span>
<a name="l4465"><span class="linenum">4465</span></a>  <span class="comment">     * The user competency passed should be one that was recently marked as complete.</span>
<a name="l4466"><span class="linenum">4466</span></a>  <span class="comment">     * A user competency is considered 'complete' when it's proficiency value is true.</span>
<a name="l4467"><span class="linenum">4467</span></a>  <span class="comment">     *</span>
<a name="l4468"><span class="linenum">4468</span></a>  <span class="comment">     * This method will check if the parent of this usercompetency's competency has any</span>
<a name="l4469"><span class="linenum">4469</span></a>  <span class="comment">     * rules and if so will see if they match. When matched it will take the required</span>
<a name="l4470"><span class="linenum">4470</span></a>  <span class="comment">     * step to add evidence and trigger completion, etc...</span>
<a name="l4471"><span class="linenum">4471</span></a>  <span class="comment">     *</span>
<a name="l4472"><span class="linenum">4472</span></a>  <span class="comment">     * @param  user_competency $usercompetency The user competency recently completed.</span>
<a name="l4473"><span class="linenum">4473</span></a>  <span class="comment">     * @param  competency|null $competency     The competency of the user competency, useful to avoid unnecessary read.</span>
<a name="l4474"><span class="linenum">4474</span></a>  <span class="comment">     * @return void</span>
<a name="l4475"><span class="linenum">4475</span></a>  <span class="comment">     */</span>
<a name="l4476"><span class="linenum">4476</span></a>      protected static function <a class="function" onClick="logFunction('apply_competency_rules_from_usercompetency')" href="../../_functions/apply_competency_rules_from_usercompetency.html" onMouseOver="funcPopup(event,'apply_competency_rules_from_usercompetency')">apply_competency_rules_from_usercompetency</a>(user_competency <a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>,
<a name="l4477"><span class="linenum">4477</span></a>                                                                           competency <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = null) {
<a name="l4478"><span class="linenum">4478</span></a>  
<a name="l4479"><span class="linenum">4479</span></a>  <span class="comment">        // Perform some basic checks.</span>
<a name="l4480"><span class="linenum">4480</span></a>          if (!<a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>-&gt;get_proficiency()) {
<a name="l4481"><span class="linenum">4481</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('The user competency passed is not completed.');
<a name="l4482"><span class="linenum">4482</span></a>          }
<a name="l4483"><span class="linenum">4483</span></a>          if (<a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> === null) {
<a name="l4484"><span class="linenum">4484</span></a>              <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>-&gt;<a class="function" onClick="logFunction('get_competency')" href="../../_functions/get_competency.html" onMouseOver="funcPopup(event,'get_competency')">get_competency</a>();
<a name="l4485"><span class="linenum">4485</span></a>          }
<a name="l4486"><span class="linenum">4486</span></a>          if (<a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>() != <a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>-&gt;get_competencyid()) {
<a name="l4487"><span class="linenum">4487</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Mismatch between user competency and competency.');
<a name="l4488"><span class="linenum">4488</span></a>          }
<a name="l4489"><span class="linenum">4489</span></a>  
<a name="l4490"><span class="linenum">4490</span></a>  <span class="comment">        // Fetch the parent.</span>
<a name="l4491"><span class="linenum">4491</span></a>          <a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a> = <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_parent')" href="../../_functions/get_parent.html" onMouseOver="funcPopup(event,'get_parent')">get_parent</a>();
<a name="l4492"><span class="linenum">4492</span></a>          if (<a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a> === null) {
<a name="l4493"><span class="linenum">4493</span></a>              return;
<a name="l4494"><span class="linenum">4494</span></a>          }
<a name="l4495"><span class="linenum">4495</span></a>  
<a name="l4496"><span class="linenum">4496</span></a>  <span class="comment">        // The parent should have a rule, and a meaningful outcome.</span>
<a name="l4497"><span class="linenum">4497</span></a>          <a class="var it8527" onMouseOver="hilite(8527)" onMouseOut="lolite()" onClick="logVariable('ruleoutcome')" href="../../_variables/ruleoutcome.html">$ruleoutcome</a> = <a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>-&gt;get_ruleoutcome();
<a name="l4498"><span class="linenum">4498</span></a>          if (<a class="var it8527" onMouseOver="hilite(8527)" onMouseOut="lolite()" onClick="logVariable('ruleoutcome')" href="../../_variables/ruleoutcome.html">$ruleoutcome</a> == <a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>::OUTCOME_NONE) {
<a name="l4499"><span class="linenum">4499</span></a>              return;
<a name="l4500"><span class="linenum">4500</span></a>          }
<a name="l4501"><span class="linenum">4501</span></a>          <a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../_variables/rule.html">$rule</a> = <a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>-&gt;<a class="function" onClick="logFunction('get_rule_object')" href="../../_functions/get_rule_object.html" onMouseOver="funcPopup(event,'get_rule_object')">get_rule_object</a>();
<a name="l4502"><span class="linenum">4502</span></a>          if (<a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../_variables/rule.html">$rule</a> === null) {
<a name="l4503"><span class="linenum">4503</span></a>              return;
<a name="l4504"><span class="linenum">4504</span></a>          }
<a name="l4505"><span class="linenum">4505</span></a>  
<a name="l4506"><span class="linenum">4506</span></a>  <span class="comment">        // Fetch or create the user competency for the parent.</span>
<a name="l4507"><span class="linenum">4507</span></a>          <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> = <a class="var it4626" onMouseOver="hilite(4626)" onMouseOut="lolite()" onClick="logVariable('usercompetency')" href="../../_variables/usercompetency.html">$usercompetency</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>();
<a name="l4508"><span class="linenum">4508</span></a>          <a class="var it30490" onMouseOver="hilite(30490)" onMouseOut="lolite()" onClick="logVariable('parentuc')" href="../../_variables/parentuc.html">$parentuc</a> = <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, 'competencyid' =&gt; <a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>()));
<a name="l4509"><span class="linenum">4509</span></a>          if (!<a class="var it30490" onMouseOver="hilite(30490)" onMouseOut="lolite()" onClick="logVariable('parentuc')" href="../../_variables/parentuc.html">$parentuc</a>) {
<a name="l4510"><span class="linenum">4510</span></a>              <a class="var it30490" onMouseOver="hilite(30490)" onMouseOut="lolite()" onClick="logVariable('parentuc')" href="../../_variables/parentuc.html">$parentuc</a> = <a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('create_relation')" href="../../_functions/create_relation.html" onMouseOver="funcPopup(event,'create_relation')">create_relation</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>());
<a name="l4511"><span class="linenum">4511</span></a>              <a class="var it30490" onMouseOver="hilite(30490)" onMouseOut="lolite()" onClick="logVariable('parentuc')" href="../../_variables/parentuc.html">$parentuc</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l4512"><span class="linenum">4512</span></a>          }
<a name="l4513"><span class="linenum">4513</span></a>  
<a name="l4514"><span class="linenum">4514</span></a>  <span class="comment">        // Does the rule match?</span>
<a name="l4515"><span class="linenum">4515</span></a>          if (!<a class="var it1936" onMouseOver="hilite(1936)" onMouseOut="lolite()" onClick="logVariable('rule')" href="../../_variables/rule.html">$rule</a>-&gt;<a class="function" onClick="logFunction('matches')" href="../../_functions/matches.html" onMouseOver="funcPopup(event,'matches')">matches</a>(<a class="var it30490" onMouseOver="hilite(30490)" onMouseOut="lolite()" onClick="logVariable('parentuc')" href="../../_variables/parentuc.html">$parentuc</a>)) {
<a name="l4516"><span class="linenum">4516</span></a>              return;
<a name="l4517"><span class="linenum">4517</span></a>          }
<a name="l4518"><span class="linenum">4518</span></a>  
<a name="l4519"><span class="linenum">4519</span></a>  <span class="comment">        // Figuring out what to do.</span>
<a name="l4520"><span class="linenum">4520</span></a>          <a class="var it25028" onMouseOver="hilite(25028)" onMouseOut="lolite()" onClick="logVariable('recommend')" href="../../_variables/recommend.html">$recommend</a> = false;
<a name="l4521"><span class="linenum">4521</span></a>          if (<a class="var it8527" onMouseOver="hilite(8527)" onMouseOut="lolite()" onClick="logVariable('ruleoutcome')" href="../../_variables/ruleoutcome.html">$ruleoutcome</a> == <a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>::OUTCOME_EVIDENCE) {
<a name="l4522"><span class="linenum">4522</span></a>              <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> = <a class="class" onClick="logClass('evidence')" href="../../_classes/evidence.html" onMouseOver="classPopup(event,'evidence')">evidence</a>::ACTION_LOG;
<a name="l4523"><span class="linenum">4523</span></a>  
<a name="l4524"><span class="linenum">4524</span></a>          } else if (<a class="var it8527" onMouseOver="hilite(8527)" onMouseOut="lolite()" onClick="logVariable('ruleoutcome')" href="../../_variables/ruleoutcome.html">$ruleoutcome</a> == <a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>::OUTCOME_RECOMMEND) {
<a name="l4525"><span class="linenum">4525</span></a>              <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> = <a class="class" onClick="logClass('evidence')" href="../../_classes/evidence.html" onMouseOver="classPopup(event,'evidence')">evidence</a>::ACTION_LOG;
<a name="l4526"><span class="linenum">4526</span></a>              <a class="var it25028" onMouseOver="hilite(25028)" onMouseOut="lolite()" onClick="logVariable('recommend')" href="../../_variables/recommend.html">$recommend</a> = true;
<a name="l4527"><span class="linenum">4527</span></a>  
<a name="l4528"><span class="linenum">4528</span></a>          } else if (<a class="var it8527" onMouseOver="hilite(8527)" onMouseOut="lolite()" onClick="logVariable('ruleoutcome')" href="../../_variables/ruleoutcome.html">$ruleoutcome</a> == <a class="class" onClick="logClass('competency')" href="../../_classes/competency.html" onMouseOver="classPopup(event,'competency')">competency</a>::OUTCOME_COMPLETE) {
<a name="l4529"><span class="linenum">4529</span></a>              <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> = <a class="class" onClick="logClass('evidence')" href="../../_classes/evidence.html" onMouseOver="classPopup(event,'evidence')">evidence</a>::ACTION_COMPLETE;
<a name="l4530"><span class="linenum">4530</span></a>  
<a name="l4531"><span class="linenum">4531</span></a>          } else {
<a name="l4532"><span class="linenum">4532</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('Unexpected rule outcome: ' + <a class="var it8527" onMouseOver="hilite(8527)" onMouseOut="lolite()" onClick="logVariable('ruleoutcome')" href="../../_variables/ruleoutcome.html">$ruleoutcome</a>);
<a name="l4533"><span class="linenum">4533</span></a>          }
<a name="l4534"><span class="linenum">4534</span></a>  
<a name="l4535"><span class="linenum">4535</span></a>  <span class="comment">        // Finally add an evidence.</span>
<a name="l4536"><span class="linenum">4536</span></a>          static::<a class="function" onClick="logFunction('add_evidence')" href="../../_functions/add_evidence.html" onMouseOver="funcPopup(event,'add_evidence')">add_evidence</a>(
<a name="l4537"><span class="linenum">4537</span></a>              <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>,
<a name="l4538"><span class="linenum">4538</span></a>              <a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>,
<a name="l4539"><span class="linenum">4539</span></a>              <a class="var it311" onMouseOver="hilite(311)" onMouseOut="lolite()" onClick="logVariable('parent')" href="../../_variables/parent.html">$parent</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>()-&gt;id,
<a name="l4540"><span class="linenum">4540</span></a>              <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a>,
<a name="l4541"><span class="linenum">4541</span></a>              'evidence_competencyrule',
<a name="l4542"><span class="linenum">4542</span></a>              'core_competency',
<a name="l4543"><span class="linenum">4543</span></a>              null,
<a name="l4544"><span class="linenum">4544</span></a>              <a class="var it25028" onMouseOver="hilite(25028)" onMouseOut="lolite()" onClick="logVariable('recommend')" href="../../_variables/recommend.html">$recommend</a>
<a name="l4545"><span class="linenum">4545</span></a>          );
<a name="l4546"><span class="linenum">4546</span></a>      }
<a name="l4547"><span class="linenum">4547</span></a>  
<a name="l4548"><span class="linenum">4548</span></a>      <span class="comment">/**</span>
<a name="l4549"><span class="linenum">4549</span></a>  <span class="comment">     * Observe when a course module is marked as completed.</span>
<a name="l4550"><span class="linenum">4550</span></a>  <span class="comment">     *</span>
<a name="l4551"><span class="linenum">4551</span></a>  <span class="comment">     * Note that the user being logged in while this happens may be anyone.</span>
<a name="l4552"><span class="linenum">4552</span></a>  <span class="comment">     * Do not rely on capability checks here!</span>
<a name="l4553"><span class="linenum">4553</span></a>  <span class="comment">     *</span>
<a name="l4554"><span class="linenum">4554</span></a>  <span class="comment">     * @param  \core\event\course_module_completion_updated $event</span>
<a name="l4555"><span class="linenum">4555</span></a>  <span class="comment">     * @return void</span>
<a name="l4556"><span class="linenum">4556</span></a>  <span class="comment">     */</span>
<a name="l4557"><span class="linenum">4557</span></a>      public static function <a class="function" onClick="logFunction('observe_course_module_completion_updated')" href="../../_functions/observe_course_module_completion_updated.html" onMouseOver="funcPopup(event,'observe_course_module_completion_updated')">observe_course_module_completion_updated</a>(\core\event\course_module_completion_updated <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>) {
<a name="l4558"><span class="linenum">4558</span></a>          if (!static::<a class="function" onClick="logFunction('is_enabled')" href="../../_functions/is_enabled.html" onMouseOver="funcPopup(event,'is_enabled')">is_enabled</a>()) {
<a name="l4559"><span class="linenum">4559</span></a>              return;
<a name="l4560"><span class="linenum">4560</span></a>          }
<a name="l4561"><span class="linenum">4561</span></a>  
<a name="l4562"><span class="linenum">4562</span></a>          <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a> = <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('get_record_snapshot')" href="../../_functions/get_record_snapshot.html" onMouseOver="funcPopup(event,'get_record_snapshot')">get_record_snapshot</a>('course_modules_completion', <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('objectid')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/objectid.html">objectid</a>);
<a name="l4563"><span class="linenum">4563</span></a>  
<a name="l4564"><span class="linenum">4564</span></a>          if (<a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('completionstate')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/completionstate.html">completionstate</a> == <a class="constant" onClick="logConstant('COMPLETION_COMPLETE')" href="../../_constants/COMPLETION_COMPLETE.html" onMouseOver="constPopup(event,'COMPLETION_COMPLETE')">COMPLETION_COMPLETE</a>
<a name="l4565"><span class="linenum">4565</span></a>                  || <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('completionstate')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/completionstate.html">completionstate</a> == <a class="constant" onClick="logConstant('COMPLETION_COMPLETE_PASS')" href="../../_constants/COMPLETION_COMPLETE_PASS.html" onMouseOver="constPopup(event,'COMPLETION_COMPLETE_PASS')">COMPLETION_COMPLETE_PASS</a>) {
<a name="l4566"><span class="linenum">4566</span></a>              <a class="var it30438" onMouseOver="hilite(30438)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetencies')" href="../../_variables/coursemodulecompetencies.html">$coursemodulecompetencies</a> = <a class="class" onClick="logClass('course_module_competency')" href="../../_classes/course_module_competency.html" onMouseOver="classPopup(event,'course_module_competency')">course_module_competency</a>::<a class="function" onClick="logFunction('list_course_module_competencies')" href="../../_functions/list_course_module_competencies.html" onMouseOver="funcPopup(event,'list_course_module_competencies')">list_course_module_competencies</a>(<a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('coursemoduleid')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/coursemoduleid.html">coursemoduleid</a>);
<a name="l4567"><span class="linenum">4567</span></a>  
<a name="l4568"><span class="linenum">4568</span></a>              <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a> = <a class="function" onClick="logFunction('get_coursemodule_from_id')" href="../../_functions/get_coursemodule_from_id.html" onMouseOver="funcPopup(event,'get_coursemodule_from_id')">get_coursemodule_from_id</a>(null, <a class="var it841" onMouseOver="hilite(841)" onMouseOut="lolite()" onClick="logVariable('eventdata')" href="../../_variables/eventdata.html">$eventdata</a>-&gt;<a onClick="logVariable('coursemoduleid')" class="var it42966" onMouseOver="hilite(42966)" onMouseOut="lolite()" href="../../_variables/coursemoduleid.html">coursemoduleid</a>);
<a name="l4569"><span class="linenum">4569</span></a>              <a class="var it26555" onMouseOver="hilite(26555)" onMouseOut="lolite()" onClick="logVariable('fastmodinfo')" href="../../_variables/fastmodinfo.html">$fastmodinfo</a> = <a class="function" onClick="logFunction('get_fast_modinfo')" href="../../_functions/get_fast_modinfo.html" onMouseOver="funcPopup(event,'get_fast_modinfo')">get_fast_modinfo</a>(<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('course')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/course.html">course</a>)-&gt;cms[<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>];
<a name="l4570"><span class="linenum">4570</span></a>  
<a name="l4571"><span class="linenum">4571</span></a>              <a class="var it1082" onMouseOver="hilite(1082)" onMouseOut="lolite()" onClick="logVariable('cmname')" href="../../_variables/cmname.html">$cmname</a> = <a class="var it26555" onMouseOver="hilite(26555)" onMouseOut="lolite()" onClick="logVariable('fastmodinfo')" href="../../_variables/fastmodinfo.html">$fastmodinfo</a>-&gt;<a onClick="logVariable('name')" class="var it43747" onMouseOver="hilite(43747)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>;
<a name="l4572"><span class="linenum">4572</span></a>              <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a> = <a class="var it26555" onMouseOver="hilite(26555)" onMouseOut="lolite()" onClick="logVariable('fastmodinfo')" href="../../_variables/fastmodinfo.html">$fastmodinfo</a>-&gt;<a onClick="logVariable('url')" class="var it43747" onMouseOver="hilite(43747)" onMouseOut="lolite()" href="../../_variables/url.html">url</a>;
<a name="l4573"><span class="linenum">4573</span></a>  
<a name="l4574"><span class="linenum">4574</span></a>              foreach (<a class="var it30438" onMouseOver="hilite(30438)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetencies')" href="../../_variables/coursemodulecompetencies.html">$coursemodulecompetencies</a> as <a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a>) {
<a name="l4575"><span class="linenum">4575</span></a>                  <a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../_variables/outcome.html">$outcome</a> = <a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a>-&gt;get_ruleoutcome();
<a name="l4576"><span class="linenum">4576</span></a>                  <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> = null;
<a name="l4577"><span class="linenum">4577</span></a>                  <a class="var it25028" onMouseOver="hilite(25028)" onMouseOut="lolite()" onClick="logVariable('recommend')" href="../../_variables/recommend.html">$recommend</a> = false;
<a name="l4578"><span class="linenum">4578</span></a>                  <a class="var it30491" onMouseOver="hilite(30491)" onMouseOut="lolite()" onClick="logVariable('strdesc')" href="../../_variables/strdesc.html">$strdesc</a> = 'evidence_coursemodulecompleted';
<a name="l4579"><span class="linenum">4579</span></a>  
<a name="l4580"><span class="linenum">4580</span></a>                  if (<a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../_variables/outcome.html">$outcome</a> == <a class="class" onClick="logClass('course_module_competency')" href="../../_classes/course_module_competency.html" onMouseOver="classPopup(event,'course_module_competency')">course_module_competency</a>::OUTCOME_EVIDENCE) {
<a name="l4581"><span class="linenum">4581</span></a>                      <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> = <a class="class" onClick="logClass('evidence')" href="../../_classes/evidence.html" onMouseOver="classPopup(event,'evidence')">evidence</a>::ACTION_LOG;
<a name="l4582"><span class="linenum">4582</span></a>  
<a name="l4583"><span class="linenum">4583</span></a>                  } else if (<a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../_variables/outcome.html">$outcome</a> == <a class="class" onClick="logClass('course_module_competency')" href="../../_classes/course_module_competency.html" onMouseOver="classPopup(event,'course_module_competency')">course_module_competency</a>::OUTCOME_RECOMMEND) {
<a name="l4584"><span class="linenum">4584</span></a>                      <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> = <a class="class" onClick="logClass('evidence')" href="../../_classes/evidence.html" onMouseOver="classPopup(event,'evidence')">evidence</a>::ACTION_LOG;
<a name="l4585"><span class="linenum">4585</span></a>                      <a class="var it25028" onMouseOver="hilite(25028)" onMouseOut="lolite()" onClick="logVariable('recommend')" href="../../_variables/recommend.html">$recommend</a> = true;
<a name="l4586"><span class="linenum">4586</span></a>  
<a name="l4587"><span class="linenum">4587</span></a>                  } else if (<a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../_variables/outcome.html">$outcome</a> == <a class="class" onClick="logClass('course_module_competency')" href="../../_classes/course_module_competency.html" onMouseOver="classPopup(event,'course_module_competency')">course_module_competency</a>::OUTCOME_COMPLETE) {
<a name="l4588"><span class="linenum">4588</span></a>                      <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> = <a class="class" onClick="logClass('evidence')" href="../../_classes/evidence.html" onMouseOver="classPopup(event,'evidence')">evidence</a>::ACTION_COMPLETE;
<a name="l4589"><span class="linenum">4589</span></a>  
<a name="l4590"><span class="linenum">4590</span></a>                  } else {
<a name="l4591"><span class="linenum">4591</span></a>                      throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('Unexpected rule outcome: ' + <a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../_variables/outcome.html">$outcome</a>);
<a name="l4592"><span class="linenum">4592</span></a>                  }
<a name="l4593"><span class="linenum">4593</span></a>  
<a name="l4594"><span class="linenum">4594</span></a>                  static::<a class="function" onClick="logFunction('add_evidence')" href="../../_functions/add_evidence.html" onMouseOver="funcPopup(event,'add_evidence')">add_evidence</a>(
<a name="l4595"><span class="linenum">4595</span></a>                      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('relateduserid')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/relateduserid.html">relateduserid</a>,
<a name="l4596"><span class="linenum">4596</span></a>                      <a class="var it15433" onMouseOver="hilite(15433)" onMouseOut="lolite()" onClick="logVariable('coursemodulecompetency')" href="../../_variables/coursemodulecompetency.html">$coursemodulecompetency</a>-&gt;get_competencyid(),
<a name="l4597"><span class="linenum">4597</span></a>                      <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('contextid')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>,
<a name="l4598"><span class="linenum">4598</span></a>                      <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a>,
<a name="l4599"><span class="linenum">4599</span></a>                      <a class="var it30491" onMouseOver="hilite(30491)" onMouseOut="lolite()" onClick="logVariable('strdesc')" href="../../_variables/strdesc.html">$strdesc</a>,
<a name="l4600"><span class="linenum">4600</span></a>                      'core_competency',
<a name="l4601"><span class="linenum">4601</span></a>                      <a class="var it1082" onMouseOver="hilite(1082)" onMouseOut="lolite()" onClick="logVariable('cmname')" href="../../_variables/cmname.html">$cmname</a>,
<a name="l4602"><span class="linenum">4602</span></a>                      <a class="var it25028" onMouseOver="hilite(25028)" onMouseOut="lolite()" onClick="logVariable('recommend')" href="../../_variables/recommend.html">$recommend</a>,
<a name="l4603"><span class="linenum">4603</span></a>                      <a class="var it231" onMouseOver="hilite(231)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../_variables/url.html">$url</a>
<a name="l4604"><span class="linenum">4604</span></a>                  );
<a name="l4605"><span class="linenum">4605</span></a>              }
<a name="l4606"><span class="linenum">4606</span></a>          }
<a name="l4607"><span class="linenum">4607</span></a>      }
<a name="l4608"><span class="linenum">4608</span></a>  
<a name="l4609"><span class="linenum">4609</span></a>      <span class="comment">/**</span>
<a name="l4610"><span class="linenum">4610</span></a>  <span class="comment">     * Observe when a course is marked as completed.</span>
<a name="l4611"><span class="linenum">4611</span></a>  <span class="comment">     *</span>
<a name="l4612"><span class="linenum">4612</span></a>  <span class="comment">     * Note that the user being logged in while this happens may be anyone.</span>
<a name="l4613"><span class="linenum">4613</span></a>  <span class="comment">     * Do not rely on capability checks here!</span>
<a name="l4614"><span class="linenum">4614</span></a>  <span class="comment">     *</span>
<a name="l4615"><span class="linenum">4615</span></a>  <span class="comment">     * @param  \core\event\course_completed $event</span>
<a name="l4616"><span class="linenum">4616</span></a>  <span class="comment">     * @return void</span>
<a name="l4617"><span class="linenum">4617</span></a>  <span class="comment">     */</span>
<a name="l4618"><span class="linenum">4618</span></a>      public static function <a class="function" onClick="logFunction('observe_course_completed')" href="../../_functions/observe_course_completed.html" onMouseOver="funcPopup(event,'observe_course_completed')">observe_course_completed</a>(\core\event\course_completed <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>) {
<a name="l4619"><span class="linenum">4619</span></a>          if (!static::<a class="function" onClick="logFunction('is_enabled')" href="../../_functions/is_enabled.html" onMouseOver="funcPopup(event,'is_enabled')">is_enabled</a>()) {
<a name="l4620"><span class="linenum">4620</span></a>              return;
<a name="l4621"><span class="linenum">4621</span></a>          }
<a name="l4622"><span class="linenum">4622</span></a>  
<a name="l4623"><span class="linenum">4623</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'courseid = :courseid AND ruleoutcome != :nooutcome';
<a name="l4624"><span class="linenum">4624</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = array(
<a name="l4625"><span class="linenum">4625</span></a>              'courseid' =&gt; <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('courseid')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>,
<a name="l4626"><span class="linenum">4626</span></a>              'nooutcome' =&gt; <a class="class" onClick="logClass('course_competency')" href="../../_classes/course_competency.html" onMouseOver="classPopup(event,'course_competency')">course_competency</a>::OUTCOME_NONE
<a name="l4627"><span class="linenum">4627</span></a>          );
<a name="l4628"><span class="linenum">4628</span></a>          <a class="var it9650" onMouseOver="hilite(9650)" onMouseOut="lolite()" onClick="logVariable('coursecompetencies')" href="../../_variables/coursecompetencies.html">$coursecompetencies</a> = <a class="class" onClick="logClass('course_competency')" href="../../_classes/course_competency.html" onMouseOver="classPopup(event,'course_competency')">course_competency</a>::<a class="function" onClick="logFunction('get_records_select')" href="../../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l4629"><span class="linenum">4629</span></a>  
<a name="l4630"><span class="linenum">4630</span></a>          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a> = <a class="function" onClick="logFunction('get_course')" href="../../_functions/get_course.html" onMouseOver="funcPopup(event,'get_course')">get_course</a>(<a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('courseid')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/courseid.html">courseid</a>);
<a name="l4631"><span class="linenum">4631</span></a>          <a class="var it8904" onMouseOver="hilite(8904)" onMouseOut="lolite()" onClick="logVariable('courseshortname')" href="../../_variables/courseshortname.html">$courseshortname</a> = <a class="function" onClick="logFunction('format_string')" href="../../_functions/format_string.html" onMouseOver="funcPopup(event,'format_string')">format_string</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('shortname')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/shortname.html">shortname</a>, null, array('context' =&gt; <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('contextid')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>));
<a name="l4632"><span class="linenum">4632</span></a>  
<a name="l4633"><span class="linenum">4633</span></a>          foreach (<a class="var it9650" onMouseOver="hilite(9650)" onMouseOut="lolite()" onClick="logVariable('coursecompetencies')" href="../../_variables/coursecompetencies.html">$coursecompetencies</a> as <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>) {
<a name="l4634"><span class="linenum">4634</span></a>  
<a name="l4635"><span class="linenum">4635</span></a>              <a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../_variables/outcome.html">$outcome</a> = <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>-&gt;get_ruleoutcome();
<a name="l4636"><span class="linenum">4636</span></a>              <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> = null;
<a name="l4637"><span class="linenum">4637</span></a>              <a class="var it25028" onMouseOver="hilite(25028)" onMouseOut="lolite()" onClick="logVariable('recommend')" href="../../_variables/recommend.html">$recommend</a> = false;
<a name="l4638"><span class="linenum">4638</span></a>              <a class="var it30491" onMouseOver="hilite(30491)" onMouseOut="lolite()" onClick="logVariable('strdesc')" href="../../_variables/strdesc.html">$strdesc</a> = 'evidence_coursecompleted';
<a name="l4639"><span class="linenum">4639</span></a>  
<a name="l4640"><span class="linenum">4640</span></a>              if (<a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../_variables/outcome.html">$outcome</a> == <a class="class" onClick="logClass('course_competency')" href="../../_classes/course_competency.html" onMouseOver="classPopup(event,'course_competency')">course_competency</a>::OUTCOME_EVIDENCE) {
<a name="l4641"><span class="linenum">4641</span></a>                  <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> = <a class="class" onClick="logClass('evidence')" href="../../_classes/evidence.html" onMouseOver="classPopup(event,'evidence')">evidence</a>::ACTION_LOG;
<a name="l4642"><span class="linenum">4642</span></a>  
<a name="l4643"><span class="linenum">4643</span></a>              } else if (<a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../_variables/outcome.html">$outcome</a> == <a class="class" onClick="logClass('course_competency')" href="../../_classes/course_competency.html" onMouseOver="classPopup(event,'course_competency')">course_competency</a>::OUTCOME_RECOMMEND) {
<a name="l4644"><span class="linenum">4644</span></a>                  <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> = <a class="class" onClick="logClass('evidence')" href="../../_classes/evidence.html" onMouseOver="classPopup(event,'evidence')">evidence</a>::ACTION_LOG;
<a name="l4645"><span class="linenum">4645</span></a>                  <a class="var it25028" onMouseOver="hilite(25028)" onMouseOut="lolite()" onClick="logVariable('recommend')" href="../../_variables/recommend.html">$recommend</a> = true;
<a name="l4646"><span class="linenum">4646</span></a>  
<a name="l4647"><span class="linenum">4647</span></a>              } else if (<a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../_variables/outcome.html">$outcome</a> == <a class="class" onClick="logClass('course_competency')" href="../../_classes/course_competency.html" onMouseOver="classPopup(event,'course_competency')">course_competency</a>::OUTCOME_COMPLETE) {
<a name="l4648"><span class="linenum">4648</span></a>                  <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> = <a class="class" onClick="logClass('evidence')" href="../../_classes/evidence.html" onMouseOver="classPopup(event,'evidence')">evidence</a>::ACTION_COMPLETE;
<a name="l4649"><span class="linenum">4649</span></a>  
<a name="l4650"><span class="linenum">4650</span></a>              } else {
<a name="l4651"><span class="linenum">4651</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('Unexpected rule outcome: ' + <a class="var it3376" onMouseOver="hilite(3376)" onMouseOut="lolite()" onClick="logVariable('outcome')" href="../../_variables/outcome.html">$outcome</a>);
<a name="l4652"><span class="linenum">4652</span></a>              }
<a name="l4653"><span class="linenum">4653</span></a>  
<a name="l4654"><span class="linenum">4654</span></a>              static::<a class="function" onClick="logFunction('add_evidence')" href="../../_functions/add_evidence.html" onMouseOver="funcPopup(event,'add_evidence')">add_evidence</a>(
<a name="l4655"><span class="linenum">4655</span></a>                  <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('relateduserid')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/relateduserid.html">relateduserid</a>,
<a name="l4656"><span class="linenum">4656</span></a>                  <a class="var it9654" onMouseOver="hilite(9654)" onMouseOut="lolite()" onClick="logVariable('coursecompetency')" href="../../_variables/coursecompetency.html">$coursecompetency</a>-&gt;get_competencyid(),
<a name="l4657"><span class="linenum">4657</span></a>                  <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a onClick="logVariable('contextid')" class="var it42950" onMouseOver="hilite(42950)" onMouseOut="lolite()" href="../../_variables/contextid.html">contextid</a>,
<a name="l4658"><span class="linenum">4658</span></a>                  <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a>,
<a name="l4659"><span class="linenum">4659</span></a>                  <a class="var it30491" onMouseOver="hilite(30491)" onMouseOut="lolite()" onClick="logVariable('strdesc')" href="../../_variables/strdesc.html">$strdesc</a>,
<a name="l4660"><span class="linenum">4660</span></a>                  'core_competency',
<a name="l4661"><span class="linenum">4661</span></a>                  <a class="var it8904" onMouseOver="hilite(8904)" onMouseOut="lolite()" onClick="logVariable('courseshortname')" href="../../_variables/courseshortname.html">$courseshortname</a>,
<a name="l4662"><span class="linenum">4662</span></a>                  <a class="var it25028" onMouseOver="hilite(25028)" onMouseOut="lolite()" onClick="logVariable('recommend')" href="../../_variables/recommend.html">$recommend</a>,
<a name="l4663"><span class="linenum">4663</span></a>                  <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('get_url')" href="../../_functions/get_url.html" onMouseOver="funcPopup(event,'get_url')">get_url</a>()
<a name="l4664"><span class="linenum">4664</span></a>              );
<a name="l4665"><span class="linenum">4665</span></a>          }
<a name="l4666"><span class="linenum">4666</span></a>      }
<a name="l4667"><span class="linenum">4667</span></a>  
<a name="l4668"><span class="linenum">4668</span></a>      <span class="comment">/**</span>
<a name="l4669"><span class="linenum">4669</span></a>  <span class="comment">     * Action to perform when a course module is deleted.</span>
<a name="l4670"><span class="linenum">4670</span></a>  <span class="comment">     *</span>
<a name="l4671"><span class="linenum">4671</span></a>  <span class="comment">     * Do not call this directly, this is reserved for core use.</span>
<a name="l4672"><span class="linenum">4672</span></a>  <span class="comment">     *</span>
<a name="l4673"><span class="linenum">4673</span></a>  <span class="comment">     * @param stdClass $cm The CM object.</span>
<a name="l4674"><span class="linenum">4674</span></a>  <span class="comment">     * @return void</span>
<a name="l4675"><span class="linenum">4675</span></a>  <span class="comment">     */</span>
<a name="l4676"><span class="linenum">4676</span></a>      public static function <a class="function" onClick="logFunction('hook_course_module_deleted')" href="../../_functions/hook_course_module_deleted.html" onMouseOver="funcPopup(event,'hook_course_module_deleted')">hook_course_module_deleted</a>(stdClass <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>) {
<a name="l4677"><span class="linenum">4677</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l4678"><span class="linenum">4678</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>(<a class="class" onClick="logClass('course_module_competency')" href="../../_classes/course_module_competency.html" onMouseOver="classPopup(event,'course_module_competency')">course_module_competency</a>::TABLE, array('cmid' =&gt; <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('cm')" href="../../_variables/cm.html">$cm</a>-&gt;<a onClick="logVariable('id')" class="var it42905" onMouseOver="hilite(42905)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l4679"><span class="linenum">4679</span></a>      }
<a name="l4680"><span class="linenum">4680</span></a>  
<a name="l4681"><span class="linenum">4681</span></a>      <span class="comment">/**</span>
<a name="l4682"><span class="linenum">4682</span></a>  <span class="comment">     * Action to perform when a course is deleted.</span>
<a name="l4683"><span class="linenum">4683</span></a>  <span class="comment">     *</span>
<a name="l4684"><span class="linenum">4684</span></a>  <span class="comment">     * Do not call this directly, this is reserved for core use.</span>
<a name="l4685"><span class="linenum">4685</span></a>  <span class="comment">     *</span>
<a name="l4686"><span class="linenum">4686</span></a>  <span class="comment">     * @param stdClass $course The course object.</span>
<a name="l4687"><span class="linenum">4687</span></a>  <span class="comment">     * @return void</span>
<a name="l4688"><span class="linenum">4688</span></a>  <span class="comment">     */</span>
<a name="l4689"><span class="linenum">4689</span></a>      public static function <a class="function" onClick="logFunction('hook_course_deleted')" href="../../_functions/hook_course_deleted.html" onMouseOver="funcPopup(event,'hook_course_deleted')">hook_course_deleted</a>(stdClass <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>) {
<a name="l4690"><span class="linenum">4690</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l4691"><span class="linenum">4691</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>(<a class="class" onClick="logClass('course_competency')" href="../../_classes/course_competency.html" onMouseOver="classPopup(event,'course_competency')">course_competency</a>::TABLE, array('courseid' =&gt; <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l4692"><span class="linenum">4692</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>(<a class="class" onClick="logClass('course_competency_settings')" href="../../_classes/course_competency_settings.html" onMouseOver="classPopup(event,'course_competency_settings')">course_competency_settings</a>::TABLE, array('courseid' =&gt; <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l4693"><span class="linenum">4693</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>(<a class="class" onClick="logClass('user_competency_course')" href="../../_classes/user_competency_course.html" onMouseOver="classPopup(event,'user_competency_course')">user_competency_course</a>::TABLE, array('courseid' =&gt; <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l4694"><span class="linenum">4694</span></a>      }
<a name="l4695"><span class="linenum">4695</span></a>  
<a name="l4696"><span class="linenum">4696</span></a>      <span class="comment">/**</span>
<a name="l4697"><span class="linenum">4697</span></a>  <span class="comment">     * Action to perform when a course is being reset.</span>
<a name="l4698"><span class="linenum">4698</span></a>  <span class="comment">     *</span>
<a name="l4699"><span class="linenum">4699</span></a>  <span class="comment">     * Do not call this directly, this is reserved for core use.</span>
<a name="l4700"><span class="linenum">4700</span></a>  <span class="comment">     *</span>
<a name="l4701"><span class="linenum">4701</span></a>  <span class="comment">     * @param int $courseid The course ID.</span>
<a name="l4702"><span class="linenum">4702</span></a>  <span class="comment">     * @return void</span>
<a name="l4703"><span class="linenum">4703</span></a>  <span class="comment">     */</span>
<a name="l4704"><span class="linenum">4704</span></a>      public static function <a class="function" onClick="logFunction('hook_course_reset_competency_ratings')" href="../../_functions/hook_course_reset_competency_ratings.html" onMouseOver="funcPopup(event,'hook_course_reset_competency_ratings')">hook_course_reset_competency_ratings</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>) {
<a name="l4705"><span class="linenum">4705</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l4706"><span class="linenum">4706</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>(<a class="class" onClick="logClass('user_competency_course')" href="../../_classes/user_competency_course.html" onMouseOver="classPopup(event,'user_competency_course')">user_competency_course</a>::TABLE, array('courseid' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>));
<a name="l4707"><span class="linenum">4707</span></a>      }
<a name="l4708"><span class="linenum">4708</span></a>  
<a name="l4709"><span class="linenum">4709</span></a>      <span class="comment">/**</span>
<a name="l4710"><span class="linenum">4710</span></a>  <span class="comment">     * Action to perform when a cohort is deleted.</span>
<a name="l4711"><span class="linenum">4711</span></a>  <span class="comment">     *</span>
<a name="l4712"><span class="linenum">4712</span></a>  <span class="comment">     * Do not call this directly, this is reserved for core use.</span>
<a name="l4713"><span class="linenum">4713</span></a>  <span class="comment">     *</span>
<a name="l4714"><span class="linenum">4714</span></a>  <span class="comment">     * @param \stdClass $cohort The cohort object.</span>
<a name="l4715"><span class="linenum">4715</span></a>  <span class="comment">     * @return void</span>
<a name="l4716"><span class="linenum">4716</span></a>  <span class="comment">     */</span>
<a name="l4717"><span class="linenum">4717</span></a>      public static function <a class="function" onClick="logFunction('hook_cohort_deleted')" href="../../_functions/hook_cohort_deleted.html" onMouseOver="funcPopup(event,'hook_cohort_deleted')">hook_cohort_deleted</a>(\stdClass <a class="var it7758" onMouseOver="hilite(7758)" onMouseOut="lolite()" onClick="logVariable('cohort')" href="../../_variables/cohort.html">$cohort</a>) {
<a name="l4718"><span class="linenum">4718</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l4719"><span class="linenum">4719</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>(<a class="class" onClick="logClass('template_cohort')" href="../../_classes/template_cohort.html" onMouseOver="classPopup(event,'template_cohort')">template_cohort</a>::TABLE, array('cohortid' =&gt; <a class="var it7758" onMouseOver="hilite(7758)" onMouseOut="lolite()" onClick="logVariable('cohort')" href="../../_variables/cohort.html">$cohort</a>-&gt;<a onClick="logVariable('id')" class="var it43123" onMouseOver="hilite(43123)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>));
<a name="l4720"><span class="linenum">4720</span></a>      }
<a name="l4721"><span class="linenum">4721</span></a>  
<a name="l4722"><span class="linenum">4722</span></a>      <span class="comment">/**</span>
<a name="l4723"><span class="linenum">4723</span></a>  <span class="comment">     * Manually grade a user competency.</span>
<a name="l4724"><span class="linenum">4724</span></a>  <span class="comment">     *</span>
<a name="l4725"><span class="linenum">4725</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l4726"><span class="linenum">4726</span></a>  <span class="comment">     * @param int $competencyid</span>
<a name="l4727"><span class="linenum">4727</span></a>  <span class="comment">     * @param int $grade</span>
<a name="l4728"><span class="linenum">4728</span></a>  <span class="comment">     * @param string $note A note to attach to the evidence</span>
<a name="l4729"><span class="linenum">4729</span></a>  <span class="comment">     * @return array of \core_competency\user_competency</span>
<a name="l4730"><span class="linenum">4730</span></a>  <span class="comment">     */</span>
<a name="l4731"><span class="linenum">4731</span></a>      public static function <a class="function" onClick="logFunction('grade_competency')" href="../../_functions/grade_competency.html" onMouseOver="funcPopup(event,'grade_competency')">grade_competency</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>, <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>, <a class="var it6990" onMouseOver="hilite(6990)" onMouseOut="lolite()" onClick="logVariable('note')" href="../../_variables/note.html">$note</a> = null) {
<a name="l4732"><span class="linenum">4732</span></a>          global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l4733"><span class="linenum">4733</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l4734"><span class="linenum">4734</span></a>  
<a name="l4735"><span class="linenum">4735</span></a>          <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> = static::<a class="function" onClick="logFunction('get_user_competency')" href="../../_functions/get_user_competency.html" onMouseOver="funcPopup(event,'get_user_competency')">get_user_competency</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l4736"><span class="linenum">4736</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>();
<a name="l4737"><span class="linenum">4737</span></a>          if (!<a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('can_grade_user')" href="../../_functions/can_grade_user.html" onMouseOver="funcPopup(event,'can_grade_user')">can_grade_user</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>())) {
<a name="l4738"><span class="linenum">4738</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:competencygrade', 'nopermissions', '');
<a name="l4739"><span class="linenum">4739</span></a>          }
<a name="l4740"><span class="linenum">4740</span></a>  
<a name="l4741"><span class="linenum">4741</span></a>  <span class="comment">        // Throws exception if competency not in plan.</span>
<a name="l4742"><span class="linenum">4742</span></a>          <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('get_competency')" href="../../_functions/get_competency.html" onMouseOver="funcPopup(event,'get_competency')">get_competency</a>();
<a name="l4743"><span class="linenum">4743</span></a>          <a class="var it30492" onMouseOver="hilite(30492)" onMouseOut="lolite()" onClick="logVariable('competencycontext')" href="../../_variables/competencycontext.html">$competencycontext</a> = <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>();
<a name="l4744"><span class="linenum">4744</span></a>          if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(array('moodle/competency:competencyview', 'moodle/competency:competencymanage'),
<a name="l4745"><span class="linenum">4745</span></a>                  <a class="var it30492" onMouseOver="hilite(30492)" onMouseOut="lolite()" onClick="logVariable('competencycontext')" href="../../_variables/competencycontext.html">$competencycontext</a>)) {
<a name="l4746"><span class="linenum">4746</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it30492" onMouseOver="hilite(30492)" onMouseOut="lolite()" onClick="logVariable('competencycontext')" href="../../_variables/competencycontext.html">$competencycontext</a>, 'moodle/competency:competencyview', 'nopermissions', '');
<a name="l4747"><span class="linenum">4747</span></a>          }
<a name="l4748"><span class="linenum">4748</span></a>  
<a name="l4749"><span class="linenum">4749</span></a>          <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> = <a class="class" onClick="logClass('evidence')" href="../../_classes/evidence.html" onMouseOver="classPopup(event,'evidence')">evidence</a>::ACTION_OVERRIDE;
<a name="l4750"><span class="linenum">4750</span></a>          <a class="var it30493" onMouseOver="hilite(30493)" onMouseOut="lolite()" onClick="logVariable('desckey')" href="../../_variables/desckey.html">$desckey</a> = 'evidence_manualoverride';
<a name="l4751"><span class="linenum">4751</span></a>  
<a name="l4752"><span class="linenum">4752</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = self::<a class="function" onClick="logFunction('add_evidence')" href="../../_functions/add_evidence.html" onMouseOver="funcPopup(event,'add_evidence')">add_evidence</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>(),
<a name="l4753"><span class="linenum">4753</span></a>                                    <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>,
<a name="l4754"><span class="linenum">4754</span></a>                                    <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l4755"><span class="linenum">4755</span></a>                                    <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a>,
<a name="l4756"><span class="linenum">4756</span></a>                                    <a class="var it30493" onMouseOver="hilite(30493)" onMouseOut="lolite()" onClick="logVariable('desckey')" href="../../_variables/desckey.html">$desckey</a>,
<a name="l4757"><span class="linenum">4757</span></a>                                    'core_competency',
<a name="l4758"><span class="linenum">4758</span></a>                                    null,
<a name="l4759"><span class="linenum">4759</span></a>                                    false,
<a name="l4760"><span class="linenum">4760</span></a>                                    null,
<a name="l4761"><span class="linenum">4761</span></a>                                    <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>,
<a name="l4762"><span class="linenum">4762</span></a>                                    <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l4763"><span class="linenum">4763</span></a>                                    <a class="var it6990" onMouseOver="hilite(6990)" onMouseOut="lolite()" onClick="logVariable('note')" href="../../_variables/note.html">$note</a>);
<a name="l4764"><span class="linenum">4764</span></a>          if (<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>) {
<a name="l4765"><span class="linenum">4765</span></a>              <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>-&gt;<a class="function" onClick="logFunction('read')" href="../../_functions/read.html" onMouseOver="funcPopup(event,'read')">read</a>();
<a name="l4766"><span class="linenum">4766</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('competency_user_competency_rated')" href="../../_classes/competency_user_competency_rated.html" onMouseOver="classPopup(event,'competency_user_competency_rated')">competency_user_competency_rated</a>::<a class="function" onClick="logFunction('create_from_user_competency')" href="../../_functions/create_from_user_competency.html" onMouseOver="funcPopup(event,'create_from_user_competency')">create_from_user_competency</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>);
<a name="l4767"><span class="linenum">4767</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l4768"><span class="linenum">4768</span></a>          }
<a name="l4769"><span class="linenum">4769</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l4770"><span class="linenum">4770</span></a>      }
<a name="l4771"><span class="linenum">4771</span></a>  
<a name="l4772"><span class="linenum">4772</span></a>      <span class="comment">/**</span>
<a name="l4773"><span class="linenum">4773</span></a>  <span class="comment">     * Manually grade a user competency from the plans page.</span>
<a name="l4774"><span class="linenum">4774</span></a>  <span class="comment">     *</span>
<a name="l4775"><span class="linenum">4775</span></a>  <span class="comment">     * @param mixed $planorid</span>
<a name="l4776"><span class="linenum">4776</span></a>  <span class="comment">     * @param int $competencyid</span>
<a name="l4777"><span class="linenum">4777</span></a>  <span class="comment">     * @param int $grade</span>
<a name="l4778"><span class="linenum">4778</span></a>  <span class="comment">     * @param string $note A note to attach to the evidence</span>
<a name="l4779"><span class="linenum">4779</span></a>  <span class="comment">     * @return array of \core_competency\user_competency</span>
<a name="l4780"><span class="linenum">4780</span></a>  <span class="comment">     */</span>
<a name="l4781"><span class="linenum">4781</span></a>      public static function <a class="function" onClick="logFunction('grade_competency_in_plan')" href="../../_functions/grade_competency_in_plan.html" onMouseOver="funcPopup(event,'grade_competency_in_plan')">grade_competency_in_plan</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>, <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>, <a class="var it6990" onMouseOver="hilite(6990)" onMouseOut="lolite()" onClick="logVariable('note')" href="../../_variables/note.html">$note</a> = null) {
<a name="l4782"><span class="linenum">4782</span></a>          global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>;
<a name="l4783"><span class="linenum">4783</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l4784"><span class="linenum">4784</span></a>  
<a name="l4785"><span class="linenum">4785</span></a>          <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>;
<a name="l4786"><span class="linenum">4786</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>)) {
<a name="l4787"><span class="linenum">4787</span></a>              <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a> = <span class="keyword">new </span><a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>(<a class="var it30463" onMouseOver="hilite(30463)" onMouseOut="lolite()" onClick="logVariable('planorid')" href="../../_variables/planorid.html">$planorid</a>);
<a name="l4788"><span class="linenum">4788</span></a>          }
<a name="l4789"><span class="linenum">4789</span></a>  
<a name="l4790"><span class="linenum">4790</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>();
<a name="l4791"><span class="linenum">4791</span></a>          if (!<a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('can_grade_user')" href="../../_functions/can_grade_user.html" onMouseOver="funcPopup(event,'can_grade_user')">can_grade_user</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>())) {
<a name="l4792"><span class="linenum">4792</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:competencygrade', 'nopermissions', '');
<a name="l4793"><span class="linenum">4793</span></a>          }
<a name="l4794"><span class="linenum">4794</span></a>  
<a name="l4795"><span class="linenum">4795</span></a>  <span class="comment">        // Throws exception if competency not in plan.</span>
<a name="l4796"><span class="linenum">4796</span></a>          <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_competency')" href="../../_functions/get_competency.html" onMouseOver="funcPopup(event,'get_competency')">get_competency</a>(<a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l4797"><span class="linenum">4797</span></a>          <a class="var it30492" onMouseOver="hilite(30492)" onMouseOut="lolite()" onClick="logVariable('competencycontext')" href="../../_variables/competencycontext.html">$competencycontext</a> = <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>();
<a name="l4798"><span class="linenum">4798</span></a>          if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(array('moodle/competency:competencyview', 'moodle/competency:competencymanage'),
<a name="l4799"><span class="linenum">4799</span></a>                  <a class="var it30492" onMouseOver="hilite(30492)" onMouseOut="lolite()" onClick="logVariable('competencycontext')" href="../../_variables/competencycontext.html">$competencycontext</a>)) {
<a name="l4800"><span class="linenum">4800</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it30492" onMouseOver="hilite(30492)" onMouseOut="lolite()" onClick="logVariable('competencycontext')" href="../../_variables/competencycontext.html">$competencycontext</a>, 'moodle/competency:competencyview', 'nopermissions', '');
<a name="l4801"><span class="linenum">4801</span></a>          }
<a name="l4802"><span class="linenum">4802</span></a>  
<a name="l4803"><span class="linenum">4803</span></a>          <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> = <a class="class" onClick="logClass('evidence')" href="../../_classes/evidence.html" onMouseOver="classPopup(event,'evidence')">evidence</a>::ACTION_OVERRIDE;
<a name="l4804"><span class="linenum">4804</span></a>          <a class="var it30493" onMouseOver="hilite(30493)" onMouseOut="lolite()" onClick="logVariable('desckey')" href="../../_variables/desckey.html">$desckey</a> = 'evidence_manualoverrideinplan';
<a name="l4805"><span class="linenum">4805</span></a>  
<a name="l4806"><span class="linenum">4806</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = self::<a class="function" onClick="logFunction('add_evidence')" href="../../_functions/add_evidence.html" onMouseOver="funcPopup(event,'add_evidence')">add_evidence</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>(),
<a name="l4807"><span class="linenum">4807</span></a>                                    <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>,
<a name="l4808"><span class="linenum">4808</span></a>                                    <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l4809"><span class="linenum">4809</span></a>                                    <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a>,
<a name="l4810"><span class="linenum">4810</span></a>                                    <a class="var it30493" onMouseOver="hilite(30493)" onMouseOut="lolite()" onClick="logVariable('desckey')" href="../../_variables/desckey.html">$desckey</a>,
<a name="l4811"><span class="linenum">4811</span></a>                                    'core_competency',
<a name="l4812"><span class="linenum">4812</span></a>                                    <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>(),
<a name="l4813"><span class="linenum">4813</span></a>                                    false,
<a name="l4814"><span class="linenum">4814</span></a>                                    null,
<a name="l4815"><span class="linenum">4815</span></a>                                    <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>,
<a name="l4816"><span class="linenum">4816</span></a>                                    <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l4817"><span class="linenum">4817</span></a>                                    <a class="var it6990" onMouseOver="hilite(6990)" onMouseOut="lolite()" onClick="logVariable('note')" href="../../_variables/note.html">$note</a>);
<a name="l4818"><span class="linenum">4818</span></a>          if (<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>) {
<a name="l4819"><span class="linenum">4819</span></a>              <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> = static::<a class="function" onClick="logFunction('get_user_competency')" href="../../_functions/get_user_competency.html" onMouseOver="funcPopup(event,'get_user_competency')">get_user_competency</a>(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_userid')" href="../../_functions/get_userid.html" onMouseOver="funcPopup(event,'get_userid')">get_userid</a>(), <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>());
<a name="l4820"><span class="linenum">4820</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('competency_user_competency_rated_in_plan')" href="../../_classes/competency_user_competency_rated_in_plan.html" onMouseOver="classPopup(event,'competency_user_competency_rated_in_plan')">competency_user_competency_rated_in_plan</a>::<a class="function" onClick="logFunction('create_from_user_competency')" href="../../_functions/create_from_user_competency.html" onMouseOver="funcPopup(event,'create_from_user_competency')">create_from_user_competency</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>, <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('plan')" href="../../_variables/plan.html">$plan</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>());
<a name="l4821"><span class="linenum">4821</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l4822"><span class="linenum">4822</span></a>          }
<a name="l4823"><span class="linenum">4823</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l4824"><span class="linenum">4824</span></a>      }
<a name="l4825"><span class="linenum">4825</span></a>  
<a name="l4826"><span class="linenum">4826</span></a>      <span class="comment">/**</span>
<a name="l4827"><span class="linenum">4827</span></a>  <span class="comment">     * Manually grade a user course competency from the course page.</span>
<a name="l4828"><span class="linenum">4828</span></a>  <span class="comment">     *</span>
<a name="l4829"><span class="linenum">4829</span></a>  <span class="comment">     * This may push the rating to the user competency</span>
<a name="l4830"><span class="linenum">4830</span></a>  <span class="comment">     * if the course is configured this way.</span>
<a name="l4831"><span class="linenum">4831</span></a>  <span class="comment">     *</span>
<a name="l4832"><span class="linenum">4832</span></a>  <span class="comment">     * @param mixed $courseorid</span>
<a name="l4833"><span class="linenum">4833</span></a>  <span class="comment">     * @param int $userid</span>
<a name="l4834"><span class="linenum">4834</span></a>  <span class="comment">     * @param int $competencyid</span>
<a name="l4835"><span class="linenum">4835</span></a>  <span class="comment">     * @param int $grade</span>
<a name="l4836"><span class="linenum">4836</span></a>  <span class="comment">     * @param string $note A note to attach to the evidence</span>
<a name="l4837"><span class="linenum">4837</span></a>  <span class="comment">     * @return array of \core_competency\user_competency</span>
<a name="l4838"><span class="linenum">4838</span></a>  <span class="comment">     */</span>
<a name="l4839"><span class="linenum">4839</span></a>      public static function <a class="function" onClick="logFunction('grade_competency_in_course')" href="../../_functions/grade_competency_in_course.html" onMouseOver="funcPopup(event,'grade_competency_in_course')">grade_competency_in_course</a>(<a class="var it11871" onMouseOver="hilite(11871)" onMouseOut="lolite()" onClick="logVariable('courseorid')" href="../../_variables/courseorid.html">$courseorid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>, <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>, <a class="var it6990" onMouseOver="hilite(6990)" onMouseOut="lolite()" onClick="logVariable('note')" href="../../_variables/note.html">$note</a> = null) {
<a name="l4840"><span class="linenum">4840</span></a>          global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l4841"><span class="linenum">4841</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l4842"><span class="linenum">4842</span></a>  
<a name="l4843"><span class="linenum">4843</span></a>          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a> = <a class="var it11871" onMouseOver="hilite(11871)" onMouseOut="lolite()" onClick="logVariable('courseorid')" href="../../_variables/courseorid.html">$courseorid</a>;
<a name="l4844"><span class="linenum">4844</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it11871" onMouseOver="hilite(11871)" onMouseOut="lolite()" onClick="logVariable('courseorid')" href="../../_variables/courseorid.html">$courseorid</a>)) {
<a name="l4845"><span class="linenum">4845</span></a>              <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('course', array('id' =&gt; <a class="var it11871" onMouseOver="hilite(11871)" onMouseOut="lolite()" onClick="logVariable('courseorid')" href="../../_variables/courseorid.html">$courseorid</a>));
<a name="l4846"><span class="linenum">4846</span></a>          }
<a name="l4847"><span class="linenum">4847</span></a>          <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>);
<a name="l4848"><span class="linenum">4848</span></a>  
<a name="l4849"><span class="linenum">4849</span></a>  <span class="comment">        // Check that we can view the user competency details in the course.</span>
<a name="l4850"><span class="linenum">4850</span></a>          if (!<a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('can_read_user_in_course')" href="../../_functions/can_read_user_in_course.html" onMouseOver="funcPopup(event,'can_read_user_in_course')">can_read_user_in_course</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l4851"><span class="linenum">4851</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:usercompetencyview', 'nopermissions', '');
<a name="l4852"><span class="linenum">4852</span></a>          }
<a name="l4853"><span class="linenum">4853</span></a>  
<a name="l4854"><span class="linenum">4854</span></a>  <span class="comment">        // Validate the permission to grade.</span>
<a name="l4855"><span class="linenum">4855</span></a>          if (!<a class="class" onClick="logClass('user_competency')" href="../../_classes/user_competency.html" onMouseOver="classPopup(event,'user_competency')">user_competency</a>::<a class="function" onClick="logFunction('can_grade_user_in_course')" href="../../_functions/can_grade_user_in_course.html" onMouseOver="funcPopup(event,'can_grade_user_in_course')">can_grade_user_in_course</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>)) {
<a name="l4856"><span class="linenum">4856</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:competencygrade', 'nopermissions', '');
<a name="l4857"><span class="linenum">4857</span></a>          }
<a name="l4858"><span class="linenum">4858</span></a>  
<a name="l4859"><span class="linenum">4859</span></a>  <span class="comment">        // Check that competency is in course and visible to the current user.</span>
<a name="l4860"><span class="linenum">4860</span></a>          <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a> = <a class="class" onClick="logClass('course_competency')" href="../../_classes/course_competency.html" onMouseOver="classPopup(event,'course_competency')">course_competency</a>::<a class="function" onClick="logFunction('get_competency')" href="../../_functions/get_competency.html" onMouseOver="funcPopup(event,'get_competency')">get_competency</a>(<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, <a class="var it8525" onMouseOver="hilite(8525)" onMouseOut="lolite()" onClick="logVariable('competencyid')" href="../../_variables/competencyid.html">$competencyid</a>);
<a name="l4861"><span class="linenum">4861</span></a>          <a class="var it30492" onMouseOver="hilite(30492)" onMouseOut="lolite()" onClick="logVariable('competencycontext')" href="../../_variables/competencycontext.html">$competencycontext</a> = <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>();
<a name="l4862"><span class="linenum">4862</span></a>          if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(array('moodle/competency:competencyview', 'moodle/competency:competencymanage'),
<a name="l4863"><span class="linenum">4863</span></a>                  <a class="var it30492" onMouseOver="hilite(30492)" onMouseOut="lolite()" onClick="logVariable('competencycontext')" href="../../_variables/competencycontext.html">$competencycontext</a>)) {
<a name="l4864"><span class="linenum">4864</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it30492" onMouseOver="hilite(30492)" onMouseOut="lolite()" onClick="logVariable('competencycontext')" href="../../_variables/competencycontext.html">$competencycontext</a>, 'moodle/competency:competencyview', 'nopermissions', '');
<a name="l4865"><span class="linenum">4865</span></a>          }
<a name="l4866"><span class="linenum">4866</span></a>  
<a name="l4867"><span class="linenum">4867</span></a>  <span class="comment">        // Check that the user is enrolled in the course, and is &quot;gradable&quot;.</span>
<a name="l4868"><span class="linenum">4868</span></a>          if (!<a class="function" onClick="logFunction('is_enrolled')" href="../../_functions/is_enrolled.html" onMouseOver="funcPopup(event,'is_enrolled')">is_enrolled</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, 'moodle/competency:coursecompetencygradable')) {
<a name="l4869"><span class="linenum">4869</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('The competency may not be rated at this time.');
<a name="l4870"><span class="linenum">4870</span></a>          }
<a name="l4871"><span class="linenum">4871</span></a>  
<a name="l4872"><span class="linenum">4872</span></a>          <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> = <a class="class" onClick="logClass('evidence')" href="../../_classes/evidence.html" onMouseOver="classPopup(event,'evidence')">evidence</a>::ACTION_OVERRIDE;
<a name="l4873"><span class="linenum">4873</span></a>          <a class="var it30493" onMouseOver="hilite(30493)" onMouseOut="lolite()" onClick="logVariable('desckey')" href="../../_variables/desckey.html">$desckey</a> = 'evidence_manualoverrideincourse';
<a name="l4874"><span class="linenum">4874</span></a>  
<a name="l4875"><span class="linenum">4875</span></a>          <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = self::<a class="function" onClick="logFunction('add_evidence')" href="../../_functions/add_evidence.html" onMouseOver="funcPopup(event,'add_evidence')">add_evidence</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>,
<a name="l4876"><span class="linenum">4876</span></a>                                    <a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>,
<a name="l4877"><span class="linenum">4877</span></a>                                    <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a onClick="logVariable('id')" class="var it42918" onMouseOver="hilite(42918)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l4878"><span class="linenum">4878</span></a>                                    <a class="var it280" onMouseOver="hilite(280)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a>,
<a name="l4879"><span class="linenum">4879</span></a>                                    <a class="var it30493" onMouseOver="hilite(30493)" onMouseOut="lolite()" onClick="logVariable('desckey')" href="../../_variables/desckey.html">$desckey</a>,
<a name="l4880"><span class="linenum">4880</span></a>                                    'core_competency',
<a name="l4881"><span class="linenum">4881</span></a>                                    <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>-&gt;<a class="function" onClick="logFunction('get_context_name')" href="../../_functions/get_context_name.html" onMouseOver="funcPopup(event,'get_context_name')">get_context_name</a>(),
<a name="l4882"><span class="linenum">4882</span></a>                                    false,
<a name="l4883"><span class="linenum">4883</span></a>                                    null,
<a name="l4884"><span class="linenum">4884</span></a>                                    <a class="var it288" onMouseOver="hilite(288)" onMouseOut="lolite()" onClick="logVariable('grade')" href="../../_variables/grade.html">$grade</a>,
<a name="l4885"><span class="linenum">4885</span></a>                                    <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>,
<a name="l4886"><span class="linenum">4886</span></a>                                    <a class="var it6990" onMouseOver="hilite(6990)" onMouseOut="lolite()" onClick="logVariable('note')" href="../../_variables/note.html">$note</a>);
<a name="l4887"><span class="linenum">4887</span></a>          if (<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>) {
<a name="l4888"><span class="linenum">4888</span></a>              <a class="var it5375" onMouseOver="hilite(5375)" onMouseOut="lolite()" onClick="logVariable('all')" href="../../_variables/all.html">$all</a> = <a class="class" onClick="logClass('user_competency_course')" href="../../_classes/user_competency_course.html" onMouseOver="classPopup(event,'user_competency_course')">user_competency_course</a>::<a class="function" onClick="logFunction('get_multiple')" href="../../_functions/get_multiple.html" onMouseOver="funcPopup(event,'get_multiple')">get_multiple</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('course')" href="../../_variables/course.html">$course</a>-&gt;<a onClick="logVariable('id')" class="var it42904" onMouseOver="hilite(42904)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>, array(<a class="var it2286" onMouseOver="hilite(2286)" onMouseOut="lolite()" onClick="logVariable('competency')" href="../../_variables/competency.html">$competency</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>()));
<a name="l4889"><span class="linenum">4889</span></a>              <a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a> = <a class="phpfunction" onClick="logFunction('reset')" href="../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>(<a class="var it5375" onMouseOver="hilite(5375)" onMouseOut="lolite()" onClick="logVariable('all')" href="../../_variables/all.html">$all</a>);
<a name="l4890"><span class="linenum">4890</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('competency_user_competency_rated_in_course')" href="../../_classes/competency_user_competency_rated_in_course.html" onMouseOver="classPopup(event,'competency_user_competency_rated_in_course')">competency_user_competency_rated_in_course</a>::<a class="function" onClick="logFunction('create_from_user_competency_course')" href="../../_functions/create_from_user_competency_course.html" onMouseOver="funcPopup(event,'create_from_user_competency_course')">create_from_user_competency_course</a>(<a class="var it4167" onMouseOver="hilite(4167)" onMouseOut="lolite()" onClick="logVariable('uc')" href="../../_variables/uc.html">$uc</a>);
<a name="l4891"><span class="linenum">4891</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l4892"><span class="linenum">4892</span></a>          }
<a name="l4893"><span class="linenum">4893</span></a>          return <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>;
<a name="l4894"><span class="linenum">4894</span></a>      }
<a name="l4895"><span class="linenum">4895</span></a>  
<a name="l4896"><span class="linenum">4896</span></a>      <span class="comment">/**</span>
<a name="l4897"><span class="linenum">4897</span></a>  <span class="comment">     * Count the plans in the template, filtered by status.</span>
<a name="l4898"><span class="linenum">4898</span></a>  <span class="comment">     *</span>
<a name="l4899"><span class="linenum">4899</span></a>  <span class="comment">     * Requires moodle/competency:templateview capability at the system context.</span>
<a name="l4900"><span class="linenum">4900</span></a>  <span class="comment">     *</span>
<a name="l4901"><span class="linenum">4901</span></a>  <span class="comment">     * @param mixed $templateorid The id or the template.</span>
<a name="l4902"><span class="linenum">4902</span></a>  <span class="comment">     * @param int $status One of the plan status constants (or 0 for all plans).</span>
<a name="l4903"><span class="linenum">4903</span></a>  <span class="comment">     * @return int</span>
<a name="l4904"><span class="linenum">4904</span></a>  <span class="comment">     */</span>
<a name="l4905"><span class="linenum">4905</span></a>      public static function <a class="function" onClick="logFunction('count_plans_for_template')" href="../../_functions/count_plans_for_template.html" onMouseOver="funcPopup(event,'count_plans_for_template')">count_plans_for_template</a>(<a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>, <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a> = 0) {
<a name="l4906"><span class="linenum">4906</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l4907"><span class="linenum">4907</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>;
<a name="l4908"><span class="linenum">4908</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>)) {
<a name="l4909"><span class="linenum">4909</span></a>              <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>);
<a name="l4910"><span class="linenum">4910</span></a>          }
<a name="l4911"><span class="linenum">4911</span></a>  
<a name="l4912"><span class="linenum">4912</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l4913"><span class="linenum">4913</span></a>          if (!<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l4914"><span class="linenum">4914</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:templateview',
<a name="l4915"><span class="linenum">4915</span></a>                  'nopermissions', '');
<a name="l4916"><span class="linenum">4916</span></a>          }
<a name="l4917"><span class="linenum">4917</span></a>  
<a name="l4918"><span class="linenum">4918</span></a>          return <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::<a class="function" onClick="logFunction('count_records_for_template')" href="../../_functions/count_records_for_template.html" onMouseOver="funcPopup(event,'count_records_for_template')">count_records_for_template</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(), <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>);
<a name="l4919"><span class="linenum">4919</span></a>      }
<a name="l4920"><span class="linenum">4920</span></a>  
<a name="l4921"><span class="linenum">4921</span></a>      <span class="comment">/**</span>
<a name="l4922"><span class="linenum">4922</span></a>  <span class="comment">     * Count the user-completency-plans in the template, optionally filtered by proficiency.</span>
<a name="l4923"><span class="linenum">4923</span></a>  <span class="comment">     *</span>
<a name="l4924"><span class="linenum">4924</span></a>  <span class="comment">     * Requires moodle/competency:templateview capability at the system context.</span>
<a name="l4925"><span class="linenum">4925</span></a>  <span class="comment">     *</span>
<a name="l4926"><span class="linenum">4926</span></a>  <span class="comment">     * @param mixed $templateorid The id or the template.</span>
<a name="l4927"><span class="linenum">4927</span></a>  <span class="comment">     * @param mixed $proficiency If true, filter by proficiency, if false filter by not proficient, if null - no filter.</span>
<a name="l4928"><span class="linenum">4928</span></a>  <span class="comment">     * @return int</span>
<a name="l4929"><span class="linenum">4929</span></a>  <span class="comment">     */</span>
<a name="l4930"><span class="linenum">4930</span></a>      public static function <a class="function" onClick="logFunction('count_user_competency_plans_for_template')" href="../../_functions/count_user_competency_plans_for_template.html" onMouseOver="funcPopup(event,'count_user_competency_plans_for_template')">count_user_competency_plans_for_template</a>(<a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>, <a class="var it11570" onMouseOver="hilite(11570)" onMouseOut="lolite()" onClick="logVariable('proficiency')" href="../../_variables/proficiency.html">$proficiency</a> = null) {
<a name="l4931"><span class="linenum">4931</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l4932"><span class="linenum">4932</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>;
<a name="l4933"><span class="linenum">4933</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>)) {
<a name="l4934"><span class="linenum">4934</span></a>              <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>);
<a name="l4935"><span class="linenum">4935</span></a>          }
<a name="l4936"><span class="linenum">4936</span></a>  
<a name="l4937"><span class="linenum">4937</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l4938"><span class="linenum">4938</span></a>          if (!<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l4939"><span class="linenum">4939</span></a>               throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:templateview',
<a name="l4940"><span class="linenum">4940</span></a>                  'nopermissions', '');
<a name="l4941"><span class="linenum">4941</span></a>          }
<a name="l4942"><span class="linenum">4942</span></a>  
<a name="l4943"><span class="linenum">4943</span></a>          return <a class="class" onClick="logClass('user_competency_plan')" href="../../_classes/user_competency_plan.html" onMouseOver="classPopup(event,'user_competency_plan')">user_competency_plan</a>::<a class="function" onClick="logFunction('count_records_for_template')" href="../../_functions/count_records_for_template.html" onMouseOver="funcPopup(event,'count_records_for_template')">count_records_for_template</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(), <a class="var it11570" onMouseOver="hilite(11570)" onMouseOut="lolite()" onClick="logVariable('proficiency')" href="../../_variables/proficiency.html">$proficiency</a>);
<a name="l4944"><span class="linenum">4944</span></a>      }
<a name="l4945"><span class="linenum">4945</span></a>  
<a name="l4946"><span class="linenum">4946</span></a>      <span class="comment">/**</span>
<a name="l4947"><span class="linenum">4947</span></a>  <span class="comment">     * List the plans in the template, filtered by status.</span>
<a name="l4948"><span class="linenum">4948</span></a>  <span class="comment">     *</span>
<a name="l4949"><span class="linenum">4949</span></a>  <span class="comment">     * Requires moodle/competency:templateview capability at the system context.</span>
<a name="l4950"><span class="linenum">4950</span></a>  <span class="comment">     *</span>
<a name="l4951"><span class="linenum">4951</span></a>  <span class="comment">     * @param mixed $templateorid The id or the template.</span>
<a name="l4952"><span class="linenum">4952</span></a>  <span class="comment">     * @param int $status One of the plan status constants (or 0 for all plans).</span>
<a name="l4953"><span class="linenum">4953</span></a>  <span class="comment">     * @param int $skip The number of records to skip</span>
<a name="l4954"><span class="linenum">4954</span></a>  <span class="comment">     * @param int $limit The max number of records to return</span>
<a name="l4955"><span class="linenum">4955</span></a>  <span class="comment">     * @return plan[]</span>
<a name="l4956"><span class="linenum">4956</span></a>  <span class="comment">     */</span>
<a name="l4957"><span class="linenum">4957</span></a>      public static function <a class="function" onClick="logFunction('list_plans_for_template')" href="../../_functions/list_plans_for_template.html" onMouseOver="funcPopup(event,'list_plans_for_template')">list_plans_for_template</a>(<a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>, <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a> = 0, <a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('skip')" href="../../_variables/skip.html">$skip</a> = 0, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a> = 100) {
<a name="l4958"><span class="linenum">4958</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>;
<a name="l4959"><span class="linenum">4959</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>)) {
<a name="l4960"><span class="linenum">4960</span></a>              <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>);
<a name="l4961"><span class="linenum">4961</span></a>          }
<a name="l4962"><span class="linenum">4962</span></a>  
<a name="l4963"><span class="linenum">4963</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l4964"><span class="linenum">4964</span></a>          if (!<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l4965"><span class="linenum">4965</span></a>               throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:templateview',
<a name="l4966"><span class="linenum">4966</span></a>                  'nopermissions', '');
<a name="l4967"><span class="linenum">4967</span></a>          }
<a name="l4968"><span class="linenum">4968</span></a>  
<a name="l4969"><span class="linenum">4969</span></a>          return <a class="class" onClick="logClass('plan')" href="../../_classes/plan.html" onMouseOver="classPopup(event,'plan')">plan</a>::<a class="function" onClick="logFunction('get_records_for_template')" href="../../_functions/get_records_for_template.html" onMouseOver="funcPopup(event,'get_records_for_template')">get_records_for_template</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(), <a class="var it646" onMouseOver="hilite(646)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../_variables/status.html">$status</a>, <a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('skip')" href="../../_variables/skip.html">$skip</a>, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a>);
<a name="l4970"><span class="linenum">4970</span></a>      }
<a name="l4971"><span class="linenum">4971</span></a>  
<a name="l4972"><span class="linenum">4972</span></a>      <span class="comment">/**</span>
<a name="l4973"><span class="linenum">4973</span></a>  <span class="comment">     * Get the most often not completed competency for this course.</span>
<a name="l4974"><span class="linenum">4974</span></a>  <span class="comment">     *</span>
<a name="l4975"><span class="linenum">4975</span></a>  <span class="comment">     * Requires moodle/competency:coursecompetencyview capability at the course context.</span>
<a name="l4976"><span class="linenum">4976</span></a>  <span class="comment">     *</span>
<a name="l4977"><span class="linenum">4977</span></a>  <span class="comment">     * @param int $courseid The course id</span>
<a name="l4978"><span class="linenum">4978</span></a>  <span class="comment">     * @param int $skip The number of records to skip</span>
<a name="l4979"><span class="linenum">4979</span></a>  <span class="comment">     * @param int $limit The max number of records to return</span>
<a name="l4980"><span class="linenum">4980</span></a>  <span class="comment">     * @return competency[]</span>
<a name="l4981"><span class="linenum">4981</span></a>  <span class="comment">     */</span>
<a name="l4982"><span class="linenum">4982</span></a>      public static function <a class="function" onClick="logFunction('get_least_proficient_competencies_for_course')" href="../../_functions/get_least_proficient_competencies_for_course.html" onMouseOver="funcPopup(event,'get_least_proficient_competencies_for_course')">get_least_proficient_competencies_for_course</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('skip')" href="../../_variables/skip.html">$skip</a> = 0, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a> = 100) {
<a name="l4983"><span class="linenum">4983</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l4984"><span class="linenum">4984</span></a>          <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l4985"><span class="linenum">4985</span></a>  
<a name="l4986"><span class="linenum">4986</span></a>          if (!<a class="function" onClick="logFunction('has_any_capability')" href="../../_functions/has_any_capability.html" onMouseOver="funcPopup(event,'has_any_capability')">has_any_capability</a>(array('moodle/competency:competencyview', 'moodle/competency:competencymanage'), <a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a>)) {
<a name="l4987"><span class="linenum">4987</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it683" onMouseOver="hilite(683)" onMouseOut="lolite()" onClick="logVariable('coursecontext')" href="../../_variables/coursecontext.html">$coursecontext</a>, 'moodle/competency:competencyview', 'nopermissions', '');
<a name="l4988"><span class="linenum">4988</span></a>          }
<a name="l4989"><span class="linenum">4989</span></a>  
<a name="l4990"><span class="linenum">4990</span></a>          return <a class="class" onClick="logClass('user_competency_course')" href="../../_classes/user_competency_course.html" onMouseOver="classPopup(event,'user_competency_course')">user_competency_course</a>::<a class="function" onClick="logFunction('get_least_proficient_competencies_for_course')" href="../../_functions/get_least_proficient_competencies_for_course.html" onMouseOver="funcPopup(event,'get_least_proficient_competencies_for_course')">get_least_proficient_competencies_for_course</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('skip')" href="../../_variables/skip.html">$skip</a>, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a>);
<a name="l4991"><span class="linenum">4991</span></a>      }
<a name="l4992"><span class="linenum">4992</span></a>  
<a name="l4993"><span class="linenum">4993</span></a>      <span class="comment">/**</span>
<a name="l4994"><span class="linenum">4994</span></a>  <span class="comment">     * Get the most often not completed competency for this template.</span>
<a name="l4995"><span class="linenum">4995</span></a>  <span class="comment">     *</span>
<a name="l4996"><span class="linenum">4996</span></a>  <span class="comment">     * Requires moodle/competency:templateview capability at the system context.</span>
<a name="l4997"><span class="linenum">4997</span></a>  <span class="comment">     *</span>
<a name="l4998"><span class="linenum">4998</span></a>  <span class="comment">     * @param mixed $templateorid The id or the template.</span>
<a name="l4999"><span class="linenum">4999</span></a>  <span class="comment">     * @param int $skip The number of records to skip</span>
<a name="l5000"><span class="linenum">5000</span></a>  <span class="comment">     * @param int $limit The max number of records to return</span>
<a name="l5001"><span class="linenum">5001</span></a>  <span class="comment">     * @return competency[]</span>
<a name="l5002"><span class="linenum">5002</span></a>  <span class="comment">     */</span>
<a name="l5003"><span class="linenum">5003</span></a>      public static function <a class="function" onClick="logFunction('get_least_proficient_competencies_for_template')" href="../../_functions/get_least_proficient_competencies_for_template.html" onMouseOver="funcPopup(event,'get_least_proficient_competencies_for_template')">get_least_proficient_competencies_for_template</a>(<a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>, <a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('skip')" href="../../_variables/skip.html">$skip</a> = 0, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a> = 100) {
<a name="l5004"><span class="linenum">5004</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l5005"><span class="linenum">5005</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>;
<a name="l5006"><span class="linenum">5006</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>)) {
<a name="l5007"><span class="linenum">5007</span></a>              <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>);
<a name="l5008"><span class="linenum">5008</span></a>          }
<a name="l5009"><span class="linenum">5009</span></a>  
<a name="l5010"><span class="linenum">5010</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l5011"><span class="linenum">5011</span></a>          if (!<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l5012"><span class="linenum">5012</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:templateview',
<a name="l5013"><span class="linenum">5013</span></a>                  'nopermissions', '');
<a name="l5014"><span class="linenum">5014</span></a>          }
<a name="l5015"><span class="linenum">5015</span></a>  
<a name="l5016"><span class="linenum">5016</span></a>          return <a class="class" onClick="logClass('user_competency_plan')" href="../../_classes/user_competency_plan.html" onMouseOver="classPopup(event,'user_competency_plan')">user_competency_plan</a>::<a class="function" onClick="logFunction('get_least_proficient_competencies_for_template')" href="../../_functions/get_least_proficient_competencies_for_template.html" onMouseOver="funcPopup(event,'get_least_proficient_competencies_for_template')">get_least_proficient_competencies_for_template</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_id')" href="../../_functions/get_id.html" onMouseOver="funcPopup(event,'get_id')">get_id</a>(), <a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('skip')" href="../../_variables/skip.html">$skip</a>, <a class="var it1051" onMouseOver="hilite(1051)" onMouseOut="lolite()" onClick="logVariable('limit')" href="../../_variables/limit.html">$limit</a>);
<a name="l5017"><span class="linenum">5017</span></a>      }
<a name="l5018"><span class="linenum">5018</span></a>  
<a name="l5019"><span class="linenum">5019</span></a>      <span class="comment">/**</span>
<a name="l5020"><span class="linenum">5020</span></a>  <span class="comment">     * Template event viewed.</span>
<a name="l5021"><span class="linenum">5021</span></a>  <span class="comment">     *</span>
<a name="l5022"><span class="linenum">5022</span></a>  <span class="comment">     * Requires moodle/competency:templateview capability at the system context.</span>
<a name="l5023"><span class="linenum">5023</span></a>  <span class="comment">     *</span>
<a name="l5024"><span class="linenum">5024</span></a>  <span class="comment">     * @param mixed $templateorid The id or the template.</span>
<a name="l5025"><span class="linenum">5025</span></a>  <span class="comment">     * @return boolean</span>
<a name="l5026"><span class="linenum">5026</span></a>  <span class="comment">     */</span>
<a name="l5027"><span class="linenum">5027</span></a>      public static function <a class="function" onClick="logFunction('template_viewed')" href="../../_functions/template_viewed.html" onMouseOver="funcPopup(event,'template_viewed')">template_viewed</a>(<a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>) {
<a name="l5028"><span class="linenum">5028</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l5029"><span class="linenum">5029</span></a>          <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <a class="var it30457" onMouseOver="hilite(30457)" onMouseOut="lolite()" onClick="logVariable('templateorid')" href="../../_variables/templateorid.html">$templateorid</a>;
<a name="l5030"><span class="linenum">5030</span></a>          if (!<a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>)) {
<a name="l5031"><span class="linenum">5031</span></a>              <a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a> = <span class="keyword">new </span><a class="class" onClick="logClass('template')" href="../../_classes/template.html" onMouseOver="classPopup(event,'template')">template</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>);
<a name="l5032"><span class="linenum">5032</span></a>          }
<a name="l5033"><span class="linenum">5033</span></a>  
<a name="l5034"><span class="linenum">5034</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l5035"><span class="linenum">5035</span></a>          if (!<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>()) {
<a name="l5036"><span class="linenum">5036</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>-&gt;<a class="function" onClick="logFunction('get_context')" href="../../_functions/get_context.html" onMouseOver="funcPopup(event,'get_context')">get_context</a>(), 'moodle/competency:templateview',
<a name="l5037"><span class="linenum">5037</span></a>                  'nopermissions', '');
<a name="l5038"><span class="linenum">5038</span></a>          }
<a name="l5039"><span class="linenum">5039</span></a>  
<a name="l5040"><span class="linenum">5040</span></a>  <span class="comment">        // Trigger a template viewed event.</span>
<a name="l5041"><span class="linenum">5041</span></a>          \core\event\<a class="class" onClick="logClass('competency_template_viewed')" href="../../_classes/competency_template_viewed.html" onMouseOver="classPopup(event,'competency_template_viewed')">competency_template_viewed</a>::<a class="function" onClick="logFunction('create_from_template')" href="../../_functions/create_from_template.html" onMouseOver="funcPopup(event,'create_from_template')">create_from_template</a>(<a class="var it2289" onMouseOver="hilite(2289)" onMouseOut="lolite()" onClick="logVariable('template')" href="../../_variables/template.html">$template</a>)-&gt;<a class="function" onClick="logFunction('trigger')" href="../../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l5042"><span class="linenum">5042</span></a>  
<a name="l5043"><span class="linenum">5043</span></a>          return true;
<a name="l5044"><span class="linenum">5044</span></a>      }
<a name="l5045"><span class="linenum">5045</span></a>  
<a name="l5046"><span class="linenum">5046</span></a>      <span class="comment">/**</span>
<a name="l5047"><span class="linenum">5047</span></a>  <span class="comment">     * Get the competency settings for a course.</span>
<a name="l5048"><span class="linenum">5048</span></a>  <span class="comment">     *</span>
<a name="l5049"><span class="linenum">5049</span></a>  <span class="comment">     * Requires moodle/competency:coursecompetencyview capability at the course context.</span>
<a name="l5050"><span class="linenum">5050</span></a>  <span class="comment">     *</span>
<a name="l5051"><span class="linenum">5051</span></a>  <span class="comment">     * @param int $courseid The course id</span>
<a name="l5052"><span class="linenum">5052</span></a>  <span class="comment">     * @return course_competency_settings</span>
<a name="l5053"><span class="linenum">5053</span></a>  <span class="comment">     */</span>
<a name="l5054"><span class="linenum">5054</span></a>      public static function <a class="function" onClick="logFunction('read_course_competency_settings')" href="../../_functions/read_course_competency_settings.html" onMouseOver="funcPopup(event,'read_course_competency_settings')">read_course_competency_settings</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>) {
<a name="l5055"><span class="linenum">5055</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l5056"><span class="linenum">5056</span></a>  
<a name="l5057"><span class="linenum">5057</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l5058"><span class="linenum">5058</span></a>          if (!<a class="class" onClick="logClass('course_competency_settings')" href="../../_classes/course_competency_settings.html" onMouseOver="classPopup(event,'course_competency_settings')">course_competency_settings</a>::<a class="function" onClick="logFunction('can_read')" href="../../_functions/can_read.html" onMouseOver="funcPopup(event,'can_read')">can_read</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>)) {
<a name="l5059"><span class="linenum">5059</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l5060"><span class="linenum">5060</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:coursecompetencyview', 'nopermissions', '');
<a name="l5061"><span class="linenum">5061</span></a>          }
<a name="l5062"><span class="linenum">5062</span></a>  
<a name="l5063"><span class="linenum">5063</span></a>          return <a class="class" onClick="logClass('course_competency_settings')" href="../../_classes/course_competency_settings.html" onMouseOver="classPopup(event,'course_competency_settings')">course_competency_settings</a>::<a class="function" onClick="logFunction('get_by_courseid')" href="../../_functions/get_by_courseid.html" onMouseOver="funcPopup(event,'get_by_courseid')">get_by_courseid</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l5064"><span class="linenum">5064</span></a>      }
<a name="l5065"><span class="linenum">5065</span></a>  
<a name="l5066"><span class="linenum">5066</span></a>      <span class="comment">/**</span>
<a name="l5067"><span class="linenum">5067</span></a>  <span class="comment">     * Update the competency settings for a course.</span>
<a name="l5068"><span class="linenum">5068</span></a>  <span class="comment">     *</span>
<a name="l5069"><span class="linenum">5069</span></a>  <span class="comment">     * Requires moodle/competency:coursecompetencyconfigure capability at the course context.</span>
<a name="l5070"><span class="linenum">5070</span></a>  <span class="comment">     *</span>
<a name="l5071"><span class="linenum">5071</span></a>  <span class="comment">     * @param int $courseid The course id</span>
<a name="l5072"><span class="linenum">5072</span></a>  <span class="comment">     * @param stdClass $settings List of settings. The only valid setting ATM is pushratginstouserplans (boolean).</span>
<a name="l5073"><span class="linenum">5073</span></a>  <span class="comment">     * @return bool</span>
<a name="l5074"><span class="linenum">5074</span></a>  <span class="comment">     */</span>
<a name="l5075"><span class="linenum">5075</span></a>      public static function <a class="function" onClick="logFunction('update_course_competency_settings')" href="../../_functions/update_course_competency_settings.html" onMouseOver="funcPopup(event,'update_course_competency_settings')">update_course_competency_settings</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, <a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a>) {
<a name="l5076"><span class="linenum">5076</span></a>          static::<a class="function" onClick="logFunction('require_enabled')" href="../../_functions/require_enabled.html" onMouseOver="funcPopup(event,'require_enabled')">require_enabled</a>();
<a name="l5077"><span class="linenum">5077</span></a>  
<a name="l5078"><span class="linenum">5078</span></a>          <a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a> = (object) <a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a>;
<a name="l5079"><span class="linenum">5079</span></a>  
<a name="l5080"><span class="linenum">5080</span></a>  <span class="comment">        // Get all the valid settings.</span>
<a name="l5081"><span class="linenum">5081</span></a>          <a class="var it9646" onMouseOver="hilite(9646)" onMouseOut="lolite()" onClick="logVariable('pushratingstouserplans')" href="../../_variables/pushratingstouserplans.html">$pushratingstouserplans</a> = isset(<a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a>-&gt;<a onClick="logVariable('pushratingstouserplans')" class="var it43241" onMouseOver="hilite(43241)" onMouseOut="lolite()" href="../../_variables/pushratingstouserplans.html">pushratingstouserplans</a>) ? <a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a>-&gt;<a onClick="logVariable('pushratingstouserplans')" class="var it43241" onMouseOver="hilite(43241)" onMouseOut="lolite()" href="../../_variables/pushratingstouserplans.html">pushratingstouserplans</a> : false;
<a name="l5082"><span class="linenum">5082</span></a>  
<a name="l5083"><span class="linenum">5083</span></a>  <span class="comment">        // First we do a permissions check.</span>
<a name="l5084"><span class="linenum">5084</span></a>          if (!<a class="class" onClick="logClass('course_competency_settings')" href="../../_classes/course_competency_settings.html" onMouseOver="classPopup(event,'course_competency_settings')">course_competency_settings</a>::<a class="function" onClick="logFunction('can_manage_course')" href="../../_functions/can_manage_course.html" onMouseOver="funcPopup(event,'can_manage_course')">can_manage_course</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>)) {
<a name="l5085"><span class="linenum">5085</span></a>              <a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a> = <a class="class" onClick="logClass('context_course')" href="../../_classes/context_course.html" onMouseOver="classPopup(event,'context_course')">context_course</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>);
<a name="l5086"><span class="linenum">5086</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('required_capability_exception')" href="../../_classes/required_capability_exception.html" onMouseOver="classPopup(event,'required_capability_exception')">required_capability_exception</a>(<a class="var it23" onMouseOver="hilite(23)" onMouseOut="lolite()" onClick="logVariable('context')" href="../../_variables/context.html">$context</a>, 'moodle/competency:coursecompetencyconfigure', 'nopermissions', '');
<a name="l5087"><span class="linenum">5087</span></a>          }
<a name="l5088"><span class="linenum">5088</span></a>  
<a name="l5089"><span class="linenum">5089</span></a>          <a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a> = <a class="class" onClick="logClass('course_competency_settings')" href="../../_classes/course_competency_settings.html" onMouseOver="classPopup(event,'course_competency_settings')">course_competency_settings</a>::<a class="function" onClick="logFunction('get_record')" href="../../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>(array('courseid' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>));
<a name="l5090"><span class="linenum">5090</span></a>  
<a name="l5091"><span class="linenum">5091</span></a>  <span class="comment">        // Now update or insert.</span>
<a name="l5092"><span class="linenum">5092</span></a>          if (<a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a>) {
<a name="l5093"><span class="linenum">5093</span></a>              <a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a> = <a class="var it2527" onMouseOver="hilite(2527)" onMouseOut="lolite()" onClick="logVariable('exists')" href="../../_variables/exists.html">$exists</a>;
<a name="l5094"><span class="linenum">5094</span></a>              <a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a>-&gt;set_pushratingstouserplans(<a class="var it9646" onMouseOver="hilite(9646)" onMouseOut="lolite()" onClick="logVariable('pushratingstouserplans')" href="../../_variables/pushratingstouserplans.html">$pushratingstouserplans</a>);
<a name="l5095"><span class="linenum">5095</span></a>              return <a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a>-&gt;<a class="function" onClick="logFunction('update')" href="../../_functions/update.html" onMouseOver="funcPopup(event,'update')">update</a>();
<a name="l5096"><span class="linenum">5096</span></a>          } else {
<a name="l5097"><span class="linenum">5097</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a> = (object) array('courseid' =&gt; <a class="var it700" onMouseOver="hilite(700)" onMouseOut="lolite()" onClick="logVariable('courseid')" href="../../_variables/courseid.html">$courseid</a>, 'pushratingstouserplans' =&gt; <a class="var it9646" onMouseOver="hilite(9646)" onMouseOut="lolite()" onClick="logVariable('pushratingstouserplans')" href="../../_variables/pushratingstouserplans.html">$pushratingstouserplans</a>);
<a name="l5098"><span class="linenum">5098</span></a>              <a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a> = <span class="keyword">new </span><a class="class" onClick="logClass('course_competency_settings')" href="../../_classes/course_competency_settings.html" onMouseOver="classPopup(event,'course_competency_settings')">course_competency_settings</a>(0, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../_variables/data.html">$data</a>);
<a name="l5099"><span class="linenum">5099</span></a>              <a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l5100"><span class="linenum">5100</span></a>              return !empty(<a class="var it157" onMouseOver="hilite(157)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a>);
<a name="l5101"><span class="linenum">5101</span></a>          }
<a name="l5102"><span class="linenum">5102</span></a>      }
<a name="l5103"><span class="linenum">5103</span></a>  
<a name="l5104"><span class="linenum">5104</span></a>  
<a name="l5105"><span class="linenum">5105</span></a>      <span class="comment">/**</span>
<a name="l5106"><span class="linenum">5106</span></a>  <span class="comment">     * Function used to return a list of users where the given user has a particular capability.</span>
<a name="l5107"><span class="linenum">5107</span></a>  <span class="comment">     *</span>
<a name="l5108"><span class="linenum">5108</span></a>  <span class="comment">     * This is used e.g. to find all the users where someone is able to manage their learning plans,</span>
<a name="l5109"><span class="linenum">5109</span></a>  <span class="comment">     * it also would be useful for mentees etc.</span>
<a name="l5110"><span class="linenum">5110</span></a>  <span class="comment">     *</span>
<a name="l5111"><span class="linenum">5111</span></a>  <span class="comment">     * @param string $capability - The capability string we are filtering for. If '' is passed,</span>
<a name="l5112"><span class="linenum">5112</span></a>  <span class="comment">     *                             an always matching filter is returned.</span>
<a name="l5113"><span class="linenum">5113</span></a>  <span class="comment">     * @param int $userid - The user id we are using for the access checks. Defaults to current user.</span>
<a name="l5114"><span class="linenum">5114</span></a>  <span class="comment">     * @param int $type - The type of named params to return (passed to $DB-&gt;get_in_or_equal).</span>
<a name="l5115"><span class="linenum">5115</span></a>  <span class="comment">     * @param string $prefix - The type prefix for the db table (passed to $DB-&gt;get_in_or_equal).</span>
<a name="l5116"><span class="linenum">5116</span></a>  <span class="comment">     * @return list($sql, $params) Same as $DB-&gt;get_in_or_equal().</span>
<a name="l5117"><span class="linenum">5117</span></a>  <span class="comment">     * @todo MDL-52243 Move this function to lib/accesslib.php</span>
<a name="l5118"><span class="linenum">5118</span></a>  <span class="comment">     */</span>
<a name="l5119"><span class="linenum">5119</span></a>      public static function <a class="function" onClick="logFunction('filter_users_with_capability_on_user_context_sql')" href="../../_functions/filter_users_with_capability_on_user_context_sql.html" onMouseOver="funcPopup(event,'filter_users_with_capability_on_user_context_sql')">filter_users_with_capability_on_user_context_sql</a>(<a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> = 0, <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a> = <a class="constant" onClick="logConstant('SQL_PARAMS_QM')" href="../../_constants/SQL_PARAMS_QM.html" onMouseOver="constPopup(event,'SQL_PARAMS_QM')">SQL_PARAMS_QM</a>,
<a name="l5120"><span class="linenum">5120</span></a>                                                                              <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../_variables/prefix.html">$prefix</a>='param') {
<a name="l5121"><span class="linenum">5121</span></a>  
<a name="l5122"><span class="linenum">5122</span></a>          global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l5123"><span class="linenum">5123</span></a>          <a class="var it30494" onMouseOver="hilite(30494)" onMouseOut="lolite()" onClick="logVariable('allresultsfilter')" href="../../_variables/allresultsfilter.html">$allresultsfilter</a> = array('&gt; 0', array());
<a name="l5124"><span class="linenum">5124</span></a>          <a class="var it30495" onMouseOver="hilite(30495)" onMouseOut="lolite()" onClick="logVariable('noresultsfilter')" href="../../_variables/noresultsfilter.html">$noresultsfilter</a> = array('= -1', array());
<a name="l5125"><span class="linenum">5125</span></a>  
<a name="l5126"><span class="linenum">5126</span></a>          if (empty(<a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>)) {
<a name="l5127"><span class="linenum">5127</span></a>              return <a class="var it30494" onMouseOver="hilite(30494)" onMouseOut="lolite()" onClick="logVariable('allresultsfilter')" href="../../_variables/allresultsfilter.html">$allresultsfilter</a>;
<a name="l5128"><span class="linenum">5128</span></a>          }
<a name="l5129"><span class="linenum">5129</span></a>  
<a name="l5130"><span class="linenum">5130</span></a>          if (!<a class="var it29064" onMouseOver="hilite(29064)" onMouseOut="lolite()" onClick="logVariable('capinfo')" href="../../_variables/capinfo.html">$capinfo</a> = <a class="function" onClick="logFunction('get_capability_info')" href="../../_functions/get_capability_info.html" onMouseOver="funcPopup(event,'get_capability_info')">get_capability_info</a>(<a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>)) {
<a name="l5131"><span class="linenum">5131</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Capability does not exist: ' . <a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>);
<a name="l5132"><span class="linenum">5132</span></a>          }
<a name="l5133"><span class="linenum">5133</span></a>  
<a name="l5134"><span class="linenum">5134</span></a>          if (empty(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>)) {
<a name="l5135"><span class="linenum">5135</span></a>              <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> = <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../../_variables/id.html">id</a>;
<a name="l5136"><span class="linenum">5136</span></a>          }
<a name="l5137"><span class="linenum">5137</span></a>  
<a name="l5138"><span class="linenum">5138</span></a>  <span class="comment">        // Make sure the guest account and not-logged-in users never get any risky caps no matter what the actual settings are.</span>
<a name="l5139"><span class="linenum">5139</span></a>          if ((<a class="var it29064" onMouseOver="hilite(29064)" onMouseOut="lolite()" onClick="logVariable('capinfo')" href="../../_variables/capinfo.html">$capinfo</a>-&gt;<a onClick="logVariable('captype')" class="var it43748" onMouseOver="hilite(43748)" onMouseOut="lolite()" href="../../_variables/captype.html">captype</a> === 'write') <a class="function" onClick="logFunction('or')" href="../../_functions/or.html" onMouseOver="funcPopup(event,'or')">or</a> (<a class="var it29064" onMouseOver="hilite(29064)" onMouseOut="lolite()" onClick="logVariable('capinfo')" href="../../_variables/capinfo.html">$capinfo</a>-&gt;<a onClick="logVariable('riskbitmask')" class="var it43748" onMouseOver="hilite(43748)" onMouseOut="lolite()" href="../../_variables/riskbitmask.html">riskbitmask</a> &amp; (<a class="constant" onClick="logConstant('RISK_XSS')" href="../../_constants/RISK_XSS.html" onMouseOver="constPopup(event,'RISK_XSS')">RISK_XSS</a> | <a class="constant" onClick="logConstant('RISK_CONFIG')" href="../../_constants/RISK_CONFIG.html" onMouseOver="constPopup(event,'RISK_CONFIG')">RISK_CONFIG</a> | <a class="constant" onClick="logConstant('RISK_DATALOSS')" href="../../_constants/RISK_DATALOSS.html" onMouseOver="constPopup(event,'RISK_DATALOSS')">RISK_DATALOSS</a>))) {
<a name="l5140"><span class="linenum">5140</span></a>              if (<a class="function" onClick="logFunction('isguestuser')" href="../../_functions/isguestuser.html" onMouseOver="funcPopup(event,'isguestuser')">isguestuser</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>) or <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a> == 0) {
<a name="l5141"><span class="linenum">5141</span></a>                  return <a class="var it30495" onMouseOver="hilite(30495)" onMouseOut="lolite()" onClick="logVariable('noresultsfilter')" href="../../_variables/noresultsfilter.html">$noresultsfilter</a>;
<a name="l5142"><span class="linenum">5142</span></a>              }
<a name="l5143"><span class="linenum">5143</span></a>          }
<a name="l5144"><span class="linenum">5144</span></a>  
<a name="l5145"><span class="linenum">5145</span></a>          if (<a class="function" onClick="logFunction('is_siteadmin')" href="../../_functions/is_siteadmin.html" onMouseOver="funcPopup(event,'is_siteadmin')">is_siteadmin</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>)) {
<a name="l5146"><span class="linenum">5146</span></a>  <span class="comment">            // No filtering for site admins.</span>
<a name="l5147"><span class="linenum">5147</span></a>              return <a class="var it30494" onMouseOver="hilite(30494)" onMouseOut="lolite()" onClick="logVariable('allresultsfilter')" href="../../_variables/allresultsfilter.html">$allresultsfilter</a>;
<a name="l5148"><span class="linenum">5148</span></a>          }
<a name="l5149"><span class="linenum">5149</span></a>  
<a name="l5150"><span class="linenum">5150</span></a>  <span class="comment">        // Check capability on system level.</span>
<a name="l5151"><span class="linenum">5151</span></a>          <a class="var it832" onMouseOver="hilite(832)" onMouseOut="lolite()" onClick="logVariable('syscontext')" href="../../_variables/syscontext.html">$syscontext</a> = <a class="class" onClick="logClass('context_system')" href="../../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l5152"><span class="linenum">5152</span></a>          <a class="var it30496" onMouseOver="hilite(30496)" onMouseOut="lolite()" onClick="logVariable('hassystem')" href="../../_variables/hassystem.html">$hassystem</a> = <a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(<a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>, <a class="var it832" onMouseOver="hilite(832)" onMouseOut="lolite()" onClick="logVariable('syscontext')" href="../../_variables/syscontext.html">$syscontext</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>);
<a name="l5153"><span class="linenum">5153</span></a>  
<a name="l5154"><span class="linenum">5154</span></a>          <a class="var it1030" onMouseOver="hilite(1030)" onMouseOut="lolite()" onClick="logVariable('access')" href="../../_variables/access.html">$access</a> = <a class="function" onClick="logFunction('get_user_access_sitewide')" href="../../_functions/get_user_access_sitewide.html" onMouseOver="funcPopup(event,'get_user_access_sitewide')">get_user_access_sitewide</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>);
<a name="l5155"><span class="linenum">5155</span></a>  <span class="comment">        // Build up a list of level 2 contexts (candidates to be user context).</span>
<a name="l5156"><span class="linenum">5156</span></a>          <a class="var it30497" onMouseOver="hilite(30497)" onMouseOut="lolite()" onClick="logVariable('filtercontexts')" href="../../_variables/filtercontexts.html">$filtercontexts</a> = array();
<a name="l5157"><span class="linenum">5157</span></a>          foreach (<a class="var it1030" onMouseOver="hilite(1030)" onMouseOut="lolite()" onClick="logVariable('access')" href="../../_variables/access.html">$access</a>['ra'] as <a class="var it240" onMouseOver="hilite(240)" onMouseOut="lolite()" onClick="logVariable('path')" href="../../_variables/path.html">$path</a> =&gt; <a class="var it573" onMouseOver="hilite(573)" onMouseOut="lolite()" onClick="logVariable('role')" href="../../_variables/role.html">$role</a>) {
<a name="l5158"><span class="linenum">5158</span></a>              <a class="var it1412" onMouseOver="hilite(1412)" onMouseOut="lolite()" onClick="logVariable('parts')" href="../../_variables/parts.html">$parts</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>('/', <a class="var it240" onMouseOver="hilite(240)" onMouseOut="lolite()" onClick="logVariable('path')" href="../../_variables/path.html">$path</a>);
<a name="l5159"><span class="linenum">5159</span></a>              if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it1412" onMouseOver="hilite(1412)" onMouseOut="lolite()" onClick="logVariable('parts')" href="../../_variables/parts.html">$parts</a>) == 3) {
<a name="l5160"><span class="linenum">5160</span></a>                  <a class="var it30497" onMouseOver="hilite(30497)" onMouseOut="lolite()" onClick="logVariable('filtercontexts')" href="../../_variables/filtercontexts.html">$filtercontexts</a>[<a class="var it1412" onMouseOver="hilite(1412)" onMouseOut="lolite()" onClick="logVariable('parts')" href="../../_variables/parts.html">$parts</a>[2]] = <a class="var it1412" onMouseOver="hilite(1412)" onMouseOut="lolite()" onClick="logVariable('parts')" href="../../_variables/parts.html">$parts</a>[2];
<a name="l5161"><span class="linenum">5161</span></a>              } else if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it1412" onMouseOver="hilite(1412)" onMouseOut="lolite()" onClick="logVariable('parts')" href="../../_variables/parts.html">$parts</a>) &gt; 3) {
<a name="l5162"><span class="linenum">5162</span></a>  <span class="comment">                // We know this is not a user context because there is another path with more than 2 levels.</span>
<a name="l5163"><span class="linenum">5163</span></a>                  unset(<a class="var it30497" onMouseOver="hilite(30497)" onMouseOut="lolite()" onClick="logVariable('filtercontexts')" href="../../_variables/filtercontexts.html">$filtercontexts</a>[<a class="var it1412" onMouseOver="hilite(1412)" onMouseOut="lolite()" onClick="logVariable('parts')" href="../../_variables/parts.html">$parts</a>[2]]);
<a name="l5164"><span class="linenum">5164</span></a>              }
<a name="l5165"><span class="linenum">5165</span></a>          }
<a name="l5166"><span class="linenum">5166</span></a>  
<a name="l5167"><span class="linenum">5167</span></a>  <span class="comment">        // Add all contexts in which a role may be overidden.</span>
<a name="l5168"><span class="linenum">5168</span></a>          foreach (<a class="var it1030" onMouseOver="hilite(1030)" onMouseOut="lolite()" onClick="logVariable('access')" href="../../_variables/access.html">$access</a>['rdef'] as <a class="var it30498" onMouseOver="hilite(30498)" onMouseOut="lolite()" onClick="logVariable('pathandroleid')" href="../../_variables/pathandroleid.html">$pathandroleid</a> =&gt; <a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../_variables/def.html">$def</a>) {
<a name="l5169"><span class="linenum">5169</span></a>              <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> = array();
<a name="l5170"><span class="linenum">5170</span></a>              if (!isset(<a class="var it500" onMouseOver="hilite(500)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../_variables/def.html">$def</a>[<a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>])) {
<a name="l5171"><span class="linenum">5171</span></a>  <span class="comment">                // The capability is not mentioned, we can ignore.</span>
<a name="l5172"><span class="linenum">5172</span></a>                  continue;
<a name="l5173"><span class="linenum">5173</span></a>              }
<a name="l5174"><span class="linenum">5174</span></a>  
<a name="l5175"><span class="linenum">5175</span></a>              <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it30499" onMouseOver="hilite(30499)" onMouseOut="lolite()" onClick="logVariable('contextpath')" href="../../_variables/contextpath.html">$contextpath</a>, <a class="var it788" onMouseOver="hilite(788)" onMouseOut="lolite()" onClick="logVariable('roleid')" href="../../_variables/roleid.html">$roleid</a>) = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(':', <a class="var it30498" onMouseOver="hilite(30498)" onMouseOut="lolite()" onClick="logVariable('pathandroleid')" href="../../_variables/pathandroleid.html">$pathandroleid</a>, 2);
<a name="l5176"><span class="linenum">5176</span></a>              <a class="var it1412" onMouseOver="hilite(1412)" onMouseOut="lolite()" onClick="logVariable('parts')" href="../../_variables/parts.html">$parts</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>('/', <a class="var it30499" onMouseOver="hilite(30499)" onMouseOut="lolite()" onClick="logVariable('contextpath')" href="../../_variables/contextpath.html">$contextpath</a>);
<a name="l5177"><span class="linenum">5177</span></a>              if (<a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it1412" onMouseOver="hilite(1412)" onMouseOut="lolite()" onClick="logVariable('parts')" href="../../_variables/parts.html">$parts</a>) != 3) {
<a name="l5178"><span class="linenum">5178</span></a>  <span class="comment">                // Only get potential user contexts, they only ever have 2 slashes /parentId/Id.</span>
<a name="l5179"><span class="linenum">5179</span></a>                  continue;
<a name="l5180"><span class="linenum">5180</span></a>              }
<a name="l5181"><span class="linenum">5181</span></a>  
<a name="l5182"><span class="linenum">5182</span></a>              <a class="var it30497" onMouseOver="hilite(30497)" onMouseOut="lolite()" onClick="logVariable('filtercontexts')" href="../../_variables/filtercontexts.html">$filtercontexts</a>[<a class="var it1412" onMouseOver="hilite(1412)" onMouseOut="lolite()" onClick="logVariable('parts')" href="../../_variables/parts.html">$parts</a>[2]] = <a class="var it1412" onMouseOver="hilite(1412)" onMouseOut="lolite()" onClick="logVariable('parts')" href="../../_variables/parts.html">$parts</a>[2];
<a name="l5183"><span class="linenum">5183</span></a>          }
<a name="l5184"><span class="linenum">5184</span></a>  
<a name="l5185"><span class="linenum">5185</span></a>  <span class="comment">        // No interesting contexts - return all or no results.</span>
<a name="l5186"><span class="linenum">5186</span></a>          if (empty(<a class="var it30497" onMouseOver="hilite(30497)" onMouseOut="lolite()" onClick="logVariable('filtercontexts')" href="../../_variables/filtercontexts.html">$filtercontexts</a>)) {
<a name="l5187"><span class="linenum">5187</span></a>              if (<a class="var it30496" onMouseOver="hilite(30496)" onMouseOut="lolite()" onClick="logVariable('hassystem')" href="../../_variables/hassystem.html">$hassystem</a>) {
<a name="l5188"><span class="linenum">5188</span></a>                  return <a class="var it30494" onMouseOver="hilite(30494)" onMouseOut="lolite()" onClick="logVariable('allresultsfilter')" href="../../_variables/allresultsfilter.html">$allresultsfilter</a>;
<a name="l5189"><span class="linenum">5189</span></a>              } else {
<a name="l5190"><span class="linenum">5190</span></a>                  return <a class="var it30495" onMouseOver="hilite(30495)" onMouseOut="lolite()" onClick="logVariable('noresultsfilter')" href="../../_variables/noresultsfilter.html">$noresultsfilter</a>;
<a name="l5191"><span class="linenum">5191</span></a>              }
<a name="l5192"><span class="linenum">5192</span></a>          }
<a name="l5193"><span class="linenum">5193</span></a>  <span class="comment">        // Fetch all interesting contexts for further examination.</span>
<a name="l5194"><span class="linenum">5194</span></a>          <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it1041" onMouseOver="hilite(1041)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../../_variables/insql.html">$insql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it30497" onMouseOver="hilite(30497)" onMouseOut="lolite()" onClick="logVariable('filtercontexts')" href="../../_variables/filtercontexts.html">$filtercontexts</a>, <a class="constant" onClick="logConstant('SQL_PARAMS_NAMED')" href="../../_constants/SQL_PARAMS_NAMED.html" onMouseOver="constPopup(event,'SQL_PARAMS_NAMED')">SQL_PARAMS_NAMED</a>);
<a name="l5195"><span class="linenum">5195</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['level'] = <a class="constant" onClick="logConstant('CONTEXT_USER')" href="../../_constants/CONTEXT_USER.html" onMouseOver="constPopup(event,'CONTEXT_USER')">CONTEXT_USER</a>;
<a name="l5196"><span class="linenum">5196</span></a>          <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a> = <a class="class" onClick="logClass('context_helper')" href="../../_classes/context_helper.html" onMouseOver="classPopup(event,'context_helper')">context_helper</a>::<a class="function" onClick="logFunction('get_preload_record_columns_sql')" href="../../_functions/get_preload_record_columns_sql.html" onMouseOver="funcPopup(event,'get_preload_record_columns_sql')">get_preload_record_columns_sql</a>('ctx');
<a name="l5197"><span class="linenum">5197</span></a>          <a class="var it30500" onMouseOver="hilite(30500)" onMouseOut="lolite()" onClick="logVariable('interestingcontexts')" href="../../_variables/interestingcontexts.html">$interestingcontexts</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>('SELECT ' . <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../../_variables/fields.html">$fields</a> . '
<a name="l5198"><span class="linenum">5198</span></a>                                                         FROM {context} ctx
<a name="l5199"><span class="linenum">5199</span></a>                                                         WHERE ctx.contextlevel = :level
<a name="l5200"><span class="linenum">5200</span></a>                                                           AND ctx.id ' . <a class="var it1041" onMouseOver="hilite(1041)" onMouseOut="lolite()" onClick="logVariable('insql')" href="../../_variables/insql.html">$insql</a> . '
<a name="l5201"><span class="linenum">5201</span></a>                                                         ORDER BY ctx.id', <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l5202"><span class="linenum">5202</span></a>          if (<a class="var it30496" onMouseOver="hilite(30496)" onMouseOut="lolite()" onClick="logVariable('hassystem')" href="../../_variables/hassystem.html">$hassystem</a>) {
<a name="l5203"><span class="linenum">5203</span></a>  <span class="comment">            // If allowed at system, search for exceptions prohibiting the capability at user context.</span>
<a name="l5204"><span class="linenum">5204</span></a>              <a class="var it30501" onMouseOver="hilite(30501)" onMouseOut="lolite()" onClick="logVariable('excludeusers')" href="../../_variables/excludeusers.html">$excludeusers</a> = array();
<a name="l5205"><span class="linenum">5205</span></a>              foreach (<a class="var it30500" onMouseOver="hilite(30500)" onMouseOut="lolite()" onClick="logVariable('interestingcontexts')" href="../../_variables/interestingcontexts.html">$interestingcontexts</a> as <a class="var it18090" onMouseOver="hilite(18090)" onMouseOut="lolite()" onClick="logVariable('contextrecord')" href="../../_variables/contextrecord.html">$contextrecord</a>) {
<a name="l5206"><span class="linenum">5206</span></a>                  <a class="var it30502" onMouseOver="hilite(30502)" onMouseOut="lolite()" onClick="logVariable('candidateuserid')" href="../../_variables/candidateuserid.html">$candidateuserid</a> = <a class="var it18090" onMouseOver="hilite(18090)" onMouseOut="lolite()" onClick="logVariable('contextrecord')" href="../../_variables/contextrecord.html">$contextrecord</a>-&gt;<a onClick="logVariable('ctxinstance')" class="var it43749" onMouseOver="hilite(43749)" onMouseOut="lolite()" href="../../_variables/ctxinstance.html">ctxinstance</a>;
<a name="l5207"><span class="linenum">5207</span></a>                  <a class="class" onClick="logClass('context_helper')" href="../../_classes/context_helper.html" onMouseOver="classPopup(event,'context_helper')">context_helper</a>::<a class="function" onClick="logFunction('preload_from_record')" href="../../_functions/preload_from_record.html" onMouseOver="funcPopup(event,'preload_from_record')">preload_from_record</a>(<a class="var it18090" onMouseOver="hilite(18090)" onMouseOut="lolite()" onClick="logVariable('contextrecord')" href="../../_variables/contextrecord.html">$contextrecord</a>);
<a name="l5208"><span class="linenum">5208</span></a>                  <a class="var it639" onMouseOver="hilite(639)" onMouseOut="lolite()" onClick="logVariable('usercontext')" href="../../_variables/usercontext.html">$usercontext</a> = <a class="class" onClick="logClass('context_user')" href="../../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it30502" onMouseOver="hilite(30502)" onMouseOut="lolite()" onClick="logVariable('candidateuserid')" href="../../_variables/candidateuserid.html">$candidateuserid</a>);
<a name="l5209"><span class="linenum">5209</span></a>  <span class="comment">                // Has capability should use the data already preloaded.</span>
<a name="l5210"><span class="linenum">5210</span></a>                  if (!<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(<a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>, <a class="var it639" onMouseOver="hilite(639)" onMouseOut="lolite()" onClick="logVariable('usercontext')" href="../../_variables/usercontext.html">$usercontext</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>)) {
<a name="l5211"><span class="linenum">5211</span></a>                      <a class="var it30501" onMouseOver="hilite(30501)" onMouseOut="lolite()" onClick="logVariable('excludeusers')" href="../../_variables/excludeusers.html">$excludeusers</a>[<a class="var it30502" onMouseOver="hilite(30502)" onMouseOut="lolite()" onClick="logVariable('candidateuserid')" href="../../_variables/candidateuserid.html">$candidateuserid</a>] = <a class="var it30502" onMouseOver="hilite(30502)" onMouseOut="lolite()" onClick="logVariable('candidateuserid')" href="../../_variables/candidateuserid.html">$candidateuserid</a>;
<a name="l5212"><span class="linenum">5212</span></a>                  }
<a name="l5213"><span class="linenum">5213</span></a>              }
<a name="l5214"><span class="linenum">5214</span></a>  
<a name="l5215"><span class="linenum">5215</span></a>  <span class="comment">            // Construct SQL excluding users with this role assigned for this user.</span>
<a name="l5216"><span class="linenum">5216</span></a>              if (empty(<a class="var it30501" onMouseOver="hilite(30501)" onMouseOut="lolite()" onClick="logVariable('excludeusers')" href="../../_variables/excludeusers.html">$excludeusers</a>)) {
<a name="l5217"><span class="linenum">5217</span></a>                  <a class="var it30500" onMouseOver="hilite(30500)" onMouseOut="lolite()" onClick="logVariable('interestingcontexts')" href="../../_variables/interestingcontexts.html">$interestingcontexts</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l5218"><span class="linenum">5218</span></a>                  return <a class="var it30494" onMouseOver="hilite(30494)" onMouseOut="lolite()" onClick="logVariable('allresultsfilter')" href="../../_variables/allresultsfilter.html">$allresultsfilter</a>;
<a name="l5219"><span class="linenum">5219</span></a>              }
<a name="l5220"><span class="linenum">5220</span></a>              <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it30501" onMouseOver="hilite(30501)" onMouseOut="lolite()" onClick="logVariable('excludeusers')" href="../../_variables/excludeusers.html">$excludeusers</a>, <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>, <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../_variables/prefix.html">$prefix</a>, false);
<a name="l5221"><span class="linenum">5221</span></a>          } else {
<a name="l5222"><span class="linenum">5222</span></a>  <span class="comment">            // If not allowed at system, search for exceptions allowing the capability at user context.</span>
<a name="l5223"><span class="linenum">5223</span></a>              <a class="var it30503" onMouseOver="hilite(30503)" onMouseOut="lolite()" onClick="logVariable('allowusers')" href="../../_variables/allowusers.html">$allowusers</a> = array();
<a name="l5224"><span class="linenum">5224</span></a>              foreach (<a class="var it30500" onMouseOver="hilite(30500)" onMouseOut="lolite()" onClick="logVariable('interestingcontexts')" href="../../_variables/interestingcontexts.html">$interestingcontexts</a> as <a class="var it18090" onMouseOver="hilite(18090)" onMouseOut="lolite()" onClick="logVariable('contextrecord')" href="../../_variables/contextrecord.html">$contextrecord</a>) {
<a name="l5225"><span class="linenum">5225</span></a>                  <a class="var it30502" onMouseOver="hilite(30502)" onMouseOut="lolite()" onClick="logVariable('candidateuserid')" href="../../_variables/candidateuserid.html">$candidateuserid</a> = <a class="var it18090" onMouseOver="hilite(18090)" onMouseOut="lolite()" onClick="logVariable('contextrecord')" href="../../_variables/contextrecord.html">$contextrecord</a>-&gt;<a onClick="logVariable('ctxinstance')" class="var it43749" onMouseOver="hilite(43749)" onMouseOut="lolite()" href="../../_variables/ctxinstance.html">ctxinstance</a>;
<a name="l5226"><span class="linenum">5226</span></a>                  <a class="class" onClick="logClass('context_helper')" href="../../_classes/context_helper.html" onMouseOver="classPopup(event,'context_helper')">context_helper</a>::<a class="function" onClick="logFunction('preload_from_record')" href="../../_functions/preload_from_record.html" onMouseOver="funcPopup(event,'preload_from_record')">preload_from_record</a>(<a class="var it18090" onMouseOver="hilite(18090)" onMouseOut="lolite()" onClick="logVariable('contextrecord')" href="../../_variables/contextrecord.html">$contextrecord</a>);
<a name="l5227"><span class="linenum">5227</span></a>                  <a class="var it639" onMouseOver="hilite(639)" onMouseOut="lolite()" onClick="logVariable('usercontext')" href="../../_variables/usercontext.html">$usercontext</a> = <a class="class" onClick="logClass('context_user')" href="../../_classes/context_user.html" onMouseOver="classPopup(event,'context_user')">context_user</a>::<a class="function" onClick="logFunction('instance')" href="../../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(<a class="var it30502" onMouseOver="hilite(30502)" onMouseOut="lolite()" onClick="logVariable('candidateuserid')" href="../../_variables/candidateuserid.html">$candidateuserid</a>);
<a name="l5228"><span class="linenum">5228</span></a>  <span class="comment">                // Has capability should use the data already preloaded.</span>
<a name="l5229"><span class="linenum">5229</span></a>                  if (<a class="function" onClick="logFunction('has_capability')" href="../../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(<a class="var it787" onMouseOver="hilite(787)" onMouseOut="lolite()" onClick="logVariable('capability')" href="../../_variables/capability.html">$capability</a>, <a class="var it639" onMouseOver="hilite(639)" onMouseOut="lolite()" onClick="logVariable('usercontext')" href="../../_variables/usercontext.html">$usercontext</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../../_variables/userid.html">$userid</a>)) {
<a name="l5230"><span class="linenum">5230</span></a>                      <a class="var it30503" onMouseOver="hilite(30503)" onMouseOut="lolite()" onClick="logVariable('allowusers')" href="../../_variables/allowusers.html">$allowusers</a>[<a class="var it30502" onMouseOver="hilite(30502)" onMouseOut="lolite()" onClick="logVariable('candidateuserid')" href="../../_variables/candidateuserid.html">$candidateuserid</a>] = <a class="var it30502" onMouseOver="hilite(30502)" onMouseOut="lolite()" onClick="logVariable('candidateuserid')" href="../../_variables/candidateuserid.html">$candidateuserid</a>;
<a name="l5231"><span class="linenum">5231</span></a>                  }
<a name="l5232"><span class="linenum">5232</span></a>              }
<a name="l5233"><span class="linenum">5233</span></a>  
<a name="l5234"><span class="linenum">5234</span></a>  <span class="comment">            // Construct SQL excluding users with this role assigned for this user.</span>
<a name="l5235"><span class="linenum">5235</span></a>              if (empty(<a class="var it30503" onMouseOver="hilite(30503)" onMouseOut="lolite()" onClick="logVariable('allowusers')" href="../../_variables/allowusers.html">$allowusers</a>)) {
<a name="l5236"><span class="linenum">5236</span></a>                  <a class="var it30500" onMouseOver="hilite(30500)" onMouseOut="lolite()" onClick="logVariable('interestingcontexts')" href="../../_variables/interestingcontexts.html">$interestingcontexts</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l5237"><span class="linenum">5237</span></a>                  return <a class="var it30495" onMouseOver="hilite(30495)" onMouseOut="lolite()" onClick="logVariable('noresultsfilter')" href="../../_variables/noresultsfilter.html">$noresultsfilter</a>;
<a name="l5238"><span class="linenum">5238</span></a>              }
<a name="l5239"><span class="linenum">5239</span></a>              <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it30503" onMouseOver="hilite(30503)" onMouseOut="lolite()" onClick="logVariable('allowusers')" href="../../_variables/allowusers.html">$allowusers</a>, <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>, <a class="var it416" onMouseOver="hilite(416)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../_variables/prefix.html">$prefix</a>);
<a name="l5240"><span class="linenum">5240</span></a>          }
<a name="l5241"><span class="linenum">5241</span></a>          <a class="var it30500" onMouseOver="hilite(30500)" onMouseOut="lolite()" onClick="logVariable('interestingcontexts')" href="../../_variables/interestingcontexts.html">$interestingcontexts</a>-&gt;<a class="function" onClick="logFunction('close')" href="../../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l5242"><span class="linenum">5242</span></a>  
<a name="l5243"><span class="linenum">5243</span></a>  <span class="comment">        // Return the goods!.</span>
<a name="l5244"><span class="linenum">5244</span></a>          return array(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>);
<a name="l5245"><span class="linenum">5245</span></a>      }
<a name="l5246"><span class="linenum">5246</span></a>  
<a name="l5247"><span class="linenum">5247</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'get_by_courseid': ['get_by_courseid', 'Get a the course settings for a single course. ', [['competency/classes','course_competency_settings.php',61]], 9],
'is_siteadmin': ['is_siteadmin', 'Check if the user is an admin at the site level. ', [['lib','accesslib.php',602]], 95],
'get_user_competency_by_id': ['get_user_competency_by_id', 'Get a user competency by ID. ', [['competency/classes','api.php',1164]], 3],
'grade_competency_in_plan': ['grade_competency_in_plan', 'Manually grade a user competency from the plans page. ', [['competency/classes','api.php',4772],['competency/classes','external.php',3776]], 6],
'is_enabled': ['is_enabled', 'Tools cannot be disabled. ', [['lib/classes/plugininfo','tool.php',39],['admin/tool/recyclebin/classes','category_bin.php',54],['admin/tool/log/classes/plugininfo','logstore.php',35],['admin/tool/recyclebin/classes','course_bin.php',54],['mod/assign/feedback/offline','locallib.php',380],['admin/tool/recyclebin/classes','base_bin.php',38],['lib','adminlib.php',1955],['search/classes','base.php',190],['lib','medialib.php',318],['lib','medialib.php',635],['lib','medialib.php',1268],['admin/tool/health','index.php',393],['lib/classes/plugininfo','mnetservice.php',33],['lib/classes/message/inbound','manager.php',37],['mod/assignment/classes/plugininfo','assignment.php',32],['competency/classes','api.php',49],['mod/assign','assignmentplugin.php',223],['lib/classes/plugininfo','orphaned.php',37],['search/tests/fixtures','mock_search_area.php',38],['tag/classes','area.php',106],['lib/classes/plugininfo','base.php',383],['mod/assign/feedback/editpdf','locallib.php',340],['tag/classes','tag.php',1269],['mod/assign/submission/comments','locallib.php',172],['lib','completionlib.php',269]], 276],
'list_courses_min': ['list_courses_min', 'Return the course IDs and visible flags that include this competency. ', [['competency/classes','course_competency.php',217]], 1],
'set_taxonomies': ['set_taxonomies', 'Convenience method to set taxonomies from an array or string. ', [['competency/classes','competency_framework.php',210]], 2],
'list_plans_for_template': ['list_plans_for_template', 'List the plans in the template, filtered by status. ', [['competency/classes','api.php',4946]], 2],
'count_frameworks': ['count_frameworks', 'Perform a search based on the provided filters and return a paginated list of records. ', [['competency/classes','api.php',834]], 1],
'record_exists_select': ['record_exists_select', 'Check if a records exists. ', [['competency/classes','persistent.php',853],['lib/dml','moodle_database.php',1830]], 85],
'list_templates_using_competency': ['list_templates_using_competency', 'List all the learning plan templatesd using a competency. ', [['competency/classes','api.php',2027],['competency/classes','external.php',2036]], 3],
'list_related_competencies': ['list_related_competencies', 'List all the related competencies. ', [['competency/classes','api.php',3632]], 7],
'delete_multiple_relations': ['delete_multiple_relations', 'Delete relations using competencies. ', [['competency/classes','related_competency.php',194]], 2],
'get_draft_statuses': ['get_draft_statuses', 'Get the list of draft statuses. ', [['competency/classes','plan.php',539]], 3],
'remove_competency_from_course': ['remove_competency_from_course', 'Remove a competency from this course. ', [['competency/classes','api.php',1592],['competency/classes','external.php',1445]], 2],
'get_name': ['get_name', 'Return localised event name. ', [['lib/classes/event','competency_plan_unlinked.php',72],['admin/tool/langimport/classes/task','update_langpacks_task.php',35],['lib/simplepie/library/SimplePie','Author.php',106],['portfolio/download','lib.php',10],['backup/util/structure','restore_path_element.class.php',98],['lib/classes/message/inbound','private_files_handler.php',56],['lib/classes/event','grouping_group_assigned.php',48],['calendar/tests','calendartype_test_example.php',32],['lib/classes/event','enrol_instance_deleted.php',70],['report/log/classes/event','user_report_viewed.php',54],['lib/classes/task','blog_cron_task.php',31],['mod/quiz/classes/event','attempt_reviewed.php',53],['lib/classes/event','tag_unflagged.php',55],['lib/classes/task','send_new_user_passwords_task.php',31],['lib/classes/event','role_unassigned.php',53],['mod/assign/classes/event','grading_form_viewed.php',82],['question/classes/bank','edit_action_column.php',35],['admin/tool/log/store/standard/classes/task','cleanup_task.php',31],['mod/workshop/classes/event','submission_deleted.php',63],['mod/forum/classes/event','discussion_updated.php',65],['lib/classes/event','course_module_instance_list_viewed.php',75],['lib/classes/event','course_created.php',55],['lib/dml','pdo_moodle_database.php',113],['mod/assign/classes/event','extension_granted.php',77],['lib/classes/task','tag_cron_task.php',33],['enrol/imsenterprise/classes/task','cron_task.php',34],['lib/classes/event','course_deleted.php',56],['lib/classes/task','completion_daily_task.php',33],['mod/forum/classes/event','readtracking_enabled.php',64],['mod/wiki/classes/event','page_created.php',48],['lib/dml','oci_native_moodle_database.php',94],['lib/classes/event','competency_viewed.php',70],['mod/choice/classes/event','answer_updated.php',72],['lib/classes/event','search_indexed.php',47],['lib/classes/event','badge_criteria_updated.php',53],['question/classes/bank','question_type_column.php',26],['mod/wiki/classes/event','page_version_deleted.php',54],['lib/grade','grade_item.php',1384],['lib/classes/event','competency_user_competency_rated_in_plan.php',88],['lib/classes/event','webservice_token_sent.php',56],['mod/glossary/classes/event','entry_deleted.php',54],['admin/tool/messageinbound/classes/message/inbound','invalid_recipient_handler.php',60],['lib/classes/event','competency_template_viewed.php',63],['lib/classes/task','context_cleanup_task.php',32],['mod/assign/tests/fixtures','event_mod_assign_fixtures.php',62],['admin/tool/langimport/classes/event','langpack_removed.php',89],['mod/glossary/classes/event','category_deleted.php',46],['mod/forum/classes/message/inbound','reply_handler.php',51],['competency/classes','competency_rule.php',84],['mod/lti/classes/event','unknown_service_api_called.php',82],['lib/classes/event','badge_deleted.php',49],['mod/quiz/classes/event','user_override_updated.php',54],['lib/classes/event','message_contact_added.php',48],['lib/classes/event','cohort_member_added.php',49],['backup/util/ui','restore_ui.class.php',351],['lib/classes/event','blog_entry_updated.php',74],['mod/assign/classes/event','workflow_state_updated.php',88],['mod/forum/classes/event','assessable_uploaded.php',86],['mod/assign/classes/event','submission_created.php',57],['lib/classes/event','group_deleted.php',65],['lib/classes/event','role_allow_assign_updated.php',47],['mod/lesson/classes/event','highscore_added.php',59],['mod/forum/classes/event','discussion_pinned.php',55],['lib/classes/event','webservice_function_called.php',67],['lib/classes/event','competency_plan_reopened.php',75],['mod/lesson/classes/event','essay_attempt_viewed.php',48],['mod/wiki/classes/event','page_locks_deleted.php',54],['lib/classes/event','webservice_service_deleted.php',59],['mod/forum/classes/event','discussion_subscription_created.php',66],['admin/tool/log/store/database/tests/fixtures','event.php',31],['mod/workshop/classes/event','assessable_uploaded.php',93],['lib','csslib.php',2155],['lib','csslib.php',2283],['lib/classes/event','user_loggedout.php',54],['lib/classes/event','webservice_token_created.php',65],['lib/classes/event','tag_collection_updated.php',65],['competency/classes','competency_rule_all.php',84],['backup/util/settings','base_setting.class.php',145],['mod/data/classes/event','field_deleted.php',57],['mod/book/classes/event','chapter_created.php',79],['lib/classes/event','email_failed.php',56],['lib/classes/task','stats_cron_task.php',31],['mod/survey/classes/event','report_downloaded.php',55],['mod/workshop/classes/event','phase_switched.php',75],['lib/grade','grade_category.php',2300],['lib/grade','grade_scale.php',156],['lib/classes/event','course_reset_started.php',53],['mod/workshop/classes/event','assessment_evaluated.php',66],['lib/classes/event','blog_association_created.php',56],['backup/converter','convertlib.php',109],['report/outline/classes/event','activity_report_viewed.php',48],['lib/classes/task','legacy_plugin_cron_task.php',33],['lib/classes/event','competency_plan_updated.php',75],['mod/choice/classes/event','answer_submitted.php',72],['mod/lesson/classes/event','lesson_ended.php',49],['lib/classes/event','role_allow_switch_updated.php',47],['lib/classes/task','portfolio_cron_task.php',31],['lib/classes/event','competency_user_competency_rated_in_course.php',88],['question/classes/bank','question_text_row.php',35],['lib/classes/event','tag_created.php',75],['report/participation/classes/event','report_viewed.php',58],['lib/classes/event','role_capabilities_updated.php',51],['mod/survey/classes/event','response_submitted.php',53],['lib/classes/event','badge_archived.php',47],['mod/workshop/classes/event','assessment_reevaluated.php',76],['mod/assign/classes/event','submission_locked.php',78],['report/outline/classes/event','report_viewed.php',54],['lib/classes/event','user_deleted.php',57],['lib/classes/event','mnet_access_control_updated.php',57],['mod/lesson/classes/event','essay_assessed.php',78],['mod/book/tool/print/classes/event','book_printed.php',76],['lib/classes/event','grouping_deleted.php',72],['admin/tool/monitor/classes','rule.php',239],['lib/classes/event','course_viewed.php',75],['mod/forum/classes/event','user_report_viewed.php',65],['user/selector','lib.php',309],['mod/quiz/classes/event','attempt_summary_viewed.php',56],['lib/classes/event','webservice_service_user_added.php',59],['mod/forum/classes/event','discussion_unpinned.php',55],['lib/classes/event','grouping_group_unassigned.php',48],['lib/grade','grade_outcome.php',272],['mod/chat/classes/event','message_sent.php',59],['lib/classes/event','role_assigned.php',56],['mod/quiz/classes/question/bank','question_name_text_column.php',37],['question/classes/bank','modifier_name_column.php',27],['mod/glossary/classes/event','entry_viewed.php',48],['mod/data/classes/event','record_created.php',56],['lib/classes/event','course_category_deleted.php',59],['lib/dml','mariadb_native_moodle_database.php',41],['lib/classes/event','role_deleted.php',55],['lib/classes/task','question_cron_task.php',31],['portfolio/flickr','lib.php',41],['lib/classes/task','cache_cron_task.php',31],['mod/wiki/classes/event','page_version_viewed.php',54],['admin/tool/recyclebin/classes/event','category_bin_item_deleted.php',47],['admin/tool/log/store/standard/tests/fixtures','event.php',31],['mod/scorm/classes/event','status_submitted.php',46],['admin/tool/monitor/classes/event','rule_created.php',50],['admin/tool/log/store/legacy/classes/task','cleanup_task.php',31],['question/classes/bank','checkbox_column.php',32],['lib/classes/event','competency_user_competency_plan_viewed.php',81],['mod/assign/feedback/offline','locallib.php',42],['admin/tool/messageinbound/classes/task','cleanup_task.php',38],['mod/workshop/classes/event','submission_updated.php',63],['lib/editor/atto/classes/task','autosave_cleanup_task.php',33],['mod/choice/classes/event','report_viewed.php',53],['mod/lesson/classes/event','group_override_deleted.php',54],['mod/wiki/classes/event','page_map_viewed.php',54],['admin/tool/log/store/legacy/tests/fixtures','event.php',31],['mod/lesson/classes/event','question_answered.php',54],['mod/choice/classes/event','report_downloaded.php',54],['admin/tool/recyclebin/classes/task','cleanup_category_bin.php',36],['backup/util/ui','backup_ui_setting.class.php',86],['lib/classes/event','competency_user_evidence_created.php',64],['lib/classes/event','course_module_completion_updated.php',54],['repository/coursefiles','lib.php',183],['lib/classes/event','note_updated.php',56],['lib/classes/event','note_created.php',56],['lib/classes/event','competency_framework_created.php',63],['lib/classes/event','course_resources_list_viewed.php',60],['lib/classes/event','tag_updated.php',58],['mod/forum/classes/event','subscribers_viewed.php',65],['mod/book/tool/exportimscp/classes/event','book_exported.php',76],['mod/quiz/classes/question/bank','add_action_column.php',45],['lib/classes/task','completion_regular_task.php',33],['lib/classes/event','user_enrolment_deleted.php',54],['grade/report/grader/classes/event','grade_report_viewed.php',39],['lib','enrollib.php',1076],['admin/tool/recyclebin/classes/event','course_bin_item_restored.php',47],['lib/classes/event','webservice_service_updated.php',59],['lib/editor/tinymce/classes','plugin.php',101],['mod/lesson/classes/event','group_override_created.php',55],['mod/scorm/classes/event','attempt_deleted.php',62],['lib/classes/event','competency_user_competency_review_request_cancelled.php',72],['lib/classes/event','webservice_service_created.php',65],['lib/classes/task','events_cron_task.php',31],['mod/wiki/classes/event','page_version_restored.php',54],['mod/forum/classes/event','discussion_deleted.php',66],['lib/classes/event','competency_framework_updated.php',73],['mod/lesson/classes/event','lesson_restarted.php',48],['mod/wiki/classes/event','page_updated.php',54],['mod/assign/classes/event','marker_updated.php',89],['lib','modinfolib.php',1270],['mod/assign/feedback/editpdf/classes/task','convert_submissions.php',38],['lib/classes/event','course_module_updated.php',57],['repository','lib.php',1834],['auth/cas/classes/task','sync_task.php',34],['lib/classes/event','competency_template_deleted.php',73],['mod/assign/classes/event','submission_confirmation_form_viewed.php',79],['lib/bennu','iCalendar_components.php',37],['report/questioninstances/classes/event','report_viewed.php',55],['admin/tool/recyclebin/classes/task','cleanup_course_bin.php',36],['lib/classes/event','message_contact_blocked.php',48],['lib/classes/event','competency_template_updated.php',75],['question/behaviour','behaviourbase.php',83],['grade/report/history/classes/event','grade_report_viewed.php',39],['lib/classes/event','badge_disabled.php',47],['mod/assign/classes/event','grading_table_viewed.php',79],['lib/classes/event','badge_enabled.php',47],['mod/lti','OAuth.php',122],['mod/lti','OAuth.php',149],['mod/lti','OAuth.php',173],['calendar/type/gregorian/classes','structure.php',29],['mod/quiz/classes/event','edit_page_viewed.php',53],['lib/simplepie/library/SimplePie','Credit.php',139],['mod/scorm/classes/event','tracks_viewed.php',64],['mod/wiki/classes/event','page_diff_viewed.php',55],['message/tests/fixtures','inbound_fixtures.php',41],['lib/classes/event','grouping_created.php',65],['lib/classes/event','calendar_event_deleted.php',58],['enrol/flatfile/classes/task','flatfile_sync_task.php',37],['lib/classes/event','group_updated.php',65],['lib/classes/task','registration_cron_task.php',31],['mod/book/classes/event','chapter_updated.php',79],['lib/classes/event','grade_deleted.php',94],['admin/tool/recyclebin/classes/event','course_bin_item_created.php',47],['lib/classes/event','user_loggedin.php',64],['lib/classes/task','check_for_updates_task.php',31],['grade/report/singleview/classes/local/ui','grade_attribute_format.php',56],['mod/assign/submission/file','locallib.php',44],['mod/forum/classes/task','cron_task.php',30],['mod/forum/classes/event','subscription_created.php',65],['lib/classes/event','tag_collection_created.php',65],['grade/report/overview/classes/event','grade_report_viewed.php',48],['mod/assign/classes/event','batch_set_marker_allocation_viewed.php',79],['mod/quiz/classes/event','group_override_updated.php',54],['lib/classes/event','competency_plan_created.php',63],['mod/glossary/classes/event','entry_disapproved.php',46],['lib/classes/task','send_failed_login_notifications_task.php',34],['enrol/lti/classes/task','sync_grades.php',36],['lib/classes/event','message_viewed.php',54],['portfolio/boxnet','lib.php',14],['lib/classes/event','comment_created.php',58],['question/classes/bank','preview_action_column.php',26],['lib/classes/event','course_content_deleted.php',54],['lib/dml','pgsql_native_moodle_database.php',87],['mod/feedback/classes/event','response_deleted.php',83],['lib/classes/event','competency_evidence_created.php',98],['lib/classes/event','comment_deleted.php',58],['lib/classes/event','competency_user_competency_review_requested.php',72],['mod/quiz/classes/event','attempt_abandoned.php',63],['mod/scorm/classes/event','user_report_viewed.php',62],['lib/dml','mssql_native_moodle_database.php',88],['mod/quiz/classes/event','attempt_becameoverdue.php',66],['mod/quiz/classes/event','group_override_created.php',55],['lib/dml','mysqli_native_moodle_database.php',352],['backup/util/ui','backup_ui.class.php',194],['mod/book/tool/print/classes/event','chapter_printed.php',79],['mod/data/classes/event','record_deleted.php',56],['competency/classes','competency_rule_points.php',185],['lib/classes/event','competency_user_competency_viewed.php',81],['lib/classes/event','dashboard_viewed.php',59],['mod/lesson/classes/event','question_viewed.php',54],['lib/classes/event','user_profile_viewed.php',56],['lib','medialib.php',345],['admin/tool/monitor/classes/task','clean_events.php',32],['mod/lesson/classes/event','user_override_deleted.php',53],['lib/classes/event','cohort_member_removed.php',50],['mod/lesson/classes/event','lesson_started.php',48],['mod/lesson/classes/event','page_updated.php',73],['mod/workshop/classes/event','submission_viewed.php',63],['question/classes/bank','question_name_column.php',28],['lib/classes/event','competency_deleted.php',87],['admin/tool/monitor/classes','subscription.php',132],['lib/classes/task','grade_cron_task.php',31],['mod/glossary/classes/event','entry_created.php',52],['lib/classes/task','file_temp_cleanup_task.php',31],['lib/classes/event','dashboard_reset.php',60],['backup/util/structure','base_atom.class.php',71],['portfolio/googledocs','lib.php',54],['mod/assign/feedback/comments','locallib.php',36],['mod/wiki/classes/event','page_history_viewed.php',48],['lib/classes/event','competency_plan_review_request_cancelled.php',75],['lib/classes/event','competency_plan_deleted.php',73],['mod/quiz/classes/event','attempt_viewed.php',54],['mod/data/classes/event','field_updated.php',57],['lib/classes/event','grouping_updated.php',65],['cache/classes','definition.php',621],['lib/classes/task','plagiarism_cron_task.php',31],['backup/converter/moodle1','lib.php',1033],['lib/classes/event','question_category_created.php',48],['grade/report/user/classes/event','grade_report_viewed.php',48],['lib/classes/event','user_login_failed.php',56],['mod/scorm/classes/event','report_viewed.php',63],['mod/chat/classes/event','sessions_viewed.php',65],['admin/tool/recyclebin/classes/event','course_bin_item_deleted.php',47],['mod/quiz/classes/event','user_override_deleted.php',53],['portfolio/mahara','lib.php',61],['mod/quiz/classes/event','attempt_submitted.php',63],['grade/report/outcomes/classes/event','grade_report_viewed.php',39],['mod/lesson/classes/event','group_override_updated.php',54],['mod/workshop/classes/event','submission_created.php',63],['mod/assign/classes/event','submission_updated.php',57],['mod/assign/submission/onlinetext/classes/event','assessable_uploaded.php',83],['lib/classes/event','competency_updated.php',70],['lib/classes/event','note_deleted.php',56],['mod/lesson/classes/event','page_moved.php',56],['lib/classes/event','course_completed.php',73],['lib/classes/event','tag_added.php',58],['lib/classes/event','competency_created.php',70],['mod/lesson/classes/event','highscores_viewed.php',51],['lib/classes/event','message_contact_unblocked.php',48],['lib/classes/event','user_enrolment_created.php',53],['lib/classes/task','search_index_task.php',35],['lib/classes/event','course_module_created.php',86],['lib/classes/event','webservice_service_user_removed.php',59],['report/log/classes/event','report_viewed.php',58],['mod/assign/submission/file/classes/event','assessable_uploaded.php',85],['lib/classes/event','group_member_added.php',78],['mod/forum/classes/event','discussion_viewed.php',60],['mod/assign/classes/event','submission_viewed.php',76],['mod/lti/classes/local/ltiservice','service_base.php',87],['enrol/lti/classes/task','sync_members.php',46],['mod/workshop/classes/event','submission_reassessed.php',77],['lib/classes/task','session_cleanup_task.php',31],['lib/tests','messageinbound_test.php',166],['lib/classes/task','backup_cleanup_task.php',31],['mod/workshop/classes/event','assessment_evaluations_reset.php',75],['mod/scorm/classes/event','scoreraw_submitted.php',46],['mod/assign/classes/event','statement_accepted.php',77],['mod/assign/classes/event','feedback_viewed.php',76],['lib/classes/task','delete_unconfirmed_users_task.php',31],['mod/forum/classes/event','discussion_moved.php',66],['lib/classes/event','competency_user_evidence_deleted.php',64],['mod/assign/classes/event','batch_set_workflow_state_viewed.php',79],['mod/lesson/classes/event','lesson_resumed.php',48],['lib/classes/task','badges_cron_task.php',31],['lib/classes/event','comments_viewed.php',51],['mod/data/classes/event','template_viewed.php',55],['mod/wiki/classes/event','page_deleted.php',54],['mod/quiz/classes/event','report_viewed.php',56],['mod/scorm/classes/event','sco_launched.php',64],['mod/glossary/classes/event','entry_updated.php',52],['mod/lesson/classes/event','user_override_created.php',53],['mod/glossary/classes/event','category_updated.php',46],['lib/classes/event','course_updated.php',58],['grade/report/singleview/classes/event','grade_report_viewed.php',39],['mod/feedback/classes/event','response_submitted.php',83],['lib/classes/event','blog_entry_deleted.php',53],['mod/book/classes/event','chapter_deleted.php',79],['report/completion/classes/event','report_viewed.php',49],['lib/classes/event','recent_activity_viewed.php',49],['mod/quiz/classes/event','question_manually_graded.php',55],['mod/assign/classes/event','submission_status_updated.php',79],['lib/classes/event','user_enrolment_updated.php',53],['lib/classes/event','tag_deleted.php',55],['report/completion/classes/event','user_report_viewed.php',49],['report/stats/classes/event','report_viewed.php',56],['lib/classes/event','calendar_event_created.php',58],['mod/assign/classes/event','submission_duplicated.php',77],['lib/classes/event','competency_framework_deleted.php',73],['lib/classes/event','course_section_updated.php',56],['lib/classes/event','message_sent.php',82],['lib/classes/event','calendar_subscription_deleted.php',56],['lib/classes/event','course_category_updated.php',51],['lib/classes/event','user_password_updated.php',70],['enrol/lti/ims-blti','OAuth.php',65],['enrol/lti/ims-blti','OAuth.php',92],['enrol/lti/ims-blti','OAuth.php',116],['mod/forum/classes/event','subscription_deleted.php',65],['mod/assign/classes/event','reveal_identities_confirmation_page_viewed.php',79],['lib/classes/event','user_loggedinas.php',57],['lib/classes/event','competency_template_created.php',63],['lib/classes/event','user_created.php',48],['admin/tool/recyclebin/classes/event','category_bin_item_restored.php',47],['report/loglive/classes/event','report_viewed.php',48],['admin/tool/monitor/classes/event','subscription_created.php',50],['mod/book/classes/event','chapter_viewed.php',79],['lib/classes/event','badge_awarded.php',54],['lib/classes/event','calendar_subscription_created.php',57],['lib/classes/event','enrol_instance_created.php',69],['lib/classes/event','user_list_viewed.php',56],['lib/classes/task','calendar_cron_task.php',31],['mod/forum/classes/event','post_deleted.php',67],['mod/quiz/classes/event','group_override_deleted.php',54],['lib/classes/event','badge_created.php',47],['backup/util/plan','base_plan.class.php',50],['lib/classes/event','base.php',292],['lib/classes/event','competency_framework_viewed.php',69],['lib/classes/event','tag_collection_deleted.php',65],['lib/classes/event','group_member_removed.php',69],['lib/classes/event','grade_report_viewed.php',54],['lib/classes/event','calendar_event_updated.php',58],['mod/assign/submission/onlinetext','locallib.php',40],['lib/classes/event','user_updated.php',48],['mod/lesson/classes/event','page_created.php',54],['backup/util/ui','base_ui_stage.class.php',110],['mod/assign/classes/event','submission_form_viewed.php',82],['auth/ldap/classes/task','sync_task.php',34],['lib/classes/event','course_completion_updated.php',47],['lib/classes/event','competency_plan_review_started.php',75],['lib/classes/event','course_user_report_viewed.php',66],['mod/folder/classes/event','all_files_downloaded.php',60],['mod/workshop/classes/event','assessments_reset.php',74],['lib/tests/fixtures','task_fixtures.php',35],['lib/tests/fixtures','task_fixtures.php',44],['lib/tests/fixtures','task_fixtures.php',53],['mod/data/classes/event','template_updated.php',56],['mod/assign/classes/event','identities_revealed.php',75],['question/classes/bank','copy_action_column.php',35],['admin/tool/log/store/legacy/classes/event','legacy_logged.php',35],['lib/classes/event','notes_viewed.php',49],['admin/tool/recyclebin/classes/event','category_bin_item_created.php',47],['lib/classes/event','competency_plan_viewed.php',63],['mod/data/classes/event','record_updated.php',56],['mod/assign/feedback/file','locallib.php',45],['lib/classes/event','competency_plan_unapproved.php',75],['mod/lesson/classes/event','content_page_viewed.php',48],['mod/assign/feedback/editpdf','locallib.php',43],['lib/dml','sqlsrv_native_moodle_database.php',108],['admin/tool/monitor/classes/event','subscription_deleted.php',50],['mod/assign/classes/event','assessable_submitted.php',109],['mod/quiz/classes/event','attempt_started.php',62],['lib/classes/task','create_contexts_task.php',31],['lib/classes/task','file_trash_cleanup_task.php',31],['lib/classes/event','competency_user_competency_rated.php',82],['mod/forum/classes/event','post_updated.php',67],['admin/tool/cohortroles/classes/task','cohort_role_sync.php',37],['lib/classes/event','course_module_deleted.php',56],['mod/assign/submission/comments','locallib.php',39],['lib/classes/event','competency_plan_review_requested.php',75],['lib/classes/event','user_graded.php',96],['lib/classes/event','webservice_login_failed.php',71],['mod/forum/classes/event','post_created.php',67],['lib/classes/task','complete_plans_task.php',43],['mod/assign/classes/event','submission_status_viewed.php',81],['lib/classes/event','enrol_instance_updated.php',70],['lib/classes/task','messaging_cleanup_task.php',31],['portfolio/picasa','lib.php',33],['admin/tool/capability/classes/event','report_viewed.php',47],['grade/report/singleview/classes/local/ui','unique_name.php',38],['mod/data/classes/event','field_created.php',58],['mod/folder/classes/event','folder_updated.php',48],['lib/classes/event','badge_updated.php',47],['lib/tests/fixtures','event_fixtures.php',34],['lib/classes/task','cache_cleanup_task.php',31],['mod/survey/classes/event','report_viewed.php',55],['mod/quiz/classes/event','attempt_deleted.php',53],['mod/glossary/classes/event','entry_approved.php',46],['mod/wiki/classes/event','page_viewed.php',57],['lib/classes/log','reader.php',30],['lib/classes/task','password_reset_cleanup_task.php',31],['mod/forum/classes/event','readtracking_disabled.php',64],['admin/tool/langimport/classes/event','langpack_imported.php',80],['lib/classes/event','competency_plan_review_stopped.php',75],['admin/tool/langimport/classes/event','langpack_updated.php',80],['lib/classes/event','unknown_logged.php',43],['lib/classes/event','competency_user_competency_viewed_in_plan.php',85],['lib/classes/event','competency_user_competency_viewed_in_course.php',84],['lib/classes/task','search_optimize_task.php',38],['mod/glossary/classes/event','category_created.php',46],['lib/portfolio','plugin.php',120],['report/stats/classes/event','user_report_viewed.php',48],['lib/classes/event','dashboards_reset.php',59],['lib/classes/event','calendar_subscription_updated.php',57],['lib/classes/event','cohort_updated.php',49],['admin/tool/monitor/classes/event','rule_updated.php',50],['mod/lesson/classes/event','page_deleted.php',54],['lib/classes/event','course_section_deleted.php',57],['lib/classes/task','delete_incomplete_users_task.php',31],['lib/classes/task','automated_backup_task.php',31],['admin/tool/monitor/classes/event','subscription_criteria_met.php',55],['lib/classes/event','mnet_access_control_created.php',57],['admin/tool/messageinbound/classes/task','pickup_task.php',38],['mod/forum/classes/event','discussion_created.php',65],['question/classes/bank','creator_name_column.php',28],['lib/classes/event','blog_entries_viewed.php',62],['lib/classes/task','sync_plans_from_template_cohorts_task.php',41],['mod/quiz/classes/event','attempt_preview_started.php',54],['lib/classes/event','content_viewed.php',80],['lib/classes/event','competency_user_evidence_updated.php',64],['lib/dml/tests','dml_test.php',5530],['mod/assign/classes/event','submission_graded.php',78],['mod/assign/classes/event','all_submissions_downloaded.php',75],['lib/classes/event','course_restored.php',58],['lib/classes/event','group_created.php',65],['lib/classes/event','badge_criteria_deleted.php',52],['lib/classes/event','tag_flagged.php',55],['lib/classes/event','competency_plan_completed.php',75],['mod/lesson/classes/event','user_override_updated.php',54],['lib/classes/event','role_allow_override_updated.php',47],['mod/forum/classes/event','discussion_subscription_deleted.php',66],['lib/classes/event','cohort_deleted.php',49],['lib/classes/event','badge_criteria_created.php',52],['admin/tool/log/classes/helper','reader.php',41],['admin/tool/monitor/classes/task','check_subscriptions.php',50],['lib/classes/event','blog_entry_created.php',76],['mod/scorm/classes/event','interactions_viewed.php',63],['mod/workshop/classes/event','submission_assessed.php',76],['lib/classes/event','badge_duplicated.php',47],['backup/util/plan','base_step.class.php',49],['lib/classes/event','course_category_created.php',48],['lib/classes/event','cohort_created.php',49],['lib/classes/event','tag_removed.php',58],['lib/classes/event','competency_plan_approved.php',75],['mod/choice/classes/event','answer_deleted.php',56],['backup/util/ui','restore_ui_stage.class.php',75],['lib/classes/event','competency_user_competency_review_started.php',72],['lib/classes/event','course_reset_ended.php',53],['mod/quiz/classes/event','user_override_created.php',53],['mod/forum/classes/event','course_searched.php',66],['lib/classes/event','message_contact_removed.php',48],['admin/tool/monitor/classes/event','rule_deleted.php',50],['lib/classes/event','message_deleted.php',91],['mod/assign/classes/event','submission_unlocked.php',78],['lib/classes/event','competency_user_competency_review_stopped.php',72],['lib/classes/event','course_module_viewed.php',62],['backup/util/plan','base_task.class.php',58],['question/classes/bank','delete_action_column.php',36]], 469],
'get_idnumber': ['get_idnumber', 'Returns the idnumber of this grade_item. This method is also available in grade_category, for cases where the object type is not know. ', [['lib/grade','grade_item.php',1296],['lib/grade','grade_category.php',2404]], 25],
'get_missing_plans': ['get_missing_plans', 'Return an array of user IDs for which the plans are missing. ', [['competency/classes','template_cohort.php',88]], 2],
'get_contextid': ['get_contextid', '', [['backup/moodle2','backup_block_task.class.php',96],['backup/moodle2','restore_activity_task.class.php',115],['backup/moodle2','restore_block_task.class.php',133],['lib/filebrowser','virtual_root_file.php',182],['lib/filestorage','stored_file.php',652],['backup/moodle2','restore_section_task.class.php',63],['backup/moodle2','backup_course_task.class.php',50],['backup/converter/moodle1','lib.php',524],['backup/moodle2','restore_course_task.class.php',57],['backup/moodle2','backup_activity_task.class.php',103]], 154],
'can_read_user_draft': ['can_read_user_draft', 'Can the current user view a user\'s draft plan? ', [['competency/classes','plan.php',447]], 28],
'delete_records': ['delete_records', 'Delete the records from a table where all the given conditions met. If conditions not specified, table is truncated. ', [['lib/dml','sqlite3_pdo_moodle_database.php',345],['lib/dml','moodle_database.php',1864]], 773],
'get_status': ['get_status', '', [['backup/util/settings','base_setting.class.php',157],['completion/criteria','completion_criteria_date.php',134],['lib/filebrowser','file_info.php',348],['lib/filebrowser','virtual_root_file.php',281],['lib/filebrowser','file_info_stored.php',321],['lib/filestorage','stored_file.php',777],['completion/criteria','completion_criteria.php',249],['completion','completion_criteria_completion.php',158],['grade/grading/form','lib.php',863],['mod/workshop/allocation','lib.php',128],['completion/criteria','completion_criteria_grade.php',162],['lib/classes/plugininfo','base.php',344],['backup/controller','backup_controller.class.php',287],['completion/criteria','completion_criteria_duration.php',180],['backup/controller','restore_controller.class.php',297]], 180],
'can_be_edited': ['can_be_edited', 'Check if plan can be edited. ', [['competency/classes','plan.php',622],['mod/quiz/classes','structure.php',269]], 18],
'can_delete_user': ['can_delete_user', 'Whether the current user can delete an evidence in the context of a user. ', [['competency/classes','evidence.php',277]], 2],
'can_grade_user': ['can_grade_user', 'Can the current user grade a user\'s user competency? ', [['competency/classes','user_competency.php',350]], 4],
'get_coursemodule_from_id': ['get_coursemodule_from_id', 'Given an id of a course module, finds the coursemodule description ', [['lib','datalib.php',1238]], 212],
'create_from_competency': ['create_from_competency', 'Convenience method to instantiate the event. ', [['lib/classes/event','competency_viewed.php',43],['lib/classes/event','competency_deleted.php',42],['lib/classes/event','competency_updated.php',43],['lib/classes/event','competency_created.php',43]], 4],
'duplicate_framework': ['duplicate_framework', 'Duplicate a competency framework by id. ', [['competency/classes','api.php',565]], 5],
'list': ['list', '', [['mod/data/preset/imagegallery','jstemplate.js',9]], 2229],
'isguestuser': ['isguestuser', 'Determines if a user is logged in as real guest user with username \'guest\'. ', [['lib','accesslib.php',1923]], 260],
'create_plan_from_template': ['create_plan_from_template', 'Create a learning plan from a template. ', [['competency/classes','api.php',2468]], 7],
'list_plans_to_review': ['list_plans_to_review', 'List the plans to review. ', [['competency/classes','api.php',2342]], 4],
'list_course_module_competencies_in_course_module': ['list_course_module_competencies_in_course_module', 'List all the competencies linked to a course module. ', [['competency/classes','api.php',988]], 6],
'count_competencies_in_course': ['count_competencies_in_course', 'Count all the competencies in a course. ', [['competency/classes','api.php',1075],['competency/classes','external.php',1212]], 2],
'get_courseid': ['get_courseid', 'Id of the current course (for site feedbacks only) ', [['mod/feedback/classes','structure.php',80],['course/format','lib.php',222],['mod/quiz','attemptlib.php',175],['mod/quiz','attemptlib.php',717],['backup/util/plan','backup_plan.class.php',78],['comment','lib.php',1002],['mod/quiz/classes','structure.php',228],['question/classes/bank','view.php',217],['backup/util/plan','restore_plan.class.php',81],['backup/controller','backup_controller.class.php',267],['backup/util/plan','base_step.class.php',105],['backup/controller','restore_controller.class.php',269],['backup/util/plan','base_task.class.php',109]], 244],
'matches': ['matches', 'Whether or not the rule is matched. ', [['competency/classes','competency_rule_all.php',41],['auth/cas/CAS/CAS','ProxyChain.php',66],['auth/cas/CAS/CAS/ProxyChain','Any.php',51],['lib/behat/form_field','behat_form_checkbox.php',87],['auth/cas/CAS/CAS/ProxyChain','Interface.php',44],['lib/behat/form_field','behat_form_editor.php',94],['competency/classes','competency_rule_points.php',53],['lib/behat/form_field','behat_form_filemanager.php',109],['lib/behat/form_field','behat_form_field.php',120],['lib/behat/form_field','behat_form_select.php',107],['lib/behat/form_field','behat_form_text.php',59]], 24],
'update_multiple_from_template': ['update_multiple_from_template', 'Update from template. ', [['competency/classes','plan.php',577]], 1],
'template_has_related_data': ['template_has_related_data', 'Check if template has related data. ', [['competency/classes','api.php',3612],['competency/classes','external.php',2587]], 3],
'list_evidence': ['list_evidence', 'List all the evidence for a user competency. ', [['competency/classes','api.php',4094]], 6],
'list_frameworks': ['list_frameworks', 'Perform a search based on the provided filters and return a paginated list of records. ', [['competency/classes','api.php',782]], 9],
'create_from_user_competency_plan': ['create_from_user_competency_plan', 'Convenience method to instantiate the event. ', [['lib/classes/event','competency_user_competency_plan_viewed.php',49]], 1],
'list_courses_using_competency': ['list_courses_using_competency', 'List all the courses using a competency. ', [['competency/classes','api.php',1020],['admin/tool/lp/classes','external.php',317]], 3],
'get_multiple': ['get_multiple', 'Get multiple user_competency_plan for a user. ', [['competency/classes','user_competency_plan.php',230],['competency/classes','user_competency.php',481],['competency/classes','user_competency_course.php',198]], 9],
'get_path': ['get_path', '', [['backup/util/structure','restore_path_element.class.php',102],['lib','weblib.php',880],['competency/tests','persistent_test.php',530],['mod/lti/service/profile/classes/local/resource','profile.php',59],['backup/converter/moodle1','lib.php',1040],['mod/lti/classes/local/ltiservice','resource_base.php',103]], 56],
'is_valid': ['is_valid', 'Returns true if the value associated with this style is valid ', [['lib','csslib.php',2274],['lib','csslib.php',2527],['lib','csslib.php',2547],['lib','csslib.php',3480],['lib','csslib.php',4309],['lib','csslib.php',4363],['lib','csslib.php',4445],['lib','csslib.php',4496],['lib','csslib.php',4547],['lib/simplepie/library/SimplePie','IRI.php',763],['competency/classes','persistent.php',661],['lib/bennu','iCalendar_components.php',153]], 47],
'delete_by_frameworkid': ['delete_by_frameworkid', 'Delete competencies by framework ID. ', [['competency/classes','competency.php',839]], 1],
'hook_course_module_deleted': ['hook_course_module_deleted', 'Action to perform when a course module is deleted. ', [['competency/classes','api.php',4668]], 2],
'from_record': ['from_record', 'Populate this class with data from a DB record. ', [['competency/classes','persistent.php',320]], 18],
'get_errors': ['get_errors', 'Returns an array of errors that have occured ', [['lib','csslib.php',1017],['lib','csslib.php',2036],['competency/classes','persistent.php',670],['admin/tool/uploadcourse/classes','course.php',278],['admin/tool/lpmigrate/classes','framework_processor.php',332],['admin/tool/uploadcourse/classes','processor.php',250]], 66],
'get_framework': ['get_framework', 'Get the competency framework. ', [['competency/classes','competency.php',232],['lib/testing/classes','util.php',129]], 24],
'move_up_competency': ['move_up_competency', 'Reorder this competency. ', [['competency/classes','api.php',288],['competency/classes','external.php',1083]], 2],
'count_plans_for_template': ['count_plans_for_template', 'Count the plans in the template, filtered by status. ', [['competency/classes','api.php',4896]], 4],
'list_course_modules_using_competency': ['list_course_modules_using_competency', 'List all the courses modules using a competency in a course. ', [['competency/classes','api.php',957]], 6],
'get_competencies_by_userevidenceid': ['get_competencies_by_userevidenceid', 'Get competencies by user evidence ID. ', [['competency/classes','user_evidence_competency.php',86]], 2],
'read_template': ['read_template', 'Read a the details for a single learning plan template and return a record. ', [['competency/classes','api.php',1899],['competency/classes','external.php',1649]], 26],
'create_from_user_competency': ['create_from_user_competency', 'Convenience method to instantiate the event. ', [['lib/classes/event','competency_user_competency_rated_in_plan.php',49],['lib/classes/event','competency_user_competency_review_request_cancelled.php',42],['lib/classes/event','competency_user_competency_review_requested.php',42],['lib/classes/event','competency_user_competency_rated.php',47],['lib/classes/event','competency_user_competency_review_started.php',42],['lib/classes/event','competency_user_competency_review_stopped.php',42]], 6],
'set_url': ['set_url', 'Convenience method handling moodle_urls. ', [['competency/classes','evidence.php',151],['lib','outputcomponents.php',2828],['backup/cc/cc_lib','cc_weblink.php',50],['lib','pagelib.php',1227],['blocks/rss_client/classes/output','channel_image.php',89],['backup/util/ui','restore_ui_components.php',141],['mod/wiki','pagelib.php',245],['mod/wiki','pagelib.php',333],['mod/wiki','pagelib.php',425],['mod/wiki','pagelib.php',696],['mod/wiki','pagelib.php',721],['mod/wiki','pagelib.php',835],['mod/wiki','pagelib.php',879],['mod/wiki','pagelib.php',1008],['mod/wiki','pagelib.php',1112],['mod/wiki','pagelib.php',1219],['mod/wiki','pagelib.php',1462],['mod/wiki','pagelib.php',1864],['mod/wiki','pagelib.php',1932],['mod/wiki','pagelib.php',2104],['mod/wiki','pagelib.php',2165],['mod/wiki','pagelib.php',2221],['mod/wiki','pagelib.php',2286],['mod/wiki','pagelib.php',2334],['mod/wiki','pagelib.php',2382],['mod/wiki','pagelib.php',2486]], 596],
'get_user_fieldnames': ['get_user_fieldnames', 'Returns an array of user fields ', [['lib','moodlelib.php',3688]], 3],
'can_read_user_in_course': ['can_read_user_in_course', 'Can the current user read the user competencies of a user in a course? ', [['competency/classes','user_competency.php',385]], 5],
'create_from_user_competency_viewed': ['create_from_user_competency_viewed', 'Convenience method to instantiate the event. ', [['lib/classes/event','competency_user_competency_viewed.php',48]], 1],
'has_plans': ['has_plans', 'Returns true when the template has user learning plans. ', [['competency/classes','template.php',196]], 1],
'get_rule_object': ['get_rule_object', 'Get the rule object. ', [['competency/classes','competency.php',289]], 2],
'delete_plan': ['delete_plan', 'Deletes a plan. ', [['competency/classes','api.php',2755],['competency/classes','external.php',2866]], 12],
'get_preload_record_columns_sql': ['get_preload_record_columns_sql', 'Returns all fields necessary for context preloading from user $rec. ', [['lib','accesslib.php',6066]], 56],
'get_least_proficient_competencies_for_template': ['get_least_proficient_competencies_for_template', 'Get the list of competencies that were completed the least times (in completed plans) from a template. ', [['competency/classes','user_competency_plan.php',334],['competency/classes','api.php',4993]], 3],
'grade_competency_in_course': ['grade_competency_in_course', 'Manually grade a user course competency from the course page. ', [['competency/classes','api.php',4826],['competency/classes','external.php',4085]], 19],
'create_template_cohort': ['create_template_cohort', 'Create a new template cohort. ', [['competency/tests/generator','lib.php',410],['competency/classes','api.php',2239]], 20],
'create_relation': ['create_relation', 'Create a new user_competency_plan object. ', [['competency/classes','user_competency_plan.php',159],['competency/classes','user_competency.php',446],['competency/classes','user_competency_course.php',89]], 12],
'count_competencies': ['count_competencies', 'Count the competencies in this course. ', [['competency/classes','course_competency.php',255],['competency/classes','course_module_competency.php',183],['competency/classes','api.php',513],['competency/classes','template_competency.php',122],['competency/classes','external.php',972]], 15],
'file_save_draft_area_files': ['file_save_draft_area_files', 'Saves files from a draft file area to a real one (merging the list of files). Can rewrite URLs in some content at the same time if desired. ', [['lib','filelib.php',778]], 61],
'delete_template': ['delete_template', 'Delete a learning plan template by id. If the learning plan template has associated cohorts they will be deleted. ', [['competency/classes','api.php',1771],['competency/classes','external.php',1702]], 11],
'count_proficient_competencies': ['count_proficient_competencies', 'Count the proficient competencies in this course for one user. ', [['competency/classes','user_competency_course.php',234]], 1],
'list_competencies_in_template': ['list_competencies_in_template', 'List all the competencies in a template. ', [['competency/classes','api.php',2098],['competency/classes','external.php',2133]], 6],
'get_user_competencies_by_userevidenceid': ['get_user_competencies_by_userevidenceid', 'Get user competencies by user evidence ID. ', [['competency/classes','user_evidence_competency.php',109]], 4],
'get_framework_tree': ['get_framework_tree', 'Build a framework tree with competency nodes. ', [['competency/classes','competency.php',719]], 1],
'can_read': ['can_read', 'Whether the current user can read the plan. ', [['competency/classes','plan.php',148],['competency/classes','user_competency.php',102],['competency/classes','user_evidence.php',81],['competency/classes','course_competency_settings.php',82],['competency/classes','competency_framework.php',488],['competency/classes','template.php',120]], 41],
'get_course': ['get_course', 'Get the course id. ', [['course','moodleform_mod.php',132],['search/classes','engine.php',102],['course/format','lib.php',231],['mod/quiz','attemptlib.php',180],['mod/quiz','attemptlib.php',722],['tag/classes','index_builder.php',296],['lib','modinfolib.php',180],['lib','modinfolib.php',1424],['lib','modinfolib.php',2706],['lib','datalib.php',568],['availability/classes','info.php',70],['mod/assign','locallib.php',1316],['admin/tool/uploadcourse/classes','processor.php',232],['enrol','locallib.php',912],['search/tests/fixtures','mock_search_engine.php',56]], 302],
'can_review': ['can_review', 'Whether the current user can review the plan. ', [['competency/classes','plan.php',178],['competency/classes','user_competency.php',129]], 8],
'count_records_select': ['count_records_select', 'Count a list of records. ', [['competency/classes','persistent.php',828],['lib/dml','moodle_database.php',1779]], 73],
'get_sortorder': ['get_sortorder', 'Returns the sortorder of this grade_item. This method is also available in grade_category, for cases where the object type is not know. ', [['lib/grade','grade_item.php',1286],['lib/grade','grade_category.php',2392],['lib/filebrowser','file_info.php',330],['lib/filebrowser','virtual_root_file.php',344],['lib/filebrowser','file_info_stored.php',303],['repository','lib.php',197],['lib/filestorage','stored_file.php',875]], 127],
'observe_course_module_completion_updated': ['observe_course_module_completion_updated', 'Observe when a course module is marked as completed. ', [['competency/classes','api.php',4548]], 0],
'read_user_evidence': ['read_user_evidence', 'Read a user evidence. ', [['competency/classes','api.php',3697],['competency/classes','external.php',3258]], 10],
'list_templates': ['list_templates', 'Perform a search based on the provided filters and return a paginated list of records. ', [['competency/classes','api.php',1922],['competency/classes','template_competency.php',88],['admin/tool/templatelibrary/classes','external.php',66],['admin/tool/templatelibrary/classes','api.php',41],['competency/classes','external.php',1870]], 11],
'create_from_user_evidence': ['create_from_user_evidence', 'Convenience method to instantiate the event. ', [['lib/classes/event','competency_user_evidence_created.php',45],['lib/classes/event','competency_user_evidence_deleted.php',45],['lib/classes/event','competency_user_evidence_updated.php',45]], 3],
'migrate_competency_tree_rules': ['migrate_competency_tree_rules', 'Recursively migrate competency rules. ', [['competency/classes','api.php',3996]], 2],
'read': ['read', 'Read data from incoming POP3 stream. ', [['lib/horde/framework/Horde/Imap/Client/Socket/Connection','Pop3.php',54],['auth/cas/CAS/CAS/PGTStorage','File.php',222],['competency/classes','persistent.php',354],['lib/horde/framework/Horde','Secret.php',79],['lib/spout/src/Spout/Reader/Wrapper','XMLReader.php',114],['lib/editor/tinymce/plugins/spellchecker/classes/utils','JSON.php',341],['auth/cas/CAS/CAS/PGTStorage','Db.php',384],['auth/cas/CAS/CAS/PGTStorage','AbstractStorage.php',203],['lib/jabber/XMPP','XMLStream.php',660],['lib/horde/framework/Horde/Imap/Client/Socket/Connection','Socket.php',110]], 170],
'get_cmid': ['get_cmid', '', [['mod/quiz','attemptlib.php',210],['mod/quiz','attemptlib.php',747],['mod/quiz/classes','structure.php',236]], 43],
'get_relations_by_templateid': ['get_relations_by_templateid', 'Get a relations by templateid. ', [['competency/classes','template_cohort.php',151]], 1],
'get_grade': ['get_grade', 'Get (or create if not exist yet) grade for this user ', [['lib/grade','grade_item.php',1265],['lib/classes/event','grade_deleted.php',81],['mod/assign','locallib.php',3195],['completion/criteria','completion_criteria_grade.php',96],['grade/grading/form/rubric','lib.php',868],['lib/classes/event','user_graded.php',72],['grade/grading/form/guide','lib.php',889]], 80],
'user_competency_viewed': ['user_competency_viewed', 'Log user competency viewed event. ', [['competency/classes','api.php',3510],['competency/classes','external.php',3843]], 3],
'remove_competency_from_plan': ['remove_competency_from_plan', 'Remove a competency from a plan. ', [['competency/classes','api.php',3300],['competency/classes','external.php',2301]], 4],
'count_competencies_with_no_courses': ['count_competencies_with_no_courses', 'Count the competencies in a template with no links to courses. ', [['competency/classes','template_competency.php',143]], 1],
'update_template': ['update_template', '', [['competency/tests','external_test.php',233],['competency/classes','api.php',1841],['competency/classes','external.php',1741]], 14],
'create_framework': ['create_framework', 'Create a new framework. ', [['competency/tests/generator','lib.php',129],['competency/classes','api.php',539]], 135],
'request_review_of_user_evidence_linked_competencies': ['request_review_of_user_evidence_linked_competencies', 'Send request review for user evidence competencies. ', [['competency/classes','api.php',3929],['competency/classes','external.php',3416]], 1],
'get_capability_info': ['get_capability_info', 'Returns capability information (cached) ', [['lib','accesslib.php',2961]], 13],
'create_user_evidence_competency': ['create_user_evidence_competency', 'Create a new user_evidence_comp. ', [['competency/tests/generator','lib.php',540],['competency/classes','api.php',3832],['competency/classes','external.php',3334]], 5],
'create_from_user_competency_viewed_in_plan': ['create_from_user_competency_viewed_in_plan', 'Convenience method to instantiate the event in plan. ', [['lib/classes/event','competency_user_competency_viewed_in_plan.php',49]], 1],
'get_relation': ['get_relation', 'Get a relation. ', [['competency/classes','template_cohort.php',125],['competency/classes','related_competency.php',97],['competency/classes','user_evidence_competency.php',137]], 7],
'delete_user_evidence': ['delete_user_evidence', 'Delete a user evidence. ', [['competency/classes','api.php',3778],['competency/classes','external.php',3298]], 2],
'list_course_competencies': ['list_course_competencies', 'List the course_competencies in this course. ', [['competency/classes','course_competency.php',369],['competency/classes','api.php',1098],['competency/classes','external.php',1319]], 8],
'approve_plan': ['approve_plan', 'Approve a plan. ', [['competency/classes','api.php',2941],['competency/classes','external.php',3051]], 11],
'complete_plan': ['complete_plan', 'Complete a plan. ', [['competency/classes','api.php',3017],['competency/classes','external.php',2742]], 27],
'trigger': ['trigger', '', [['lib/evalmath','evalmath.class.php',448],['lib/classes/event','base.php',765]], 964],
'count_records': ['count_records', 'Count a list of records. ', [['competency/classes','persistent.php',815],['mod/glossary/classes','entry_query_builder.php',152],['lib/dml','moodle_database.php',1766]], 1630],
'is_based_on_template': ['is_based_on_template', 'Check if a template is associated to the plan. ', [['competency/classes','plan.php',613]], 26],
'observe_course_completed': ['observe_course_completed', 'Observe when a course is marked as completed. ', [['competency/classes','api.php',4609]], 1],
'get_context_name': ['get_context_name', 'Returns human readable context identifier. ', [['lib','accesslib.php',5639],['lib','accesslib.php',6189],['lib','accesslib.php',6431],['lib','accesslib.php',6618],['lib','accesslib.php',6850],['lib','accesslib.php',7072],['lib','accesslib.php',7314]], 73],
'set_id': ['set_id', 'Setter for $id. ', [['lib/classes/task','adhoc_task.php',43],['lib/classes/message/inbound','handler.php',100],['blocks/rss_client/classes/output','item.php',140],['mnet','peer.php',253]], 26],
'get_file_storage': ['get_file_storage', 'Returns local file storage instance ', [['lib','moodlelib.php',6144]], 546],
'get_records_select': ['get_records_select', 'Load a list of records based on a select query. ', [['competency/classes','persistent.php',751],['lib/dml','moodle_database.php',1332]], 166],
'update_competency': ['update_competency', '', [['competency/tests','external_test.php',291],['competency/classes','api.php',395],['competency/classes','external.php',736]], 8],
'is_draft': ['is_draft', 'Is the plan in draft mode? ', [['competency/classes','plan.php',313]], 4],
'update_framework': ['update_framework', 'Update the details for a competency framework. ', [['competency/classes','api.php',692]], 3],
'create_plans_from_template_cohort': ['create_plans_from_template_cohort', 'Create learning plans from a template and cohort. ', [['competency/classes','api.php',2532]], 4],
'get_cm': ['get_cm', 'Returns the current course module ', [['mod/feedback/classes','complete_form.php',245],['search/classes','base_mod.php',51],['mod/feedback/classes','structure.php',72],['mod/quiz','attemptlib.php',215],['mod/quiz','attemptlib.php',742],['lib','modinfolib.php',222],['comment','lib.php',1010]], 137],
'get_records_by_competencyid_in_course': ['get_records_by_competencyid_in_course', 'List the relationship objects for a competency in a course. ', [['competency/classes','course_module_competency.php',301]], 1],
'grade_competency': ['grade_competency', 'Manually grade a user competency. ', [['competency/classes','api.php',4722],['competency/classes','external.php',3692]], 2],
'delete_area_files': ['delete_area_files', 'Delete all area files (optionally limited by itemid). ', [['lib/filestorage','file_storage.php',992]], 123],
'remove_competency_from_course_module': ['remove_competency_from_course_module', 'Remove a competency from this course module. ', [['competency/classes','api.php',1436]], 3],
'competency_framework_viewed': ['competency_framework_viewed', 'Logg the competency framework viewed event. ', [['competency/classes','api.php',738],['competency/classes','external.php',562]], 3],
'delete_template_cohort': ['delete_template_cohort', 'Remove a relation between a template and a cohort. ', [['competency/classes','api.php',2277]], 3],
'add_competency_to_template': ['add_competency_to_template', 'Add a competency to this template. ', [['competency/classes','api.php',2121],['competency/classes','external.php',2198]], 19],
'read_competency': ['read_competency', 'Read a the details for a single competency and return a record. ', [['competency/classes','api.php',429],['competency/classes','external.php',649]], 26],
'filter_users_with_capability_on_user_context_sql': ['filter_users_with_capability_on_user_context_sql', 'Function used to return a list of users where the given user has a particular capability. ', [['competency/classes','api.php',5105]], 3],
'get_competency': ['get_competency', 'Get a single competency from the course (only if it is really in the course). ', [['competency/classes','course_competency.php',304],['competency/classes','evidence.php',104],['competency/classes','user_competency_plan.php',74],['competency/classes','plan.php',234],['competency/classes','user_competency.php',207],['competency/classes','course_module_competency.php',232],['competency/classes','plan_competency.php',89],['competency/classes','template_competency.php',166],['competency/classes','user_competency_course.php',71]], 23],
'get_userid': ['get_userid', 'Returns user ID ', [['lib/filebrowser','virtual_root_file.php',236],['mod/quiz','attemptlib.php',804],['lib/filestorage','stored_file.php',708],['mod/data','lib.php',2585],['backup/util/plan','restore_task.class.php',54],['backup/util/plan','restore_plan.class.php',115],['backup/controller','backup_controller.class.php',283],['backup/controller','restore_controller.class.php',285]], 220],
'start_delegated_transaction': ['start_delegated_transaction', 'On DBs that support it, switch to transaction mode and begin a transaction you\'ll need to ensure you call allow_commit() on the returned object or your changes *will* be lost. ', [['lib/dml','moodle_database.php',2393]], 145],
'delete_competency': ['delete_competency', 'Delete a competency by id. ', [['competency/classes','api.php',183],['competency/classes','external.php',698]], 21],
'get_context': ['get_context', 'Return the course context for new modules, or the module context for existing modules. ', [['course','moodleform_mod.php',148],['availability/classes','info_module.php',72],['availability/classes','info_section.php',55],['competency/classes','user_competency_plan.php',83],['availability/tests/fixtures','mock_info.php',59],['mod/feedback/classes','responses_table.php',146],['competency/classes','competency.php',730],['competency/classes','plan.php',258],['mod/quiz','attemptlib.php',220],['competency/classes','user_competency.php',216],['grade/grading','lib.php',107],['lib','modinfolib.php',1486],['lib','badgeslib.php',157],['competency/classes/external','exporter.php',172],['comment','lib.php',994],['grade/grading/form','lib.php',102],['mod/assign','locallib.php',1307],['competency/classes','user_evidence.php',90],['competency/classes','user_competency_course.php',80],['lib/classes/event','base.php',627],['enrol','locallib.php',921],['lib','coursecatlib.php',2369],['lib','coursecatlib.php',3065],['competency/classes','course_competency_settings.php',133],['lib/tests/behat','behat_data_generators.php',769],['competency/classes','competency_framework.php',70],['competency/classes','template.php',139]], 1033],
'unlink_plan_from_template': ['unlink_plan_from_template', 'Unlink a plan from its template. ', [['competency/classes','api.php',2609],['competency/classes','external.php',4156]], 8],
'get_ids_by_frameworkid': ['get_ids_by_frameworkid', 'Get competencyids by frameworkid. ', [['competency/classes','competency.php',827]], 1],
'count_competencies_in_template': ['count_competencies_in_template', 'Count all the competencies in a learning plan template. ', [['competency/classes','api.php',2053],['competency/classes','external.php',2091]], 5],
'set_path': ['set_path', 'Set the ipath. ', [['lib/simplepie/library/SimplePie','IRI.php',1046],['competency/tests','persistent_test.php',538]], 3],
'user_competency_viewed_in_plan': ['user_competency_viewed_in_plan', 'Log user competency viewed in plan event. ', [['competency/classes','api.php',3532],['competency/classes','external.php',3898]], 4],
'get_recordset_select': ['get_recordset_select', 'Get a number of records as a moodle_recordset which match a particular WHERE clause. ', [['lib/dml','moodle_database.php',1224]], 45],
'get_user_competency_in_course': ['get_user_competency_in_course', 'Get a user competency in a course. ', [['competency/classes','api.php',1222]], 5],
'get_least_proficient_competencies_for_course': ['get_least_proficient_competencies_for_course', 'Get the most often not completed competency for this course. ', [['competency/classes','api.php',4972],['competency/classes','user_competency_course.php',256]], 4],
'getmessage': ['getmessage', '', [['lib/google/src/Google/Service','Freebase.php',441],['lib/google/src/Google/Service','AdSense.php',2970],['lib/google/src/Google/Service','Replicapool.php',1165],['lib/google/src/Google/Service','Replicapool.php',1257],['lib/google/src/Google/Service','Computeaccounts.php',1368],['lib/google/src/Google/Service','Computeaccounts.php',1460],['lib/google/src/Google/Service','Appengine.php',1604],['lib/google/src/Google/Service','Books.php',3579],['lib/google/src/Google/Service','Books.php',4429],['lib/google/src/Google/Service','Script.php',360],['lib/google/src/Google/Service','DeploymentManager.php',1116],['lib/google/src/Google/Service','DeploymentManager.php',1604],['lib/google/src/Google/Service','DeploymentManager.php',1641],['lib/google/src/Google/Service','DeploymentManager.php',1823],['lib/google/src/Google/Service','DeploymentManager.php',1860],['lib/google/src/Google/Service','Dataflow.php',2656],['lib/google/src/Google/Service','CloudUserAccounts.php',1807],['lib/google/src/Google/Service','CloudUserAccounts.php',1899],['lib/google/src/Google/Service','Replicapoolupdater.php',617],['lib/google/src/Google/Service','Replicapoolupdater.php',926],['lib/google/src/Google/Service','Replicapoolupdater.php',1018],['lib/google/src/Google/Service','Replicapoolupdater.php',1252],['lib/google/src/Google/Service','Bigquery.php',1367],['lib/google/src/Google/Service','ShoppingContent.php',4125],['lib/google/src/Google/Service','ShoppingContent.php',4527],['lib/google/src/Google/Service','ShoppingContent.php',4572],['lib/google/src/Google/Service','Genomics.php',3622],['lib/google/src/Google/Service','Reports.php',1106],['lib/google/src/Google/Service','Gmail.php',1371],['lib/google/src/Google/Service','Gmail.php',1467],['lib/google/src/Google/Service','Gmail.php',1495],['lib/google/src/Google/Service','Gmail.php',1513],['lib/google/src/Google/Service','Gmail.php',1531],['lib/google/src/Google/Service','Autoscaler.php',1079],['lib/google/src/Google/Service','Autoscaler.php',1171],['lib/google/src/Google/Service','AdExchangeSeller.php',1043],['lib/google/src/Google/Service','IdentityToolkit.php',1266],['lib/pear','PEAR.php',941],['lib/google/src/Google/Service','Storagetransfer.php',948],['lib/htmlpurifier/HTMLPurifier','Language.php',86],['lib/google/src/Google/Service','Resourceviews.php',894],['lib/google/src/Google/Service','Resourceviews.php',986],['lib/google/src/Google/Service','SQLAdmin.php',3029],['lib/google/src/Google/Service','Compute.php',8752],['lib/google/src/Google/Service','Compute.php',9200],['lib/google/src/Google/Service','Compute.php',10292],['lib/google/src/Google/Service','Compute.php',10384],['lib/google/src/Google/Service','Compute.php',10890],['lib/google/src/Google/Service','Compute.php',12525],['lib/google/src/Google/Service','Compute.php',12771],['lib/google/src/Google/Service','Compute.php',13249],['lib/google/src/Google/Service','Compute.php',13652],['lib/google/src/Google/Service','Compute.php',13804],['lib/google/src/Google/Service','Compute.php',14396],['lib/google/src/Google/Service','Compute.php',14488],['lib/google/src/Google/Service','Compute.php',14580],['lib/google/src/Google/Service','Compute.php',15235],['lib/google/src/Google/Service','Compute.php',16249],['lib/google/src/Google/Service','Compute.php',16675],['lib/google/src/Google/Service','Compute.php',17005],['lib/google/src/Google/Service','Compute.php',17723],['lib/google/src/Google/Service','Pubsub.php',711],['lib/google/src/Google/Service','Pubsub.php',748],['lib/google/src/Google/Service','Dfareporting.php',19533]], 489],
'require_enabled': ['require_enabled', 'Throws an exception if competencies are not enabled. ', [['competency/classes','api.php',62]], 132],
'get_id': ['get_id', 'Getter for $id. ', [['lib/classes/task','adhoc_task.php',51],['backup/converter','convertlib.php',100],['lib/filebrowser','virtual_root_file.php',290],['lib','adminlib.php',1719],['admin/tool/uploadcourse/classes','course.php',335],['lib/simplepie/library/SimplePie','Item.php',199],['lib/filestorage','stored_file.php',786],['cache/classes','definition.php',613],['grade/grading/form','lib.php',854],['question/engine','questionusage.php',120],['mod/lti/classes/local/ltiservice','service_base.php',76],['blocks/rss_client/classes/output','item.php',152],['backup/controller','backup_controller.class.php',263],['question/engine','questionattemptstep.php',136],['mod/lti/classes/local/ltiservice','resource_base.php',81]], 2250],
'list_user_competencies_in_course': ['list_user_competencies_in_course', 'List all the user competencies in a course. ', [['competency/classes','api.php',1258]], 3],
'create_user_evidence': ['create_user_evidence', 'Create a new user_evidence. ', [['competency/tests/generator','lib.php',510],['competency/classes','api.php',3715]], 7],
'get_default_grade': ['get_default_grade', 'Extracts the default grade from the scale configuration. ', [['competency/classes','competency.php',215]], 1],
'get_records_for_usercompetency': ['get_records_for_usercompetency', 'Load a list of records in a context for a user competency. ', [['competency/classes','evidence.php',287]], 1],
'get_config': ['get_config', 'Config get method. ', [['lib/classes/antivirus','scanner.php',54],['competency/classes','competency_rule.php',59],['question/engine','bank.php',109],['admin/tool/log/classes/helper','store.php',63],['lib','moodlelib.php',1409],['lib','enrollib.php',1142],['lib/editor/tinymce/classes','plugin.php',73],['competency/classes','competency_rule_points.php',43],['search/classes','base.php',169],['mod/assign','assignmentplugin.php',345],['lib/portfolio','plugin.php',546]], 934],
'validate_course': ['validate_course', 'Validate if current user have acces to the course if hidden. ', [['competency/classes','api.php',127]], 11],
'read_evidence': ['read_evidence', 'Read an evidence. ', [['competency/classes','api.php',4424]], 1],
'add_competency_to_course_module': ['add_competency_to_course_module', 'Add a competency to this course module. ', [['competency/classes','api.php',1393]], 6],
'archive_user_competencies_in_plan': ['archive_user_competencies_in_plan', 'Archive user competencies in a plan. ', [['competency/classes','api.php',4029]], 1],
'count_templates_using_competency': ['count_templates_using_competency', 'Count all the templates using a competency. ', [['competency/classes','api.php',2002],['competency/classes','external.php',1993]], 3],
'get_visible': ['get_visible', 'Return visibility ', [['repository','lib.php',188]], 16],
'remove_competency_from_template': ['remove_competency_from_template', 'Remove a competency from this template. ', [['competency/classes','api.php',2157],['competency/classes','external.php',2613]], 5],
'allow_commit': ['allow_commit', 'Commit delegated transaction. The real database commit SQL is executed only after committing all delegated transactions. ', [['lib/dml','moodle_transaction.php',78]], 135],
'delete_evidence': ['delete_evidence', 'Delete an evidence. ', [['competency/classes','api.php',4442],['competency/classes','external.php',4293]], 3],
'format_string': ['format_string', 'Given a simple string, this function returns the string processed by enabled string filters if $CFG->filterall is enabled ', [['lib','weblib.php',1379]], 880],
'list_course_modules': ['list_course_modules', 'Return the module IDs and visible flags that include this competency in a single course. ', [['competency/classes','course_module_competency.php',163]], 1],
'get_unused_idnumber': ['get_unused_idnumber', 'Get a uniq idnumber. ', [['competency/classes','competency_framework.php',448]], 1],
'get_timemodified': ['get_timemodified', 'Returns time modified unix timestamp if known ', [['lib/filebrowser','file_info.php',295],['lib/filebrowser','virtual_root_file.php',272],['lib/filebrowser','file_info_stored.php',258],['lib/filestorage','stored_file.php',756]], 63],
'hook_course_reset_competency_ratings': ['hook_course_reset_competency_ratings', 'Action to perform when a course is being reset. ', [['competency/classes','api.php',4696]], 1],
'or': ['or', '', [['lib/tcpdf','LICENSE.TXT',69]], 556],
'count_records_for_template': ['count_records_for_template', 'Count the number of records matching a specific template, optionally filtered by proficient values. ', [['competency/classes','user_competency_plan.php',307],['competency/classes','plan.php',683]], 2],
'hook_cohort_deleted': ['hook_cohort_deleted', 'Action to perform when a cohort is deleted. ', [['competency/classes','api.php',4709]], 1],
'is_enrolled': ['is_enrolled', 'Returns true if user is enrolled (is participating) in course this is intended for students and teachers. ', [['lib','accesslib.php',2038]], 145],
'get_related_competencies': ['get_related_competencies', 'Return the related competencies. ', [['competency/classes','competency.php',280],['competency/classes','related_competency.php',132]], 3],
'get_multiple_relations': ['get_multiple_relations', 'Get the related competencies from competency ids. ', [['competency/classes','related_competency.php',166]], 7],
'get_in_or_equal': ['get_in_or_equal', 'Constructs \'IN()\' or \'=\' sql fragment ', [['lib/dml','oci_native_moodle_database.php',1635],['lib/dml','moodle_database.php',711]], 438],
'can_manage_course': ['can_manage_course', 'Can the current user change competency settings for this course. ', [['competency/classes','course_competency_settings.php',96]], 2],
'get_course_context': ['get_course_context', '', [['lib','deprecatedlib.php',1907],['lib','accesslib.php',5764],['lib','accesslib.php',6909],['lib','accesslib.php',7170],['lib','accesslib.php',7381],['mod/assign','gradingtable.php',1372],['mod/assign','locallib.php',1268]], 86],
'count_templates': ['count_templates', 'Perform a search based on the provided filters and return how many results there are. ', [['competency/classes','api.php',1971],['competency/classes','template_competency.php',61],['competency/classes','external.php',1949]], 5],
'list_competencies': ['list_competencies', 'List the competencies in this course. ', [['competency/classes','course_competency.php',276],['competency/classes','user_competency_plan.php',176],['competency/classes','course_module_competency.php',204],['competency/classes','api.php',483],['competency/classes','plan_competency.php',60],['competency/classes','template_competency.php',191],['competency/classes','external.php',812]], 19],
'create_multiple_from_competencyids': ['create_multiple_from_competencyids', 'Instantiate events from competency ids. ', [['lib/classes/event','competency_deleted.php',60]], 2],
'delete': ['delete', 'Deletes an item from the cache store. ', [['cache/stores/static','lib.php',374],['cache','disabledlib.php',102],['lib/google/src/Google/Service','AdSense.php',1258],['lib/google/src/Google/Service','AdSense.php',1730],['lib/grade','grade_item.php',396],['lib/google/src/Google/Service','Replicapool.php',378],['lib/google/src/Google/Service','Tasks.php',310],['lib/google/src/Google/Service','Tasks.php',428],['lib/google/src/Google/Service','AndroidPublisher.php',1230],['lib/google/src/Google/Service','AndroidPublisher.php',1310],['lib/google/src/Google/Service','AndroidPublisher.php',1668],['lib/google/src/Google/Service','AndroidPublisher.php',1763],['lib/google/src/Google/Service','AndroidPublisher.php',2083],['lib/google/src/Google/Service','YouTubeReporting.php',255],['lib/google/src/Google/Service','Reseller.php',441],['lib/google/src/Google/Cache','Memcache.php',144],['lib','filelib.php',3481],['lib/google/src/Google/Service','Computeaccounts.php',418],['lib/google/src/Google/Service','Computeaccounts.php',497],['lib/google/src/Google/Service','Computeaccounts.php',668],['lib/grade','grade_category.php',281],['lib/grade','grade_scale.php',136],['lib/adodb','adodb-active-record.inc.php',901],['lib/grade','grade_object.php',270],['lib/google/src/Google/Service','YouTubeAnalytics.php',352],['lib/google/src/Google/Service','YouTubeAnalytics.php',447],['lib/google/src/Google/Service','MapsEngine.php',1693],['lib/google/src/Google/Service','MapsEngine.php',1991],['lib/google/src/Google/Service','MapsEngine.php',2344],['lib/google/src/Google/Service','MapsEngine.php',2651],['lib/google/src/Google/Service','MapsEngine.php',2912],['completion','data_object.php',273],['lib/google/src/Google/Cache','File.php',115],['cache/classes','dummystore.php',198],['lib/google/src/Google/Service','Dns.php',378],['cache/classes','loaders.php',792],['cache/classes','loaders.php',1471],['cache/classes','loaders.php',1841],['lib/google/src/Google/Service','Appengine.php',352],['lib/google/src/Google/Service','Appengine.php',455],['tag/classes','collection.php',260],['lib/filebrowser','file_info.php',418],['lib/google/src/Google/Service','AdExchangeBuyer.php',938],['lib/google/src/Google/Service','AdExchangeBuyer.php',1137],['lib/google/src/Google/Service','AdExchangeBuyer.php',1561],['lib/filebrowser','virtual_root_file.php',69],['lib/google/src/Google/Service','Books.php',1946],['lib/grade','grade_grade.php',1024],['lib/grade','grade_outcome.php',97],['lib/google/src/Google/Service','Analytics.php',2165],['lib/google/src/Google/Service','Analytics.php',2534],['lib/google/src/Google/Service','Analytics.php',2655],['lib/google/src/Google/Service','Analytics.php',2872],['lib/google/src/Google/Service','Analytics.php',3001],['lib/google/src/Google/Service','Analytics.php',3092],['lib/google/src/Google/Service','Analytics.php',3406],['lib/google/src/Google/Service','Analytics.php',3631],['lib/google/src/Google/Service','DeploymentManager.php',452],['lib/google/src/Google/Service','Blogger.php',1065],['lib/google/src/Google/Service','Blogger.php',1227],['lib/google/src/Google/Service','Blogger.php',1451],['lib/filebrowser','file_info_stored.php',631],['competency/classes','persistent.php',510],['lib/google/src/Google/Service','CloudUserAccounts.php',528],['lib/google/src/Google/Service','CloudUserAccounts.php',628],['lib/google/src/Google/Service','CloudUserAccounts.php',893],['lib/google/src/Google/Service','Cloudresourcemanager.php',390],['lib/htmlpurifier/HTMLPurifier','Zipper.php',89],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',960],['lib/google/src/Google/Service','TagManager.php',1022],['lib/google/src/Google/Service','TagManager.php',1113],['lib/google/src/Google/Service','TagManager.php',1265],['lib/google/src/Google/Service','TagManager.php',1358],['lib/google/src/Google/Service','TagManager.php',1452],['lib/google/src/Google/Service','TagManager.php',1546],['lib/google/src/Google/Service','TagManager.php',1696],['mod/lesson','locallib.php',1037],['mod/lesson','locallib.php',2271],['repository','lib.php',427],['repository','lib.php',1962],['admin/tool/uploadcourse/classes','course.php',226],['lib','badgeslib.php',640],['lib/google/src/Google/Service','Bigquery.php',531],['lib/google/src/Google/Service','Bigquery.php',863],['lib/google/src/Google/Service','ShoppingContent.php',1050],['lib/google/src/Google/Service','ShoppingContent.php',1448],['lib/google/src/Google/Service','ShoppingContent.php',1970],['lib/google/src/Google/Service','Webmasters.php',355],['lib/google/src/Google/Service','Webmasters.php',449],['lib/google/src/Google/Service','Clouddebugger.php',384],['lib/filestorage','stored_file.php',323],['lib/google/src/Google/Service','Container.php',309],['lib/google/src/Google/Service','Storage.php',1042],['lib/google/src/Google/Service','Storage.php',1157],['lib/google/src/Google/Service','Storage.php',1332],['lib/google/src/Google/Service','Storage.php',1454],['lib/google/src/Google/Service','Storage.php',1681],['cache/stores/memcache','lib.php',401],['lib/google/src/Google/Service','Genomics.php',646],['lib/google/src/Google/Service','Genomics.php',735],['lib/google/src/Google/Service','Genomics.php',903],['lib/google/src/Google/Service','Genomics.php',971],['lib/google/src/Google/Service','Genomics.php',1326],['lib/google/src/Google/Service','Genomics.php',1443],['lib/google/src/Google/Service','Licensing.php',224],['lib/google/src/Google/Service','Fitness.php',400],['lib/google/src/Google/Service','Fitness.php',512],['lib/google/src/Google/Service','Fitness.php',647],['comment','lib.php',790],['lib/google/src/Google/Service','Gmail.php',763],['lib/google/src/Google/Service','Gmail.php',921],['lib/google/src/Google/Service','Gmail.php',1014],['lib/google/src/Google/Service','Gmail.php',1234],['lib/google/src/Google/Service','Taskqueue.php',293],['lib/adodb','adodb-active-recordx.inc.php',1016],['lib','accesslib.php',5580],['cache/classes','interfaces.php',161],['lib/google/src/Google/Service','Autoscaler.php',315],['lib/google/src/Google/Service','Autoscaler.php',429],['lib/google/src/Google/Service','Prediction.php',262],['lib/google/src/Google/Service','SiteVerification.php',139],['lib/google/src/Google/Service','Drive.php',1522],['lib/google/src/Google/Service','Drive.php',1603],['lib/google/src/Google/Service','Drive.php',1748],['lib/google/src/Google/Service','Drive.php',2040],['lib/google/src/Google/Service','Drive.php',2110],['lib/google/src/Google/Service','Drive.php',2240],['lib/google/src/Google/Service','Drive.php',2403],['lib/google/src/Google/Service','Drive.php',2523],['lib/google/src/Google/Service','Proximitybeacon.php',522],['lib/google/src/Google/Service','Directory.php',1683],['lib/google/src/Google/Service','Directory.php',1916],['lib/google/src/Google/Service','Directory.php',1989],['lib/google/src/Google/Service','Directory.php',2059],['lib/google/src/Google/Service','Directory.php',2169],['lib/google/src/Google/Service','Directory.php',2224],['lib/google/src/Google/Service','Directory.php',2351],['lib/google/src/Google/Service','Directory.php',2420],['lib/google/src/Google/Service','Directory.php',2517],['lib/google/src/Google/Service','Directory.php',2652],['lib/google/src/Google/Service','Directory.php',2731],['lib/google/src/Google/Service','Directory.php',2836],['lib/google/src/Google/Service','Directory.php',2938],['lib/google/src/Google/Service','Directory.php',2999],['lib/google/src/Google/Service','Directory.php',3199],['lib/google/src/Google/Service','Directory.php',3274],['lib/google/src/Google/Service','Fusiontables.php',645],['lib/google/src/Google/Service','Fusiontables.php',812],['lib/google/src/Google/Service','Fusiontables.php',937],['lib/google/src/Google/Service','Fusiontables.php',1126],['lib/google/src/Google/Service','Fusiontables.php',1188],['lib/google/src/Google/Service','AdSenseHost.php',734],['lib/google/src/Google/Service','AdSenseHost.php',1010],['lib/google/src/Google/Service','AdSenseHost.php',1168],['lib/google/src/Google/Service','Mirror.php',425],['lib/google/src/Google/Service','Mirror.php',593],['lib/google/src/Google/Service','Mirror.php',661],['lib/google/src/Google/Service','Mirror.php',772],['tag/classes','area.php',187],['lib/google/src/Google/Service','AndroidEnterprise.php',988],['lib/google/src/Google/Service','AndroidEnterprise.php',1092],['lib/google/src/Google/Service','AndroidEnterprise.php',1280],['lib/google/src/Google/Service','AndroidEnterprise.php',1415],['lib/google/src/Google/Service','AndroidEnterprise.php',1597],['course','lib.php',3263],['mnet','peer.php',118],['search/tests/fixtures','mock_search_engine.php',48],['lib/google/src/Google/Service','Calendar.php',903],['lib/google/src/Google/Service','Calendar.php',1071],['lib/google/src/Google/Service','Calendar.php',1269],['lib/google/src/Google/Service','Calendar.php',1412],['cache/stores/session','lib.php',417],['blog','locallib.php',322],['lib/google/src/Google/Service','Storagetransfer.php',381],['cache/stores/mongodb','lib.php',361],['lib/google/src/Google/Cache','Null.php',53],['lib/google/src/Google/Service','GamesConfiguration.php',251],['lib/google/src/Google/Service','GamesConfiguration.php',390],['cache/stores/file','lib.php',393],['badges/criteria','award_criteria.php',330],['cache/stores/memcached','lib.php',402],['lib/google/src/Google/Service','AppState.php',154],['lib/google/src/Google/Service','Resourceviews.php',423],['lib/portfolio','plugin.php',692],['calendar','lib.php',2423],['lib/google/src/Google/Service','Classroom.php',466],['lib/google/src/Google/Service','Classroom.php',615],['lib/google/src/Google/Service','Classroom.php',701],['lib/google/src/Google/Service','Classroom.php',806],['lib/google/src/Google/Service','Classroom.php',934],['lib/google/src/Google/Service','SQLAdmin.php',786],['lib/google/src/Google/Service','SQLAdmin.php',856],['lib/google/src/Google/Service','SQLAdmin.php',1023],['lib/google/src/Google/Service','SQLAdmin.php',1368],['lib/google/src/Google/Service','SQLAdmin.php',1483],['badges/criteria','award_criteria_manual.php',220],['search/engine/solr/classes','engine.php',1045],['lib/google/src/Google/Service','Compute.php',4021],['lib/google/src/Google/Service','Compute.php',4149],['lib/google/src/Google/Service','Compute.php',4284],['lib/google/src/Google/Service','Compute.php',4571],['lib/google/src/Google/Service','Compute.php',4671],['lib/google/src/Google/Service','Compute.php',4829],['lib/google/src/Google/Service','Compute.php',4942],['lib/google/src/Google/Service','Compute.php',5033],['lib/google/src/Google/Service','Compute.php',5174],['lib/google/src/Google/Service','Compute.php',5248],['lib/google/src/Google/Service','Compute.php',5378],['lib/google/src/Google/Service','Compute.php',5508],['lib/google/src/Google/Service','Compute.php',5683],['lib/google/src/Google/Service','Compute.php',5984],['lib/google/src/Google/Service','Compute.php',6156],['lib/google/src/Google/Service','Compute.php',6316],['lib/google/src/Google/Service','Compute.php',6717],['lib/google/src/Google/Service','Compute.php',6898],['lib/google/src/Google/Service','Compute.php',7037],['lib/google/src/Google/Service','Compute.php',7128],['lib/google/src/Google/Service','Compute.php',7208],['lib/google/src/Google/Service','Compute.php',7299],['lib/google/src/Google/Service','Compute.php',7409],['lib/google/src/Google/Service','Compute.php',7570],['lib/google/src/Google/Service','Compute.php',7734],['lib/google/src/Google/Service','Compute.php',7938],['lib/google/src/Google/Service','Compute.php',8035],['lib/google/src/Google/Service','Compute.php',8210],['lib/google/src/Google/Service','Compute.php',8305],['lib/google/src/Google/Service','Pubsub.php',240],['lib/google/src/Google/Service','Pubsub.php',379],['lib/google/src/Google/Service','YouTube.php',1810],['lib/google/src/Google/Service','YouTube.php',2061],['lib/google/src/Google/Service','YouTube.php',2459],['lib/google/src/Google/Service','YouTube.php',2889],['lib/google/src/Google/Service','YouTube.php',3187],['lib/google/src/Google/Service','YouTube.php',3419],['lib/google/src/Google/Service','YouTube.php',3559],['lib/google/src/Google/Service','YouTube.php',3928],['lib/google/src/Google/Service','YouTube.php',4158],['lib/google/src/Google/Cache','Apc.php',105],['lib/google/src/Google/Service','Dfareporting.php',5000],['lib/google/src/Google/Service','Dfareporting.php',5566],['lib/google/src/Google/Service','Dfareporting.php',5753],['lib/google/src/Google/Service','Dfareporting.php',5877],['lib/google/src/Google/Service','Dfareporting.php',6397],['lib/google/src/Google/Service','Dfareporting.php',6578],['lib/google/src/Google/Service','Dfareporting.php',6731],['lib/google/src/Google/Service','Dfareporting.php',6996],['lib/google/src/Google/Service','Dfareporting.php',7503],['lib/google/src/Google/Service','Dfareporting.php',8102],['lib/google/src/Google/Service','Dfareporting.php',8768],['lib/google/src/Google/Service','Manager.php',244],['lib/google/src/Google/Service','Manager.php',324],['lib/google/src/Google/Service','CloudMonitoring.php',274],['lib','webdavlib.php',691]], 317],
'is_scale_used_anywhere': ['is_scale_used_anywhere', 'Checks whether a scale is used anywhere in the plugin. ', [['competency/classes','api.php',74]], 21],
'get_related_contexts': ['get_related_contexts', 'Fetches all the relevant contexts. ', [['competency/classes','api.php',864]], 16],
'where': ['where', '', [['question/engine','datalib.php',1883],['question/engine','datalib.php',1965],['mod/glossary/classes','entry_query_builder.php',448],['question/classes/bank/search','hidden_condition.php',53],['question/classes/bank/search','category_condition.php',96]], 64],
'preload_from_record': ['preload_from_record', 'Preloads context information from db record and strips the cached info. ', [['lib','accesslib.php',5250],['lib','accesslib.php',6079]], 61],
'add_competency_to_plan': ['add_competency_to_plan', 'Add a competency to a plan. ', [['competency/classes','api.php',3258],['competency/classes','external.php',2250]], 6],
'record_exists_sql': ['record_exists_sql', 'Test whether a SQL SELECT statement returns any records. ', [['lib/dml','moodle_database.php',1846]], 52],
'count_user_competency_plans_for_template': ['count_user_competency_plans_for_template', 'Count the user-completency-plans in the template, optionally filtered by proficiency. ', [['competency/classes','api.php',4921]], 5],
'count_courses_using_competency': ['count_courses_using_competency', 'Count all the courses using a competency. ', [['competency/classes','api.php',926],['competency/classes','external.php',1169]], 1],
'delete_multiple': ['delete_multiple', 'Delete the competencies. ', [['competency/classes','competency.php',797]], 1],
'plan_request_review': ['plan_request_review', 'Request the review of a plan. ', [['competency/classes','api.php',2833],['competency/classes','external.php',2940]], 11],
'set_desca': ['set_desca', 'Convenience method to set the description $a. ', [['competency/classes','evidence.php',135]], 1],
'add_competency_to_course': ['add_competency_to_course', 'Add a competency to this course. ', [['competency/classes','api.php',1553],['competency/classes','external.php',1397]], 8],
'count_competencies_in_template_with_no_courses': ['count_competencies_in_template_with_no_courses', 'Count all the competencies in a learning plan template with no linked courses. ', [['competency/classes','api.php',2076]], 2],
'user_competency_cancel_review_request': ['user_competency_cancel_review_request', 'Cancel a user competency review request. ', [['competency/classes','api.php',3393],['competency/classes','external.php',2422]], 1],
'can_grade_user_in_course': ['can_grade_user_in_course', 'Can the current user grade a user\'s user competency in a course? ', [['competency/classes','user_competency.php',361]], 2],
'set_parent_competency': ['set_parent_competency', 'Move this competency so it sits in a new parent. ', [['competency/classes','api.php',326],['competency/classes','external.php',1037]], 7],
'user_competency_start_review': ['user_competency_start_review', 'Start a user competency review. ', [['competency/classes','api.php',3453],['competency/classes','external.php',2502]], 1],
'remove_archived_user_competencies_in_plan': ['remove_archived_user_competencies_in_plan', 'Delete archived user competencies in a plan. ', [['competency/classes','api.php',4079]], 2],
'to_record': ['to_record', 'Create a DB record from this class. ', [['competency/classes','persistent.php',337]], 96],
'update': ['update', 'In addition to update() as defined in grade_object, handle the grade_outcome and grade_scale objects. Force regrading if necessary, rounds the float numbers using php function, the reason is we need to compare the db value with computed number to skip regrading if possible. ', [['lib/grade','grade_item.php',274],['lib/google/src/Google/Service','Tasks.php',386],['lib/google/src/Google/Service','Tasks.php',556],['lib/google/src/Google/Service','AndroidPublisher.php',1413],['lib/google/src/Google/Service','AndroidPublisher.php',1545],['lib/google/src/Google/Service','AndroidPublisher.php',1615],['lib/google/src/Google/Service','AndroidPublisher.php',1853],['lib/google/src/Google/Service','AndroidPublisher.php',1919],['lib/google/src/Google/Service','AndroidPublisher.php',2003],['lib/google/src/Google/Service','AndroidPublisher.php',2177],['lib/google/src/Google/Service','Reseller.php',344],['lib/grade','grade_category.php',226],['lib/grade','grade_scale.php',125],['lib/adodb','adodb-active-record.inc.php',1004],['lib/grade','grade_object.php',238],['lib/google/src/Google/Service','YouTubeAnalytics.php',534],['completion','data_object.php',252],['mod/lesson/pagetypes','matching.php',308],['tag/classes','collection.php',215],['lib/google/src/Google/Service','AdExchangeBuyer.php',802],['lib/google/src/Google/Service','AdExchangeBuyer.php',906],['lib/google/src/Google/Service','AdExchangeBuyer.php',1013],['lib/google/src/Google/Service','AdExchangeBuyer.php',1181],['lib/google/src/Google/Service','AdExchangeBuyer.php',1357],['lib/google/src/Google/Service','AdExchangeBuyer.php',1640],['lib/google/src/Google/Service','Books.php',2025],['lib/grade','grade_grade.php',1009],['lib/grade','grade_outcome.php',144],['lib/google/src/Google/Service','Analytics.php',2215],['lib/google/src/Google/Service','Analytics.php',2388],['lib/google/src/Google/Service','Analytics.php',2501],['lib/google/src/Google/Service','Analytics.php',2626],['lib/google/src/Google/Service','Analytics.php',2736],['lib/google/src/Google/Service','Analytics.php',2843],['lib/google/src/Google/Service','Analytics.php',2971],['lib/google/src/Google/Service','Analytics.php',3062],['lib/google/src/Google/Service','Analytics.php',3185],['lib/google/src/Google/Service','Analytics.php',3502],['lib/google/src/Google/Service','Analytics.php',3604],['lib/google/src/Google/Service','Analytics.php',3686],['lib/google/src/Google/Service','Coordinate.php',611],['lib/google/src/Google/Service','Coordinate.php',727],['lib/google/src/Google/Service','DeploymentManager.php',589],['tag/classes/output','tagareacollection.php',68],['lib','weblib.php',3312],['lib/google/src/Google/Service','Blogger.php',1349],['lib/google/src/Google/Service','Blogger.php',1647],['lib/google/src/Google/Service','Dataflow.php',350],['tag/classes/output','tagcollname.php',58],['competency/classes','persistent.php',452],['lib/google/src/Google/Service','Cloudresourcemanager.php',344],['lib/google/src/Google/Service','Cloudresourcemanager.php',555],['lib/google/src/Google/Service','TagManager.php',977],['lib/google/src/Google/Service','TagManager.php',1066],['lib/google/src/Google/Service','TagManager.php',1159],['lib/google/src/Google/Service','TagManager.php',1219],['lib/google/src/Google/Service','TagManager.php',1311],['lib/google/src/Google/Service','TagManager.php',1405],['lib/google/src/Google/Service','TagManager.php',1499],['lib/google/src/Google/Service','TagManager.php',1650],['lib/google/src/Google/Service','TagManager.php',1743],['mod/lesson','locallib.php',2691],['lib/google/src/Google/Service','Bigquery.php',621],['lib/google/src/Google/Service','Bigquery.php',953],['lib/google/src/Google/Service','ShoppingContent.php',1136],['lib/google/src/Google/Service','ShoppingContent.php',1238],['lib/google/src/Google/Service','ShoppingContent.php',1401],['lib/google/src/Google/Service','ShoppingContent.php',1534],['mod/lesson/pagetypes','truefalse.php',163],['lib/google/src/Google/Service','Clouddebugger.php',307],['lib/filestorage','stored_file.php',103],['lib/google/src/Google/Service','Container.php',366],['lib/horde/framework/Horde/Support','Array.php',70],['lib/google/src/Google/Service','Storage.php',1127],['lib/google/src/Google/Service','Storage.php',1268],['lib/google/src/Google/Service','Storage.php',1423],['lib/google/src/Google/Service','Storage.php',1564],['lib/google/src/Google/Service','Storage.php',1904],['tag/classes/output','tagname.php',56],['tag/classes/output','tagcollsearchable.php',72],['lib/google/src/Google/Service','Games.php',1508],['lib/google/src/Google/Service','Licensing.php',335],['lib/google/src/Google/Service','Fitness.php',478],['lib/google/src/Google/Service','Fitness.php',691],['lib/google/src/Google/Service','Gmail.php',833],['lib/google/src/Google/Service','Gmail.php',986],['lib/google/src/Google/Service','Taskqueue.php',398],['lib/adodb','adodb-active-recordx.inc.php',1136],['grade/grading/form','lib.php',905],['lib/google/src/Google/Service','Doubleclicksearch.php',326],['lib/google/src/Google/Service','Autoscaler.php',400],['tag/classes/output','tagisstandard.php',70],['lib/google/src/Google/Service','Prediction.php',339],['lib/google/src/Google/Service','SiteVerification.php',227],['lib/google/src/Google/Service','Drive.php',1691],['lib/google/src/Google/Service','Drive.php',1961],['lib/google/src/Google/Service','Drive.php',2208],['lib/google/src/Google/Service','Drive.php',2320],['lib/google/src/Google/Service','Drive.php',2370],['lib/google/src/Google/Service','Drive.php',2494],['lib/google/src/Google/Service','Drive.php',2582],['tag/classes/output','tagflag.php',71],['lib/google/src/Google/Service','Proximitybeacon.php',440],['lib/google/src/Google/Service','Groupssettings.php',138],['lib/google/src/Google/Service','Directory.php',1829],['lib/google/src/Google/Service','Directory.php',1889],['lib/google/src/Google/Service','Directory.php',2141],['lib/google/src/Google/Service','Directory.php',2306],['lib/google/src/Google/Service','Directory.php',2489],['lib/google/src/Google/Service','Directory.php',2597],['lib/google/src/Google/Service','Directory.php',2808],['lib/google/src/Google/Service','Directory.php',2910],['lib/google/src/Google/Service','Directory.php',3131],['lib/google/src/Google/Service','Directory.php',3317],['lib/google/src/Google/Service','Fusiontables.php',727],['lib/google/src/Google/Service','Fusiontables.php',892],['lib/google/src/Google/Service','Fusiontables.php',1094],['lib/google/src/Google/Service','Fusiontables.php',1269],['lib/google/src/Google/Service','AdSenseHost.php',846],['lib/google/src/Google/Service','AdSenseHost.php',1097],['course/classes/output','course_module_name.php',81],['lib/google/src/Google/Service','Mirror.php',496],['lib/google/src/Google/Service','Mirror.php',634],['lib/google/src/Google/Service','Mirror.php',745],['tag/classes','area.php',226],['lib/google/src/Google/Service','AndroidEnterprise.php',1064],['lib/google/src/Google/Service','AndroidEnterprise.php',1165],['lib/google/src/Google/Service','AndroidEnterprise.php',1489],['lib/google/src/Google/Service','AndroidEnterprise.php',1672],['grade/grading/form/rubric','lib.php',828],['lib/xhprof/xhprof_html/jquery','jquery.tooltip.js',200],['mod/lesson/pagetypes','essay.php',158],['lib','coursecatlib.php',438],['tag/classes','tag.php',893],['lib/google/src/Google/Service','Calendar.php',1006],['lib/google/src/Google/Service','Calendar.php',1181],['lib/google/src/Google/Service','Calendar.php',1333],['lib/google/src/Google/Service','Calendar.php',1714],['lib/google/src/Google/Service','PlusDomains.php',692],['lib/google/src/Google/Service','GamesConfiguration.php',334],['lib/google/src/Google/Service','GamesConfiguration.php',473],['mod/lesson/pagetypes','branchtable.php',262],['tag/classes/output','tagareashowstandard.php',64],['lib/google/src/Google/Service','AppState.php',202],['calendar','lib.php',2206],['tag/classes/output','tagareaenabled.php',69],['cohort/classes/output','cohortidnumber.php',53],['lib/google/src/Google/Service','Classroom.php',564],['cohort/classes/output','cohortname.php',53],['lib/google/src/Google/Service','SQLAdmin.php',947],['lib/google/src/Google/Service','SQLAdmin.php',1267],['lib/google/src/Google/Service','SQLAdmin.php',1534],['grade/grading/form/guide','lib.php',836],['lib/google/src/Google/Service','Compute.php',4253],['lib/google/src/Google/Service','Compute.php',4398],['lib/google/src/Google/Service','Compute.php',4767],['lib/google/src/Google/Service','Compute.php',5348],['lib/google/src/Google/Service','Compute.php',5478],['lib/google/src/Google/Service','Compute.php',8131],['lib/google/src/Google/Service','YouTube.php',1959],['lib/google/src/Google/Service','YouTube.php',2194],['lib/google/src/Google/Service','YouTube.php',2303],['lib/google/src/Google/Service','YouTube.php',2429],['lib/google/src/Google/Service','YouTube.php',2570],['lib/google/src/Google/Service','YouTube.php',3111],['lib/google/src/Google/Service','YouTube.php',3348],['lib/google/src/Google/Service','YouTube.php',3518],['lib/google/src/Google/Service','YouTube.php',3708],['lib/google/src/Google/Service','YouTube.php',4400],['lib/google/src/Google/Service','Dfareporting.php',4752],['lib/google/src/Google/Service','Dfareporting.php',4840],['lib/google/src/Google/Service','Dfareporting.php',4973],['lib/google/src/Google/Service','Dfareporting.php',5090],['lib/google/src/Google/Service','Dfareporting.php',5204],['lib/google/src/Google/Service','Dfareporting.php',5400],['lib/google/src/Google/Service','Dfareporting.php',5656],['lib/google/src/Google/Service','Dfareporting.php',5848],['lib/google/src/Google/Service','Dfareporting.php',5970],['lib/google/src/Google/Service','Dfareporting.php',6078],['lib/google/src/Google/Service','Dfareporting.php',6196],['lib/google/src/Google/Service','Dfareporting.php',6502],['lib/google/src/Google/Service','Dfareporting.php',6704],['lib/google/src/Google/Service','Dfareporting.php',6834],['lib/google/src/Google/Service','Dfareporting.php',6912],['lib/google/src/Google/Service','Dfareporting.php',7077],['lib/google/src/Google/Service','Dfareporting.php',7476],['lib/google/src/Google/Service','Dfareporting.php',7594],['lib/google/src/Google/Service','Dfareporting.php',7744],['lib/google/src/Google/Service','Dfareporting.php',7968],['lib/google/src/Google/Service','Dfareporting.php',8075],['lib/google/src/Google/Service','Dfareporting.php',8202],['lib/google/src/Google/Service','Dfareporting.php',8394],['lib/google/src/Google/Service','Dfareporting.php',8557],['lib/google/src/Google/Service','Dfareporting.php',8861],['lib/horde/framework/Horde/Imap/Client/Ids','Map.php',72]], 498],
'reorder_template_competency': ['reorder_template_competency', 'Move the template competency up or down in the display list. ', [['competency/classes','api.php',2187],['competency/classes','external.php',1555]], 5],
'get_plan_competency': ['get_plan_competency', 'Get a single competency from the user plan. ', [['competency/classes','api.php',3131]], 4],
'list_user_plans': ['list_user_plans', 'Lists user plans. ', [['competency/classes','api.php',2307],['competency/classes','external.php',3210]], 3],
'update_user_evidence': ['update_user_evidence', 'Create a new user evidence. ', [['competency/classes','api.php',3744]], 2],
'add_evidence': ['add_evidence', 'Create an evidence from a list of parameters. ', [['competency/classes','api.php',4173]], 40],
'has_any_capability': ['has_any_capability', 'Check if the user has any one of several capabilities from a list. ', [['lib','accesslib.php',496]], 100],
'delete_user_evidence_competency': ['delete_user_evidence_competency', 'Delete a relationship between a user evidence and a competency. ', [['competency/classes','api.php',3881],['competency/classes','external.php',3377]], 2],
'get_record_snapshot': ['get_record_snapshot', 'Returns cached record or fetches data from database if not cached. ', [['lib/classes/event','base.php',883]], 90],
'user_evidence': ['user_evidence', 'The URL where the user evidence (of prior learning) can be found. ', [['admin/tool/lp/classes','url_resolver.php',163],['competency/classes','url.php',182]], 10],
'set_course_competency_ruleoutcome': ['set_course_competency_ruleoutcome', 'Update ruleoutcome value for a course competency. ', [['competency/classes','api.php',1682],['competency/classes','external.php',3627]], 3],
'plan_viewed': ['plan_viewed', 'Plan event viewed. ', [['competency/classes','api.php',2730]], 2],
'set_status': ['set_status', '', [['backup/util/settings','base_setting.class.php',201],['lib','badgeslib.php',315],['mod/workshop/allocation','lib.php',113],['backup/controller','backup_controller.class.php',178],['backup/controller','restore_controller.class.php',190]], 137],
'search_competencies': ['search_competencies', 'Perform a text search based and return all results and their parents. ', [['competency/classes','api.php',459],['competency/classes','external.php',911]], 5],
'rollback': ['rollback', 'Rolls back the update in state from ROLLING_FORWARD or PAUSED. Has no effect if invoked when the state of the update is ROLLED_BACK. (rollingUpdates.rollback) ', [['lib/google/src/Google/Service','Replicapoolupdater.php',458],['lib/google/src/Google/Service','Datastore.php',206],['lib/dml','moodle_transaction.php',95]], 26],
'get_recordset_sql': ['get_recordset_sql', 'Get a number of records as an moodle_recordset.  $sql must be a complete SQL query. Since this method is a little less readable, use of it should be restricted to code where it\'s possible there might be large datasets being returned.  For known small datasets use get_records_sql - it leads to simpler code. ', [['lib/dml','pdo_moodle_database.php',252],['lib/dml','oci_native_moodle_database.php',1106],['lib/dml','pgsql_native_moodle_database.php',688],['lib/dml','mssql_native_moodle_database.php',736],['lib/dml','mysqli_native_moodle_database.php',993],['lib/dml','sqlsrv_native_moodle_database.php',811],['lib/dml/tests','dml_test.php',5544]], 283],
'count_records_sql': ['count_records_sql', 'Get the result of a SQL SELECT COUNT(...) query. ', [['lib/dml','moodle_database.php',1796]], 155],
'delete_framework': ['delete_framework', 'Delete a competency framework by id. ', [['competency/classes','api.php',634]], 15],
'extract_record': ['extract_record', 'Extract a record from a row of data. ', [['competency/classes','persistent.php',680]], 9],
'out': ['out', 'Returns the selector for use in a CSS rule ', [['lib','csslib.php',1540],['lib','csslib.php',1698],['lib','csslib.php',2078],['lib','csslib.php',2162],['lib','csslib.php',2306],['lib','csslib.php',2495],['lib','csslib.php',3240],['mod/feedback/classes','responses_table.php',332],['lib','moodlelib.php',9729],['lib','weblib.php',545],['lib','tablelib.php',1594],['report/loglive/classes','table_log_ajax.php',37]], 626],
'get_sql_fields': ['get_sql_fields', 'Return the list of fields for use in a SELECT clause. ', [['competency/classes','persistent.php',777]], 9],
'list_user_competencies_to_review': ['list_user_competencies_to_review', 'List the user competencies to review. ', [['competency/classes','api.php',1305]], 4],
'set_sortorder': ['set_sortorder', 'Sets the sortorder of this grade_item. This method is also available in grade_category, for cases where the object type is not know. ', [['lib/grade','grade_item.php',1316],['lib/grade','grade_category.php',2416],['lib/filestorage','stored_file.php',884]], 29],
'can_manage': ['can_manage', 'Whether the current user can manage the plan. ', [['competency/classes','plan.php',136],['competency/classes','user_evidence.php',72],['competency/classes','course_competency_settings.php',110],['competency/classes','competency_framework.php',469],['competency/classes','template.php',101]], 35],
'reorder_plan_competency': ['reorder_plan_competency', 'Move the plan competency up or down in the display list. ', [['competency/classes','api.php',3331],['competency/classes','external.php',2380]], 4],
'list_user_evidence': ['list_user_evidence', 'List the user evidence of a user. ', [['competency/classes','api.php',3815]], 1],
'read_course_competency_settings': ['read_course_competency_settings', 'Get the competency settings for a course. ', [['competency/classes','api.php',5046]], 2],
'create': ['create', 'Auto-scan an incoming line to determine the response type. ', [['lib/horde/framework/Horde/Imap/Client/Interaction','Server.php',65],['lib/google/src/Google/Service','Partners.php',492],['lib/simplepie/library/SimplePie','Cache.php',95],['lib/google/src/Google/Service','YouTubeReporting.php',237],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',81],['lib/google/src/Google/Service','MapsEngine.php',1677],['lib/google/src/Google/Service','MapsEngine.php',1977],['lib/google/src/Google/Service','MapsEngine.php',2253],['lib/google/src/Google/Service','MapsEngine.php',2330],['lib/google/src/Google/Service','MapsEngine.php',2898],['lib/spout/src/Spout/Writer','WriterFactory.php',18],['lib/google/src/Google/Service','Dns.php',290],['lib/google/src/Google/Service','Dns.php',363],['lib/google/src/Google/Service','Appengine.php',438],['tag/classes','collection.php',188],['lib/adodb','adodb-xmlschema.inc.php',152],['lib/adodb','adodb-xmlschema.inc.php',473],['lib/adodb','adodb-xmlschema.inc.php',738],['lib/adodb','adodb-xmlschema.inc.php',884],['lib/adodb','adodb-xmlschema.inc.php',1129],['mod/quiz','attemptlib.php',100],['mod/quiz','attemptlib.php',596],['lib','weblib.php',3206],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',58],['lib/google/src/Google/Service','Dataflow.php',273],['lib/simplepie/library/SimplePie','Registry.php',153],['competency/classes','persistent.php',387],['lib/google/src/Google/Service','Cloudresourcemanager.php',373],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',270],['lib/google/src/Google/Service','TagManager.php',1007],['lib/google/src/Google/Service','TagManager.php',1097],['lib/google/src/Google/Service','TagManager.php',1249],['lib/google/src/Google/Service','TagManager.php',1342],['lib/google/src/Google/Service','TagManager.php',1436],['lib/google/src/Google/Service','TagManager.php',1530],['lib/google/src/Google/Service','TagManager.php',1681],['mod/lesson','locallib.php',1011],['mod/lesson','locallib.php',2163],['mod/lesson','locallib.php',3212],['lib','modinfolib.php',1732],['repository','lib.php',206],['repository','lib.php',1910],['lib','navigationlib.php',268],['lib/htmlpurifier/HTMLPurifier','Config.php',114],['lib/google/src/Google/Service','Container.php',284],['lib/google/src/Google/Service','Genomics.php',632],['lib/google/src/Google/Service','Genomics.php',721],['lib/google/src/Google/Service','Genomics.php',1312],['lib/google/src/Google/Service','Genomics.php',1427],['lib/google/src/Google/Service','Games.php',1649],['lib/google/src/Google/Service','Games.php',2013],['lib/google/src/Google/Service','Fitness.php',377],['lib/google/src/Google/Service','Gmail.php',747],['lib/google/src/Google/Service','Gmail.php',905],['mod/quiz/classes','structure.php',65],['lib/htmlpurifier/HTMLPurifier','ElementDef.php',135],['lib/adodb','adodb-xmlschema03.inc.php',170],['lib/adodb','adodb-xmlschema03.inc.php',514],['lib/adodb','adodb-xmlschema03.inc.php',779],['lib/adodb','adodb-xmlschema03.inc.php',930],['lib/adodb','adodb-xmlschema03.inc.php',1228],['lib/google/src/Google/Service','Proximitybeacon.php',500],['tag/classes','area.php',205],['course','lib.php',3003],['question/type/ddmarker','shapes.php',170],['lib/classes/event','base.php',149],['lib','coursecatlib.php',325],['repository/filesystem','lib.php',498],['lib/google/src/Google/Service','Storagetransfer.php',281],['calendar','lib.php',2686],['lib/htmlpurifier/HTMLPurifier','Lexer.php',53],['lib/google/src/Google/Service','Classroom.php',445],['lib/google/src/Google/Service','Classroom.php',596],['lib/google/src/Google/Service','Classroom.php',673],['lib/google/src/Google/Service','Classroom.php',783],['lib/google/src/Google/Service','Classroom.php',912],['lib/spout/src/Spout/Reader','ReaderFactory.php',18],['lib/google/src/Google/Service','Pubsub.php',220],['lib/google/src/Google/Service','Pubsub.php',365],['lib/google/src/Google/Service','CloudMonitoring.php',258]], 3276],
'search': ['search', 'Search Freebase open data. (search) ', [['lib/google/src/Google/Service','Freebase.php',219],['search/classes','manager.php',469],['repository/boxnet','lib.php',169],['repository/picasa','lib.php',87],['repository/flickr_public','lib.php',233],['competency/classes','competency.php',383],['lib/google/src/Google/Service','AdExchangeBuyer.php',1266],['lib/google/src/Google/Service','AdExchangeBuyer.php',1342],['lib/google/src/Google/Service','CivicInfo.php',176],['lib','boxlib.php',216],['lib/google/src/Google/Service','Blogger.php',1627],['repository','lib.php',2286],['lib','adminlib.php',687],['lib','adminlib.php',847],['lib','adminlib.php',1266],['lib','adminlib.php',1398],['lib','adminlib.php',5504],['lib','adminlib.php',5785],['lib','adminlib.php',5839],['lib','adminlib.php',5911],['lib','adminlib.php',5959],['lib','adminlib.php',6001],['lib','adminlib.php',6052],['lib','adminlib.php',7096],['repository/wikimedia','lib.php',165],['lib/horde/framework/Horde/Imap/Client','Base.php',1958],['lib/google/src/Google/Service','QPXExpress.php',81],['repository/googledocs','lib.php',265],['lib/google/src/Google/Service','Genomics.php',693],['lib/google/src/Google/Service','Genomics.php',1066],['lib/google/src/Google/Service','Genomics.php',1149],['lib/google/src/Google/Service','Genomics.php',1201],['lib/google/src/Google/Service','Genomics.php',1284],['lib/google/src/Google/Service','Genomics.php',1399],['lib/google/src/Google/Service','Genomics.php',1510],['lib/horde/framework/Horde','Stream.php',255],['repository/merlot','lib.php',62],['repository/youtube','lib.php',127],['repository/local','lib.php',255],['lib/google/src/Google/Service','Plus.php',381],['lib/google/src/Google/Service','Plus.php',590],['backup/util/ui','restore_ui_components.php',172],['repository/filesystem','lib.php',129],['repository/flickr','lib.php',207],['mod/assign','adminlib.php',54],['lib/horde/framework/Horde/Stream','TempString.php',165]], 104],
'create_from_plan': ['create_from_plan', 'Convenience method to instantiate the plan unlinked event. ', [['lib/classes/event','competency_plan_unlinked.php',43],['lib/classes/event','competency_plan_reopened.php',46],['lib/classes/event','competency_plan_updated.php',46],['lib/classes/event','competency_plan_created.php',45],['lib/classes/event','competency_plan_review_request_cancelled.php',46],['lib/classes/event','competency_plan_deleted.php',46],['lib/classes/event','competency_plan_review_started.php',46],['lib/classes/event','competency_plan_viewed.php',45],['lib/classes/event','competency_plan_unapproved.php',46],['lib/classes/event','competency_plan_review_requested.php',46],['lib/classes/event','competency_plan_review_stopped.php',46],['lib/classes/event','competency_plan_completed.php',46],['lib/classes/event','competency_plan_approved.php',46]], 15],
'can_request_review': ['can_request_review', 'Whether the current user can request a review of the plan. ', [['competency/classes','plan.php',169],['competency/classes','user_competency.php',120]], 6],
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'list_evidence_in_course': ['list_evidence_in_course', 'List all the evidence for a user competency in a course. ', [['competency/classes','api.php',4143]], 3],
'apply_competency_rules_from_usercompetency': ['apply_competency_rules_from_usercompetency', 'Apply the competency rules from a user competency. ', [['competency/classes','api.php',4462]], 1],
'plan_cancel_review_request': ['plan_cancel_review_request', 'Cancel the review of a plan. ', [['competency/classes','api.php',2798],['competency/classes','external.php',2903]], 11],
'read_framework': ['read_framework', 'Read a the details for a single competency framework and return a record. ', [['competency/classes','api.php',719]], 14],
'instance': ['instance', 'Returns an instance of the cache_factor method. ', [['cache','disabledlib.php',171],['cache','disabledlib.php',296],['lib/classes','useragent.php',101],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['search/classes','manager.php',109],['cache','locallib.php',52],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['lib/classes','plugin_manager.php',103],['lib/htmlpurifier','HTMLPurifier.php',251],['course/format','lib.php',156],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['admin/tool/installaddon/classes','installer.php',40],['lib','modinfolib.php',373],['cache/classes','helper.php',76],['lib/tests','string_manager_standard_test.php',124],['lib/portfolio','exporter.php',251],['lib/classes/update','validator.php',88],['search/classes','document_factory.php',49],['lib','accesslib.php',6235],['lib','accesslib.php',6487],['lib','accesslib.php',6665],['lib','accesslib.php',6919],['lib','accesslib.php',7180],['lib','accesslib.php',7392],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443],['lib','filterlib.php',80],['search/tests/fixtures','testable_core_search.php',43],['lib/tests/fixtures','testable_update_checker.php',45],['backup/cc','validator.php',35],['cache/classes','config.php',87],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29]], 4647],
'create_from_user_competency_viewed_in_course': ['create_from_user_competency_viewed_in_course', 'Convenience method to instantiate the event in course. ', [['lib/classes/event','competency_user_competency_viewed_in_course.php',48]], 1],
'get_records': ['get_records', 'Load a list of records. ', [['competency/classes','persistent.php',709],['mod/glossary/classes','entry_query_builder.php',295],['lib/dml','moodle_database.php',1285],['lib','coursecatlib.php',651],['question','category_class.php',63]], 965],
'user_competency_stop_review': ['user_competency_stop_review', 'Stop a user competency review. ', [['competency/classes','api.php',3483],['competency/classes','external.php',2542]], 1],
'get_records_for_template': ['get_records_for_template', 'Get the plans for a template, optionally filtering by status. ', [['competency/classes','plan.php',698]], 1],
'list_plan_competencies': ['list_plan_competencies', 'List the competencies in a user plan. ', [['competency/classes','api.php',3190],['competency/classes','external.php',3125]], 11],
'create_from_template': ['create_from_template', 'Convenience method to instantiate the event. ', [['lib/classes/event','competency_template_viewed.php',45],['lib/classes/event','competency_template_deleted.php',46],['lib/classes/event','competency_template_updated.php',46],['lib/classes/event','competency_template_created.php',45]], 5],
'create_plan': ['create_plan', 'Create a new plan. ', [['competency/tests/generator','lib.php',302],['competency/tests','external_test.php',206],['competency/classes','api.php',2439],['competency/classes','external.php',2651]], 108],
'remove_related_competency': ['remove_related_competency', 'Remove a related competency. ', [['competency/classes','api.php',3674],['competency/classes','external.php',3575]], 4],
'get_competencies': ['get_competencies', 'Get the competencies in this plan. ', [['competency/classes','plan.php',212],['competency/classes','user_evidence.php',99]], 6],
'create_template': ['create_template', 'Create a template. ', [['competency/tests/generator','lib.php',231],['competency/tests','external_test.php',220],['competency/classes','api.php',1706],['competency/classes','external.php',1596]], 82],
'reopen_plan': ['reopen_plan', 'Reopen a plan. ', [['competency/classes','api.php',3072],['competency/classes','external.php',2780]], 8],
'create_competency': ['create_competency', 'Create a new competency. ', [['competency/tests/generator','lib.php',91],['competency/tests','external_test.php',278],['competency/classes','api.php',152],['competency/classes','external.php',596]], 386],
'get_parent': ['get_parent', '', [['mod/resource','locallib.php',507],['lib/filebrowser','file_info_context_system.php',207],['mod/lesson/classes','file_info.php',187],['mod/imscp','locallib.php',414],['lib/filebrowser','file_info_context_coursecat.php',254],['mod/book','locallib.php',554],['lib/filebrowser','file_info_context_user.php',298],['mod/scorm','locallib.php',62],['competency/classes','competency.php',252],['mod/data','locallib.php',574],['lib/filebrowser','file_info_stored.php',431],['lib','outputcomponents.php',2789],['backup/util/structure','base_final_element.class.php',164],['mod/page','locallib.php',37],['mod/workshop','fileinfolib.php',174],['mod/workshop','fileinfolib.php',335],['lib/filebrowser','file_info_context_module.php',349],['mod/glossary','locallib.php',629],['lib/filebrowser','file_info_context_course.php',472],['lib/filebrowser','file_info_context_course.php',721],['lib/filebrowser','file_info_context_course.php',867],['mod/folder','locallib.php',35],['mod/forum','locallib.php',560]], 58],
'require_capability': ['require_capability', 'Wrapper round the require_capability funciton that automatically passes in the quiz context. ', [['mod/quiz','attemptlib.php',306],['mod/quiz','attemptlib.php',929],['lib','accesslib.php',762],['backup/util/ui','restore_ui_components.php',157]], 690],
'sql_like_escape': ['sql_like_escape', 'Escape sql LIKE special characters like \'_\' or \'%\'. ', [['lib/dml','moodle_database.php',2073]], 26],
'delete_by_templateid': ['delete_by_templateid', 'Remove the competencies in this template. ', [['competency/classes','template_competency.php',219]], 1],
'template_viewed': ['template_viewed', 'Template event viewed. ', [['competency/classes','api.php',5019],['competency/classes','external.php',4200]], 3],
'add_related_competency': ['add_related_competency', 'Add a related competency. ', [['competency/classes','api.php',3651],['competency/classes','external.php',3525]], 8],
'user_competency_plan_viewed': ['user_competency_plan_viewed', 'Log user competency plan viewed event. ', [['competency/classes','api.php',3585],['competency/classes','external.php',4014]], 4],
'set_grade': ['set_grade', 'Updates the grade of a user in the given assign module instance. ', [['availability/condition/grade/tests','condition_test.php',221],['availability/condition/completion/tests','condition_test.php',385]], 13],
'plan_start_review': ['plan_start_review', 'Start the review of a plan. ', [['competency/classes','api.php',2868],['competency/classes','external.php',2977]], 11],
'reorder_course_module_competency': ['reorder_course_module_competency', 'Move the course module competency up or down in the display list. ', [['competency/classes','api.php',1469]], 3],
'user_competency_viewed_in_course': ['user_competency_viewed_in_course', 'Log user competency viewed in course event. ', [['competency/classes','api.php',3559],['competency/classes','external.php',3956]], 3],
'hook_course_deleted': ['hook_course_deleted', 'Action to perform when a course is deleted. ', [['competency/classes','api.php',4681]], 1],
'validate_course_module': ['validate_course_module', 'Validate if current user have acces to the course_module if hidden. ', [['competency/classes','api.php',97]], 7],
'reset_rule': ['reset_rule', 'Reset the rule. ', [['competency/classes','competency.php',347]], 7],
'instance_by_id': ['instance_by_id', 'Get a context instance as an object, from a given context id. ', [['lib','accesslib.php',5434]], 235],
'move_down_competency': ['move_down_competency', 'Reorder this competency. ', [['competency/classes','api.php',245],['competency/classes','external.php',1126]], 2],
'get_proficiency_of_grade': ['get_proficiency_of_grade', 'Extracts the proficiency of a grade from the scale configuration. ', [['competency/classes','competency.php',265]], 3],
'debugging': ['debugging', 'Standard Debugging Function ', [['lib','weblib.php',3012]], 1007],
'can_read_user': ['can_read_user', 'Can the current user view a user\'s plan? ', [['competency/classes','plan.php',428],['competency/classes','user_competency.php',398],['competency/classes','user_evidence.php',191]], 27],
'create_from_evidence': ['create_from_evidence', 'Convenience method to instantiate the event. ', [['lib/classes/event','competency_evidence_created.php',51]], 2],
'get_url': ['get_url', 'Get URL related to the action ', [['lib/classes/event','competency_plan_unlinked.php',81],['lib/classes/event','grouping_group_assigned.php',57],['lib/classes/event','enrol_instance_deleted.php',79],['report/log/classes/event','user_report_viewed.php',82],['mod/quiz/classes/event','attempt_reviewed.php',72],['lib/classes/event','role_unassigned.php',72],['mod/workshop/classes/event','submission_deleted.php',72],['mod/forum/classes/event','discussion_updated.php',74],['lib/classes/event','course_module_instance_list_viewed.php',84],['lib/classes/event','course_created.php',73],['mod/forum/classes/event','readtracking_enabled.php',73],['mod/wiki/classes/event','page_created.php',77],['lib/classes/event','competency_viewed.php',79],['mod/choice/classes/event','answer_updated.php',81],['lib/simplepie/library/SimplePie','Copyright.php',96],['lib/classes/event','search_indexed.php',69],['lib/classes/event','badge_criteria_updated.php',71],['mod/wiki/classes/event','page_version_deleted.php',83],['lib/classes/event','competency_user_competency_rated_in_plan.php',97],['mod/glossary/classes/event','entry_deleted.php',73],['lib/classes/event','competency_template_viewed.php',81],['admin/tool/langimport/classes/event','langpack_removed.php',80],['mod/glossary/classes/event','category_deleted.php',65],['lib/classes/event','badge_deleted.php',67],['mod/quiz/classes/event','user_override_updated.php',73],['lib/classes/event','message_contact_added.php',57],['lib/classes/event','cohort_member_added.php',68],['lib/classes/event','blog_entry_updated.php',92],['mod/forum/classes/event','assessable_uploaded.php',95],['lib/classes/event','group_deleted.php',74],['lib/classes/event','role_allow_assign_updated.php',65],['mod/lesson/classes/event','highscore_added.php',68],['mod/forum/classes/event','discussion_pinned.php',64],['lib/classes/event','competency_plan_reopened.php',84],['mod/lesson/classes/event','essay_attempt_viewed.php',57],['mod/wiki/classes/event','page_locks_deleted.php',83],['mod/glossary/classes/event','comment_created.php',37],['lib/classes/event','webservice_service_deleted.php',68],['mod/forum/classes/event','discussion_subscription_created.php',75],['admin/tool/log/store/database/tests/fixtures','event.php',44],['mod/workshop/classes/event','assessable_uploaded.php',102],['lib/classes/event','user_loggedout.php',72],['lib/classes/event','webservice_token_created.php',74],['mod/data/classes/event','field_deleted.php',76],['mod/book/classes/event','chapter_created.php',88],['mod/survey/classes/event','report_downloaded.php',73],['mod/workshop/classes/event','phase_switched.php',84],['lib/classes/event','course_reset_started.php',62],['mod/workshop/classes/event','assessment_evaluated.php',75],['lib/classes/event','blog_association_created.php',75],['report/outline/classes/event','activity_report_viewed.php',75],['lib/classes/event','competency_plan_updated.php',84],['mod/choice/classes/event','answer_submitted.php',81],['mod/lesson/classes/event','lesson_ended.php',58],['lib/classes/event','role_allow_switch_updated.php',65],['lib/classes/event','competency_user_competency_rated_in_course.php',97],['mod/quiz/report','attemptsreport_options.php',133],['report/participation/classes/event','report_viewed.php',86],['lib/classes/event','role_capabilities_updated.php',69],['mod/survey/classes/event','response_submitted.php',71],['lib/classes/event','badge_archived.php',65],['mod/workshop/classes/event','assessment_reevaluated.php',85],['report/outline/classes/event','report_viewed.php',83],['lib/classes/event','mnet_access_control_updated.php',66],['mod/assign/classes/event','base.php',90],['mod/lesson/classes/event','essay_assessed.php',87],['lib/filebrowser','file_info.php',226],['mod/book/tool/print/classes/event','book_printed.php',85],['lib/classes/event','grouping_deleted.php',81],['lib/classes/event','course_viewed.php',84],['mod/forum/classes/event','user_report_viewed.php',74],['mod/quiz/classes/event','attempt_summary_viewed.php',75],['lib/classes/event','webservice_service_user_added.php',68],['mod/forum/classes/event','discussion_unpinned.php',64],['lib/classes/event','grouping_group_unassigned.php',57],['mod/chat/classes/event','message_sent.php',68],['lib/classes/event','role_assigned.php',75],['mod/glossary/classes/event','entry_viewed.php',67],['mod/data/classes/event','record_created.php',75],['lib/classes/event','role_deleted.php',73],['mod/wiki/classes/event','page_version_viewed.php',84],['admin/tool/log/store/standard/tests/fixtures','event.php',44],['admin/tool/monitor/classes/event','rule_created.php',68],['lib/classes/event','competency_user_competency_plan_viewed.php',90],['mod/data/classes/event','comment_deleted.php',37],['mod/forum/classes/event','course_module_viewed.php',50],['mod/workshop/classes/event','submission_updated.php',72],['mod/choice/classes/event','report_viewed.php',72],['mod/lesson/classes/event','group_override_deleted.php',73],['mod/wiki/classes/event','page_map_viewed.php',83],['admin/tool/log/store/legacy/tests/fixtures','event.php',44],['mod/lesson/classes/event','question_answered.php',63],['mod/choice/classes/event','report_downloaded.php',73],['lib/classes/event','competency_user_evidence_created.php',82],['lib/classes/event','course_module_completion_updated.php',73],['lib/classes/event','note_updated.php',75],['lib/classes/event','note_created.php',75],['lib/classes/event','competency_framework_created.php',81],['lib/classes/event','course_resources_list_viewed.php',69],['lib/filebrowser','file_info_stored.php',156],['mod/forum/classes/event','subscribers_viewed.php',74],['mod/book/tool/exportimscp/classes/event','book_exported.php',85],['lib','outputcomponents.php',326],['lib','outputcomponents.php',2756],['lib/classes/event','user_enrolment_deleted.php',73],['lib/classes/event','webservice_service_updated.php',68],['mod/lesson/classes/event','group_override_created.php',74],['mod/scorm/classes/event','attempt_deleted.php',71],['lib/classes/event','competency_user_competency_review_request_cancelled.php',81],['lib/classes/event','webservice_service_created.php',74],['mod/wiki/classes/event','page_version_restored.php',83],['mod/forum/classes/event','discussion_deleted.php',75],['lib/classes/event','competency_framework_updated.php',82],['lib/classes/event','blog_comment_created.php',38],['mod/lesson/classes/event','lesson_restarted.php',57],['mod/wiki/classes/event','page_updated.php',83],['mod/assign/submission/comments/classes/event','comment_created.php',37],['lib','modinfolib.php',1230],['lib/classes/event','course_module_updated.php',76],['report/questioninstances/classes/event','report_viewed.php',83],['lib/classes/event','message_contact_blocked.php',57],['lib/classes/event','competency_template_updated.php',84],['lib/classes/event','badge_disabled.php',65],['lib/classes/event','badge_enabled.php',65],['mod/quiz/classes/event','edit_page_viewed.php',72],['mod/scorm/classes/event','tracks_viewed.php',73],['mod/wiki/classes/event','page_diff_viewed.php',85],['lib/classes/event','grouping_created.php',74],['lib/classes/event','group_updated.php',74],['mod/book/classes/event','chapter_updated.php',88],['lib/classes/event','user_loggedin.php',73],['mod/forum/classes/event','subscription_created.php',74],['mod/quiz/classes/event','group_override_updated.php',73],['lib/classes/event','competency_plan_created.php',81],['mod/glossary/classes/event','entry_disapproved.php',65],['lib/classes/event','message_viewed.php',63],['lib/classes/event','comment_created.php',77],['lib/classes/event','competency_evidence_created.php',116],['lib/classes/event','comment_deleted.php',77],['lib/classes/event','competency_user_competency_review_requested.php',81],['mod/quiz/classes/event','attempt_abandoned.php',81],['mod/scorm/classes/event','user_report_viewed.php',71],['mod/quiz/classes/event','attempt_becameoverdue.php',84],['mod/quiz/classes/event','group_override_created.php',74],['mod/book/tool/print/classes/event','chapter_printed.php',88],['mod/data/classes/event','record_deleted.php',75],['lib/classes/event','competency_user_competency_viewed.php',90],['mod/lesson/classes/event','question_viewed.php',63],['lib/classes/event','user_profile_viewed.php',76],['mod/lesson/classes/event','user_override_deleted.php',72],['lib/classes/event','cohort_member_removed.php',69],['mod/lesson/classes/event','lesson_started.php',57],['mod/lesson/classes/event','page_updated.php',82],['mod/workshop/classes/event','submission_viewed.php',72],['mod/glossary/classes/event','entry_created.php',71],['mod/wiki/classes/event','page_history_viewed.php',77],['lib/classes/event','competency_plan_review_request_cancelled.php',84],['mod/quiz/classes/event','attempt_viewed.php',73],['mod/data/classes/event','field_updated.php',76],['lib/classes/event','grouping_updated.php',74],['lib/classes/event','question_category_created.php',66],['lib/classes/event','user_login_failed.php',76],['mod/scorm/classes/event','report_viewed.php',72],['mod/chat/classes/event','sessions_viewed.php',74],['mod/quiz/classes/event','user_override_deleted.php',72],['mod/quiz/classes/event','attempt_submitted.php',81],['mod/lesson/classes/event','group_override_updated.php',73],['mod/workshop/classes/event','submission_created.php',72],['mod/assign/submission/onlinetext/classes/event','assessable_uploaded.php',92],['lib/classes/event','competency_updated.php',79],['mod/lesson/classes/event','page_moved.php',65],['blocks/rss_client/classes/output','channel_image.php',101],['badges/lib','backpacklib.php',116],['lib/classes/event','course_completed.php',91],['lib/classes/event','competency_created.php',79],['mod/lesson/classes/event','highscores_viewed.php',60],['lib/classes/event','message_contact_unblocked.php',57],['lib','accesslib.php',6143],['lib','accesslib.php',6200],['lib','accesslib.php',6451],['lib','accesslib.php',6638],['lib','accesslib.php',6878],['lib','accesslib.php',7098],['lib','accesslib.php',7341],['mod/wiki/classes/event','comment_deleted.php',38],['lib/classes/event','user_enrolment_created.php',72],['lib/classes/event','course_module_created.php',105],['lib/classes/event','webservice_service_user_removed.php',68],['report/log/classes/event','report_viewed.php',85],['mod/assign/submission/file/classes/event','assessable_uploaded.php',94],['lib/classes/event','group_member_added.php',87],['mod/forum/classes/event','discussion_viewed.php',69],['mod/workshop/classes/event','submission_reassessed.php',86],['mod/workshop/classes/event','assessment_evaluations_reset.php',84],['mod/forum/classes/event','discussion_moved.php',75],['mod/lesson/classes/event','lesson_resumed.php',57],['lib/classes/event','comments_viewed.php',69],['mod/data/classes/event','template_viewed.php',74],['mod/wiki/classes/event','page_deleted.php',83],['mod/quiz/classes/event','report_viewed.php',75],['mod/scorm/classes/event','sco_launched.php',73],['mod/glossary/classes/event','entry_updated.php',71],['mod/lesson/classes/event','user_override_created.php',72],['mod/glossary/classes/event','category_updated.php',65],['lib/classes/event','course_updated.php',76],['mod/feedback/classes/event','response_submitted.php',102],['mod/book/classes/event','chapter_deleted.php',88],['mod/wiki/classes/event','comment_created.php',38],['report/completion/classes/event','report_viewed.php',67],['lib/classes/event','recent_activity_viewed.php',76],['mod/quiz/classes/event','question_manually_graded.php',74],['lib/classes/event','user_enrolment_updated.php',72],['lib/classes/event','competency_comment_created.php',49],['report/completion/classes/event','user_report_viewed.php',77],['report/stats/classes/event','report_viewed.php',83],['lib/classes/event','calendar_event_created.php',77],['lib/classes/event','course_section_updated.php',75],['lib/classes/event','message_sent.php',91],['lib/classes/event','calendar_subscription_deleted.php',75],['lib/classes/event','course_category_updated.php',60],['lib/classes/event','user_password_updated.php',95],['mod/forum/classes/event','subscription_deleted.php',74],['lib/classes/event','user_loggedinas.php',85],['lib/classes/event','competency_template_created.php',81],['lib/classes/event','user_created.php',66],['report/loglive/classes/event','report_viewed.php',75],['mod/book/classes/event','chapter_viewed.php',88],['lib/classes/event','badge_awarded.php',72],['lib/classes/event','calendar_subscription_created.php',76],['lib/classes/event','enrol_instance_created.php',78],['lib/classes/event','user_list_viewed.php',74],['mod/forum/classes/event','post_deleted.php',76],['mod/quiz/classes/event','group_override_deleted.php',73],['mod/assign/submission/comments/classes/event','comment_deleted.php',37],['lib/classes/event','badge_created.php',65],['lib/classes/event','base.php',639],['lib/classes/event','competency_framework_viewed.php',78],['mod/glossary/classes/event','course_module_viewed.php',53],['lib/classes/event','group_member_removed.php',78],['lib/classes/event','grade_report_viewed.php',72],['lib/classes/event','calendar_event_updated.php',77],['lib/classes/event','user_updated.php',66],['mod/lesson/classes/event','page_created.php',63],['enrol','locallib.php',1412],['lib/classes/event','blog_comment_deleted.php',38],['backup/util/ui','restore_ui_components.php',98],['lib/classes/event','course_completion_updated.php',65],['lib/classes/event','competency_plan_review_started.php',84],['lib/classes/event','course_user_report_viewed.php',75],['mod/folder/classes/event','all_files_downloaded.php',69],['mod/workshop/classes/event','assessments_reset.php',83],['mod/glossary/classes/event','comment_deleted.php',37],['mod/data/classes/event','template_updated.php',85],['admin/tool/log/store/legacy/classes/event','legacy_logged.php',43],['lib/filebrowser','file_info_context_course.php',505],['lib/classes/event','notes_viewed.php',71],['lib/classes/event','competency_plan_viewed.php',81],['mod/data/classes/event','record_updated.php',75],['lib/classes/event','competency_plan_unapproved.php',84],['mod/lesson/classes/event','content_page_viewed.php',57],['mod/quiz/classes/event','attempt_started.php',80],['lib/classes/event','competency_user_competency_rated.php',91],['mod/forum/classes/event','post_updated.php',76],['lib/classes/event','competency_plan_review_requested.php',84],['lib/classes/event','user_graded.php',115],['mod/forum/classes/event','post_created.php',76],['mod/scorm/classes/event','cmielement_submitted.php',67],['lib/classes/event','enrol_instance_updated.php',79],['admin/tool/capability/classes/event','report_viewed.php',74],['mod/data/classes/event','field_created.php',77],['mod/folder/classes/event','folder_updated.php',66],['lib/classes/event','badge_updated.php',65],['lib/tests/fixtures','event_fixtures.php',47],['lib/tests/fixtures','event_fixtures.php',273],['mod/survey/classes/event','report_viewed.php',73],['mod/quiz/classes/event','attempt_deleted.php',72],['mod/glossary/classes/event','entry_approved.php',65],['mod/wiki/classes/event','comments_viewed.php',68],['mod/wiki/classes/event','page_viewed.php',95],['mod/forum/classes/event','readtracking_disabled.php',73],['admin/tool/langimport/classes/event','langpack_imported.php',89],['lib/classes/event','competency_plan_review_stopped.php',84],['admin/tool/langimport/classes/event','langpack_updated.php',89],['lib/tests','customcontext_test.php',33],['lib/tests','customcontext_test.php',57],['lib/tests','customcontext_test.php',81],['lib/classes/event','competency_user_competency_viewed_in_plan.php',94],['lib/classes/event','competency_user_competency_viewed_in_course.php',93],['mod/glossary/classes/event','category_created.php',65],['report/stats/classes/event','user_report_viewed.php',76],['lib/classes/event','dashboards_reset.php',68],['lib/classes/event','calendar_subscription_updated.php',76],['lib/classes/event','cohort_updated.php',67],['admin/tool/monitor/classes/event','rule_updated.php',68],['mod/lesson/classes/event','page_deleted.php',63],['lib/classes/event','mnet_access_control_created.php',66],['mod/forum/classes/event','discussion_created.php',74],['lib/classes/event','blog_entries_viewed.php',80],['mod/quiz/classes/event','attempt_preview_started.php',73],['lib/classes/event','competency_user_evidence_updated.php',82],['lib/classes/event','course_restored.php',76],['mod/data/classes/event','comment_created.php',37],['lib/classes/event','group_created.php',74],['lib/classes/event','badge_criteria_deleted.php',70],['lib/classes/event','competency_plan_completed.php',84],['mod/lesson/classes/event','user_override_updated.php',73],['lib/classes/event','role_allow_override_updated.php',65],['mod/forum/classes/event','discussion_subscription_deleted.php',75],['lib/classes/event','cohort_deleted.php',67],['lib/classes/event','badge_criteria_created.php',70],['lib/classes/event','blog_entry_created.php',94],['mod/scorm/classes/event','interactions_viewed.php',72],['mod/workshop/classes/event','submission_assessed.php',85],['lib/classes/event','badge_duplicated.php',65],['lib/classes/event','course_category_created.php',57],['lib/classes/event','cohort_created.php',67],['lib/classes/event','competency_plan_approved.php',84],['mod/choice/classes/event','answer_deleted.php',65],['lib/classes/event','competency_user_competency_review_started.php',81],['lib/classes/event','course_reset_ended.php',62],['mod/quiz/classes/event','user_override_created.php',72],['mod/forum/classes/event','course_searched.php',75],['lib/classes/event','message_contact_removed.php',57],['admin/tool/monitor/classes/event','rule_deleted.php',68],['lib/classes/event','competency_user_competency_review_stopped.php',81],['lib/classes/event','course_module_viewed.php',71]], 259],
'update_course_competency_settings': ['update_course_competency_settings', 'Update the competency settings for a course. ', [['competency/classes','api.php',5066],['competency/classes','external.php',4253]], 8],
'get_parent_contexts': ['get_parent_contexts', '', [['lib','deprecatedlib.php',1773],['lib','accesslib.php',5704]], 11],
'create_from_user_competency_course': ['create_from_user_competency_course', 'Convenience method to instantiate the event. ', [['lib/classes/event','competency_user_competency_rated_in_course.php',49]], 1],
'has_capability': ['has_capability', 'Wrapper round the has_capability funciton that automatically passes in the quiz context. ', [['mod/quiz','attemptlib.php',299],['mod/quiz','attemptlib.php',922],['lib','accesslib.php',344]], 2064],
'can_all_be_deleted': ['can_all_be_deleted', 'Check if we can delete competencies safely. ', [['competency/classes','competency.php',759]], 2],
'read_plan': ['read_plan', 'Returns a plan data. ', [['competency/classes','api.php',2712],['competency/classes','external.php',2817]], 40],
'get_shortname': ['get_shortname', 'Returns unique outcome short name. ', [['lib/grade','grade_outcome.php',282],['lib','adminlib.php',1973]], 38],
'update_plan': ['update_plan', '', [['competency/tests','external_test.php',245],['competency/classes','api.php',2666],['competency/classes','external.php',2694]], 21],
'set_course_module_competency_ruleoutcome': ['set_course_module_competency_ruleoutcome', 'Update ruleoutcome value for a course module competency. ', [['competency/classes','api.php',1528]], 2],
'get_string': ['get_string', 'Get String returns a requested string ', [['lib/classes','string_manager_install.php',95],['lib','moodlelib.php',6735],['lib','moodlelib.php',9695],['lib/external','externallib.php',102],['question/behaviour','behaviourbase.php',770],['lib/classes','string_manager_standard.php',280],['lib/classes','string_manager.php',38]], 20134],
'list_course_module_competencies': ['list_course_module_competencies', 'List the course_module_competencies in this course module. ', [['competency/classes','course_module_competency.php',274],['competency/classes','api.php',1180],['competency/classes','external.php',1254]], 5],
'get_templateid': ['get_templateid', 'Template id ', [['mod/feedback/classes','structure.php',88]], 17],
'reorder_course_competency': ['reorder_course_competency', 'Move the course competency up or down in the display list. ', [['competency/classes','api.php',1626],['competency/classes','external.php',1499]], 2],
'get_user_access_sitewide': ['get_user_access_sitewide', 'Return a nested array showing role assignments all relevant role capabilities for the user at site/course_category/course levels ', [['lib','accesslib.php',788]], 2],
'unapprove_plan': ['unapprove_plan', 'Unapprove a plan. ', [['competency/classes','api.php',2980],['competency/classes','external.php',3088]], 11],
'duplicate_template': ['duplicate_template', 'Duplicate a learning plan template. ', [['competency/classes','api.php',1733],['competency/classes','external.php',1786]], 2],
'migrate_config': ['migrate_config', 'Migrate rule config from one set of competencies to another. ', [['competency/classes','competency_rule.php',93],['competency/classes','competency_rule_points.php',194]], 1],
'list_courses': ['list_courses', 'Return partial course records foreach course that contains this competency. ', [['competency/classes','course_competency.php',237]], 1],
'sql_like': ['sql_like', 'Returns \'LIKE\' part of a query. ', [['lib/dml','oci_native_moodle_database.php',1575],['lib/dml','pgsql_native_moodle_database.php',1188],['lib/dml','mssql_native_moodle_database.php',1224],['lib/dml','mysqli_native_moodle_database.php',1514],['lib/dml','moodle_database.php',2053],['lib/dml','sqlsrv_native_moodle_database.php',1291]], 159],
'plan_stop_review': ['plan_stop_review', 'Stop reviewing a plan. ', [['competency/classes','api.php',2905],['competency/classes','external.php',3014]], 11],
'competency_viewed': ['competency_viewed', 'Logg the competency viewed event. ', [['competency/classes','api.php',759],['competency/classes','external.php',213]], 2],
'close': ['close', 'Close archive, write changes to disk. ', [['lib/filestorage','zip_archive.php',183],['lib/dml','mssql_native_moodle_recordset.php',87],['auth/fc','fcFPP.php',78],['lib/dml','mysqli_native_moodle_recordset.php',86],['lib/spout/src/Spout/Reader','ReaderInterface.php',30],['lib/spout/src/Spout/Writer/ODS/Internal','Workbook.php',81],['lib/dml','pdo_moodle_recordset.php',79],['lib','csvlib.class.php',256],['lib/horde/framework/Horde/Socket','Client.php',135],['backup/util/helper','backup_null_iterator.class.php',53],['admin/tool/uploaduser','locallib.php',149],['lib/tcpdf','tcpdf.php',2943],['lib/phpunit/classes','phpmailer_sink.php',41],['lib/phpmailer','class.smtp.php',582],['lib/dml','sqlsrv_native_moodle_recordset.php',133],['lib/classes/dml','recordset_walk.php',153],['lib/spout/src/Spout/Writer/XLSX/Helper','SharedStringsHelper.php',84],['grade/export','lib.php',689],['lib','excellib.class.php',93],['backup/util/loggers','file_logger.class.php',69],['grade','lib.php',324],['backup/util/helper','backup_array_iterator.class.php',63],['lib/horde/framework/Horde/Imap/Client','Base.php',1846],['mod/assign/feedback/offline','importgradeslib.php',204],['lib/dml','oci_native_moodle_recordset.php',80],['lib/adodb','adodb.inc.php',2361],['lib/adodb','adodb.inc.php',3090],['lib/adodb','adodb.inc.php',3870],['lib/google/src/Google/Logger','File.php',132],['lib/phpunit/classes','event_sink.php',39],['lib/horde/framework/Horde','Stream.php',585],['backup/util/loggers','base_logger.class.php',89],['lib/phpexcel/PHPExcel/Shared','ZipArchive.php',71],['question/engine/tests','helpers.php',1241],['lib/spout/src/Spout/Writer','AbstractWriter.php',312],['lib','odslib.class.php',71],['lib/spout/src/Spout/Writer/Common/Internal','WorksheetInterface.php',34],['lib/spout/src/Spout/Writer/ODS/Internal','Worksheet.php',214],['lib/spout/src/Spout/Writer','WriterInterface.php',84],['lib/spout/src/Spout/Writer/XLSX/Internal','Worksheet.php',174],['lib/spout/src/Spout/Reader','AbstractReader.php',183],['lib/phpunit/classes','message_sink.php',39],['lib/spout/src/Spout/Writer/Common/Internal','WorkbookInterface.php',65],['lib/spout/src/Spout/Writer/XLSX/Internal','Workbook.php',95],['lib/pear/Net','GeoIP.php',556],['lib/tests','completionlib_test.php',907],['lib/pear/Auth','RADIUS.php',550],['lib/pear/Auth','RADIUS.php',710],['lib/pear/Auth','RADIUS.php',829],['lib','webdavlib.php',176],['lib/dml','pgsql_native_moodle_recordset.php',107]], 1128],
'count_proficient_competencies_in_course_for_user': ['count_proficient_competencies_in_course_for_user', 'Count the proficient competencies in a course for one user. ', [['competency/classes','api.php',1051]], 5],
'get_user_competency': ['get_user_competency', 'Get a user competency. ', [['competency/classes','api.php',1140]], 4],
'get_descendants_ids': ['get_descendants_ids', 'Get descendant ids. ', [['competency/classes','competency.php',813]], 1],
'delete_by_competencyids': ['delete_by_competencyids', 'Delete evidences using competencies. ', [['competency/classes','user_evidence_competency.php',163]], 2],
'user_competency_request_review': ['user_competency_request_review', 'Request a user competency review. ', [['competency/classes','api.php',3420],['competency/classes','external.php',2462]], 2],
'properties_definition': ['properties_definition', 'Get the properties definition of this model.. ', [['competency/classes','persistent.php',177],['competency/classes/external','exporter.php',228]], 15],
'duplicate_competency_tree': ['duplicate_competency_tree', 'Recursively duplicate competencies from a tree, we start duplicating from parents to children to have a correct path. This method does not copy the related competencies. ', [['competency/classes','api.php',3954]], 2],
'create_from_framework': ['create_from_framework', 'Convenience method to instantiate the event. ', [['lib/classes/event','competency_framework_created.php',45],['lib/classes/event','competency_framework_updated.php',46],['lib/classes/event','competency_framework_deleted.php',46],['lib/classes/event','competency_framework_viewed.php',42]], 5],
'get_fast_modinfo': ['get_fast_modinfo', 'Returns reference to full info about modules in course (including visibility). Cached and as fast as possible (0 or 1 db query). ', [['lib','modinfolib.php',1977]], 289],
'implode': ['implode', '', [], 1281],
'defined': ['defined', '', [], 4731],
'array_keys': ['array_keys', '', [], 1256],
'array_pop': ['array_pop', '', [], 483],
'time': ['time', '', [], 1959],
'is_object': ['is_object', '', [], 544],
'count': ['count', '', [], 4095],
'array_push': ['array_push', '', [], 240],
'is_numeric': ['is_numeric', '', [], 672],
'in_array': ['in_array', '', [], 1234],
'array_merge': ['array_merge', '', [], 2944],
'intval': ['intval', '', [], 455],
'explode': ['explode', '', [], 1572],
'array_key_exists': ['array_key_exists', '', [], 1445],
'reset': ['reset', '', [], 1213]};
CLASS_DATA={
'competency_user_competency_rated_in_plan': ['competency_user_competency_rated_in_plan', 'User competency grade rated in plan event class. ', [['lib/classes/event','competency_user_competency_rated_in_plan.php',31]], 1],
'invalid_persistent_exception': ['invalid_persistent_exception', 'Invalid persistent exception class. ', [['competency/classes','invalid_persistent_exception.php',29]], 6],
'course_competency': ['course_competency', 'Class for loading/storing course_competencies from the DB. ', [['competency/classes','course_competency.php',31]], 64],
'url': ['url', 'URL manager class. ', [['competency/classes','url.php',30]], 61],
'competency_plan_review_request_cancelled': ['competency_plan_review_request_cancelled', 'Plan review request cancelled event class. ', [['lib/classes/event','competency_plan_review_request_cancelled.php',32]], 1],
'competency_user_evidence_created': ['competency_user_evidence_created', 'Evidence of prior learning created event class. ', [['lib/classes/event','competency_user_evidence_created.php',31]], 1],
'evidence': ['evidence', 'Evidence persistent class. ', [['competency/classes','evidence.php',35]], 97],
'competency_evidence_created': ['competency_evidence_created', 'Evidence created event class. ', [['lib/classes/event','competency_evidence_created.php',32]], 8],
'competency_plan_updated': ['competency_plan_updated', 'Plan updated event class. ', [['lib/classes/event','competency_plan_updated.php',32]], 1],
'competency_plan_reopened': ['competency_plan_reopened', 'Plan reopened event class. ', [['lib/classes/event','competency_plan_reopened.php',32]], 1],
'context_course': ['context_course', 'Course context class ', [['lib','accesslib.php',6817]], 1323],
'related_competency': ['related_competency', 'Class for loading/storing related_competencies from the DB. ', [['competency/classes','related_competency.php',30]], 28],
'coding_exception': ['coding_exception', 'Exception indicating programming error, must be fixed by a programer. For example a core API might throw this type of exception if a plugin calls it incorrectly. ', [['lib','setuplib.php',239]], 1200],
'competency_created': ['competency_created', 'Competency created event class. ', [['lib/classes/event','competency_created.php',32]], 2],
'competency': ['competency', 'Competency framework form. ', [['admin/tool/lp/classes/form','competency.php',30],['competency/classes','competency.php',34]], 250],
'competency_deleted': ['competency_deleted', 'Competency deleted event class. ', [['lib/classes/event','competency_deleted.php',32]], 2],
'competency_user_competency_viewed': ['competency_user_competency_viewed', 'User competency viewed event class. ', [['lib/classes/event','competency_user_competency_viewed.php',32]], 2],
'plan': ['plan', 'Learning plan form. ', [['admin/tool/lp/classes/form','plan.php',31],['competency/classes','plan.php',32]], 411],
'competency_framework_viewed': ['competency_framework_viewed', 'Competency framework viewed event class. ', [['lib/classes/event','competency_framework_viewed.php',32]], 1],
'competency_plan_viewed': ['competency_plan_viewed', 'Plan viewed event class. ', [['lib/classes/event','competency_plan_viewed.php',31]], 1],
'moodle_exception': ['moodle_exception', 'Base Moodle Exception class ', [['lib','setuplib.php',75]], 606],
'template_cohort': ['template_cohort', 'Template cohort persistent. ', [['competency/classes','template_cohort.php',31]], 34],
'competency_framework_deleted': ['competency_framework_deleted', 'Competency framework deleted event class. ', [['lib/classes/event','competency_framework_deleted.php',32]], 1],
'competency_framework': ['competency_framework', 'Competency framework form. ', [['admin/tool/lp/classes/form','competency_framework.php',30],['competency/classes','competency_framework.php',34]], 45],
'competency_template_updated': ['competency_template_updated', 'Template updated event class. ', [['lib/classes/event','competency_template_updated.php',32]], 1],
'competency_plan_created': ['competency_plan_created', 'Plan created event class. ', [['lib/classes/event','competency_plan_created.php',31]], 3],
'competency_plan_completed': ['competency_plan_completed', 'Plan completed event class. ', [['lib/classes/event','competency_plan_completed.php',32]], 1],
'require_login_exception': ['require_login_exception', 'Course/activity access exception. ', [['lib','setuplib.php',155]], 26],
'competency_user_competency_review_started': ['competency_user_competency_review_started', 'User competency review started event class. ', [['lib/classes/event','competency_user_competency_review_started.php',31]], 1],
'competency_user_competency_viewed_in_course': ['competency_user_competency_viewed_in_course', 'User competency viewed in course event class. ', [['lib/classes/event','competency_user_competency_viewed_in_course.php',32]], 3],
'competency_user_competency_review_stopped': ['competency_user_competency_review_stopped', 'User competency review stopped event class. ', [['lib/classes/event','competency_user_competency_review_stopped.php',31]], 1],
'competency_framework_updated': ['competency_framework_updated', 'Competency framework updated event class. ', [['lib/classes/event','competency_framework_updated.php',32]], 1],
'context_helper': ['context_helper', 'Context maintenance and helper methods. ', [['lib','accesslib.php',5875]], 203],
'competency_user_evidence_deleted': ['competency_user_evidence_deleted', 'Evidence of prior learning deleted event class. ', [['lib/classes/event','competency_user_evidence_deleted.php',31]], 1],
'competency_user_evidence_updated': ['competency_user_evidence_updated', 'Evidence of prior learning updated event class. ', [['lib/classes/event','competency_user_evidence_updated.php',31]], 1],
'competency_plan_deleted': ['competency_plan_deleted', 'Plan deleted event class. ', [['lib/classes/event','competency_plan_deleted.php',32]], 1],
'template_competency': ['template_competency', 'Class for loading/storing template_competencies from the DB. ', [['competency/classes','template_competency.php',29]], 32],
'user_competency': ['user_competency', 'Class for loading/storing user_competency from the DB. ', [['competency/classes','user_competency.php',33]], 172],
'template': ['template', 'Learning plan template form. ', [['admin/tool/lp/classes/form','template.php',28],['admin/tool/xmldb/actions/template','template.class.php',29],['competency/classes','template.php',31]], 78],
'competency_user_competency_rated_in_course': ['competency_user_competency_rated_in_course', 'User competency grade rated in course event class. ', [['lib/classes/event','competency_user_competency_rated_in_course.php',32]], 1],
'context_user': ['context_user', 'User context class ', [['lib','accesslib.php',6398]], 414],
'context_system': ['context_system', 'System context class ', [['lib','accesslib.php',6157]], 1147],
'competency_plan_unapproved': ['competency_plan_unapproved', 'Plan unapproved event class. ', [['lib/classes/event','competency_plan_unapproved.php',32]], 1],
'course_competency_settings': ['course_competency_settings', 'Class for course_competency_settings persistence. ', [['competency/classes','course_competency_settings.php',31]], 17],
'competency_user_competency_viewed_in_plan': ['competency_user_competency_viewed_in_plan', 'User competency viewed in plan event class. ', [['lib/classes/event','competency_user_competency_viewed_in_plan.php',32]], 4],
'competency_plan_review_started': ['competency_plan_review_started', 'Plan review started event class. ', [['lib/classes/event','competency_plan_review_started.php',32]], 1],
'user_evidence': ['user_evidence', 'User evidence form class. ', [['admin/tool/lp/classes/form','user_evidence.php',28],['competency/classes','user_evidence.php',31]], 22],
'context_module': ['context_module', 'Course module context class ', [['lib','accesslib.php',7039]], 1106],
'user_evidence_competency': ['user_evidence_competency', 'User evidence competency persistent class. ', [['competency/classes','user_evidence_competency.php',33]], 18],
'competency_template_deleted': ['competency_template_deleted', 'Template deleted event class. ', [['lib/classes/event','competency_template_deleted.php',32]], 1],
'competency_user_competency_rated': ['competency_user_competency_rated', 'User competency grade rated event class. ', [['lib/classes/event','competency_user_competency_rated.php',31]], 1],
'competency_framework_created': ['competency_framework_created', 'Competency framework created event class. ', [['lib/classes/event','competency_framework_created.php',31]], 2],
'competency_plan_review_stopped': ['competency_plan_review_stopped', 'Plan review stopped event class. ', [['lib/classes/event','competency_plan_review_stopped.php',32]], 1],
'api': ['api', 'Class for doing things with cohort roles. ', [['admin/tool/cohortroles/classes','api.php',30],['admin/tool/mobile/classes','api.php',31],['competency/classes','api.php',41],['lib/classes/update','api.php',33],['admin/tool/templatelibrary/classes','api.php',33]], 699],
'competency_plan_unlinked': ['competency_plan_unlinked', 'Plan unlinked event class. ', [['lib/classes/event','competency_plan_unlinked.php',32]], 1],
'competency_template_created': ['competency_template_created', 'Template created event class. ', [['lib/classes/event','competency_template_created.php',31]], 2],
'required_capability_exception': ['required_capability_exception', 'Exceptions indicating user does not have permissions to do something and the execution can not continue. ', [['lib','setuplib.php',210]], 131],
'competency_user_competency_review_request_cancelled': ['competency_user_competency_review_request_cancelled', 'User competency review requested event class. ', [['lib/classes/event','competency_user_competency_review_request_cancelled.php',31]], 1],
'competency_plan_approved': ['competency_plan_approved', 'Plan approved event class. ', [['lib/classes/event','competency_plan_approved.php',32]], 1],
'competency_plan_review_requested': ['competency_plan_review_requested', 'Plan review requested event class. ', [['lib/classes/event','competency_plan_review_requested.php',32]], 1],
'user_competency_plan': ['user_competency_plan', 'Class for loading/storing user_competency_plan from the DB. ', [['competency/classes','user_competency_plan.php',30]], 31],
'competency_viewed': ['competency_viewed', 'Competency viewed event class. ', [['lib/classes/event','competency_viewed.php',32]], 1],
'competency_template_viewed': ['competency_template_viewed', 'Template viewed event class. ', [['lib/classes/event','competency_template_viewed.php',31]], 1],
'competency_user_competency_plan_viewed': ['competency_user_competency_plan_viewed', 'User competency plan viewed event class. ', [['lib/classes/event','competency_user_competency_plan_viewed.php',32]], 4],
'plan_competency': ['plan_competency', 'Class for managing competencies in the plan (add/remove competencies for given plan). ', [['competency/classes','plan_competency.php',29]], 23],
'competency_user_competency_review_requested': ['competency_user_competency_review_requested', 'User competency review requested event class. ', [['lib/classes/event','competency_user_competency_review_requested.php',31]], 1],
'user_competency_course': ['user_competency_course', 'Class for loading/storing user_competency_course from the DB. ', [['competency/classes','user_competency_course.php',31]], 31],
'course_module_competency': ['course_module_competency', 'Class for loading/storing course_module_competencies from the DB. ', [['competency/classes','course_module_competency.php',30]], 43],
'competency_updated': ['competency_updated', 'Competency updated event class. ', [['lib/classes/event','competency_updated.php',32]], 1]};
CONST_DATA={
'CONTEXT_MODULE': ['CONTEXT_MODULE', '', [['lib','accesslib.php',150]], 466],
'CONTEXT_USER': ['CONTEXT_USER', '', [['lib','accesslib.php',144]], 123],
'MOODLE_INTERNAL': ['MOODLE_INTERNAL', '', [['admin/cli','install.php',140],['','install.php',93],['lib','setup.php',391]], 4153],
'COMPLETION_COMPLETE': ['COMPLETION_COMPLETE', '', [['lib','completionlib.php',76]], 90],
'DEBUG_DEVELOPER': ['DEBUG_DEVELOPER', '', [['lib','setuplib.php',40]], 736],
'SQL_PARAMS_QM': ['SQL_PARAMS_QM', '', [['lib/dml','moodle_database.php',35]], 40],
'RISK_DATALOSS': ['RISK_DATALOSS', '', [['lib','accesslib.php',169]], 21],
'MUST_EXIST': ['MUST_EXIST', '', [['lib','dmllib.php',52]], 1384],
'CONTEXT_COURSE': ['CONTEXT_COURSE', '', [['lib','accesslib.php',148]], 441],
'COMPLETION_COMPLETE_PASS': ['COMPLETION_COMPLETE_PASS', '', [['lib','completionlib.php',81]], 31],
'RISK_XSS': ['RISK_XSS', '', [['lib','accesslib.php',163]], 135],
'SQL_PARAMS_NAMED': ['SQL_PARAMS_NAMED', '', [['lib/dml','moodle_database.php',32]], 315],
'CONTEXT_COURSECAT': ['CONTEXT_COURSECAT', '', [['lib','accesslib.php',146]], 105],
'RISK_CONFIG': ['RISK_CONFIG', '', [['lib','accesslib.php',161]], 22]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
