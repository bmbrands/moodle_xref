<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /webservice/lib.php source</title>
    <link rel="stylesheet" href="../sample.css" type="text/css">
    <link rel="stylesheet" href="../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu Aug 11 10:00:09 2016 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../';
subdir='webservice';
filename='lib.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/webservice/</a> -> <a href="lib.php.html">lib.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="lib.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="lib.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment">/**</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> * Web services utility functions and classes</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> *</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @package    core_webservice</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @copyright  2009 Jerome Mouneyrac &lt;jerome@moodle.com&gt;</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> */</span>
<a name="l25"><span class="linenum">  25</span></a>  
<a name="l26"><span class="linenum">  26</span></a>  require_once(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/libdir.html">libdir</a>.'/externallib.php');
<a name="l27"><span class="linenum">  27</span></a>  
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment">/**</span>
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment"> * WEBSERVICE_AUTHMETHOD_USERNAME - username/password authentication (also called simple authentication)</span>
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment"> */</span>
<a name="l31"><span class="linenum">  31</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('WEBSERVICE_AUTHMETHOD_USERNAME')" href="../_constants/WEBSERVICE_AUTHMETHOD_USERNAME.html" onMouseOver="constPopup(event,'WEBSERVICE_AUTHMETHOD_USERNAME')">WEBSERVICE_AUTHMETHOD_USERNAME</a>', 0);
<a name="l32"><span class="linenum">  32</span></a>  
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment">/**</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment"> * WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN - most common token authentication (external app, mobile app...)</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment"> */</span>
<a name="l36"><span class="linenum">  36</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN')" href="../_constants/WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN.html" onMouseOver="constPopup(event,'WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN')">WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN</a>', 1);
<a name="l37"><span class="linenum">  37</span></a>  
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment">/**</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment"> * WEBSERVICE_AUTHMETHOD_SESSION_TOKEN - token for embedded application (requires Moodle session)</span>
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment"> */</span>
<a name="l41"><span class="linenum">  41</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('WEBSERVICE_AUTHMETHOD_SESSION_TOKEN')" href="../_constants/WEBSERVICE_AUTHMETHOD_SESSION_TOKEN.html" onMouseOver="constPopup(event,'WEBSERVICE_AUTHMETHOD_SESSION_TOKEN')">WEBSERVICE_AUTHMETHOD_SESSION_TOKEN</a>', 2);
<a name="l42"><span class="linenum">  42</span></a>  
<a name="l43"><span class="linenum">  43</span></a>  <span class="comment">/**</span>
<a name="l44"><span class="linenum">  44</span></a>  <span class="comment"> * General web service library</span>
<a name="l45"><span class="linenum">  45</span></a>  <span class="comment"> *</span>
<a name="l46"><span class="linenum">  46</span></a>  <span class="comment"> * @package    core_webservice</span>
<a name="l47"><span class="linenum">  47</span></a>  <span class="comment"> * @copyright  2010 Jerome Mouneyrac &lt;jerome@moodle.com&gt;</span>
<a name="l48"><span class="linenum">  48</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l49"><span class="linenum">  49</span></a>  <span class="comment"> */</span>
<a name="l50"><span class="linenum">  50</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('webservice')" href="../_classes/webservice.html" onMouseOver="classPopup(event,'webservice')">webservice</a> {
<a name="l51"><span class="linenum">  51</span></a>  
<a name="l52"><span class="linenum">  52</span></a>      <span class="comment">/**</span>
<a name="l53"><span class="linenum">  53</span></a>  <span class="comment">     * Authenticate user (used by download/upload file scripts)</span>
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment">     *</span>
<a name="l55"><span class="linenum">  55</span></a>  <span class="comment">     * @param string $token</span>
<a name="l56"><span class="linenum">  56</span></a>  <span class="comment">     * @return array - contains the authenticated user, token and service objects</span>
<a name="l57"><span class="linenum">  57</span></a>  <span class="comment">     */</span>
<a name="l58"><span class="linenum">  58</span></a>      public function <a class="function" onClick="logFunction('authenticate_user')" href="../_functions/authenticate_user.html" onMouseOver="funcPopup(event,'authenticate_user')">authenticate_user</a>(<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>) {
<a name="l59"><span class="linenum">  59</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l60"><span class="linenum">  60</span></a>  
<a name="l61"><span class="linenum">  61</span></a>  <span class="comment">        // web service must be enabled to use this script</span>
<a name="l62"><span class="linenum">  62</span></a>          if (!<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enablewebservices')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/enablewebservices.html">enablewebservices</a>) {
<a name="l63"><span class="linenum">  63</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Web services are not enabled in Advanced features.');
<a name="l64"><span class="linenum">  64</span></a>          }
<a name="l65"><span class="linenum">  65</span></a>  
<a name="l66"><span class="linenum">  66</span></a>  <span class="comment">        // Obtain token record</span>
<a name="l67"><span class="linenum">  67</span></a>          if (!<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('external_tokens', array('token' =&gt; <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>))) {
<a name="l68"><span class="linenum">  68</span></a>  <span class="comment">            //client may want to display login form =&gt; moodle_exception</span>
<a name="l69"><span class="linenum">  69</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('invalidtoken', 'webservice');
<a name="l70"><span class="linenum">  70</span></a>          }
<a name="l71"><span class="linenum">  71</span></a>  
<a name="l72"><span class="linenum">  72</span></a>          <a class="var it9250" onMouseOver="hilite(9250)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a> = array(
<a name="l73"><span class="linenum">  73</span></a>              'other' =&gt; array(
<a name="l74"><span class="linenum">  74</span></a>                  'method' =&gt; <a class="constant" onClick="logConstant('WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN')" href="../_constants/WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN.html" onMouseOver="constPopup(event,'WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN')">WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN</a>,
<a name="l75"><span class="linenum">  75</span></a>                  'reason' =&gt; null,
<a name="l76"><span class="linenum">  76</span></a>                  'tokenid' =&gt; <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;id
<a name="l77"><span class="linenum">  77</span></a>              )
<a name="l78"><span class="linenum">  78</span></a>          );
<a name="l79"><span class="linenum">  79</span></a>  
<a name="l80"><span class="linenum">  80</span></a>  <span class="comment">        // Validate token date</span>
<a name="l81"><span class="linenum">  81</span></a>          if (<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('validuntil')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/validuntil.html">validuntil</a> and <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('validuntil')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/validuntil.html">validuntil</a> &lt; <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()) {
<a name="l82"><span class="linenum">  82</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it9250" onMouseOver="hilite(9250)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l83"><span class="linenum">  83</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'token_expired';
<a name="l84"><span class="linenum">  84</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l85"><span class="linenum">  85</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('external_tokens', <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>);
<a name="l86"><span class="linenum">  86</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, 'webservice', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('tokenauthlog', 'webservice'), '',
<a name="l87"><span class="linenum">  87</span></a>                  <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('invalidtimedtoken', 'webservice'), 0));
<a name="l88"><span class="linenum">  88</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l89"><span class="linenum">  89</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_tokens', array('token' =&gt; <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('token')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/token.html">token</a>));
<a name="l90"><span class="linenum">  90</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Invalid token - token expired - check validuntil time for the token');
<a name="l91"><span class="linenum">  91</span></a>          }
<a name="l92"><span class="linenum">  92</span></a>  
<a name="l93"><span class="linenum">  93</span></a>  <span class="comment">        // Check ip</span>
<a name="l94"><span class="linenum">  94</span></a>          if (<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a> and !<a class="function" onClick="logFunction('address_in_subnet')" href="../_functions/address_in_subnet.html" onMouseOver="funcPopup(event,'address_in_subnet')">address_in_subnet</a>(<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>(), <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a>)) {
<a name="l95"><span class="linenum">  95</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it9250" onMouseOver="hilite(9250)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l96"><span class="linenum">  96</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'ip_restricted';
<a name="l97"><span class="linenum">  97</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l98"><span class="linenum">  98</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('external_tokens', <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>);
<a name="l99"><span class="linenum">  99</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, 'webservice', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('tokenauthlog', 'webservice'), '',
<a name="l100"><span class="linenum"> 100</span></a>                  <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('failedtolog', 'webservice') . &quot;: &quot; . <a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>(), 0));
<a name="l101"><span class="linenum"> 101</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l102"><span class="linenum"> 102</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Invalid token - IP:' . <a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>()
<a name="l103"><span class="linenum"> 103</span></a>                      . ' is not supported');
<a name="l104"><span class="linenum"> 104</span></a>          }
<a name="l105"><span class="linenum"> 105</span></a>  
<a name="l106"><span class="linenum"> 106</span></a>  <span class="comment">        //retrieve user link to the token</span>
<a name="l107"><span class="linenum"> 107</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id' =&gt; <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('userid')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>, 'deleted' =&gt; 0), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l108"><span class="linenum"> 108</span></a>  
<a name="l109"><span class="linenum"> 109</span></a>  <span class="comment">        // let enrol plugins deal with new enrolments if necessary</span>
<a name="l110"><span class="linenum"> 110</span></a>          <a class="function" onClick="logFunction('enrol_check_plugins')" href="../_functions/enrol_check_plugins.html" onMouseOver="funcPopup(event,'enrol_check_plugins')">enrol_check_plugins</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l111"><span class="linenum"> 111</span></a>  
<a name="l112"><span class="linenum"> 112</span></a>  <span class="comment">        // setup user session to check capability</span>
<a name="l113"><span class="linenum"> 113</span></a>          \core\session\<a class="class" onClick="logClass('manager')" href="../_classes/manager.html" onMouseOver="classPopup(event,'manager')">manager</a>::<a class="function" onClick="logFunction('set_user')" href="../_functions/set_user.html" onMouseOver="funcPopup(event,'set_user')">set_user</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l114"><span class="linenum"> 114</span></a>  
<a name="l115"><span class="linenum"> 115</span></a>  <span class="comment">        //assumes that if sid is set then there must be a valid associated session no matter the token type</span>
<a name="l116"><span class="linenum"> 116</span></a>          if (<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('sid')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/sid.html">sid</a>) {
<a name="l117"><span class="linenum"> 117</span></a>              if (!\core\session\<a class="class" onClick="logClass('manager')" href="../_classes/manager.html" onMouseOver="classPopup(event,'manager')">manager</a>::<a class="function" onClick="logFunction('session_exists')" href="../_functions/session_exists.html" onMouseOver="funcPopup(event,'session_exists')">session_exists</a>(<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('sid')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/sid.html">sid</a>)) {
<a name="l118"><span class="linenum"> 118</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_tokens', array('sid' =&gt; <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('sid')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/sid.html">sid</a>));
<a name="l119"><span class="linenum"> 119</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Invalid session based token - session not found or expired');
<a name="l120"><span class="linenum"> 120</span></a>              }
<a name="l121"><span class="linenum"> 121</span></a>          }
<a name="l122"><span class="linenum"> 122</span></a>  
<a name="l123"><span class="linenum"> 123</span></a>  <span class="comment">        //Non admin can not authenticate if maintenance mode</span>
<a name="l124"><span class="linenum"> 124</span></a>          <a class="var it2523" onMouseOver="hilite(2523)" onMouseOut="lolite()" onClick="logVariable('hassiteconfig')" href="../_variables/hassiteconfig.html">$hassiteconfig</a> = <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:config', <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(), <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l125"><span class="linenum"> 125</span></a>          if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('maintenance_enabled')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/maintenance_enabled.html">maintenance_enabled</a>) and !<a class="var it2523" onMouseOver="hilite(2523)" onMouseOut="lolite()" onClick="logVariable('hassiteconfig')" href="../_variables/hassiteconfig.html">$hassiteconfig</a>) {
<a name="l126"><span class="linenum"> 126</span></a>  <span class="comment">            //this is usually temporary, client want to implement code logic  =&gt; moodle_exception</span>
<a name="l127"><span class="linenum"> 127</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('sitemaintenance', 'admin');
<a name="l128"><span class="linenum"> 128</span></a>          }
<a name="l129"><span class="linenum"> 129</span></a>  
<a name="l130"><span class="linenum"> 130</span></a>  <span class="comment">        //retrieve web service record</span>
<a name="l131"><span class="linenum"> 131</span></a>          <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('external_services', array('id' =&gt; <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('externalserviceid')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/externalserviceid.html">externalserviceid</a>, 'enabled' =&gt; 1));
<a name="l132"><span class="linenum"> 132</span></a>          if (empty(<a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>)) {
<a name="l133"><span class="linenum"> 133</span></a>  <span class="comment">            // will throw exception if no token found</span>
<a name="l134"><span class="linenum"> 134</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Web service is not available (it doesn\'t exist or might be disabled)');
<a name="l135"><span class="linenum"> 135</span></a>          }
<a name="l136"><span class="linenum"> 136</span></a>  
<a name="l137"><span class="linenum"> 137</span></a>  <span class="comment">        //check if there is any required system capability</span>
<a name="l138"><span class="linenum"> 138</span></a>          if (<a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('requiredcapability')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/requiredcapability.html">requiredcapability</a> and !<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(<a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('requiredcapability')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/requiredcapability.html">requiredcapability</a>, <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(), <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l139"><span class="linenum"> 139</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('The capability ' . <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('requiredcapability')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/requiredcapability.html">requiredcapability</a> . ' is required.');
<a name="l140"><span class="linenum"> 140</span></a>          }
<a name="l141"><span class="linenum"> 141</span></a>  
<a name="l142"><span class="linenum"> 142</span></a>  <span class="comment">        //specific checks related to user restricted service</span>
<a name="l143"><span class="linenum"> 143</span></a>          if (<a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('restrictedusers')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/restrictedusers.html">restrictedusers</a>) {
<a name="l144"><span class="linenum"> 144</span></a>              <a class="var it5793" onMouseOver="hilite(5793)" onMouseOut="lolite()" onClick="logVariable('authoriseduser')" href="../_variables/authoriseduser.html">$authoriseduser</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('external_services_users', array('externalserviceid' =&gt; <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('id')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'userid' =&gt; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l145"><span class="linenum"> 145</span></a>  
<a name="l146"><span class="linenum"> 146</span></a>              if (empty(<a class="var it5793" onMouseOver="hilite(5793)" onMouseOut="lolite()" onClick="logVariable('authoriseduser')" href="../_variables/authoriseduser.html">$authoriseduser</a>)) {
<a name="l147"><span class="linenum"> 147</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>(
<a name="l148"><span class="linenum"> 148</span></a>                          'The user is not allowed for this service. First you need to allow this user on the '
<a name="l149"><span class="linenum"> 149</span></a>                          . <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('name')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/name.html">name</a> . '\'s allowed users administration page.');
<a name="l150"><span class="linenum"> 150</span></a>              }
<a name="l151"><span class="linenum"> 151</span></a>  
<a name="l152"><span class="linenum"> 152</span></a>              if (!empty(<a class="var it5793" onMouseOver="hilite(5793)" onMouseOut="lolite()" onClick="logVariable('authoriseduser')" href="../_variables/authoriseduser.html">$authoriseduser</a>-&gt;<a onClick="logVariable('validuntil')" class="var it45261" onMouseOver="hilite(45261)" onMouseOut="lolite()" href="../_variables/validuntil.html">validuntil</a>) and <a class="var it5793" onMouseOver="hilite(5793)" onMouseOut="lolite()" onClick="logVariable('authoriseduser')" href="../_variables/authoriseduser.html">$authoriseduser</a>-&gt;<a onClick="logVariable('validuntil')" class="var it45261" onMouseOver="hilite(45261)" onMouseOut="lolite()" href="../_variables/validuntil.html">validuntil</a> &lt; <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()) {
<a name="l153"><span class="linenum"> 153</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Invalid service - service expired - check validuntil time for this allowed user');
<a name="l154"><span class="linenum"> 154</span></a>              }
<a name="l155"><span class="linenum"> 155</span></a>  
<a name="l156"><span class="linenum"> 156</span></a>              if (!empty(<a class="var it5793" onMouseOver="hilite(5793)" onMouseOut="lolite()" onClick="logVariable('authoriseduser')" href="../_variables/authoriseduser.html">$authoriseduser</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it45261" onMouseOver="hilite(45261)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a>) and !<a class="function" onClick="logFunction('address_in_subnet')" href="../_functions/address_in_subnet.html" onMouseOver="funcPopup(event,'address_in_subnet')">address_in_subnet</a>(<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>(), <a class="var it5793" onMouseOver="hilite(5793)" onMouseOut="lolite()" onClick="logVariable('authoriseduser')" href="../_variables/authoriseduser.html">$authoriseduser</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it45261" onMouseOver="hilite(45261)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a>)) {
<a name="l157"><span class="linenum"> 157</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Invalid service - IP:' . <a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>()
<a name="l158"><span class="linenum"> 158</span></a>                      . ' is not supported - check this allowed user');
<a name="l159"><span class="linenum"> 159</span></a>              }
<a name="l160"><span class="linenum"> 160</span></a>          }
<a name="l161"><span class="linenum"> 161</span></a>  
<a name="l162"><span class="linenum"> 162</span></a>  <span class="comment">        //only confirmed user should be able to call web service</span>
<a name="l163"><span class="linenum"> 163</span></a>          if (empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('confirmed')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/confirmed.html">confirmed</a>)) {
<a name="l164"><span class="linenum"> 164</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it9250" onMouseOver="hilite(9250)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l165"><span class="linenum"> 165</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'user_unconfirmed';
<a name="l166"><span class="linenum"> 166</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l167"><span class="linenum"> 167</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('external_tokens', <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>);
<a name="l168"><span class="linenum"> 168</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, 'webservice', 'user unconfirmed', '', <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>));
<a name="l169"><span class="linenum"> 169</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l170"><span class="linenum"> 170</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('usernotconfirmed', 'moodle', '', <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l171"><span class="linenum"> 171</span></a>          }
<a name="l172"><span class="linenum"> 172</span></a>  
<a name="l173"><span class="linenum"> 173</span></a>  <span class="comment">        //check the user is suspended</span>
<a name="l174"><span class="linenum"> 174</span></a>          if (!empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('suspended')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/suspended.html">suspended</a>)) {
<a name="l175"><span class="linenum"> 175</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it9250" onMouseOver="hilite(9250)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l176"><span class="linenum"> 176</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'user_suspended';
<a name="l177"><span class="linenum"> 177</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l178"><span class="linenum"> 178</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('external_tokens', <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>);
<a name="l179"><span class="linenum"> 179</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, 'webservice', 'user suspended', '', <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>));
<a name="l180"><span class="linenum"> 180</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l181"><span class="linenum"> 181</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Refused web service access for suspended username: ' . <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l182"><span class="linenum"> 182</span></a>          }
<a name="l183"><span class="linenum"> 183</span></a>  
<a name="l184"><span class="linenum"> 184</span></a>  <span class="comment">        //check if the auth method is nologin (in this case refuse connection)</span>
<a name="l185"><span class="linenum"> 185</span></a>          if (<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/auth.html">auth</a> == 'nologin') {
<a name="l186"><span class="linenum"> 186</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it9250" onMouseOver="hilite(9250)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l187"><span class="linenum"> 187</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'nologin';
<a name="l188"><span class="linenum"> 188</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l189"><span class="linenum"> 189</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('external_tokens', <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>);
<a name="l190"><span class="linenum"> 190</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, 'webservice', 'nologin auth attempt with web service', '', <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>));
<a name="l191"><span class="linenum"> 191</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l192"><span class="linenum"> 192</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Refused web service access for nologin authentication username: ' . <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l193"><span class="linenum"> 193</span></a>          }
<a name="l194"><span class="linenum"> 194</span></a>  
<a name="l195"><span class="linenum"> 195</span></a>  <span class="comment">        //Check if the user password is expired</span>
<a name="l196"><span class="linenum"> 196</span></a>          <a class="var it378" onMouseOver="hilite(378)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../_variables/auth.html">$auth</a> = <a class="function" onClick="logFunction('get_auth_plugin')" href="../_functions/get_auth_plugin.html" onMouseOver="funcPopup(event,'get_auth_plugin')">get_auth_plugin</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/auth.html">auth</a>);
<a name="l197"><span class="linenum"> 197</span></a>          if (!empty(<a class="var it378" onMouseOver="hilite(378)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../_variables/auth.html">$auth</a>-&gt;<a onClick="logVariable('config')" class="var it43487" onMouseOver="hilite(43487)" onMouseOut="lolite()" href="../_variables/config.html">config</a>-&gt;expiration) and <a class="var it378" onMouseOver="hilite(378)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../_variables/auth.html">$auth</a>-&gt;<a onClick="logVariable('config')" class="var it43487" onMouseOver="hilite(43487)" onMouseOut="lolite()" href="../_variables/config.html">config</a>-&gt;expiration == 1) {
<a name="l198"><span class="linenum"> 198</span></a>              <a class="var it380" onMouseOver="hilite(380)" onMouseOut="lolite()" onClick="logVariable('days2expire')" href="../_variables/days2expire.html">$days2expire</a> = <a class="var it378" onMouseOver="hilite(378)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../_variables/auth.html">$auth</a>-&gt;<a class="function" onClick="logFunction('password_expire')" href="../_functions/password_expire.html" onMouseOver="funcPopup(event,'password_expire')">password_expire</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l199"><span class="linenum"> 199</span></a>              if (<a class="phpfunction" onClick="logFunction('intval')" href="../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>(<a class="var it380" onMouseOver="hilite(380)" onMouseOut="lolite()" onClick="logVariable('days2expire')" href="../_variables/days2expire.html">$days2expire</a>) &lt; 0) {
<a name="l200"><span class="linenum"> 200</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it9250" onMouseOver="hilite(9250)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l201"><span class="linenum"> 201</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'password_expired';
<a name="l202"><span class="linenum"> 202</span></a>                  <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l203"><span class="linenum"> 203</span></a>                  <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('external_tokens', <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>);
<a name="l204"><span class="linenum"> 204</span></a>                  <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, 'webservice', 'expired password', '', <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>));
<a name="l205"><span class="linenum"> 205</span></a>                  <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l206"><span class="linenum"> 206</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('passwordisexpired', 'webservice');
<a name="l207"><span class="linenum"> 207</span></a>              }
<a name="l208"><span class="linenum"> 208</span></a>          }
<a name="l209"><span class="linenum"> 209</span></a>  
<a name="l210"><span class="linenum"> 210</span></a>  <span class="comment">        // log token access</span>
<a name="l211"><span class="linenum"> 211</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('external_tokens', 'lastaccess', <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>(), array('id' =&gt; <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('id')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l212"><span class="linenum"> 212</span></a>  
<a name="l213"><span class="linenum"> 213</span></a>          return array('user' =&gt; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, 'token' =&gt; <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>, 'service' =&gt; <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>);
<a name="l214"><span class="linenum"> 214</span></a>      }
<a name="l215"><span class="linenum"> 215</span></a>  
<a name="l216"><span class="linenum"> 216</span></a>      <span class="comment">/**</span>
<a name="l217"><span class="linenum"> 217</span></a>  <span class="comment">     * Allow user to call a service</span>
<a name="l218"><span class="linenum"> 218</span></a>  <span class="comment">     *</span>
<a name="l219"><span class="linenum"> 219</span></a>  <span class="comment">     * @param stdClass $user a user</span>
<a name="l220"><span class="linenum"> 220</span></a>  <span class="comment">     */</span>
<a name="l221"><span class="linenum"> 221</span></a>      public function <a class="function" onClick="logFunction('add_ws_authorised_user')" href="../_functions/add_ws_authorised_user.html" onMouseOver="funcPopup(event,'add_ws_authorised_user')">add_ws_authorised_user</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) {
<a name="l222"><span class="linenum"> 222</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l223"><span class="linenum"> 223</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('timecreated')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a> = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l224"><span class="linenum"> 224</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('external_services_users', <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l225"><span class="linenum"> 225</span></a>      }
<a name="l226"><span class="linenum"> 226</span></a>  
<a name="l227"><span class="linenum"> 227</span></a>      <span class="comment">/**</span>
<a name="l228"><span class="linenum"> 228</span></a>  <span class="comment">     * Disallow a user to call a service</span>
<a name="l229"><span class="linenum"> 229</span></a>  <span class="comment">     *</span>
<a name="l230"><span class="linenum"> 230</span></a>  <span class="comment">     * @param stdClass $user a user</span>
<a name="l231"><span class="linenum"> 231</span></a>  <span class="comment">     * @param int $serviceid</span>
<a name="l232"><span class="linenum"> 232</span></a>  <span class="comment">     */</span>
<a name="l233"><span class="linenum"> 233</span></a>      public function <a class="function" onClick="logFunction('remove_ws_authorised_user')" href="../_functions/remove_ws_authorised_user.html" onMouseOver="funcPopup(event,'remove_ws_authorised_user')">remove_ws_authorised_user</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>) {
<a name="l234"><span class="linenum"> 234</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l235"><span class="linenum"> 235</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_services_users',
<a name="l236"><span class="linenum"> 236</span></a>                  array('externalserviceid' =&gt; <a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>, 'userid' =&gt; <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l237"><span class="linenum"> 237</span></a>      }
<a name="l238"><span class="linenum"> 238</span></a>  
<a name="l239"><span class="linenum"> 239</span></a>      <span class="comment">/**</span>
<a name="l240"><span class="linenum"> 240</span></a>  <span class="comment">     * Update allowed user settings (ip restriction, valid until...)</span>
<a name="l241"><span class="linenum"> 241</span></a>  <span class="comment">     *</span>
<a name="l242"><span class="linenum"> 242</span></a>  <span class="comment">     * @param stdClass $user</span>
<a name="l243"><span class="linenum"> 243</span></a>  <span class="comment">     */</span>
<a name="l244"><span class="linenum"> 244</span></a>      public function <a class="function" onClick="logFunction('update_ws_authorised_user')" href="../_functions/update_ws_authorised_user.html" onMouseOver="funcPopup(event,'update_ws_authorised_user')">update_ws_authorised_user</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) {
<a name="l245"><span class="linenum"> 245</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l246"><span class="linenum"> 246</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('external_services_users', <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l247"><span class="linenum"> 247</span></a>      }
<a name="l248"><span class="linenum"> 248</span></a>  
<a name="l249"><span class="linenum"> 249</span></a>      <span class="comment">/**</span>
<a name="l250"><span class="linenum"> 250</span></a>  <span class="comment">     * Return list of allowed users with their options (ip/timecreated / validuntil...)</span>
<a name="l251"><span class="linenum"> 251</span></a>  <span class="comment">     * for a given service</span>
<a name="l252"><span class="linenum"> 252</span></a>  <span class="comment">     *</span>
<a name="l253"><span class="linenum"> 253</span></a>  <span class="comment">     * @param int $serviceid the service id to search against</span>
<a name="l254"><span class="linenum"> 254</span></a>  <span class="comment">     * @return array $users</span>
<a name="l255"><span class="linenum"> 255</span></a>  <span class="comment">     */</span>
<a name="l256"><span class="linenum"> 256</span></a>      public function <a class="function" onClick="logFunction('get_ws_authorised_users')" href="../_functions/get_ws_authorised_users.html" onMouseOver="funcPopup(event,'get_ws_authorised_users')">get_ws_authorised_users</a>(<a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>) {
<a name="l257"><span class="linenum"> 257</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l258"><span class="linenum"> 258</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('siteguest')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/siteguest.html">siteguest</a>, <a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>);
<a name="l259"><span class="linenum"> 259</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot; SELECT u.id as id, esu.id as serviceuserid, u.email as email, u.firstname as firstname,
<a name="l260"><span class="linenum"> 260</span></a>                          u.lastname as lastname,
<a name="l261"><span class="linenum"> 261</span></a>                          esu.iprestriction as iprestriction, esu.validuntil as validuntil,
<a name="l262"><span class="linenum"> 262</span></a>                          esu.timecreated as timecreated
<a name="l263"><span class="linenum"> 263</span></a>                     FROM {user} u, {external_services_users} esu
<a name="l264"><span class="linenum"> 264</span></a>                    WHERE u.id &lt;&gt; ? AND u.deleted = 0 AND u.confirmed = 1
<a name="l265"><span class="linenum"> 265</span></a>                          AND esu.userid = u.id
<a name="l266"><span class="linenum"> 266</span></a>                          AND esu.externalserviceid = ?&quot;;
<a name="l267"><span class="linenum"> 267</span></a>  
<a name="l268"><span class="linenum"> 268</span></a>          <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l269"><span class="linenum"> 269</span></a>          return <a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a>;
<a name="l270"><span class="linenum"> 270</span></a>      }
<a name="l271"><span class="linenum"> 271</span></a>  
<a name="l272"><span class="linenum"> 272</span></a>      <span class="comment">/**</span>
<a name="l273"><span class="linenum"> 273</span></a>  <span class="comment">     * Return an authorised user with their options (ip/timecreated / validuntil...)</span>
<a name="l274"><span class="linenum"> 274</span></a>  <span class="comment">     *</span>
<a name="l275"><span class="linenum"> 275</span></a>  <span class="comment">     * @param int $serviceid the service id to search against</span>
<a name="l276"><span class="linenum"> 276</span></a>  <span class="comment">     * @param int $userid the user to search against</span>
<a name="l277"><span class="linenum"> 277</span></a>  <span class="comment">     * @return stdClass</span>
<a name="l278"><span class="linenum"> 278</span></a>  <span class="comment">     */</span>
<a name="l279"><span class="linenum"> 279</span></a>      public function <a class="function" onClick="logFunction('get_ws_authorised_user')" href="../_functions/get_ws_authorised_user.html" onMouseOver="funcPopup(event,'get_ws_authorised_user')">get_ws_authorised_user</a>(<a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) {
<a name="l280"><span class="linenum"> 280</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l281"><span class="linenum"> 281</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('siteguest')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/siteguest.html">siteguest</a>, <a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>, <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>);
<a name="l282"><span class="linenum"> 282</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot; SELECT u.id as id, esu.id as serviceuserid, u.email as email, u.firstname as firstname,
<a name="l283"><span class="linenum"> 283</span></a>                          u.lastname as lastname,
<a name="l284"><span class="linenum"> 284</span></a>                          esu.iprestriction as iprestriction, esu.validuntil as validuntil,
<a name="l285"><span class="linenum"> 285</span></a>                          esu.timecreated as timecreated
<a name="l286"><span class="linenum"> 286</span></a>                     FROM {user} u, {external_services_users} esu
<a name="l287"><span class="linenum"> 287</span></a>                    WHERE u.id &lt;&gt; ? AND u.deleted = 0 AND u.confirmed = 1
<a name="l288"><span class="linenum"> 288</span></a>                          AND esu.userid = u.id
<a name="l289"><span class="linenum"> 289</span></a>                          AND esu.externalserviceid = ?
<a name="l290"><span class="linenum"> 290</span></a>                          AND u.id = ?&quot;;
<a name="l291"><span class="linenum"> 291</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l292"><span class="linenum"> 292</span></a>          return <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>;
<a name="l293"><span class="linenum"> 293</span></a>      }
<a name="l294"><span class="linenum"> 294</span></a>  
<a name="l295"><span class="linenum"> 295</span></a>      <span class="comment">/**</span>
<a name="l296"><span class="linenum"> 296</span></a>  <span class="comment">     * Generate all tokens of a specific user</span>
<a name="l297"><span class="linenum"> 297</span></a>  <span class="comment">     *</span>
<a name="l298"><span class="linenum"> 298</span></a>  <span class="comment">     * @param int $userid user id</span>
<a name="l299"><span class="linenum"> 299</span></a>  <span class="comment">     */</span>
<a name="l300"><span class="linenum"> 300</span></a>      public function <a class="function" onClick="logFunction('generate_user_ws_tokens')" href="../_functions/generate_user_ws_tokens.html" onMouseOver="funcPopup(event,'generate_user_ws_tokens')">generate_user_ws_tokens</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) {
<a name="l301"><span class="linenum"> 301</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l302"><span class="linenum"> 302</span></a>  
<a name="l303"><span class="linenum"> 303</span></a>  <span class="comment">        // generate a token for non admin if web service are enable and the user has the capability to create a token</span>
<a name="l304"><span class="linenum"> 304</span></a>          if (!<a class="function" onClick="logFunction('is_siteadmin')" href="../_functions/is_siteadmin.html" onMouseOver="funcPopup(event,'is_siteadmin')">is_siteadmin</a>() &amp;&amp; <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/webservice:createtoken', <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(), <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) &amp;&amp; !empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enablewebservices')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/enablewebservices.html">enablewebservices</a>)) {
<a name="l305"><span class="linenum"> 305</span></a>  <span class="comment">            // for every service than the user is authorised on, create a token (if it doesn't already exist)</span>
<a name="l306"><span class="linenum"> 306</span></a>  
<a name="l307"><span class="linenum"> 307</span></a>  <span class="comment">            // get all services which are set to all user (no restricted to specific users)</span>
<a name="l308"><span class="linenum"> 308</span></a>              <a class="var it9251" onMouseOver="hilite(9251)" onMouseOut="lolite()" onClick="logVariable('norestrictedservices')" href="../_variables/norestrictedservices.html">$norestrictedservices</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('external_services', array('restrictedusers' =&gt; 0));
<a name="l309"><span class="linenum"> 309</span></a>              <a class="var it9252" onMouseOver="hilite(9252)" onMouseOut="lolite()" onClick="logVariable('serviceidlist')" href="../_variables/serviceidlist.html">$serviceidlist</a> = array();
<a name="l310"><span class="linenum"> 310</span></a>              foreach (<a class="var it9251" onMouseOver="hilite(9251)" onMouseOut="lolite()" onClick="logVariable('norestrictedservices')" href="../_variables/norestrictedservices.html">$norestrictedservices</a> as <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>) {
<a name="l311"><span class="linenum"> 311</span></a>                  <a class="var it9252" onMouseOver="hilite(9252)" onMouseOut="lolite()" onClick="logVariable('serviceidlist')" href="../_variables/serviceidlist.html">$serviceidlist</a>[] = <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('id')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l312"><span class="linenum"> 312</span></a>              }
<a name="l313"><span class="linenum"> 313</span></a>  
<a name="l314"><span class="linenum"> 314</span></a>  <span class="comment">            // get all services which are set to the current user (the current user is specified in the restricted user list)</span>
<a name="l315"><span class="linenum"> 315</span></a>              <a class="var it9253" onMouseOver="hilite(9253)" onMouseOut="lolite()" onClick="logVariable('servicesusers')" href="../_variables/servicesusers.html">$servicesusers</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('external_services_users', array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>));
<a name="l316"><span class="linenum"> 316</span></a>              foreach (<a class="var it9253" onMouseOver="hilite(9253)" onMouseOut="lolite()" onClick="logVariable('servicesusers')" href="../_variables/servicesusers.html">$servicesusers</a> as <a class="var it5560" onMouseOver="hilite(5560)" onMouseOut="lolite()" onClick="logVariable('serviceuser')" href="../_variables/serviceuser.html">$serviceuser</a>) {
<a name="l317"><span class="linenum"> 317</span></a>                  if (!<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it5560" onMouseOver="hilite(5560)" onMouseOut="lolite()" onClick="logVariable('serviceuser')" href="../_variables/serviceuser.html">$serviceuser</a>-&gt;<a onClick="logVariable('externalserviceid')" class="var it44951" onMouseOver="hilite(44951)" onMouseOut="lolite()" href="../_variables/externalserviceid.html">externalserviceid</a>,<a class="var it9252" onMouseOver="hilite(9252)" onMouseOut="lolite()" onClick="logVariable('serviceidlist')" href="../_variables/serviceidlist.html">$serviceidlist</a>)) {
<a name="l318"><span class="linenum"> 318</span></a>                       <a class="var it9252" onMouseOver="hilite(9252)" onMouseOut="lolite()" onClick="logVariable('serviceidlist')" href="../_variables/serviceidlist.html">$serviceidlist</a>[] = <a class="var it5560" onMouseOver="hilite(5560)" onMouseOut="lolite()" onClick="logVariable('serviceuser')" href="../_variables/serviceuser.html">$serviceuser</a>-&gt;<a onClick="logVariable('externalserviceid')" class="var it44951" onMouseOver="hilite(44951)" onMouseOut="lolite()" href="../_variables/externalserviceid.html">externalserviceid</a>;
<a name="l319"><span class="linenum"> 319</span></a>                  }
<a name="l320"><span class="linenum"> 320</span></a>              }
<a name="l321"><span class="linenum"> 321</span></a>  
<a name="l322"><span class="linenum"> 322</span></a>  <span class="comment">            // get all services which already have a token set for the current user</span>
<a name="l323"><span class="linenum"> 323</span></a>              <a class="var it9254" onMouseOver="hilite(9254)" onMouseOut="lolite()" onClick="logVariable('usertokens')" href="../_variables/usertokens.html">$usertokens</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('external_tokens', array('userid' =&gt; <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, 'tokentype' =&gt; <a class="constant" onClick="logConstant('EXTERNAL_TOKEN_PERMANENT')" href="../_constants/EXTERNAL_TOKEN_PERMANENT.html" onMouseOver="constPopup(event,'EXTERNAL_TOKEN_PERMANENT')">EXTERNAL_TOKEN_PERMANENT</a>));
<a name="l324"><span class="linenum"> 324</span></a>              <a class="var it9255" onMouseOver="hilite(9255)" onMouseOut="lolite()" onClick="logVariable('tokenizedservice')" href="../_variables/tokenizedservice.html">$tokenizedservice</a> = array();
<a name="l325"><span class="linenum"> 325</span></a>              foreach (<a class="var it9254" onMouseOver="hilite(9254)" onMouseOut="lolite()" onClick="logVariable('usertokens')" href="../_variables/usertokens.html">$usertokens</a> as <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>) {
<a name="l326"><span class="linenum"> 326</span></a>                      <a class="var it9255" onMouseOver="hilite(9255)" onMouseOut="lolite()" onClick="logVariable('tokenizedservice')" href="../_variables/tokenizedservice.html">$tokenizedservice</a>[]  = <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('externalserviceid')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/externalserviceid.html">externalserviceid</a>;
<a name="l327"><span class="linenum"> 327</span></a>              }
<a name="l328"><span class="linenum"> 328</span></a>  
<a name="l329"><span class="linenum"> 329</span></a>  <span class="comment">            // create a token for the service which have no token already</span>
<a name="l330"><span class="linenum"> 330</span></a>              foreach (<a class="var it9252" onMouseOver="hilite(9252)" onMouseOut="lolite()" onClick="logVariable('serviceidlist')" href="../_variables/serviceidlist.html">$serviceidlist</a> as <a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>) {
<a name="l331"><span class="linenum"> 331</span></a>                  if (!<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>, <a class="var it9255" onMouseOver="hilite(9255)" onMouseOut="lolite()" onClick="logVariable('tokenizedservice')" href="../_variables/tokenizedservice.html">$tokenizedservice</a>)) {
<a name="l332"><span class="linenum"> 332</span></a>  <span class="comment">                    // create the token for this service</span>
<a name="l333"><span class="linenum"> 333</span></a>                      <a class="var it9256" onMouseOver="hilite(9256)" onMouseOut="lolite()" onClick="logVariable('newtoken')" href="../_variables/newtoken.html">$newtoken</a> = new stdClass();
<a name="l334"><span class="linenum"> 334</span></a>                      <a class="var it9256" onMouseOver="hilite(9256)" onMouseOut="lolite()" onClick="logVariable('newtoken')" href="../_variables/newtoken.html">$newtoken</a>-&gt;<a onClick="logVariable('token')" class="var it44246" onMouseOver="hilite(44246)" onMouseOut="lolite()" href="../_variables/token.html">token</a> = md5(<a class="phpfunction" onClick="logFunction('uniqid')" href="../_functions/uniqid.html" onMouseOver="phpfuncPopup(event,'uniqid')">uniqid</a>(<a class="phpfunction" onClick="logFunction('rand')" href="../_functions/rand.html" onMouseOver="phpfuncPopup(event,'rand')">rand</a>(),1));
<a name="l335"><span class="linenum"> 335</span></a>  <span class="comment">                    // check that the user has capability on this service</span>
<a name="l336"><span class="linenum"> 336</span></a>                      <a class="var it9256" onMouseOver="hilite(9256)" onMouseOut="lolite()" onClick="logVariable('newtoken')" href="../_variables/newtoken.html">$newtoken</a>-&gt;<a onClick="logVariable('tokentype')" class="var it44246" onMouseOver="hilite(44246)" onMouseOut="lolite()" href="../_variables/tokentype.html">tokentype</a> = <a class="constant" onClick="logConstant('EXTERNAL_TOKEN_PERMANENT')" href="../_constants/EXTERNAL_TOKEN_PERMANENT.html" onMouseOver="constPopup(event,'EXTERNAL_TOKEN_PERMANENT')">EXTERNAL_TOKEN_PERMANENT</a>;
<a name="l337"><span class="linenum"> 337</span></a>                      <a class="var it9256" onMouseOver="hilite(9256)" onMouseOut="lolite()" onClick="logVariable('newtoken')" href="../_variables/newtoken.html">$newtoken</a>-&gt;<a onClick="logVariable('userid')" class="var it44246" onMouseOver="hilite(44246)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a> = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>;
<a name="l338"><span class="linenum"> 338</span></a>                      <a class="var it9256" onMouseOver="hilite(9256)" onMouseOut="lolite()" onClick="logVariable('newtoken')" href="../_variables/newtoken.html">$newtoken</a>-&gt;<a onClick="logVariable('externalserviceid')" class="var it44246" onMouseOver="hilite(44246)" onMouseOut="lolite()" href="../_variables/externalserviceid.html">externalserviceid</a> = <a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>;
<a name="l339"><span class="linenum"> 339</span></a>  <span class="comment">                    // TODO MDL-31190 find a way to get the context - UPDATE FOLLOWING LINE</span>
<a name="l340"><span class="linenum"> 340</span></a>                      <a class="var it9256" onMouseOver="hilite(9256)" onMouseOut="lolite()" onClick="logVariable('newtoken')" href="../_variables/newtoken.html">$newtoken</a>-&gt;<a onClick="logVariable('contextid')" class="var it44246" onMouseOver="hilite(44246)" onMouseOut="lolite()" href="../_variables/contextid.html">contextid</a> = <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>()-&gt;id;
<a name="l341"><span class="linenum"> 341</span></a>                      <a class="var it9256" onMouseOver="hilite(9256)" onMouseOut="lolite()" onClick="logVariable('newtoken')" href="../_variables/newtoken.html">$newtoken</a>-&gt;<a onClick="logVariable('creatorid')" class="var it44246" onMouseOver="hilite(44246)" onMouseOut="lolite()" href="../_variables/creatorid.html">creatorid</a> = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>;
<a name="l342"><span class="linenum"> 342</span></a>                      <a class="var it9256" onMouseOver="hilite(9256)" onMouseOut="lolite()" onClick="logVariable('newtoken')" href="../_variables/newtoken.html">$newtoken</a>-&gt;<a onClick="logVariable('timecreated')" class="var it44246" onMouseOver="hilite(44246)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a> = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l343"><span class="linenum"> 343</span></a>  
<a name="l344"><span class="linenum"> 344</span></a>                      <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('external_tokens', <a class="var it9256" onMouseOver="hilite(9256)" onMouseOut="lolite()" onClick="logVariable('newtoken')" href="../_variables/newtoken.html">$newtoken</a>);
<a name="l345"><span class="linenum"> 345</span></a>                  }
<a name="l346"><span class="linenum"> 346</span></a>              }
<a name="l347"><span class="linenum"> 347</span></a>  
<a name="l348"><span class="linenum"> 348</span></a>  
<a name="l349"><span class="linenum"> 349</span></a>          }
<a name="l350"><span class="linenum"> 350</span></a>      }
<a name="l351"><span class="linenum"> 351</span></a>  
<a name="l352"><span class="linenum"> 352</span></a>      <span class="comment">/**</span>
<a name="l353"><span class="linenum"> 353</span></a>  <span class="comment">     * Return all tokens of a specific user</span>
<a name="l354"><span class="linenum"> 354</span></a>  <span class="comment">     * + the service state (enabled/disabled)</span>
<a name="l355"><span class="linenum"> 355</span></a>  <span class="comment">     * + the authorised user mode (restricted/not restricted)</span>
<a name="l356"><span class="linenum"> 356</span></a>  <span class="comment">     *</span>
<a name="l357"><span class="linenum"> 357</span></a>  <span class="comment">     * @param int $userid user id</span>
<a name="l358"><span class="linenum"> 358</span></a>  <span class="comment">     * @return array</span>
<a name="l359"><span class="linenum"> 359</span></a>  <span class="comment">     */</span>
<a name="l360"><span class="linenum"> 360</span></a>      public function <a class="function" onClick="logFunction('get_user_ws_tokens')" href="../_functions/get_user_ws_tokens.html" onMouseOver="funcPopup(event,'get_user_ws_tokens')">get_user_ws_tokens</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) {
<a name="l361"><span class="linenum"> 361</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l362"><span class="linenum"> 362</span></a>  <span class="comment">        //here retrieve token list (including linked users firstname/lastname and linked services name)</span>
<a name="l363"><span class="linenum"> 363</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT
<a name="l364"><span class="linenum"> 364</span></a>                      t.id, t.creatorid, t.token, u.firstname, u.lastname, s.id as wsid, s.name, s.enabled, s.restrictedusers, t.validuntil
<a name="l365"><span class="linenum"> 365</span></a>                  FROM
<a name="l366"><span class="linenum"> 366</span></a>                      {external_tokens} t, {user} u, {external_services} s
<a name="l367"><span class="linenum"> 367</span></a>                  WHERE
<a name="l368"><span class="linenum"> 368</span></a>                      t.userid=? AND t.tokentype = &quot;.<a class="constant" onClick="logConstant('EXTERNAL_TOKEN_PERMANENT')" href="../_constants/EXTERNAL_TOKEN_PERMANENT.html" onMouseOver="constPopup(event,'EXTERNAL_TOKEN_PERMANENT')">EXTERNAL_TOKEN_PERMANENT</a>.&quot; AND s.id = t.externalserviceid AND t.userid = u.id&quot;;
<a name="l369"><span class="linenum"> 369</span></a>          <a class="var it480" onMouseOver="hilite(480)" onMouseOut="lolite()" onClick="logVariable('tokens')" href="../_variables/tokens.html">$tokens</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, array( <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>));
<a name="l370"><span class="linenum"> 370</span></a>          return <a class="var it480" onMouseOver="hilite(480)" onMouseOut="lolite()" onClick="logVariable('tokens')" href="../_variables/tokens.html">$tokens</a>;
<a name="l371"><span class="linenum"> 371</span></a>      }
<a name="l372"><span class="linenum"> 372</span></a>  
<a name="l373"><span class="linenum"> 373</span></a>      <span class="comment">/**</span>
<a name="l374"><span class="linenum"> 374</span></a>  <span class="comment">     * Return a token that has been created by the user (i.e. to created by an admin)</span>
<a name="l375"><span class="linenum"> 375</span></a>  <span class="comment">     * If no tokens exist an exception is thrown</span>
<a name="l376"><span class="linenum"> 376</span></a>  <span class="comment">     *</span>
<a name="l377"><span class="linenum"> 377</span></a>  <span class="comment">     * The returned value is a stdClass:</span>
<a name="l378"><span class="linenum"> 378</span></a>  <span class="comment">     * -&gt;id token id</span>
<a name="l379"><span class="linenum"> 379</span></a>  <span class="comment">     * -&gt;token</span>
<a name="l380"><span class="linenum"> 380</span></a>  <span class="comment">     * -&gt;firstname user firstname</span>
<a name="l381"><span class="linenum"> 381</span></a>  <span class="comment">     * -&gt;lastname</span>
<a name="l382"><span class="linenum"> 382</span></a>  <span class="comment">     * -&gt;name service name</span>
<a name="l383"><span class="linenum"> 383</span></a>  <span class="comment">     *</span>
<a name="l384"><span class="linenum"> 384</span></a>  <span class="comment">     * @param int $userid user id</span>
<a name="l385"><span class="linenum"> 385</span></a>  <span class="comment">     * @param int $tokenid token id</span>
<a name="l386"><span class="linenum"> 386</span></a>  <span class="comment">     * @return stdClass</span>
<a name="l387"><span class="linenum"> 387</span></a>  <span class="comment">     */</span>
<a name="l388"><span class="linenum"> 388</span></a>      public function <a class="function" onClick="logFunction('get_created_by_user_ws_token')" href="../_functions/get_created_by_user_ws_token.html" onMouseOver="funcPopup(event,'get_created_by_user_ws_token')">get_created_by_user_ws_token</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it4324" onMouseOver="hilite(4324)" onMouseOut="lolite()" onClick="logVariable('tokenid')" href="../_variables/tokenid.html">$tokenid</a>) {
<a name="l389"><span class="linenum"> 389</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l390"><span class="linenum"> 390</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT
<a name="l391"><span class="linenum"> 391</span></a>                          t.id, t.token, u.firstname, u.lastname, s.name
<a name="l392"><span class="linenum"> 392</span></a>                      FROM
<a name="l393"><span class="linenum"> 393</span></a>                          {external_tokens} t, {user} u, {external_services} s
<a name="l394"><span class="linenum"> 394</span></a>                      WHERE
<a name="l395"><span class="linenum"> 395</span></a>                          t.creatorid=? AND t.id=? AND t.tokentype = &quot;
<a name="l396"><span class="linenum"> 396</span></a>                  . <a class="constant" onClick="logConstant('EXTERNAL_TOKEN_PERMANENT')" href="../_constants/EXTERNAL_TOKEN_PERMANENT.html" onMouseOver="constPopup(event,'EXTERNAL_TOKEN_PERMANENT')">EXTERNAL_TOKEN_PERMANENT</a>
<a name="l397"><span class="linenum"> 397</span></a>                  . &quot; AND s.id = t.externalserviceid AND t.userid = u.id&quot;;
<a name="l398"><span class="linenum"> 398</span></a>  <span class="comment">        //must be the token creator</span>
<a name="l399"><span class="linenum"> 399</span></a>          <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, array(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it4324" onMouseOver="hilite(4324)" onMouseOut="lolite()" onClick="logVariable('tokenid')" href="../_variables/tokenid.html">$tokenid</a>), <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l400"><span class="linenum"> 400</span></a>          return <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>;
<a name="l401"><span class="linenum"> 401</span></a>      }
<a name="l402"><span class="linenum"> 402</span></a>  
<a name="l403"><span class="linenum"> 403</span></a>      <span class="comment">/**</span>
<a name="l404"><span class="linenum"> 404</span></a>  <span class="comment">     * Return a database token record for a token id</span>
<a name="l405"><span class="linenum"> 405</span></a>  <span class="comment">     *</span>
<a name="l406"><span class="linenum"> 406</span></a>  <span class="comment">     * @param int $tokenid token id</span>
<a name="l407"><span class="linenum"> 407</span></a>  <span class="comment">     * @return object token</span>
<a name="l408"><span class="linenum"> 408</span></a>  <span class="comment">     */</span>
<a name="l409"><span class="linenum"> 409</span></a>      public function <a class="function" onClick="logFunction('get_token_by_id')" href="../_functions/get_token_by_id.html" onMouseOver="funcPopup(event,'get_token_by_id')">get_token_by_id</a>(<a class="var it4324" onMouseOver="hilite(4324)" onMouseOut="lolite()" onClick="logVariable('tokenid')" href="../_variables/tokenid.html">$tokenid</a>) {
<a name="l410"><span class="linenum"> 410</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l411"><span class="linenum"> 411</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('external_tokens', array('id' =&gt; <a class="var it4324" onMouseOver="hilite(4324)" onMouseOut="lolite()" onClick="logVariable('tokenid')" href="../_variables/tokenid.html">$tokenid</a>));
<a name="l412"><span class="linenum"> 412</span></a>      }
<a name="l413"><span class="linenum"> 413</span></a>  
<a name="l414"><span class="linenum"> 414</span></a>      <span class="comment">/**</span>
<a name="l415"><span class="linenum"> 415</span></a>  <span class="comment">     * Delete a token</span>
<a name="l416"><span class="linenum"> 416</span></a>  <span class="comment">     *</span>
<a name="l417"><span class="linenum"> 417</span></a>  <span class="comment">     * @param int $tokenid token id</span>
<a name="l418"><span class="linenum"> 418</span></a>  <span class="comment">     */</span>
<a name="l419"><span class="linenum"> 419</span></a>      public function <a class="function" onClick="logFunction('delete_user_ws_token')" href="../_functions/delete_user_ws_token.html" onMouseOver="funcPopup(event,'delete_user_ws_token')">delete_user_ws_token</a>(<a class="var it4324" onMouseOver="hilite(4324)" onMouseOut="lolite()" onClick="logVariable('tokenid')" href="../_variables/tokenid.html">$tokenid</a>) {
<a name="l420"><span class="linenum"> 420</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l421"><span class="linenum"> 421</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_tokens', array('id'=&gt;<a class="var it4324" onMouseOver="hilite(4324)" onMouseOut="lolite()" onClick="logVariable('tokenid')" href="../_variables/tokenid.html">$tokenid</a>));
<a name="l422"><span class="linenum"> 422</span></a>      }
<a name="l423"><span class="linenum"> 423</span></a>  
<a name="l424"><span class="linenum"> 424</span></a>      <span class="comment">/**</span>
<a name="l425"><span class="linenum"> 425</span></a>  <span class="comment">     * Delete a service</span>
<a name="l426"><span class="linenum"> 426</span></a>  <span class="comment">     * Also delete function references and authorised user references.</span>
<a name="l427"><span class="linenum"> 427</span></a>  <span class="comment">     *</span>
<a name="l428"><span class="linenum"> 428</span></a>  <span class="comment">     * @param int $serviceid service id</span>
<a name="l429"><span class="linenum"> 429</span></a>  <span class="comment">     */</span>
<a name="l430"><span class="linenum"> 430</span></a>      public function <a class="function" onClick="logFunction('delete_service')" href="../_functions/delete_service.html" onMouseOver="funcPopup(event,'delete_service')">delete_service</a>(<a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>) {
<a name="l431"><span class="linenum"> 431</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l432"><span class="linenum"> 432</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_services_users', array('externalserviceid' =&gt; <a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>));
<a name="l433"><span class="linenum"> 433</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_services_functions', array('externalserviceid' =&gt; <a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>));
<a name="l434"><span class="linenum"> 434</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_tokens', array('externalserviceid' =&gt; <a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>));
<a name="l435"><span class="linenum"> 435</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_services', array('id' =&gt; <a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>));
<a name="l436"><span class="linenum"> 436</span></a>      }
<a name="l437"><span class="linenum"> 437</span></a>  
<a name="l438"><span class="linenum"> 438</span></a>      <span class="comment">/**</span>
<a name="l439"><span class="linenum"> 439</span></a>  <span class="comment">     * Get a full database token record for a given token value</span>
<a name="l440"><span class="linenum"> 440</span></a>  <span class="comment">     *</span>
<a name="l441"><span class="linenum"> 441</span></a>  <span class="comment">     * @param string $token</span>
<a name="l442"><span class="linenum"> 442</span></a>  <span class="comment">     * @throws moodle_exception if there is multiple result</span>
<a name="l443"><span class="linenum"> 443</span></a>  <span class="comment">     */</span>
<a name="l444"><span class="linenum"> 444</span></a>      public function <a class="function" onClick="logFunction('get_user_ws_token')" href="../_functions/get_user_ws_token.html" onMouseOver="funcPopup(event,'get_user_ws_token')">get_user_ws_token</a>(<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>) {
<a name="l445"><span class="linenum"> 445</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l446"><span class="linenum"> 446</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('external_tokens', array('token'=&gt;<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l447"><span class="linenum"> 447</span></a>      }
<a name="l448"><span class="linenum"> 448</span></a>  
<a name="l449"><span class="linenum"> 449</span></a>      <span class="comment">/**</span>
<a name="l450"><span class="linenum"> 450</span></a>  <span class="comment">     * Get the functions list of a service list (by id)</span>
<a name="l451"><span class="linenum"> 451</span></a>  <span class="comment">     *</span>
<a name="l452"><span class="linenum"> 452</span></a>  <span class="comment">     * @param array $serviceids service ids</span>
<a name="l453"><span class="linenum"> 453</span></a>  <span class="comment">     * @return array of functions</span>
<a name="l454"><span class="linenum"> 454</span></a>  <span class="comment">     */</span>
<a name="l455"><span class="linenum"> 455</span></a>      public function <a class="function" onClick="logFunction('get_external_functions')" href="../_functions/get_external_functions.html" onMouseOver="funcPopup(event,'get_external_functions')">get_external_functions</a>(<a class="var it9257" onMouseOver="hilite(9257)" onMouseOut="lolite()" onClick="logVariable('serviceids')" href="../_variables/serviceids.html">$serviceids</a>) {
<a name="l456"><span class="linenum"> 456</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l457"><span class="linenum"> 457</span></a>          if (!empty(<a class="var it9257" onMouseOver="hilite(9257)" onMouseOut="lolite()" onClick="logVariable('serviceids')" href="../_variables/serviceids.html">$serviceids</a>)) {
<a name="l458"><span class="linenum"> 458</span></a>              <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it9257" onMouseOver="hilite(9257)" onMouseOut="lolite()" onClick="logVariable('serviceids')" href="../_variables/serviceids.html">$serviceids</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it9257" onMouseOver="hilite(9257)" onMouseOut="lolite()" onClick="logVariable('serviceids')" href="../_variables/serviceids.html">$serviceids</a>);
<a name="l459"><span class="linenum"> 459</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT f.*
<a name="l460"><span class="linenum"> 460</span></a>                        FROM {external_functions} f
<a name="l461"><span class="linenum"> 461</span></a>                       WHERE f.name IN (SELECT sf.functionname
<a name="l462"><span class="linenum"> 462</span></a>                                          FROM {external_services_functions} sf
<a name="l463"><span class="linenum"> 463</span></a>                                         WHERE sf.externalserviceid <a class="var it9257" onMouseOver="hilite(9257)" onMouseOut="lolite()" onClick="logVariable('serviceids')" href="../_variables/serviceids.html">$serviceids</a>)
<a name="l464"><span class="linenum"> 464</span></a>                       ORDER BY f.name ASC&quot;;
<a name="l465"><span class="linenum"> 465</span></a>              <a class="var it302" onMouseOver="hilite(302)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l466"><span class="linenum"> 466</span></a>          } else {
<a name="l467"><span class="linenum"> 467</span></a>              <a class="var it302" onMouseOver="hilite(302)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a> = array();
<a name="l468"><span class="linenum"> 468</span></a>          }
<a name="l469"><span class="linenum"> 469</span></a>          return <a class="var it302" onMouseOver="hilite(302)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a>;
<a name="l470"><span class="linenum"> 470</span></a>      }
<a name="l471"><span class="linenum"> 471</span></a>  
<a name="l472"><span class="linenum"> 472</span></a>      <span class="comment">/**</span>
<a name="l473"><span class="linenum"> 473</span></a>  <span class="comment">     * Get the functions of a service list (by shortname). It can return only enabled functions if required.</span>
<a name="l474"><span class="linenum"> 474</span></a>  <span class="comment">     *</span>
<a name="l475"><span class="linenum"> 475</span></a>  <span class="comment">     * @param array $serviceshortnames service shortnames</span>
<a name="l476"><span class="linenum"> 476</span></a>  <span class="comment">     * @param bool $enabledonly if true then only return functions for services that have been enabled</span>
<a name="l477"><span class="linenum"> 477</span></a>  <span class="comment">     * @return array functions</span>
<a name="l478"><span class="linenum"> 478</span></a>  <span class="comment">     */</span>
<a name="l479"><span class="linenum"> 479</span></a>      public function <a class="function" onClick="logFunction('get_external_functions_by_enabled_services')" href="../_functions/get_external_functions_by_enabled_services.html" onMouseOver="funcPopup(event,'get_external_functions_by_enabled_services')">get_external_functions_by_enabled_services</a>(<a class="var it9258" onMouseOver="hilite(9258)" onMouseOut="lolite()" onClick="logVariable('serviceshortnames')" href="../_variables/serviceshortnames.html">$serviceshortnames</a>, <a class="var it9259" onMouseOver="hilite(9259)" onMouseOut="lolite()" onClick="logVariable('enabledonly')" href="../_variables/enabledonly.html">$enabledonly</a> = true) {
<a name="l480"><span class="linenum"> 480</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l481"><span class="linenum"> 481</span></a>          if (!empty(<a class="var it9258" onMouseOver="hilite(9258)" onMouseOut="lolite()" onClick="logVariable('serviceshortnames')" href="../_variables/serviceshortnames.html">$serviceshortnames</a>)) {
<a name="l482"><span class="linenum"> 482</span></a>              <a class="var it9260" onMouseOver="hilite(9260)" onMouseOut="lolite()" onClick="logVariable('enabledonlysql')" href="../_variables/enabledonlysql.html">$enabledonlysql</a> = <a class="var it9259" onMouseOver="hilite(9259)" onMouseOut="lolite()" onClick="logVariable('enabledonly')" href="../_variables/enabledonly.html">$enabledonly</a>?' AND s.enabled = 1 ':'';
<a name="l483"><span class="linenum"> 483</span></a>              <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it9258" onMouseOver="hilite(9258)" onMouseOut="lolite()" onClick="logVariable('serviceshortnames')" href="../_variables/serviceshortnames.html">$serviceshortnames</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it9258" onMouseOver="hilite(9258)" onMouseOut="lolite()" onClick="logVariable('serviceshortnames')" href="../_variables/serviceshortnames.html">$serviceshortnames</a>);
<a name="l484"><span class="linenum"> 484</span></a>              <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT f.*
<a name="l485"><span class="linenum"> 485</span></a>                        FROM {external_functions} f
<a name="l486"><span class="linenum"> 486</span></a>                       WHERE f.name IN (SELECT sf.functionname
<a name="l487"><span class="linenum"> 487</span></a>                                          FROM {external_services_functions} sf, {external_services} s
<a name="l488"><span class="linenum"> 488</span></a>                                         WHERE s.shortname <a class="var it9258" onMouseOver="hilite(9258)" onMouseOut="lolite()" onClick="logVariable('serviceshortnames')" href="../_variables/serviceshortnames.html">$serviceshortnames</a>
<a name="l489"><span class="linenum"> 489</span></a>                                               AND sf.externalserviceid = s.id
<a name="l490"><span class="linenum"> 490</span></a>                                               &quot; . <a class="var it9260" onMouseOver="hilite(9260)" onMouseOut="lolite()" onClick="logVariable('enabledonlysql')" href="../_variables/enabledonlysql.html">$enabledonlysql</a> . &quot;)&quot;;
<a name="l491"><span class="linenum"> 491</span></a>              <a class="var it302" onMouseOver="hilite(302)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l492"><span class="linenum"> 492</span></a>          } else {
<a name="l493"><span class="linenum"> 493</span></a>              <a class="var it302" onMouseOver="hilite(302)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a> = array();
<a name="l494"><span class="linenum"> 494</span></a>          }
<a name="l495"><span class="linenum"> 495</span></a>          return <a class="var it302" onMouseOver="hilite(302)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a>;
<a name="l496"><span class="linenum"> 496</span></a>      }
<a name="l497"><span class="linenum"> 497</span></a>  
<a name="l498"><span class="linenum"> 498</span></a>      <span class="comment">/**</span>
<a name="l499"><span class="linenum"> 499</span></a>  <span class="comment">     * Get functions not included in a service</span>
<a name="l500"><span class="linenum"> 500</span></a>  <span class="comment">     *</span>
<a name="l501"><span class="linenum"> 501</span></a>  <span class="comment">     * @param int $serviceid service id</span>
<a name="l502"><span class="linenum"> 502</span></a>  <span class="comment">     * @return array functions</span>
<a name="l503"><span class="linenum"> 503</span></a>  <span class="comment">     */</span>
<a name="l504"><span class="linenum"> 504</span></a>      public function <a class="function" onClick="logFunction('get_not_associated_external_functions')" href="../_functions/get_not_associated_external_functions.html" onMouseOver="funcPopup(event,'get_not_associated_external_functions')">get_not_associated_external_functions</a>(<a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>) {
<a name="l505"><span class="linenum"> 505</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l506"><span class="linenum"> 506</span></a>          <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../_variables/select.html">$select</a> = &quot;name NOT IN (SELECT s.functionname
<a name="l507"><span class="linenum"> 507</span></a>                                    FROM {external_services_functions} s
<a name="l508"><span class="linenum"> 508</span></a>                                   WHERE s.externalserviceid = :sid
<a name="l509"><span class="linenum"> 509</span></a>                                 )&quot;;
<a name="l510"><span class="linenum"> 510</span></a>  
<a name="l511"><span class="linenum"> 511</span></a>          <a class="var it302" onMouseOver="hilite(302)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_select')" href="../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>('external_functions',
<a name="l512"><span class="linenum"> 512</span></a>                          <a class="var it1047" onMouseOver="hilite(1047)" onMouseOut="lolite()" onClick="logVariable('select')" href="../_variables/select.html">$select</a>, array('sid' =&gt; <a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>), 'name');
<a name="l513"><span class="linenum"> 513</span></a>  
<a name="l514"><span class="linenum"> 514</span></a>          return <a class="var it302" onMouseOver="hilite(302)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a>;
<a name="l515"><span class="linenum"> 515</span></a>      }
<a name="l516"><span class="linenum"> 516</span></a>  
<a name="l517"><span class="linenum"> 517</span></a>      <span class="comment">/**</span>
<a name="l518"><span class="linenum"> 518</span></a>  <span class="comment">     * Get list of required capabilities of a service, sorted by functions</span>
<a name="l519"><span class="linenum"> 519</span></a>  <span class="comment">     * Example of returned value:</span>
<a name="l520"><span class="linenum"> 520</span></a>  <span class="comment">     *  Array</span>
<a name="l521"><span class="linenum"> 521</span></a>  <span class="comment">     *  (</span>
<a name="l522"><span class="linenum"> 522</span></a>  <span class="comment">     *    [core_group_create_groups] =&gt; Array</span>
<a name="l523"><span class="linenum"> 523</span></a>  <span class="comment">     *    (</span>
<a name="l524"><span class="linenum"> 524</span></a>  <span class="comment">     *       [0] =&gt; moodle/course:managegroups</span>
<a name="l525"><span class="linenum"> 525</span></a>  <span class="comment">     *    )</span>
<a name="l526"><span class="linenum"> 526</span></a>  <span class="comment">     *</span>
<a name="l527"><span class="linenum"> 527</span></a>  <span class="comment">     *    [core_enrol_get_enrolled_users] =&gt; Array</span>
<a name="l528"><span class="linenum"> 528</span></a>  <span class="comment">     *    (</span>
<a name="l529"><span class="linenum"> 529</span></a>  <span class="comment">     *       [0] =&gt; moodle/user:viewdetails</span>
<a name="l530"><span class="linenum"> 530</span></a>  <span class="comment">     *       [1] =&gt; moodle/user:viewhiddendetails</span>
<a name="l531"><span class="linenum"> 531</span></a>  <span class="comment">     *       [2] =&gt; moodle/course:useremail</span>
<a name="l532"><span class="linenum"> 532</span></a>  <span class="comment">     *       [3] =&gt; moodle/user:update</span>
<a name="l533"><span class="linenum"> 533</span></a>  <span class="comment">     *       [4] =&gt; moodle/site:accessallgroups</span>
<a name="l534"><span class="linenum"> 534</span></a>  <span class="comment">     *    )</span>
<a name="l535"><span class="linenum"> 535</span></a>  <span class="comment">     *  )</span>
<a name="l536"><span class="linenum"> 536</span></a>  <span class="comment">     * @param int $serviceid service id</span>
<a name="l537"><span class="linenum"> 537</span></a>  <span class="comment">     * @return array</span>
<a name="l538"><span class="linenum"> 538</span></a>  <span class="comment">     */</span>
<a name="l539"><span class="linenum"> 539</span></a>      public function <a class="function" onClick="logFunction('get_service_required_capabilities')" href="../_functions/get_service_required_capabilities.html" onMouseOver="funcPopup(event,'get_service_required_capabilities')">get_service_required_capabilities</a>(<a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>) {
<a name="l540"><span class="linenum"> 540</span></a>          <a class="var it302" onMouseOver="hilite(302)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_external_functions')" href="../_functions/get_external_functions.html" onMouseOver="funcPopup(event,'get_external_functions')">get_external_functions</a>(array(<a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>));
<a name="l541"><span class="linenum"> 541</span></a>          <a class="var it9261" onMouseOver="hilite(9261)" onMouseOut="lolite()" onClick="logVariable('requiredusercaps')" href="../_variables/requiredusercaps.html">$requiredusercaps</a> = array();
<a name="l542"><span class="linenum"> 542</span></a>          foreach (<a class="var it302" onMouseOver="hilite(302)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a> as <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>) {
<a name="l543"><span class="linenum"> 543</span></a>              <a class="var it9262" onMouseOver="hilite(9262)" onMouseOut="lolite()" onClick="logVariable('functioncaps')" href="../_variables/functioncaps.html">$functioncaps</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('capabilities')" class="var it44241" onMouseOver="hilite(44241)" onMouseOut="lolite()" href="../_variables/capabilities.html">capabilities</a>);
<a name="l544"><span class="linenum"> 544</span></a>              if (!empty(<a class="var it9262" onMouseOver="hilite(9262)" onMouseOut="lolite()" onClick="logVariable('functioncaps')" href="../_variables/functioncaps.html">$functioncaps</a>) and !empty(<a class="var it9262" onMouseOver="hilite(9262)" onMouseOut="lolite()" onClick="logVariable('functioncaps')" href="../_variables/functioncaps.html">$functioncaps</a>[0])) {
<a name="l545"><span class="linenum"> 545</span></a>                  foreach (<a class="var it9262" onMouseOver="hilite(9262)" onMouseOut="lolite()" onClick="logVariable('functioncaps')" href="../_variables/functioncaps.html">$functioncaps</a> as <a class="var it9263" onMouseOver="hilite(9263)" onMouseOut="lolite()" onClick="logVariable('functioncap')" href="../_variables/functioncap.html">$functioncap</a>) {
<a name="l546"><span class="linenum"> 546</span></a>                      <a class="var it9261" onMouseOver="hilite(9261)" onMouseOut="lolite()" onClick="logVariable('requiredusercaps')" href="../_variables/requiredusercaps.html">$requiredusercaps</a>[<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('name')" class="var it44241" onMouseOver="hilite(44241)" onMouseOut="lolite()" href="../_variables/name.html">name</a>][] = <a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it9263" onMouseOver="hilite(9263)" onMouseOut="lolite()" onClick="logVariable('functioncap')" href="../_variables/functioncap.html">$functioncap</a>);
<a name="l547"><span class="linenum"> 547</span></a>                  }
<a name="l548"><span class="linenum"> 548</span></a>              }
<a name="l549"><span class="linenum"> 549</span></a>          }
<a name="l550"><span class="linenum"> 550</span></a>          return <a class="var it9261" onMouseOver="hilite(9261)" onMouseOut="lolite()" onClick="logVariable('requiredusercaps')" href="../_variables/requiredusercaps.html">$requiredusercaps</a>;
<a name="l551"><span class="linenum"> 551</span></a>      }
<a name="l552"><span class="linenum"> 552</span></a>  
<a name="l553"><span class="linenum"> 553</span></a>      <span class="comment">/**</span>
<a name="l554"><span class="linenum"> 554</span></a>  <span class="comment">     * Get user capabilities (with context)</span>
<a name="l555"><span class="linenum"> 555</span></a>  <span class="comment">     * Only useful for documentation purpose</span>
<a name="l556"><span class="linenum"> 556</span></a>  <span class="comment">     * WARNING: do not use this &quot;broken&quot; function. It was created in the goal to display some capabilities</span>
<a name="l557"><span class="linenum"> 557</span></a>  <span class="comment">     * required by users. In theory we should not need to display this kind of information</span>
<a name="l558"><span class="linenum"> 558</span></a>  <span class="comment">     * as the front end does not display it itself. In pratice,</span>
<a name="l559"><span class="linenum"> 559</span></a>  <span class="comment">     * admins would like the info, for more info you can follow: MDL-29962</span>
<a name="l560"><span class="linenum"> 560</span></a>  <span class="comment">     *</span>
<a name="l561"><span class="linenum"> 561</span></a>  <span class="comment">     * @param int $userid user id</span>
<a name="l562"><span class="linenum"> 562</span></a>  <span class="comment">     * @return array</span>
<a name="l563"><span class="linenum"> 563</span></a>  <span class="comment">     */</span>
<a name="l564"><span class="linenum"> 564</span></a>      public function <a class="function" onClick="logFunction('get_user_capabilities')" href="../_functions/get_user_capabilities.html" onMouseOver="funcPopup(event,'get_user_capabilities')">get_user_capabilities</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) {
<a name="l565"><span class="linenum"> 565</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l566"><span class="linenum"> 566</span></a>  <span class="comment">        //retrieve the user capabilities</span>
<a name="l567"><span class="linenum"> 567</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT DISTINCT rc.id, rc.capability FROM {role_capabilities} rc, {role_assignments} ra
<a name="l568"><span class="linenum"> 568</span></a>              WHERE rc.roleid=ra.roleid AND ra.userid= ? AND rc.permission = ?&quot;;
<a name="l569"><span class="linenum"> 569</span></a>          <a class="var it9264" onMouseOver="hilite(9264)" onMouseOut="lolite()" onClick="logVariable('dbusercaps')" href="../_variables/dbusercaps.html">$dbusercaps</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, array(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="constant" onClick="logConstant('CAP_ALLOW')" href="../_constants/CAP_ALLOW.html" onMouseOver="constPopup(event,'CAP_ALLOW')">CAP_ALLOW</a>));
<a name="l570"><span class="linenum"> 570</span></a>          <a class="var it9265" onMouseOver="hilite(9265)" onMouseOut="lolite()" onClick="logVariable('usercaps')" href="../_variables/usercaps.html">$usercaps</a> = array();
<a name="l571"><span class="linenum"> 571</span></a>          foreach (<a class="var it9264" onMouseOver="hilite(9264)" onMouseOut="lolite()" onClick="logVariable('dbusercaps')" href="../_variables/dbusercaps.html">$dbusercaps</a> as <a class="var it9266" onMouseOver="hilite(9266)" onMouseOut="lolite()" onClick="logVariable('usercap')" href="../_variables/usercap.html">$usercap</a>) {
<a name="l572"><span class="linenum"> 572</span></a>              <a class="var it9265" onMouseOver="hilite(9265)" onMouseOut="lolite()" onClick="logVariable('usercaps')" href="../_variables/usercaps.html">$usercaps</a>[<a class="var it9266" onMouseOver="hilite(9266)" onMouseOut="lolite()" onClick="logVariable('usercap')" href="../_variables/usercap.html">$usercap</a>-&gt;<a onClick="logVariable('capability')" class="var it45427" onMouseOver="hilite(45427)" onMouseOut="lolite()" href="../_variables/capability.html">capability</a>] = true;
<a name="l573"><span class="linenum"> 573</span></a>          }
<a name="l574"><span class="linenum"> 574</span></a>          return <a class="var it9265" onMouseOver="hilite(9265)" onMouseOut="lolite()" onClick="logVariable('usercaps')" href="../_variables/usercaps.html">$usercaps</a>;
<a name="l575"><span class="linenum"> 575</span></a>      }
<a name="l576"><span class="linenum"> 576</span></a>  
<a name="l577"><span class="linenum"> 577</span></a>      <span class="comment">/**</span>
<a name="l578"><span class="linenum"> 578</span></a>  <span class="comment">     * Get missing user capabilities for a given service</span>
<a name="l579"><span class="linenum"> 579</span></a>  <span class="comment">     * WARNING: do not use this &quot;broken&quot; function. It was created in the goal to display some capabilities</span>
<a name="l580"><span class="linenum"> 580</span></a>  <span class="comment">     * required by users. In theory we should not need to display this kind of information</span>
<a name="l581"><span class="linenum"> 581</span></a>  <span class="comment">     * as the front end does not display it itself. In pratice,</span>
<a name="l582"><span class="linenum"> 582</span></a>  <span class="comment">     * admins would like the info, for more info you can follow: MDL-29962</span>
<a name="l583"><span class="linenum"> 583</span></a>  <span class="comment">     *</span>
<a name="l584"><span class="linenum"> 584</span></a>  <span class="comment">     * @param array $users users</span>
<a name="l585"><span class="linenum"> 585</span></a>  <span class="comment">     * @param int $serviceid service id</span>
<a name="l586"><span class="linenum"> 586</span></a>  <span class="comment">     * @return array of missing capabilities, keys being the user ids</span>
<a name="l587"><span class="linenum"> 587</span></a>  <span class="comment">     */</span>
<a name="l588"><span class="linenum"> 588</span></a>      public function <a class="function" onClick="logFunction('get_missing_capabilities_by_users')" href="../_functions/get_missing_capabilities_by_users.html" onMouseOver="funcPopup(event,'get_missing_capabilities_by_users')">get_missing_capabilities_by_users</a>(<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a>, <a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>) {
<a name="l589"><span class="linenum"> 589</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l590"><span class="linenum"> 590</span></a>          <a class="var it9267" onMouseOver="hilite(9267)" onMouseOut="lolite()" onClick="logVariable('usersmissingcaps')" href="../_variables/usersmissingcaps.html">$usersmissingcaps</a> = array();
<a name="l591"><span class="linenum"> 591</span></a>  
<a name="l592"><span class="linenum"> 592</span></a>  <span class="comment">        //retrieve capabilities required by the service</span>
<a name="l593"><span class="linenum"> 593</span></a>          <a class="var it9268" onMouseOver="hilite(9268)" onMouseOut="lolite()" onClick="logVariable('servicecaps')" href="../_variables/servicecaps.html">$servicecaps</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_service_required_capabilities')" href="../_functions/get_service_required_capabilities.html" onMouseOver="funcPopup(event,'get_service_required_capabilities')">get_service_required_capabilities</a>(<a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>);
<a name="l594"><span class="linenum"> 594</span></a>  
<a name="l595"><span class="linenum"> 595</span></a>  <span class="comment">        //retrieve users missing capabilities</span>
<a name="l596"><span class="linenum"> 596</span></a>          foreach (<a class="var it1062" onMouseOver="hilite(1062)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a> as <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) {
<a name="l597"><span class="linenum"> 597</span></a>  <span class="comment">            //cast user array into object to be a bit more flexible</span>
<a name="l598"><span class="linenum"> 598</span></a>              if (<a class="phpfunction" onClick="logFunction('is_array')" href="../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l599"><span class="linenum"> 599</span></a>                  <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = (object) <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>;
<a name="l600"><span class="linenum"> 600</span></a>              }
<a name="l601"><span class="linenum"> 601</span></a>              <a class="var it9265" onMouseOver="hilite(9265)" onMouseOut="lolite()" onClick="logVariable('usercaps')" href="../_variables/usercaps.html">$usercaps</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_user_capabilities')" href="../_functions/get_user_capabilities.html" onMouseOver="funcPopup(event,'get_user_capabilities')">get_user_capabilities</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l602"><span class="linenum"> 602</span></a>  
<a name="l603"><span class="linenum"> 603</span></a>  <span class="comment">            //detect the missing capabilities</span>
<a name="l604"><span class="linenum"> 604</span></a>              foreach (<a class="var it9268" onMouseOver="hilite(9268)" onMouseOut="lolite()" onClick="logVariable('servicecaps')" href="../_variables/servicecaps.html">$servicecaps</a> as <a class="var it9269" onMouseOver="hilite(9269)" onMouseOut="lolite()" onClick="logVariable('functioname')" href="../_variables/functioname.html">$functioname</a> =&gt; <a class="var it9262" onMouseOver="hilite(9262)" onMouseOut="lolite()" onClick="logVariable('functioncaps')" href="../_variables/functioncaps.html">$functioncaps</a>) {
<a name="l605"><span class="linenum"> 605</span></a>                  foreach (<a class="var it9262" onMouseOver="hilite(9262)" onMouseOut="lolite()" onClick="logVariable('functioncaps')" href="../_variables/functioncaps.html">$functioncaps</a> as <a class="var it9263" onMouseOver="hilite(9263)" onMouseOut="lolite()" onClick="logVariable('functioncap')" href="../_variables/functioncap.html">$functioncap</a>) {
<a name="l606"><span class="linenum"> 606</span></a>                      if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it9263" onMouseOver="hilite(9263)" onMouseOut="lolite()" onClick="logVariable('functioncap')" href="../_variables/functioncap.html">$functioncap</a>, <a class="var it9265" onMouseOver="hilite(9265)" onMouseOut="lolite()" onClick="logVariable('usercaps')" href="../_variables/usercaps.html">$usercaps</a>)) {
<a name="l607"><span class="linenum"> 607</span></a>                          if (!isset(<a class="var it9267" onMouseOver="hilite(9267)" onMouseOut="lolite()" onClick="logVariable('usersmissingcaps')" href="../_variables/usersmissingcaps.html">$usersmissingcaps</a>[<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>])
<a name="l608"><span class="linenum"> 608</span></a>                                  or <a class="phpfunction" onClick="logFunction('array_search')" href="../_functions/array_search.html" onMouseOver="phpfuncPopup(event,'array_search')">array_search</a>(<a class="var it9263" onMouseOver="hilite(9263)" onMouseOut="lolite()" onClick="logVariable('functioncap')" href="../_variables/functioncap.html">$functioncap</a>, <a class="var it9267" onMouseOver="hilite(9267)" onMouseOut="lolite()" onClick="logVariable('usersmissingcaps')" href="../_variables/usersmissingcaps.html">$usersmissingcaps</a>[<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>]) === false) {
<a name="l609"><span class="linenum"> 609</span></a>                              <a class="var it9267" onMouseOver="hilite(9267)" onMouseOut="lolite()" onClick="logVariable('usersmissingcaps')" href="../_variables/usersmissingcaps.html">$usersmissingcaps</a>[<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>][] = <a class="var it9263" onMouseOver="hilite(9263)" onMouseOut="lolite()" onClick="logVariable('functioncap')" href="../_variables/functioncap.html">$functioncap</a>;
<a name="l610"><span class="linenum"> 610</span></a>                          }
<a name="l611"><span class="linenum"> 611</span></a>                      }
<a name="l612"><span class="linenum"> 612</span></a>                  }
<a name="l613"><span class="linenum"> 613</span></a>              }
<a name="l614"><span class="linenum"> 614</span></a>          }
<a name="l615"><span class="linenum"> 615</span></a>  
<a name="l616"><span class="linenum"> 616</span></a>          return <a class="var it9267" onMouseOver="hilite(9267)" onMouseOut="lolite()" onClick="logVariable('usersmissingcaps')" href="../_variables/usersmissingcaps.html">$usersmissingcaps</a>;
<a name="l617"><span class="linenum"> 617</span></a>      }
<a name="l618"><span class="linenum"> 618</span></a>  
<a name="l619"><span class="linenum"> 619</span></a>      <span class="comment">/**</span>
<a name="l620"><span class="linenum"> 620</span></a>  <span class="comment">     * Get an external service for a given service id</span>
<a name="l621"><span class="linenum"> 621</span></a>  <span class="comment">     *</span>
<a name="l622"><span class="linenum"> 622</span></a>  <span class="comment">     * @param int $serviceid service id</span>
<a name="l623"><span class="linenum"> 623</span></a>  <span class="comment">     * @param int $strictness IGNORE_MISSING, MUST_EXIST...</span>
<a name="l624"><span class="linenum"> 624</span></a>  <span class="comment">     * @return stdClass external service</span>
<a name="l625"><span class="linenum"> 625</span></a>  <span class="comment">     */</span>
<a name="l626"><span class="linenum"> 626</span></a>      public function <a class="function" onClick="logFunction('get_external_service_by_id')" href="../_functions/get_external_service_by_id.html" onMouseOver="funcPopup(event,'get_external_service_by_id')">get_external_service_by_id</a>(<a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>, <a class="var it1289" onMouseOver="hilite(1289)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a>=<a class="constant" onClick="logConstant('IGNORE_MISSING')" href="../_constants/IGNORE_MISSING.html" onMouseOver="constPopup(event,'IGNORE_MISSING')">IGNORE_MISSING</a>) {
<a name="l627"><span class="linenum"> 627</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l628"><span class="linenum"> 628</span></a>          <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('external_services',
<a name="l629"><span class="linenum"> 629</span></a>                          array('id' =&gt; <a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>), '*', <a class="var it1289" onMouseOver="hilite(1289)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a>);
<a name="l630"><span class="linenum"> 630</span></a>          return <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>;
<a name="l631"><span class="linenum"> 631</span></a>      }
<a name="l632"><span class="linenum"> 632</span></a>  
<a name="l633"><span class="linenum"> 633</span></a>      <span class="comment">/**</span>
<a name="l634"><span class="linenum"> 634</span></a>  <span class="comment">     * Get an external service for a given shortname</span>
<a name="l635"><span class="linenum"> 635</span></a>  <span class="comment">     *</span>
<a name="l636"><span class="linenum"> 636</span></a>  <span class="comment">     * @param string $shortname service shortname</span>
<a name="l637"><span class="linenum"> 637</span></a>  <span class="comment">     * @param int $strictness IGNORE_MISSING, MUST_EXIST...</span>
<a name="l638"><span class="linenum"> 638</span></a>  <span class="comment">     * @return stdClass external service</span>
<a name="l639"><span class="linenum"> 639</span></a>  <span class="comment">     */</span>
<a name="l640"><span class="linenum"> 640</span></a>      public function <a class="function" onClick="logFunction('get_external_service_by_shortname')" href="../_functions/get_external_service_by_shortname.html" onMouseOver="funcPopup(event,'get_external_service_by_shortname')">get_external_service_by_shortname</a>(<a class="var it911" onMouseOver="hilite(911)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../_variables/shortname.html">$shortname</a>, <a class="var it1289" onMouseOver="hilite(1289)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a>=<a class="constant" onClick="logConstant('IGNORE_MISSING')" href="../_constants/IGNORE_MISSING.html" onMouseOver="constPopup(event,'IGNORE_MISSING')">IGNORE_MISSING</a>) {
<a name="l641"><span class="linenum"> 641</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l642"><span class="linenum"> 642</span></a>          <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('external_services',
<a name="l643"><span class="linenum"> 643</span></a>                          array('shortname' =&gt; <a class="var it911" onMouseOver="hilite(911)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../_variables/shortname.html">$shortname</a>), '*', <a class="var it1289" onMouseOver="hilite(1289)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a>);
<a name="l644"><span class="linenum"> 644</span></a>          return <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>;
<a name="l645"><span class="linenum"> 645</span></a>      }
<a name="l646"><span class="linenum"> 646</span></a>  
<a name="l647"><span class="linenum"> 647</span></a>      <span class="comment">/**</span>
<a name="l648"><span class="linenum"> 648</span></a>  <span class="comment">     * Get an external function for a given function id</span>
<a name="l649"><span class="linenum"> 649</span></a>  <span class="comment">     *</span>
<a name="l650"><span class="linenum"> 650</span></a>  <span class="comment">     * @param int $functionid function id</span>
<a name="l651"><span class="linenum"> 651</span></a>  <span class="comment">     * @param int $strictness IGNORE_MISSING, MUST_EXIST...</span>
<a name="l652"><span class="linenum"> 652</span></a>  <span class="comment">     * @return stdClass external function</span>
<a name="l653"><span class="linenum"> 653</span></a>  <span class="comment">     */</span>
<a name="l654"><span class="linenum"> 654</span></a>      public function <a class="function" onClick="logFunction('get_external_function_by_id')" href="../_functions/get_external_function_by_id.html" onMouseOver="funcPopup(event,'get_external_function_by_id')">get_external_function_by_id</a>(<a class="var it9270" onMouseOver="hilite(9270)" onMouseOut="lolite()" onClick="logVariable('functionid')" href="../_variables/functionid.html">$functionid</a>, <a class="var it1289" onMouseOver="hilite(1289)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a>=<a class="constant" onClick="logConstant('IGNORE_MISSING')" href="../_constants/IGNORE_MISSING.html" onMouseOver="constPopup(event,'IGNORE_MISSING')">IGNORE_MISSING</a>) {
<a name="l655"><span class="linenum"> 655</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l656"><span class="linenum"> 656</span></a>          <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('external_functions',
<a name="l657"><span class="linenum"> 657</span></a>                              array('id' =&gt; <a class="var it9270" onMouseOver="hilite(9270)" onMouseOut="lolite()" onClick="logVariable('functionid')" href="../_variables/functionid.html">$functionid</a>), '*', <a class="var it1289" onMouseOver="hilite(1289)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a>);
<a name="l658"><span class="linenum"> 658</span></a>          return <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>;
<a name="l659"><span class="linenum"> 659</span></a>      }
<a name="l660"><span class="linenum"> 660</span></a>  
<a name="l661"><span class="linenum"> 661</span></a>      <span class="comment">/**</span>
<a name="l662"><span class="linenum"> 662</span></a>  <span class="comment">     * Add a function to a service</span>
<a name="l663"><span class="linenum"> 663</span></a>  <span class="comment">     *</span>
<a name="l664"><span class="linenum"> 664</span></a>  <span class="comment">     * @param string $functionname function name</span>
<a name="l665"><span class="linenum"> 665</span></a>  <span class="comment">     * @param int $serviceid service id</span>
<a name="l666"><span class="linenum"> 666</span></a>  <span class="comment">     */</span>
<a name="l667"><span class="linenum"> 667</span></a>      public function <a class="function" onClick="logFunction('add_external_function_to_service')" href="../_functions/add_external_function_to_service.html" onMouseOver="funcPopup(event,'add_external_function_to_service')">add_external_function_to_service</a>(<a class="var it2244" onMouseOver="hilite(2244)" onMouseOut="lolite()" onClick="logVariable('functionname')" href="../_variables/functionname.html">$functionname</a>, <a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>) {
<a name="l668"><span class="linenum"> 668</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l669"><span class="linenum"> 669</span></a>          <a class="var it9271" onMouseOver="hilite(9271)" onMouseOut="lolite()" onClick="logVariable('addedfunction')" href="../_variables/addedfunction.html">$addedfunction</a> = new stdClass();
<a name="l670"><span class="linenum"> 670</span></a>          <a class="var it9271" onMouseOver="hilite(9271)" onMouseOut="lolite()" onClick="logVariable('addedfunction')" href="../_variables/addedfunction.html">$addedfunction</a>-&gt;<a onClick="logVariable('externalserviceid')" class="var it45428" onMouseOver="hilite(45428)" onMouseOut="lolite()" href="../_variables/externalserviceid.html">externalserviceid</a> = <a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>;
<a name="l671"><span class="linenum"> 671</span></a>          <a class="var it9271" onMouseOver="hilite(9271)" onMouseOut="lolite()" onClick="logVariable('addedfunction')" href="../_variables/addedfunction.html">$addedfunction</a>-&gt;<a onClick="logVariable('functionname')" class="var it45428" onMouseOver="hilite(45428)" onMouseOut="lolite()" href="../_variables/functionname.html">functionname</a> = <a class="var it2244" onMouseOver="hilite(2244)" onMouseOut="lolite()" onClick="logVariable('functionname')" href="../_variables/functionname.html">$functionname</a>;
<a name="l672"><span class="linenum"> 672</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('external_services_functions', <a class="var it9271" onMouseOver="hilite(9271)" onMouseOut="lolite()" onClick="logVariable('addedfunction')" href="../_variables/addedfunction.html">$addedfunction</a>);
<a name="l673"><span class="linenum"> 673</span></a>      }
<a name="l674"><span class="linenum"> 674</span></a>  
<a name="l675"><span class="linenum"> 675</span></a>      <span class="comment">/**</span>
<a name="l676"><span class="linenum"> 676</span></a>  <span class="comment">     * Add a service</span>
<a name="l677"><span class="linenum"> 677</span></a>  <span class="comment">     * It generates the timecreated field automatically.</span>
<a name="l678"><span class="linenum"> 678</span></a>  <span class="comment">     *</span>
<a name="l679"><span class="linenum"> 679</span></a>  <span class="comment">     * @param stdClass $service</span>
<a name="l680"><span class="linenum"> 680</span></a>  <span class="comment">     * @return serviceid integer</span>
<a name="l681"><span class="linenum"> 681</span></a>  <span class="comment">     */</span>
<a name="l682"><span class="linenum"> 682</span></a>      public function <a class="function" onClick="logFunction('add_external_service')" href="../_functions/add_external_service.html" onMouseOver="funcPopup(event,'add_external_service')">add_external_service</a>(<a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>) {
<a name="l683"><span class="linenum"> 683</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l684"><span class="linenum"> 684</span></a>          <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('timecreated')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a> = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l685"><span class="linenum"> 685</span></a>          <a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('external_services', <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>);
<a name="l686"><span class="linenum"> 686</span></a>          return <a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>;
<a name="l687"><span class="linenum"> 687</span></a>      }
<a name="l688"><span class="linenum"> 688</span></a>  
<a name="l689"><span class="linenum"> 689</span></a>      <span class="comment">/**</span>
<a name="l690"><span class="linenum"> 690</span></a>  <span class="comment">     * Update a service</span>
<a name="l691"><span class="linenum"> 691</span></a>  <span class="comment">     * It modifies the timemodified automatically.</span>
<a name="l692"><span class="linenum"> 692</span></a>  <span class="comment">     *</span>
<a name="l693"><span class="linenum"> 693</span></a>  <span class="comment">     * @param stdClass $service</span>
<a name="l694"><span class="linenum"> 694</span></a>  <span class="comment">     */</span>
<a name="l695"><span class="linenum"> 695</span></a>      public function <a class="function" onClick="logFunction('update_external_service')" href="../_functions/update_external_service.html" onMouseOver="funcPopup(event,'update_external_service')">update_external_service</a>(<a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>) {
<a name="l696"><span class="linenum"> 696</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l697"><span class="linenum"> 697</span></a>          <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('timemodified')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l698"><span class="linenum"> 698</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('external_services', <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>);
<a name="l699"><span class="linenum"> 699</span></a>      }
<a name="l700"><span class="linenum"> 700</span></a>  
<a name="l701"><span class="linenum"> 701</span></a>      <span class="comment">/**</span>
<a name="l702"><span class="linenum"> 702</span></a>  <span class="comment">     * Test whether an external function is already linked to a service</span>
<a name="l703"><span class="linenum"> 703</span></a>  <span class="comment">     *</span>
<a name="l704"><span class="linenum"> 704</span></a>  <span class="comment">     * @param string $functionname function name</span>
<a name="l705"><span class="linenum"> 705</span></a>  <span class="comment">     * @param int $serviceid service id</span>
<a name="l706"><span class="linenum"> 706</span></a>  <span class="comment">     * @return bool true if a matching function exists for the service, else false.</span>
<a name="l707"><span class="linenum"> 707</span></a>  <span class="comment">     * @throws dml_exception if error</span>
<a name="l708"><span class="linenum"> 708</span></a>  <span class="comment">     */</span>
<a name="l709"><span class="linenum"> 709</span></a>      public function <a class="function" onClick="logFunction('service_function_exists')" href="../_functions/service_function_exists.html" onMouseOver="funcPopup(event,'service_function_exists')">service_function_exists</a>(<a class="var it2244" onMouseOver="hilite(2244)" onMouseOut="lolite()" onClick="logVariable('functionname')" href="../_variables/functionname.html">$functionname</a>, <a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>) {
<a name="l710"><span class="linenum"> 710</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l711"><span class="linenum"> 711</span></a>          return <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('external_services_functions',
<a name="l712"><span class="linenum"> 712</span></a>                              array('externalserviceid' =&gt; <a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>,
<a name="l713"><span class="linenum"> 713</span></a>                                  'functionname' =&gt; <a class="var it2244" onMouseOver="hilite(2244)" onMouseOut="lolite()" onClick="logVariable('functionname')" href="../_variables/functionname.html">$functionname</a>));
<a name="l714"><span class="linenum"> 714</span></a>      }
<a name="l715"><span class="linenum"> 715</span></a>  
<a name="l716"><span class="linenum"> 716</span></a>      <span class="comment">/**</span>
<a name="l717"><span class="linenum"> 717</span></a>  <span class="comment">     * Remove a function from a service</span>
<a name="l718"><span class="linenum"> 718</span></a>  <span class="comment">     *</span>
<a name="l719"><span class="linenum"> 719</span></a>  <span class="comment">     * @param string $functionname function name</span>
<a name="l720"><span class="linenum"> 720</span></a>  <span class="comment">     * @param int $serviceid service id</span>
<a name="l721"><span class="linenum"> 721</span></a>  <span class="comment">     */</span>
<a name="l722"><span class="linenum"> 722</span></a>      public function <a class="function" onClick="logFunction('remove_external_function_from_service')" href="../_functions/remove_external_function_from_service.html" onMouseOver="funcPopup(event,'remove_external_function_from_service')">remove_external_function_from_service</a>(<a class="var it2244" onMouseOver="hilite(2244)" onMouseOut="lolite()" onClick="logVariable('functionname')" href="../_variables/functionname.html">$functionname</a>, <a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>) {
<a name="l723"><span class="linenum"> 723</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l724"><span class="linenum"> 724</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_services_functions',
<a name="l725"><span class="linenum"> 725</span></a>                      array('externalserviceid' =&gt; <a class="var it5556" onMouseOver="hilite(5556)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>, 'functionname' =&gt; <a class="var it2244" onMouseOver="hilite(2244)" onMouseOut="lolite()" onClick="logVariable('functionname')" href="../_variables/functionname.html">$functionname</a>));
<a name="l726"><span class="linenum"> 726</span></a>  
<a name="l727"><span class="linenum"> 727</span></a>      }
<a name="l728"><span class="linenum"> 728</span></a>  
<a name="l729"><span class="linenum"> 729</span></a>  
<a name="l730"><span class="linenum"> 730</span></a>  }
<a name="l731"><span class="linenum"> 731</span></a>  
<a name="l732"><span class="linenum"> 732</span></a>  <span class="comment">/**</span>
<a name="l733"><span class="linenum"> 733</span></a>  <span class="comment"> * Exception indicating access control problem in web service call</span>
<a name="l734"><span class="linenum"> 734</span></a>  <span class="comment"> * This exception should return general errors about web service setup.</span>
<a name="l735"><span class="linenum"> 735</span></a>  <span class="comment"> * Errors related to the user like wrong username/password should not use it,</span>
<a name="l736"><span class="linenum"> 736</span></a>  <span class="comment"> * you should not use this exception if you want to let the client implement</span>
<a name="l737"><span class="linenum"> 737</span></a>  <span class="comment"> * some code logic against an access error.</span>
<a name="l738"><span class="linenum"> 738</span></a>  <span class="comment"> *</span>
<a name="l739"><span class="linenum"> 739</span></a>  <span class="comment"> * @package    core_webservice</span>
<a name="l740"><span class="linenum"> 740</span></a>  <span class="comment"> * @copyright  2009 Petr Skodak</span>
<a name="l741"><span class="linenum"> 741</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l742"><span class="linenum"> 742</span></a>  <span class="comment"> */</span>
<a name="l743"><span class="linenum"> 743</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a> <span class="keyword">extends</span> <a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a> {
<a name="l744"><span class="linenum"> 744</span></a>  
<a name="l745"><span class="linenum"> 745</span></a>      <span class="comment">/**</span>
<a name="l746"><span class="linenum"> 746</span></a>  <span class="comment">     * Constructor</span>
<a name="l747"><span class="linenum"> 747</span></a>  <span class="comment">     *</span>
<a name="l748"><span class="linenum"> 748</span></a>  <span class="comment">     * @param string $debuginfo the debug info</span>
<a name="l749"><span class="linenum"> 749</span></a>  <span class="comment">     */</span>
<a name="l750"><span class="linenum"> 750</span></a>      function <a class="function" onClick="logFunction('__construct')" href="../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>(<a class="var it263" onMouseOver="hilite(263)" onMouseOut="lolite()" onClick="logVariable('debuginfo')" href="../_variables/debuginfo.html">$debuginfo</a>) {
<a name="l751"><span class="linenum"> 751</span></a>          parent::<a class="function" onClick="logFunction('__construct')" href="../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>('accessexception', 'webservice', '', null, <a class="var it263" onMouseOver="hilite(263)" onMouseOut="lolite()" onClick="logVariable('debuginfo')" href="../_variables/debuginfo.html">$debuginfo</a>);
<a name="l752"><span class="linenum"> 752</span></a>      }
<a name="l753"><span class="linenum"> 753</span></a>  }
<a name="l754"><span class="linenum"> 754</span></a>  
<a name="l755"><span class="linenum"> 755</span></a>  <span class="comment">/**</span>
<a name="l756"><span class="linenum"> 756</span></a>  <span class="comment"> * Check if a protocol is enabled</span>
<a name="l757"><span class="linenum"> 757</span></a>  <span class="comment"> *</span>
<a name="l758"><span class="linenum"> 758</span></a>  <span class="comment"> * @param string $protocol name of WS protocol ('rest', 'soap', 'xmlrpc'...)</span>
<a name="l759"><span class="linenum"> 759</span></a>  <span class="comment"> * @return bool true if the protocol is enabled</span>
<a name="l760"><span class="linenum"> 760</span></a>  <span class="comment"> */</span>
<a name="l761"><span class="linenum"> 761</span></a>  function <a class="function" onClick="logFunction('webservice_protocol_is_enabled')" href="../_functions/webservice_protocol_is_enabled.html" onMouseOver="funcPopup(event,'webservice_protocol_is_enabled')">webservice_protocol_is_enabled</a>(<a class="var it306" onMouseOver="hilite(306)" onMouseOut="lolite()" onClick="logVariable('protocol')" href="../_variables/protocol.html">$protocol</a>) {
<a name="l762"><span class="linenum"> 762</span></a>      global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l763"><span class="linenum"> 763</span></a>  
<a name="l764"><span class="linenum"> 764</span></a>      if (empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enablewebservices')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/enablewebservices.html">enablewebservices</a>)) {
<a name="l765"><span class="linenum"> 765</span></a>          return false;
<a name="l766"><span class="linenum"> 766</span></a>      }
<a name="l767"><span class="linenum"> 767</span></a>  
<a name="l768"><span class="linenum"> 768</span></a>      <a class="var it1343" onMouseOver="hilite(1343)" onMouseOut="lolite()" onClick="logVariable('active')" href="../_variables/active.html">$active</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('webserviceprotocols')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/webserviceprotocols.html">webserviceprotocols</a>);
<a name="l769"><span class="linenum"> 769</span></a>  
<a name="l770"><span class="linenum"> 770</span></a>      return(<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it306" onMouseOver="hilite(306)" onMouseOut="lolite()" onClick="logVariable('protocol')" href="../_variables/protocol.html">$protocol</a>, <a class="var it1343" onMouseOver="hilite(1343)" onMouseOut="lolite()" onClick="logVariable('active')" href="../_variables/active.html">$active</a>));
<a name="l771"><span class="linenum"> 771</span></a>  }
<a name="l772"><span class="linenum"> 772</span></a>  
<a name="l773"><span class="linenum"> 773</span></a>  <span class="comment">/**</span>
<a name="l774"><span class="linenum"> 774</span></a>  <span class="comment"> * Mandatory interface for all test client classes.</span>
<a name="l775"><span class="linenum"> 775</span></a>  <span class="comment"> *</span>
<a name="l776"><span class="linenum"> 776</span></a>  <span class="comment"> * @package    core_webservice</span>
<a name="l777"><span class="linenum"> 777</span></a>  <span class="comment"> * @copyright  2009 Petr Skodak</span>
<a name="l778"><span class="linenum"> 778</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l779"><span class="linenum"> 779</span></a>  <span class="comment"> */</span>
<a name="l780"><span class="linenum"> 780</span></a>  <span class="keyword">interface </span><a class="class" onClick="logClass('webservice_test_client_interface')" href="../_classes/webservice_test_client_interface.html" onMouseOver="classPopup(event,'webservice_test_client_interface')">webservice_test_client_interface</a> {
<a name="l781"><span class="linenum"> 781</span></a>  
<a name="l782"><span class="linenum"> 782</span></a>      <span class="comment">/**</span>
<a name="l783"><span class="linenum"> 783</span></a>  <span class="comment">     * Execute test client WS request</span>
<a name="l784"><span class="linenum"> 784</span></a>  <span class="comment">     *</span>
<a name="l785"><span class="linenum"> 785</span></a>  <span class="comment">     * @param string $serverurl server url (including the token param)</span>
<a name="l786"><span class="linenum"> 786</span></a>  <span class="comment">     * @param string $function web service function name</span>
<a name="l787"><span class="linenum"> 787</span></a>  <span class="comment">     * @param array $params parameters of the web service function</span>
<a name="l788"><span class="linenum"> 788</span></a>  <span class="comment">     * @return mixed</span>
<a name="l789"><span class="linenum"> 789</span></a>  <span class="comment">     */</span>
<a name="l790"><span class="linenum"> 790</span></a>      public function <a class="function" onClick="logFunction('simpletest')" href="../_functions/simpletest.html" onMouseOver="funcPopup(event,'simpletest')">simpletest</a>(<a class="var it2253" onMouseOver="hilite(2253)" onMouseOut="lolite()" onClick="logVariable('serverurl')" href="../_variables/serverurl.html">$serverurl</a>, <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l791"><span class="linenum"> 791</span></a>  }
<a name="l792"><span class="linenum"> 792</span></a>  
<a name="l793"><span class="linenum"> 793</span></a>  <span class="comment">/**</span>
<a name="l794"><span class="linenum"> 794</span></a>  <span class="comment"> * Mandatory interface for all web service protocol classes</span>
<a name="l795"><span class="linenum"> 795</span></a>  <span class="comment"> *</span>
<a name="l796"><span class="linenum"> 796</span></a>  <span class="comment"> * @package    core_webservice</span>
<a name="l797"><span class="linenum"> 797</span></a>  <span class="comment"> * @copyright  2009 Petr Skodak</span>
<a name="l798"><span class="linenum"> 798</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l799"><span class="linenum"> 799</span></a>  <span class="comment"> */</span>
<a name="l800"><span class="linenum"> 800</span></a>  <span class="keyword">interface </span><a class="class" onClick="logClass('webservice_server_interface')" href="../_classes/webservice_server_interface.html" onMouseOver="classPopup(event,'webservice_server_interface')">webservice_server_interface</a> {
<a name="l801"><span class="linenum"> 801</span></a>  
<a name="l802"><span class="linenum"> 802</span></a>      <span class="comment">/**</span>
<a name="l803"><span class="linenum"> 803</span></a>  <span class="comment">     * Process request from client.</span>
<a name="l804"><span class="linenum"> 804</span></a>  <span class="comment">     */</span>
<a name="l805"><span class="linenum"> 805</span></a>      public function <a class="function" onClick="logFunction('run')" href="../_functions/run.html" onMouseOver="funcPopup(event,'run')">run</a>();
<a name="l806"><span class="linenum"> 806</span></a>  }
<a name="l807"><span class="linenum"> 807</span></a>  
<a name="l808"><span class="linenum"> 808</span></a>  <span class="comment">/**</span>
<a name="l809"><span class="linenum"> 809</span></a>  <span class="comment"> * Abstract web service base class.</span>
<a name="l810"><span class="linenum"> 810</span></a>  <span class="comment"> *</span>
<a name="l811"><span class="linenum"> 811</span></a>  <span class="comment"> * @package    core_webservice</span>
<a name="l812"><span class="linenum"> 812</span></a>  <span class="comment"> * @copyright  2009 Petr Skodak</span>
<a name="l813"><span class="linenum"> 813</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l814"><span class="linenum"> 814</span></a>  <span class="comment"> */</span>
<a name="l815"><span class="linenum"> 815</span></a>  abstract class webservice_server <span class="keyword">implements</span> <a class="class" onClick="logClass('webservice_server_interface')" href="../_classes/webservice_server_interface.html" onMouseOver="classPopup(event,'webservice_server_interface')">webservice_server_interface</a> {
<a name="l816"><span class="linenum"> 816</span></a>  
<a name="l817"><span class="linenum"> 817</span></a>  <span class="comment">    /** @var string Name of the web server plugin */</span>
<a name="l818"><span class="linenum"> 818</span></a>      protected <a class="var it2240" onMouseOver="hilite(2240)" onMouseOut="lolite()" onClick="logVariable('wsname')" href="../_variables/wsname.html">$wsname</a> = null;
<a name="l819"><span class="linenum"> 819</span></a>  
<a name="l820"><span class="linenum"> 820</span></a>  <span class="comment">    /** @var string Name of local user */</span>
<a name="l821"><span class="linenum"> 821</span></a>      protected <a class="var it200" onMouseOver="hilite(200)" onMouseOut="lolite()" onClick="logVariable('username')" href="../_variables/username.html">$username</a> = null;
<a name="l822"><span class="linenum"> 822</span></a>  
<a name="l823"><span class="linenum"> 823</span></a>  <span class="comment">    /** @var string Password of the local user */</span>
<a name="l824"><span class="linenum"> 824</span></a>      protected <a class="var it201" onMouseOver="hilite(201)" onMouseOut="lolite()" onClick="logVariable('password')" href="../_variables/password.html">$password</a> = null;
<a name="l825"><span class="linenum"> 825</span></a>  
<a name="l826"><span class="linenum"> 826</span></a>  <span class="comment">    /** @var int The local user */</span>
<a name="l827"><span class="linenum"> 827</span></a>      protected <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> = null;
<a name="l828"><span class="linenum"> 828</span></a>  
<a name="l829"><span class="linenum"> 829</span></a>  <span class="comment">    /** @var integer Authentication method one of WEBSERVICE_AUTHMETHOD_* */</span>
<a name="l830"><span class="linenum"> 830</span></a>      protected <a class="var it304" onMouseOver="hilite(304)" onMouseOut="lolite()" onClick="logVariable('authmethod')" href="../_variables/authmethod.html">$authmethod</a>;
<a name="l831"><span class="linenum"> 831</span></a>  
<a name="l832"><span class="linenum"> 832</span></a>  <span class="comment">    /** @var string Authentication token*/</span>
<a name="l833"><span class="linenum"> 833</span></a>      protected <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a> = null;
<a name="l834"><span class="linenum"> 834</span></a>  
<a name="l835"><span class="linenum"> 835</span></a>  <span class="comment">    /** @var stdClass Restricted context */</span>
<a name="l836"><span class="linenum"> 836</span></a>      protected <a class="var it9273" onMouseOver="hilite(9273)" onMouseOut="lolite()" onClick="logVariable('restricted_context')" href="../_variables/restricted_context.html">$restricted_context</a>;
<a name="l837"><span class="linenum"> 837</span></a>  
<a name="l838"><span class="linenum"> 838</span></a>  <span class="comment">    /** @var int Restrict call to one service id*/</span>
<a name="l839"><span class="linenum"> 839</span></a>      protected <a class="var it9274" onMouseOver="hilite(9274)" onMouseOut="lolite()" onClick="logVariable('restricted_serviceid')" href="../_variables/restricted_serviceid.html">$restricted_serviceid</a> = null;
<a name="l840"><span class="linenum"> 840</span></a>  
<a name="l841"><span class="linenum"> 841</span></a>      <span class="comment">/**</span>
<a name="l842"><span class="linenum"> 842</span></a>  <span class="comment">     * Constructor</span>
<a name="l843"><span class="linenum"> 843</span></a>  <span class="comment">     *</span>
<a name="l844"><span class="linenum"> 844</span></a>  <span class="comment">     * @param integer $authmethod authentication method one of WEBSERVICE_AUTHMETHOD_*</span>
<a name="l845"><span class="linenum"> 845</span></a>  <span class="comment">     */</span>
<a name="l846"><span class="linenum"> 846</span></a>      public function <a class="function" onClick="logFunction('__construct')" href="../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>(<a class="var it304" onMouseOver="hilite(304)" onMouseOut="lolite()" onClick="logVariable('authmethod')" href="../_variables/authmethod.html">$authmethod</a>) {
<a name="l847"><span class="linenum"> 847</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authmethod')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/authmethod.html">authmethod</a> = <a class="var it304" onMouseOver="hilite(304)" onMouseOut="lolite()" onClick="logVariable('authmethod')" href="../_variables/authmethod.html">$authmethod</a>;
<a name="l848"><span class="linenum"> 848</span></a>      }
<a name="l849"><span class="linenum"> 849</span></a>  
<a name="l850"><span class="linenum"> 850</span></a>  
<a name="l851"><span class="linenum"> 851</span></a>      <span class="comment">/**</span>
<a name="l852"><span class="linenum"> 852</span></a>  <span class="comment">     * Authenticate user using username+password or token.</span>
<a name="l853"><span class="linenum"> 853</span></a>  <span class="comment">     * This function sets up $USER global.</span>
<a name="l854"><span class="linenum"> 854</span></a>  <span class="comment">     * It is safe to use has_capability() after this.</span>
<a name="l855"><span class="linenum"> 855</span></a>  <span class="comment">     * This method also verifies user is allowed to use this</span>
<a name="l856"><span class="linenum"> 856</span></a>  <span class="comment">     * server.</span>
<a name="l857"><span class="linenum"> 857</span></a>  <span class="comment">     */</span>
<a name="l858"><span class="linenum"> 858</span></a>      protected function <a class="function" onClick="logFunction('authenticate_user')" href="../_functions/authenticate_user.html" onMouseOver="funcPopup(event,'authenticate_user')">authenticate_user</a>() {
<a name="l859"><span class="linenum"> 859</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l860"><span class="linenum"> 860</span></a>  
<a name="l861"><span class="linenum"> 861</span></a>          if (!<a class="constant" onClick="logConstant('NO_MOODLE_COOKIES')" href="../_constants/NO_MOODLE_COOKIES.html" onMouseOver="constPopup(event,'NO_MOODLE_COOKIES')">NO_MOODLE_COOKIES</a>) {
<a name="l862"><span class="linenum"> 862</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Cookies must be disabled in WS servers!');
<a name="l863"><span class="linenum"> 863</span></a>          }
<a name="l864"><span class="linenum"> 864</span></a>  
<a name="l865"><span class="linenum"> 865</span></a>          <a class="var it9250" onMouseOver="hilite(9250)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a> = array(
<a name="l866"><span class="linenum"> 866</span></a>              'context' =&gt; <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(),
<a name="l867"><span class="linenum"> 867</span></a>              'other' =&gt; array(
<a name="l868"><span class="linenum"> 868</span></a>                  'method' =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authmethod')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/authmethod.html">authmethod</a>,
<a name="l869"><span class="linenum"> 869</span></a>                  'reason' =&gt; null
<a name="l870"><span class="linenum"> 870</span></a>              )
<a name="l871"><span class="linenum"> 871</span></a>          );
<a name="l872"><span class="linenum"> 872</span></a>  
<a name="l873"><span class="linenum"> 873</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authmethod')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/authmethod.html">authmethod</a> == <a class="constant" onClick="logConstant('WEBSERVICE_AUTHMETHOD_USERNAME')" href="../_constants/WEBSERVICE_AUTHMETHOD_USERNAME.html" onMouseOver="constPopup(event,'WEBSERVICE_AUTHMETHOD_USERNAME')">WEBSERVICE_AUTHMETHOD_USERNAME</a>) {
<a name="l874"><span class="linenum"> 874</span></a>  
<a name="l875"><span class="linenum"> 875</span></a>  <span class="comment">            //we check that authentication plugin is enabled</span>
<a name="l876"><span class="linenum"> 876</span></a>  <span class="comment">            //it is only required by simple authentication</span>
<a name="l877"><span class="linenum"> 877</span></a>              if (!<a class="function" onClick="logFunction('is_enabled_auth')" href="../_functions/is_enabled_auth.html" onMouseOver="funcPopup(event,'is_enabled_auth')">is_enabled_auth</a>('webservice')) {
<a name="l878"><span class="linenum"> 878</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('The web service authentication plugin is disabled.');
<a name="l879"><span class="linenum"> 879</span></a>              }
<a name="l880"><span class="linenum"> 880</span></a>  
<a name="l881"><span class="linenum"> 881</span></a>              if (!<a class="var it378" onMouseOver="hilite(378)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../_variables/auth.html">$auth</a> = <a class="function" onClick="logFunction('get_auth_plugin')" href="../_functions/get_auth_plugin.html" onMouseOver="funcPopup(event,'get_auth_plugin')">get_auth_plugin</a>('webservice')) {
<a name="l882"><span class="linenum"> 882</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('The web service authentication plugin is missing.');
<a name="l883"><span class="linenum"> 883</span></a>              }
<a name="l884"><span class="linenum"> 884</span></a>  
<a name="l885"><span class="linenum"> 885</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_context')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/restricted_context.html">restricted_context</a> = <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l886"><span class="linenum"> 886</span></a>  
<a name="l887"><span class="linenum"> 887</span></a>              if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('username')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/username.html">username</a>) {
<a name="l888"><span class="linenum"> 888</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('missingusername', 'webservice');
<a name="l889"><span class="linenum"> 889</span></a>              }
<a name="l890"><span class="linenum"> 890</span></a>  
<a name="l891"><span class="linenum"> 891</span></a>              if (!<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('password')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/password.html">password</a>) {
<a name="l892"><span class="linenum"> 892</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('missingpassword', 'webservice');
<a name="l893"><span class="linenum"> 893</span></a>              }
<a name="l894"><span class="linenum"> 894</span></a>  
<a name="l895"><span class="linenum"> 895</span></a>              if (!<a class="var it378" onMouseOver="hilite(378)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../_variables/auth.html">$auth</a>-&gt;<a class="function" onClick="logFunction('user_login_webservice')" href="../_functions/user_login_webservice.html" onMouseOver="funcPopup(event,'user_login_webservice')">user_login_webservice</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('username')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/username.html">username</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('password')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/password.html">password</a>)) {
<a name="l896"><span class="linenum"> 896</span></a>  
<a name="l897"><span class="linenum"> 897</span></a>  <span class="comment">                // Log failed login attempts.</span>
<a name="l898"><span class="linenum"> 898</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it9250" onMouseOver="hilite(9250)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l899"><span class="linenum"> 899</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'password';
<a name="l900"><span class="linenum"> 900</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['username'] = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('username')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/username.html">username</a>;
<a name="l901"><span class="linenum"> 901</span></a>                  <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l902"><span class="linenum"> 902</span></a>                  <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, 'webservice', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('simpleauthlog', 'webservice'), '' ,
<a name="l903"><span class="linenum"> 903</span></a>                      <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('failedtolog', 'webservice').&quot;: &quot;.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('username')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/username.html">username</a>.&quot;/&quot;.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('password')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/password.html">password</a>.&quot; - &quot;.<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>() , 0));
<a name="l904"><span class="linenum"> 904</span></a>                  <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l905"><span class="linenum"> 905</span></a>  
<a name="l906"><span class="linenum"> 906</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('wrongusernamepassword', 'webservice');
<a name="l907"><span class="linenum"> 907</span></a>              }
<a name="l908"><span class="linenum"> 908</span></a>  
<a name="l909"><span class="linenum"> 909</span></a>              <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('username'=&gt;<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('username')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/username.html">username</a>, 'mnethostid'=&gt;<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('mnet_localhost_id')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/mnet_localhost_id.html">mnet_localhost_id</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l910"><span class="linenum"> 910</span></a>  
<a name="l911"><span class="linenum"> 911</span></a>          } else if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authmethod')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/authmethod.html">authmethod</a> == <a class="constant" onClick="logConstant('WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN')" href="../_constants/WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN.html" onMouseOver="constPopup(event,'WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN')">WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN</a>){
<a name="l912"><span class="linenum"> 912</span></a>              <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('authenticate_by_token')" href="../_functions/authenticate_by_token.html" onMouseOver="funcPopup(event,'authenticate_by_token')">authenticate_by_token</a>(<a class="constant" onClick="logConstant('EXTERNAL_TOKEN_PERMANENT')" href="../_constants/EXTERNAL_TOKEN_PERMANENT.html" onMouseOver="constPopup(event,'EXTERNAL_TOKEN_PERMANENT')">EXTERNAL_TOKEN_PERMANENT</a>);
<a name="l913"><span class="linenum"> 913</span></a>          } else {
<a name="l914"><span class="linenum"> 914</span></a>              <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('authenticate_by_token')" href="../_functions/authenticate_by_token.html" onMouseOver="funcPopup(event,'authenticate_by_token')">authenticate_by_token</a>(<a class="constant" onClick="logConstant('EXTERNAL_TOKEN_EMBEDDED')" href="../_constants/EXTERNAL_TOKEN_EMBEDDED.html" onMouseOver="constPopup(event,'EXTERNAL_TOKEN_EMBEDDED')">EXTERNAL_TOKEN_EMBEDDED</a>);
<a name="l915"><span class="linenum"> 915</span></a>          }
<a name="l916"><span class="linenum"> 916</span></a>  
<a name="l917"><span class="linenum"> 917</span></a>  <span class="comment">        //Non admin can not authenticate if maintenance mode</span>
<a name="l918"><span class="linenum"> 918</span></a>          <a class="var it2523" onMouseOver="hilite(2523)" onMouseOut="lolite()" onClick="logVariable('hassiteconfig')" href="../_variables/hassiteconfig.html">$hassiteconfig</a> = <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:config', <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(), <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l919"><span class="linenum"> 919</span></a>          if (!empty(<a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('maintenance_enabled')" class="var it42902" onMouseOver="hilite(42902)" onMouseOut="lolite()" href="../_variables/maintenance_enabled.html">maintenance_enabled</a>) and !<a class="var it2523" onMouseOver="hilite(2523)" onMouseOut="lolite()" onClick="logVariable('hassiteconfig')" href="../_variables/hassiteconfig.html">$hassiteconfig</a>) {
<a name="l920"><span class="linenum"> 920</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('sitemaintenance', 'admin');
<a name="l921"><span class="linenum"> 921</span></a>          }
<a name="l922"><span class="linenum"> 922</span></a>  
<a name="l923"><span class="linenum"> 923</span></a>  <span class="comment">        //only confirmed user should be able to call web service</span>
<a name="l924"><span class="linenum"> 924</span></a>          if (!empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('deleted')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/deleted.html">deleted</a>)) {
<a name="l925"><span class="linenum"> 925</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it9250" onMouseOver="hilite(9250)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l926"><span class="linenum"> 926</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'user_deleted';
<a name="l927"><span class="linenum"> 927</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['username'] = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>;
<a name="l928"><span class="linenum"> 928</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l929"><span class="linenum"> 929</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, '', '', '', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('wsaccessuserdeleted', 'webservice',
<a name="l930"><span class="linenum"> 930</span></a>                  <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>) . &quot; - &quot;.<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>(), 0, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l931"><span class="linenum"> 931</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l932"><span class="linenum"> 932</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Refused web service access for deleted username: ' . <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l933"><span class="linenum"> 933</span></a>          }
<a name="l934"><span class="linenum"> 934</span></a>  
<a name="l935"><span class="linenum"> 935</span></a>  <span class="comment">        //only confirmed user should be able to call web service</span>
<a name="l936"><span class="linenum"> 936</span></a>          if (empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('confirmed')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/confirmed.html">confirmed</a>)) {
<a name="l937"><span class="linenum"> 937</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it9250" onMouseOver="hilite(9250)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l938"><span class="linenum"> 938</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'user_unconfirmed';
<a name="l939"><span class="linenum"> 939</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['username'] = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>;
<a name="l940"><span class="linenum"> 940</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l941"><span class="linenum"> 941</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, '', '', '', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('wsaccessuserunconfirmed', 'webservice',
<a name="l942"><span class="linenum"> 942</span></a>                  <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>) . &quot; - &quot;.<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>(), 0, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l943"><span class="linenum"> 943</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l944"><span class="linenum"> 944</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('wsaccessuserunconfirmed', 'webservice', '', <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l945"><span class="linenum"> 945</span></a>          }
<a name="l946"><span class="linenum"> 946</span></a>  
<a name="l947"><span class="linenum"> 947</span></a>  <span class="comment">        //check the user is suspended</span>
<a name="l948"><span class="linenum"> 948</span></a>          if (!empty(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('suspended')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/suspended.html">suspended</a>)) {
<a name="l949"><span class="linenum"> 949</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it9250" onMouseOver="hilite(9250)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l950"><span class="linenum"> 950</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'user_unconfirmed';
<a name="l951"><span class="linenum"> 951</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['username'] = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>;
<a name="l952"><span class="linenum"> 952</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l953"><span class="linenum"> 953</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, '', '', '', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('wsaccessusersuspended', 'webservice',
<a name="l954"><span class="linenum"> 954</span></a>                  <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>) . &quot; - &quot;.<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>(), 0, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l955"><span class="linenum"> 955</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l956"><span class="linenum"> 956</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Refused web service access for suspended username: ' . <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l957"><span class="linenum"> 957</span></a>          }
<a name="l958"><span class="linenum"> 958</span></a>  
<a name="l959"><span class="linenum"> 959</span></a>  <span class="comment">        //retrieve the authentication plugin if no previously done</span>
<a name="l960"><span class="linenum"> 960</span></a>          if (empty(<a class="var it378" onMouseOver="hilite(378)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../_variables/auth.html">$auth</a>)) {
<a name="l961"><span class="linenum"> 961</span></a>            <a class="var it378" onMouseOver="hilite(378)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../_variables/auth.html">$auth</a>  = <a class="function" onClick="logFunction('get_auth_plugin')" href="../_functions/get_auth_plugin.html" onMouseOver="funcPopup(event,'get_auth_plugin')">get_auth_plugin</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/auth.html">auth</a>);
<a name="l962"><span class="linenum"> 962</span></a>          }
<a name="l963"><span class="linenum"> 963</span></a>  
<a name="l964"><span class="linenum"> 964</span></a>  <span class="comment">        // check if credentials have expired</span>
<a name="l965"><span class="linenum"> 965</span></a>          if (!empty(<a class="var it378" onMouseOver="hilite(378)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../_variables/auth.html">$auth</a>-&gt;<a onClick="logVariable('config')" class="var it43487" onMouseOver="hilite(43487)" onMouseOut="lolite()" href="../_variables/config.html">config</a>-&gt;expiration) and <a class="var it378" onMouseOver="hilite(378)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../_variables/auth.html">$auth</a>-&gt;<a onClick="logVariable('config')" class="var it43487" onMouseOver="hilite(43487)" onMouseOut="lolite()" href="../_variables/config.html">config</a>-&gt;expiration == 1) {
<a name="l966"><span class="linenum"> 966</span></a>              <a class="var it380" onMouseOver="hilite(380)" onMouseOut="lolite()" onClick="logVariable('days2expire')" href="../_variables/days2expire.html">$days2expire</a> = <a class="var it378" onMouseOver="hilite(378)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../_variables/auth.html">$auth</a>-&gt;<a class="function" onClick="logFunction('password_expire')" href="../_functions/password_expire.html" onMouseOver="funcPopup(event,'password_expire')">password_expire</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l967"><span class="linenum"> 967</span></a>              if (<a class="phpfunction" onClick="logFunction('intval')" href="../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>(<a class="var it380" onMouseOver="hilite(380)" onMouseOut="lolite()" onClick="logVariable('days2expire')" href="../_variables/days2expire.html">$days2expire</a>) &lt; 0 ) {
<a name="l968"><span class="linenum"> 968</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it9250" onMouseOver="hilite(9250)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l969"><span class="linenum"> 969</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'password_expired';
<a name="l970"><span class="linenum"> 970</span></a>                  <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['username'] = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>;
<a name="l971"><span class="linenum"> 971</span></a>                  <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l972"><span class="linenum"> 972</span></a>                  <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, '', '', '', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('wsaccessuserexpired', 'webservice',
<a name="l973"><span class="linenum"> 973</span></a>                      <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>) . &quot; - &quot;.<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>(), 0, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l974"><span class="linenum"> 974</span></a>                  <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l975"><span class="linenum"> 975</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Refused web service access for password expired username: ' . <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l976"><span class="linenum"> 976</span></a>              }
<a name="l977"><span class="linenum"> 977</span></a>          }
<a name="l978"><span class="linenum"> 978</span></a>  
<a name="l979"><span class="linenum"> 979</span></a>  <span class="comment">        //check if the auth method is nologin (in this case refuse connection)</span>
<a name="l980"><span class="linenum"> 980</span></a>          if (<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/auth.html">auth</a>=='nologin') {
<a name="l981"><span class="linenum"> 981</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it9250" onMouseOver="hilite(9250)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l982"><span class="linenum"> 982</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'login';
<a name="l983"><span class="linenum"> 983</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['username'] = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>;
<a name="l984"><span class="linenum"> 984</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l985"><span class="linenum"> 985</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, '', '', '', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('wsaccessusernologin', 'webservice',
<a name="l986"><span class="linenum"> 986</span></a>                  <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>) . &quot; - &quot;.<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>(), 0, <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l987"><span class="linenum"> 987</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l988"><span class="linenum"> 988</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Refused web service access for nologin authentication username: ' . <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l989"><span class="linenum"> 989</span></a>          }
<a name="l990"><span class="linenum"> 990</span></a>  
<a name="l991"><span class="linenum"> 991</span></a>  <span class="comment">        // now fake user login, the session is completely empty too</span>
<a name="l992"><span class="linenum"> 992</span></a>          <a class="function" onClick="logFunction('enrol_check_plugins')" href="../_functions/enrol_check_plugins.html" onMouseOver="funcPopup(event,'enrol_check_plugins')">enrol_check_plugins</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l993"><span class="linenum"> 993</span></a>          \core\session\<a class="class" onClick="logClass('manager')" href="../_classes/manager.html" onMouseOver="classPopup(event,'manager')">manager</a>::<a class="function" onClick="logFunction('set_user')" href="../_functions/set_user.html" onMouseOver="funcPopup(event,'set_user')">set_user</a>(<a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l994"><span class="linenum"> 994</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userid')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a> = <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it42948" onMouseOver="hilite(42948)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l995"><span class="linenum"> 995</span></a>  
<a name="l996"><span class="linenum"> 996</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authmethod')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/authmethod.html">authmethod</a> != <a class="constant" onClick="logConstant('WEBSERVICE_AUTHMETHOD_SESSION_TOKEN')" href="../_constants/WEBSERVICE_AUTHMETHOD_SESSION_TOKEN.html" onMouseOver="constPopup(event,'WEBSERVICE_AUTHMETHOD_SESSION_TOKEN')">WEBSERVICE_AUTHMETHOD_SESSION_TOKEN</a> &amp;&amp; !<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(&quot;webservice/<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('wsname')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/wsname.html">wsname</a>:use&quot;, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_context')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/restricted_context.html">restricted_context</a>)) {
<a name="l997"><span class="linenum"> 997</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('You are not allowed to use the {<a class="var it70" onMouseOver="hilite(70)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a>} protocol (missing capability: webservice/' . <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('wsname')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/wsname.html">wsname</a> . ':use)');
<a name="l998"><span class="linenum"> 998</span></a>          }
<a name="l999"><span class="linenum"> 999</span></a>  
<a name="l1000"><span class="linenum">1000</span></a>          <a class="class" onClick="logClass('external_api')" href="../_classes/external_api.html" onMouseOver="classPopup(event,'external_api')">external_api</a>::<a class="function" onClick="logFunction('set_context_restriction')" href="../_functions/set_context_restriction.html" onMouseOver="funcPopup(event,'set_context_restriction')">set_context_restriction</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_context')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/restricted_context.html">restricted_context</a>);
<a name="l1001"><span class="linenum">1001</span></a>      }
<a name="l1002"><span class="linenum">1002</span></a>  
<a name="l1003"><span class="linenum">1003</span></a>      <span class="comment">/**</span>
<a name="l1004"><span class="linenum">1004</span></a>  <span class="comment">     * User authentication by token</span>
<a name="l1005"><span class="linenum">1005</span></a>  <span class="comment">     *</span>
<a name="l1006"><span class="linenum">1006</span></a>  <span class="comment">     * @param string $tokentype token type (EXTERNAL_TOKEN_EMBEDDED or EXTERNAL_TOKEN_PERMANENT)</span>
<a name="l1007"><span class="linenum">1007</span></a>  <span class="comment">     * @return stdClass the authenticated user</span>
<a name="l1008"><span class="linenum">1008</span></a>  <span class="comment">     * @throws webservice_access_exception</span>
<a name="l1009"><span class="linenum">1009</span></a>  <span class="comment">     */</span>
<a name="l1010"><span class="linenum">1010</span></a>      protected function <a class="function" onClick="logFunction('authenticate_by_token')" href="../_functions/authenticate_by_token.html" onMouseOver="funcPopup(event,'authenticate_by_token')">authenticate_by_token</a>(<a class="var it5797" onMouseOver="hilite(5797)" onMouseOut="lolite()" onClick="logVariable('tokentype')" href="../_variables/tokentype.html">$tokentype</a>){
<a name="l1011"><span class="linenum">1011</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1012"><span class="linenum">1012</span></a>  
<a name="l1013"><span class="linenum">1013</span></a>          <a class="var it9250" onMouseOver="hilite(9250)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a> = array(
<a name="l1014"><span class="linenum">1014</span></a>              'context' =&gt; <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(),
<a name="l1015"><span class="linenum">1015</span></a>              'other' =&gt; array(
<a name="l1016"><span class="linenum">1016</span></a>                  'method' =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authmethod')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/authmethod.html">authmethod</a>,
<a name="l1017"><span class="linenum">1017</span></a>                  'reason' =&gt; null
<a name="l1018"><span class="linenum">1018</span></a>              )
<a name="l1019"><span class="linenum">1019</span></a>          );
<a name="l1020"><span class="linenum">1020</span></a>  
<a name="l1021"><span class="linenum">1021</span></a>          if (!<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('external_tokens', array('token'=&gt;<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('token')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/token.html">token</a>, 'tokentype'=&gt;<a class="var it5797" onMouseOver="hilite(5797)" onMouseOut="lolite()" onClick="logVariable('tokentype')" href="../_variables/tokentype.html">$tokentype</a>))) {
<a name="l1022"><span class="linenum">1022</span></a>  <span class="comment">            // Log failed login attempts.</span>
<a name="l1023"><span class="linenum">1023</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it9250" onMouseOver="hilite(9250)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l1024"><span class="linenum">1024</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'invalid_token';
<a name="l1025"><span class="linenum">1025</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l1026"><span class="linenum">1026</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, 'webservice', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('tokenauthlog', 'webservice'), '' ,
<a name="l1027"><span class="linenum">1027</span></a>                  <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('failedtolog', 'webservice').&quot;: &quot;.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('token')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/token.html">token</a>. &quot; - &quot;.<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>() , 0));
<a name="l1028"><span class="linenum">1028</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1029"><span class="linenum">1029</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('invalidtoken', 'webservice');
<a name="l1030"><span class="linenum">1030</span></a>          }
<a name="l1031"><span class="linenum">1031</span></a>  
<a name="l1032"><span class="linenum">1032</span></a>          if (<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('validuntil')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/validuntil.html">validuntil</a> and <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('validuntil')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/validuntil.html">validuntil</a> &lt; <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()) {
<a name="l1033"><span class="linenum">1033</span></a>              <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_tokens', array('token'=&gt;<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('token')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/token.html">token</a>, 'tokentype'=&gt;<a class="var it5797" onMouseOver="hilite(5797)" onMouseOut="lolite()" onClick="logVariable('tokentype')" href="../_variables/tokentype.html">$tokentype</a>));
<a name="l1034"><span class="linenum">1034</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Invalid token - token expired - check validuntil time for the token');
<a name="l1035"><span class="linenum">1035</span></a>          }
<a name="l1036"><span class="linenum">1036</span></a>  
<a name="l1037"><span class="linenum">1037</span></a>          if (<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('sid')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/sid.html">sid</a>){//assumes that if sid is set then there must be a valid associated session no matter the token type
<a name="l1038"><span class="linenum">1038</span></a>              if (!\core\session\<a class="class" onClick="logClass('manager')" href="../_classes/manager.html" onMouseOver="classPopup(event,'manager')">manager</a>::<a class="function" onClick="logFunction('session_exists')" href="../_functions/session_exists.html" onMouseOver="funcPopup(event,'session_exists')">session_exists</a>(<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('sid')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/sid.html">sid</a>)){
<a name="l1039"><span class="linenum">1039</span></a>                  <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_tokens', array('sid'=&gt;<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('sid')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/sid.html">sid</a>));
<a name="l1040"><span class="linenum">1040</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Invalid session based token - session not found or expired');
<a name="l1041"><span class="linenum">1041</span></a>              }
<a name="l1042"><span class="linenum">1042</span></a>          }
<a name="l1043"><span class="linenum">1043</span></a>  
<a name="l1044"><span class="linenum">1044</span></a>          if (<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a> and !<a class="function" onClick="logFunction('address_in_subnet')" href="../_functions/address_in_subnet.html" onMouseOver="funcPopup(event,'address_in_subnet')">address_in_subnet</a>(<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>(), <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a>)) {
<a name="l1045"><span class="linenum">1045</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it9250" onMouseOver="hilite(9250)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l1046"><span class="linenum">1046</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'ip_restricted';
<a name="l1047"><span class="linenum">1047</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['tokenid'] = <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('id')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l1048"><span class="linenum">1048</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l1049"><span class="linenum">1049</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('external_tokens', <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>);
<a name="l1050"><span class="linenum">1050</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, 'webservice', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('tokenauthlog', 'webservice'), '' ,
<a name="l1051"><span class="linenum">1051</span></a>                  <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('failedtolog', 'webservice').&quot;: &quot;.<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>() , 0));
<a name="l1052"><span class="linenum">1052</span></a>              <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1053"><span class="linenum">1053</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Invalid service - IP:' . <a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>()
<a name="l1054"><span class="linenum">1054</span></a>                      . ' is not supported - check this allowed user');
<a name="l1055"><span class="linenum">1055</span></a>          }
<a name="l1056"><span class="linenum">1056</span></a>  
<a name="l1057"><span class="linenum">1057</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_context')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/restricted_context.html">restricted_context</a> = context::<a class="function" onClick="logFunction('instance_by_id')" href="../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>(<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('contextid')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/contextid.html">contextid</a>);
<a name="l1058"><span class="linenum">1058</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_serviceid')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/restricted_serviceid.html">restricted_serviceid</a> = <a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('externalserviceid')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/externalserviceid.html">externalserviceid</a>;
<a name="l1059"><span class="linenum">1059</span></a>  
<a name="l1060"><span class="linenum">1060</span></a>          <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id'=&gt;<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('userid')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l1061"><span class="linenum">1061</span></a>  
<a name="l1062"><span class="linenum">1062</span></a>  <span class="comment">        // log token access</span>
<a name="l1063"><span class="linenum">1063</span></a>          <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('external_tokens', 'lastaccess', <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>(), array('id'=&gt;<a class="var it310" onMouseOver="hilite(310)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('id')" class="var it43411" onMouseOver="hilite(43411)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l1064"><span class="linenum">1064</span></a>  
<a name="l1065"><span class="linenum">1065</span></a>          return <a class="var it362" onMouseOver="hilite(362)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>;
<a name="l1066"><span class="linenum">1066</span></a>  
<a name="l1067"><span class="linenum">1067</span></a>      }
<a name="l1068"><span class="linenum">1068</span></a>  
<a name="l1069"><span class="linenum">1069</span></a>      <span class="comment">/**</span>
<a name="l1070"><span class="linenum">1070</span></a>  <span class="comment">     * Intercept some moodlewssettingXXX $_GET and $_POST parameter</span>
<a name="l1071"><span class="linenum">1071</span></a>  <span class="comment">     * that are related to the web service call and are not the function parameters</span>
<a name="l1072"><span class="linenum">1072</span></a>  <span class="comment">     */</span>
<a name="l1073"><span class="linenum">1073</span></a>      protected function <a class="function" onClick="logFunction('set_web_service_call_settings')" href="../_functions/set_web_service_call_settings.html" onMouseOver="funcPopup(event,'set_web_service_call_settings')">set_web_service_call_settings</a>() {
<a name="l1074"><span class="linenum">1074</span></a>          global <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l1075"><span class="linenum">1075</span></a>  
<a name="l1076"><span class="linenum">1076</span></a>  <span class="comment">        // Default web service settings.</span>
<a name="l1077"><span class="linenum">1077</span></a>  <span class="comment">        // Must be the same XXX key name as the external_settings::set_XXX function.</span>
<a name="l1078"><span class="linenum">1078</span></a>  <span class="comment">        // Must be the same XXX ws parameter name as 'moodlewssettingXXX'.</span>
<a name="l1079"><span class="linenum">1079</span></a>          <a class="var it9275" onMouseOver="hilite(9275)" onMouseOut="lolite()" onClick="logVariable('externalsettings')" href="../_variables/externalsettings.html">$externalsettings</a> = array(
<a name="l1080"><span class="linenum">1080</span></a>              'raw' =&gt; false,
<a name="l1081"><span class="linenum">1081</span></a>              'fileurl' =&gt; true,
<a name="l1082"><span class="linenum">1082</span></a>              'filter' =&gt;  false);
<a name="l1083"><span class="linenum">1083</span></a>  
<a name="l1084"><span class="linenum">1084</span></a>  <span class="comment">        // Load the external settings with the web service settings.</span>
<a name="l1085"><span class="linenum">1085</span></a>          <a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../_variables/settings.html">$settings</a> = <a class="class" onClick="logClass('external_settings')" href="../_classes/external_settings.html" onMouseOver="classPopup(event,'external_settings')">external_settings</a>::<a class="function" onClick="logFunction('get_instance')" href="../_functions/get_instance.html" onMouseOver="funcPopup(event,'get_instance')">get_instance</a>();
<a name="l1086"><span class="linenum">1086</span></a>          foreach (<a class="var it9275" onMouseOver="hilite(9275)" onMouseOut="lolite()" onClick="logVariable('externalsettings')" href="../_variables/externalsettings.html">$externalsettings</a> as <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> =&gt; <a class="var it777" onMouseOver="hilite(777)" onMouseOut="lolite()" onClick="logVariable('default')" href="../_variables/default.html">$default</a>) {
<a name="l1087"><span class="linenum">1087</span></a>  
<a name="l1088"><span class="linenum">1088</span></a>              <a class="var it9276" onMouseOver="hilite(9276)" onMouseOut="lolite()" onClick="logVariable('wsparamname')" href="../_variables/wsparamname.html">$wsparamname</a> = 'moodlewssetting' . <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>;
<a name="l1089"><span class="linenum">1089</span></a>  
<a name="l1090"><span class="linenum">1090</span></a>  <span class="comment">            // Retrieve and remove the setting parameter from the request.</span>
<a name="l1091"><span class="linenum">1091</span></a>              <a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../_variables/value.html">$value</a> = <a class="function" onClick="logFunction('optional_param')" href="../_functions/optional_param.html" onMouseOver="funcPopup(event,'optional_param')">optional_param</a>(<a class="var it9276" onMouseOver="hilite(9276)" onMouseOut="lolite()" onClick="logVariable('wsparamname')" href="../_variables/wsparamname.html">$wsparamname</a>, <a class="var it777" onMouseOver="hilite(777)" onMouseOut="lolite()" onClick="logVariable('default')" href="../_variables/default.html">$default</a>, <a class="constant" onClick="logConstant('PARAM_BOOL')" href="../_constants/PARAM_BOOL.html" onMouseOver="constPopup(event,'PARAM_BOOL')">PARAM_BOOL</a>);
<a name="l1092"><span class="linenum">1092</span></a>              unset(<a class="var it385" onMouseOver="hilite(385)" onMouseOut="lolite()" onClick="logVariable('_GET')" href="../_variables/_GET.html">$_GET</a>[<a class="var it9276" onMouseOver="hilite(9276)" onMouseOut="lolite()" onClick="logVariable('wsparamname')" href="../_variables/wsparamname.html">$wsparamname</a>]);
<a name="l1093"><span class="linenum">1093</span></a>              unset(<a class="var it2242" onMouseOver="hilite(2242)" onMouseOut="lolite()" onClick="logVariable('_POST')" href="../_variables/_POST.html">$_POST</a>[<a class="var it9276" onMouseOver="hilite(9276)" onMouseOut="lolite()" onClick="logVariable('wsparamname')" href="../_variables/wsparamname.html">$wsparamname</a>]);
<a name="l1094"><span class="linenum">1094</span></a>  
<a name="l1095"><span class="linenum">1095</span></a>              <a class="var it9269" onMouseOver="hilite(9269)" onMouseOut="lolite()" onClick="logVariable('functioname')" href="../_variables/functioname.html">$functioname</a> = 'set_' . <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>;
<a name="l1096"><span class="linenum">1096</span></a>              <a class="var it18" onMouseOver="hilite(18)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../_variables/settings.html">$settings</a>-&gt;<a class="var it9269" onMouseOver="hilite(9269)" onMouseOut="lolite()" onClick="logVariable('functioname')" href="../_variables/functioname.html">$functioname</a>(<a class="var it394" onMouseOver="hilite(394)" onMouseOut="lolite()" onClick="logVariable('value')" href="../_variables/value.html">$value</a>);
<a name="l1097"><span class="linenum">1097</span></a>          }
<a name="l1098"><span class="linenum">1098</span></a>  
<a name="l1099"><span class="linenum">1099</span></a>      }
<a name="l1100"><span class="linenum">1100</span></a>  }
<a name="l1101"><span class="linenum">1101</span></a>  
<a name="l1102"><span class="linenum">1102</span></a>  <span class="comment">/**</span>
<a name="l1103"><span class="linenum">1103</span></a>  <span class="comment"> * Web Service server base class.</span>
<a name="l1104"><span class="linenum">1104</span></a>  <span class="comment"> *</span>
<a name="l1105"><span class="linenum">1105</span></a>  <span class="comment"> * This class handles both simple and token authentication.</span>
<a name="l1106"><span class="linenum">1106</span></a>  <span class="comment"> *</span>
<a name="l1107"><span class="linenum">1107</span></a>  <span class="comment"> * @package    core_webservice</span>
<a name="l1108"><span class="linenum">1108</span></a>  <span class="comment"> * @copyright  2009 Petr Skodak</span>
<a name="l1109"><span class="linenum">1109</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l1110"><span class="linenum">1110</span></a>  <span class="comment"> */</span>
<a name="l1111"><span class="linenum">1111</span></a>  abstract class webservice_base_server extends webservice_server {
<a name="l1112"><span class="linenum">1112</span></a>  
<a name="l1113"><span class="linenum">1113</span></a>  <span class="comment">    /** @var array The function parameters - the real values submitted in the request */</span>
<a name="l1114"><span class="linenum">1114</span></a>      protected <a class="var it2245" onMouseOver="hilite(2245)" onMouseOut="lolite()" onClick="logVariable('parameters')" href="../_variables/parameters.html">$parameters</a> = null;
<a name="l1115"><span class="linenum">1115</span></a>  
<a name="l1116"><span class="linenum">1116</span></a>  <span class="comment">    /** @var string The name of the function that is executed */</span>
<a name="l1117"><span class="linenum">1117</span></a>      protected <a class="var it2244" onMouseOver="hilite(2244)" onMouseOut="lolite()" onClick="logVariable('functionname')" href="../_variables/functionname.html">$functionname</a> = null;
<a name="l1118"><span class="linenum">1118</span></a>  
<a name="l1119"><span class="linenum">1119</span></a>  <span class="comment">    /** @var stdClass Full function description */</span>
<a name="l1120"><span class="linenum">1120</span></a>      protected <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a> = null;
<a name="l1121"><span class="linenum">1121</span></a>  
<a name="l1122"><span class="linenum">1122</span></a>  <span class="comment">    /** @var mixed Function return value */</span>
<a name="l1123"><span class="linenum">1123</span></a>      protected <a class="var it2247" onMouseOver="hilite(2247)" onMouseOut="lolite()" onClick="logVariable('returns')" href="../_variables/returns.html">$returns</a> = null;
<a name="l1124"><span class="linenum">1124</span></a>  
<a name="l1125"><span class="linenum">1125</span></a>  <span class="comment">    /** @var array List of methods and their information provided by the web service. */</span>
<a name="l1126"><span class="linenum">1126</span></a>      protected <a class="var it9277" onMouseOver="hilite(9277)" onMouseOut="lolite()" onClick="logVariable('servicemethods')" href="../_variables/servicemethods.html">$servicemethods</a>;
<a name="l1127"><span class="linenum">1127</span></a>  
<a name="l1128"><span class="linenum">1128</span></a>  <span class="comment">    /** @var  array List of struct classes generated for the web service methods. */</span>
<a name="l1129"><span class="linenum">1129</span></a>      protected <a class="var it9278" onMouseOver="hilite(9278)" onMouseOut="lolite()" onClick="logVariable('servicestructs')" href="../_variables/servicestructs.html">$servicestructs</a>;
<a name="l1130"><span class="linenum">1130</span></a>  
<a name="l1131"><span class="linenum">1131</span></a>      <span class="comment">/**</span>
<a name="l1132"><span class="linenum">1132</span></a>  <span class="comment">     * This method parses the request input, it needs to get:</span>
<a name="l1133"><span class="linenum">1133</span></a>  <span class="comment">     *  1/ user authentication - username+password or token</span>
<a name="l1134"><span class="linenum">1134</span></a>  <span class="comment">     *  2/ function name</span>
<a name="l1135"><span class="linenum">1135</span></a>  <span class="comment">     *  3/ function parameters</span>
<a name="l1136"><span class="linenum">1136</span></a>  <span class="comment">     */</span>
<a name="l1137"><span class="linenum">1137</span></a>      abstract protected function <a class="function" onClick="logFunction('parse_request')" href="../_functions/parse_request.html" onMouseOver="funcPopup(event,'parse_request')">parse_request</a>();
<a name="l1138"><span class="linenum">1138</span></a>  
<a name="l1139"><span class="linenum">1139</span></a>      <span class="comment">/**</span>
<a name="l1140"><span class="linenum">1140</span></a>  <span class="comment">     * Send the result of function call to the WS client.</span>
<a name="l1141"><span class="linenum">1141</span></a>  <span class="comment">     */</span>
<a name="l1142"><span class="linenum">1142</span></a>      abstract protected function <a class="function" onClick="logFunction('send_response')" href="../_functions/send_response.html" onMouseOver="funcPopup(event,'send_response')">send_response</a>();
<a name="l1143"><span class="linenum">1143</span></a>  
<a name="l1144"><span class="linenum">1144</span></a>      <span class="comment">/**</span>
<a name="l1145"><span class="linenum">1145</span></a>  <span class="comment">     * Send the error information to the WS client.</span>
<a name="l1146"><span class="linenum">1146</span></a>  <span class="comment">     *</span>
<a name="l1147"><span class="linenum">1147</span></a>  <span class="comment">     * @param exception $ex</span>
<a name="l1148"><span class="linenum">1148</span></a>  <span class="comment">     */</span>
<a name="l1149"><span class="linenum">1149</span></a>      abstract protected function <a class="function" onClick="logFunction('send_error')" href="../_functions/send_error.html" onMouseOver="funcPopup(event,'send_error')">send_error</a>(<a class="var it341" onMouseOver="hilite(341)" onMouseOut="lolite()" onClick="logVariable('ex')" href="../_variables/ex.html">$ex</a>=null);
<a name="l1150"><span class="linenum">1150</span></a>  
<a name="l1151"><span class="linenum">1151</span></a>      <span class="comment">/**</span>
<a name="l1152"><span class="linenum">1152</span></a>  <span class="comment">     * Process request from client.</span>
<a name="l1153"><span class="linenum">1153</span></a>  <span class="comment">     *</span>
<a name="l1154"><span class="linenum">1154</span></a>  <span class="comment">     * @uses die</span>
<a name="l1155"><span class="linenum">1155</span></a>  <span class="comment">     */</span>
<a name="l1156"><span class="linenum">1156</span></a>      public function <a class="function" onClick="logFunction('run')" href="../_functions/run.html" onMouseOver="funcPopup(event,'run')">run</a>() {
<a name="l1157"><span class="linenum">1157</span></a>  <span class="comment">        // we will probably need a lot of memory in some functions</span>
<a name="l1158"><span class="linenum">1158</span></a>          <a class="function" onClick="logFunction('raise_memory_limit')" href="../_functions/raise_memory_limit.html" onMouseOver="funcPopup(event,'raise_memory_limit')">raise_memory_limit</a>(<a class="constant" onClick="logConstant('MEMORY_EXTRA')" href="../_constants/MEMORY_EXTRA.html" onMouseOver="constPopup(event,'MEMORY_EXTRA')">MEMORY_EXTRA</a>);
<a name="l1159"><span class="linenum">1159</span></a>  
<a name="l1160"><span class="linenum">1160</span></a>  <span class="comment">        // set some longer timeout, this script is not sending any output,</span>
<a name="l1161"><span class="linenum">1161</span></a>  <span class="comment">        // this means we need to manually extend the timeout operations</span>
<a name="l1162"><span class="linenum">1162</span></a>  <span class="comment">        // that need longer time to finish</span>
<a name="l1163"><span class="linenum">1163</span></a>          <a class="class" onClick="logClass('external_api')" href="../_classes/external_api.html" onMouseOver="classPopup(event,'external_api')">external_api</a>::<a class="function" onClick="logFunction('set_timeout')" href="../_functions/set_timeout.html" onMouseOver="funcPopup(event,'set_timeout')">set_timeout</a>();
<a name="l1164"><span class="linenum">1164</span></a>  
<a name="l1165"><span class="linenum">1165</span></a>  <span class="comment">        // set up exception handler first, we want to sent them back in correct format that</span>
<a name="l1166"><span class="linenum">1166</span></a>  <span class="comment">        // the other system understands</span>
<a name="l1167"><span class="linenum">1167</span></a>  <span class="comment">        // we do not need to call the original default handler because this ws handler does everything</span>
<a name="l1168"><span class="linenum">1168</span></a>          <a class="phpfunction" onClick="logFunction('set_exception_handler')" href="../_functions/set_exception_handler.html" onMouseOver="phpfuncPopup(event,'set_exception_handler')">set_exception_handler</a>(array(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>, 'exception_handler'));
<a name="l1169"><span class="linenum">1169</span></a>  
<a name="l1170"><span class="linenum">1170</span></a>  <span class="comment">        // init all properties from the request data</span>
<a name="l1171"><span class="linenum">1171</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('parse_request')" href="../_functions/parse_request.html" onMouseOver="funcPopup(event,'parse_request')">parse_request</a>();
<a name="l1172"><span class="linenum">1172</span></a>  
<a name="l1173"><span class="linenum">1173</span></a>  <span class="comment">        // authenticate user, this has to be done after the request parsing</span>
<a name="l1174"><span class="linenum">1174</span></a>  <span class="comment">        // this also sets up $USER and $SESSION</span>
<a name="l1175"><span class="linenum">1175</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('authenticate_user')" href="../_functions/authenticate_user.html" onMouseOver="funcPopup(event,'authenticate_user')">authenticate_user</a>();
<a name="l1176"><span class="linenum">1176</span></a>  
<a name="l1177"><span class="linenum">1177</span></a>  <span class="comment">        // find all needed function info and make sure user may actually execute the function</span>
<a name="l1178"><span class="linenum">1178</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('load_function_info')" href="../_functions/load_function_info.html" onMouseOver="funcPopup(event,'load_function_info')">load_function_info</a>();
<a name="l1179"><span class="linenum">1179</span></a>  
<a name="l1180"><span class="linenum">1180</span></a>  <span class="comment">        // Log the web service request.</span>
<a name="l1181"><span class="linenum">1181</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array(
<a name="l1182"><span class="linenum">1182</span></a>              'other' =&gt; array(
<a name="l1183"><span class="linenum">1183</span></a>                  'function' =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;functionname
<a name="l1184"><span class="linenum">1184</span></a>              )
<a name="l1185"><span class="linenum">1185</span></a>          );
<a name="l1186"><span class="linenum">1186</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_function_called')" href="../_classes/webservice_function_called.html" onMouseOver="classPopup(event,'webservice_function_called')">webservice_function_called</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l1187"><span class="linenum">1187</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, 'webservice', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('functionname')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/functionname.html">functionname</a>, '' , <a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>() , 0, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userid')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>));
<a name="l1188"><span class="linenum">1188</span></a>          <a class="var it165" onMouseOver="hilite(165)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1189"><span class="linenum">1189</span></a>  
<a name="l1190"><span class="linenum">1190</span></a>  <span class="comment">        // finally, execute the function - any errors are catched by the default exception handler</span>
<a name="l1191"><span class="linenum">1191</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>();
<a name="l1192"><span class="linenum">1192</span></a>  
<a name="l1193"><span class="linenum">1193</span></a>  <span class="comment">        // send the results back in correct format</span>
<a name="l1194"><span class="linenum">1194</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('send_response')" href="../_functions/send_response.html" onMouseOver="funcPopup(event,'send_response')">send_response</a>();
<a name="l1195"><span class="linenum">1195</span></a>  
<a name="l1196"><span class="linenum">1196</span></a>  <span class="comment">        // session cleanup</span>
<a name="l1197"><span class="linenum">1197</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('session_cleanup')" href="../_functions/session_cleanup.html" onMouseOver="funcPopup(event,'session_cleanup')">session_cleanup</a>();
<a name="l1198"><span class="linenum">1198</span></a>  
<a name="l1199"><span class="linenum">1199</span></a>          die;
<a name="l1200"><span class="linenum">1200</span></a>      }
<a name="l1201"><span class="linenum">1201</span></a>  
<a name="l1202"><span class="linenum">1202</span></a>      <span class="comment">/**</span>
<a name="l1203"><span class="linenum">1203</span></a>  <span class="comment">     * Specialised exception handler, we can not use the standard one because</span>
<a name="l1204"><span class="linenum">1204</span></a>  <span class="comment">     * it can not just print html to output.</span>
<a name="l1205"><span class="linenum">1205</span></a>  <span class="comment">     *</span>
<a name="l1206"><span class="linenum">1206</span></a>  <span class="comment">     * @param exception $ex</span>
<a name="l1207"><span class="linenum">1207</span></a>  <span class="comment">     * $uses exit</span>
<a name="l1208"><span class="linenum">1208</span></a>  <span class="comment">     */</span>
<a name="l1209"><span class="linenum">1209</span></a>      public function <a class="function" onClick="logFunction('exception_handler')" href="../_functions/exception_handler.html" onMouseOver="funcPopup(event,'exception_handler')">exception_handler</a>(<a class="var it341" onMouseOver="hilite(341)" onMouseOut="lolite()" onClick="logVariable('ex')" href="../_variables/ex.html">$ex</a>) {
<a name="l1210"><span class="linenum">1210</span></a>  <span class="comment">        // detect active db transactions, rollback and log as error</span>
<a name="l1211"><span class="linenum">1211</span></a>          <a class="function" onClick="logFunction('abort_all_db_transactions')" href="../_functions/abort_all_db_transactions.html" onMouseOver="funcPopup(event,'abort_all_db_transactions')">abort_all_db_transactions</a>();
<a name="l1212"><span class="linenum">1212</span></a>  
<a name="l1213"><span class="linenum">1213</span></a>  <span class="comment">        // some hacks might need a cleanup hook</span>
<a name="l1214"><span class="linenum">1214</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('session_cleanup')" href="../_functions/session_cleanup.html" onMouseOver="funcPopup(event,'session_cleanup')">session_cleanup</a>(<a class="var it341" onMouseOver="hilite(341)" onMouseOut="lolite()" onClick="logVariable('ex')" href="../_variables/ex.html">$ex</a>);
<a name="l1215"><span class="linenum">1215</span></a>  
<a name="l1216"><span class="linenum">1216</span></a>  <span class="comment">        // now let the plugin send the exception to client</span>
<a name="l1217"><span class="linenum">1217</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('send_error')" href="../_functions/send_error.html" onMouseOver="funcPopup(event,'send_error')">send_error</a>(<a class="var it341" onMouseOver="hilite(341)" onMouseOut="lolite()" onClick="logVariable('ex')" href="../_variables/ex.html">$ex</a>);
<a name="l1218"><span class="linenum">1218</span></a>  
<a name="l1219"><span class="linenum">1219</span></a>  <span class="comment">        // not much else we can do now, add some logging later</span>
<a name="l1220"><span class="linenum">1220</span></a>          exit(1);
<a name="l1221"><span class="linenum">1221</span></a>      }
<a name="l1222"><span class="linenum">1222</span></a>  
<a name="l1223"><span class="linenum">1223</span></a>      <span class="comment">/**</span>
<a name="l1224"><span class="linenum">1224</span></a>  <span class="comment">     * Future hook needed for emulated sessions.</span>
<a name="l1225"><span class="linenum">1225</span></a>  <span class="comment">     *</span>
<a name="l1226"><span class="linenum">1226</span></a>  <span class="comment">     * @param exception $exception null means normal termination, $exception received when WS call failed</span>
<a name="l1227"><span class="linenum">1227</span></a>  <span class="comment">     */</span>
<a name="l1228"><span class="linenum">1228</span></a>      protected function <a class="function" onClick="logFunction('session_cleanup')" href="../_functions/session_cleanup.html" onMouseOver="funcPopup(event,'session_cleanup')">session_cleanup</a>(<a class="var it2248" onMouseOver="hilite(2248)" onMouseOut="lolite()" onClick="logVariable('exception')" href="../_variables/exception.html">$exception</a>=null) {
<a name="l1229"><span class="linenum">1229</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authmethod')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/authmethod.html">authmethod</a> == <a class="constant" onClick="logConstant('WEBSERVICE_AUTHMETHOD_USERNAME')" href="../_constants/WEBSERVICE_AUTHMETHOD_USERNAME.html" onMouseOver="constPopup(event,'WEBSERVICE_AUTHMETHOD_USERNAME')">WEBSERVICE_AUTHMETHOD_USERNAME</a>) {
<a name="l1230"><span class="linenum">1230</span></a>  <span class="comment">            // nothing needs to be done, there is no persistent session</span>
<a name="l1231"><span class="linenum">1231</span></a>          } else {
<a name="l1232"><span class="linenum">1232</span></a>  <span class="comment">            // close emulated session if used</span>
<a name="l1233"><span class="linenum">1233</span></a>          }
<a name="l1234"><span class="linenum">1234</span></a>      }
<a name="l1235"><span class="linenum">1235</span></a>  
<a name="l1236"><span class="linenum">1236</span></a>      <span class="comment">/**</span>
<a name="l1237"><span class="linenum">1237</span></a>  <span class="comment">     * Fetches the function description from database,</span>
<a name="l1238"><span class="linenum">1238</span></a>  <span class="comment">     * verifies user is allowed to use this function and</span>
<a name="l1239"><span class="linenum">1239</span></a>  <span class="comment">     * loads all paremeters and return descriptions.</span>
<a name="l1240"><span class="linenum">1240</span></a>  <span class="comment">     */</span>
<a name="l1241"><span class="linenum">1241</span></a>      protected function <a class="function" onClick="logFunction('load_function_info')" href="../_functions/load_function_info.html" onMouseOver="funcPopup(event,'load_function_info')">load_function_info</a>() {
<a name="l1242"><span class="linenum">1242</span></a>          global <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it31" onMouseOver="hilite(31)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l1243"><span class="linenum">1243</span></a>  
<a name="l1244"><span class="linenum">1244</span></a>          if (empty(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('functionname')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/functionname.html">functionname</a>)) {
<a name="l1245"><span class="linenum">1245</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('invalid_parameter_exception')" href="../_classes/invalid_parameter_exception.html" onMouseOver="classPopup(event,'invalid_parameter_exception')">invalid_parameter_exception</a>('Missing function name');
<a name="l1246"><span class="linenum">1246</span></a>          }
<a name="l1247"><span class="linenum">1247</span></a>  
<a name="l1248"><span class="linenum">1248</span></a>  <span class="comment">        // function must exist</span>
<a name="l1249"><span class="linenum">1249</span></a>          <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a> = <a class="class" onClick="logClass('external_api')" href="../_classes/external_api.html" onMouseOver="classPopup(event,'external_api')">external_api</a>::<a class="function" onClick="logFunction('external_function_info')" href="../_functions/external_function_info.html" onMouseOver="funcPopup(event,'external_function_info')">external_function_info</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('functionname')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/functionname.html">functionname</a>);
<a name="l1250"><span class="linenum">1250</span></a>  
<a name="l1251"><span class="linenum">1251</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_serviceid')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/restricted_serviceid.html">restricted_serviceid</a>) {
<a name="l1252"><span class="linenum">1252</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array('sid1'=&gt;<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_serviceid')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/restricted_serviceid.html">restricted_serviceid</a>, 'sid2'=&gt;<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_serviceid')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/restricted_serviceid.html">restricted_serviceid</a>);
<a name="l1253"><span class="linenum">1253</span></a>              <a class="var it9279" onMouseOver="hilite(9279)" onMouseOut="lolite()" onClick="logVariable('wscond1')" href="../_variables/wscond1.html">$wscond1</a> = 'AND s.id = :sid1';
<a name="l1254"><span class="linenum">1254</span></a>              <a class="var it9280" onMouseOver="hilite(9280)" onMouseOut="lolite()" onClick="logVariable('wscond2')" href="../_variables/wscond2.html">$wscond2</a> = 'AND s.id = :sid2';
<a name="l1255"><span class="linenum">1255</span></a>          } else {
<a name="l1256"><span class="linenum">1256</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array();
<a name="l1257"><span class="linenum">1257</span></a>              <a class="var it9279" onMouseOver="hilite(9279)" onMouseOut="lolite()" onClick="logVariable('wscond1')" href="../_variables/wscond1.html">$wscond1</a> = '';
<a name="l1258"><span class="linenum">1258</span></a>              <a class="var it9280" onMouseOver="hilite(9280)" onMouseOut="lolite()" onClick="logVariable('wscond2')" href="../_variables/wscond2.html">$wscond2</a> = '';
<a name="l1259"><span class="linenum">1259</span></a>          }
<a name="l1260"><span class="linenum">1260</span></a>  
<a name="l1261"><span class="linenum">1261</span></a>  <span class="comment">        // now let's verify access control</span>
<a name="l1262"><span class="linenum">1262</span></a>  
<a name="l1263"><span class="linenum">1263</span></a>  <span class="comment">        // now make sure the function is listed in at least one service user is allowed to use</span>
<a name="l1264"><span class="linenum">1264</span></a>  <span class="comment">        // allow access only if:</span>
<a name="l1265"><span class="linenum">1265</span></a>  <span class="comment">        //  1/ entry in the external_services_users table if required</span>
<a name="l1266"><span class="linenum">1266</span></a>  <span class="comment">        //  2/ validuntil not reached</span>
<a name="l1267"><span class="linenum">1267</span></a>  <span class="comment">        //  3/ has capability if specified in service desc</span>
<a name="l1268"><span class="linenum">1268</span></a>  <span class="comment">        //  4/ iprestriction</span>
<a name="l1269"><span class="linenum">1269</span></a>  
<a name="l1270"><span class="linenum">1270</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT s.*, NULL AS iprestriction
<a name="l1271"><span class="linenum">1271</span></a>                    FROM {external_services} s
<a name="l1272"><span class="linenum">1272</span></a>                    JOIN {external_services_functions} sf <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (sf.externalserviceid = s.id AND s.restrictedusers = 0 AND sf.functionname = :name1)
<a name="l1273"><span class="linenum">1273</span></a>                   WHERE s.enabled = 1 <a class="var it9279" onMouseOver="hilite(9279)" onMouseOut="lolite()" onClick="logVariable('wscond1')" href="../_variables/wscond1.html">$wscond1</a>
<a name="l1274"><span class="linenum">1274</span></a>  
<a name="l1275"><span class="linenum">1275</span></a>                   UNION
<a name="l1276"><span class="linenum">1276</span></a>  
<a name="l1277"><span class="linenum">1277</span></a>                  SELECT s.*, su.iprestriction
<a name="l1278"><span class="linenum">1278</span></a>                    FROM {external_services} s
<a name="l1279"><span class="linenum">1279</span></a>                    JOIN {external_services_functions} sf <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (sf.externalserviceid = s.id AND s.restrictedusers = 1 AND sf.functionname = :name2)
<a name="l1280"><span class="linenum">1280</span></a>                    JOIN {external_services_users} su <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (su.externalserviceid = s.id AND su.userid = :userid)
<a name="l1281"><span class="linenum">1281</span></a>                   WHERE s.enabled = 1 AND (su.validuntil IS NULL OR su.validuntil &lt; :now) <a class="var it9280" onMouseOver="hilite(9280)" onMouseOut="lolite()" onClick="logVariable('wscond2')" href="../_variables/wscond2.html">$wscond2</a>&quot;;
<a name="l1282"><span class="linenum">1282</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, array('userid'=&gt;<a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'name1'=&gt;<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('name')" class="var it44241" onMouseOver="hilite(44241)" onMouseOut="lolite()" href="../_variables/name.html">name</a>, 'name2'=&gt;<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('name')" class="var it44241" onMouseOver="hilite(44241)" onMouseOut="lolite()" href="../_variables/name.html">name</a>, 'now'=&gt;<a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()));
<a name="l1283"><span class="linenum">1283</span></a>  
<a name="l1284"><span class="linenum">1284</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l1285"><span class="linenum">1285</span></a>  <span class="comment">        // now make sure user may access at least one service</span>
<a name="l1286"><span class="linenum">1286</span></a>          <a class="var it9281" onMouseOver="hilite(9281)" onMouseOut="lolite()" onClick="logVariable('remoteaddr')" href="../_variables/remoteaddr.html">$remoteaddr</a> = <a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>();
<a name="l1287"><span class="linenum">1287</span></a>          <a class="var it778" onMouseOver="hilite(778)" onMouseOut="lolite()" onClick="logVariable('allowed')" href="../_variables/allowed.html">$allowed</a> = false;
<a name="l1288"><span class="linenum">1288</span></a>          foreach (<a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> as <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>) {
<a name="l1289"><span class="linenum">1289</span></a>              if (<a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('requiredcapability')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/requiredcapability.html">requiredcapability</a> and !<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(<a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('requiredcapability')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/requiredcapability.html">requiredcapability</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_context')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/restricted_context.html">restricted_context</a>)) {
<a name="l1290"><span class="linenum">1290</span></a>                  continue; <span class="comment">// cap required, sorry</span>
<a name="l1291"><span class="linenum">1291</span></a>              }
<a name="l1292"><span class="linenum">1292</span></a>              if (<a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a> and !<a class="function" onClick="logFunction('address_in_subnet')" href="../_functions/address_in_subnet.html" onMouseOver="funcPopup(event,'address_in_subnet')">address_in_subnet</a>(<a class="var it9281" onMouseOver="hilite(9281)" onMouseOut="lolite()" onClick="logVariable('remoteaddr')" href="../_variables/remoteaddr.html">$remoteaddr</a>, <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a>)) {
<a name="l1293"><span class="linenum">1293</span></a>                  continue; <span class="comment">// wrong request source ip, sorry</span>
<a name="l1294"><span class="linenum">1294</span></a>              }
<a name="l1295"><span class="linenum">1295</span></a>              <a class="var it778" onMouseOver="hilite(778)" onMouseOut="lolite()" onClick="logVariable('allowed')" href="../_variables/allowed.html">$allowed</a> = true;
<a name="l1296"><span class="linenum">1296</span></a>              break; <span class="comment">// one service is enough, no need to continue</span>
<a name="l1297"><span class="linenum">1297</span></a>          }
<a name="l1298"><span class="linenum">1298</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l1299"><span class="linenum">1299</span></a>          if (!<a class="var it778" onMouseOver="hilite(778)" onMouseOut="lolite()" onClick="logVariable('allowed')" href="../_variables/allowed.html">$allowed</a>) {
<a name="l1300"><span class="linenum">1300</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>(
<a name="l1301"><span class="linenum">1301</span></a>                      'Access to the function '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('functionname')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/functionname.html">functionname</a>.'() is not allowed.
<a name="l1302"><span class="linenum">1302</span></a>                       There could be multiple reasons for this:
<a name="l1303"><span class="linenum">1303</span></a>                       1. The service linked to the user token does not contain the function.
<a name="l1304"><span class="linenum">1304</span></a>                       2. The service is user-restricted and the user is not listed.
<a name="l1305"><span class="linenum">1305</span></a>                       3. The service is IP-restricted and the user IP is not listed.
<a name="l1306"><span class="linenum">1306</span></a>                       4. The service is time-restricted and the time has expired.
<a name="l1307"><span class="linenum">1307</span></a>                       5. The token is time-restricted and the time has expired.
<a name="l1308"><span class="linenum">1308</span></a>                       6. The service requires a specific capability which the user does not have.
<a name="l1309"><span class="linenum">1309</span></a>                       7. The function is called with username/password (no user token is sent)
<a name="l1310"><span class="linenum">1310</span></a>                       and none of the services has the function to allow the user.
<a name="l1311"><span class="linenum">1311</span></a>                       These settings can be found in Administration &gt; Site administration
<a name="l1312"><span class="linenum">1312</span></a>                       &gt; Plugins &gt; Web services &gt; External services and Manage tokens.');
<a name="l1313"><span class="linenum">1313</span></a>          }
<a name="l1314"><span class="linenum">1314</span></a>  
<a name="l1315"><span class="linenum">1315</span></a>  <span class="comment">        // we have all we need now</span>
<a name="l1316"><span class="linenum">1316</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('function')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/function.html">function</a> = <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>;
<a name="l1317"><span class="linenum">1317</span></a>      }
<a name="l1318"><span class="linenum">1318</span></a>  
<a name="l1319"><span class="linenum">1319</span></a>      <span class="comment">/**</span>
<a name="l1320"><span class="linenum">1320</span></a>  <span class="comment">     * Execute previously loaded function using parameters parsed from the request data.</span>
<a name="l1321"><span class="linenum">1321</span></a>  <span class="comment">     */</span>
<a name="l1322"><span class="linenum">1322</span></a>      protected function <a class="function" onClick="logFunction('execute')" href="../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>() {
<a name="l1323"><span class="linenum">1323</span></a>  <span class="comment">        // validate params, this also sorts the params properly, we need the correct order in the next part</span>
<a name="l1324"><span class="linenum">1324</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('call_user_func')" href="../_functions/call_user_func.html" onMouseOver="phpfuncPopup(event,'call_user_func')">call_user_func</a>(array(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('function')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/function.html">function</a>-&gt;classname, 'validate_parameters'), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('function')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/function.html">function</a>-&gt;parameters_desc, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('parameters')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/parameters.html">parameters</a>);
<a name="l1325"><span class="linenum">1325</span></a>  
<a name="l1326"><span class="linenum">1326</span></a>  <span class="comment">        // execute - yay!</span>
<a name="l1327"><span class="linenum">1327</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('returns')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/returns.html">returns</a> = <a class="phpfunction" onClick="logFunction('call_user_func_array')" href="../_functions/call_user_func_array.html" onMouseOver="phpfuncPopup(event,'call_user_func_array')">call_user_func_array</a>(array(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('function')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/function.html">function</a>-&gt;classname, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('function')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/function.html">function</a>-&gt;methodname), <a class="phpfunction" onClick="logFunction('array_values')" href="../_functions/array_values.html" onMouseOver="phpfuncPopup(event,'array_values')">array_values</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>));
<a name="l1328"><span class="linenum">1328</span></a>      }
<a name="l1329"><span class="linenum">1329</span></a>  
<a name="l1330"><span class="linenum">1330</span></a>      <span class="comment">/**</span>
<a name="l1331"><span class="linenum">1331</span></a>  <span class="comment">     * Load the virtual class needed for the web service.</span>
<a name="l1332"><span class="linenum">1332</span></a>  <span class="comment">     *</span>
<a name="l1333"><span class="linenum">1333</span></a>  <span class="comment">     * Initialises the virtual class that contains the web service functions that the user is allowed to use.</span>
<a name="l1334"><span class="linenum">1334</span></a>  <span class="comment">     * The web service function will be available if the user:</span>
<a name="l1335"><span class="linenum">1335</span></a>  <span class="comment">     * - is validly registered in the external_services_users table.</span>
<a name="l1336"><span class="linenum">1336</span></a>  <span class="comment">     * - has the required capability.</span>
<a name="l1337"><span class="linenum">1337</span></a>  <span class="comment">     * - meets the IP restriction requirement.</span>
<a name="l1338"><span class="linenum">1338</span></a>  <span class="comment">     * This virtual class can be used by web service protocols such as SOAP, especially when generating WSDL.</span>
<a name="l1339"><span class="linenum">1339</span></a>  <span class="comment">     */</span>
<a name="l1340"><span class="linenum">1340</span></a>      protected function <a class="function" onClick="logFunction('init_service_class')" href="../_functions/init_service_class.html" onMouseOver="funcPopup(event,'init_service_class')">init_service_class</a>() {
<a name="l1341"><span class="linenum">1341</span></a>          global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1342"><span class="linenum">1342</span></a>  
<a name="l1343"><span class="linenum">1343</span></a>  <span class="comment">        // Initialise service methods and struct classes.</span>
<a name="l1344"><span class="linenum">1344</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('servicemethods')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/servicemethods.html">servicemethods</a> = array();
<a name="l1345"><span class="linenum">1345</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('servicestructs')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/servicestructs.html">servicestructs</a> = array();
<a name="l1346"><span class="linenum">1346</span></a>  
<a name="l1347"><span class="linenum">1347</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array();
<a name="l1348"><span class="linenum">1348</span></a>          <a class="var it9279" onMouseOver="hilite(9279)" onMouseOut="lolite()" onClick="logVariable('wscond1')" href="../_variables/wscond1.html">$wscond1</a> = '';
<a name="l1349"><span class="linenum">1349</span></a>          <a class="var it9280" onMouseOver="hilite(9280)" onMouseOut="lolite()" onClick="logVariable('wscond2')" href="../_variables/wscond2.html">$wscond2</a> = '';
<a name="l1350"><span class="linenum">1350</span></a>          if (<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_serviceid')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/restricted_serviceid.html">restricted_serviceid</a>) {
<a name="l1351"><span class="linenum">1351</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array('sid1' =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_serviceid')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/restricted_serviceid.html">restricted_serviceid</a>, 'sid2' =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_serviceid')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/restricted_serviceid.html">restricted_serviceid</a>);
<a name="l1352"><span class="linenum">1352</span></a>              <a class="var it9279" onMouseOver="hilite(9279)" onMouseOut="lolite()" onClick="logVariable('wscond1')" href="../_variables/wscond1.html">$wscond1</a> = 'AND s.id = :sid1';
<a name="l1353"><span class="linenum">1353</span></a>              <a class="var it9280" onMouseOver="hilite(9280)" onMouseOut="lolite()" onClick="logVariable('wscond2')" href="../_variables/wscond2.html">$wscond2</a> = 'AND s.id = :sid2';
<a name="l1354"><span class="linenum">1354</span></a>          }
<a name="l1355"><span class="linenum">1355</span></a>  
<a name="l1356"><span class="linenum">1356</span></a>          <a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT s.*, NULL AS iprestriction
<a name="l1357"><span class="linenum">1357</span></a>                    FROM {external_services} s
<a name="l1358"><span class="linenum">1358</span></a>                    JOIN {external_services_functions} sf <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (sf.externalserviceid = s.id AND s.restrictedusers = 0)
<a name="l1359"><span class="linenum">1359</span></a>                   WHERE s.enabled = 1 <a class="var it9279" onMouseOver="hilite(9279)" onMouseOut="lolite()" onClick="logVariable('wscond1')" href="../_variables/wscond1.html">$wscond1</a>
<a name="l1360"><span class="linenum">1360</span></a>  
<a name="l1361"><span class="linenum">1361</span></a>                   UNION
<a name="l1362"><span class="linenum">1362</span></a>  
<a name="l1363"><span class="linenum">1363</span></a>                  SELECT s.*, su.iprestriction
<a name="l1364"><span class="linenum">1364</span></a>                    FROM {external_services} s
<a name="l1365"><span class="linenum">1365</span></a>                    JOIN {external_services_functions} sf <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (sf.externalserviceid = s.id AND s.restrictedusers = 1)
<a name="l1366"><span class="linenum">1366</span></a>                    JOIN {external_services_users} su <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (su.externalserviceid = s.id AND su.userid = :userid)
<a name="l1367"><span class="linenum">1367</span></a>                   WHERE s.enabled = 1 AND (su.validuntil IS NULL OR su.validuntil &lt; :now) <a class="var it9280" onMouseOver="hilite(9280)" onMouseOut="lolite()" onClick="logVariable('wscond2')" href="../_variables/wscond2.html">$wscond2</a>&quot;;
<a name="l1368"><span class="linenum">1368</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, array('userid' =&gt; <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it42989" onMouseOver="hilite(42989)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'now' =&gt; <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()));
<a name="l1369"><span class="linenum">1369</span></a>  
<a name="l1370"><span class="linenum">1370</span></a>          <a class="var it9257" onMouseOver="hilite(9257)" onMouseOut="lolite()" onClick="logVariable('serviceids')" href="../_variables/serviceids.html">$serviceids</a> = array();
<a name="l1371"><span class="linenum">1371</span></a>          <a class="var it9281" onMouseOver="hilite(9281)" onMouseOut="lolite()" onClick="logVariable('remoteaddr')" href="../_variables/remoteaddr.html">$remoteaddr</a> = <a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>();
<a name="l1372"><span class="linenum">1372</span></a>  
<a name="l1373"><span class="linenum">1373</span></a>  <span class="comment">        // Query list of external services for the user.</span>
<a name="l1374"><span class="linenum">1374</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> = <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it64" onMouseOver="hilite(64)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l1375"><span class="linenum">1375</span></a>  
<a name="l1376"><span class="linenum">1376</span></a>  <span class="comment">        // Check which service ID to include.</span>
<a name="l1377"><span class="linenum">1377</span></a>          foreach (<a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> as <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>) {
<a name="l1378"><span class="linenum">1378</span></a>              if (isset(<a class="var it9257" onMouseOver="hilite(9257)" onMouseOut="lolite()" onClick="logVariable('serviceids')" href="../_variables/serviceids.html">$serviceids</a>[<a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('id')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/id.html">id</a>])) {
<a name="l1379"><span class="linenum">1379</span></a>                  continue; <span class="comment">// Service already added.</span>
<a name="l1380"><span class="linenum">1380</span></a>              }
<a name="l1381"><span class="linenum">1381</span></a>              if (<a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('requiredcapability')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/requiredcapability.html">requiredcapability</a> and !<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(<a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('requiredcapability')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/requiredcapability.html">requiredcapability</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_context')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/restricted_context.html">restricted_context</a>)) {
<a name="l1382"><span class="linenum">1382</span></a>                  continue; <span class="comment">// Cap required, sorry.</span>
<a name="l1383"><span class="linenum">1383</span></a>              }
<a name="l1384"><span class="linenum">1384</span></a>              if (<a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a> and !<a class="function" onClick="logFunction('address_in_subnet')" href="../_functions/address_in_subnet.html" onMouseOver="funcPopup(event,'address_in_subnet')">address_in_subnet</a>(<a class="var it9281" onMouseOver="hilite(9281)" onMouseOut="lolite()" onClick="logVariable('remoteaddr')" href="../_variables/remoteaddr.html">$remoteaddr</a>, <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a>)) {
<a name="l1385"><span class="linenum">1385</span></a>                  continue; <span class="comment">// Wrong request source ip, sorry.</span>
<a name="l1386"><span class="linenum">1386</span></a>              }
<a name="l1387"><span class="linenum">1387</span></a>              <a class="var it9257" onMouseOver="hilite(9257)" onMouseOut="lolite()" onClick="logVariable('serviceids')" href="../_variables/serviceids.html">$serviceids</a>[<a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('id')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="var it898" onMouseOver="hilite(898)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('id')" class="var it43730" onMouseOver="hilite(43730)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l1388"><span class="linenum">1388</span></a>          }
<a name="l1389"><span class="linenum">1389</span></a>          <a class="var it83" onMouseOver="hilite(83)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l1390"><span class="linenum">1390</span></a>  
<a name="l1391"><span class="linenum">1391</span></a>  <span class="comment">        // Generate the virtual class name.</span>
<a name="l1392"><span class="linenum">1392</span></a>          <a class="var it202" onMouseOver="hilite(202)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a> = 'webservices_virtual_class_000000';
<a name="l1393"><span class="linenum">1393</span></a>          while (<a class="phpfunction" onClick="logFunction('class_exists')" href="../_functions/class_exists.html" onMouseOver="phpfuncPopup(event,'class_exists')">class_exists</a>(<a class="var it202" onMouseOver="hilite(202)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a>)) {
<a name="l1394"><span class="linenum">1394</span></a>              <a class="var it202" onMouseOver="hilite(202)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a>++;
<a name="l1395"><span class="linenum">1395</span></a>          }
<a name="l1396"><span class="linenum">1396</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('serviceclass')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/serviceclass.html">serviceclass</a> = <a class="var it202" onMouseOver="hilite(202)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a>;
<a name="l1397"><span class="linenum">1397</span></a>  
<a name="l1398"><span class="linenum">1398</span></a>  <span class="comment">        // Get the list of all available external functions.</span>
<a name="l1399"><span class="linenum">1399</span></a>          <a class="var it9282" onMouseOver="hilite(9282)" onMouseOut="lolite()" onClick="logVariable('wsmanager')" href="../_variables/wsmanager.html">$wsmanager</a> = <span class="keyword">new </span><a class="class" onClick="logClass('webservice')" href="../_classes/webservice.html" onMouseOver="classPopup(event,'webservice')">webservice</a>();
<a name="l1400"><span class="linenum">1400</span></a>          <a class="var it302" onMouseOver="hilite(302)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a> = <a class="var it9282" onMouseOver="hilite(9282)" onMouseOut="lolite()" onClick="logVariable('wsmanager')" href="../_variables/wsmanager.html">$wsmanager</a>-&gt;<a class="function" onClick="logFunction('get_external_functions')" href="../_functions/get_external_functions.html" onMouseOver="funcPopup(event,'get_external_functions')">get_external_functions</a>(<a class="var it9257" onMouseOver="hilite(9257)" onMouseOut="lolite()" onClick="logVariable('serviceids')" href="../_variables/serviceids.html">$serviceids</a>);
<a name="l1401"><span class="linenum">1401</span></a>  
<a name="l1402"><span class="linenum">1402</span></a>  <span class="comment">        // Generate code for the virtual methods for this web service.</span>
<a name="l1403"><span class="linenum">1403</span></a>          <a class="var it6183" onMouseOver="hilite(6183)" onMouseOut="lolite()" onClick="logVariable('methods')" href="../_variables/methods.html">$methods</a> = '';
<a name="l1404"><span class="linenum">1404</span></a>          foreach (<a class="var it302" onMouseOver="hilite(302)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a> as <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>) {
<a name="l1405"><span class="linenum">1405</span></a>              <a class="var it6183" onMouseOver="hilite(6183)" onMouseOut="lolite()" onClick="logVariable('methods')" href="../_variables/methods.html">$methods</a> .= <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_virtual_method_code')" href="../_functions/get_virtual_method_code.html" onMouseOver="funcPopup(event,'get_virtual_method_code')">get_virtual_method_code</a>(<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>);
<a name="l1406"><span class="linenum">1406</span></a>          }
<a name="l1407"><span class="linenum">1407</span></a>  
<a name="l1408"><span class="linenum">1408</span></a>          <a class="var it1960" onMouseOver="hilite(1960)" onMouseOut="lolite()" onClick="logVariable('code')" href="../_variables/code.html">$code</a> = &lt;&lt;&lt;EOD
<a name="l1409"><span class="linenum">1409</span></a>  <span class="comment">/**</span>
<a name="l1410"><span class="linenum">1410</span></a>  <span class="comment"> * Virtual class web services for user id $USER-&gt;id in context {$this-&gt;restricted_context-&gt;id}.</span>
<a name="l1411"><span class="linenum">1411</span></a>  <span class="comment"> */</span>
<a name="l1412"><span class="linenum">1412</span></a>  class <a class="var it202" onMouseOver="hilite(202)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a> {
<a name="l1413"><span class="linenum">1413</span></a>  <a class="var it6183" onMouseOver="hilite(6183)" onMouseOut="lolite()" onClick="logVariable('methods')" href="../_variables/methods.html">$methods</a>
<a name="l1414"><span class="linenum">1414</span></a>  }
<a name="l1415"><span class="linenum">1415</span></a>  EOD;
<a name="l1416"><span class="linenum">1416</span></a>  <span class="comment">        // Load the virtual class definition into memory.</span>
<a name="l1417"><span class="linenum">1417</span></a>          eval(<a class="var it1960" onMouseOver="hilite(1960)" onMouseOut="lolite()" onClick="logVariable('code')" href="../_variables/code.html">$code</a>);
<a name="l1418"><span class="linenum">1418</span></a>      }
<a name="l1419"><span class="linenum">1419</span></a>  
<a name="l1420"><span class="linenum">1420</span></a>      <span class="comment">/**</span>
<a name="l1421"><span class="linenum">1421</span></a>  <span class="comment">     * Generates a struct class.</span>
<a name="l1422"><span class="linenum">1422</span></a>  <span class="comment">     *</span>
<a name="l1423"><span class="linenum">1423</span></a>  <span class="comment">     * @param external_single_structure $structdesc The basis of the struct class to be generated.</span>
<a name="l1424"><span class="linenum">1424</span></a>  <span class="comment">     * @return string The class name of the generated struct class.</span>
<a name="l1425"><span class="linenum">1425</span></a>  <span class="comment">     */</span>
<a name="l1426"><span class="linenum">1426</span></a>      protected function <a class="function" onClick="logFunction('generate_simple_struct_class')" href="../_functions/generate_simple_struct_class.html" onMouseOver="funcPopup(event,'generate_simple_struct_class')">generate_simple_struct_class</a>(external_single_structure <a class="var it9283" onMouseOver="hilite(9283)" onMouseOut="lolite()" onClick="logVariable('structdesc')" href="../_variables/structdesc.html">$structdesc</a>) {
<a name="l1427"><span class="linenum">1427</span></a>          global <a class="var it354" onMouseOver="hilite(354)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>;
<a name="l1428"><span class="linenum">1428</span></a>  
<a name="l1429"><span class="linenum">1429</span></a>          <a class="var it9284" onMouseOver="hilite(9284)" onMouseOut="lolite()" onClick="logVariable('propeties')" href="../_variables/propeties.html">$propeties</a> = array();
<a name="l1430"><span class="linenum">1430</span></a>          <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a> = array();
<a name="l1431"><span class="linenum">1431</span></a>          foreach (<a class="var it9283" onMouseOver="hilite(9283)" onMouseOut="lolite()" onClick="logVariable('structdesc')" href="../_variables/structdesc.html">$structdesc</a>-&gt;<a onClick="logVariable('keys')" class="var it45429" onMouseOver="hilite(45429)" onMouseOut="lolite()" href="../_variables/keys.html">keys</a> as <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> =&gt; <a class="var it9285" onMouseOver="hilite(9285)" onMouseOut="lolite()" onClick="logVariable('fieldsdesc')" href="../_variables/fieldsdesc.html">$fieldsdesc</a>) {
<a name="l1432"><span class="linenum">1432</span></a>              <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_phpdoc_type')" href="../_functions/get_phpdoc_type.html" onMouseOver="funcPopup(event,'get_phpdoc_type')">get_phpdoc_type</a>(<a class="var it9285" onMouseOver="hilite(9285)" onMouseOut="lolite()" onClick="logVariable('fieldsdesc')" href="../_variables/fieldsdesc.html">$fieldsdesc</a>);
<a name="l1433"><span class="linenum">1433</span></a>              <a class="var it9286" onMouseOver="hilite(9286)" onMouseOut="lolite()" onClick="logVariable('propertytype')" href="../_variables/propertytype.html">$propertytype</a> = array('type' =&gt; <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>);
<a name="l1434"><span class="linenum">1434</span></a>              if (empty(<a class="var it9285" onMouseOver="hilite(9285)" onMouseOut="lolite()" onClick="logVariable('fieldsdesc')" href="../_variables/fieldsdesc.html">$fieldsdesc</a>-&gt;<a onClick="logVariable('allownull')" class="var it45430" onMouseOver="hilite(45430)" onMouseOut="lolite()" href="../_variables/allownull.html">allownull</a>) || <a class="var it9285" onMouseOver="hilite(9285)" onMouseOut="lolite()" onClick="logVariable('fieldsdesc')" href="../_variables/fieldsdesc.html">$fieldsdesc</a>-&gt;<a onClick="logVariable('allownull')" class="var it45430" onMouseOver="hilite(45430)" onMouseOut="lolite()" href="../_variables/allownull.html">allownull</a> == <a class="constant" onClick="logConstant('NULL_ALLOWED')" href="../_constants/NULL_ALLOWED.html" onMouseOver="constPopup(event,'NULL_ALLOWED')">NULL_ALLOWED</a>) {
<a name="l1435"><span class="linenum">1435</span></a>                  <a class="var it9286" onMouseOver="hilite(9286)" onMouseOut="lolite()" onClick="logVariable('propertytype')" href="../_variables/propertytype.html">$propertytype</a>['nillable'] = true;
<a name="l1436"><span class="linenum">1436</span></a>              }
<a name="l1437"><span class="linenum">1437</span></a>              <a class="var it9284" onMouseOver="hilite(9284)" onMouseOut="lolite()" onClick="logVariable('propeties')" href="../_variables/propeties.html">$propeties</a>[<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>] = <a class="var it9286" onMouseOver="hilite(9286)" onMouseOut="lolite()" onClick="logVariable('propertytype')" href="../_variables/propertytype.html">$propertytype</a>;
<a name="l1438"><span class="linenum">1438</span></a>              <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>[] = '    <span class="comment">/** @var ' . $type . ' $' . $name . '*/</span>';
<a name="l1439"><span class="linenum">1439</span></a>              <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>[] = '    public $' . <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> .';';
<a name="l1440"><span class="linenum">1440</span></a>          }
<a name="l1441"><span class="linenum">1441</span></a>          <a class="var it9288" onMouseOver="hilite(9288)" onMouseOut="lolite()" onClick="logVariable('fieldsstr')" href="../_variables/fieldsstr.html">$fieldsstr</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(&quot;\n&quot;, <a class="var it89" onMouseOver="hilite(89)" onMouseOut="lolite()" onClick="logVariable('fields')" href="../_variables/fields.html">$fields</a>);
<a name="l1442"><span class="linenum">1442</span></a>  
<a name="l1443"><span class="linenum">1443</span></a>  <span class="comment">        // We do this after the call to get_phpdoc_type() to avoid duplicate class creation.</span>
<a name="l1444"><span class="linenum">1444</span></a>          <a class="var it202" onMouseOver="hilite(202)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a> = 'webservices_struct_class_000000';
<a name="l1445"><span class="linenum">1445</span></a>          while (<a class="phpfunction" onClick="logFunction('class_exists')" href="../_functions/class_exists.html" onMouseOver="phpfuncPopup(event,'class_exists')">class_exists</a>(<a class="var it202" onMouseOver="hilite(202)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a>)) {
<a name="l1446"><span class="linenum">1446</span></a>              <a class="var it202" onMouseOver="hilite(202)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a>++;
<a name="l1447"><span class="linenum">1447</span></a>          }
<a name="l1448"><span class="linenum">1448</span></a>          <a class="var it1960" onMouseOver="hilite(1960)" onMouseOut="lolite()" onClick="logVariable('code')" href="../_variables/code.html">$code</a> = &lt;&lt;&lt;EOD
<a name="l1449"><span class="linenum">1449</span></a>  <span class="comment">/**</span>
<a name="l1450"><span class="linenum">1450</span></a>  <span class="comment"> * Virtual struct class for web services for user id $USER-&gt;id in context {$this-&gt;restricted_context-&gt;id}.</span>
<a name="l1451"><span class="linenum">1451</span></a>  <span class="comment"> */</span>
<a name="l1452"><span class="linenum">1452</span></a>  class <a class="var it202" onMouseOver="hilite(202)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a> {
<a name="l1453"><span class="linenum">1453</span></a>  <a class="var it9288" onMouseOver="hilite(9288)" onMouseOut="lolite()" onClick="logVariable('fieldsstr')" href="../_variables/fieldsstr.html">$fieldsstr</a>
<a name="l1454"><span class="linenum">1454</span></a>  }
<a name="l1455"><span class="linenum">1455</span></a>  EOD;
<a name="l1456"><span class="linenum">1456</span></a>  <span class="comment">        // Load into memory.</span>
<a name="l1457"><span class="linenum">1457</span></a>          eval(<a class="var it1960" onMouseOver="hilite(1960)" onMouseOut="lolite()" onClick="logVariable('code')" href="../_variables/code.html">$code</a>);
<a name="l1458"><span class="linenum">1458</span></a>  
<a name="l1459"><span class="linenum">1459</span></a>  <span class="comment">        // Prepare struct info.</span>
<a name="l1460"><span class="linenum">1460</span></a>          <a class="var it9289" onMouseOver="hilite(9289)" onMouseOut="lolite()" onClick="logVariable('structinfo')" href="../_variables/structinfo.html">$structinfo</a> = new stdClass();
<a name="l1461"><span class="linenum">1461</span></a>          <a class="var it9289" onMouseOver="hilite(9289)" onMouseOut="lolite()" onClick="logVariable('structinfo')" href="../_variables/structinfo.html">$structinfo</a>-&gt;<a onClick="logVariable('classname')" class="var it45128" onMouseOver="hilite(45128)" onMouseOut="lolite()" href="../_variables/classname.html">classname</a> = <a class="var it202" onMouseOver="hilite(202)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a>;
<a name="l1462"><span class="linenum">1462</span></a>          <a class="var it9289" onMouseOver="hilite(9289)" onMouseOut="lolite()" onClick="logVariable('structinfo')" href="../_variables/structinfo.html">$structinfo</a>-&gt;<a onClick="logVariable('properties')" class="var it45128" onMouseOver="hilite(45128)" onMouseOut="lolite()" href="../_variables/properties.html">properties</a> = <a class="var it9284" onMouseOver="hilite(9284)" onMouseOut="lolite()" onClick="logVariable('propeties')" href="../_variables/propeties.html">$propeties</a>;
<a name="l1463"><span class="linenum">1463</span></a>  <span class="comment">        // Add the struct info the the list of service struct classes.</span>
<a name="l1464"><span class="linenum">1464</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('servicestructs')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/servicestructs.html">servicestructs</a>[] = <a class="var it9289" onMouseOver="hilite(9289)" onMouseOut="lolite()" onClick="logVariable('structinfo')" href="../_variables/structinfo.html">$structinfo</a>;
<a name="l1465"><span class="linenum">1465</span></a>  
<a name="l1466"><span class="linenum">1466</span></a>          return <a class="var it202" onMouseOver="hilite(202)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a>;
<a name="l1467"><span class="linenum">1467</span></a>      }
<a name="l1468"><span class="linenum">1468</span></a>  
<a name="l1469"><span class="linenum">1469</span></a>      <span class="comment">/**</span>
<a name="l1470"><span class="linenum">1470</span></a>  <span class="comment">     * Returns a virtual method code for a web service function.</span>
<a name="l1471"><span class="linenum">1471</span></a>  <span class="comment">     *</span>
<a name="l1472"><span class="linenum">1472</span></a>  <span class="comment">     * @param stdClass $function a record from external_function</span>
<a name="l1473"><span class="linenum">1473</span></a>  <span class="comment">     * @return string The PHP code of the virtual method.</span>
<a name="l1474"><span class="linenum">1474</span></a>  <span class="comment">     * @throws coding_exception</span>
<a name="l1475"><span class="linenum">1475</span></a>  <span class="comment">     * @throws moodle_exception</span>
<a name="l1476"><span class="linenum">1476</span></a>  <span class="comment">     */</span>
<a name="l1477"><span class="linenum">1477</span></a>      protected function <a class="function" onClick="logFunction('get_virtual_method_code')" href="../_functions/get_virtual_method_code.html" onMouseOver="funcPopup(event,'get_virtual_method_code')">get_virtual_method_code</a>(<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>) {
<a name="l1478"><span class="linenum">1478</span></a>          <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a> = <a class="class" onClick="logClass('external_api')" href="../_classes/external_api.html" onMouseOver="classPopup(event,'external_api')">external_api</a>::<a class="function" onClick="logFunction('external_function_info')" href="../_functions/external_function_info.html" onMouseOver="funcPopup(event,'external_function_info')">external_function_info</a>(<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>);
<a name="l1479"><span class="linenum">1479</span></a>  
<a name="l1480"><span class="linenum">1480</span></a>  <span class="comment">        // Parameters and their defaults for the method signature.</span>
<a name="l1481"><span class="linenum">1481</span></a>          <a class="var it9290" onMouseOver="hilite(9290)" onMouseOut="lolite()" onClick="logVariable('paramanddefaults')" href="../_variables/paramanddefaults.html">$paramanddefaults</a> = array();
<a name="l1482"><span class="linenum">1482</span></a>  <span class="comment">        // Parameters for external lib call.</span>
<a name="l1483"><span class="linenum">1483</span></a>          <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array();
<a name="l1484"><span class="linenum">1484</span></a>          <a class="var it9291" onMouseOver="hilite(9291)" onMouseOut="lolite()" onClick="logVariable('paramdesc')" href="../_variables/paramdesc.html">$paramdesc</a> = array();
<a name="l1485"><span class="linenum">1485</span></a>  <span class="comment">        // The method's input parameters and their respective types.</span>
<a name="l1486"><span class="linenum">1486</span></a>          <a class="var it5661" onMouseOver="hilite(5661)" onMouseOut="lolite()" onClick="logVariable('inputparams')" href="../_variables/inputparams.html">$inputparams</a> = array();
<a name="l1487"><span class="linenum">1487</span></a>  <span class="comment">        // The method's output parameters and their respective types.</span>
<a name="l1488"><span class="linenum">1488</span></a>          <a class="var it9292" onMouseOver="hilite(9292)" onMouseOut="lolite()" onClick="logVariable('outputparams')" href="../_variables/outputparams.html">$outputparams</a> = array();
<a name="l1489"><span class="linenum">1489</span></a>  
<a name="l1490"><span class="linenum">1490</span></a>          foreach (<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('parameters_desc')" class="var it44241" onMouseOver="hilite(44241)" onMouseOut="lolite()" href="../_variables/parameters_desc.html">parameters_desc</a>-&gt;keys as <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> =&gt; <a class="var it9293" onMouseOver="hilite(9293)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>) {
<a name="l1491"><span class="linenum">1491</span></a>              <a class="var it334" onMouseOver="hilite(334)" onMouseOut="lolite()" onClick="logVariable('param')" href="../_variables/param.html">$param</a> = '$' . <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>;
<a name="l1492"><span class="linenum">1492</span></a>              <a class="var it9295" onMouseOver="hilite(9295)" onMouseOut="lolite()" onClick="logVariable('paramanddefault')" href="../_variables/paramanddefault.html">$paramanddefault</a> = <a class="var it334" onMouseOver="hilite(334)" onMouseOut="lolite()" onClick="logVariable('param')" href="../_variables/param.html">$param</a>;
<a name="l1493"><span class="linenum">1493</span></a>              if (<a class="var it9293" onMouseOver="hilite(9293)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('required')" class="var it45431" onMouseOver="hilite(45431)" onMouseOut="lolite()" href="../_variables/required.html">required</a> == <a class="constant" onClick="logConstant('VALUE_OPTIONAL')" href="../_constants/VALUE_OPTIONAL.html" onMouseOver="constPopup(event,'VALUE_OPTIONAL')">VALUE_OPTIONAL</a>) {
<a name="l1494"><span class="linenum">1494</span></a>  <span class="comment">                // It does not make sense to declare a parameter VALUE_OPTIONAL. VALUE_OPTIONAL is used only for array/object key.</span>
<a name="l1495"><span class="linenum">1495</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('erroroptionalparamarray', 'webservice', '', <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>);
<a name="l1496"><span class="linenum">1496</span></a>              } else if (<a class="var it9293" onMouseOver="hilite(9293)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('required')" class="var it45431" onMouseOver="hilite(45431)" onMouseOut="lolite()" href="../_variables/required.html">required</a> == <a class="constant" onClick="logConstant('VALUE_DEFAULT')" href="../_constants/VALUE_DEFAULT.html" onMouseOver="constPopup(event,'VALUE_DEFAULT')">VALUE_DEFAULT</a>) {
<a name="l1497"><span class="linenum">1497</span></a>  <span class="comment">                // Need to generate the default, if there is any.</span>
<a name="l1498"><span class="linenum">1498</span></a>                  if (<a class="var it9293" onMouseOver="hilite(9293)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a> instanceof external_value) {
<a name="l1499"><span class="linenum">1499</span></a>                      if (<a class="var it9293" onMouseOver="hilite(9293)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('default')" class="var it45431" onMouseOver="hilite(45431)" onMouseOut="lolite()" href="../_variables/default.html">default</a> === null) {
<a name="l1500"><span class="linenum">1500</span></a>                          <a class="var it9295" onMouseOver="hilite(9295)" onMouseOut="lolite()" onClick="logVariable('paramanddefault')" href="../_variables/paramanddefault.html">$paramanddefault</a> .= ' = null';
<a name="l1501"><span class="linenum">1501</span></a>                      } else {
<a name="l1502"><span class="linenum">1502</span></a>                          switch (<a class="var it9293" onMouseOver="hilite(9293)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('type')" class="var it45431" onMouseOver="hilite(45431)" onMouseOut="lolite()" href="../_variables/type.html">type</a>) {
<a name="l1503"><span class="linenum">1503</span></a>                              case <a class="constant" onClick="logConstant('PARAM_BOOL')" href="../_constants/PARAM_BOOL.html" onMouseOver="constPopup(event,'PARAM_BOOL')">PARAM_BOOL</a>:
<a name="l1504"><span class="linenum">1504</span></a>                                  <a class="var it777" onMouseOver="hilite(777)" onMouseOut="lolite()" onClick="logVariable('default')" href="../_variables/default.html">$default</a> = (int)<a class="var it9293" onMouseOver="hilite(9293)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('default')" class="var it45431" onMouseOver="hilite(45431)" onMouseOut="lolite()" href="../_variables/default.html">default</a>;
<a name="l1505"><span class="linenum">1505</span></a>                                  break;
<a name="l1506"><span class="linenum">1506</span></a>                              case <a class="constant" onClick="logConstant('PARAM_INT')" href="../_constants/PARAM_INT.html" onMouseOver="constPopup(event,'PARAM_INT')">PARAM_INT</a>:
<a name="l1507"><span class="linenum">1507</span></a>                                  <a class="var it777" onMouseOver="hilite(777)" onMouseOut="lolite()" onClick="logVariable('default')" href="../_variables/default.html">$default</a> = <a class="var it9293" onMouseOver="hilite(9293)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('default')" class="var it45431" onMouseOver="hilite(45431)" onMouseOut="lolite()" href="../_variables/default.html">default</a>;
<a name="l1508"><span class="linenum">1508</span></a>                                  break;
<a name="l1509"><span class="linenum">1509</span></a>                              case <a class="constant" onClick="logConstant('PARAM_FLOAT')" href="../_constants/PARAM_FLOAT.html" onMouseOver="constPopup(event,'PARAM_FLOAT')">PARAM_FLOAT</a>;
<a name="l1510"><span class="linenum">1510</span></a>                                  <a class="var it777" onMouseOver="hilite(777)" onMouseOut="lolite()" onClick="logVariable('default')" href="../_variables/default.html">$default</a> = <a class="var it9293" onMouseOver="hilite(9293)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('default')" class="var it45431" onMouseOver="hilite(45431)" onMouseOut="lolite()" href="../_variables/default.html">default</a>;
<a name="l1511"><span class="linenum">1511</span></a>                                  break;
<a name="l1512"><span class="linenum">1512</span></a>                              default:
<a name="l1513"><span class="linenum">1513</span></a>                                  <a class="var it777" onMouseOver="hilite(777)" onMouseOut="lolite()" onClick="logVariable('default')" href="../_variables/default.html">$default</a> = &quot;'<a class="var it9293" onMouseOver="hilite(9293)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('default')" class="var it45431" onMouseOver="hilite(45431)" onMouseOut="lolite()" href="../_variables/default.html">default</a>'&quot;;
<a name="l1514"><span class="linenum">1514</span></a>                          }
<a name="l1515"><span class="linenum">1515</span></a>                          <a class="var it9295" onMouseOver="hilite(9295)" onMouseOut="lolite()" onClick="logVariable('paramanddefault')" href="../_variables/paramanddefault.html">$paramanddefault</a> .= &quot; = <a class="var it777" onMouseOver="hilite(777)" onMouseOut="lolite()" onClick="logVariable('default')" href="../_variables/default.html">$default</a>&quot;;
<a name="l1516"><span class="linenum">1516</span></a>                      }
<a name="l1517"><span class="linenum">1517</span></a>                  } else {
<a name="l1518"><span class="linenum">1518</span></a>  <span class="comment">                    // Accept empty array as default.</span>
<a name="l1519"><span class="linenum">1519</span></a>                      if (isset(<a class="var it9293" onMouseOver="hilite(9293)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('default')" class="var it45431" onMouseOver="hilite(45431)" onMouseOut="lolite()" href="../_variables/default.html">default</a>) &amp;&amp; <a class="phpfunction" onClick="logFunction('is_array')" href="../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it9293" onMouseOver="hilite(9293)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('default')" class="var it45431" onMouseOver="hilite(45431)" onMouseOut="lolite()" href="../_variables/default.html">default</a>) &amp;&amp; empty(<a class="var it9293" onMouseOver="hilite(9293)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('default')" class="var it45431" onMouseOver="hilite(45431)" onMouseOut="lolite()" href="../_variables/default.html">default</a>)) {
<a name="l1520"><span class="linenum">1520</span></a>                          <a class="var it9295" onMouseOver="hilite(9295)" onMouseOut="lolite()" onClick="logVariable('paramanddefault')" href="../_variables/paramanddefault.html">$paramanddefault</a> .= ' = array()';
<a name="l1521"><span class="linenum">1521</span></a>                      } else {
<a name="l1522"><span class="linenum">1522</span></a>  <span class="comment">                        // For the moment we do not support default for other structure types.</span>
<a name="l1523"><span class="linenum">1523</span></a>                          throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('errornotemptydefaultparamarray', 'webservice', '', <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>);
<a name="l1524"><span class="linenum">1524</span></a>                      }
<a name="l1525"><span class="linenum">1525</span></a>                  }
<a name="l1526"><span class="linenum">1526</span></a>              }
<a name="l1527"><span class="linenum">1527</span></a>  
<a name="l1528"><span class="linenum">1528</span></a>              <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>[] = <a class="var it334" onMouseOver="hilite(334)" onMouseOut="lolite()" onClick="logVariable('param')" href="../_variables/param.html">$param</a>;
<a name="l1529"><span class="linenum">1529</span></a>              <a class="var it9290" onMouseOver="hilite(9290)" onMouseOut="lolite()" onClick="logVariable('paramanddefaults')" href="../_variables/paramanddefaults.html">$paramanddefaults</a>[] = <a class="var it9295" onMouseOver="hilite(9295)" onMouseOut="lolite()" onClick="logVariable('paramanddefault')" href="../_variables/paramanddefault.html">$paramanddefault</a>;
<a name="l1530"><span class="linenum">1530</span></a>              <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_phpdoc_type')" href="../_functions/get_phpdoc_type.html" onMouseOver="funcPopup(event,'get_phpdoc_type')">get_phpdoc_type</a>(<a class="var it9293" onMouseOver="hilite(9293)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>);
<a name="l1531"><span class="linenum">1531</span></a>              <a class="var it5661" onMouseOver="hilite(5661)" onMouseOut="lolite()" onClick="logVariable('inputparams')" href="../_variables/inputparams.html">$inputparams</a>[<a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>]['type'] = <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>;
<a name="l1532"><span class="linenum">1532</span></a>  
<a name="l1533"><span class="linenum">1533</span></a>              <a class="var it9291" onMouseOver="hilite(9291)" onMouseOut="lolite()" onClick="logVariable('paramdesc')" href="../_variables/paramdesc.html">$paramdesc</a>[] = '* @param ' . <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> . ' $' . <a class="var it88" onMouseOver="hilite(88)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> . ' ' . <a class="var it9293" onMouseOver="hilite(9293)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('desc')" class="var it45431" onMouseOver="hilite(45431)" onMouseOut="lolite()" href="../_variables/desc.html">desc</a>;
<a name="l1534"><span class="linenum">1534</span></a>          }
<a name="l1535"><span class="linenum">1535</span></a>          <a class="var it9290" onMouseOver="hilite(9290)" onMouseOut="lolite()" onClick="logVariable('paramanddefaults')" href="../_variables/paramanddefaults.html">$paramanddefaults</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(', ', <a class="var it9290" onMouseOver="hilite(9290)" onMouseOut="lolite()" onClick="logVariable('paramanddefaults')" href="../_variables/paramanddefaults.html">$paramanddefaults</a>);
<a name="l1536"><span class="linenum">1536</span></a>          <a class="var it9296" onMouseOver="hilite(9296)" onMouseOut="lolite()" onClick="logVariable('paramdescstr')" href="../_variables/paramdescstr.html">$paramdescstr</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(&quot;\n &quot;, <a class="var it9291" onMouseOver="hilite(9291)" onMouseOut="lolite()" onClick="logVariable('paramdesc')" href="../_variables/paramdesc.html">$paramdesc</a>);
<a name="l1537"><span class="linenum">1537</span></a>  
<a name="l1538"><span class="linenum">1538</span></a>          <a class="var it9297" onMouseOver="hilite(9297)" onMouseOut="lolite()" onClick="logVariable('serviceclassmethodbody')" href="../_variables/serviceclassmethodbody.html">$serviceclassmethodbody</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('service_class_method_body')" href="../_functions/service_class_method_body.html" onMouseOver="funcPopup(event,'service_class_method_body')">service_class_method_body</a>(<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l1539"><span class="linenum">1539</span></a>  
<a name="l1540"><span class="linenum">1540</span></a>          if (empty(<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('returns_desc')" class="var it44241" onMouseOver="hilite(44241)" onMouseOut="lolite()" href="../_variables/returns_desc.html">returns_desc</a>)) {
<a name="l1541"><span class="linenum">1541</span></a>              <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../_variables/return.html">$return</a> = '* @return void';
<a name="l1542"><span class="linenum">1542</span></a>          } else {
<a name="l1543"><span class="linenum">1543</span></a>              <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_phpdoc_type')" href="../_functions/get_phpdoc_type.html" onMouseOver="funcPopup(event,'get_phpdoc_type')">get_phpdoc_type</a>(<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('returns_desc')" class="var it44241" onMouseOver="hilite(44241)" onMouseOut="lolite()" href="../_variables/returns_desc.html">returns_desc</a>);
<a name="l1544"><span class="linenum">1544</span></a>              <a class="var it9292" onMouseOver="hilite(9292)" onMouseOut="lolite()" onClick="logVariable('outputparams')" href="../_variables/outputparams.html">$outputparams</a>['return']['type'] = <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>;
<a name="l1545"><span class="linenum">1545</span></a>              <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('return')" href="../_variables/return.html">$return</a> = '* @return ' . <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> . ' ' . <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('returns_desc')" class="var it44241" onMouseOver="hilite(44241)" onMouseOut="lolite()" href="../_variables/returns_desc.html">returns_desc</a>-&gt;desc;
<a name="l1546"><span class="linenum">1546</span></a>          }
<a name="l1547"><span class="linenum">1547</span></a>  
<a name="l1548"><span class="linenum">1548</span></a>  <span class="comment">        // Now create the virtual method that calls the ext implementation.</span>
<a name="l1549"><span class="linenum">1549</span></a>          <a class="var it1960" onMouseOver="hilite(1960)" onMouseOut="lolite()" onClick="logVariable('code')" href="../_variables/code.html">$code</a> = &lt;&lt;&lt;EOD
<a name="l1550"><span class="linenum">1550</span></a>  <span class="comment">/**</span>
<a name="l1551"><span class="linenum">1551</span></a>  <span class="comment"> * $function-&gt;description.</span>
<a name="l1552"><span class="linenum">1552</span></a>  <span class="comment"> *</span>
<a name="l1553"><span class="linenum">1553</span></a>  <span class="comment"> $paramdescstr</span>
<a name="l1554"><span class="linenum">1554</span></a>  <span class="comment"> $return</span>
<a name="l1555"><span class="linenum">1555</span></a>  <span class="comment"> */</span>
<a name="l1556"><span class="linenum">1556</span></a>  public function <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a class="phpfunction" onClick="logFunction('name')" href="../_functions/name.html" onMouseOver="phpfuncPopup(event,'name')">name</a>(<a class="var it9290" onMouseOver="hilite(9290)" onMouseOut="lolite()" onClick="logVariable('paramanddefaults')" href="../_variables/paramanddefaults.html">$paramanddefaults</a>) {
<a name="l1557"><span class="linenum">1557</span></a>  <a class="var it9297" onMouseOver="hilite(9297)" onMouseOut="lolite()" onClick="logVariable('serviceclassmethodbody')" href="../_variables/serviceclassmethodbody.html">$serviceclassmethodbody</a>
<a name="l1558"><span class="linenum">1558</span></a>  }
<a name="l1559"><span class="linenum">1559</span></a>  EOD;
<a name="l1560"><span class="linenum">1560</span></a>  
<a name="l1561"><span class="linenum">1561</span></a>  <span class="comment">        // Prepare the method information.</span>
<a name="l1562"><span class="linenum">1562</span></a>          <a class="var it9299" onMouseOver="hilite(9299)" onMouseOut="lolite()" onClick="logVariable('methodinfo')" href="../_variables/methodinfo.html">$methodinfo</a> = new stdClass();
<a name="l1563"><span class="linenum">1563</span></a>          <a class="var it9299" onMouseOver="hilite(9299)" onMouseOut="lolite()" onClick="logVariable('methodinfo')" href="../_variables/methodinfo.html">$methodinfo</a>-&gt;<a onClick="logVariable('name')" class="var it45049" onMouseOver="hilite(45049)" onMouseOut="lolite()" href="../_variables/name.html">name</a> = <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('name')" class="var it44241" onMouseOver="hilite(44241)" onMouseOut="lolite()" href="../_variables/name.html">name</a>;
<a name="l1564"><span class="linenum">1564</span></a>          <a class="var it9299" onMouseOver="hilite(9299)" onMouseOut="lolite()" onClick="logVariable('methodinfo')" href="../_variables/methodinfo.html">$methodinfo</a>-&gt;<a onClick="logVariable('inputparams')" class="var it45049" onMouseOver="hilite(45049)" onMouseOut="lolite()" href="../_variables/inputparams.html">inputparams</a> = <a class="var it5661" onMouseOver="hilite(5661)" onMouseOut="lolite()" onClick="logVariable('inputparams')" href="../_variables/inputparams.html">$inputparams</a>;
<a name="l1565"><span class="linenum">1565</span></a>          <a class="var it9299" onMouseOver="hilite(9299)" onMouseOut="lolite()" onClick="logVariable('methodinfo')" href="../_variables/methodinfo.html">$methodinfo</a>-&gt;<a onClick="logVariable('outputparams')" class="var it45049" onMouseOver="hilite(45049)" onMouseOut="lolite()" href="../_variables/outputparams.html">outputparams</a> = <a class="var it9292" onMouseOver="hilite(9292)" onMouseOut="lolite()" onClick="logVariable('outputparams')" href="../_variables/outputparams.html">$outputparams</a>;
<a name="l1566"><span class="linenum">1566</span></a>          <a class="var it9299" onMouseOver="hilite(9299)" onMouseOut="lolite()" onClick="logVariable('methodinfo')" href="../_variables/methodinfo.html">$methodinfo</a>-&gt;<a onClick="logVariable('description')" class="var it45049" onMouseOver="hilite(45049)" onMouseOut="lolite()" href="../_variables/description.html">description</a> = <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('description')" class="var it44241" onMouseOver="hilite(44241)" onMouseOut="lolite()" href="../_variables/description.html">description</a>;
<a name="l1567"><span class="linenum">1567</span></a>  <span class="comment">        // Add the method information into the list of service methods.</span>
<a name="l1568"><span class="linenum">1568</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('servicemethods')" class="var it42912" onMouseOver="hilite(42912)" onMouseOut="lolite()" href="../_variables/servicemethods.html">servicemethods</a>[] = <a class="var it9299" onMouseOver="hilite(9299)" onMouseOut="lolite()" onClick="logVariable('methodinfo')" href="../_variables/methodinfo.html">$methodinfo</a>;
<a name="l1569"><span class="linenum">1569</span></a>  
<a name="l1570"><span class="linenum">1570</span></a>          return <a class="var it1960" onMouseOver="hilite(1960)" onMouseOut="lolite()" onClick="logVariable('code')" href="../_variables/code.html">$code</a>;
<a name="l1571"><span class="linenum">1571</span></a>      }
<a name="l1572"><span class="linenum">1572</span></a>  
<a name="l1573"><span class="linenum">1573</span></a>      <span class="comment">/**</span>
<a name="l1574"><span class="linenum">1574</span></a>  <span class="comment">     * Get the phpdoc type for an external_description object.</span>
<a name="l1575"><span class="linenum">1575</span></a>  <span class="comment">     * external_value =&gt; int, double or string</span>
<a name="l1576"><span class="linenum">1576</span></a>  <span class="comment">     * external_single_structure =&gt; object|struct, on-fly generated stdClass name.</span>
<a name="l1577"><span class="linenum">1577</span></a>  <span class="comment">     * external_multiple_structure =&gt; array</span>
<a name="l1578"><span class="linenum">1578</span></a>  <span class="comment">     *</span>
<a name="l1579"><span class="linenum">1579</span></a>  <span class="comment">     * @param mixed $keydesc The type description.</span>
<a name="l1580"><span class="linenum">1580</span></a>  <span class="comment">     * @return string The PHP doc type of the external_description object.</span>
<a name="l1581"><span class="linenum">1581</span></a>  <span class="comment">     */</span>
<a name="l1582"><span class="linenum">1582</span></a>      protected function <a class="function" onClick="logFunction('get_phpdoc_type')" href="../_functions/get_phpdoc_type.html" onMouseOver="funcPopup(event,'get_phpdoc_type')">get_phpdoc_type</a>(<a class="var it9293" onMouseOver="hilite(9293)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>) {
<a name="l1583"><span class="linenum">1583</span></a>          <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> = null;
<a name="l1584"><span class="linenum">1584</span></a>          if (<a class="var it9293" onMouseOver="hilite(9293)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a> instanceof external_value) {
<a name="l1585"><span class="linenum">1585</span></a>              switch (<a class="var it9293" onMouseOver="hilite(9293)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('type')" class="var it45431" onMouseOver="hilite(45431)" onMouseOut="lolite()" href="../_variables/type.html">type</a>) {
<a name="l1586"><span class="linenum">1586</span></a>                  case <a class="constant" onClick="logConstant('PARAM_BOOL')" href="../_constants/PARAM_BOOL.html" onMouseOver="constPopup(event,'PARAM_BOOL')">PARAM_BOOL</a>: // 0 or 1 only for now.
<a name="l1587"><span class="linenum">1587</span></a>                  case <a class="constant" onClick="logConstant('PARAM_INT')" href="../_constants/PARAM_INT.html" onMouseOver="constPopup(event,'PARAM_INT')">PARAM_INT</a>:
<a name="l1588"><span class="linenum">1588</span></a>                      <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> = 'int';
<a name="l1589"><span class="linenum">1589</span></a>                      break;
<a name="l1590"><span class="linenum">1590</span></a>                  case <a class="constant" onClick="logConstant('PARAM_FLOAT')" href="../_constants/PARAM_FLOAT.html" onMouseOver="constPopup(event,'PARAM_FLOAT')">PARAM_FLOAT</a>;
<a name="l1591"><span class="linenum">1591</span></a>                      <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> = 'double';
<a name="l1592"><span class="linenum">1592</span></a>                      break;
<a name="l1593"><span class="linenum">1593</span></a>                  default:
<a name="l1594"><span class="linenum">1594</span></a>                      <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> = 'string';
<a name="l1595"><span class="linenum">1595</span></a>              }
<a name="l1596"><span class="linenum">1596</span></a>          } else if (<a class="var it9293" onMouseOver="hilite(9293)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a> instanceof external_single_structure) {
<a name="l1597"><span class="linenum">1597</span></a>              <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('generate_simple_struct_class')" href="../_functions/generate_simple_struct_class.html" onMouseOver="funcPopup(event,'generate_simple_struct_class')">generate_simple_struct_class</a>(<a class="var it9293" onMouseOver="hilite(9293)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>);
<a name="l1598"><span class="linenum">1598</span></a>          } else if (<a class="var it9293" onMouseOver="hilite(9293)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a> instanceof external_multiple_structure) {
<a name="l1599"><span class="linenum">1599</span></a>              <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> = 'array';
<a name="l1600"><span class="linenum">1600</span></a>          }
<a name="l1601"><span class="linenum">1601</span></a>  
<a name="l1602"><span class="linenum">1602</span></a>          return <a class="var it90" onMouseOver="hilite(90)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>;
<a name="l1603"><span class="linenum">1603</span></a>      }
<a name="l1604"><span class="linenum">1604</span></a>  
<a name="l1605"><span class="linenum">1605</span></a>      <span class="comment">/**</span>
<a name="l1606"><span class="linenum">1606</span></a>  <span class="comment">     * Generates the method body of the virtual external function.</span>
<a name="l1607"><span class="linenum">1607</span></a>  <span class="comment">     *</span>
<a name="l1608"><span class="linenum">1608</span></a>  <span class="comment">     * @param stdClass $function a record from external_function.</span>
<a name="l1609"><span class="linenum">1609</span></a>  <span class="comment">     * @param array $params web service function parameters.</span>
<a name="l1610"><span class="linenum">1610</span></a>  <span class="comment">     * @return string body of the method for $function ie. everything within the {} of the method declaration.</span>
<a name="l1611"><span class="linenum">1611</span></a>  <span class="comment">     */</span>
<a name="l1612"><span class="linenum">1612</span></a>      protected function <a class="function" onClick="logFunction('service_class_method_body')" href="../_functions/service_class_method_body.html" onMouseOver="funcPopup(event,'service_class_method_body')">service_class_method_body</a>(<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>, <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) {
<a name="l1613"><span class="linenum">1613</span></a>  <span class="comment">        // Cast the param from object to array (validate_parameters except array only).</span>
<a name="l1614"><span class="linenum">1614</span></a>          <a class="var it9300" onMouseOver="hilite(9300)" onMouseOut="lolite()" onClick="logVariable('castingcode')" href="../_variables/castingcode.html">$castingcode</a> = '';
<a name="l1615"><span class="linenum">1615</span></a>          <a class="var it9301" onMouseOver="hilite(9301)" onMouseOut="lolite()" onClick="logVariable('paramsstr')" href="../_variables/paramsstr.html">$paramsstr</a> = '';
<a name="l1616"><span class="linenum">1616</span></a>          if (!empty(<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>)) {
<a name="l1617"><span class="linenum">1617</span></a>              foreach (<a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> as <a class="var it9302" onMouseOver="hilite(9302)" onMouseOut="lolite()" onClick="logVariable('paramtocast')" href="../_variables/paramtocast.html">$paramtocast</a>) {
<a name="l1618"><span class="linenum">1618</span></a>  <span class="comment">                // Clean the parameter from any white space.</span>
<a name="l1619"><span class="linenum">1619</span></a>                  <a class="var it9302" onMouseOver="hilite(9302)" onMouseOut="lolite()" onClick="logVariable('paramtocast')" href="../_variables/paramtocast.html">$paramtocast</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it9302" onMouseOver="hilite(9302)" onMouseOut="lolite()" onClick="logVariable('paramtocast')" href="../_variables/paramtocast.html">$paramtocast</a>);
<a name="l1620"><span class="linenum">1620</span></a>                  <a class="var it9300" onMouseOver="hilite(9300)" onMouseOut="lolite()" onClick="logVariable('castingcode')" href="../_variables/castingcode.html">$castingcode</a> .= &quot;    <a class="var it9302" onMouseOver="hilite(9302)" onMouseOut="lolite()" onClick="logVariable('paramtocast')" href="../_variables/paramtocast.html">$paramtocast</a> = json_decode(<a class="function" onClick="logFunction('json_encode')" href="../_functions/json_encode.html" onMouseOver="funcPopup(event,'json_encode')">json_encode</a>(<a class="var it9302" onMouseOver="hilite(9302)" onMouseOut="lolite()" onClick="logVariable('paramtocast')" href="../_variables/paramtocast.html">$paramtocast</a>), true);\n&quot;;
<a name="l1621"><span class="linenum">1621</span></a>              }
<a name="l1622"><span class="linenum">1622</span></a>              <a class="var it9301" onMouseOver="hilite(9301)" onMouseOut="lolite()" onClick="logVariable('paramsstr')" href="../_variables/paramsstr.html">$paramsstr</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(', ', <a class="var it189" onMouseOver="hilite(189)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l1623"><span class="linenum">1623</span></a>          }
<a name="l1624"><span class="linenum">1624</span></a>  
<a name="l1625"><span class="linenum">1625</span></a>          <a class="var it9303" onMouseOver="hilite(9303)" onMouseOut="lolite()" onClick="logVariable('descriptionmethod')" href="../_variables/descriptionmethod.html">$descriptionmethod</a> = <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('methodname')" class="var it44241" onMouseOver="hilite(44241)" onMouseOut="lolite()" href="../_variables/methodname.html">methodname</a> . '_returns()';
<a name="l1626"><span class="linenum">1626</span></a>          <a class="var it9304" onMouseOver="hilite(9304)" onMouseOut="lolite()" onClick="logVariable('callforreturnvaluedesc')" href="../_variables/callforreturnvaluedesc.html">$callforreturnvaluedesc</a> = <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('classname')" class="var it44241" onMouseOver="hilite(44241)" onMouseOut="lolite()" href="../_variables/classname.html">classname</a> . '::' . <a class="var it9303" onMouseOver="hilite(9303)" onMouseOut="lolite()" onClick="logVariable('descriptionmethod')" href="../_variables/descriptionmethod.html">$descriptionmethod</a>;
<a name="l1627"><span class="linenum">1627</span></a>  
<a name="l1628"><span class="linenum">1628</span></a>          <a class="var it9305" onMouseOver="hilite(9305)" onMouseOut="lolite()" onClick="logVariable('methodbody')" href="../_variables/methodbody.html">$methodbody</a> = &lt;&lt;&lt;EOD
<a name="l1629"><span class="linenum">1629</span></a>  <a class="var it9300" onMouseOver="hilite(9300)" onMouseOut="lolite()" onClick="logVariable('castingcode')" href="../_variables/castingcode.html">$castingcode</a>
<a name="l1630"><span class="linenum">1630</span></a>      if (<a class="var it9304" onMouseOver="hilite(9304)" onMouseOut="lolite()" onClick="logVariable('callforreturnvaluedesc')" href="../_variables/callforreturnvaluedesc.html">$callforreturnvaluedesc</a> == null) {
<a name="l1631"><span class="linenum">1631</span></a>          <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('classname')" class="var it44241" onMouseOver="hilite(44241)" onMouseOut="lolite()" href="../_variables/classname.html">classname</a>::<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;methodname(<a class="var it9301" onMouseOver="hilite(9301)" onMouseOut="lolite()" onClick="logVariable('paramsstr')" href="../_variables/paramsstr.html">$paramsstr</a>);
<a name="l1632"><span class="linenum">1632</span></a>          return null;
<a name="l1633"><span class="linenum">1633</span></a>      }
<a name="l1634"><span class="linenum">1634</span></a>      return <a class="class" onClick="logClass('external_api')" href="../_classes/external_api.html" onMouseOver="classPopup(event,'external_api')">external_api</a>::<a class="function" onClick="logFunction('clean_returnvalue')" href="../_functions/clean_returnvalue.html" onMouseOver="funcPopup(event,'clean_returnvalue')">clean_returnvalue</a>(<a class="var it9304" onMouseOver="hilite(9304)" onMouseOut="lolite()" onClick="logVariable('callforreturnvaluedesc')" href="../_variables/callforreturnvaluedesc.html">$callforreturnvaluedesc</a>, <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('classname')" class="var it44241" onMouseOver="hilite(44241)" onMouseOut="lolite()" href="../_variables/classname.html">classname</a>::<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;methodname(<a class="var it9301" onMouseOver="hilite(9301)" onMouseOut="lolite()" onClick="logVariable('paramsstr')" href="../_variables/paramsstr.html">$paramsstr</a>));
<a name="l1635"><span class="linenum">1635</span></a>  EOD;
<a name="l1636"><span class="linenum">1636</span></a>          return <a class="var it9305" onMouseOver="hilite(9305)" onMouseOut="lolite()" onClick="logVariable('methodbody')" href="../_variables/methodbody.html">$methodbody</a>;
<a name="l1637"><span class="linenum">1637</span></a>      }
<a name="l1638"><span class="linenum">1638</span></a>  }
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'add_external_function_to_service': ['add_external_function_to_service', 'Add a function to a service ', [['webservice','lib.php',661]], 1],
'get_phpdoc_type': ['get_phpdoc_type', '', [['webservice','lib.php',1582]], 3],
'authenticate_user': ['authenticate_user', 'Authenticate user (used by download/upload file scripts) ', [['webservice','lib.php',52],['webservice','lib.php',851]], 5],
'set_web_service_call_settings': ['set_web_service_call_settings', 'Intercept some moodlewssettingXXX $_GET and $_POST parameter that are related to the web service call and are not the function parameters ', [['webservice','lib.php',1069]], 3],
'get_missing_capabilities_by_users': ['get_missing_capabilities_by_users', 'Get missing user capabilities for a given service WARNING: do not use this "broken" function. It was created in the goal to display some capabilities required by users. In theory we should not need to display this kind of information as the front end does not display it itself. In pratice, admins would like the info, for more info you can follow: MDL-29962 ', [['webservice','lib.php',577]], 2],
'generate_user_ws_tokens': ['generate_user_ws_tokens', 'Generate all tokens of a specific user ', [['webservice','lib.php',295]], 1],
'list': ['list', '', [['mod/data/preset/imagegallery','jstemplate.js',9]], 2229],
'get_external_service_by_shortname': ['get_external_service_by_shortname', 'Get an external service for a given shortname ', [['webservice','lib.php',633]], 3],
'set_field': ['set_field', 'Set a single field in every table record where all the given conditions met. ', [['lib/dml','moodle_database.php',1737],['availability/condition/profile/tests','condition_test.php',349]], 485],
'set_timeout': ['set_timeout', 'Allow users to override the default timeout ', [['mnet/xmlrpc','client.php',43],['lib/simplepie/library','SimplePie.php',769],['lib','externallib.php',267]], 6],
'get_records_select': ['get_records_select', 'Load a list of records based on a select query. ', [['competency/classes','persistent.php',751],['lib/dml','moodle_database.php',1332]], 166],
'enrol_check_plugins': ['enrol_check_plugins', 'Check all the login enrolment information for the given user object by querying the enrolment plugins ', [['lib','enrollib.php',186]], 8],
'get_recordset_sql': ['get_recordset_sql', 'Get a number of records as an moodle_recordset.  $sql must be a complete SQL query. Since this method is a little less readable, use of it should be restricted to code where it\'s possible there might be large datasets being returned.  For known small datasets use get_records_sql - it leads to simpler code. ', [['lib/dml','pdo_moodle_database.php',252],['lib/dml','oci_native_moodle_database.php',1106],['lib/dml','pgsql_native_moodle_database.php',688],['lib/dml','mssql_native_moodle_database.php',736],['lib/dml','mysqli_native_moodle_database.php',993],['lib/dml','sqlsrv_native_moodle_database.php',811],['lib/dml/tests','dml_test.php',5544]], 283],
'clean_returnvalue': ['clean_returnvalue', 'Clean response If a response attribute is unknown from the description, we just ignore the attribute. If a response attribute is incorrect, invalid_response_exception is thrown. Note: this function is similar to validate parameters, however it is distinct because parameters validation must be distinct from cleaning return values. ', [['lib','externallib.php',358]], 733],
'getremoteaddr': ['getremoteaddr', 'Returns most reliable client address ', [['lib','moodlelib.php',8569]], 61],
'execute': ['execute', 'Run langpack update ', [['admin/tool/langimport/classes/task','update_langpacks_task.php',44],['backup/converter/imscc1','lib.php',84],['lib/classes/task','blog_cron_task.php',40],['mod/workshop/allocation/scheduled','lib.php',128],['lib/classes/task','send_new_user_passwords_task.php',40],['admin/tool/log/store/standard/classes/task','cleanup_task.php',40],['lib/dml','pdo_moodle_database.php',227],['lib/classes/task','tag_cron_task.php',42],['enrol/imsenterprise/classes/task','cron_task.php',43],['lib/classes/task','completion_daily_task.php',42],['lib/google/src/Google/Http','Batch.php',61],['lib/dml','oci_native_moodle_database.php',1048],['lib/classes/task','context_cleanup_task.php',41],['backup/util/plan','backup_structure_step.class.php',50],['backup/util/ui','restore_ui.class.php',206],['webservice','lib.php',1319],['lib/classes/task','stats_cron_task.php',40],['lib/htmlpurifier/HTMLPurifier/Strategy','ValidateAttributes.php',16],['lib/htmlpurifier/HTMLPurifier/Strategy','RemoveForeignElements.php',20],['lib/classes/task','legacy_plugin_cron_task.php',42],['backup/moodle2','restore_activity_task.class.php',189],['lib/classes/task','portfolio_cron_task.php',40],['lib/google/src/Google/Http','REST.php',27],['lib/htmlpurifier/HTMLPurifier/Strategy','MakeWellFormed.php',66],['backup/converter/imscc11','backuplib.php',42],['lib/classes/task','question_cron_task.php',40],['lib/classes/task','cache_cron_task.php',40],['admin/tool/log/store/legacy/classes/task','cleanup_task.php',40],['mod/lti/service/memberships/classes/local/resource','linkmemberships.php',62],['admin/tool/messageinbound/classes/task','cleanup_task.php',47],['lib/adodb/drivers','adodb-pdo.inc.php',559],['lib/editor/atto/classes/task','autosave_cleanup_task.php',42],['admin/tool/recyclebin/classes/task','cleanup_category_bin.php',43],['lib/classes/task','completion_regular_task.php',42],['lib/adodb/drivers','adodb-oci8po.inc.php',54],['lib/classes/task','events_cron_task.php',40],['mod/workshop/allocation/random','lib.php',83],['mod/assign/feedback/editpdf/classes/task','convert_submissions.php',47],['auth/cas/classes/task','sync_task.php',43],['admin/tool/recyclebin/classes/task','cleanup_course_bin.php',43],['mod/lti/service/toolsettings/classes/local/resource','contextsettings.php',62],['backup/util/helper','restore_decode_processor.class.php',73],['lib/behat','behat_base.php',840],['enrol/flatfile/classes/task','flatfile_sync_task.php',46],['lib/classes/task','registration_cron_task.php',40],['backup/moodle2','backup_section_task.class.php',97],['lib/classes/task','check_for_updates_task.php',40],['backup/util/plan/tests/fixtures','plan_fixtures.php',48],['backup/util/plan/tests/fixtures','plan_fixtures.php',56],['mod/forum/classes/task','cron_task.php',39],['lib/classes/task','send_failed_login_notifications_task.php',43],['enrol/lti/classes/task','sync_grades.php',45],['lib/dml','pgsql_native_moodle_database.php',665],['lib/htmlpurifier/HTMLPurifier/Strategy','Composite.php',21],['lib/classes/update','validator.php',117],['lib/google/src/Google','Client.php',574],['lib/dml','mssql_native_moodle_database.php',711],['mod/lti/service/profile/classes/local/resource','profile.php',76],['backup/util/plan','backup_plan.class.php',112],['lib/dml','mysqli_native_moodle_database.php',963],['backup/util/ui','backup_ui.class.php',122],['admin/tool/monitor/classes/task','clean_events.php',41],['backup/converter/moodle1','backuplib.php',10],['backup/converter/imscc11','lib.php',85],['lib/classes/task','grade_cron_task.php',40],['lib/classes/task','file_temp_cleanup_task.php',40],['backup/moodle2','restore_section_task.class.php',87],['mod/lti/service/toolsettings/classes/local/resource','linksettings.php',63],['filter/tex','latex.php',70],['lib/adodb','adodb.inc.php',1088],['lib/classes/task','plagiarism_cron_task.php',40],['mod/lti/service/toolproxy/classes/local/resource','toolproxy.php',62],['backup/converter/moodle1','lib.php',142],['backup/util/plan','restore_structure_step.class.php',62],['lib/classes/task','search_index_task.php',44],['enrol/lti/classes/task','sync_members.php',55],['lib/classes/task','session_cleanup_task.php',40],['mod/lti/service/toolsettings/classes/local/resource','systemsettings.php',61],['lib/classes/task','backup_cleanup_task.php',40],['lib/classes/task','delete_unconfirmed_users_task.php',40],['backup/converter/imscc1','backuplib.php',10],['lib/classes/task','badges_cron_task.php',40],['admin/tool/uploadcourse/classes','processor.php',174],['lib/classes/task','calendar_cron_task.php',40],['backup/util/plan','base_plan.class.php',158],['auth/ldap/classes/task','sync_task.php',43],['lib/adodb/drivers','adodb-oci8.inc.php',920],['backup/util/plan','restore_plan.class.php',159],['lib/tests/fixtures','task_fixtures.php',30],['lib/tests/fixtures','task_fixtures.php',39],['lib/tests/fixtures','task_fixtures.php',48],['lib/tests/fixtures','task_fixtures.php',57],['lib/dml','sqlsrv_native_moodle_database.php',795],['lib/classes/task','create_contexts_task.php',40],['lib/classes/task','file_trash_cleanup_task.php',40],['admin/tool/cohortroles/classes/task','cohort_role_sync.php',46],['lib/classes/task','complete_plans_task.php',52],['lib/classes/task','messaging_cleanup_task.php',40],['backup/util/plan','backup_execution_step.class.php',25],['lib/classes/task','cache_cleanup_task.php',40],['backup/moodle2','backup_activity_task.class.php',211],['filter/tex','texdebug.php',287],['lib/classes/task','password_reset_cleanup_task.php',40],['lib/classes/task','search_optimize_task.php',47],['mod/assign','adminlib.php',342],['lib/classes/task','delete_incomplete_users_task.php',40],['lib/classes/task','automated_backup_task.php',40],['admin/tool/messageinbound/classes/task','pickup_task.php',47],['backup/util/plan','restore_execution_step.class.php',25],['lib/classes/task','sync_plans_from_template_cohorts_task.php',50],['admin/tool/monitor/classes','notification_task.php',39],['lib/dml/tests','dml_test.php',5543],['lib/htmlpurifier/HTMLPurifier/Strategy','FixNesting.php',41],['mod/lti/service/memberships/classes/local/resource','contextmemberships.php',60],['admin/tool/monitor/classes/task','check_subscriptions.php',60],['backup/util/interfaces','executable.class.php',32],['backup/util/plan','base_task.class.php',162]], 1058],
'get_ws_authorised_users': ['get_ws_authorised_users', 'Return list of allowed users with their options (ip/timecreated / validuntil...) for a given service ', [['webservice','lib.php',249]], 1],
'user_login_webservice': ['user_login_webservice', 'Custom auth hook for web services. ', [['auth/webservice','auth.php',67]], 1],
'parse_request': ['parse_request', 'This method parses the $_POST and $_GET superglobals and looks for the following information: 1/ user authentication - username+password or token (wsusername, wspassword and wstoken parameters) 2/ function name (wsfunction parameter) 3/ function parameters (all other parameters except those above) 4/ text format parameters 5/ return rest format xml/json ', [['webservice/rest','locallib.php',51],['webservice/tests','lib_test.php',234],['webservice/soap','locallib.php',70],['webservice/xmlrpc','locallib.php',51]], 3],
'set_context_restriction': ['set_context_restriction', 'Set context restriction for all following subsequent function calls. ', [['lib','externallib.php',257]], 1],
'remove_ws_authorised_user': ['remove_ws_authorised_user', 'Disallow a user to call a service ', [['webservice','lib.php',227]], 1],
'get_records': ['get_records', 'Load a list of records. ', [['competency/classes','persistent.php',709],['mod/glossary/classes','entry_query_builder.php',295],['lib/dml','moodle_database.php',1285],['lib','coursecatlib.php',651],['question','category_class.php',63]], 965],
'address_in_subnet': ['address_in_subnet', 'Function to check the passed address is within the passed subnet ', [['lib','moodlelib.php',8284]], 80],
'get_user_capabilities': ['get_user_capabilities', 'Get user capabilities (with context) Only useful for documentation purpose WARNING: do not use this "broken" function. It was created in the goal to display some capabilities required by users. In theory we should not need to display this kind of information as the front end does not display it itself. In pratice, admins would like the info, for more info you can follow: MDL-29962 ', [['webservice','lib.php',553]], 1],
'abort_all_db_transactions': ['abort_all_db_transactions', 'Unconditionally abort all database transactions, this function should be called from exception handlers only. ', [['lib','setuplib.php',430]], 3],
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pdo_moodle_database.php',461],['lib/dml','oci_native_moodle_database.php',1404],['lib/dml','pgsql_native_moodle_database.php',1089],['lib/dml','mssql_native_moodle_database.php',1067],['lib/dml','mysqli_native_moodle_database.php',1405],['lib/dml','sqlsrv_native_moodle_database.php',1148],['lib/dml/tests','dml_test.php',5551]], 650],
'session_exists': ['session_exists', 'Check the backend contains data for this session id. ', [['lib/classes/session','file.php',78],['lib/classes/session','memcache.php',123],['lib/classes/session','memcached.php',148],['lib/classes/session','database.php',84],['lib/classes/session','manager.php',549]], 13],
'authenticate_by_token': ['authenticate_by_token', 'User authentication by token ', [['webservice','lib.php',1003]], 2],
'get_not_associated_external_functions': ['get_not_associated_external_functions', 'Get functions not included in a service ', [['webservice','lib.php',498]], 1],
'get_external_functions_by_enabled_services': ['get_external_functions_by_enabled_services', 'Get the functions of a service list (by shortname). It can return only enabled functions if required. ', [['webservice','lib.php',472]], 0],
'delete_records': ['delete_records', 'Delete the records from a table where all the given conditions met. If conditions not specified, table is truncated. ', [['lib/dml','sqlite3_pdo_moodle_database.php',345],['lib/dml','moodle_database.php',1864]], 773],
'on': ['on', '', [['lib/requirejs','require.js',508],['lib/jquery','jquery-3.1.0.js',4809]], 3823],
'get_external_function_by_id': ['get_external_function_by_id', 'Get an external function for a given function id ', [['webservice','lib.php',647]], 2],
'session_cleanup': ['session_cleanup', 'Future hook needed for emulated sessions. ', [['webservice','lib.php',1223]], 3],
'raise_memory_limit': ['raise_memory_limit', 'Function to raise the memory limit to a new value. Will respect the memory limit if it is higher, thus allowing settings in php.ini, apache conf or command line switches to override it. ', [['lib','setuplib.php',1206]], 59],
'get_created_by_user_ws_token': ['get_created_by_user_ws_token', 'Return a token that has been created by the user (i.e. to created by an admin) If no tokens exist an exception is thrown ', [['webservice','lib.php',373]], 2],
'get_user_ws_token': ['get_user_ws_token', 'Get a full database token record for a given token value ', [['webservice','lib.php',438]], 0],
'simpletest': ['simpletest', 'Execute test client WS request ', [['webservice/rest','locallib.php',245],['webservice','lib.php',782],['webservice/soap','locallib.php',322],['webservice/xmlrpc','locallib.php',219]], 1],
'remove_external_function_from_service': ['remove_external_function_from_service', 'Remove a function from a service ', [['webservice','lib.php',716]], 1],
'get_auth_plugin': ['get_auth_plugin', 'Returns an authentication plugin instance. ', [['lib','moodlelib.php',3608]], 81],
'delete_user_ws_token': ['delete_user_ws_token', 'Delete a token ', [['webservice','lib.php',414]], 2],
'record_exists': ['record_exists', 'Check if a record exists by ID. ', [['competency/classes','persistent.php',842],['lib/dml','moodle_database.php',1817]], 901],
'get_token_by_id': ['get_token_by_id', 'Return a database token record for a token id ', [['webservice','lib.php',403]], 1],
'has_capability': ['has_capability', 'Wrapper round the has_capability funciton that automatically passes in the quiz context. ', [['mod/quiz','attemptlib.php',299],['mod/quiz','attemptlib.php',922],['lib','accesslib.php',344]], 2064],
'update_ws_authorised_user': ['update_ws_authorised_user', 'Update allowed user settings (ip restriction, valid until...) ', [['webservice','lib.php',239]], 1],
'update_external_service': ['update_external_service', 'Update a service It modifies the timemodified automatically. ', [['webservice','lib.php',689]], 3],
'is_siteadmin': ['is_siteadmin', 'Check if the user is an admin at the site level. ', [['lib','accesslib.php',602]], 95],
'delete_service': ['delete_service', 'Delete a service Also delete function references and authorised user references. ', [['webservice','lib.php',424]], 1],
'run': ['run', 'Runs the task and (if applicable) automatically retries when errors occur. ', [['lib/google/src/Google/Task','Runner.php',164],['lib','componentlib.class.php',641],['lib/lessphp/Visitor','processExtends.php',16],['webservice','lib.php',802],['webservice','lib.php',1151],['lib/lessphp/Visitor','extendFinder.php',24],['webservice/tests','lib_test.php',260],['lib/google/src/Google/Service','Script.php',115],['lib/behat/classes','behat_command.php',123],['lib/minify/lib','CSSmin.php',54],['webservice/soap','locallib.php',105],['lib/jquery/ui-1.11.4','jquery-ui.js',15350],['lib/lessphp/Visitor','toCSS.php',20],['lib/lessphp/Visitor','joinSelector.php',16],['lib/google/src/Google/Service','Dfareporting.php',8184]], 121],
'exception_handler': ['exception_handler', 'Specialised exception handler, we can not use the standard one because it can not just print html to output. ', [['webservice','lib.php',1202]], 0],
'optional_param': ['optional_param', 'Returns a particular value for the named variable, taken from POST or GET, otherwise returning a given default. ', [['lib','moodlelib.php',609]], 2210],
'trigger': ['trigger', '', [['lib/evalmath','evalmath.class.php',448],['lib/classes/event','base.php',765]], 964],
'is_enabled_auth': ['is_enabled_auth', 'Checks if a given plugin is in the list of enabled authentication plugins. ', [['lib','moodlelib.php',3592]], 38],
'service_class_method_body': ['service_class_method_body', 'Generates the method body of the virtual external function. ', [['webservice','lib.php',1605]], 1],
'send_response': ['send_response', 'Send the result of function call to the WS client formatted as XML document. ', [['webservice/rest','locallib.php',97],['webservice/tests','lib_test.php',244],['course','dnduploadlib.php',664],['webservice/soap','locallib.php',247],['webservice/xmlrpc','locallib.php',127]], 5],
'set_legacy_logdata': ['set_legacy_logdata', 'Return the legacy event log data. ', [['lib/classes/event','webservice_function_called.php',87],['mod/workshop/classes/event','assessable_uploaded.php',122],['lib/classes/event','role_capabilities_updated.php',83],['mod/assign/classes/event','base.php',99],['lib/classes/event','course_resources_list_viewed.php',78],['lib/classes/event','tag_updated.php',76],['lib/classes/event','course_updated.php',103],['lib/classes/event','course_category_updated.php',78],['lib/classes/event','webservice_login_failed.php',91],['lib/classes/event','content_viewed.php',98]], 55],
'get_service_required_capabilities': ['get_service_required_capabilities', 'Get list of required capabilities of a service, sorted by functions Example of returned value: Array ( [core_group_create_groups] => Array ( [0] => moodle/course:managegroups ) ', [['webservice','lib.php',517]], 1],
'get_record': ['get_record', 'Load a single record. ', [['competency/classes','persistent.php',738],['lib/dml','moodle_database.php',1462]], 3224],
'send_error': ['send_error', 'Send the error information to the WS client formatted as XML document. Note: the exception is never passed as null, it only matches the abstract function declaration. ', [['webservice/rest','locallib.php',132],['webservice/tests','lib_test.php',251],['webservice/soap','locallib.php',208],['webservice/xmlrpc','locallib.php',136]], 2],
'load_function_info': ['load_function_info', 'Fetches the function description from database, verifies user is allowed to use this function and loads all paremeters and return descriptions. ', [['webservice','lib.php',1236]], 1],
'get_in_or_equal': ['get_in_or_equal', 'Constructs \'IN()\' or \'=\' sql fragment ', [['lib/dml','oci_native_moodle_database.php',1635],['lib/dml','moodle_database.php',711]], 438],
'__construct': ['__construct', '', [['lib/adodb/drivers','adodb-odbc_mssql.inc.php',50],['lib/adodb/drivers','adodb-odbc_mssql.inc.php',359],['question/classes/statistics/responses','analyser.php',69],['auth/radius','auth.php',38],['lib/xmldb','xmldb_file.php',43],['lib/lessphp/Tree/Mixin','Definition.php',18],['cache/stores/static','lib.php',127],['lib/classes/session','file.php',40],['lib/htmlpurifier/HTMLPurifier/Lexer','DOMLex.php',35],['backup/util/ui','base_moodleform.class.php',68],['lib/simplepie/library/SimplePie','Author.php',81],['lib/filestorage','zip_archive.php',66],['backup/util/structure','restore_path_element.class.php',47],['backup/util/structure','restore_path_element.class.php',128],['lib/htmlpurifier/HTMLPurifier/ChildDef','Chameleon.php',36],['lib/phpexcel/PHPExcel','HashTable.php',44],['mod/quiz/tests','repaginate_test.php',39],['lib/form','modvisible.php',43],['lib/phpexcel/PHPExcel/Worksheet','Row.php',44],['cache','disabledlib.php',44],['lib/phpexcel/PHPExcel/Worksheet','Dimension.php',58],['lib/mustache/src/Mustache/Cache','FilesystemCache.php',27],['question/type/ddwtos','question.php',61],['mnet/xmlrpc','client.php',25],['lib/horde/framework/Horde/Imap/Client','Url.php',112],['lib/classes','useragent.php',115],['lib/pear/HTML/QuickForm','advcheckbox.php',66],['lib/classes/update','checker_exception.php',37],['lib/phpexcel/PHPExcel/Reader','Excel2007.php',53],['lib/jabber/XMPP','XMPP.php',101],['lib/form','radio.php',44],['lib/spout/src/Spout/Reader/XLSX/Helper','StyleHelper.php',45],['auth/cas/CAS/CAS/ProxiedService/Http','Abstract.php',58],['lib/phpexcel/PHPExcel/Style','Border.php',67],['lib/htmlpurifier/HTMLPurifier','HTMLDefinition.php',182],['lib/adodb/drivers','adodb-oci8quercus.inc.php',31],['lib/adodb/drivers','adodb-oci8quercus.inc.php',45],['lib/spout/src/Spout/Reader/XLSX','SheetIterator.php',29],['lib/horde/framework/Horde/Imap/Client/Interaction','Server.php',91],['lib/phpexcel/PHPExcel','DocumentProperties.php',123],['lib/typo3','class.t3lib_cs.php',509],['mod/workshop/allocation/scheduled','lib.php',48],['lib/adodb/drivers','adodb-netezza.inc.php',53],['lib/adodb/drivers','adodb-netezza.inc.php',144],['mod/feedback/classes','complete_form.php',58],['search/classes','document.php',188],['webservice/rest','locallib.php',40],['lib/dml','mssql_native_moodle_recordset.php',34],['mod/assign/feedback/editpdf/fpdi','fpdi_pdf_parser.php',57],['lib/htmlpurifier/HTMLPurifier','TokenFactory.php',43],['backup/moodle2','backup_block_task.class.php',43],['lib/lessphp/Tree','Negative.php',14],['lib/minify/lib/Minify/Cache','APC.php',19],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',54],['lib/pear/HTML/QuickForm','header.php',33],['lib/spout/src/Spout/Reader/XLSX/Helper/SharedStringsCaching','InMemoryStrategy.php',26],['lib/phpexcel/PHPExcel/Worksheet','RowCellIterator.php',51],['lib/simplepie/library/SimplePie/XML/Declaration','Parser.php',110],['lib/phpexcel/PHPExcel/Worksheet','ColumnIterator.php',60],['lib/spout/src/Spout/Reader/ODS','Sheet.php',33],['question/type/calculated/tests','helper.php',205],['lib/adodb/drivers','adodb-odbtp.inc.php',38],['lib/adodb/drivers','adodb-odbtp.inc.php',673],['lib/adodb/drivers','adodb-odbtp.inc.php',796],['lib/adodb/drivers','adodb-odbtp.inc.php',806],['lib/adodb/drivers','adodb-odbtp.inc.php',816],['lib/adodb/drivers','adodb-odbtp.inc.php',826],['lib/adodb/drivers','adodb-odbtp.inc.php',836],['enrol/lti/ims-blti','blti.php',28],['backup/cc','cc2moodle.php',105],['mod/chat','locallib.php',181],['mod/chat','locallib.php',229],['user/filters','simpleselect.php',45],['lib/phpexcel/PHPExcel/CachedObjectStorage','Memcache.php',244],['lib/dml','pdo_moodle_database.php',42],['lib/adodb/drivers','adodb-sqlite3.inc.php',36],['lib/adodb/drivers','adodb-sqlite3.inc.php',350],['lib/pear/HTML/QuickForm','static.php',44],['competency/classes/external','comment_area_exporter.php',48],['lib/lessphp/Tree','Selector.php',31],['auth/cas/CAS/CAS','TypeMismatchException.php',43],['auth/fc','fcFPP.php',33],['lib/xmldb','xmldb_key.php',43],['grade/grading/form/rubric','rubriceditor.php',56],['lib/google/src/Google/Service','Cloudlatencytest.php',40],['course','moodleform_mod.php',69],['auth/nntp','auth.php',35],['grade/report/grader','lib.php',111],['admin/tool/generator/classes','course_backend.php',116],['lib/minify/lib','FirePHP.php',189],['lib/adodb/drivers','adodb-sqlitepo.inc.php',38],['lib/horde/framework/Horde/Imap/Client','Tokenize.php',67],['lib/phpexcel/PHPExcel/CachedObjectStorage','CacheBase.php',66],['lib/lessphp/Tree','Rule.php',24],['lib/behat/features/bootstrap','behat_init_context.php',45],['lib','dmllib.php',69],['lib','dmllib.php',84],['lib','dmllib.php',104],['lib','dmllib.php',129],['lib','dmllib.php',159],['lib','dmllib.php',187],['lib','dmllib.php',240],['lib','dmllib.php',270],['lib/google/src/Google/Service','DataTransfer.php',44],['lib/google/src/Google/Http','Batch.php',42],['backup/util/structure','base_processor.class.php',49],['admin/tool/lpmigrate/classes','framework_mapper.php',50],['lib/phpexcel/PHPExcel/Reader','OOCalc.php',46],['lib/lessphp/Tree','NameValue.php',22],['mod/quiz/classes','admin_review_setting.php',82],['lib/htmlpurifier/HTMLPurifier','Generator.php',67],['mod/quiz/report','attemptsreport_table.php',76],['blocks/lp/classes/output','summary.php',59],['lib/google/src/Google/IO','Stream.php',45],['lib/google/src/Google/Service','Freebase.php',38],['grade/tests','reportlib_test.php',36],['search/classes','manager.php',100],['question/behaviour/adaptive','behaviour.php',310],['admin/tool/lp/classes/form','framework_autocomplete.php',48],['lib/minify/lib','JSMinPlus.php',193],['lib/minify/lib','JSMinPlus.php',726],['lib/minify/lib','JSMinPlus.php',1638],['lib/minify/lib','JSMinPlus.php',1656],['lib/minify/lib','JSMinPlus.php',1748],['lib/simplepie/library/SimplePie','Copyright.php',73],['lib/phpexcel/PHPExcel/Style','Conditional.php',93],['lib/google/src/Google/Task','Runner.php',76],['backup/util/settings/root','root_backup_setting.class.php',34],['lib','componentlib.class.php',179],['lib','componentlib.class.php',610],['lib','componentlib.class.php',834],['lib/google/src/Google/Service','AdSense.php',68],['lib/htmlpurifier/HTMLPurifier/AttrDef','Clone.php',18],['lib/spout/src/Spout/Reader/CSV','Sheet.php',24],['lib/filebrowser','file_info_context_system.php',37],['lib/grade','grade_item.php',260],['lib/horde/framework/Horde/Imap/Client/Data/Format','Nstring.php',27],['repository/boxnet','lib.php',56],['auth/email','auth.php',34],['mod/wiki/editors','wikifiletable.php',40],['lib/google/src/Google/Service','Replicapool.php',51],['lib/dtl','database_exporter.php',55],['lib/horde/framework/Horde/Imap/Client/Namespace','List.php',34],['lib/phpexcel/PHPExcel/Writer','CSV.php',79],['lib/google/src/Google/Service','Tasks.php',44],['lib/dml','mysqli_native_moodle_recordset.php',42],['lib/google/src/Google/Service','GamesManagement.php',50],['lib/minify/lib/Minify','Source.php',43],['lib/jabber/XMPP','Roster.php',48],['lib/lessphp/Tree','Element.php',19],['lib/classes','string_manager_install.php',43],['question/type','questiontypebase.php',55],['question/type','questiontypebase.php',1442],['lib/form','filemanager.php',54],['lib/form','filemanager.php',316],['lib/htmlpurifier/HTMLPurifier/ChildDef','Custom.php',36],['backup/util/ui','renderer.php',813],['lib/simplepie/library/SimplePie','Rating.php',73],['lib/phpexcel/PHPExcel/Cell','Hyperlink.php',44],['question/classes/statistics/questions','calculator.php',66],['backup/moodle2','backup_xml_transformer.class.php',50],['lib/google/src/Google/Service','Resource.php',62],['lib/form','autocomplete.php',56],['lib/phpexcel/PHPExcel/Worksheet','RowIterator.php',60],['mod/lesson/classes','file_info.php',45],['question/type/tests','question_first_matching_answer_grading_strategy_test.php',40],['lib/google/src/Google/Service','Partners.php',43],['cache','lib.php',66],['cache','lib.php',109],['cache','lib.php',138],['cache','lib.php',183],['grade/edit/tree','lib.php',57],['grade/edit/tree','lib.php',635],['grade/edit/tree','lib.php',668],['grade/edit/tree','lib.php',834],['lib/simplepie/library/SimplePie','Cache.php',69],['mod/wiki/diff','difflib.php',277],['mod/wiki/diff','difflib.php',381],['mod/wiki/diff','difflib.php',478],['lib/pear/HTML/QuickForm','select.php',58],['lib/classes/output','mustache_javascript_helper.php',40],['lib/phpexcel/PHPExcel/Reader/Excel2007','Theme.php',68],['mod/data','export_form.php',16],['lib/pear/HTML/QuickForm','autocomplete.php',67],['question/type/shortanswer','question.php',44],['lib/google/src/Google/Service','AndroidPublisher.php',52],['lib/google/src/Google/Verifier','Pem.php',31],['lib/classes/antivirus','scanner.php',41],['lib/phpexcel/PHPExcel/Reader','Excel5.php',414],['lib/horde/framework/Horde/Imap/Client/Auth','DigestMD5.php',69],['lib/classes/output','mustache_filesystem_loader.php',39],['lib/classes/output','inplace_editable.php',107],['lib/adodb/drivers','adodb-informix.inc.php',37],['competency/classes','competency_rule.php',45],['lib/phpexcel/PHPExcel','RichText.php',37],['lib/phpexcel/PHPExcel/Shared/JAMA','Matrix.php',59],['lib/pear/HTML/QuickForm','input.php',38],['repository/picasa','lib.php',41],['mod/feedback/classes','structure.php',48],['backup/util/plan','backup_structure_step.class.php',38],['question/classes/bank','random_question_loader.php',61],['mod/quiz/report/statistics/classes','calculated.php',43],['lib/horde/framework/Horde/Stream','String.php',27],['backup/util/helper','restore_decode_content.class.php',50],['backup/util/helper','restore_decode_content.class.php',125],['mod/workshop/backup/moodle1','lib.php',308],['lib/google/src/Google/Service','YouTubeReporting.php',47],['grade/export/txt','grade_export_txt.php',27],['lib/mustache/src/Mustache/Exception','SyntaxException.php',23],['lib/tcpdf','tcpdf_barcodes_2d.php',58],['mod/imscp','locallib.php',289],['lib/form','selectyesno.php',42],['lib/horde/framework/Horde/Mail/Transport','Smtphorde.php',62],['mod/lti/service/toolsettings/classes/local/service','toolsettings.php',41],['mod/lti/service/profile/classes/local/service','profile.php',41],['repository/flickr_public','lib.php',49],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','BackgroundPosition.php',57],['admin/tool/lp/classes/output','template_cohorts_table.php',53],['lib/simplepie/library','SimplePie.php',611],['lib/horde/framework/Horde/Imap/Client/Base','Debug.php',55],['lib/google/src/Google/Service','Reseller.php',44],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Border.php',18],['lib/testing/generator','component_generator_base.php',45],['lib/horde/framework/Horde/Translation/Handler','Gettext.php',34],['lib/phpexcel/PHPExcel/Worksheet','HeaderFooter.php',175],['lib/classes','plugin_manager.php',91],['lib/horde/framework/Horde/Imap/Client/Data/Format','List.php',28],['lib/horde/framework/Horde/Support','CombineStream.php',29],['lib/xmldb','xmldb_field.php',84],['lib/adodb/drivers','adodb-ibase.inc.php',59],['lib/adodb/drivers','adodb-ibase.inc.php',764],['lib/htmlpurifier/HTMLPurifier/AttrDef','URI.php',23],['admin/roles/classes','view_role_definition_table.php',28],['lib/google/src/Google/Cache','Memcache.php',44],['lib/pear/HTML/QuickForm','radio.php',48],['lib/filebrowser','file_info_context_coursecat.php',39],['lib/spout/src/Spout/Writer/ODS/Internal','Workbook.php',37],['mod/workshop/eval/best','lib.php',44],['lib/phpexcel/PHPExcel/Writer/PDF','DomPDF.php',38],['grade/report','lib.php',156],['lib','csslib.php',1501],['lib','csslib.php',1587],['lib','csslib.php',2068],['lib','csslib.php',2136],['lib','csslib.php',2242],['availability/classes','info_module.php',40],['mod/book','locallib.php',414],['question/engine','datalib.php',68],['question/engine','datalib.php',1331],['question/engine','datalib.php',1632],['question/engine','datalib.php',1740],['question/engine','datalib.php',1870],['question/engine','datalib.php',1941],['webservice','lib.php',745],['webservice','lib.php',841],['lib/adodb/drivers','adodb-informix72.inc.php',59],['lib/adodb/drivers','adodb-informix72.inc.php',399],['lib/adodb','adodb-pager.inc.php',60],['user/classes/output/myprofile','category.php',68],['lib/lessphp/Visitor','extendFinder.php',15],['backup/util/settings','base_setting.class.php',89],['backup/util/settings','base_setting.class.php',556],['lib','filelib.php',2720],['lib','filelib.php',3601],['lib/phpunit/classes','database_driver_testcase.php',55],['lib/phpexcel/PHPExcel/Shared/OLE/PPS','File.php',32],['report/competency/classes/output','report.php',56],['lib/google/src/Google/Service','Computeaccounts.php',49],['question/type','edit_question_form.php',96],['lib/filebrowser','file_info_context_user.php',39],['admin/tool/lp/classes/output','template_plans_page.php',37],['lib/phpexcel/PHPExcel','Style.php',93],['lib/minify/lib/Minify','HTML.php',49],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','ListStyle.php',20],['lib/form','password.php',44],['backup','backup.class.php',146],['mod/feedback/classes','course_select_form.php',39],['lib/google/src/Google/Auth','AppIdentity.php',39],['lib/adodb','adodb-active-record.inc.php',121],['lib/phpexcel/PHPExcel','Chart.php',169],['lib/horde/framework/Horde/Mail/Rfc822','List.php',61],['admin/roles/classes','allow_switch_page.php',33],['lib/grade','grade_object.php',80],['lib/google/src/Google/IO','Exception.php',29],['auth/lti','auth.php',38],['mod/quiz/report/statistics/classes','calculator.php',39],['lib/htmlpurifier','HTMLPurifier.php',104],['admin/tool/lp/classes/output','user_competency_summary_in_plan.php',47],['mod/assign/feedback/editpdf/classes','widget.php',53],['lib/evalmath','evalmath.class.php',120],['lib/form','url.php',46],['lib/dml','pdo_moodle_recordset.php',41],['lib/htmlpurifier/HTMLPurifier/TagTransform','Simple.php',19],['backup/cc/cc_lib','xmlbase.php',52],['badges/lib','bakerlib.php',52],['lib/google/src/Google/Signer','P12.php',35],['availability/classes','info_section.php',40],['lib/form','static.php',47],['backup/converter','convertlib.php',52],['backup/converter','convertlib.php',277],['lib/google/src/Google/Service','YouTubeAnalytics.php',56],['admin/roles/classes','check_capability_table.php',40],['lib/htmlpurifier/HTMLPurifier','AttrTypes.php',14],['lib/adodb/drivers','adodb-postgres64.inc.php',127],['lib/adodb/drivers','adodb-postgres64.inc.php',919],['backup/util/helper','restore_prechecks_helper.class.php',213],['user/profile','lib.php',59],['lib/google/src/Google/Service','Admin.php',40],['lib/spout/src/Spout/Reader/CSV','RowIterator.php',62],['lib/google/src/Google/Service','MapsEngine.php',66],['lib','listlib.php',82],['lib','listlib.php',485],['lib/phpexcel/PHPExcel/Writer','HTML.php',128],['backup/moodle2','restore_activity_task.class.php',48],['lib/htmlpurifier/HTMLPurifier','HTMLModuleManager.php',68],['lib/simplepie/library/SimplePie','Source.php',61],['completion','data_object.php',68],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','ID.php',28],['grade/report/singleview/classes/local/ui','dropdown_attribute.php',49],['lib/horde/framework/Horde/Support','Stack.php',18],['lib/google/src/Google/Cache','File.php',41],['lib/horde/framework/Horde/Mail/Transport','Mock.php',76],['backup/util/ui','backup_moodleform.class.php',41],['availability/condition/grouping/classes','condition.php',46],['lib/classes/session','memcache.php',50],['cache/classes','dummystore.php',62],['badges/classes','assertion.php',49],['lib/xhprof/xhprof_lib/utils','xhprof_runs.php',87],['availability/tests/fixtures','mock_condition.php',52],['lib/mustache/src/Mustache/Loader','FilesystemLoader.php',33],['mod/quiz/report','attemptsreport_options.php',95],['lib/phpexcel/PHPExcel/Writer/PDF','tcPDF.php',39],['lib/minify/lib/Minify/CSS','Compressor.php',51],['lib/google/src/Google/Service','Dns.php',53],['question/type/calculatedmulti','edit_calculatedmulti_form.php',47],['backup/moodle2','restore_block_task.class.php',45],['lib/phpexcel/PHPExcel/Worksheet','AutoFilter.php',54],['lib/form','recaptcha.php',48],['lib','csvlib.class.php',64],['lib','csvlib.class.php',398],['lib/simplepie/library/SimplePie/Cache','File.php',82],['lib/phpexcel/PHPExcel/Chart','Legend.php',75],['lib/phpexcel/PHPExcel','WorksheetIterator.php',44],['cache/classes','loaders.php',196],['cache/classes','loaders.php',1189],['cache/classes','loaders.php',1586],['lib/google/src/Google/Service','Appengine.php',44],['admin/tool/lp/classes/output','template_cohorts_page.php',37],['search/classes','engine.php',77],['backup/cc/cc_lib','cc_assesment_essay.php',25],['lib/classes/progress','display.php',48],['lib/lessphp/Tree','Call.php',19],['course/format','lib.php',78],['question/type/calculated','datasetdefinitions_form.php',53],['lib/google/src/Google/Service','Translate.php',40],['enrol/database','settingslib.php',34],['lib/lessphp/Tree/Mixin','Call.php',14],['admin/tool/log/store/standard/classes/log','store.php',37],['lib/google/src/Google/Service','Urlshortener.php',40],['lib/horde/framework/Horde/Imap/Client','Socket.php',168],['lib/tests','collator_test.php',310],['lib/google/src/Google/Auth','Simple.php',31],['backup/cc/cc_lib','cc_manifest.php',45],['lib/bennu','iCalendar_properties.php',28],['lib/bennu','iCalendar_properties.php',220],['lib/bennu','iCalendar_properties.php',238],['lib/bennu','iCalendar_properties.php',259],['lib/bennu','iCalendar_properties.php',275],['lib/bennu','iCalendar_properties.php',296],['lib/bennu','iCalendar_properties.php',343],['lib/bennu','iCalendar_properties.php',358],['lib/bennu','iCalendar_properties.php',376],['lib/bennu','iCalendar_properties.php',391],['lib/bennu','iCalendar_properties.php',406],['lib/bennu','iCalendar_properties.php',447],['lib/bennu','iCalendar_properties.php',462],['lib/bennu','iCalendar_properties.php',485],['lib/bennu','iCalendar_properties.php',509],['lib/bennu','iCalendar_properties.php',524],['lib/bennu','iCalendar_properties.php',555],['lib/bennu','iCalendar_properties.php',573],['lib/bennu','iCalendar_properties.php',594],['lib/bennu','iCalendar_properties.php',637],['lib/bennu','iCalendar_properties.php',680],['lib/bennu','iCalendar_properties.php',724],['lib/bennu','iCalendar_properties.php',747],['lib/bennu','iCalendar_properties.php',782],['lib/bennu','iCalendar_properties.php',808],['lib/bennu','iCalendar_properties.php',849],['lib/bennu','iCalendar_properties.php',864],['lib/bennu','iCalendar_properties.php',905],['lib/bennu','iCalendar_properties.php',938],['lib/bennu','iCalendar_properties.php',952],['lib/bennu','iCalendar_properties.php',965],['lib/bennu','iCalendar_properties.php',987],['lib/bennu','iCalendar_properties.php',1017],['lib/bennu','iCalendar_properties.php',1031],['lib/bennu','iCalendar_properties.php',1061],['lib/bennu','iCalendar_properties.php',1075],['lib/bennu','iCalendar_properties.php',1098],['lib/bennu','iCalendar_properties.php',1110],['lib/bennu','iCalendar_properties.php',1139],['lib/bennu','iCalendar_properties.php',1160],['lib/bennu','iCalendar_properties.php',1181],['lib/bennu','iCalendar_properties.php',1203],['lib/bennu','iCalendar_properties.php',1227],['lib/bennu','iCalendar_properties.php',1260],['lib/bennu','iCalendar_properties.php',1386],['lib/bennu','iCalendar_properties.php',1407],['lib/bennu','iCalendar_properties.php',1429],['lib/bennu','iCalendar_properties.php',1450],['lib/mustache/src/Mustache/Exception','UnknownTemplateException.php',22],['lib/phpmailer','moodle_phpmailer.php',47],['availability/tests/fixtures','mock_info.php',40],['lib/horde/framework/Horde/Mail/Transport','Smtpmx.php',138],['admin/tool/lp/classes/form','persistent.php',68],['lib/adodb/drivers','adodb-mysqlt.inc.php',32],['lib/adodb/drivers','adodb-mysqlt.inc.php',96],['webservice/tests','lib_test.php',213],['lib/horde/framework/Horde/Imap/Client/Data/Format','Mailbox.php',35],['filter','local_settings_form.php',33],['mod/quiz/accessrule','accessrulebase.php',52],['lib/horde/framework/Horde/Exception','Wrapped.php',16],['mod/assign/feedback/editpdf/fpdi','pdf_parser.php',170],['lib/lessphp/Tree','Dimension.php',15],['lib/minify/lib/HTTP','ConditionalGet.php',109],['lib/adodb/perf','perf-oci8.inc.php',203],['lib/phpexcel','PHPExcel.php',361],['backup/util/helper','restore_questions_parser_processor.class.php',42],['backup/moodle2','backup_plugin.class.php',44],['lib/classes/antivirus','scanner_exception.php',38],['webservice/xmlrpc','lib.php',43],['report/loglive/classes','renderable.php',73],['course','dnduploadlib.php',109],['course','dnduploadlib.php',407],['lib/filebrowser','file_info.php',43],['lib/adodb/drivers','adodb-access.inc.php',34],['lib/adodb/drivers','adodb-access.inc.php',83],['mod/feedback/classes','responses_table.php',54],['lib/editor/tinymce','adminlib.php',36],['admin/tool/monitor/classes','rule.php',44],['lib/google/src/Google/Service','AdExchangeBuyer.php',55],['lib/filebrowser','virtual_root_file.php',45],['lib/phpexcel/PHPExcel/RichText','Run.php',35],['admin/tool/monitor/classes/output/managesubs','subs.php',51],['auth/cas/CAS/CAS','ProxyChain.php',48],['lib/htmlpurifier/HTMLPurifier','DefinitionCache.php',22],['lib/google/src/Google/Service','CivicInfo.php',40],['mod/feedback/classes/output','summary.php',52],['lib/minify/lib/Minify','Build.php',77],['lib/adodb/drivers','adodb-ado_mssql.inc.php',146],['lib/adodb/drivers','adodb-odbc.inc.php',44],['lib/adodb/drivers','adodb-odbc.inc.php',611],['lib','moodlelib.php',9421],['lib','moodlelib.php',9632],['user/selector','lib.php',85],['user/selector','lib.php',674],['admin/tool/lp/classes/output','plan_page.php',49],['repository/dropbox','lib.php',49],['lib/horde/framework/Horde/Mime','Part.php',261],['lib/spout/src/Spout/Reader/XLSX/Helper/SharedStringsCaching','CachingStrategyFactory.php',56],['lib/phpexcel/PHPExcel/Chart','Layout.php',143],['lib/mustache/src/Mustache/Loader','CascadingLoader.php',20],['lib/phpexcel/PHPExcel/Shared/JAMA','EigenvalueDecomposition.php',777],['lib/google/src/Google/Service','Books.php',60],['lib/google/src/Google/Service','Oauth2.php',50],['admin/tool/log/classes/log','store.php',30],['admin/tool/recyclebin/classes','category_bin.php',45],['lib/phpexcel/PHPExcel/Style','Color.php',64],['lib/phpexcel/PHPExcel/Worksheet','SheetView.php',69],['lib/htmlpurifier/HTMLPurifier/Token','Text.php',34],['lib/classes/update','checker.php',50],['lib/horde/framework/Horde/Socket','Client.php',52],['lib/phpexcel/PHPExcel/CachedObjectStorage','APC.php',243],['lib/horde/framework/Horde/Imap/Client/Cache','Backend.php',33],['lib/phpexcel/PHPExcel/Chart','Title.php',45],['lib/horde/framework/Horde/Imap/Client/Data','Format.php',32],['lib/adodb/drivers','adodb-text.inc.php',93],['lib/adodb/drivers','adodb-text.inc.php',379],['lib/phpexcel/PHPExcel','Calculation.php',2071],['lib/adodb/drivers','adodb-sqlite.inc.php',36],['lib/adodb/drivers','adodb-sqlite.inc.php',367],['lib/google/src/Google/Service','Analytics.php',77],['blocks/lp/classes/output','plans_to_review_page.php',48],['lib/google/src/Google/Service','Coordinate.php',48],['availability/condition/group/classes','condition.php',43],['lib/lessphp/Exception','Chunk.php',19],['lib/htmlpurifier/HTMLPurifier','PropertyListIterator.php',22],['backup/cc/cc_lib','cc_resources.php',102],['lib/horde/framework/Horde/Mail/Rfc822','Group.php',45],['backup/util/structure','base_optigroup.class.php',35],['backup/util/structure','base_optigroup.class.php',169],['question/classes/statistics/questions','calculated.php',181],['lib/horde/framework/Horde/Imap/Client/Interaction','Command.php',72],['lib/htmlpurifier/HTMLPurifier/Strategy','Core.php',8],['lib/htmlpurifier/HTMLPurifier/Filter','ExtractStyleBlocks.php',57],['backup/cc/cc_lib','cc_converter_url.php',29],['lib/xmldb','xmldb_structure.php',40],['lib/ddl','sqlite_sql_generator.php',73],['lib/pear/HTML/QuickForm','Renderer.php',31],['backup/util/helper','restore_moodlexml_parser_processor.class.php',38],['lib/pear/HTML/QuickForm','file.php',54],['lib/minify/lib/Minify/Cache','File.php',9],['lib/pear/HTML/QuickForm','xbutton.php',39],['lib/htmlpurifier','locallib.php',134],['admin/tool/recyclebin/classes','course_bin.php',45],['backup/util/plan','backup_task.class.php',32],['backup/util/plan','backup_task.class.php',56],['lib/phpexcel/PHPExcel/CachedObjectStorage','PHPTemp.php',174],['backup/util/helper','backup_helper.class.php',381],['lib/form','htmleditor.php',48],['lib','oauthlib.php',65],['lib','oauthlib.php',409],['auth/cas/CAS/CAS/PGTStorage','File.php',105],['auth/cas/CAS/CAS/ProxiedService','Imap.php',51],['repository/skydrive','lib.php',42],['lib/htmlpurifier/HTMLPurifier','ErrorCollector.php',57],['lib/classes/lock','postgres_lock_factory.php',81],['lib/phpexcel/PHPExcel/CachedObjectStorage','SQLite.php',260],['lib/horde/framework/Horde/Support','ConsistentHash.php',56],['lib/horde/framework/Horde/Exception','Pear.php',22],['lib/portfolio','exceptions.php',50],['backup/moodle2','restore_plugin.class.php',43],['lib/phpexcel/PHPExcel/CachedObjectStorage','DiscISAM.php',177],['lib/google/src/Google/Service','DoubleClickBidManager.php',40],['lib/minify/lib/Minify/JS','ClosureCompiler.php',101],['lib/horde/framework/Horde/Imap/Client/Data/Format','String.php',38],['lib/form','dateselector.php',70],['lib/spout/src/Spout/Common/Helper','EncodingHelper.php',38],['report/competency/classes/output','user_course_navigation.php',51],['lib/adodb/drivers','adodb-postgres7.inc.php',98],['lib/adodb/drivers','adodb-postgres7.inc.php',311],['lib/adodb/drivers','adodb-postgres7.inc.php',342],['lib/lessphp/Tree','Alpha.php',13],['mod/lti/service/memberships/classes/local/resource','linkmemberships.php',46],['lib/tcpdf','tcpdf.php',1822],['lib/adodb/drivers','adodb-sybase.inc.php',47],['lib/adodb/drivers','adodb-sybase.inc.php',313],['lib/adodb/drivers','adodb-sybase.inc.php',394],['lib/phpexcel/PHPExcel/Chart','PlotArea.php',44],['lib/phpexcel/PHPExcel/Chart','DataSeries.php',136],['mod/lesson','editpage_form.php',41],['question/classes/statistics/responses','analysis_for_question.php',58],['lib/horde/framework/Horde','Domhtml.php',53],['lib','formslib.php',142],['lib','formslib.php',1442],['lib','formslib.php',2653],['rating','lib.php',114],['rating','lib.php',1070],['lib/phpexcel/PHPExcel/Worksheet','Column.php',44],['lib/google/src/Google/Service','Script.php',67],['lib/adodb','adodb-xmlschema.inc.php',118],['lib/adodb','adodb-xmlschema.inc.php',245],['lib/adodb','adodb-xmlschema.inc.php',637],['lib/adodb','adodb-xmlschema.inc.php',781],['lib/adodb','adodb-xmlschema.inc.php',982],['lib/adodb','adodb-xmlschema.inc.php',1295],['lib/google/src/Google/Service','DeploymentManager.php',54],['mod/quiz','attemptlib.php',41],['mod/quiz','attemptlib.php',82],['mod/quiz','attemptlib.php',546],['mod/quiz','attemptlib.php',2337],['mod/quiz','attemptlib.php',2392],['backup/cc/cc_lib','cc_converter_forum.php',29],['lib','boxlib.php',264],['lib/simplepie/library/SimplePie','Restriction.php',81],['admin/roles/classes','allow_assign_page.php',31],['lib/adodb/drivers','adodb-pdo.inc.php',90],['lib/adodb/drivers','adodb-pdo.inc.php',553],['lib/adodb/drivers','adodb-pdo.inc.php',630],['tag/classes/output','tagareacollection.php',40],['admin/tool/lp/classes','template_statistics.php',62],['lib','weblib.php',313],['lib','weblib.php',3183],['lib','weblib.php',3483],['lib','weblib.php',3518],['lib','weblib.php',3593],['backup/cc/cc_lib','cc_converter_basiclti.php',29],['lib/html2text','Html2Text.php',232],['mod/assign/feedback/editpdf/classes','annotation.php',66],['lib/pear/HTML/QuickForm/Renderer','Array.php',143],['question/engine','lib.php',774],['question/engine','lib.php',1011],['question/engine','lib.php',1059],['lib/jabber/XMPP','XMLObj.php',76],['lib/horde/framework/Horde/Exception','PermissionDenied.php',15],['lib/editor/atto','adminlib.php',109],['lib/pear/HTML/QuickForm/Renderer','Tableless.php',116],['grade/report/history/classes/output','tablelog.php',72],['lib/google/src/Google/IO','Curl.php',38],['lib/editor/tinymce/plugins/spellchecker/classes/utils','Logger.php',31],['lib/pear/HTML/QuickForm','hiddenselect.php',41],['backup/util/ui','backup_ui_setting.class.php',70],['backup/util/ui','backup_ui_setting.class.php',200],['backup/util/ui','backup_ui_setting.class.php',398],['backup/util/ui','backup_ui_setting.class.php',504],['backup/util/ui','backup_ui_setting.class.php',583],['lib/adodb/drivers','adodb-mysqlpo.inc.php',35],['lib/adodb/drivers','adodb-mysqlpo.inc.php',82],['lib/adodb/drivers','adodb-mysqlpo.inc.php',119],['lib/google/src/Google/Service','Blogger.php',50],['backup/util/xml/output','file_xml_output.class.php',37],['lib/form','tags.php',75],['admin/tool/installaddon/classes','installer.php',219],['lib/htmlpurifier/HTMLPurifier/AttrDef','Enum.php',30],['lib/simplepie/library/SimplePie','IRI.php',252],['comment','locallib.php',39],['question/engine','states.php',61],['lib/spout/src/Spout/Reader/XLSX/Helper','CellValueFormatter.php',52],['lib/google/src/Google/Service','Dataflow.php',45],['mod/data','locallib.php',66],['mod/data','locallib.php',433],['lib/horde/framework/Horde','Variables.php',60],['backup/util/ui','base_ui.class.php',84],['lib/simplepie/library/SimplePie','Registry.php',99],['cache/locks/file','lib.php',66],['question/classes/statistics/responses','analysis_for_class.php',68],['lib/filebrowser','file_info_stored.php',51],['tag/classes/output','tagcollname.php',42],['competency/classes','persistent.php',54],['admin/tool/lp/classes/output','competency_plan_navigation.php',54],['lib/phpexcel/PHPExcel/Cell','DataValidation.php',146],['lib/pear/HTML/QuickForm','textarea.php',48],['lib/lessphp','Visitor.php',14],['lib/google/src/Google/Service','CloudUserAccounts.php',52],['question/classes/bank','column_base.php',44],['lib/minify/lib/MrClay','Cli.php',74],['lib','outputcomponents.php',80],['lib','outputcomponents.php',204],['lib','outputcomponents.php',469],['lib','outputcomponents.php',523],['lib','outputcomponents.php',589],['lib','outputcomponents.php',665],['lib','outputcomponents.php',783],['lib','outputcomponents.php',925],['lib','outputcomponents.php',1009],['lib','outputcomponents.php',2183],['lib','outputcomponents.php',2222],['lib','outputcomponents.php',2295],['lib','outputcomponents.php',2376],['lib','outputcomponents.php',2579],['lib','outputcomponents.php',2627],['lib','outputcomponents.php',2687],['lib','outputcomponents.php',2860],['lib','outputcomponents.php',3030],['lib','outputcomponents.php',3134],['lib','outputcomponents.php',3201],['lib','outputcomponents.php',3329],['lib','outputcomponents.php',3613],['lib','outputcomponents.php',3642],['lib','outputcomponents.php',3668],['lib','outputcomponents.php',3690],['lib','outputcomponents.php',3719],['lib','outputcomponents.php',3751],['lib/google/src/Google/Service','Pagespeedonline.php',39],['lib/phpexcel/PHPExcel','Cell.php',114],['lib/dml','sqlsrv_native_moodle_recordset.php',40],['repository/wikimedia','wikimedia.php',35],['lib/phpexcel/PHPExcel/Style','Fill.php',81],['lib/google/src/Google/Service','Cloudresourcemanager.php',42],['lib/editor/tinymce/classes','plugin.php',49],['mod/wiki/parser/markups','html.php',21],['lib/simplepie/library/SimplePie/Parse','Date.php',536],['lib/horde/framework/Horde/Support','Inflector.php',115],['question/type/gapselect','question.php',55],['lib/google/src/Google','Config.php',33],['badges/criteria','award_criteria_activity.php',45],['backup/util/xml/output','xml_output.class.php',52],['backup/util/xml/output','xml_output.class.php',158],['course/format/topics','renderer.php',38],['lib/adodb/drivers','adodb-oci8po.inc.php',33],['lib/adodb/drivers','adodb-oci8po.inc.php',99],['mod/workshop/allocation/random','lib.php',52],['mod/workshop/allocation/random','lib.php',727],['backup/util/structure','base_final_element.class.php',38],['backup/util/structure','base_final_element.class.php',239],['backup/util/structure','base_final_element.class.php',256],['lib/htmlpurifier/HTMLPurifier','Zipper.php',25],['lib/horde/framework/Horde/Imap/Client/Data','Thread.php',41],['lib/mustache/src/Mustache/Exception','UnknownHelperException.php',22],['backup/util/settings/activity','activity_backup_setting.class.php',25],['lib/filestorage','tgz_packer.php',749],['lib/filestorage','tgz_packer.php',831],['tag/classes','index_builder.php',96],['lib/pear/HTML/QuickForm','reset.php',37],['lib/classes/lock','lock.php',55],['admin/roles/classes','assign_user_selector_base.php',40],['backup/util/output','output_controller.class.php',44],['question/type/randomsamatch','question.php',114],['lib/google/src/Google/Service','Customsearch.php',38],['lib/lessphp/Tree','Extend.php',28],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',215],['lib/google/src/Google/Service','TagManager.php',67],['question/type/gapselect/tests','edit_form_test.php',41],['mod/lesson','locallib.php',2004],['mod/lesson','locallib.php',2611],['backup/util/helper','restore_structure_parser_processor.class.php',41],['course','renderer.php',52],['backup/util/xml/parser/processors','selective_exact_parser_processor.class.php',35],['lib','modinfolib.php',429],['lib','modinfolib.php',1665],['lib','modinfolib.php',2492],['lib','tablelib.php',128],['lib','tablelib.php',1468],['lib','tablelib.php',1633],['lib','tablelib.php',1698],['user/filters','cohort.php',36],['user/filters','text.php',37],['lib','outputrenderers.php',120],['lib','outputrenderers.php',285],['lib','outputrenderers.php',408],['lib','outputrenderers.php',4578],['lib','outputrenderers.php',4831],['repository','lib.php',116],['repository','lib.php',533],['lib','adminlib.php',791],['lib','adminlib.php',1138],['lib','adminlib.php',1212],['lib','adminlib.php',1355],['lib','adminlib.php',1556],['lib','adminlib.php',1928],['lib','adminlib.php',2040],['lib','adminlib.php',2106],['lib','adminlib.php',2199],['lib','adminlib.php',2260],['lib','adminlib.php',2302],['lib','adminlib.php',2341],['lib','adminlib.php',2429],['lib','adminlib.php',2463],['lib','adminlib.php',2621],['lib','adminlib.php',2706],['lib','adminlib.php',2935],['lib','adminlib.php',3091],['lib','adminlib.php',3233],['lib','adminlib.php',3324],['lib','adminlib.php',3488],['lib','adminlib.php',3571],['lib','adminlib.php',3682],['lib','adminlib.php',3833],['lib','adminlib.php',4067],['lib','adminlib.php',4134],['lib','adminlib.php',4352],['lib','adminlib.php',4381],['lib','adminlib.php',4410],['lib','adminlib.php',4434],['lib','adminlib.php',4464],['lib','adminlib.php',4500],['lib','adminlib.php',4535],['lib','adminlib.php',4567],['lib','adminlib.php',4657],['lib','adminlib.php',4690],['lib','adminlib.php',4748],['lib','adminlib.php',4790],['lib','adminlib.php',4814],['lib','adminlib.php',4840],['lib','adminlib.php',4863],['lib','adminlib.php',4880],['lib','adminlib.php',4925],['lib','adminlib.php',4943],['lib','adminlib.php',5002],['lib','adminlib.php',5045],['lib','adminlib.php',5080],['lib','adminlib.php',5123],['lib','adminlib.php',5206],['lib','adminlib.php',5336],['lib','adminlib.php',5378],['lib','adminlib.php',5423],['lib','adminlib.php',5480],['lib','adminlib.php',5496],['lib','adminlib.php',5552],['lib','adminlib.php',5777],['lib','adminlib.php',5831],['lib','adminlib.php',5885],['lib','adminlib.php',5902],['lib','adminlib.php',5950],['lib','adminlib.php',5992],['lib','adminlib.php',6043],['lib','adminlib.php',6099],['lib','adminlib.php',6328],['lib','adminlib.php',6508],['lib','adminlib.php',6688],['lib','adminlib.php',6782],['lib','adminlib.php',6931],['lib','adminlib.php',7088],['lib','adminlib.php',7712],['lib','adminlib.php',8147],['lib','adminlib.php',8330],['lib','adminlib.php',8617],['lib','adminlib.php',8764],['lib','adminlib.php',8924],['lib','adminlib.php',9071],['lib','adminlib.php',9235],['lib','adminlib.php',9428],['lib','adminlib.php',9482],['lib','adminlib.php',9544],['lib','adminlib.php',9589],['lib','adminlib.php',9626],['backup/cc/cc_lib','cc_organization.php',47],['backup/cc/cc_lib','cc_organization.php',145],['lib/phpexcel/PHPExcel/Chart','DataSeriesValues.php',81],['lib/horde/framework/Horde/Mail/Rfc822','Identification.php',34],['question/type/numerical','questiontype.php',507],['auth/mnet','auth.php',35],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Cache.php',68],['lib/htmlpurifier/HTMLPurifier','PropertyList.php',29],['auth/imap','auth.php',35],['tag/classes/output','taglist.php',54],['lib','pdflib.php',161],['lib/phpexcel/PHPExcel/RichText','TextElement.php',35],['lib/dml','database_column_info.php',112],['lib/horde/framework/Horde/Imap/Client/Exception','NoSupportExtension.php',33],['mod/wiki/editors','wikieditor.php',36],['lib/lessphp/SourceMap','Base64VLQ.php',67],['repository/s3','lib.php',44],['admin/tool/uploadcourse/classes','course.php',111],['lib/google/src/Google/Service','Replicapoolupdater.php',51],['lib/horde/framework/Horde/Imap/Client/Data/Format','Date.php',25],['lib/bennu','iCalendar_components.php',21],['lib/bennu','iCalendar_components.php',333],['lib/bennu','iCalendar_components.php',355],['lib/bennu','iCalendar_components.php',433],['lib/bennu','iCalendar_components.php',513],['lib/bennu','iCalendar_components.php',551],['lib/bennu','iCalendar_components.php',602],['lib/bennu','iCalendar_components.php',659],['lib/bennu','iCalendar_components.php',679],['lib/phpexcel/PHPExcel/Calculation','FormulaToken.php',102],['mod/feedback/item','feedback_item_class.php',28],['lib/adodb/drivers','adodb-mssql_n.inc.php',245],['lib','badgeslib.php',133],['lib/pear/HTML/QuickForm','text.php',38],['lib/simplepie/library/SimplePie','Enclosure.php',219],['calendar/classes','rrule_manager.php',182],['auth/webservice','auth.php',35],['lib','outputrequirementslib.php',171],['mod/lti/service/toolsettings/classes/local/resource','contextsettings.php',44],['lib','questionlib.php',1261],['lib','questionlib.php',1505],['lib','uploadlib.php',40],['lib/spout/src/Spout/Writer/Common/Helper','ZipHelper.php',28],['lib/google/src/Google/Service','Cloudsearch.php',40],['backup/util/structure','backup_nested_element.class.php',44],['lib/spout/src/Spout/Writer/Common','Sheet.php',39],['question/behaviour','behaviourbase.php',50],['blocks/rss_client/classes/output','footer.php',47],['lib/dtl','file_xml_database_importer.php',34],['admin/roles/classes','capability_table_with_risks.php',45],['lib/adodb/drivers','adodb-mssql.inc.php',110],['lib/adodb/drivers','adodb-mssql.inc.php',870],['lib/adodb/drivers','adodb-mssql.inc.php',1077],['lib/google/src/Google/Service','Bigquery.php',62],['lib/google/src/Google/Service','ShoppingContent.php',50],['mod/lti','OAuth.php',73],['mod/lti','OAuth.php',89],['mod/lti','OAuth.php',244],['mod/lti','OAuth.php',499],['repository/equella','lib.php',42],['lib/phpexcel/PHPExcel/Worksheet','PageMargins.php',80],['backup/cc/cc_lib','cc_converter_quiz.php',33],['lib/horde/framework/Horde/Imap/Client/Interaction','Pipeline.php',60],['lib/phpexcel/PHPExcel/Shared/trend','polynomialBestFitClass.php',199],['backup/util/helper','restore_decode_processor.class.php',47],['backup/util/helper','restore_decode_processor.class.php',182],['cache/classes','helper.php',90],['lib/simplepie/library/SimplePie','Credit.php',81],['lib/classes','chart_series.php',62],['lib/classes/dml','recordset_walk.php',64],['lib/google/src/Google/Service','Webmasters.php',47],['lib/tcpdf/include/barcodes','qrcode.php',631],['backup/moodle2','backup_settingslib.php',42],['backup/moodle2','backup_settingslib.php',138],['lib/spout/src/Spout/Writer/XLSX/Helper','SharedStringsHelper.php',40],['course/tests/fixtures','course_capability_assignment.php',60],['mod/forum/classes','subscriber_selector_base.php',53],['lib','blocklib.php',54],['lib','blocklib.php',152],['report/loglive/classes','table_log.php',50],['lib','navigationlib.php',147],['lib','navigationlib.php',1015],['lib','navigationlib.php',2825],['lib','navigationlib.php',3086],['lib','navigationlib.php',3412],['lib','navigationlib.php',3459],['lib','navigationlib.php',4888],['lib','navigationlib.php',5070],['lib/phpexcel/PHPExcel/Shared/JAMA','CholeskyDecomposition.php',41],['grade/report/history/classes/output','user_button.php',40],['user/filters','courserole.php',34],['lib/phpexcel/PHPExcel','IOFactory.php',69],['lib/lessphp/Tree','Color.php',15],['lib/phpexcel/PHPExcel/Worksheet','MemoryDrawing.php',70],['lib/adodb/drivers','adodb-vfp.inc.php',72],['lib/horde/framework/Horde/Support','Backtrace.php',20],['lib/google/src/Google/Service','Clouddebugger.php',50],['lib/horde/framework/Horde/Exception','NotFound.php',15],['admin/tool/lp/classes/output','user_competency_course_navigation.php',55],['lib/lessphp/Tree','UnicodeDescriptor.php',14],['lib/phpexcel/PHPExcel/Worksheet','PageSetup.php',277],['grade/report/singleview/classes/local/ui','bulk_insert.php',40],['lib','mathslib.php',45],['lib/filestorage','tgz_extractor.php',119],['lib/horde/framework/Horde/Imap/Client/Interaction/Command','Continuation.php',42],['lib/horde/framework/Horde/Imap/Client','Exception.php',247],['filter/emoticon/tests','filter_test.php',68],['mnet/xmlrpc','xmlparser.php',15],['lib/spout/src/Spout/Reader/XLSX','Sheet.php',31],['admin/roles/classes','capability_table_base.php',51],['lib/simplepie/library/SimplePie','Item.php',82],['lib/form','selectgroups.php',57],['auth/shibboleth','auth.php',38],['admin/tool/langimport/classes','controller.php',48],['lib/form','warning.php',49],['lib/filestorage','stored_file.php',63],['grade/grading/form/guide','guideeditor.php',49],['lib/pear/HTML/QuickForm','group.php',80],['backup/moodle2','restore_subplugin.class.php',45],['grade/export','lib.php',60],['grade/export','lib.php',625],['lib/phpexcel/PHPExcel/Style','NumberFormat.php',98],['backup/moodle2','backup_section_task.class.php',40],['lib/htmlpurifier/HTMLPurifier','Config.php',100],['lib','flickrlib.php',53],['mod/assign/classes/output','grading_app.php',59],['grade/report/singleview/classes/local/ui','grade_attribute_format.php',47],['user/profile/field/menu','field.class.php',39],['lib/spout/src/Spout/Writer/Common/Internal','AbstractWorkbook.php',30],['lib/portfolio','exporter.php',113],['lib','ddllib.php',80],['lib','ddllib.php',93],['lib','ddllib.php',107],['lib','ddllib.php',126],['lib','ddllib.php',140],['lib/horde/framework/Horde/Crypt','Blowfish.php',54],['lib/horde/framework/Horde','Secret.php',48],['lib/htmlpurifier/HTMLPurifier/AttrDef','Integer.php',36],['lib/classes/update','info.php',48],['lib/htmlpurifier/HTMLPurifier/ConfigSchema','ValidatorAtom.php',31],['lib/lessphp/Tree','Anonymous.php',21],['admin/tool/lp/classes','course_competencies_form_element.php',43],['lib/lessphp/Tree','Comment.php',17],['auth/cas/CAS/CAS','OutOfSequenceBeforeAuthenticationCallException.php',47],['question/type/calculatedsimple','edit_calculatedsimple_form.php',72],['lib/adodb/drivers','adodb-mysql.inc.php',54],['lib/adodb/drivers','adodb-mysql.inc.php',717],['lib/adodb/drivers','adodb-mysql.inc.php',880],['enrol/ldap','lib.php',43],['mod/quiz/report/statistics','statistics_table.php',45],['lib/form','listing.php',68],['lib/google/src/Google/Service','Container.php',43],['mod/quiz','accessmanager.php',45],['lib/classes/message/inbound','processing_failed_exception.php',36],['blocks/online_users/classes','fetcher.php',45],['lib/pear/HTML/QuickForm','checkbox.php',48],['auth/cas/CAS/CAS','OutOfSequenceBeforeProxyException.php',48],['mod/lti/service/toolproxy/classes/local/service','toolproxy.php',41],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','URI.php',15],['lib/classes','chart_axis.php',65],['mod/glossary/classes','entry_query_builder.php',83],['mod/feedback/item/label','lib.php',26],['lib/adodb/drivers','adodb-mssqlnative.inc.php',131],['lib/adodb/drivers','adodb-mssqlnative.inc.php',847],['lib/adodb/drivers','adodb-mssqlnative.inc.php',1099],['lib/horde/framework/Horde/Imap/Client','Ids.php',78],['lib/form','editor.php',62],['lib','environmentlib.php',1258],['mod/workshop','fileinfolib.php',43],['mod/workshop','fileinfolib.php',198],['mod/feedback/classes','templates_table.php',39],['tag/classes','manage_table.php',44],['lib/adodb/drivers','adodb-odbc_db2.inc.php',115],['lib/adodb/drivers','adodb-odbc_db2.inc.php',309],['backup/cc/cc_lib/gral_lib','cssparser.php',21],['lib/horde/framework/Horde/Support','Array.php',21],['lib/google/src/Google/Service','GroupsMigration.php',40],['admin/tool/lp/classes/output','user_evidence_list_page.php',61],['lib/google/src/Google/Service','Audit.php',39],['lib/simplepie/library/SimplePie','File.php',68],['lib/horde/framework/Horde/Imap/Client','Mailbox.php',62],['enrol/lti/classes','manage_table.php',62],['lib/simplepie/library/SimplePie/Content/Type','Sniffer.php',69],['question/type','questionbase.php',124],['question/type','questionbase.php',438],['question/type','questionbase.php',531],['question/type','questionbase.php',750],['question/type','questionbase.php',835],['question/type','questionbase.php',868],['question/type','questionbase.php',914],['question/type','questionbase.php',1013],['question/type/ddimageortext','question.php',64],['question/type/ddimageortext','question.php',122],['lib','excellib.class.php',47],['lib','excellib.class.php',155],['lib','excellib.class.php',456],['lib/minify/lib','CSSmin.php',43],['lib/dml','moodle_temptables.php',51],['lib/minify/lib/Minify/Cache','ZendPlatform.php',23],['backup/util/xml/parser','progressive_parser.class.php',79],['backup/util/xml/parser','progressive_parser.class.php',305],['blocks/rss_client/classes/output','block.php',47],['question/type/ddmarker','question.php',417],['question/type/ddmarker','question.php',469],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Percentage.php',18],['admin/tool/lp/classes/output','user_competency_summary_in_course.php',51],['backup/util/helper','convert_helper.class.php',378],['lib/classes/update','validator.php',265],['lib/lessphp/Tree','Attribute.php',16],['admin/tool/generator/classes','backend.php',84],['backup/util/loggers','file_logger.class.php',35],['lib/adodb','adodb-exceptions.inc.php',30],['lib/google/src/Google','Client.php',70],['user/filters','profilefield.php',36],['backup/util/helper','restore_inforef_parser_processor.class.php',37],['cache/tests/fixtures','lib.php',326],['mod/lti/service/profile/classes/local/resource','profile.php',43],['competency/classes','invalid_persistent_exception.php',38],['backup/util/plan','backup_plan.class.php',36],['backup/util/plan','backup_plan.class.php',130],['lib/phpexcel/PHPExcel/Writer/Excel2007','WriterPart.php',63],['backup/util/settings','setting_dependency.class.php',68],['backup/util/settings','setting_dependency.class.php',175],['backup/util/settings','setting_dependency.class.php',328],['backup/util/settings','setting_dependency.class.php',439],['backup/util/settings','setting_dependency.class.php',465],['backup/util/settings','setting_dependency.class.php',491],['backup/util/settings','setting_dependency.class.php',556],['backup/util/xml','xml_writer.class.php',57],['backup/util/xml','xml_writer.class.php',284],['enrol/imsenterprise','locallib.php',38],['enrol/imsenterprise','locallib.php',115],['lib/dml','moodle_database.php',139],['search/classes','base.php',69],['admin/tool/lp/classes/output','competency_summary.php',54],['lib','upgradelib.php',45],['lib','upgradelib.php',61],['lib','upgradelib.php',76],['lib','upgradelib.php',94],['lib','upgradelib.php',111],['lib/htmlpurifier/HTMLPurifier/AttrTransform','NameSync.php',11],['mod/workshop/form/rubric','lib.php',105],['grade','lib.php',103],['grade','lib.php',927],['grade','lib.php',1089],['grade','lib.php',2053],['grade','lib.php',2213],['lib/horde/framework/Horde/Imap/Client/Data','Acl.php',32],['lib/phpexcel/PHPExcel/Reader/Excel5','RC4.php',35],['lib/google/src/Google/Service','Datastore.php',46],['admin/tool/lpmigrate/classes','framework_processor.php',98],['lib/dtl','database_importer.php',61],['lib/horde/framework/Horde/Imap/Client/Password','Xoauth2.php',44],['badges/lib','awardlib.php',55],['backup/util/helper','backup_array_iterator.class.php',39],['admin/tool/monitor/classes','subscription.php',43],['question/type/calculated','edit_calculated_form.php',51],['lib/spout/src/Spout/Reader/XLSX/Helper/SharedStringsCaching','FileBasedStrategy.php',57],['lib/form','datetimeselector.php',72],['lib/horde/framework/Horde/Imap/Client','Base.php',153],['lib/classes','collator.php',58],['admin/tool/lp/classes','course_competency_statistics.php',48],['lib/google/src/Google/Service','Storage.php',57],['lib/spout/src/Spout/Reader/CSV','SheetIterator.php',28],['lib/lessphp/Tree','Paren.php',14],['mod/lti/classes','service_exception_handler.php',63],['lib/tcpdf/include/barcodes','pdf417.php',523],['mod/assign/feedback/offline','importgradeslib.php',66],['lib/filestorage','file_exceptions.php',36],['lib/filestorage','file_exceptions.php',57],['lib/filestorage','file_exceptions.php',89],['lib/filestorage','file_exceptions.php',108],['lib/filestorage','file_exceptions.php',129],['lib/horde/framework/Horde/Mail/Transport','Smtp.php',100],['lib/htmlpurifier/HTMLPurifier/ConfigSchema/Interchange','Id.php',17],['question/engine/upgrade','upgradelib.php',283],['question/engine/upgrade','upgradelib.php',384],['question/type/numerical','question.php',323],['lib/pear/PEAR','Exception.php',107],['course/format','renderer.php',44],['lib/dml','oci_native_moodle_recordset.php',34],['question/behaviour','behaviourtypebase.php',133],['lib/pear/HTML','QuickForm.php',246],['lib/pear/HTML','QuickForm.php',1979],['backup/util/structure','base_atom.class.php',41],['backup/util/structure','base_atom.class.php',114],['backup/util/structure','base_atom.class.php',135],['backup/util/structure','base_atom.class.php',156],['lib/horde/framework/Horde/Imap/Client/Data','BaseSubject.php',39],['lib/google/src/Google/Auth','LoginTicket.php',37],['lib/adodb/drivers','adodb-csv.inc.php',41],['lib/adodb/drivers','adodb-csv.inc.php',196],['user/filters','yesno.php',33],['mod/wiki/parser','parser.php',98],['lib/htmlpurifier/HTMLPurifier/Token','Comment.php',19],['lib/phpexcel/PHPExcel/Calculation','FormulaParser.php',87],['backup/cc/cc_lib','cc_assesment_truefalse.php',27],['lib/htmlpurifier/HTMLPurifier','Encoder.php',10],['admin/tool/lpmigrate/classes/form','migrate_framework.php',45],['backup/util/xml/parser/tests','parser_test.php',797],['lib/htmlpurifier/HTMLPurifier/AttrTransform','EnumToCSS.php',34],['lib/tests','medialib_test.php',644],['lib/google/src/Google/Service','QPXExpress.php',39],['tag/classes/output','tagname.php',41],['lib/mustache/src/Mustache','Context.php',20],['lib/adodb/drivers','adodb-oracle.inc.php',32],['lib/adodb/drivers','adodb-oracle.inc.php',224],['backup/moodle2','restore_section_task.class.php',42],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Composite.php',25],['lib/htmlpurifier/HTMLPurifier/AttrTransform','Nofollow.php',16],['mod/forum/classes/output','forum_post.php',110],['admin/tool/assignmentupgrade','locallib.php',50],['admin/tool/assignmentupgrade','locallib.php',93],['repository/googledocs','lib.php',65],['cache/stores/memcache','lib.php',120],['lib/filestorage','file_storage.php',78],['admin/tool/monitor/classes/output/managerules','renderable.php',56],['mod/lti/service/toolsettings/classes/local/resource','linksettings.php',45],['lib/form','duration.php',55],['lib','outputlib.php',480],['lib','outputlib.php',2038],['filter/tex','latex.php',13],['backup/moodle2','backup_course_task.class.php',39],['lib/adodb','adodb.inc.php',310],['lib/adodb','adodb.inc.php',3035],['lib/adodb','adodb.inc.php',3160],['lib/adodb','adodb.inc.php',3242],['lib/adodb','adodb.inc.php',4353],['lib/horde/framework/Horde/Support','Randomid.php',26],['lib/google/src/Google/Logger','File.php',51],['admin/roles/classes','allow_role_page.php',37],['mod/quiz/report/overview','overview_table.php',41],['lib/lessphp/Tree','Keyword.php',17],['lib/htmlpurifier/HTMLPurifier/Node','Comment.php',19],['question/type/ddmarker','questiontype.php',48],['mod/folder','renderer.php',159],['lib','portfoliolib.php',101],['tag/classes/output','tagcollsearchable.php',40],['webservice/soap/classes','wsdl.php',88],['lib/lessphp/Exception','Parser.php',30],['badges','renderer.php',973],['badges','renderer.php',1014],['badges','renderer.php',1078],['badges','renderer.php',1111],['badges','renderer.php',1137],['competency/classes/external','exporter.php',56],['mod/lti/service/toolproxy/classes/local/resource','toolproxy.php',47],['lib/google/src/Google/Service','Genomics.php',63],['lib/phpexcel/PHPExcel/Writer','PDF.php',38],['lib/phpexcel/PHPExcel/Shared/trend','exponentialBestFitClass.php',125],['lib/google/src/Google/Service','Games.php',60],['backup/converter/moodle1','lib.php',725],['backup/converter/moodle1','lib.php',865],['backup/converter/moodle1','lib.php',1145],['backup/converter/moodle1','lib.php',1190],['backup/converter/moodle1','lib.php',1480],['backup/util/helper','restore_logs_processor.class.php',45],['backup/util/helper','restore_logs_processor.class.php',141],['lib/htmlpurifier/HTMLPurifier/AttrTransform','Input.php',14],['lib/google/src/Google/Service','Licensing.php',40],['mod/workshop/form/comments','lib.php',99],['backup/util/settings/section','section_backup_setting.class.php',25],['lib/htmlpurifier/HTMLPurifier','Doctype.php',48],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Font.php',22],['lib/google/src/Google/Service','Fitness.php',58],['blocks/private_files','renderer.php',83],['lib/phpexcel/PHPExcel/Worksheet','ColumnCellIterator.php',51],['enrol/flatfile','adminlib.php',35],['lib/xmldb','xmldb_object.php',55],['lib/google/src/Google/Service','Reports.php',47],['question/classes/statistics/responses','analysis_for_actual_response.php',70],['auth/pam','auth.php',53],['lib/horde/framework/Horde','Stream.php',50],['comment','lib.php',100],['lib/htmlpurifier/HTMLPurifier','URIParser.php',10],['lib/htmlpurifier/HTMLPurifier/Node','Text.php',35],['lib/phpexcel/PHPExcel/Worksheet','RowDimension.php',53],['lib/google/src/Google/Service','Gmail.php',64],['lib/google/src/Google/Service','Taskqueue.php',44],['lib/minify/lib/Minify','ImportProcessor.php',48],['lib/horde/framework/Horde/Mime','Related.php',32],['blocks','moodleblock.class.php',111],['lib/tcpdf','tcpdf_parser.php',92],['backup/util/plan','restore_structure_step.class.php',46],['blocks/rss_client/classes/output','channel_image.php',61],['lib/pear/HTML/QuickForm','hierselect.php',105],['question/type/numerical/tests','form_test.php',40],['badges/lib','backpacklib.php',40],['mod/workshop/allocation/manual','lib.php',51],['mod/quiz/report/responses','last_responses_table.php',39],['lib/simplepie','autoloader.php',62],['lib/spout/src/Spout/Common/Helper','StringHelper.php',21],['lib/phpexcel/PHPExcel/Worksheet','BaseDrawing.php',121],['lib/pear/Crypt','CHAP.php',82],['lib/pear/Crypt','CHAP.php',170],['lib/pear/Crypt','CHAP.php',424],['lib/spout/src/Spout/Writer/Common/Helper','AbstractStyleHelper.php',22],['backup/util/xml/parser/processors','progressive_parser_processor.class.php',57],['mod/quiz/classes/question','qubaids_for_users_attempts.php',37],['lib/spout/src/Spout/Reader/XLSX','RowIterator.php',63],['lib/phpexcel/PHPExcel/Reader/Excel5','Escher.php',77],['lib/simplepie/library/SimplePie','gzdecode.php',186],['mod/wiki','renderer.php',540],['lib/adodb','adodb-active-recordx.inc.php',138],['availability/classes','result.php',46],['lib','accesslib.php',5352],['lib','accesslib.php',5897],['lib','accesslib.php',6167],['lib','accesslib.php',6408],['lib','accesslib.php',6595],['lib','accesslib.php',6827],['lib','accesslib.php',7049],['lib','accesslib.php',7291],['lib/phpexcel/PHPExcel/Shared/OLE','PPS.php',110],['grade/grading/form','lib.php',82],['grade/grading/form','lib.php',766],['question/engine','questionusage.php',78],['question/engine','questionusage.php',973],['auth/manual','auth.php',46],['question/engine/upgrade','behaviourconverters.php',78],['mod/wiki/diff','diff_nwiki.php',35],['mod/wiki/diff','diff_nwiki.php',50],['mod/wiki/diff','diff_nwiki.php',63],['mod/wiki/diff','diff_nwiki.php',76],['mod/wiki/diff','diff_nwiki.php',495],['mod/wiki/diff','diff_nwiki.php',640],['mod/wiki/diff','diff_nwiki.php',850],['mod/wiki/diff','diff_nwiki.php',901],['mod/wiki/diff','diff_nwiki.php',953],['lib/adodb/drivers','adodb-proxy.inc.php',28],['lib/classes/lock','file_lock_factory.php',57],['lib/google/src/Google/Auth','OAuth2.php',55],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','Pixels.php',17],['lib/filebrowser','file_info_context_module.php',47],['auth/none','auth.php',34],['lib/simplepie/library/SimplePie/Cache','Base.php',70],['lib/htmlpurifier/HTMLPurifier','Queue.php',24],['lib/horde/framework/Horde/Text','Flowed.php',75],['admin/tool/log/store/legacy/classes/log','store.php',33],['lib/mustache/src/Mustache','HelperCollection.php',19],['backup/util/structure','backup_structure_processor.class.php',45],['backup/util/structure','backup_structure_processor.class.php',133],['admin/tool/lp/classes/output','related_competencies.php',47],['mod/quiz/classes/question/bank','custom_view.php',44],['files','renderer.php',1083],['lib/form','text.php',47],['lib/phpexcel/PHPExcel/Shared/trend','bestFitClass.php',398],['backup/cc','cc112moodle.php',59],['admin/tool/cohortroles/classes/output','cohort_role_assignments_table.php',45],['lib/horde/framework/Horde/Imap/Client/Data','Envelope.php',46],['lib/google/src/Google/Service','Logging.php',39],['lib/lessphp/Tree','Expression.php',16],['mod/lti/classes/local/ltiservice','service_base.php',63],['lib/phpexcel/PHPExcel/Reader','HTML.php',118],['search/engine/solr/classes','schema.php',60],['backup/util/xml/parser/processors','simplified_parser_processor.class.php',46],['lib/htmlpurifier/HTMLPurifier','UnitConverter.php',50],['lib/adodb/drivers','adodb-ado5.inc.php',42],['lib/adodb/drivers','adodb-ado5.inc.php',380],['mod/assign/feedback/editpdf/classes','comment.php',58],['cache/classes','interfaces.php',473],['lib/phpexcel/PHPExcel/Worksheet','Protection.php',157],['repository/merlot','lib.php',37],['lib/adodb/drivers','adodb-firebird.inc.php',69],['backup/util/settings','backup_setting.class.php',43],['lib/adodb/drivers','adodb-fbsql.inc.php',28],['lib/adodb/drivers','adodb-fbsql.inc.php',167],['mnet/xmlrpc','serverlib.php',674],['webservice/soap','lib.php',45],['admin/tool/log/store/database/classes/log','store.php',47],['lib/google/src/Google/Service','Doubleclicksearch.php',43],['lib/form','passwordunmask.php',46],['lib/lessphp/Tree','Variable.php',20],['report/log/classes','renderable.php',96],['mod/lti/service/toolsettings/classes/local/resource','systemsettings.php',43],['question/classes/bank','view.php',70],['grade/report/singleview/classes/local/ui','range.php',38],['lib/simplepie/library/SimplePie/Cache','MySQL.php',80],['admin/roles/classes','define_role_table_basic.php',31],['backup/cc/cc_lib','cc_converter_resource.php',28],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Mongo.php',78],['blocks/rss_client','editfeed.php',36],['admin/tool/lpmigrate/classes/output','migrate_framework_results.php',55],['blocks/lp/classes/output','competencies_to_review_page.php',49],['lib/horde/framework/Horde/Crypt/Blowfish/Php','Base.php',318],['backup/util/loggers','base_logger.class.php',42],['backup/util/loggers','base_logger.class.php',187],['mod/assign/feedback/file','renderable.php',44],['backup/cc/cc_lib','cc_utils.php',313],['backup/cc/cc_lib','cc_utils.php',381],['backup/cc/cc_lib','cc_utils.php',437],['lib/adodb/drivers','adodb-db2.inc.php',66],['lib/adodb/drivers','adodb-db2.inc.php',731],['lib/adodb','adodb-xmlschema03.inc.php',136],['lib/adodb','adodb-xmlschema03.inc.php',270],['lib/adodb','adodb-xmlschema03.inc.php',678],['lib/adodb','adodb-xmlschema03.inc.php',823],['lib/adodb','adodb-xmlschema03.inc.php',1081],['lib/adodb','adodb-xmlschema03.inc.php',1399],['repository/youtube','lib.php',58],['lib/phpexcel/PHPExcel/Writer/PDF','mPDF.php',38],['auth/cas/CAS/CAS','GracefullTerminationException.php',48],['lib/adodb/drivers','adodb-sybase_ase.inc.php',25],['lib/adodb/drivers','adodb-sybase_ase.inc.php',115],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Background.php',20],['lib/adodb','adodb-memcache.lib.inc.php',53],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','FrameTarget.php',19],['lib/phpexcel/PHPExcel/Writer','Excel2007.php',118],['lib/minify/lib/MrClay/Cli','Arg.php',82],['lib/phpexcel/PHPExcel/Worksheet/AutoFilter','Column.php',117],['lib/simplepie','moodle_simplepie.php',50],['lib/simplepie','moodle_simplepie.php',121],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','FontFamily.php',11],['lib/simplepie/library/SimplePie/Decode/HTML','Entities.php',80],['lib/spout/src/Spout/Common/Helper','FileSystemHelper.php',22],['lib/pear/HTML/QuickForm','button.php',37],['lib/google/src/Google/Service','Autoscaler.php',46],['lib/mustache/src/Mustache','Engine.php',63],['lib/google/src/Google/Http','MediaFileUpload.php',75],['lib/phpexcel/PHPExcel','Worksheet.php',327],['mod/assign','gradingtable.php',68],['lib/google/src/Google/Service','AdExchangeSeller.php',53],['question/engine/tests','helpers.php',582],['question/engine/tests','helpers.php',594],['question/engine/tests','helpers.php',608],['question/engine/tests','helpers.php',623],['question/engine/tests','helpers.php',637],['question/engine/tests','helpers.php',652],['question/engine/tests','helpers.php',665],['question/engine/tests','helpers.php',676],['question/engine/tests','helpers.php',1196],['repository/webdav','lib.php',38],['tag/classes/output','tagisstandard.php',39],['lib/google/src/Google/Service','Appsactivity.php',52],['badges/criteria','award_criteria_course.php',47],['lib','searchlib.php',53],['lib','searchlib.php',95],['lib/lessphp/Output','Mapped.php',39],['availability/classes','tree.php',118],['lib/lessphp/Tree','Javascript.php',20],['lib/horde/framework/Horde/Imap/Client','Cache.php',53],['lib/htmlpurifier/HTMLPurifier','AttrCollections.php',16],['lib/mustache/src/Mustache/Loader','InlineLoader.php',56],['repository/url','lib.php',46],['lib/phpexcel/PHPExcel/CachedObjectStorage','SQLite3.php',293],['lib/lessphp/Tree','Ruleset.php',45],['tag/classes/output','tagindex.php',52],['backup/util/ui','backup_ui_stage.class.php',43],['backup/util/ui','backup_ui_stage.class.php',79],['backup/util/ui','backup_ui_stage.class.php',234],['backup/util/ui','backup_ui_stage.class.php',387],['backup/util/ui','backup_ui_stage.class.php',516],['backup/util/ui','backup_ui_stage.class.php',575],['grade/report/singleview/classes/local/screen','screen.php',67],['lib/tcpdf/include/barcodes','datamatrix.php',229],['lib/horde/framework/Horde/Imap/Client/Socket','Catenate.php',37],['lib/google/src/Google/Service','Prediction.php',51],['lib/classes/output','notification.php',101],['lib/lessphp/Tree','Unit.php',16],['backup/util/settings/course','course_backup_setting.class.php',25],['lib/spout/src/Spout/Writer','AbstractWriter.php',68],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','DenyElementDecorator.php',21],['lib','outputfactories.php',120],['lib','outputfactories.php',367],['lib','dtllib.php',66],['mod/assign','assignmentplugin.php',50],['mnet/service/enrol','locallib.php',48],['mnet/service/enrol','locallib.php',466],['mnet/service/enrol','locallib.php',537],['backup/cc/cc_lib','cc_version11.php',57],['availability/condition/completion/classes','condition.php',48],['admin/roles/classes','allow_override_page.php',31],['mod/workshop/allocation','lib.php',103],['lib/htmlpurifier/HTMLPurifier/AttrTransform','BoolToCSS.php',24],['lib/horde/framework/Horde/Imap/Client/Base','Mailbox.php',59],['lib/spout/src/Spout/Reader/Wrapper','SimpleXMLElement.php',23],['lib/google/src/Google/Service','SiteVerification.php',43],['lib/phpexcel/PHPExcel/Calculation','Function.php',64],['availability/classes','capability_checker.php',49],['lib/google/src/Google/Service','Drive.php',76],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Decorator.php',12],['lib/phpexcel/PHPExcel/Shared/JAMA','LUDecomposition.php',56],['lib','setuplib.php',67],['lib','setuplib.php',113],['lib','setuplib.php',165],['lib','setuplib.php',184],['lib','setuplib.php',199],['lib','setuplib.php',219],['lib','setuplib.php',249],['lib','setuplib.php',271],['lib','setuplib.php',287],['lib','setuplib.php',309],['lib','setuplib.php',328],['lib','setuplib.php',346],['lib/form','textarea.php',50],['webservice/soap','locallib.php',57],['availability/classes','info.php',55],['lib/tcpdf','tcpdf_barcodes_1d.php',58],['lib/spout/src/Spout/Reader/XLSX/Helper','SheetHelper.php',49],['filter/urltolink/tests','filter_test.php',209],['lib/simplepie/library/SimplePie','Category.php',81],['admin/tool/lp/classes/output','manage_competencies_page.php',65],['lib/markdown','Markdown.php',99],['mod/assign','locallib.php',160],['mod/assign','locallib.php',8131],['lib/adodb/drivers','adodb-ldap.inc.php',48],['lib/adodb/drivers','adodb-ldap.inc.php',297],['lib/editor/tinymce/plugins/spellchecker/classes/utils','JSON.php',32],['lib/editor/tinymce/plugins/spellchecker/classes/utils','JSON.php',373],['lib','odslib.class.php',42],['lib','odslib.class.php',124],['lib','odslib.class.php',422],['lib','odslib.class.php',827],['lib/horde/framework/Horde/Crypt/Blowfish','Base.php',56],['lib/phpexcel/PHPExcel/Reader/Excel5','MD5.php',36],['grade/report/singleview/classes/local/ui','checkbox_attribute.php',42],['lib/lessphp/Tree','Quoted.php',20],['mod/lesson','mod_form.php',36],['blocks/rss_client/classes/output','item.php',89],['lib/google/src/Google/Service','IdentityToolkit.php',38],['lib/horde/framework/Horde/Stream','Temp.php',25],['tag/classes/output','tagflag.php',39],['admin/tool/monitor/classes/output/managesubs','rules.php',56],['lib/htmlpurifier/HTMLPurifier/ChildDef','Table.php',57],['lib/behat/form_field','behat_form_field.php',59],['lib/phpexcel/PHPExcel/Worksheet/Drawing','Shadow.php',93],['lib/spout/src/Spout/Reader/ODS/Helper','CellValueFormatter.php',42],['tag/classes','collections_table.php',36],['lib/google/src/Google/Service','Spectrum.php',38],['lib/htmlpurifier/HTMLPurifier/AttrTransform','Length.php',19],['admin/tool/lp/classes/output','user_competency_summary.php',49],['lib/phpexcel/PHPExcel','NamedRange.php',65],['lib/pear/HTML/QuickForm','image.php',36],['lib/htmlpurifier/HTMLPurifier/AttrDef/URI','Host.php',15],['lib/form','searchableselector.php',44],['lib/phpexcel/PHPExcel/Shared/JAMA','SingularValueDecomposition.php',52],['lib/adodb/drivers','adodb-oci805.inc.php',51],['lib/google/src/Google','Service.php',28],['lib/google/src/Google/IO','Abstract.php',50],['lib/spout/src/Spout/Writer/ODS/Internal','Worksheet.php',46],['lib/form','header.php',45],['question/type/randomsamatch/tests','helper.php',121],['mod/workshop/form/accumulative','lib.php',99],['lib/phpexcel/PHPExcel/Shared/trend','linearBestFitClass.php',89],['lib/form','submit.php',41],['report/log/classes','table_log.php',45],['admin/roles/classes','admins_potential_selector.php',30],['question/classes/engine/variants','least_used_strategy.php',51],['question/engine/upgrade','logger.php',42],['question/engine/upgrade','logger.php',87],['mod/data','lib.php',68],['mod/data','lib.php',2278],['mod/data','lib.php',2552],['mod/data','lib.php',2573],['backup/util/xml/parser/processors','grouped_parser_processor.class.php',67],['lib/horde/framework/Horde/Imap/Client/Exception','NoSupportPop3.php',26],['mod/scorm','renderer.php',129],['lib/phpunit/classes','advanced_testcase.php',45],['lib/spout/src/Spout/Reader/ODS','SheetIterator.php',41],['backup/cc/cc_lib','cc_version1.php',57],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','LinkTypes.php',21],['tag/classes','areas_table.php',36],['lib/phpexcel/PHPExcel/Shared/trend','powerBestFitClass.php',125],['lib/portfolio/formats/leap2a','lib.php',62],['lib/portfolio/formats/leap2a','lib.php',258],['lib/portfolio/formats/leap2a','lib.php',503],['lib/google/src/Google/Service','Proximitybeacon.php',42],['lib/pear','PEAR.php',139],['lib/pear','PEAR.php',818],['competency/classes/external','persistent_exporter.php',42],['lib/google/src/Google/Service','Groupssettings.php',40],['lib/phpexcel/PHPExcel/Reader','CSV.php',87],['lib/horde/framework/Horde/Exception','LastError.php',16],['lib/google/src/Google/Service','Directory.php',134],['lib/google/src/Google/Service','Fusiontables.php',48],['question/type/missingtype','edit_missingtype_form.php',38],['lib/google/src/Google/Service','AdSenseHost.php',49],['lib/lessphp/Tree','Directive.php',20],['auth/ldap','auth.php',119],['auth/cas/CAS/CAS','CookieJar.php',46],['lib/phpexcel/PHPExcel/CachedObjectStorage','Wincache.php',245],['availability/condition/date/classes','condition.php',52],['lib/horde/framework/Horde/Mime','Mail.php',93],['lib','outputactions.php',60],['lib','outputactions.php',91],['lib','outputactions.php',148],['lib/horde/framework/Horde/Crypt/Blowfish','Mcrypt.php',47],['lib/classes','string_manager_standard.php',53],['repository/skydrive','microsoftliveapi.php',50],['user/filters','globalrole.php',35],['enrol/lti/ims-blti','OAuth.php',16],['enrol/lti/ims-blti','OAuth.php',32],['enrol/lti/ims-blti','OAuth.php',187],['enrol/lti/ims-blti','OAuth.php',451],['course/classes/output','course_module_name.php',46],['lib/google/src/Google/Service','Plus.php',52],['lib/horde/framework/Horde/Mime','Mdn.php',35],['lib/pear/HTML/QuickForm','html.php',36],['repository/s3','S3.php',193],['repository/s3','S3.php',2018],['repository/s3','S3.php',2374],['lib/spout/src/Spout/Reader/XLSX/Helper','SharedStringsHelper.php',39],['question/classes/bank/search','hidden_condition.php',42],['lib/htmlpurifier/HTMLPurifier/ChildDef','Empty.php',22],['lib/pear/HTML/QuickForm','element.php',73],['question/classes/statistics/responses','analysis_for_subpart.php',50],['admin/tool/log/classes','setting_managestores.php',30],['lib/google/src/Google/Service','Mirror.php',49],['lib/adodb/drivers','adodb-db2ora.inc.php',80],['lib/minify/lib/HTTP','Encoder.php',75],['mod/feedback/classes','completion.php',47],['admin/tool/uploadcourse/classes','processor.php',122],['lib/lessphp','Parser.php',78],['lib/adodb/drivers','adodb-sapdb.inc.php',36],['lib/adodb/drivers','adodb-sapdb.inc.php',179],['lib/ddl','sql_generator.php',175],['lib/google/src/Google/Service','AndroidEnterprise.php',51],['admin/tool/lp/classes/output','template_competencies_page.php',70],['lib/horde/framework/Horde/Support','ObjectStub.php',29],['mod/assignment/backup/moodle1','lib.php',223],['blocks','edit_form.php',47],['lib/simplepie/library/SimplePie/Cache','Memcache.php',81],['mod/quiz/report/statistics','statistics_question_table.php',49],['mod/workshop/form/numerrors','lib.php',102],['mod/quiz/classes','repaginate.php',49],['lib/classes/session','memcached.php',51],['lib/phpexcel/PHPExcel/Shared/OLE/PPS','Root.php',43],['lib/phpexcel/PHPExcel/Writer/PDF','Core.php',206],['mod/workshop','mod_form.php',43],['mod/assign/feedback/editpdf/fpdi','pdf_context.php',48],['availability/condition/profile/classes','condition.php',73],['lib/horde/framework/Horde/Imap/Client','DateTime.php',29],['auth/cas/CAS/CAS','Client.php',862],['lib/xhprof','xhprof_moodle.php',788],['lib/dtl','file_xml_database_exporter.php',36],['course','lib.php',3061],['lib/adodb/drivers','adodb-mssqlpo.inc.php',54],['lib/xmldb','xmldb_table.php',49],['lib/adodb/perf','perf-postgres.inc.php',92],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Filter.php',15],['question/type/ddmarker','shapes.php',40],['question/type/ddmarker','shapes.php',203],['question/type/ddmarker','shapes.php',267],['question/type/ddmarker','shapes.php',332],['question/type/ddmarker','shapes.php',470],['mod/lti/classes/local/ltiservice','response.php',58],['backup/util/helper','restore_users_parser_processor.class.php',43],['lib/pear/HTML','Common.php',79],['mod/glossary','locallib.php',481],['lib/adodb/perf','perf-mssqlnative.inc.php',70],['lib/adodb/perf','perf-mssql.inc.php',70],['backup/util/plan','base_plan.class.php',39],['backup/util/plan','base_plan.class.php',215],['backup/util/plan','restore_task.class.php',32],['backup/util/plan','restore_task.class.php',121],['lib/classes/event','base.php',124],['lib/form','checkbox.php',46],['admin/roles/classes','permissions_table.php',38],['lib/pear/HTML/QuickForm','submit.php',37],['auth/fc','auth.php',37],['enrol/ldap','settingslib.php',32],['enrol/ldap','settingslib.php',90],['enrol/ldap','settingslib.php',204],['lib/minify/lib/Minify/Cache','Memcache.php',22],['lib/lessphp/Tree','Condition.php',18],['admin/tool/lp/classes/output','plans_page.php',59],['lib/mustache/src/Mustache','Autoloader.php',19],['lib/spout/src/Spout/Writer/XLSX/Internal','Worksheet.php',52],['lib/phpexcel/PHPExcel','Comment.php',93],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','AlphaValue.php',6],['lib/lessphp/Tree','Url.php',17],['mod/lesson','override_form.php',58],['lib/form','button.php',45],['admin/tool/lp/classes/output','manage_templates_page.php',56],['lib/google/src/Google/Service','Playmoviespartner.php',44],['backup/util/ui','base_ui_stage.class.php',67],['backup/cc/cc_lib','cc_converters.php',75],['lib/dtl','database_mover.php',33],['enrol','locallib.php',125],['enrol','locallib.php',1256],['enrol','locallib.php',1379],['enrol','locallib.php',1430],['enrol','locallib.php',1463],['lib/htmlpurifier/HTMLPurifier','URI.php',58],['backup/moodle2','restore_course_task.class.php',41],['lib/htmlpurifier/HTMLPurifier/Printer','ConfigForm.php',40],['lib/htmlpurifier/HTMLPurifier/Printer','ConfigForm.php',221],['lib','xmlize.php',31],['lib','googleapi.php',52],['lib','googleapi.php',243],['grade/report/singleview/classes/local/ui','element.php',47],['lib/html2text','lib.php',43],['user/filters','lib.php',52],['user/filters','lib.php',272],['auth/cas/CAS/CAS/PGTStorage','Db.php',122],['lib/classes/lock','db_record_lock_factory.php',61],['lib/pear/HTML/QuickForm','link.php',47],['backup/cc/cc_lib','cc_asssesment.php',290],['backup/cc/cc_lib','cc_asssesment.php',345],['backup/cc/cc_lib','cc_asssesment.php',364],['backup/cc/cc_lib','cc_asssesment.php',415],['backup/cc/cc_lib','cc_asssesment.php',476],['backup/cc/cc_lib','cc_asssesment.php',486],['backup/cc/cc_lib','cc_asssesment.php',561],['backup/cc/cc_lib','cc_asssesment.php',585],['backup/cc/cc_lib','cc_asssesment.php',635],['backup/cc/cc_lib','cc_asssesment.php',668],['backup/cc/cc_lib','cc_asssesment.php',693],['backup/cc/cc_lib','cc_asssesment.php',788],['backup/cc/cc_lib','cc_asssesment.php',814],['backup/cc/cc_lib','cc_asssesment.php',838],['backup/cc/cc_lib','cc_asssesment.php',965],['backup/cc/cc_lib','cc_asssesment.php',971],['backup/cc/cc_lib','cc_asssesment.php',986],['backup/cc/cc_lib','cc_asssesment.php',1003],['backup/cc/cc_lib','cc_asssesment.php',1017],['backup/cc/cc_lib','cc_asssesment.php',1045],['backup/cc/cc_lib','cc_asssesment.php',1186],['backup/cc/cc_lib','cc_asssesment.php',1263],['backup/cc/cc_lib','cc_asssesment.php',1317],['backup/cc/cc_lib','cc_asssesment.php',1389],['backup/cc/cc_lib','cc_asssesment.php',1451],['backup/cc/cc_lib','cc_asssesment.php',1558],['backup/cc/cc_lib','cc_asssesment.php',1620],['backup/cc/cc_lib','cc_asssesment.php',1648],['backup/cc/cc_lib','cc_asssesment.php',1716],['backup/cc/cc_lib','cc_asssesment.php',2155],['backup/cc/cc_lib','cc_asssesment.php',2264],['backup/cc/cc_lib','cc_asssesment.php',2469],['lib/phpunit/classes','hint_resultprinter.php',37],['lib/horde/framework/Horde/Mail/Transport','Mail.php',53],['auth/pop3','auth.php',35],['lib/adodb/drivers','adodb-oci8.inc.php',106],['lib/adodb/drivers','adodb-oci8.inc.php',1539],['lib/adodb/drivers','adodb-oci8.inc.php',1805],['lib/classes/session','database.php',52],['backup/util/ui','restore_ui_components.php',81],['backup/util/ui','restore_ui_components.php',287],['backup/util/ui','restore_ui_components.php',382],['question/classes/bank/search','category_condition.php',60],['lib/google/src/Google/Auth','AssertionCredentials.php',53],['backup/util/plan','restore_plan.class.php',43],['backup/util/plan','restore_plan.class.php',203],['backup/util/xml/parser/processors','findpaths_parser_processor.class.php',35],['lib/phpexcel/PHPExcel/CalcEngine','Logger.php',63],['lib/jabber/XMPP','Log.php',67],['lib/horde/framework/Horde/Imap/Client/Exception','ServerResponse.php',44],['lib/lessphp/Tree','Assignment.php',15],['lib/dtl','string_xml_database_importer.php',34],['admin/tool/lp/classes/output','manage_competency_frameworks_page.php',62],['question/type/calculated','question.php',188],['question/type/calculated','question.php',303],['repository/recent','lib.php',39],['grade/report/singleview/classes/local/ui','text_attribute.php',42],['admin/webservice','lib.php',38],['lib','coursecatlib.php',194],['lib','coursecatlib.php',2782],['lib/google/src/Google/Service','Cloudtrace.php',43],['lib','filterlib.php',73],['lib','filterlib.php',377],['lib','filterlib.php',456],['lib/classes/lock','lock_factory.php',39],['lib/filebrowser','file_info_context_course.php',39],['lib/filebrowser','file_info_context_course.php',492],['lib/filebrowser','file_info_context_course.php',596],['lib/filebrowser','file_info_context_course.php',745],['enrol','renderer.php',426],['enrol','renderer.php',723],['question/classes/statistics/questions','calculated_for_subquestion.php',57],['backup/moodle2','backup_format_plugin.class.php',40],['admin/tool/lp/classes','course_competency_rule_form_element.php',45],['auth/cas/CAS/CAS','ProxyTicketException.php',46],['lib/phpunit/classes','basic_testcase.php',39],['lib/spout/src/Spout/Reader/ODS','RowIterator.php',49],['backup/util/dbops','backup_dbops.class.php',37],['admin/tool/customlang','locallib.php',44],['admin/tool/customlang','locallib.php',405],['admin/tool/customlang','locallib.php',471],['backup/util/structure','backup_optigroup_element.class.php',51],['mod/quiz/report/grading','gradingsettings_form.php',44],['backup/util/plan','restore_step.class.php',32],['backup/util/plan','restore_step.class.php',104],['lib/form','hidden.php',44],['repository/filesystem','lib.php',48],['backup/controller','backup_controller.class.php',68],['backup/controller','backup_controller.class.php',409],['backup/util/helper','restore_log_rule.class.php',62],['tag/classes','tag.php',77],['lib/htmlpurifier/HTMLPurifier/AttrTransform','SafeParam.php',27],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Db.php',38],['lib/spout/src/Spout/Writer/Style','StyleBuilder.php',19],['lib/dml','sqlsrv_native_moodle_database.php',53],['user/filters','date.php',40],['auth/nologin','auth.php',35],['lib/google/src/Google','Model.php',35],['lib/horde/framework/Horde/Imap/Client/Socket','ClientSort.php',37],['lib/horde/framework/Horde/Imap/Client/Exception','SearchCharset.php',34],['lib/horde/framework/Horde/Support','StringStream.php',30],['lib/adodb/drivers','adodb-mysqli.inc.php',66],['lib/adodb/drivers','adodb-mysqli.inc.php',887],['lib/adodb/drivers','adodb-mysqli.inc.php',1193],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','ImportantDecorator.php',21],['lib/form','questioncategory.php',46],['lib/mustache/src/Mustache','Template.php',29],['backup/util/structure','base_nested_element.class.php',44],['backup/util/structure','base_nested_element.class.php',258],['lib/google/src/Google/Logger','Abstract.php',123],['backup/cc/cc_lib','cc_general.php',38],['lib/phpexcel/PHPExcel','ReferenceHelper.php',58],['lib/pear/HTML/QuickForm','password.php',37],['lib/dml','moodle_transaction.php',40],['lib/phpexcel/PHPExcel/Reader','Excel2003XML.php',53],['lib/htmlpurifier/HTMLPurifier/AttrDef','Switch.php',29],['repository/flickr','lib.php',51],['lib/form','grading.php',57],['lib/classes/update','api.php',71],['backup/cc/cc_lib','cc_converter_lti.php',29],['backup/moodle2','backup_subplugin.class.php',44],['lib/portfolio','caller.php',67],['lib/classes/progress','display_if_slow.php',60],['lib/adodb/perf','perf-informix.inc.php',66],['lib/classes','chart_base.php',52],['lib/lessphp/Tree','Media.php',18],['lib/spout/src/Spout/Common/Escaper','XLSX.php',19],['grade/export/ods','grade_export_ods.php',24],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Length.php',23],['lib/google/src/Google/Service','Calendar.php',50],['lib/form','group.php',44],['lib/phpexcel/PHPExcel/Writer','OpenDocument.php',44],['lib/pear/HTML/QuickForm/Renderer','Object.php',75],['admin/tool/lp/classes/output','user_evidence_page.php',48],['lib/horde/framework/Horde/Imap/Client/Fetch','Results.php',54],['grade/export/xls','grade_export_xls.php',24],['lib/classes/output','mustache_pix_helper.php',43],['lib/horde/framework/Horde/Imap/Client/Mailbox','List.php',46],['lib/google/src/Google/Auth','ComputeEngine.php',35],['cache/stores/session','lib.php',131],['lib/mustache/src/Mustache/Logger','StreamLogger.php',44],['admin/tool/log/store/database/backup/moodle2','backup_logstore_database_nested_element.php',43],['user','renderer.php',220],['lib/htmlpurifier/HTMLPurifier/ChildDef','Required.php',23],['availability/condition/grade/classes','condition.php',46],['lib/lessphp/Tree','RulesetCall.php',14],['blocks/rss_client/classes/output','feed.php',75],['lib/form','select.php',47],['lib/htmlpurifier/HTMLPurifier','ContentSets.php',33],['lib/lessphp/Visitor','toCSS.php',13],['lib','outputfragmentrequirementslib.php',40],['backup/util/ui','restore_moodleform.class.php',34],['lib/google/src/Google/Service','Cloudbilling.php',43],['lib/google/src/Google/Service','PlusDomains.php',72],['lib','externallib.php',37],['lib','externallib.php',531],['lib','externallib.php',562],['lib','externallib.php',593],['lib','externallib.php',622],['lib','externallib.php',648],['lib','externallib.php',778],['lib','externallib.php',813],['lib','externallib.php',984],['lib','externallib.php',1177],['blog','locallib.php',71],['blog','locallib.php',564],['blog','locallib.php',847],['blog','locallib.php',892],['blog','locallib.php',965],['blog','locallib.php',1016],['blog','locallib.php',1041],['blog','locallib.php',1051],['blog','locallib.php',1063],['blog','locallib.php',1084],['lib/phpexcel/PHPExcel/Worksheet','ColumnDimension.php',53],['auth/cas','auth.php',39],['lib','lexer.php',41],['lib','lexer.php',145],['lib','lexer.php',217],['lib/phpexcel/PHPExcel/Shared/JAMA','QRDecomposition.php',48],['lib/google/src/Google/Service','Exception.php',34],['lib/htmlpurifier/HTMLPurifier','Printer.php',21],['tag/classes/output','tagcloud.php',49],['lib/google/src/Google/Service','Storagetransfer.php',44],['user/filters','select.php',46],['cache/stores/mongodb','lib.php',116],['admin/tool/lp/classes/output','course_competencies_page.php',73],['lib/google/src/Google/Cache','Null.php',28],['lib','graphlib.php',1176],['lib/phpexcel/PHPExcel/Style','Protection.php',49],['lib/google/src/Google/Service','GamesConfiguration.php',42],['repository/dropbox','locallib.php',46],['lib/phpexcel/PHPExcel/Style','Alignment.php',100],['lib/htmlpurifier/HTMLPurifier','Language.php',63],['cache/stores/file','lib.php',117],['tag/classes/output','tagareashowstandard.php',41],['question/type/multianswer','edit_multianswer_form.php',63],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','Bool.php',22],['mod/assign','renderable.php',41],['mod/assign','renderable.php',71],['mod/assign','renderable.php',103],['mod/assign','renderable.php',139],['mod/assign','renderable.php',191],['mod/assign','renderable.php',242],['mod/assign','renderable.php',291],['mod/assign','renderable.php',395],['mod/assign','renderable.php',531],['mod/assign','renderable.php',586],['mod/assign','renderable.php',670],['mod/assign','renderable.php',707],['mod/assign','renderable.php',747],['mod/assign','renderable.php',800],['mod/assign','renderable.php',854],['lib/form','selectwithlink.php',56],['backup/moodle2','backup_activity_task.class.php',45],['lib/phpmailer','class.phpmailer.php',633],['lib/horde/framework/Horde/Imap/Client/Data','AclRights.php',39],['auth/db','auth.php',36],['lib/lessphp/Tree','Value.php',14],['lib/form','course.php',62],['question/engine','questionattemptstep.php',97],['question/engine','questionattemptstep.php',608],['cohort','locallib.php',37],['cohort','locallib.php',101],['badges/criteria','award_criteria.php',127],['lib/adodb/perf','perf-mysql.inc.php',86],['cache/stores/memcached','lib.php',133],['grade/report/singleview/classes/local/ui','empty_element.php',38],['lib/google/src/Google/Service','AppState.php',40],['lib/adodb/drivers','adodb-odbc_oracle.inc.php',107],['lib/pear/HTML/QuickForm/Renderer','Default.php',139],['tag/classes/output','tag.php',46],['question','previewlib.php',122],['backup/util/loggers','database_logger.class.php',40],['mod/forum/classes','potential_subscriber_selector.php',47],['lib/htmlpurifier/HTMLPurifier/ConfigSchema','InterchangeBuilder.php',15],['lib/phpexcel/PHPExcel/Reader','SYLK.php',67],['lib/form','submitlink.php',47],['backup/util/dbops','restore_dbops.class.php',1788],['lib/xmldb','xmldb_index.php',56],['question','category_class.php',58],['question','category_class.php',160],['lib/google/src/Google/Service','Webfonts.php',38],['webservice/xmlrpc','locallib.php',41],['admin/roles/classes','check_users_selector.php',38],['lib/htmlpurifier/HTMLPurifier/AttrTransform','ImgSpace.php',24],['user/profile/field/checkbox','field.class.php',33],['lib/form','cancel.php',47],['lib/google/src/Google/Service','Resourceviews.php',57],['lib/phpexcel/PHPExcel/Style','Font.php',100],['lib/portfolio','plugin.php',445],['calendar','lib.php',2003],['calendar','lib.php',2774],['mod/wiki','pagelib.php',93],['mod/wiki','pagelib.php',380],['mod/wiki','pagelib.php',981],['mod/wiki','pagelib.php',1190],['mod/wiki','pagelib.php',2194],['mod/wiki','pagelib.php',2422],['tag/classes/output','tagfeed.php',43],['tag/classes/output','tagareaenabled.php',38],['backup/util/xml/parser/processors','selective_like_parser_processor.class.php',35],['mod/workshop','locallib.php',183],['mod/workshop','locallib.php',2976],['mod/workshop','locallib.php',3411],['mod/workshop','locallib.php',3647],['mod/workshop','locallib.php',3889],['mod/workshop','locallib.php',3975],['mod/workshop','locallib.php',4060],['mod/workshop','locallib.php',4079],['lib/form','advcheckbox.php',48],['backup/cc/cc_lib','cc_assesment_sfib.php',27],['cohort/classes/output','cohortidnumber.php',37],['lib/adodb/drivers','adodb-ado.inc.php',42],['lib/adodb/drivers','adodb-ado.inc.php',346],['lib/form','filepicker.php',53],['mod/assign','adminlib.php',41],['mod/assign','adminlib.php',102],['lib/tests/fixtures','test_renderer_factory.php',41],['backup/cc/cc_lib','cc_converter_label.php',28],['lib/htmlpurifier/HTMLPurifier','Lexer.php',152],['grade/report/singleview','lib.php',69],['backup/cc/cc_lib','cc_converter_page.php',28],['lib/google/src/Google/Logger','Psr.php',39],['lib/simplepie/library/SimplePie/HTTP','Parser.php',131],['backup/util/plan','backup_step.class.php',32],['backup/util/plan','backup_step.class.php',55],['lib/lessphp/Tree','Import.php',30],['lib/jabber/XMPP','XMPP_Old.php',45],['lib/phpexcel/PHPExcel/Worksheet','Drawing.php',37],['lib/google/src/Google/Service','Classroom.php',60],['lib/phpexcel/PHPExcel/Chart/Renderer','jpgraph.php',875],['admin/tool/lp/classes/external','competency_path_exporter.php',38],['cohort/classes/output','cohortname.php',37],['grade/report/overview','lib.php',76],['lib/horde/framework/Horde/Mail/Rfc822','Address.php',66],['admin/roles/classes','admins_existing_selector.php',30],['lib/phpunit/classes','arraydataset.php',45],['question/engine','questionattempt.php',166],['question/engine','questionattempt.php',1532],['question/engine','questionattempt.php',1618],['question/engine','questionattempt.php',1703],['lib/horde/framework/Horde/Support','Uuid.php',23],['lib/horde/framework/Horde/Imap/Client/Data/Format','Nil.php',27],['webservice/rest','lib.php',47],['lib/phpexcel/PHPExcel/Worksheet','HeaderFooterDrawing.php',79],['backup/util/xml/output','memory_xml_output.class.php',37],['repository/flickr_public','image.php',34],['mod/lti/classes/local/ltiservice','resource_base.php',62],['admin/tool/lp/classes/output','template_plans_table.php',53],['mod/quiz','mod_form.php',48],['lib/simplepie/library/SimplePie','Caption.php',98],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Multiple.php',33],['lib/htmlpurifier/HTMLPurifier','PercentEncoder.php',20],['lib/phpexcel/PHPExcel/Calculation','ExceptionHandler.php',30],['lib/htmlpurifier/HTMLPurifier/Token','Tag.php',33],['backup/moodle2','backup_theme_plugin.class.php',61],['mod/chat','chatd.php',78],['mod/chat','chatd.php',103],['lib/phpexcel/PHPExcel','DocumentSecurity.php',65],['lib/htmlpurifier/HTMLPurifier','URIDefinition.php',21],['lib/spout/src/Spout/Writer/XLSX/Internal','Workbook.php',45],['lib/phpexcel/PHPExcel/Shared','XMLWriter.php',49],['lib/lessphp/Tree','Operation.php',19],['lib/htmlpurifier/HTMLPurifier/Lexer','PH5P.php',461],['lib/htmlpurifier/HTMLPurifier/Lexer','PH5P.php',1699],['backup/cc/cc_lib','cc_converter_folder.php',28],['backup/util/helper','restore_roles_parser_processor.class.php',39],['lib/simplepie/library/SimplePie','Locator.php',68],['lib/google/src/Google/Service','SQLAdmin.php',50],['lib/lessphp/Tree','DetachedRuleset.php',15],['admin/tool/assignmentupgrade','upgradableassignmentstable.php',49],['backup/cc','validator.php',30],['backup/cc','validator.php',116],['backup/cc','validator.php',202],['backup/cc','validator.php',230],['backup/cc','validator.php',236],['backup/cc','validator.php',242],['backup/cc','validator.php',248],['backup/cc','validator.php',254],['backup/cc','validator.php',260],['lib/horde/framework/Horde/Imap/Client/Interaction','Client.php',34],['mod/quiz','override_form.php',58],['auth/cas/CAS/CAS/PGTStorage','AbstractStorage.php',57],['lib/htmlpurifier/HTMLPurifier','Length.php',41],['backup/util/helper','restore_decode_rule.class.php',47],['backup/util/helper','restore_decode_rule.class.php',192],['lib/horde/framework/Horde/Imap/Client/Data','Sync.php',133],['lib/phpexcel/PHPExcel/Shared/trend','logarithmicBestFitClass.php',97],['lib/adodb/perf','perf-db2.inc.php',61],['lib/phpexcel/PHPExcel/Style','Supervisor.php',44],['lib/htmlpurifier/HTMLPurifier/AttrTransform','TargetBlank.php',17],['lib/ddl','database_manager.php',48],['lib/mustache/src/Mustache/Exception','UnknownFilterException.php',22],['admin/roles/classes','define_role_table_advanced.php',46],['lib/dml','oci_native_moodle_temptables.php',40],['lib/horde/framework/Horde/Stream','Existing.php',28],['enrol/manual','locallib.php',37],['enrol/manual','locallib.php',102],['availability/classes','multiple_messages.php',56],['lib/phpexcel/PHPExcel/Reader','Gnumeric.php',55],['admin/roles/classes','override_permissions_table_advanced.php',31],['lib/pear/Net','GeoIP.php',323],['lib/mustache/src/Mustache/Loader','ArrayLoader.php',31],['lib/form','modgrade.php',78],['admin/tool/log/store/database/backup/moodle2','restore_logstore_database_subplugin.class.php',40],['cache/classes','config.php',80],['lib/pear/HTML/QuickForm','hidden.php',37],['question/type/calculated','datasetitems_form.php',72],['lib/tests','navigationlib_test.php',554],['lib/tests','navigationlib_test.php',612],['lib/tests','navigationlib_test.php',639],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Number.php',18],['lib/tests','completionlib_test.php',882],['admin/tool/generator/classes','site_backend.php',58],['lib/jabber/XMPP','XMLStream.php',171],['lib/simplepie/library/SimplePie','Sanitize.php',75],['cache/classes','factory.php',149],['lib/minify/lib/Minify/Cache','WinCache.php',20],['user/classes/output/myprofile','node.php',82],['lib/horde/framework/Horde/Stream','TempString.php',40],['lib/adodb/drivers','adodb-borland_ibase.inc.php',83],['mod/forum','locallib.php',55],['mod/forum','locallib.php',419],['mod/lti/service/memberships/classes/local/resource','contextmemberships.php',44],['lib/phpexcel/PHPExcel/Worksheet/AutoFilter/Column','Rule.php',262],['lib/classes/update','code_manager.php',57],['search/engine/solr/classes','engine.php',103],['lib/horde/framework/Horde/Imap/Client/Interaction/Server','Tagged.php',36],['lib/google/src/Google/Service','Compute.php',89],['lib/phpexcel/PHPExcel/Style','Borders.php',113],['lib','completionlib.php',243],['lib/google/src/Google/Service','Pubsub.php',44],['lib/adodb/drivers','adodb-ads.inc.php',69],['lib/adodb/drivers','adodb-ads.inc.php',657],['lib/markdown','MarkdownExtra.php',56],['lib/minify/lib/Minify/Cache','XCache.php',22],['lib/google/src/Google/Service','YouTube.php',75],['lib/lessphp','Functions.php',15],['auth/cas/CAS/CAS','AuthenticationException.php',53],['mod/quiz','locallib.php',1923],['competency/classes/external','stored_file_exporter.php',45],['user/filters','checkbox.php',51],['backup/moodle2','restore_settingslib.php',86],['backup/moodle2','restore_settingslib.php',149],['lib/htmlpurifier/HTMLPurifier/Node','Element.php',39],['lib/pear/HTML/QuickForm','date.php',260],['lib/lessphp/SourceMap','Generator.php',82],['backup/util/plan','base_step.class.php',35],['backup/util/plan','base_step.class.php',127],['mod/lti/service/memberships/classes/local/service','memberships.php',50],['lib/google/src/Google/Cache','Apc.php',37],['backup/util/ui','restore_ui_stage.class.php',42],['backup/util/ui','restore_ui_stage.class.php',265],['backup/util/ui','restore_ui_stage.class.php',452],['backup/util/ui','restore_ui_stage.class.php',592],['backup/util/ui','restore_ui_stage.class.php',704],['backup/util/ui','restore_ui_stage.class.php',852],['backup/util/ui','restore_ui_stage.class.php',959],['backup/util/ui','restore_ui_stage.class.php',1100],['lib/pear/Auth','RADIUS.php',120],['lib/pear/Auth','RADIUS.php',579],['lib/pear/Auth','RADIUS.php',672],['lib/pear/Auth','RADIUS.php',879],['lib/adodb/drivers','adodb-ado_access.inc.php',46],['admin/tool/xmldb/actions','XMLDBAction.class.php',56],['backup/converter/moodle1','handlerlib.php',120],['backup/converter/moodle1','handlerlib.php',1710],['backup/converter/moodle1','handlerlib.php',1902],['backup/converter/moodle1','handlerlib.php',2155],['backup/controller','restore_controller.class.php',63],['backup/controller','restore_controller.class.php',519],['lib/google/src/Google/Http','Request.php',58],['lib/google/src/Google/Service','Dfareporting.php',99],['lib/google/src/Google/Service','Manager.php',60],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Hashtable.php',73],['lib/htmlpurifier/HTMLPurifier/ConfigSchema','Validator.php',30],['lib/google/src/Google/Service','CloudMonitoring.php',45],['lib/editor/tinymce/plugins/spellchecker/classes','SpellChecker.php',11],['lib/horde/framework/Horde/Imap/Client/Ids','Map.php',44],['lib/horde/framework/Horde/Mail/Transport','Sendmail.php',65],['lib','webdavlib.php',84],['lib/dml','pgsql_native_moodle_recordset.php',43],['lib/horde/framework/Horde/Support','Guid.php',24],['lib/mustache/src/Mustache','LambdaHelper.php',25],['question/engine/upgrade/tests','helper.php',45],['admin/tool/uploadcourse/classes','tracker.php',72],['grade/report/user','lib.php',188],['lib/adodb/drivers','adodb-sqlanywhere.inc.php',156],['auth/cas/CAS/CAS','OutOfSequenceBeforeClientException.php',47],['backup/util/plan','base_task.class.php',40],['backup/util/plan','base_task.class.php',277],['lib/adodb/drivers','adodb-db2oci.inc.php',220]], 1102],
'get_virtual_method_code': ['get_virtual_method_code', 'Returns a virtual method code for a web service function. ', [['webservice','lib.php',1469]], 1],
'get_string': ['get_string', 'Get String returns a requested string ', [['lib/classes','string_manager_install.php',95],['lib','moodlelib.php',6735],['lib','moodlelib.php',9695],['lib/external','externallib.php',102],['question/behaviour','behaviourbase.php',770],['lib/classes','string_manager_standard.php',280],['lib/classes','string_manager.php',38]], 20134],
'external_function_info': ['external_function_info', 'Returns detailed function information ', [['lib','deprecatedlib.php',4485],['lib','externallib.php',60]], 15],
'generate_simple_struct_class': ['generate_simple_struct_class', 'Generates a struct class. ', [['webservice','lib.php',1420]], 1],
'set_user': ['set_user', 'Set current user. ', [['lib/classes/session','manager.php',706]], 28],
'add_record_snapshot': ['add_record_snapshot', 'Add cached data that will be most probably used in event observers. ', [['lib/classes/event','base.php',840]], 332],
'get_record_sql': ['get_record_sql', 'Get a single database record as an object using a SQL statement. ', [['lib/dml','oci_native_moodle_database.php',1076],['lib/dml','moodle_database.php',1506]], 157],
'get_records_sql': ['get_records_sql', 'Get a number of records as an array of objects. ', [['lib/dml','pdo_moodle_database.php',309],['lib/dml','oci_native_moodle_database.php',1145],['lib/dml','pgsql_native_moodle_database.php',732],['lib/dml','mssql_native_moodle_database.php',805],['lib/dml','mysqli_native_moodle_database.php',1057],['lib/dml','sqlsrv_native_moodle_database.php',890],['lib/dml/tests','dml_test.php',5545]], 700],
'get_instance': ['get_instance', 'Get the DB record for the current instance. ', [['course','moodleform_mod.php',116],['question/engine','bank.php',464],['backup/util/output','output_controller.class.php',53],['repository','lib.php',1137],['backup/util/helper','restore_logs_processor.class.php',69],['grade/grading/form','lib.php',474],['mnet/service/enrol','locallib.php',57],['mod/assign','locallib.php',1224],['lib','externallib.php',1000],['blog','locallib.php',857]], 420],
'get_ws_authorised_user': ['get_ws_authorised_user', 'Return an authorised user with their options (ip/timecreated / validuntil...) ', [['webservice','lib.php',272]], 3],
'get_user_ws_tokens': ['get_user_ws_tokens', 'Return all tokens of a specific user + the service state (enabled/disabled) + the authorised user mode (restricted/not restricted) ', [['webservice','lib.php',352]], 1],
'service_function_exists': ['service_function_exists', 'Test whether an external function is already linked to a service ', [['webservice','lib.php',701]], 1],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required, Some conversions and safety checks are carried out. Lobs are supported. If the return ID isn\'t required, then this just reports success as true/false. $data is an object containing needed data ', [['lib/dml','pdo_moodle_database.php',387],['lib/dml','oci_native_moodle_database.php',1297],['lib/dml','pgsql_native_moodle_database.php',889],['lib/dml','mssql_native_moodle_database.php',962],['lib/dml','mysqli_native_moodle_database.php',1185],['question/engine/upgrade','upgradelib.php',124],['lib/dml','sqlsrv_native_moodle_database.php',1045],['lib/dml/tests','dml_test.php',5548]], 1611],
'json_encode': ['json_encode', 'encodes an arbitrary variable into JSON format ', [['lib/minify/lib','FirePHP.php',1124]], 307],
'init_service_class': ['init_service_class', 'Load the virtual class needed for the web service. ', [['webservice','lib.php',1330]], 2],
'create': ['create', 'Auto-scan an incoming line to determine the response type. ', [['lib/horde/framework/Horde/Imap/Client/Interaction','Server.php',65],['lib/google/src/Google/Service','Partners.php',492],['lib/simplepie/library/SimplePie','Cache.php',95],['lib/google/src/Google/Service','YouTubeReporting.php',237],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',81],['lib/google/src/Google/Service','MapsEngine.php',1677],['lib/google/src/Google/Service','MapsEngine.php',1977],['lib/google/src/Google/Service','MapsEngine.php',2253],['lib/google/src/Google/Service','MapsEngine.php',2330],['lib/google/src/Google/Service','MapsEngine.php',2898],['lib/spout/src/Spout/Writer','WriterFactory.php',18],['lib/google/src/Google/Service','Dns.php',290],['lib/google/src/Google/Service','Dns.php',363],['lib/google/src/Google/Service','Appengine.php',438],['tag/classes','collection.php',188],['lib/adodb','adodb-xmlschema.inc.php',152],['lib/adodb','adodb-xmlschema.inc.php',473],['lib/adodb','adodb-xmlschema.inc.php',738],['lib/adodb','adodb-xmlschema.inc.php',884],['lib/adodb','adodb-xmlschema.inc.php',1129],['mod/quiz','attemptlib.php',100],['mod/quiz','attemptlib.php',596],['lib','weblib.php',3206],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',58],['lib/google/src/Google/Service','Dataflow.php',273],['lib/simplepie/library/SimplePie','Registry.php',153],['competency/classes','persistent.php',387],['lib/google/src/Google/Service','Cloudresourcemanager.php',373],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',270],['lib/google/src/Google/Service','TagManager.php',1007],['lib/google/src/Google/Service','TagManager.php',1097],['lib/google/src/Google/Service','TagManager.php',1249],['lib/google/src/Google/Service','TagManager.php',1342],['lib/google/src/Google/Service','TagManager.php',1436],['lib/google/src/Google/Service','TagManager.php',1530],['lib/google/src/Google/Service','TagManager.php',1681],['mod/lesson','locallib.php',1011],['mod/lesson','locallib.php',2163],['mod/lesson','locallib.php',3212],['lib','modinfolib.php',1732],['repository','lib.php',206],['repository','lib.php',1910],['lib','navigationlib.php',268],['lib/htmlpurifier/HTMLPurifier','Config.php',114],['lib/google/src/Google/Service','Container.php',284],['lib/google/src/Google/Service','Genomics.php',632],['lib/google/src/Google/Service','Genomics.php',721],['lib/google/src/Google/Service','Genomics.php',1312],['lib/google/src/Google/Service','Genomics.php',1427],['lib/google/src/Google/Service','Games.php',1649],['lib/google/src/Google/Service','Games.php',2013],['lib/google/src/Google/Service','Fitness.php',377],['lib/google/src/Google/Service','Gmail.php',747],['lib/google/src/Google/Service','Gmail.php',905],['mod/quiz/classes','structure.php',65],['lib/htmlpurifier/HTMLPurifier','ElementDef.php',135],['lib/adodb','adodb-xmlschema03.inc.php',170],['lib/adodb','adodb-xmlschema03.inc.php',514],['lib/adodb','adodb-xmlschema03.inc.php',779],['lib/adodb','adodb-xmlschema03.inc.php',930],['lib/adodb','adodb-xmlschema03.inc.php',1228],['lib/google/src/Google/Service','Proximitybeacon.php',500],['tag/classes','area.php',205],['course','lib.php',3003],['question/type/ddmarker','shapes.php',170],['lib/classes/event','base.php',149],['lib','coursecatlib.php',325],['repository/filesystem','lib.php',498],['lib/google/src/Google/Service','Storagetransfer.php',281],['calendar','lib.php',2686],['lib/htmlpurifier/HTMLPurifier','Lexer.php',53],['lib/google/src/Google/Service','Classroom.php',445],['lib/google/src/Google/Service','Classroom.php',596],['lib/google/src/Google/Service','Classroom.php',673],['lib/google/src/Google/Service','Classroom.php',783],['lib/google/src/Google/Service','Classroom.php',912],['lib/spout/src/Spout/Reader','ReaderFactory.php',18],['lib/google/src/Google/Service','Pubsub.php',220],['lib/google/src/Google/Service','Pubsub.php',365],['lib/google/src/Google/Service','CloudMonitoring.php',258]], 3276],
'add_external_service': ['add_external_service', 'Add a service It generates the timecreated field automatically. ', [['webservice','lib.php',675]], 1],
'get_external_service_by_id': ['get_external_service_by_id', 'Get an external service for a given service id ', [['webservice','lib.php',619]], 2],
'get_external_functions': ['get_external_functions', 'Get the functions list of a service list (by id) ', [['webservice','lib.php',449]], 4],
'close': ['close', 'Close archive, write changes to disk. ', [['lib/filestorage','zip_archive.php',183],['lib/dml','mssql_native_moodle_recordset.php',87],['auth/fc','fcFPP.php',78],['lib/dml','mysqli_native_moodle_recordset.php',86],['lib/spout/src/Spout/Reader','ReaderInterface.php',30],['lib/spout/src/Spout/Writer/ODS/Internal','Workbook.php',81],['lib/dml','pdo_moodle_recordset.php',79],['lib','csvlib.class.php',256],['lib/horde/framework/Horde/Socket','Client.php',135],['backup/util/helper','backup_null_iterator.class.php',53],['admin/tool/uploaduser','locallib.php',149],['lib/tcpdf','tcpdf.php',2943],['lib/phpunit/classes','phpmailer_sink.php',41],['lib/phpmailer','class.smtp.php',582],['lib/dml','sqlsrv_native_moodle_recordset.php',133],['lib/classes/dml','recordset_walk.php',153],['lib/spout/src/Spout/Writer/XLSX/Helper','SharedStringsHelper.php',84],['grade/export','lib.php',689],['lib','excellib.class.php',93],['backup/util/loggers','file_logger.class.php',69],['grade','lib.php',324],['backup/util/helper','backup_array_iterator.class.php',63],['lib/horde/framework/Horde/Imap/Client','Base.php',1846],['mod/assign/feedback/offline','importgradeslib.php',204],['lib/dml','oci_native_moodle_recordset.php',80],['lib/adodb','adodb.inc.php',2361],['lib/adodb','adodb.inc.php',3090],['lib/adodb','adodb.inc.php',3870],['lib/google/src/Google/Logger','File.php',132],['lib/phpunit/classes','event_sink.php',39],['lib/horde/framework/Horde','Stream.php',585],['backup/util/loggers','base_logger.class.php',89],['lib/phpexcel/PHPExcel/Shared','ZipArchive.php',71],['question/engine/tests','helpers.php',1241],['lib/spout/src/Spout/Writer','AbstractWriter.php',312],['lib','odslib.class.php',71],['lib/spout/src/Spout/Writer/Common/Internal','WorksheetInterface.php',34],['lib/spout/src/Spout/Writer/ODS/Internal','Worksheet.php',214],['lib/spout/src/Spout/Writer','WriterInterface.php',84],['lib/spout/src/Spout/Writer/XLSX/Internal','Worksheet.php',174],['lib/spout/src/Spout/Reader','AbstractReader.php',183],['lib/phpunit/classes','message_sink.php',39],['lib/spout/src/Spout/Writer/Common/Internal','WorkbookInterface.php',65],['lib/spout/src/Spout/Writer/XLSX/Internal','Workbook.php',95],['lib/pear/Net','GeoIP.php',556],['lib/tests','completionlib_test.php',907],['lib/pear/Auth','RADIUS.php',550],['lib/pear/Auth','RADIUS.php',710],['lib/pear/Auth','RADIUS.php',829],['lib','webdavlib.php',176],['lib/dml','pgsql_native_moodle_recordset.php',107]], 1128],
'instance': ['instance', 'Returns an instance of the cache_factor method. ', [['cache','disabledlib.php',171],['cache','disabledlib.php',296],['lib/classes','useragent.php',101],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['search/classes','manager.php',109],['cache','locallib.php',52],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['lib/classes','plugin_manager.php',103],['lib/htmlpurifier','HTMLPurifier.php',251],['course/format','lib.php',156],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['admin/tool/installaddon/classes','installer.php',40],['lib','modinfolib.php',373],['cache/classes','helper.php',76],['lib/tests','string_manager_standard_test.php',124],['lib/portfolio','exporter.php',251],['lib/classes/update','validator.php',88],['search/classes','document_factory.php',49],['lib','accesslib.php',6235],['lib','accesslib.php',6487],['lib','accesslib.php',6665],['lib','accesslib.php',6919],['lib','accesslib.php',7180],['lib','accesslib.php',7392],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443],['lib','filterlib.php',80],['search/tests/fixtures','testable_core_search.php',43],['lib/tests/fixtures','testable_update_checker.php',45],['backup/cc','validator.php',35],['cache/classes','config.php',87],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29]], 4647],
'instance_by_id': ['instance_by_id', 'Get a context instance as an object, from a given context id. ', [['lib','accesslib.php',5434]], 235],
'password_expire': ['password_expire', 'Return number of days to user password expires. ', [['auth/manual','auth.php',175],['auth/ldap','auth.php',616],['lib','authlib.php',364]], 8],
'add_ws_authorised_user': ['add_ws_authorised_user', 'Allow user to call a service ', [['webservice','lib.php',216]], 1],
'webservice_protocol_is_enabled': ['webservice_protocol_is_enabled', 'Check if a protocol is enabled ', [['webservice','lib.php',755]], 8],
'array_key_exists': ['array_key_exists', '', [], 1445],
'name': ['name', '', [], 118],
'call_user_func_array': ['call_user_func_array', '', [], 94],
'array_merge': ['array_merge', '', [], 2944],
'class_exists': ['class_exists', '', [], 279],
'set_exception_handler': ['set_exception_handler', '', [], 6],
'call_user_func': ['call_user_func', '', [], 113],
'in_array': ['in_array', '', [], 1234],
'explode': ['explode', '', [], 1572],
'intval': ['intval', '', [], 455],
'rand': ['rand', '', [], 99],
'trim': ['trim', '', [], 1948],
'array_values': ['array_values', '', [], 342],
'time': ['time', '', [], 1959],
'define': ['define', '', [], 2373],
'uniqid': ['uniqid', '', [], 86],
'is_array': ['is_array', '', [], 1608],
'implode': ['implode', '', [], 1281],
'array_search': ['array_search', '', [], 170]};
CLASS_DATA={
'webservice_login_failed': ['webservice_login_failed', 'Web service login failed event class. ', [['lib/classes/event','webservice_login_failed.php',28]], 16],
'webservice_server_interface': ['webservice_server_interface', 'Mandatory interface for all web service protocol classes ', [['webservice','lib.php',793]], 1],
'invalid_parameter_exception': ['invalid_parameter_exception', 'Exception indicating malformed parameter problem. This exception is not supposed to be thrown when processing user submitted data in forms. It is more suitable for WS and other low level stuff. ', [['lib','setuplib.php',259]], 88],
'external_api': ['external_api', 'Base class for external api methods. ', [['lib','externallib.php',47]], 808],
'webservice_function_called': ['webservice_function_called', 'Web service function called event class. ', [['lib/classes/event','webservice_function_called.php',28]], 3],
'coding_exception': ['coding_exception', 'Exception indicating programming error, must be fixed by a programer. For example a core API might throw this type of exception if a plugin calls it incorrectly. ', [['lib','setuplib.php',239]], 1200],
'external_settings': ['external_settings', 'Singleton to handle the external settings. ', [['lib','externallib.php',957]], 7],
'webservice_test_client_interface': ['webservice_test_client_interface', 'Mandatory interface for all test client classes. ', [['webservice','lib.php',773]], 3],
'context_system': ['context_system', 'System context class ', [['lib','accesslib.php',6157]], 1147],
'webservice': ['webservice', 'General web service library ', [['webservice','lib.php',43],['lib/classes/plugininfo','webservice.php',30]], 15],
'manager': ['manager', 'Search subsystem manager. ', [['search/classes','manager.php',31],['user/classes/output/myprofile','manager.php',28],['lib/classes/antivirus','manager.php',29],['lib/classes/event','manager.php',30],['lib/classes/task','manager.php',28],['admin/tool/messageinbound/classes','manager.php',29],['lib/classes/message/inbound','manager.php',29],['admin/tool/log/classes/log','manager.php',29],['lib/classes/log','manager.php',29],['lib/classes/session','manager.php',29],['lib/classes/message','manager.php',31]], 585],
'moodle_exception': ['moodle_exception', 'Base Moodle Exception class ', [['lib','setuplib.php',75]], 606],
'webservice_access_exception': ['webservice_access_exception', 'Exception indicating access control problem in web service call This exception should return general errors about web service setup. Errors related to the user like wrong username/password should not use it, you should not use this exception if you want to let the client implement some code logic against an access error. ', [['webservice','lib.php',732]], 24]};
CONST_DATA={
'VALUE_DEFAULT': ['VALUE_DEFAULT', '', [['lib','moodlelib.php',342]], 304],
'PARAM_INT': ['PARAM_INT', '', [['lib','moodlelib.php',156]], 3812],
'WEBSERVICE_AUTHMETHOD_SESSION_TOKEN': ['WEBSERVICE_AUTHMETHOD_SESSION_TOKEN', '', [['webservice','lib.php',41]], 2],
'EXTERNAL_TOKEN_PERMANENT': ['EXTERNAL_TOKEN_PERMANENT', '', [['lib','moodlelib.php',465]], 11],
'VALUE_OPTIONAL': ['VALUE_OPTIONAL', '', [['lib','moodlelib.php',337]], 761],
'CAP_ALLOW': ['CAP_ALLOW', '', [['lib','accesslib.php',135]], 1484],
'PARAM_FLOAT': ['PARAM_FLOAT', '', [['lib','moodlelib.php',146]], 103],
'NULL_ALLOWED': ['NULL_ALLOWED', '', [['lib','moodlelib.php',352]], 55],
'MUST_EXIST': ['MUST_EXIST', '', [['lib','dmllib.php',52]], 1384],
'WEBSERVICE_AUTHMETHOD_USERNAME': ['WEBSERVICE_AUTHMETHOD_USERNAME', '', [['webservice','lib.php',31]], 9],
'SITEID': ['SITEID', '', [['admin/cli','install.php',219],['lib/db','install.php',87],['','install.php',242],['lib','setup.php',755]], 608],
'IGNORE_MISSING': ['IGNORE_MISSING', '', [['lib','dmllib.php',48]], 215],
'EXTERNAL_TOKEN_EMBEDDED': ['EXTERNAL_TOKEN_EMBEDDED', '', [['lib','moodlelib.php',473]], 6],
'MEMORY_EXTRA': ['MEMORY_EXTRA', '', [['lib','setuplib.php',50]], 40],
'NO_MOODLE_COOKIES': ['NO_MOODLE_COOKIES', '', [['rss','file.php',34],['grade/export/xml','dump.php',18],['login','token.php',26],['','help.php',29],['grade/import/xml','fetch.php',18],['lib/ajax','service-nologin.php',30],['webservice','upload.php',42],['mod/data','js.php',26],['theme','font.php',124],['mod/data','css.php',26],['grade/export/txt','dump.php',18],['grade/export/xls','dump.php',18],['auth/ldap','ntlmsso_magic.php',7],['lib/editor/tinymce','all_strings.php',25],['lib/flowplayer','flowplayer-3.2.18.swf.php',26],['theme','image.php',127],['mod/lti','services.php',27],['mod/assign/feedback/editpdf','ajax_progress.php',28],['mod/chat/gui_header_js','chatinput.php',17],['','help_ajax.php',26],['user','grouppix.php',30],['mod/chat/gui_sockets','chatinput.php',17],['theme','javascript.php',83],['badges','assertion.php',28],['lib/editor/tinymce/plugins','loader.php',32],['filter/tex','pix.php',8],['mod/lti','service.php',27],['mod/chat/gui_header_js','jsupdated.php',33],['filter/algebra','pix.php',8],['grade/export/ods','dump.php',18],['theme','styles_debug.php',29],['mod/chat/gui_header_js','users.php',17],['lib/flowplayer','flowplayer.audio-3.2.11.swf.php',26],['lib','setuplib.php',863],['mnet/xmlrpc','server.php',16],['mod/chat/gui_header_js','jsupdate.php',17],['filter/tex','displaytex.php',28],['webservice','pluginfile.php',34],['theme','styles.php',112],['lib','setup.php',760],['lib','setup.php',764],['lib','setup.php',769],['lib','setup.php',772],['lib','setup.php',774],['lib/flowplayer','flowplayer.controls-3.2.16.swf.php',26],['lib/editor/tinymce/plugins/moodleemoticon','dialog.php',25]], 57],
'WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN': ['WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN', '', [['webservice','lib.php',36]], 7],
'PARAM_BOOL': ['PARAM_BOOL', '', [['lib','moodlelib.php',108]], 802]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu Aug 11 10:00:09 2016</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
