<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /webservice/lib.php source</title>
    <link rel="stylesheet" href="../sample.css" type="text/css">
    <link rel="stylesheet" href="../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Thu May 28 19:17:31 2015 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../';
subdir='webservice';
filename='lib.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/webservice/</a> -> <a href="lib.php.html">lib.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="lib.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="lib.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">// This file is part of Moodle - http://moodle.org/</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment">//</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment">// Moodle is free software: you can redistribute it and/or modify</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment">// it under the terms of the GNU General Public License as published by</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment">// the Free Software Foundation, either version 3 of the License, or</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment">// (at your option) any later version.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment">//</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment">// Moodle is distributed in the hope that it will be useful,</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment">// GNU General Public License for more details.</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">//</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment">// You should have received a copy of the GNU General Public License</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment">// along with Moodle.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment">/**</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> * Web services utility functions and classes</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> *</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @package    core_webservice</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * @copyright  2009 Jerome Mouneyrac &lt;jerome@moodle.com&gt;</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> */</span>
<a name="l25"><span class="linenum">  25</span></a>  
<a name="l26"><span class="linenum">  26</span></a>  require_once(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('libdir')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/libdir.html">libdir</a>.'/externallib.php');
<a name="l27"><span class="linenum">  27</span></a>  
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment">/**</span>
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment"> * WEBSERVICE_AUTHMETHOD_USERNAME - username/password authentication (also called simple authentication)</span>
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment"> */</span>
<a name="l31"><span class="linenum">  31</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('WEBSERVICE_AUTHMETHOD_USERNAME')" href="../_constants/WEBSERVICE_AUTHMETHOD_USERNAME.html" onMouseOver="constPopup(event,'WEBSERVICE_AUTHMETHOD_USERNAME')">WEBSERVICE_AUTHMETHOD_USERNAME</a>', 0);
<a name="l32"><span class="linenum">  32</span></a>  
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment">/**</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment"> * WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN - most common token authentication (external app, mobile app...)</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment"> */</span>
<a name="l36"><span class="linenum">  36</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN')" href="../_constants/WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN.html" onMouseOver="constPopup(event,'WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN')">WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN</a>', 1);
<a name="l37"><span class="linenum">  37</span></a>  
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment">/**</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment"> * WEBSERVICE_AUTHMETHOD_SESSION_TOKEN - token for embedded application (requires Moodle session)</span>
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment"> */</span>
<a name="l41"><span class="linenum">  41</span></a>  <a class="phpfunction" onClick="logFunction('define')" href="../_functions/define.html" onMouseOver="phpfuncPopup(event,'define')">define</a>('<a class="constant" onClick="logConstant('WEBSERVICE_AUTHMETHOD_SESSION_TOKEN')" href="../_constants/WEBSERVICE_AUTHMETHOD_SESSION_TOKEN.html" onMouseOver="constPopup(event,'WEBSERVICE_AUTHMETHOD_SESSION_TOKEN')">WEBSERVICE_AUTHMETHOD_SESSION_TOKEN</a>', 2);
<a name="l42"><span class="linenum">  42</span></a>  
<a name="l43"><span class="linenum">  43</span></a>  <span class="comment">/**</span>
<a name="l44"><span class="linenum">  44</span></a>  <span class="comment"> * General web service library</span>
<a name="l45"><span class="linenum">  45</span></a>  <span class="comment"> *</span>
<a name="l46"><span class="linenum">  46</span></a>  <span class="comment"> * @package    core_webservice</span>
<a name="l47"><span class="linenum">  47</span></a>  <span class="comment"> * @copyright  2010 Jerome Mouneyrac &lt;jerome@moodle.com&gt;</span>
<a name="l48"><span class="linenum">  48</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l49"><span class="linenum">  49</span></a>  <span class="comment"> */</span>
<a name="l50"><span class="linenum">  50</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('webservice')" href="../_classes/webservice.html" onMouseOver="classPopup(event,'webservice')">webservice</a> {
<a name="l51"><span class="linenum">  51</span></a>  
<a name="l52"><span class="linenum">  52</span></a>      <span class="comment">/**</span>
<a name="l53"><span class="linenum">  53</span></a>  <span class="comment">     * Authenticate user (used by download/upload file scripts)</span>
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment">     *</span>
<a name="l55"><span class="linenum">  55</span></a>  <span class="comment">     * @param string $token</span>
<a name="l56"><span class="linenum">  56</span></a>  <span class="comment">     * @return array - contains the authenticated user, token and service objects</span>
<a name="l57"><span class="linenum">  57</span></a>  <span class="comment">     */</span>
<a name="l58"><span class="linenum">  58</span></a>      public function <a class="function" onClick="logFunction('authenticate_user')" href="../_functions/authenticate_user.html" onMouseOver="funcPopup(event,'authenticate_user')">authenticate_user</a>(<a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>) {
<a name="l59"><span class="linenum">  59</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l60"><span class="linenum">  60</span></a>  
<a name="l61"><span class="linenum">  61</span></a>  <span class="comment">        // web service must be enabled to use this script</span>
<a name="l62"><span class="linenum">  62</span></a>          if (!<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enablewebservices')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/enablewebservices.html">enablewebservices</a>) {
<a name="l63"><span class="linenum">  63</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Web services are not enabled in Advanced features.');
<a name="l64"><span class="linenum">  64</span></a>          }
<a name="l65"><span class="linenum">  65</span></a>  
<a name="l66"><span class="linenum">  66</span></a>  <span class="comment">        // Obtain token record</span>
<a name="l67"><span class="linenum">  67</span></a>          if (!<a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('external_tokens', array('token' =&gt; <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>))) {
<a name="l68"><span class="linenum">  68</span></a>  <span class="comment">            //client may want to display login form =&gt; moodle_exception</span>
<a name="l69"><span class="linenum">  69</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('invalidtoken', 'webservice');
<a name="l70"><span class="linenum">  70</span></a>          }
<a name="l71"><span class="linenum">  71</span></a>  
<a name="l72"><span class="linenum">  72</span></a>          <a class="var it4638" onMouseOver="hilite(4638)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a> = array(
<a name="l73"><span class="linenum">  73</span></a>              'other' =&gt; array(
<a name="l74"><span class="linenum">  74</span></a>                  'method' =&gt; <a class="constant" onClick="logConstant('WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN')" href="../_constants/WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN.html" onMouseOver="constPopup(event,'WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN')">WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN</a>,
<a name="l75"><span class="linenum">  75</span></a>                  'reason' =&gt; null,
<a name="l76"><span class="linenum">  76</span></a>                  'tokenid' =&gt; <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;id
<a name="l77"><span class="linenum">  77</span></a>              )
<a name="l78"><span class="linenum">  78</span></a>          );
<a name="l79"><span class="linenum">  79</span></a>  
<a name="l80"><span class="linenum">  80</span></a>  <span class="comment">        // Validate token date</span>
<a name="l81"><span class="linenum">  81</span></a>          if (<a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('validuntil')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/validuntil.html">validuntil</a> and <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('validuntil')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/validuntil.html">validuntil</a> &lt; <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()) {
<a name="l82"><span class="linenum">  82</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it4638" onMouseOver="hilite(4638)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l83"><span class="linenum">  83</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'token_expired';
<a name="l84"><span class="linenum">  84</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l85"><span class="linenum">  85</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('external_tokens', <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>);
<a name="l86"><span class="linenum">  86</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, 'webservice', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('tokenauthlog', 'webservice'), '',
<a name="l87"><span class="linenum">  87</span></a>                  <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('invalidtimedtoken', 'webservice'), 0));
<a name="l88"><span class="linenum">  88</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l89"><span class="linenum">  89</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_tokens', array('token' =&gt; <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('token')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/token.html">token</a>));
<a name="l90"><span class="linenum">  90</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Invalid token - token expired - check validuntil time for the token');
<a name="l91"><span class="linenum">  91</span></a>          }
<a name="l92"><span class="linenum">  92</span></a>  
<a name="l93"><span class="linenum">  93</span></a>  <span class="comment">        // Check ip</span>
<a name="l94"><span class="linenum">  94</span></a>          if (<a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a> and !<a class="function" onClick="logFunction('address_in_subnet')" href="../_functions/address_in_subnet.html" onMouseOver="funcPopup(event,'address_in_subnet')">address_in_subnet</a>(<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>(), <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a>)) {
<a name="l95"><span class="linenum">  95</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it4638" onMouseOver="hilite(4638)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l96"><span class="linenum">  96</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'ip_restricted';
<a name="l97"><span class="linenum">  97</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l98"><span class="linenum">  98</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('external_tokens', <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>);
<a name="l99"><span class="linenum">  99</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, 'webservice', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('tokenauthlog', 'webservice'), '',
<a name="l100"><span class="linenum"> 100</span></a>                  <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('failedtolog', 'webservice') . &quot;: &quot; . <a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>(), 0));
<a name="l101"><span class="linenum"> 101</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l102"><span class="linenum"> 102</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Invalid token - IP:' . <a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>()
<a name="l103"><span class="linenum"> 103</span></a>                      . ' is not supported');
<a name="l104"><span class="linenum"> 104</span></a>          }
<a name="l105"><span class="linenum"> 105</span></a>  
<a name="l106"><span class="linenum"> 106</span></a>  <span class="comment">        //retrieve user link to the token</span>
<a name="l107"><span class="linenum"> 107</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id' =&gt; <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('userid')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>, 'deleted' =&gt; 0), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l108"><span class="linenum"> 108</span></a>  
<a name="l109"><span class="linenum"> 109</span></a>  <span class="comment">        // let enrol plugins deal with new enrolments if necessary</span>
<a name="l110"><span class="linenum"> 110</span></a>          <a class="function" onClick="logFunction('enrol_check_plugins')" href="../_functions/enrol_check_plugins.html" onMouseOver="funcPopup(event,'enrol_check_plugins')">enrol_check_plugins</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l111"><span class="linenum"> 111</span></a>  
<a name="l112"><span class="linenum"> 112</span></a>  <span class="comment">        // setup user session to check capability</span>
<a name="l113"><span class="linenum"> 113</span></a>          \core\session\<a class="class" onClick="logClass('manager')" href="../_classes/manager.html" onMouseOver="classPopup(event,'manager')">manager</a>::<a class="function" onClick="logFunction('set_user')" href="../_functions/set_user.html" onMouseOver="funcPopup(event,'set_user')">set_user</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l114"><span class="linenum"> 114</span></a>  
<a name="l115"><span class="linenum"> 115</span></a>  <span class="comment">        //assumes that if sid is set then there must be a valid associated session no matter the token type</span>
<a name="l116"><span class="linenum"> 116</span></a>          if (<a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('sid')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/sid.html">sid</a>) {
<a name="l117"><span class="linenum"> 117</span></a>              if (!\core\session\<a class="class" onClick="logClass('manager')" href="../_classes/manager.html" onMouseOver="classPopup(event,'manager')">manager</a>::<a class="function" onClick="logFunction('session_exists')" href="../_functions/session_exists.html" onMouseOver="funcPopup(event,'session_exists')">session_exists</a>(<a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('sid')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/sid.html">sid</a>)) {
<a name="l118"><span class="linenum"> 118</span></a>                  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_tokens', array('sid' =&gt; <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('sid')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/sid.html">sid</a>));
<a name="l119"><span class="linenum"> 119</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Invalid session based token - session not found or expired');
<a name="l120"><span class="linenum"> 120</span></a>              }
<a name="l121"><span class="linenum"> 121</span></a>          }
<a name="l122"><span class="linenum"> 122</span></a>  
<a name="l123"><span class="linenum"> 123</span></a>  <span class="comment">        //Non admin can not authenticate if maintenance mode</span>
<a name="l124"><span class="linenum"> 124</span></a>          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('hassiteconfig')" href="../_variables/hassiteconfig.html">$hassiteconfig</a> = <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:config', <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(), <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l125"><span class="linenum"> 125</span></a>          if (!empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('maintenance_enabled')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/maintenance_enabled.html">maintenance_enabled</a>) and !<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('hassiteconfig')" href="../_variables/hassiteconfig.html">$hassiteconfig</a>) {
<a name="l126"><span class="linenum"> 126</span></a>  <span class="comment">            //this is usually temporary, client want to implement code logic  =&gt; moodle_exception</span>
<a name="l127"><span class="linenum"> 127</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('sitemaintenance', 'admin');
<a name="l128"><span class="linenum"> 128</span></a>          }
<a name="l129"><span class="linenum"> 129</span></a>  
<a name="l130"><span class="linenum"> 130</span></a>  <span class="comment">        //retrieve web service record</span>
<a name="l131"><span class="linenum"> 131</span></a>          <a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('external_services', array('id' =&gt; <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('externalserviceid')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/externalserviceid.html">externalserviceid</a>, 'enabled' =&gt; 1));
<a name="l132"><span class="linenum"> 132</span></a>          if (empty(<a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>)) {
<a name="l133"><span class="linenum"> 133</span></a>  <span class="comment">            // will throw exception if no token found</span>
<a name="l134"><span class="linenum"> 134</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Web service is not available (it doesn\'t exist or might be disabled)');
<a name="l135"><span class="linenum"> 135</span></a>          }
<a name="l136"><span class="linenum"> 136</span></a>  
<a name="l137"><span class="linenum"> 137</span></a>  <span class="comment">        //check if there is any required system capability</span>
<a name="l138"><span class="linenum"> 138</span></a>          if (<a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('requiredcapability')" class="var it40434" onMouseOver="hilite(40434)" onMouseOut="lolite()" href="../_variables/requiredcapability.html">requiredcapability</a> and !<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(<a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('requiredcapability')" class="var it40434" onMouseOver="hilite(40434)" onMouseOut="lolite()" href="../_variables/requiredcapability.html">requiredcapability</a>, <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(), <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l139"><span class="linenum"> 139</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('The capability ' . <a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('requiredcapability')" class="var it40434" onMouseOver="hilite(40434)" onMouseOut="lolite()" href="../_variables/requiredcapability.html">requiredcapability</a> . ' is required.');
<a name="l140"><span class="linenum"> 140</span></a>          }
<a name="l141"><span class="linenum"> 141</span></a>  
<a name="l142"><span class="linenum"> 142</span></a>  <span class="comment">        //specific checks related to user restricted service</span>
<a name="l143"><span class="linenum"> 143</span></a>          if (<a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('restrictedusers')" class="var it40434" onMouseOver="hilite(40434)" onMouseOut="lolite()" href="../_variables/restrictedusers.html">restrictedusers</a>) {
<a name="l144"><span class="linenum"> 144</span></a>              <a class="var it4625" onMouseOver="hilite(4625)" onMouseOut="lolite()" onClick="logVariable('authoriseduser')" href="../_variables/authoriseduser.html">$authoriseduser</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('external_services_users', array('externalserviceid' =&gt; <a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('id')" class="var it40434" onMouseOver="hilite(40434)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'userid' =&gt; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l145"><span class="linenum"> 145</span></a>  
<a name="l146"><span class="linenum"> 146</span></a>              if (empty(<a class="var it4625" onMouseOver="hilite(4625)" onMouseOut="lolite()" onClick="logVariable('authoriseduser')" href="../_variables/authoriseduser.html">$authoriseduser</a>)) {
<a name="l147"><span class="linenum"> 147</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>(
<a name="l148"><span class="linenum"> 148</span></a>                          'The user is not allowed for this service. First you need to allow this user on the '
<a name="l149"><span class="linenum"> 149</span></a>                          . <a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('name')" class="var it40434" onMouseOver="hilite(40434)" onMouseOut="lolite()" href="../_variables/name.html">name</a> . '\'s allowed users administration page.');
<a name="l150"><span class="linenum"> 150</span></a>              }
<a name="l151"><span class="linenum"> 151</span></a>  
<a name="l152"><span class="linenum"> 152</span></a>              if (!empty(<a class="var it4625" onMouseOver="hilite(4625)" onMouseOut="lolite()" onClick="logVariable('authoriseduser')" href="../_variables/authoriseduser.html">$authoriseduser</a>-&gt;<a onClick="logVariable('validuntil')" class="var it40436" onMouseOver="hilite(40436)" onMouseOut="lolite()" href="../_variables/validuntil.html">validuntil</a>) and <a class="var it4625" onMouseOver="hilite(4625)" onMouseOut="lolite()" onClick="logVariable('authoriseduser')" href="../_variables/authoriseduser.html">$authoriseduser</a>-&gt;<a onClick="logVariable('validuntil')" class="var it40436" onMouseOver="hilite(40436)" onMouseOut="lolite()" href="../_variables/validuntil.html">validuntil</a> &lt; <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()) {
<a name="l153"><span class="linenum"> 153</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Invalid service - service expired - check validuntil time for this allowed user');
<a name="l154"><span class="linenum"> 154</span></a>              }
<a name="l155"><span class="linenum"> 155</span></a>  
<a name="l156"><span class="linenum"> 156</span></a>              if (!empty(<a class="var it4625" onMouseOver="hilite(4625)" onMouseOut="lolite()" onClick="logVariable('authoriseduser')" href="../_variables/authoriseduser.html">$authoriseduser</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it40436" onMouseOver="hilite(40436)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a>) and !<a class="function" onClick="logFunction('address_in_subnet')" href="../_functions/address_in_subnet.html" onMouseOver="funcPopup(event,'address_in_subnet')">address_in_subnet</a>(<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>(), <a class="var it4625" onMouseOver="hilite(4625)" onMouseOut="lolite()" onClick="logVariable('authoriseduser')" href="../_variables/authoriseduser.html">$authoriseduser</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it40436" onMouseOver="hilite(40436)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a>)) {
<a name="l157"><span class="linenum"> 157</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Invalid service - IP:' . <a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>()
<a name="l158"><span class="linenum"> 158</span></a>                      . ' is not supported - check this allowed user');
<a name="l159"><span class="linenum"> 159</span></a>              }
<a name="l160"><span class="linenum"> 160</span></a>          }
<a name="l161"><span class="linenum"> 161</span></a>  
<a name="l162"><span class="linenum"> 162</span></a>  <span class="comment">        //only confirmed user should be able to call web service</span>
<a name="l163"><span class="linenum"> 163</span></a>          if (empty(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('confirmed')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/confirmed.html">confirmed</a>)) {
<a name="l164"><span class="linenum"> 164</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it4638" onMouseOver="hilite(4638)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l165"><span class="linenum"> 165</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'user_unconfirmed';
<a name="l166"><span class="linenum"> 166</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l167"><span class="linenum"> 167</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('external_tokens', <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>);
<a name="l168"><span class="linenum"> 168</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, 'webservice', 'user unconfirmed', '', <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>));
<a name="l169"><span class="linenum"> 169</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l170"><span class="linenum"> 170</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('usernotconfirmed', 'moodle', '', <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l171"><span class="linenum"> 171</span></a>          }
<a name="l172"><span class="linenum"> 172</span></a>  
<a name="l173"><span class="linenum"> 173</span></a>  <span class="comment">        //check the user is suspended</span>
<a name="l174"><span class="linenum"> 174</span></a>          if (!empty(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('suspended')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/suspended.html">suspended</a>)) {
<a name="l175"><span class="linenum"> 175</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it4638" onMouseOver="hilite(4638)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l176"><span class="linenum"> 176</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'user_suspended';
<a name="l177"><span class="linenum"> 177</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l178"><span class="linenum"> 178</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('external_tokens', <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>);
<a name="l179"><span class="linenum"> 179</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, 'webservice', 'user suspended', '', <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>));
<a name="l180"><span class="linenum"> 180</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l181"><span class="linenum"> 181</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Refused web service access for suspended username: ' . <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l182"><span class="linenum"> 182</span></a>          }
<a name="l183"><span class="linenum"> 183</span></a>  
<a name="l184"><span class="linenum"> 184</span></a>  <span class="comment">        //check if the auth method is nologin (in this case refuse connection)</span>
<a name="l185"><span class="linenum"> 185</span></a>          if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/auth.html">auth</a> == 'nologin') {
<a name="l186"><span class="linenum"> 186</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it4638" onMouseOver="hilite(4638)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l187"><span class="linenum"> 187</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'nologin';
<a name="l188"><span class="linenum"> 188</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l189"><span class="linenum"> 189</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('external_tokens', <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>);
<a name="l190"><span class="linenum"> 190</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, 'webservice', 'nologin auth attempt with web service', '', <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>));
<a name="l191"><span class="linenum"> 191</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l192"><span class="linenum"> 192</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Refused web service access for nologin authentication username: ' . <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l193"><span class="linenum"> 193</span></a>          }
<a name="l194"><span class="linenum"> 194</span></a>  
<a name="l195"><span class="linenum"> 195</span></a>  <span class="comment">        //Check if the user password is expired</span>
<a name="l196"><span class="linenum"> 196</span></a>          <a class="var it524" onMouseOver="hilite(524)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../_variables/auth.html">$auth</a> = <a class="function" onClick="logFunction('get_auth_plugin')" href="../_functions/get_auth_plugin.html" onMouseOver="funcPopup(event,'get_auth_plugin')">get_auth_plugin</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/auth.html">auth</a>);
<a name="l197"><span class="linenum"> 197</span></a>          if (!empty(<a class="var it524" onMouseOver="hilite(524)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../_variables/auth.html">$auth</a>-&gt;<a onClick="logVariable('config')" class="var it40437" onMouseOver="hilite(40437)" onMouseOut="lolite()" href="../_variables/config.html">config</a>-&gt;expiration) and <a class="var it524" onMouseOver="hilite(524)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../_variables/auth.html">$auth</a>-&gt;<a onClick="logVariable('config')" class="var it40437" onMouseOver="hilite(40437)" onMouseOut="lolite()" href="../_variables/config.html">config</a>-&gt;expiration == 1) {
<a name="l198"><span class="linenum"> 198</span></a>              <a class="var it4622" onMouseOver="hilite(4622)" onMouseOut="lolite()" onClick="logVariable('days2expire')" href="../_variables/days2expire.html">$days2expire</a> = <a class="var it524" onMouseOver="hilite(524)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../_variables/auth.html">$auth</a>-&gt;<a class="function" onClick="logFunction('password_expire')" href="../_functions/password_expire.html" onMouseOver="funcPopup(event,'password_expire')">password_expire</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l199"><span class="linenum"> 199</span></a>              if (<a class="phpfunction" onClick="logFunction('intval')" href="../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>(<a class="var it4622" onMouseOver="hilite(4622)" onMouseOut="lolite()" onClick="logVariable('days2expire')" href="../_variables/days2expire.html">$days2expire</a>) &lt; 0) {
<a name="l200"><span class="linenum"> 200</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it4638" onMouseOver="hilite(4638)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l201"><span class="linenum"> 201</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'password_expired';
<a name="l202"><span class="linenum"> 202</span></a>                  <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l203"><span class="linenum"> 203</span></a>                  <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('external_tokens', <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>);
<a name="l204"><span class="linenum"> 204</span></a>                  <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, 'webservice', 'expired password', '', <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>));
<a name="l205"><span class="linenum"> 205</span></a>                  <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l206"><span class="linenum"> 206</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('passwordisexpired', 'webservice');
<a name="l207"><span class="linenum"> 207</span></a>              }
<a name="l208"><span class="linenum"> 208</span></a>          }
<a name="l209"><span class="linenum"> 209</span></a>  
<a name="l210"><span class="linenum"> 210</span></a>  <span class="comment">        // log token access</span>
<a name="l211"><span class="linenum"> 211</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('external_tokens', 'lastaccess', <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>(), array('id' =&gt; <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('id')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l212"><span class="linenum"> 212</span></a>  
<a name="l213"><span class="linenum"> 213</span></a>          return array('user' =&gt; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, 'token' =&gt; <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>, 'service' =&gt; <a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>);
<a name="l214"><span class="linenum"> 214</span></a>      }
<a name="l215"><span class="linenum"> 215</span></a>  
<a name="l216"><span class="linenum"> 216</span></a>      <span class="comment">/**</span>
<a name="l217"><span class="linenum"> 217</span></a>  <span class="comment">     * Allow user to call a service</span>
<a name="l218"><span class="linenum"> 218</span></a>  <span class="comment">     *</span>
<a name="l219"><span class="linenum"> 219</span></a>  <span class="comment">     * @param stdClass $user a user</span>
<a name="l220"><span class="linenum"> 220</span></a>  <span class="comment">     */</span>
<a name="l221"><span class="linenum"> 221</span></a>      public function <a class="function" onClick="logFunction('add_ws_authorised_user')" href="../_functions/add_ws_authorised_user.html" onMouseOver="funcPopup(event,'add_ws_authorised_user')">add_ws_authorised_user</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) {
<a name="l222"><span class="linenum"> 222</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l223"><span class="linenum"> 223</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('timecreated')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a> = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l224"><span class="linenum"> 224</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('external_services_users', <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l225"><span class="linenum"> 225</span></a>      }
<a name="l226"><span class="linenum"> 226</span></a>  
<a name="l227"><span class="linenum"> 227</span></a>      <span class="comment">/**</span>
<a name="l228"><span class="linenum"> 228</span></a>  <span class="comment">     * Disallow a user to call a service</span>
<a name="l229"><span class="linenum"> 229</span></a>  <span class="comment">     *</span>
<a name="l230"><span class="linenum"> 230</span></a>  <span class="comment">     * @param stdClass $user a user</span>
<a name="l231"><span class="linenum"> 231</span></a>  <span class="comment">     * @param int $serviceid</span>
<a name="l232"><span class="linenum"> 232</span></a>  <span class="comment">     */</span>
<a name="l233"><span class="linenum"> 233</span></a>      public function <a class="function" onClick="logFunction('remove_ws_authorised_user')" href="../_functions/remove_ws_authorised_user.html" onMouseOver="funcPopup(event,'remove_ws_authorised_user')">remove_ws_authorised_user</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>, <a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>) {
<a name="l234"><span class="linenum"> 234</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l235"><span class="linenum"> 235</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_services_users',
<a name="l236"><span class="linenum"> 236</span></a>                  array('externalserviceid' =&gt; <a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>, 'userid' =&gt; <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l237"><span class="linenum"> 237</span></a>      }
<a name="l238"><span class="linenum"> 238</span></a>  
<a name="l239"><span class="linenum"> 239</span></a>      <span class="comment">/**</span>
<a name="l240"><span class="linenum"> 240</span></a>  <span class="comment">     * Update allowed user settings (ip restriction, valid until...)</span>
<a name="l241"><span class="linenum"> 241</span></a>  <span class="comment">     *</span>
<a name="l242"><span class="linenum"> 242</span></a>  <span class="comment">     * @param stdClass $user</span>
<a name="l243"><span class="linenum"> 243</span></a>  <span class="comment">     */</span>
<a name="l244"><span class="linenum"> 244</span></a>      public function <a class="function" onClick="logFunction('update_ws_authorised_user')" href="../_functions/update_ws_authorised_user.html" onMouseOver="funcPopup(event,'update_ws_authorised_user')">update_ws_authorised_user</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) {
<a name="l245"><span class="linenum"> 245</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l246"><span class="linenum"> 246</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('external_services_users', <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l247"><span class="linenum"> 247</span></a>      }
<a name="l248"><span class="linenum"> 248</span></a>  
<a name="l249"><span class="linenum"> 249</span></a>      <span class="comment">/**</span>
<a name="l250"><span class="linenum"> 250</span></a>  <span class="comment">     * Return list of allowed users with their options (ip/timecreated / validuntil...)</span>
<a name="l251"><span class="linenum"> 251</span></a>  <span class="comment">     * for a given service</span>
<a name="l252"><span class="linenum"> 252</span></a>  <span class="comment">     *</span>
<a name="l253"><span class="linenum"> 253</span></a>  <span class="comment">     * @param int $serviceid the service id to search against</span>
<a name="l254"><span class="linenum"> 254</span></a>  <span class="comment">     * @return array $users</span>
<a name="l255"><span class="linenum"> 255</span></a>  <span class="comment">     */</span>
<a name="l256"><span class="linenum"> 256</span></a>      public function <a class="function" onClick="logFunction('get_ws_authorised_users')" href="../_functions/get_ws_authorised_users.html" onMouseOver="funcPopup(event,'get_ws_authorised_users')">get_ws_authorised_users</a>(<a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>) {
<a name="l257"><span class="linenum"> 257</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l258"><span class="linenum"> 258</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('siteguest')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/siteguest.html">siteguest</a>, <a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>);
<a name="l259"><span class="linenum"> 259</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot; SELECT u.id as id, esu.id as serviceuserid, u.email as email, u.firstname as firstname,
<a name="l260"><span class="linenum"> 260</span></a>                          u.lastname as lastname,
<a name="l261"><span class="linenum"> 261</span></a>                          esu.iprestriction as iprestriction, esu.validuntil as validuntil,
<a name="l262"><span class="linenum"> 262</span></a>                          esu.timecreated as timecreated
<a name="l263"><span class="linenum"> 263</span></a>                     FROM {user} u, {external_services_users} esu
<a name="l264"><span class="linenum"> 264</span></a>                    WHERE u.id &lt;&gt; ? AND u.deleted = 0 AND u.confirmed = 1
<a name="l265"><span class="linenum"> 265</span></a>                          AND esu.userid = u.id
<a name="l266"><span class="linenum"> 266</span></a>                          AND esu.externalserviceid = ?&quot;;
<a name="l267"><span class="linenum"> 267</span></a>  
<a name="l268"><span class="linenum"> 268</span></a>          <a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l269"><span class="linenum"> 269</span></a>          return <a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a>;
<a name="l270"><span class="linenum"> 270</span></a>      }
<a name="l271"><span class="linenum"> 271</span></a>  
<a name="l272"><span class="linenum"> 272</span></a>      <span class="comment">/**</span>
<a name="l273"><span class="linenum"> 273</span></a>  <span class="comment">     * Return an authorised user with their options (ip/timecreated / validuntil...)</span>
<a name="l274"><span class="linenum"> 274</span></a>  <span class="comment">     *</span>
<a name="l275"><span class="linenum"> 275</span></a>  <span class="comment">     * @param int $serviceid the service id to search against</span>
<a name="l276"><span class="linenum"> 276</span></a>  <span class="comment">     * @param int $userid the user to search against</span>
<a name="l277"><span class="linenum"> 277</span></a>  <span class="comment">     * @return stdClass</span>
<a name="l278"><span class="linenum"> 278</span></a>  <span class="comment">     */</span>
<a name="l279"><span class="linenum"> 279</span></a>      public function <a class="function" onClick="logFunction('get_ws_authorised_user')" href="../_functions/get_ws_authorised_user.html" onMouseOver="funcPopup(event,'get_ws_authorised_user')">get_ws_authorised_user</a>(<a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) {
<a name="l280"><span class="linenum"> 280</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l281"><span class="linenum"> 281</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('siteguest')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/siteguest.html">siteguest</a>, <a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>, <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>);
<a name="l282"><span class="linenum"> 282</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot; SELECT u.id as id, esu.id as serviceuserid, u.email as email, u.firstname as firstname,
<a name="l283"><span class="linenum"> 283</span></a>                          u.lastname as lastname,
<a name="l284"><span class="linenum"> 284</span></a>                          esu.iprestriction as iprestriction, esu.validuntil as validuntil,
<a name="l285"><span class="linenum"> 285</span></a>                          esu.timecreated as timecreated
<a name="l286"><span class="linenum"> 286</span></a>                     FROM {user} u, {external_services_users} esu
<a name="l287"><span class="linenum"> 287</span></a>                    WHERE u.id &lt;&gt; ? AND u.deleted = 0 AND u.confirmed = 1
<a name="l288"><span class="linenum"> 288</span></a>                          AND esu.userid = u.id
<a name="l289"><span class="linenum"> 289</span></a>                          AND esu.externalserviceid = ?
<a name="l290"><span class="linenum"> 290</span></a>                          AND u.id = ?&quot;;
<a name="l291"><span class="linenum"> 291</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l292"><span class="linenum"> 292</span></a>          return <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>;
<a name="l293"><span class="linenum"> 293</span></a>      }
<a name="l294"><span class="linenum"> 294</span></a>  
<a name="l295"><span class="linenum"> 295</span></a>      <span class="comment">/**</span>
<a name="l296"><span class="linenum"> 296</span></a>  <span class="comment">     * Generate all tokens of a specific user</span>
<a name="l297"><span class="linenum"> 297</span></a>  <span class="comment">     *</span>
<a name="l298"><span class="linenum"> 298</span></a>  <span class="comment">     * @param int $userid user id</span>
<a name="l299"><span class="linenum"> 299</span></a>  <span class="comment">     */</span>
<a name="l300"><span class="linenum"> 300</span></a>      public function <a class="function" onClick="logFunction('generate_user_ws_tokens')" href="../_functions/generate_user_ws_tokens.html" onMouseOver="funcPopup(event,'generate_user_ws_tokens')">generate_user_ws_tokens</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) {
<a name="l301"><span class="linenum"> 301</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l302"><span class="linenum"> 302</span></a>  
<a name="l303"><span class="linenum"> 303</span></a>  <span class="comment">        // generate a token for non admin if web service are enable and the user has the capability to create a token</span>
<a name="l304"><span class="linenum"> 304</span></a>          if (!<a class="function" onClick="logFunction('is_siteadmin')" href="../_functions/is_siteadmin.html" onMouseOver="funcPopup(event,'is_siteadmin')">is_siteadmin</a>() &amp;&amp; <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/webservice:createtoken', <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(), <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) &amp;&amp; !empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enablewebservices')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/enablewebservices.html">enablewebservices</a>)) {
<a name="l305"><span class="linenum"> 305</span></a>  <span class="comment">            // for every service than the user is authorised on, create a token (if it doesn't already exist)</span>
<a name="l306"><span class="linenum"> 306</span></a>  
<a name="l307"><span class="linenum"> 307</span></a>  <span class="comment">            // get all services which are set to all user (no restricted to specific users)</span>
<a name="l308"><span class="linenum"> 308</span></a>              <a class="var it4641" onMouseOver="hilite(4641)" onMouseOut="lolite()" onClick="logVariable('norestrictedservices')" href="../_variables/norestrictedservices.html">$norestrictedservices</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('external_services', array('restrictedusers' =&gt; 0));
<a name="l309"><span class="linenum"> 309</span></a>              <a class="var it4642" onMouseOver="hilite(4642)" onMouseOut="lolite()" onClick="logVariable('serviceidlist')" href="../_variables/serviceidlist.html">$serviceidlist</a> = array();
<a name="l310"><span class="linenum"> 310</span></a>              foreach (<a class="var it4641" onMouseOver="hilite(4641)" onMouseOut="lolite()" onClick="logVariable('norestrictedservices')" href="../_variables/norestrictedservices.html">$norestrictedservices</a> as <a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>) {
<a name="l311"><span class="linenum"> 311</span></a>                  <a class="var it4642" onMouseOver="hilite(4642)" onMouseOut="lolite()" onClick="logVariable('serviceidlist')" href="../_variables/serviceidlist.html">$serviceidlist</a>[] = <a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('id')" class="var it40434" onMouseOver="hilite(40434)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l312"><span class="linenum"> 312</span></a>              }
<a name="l313"><span class="linenum"> 313</span></a>  
<a name="l314"><span class="linenum"> 314</span></a>  <span class="comment">            // get all services which are set to the current user (the current user is specified in the restricted user list)</span>
<a name="l315"><span class="linenum"> 315</span></a>              <a class="var it4643" onMouseOver="hilite(4643)" onMouseOut="lolite()" onClick="logVariable('servicesusers')" href="../_variables/servicesusers.html">$servicesusers</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('external_services_users', array('userid' =&gt; <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>));
<a name="l316"><span class="linenum"> 316</span></a>              foreach (<a class="var it4643" onMouseOver="hilite(4643)" onMouseOut="lolite()" onClick="logVariable('servicesusers')" href="../_variables/servicesusers.html">$servicesusers</a> as <a class="var it4644" onMouseOver="hilite(4644)" onMouseOut="lolite()" onClick="logVariable('serviceuser')" href="../_variables/serviceuser.html">$serviceuser</a>) {
<a name="l317"><span class="linenum"> 317</span></a>                  if (!<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it4644" onMouseOver="hilite(4644)" onMouseOut="lolite()" onClick="logVariable('serviceuser')" href="../_variables/serviceuser.html">$serviceuser</a>-&gt;<a onClick="logVariable('externalserviceid')" class="var it40438" onMouseOver="hilite(40438)" onMouseOut="lolite()" href="../_variables/externalserviceid.html">externalserviceid</a>,<a class="var it4642" onMouseOver="hilite(4642)" onMouseOut="lolite()" onClick="logVariable('serviceidlist')" href="../_variables/serviceidlist.html">$serviceidlist</a>)) {
<a name="l318"><span class="linenum"> 318</span></a>                       <a class="var it4642" onMouseOver="hilite(4642)" onMouseOut="lolite()" onClick="logVariable('serviceidlist')" href="../_variables/serviceidlist.html">$serviceidlist</a>[] = <a class="var it4644" onMouseOver="hilite(4644)" onMouseOut="lolite()" onClick="logVariable('serviceuser')" href="../_variables/serviceuser.html">$serviceuser</a>-&gt;<a onClick="logVariable('externalserviceid')" class="var it40438" onMouseOver="hilite(40438)" onMouseOut="lolite()" href="../_variables/externalserviceid.html">externalserviceid</a>;
<a name="l319"><span class="linenum"> 319</span></a>                  }
<a name="l320"><span class="linenum"> 320</span></a>              }
<a name="l321"><span class="linenum"> 321</span></a>  
<a name="l322"><span class="linenum"> 322</span></a>  <span class="comment">            // get all services which already have a token set for the current user</span>
<a name="l323"><span class="linenum"> 323</span></a>              <a class="var it4645" onMouseOver="hilite(4645)" onMouseOut="lolite()" onClick="logVariable('usertokens')" href="../_variables/usertokens.html">$usertokens</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records')" href="../_functions/get_records.html" onMouseOver="funcPopup(event,'get_records')">get_records</a>('external_tokens', array('userid' =&gt; <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, 'tokentype' =&gt; <a class="constant" onClick="logConstant('EXTERNAL_TOKEN_PERMANENT')" href="../_constants/EXTERNAL_TOKEN_PERMANENT.html" onMouseOver="constPopup(event,'EXTERNAL_TOKEN_PERMANENT')">EXTERNAL_TOKEN_PERMANENT</a>));
<a name="l324"><span class="linenum"> 324</span></a>              <a class="var it4646" onMouseOver="hilite(4646)" onMouseOut="lolite()" onClick="logVariable('tokenizedservice')" href="../_variables/tokenizedservice.html">$tokenizedservice</a> = array();
<a name="l325"><span class="linenum"> 325</span></a>              foreach (<a class="var it4645" onMouseOver="hilite(4645)" onMouseOut="lolite()" onClick="logVariable('usertokens')" href="../_variables/usertokens.html">$usertokens</a> as <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>) {
<a name="l326"><span class="linenum"> 326</span></a>                      <a class="var it4646" onMouseOver="hilite(4646)" onMouseOut="lolite()" onClick="logVariable('tokenizedservice')" href="../_variables/tokenizedservice.html">$tokenizedservice</a>[]  = <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('externalserviceid')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/externalserviceid.html">externalserviceid</a>;
<a name="l327"><span class="linenum"> 327</span></a>              }
<a name="l328"><span class="linenum"> 328</span></a>  
<a name="l329"><span class="linenum"> 329</span></a>  <span class="comment">            // create a token for the service which have no token already</span>
<a name="l330"><span class="linenum"> 330</span></a>              foreach (<a class="var it4642" onMouseOver="hilite(4642)" onMouseOut="lolite()" onClick="logVariable('serviceidlist')" href="../_variables/serviceidlist.html">$serviceidlist</a> as <a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>) {
<a name="l331"><span class="linenum"> 331</span></a>                  if (!<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>, <a class="var it4646" onMouseOver="hilite(4646)" onMouseOut="lolite()" onClick="logVariable('tokenizedservice')" href="../_variables/tokenizedservice.html">$tokenizedservice</a>)) {
<a name="l332"><span class="linenum"> 332</span></a>  <span class="comment">                    // create the token for this service</span>
<a name="l333"><span class="linenum"> 333</span></a>                      <a class="var it4647" onMouseOver="hilite(4647)" onMouseOut="lolite()" onClick="logVariable('newtoken')" href="../_variables/newtoken.html">$newtoken</a> = new stdClass();
<a name="l334"><span class="linenum"> 334</span></a>                      <a class="var it4647" onMouseOver="hilite(4647)" onMouseOut="lolite()" onClick="logVariable('newtoken')" href="../_variables/newtoken.html">$newtoken</a>-&gt;<a onClick="logVariable('token')" class="var it40439" onMouseOver="hilite(40439)" onMouseOut="lolite()" href="../_variables/token.html">token</a> = md5(<a class="phpfunction" onClick="logFunction('uniqid')" href="../_functions/uniqid.html" onMouseOver="phpfuncPopup(event,'uniqid')">uniqid</a>(<a class="phpfunction" onClick="logFunction('rand')" href="../_functions/rand.html" onMouseOver="phpfuncPopup(event,'rand')">rand</a>(),1));
<a name="l335"><span class="linenum"> 335</span></a>  <span class="comment">                    // check that the user has capability on this service</span>
<a name="l336"><span class="linenum"> 336</span></a>                      <a class="var it4647" onMouseOver="hilite(4647)" onMouseOut="lolite()" onClick="logVariable('newtoken')" href="../_variables/newtoken.html">$newtoken</a>-&gt;<a onClick="logVariable('tokentype')" class="var it40439" onMouseOver="hilite(40439)" onMouseOut="lolite()" href="../_variables/tokentype.html">tokentype</a> = <a class="constant" onClick="logConstant('EXTERNAL_TOKEN_PERMANENT')" href="../_constants/EXTERNAL_TOKEN_PERMANENT.html" onMouseOver="constPopup(event,'EXTERNAL_TOKEN_PERMANENT')">EXTERNAL_TOKEN_PERMANENT</a>;
<a name="l337"><span class="linenum"> 337</span></a>                      <a class="var it4647" onMouseOver="hilite(4647)" onMouseOut="lolite()" onClick="logVariable('newtoken')" href="../_variables/newtoken.html">$newtoken</a>-&gt;<a onClick="logVariable('userid')" class="var it40439" onMouseOver="hilite(40439)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a> = <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>;
<a name="l338"><span class="linenum"> 338</span></a>                      <a class="var it4647" onMouseOver="hilite(4647)" onMouseOut="lolite()" onClick="logVariable('newtoken')" href="../_variables/newtoken.html">$newtoken</a>-&gt;<a onClick="logVariable('externalserviceid')" class="var it40439" onMouseOver="hilite(40439)" onMouseOut="lolite()" href="../_variables/externalserviceid.html">externalserviceid</a> = <a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>;
<a name="l339"><span class="linenum"> 339</span></a>  <span class="comment">                    // TODO MDL-31190 find a way to get the context - UPDATE FOLLOWING LINE</span>
<a name="l340"><span class="linenum"> 340</span></a>                      <a class="var it4647" onMouseOver="hilite(4647)" onMouseOut="lolite()" onClick="logVariable('newtoken')" href="../_variables/newtoken.html">$newtoken</a>-&gt;<a onClick="logVariable('contextid')" class="var it40439" onMouseOver="hilite(40439)" onMouseOut="lolite()" href="../_variables/contextid.html">contextid</a> = <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>()-&gt;id;
<a name="l341"><span class="linenum"> 341</span></a>                      <a class="var it4647" onMouseOver="hilite(4647)" onMouseOut="lolite()" onClick="logVariable('newtoken')" href="../_variables/newtoken.html">$newtoken</a>-&gt;<a onClick="logVariable('creatorid')" class="var it40439" onMouseOver="hilite(40439)" onMouseOut="lolite()" href="../_variables/creatorid.html">creatorid</a> = <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>;
<a name="l342"><span class="linenum"> 342</span></a>                      <a class="var it4647" onMouseOver="hilite(4647)" onMouseOut="lolite()" onClick="logVariable('newtoken')" href="../_variables/newtoken.html">$newtoken</a>-&gt;<a onClick="logVariable('timecreated')" class="var it40439" onMouseOver="hilite(40439)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a> = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l343"><span class="linenum"> 343</span></a>  
<a name="l344"><span class="linenum"> 344</span></a>                      <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('external_tokens', <a class="var it4647" onMouseOver="hilite(4647)" onMouseOut="lolite()" onClick="logVariable('newtoken')" href="../_variables/newtoken.html">$newtoken</a>);
<a name="l345"><span class="linenum"> 345</span></a>                  }
<a name="l346"><span class="linenum"> 346</span></a>              }
<a name="l347"><span class="linenum"> 347</span></a>  
<a name="l348"><span class="linenum"> 348</span></a>  
<a name="l349"><span class="linenum"> 349</span></a>          }
<a name="l350"><span class="linenum"> 350</span></a>      }
<a name="l351"><span class="linenum"> 351</span></a>  
<a name="l352"><span class="linenum"> 352</span></a>      <span class="comment">/**</span>
<a name="l353"><span class="linenum"> 353</span></a>  <span class="comment">     * Return all tokens of a specific user</span>
<a name="l354"><span class="linenum"> 354</span></a>  <span class="comment">     * + the service state (enabled/disabled)</span>
<a name="l355"><span class="linenum"> 355</span></a>  <span class="comment">     * + the authorised user mode (restricted/not restricted)</span>
<a name="l356"><span class="linenum"> 356</span></a>  <span class="comment">     *</span>
<a name="l357"><span class="linenum"> 357</span></a>  <span class="comment">     * @param int $userid user id</span>
<a name="l358"><span class="linenum"> 358</span></a>  <span class="comment">     * @return array</span>
<a name="l359"><span class="linenum"> 359</span></a>  <span class="comment">     */</span>
<a name="l360"><span class="linenum"> 360</span></a>      public function <a class="function" onClick="logFunction('get_user_ws_tokens')" href="../_functions/get_user_ws_tokens.html" onMouseOver="funcPopup(event,'get_user_ws_tokens')">get_user_ws_tokens</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) {
<a name="l361"><span class="linenum"> 361</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l362"><span class="linenum"> 362</span></a>  <span class="comment">        //here retrieve token list (including linked users firstname/lastname and linked services name)</span>
<a name="l363"><span class="linenum"> 363</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT
<a name="l364"><span class="linenum"> 364</span></a>                      t.id, t.creatorid, t.token, u.firstname, u.lastname, s.id as wsid, s.name, s.enabled, s.restrictedusers, t.validuntil
<a name="l365"><span class="linenum"> 365</span></a>                  FROM
<a name="l366"><span class="linenum"> 366</span></a>                      {external_tokens} t, {user} u, {external_services} s
<a name="l367"><span class="linenum"> 367</span></a>                  WHERE
<a name="l368"><span class="linenum"> 368</span></a>                      t.userid=? AND t.tokentype = &quot;.<a class="constant" onClick="logConstant('EXTERNAL_TOKEN_PERMANENT')" href="../_constants/EXTERNAL_TOKEN_PERMANENT.html" onMouseOver="constPopup(event,'EXTERNAL_TOKEN_PERMANENT')">EXTERNAL_TOKEN_PERMANENT</a>.&quot; AND s.id = t.externalserviceid AND t.userid = u.id&quot;;
<a name="l369"><span class="linenum"> 369</span></a>          <a class="var it2186" onMouseOver="hilite(2186)" onMouseOut="lolite()" onClick="logVariable('tokens')" href="../_variables/tokens.html">$tokens</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, array( <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>));
<a name="l370"><span class="linenum"> 370</span></a>          return <a class="var it2186" onMouseOver="hilite(2186)" onMouseOut="lolite()" onClick="logVariable('tokens')" href="../_variables/tokens.html">$tokens</a>;
<a name="l371"><span class="linenum"> 371</span></a>      }
<a name="l372"><span class="linenum"> 372</span></a>  
<a name="l373"><span class="linenum"> 373</span></a>      <span class="comment">/**</span>
<a name="l374"><span class="linenum"> 374</span></a>  <span class="comment">     * Return a token that has been created by the user (i.e. to created by an admin)</span>
<a name="l375"><span class="linenum"> 375</span></a>  <span class="comment">     * If no tokens exist an exception is thrown</span>
<a name="l376"><span class="linenum"> 376</span></a>  <span class="comment">     *</span>
<a name="l377"><span class="linenum"> 377</span></a>  <span class="comment">     * The returned value is a stdClass:</span>
<a name="l378"><span class="linenum"> 378</span></a>  <span class="comment">     * -&gt;id token id</span>
<a name="l379"><span class="linenum"> 379</span></a>  <span class="comment">     * -&gt;token</span>
<a name="l380"><span class="linenum"> 380</span></a>  <span class="comment">     * -&gt;firstname user firstname</span>
<a name="l381"><span class="linenum"> 381</span></a>  <span class="comment">     * -&gt;lastname</span>
<a name="l382"><span class="linenum"> 382</span></a>  <span class="comment">     * -&gt;name service name</span>
<a name="l383"><span class="linenum"> 383</span></a>  <span class="comment">     *</span>
<a name="l384"><span class="linenum"> 384</span></a>  <span class="comment">     * @param int $userid user id</span>
<a name="l385"><span class="linenum"> 385</span></a>  <span class="comment">     * @param int $tokenid token id</span>
<a name="l386"><span class="linenum"> 386</span></a>  <span class="comment">     * @return stdClass</span>
<a name="l387"><span class="linenum"> 387</span></a>  <span class="comment">     */</span>
<a name="l388"><span class="linenum"> 388</span></a>      public function <a class="function" onClick="logFunction('get_created_by_user_ws_token')" href="../_functions/get_created_by_user_ws_token.html" onMouseOver="funcPopup(event,'get_created_by_user_ws_token')">get_created_by_user_ws_token</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it4648" onMouseOver="hilite(4648)" onMouseOut="lolite()" onClick="logVariable('tokenid')" href="../_variables/tokenid.html">$tokenid</a>) {
<a name="l389"><span class="linenum"> 389</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l390"><span class="linenum"> 390</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT
<a name="l391"><span class="linenum"> 391</span></a>                          t.id, t.token, u.firstname, u.lastname, s.name
<a name="l392"><span class="linenum"> 392</span></a>                      FROM
<a name="l393"><span class="linenum"> 393</span></a>                          {external_tokens} t, {user} u, {external_services} s
<a name="l394"><span class="linenum"> 394</span></a>                      WHERE
<a name="l395"><span class="linenum"> 395</span></a>                          t.creatorid=? AND t.id=? AND t.tokentype = &quot;
<a name="l396"><span class="linenum"> 396</span></a>                  . <a class="constant" onClick="logConstant('EXTERNAL_TOKEN_PERMANENT')" href="../_constants/EXTERNAL_TOKEN_PERMANENT.html" onMouseOver="constPopup(event,'EXTERNAL_TOKEN_PERMANENT')">EXTERNAL_TOKEN_PERMANENT</a>
<a name="l397"><span class="linenum"> 397</span></a>                  . &quot; AND s.id = t.externalserviceid AND t.userid = u.id&quot;;
<a name="l398"><span class="linenum"> 398</span></a>  <span class="comment">        //must be the token creator</span>
<a name="l399"><span class="linenum"> 399</span></a>          <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record_sql')" href="../_functions/get_record_sql.html" onMouseOver="funcPopup(event,'get_record_sql')">get_record_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, array(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="var it4648" onMouseOver="hilite(4648)" onMouseOut="lolite()" onClick="logVariable('tokenid')" href="../_variables/tokenid.html">$tokenid</a>), <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l400"><span class="linenum"> 400</span></a>          return <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>;
<a name="l401"><span class="linenum"> 401</span></a>      }
<a name="l402"><span class="linenum"> 402</span></a>  
<a name="l403"><span class="linenum"> 403</span></a>      <span class="comment">/**</span>
<a name="l404"><span class="linenum"> 404</span></a>  <span class="comment">     * Return a database token record for a token id</span>
<a name="l405"><span class="linenum"> 405</span></a>  <span class="comment">     *</span>
<a name="l406"><span class="linenum"> 406</span></a>  <span class="comment">     * @param int $tokenid token id</span>
<a name="l407"><span class="linenum"> 407</span></a>  <span class="comment">     * @return object token</span>
<a name="l408"><span class="linenum"> 408</span></a>  <span class="comment">     */</span>
<a name="l409"><span class="linenum"> 409</span></a>      public function <a class="function" onClick="logFunction('get_token_by_id')" href="../_functions/get_token_by_id.html" onMouseOver="funcPopup(event,'get_token_by_id')">get_token_by_id</a>(<a class="var it4648" onMouseOver="hilite(4648)" onMouseOut="lolite()" onClick="logVariable('tokenid')" href="../_variables/tokenid.html">$tokenid</a>) {
<a name="l410"><span class="linenum"> 410</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l411"><span class="linenum"> 411</span></a>          return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('external_tokens', array('id' =&gt; <a class="var it4648" onMouseOver="hilite(4648)" onMouseOut="lolite()" onClick="logVariable('tokenid')" href="../_variables/tokenid.html">$tokenid</a>));
<a name="l412"><span class="linenum"> 412</span></a>      }
<a name="l413"><span class="linenum"> 413</span></a>  
<a name="l414"><span class="linenum"> 414</span></a>      <span class="comment">/**</span>
<a name="l415"><span class="linenum"> 415</span></a>  <span class="comment">     * Delete a token</span>
<a name="l416"><span class="linenum"> 416</span></a>  <span class="comment">     *</span>
<a name="l417"><span class="linenum"> 417</span></a>  <span class="comment">     * @param int $tokenid token id</span>
<a name="l418"><span class="linenum"> 418</span></a>  <span class="comment">     */</span>
<a name="l419"><span class="linenum"> 419</span></a>      public function <a class="function" onClick="logFunction('delete_user_ws_token')" href="../_functions/delete_user_ws_token.html" onMouseOver="funcPopup(event,'delete_user_ws_token')">delete_user_ws_token</a>(<a class="var it4648" onMouseOver="hilite(4648)" onMouseOut="lolite()" onClick="logVariable('tokenid')" href="../_variables/tokenid.html">$tokenid</a>) {
<a name="l420"><span class="linenum"> 420</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l421"><span class="linenum"> 421</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_tokens', array('id'=&gt;<a class="var it4648" onMouseOver="hilite(4648)" onMouseOut="lolite()" onClick="logVariable('tokenid')" href="../_variables/tokenid.html">$tokenid</a>));
<a name="l422"><span class="linenum"> 422</span></a>      }
<a name="l423"><span class="linenum"> 423</span></a>  
<a name="l424"><span class="linenum"> 424</span></a>      <span class="comment">/**</span>
<a name="l425"><span class="linenum"> 425</span></a>  <span class="comment">     * Delete a service</span>
<a name="l426"><span class="linenum"> 426</span></a>  <span class="comment">     * Also delete function references and authorised user references.</span>
<a name="l427"><span class="linenum"> 427</span></a>  <span class="comment">     *</span>
<a name="l428"><span class="linenum"> 428</span></a>  <span class="comment">     * @param int $serviceid service id</span>
<a name="l429"><span class="linenum"> 429</span></a>  <span class="comment">     */</span>
<a name="l430"><span class="linenum"> 430</span></a>      public function <a class="function" onClick="logFunction('delete_service')" href="../_functions/delete_service.html" onMouseOver="funcPopup(event,'delete_service')">delete_service</a>(<a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>) {
<a name="l431"><span class="linenum"> 431</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l432"><span class="linenum"> 432</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_services_users', array('externalserviceid' =&gt; <a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>));
<a name="l433"><span class="linenum"> 433</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_services_functions', array('externalserviceid' =&gt; <a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>));
<a name="l434"><span class="linenum"> 434</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_tokens', array('externalserviceid' =&gt; <a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>));
<a name="l435"><span class="linenum"> 435</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_services', array('id' =&gt; <a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>));
<a name="l436"><span class="linenum"> 436</span></a>      }
<a name="l437"><span class="linenum"> 437</span></a>  
<a name="l438"><span class="linenum"> 438</span></a>      <span class="comment">/**</span>
<a name="l439"><span class="linenum"> 439</span></a>  <span class="comment">     * Get a full database token record for a given token value</span>
<a name="l440"><span class="linenum"> 440</span></a>  <span class="comment">     *</span>
<a name="l441"><span class="linenum"> 441</span></a>  <span class="comment">     * @param string $token</span>
<a name="l442"><span class="linenum"> 442</span></a>  <span class="comment">     * @throws moodle_exception if there is multiple result</span>
<a name="l443"><span class="linenum"> 443</span></a>  <span class="comment">     */</span>
<a name="l444"><span class="linenum"> 444</span></a>      public function <a class="function" onClick="logFunction('get_user_ws_token')" href="../_functions/get_user_ws_token.html" onMouseOver="funcPopup(event,'get_user_ws_token')">get_user_ws_token</a>(<a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>) {
<a name="l445"><span class="linenum"> 445</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l446"><span class="linenum"> 446</span></a>          return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('external_tokens', array('token'=&gt;<a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l447"><span class="linenum"> 447</span></a>      }
<a name="l448"><span class="linenum"> 448</span></a>  
<a name="l449"><span class="linenum"> 449</span></a>      <span class="comment">/**</span>
<a name="l450"><span class="linenum"> 450</span></a>  <span class="comment">     * Get the functions list of a service list (by id)</span>
<a name="l451"><span class="linenum"> 451</span></a>  <span class="comment">     *</span>
<a name="l452"><span class="linenum"> 452</span></a>  <span class="comment">     * @param array $serviceids service ids</span>
<a name="l453"><span class="linenum"> 453</span></a>  <span class="comment">     * @return array of functions</span>
<a name="l454"><span class="linenum"> 454</span></a>  <span class="comment">     */</span>
<a name="l455"><span class="linenum"> 455</span></a>      public function <a class="function" onClick="logFunction('get_external_functions')" href="../_functions/get_external_functions.html" onMouseOver="funcPopup(event,'get_external_functions')">get_external_functions</a>(<a class="var it4649" onMouseOver="hilite(4649)" onMouseOut="lolite()" onClick="logVariable('serviceids')" href="../_variables/serviceids.html">$serviceids</a>) {
<a name="l456"><span class="linenum"> 456</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l457"><span class="linenum"> 457</span></a>          if (!empty(<a class="var it4649" onMouseOver="hilite(4649)" onMouseOut="lolite()" onClick="logVariable('serviceids')" href="../_variables/serviceids.html">$serviceids</a>)) {
<a name="l458"><span class="linenum"> 458</span></a>              <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it4649" onMouseOver="hilite(4649)" onMouseOut="lolite()" onClick="logVariable('serviceids')" href="../_variables/serviceids.html">$serviceids</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it4649" onMouseOver="hilite(4649)" onMouseOut="lolite()" onClick="logVariable('serviceids')" href="../_variables/serviceids.html">$serviceids</a>);
<a name="l459"><span class="linenum"> 459</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT f.*
<a name="l460"><span class="linenum"> 460</span></a>                        FROM {external_functions} f
<a name="l461"><span class="linenum"> 461</span></a>                       WHERE f.name IN (SELECT sf.functionname
<a name="l462"><span class="linenum"> 462</span></a>                                          FROM {external_services_functions} sf
<a name="l463"><span class="linenum"> 463</span></a>                                         WHERE sf.externalserviceid <a class="var it4649" onMouseOver="hilite(4649)" onMouseOut="lolite()" onClick="logVariable('serviceids')" href="../_variables/serviceids.html">$serviceids</a>)&quot;;
<a name="l464"><span class="linenum"> 464</span></a>              <a class="var it3792" onMouseOver="hilite(3792)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l465"><span class="linenum"> 465</span></a>          } else {
<a name="l466"><span class="linenum"> 466</span></a>              <a class="var it3792" onMouseOver="hilite(3792)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a> = array();
<a name="l467"><span class="linenum"> 467</span></a>          }
<a name="l468"><span class="linenum"> 468</span></a>          return <a class="var it3792" onMouseOver="hilite(3792)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a>;
<a name="l469"><span class="linenum"> 469</span></a>      }
<a name="l470"><span class="linenum"> 470</span></a>  
<a name="l471"><span class="linenum"> 471</span></a>      <span class="comment">/**</span>
<a name="l472"><span class="linenum"> 472</span></a>  <span class="comment">     * Get the functions of a service list (by shortname). It can return only enabled functions if required.</span>
<a name="l473"><span class="linenum"> 473</span></a>  <span class="comment">     *</span>
<a name="l474"><span class="linenum"> 474</span></a>  <span class="comment">     * @param array $serviceshortnames service shortnames</span>
<a name="l475"><span class="linenum"> 475</span></a>  <span class="comment">     * @param bool $enabledonly if true then only return functions for services that have been enabled</span>
<a name="l476"><span class="linenum"> 476</span></a>  <span class="comment">     * @return array functions</span>
<a name="l477"><span class="linenum"> 477</span></a>  <span class="comment">     */</span>
<a name="l478"><span class="linenum"> 478</span></a>      public function <a class="function" onClick="logFunction('get_external_functions_by_enabled_services')" href="../_functions/get_external_functions_by_enabled_services.html" onMouseOver="funcPopup(event,'get_external_functions_by_enabled_services')">get_external_functions_by_enabled_services</a>(<a class="var it4650" onMouseOver="hilite(4650)" onMouseOut="lolite()" onClick="logVariable('serviceshortnames')" href="../_variables/serviceshortnames.html">$serviceshortnames</a>, <a class="var it4651" onMouseOver="hilite(4651)" onMouseOut="lolite()" onClick="logVariable('enabledonly')" href="../_variables/enabledonly.html">$enabledonly</a> = true) {
<a name="l479"><span class="linenum"> 479</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l480"><span class="linenum"> 480</span></a>          if (!empty(<a class="var it4650" onMouseOver="hilite(4650)" onMouseOut="lolite()" onClick="logVariable('serviceshortnames')" href="../_variables/serviceshortnames.html">$serviceshortnames</a>)) {
<a name="l481"><span class="linenum"> 481</span></a>              <a class="var it4652" onMouseOver="hilite(4652)" onMouseOut="lolite()" onClick="logVariable('enabledonlysql')" href="../_variables/enabledonlysql.html">$enabledonlysql</a> = <a class="var it4651" onMouseOver="hilite(4651)" onMouseOut="lolite()" onClick="logVariable('enabledonly')" href="../_variables/enabledonly.html">$enabledonly</a>?' AND s.enabled = 1 ':'';
<a name="l482"><span class="linenum"> 482</span></a>              <a class="function" onClick="logFunction('list')" href="../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>(<a class="var it4650" onMouseOver="hilite(4650)" onMouseOut="lolite()" onClick="logVariable('serviceshortnames')" href="../_variables/serviceshortnames.html">$serviceshortnames</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>) = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_in_or_equal')" href="../_functions/get_in_or_equal.html" onMouseOver="funcPopup(event,'get_in_or_equal')">get_in_or_equal</a>(<a class="var it4650" onMouseOver="hilite(4650)" onMouseOut="lolite()" onClick="logVariable('serviceshortnames')" href="../_variables/serviceshortnames.html">$serviceshortnames</a>);
<a name="l483"><span class="linenum"> 483</span></a>              <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT f.*
<a name="l484"><span class="linenum"> 484</span></a>                        FROM {external_functions} f
<a name="l485"><span class="linenum"> 485</span></a>                       WHERE f.name IN (SELECT sf.functionname
<a name="l486"><span class="linenum"> 486</span></a>                                          FROM {external_services_functions} sf, {external_services} s
<a name="l487"><span class="linenum"> 487</span></a>                                         WHERE s.shortname <a class="var it4650" onMouseOver="hilite(4650)" onMouseOut="lolite()" onClick="logVariable('serviceshortnames')" href="../_variables/serviceshortnames.html">$serviceshortnames</a>
<a name="l488"><span class="linenum"> 488</span></a>                                               AND sf.externalserviceid = s.id
<a name="l489"><span class="linenum"> 489</span></a>                                               &quot; . <a class="var it4652" onMouseOver="hilite(4652)" onMouseOut="lolite()" onClick="logVariable('enabledonlysql')" href="../_variables/enabledonlysql.html">$enabledonlysql</a> . &quot;)&quot;;
<a name="l490"><span class="linenum"> 490</span></a>              <a class="var it3792" onMouseOver="hilite(3792)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l491"><span class="linenum"> 491</span></a>          } else {
<a name="l492"><span class="linenum"> 492</span></a>              <a class="var it3792" onMouseOver="hilite(3792)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a> = array();
<a name="l493"><span class="linenum"> 493</span></a>          }
<a name="l494"><span class="linenum"> 494</span></a>          return <a class="var it3792" onMouseOver="hilite(3792)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a>;
<a name="l495"><span class="linenum"> 495</span></a>      }
<a name="l496"><span class="linenum"> 496</span></a>  
<a name="l497"><span class="linenum"> 497</span></a>      <span class="comment">/**</span>
<a name="l498"><span class="linenum"> 498</span></a>  <span class="comment">     * Get functions not included in a service</span>
<a name="l499"><span class="linenum"> 499</span></a>  <span class="comment">     *</span>
<a name="l500"><span class="linenum"> 500</span></a>  <span class="comment">     * @param int $serviceid service id</span>
<a name="l501"><span class="linenum"> 501</span></a>  <span class="comment">     * @return array functions</span>
<a name="l502"><span class="linenum"> 502</span></a>  <span class="comment">     */</span>
<a name="l503"><span class="linenum"> 503</span></a>      public function <a class="function" onClick="logFunction('get_not_associated_external_functions')" href="../_functions/get_not_associated_external_functions.html" onMouseOver="funcPopup(event,'get_not_associated_external_functions')">get_not_associated_external_functions</a>(<a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>) {
<a name="l504"><span class="linenum"> 504</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l505"><span class="linenum"> 505</span></a>          <a class="var it2282" onMouseOver="hilite(2282)" onMouseOut="lolite()" onClick="logVariable('select')" href="../_variables/select.html">$select</a> = &quot;name NOT IN (SELECT s.functionname
<a name="l506"><span class="linenum"> 506</span></a>                                    FROM {external_services_functions} s
<a name="l507"><span class="linenum"> 507</span></a>                                   WHERE s.externalserviceid = :sid
<a name="l508"><span class="linenum"> 508</span></a>                                 )&quot;;
<a name="l509"><span class="linenum"> 509</span></a>  
<a name="l510"><span class="linenum"> 510</span></a>          <a class="var it3792" onMouseOver="hilite(3792)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_select')" href="../_functions/get_records_select.html" onMouseOver="funcPopup(event,'get_records_select')">get_records_select</a>('external_functions',
<a name="l511"><span class="linenum"> 511</span></a>                          <a class="var it2282" onMouseOver="hilite(2282)" onMouseOut="lolite()" onClick="logVariable('select')" href="../_variables/select.html">$select</a>, array('sid' =&gt; <a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>), 'name');
<a name="l512"><span class="linenum"> 512</span></a>  
<a name="l513"><span class="linenum"> 513</span></a>          return <a class="var it3792" onMouseOver="hilite(3792)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a>;
<a name="l514"><span class="linenum"> 514</span></a>      }
<a name="l515"><span class="linenum"> 515</span></a>  
<a name="l516"><span class="linenum"> 516</span></a>      <span class="comment">/**</span>
<a name="l517"><span class="linenum"> 517</span></a>  <span class="comment">     * Get list of required capabilities of a service, sorted by functions</span>
<a name="l518"><span class="linenum"> 518</span></a>  <span class="comment">     * Example of returned value:</span>
<a name="l519"><span class="linenum"> 519</span></a>  <span class="comment">     *  Array</span>
<a name="l520"><span class="linenum"> 520</span></a>  <span class="comment">     *  (</span>
<a name="l521"><span class="linenum"> 521</span></a>  <span class="comment">     *    [moodle_group_create_groups] =&gt; Array</span>
<a name="l522"><span class="linenum"> 522</span></a>  <span class="comment">     *    (</span>
<a name="l523"><span class="linenum"> 523</span></a>  <span class="comment">     *       [0] =&gt; moodle/course:managegroups</span>
<a name="l524"><span class="linenum"> 524</span></a>  <span class="comment">     *    )</span>
<a name="l525"><span class="linenum"> 525</span></a>  <span class="comment">     *</span>
<a name="l526"><span class="linenum"> 526</span></a>  <span class="comment">     *    [moodle_enrol_get_enrolled_users] =&gt; Array</span>
<a name="l527"><span class="linenum"> 527</span></a>  <span class="comment">     *    (</span>
<a name="l528"><span class="linenum"> 528</span></a>  <span class="comment">     *       [0] =&gt; moodle/site:viewparticipants</span>
<a name="l529"><span class="linenum"> 529</span></a>  <span class="comment">     *       [1] =&gt; moodle/course:viewparticipants</span>
<a name="l530"><span class="linenum"> 530</span></a>  <span class="comment">     *       [2] =&gt; moodle/role:review</span>
<a name="l531"><span class="linenum"> 531</span></a>  <span class="comment">     *       [3] =&gt; moodle/site:accessallgroups</span>
<a name="l532"><span class="linenum"> 532</span></a>  <span class="comment">     *       [4] =&gt; moodle/course:enrolreview</span>
<a name="l533"><span class="linenum"> 533</span></a>  <span class="comment">     *    )</span>
<a name="l534"><span class="linenum"> 534</span></a>  <span class="comment">     *  )</span>
<a name="l535"><span class="linenum"> 535</span></a>  <span class="comment">     *</span>
<a name="l536"><span class="linenum"> 536</span></a>  <span class="comment">     * @param int $serviceid service id</span>
<a name="l537"><span class="linenum"> 537</span></a>  <span class="comment">     * @return array</span>
<a name="l538"><span class="linenum"> 538</span></a>  <span class="comment">     */</span>
<a name="l539"><span class="linenum"> 539</span></a>      public function <a class="function" onClick="logFunction('get_service_required_capabilities')" href="../_functions/get_service_required_capabilities.html" onMouseOver="funcPopup(event,'get_service_required_capabilities')">get_service_required_capabilities</a>(<a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>) {
<a name="l540"><span class="linenum"> 540</span></a>          <a class="var it3792" onMouseOver="hilite(3792)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_external_functions')" href="../_functions/get_external_functions.html" onMouseOver="funcPopup(event,'get_external_functions')">get_external_functions</a>(array(<a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>));
<a name="l541"><span class="linenum"> 541</span></a>          <a class="var it4653" onMouseOver="hilite(4653)" onMouseOut="lolite()" onClick="logVariable('requiredusercaps')" href="../_variables/requiredusercaps.html">$requiredusercaps</a> = array();
<a name="l542"><span class="linenum"> 542</span></a>          foreach (<a class="var it3792" onMouseOver="hilite(3792)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a> as <a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>) {
<a name="l543"><span class="linenum"> 543</span></a>              <a class="var it4654" onMouseOver="hilite(4654)" onMouseOut="lolite()" onClick="logVariable('functioncaps')" href="../_variables/functioncaps.html">$functioncaps</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('capabilities')" class="var it40435" onMouseOver="hilite(40435)" onMouseOut="lolite()" href="../_variables/capabilities.html">capabilities</a>);
<a name="l544"><span class="linenum"> 544</span></a>              if (!empty(<a class="var it4654" onMouseOver="hilite(4654)" onMouseOut="lolite()" onClick="logVariable('functioncaps')" href="../_variables/functioncaps.html">$functioncaps</a>) and !empty(<a class="var it4654" onMouseOver="hilite(4654)" onMouseOut="lolite()" onClick="logVariable('functioncaps')" href="../_variables/functioncaps.html">$functioncaps</a>[0])) {
<a name="l545"><span class="linenum"> 545</span></a>                  foreach (<a class="var it4654" onMouseOver="hilite(4654)" onMouseOut="lolite()" onClick="logVariable('functioncaps')" href="../_variables/functioncaps.html">$functioncaps</a> as <a class="var it4655" onMouseOver="hilite(4655)" onMouseOut="lolite()" onClick="logVariable('functioncap')" href="../_variables/functioncap.html">$functioncap</a>) {
<a name="l546"><span class="linenum"> 546</span></a>                      <a class="var it4653" onMouseOver="hilite(4653)" onMouseOut="lolite()" onClick="logVariable('requiredusercaps')" href="../_variables/requiredusercaps.html">$requiredusercaps</a>[<a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('name')" class="var it40435" onMouseOver="hilite(40435)" onMouseOut="lolite()" href="../_variables/name.html">name</a>][] = <a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it4655" onMouseOver="hilite(4655)" onMouseOut="lolite()" onClick="logVariable('functioncap')" href="../_variables/functioncap.html">$functioncap</a>);
<a name="l547"><span class="linenum"> 547</span></a>                  }
<a name="l548"><span class="linenum"> 548</span></a>              }
<a name="l549"><span class="linenum"> 549</span></a>          }
<a name="l550"><span class="linenum"> 550</span></a>          return <a class="var it4653" onMouseOver="hilite(4653)" onMouseOut="lolite()" onClick="logVariable('requiredusercaps')" href="../_variables/requiredusercaps.html">$requiredusercaps</a>;
<a name="l551"><span class="linenum"> 551</span></a>      }
<a name="l552"><span class="linenum"> 552</span></a>  
<a name="l553"><span class="linenum"> 553</span></a>      <span class="comment">/**</span>
<a name="l554"><span class="linenum"> 554</span></a>  <span class="comment">     * Get user capabilities (with context)</span>
<a name="l555"><span class="linenum"> 555</span></a>  <span class="comment">     * Only useful for documentation purpose</span>
<a name="l556"><span class="linenum"> 556</span></a>  <span class="comment">     * WARNING: do not use this &quot;broken&quot; function. It was created in the goal to display some capabilities</span>
<a name="l557"><span class="linenum"> 557</span></a>  <span class="comment">     * required by users. In theory we should not need to display this kind of information</span>
<a name="l558"><span class="linenum"> 558</span></a>  <span class="comment">     * as the front end does not display it itself. In pratice,</span>
<a name="l559"><span class="linenum"> 559</span></a>  <span class="comment">     * admins would like the info, for more info you can follow: MDL-29962</span>
<a name="l560"><span class="linenum"> 560</span></a>  <span class="comment">     *</span>
<a name="l561"><span class="linenum"> 561</span></a>  <span class="comment">     * @param int $userid user id</span>
<a name="l562"><span class="linenum"> 562</span></a>  <span class="comment">     * @return array</span>
<a name="l563"><span class="linenum"> 563</span></a>  <span class="comment">     */</span>
<a name="l564"><span class="linenum"> 564</span></a>      public function <a class="function" onClick="logFunction('get_user_capabilities')" href="../_functions/get_user_capabilities.html" onMouseOver="funcPopup(event,'get_user_capabilities')">get_user_capabilities</a>(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>) {
<a name="l565"><span class="linenum"> 565</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l566"><span class="linenum"> 566</span></a>  <span class="comment">        //retrieve the user capabilities</span>
<a name="l567"><span class="linenum"> 567</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT DISTINCT rc.id, rc.capability FROM {role_capabilities} rc, {role_assignments} ra
<a name="l568"><span class="linenum"> 568</span></a>              WHERE rc.roleid=ra.roleid AND ra.userid= ? AND rc.permission = ?&quot;;
<a name="l569"><span class="linenum"> 569</span></a>          <a class="var it4656" onMouseOver="hilite(4656)" onMouseOut="lolite()" onClick="logVariable('dbusercaps')" href="../_variables/dbusercaps.html">$dbusercaps</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_records_sql')" href="../_functions/get_records_sql.html" onMouseOver="funcPopup(event,'get_records_sql')">get_records_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, array(<a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a>, <a class="constant" onClick="logConstant('CAP_ALLOW')" href="../_constants/CAP_ALLOW.html" onMouseOver="constPopup(event,'CAP_ALLOW')">CAP_ALLOW</a>));
<a name="l570"><span class="linenum"> 570</span></a>          <a class="var it4657" onMouseOver="hilite(4657)" onMouseOut="lolite()" onClick="logVariable('usercaps')" href="../_variables/usercaps.html">$usercaps</a> = array();
<a name="l571"><span class="linenum"> 571</span></a>          foreach (<a class="var it4656" onMouseOver="hilite(4656)" onMouseOut="lolite()" onClick="logVariable('dbusercaps')" href="../_variables/dbusercaps.html">$dbusercaps</a> as <a class="var it4658" onMouseOver="hilite(4658)" onMouseOut="lolite()" onClick="logVariable('usercap')" href="../_variables/usercap.html">$usercap</a>) {
<a name="l572"><span class="linenum"> 572</span></a>              <a class="var it4657" onMouseOver="hilite(4657)" onMouseOut="lolite()" onClick="logVariable('usercaps')" href="../_variables/usercaps.html">$usercaps</a>[<a class="var it4658" onMouseOver="hilite(4658)" onMouseOut="lolite()" onClick="logVariable('usercap')" href="../_variables/usercap.html">$usercap</a>-&gt;<a onClick="logVariable('capability')" class="var it40440" onMouseOver="hilite(40440)" onMouseOut="lolite()" href="../_variables/capability.html">capability</a>] = true;
<a name="l573"><span class="linenum"> 573</span></a>          }
<a name="l574"><span class="linenum"> 574</span></a>          return <a class="var it4657" onMouseOver="hilite(4657)" onMouseOut="lolite()" onClick="logVariable('usercaps')" href="../_variables/usercaps.html">$usercaps</a>;
<a name="l575"><span class="linenum"> 575</span></a>      }
<a name="l576"><span class="linenum"> 576</span></a>  
<a name="l577"><span class="linenum"> 577</span></a>      <span class="comment">/**</span>
<a name="l578"><span class="linenum"> 578</span></a>  <span class="comment">     * Get missing user capabilities for a given service</span>
<a name="l579"><span class="linenum"> 579</span></a>  <span class="comment">     * WARNING: do not use this &quot;broken&quot; function. It was created in the goal to display some capabilities</span>
<a name="l580"><span class="linenum"> 580</span></a>  <span class="comment">     * required by users. In theory we should not need to display this kind of information</span>
<a name="l581"><span class="linenum"> 581</span></a>  <span class="comment">     * as the front end does not display it itself. In pratice,</span>
<a name="l582"><span class="linenum"> 582</span></a>  <span class="comment">     * admins would like the info, for more info you can follow: MDL-29962</span>
<a name="l583"><span class="linenum"> 583</span></a>  <span class="comment">     *</span>
<a name="l584"><span class="linenum"> 584</span></a>  <span class="comment">     * @param array $users users</span>
<a name="l585"><span class="linenum"> 585</span></a>  <span class="comment">     * @param int $serviceid service id</span>
<a name="l586"><span class="linenum"> 586</span></a>  <span class="comment">     * @return array of missing capabilities, keys being the user ids</span>
<a name="l587"><span class="linenum"> 587</span></a>  <span class="comment">     */</span>
<a name="l588"><span class="linenum"> 588</span></a>      public function <a class="function" onClick="logFunction('get_missing_capabilities_by_users')" href="../_functions/get_missing_capabilities_by_users.html" onMouseOver="funcPopup(event,'get_missing_capabilities_by_users')">get_missing_capabilities_by_users</a>(<a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a>, <a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>) {
<a name="l589"><span class="linenum"> 589</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l590"><span class="linenum"> 590</span></a>          <a class="var it4659" onMouseOver="hilite(4659)" onMouseOut="lolite()" onClick="logVariable('usersmissingcaps')" href="../_variables/usersmissingcaps.html">$usersmissingcaps</a> = array();
<a name="l591"><span class="linenum"> 591</span></a>  
<a name="l592"><span class="linenum"> 592</span></a>  <span class="comment">        //retrieve capabilities required by the service</span>
<a name="l593"><span class="linenum"> 593</span></a>          <a class="var it4660" onMouseOver="hilite(4660)" onMouseOut="lolite()" onClick="logVariable('servicecaps')" href="../_variables/servicecaps.html">$servicecaps</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_service_required_capabilities')" href="../_functions/get_service_required_capabilities.html" onMouseOver="funcPopup(event,'get_service_required_capabilities')">get_service_required_capabilities</a>(<a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>);
<a name="l594"><span class="linenum"> 594</span></a>  
<a name="l595"><span class="linenum"> 595</span></a>  <span class="comment">        //retrieve users missing capabilities</span>
<a name="l596"><span class="linenum"> 596</span></a>          foreach (<a class="var it572" onMouseOver="hilite(572)" onMouseOut="lolite()" onClick="logVariable('users')" href="../_variables/users.html">$users</a> as <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>) {
<a name="l597"><span class="linenum"> 597</span></a>  <span class="comment">            //cast user array into object to be a bit more flexible</span>
<a name="l598"><span class="linenum"> 598</span></a>              if (<a class="phpfunction" onClick="logFunction('is_array')" href="../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>)) {
<a name="l599"><span class="linenum"> 599</span></a>                  <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = (object) <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>;
<a name="l600"><span class="linenum"> 600</span></a>              }
<a name="l601"><span class="linenum"> 601</span></a>              <a class="var it4657" onMouseOver="hilite(4657)" onMouseOut="lolite()" onClick="logVariable('usercaps')" href="../_variables/usercaps.html">$usercaps</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_user_capabilities')" href="../_functions/get_user_capabilities.html" onMouseOver="funcPopup(event,'get_user_capabilities')">get_user_capabilities</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>);
<a name="l602"><span class="linenum"> 602</span></a>  
<a name="l603"><span class="linenum"> 603</span></a>  <span class="comment">            //detect the missing capabilities</span>
<a name="l604"><span class="linenum"> 604</span></a>              foreach (<a class="var it4660" onMouseOver="hilite(4660)" onMouseOut="lolite()" onClick="logVariable('servicecaps')" href="../_variables/servicecaps.html">$servicecaps</a> as <a class="var it4661" onMouseOver="hilite(4661)" onMouseOut="lolite()" onClick="logVariable('functioname')" href="../_variables/functioname.html">$functioname</a> =&gt; <a class="var it4654" onMouseOver="hilite(4654)" onMouseOut="lolite()" onClick="logVariable('functioncaps')" href="../_variables/functioncaps.html">$functioncaps</a>) {
<a name="l605"><span class="linenum"> 605</span></a>                  foreach (<a class="var it4654" onMouseOver="hilite(4654)" onMouseOut="lolite()" onClick="logVariable('functioncaps')" href="../_variables/functioncaps.html">$functioncaps</a> as <a class="var it4655" onMouseOver="hilite(4655)" onMouseOut="lolite()" onClick="logVariable('functioncap')" href="../_variables/functioncap.html">$functioncap</a>) {
<a name="l606"><span class="linenum"> 606</span></a>                      if (!<a class="phpfunction" onClick="logFunction('array_key_exists')" href="../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(<a class="var it4655" onMouseOver="hilite(4655)" onMouseOut="lolite()" onClick="logVariable('functioncap')" href="../_variables/functioncap.html">$functioncap</a>, <a class="var it4657" onMouseOver="hilite(4657)" onMouseOut="lolite()" onClick="logVariable('usercaps')" href="../_variables/usercaps.html">$usercaps</a>)) {
<a name="l607"><span class="linenum"> 607</span></a>                          if (!isset(<a class="var it4659" onMouseOver="hilite(4659)" onMouseOut="lolite()" onClick="logVariable('usersmissingcaps')" href="../_variables/usersmissingcaps.html">$usersmissingcaps</a>[<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>])
<a name="l608"><span class="linenum"> 608</span></a>                                  or <a class="phpfunction" onClick="logFunction('array_search')" href="../_functions/array_search.html" onMouseOver="phpfuncPopup(event,'array_search')">array_search</a>(<a class="var it4655" onMouseOver="hilite(4655)" onMouseOut="lolite()" onClick="logVariable('functioncap')" href="../_variables/functioncap.html">$functioncap</a>, <a class="var it4659" onMouseOver="hilite(4659)" onMouseOut="lolite()" onClick="logVariable('usersmissingcaps')" href="../_variables/usersmissingcaps.html">$usersmissingcaps</a>[<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>]) === false) {
<a name="l609"><span class="linenum"> 609</span></a>                              <a class="var it4659" onMouseOver="hilite(4659)" onMouseOut="lolite()" onClick="logVariable('usersmissingcaps')" href="../_variables/usersmissingcaps.html">$usersmissingcaps</a>[<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>][] = <a class="var it4655" onMouseOver="hilite(4655)" onMouseOut="lolite()" onClick="logVariable('functioncap')" href="../_variables/functioncap.html">$functioncap</a>;
<a name="l610"><span class="linenum"> 610</span></a>                          }
<a name="l611"><span class="linenum"> 611</span></a>                      }
<a name="l612"><span class="linenum"> 612</span></a>                  }
<a name="l613"><span class="linenum"> 613</span></a>              }
<a name="l614"><span class="linenum"> 614</span></a>          }
<a name="l615"><span class="linenum"> 615</span></a>  
<a name="l616"><span class="linenum"> 616</span></a>          return <a class="var it4659" onMouseOver="hilite(4659)" onMouseOut="lolite()" onClick="logVariable('usersmissingcaps')" href="../_variables/usersmissingcaps.html">$usersmissingcaps</a>;
<a name="l617"><span class="linenum"> 617</span></a>      }
<a name="l618"><span class="linenum"> 618</span></a>  
<a name="l619"><span class="linenum"> 619</span></a>      <span class="comment">/**</span>
<a name="l620"><span class="linenum"> 620</span></a>  <span class="comment">     * Get an external service for a given service id</span>
<a name="l621"><span class="linenum"> 621</span></a>  <span class="comment">     *</span>
<a name="l622"><span class="linenum"> 622</span></a>  <span class="comment">     * @param int $serviceid service id</span>
<a name="l623"><span class="linenum"> 623</span></a>  <span class="comment">     * @param int $strictness IGNORE_MISSING, MUST_EXIST...</span>
<a name="l624"><span class="linenum"> 624</span></a>  <span class="comment">     * @return stdClass external service</span>
<a name="l625"><span class="linenum"> 625</span></a>  <span class="comment">     */</span>
<a name="l626"><span class="linenum"> 626</span></a>      public function <a class="function" onClick="logFunction('get_external_service_by_id')" href="../_functions/get_external_service_by_id.html" onMouseOver="funcPopup(event,'get_external_service_by_id')">get_external_service_by_id</a>(<a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>, <a class="var it4662" onMouseOver="hilite(4662)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a>=<a class="constant" onClick="logConstant('IGNORE_MISSING')" href="../_constants/IGNORE_MISSING.html" onMouseOver="constPopup(event,'IGNORE_MISSING')">IGNORE_MISSING</a>) {
<a name="l627"><span class="linenum"> 627</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l628"><span class="linenum"> 628</span></a>          <a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('external_services',
<a name="l629"><span class="linenum"> 629</span></a>                          array('id' =&gt; <a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>), '*', <a class="var it4662" onMouseOver="hilite(4662)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a>);
<a name="l630"><span class="linenum"> 630</span></a>          return <a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>;
<a name="l631"><span class="linenum"> 631</span></a>      }
<a name="l632"><span class="linenum"> 632</span></a>  
<a name="l633"><span class="linenum"> 633</span></a>      <span class="comment">/**</span>
<a name="l634"><span class="linenum"> 634</span></a>  <span class="comment">     * Get an external service for a given shortname</span>
<a name="l635"><span class="linenum"> 635</span></a>  <span class="comment">     *</span>
<a name="l636"><span class="linenum"> 636</span></a>  <span class="comment">     * @param string $shortname service shortname</span>
<a name="l637"><span class="linenum"> 637</span></a>  <span class="comment">     * @param int $strictness IGNORE_MISSING, MUST_EXIST...</span>
<a name="l638"><span class="linenum"> 638</span></a>  <span class="comment">     * @return stdClass external service</span>
<a name="l639"><span class="linenum"> 639</span></a>  <span class="comment">     */</span>
<a name="l640"><span class="linenum"> 640</span></a>      public function <a class="function" onClick="logFunction('get_external_service_by_shortname')" href="../_functions/get_external_service_by_shortname.html" onMouseOver="funcPopup(event,'get_external_service_by_shortname')">get_external_service_by_shortname</a>(<a class="var it1256" onMouseOver="hilite(1256)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../_variables/shortname.html">$shortname</a>, <a class="var it4662" onMouseOver="hilite(4662)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a>=<a class="constant" onClick="logConstant('IGNORE_MISSING')" href="../_constants/IGNORE_MISSING.html" onMouseOver="constPopup(event,'IGNORE_MISSING')">IGNORE_MISSING</a>) {
<a name="l641"><span class="linenum"> 641</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l642"><span class="linenum"> 642</span></a>          <a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('external_services',
<a name="l643"><span class="linenum"> 643</span></a>                          array('shortname' =&gt; <a class="var it1256" onMouseOver="hilite(1256)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../_variables/shortname.html">$shortname</a>), '*', <a class="var it4662" onMouseOver="hilite(4662)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a>);
<a name="l644"><span class="linenum"> 644</span></a>          return <a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>;
<a name="l645"><span class="linenum"> 645</span></a>      }
<a name="l646"><span class="linenum"> 646</span></a>  
<a name="l647"><span class="linenum"> 647</span></a>      <span class="comment">/**</span>
<a name="l648"><span class="linenum"> 648</span></a>  <span class="comment">     * Get an external function for a given function id</span>
<a name="l649"><span class="linenum"> 649</span></a>  <span class="comment">     *</span>
<a name="l650"><span class="linenum"> 650</span></a>  <span class="comment">     * @param int $functionid function id</span>
<a name="l651"><span class="linenum"> 651</span></a>  <span class="comment">     * @param int $strictness IGNORE_MISSING, MUST_EXIST...</span>
<a name="l652"><span class="linenum"> 652</span></a>  <span class="comment">     * @return stdClass external function</span>
<a name="l653"><span class="linenum"> 653</span></a>  <span class="comment">     */</span>
<a name="l654"><span class="linenum"> 654</span></a>      public function <a class="function" onClick="logFunction('get_external_function_by_id')" href="../_functions/get_external_function_by_id.html" onMouseOver="funcPopup(event,'get_external_function_by_id')">get_external_function_by_id</a>(<a class="var it4663" onMouseOver="hilite(4663)" onMouseOut="lolite()" onClick="logVariable('functionid')" href="../_variables/functionid.html">$functionid</a>, <a class="var it4662" onMouseOver="hilite(4662)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a>=<a class="constant" onClick="logConstant('IGNORE_MISSING')" href="../_constants/IGNORE_MISSING.html" onMouseOver="constPopup(event,'IGNORE_MISSING')">IGNORE_MISSING</a>) {
<a name="l655"><span class="linenum"> 655</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l656"><span class="linenum"> 656</span></a>          <a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('external_functions',
<a name="l657"><span class="linenum"> 657</span></a>                              array('id' =&gt; <a class="var it4663" onMouseOver="hilite(4663)" onMouseOut="lolite()" onClick="logVariable('functionid')" href="../_variables/functionid.html">$functionid</a>), '*', <a class="var it4662" onMouseOver="hilite(4662)" onMouseOut="lolite()" onClick="logVariable('strictness')" href="../_variables/strictness.html">$strictness</a>);
<a name="l658"><span class="linenum"> 658</span></a>          return <a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>;
<a name="l659"><span class="linenum"> 659</span></a>      }
<a name="l660"><span class="linenum"> 660</span></a>  
<a name="l661"><span class="linenum"> 661</span></a>      <span class="comment">/**</span>
<a name="l662"><span class="linenum"> 662</span></a>  <span class="comment">     * Add a function to a service</span>
<a name="l663"><span class="linenum"> 663</span></a>  <span class="comment">     *</span>
<a name="l664"><span class="linenum"> 664</span></a>  <span class="comment">     * @param string $functionname function name</span>
<a name="l665"><span class="linenum"> 665</span></a>  <span class="comment">     * @param int $serviceid service id</span>
<a name="l666"><span class="linenum"> 666</span></a>  <span class="comment">     */</span>
<a name="l667"><span class="linenum"> 667</span></a>      public function <a class="function" onClick="logFunction('add_external_function_to_service')" href="../_functions/add_external_function_to_service.html" onMouseOver="funcPopup(event,'add_external_function_to_service')">add_external_function_to_service</a>(<a class="var it3922" onMouseOver="hilite(3922)" onMouseOut="lolite()" onClick="logVariable('functionname')" href="../_variables/functionname.html">$functionname</a>, <a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>) {
<a name="l668"><span class="linenum"> 668</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l669"><span class="linenum"> 669</span></a>          <a class="var it4664" onMouseOver="hilite(4664)" onMouseOut="lolite()" onClick="logVariable('addedfunction')" href="../_variables/addedfunction.html">$addedfunction</a> = new stdClass();
<a name="l670"><span class="linenum"> 670</span></a>          <a class="var it4664" onMouseOver="hilite(4664)" onMouseOut="lolite()" onClick="logVariable('addedfunction')" href="../_variables/addedfunction.html">$addedfunction</a>-&gt;<a onClick="logVariable('externalserviceid')" class="var it40441" onMouseOver="hilite(40441)" onMouseOut="lolite()" href="../_variables/externalserviceid.html">externalserviceid</a> = <a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>;
<a name="l671"><span class="linenum"> 671</span></a>          <a class="var it4664" onMouseOver="hilite(4664)" onMouseOut="lolite()" onClick="logVariable('addedfunction')" href="../_variables/addedfunction.html">$addedfunction</a>-&gt;<a onClick="logVariable('functionname')" class="var it40441" onMouseOver="hilite(40441)" onMouseOut="lolite()" href="../_variables/functionname.html">functionname</a> = <a class="var it3922" onMouseOver="hilite(3922)" onMouseOut="lolite()" onClick="logVariable('functionname')" href="../_variables/functionname.html">$functionname</a>;
<a name="l672"><span class="linenum"> 672</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('external_services_functions', <a class="var it4664" onMouseOver="hilite(4664)" onMouseOut="lolite()" onClick="logVariable('addedfunction')" href="../_variables/addedfunction.html">$addedfunction</a>);
<a name="l673"><span class="linenum"> 673</span></a>      }
<a name="l674"><span class="linenum"> 674</span></a>  
<a name="l675"><span class="linenum"> 675</span></a>      <span class="comment">/**</span>
<a name="l676"><span class="linenum"> 676</span></a>  <span class="comment">     * Add a service</span>
<a name="l677"><span class="linenum"> 677</span></a>  <span class="comment">     * It generates the timecreated field automatically.</span>
<a name="l678"><span class="linenum"> 678</span></a>  <span class="comment">     *</span>
<a name="l679"><span class="linenum"> 679</span></a>  <span class="comment">     * @param stdClass $service</span>
<a name="l680"><span class="linenum"> 680</span></a>  <span class="comment">     * @return serviceid integer</span>
<a name="l681"><span class="linenum"> 681</span></a>  <span class="comment">     */</span>
<a name="l682"><span class="linenum"> 682</span></a>      public function <a class="function" onClick="logFunction('add_external_service')" href="../_functions/add_external_service.html" onMouseOver="funcPopup(event,'add_external_service')">add_external_service</a>(<a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>) {
<a name="l683"><span class="linenum"> 683</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l684"><span class="linenum"> 684</span></a>          <a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('timecreated')" class="var it40434" onMouseOver="hilite(40434)" onMouseOut="lolite()" href="../_variables/timecreated.html">timecreated</a> = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l685"><span class="linenum"> 685</span></a>          <a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('insert_record')" href="../_functions/insert_record.html" onMouseOver="funcPopup(event,'insert_record')">insert_record</a>('external_services', <a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>);
<a name="l686"><span class="linenum"> 686</span></a>          return <a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>;
<a name="l687"><span class="linenum"> 687</span></a>      }
<a name="l688"><span class="linenum"> 688</span></a>  
<a name="l689"><span class="linenum"> 689</span></a>      <span class="comment">/**</span>
<a name="l690"><span class="linenum"> 690</span></a>  <span class="comment">     * Update a service</span>
<a name="l691"><span class="linenum"> 691</span></a>  <span class="comment">     * It modifies the timemodified automatically.</span>
<a name="l692"><span class="linenum"> 692</span></a>  <span class="comment">     *</span>
<a name="l693"><span class="linenum"> 693</span></a>  <span class="comment">     * @param stdClass $service</span>
<a name="l694"><span class="linenum"> 694</span></a>  <span class="comment">     */</span>
<a name="l695"><span class="linenum"> 695</span></a>      public function <a class="function" onClick="logFunction('update_external_service')" href="../_functions/update_external_service.html" onMouseOver="funcPopup(event,'update_external_service')">update_external_service</a>(<a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>) {
<a name="l696"><span class="linenum"> 696</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l697"><span class="linenum"> 697</span></a>          <a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('timemodified')" class="var it40434" onMouseOver="hilite(40434)" onMouseOut="lolite()" href="../_variables/timemodified.html">timemodified</a> = <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l698"><span class="linenum"> 698</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('update_record')" href="../_functions/update_record.html" onMouseOver="funcPopup(event,'update_record')">update_record</a>('external_services', <a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>);
<a name="l699"><span class="linenum"> 699</span></a>      }
<a name="l700"><span class="linenum"> 700</span></a>  
<a name="l701"><span class="linenum"> 701</span></a>      <span class="comment">/**</span>
<a name="l702"><span class="linenum"> 702</span></a>  <span class="comment">     * Test whether an external function is already linked to a service</span>
<a name="l703"><span class="linenum"> 703</span></a>  <span class="comment">     *</span>
<a name="l704"><span class="linenum"> 704</span></a>  <span class="comment">     * @param string $functionname function name</span>
<a name="l705"><span class="linenum"> 705</span></a>  <span class="comment">     * @param int $serviceid service id</span>
<a name="l706"><span class="linenum"> 706</span></a>  <span class="comment">     * @return bool true if a matching function exists for the service, else false.</span>
<a name="l707"><span class="linenum"> 707</span></a>  <span class="comment">     * @throws dml_exception if error</span>
<a name="l708"><span class="linenum"> 708</span></a>  <span class="comment">     */</span>
<a name="l709"><span class="linenum"> 709</span></a>      public function <a class="function" onClick="logFunction('service_function_exists')" href="../_functions/service_function_exists.html" onMouseOver="funcPopup(event,'service_function_exists')">service_function_exists</a>(<a class="var it3922" onMouseOver="hilite(3922)" onMouseOut="lolite()" onClick="logVariable('functionname')" href="../_variables/functionname.html">$functionname</a>, <a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>) {
<a name="l710"><span class="linenum"> 710</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l711"><span class="linenum"> 711</span></a>          return <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('record_exists')" href="../_functions/record_exists.html" onMouseOver="funcPopup(event,'record_exists')">record_exists</a>('external_services_functions',
<a name="l712"><span class="linenum"> 712</span></a>                              array('externalserviceid' =&gt; <a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>,
<a name="l713"><span class="linenum"> 713</span></a>                                  'functionname' =&gt; <a class="var it3922" onMouseOver="hilite(3922)" onMouseOut="lolite()" onClick="logVariable('functionname')" href="../_variables/functionname.html">$functionname</a>));
<a name="l714"><span class="linenum"> 714</span></a>      }
<a name="l715"><span class="linenum"> 715</span></a>  
<a name="l716"><span class="linenum"> 716</span></a>      <span class="comment">/**</span>
<a name="l717"><span class="linenum"> 717</span></a>  <span class="comment">     * Remove a function from a service</span>
<a name="l718"><span class="linenum"> 718</span></a>  <span class="comment">     *</span>
<a name="l719"><span class="linenum"> 719</span></a>  <span class="comment">     * @param string $functionname function name</span>
<a name="l720"><span class="linenum"> 720</span></a>  <span class="comment">     * @param int $serviceid service id</span>
<a name="l721"><span class="linenum"> 721</span></a>  <span class="comment">     */</span>
<a name="l722"><span class="linenum"> 722</span></a>      public function <a class="function" onClick="logFunction('remove_external_function_from_service')" href="../_functions/remove_external_function_from_service.html" onMouseOver="funcPopup(event,'remove_external_function_from_service')">remove_external_function_from_service</a>(<a class="var it3922" onMouseOver="hilite(3922)" onMouseOut="lolite()" onClick="logVariable('functionname')" href="../_variables/functionname.html">$functionname</a>, <a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>) {
<a name="l723"><span class="linenum"> 723</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l724"><span class="linenum"> 724</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_services_functions',
<a name="l725"><span class="linenum"> 725</span></a>                      array('externalserviceid' =&gt; <a class="var it4640" onMouseOver="hilite(4640)" onMouseOut="lolite()" onClick="logVariable('serviceid')" href="../_variables/serviceid.html">$serviceid</a>, 'functionname' =&gt; <a class="var it3922" onMouseOver="hilite(3922)" onMouseOut="lolite()" onClick="logVariable('functionname')" href="../_variables/functionname.html">$functionname</a>));
<a name="l726"><span class="linenum"> 726</span></a>  
<a name="l727"><span class="linenum"> 727</span></a>      }
<a name="l728"><span class="linenum"> 728</span></a>  
<a name="l729"><span class="linenum"> 729</span></a>  
<a name="l730"><span class="linenum"> 730</span></a>  }
<a name="l731"><span class="linenum"> 731</span></a>  
<a name="l732"><span class="linenum"> 732</span></a>  <span class="comment">/**</span>
<a name="l733"><span class="linenum"> 733</span></a>  <span class="comment"> * Exception indicating access control problem in web service call</span>
<a name="l734"><span class="linenum"> 734</span></a>  <span class="comment"> * This exception should return general errors about web service setup.</span>
<a name="l735"><span class="linenum"> 735</span></a>  <span class="comment"> * Errors related to the user like wrong username/password should not use it,</span>
<a name="l736"><span class="linenum"> 736</span></a>  <span class="comment"> * you should not use this exception if you want to let the client implement</span>
<a name="l737"><span class="linenum"> 737</span></a>  <span class="comment"> * some code logic against an access error.</span>
<a name="l738"><span class="linenum"> 738</span></a>  <span class="comment"> *</span>
<a name="l739"><span class="linenum"> 739</span></a>  <span class="comment"> * @package    core_webservice</span>
<a name="l740"><span class="linenum"> 740</span></a>  <span class="comment"> * @copyright  2009 Petr Skodak</span>
<a name="l741"><span class="linenum"> 741</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l742"><span class="linenum"> 742</span></a>  <span class="comment"> */</span>
<a name="l743"><span class="linenum"> 743</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a> <span class="keyword">extends</span> <a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a> {
<a name="l744"><span class="linenum"> 744</span></a>  
<a name="l745"><span class="linenum"> 745</span></a>      <span class="comment">/**</span>
<a name="l746"><span class="linenum"> 746</span></a>  <span class="comment">     * Constructor</span>
<a name="l747"><span class="linenum"> 747</span></a>  <span class="comment">     *</span>
<a name="l748"><span class="linenum"> 748</span></a>  <span class="comment">     * @param string $debuginfo the debug info</span>
<a name="l749"><span class="linenum"> 749</span></a>  <span class="comment">     */</span>
<a name="l750"><span class="linenum"> 750</span></a>      function <a class="function" onClick="logFunction('__construct')" href="../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>(<a class="var it545" onMouseOver="hilite(545)" onMouseOut="lolite()" onClick="logVariable('debuginfo')" href="../_variables/debuginfo.html">$debuginfo</a>) {
<a name="l751"><span class="linenum"> 751</span></a>          parent::<a class="function" onClick="logFunction('__construct')" href="../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>('accessexception', 'webservice', '', null, <a class="var it545" onMouseOver="hilite(545)" onMouseOut="lolite()" onClick="logVariable('debuginfo')" href="../_variables/debuginfo.html">$debuginfo</a>);
<a name="l752"><span class="linenum"> 752</span></a>      }
<a name="l753"><span class="linenum"> 753</span></a>  }
<a name="l754"><span class="linenum"> 754</span></a>  
<a name="l755"><span class="linenum"> 755</span></a>  <span class="comment">/**</span>
<a name="l756"><span class="linenum"> 756</span></a>  <span class="comment"> * Check if a protocol is enabled</span>
<a name="l757"><span class="linenum"> 757</span></a>  <span class="comment"> *</span>
<a name="l758"><span class="linenum"> 758</span></a>  <span class="comment"> * @param string $protocol name of WS protocol ('rest', 'soap', 'xmlrpc', 'amf'...)</span>
<a name="l759"><span class="linenum"> 759</span></a>  <span class="comment"> * @return bool true if the protocol is enabled</span>
<a name="l760"><span class="linenum"> 760</span></a>  <span class="comment"> */</span>
<a name="l761"><span class="linenum"> 761</span></a>  function <a class="function" onClick="logFunction('webservice_protocol_is_enabled')" href="../_functions/webservice_protocol_is_enabled.html" onMouseOver="funcPopup(event,'webservice_protocol_is_enabled')">webservice_protocol_is_enabled</a>(<a class="var it4665" onMouseOver="hilite(4665)" onMouseOut="lolite()" onClick="logVariable('protocol')" href="../_variables/protocol.html">$protocol</a>) {
<a name="l762"><span class="linenum"> 762</span></a>      global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l763"><span class="linenum"> 763</span></a>  
<a name="l764"><span class="linenum"> 764</span></a>      if (empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('enablewebservices')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/enablewebservices.html">enablewebservices</a>)) {
<a name="l765"><span class="linenum"> 765</span></a>          return false;
<a name="l766"><span class="linenum"> 766</span></a>      }
<a name="l767"><span class="linenum"> 767</span></a>  
<a name="l768"><span class="linenum"> 768</span></a>      <a class="var it4666" onMouseOver="hilite(4666)" onMouseOut="lolite()" onClick="logVariable('active')" href="../_variables/active.html">$active</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('webserviceprotocols')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/webserviceprotocols.html">webserviceprotocols</a>);
<a name="l769"><span class="linenum"> 769</span></a>  
<a name="l770"><span class="linenum"> 770</span></a>      return(<a class="phpfunction" onClick="logFunction('in_array')" href="../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>(<a class="var it4665" onMouseOver="hilite(4665)" onMouseOut="lolite()" onClick="logVariable('protocol')" href="../_variables/protocol.html">$protocol</a>, <a class="var it4666" onMouseOver="hilite(4666)" onMouseOut="lolite()" onClick="logVariable('active')" href="../_variables/active.html">$active</a>));
<a name="l771"><span class="linenum"> 771</span></a>  }
<a name="l772"><span class="linenum"> 772</span></a>  
<a name="l773"><span class="linenum"> 773</span></a>  <span class="comment">/**</span>
<a name="l774"><span class="linenum"> 774</span></a>  <span class="comment"> * Mandatory interface for all test client classes.</span>
<a name="l775"><span class="linenum"> 775</span></a>  <span class="comment"> *</span>
<a name="l776"><span class="linenum"> 776</span></a>  <span class="comment"> * @package    core_webservice</span>
<a name="l777"><span class="linenum"> 777</span></a>  <span class="comment"> * @copyright  2009 Petr Skodak</span>
<a name="l778"><span class="linenum"> 778</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l779"><span class="linenum"> 779</span></a>  <span class="comment"> */</span>
<a name="l780"><span class="linenum"> 780</span></a>  <span class="keyword">interface </span><a class="class" onClick="logClass('webservice_test_client_interface')" href="../_classes/webservice_test_client_interface.html" onMouseOver="classPopup(event,'webservice_test_client_interface')">webservice_test_client_interface</a> {
<a name="l781"><span class="linenum"> 781</span></a>  
<a name="l782"><span class="linenum"> 782</span></a>      <span class="comment">/**</span>
<a name="l783"><span class="linenum"> 783</span></a>  <span class="comment">     * Execute test client WS request</span>
<a name="l784"><span class="linenum"> 784</span></a>  <span class="comment">     *</span>
<a name="l785"><span class="linenum"> 785</span></a>  <span class="comment">     * @param string $serverurl server url (including the token param)</span>
<a name="l786"><span class="linenum"> 786</span></a>  <span class="comment">     * @param string $function web service function name</span>
<a name="l787"><span class="linenum"> 787</span></a>  <span class="comment">     * @param array $params parameters of the web service function</span>
<a name="l788"><span class="linenum"> 788</span></a>  <span class="comment">     * @return mixed</span>
<a name="l789"><span class="linenum"> 789</span></a>  <span class="comment">     */</span>
<a name="l790"><span class="linenum"> 790</span></a>      public function <a class="function" onClick="logFunction('simpletest')" href="../_functions/simpletest.html" onMouseOver="funcPopup(event,'simpletest')">simpletest</a>(<a class="var it4668" onMouseOver="hilite(4668)" onMouseOut="lolite()" onClick="logVariable('serverurl')" href="../_variables/serverurl.html">$serverurl</a>, <a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l791"><span class="linenum"> 791</span></a>  }
<a name="l792"><span class="linenum"> 792</span></a>  
<a name="l793"><span class="linenum"> 793</span></a>  <span class="comment">/**</span>
<a name="l794"><span class="linenum"> 794</span></a>  <span class="comment"> * Mandatory interface for all web service protocol classes</span>
<a name="l795"><span class="linenum"> 795</span></a>  <span class="comment"> *</span>
<a name="l796"><span class="linenum"> 796</span></a>  <span class="comment"> * @package    core_webservice</span>
<a name="l797"><span class="linenum"> 797</span></a>  <span class="comment"> * @copyright  2009 Petr Skodak</span>
<a name="l798"><span class="linenum"> 798</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l799"><span class="linenum"> 799</span></a>  <span class="comment"> */</span>
<a name="l800"><span class="linenum"> 800</span></a>  <span class="keyword">interface </span><a class="class" onClick="logClass('webservice_server_interface')" href="../_classes/webservice_server_interface.html" onMouseOver="classPopup(event,'webservice_server_interface')">webservice_server_interface</a> {
<a name="l801"><span class="linenum"> 801</span></a>  
<a name="l802"><span class="linenum"> 802</span></a>      <span class="comment">/**</span>
<a name="l803"><span class="linenum"> 803</span></a>  <span class="comment">     * Process request from client.</span>
<a name="l804"><span class="linenum"> 804</span></a>  <span class="comment">     */</span>
<a name="l805"><span class="linenum"> 805</span></a>      public function <a class="function" onClick="logFunction('run')" href="../_functions/run.html" onMouseOver="funcPopup(event,'run')">run</a>();
<a name="l806"><span class="linenum"> 806</span></a>  }
<a name="l807"><span class="linenum"> 807</span></a>  
<a name="l808"><span class="linenum"> 808</span></a>  <span class="comment">/**</span>
<a name="l809"><span class="linenum"> 809</span></a>  <span class="comment"> * Abstract web service base class.</span>
<a name="l810"><span class="linenum"> 810</span></a>  <span class="comment"> *</span>
<a name="l811"><span class="linenum"> 811</span></a>  <span class="comment"> * @package    core_webservice</span>
<a name="l812"><span class="linenum"> 812</span></a>  <span class="comment"> * @copyright  2009 Petr Skodak</span>
<a name="l813"><span class="linenum"> 813</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l814"><span class="linenum"> 814</span></a>  <span class="comment"> */</span>
<a name="l815"><span class="linenum"> 815</span></a>  abstract class webservice_server <span class="keyword">implements</span> <a class="class" onClick="logClass('webservice_server_interface')" href="../_classes/webservice_server_interface.html" onMouseOver="classPopup(event,'webservice_server_interface')">webservice_server_interface</a> {
<a name="l816"><span class="linenum"> 816</span></a>  
<a name="l817"><span class="linenum"> 817</span></a>  <span class="comment">    /** @var string Name of the web server plugin */</span>
<a name="l818"><span class="linenum"> 818</span></a>      protected <a class="var it4669" onMouseOver="hilite(4669)" onMouseOut="lolite()" onClick="logVariable('wsname')" href="../_variables/wsname.html">$wsname</a> = null;
<a name="l819"><span class="linenum"> 819</span></a>  
<a name="l820"><span class="linenum"> 820</span></a>  <span class="comment">    /** @var string Name of local user */</span>
<a name="l821"><span class="linenum"> 821</span></a>      protected <a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('username')" href="../_variables/username.html">$username</a> = null;
<a name="l822"><span class="linenum"> 822</span></a>  
<a name="l823"><span class="linenum"> 823</span></a>  <span class="comment">    /** @var string Password of the local user */</span>
<a name="l824"><span class="linenum"> 824</span></a>      protected <a class="var it2550" onMouseOver="hilite(2550)" onMouseOut="lolite()" onClick="logVariable('password')" href="../_variables/password.html">$password</a> = null;
<a name="l825"><span class="linenum"> 825</span></a>  
<a name="l826"><span class="linenum"> 826</span></a>  <span class="comment">    /** @var int The local user */</span>
<a name="l827"><span class="linenum"> 827</span></a>      protected <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('userid')" href="../_variables/userid.html">$userid</a> = null;
<a name="l828"><span class="linenum"> 828</span></a>  
<a name="l829"><span class="linenum"> 829</span></a>  <span class="comment">    /** @var integer Authentication method one of WEBSERVICE_AUTHMETHOD_* */</span>
<a name="l830"><span class="linenum"> 830</span></a>      protected <a class="var it4670" onMouseOver="hilite(4670)" onMouseOut="lolite()" onClick="logVariable('authmethod')" href="../_variables/authmethod.html">$authmethod</a>;
<a name="l831"><span class="linenum"> 831</span></a>  
<a name="l832"><span class="linenum"> 832</span></a>  <span class="comment">    /** @var string Authentication token*/</span>
<a name="l833"><span class="linenum"> 833</span></a>      protected <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a> = null;
<a name="l834"><span class="linenum"> 834</span></a>  
<a name="l835"><span class="linenum"> 835</span></a>  <span class="comment">    /** @var stdClass Restricted context */</span>
<a name="l836"><span class="linenum"> 836</span></a>      protected <a class="var it4671" onMouseOver="hilite(4671)" onMouseOut="lolite()" onClick="logVariable('restricted_context')" href="../_variables/restricted_context.html">$restricted_context</a>;
<a name="l837"><span class="linenum"> 837</span></a>  
<a name="l838"><span class="linenum"> 838</span></a>  <span class="comment">    /** @var int Restrict call to one service id*/</span>
<a name="l839"><span class="linenum"> 839</span></a>      protected <a class="var it4672" onMouseOver="hilite(4672)" onMouseOut="lolite()" onClick="logVariable('restricted_serviceid')" href="../_variables/restricted_serviceid.html">$restricted_serviceid</a> = null;
<a name="l840"><span class="linenum"> 840</span></a>  
<a name="l841"><span class="linenum"> 841</span></a>      <span class="comment">/**</span>
<a name="l842"><span class="linenum"> 842</span></a>  <span class="comment">     * Constructor</span>
<a name="l843"><span class="linenum"> 843</span></a>  <span class="comment">     *</span>
<a name="l844"><span class="linenum"> 844</span></a>  <span class="comment">     * @param integer $authmethod authentication method one of WEBSERVICE_AUTHMETHOD_*</span>
<a name="l845"><span class="linenum"> 845</span></a>  <span class="comment">     */</span>
<a name="l846"><span class="linenum"> 846</span></a>      public function <a class="function" onClick="logFunction('__construct')" href="../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>(<a class="var it4670" onMouseOver="hilite(4670)" onMouseOut="lolite()" onClick="logVariable('authmethod')" href="../_variables/authmethod.html">$authmethod</a>) {
<a name="l847"><span class="linenum"> 847</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authmethod')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/authmethod.html">authmethod</a> = <a class="var it4670" onMouseOver="hilite(4670)" onMouseOut="lolite()" onClick="logVariable('authmethod')" href="../_variables/authmethod.html">$authmethod</a>;
<a name="l848"><span class="linenum"> 848</span></a>      }
<a name="l849"><span class="linenum"> 849</span></a>  
<a name="l850"><span class="linenum"> 850</span></a>  
<a name="l851"><span class="linenum"> 851</span></a>      <span class="comment">/**</span>
<a name="l852"><span class="linenum"> 852</span></a>  <span class="comment">     * Authenticate user using username+password or token.</span>
<a name="l853"><span class="linenum"> 853</span></a>  <span class="comment">     * This function sets up $USER global.</span>
<a name="l854"><span class="linenum"> 854</span></a>  <span class="comment">     * It is safe to use has_capability() after this.</span>
<a name="l855"><span class="linenum"> 855</span></a>  <span class="comment">     * This method also verifies user is allowed to use this</span>
<a name="l856"><span class="linenum"> 856</span></a>  <span class="comment">     * server.</span>
<a name="l857"><span class="linenum"> 857</span></a>  <span class="comment">     */</span>
<a name="l858"><span class="linenum"> 858</span></a>      protected function <a class="function" onClick="logFunction('authenticate_user')" href="../_functions/authenticate_user.html" onMouseOver="funcPopup(event,'authenticate_user')">authenticate_user</a>() {
<a name="l859"><span class="linenum"> 859</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l860"><span class="linenum"> 860</span></a>  
<a name="l861"><span class="linenum"> 861</span></a>          if (!<a class="constant" onClick="logConstant('NO_MOODLE_COOKIES')" href="../_constants/NO_MOODLE_COOKIES.html" onMouseOver="constPopup(event,'NO_MOODLE_COOKIES')">NO_MOODLE_COOKIES</a>) {
<a name="l862"><span class="linenum"> 862</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('coding_exception')" href="../_classes/coding_exception.html" onMouseOver="classPopup(event,'coding_exception')">coding_exception</a>('Cookies must be disabled in WS servers!');
<a name="l863"><span class="linenum"> 863</span></a>          }
<a name="l864"><span class="linenum"> 864</span></a>  
<a name="l865"><span class="linenum"> 865</span></a>          <a class="var it4638" onMouseOver="hilite(4638)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a> = array(
<a name="l866"><span class="linenum"> 866</span></a>              'context' =&gt; <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(),
<a name="l867"><span class="linenum"> 867</span></a>              'other' =&gt; array(
<a name="l868"><span class="linenum"> 868</span></a>                  'method' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authmethod')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/authmethod.html">authmethod</a>,
<a name="l869"><span class="linenum"> 869</span></a>                  'reason' =&gt; null
<a name="l870"><span class="linenum"> 870</span></a>              )
<a name="l871"><span class="linenum"> 871</span></a>          );
<a name="l872"><span class="linenum"> 872</span></a>  
<a name="l873"><span class="linenum"> 873</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authmethod')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/authmethod.html">authmethod</a> == <a class="constant" onClick="logConstant('WEBSERVICE_AUTHMETHOD_USERNAME')" href="../_constants/WEBSERVICE_AUTHMETHOD_USERNAME.html" onMouseOver="constPopup(event,'WEBSERVICE_AUTHMETHOD_USERNAME')">WEBSERVICE_AUTHMETHOD_USERNAME</a>) {
<a name="l874"><span class="linenum"> 874</span></a>  
<a name="l875"><span class="linenum"> 875</span></a>  <span class="comment">            //we check that authentication plugin is enabled</span>
<a name="l876"><span class="linenum"> 876</span></a>  <span class="comment">            //it is only required by simple authentication</span>
<a name="l877"><span class="linenum"> 877</span></a>              if (!<a class="function" onClick="logFunction('is_enabled_auth')" href="../_functions/is_enabled_auth.html" onMouseOver="funcPopup(event,'is_enabled_auth')">is_enabled_auth</a>('webservice')) {
<a name="l878"><span class="linenum"> 878</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('The web service authentication plugin is disabled.');
<a name="l879"><span class="linenum"> 879</span></a>              }
<a name="l880"><span class="linenum"> 880</span></a>  
<a name="l881"><span class="linenum"> 881</span></a>              if (!<a class="var it524" onMouseOver="hilite(524)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../_variables/auth.html">$auth</a> = <a class="function" onClick="logFunction('get_auth_plugin')" href="../_functions/get_auth_plugin.html" onMouseOver="funcPopup(event,'get_auth_plugin')">get_auth_plugin</a>('webservice')) {
<a name="l882"><span class="linenum"> 882</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('The web service authentication plugin is missing.');
<a name="l883"><span class="linenum"> 883</span></a>              }
<a name="l884"><span class="linenum"> 884</span></a>  
<a name="l885"><span class="linenum"> 885</span></a>              <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_context')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/restricted_context.html">restricted_context</a> = <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>();
<a name="l886"><span class="linenum"> 886</span></a>  
<a name="l887"><span class="linenum"> 887</span></a>              if (!<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('username')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/username.html">username</a>) {
<a name="l888"><span class="linenum"> 888</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('missingusername', 'webservice');
<a name="l889"><span class="linenum"> 889</span></a>              }
<a name="l890"><span class="linenum"> 890</span></a>  
<a name="l891"><span class="linenum"> 891</span></a>              if (!<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('password')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/password.html">password</a>) {
<a name="l892"><span class="linenum"> 892</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('missingpassword', 'webservice');
<a name="l893"><span class="linenum"> 893</span></a>              }
<a name="l894"><span class="linenum"> 894</span></a>  
<a name="l895"><span class="linenum"> 895</span></a>              if (!<a class="var it524" onMouseOver="hilite(524)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../_variables/auth.html">$auth</a>-&gt;<a class="function" onClick="logFunction('user_login_webservice')" href="../_functions/user_login_webservice.html" onMouseOver="funcPopup(event,'user_login_webservice')">user_login_webservice</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('username')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/username.html">username</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('password')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/password.html">password</a>)) {
<a name="l896"><span class="linenum"> 896</span></a>  
<a name="l897"><span class="linenum"> 897</span></a>  <span class="comment">                // Log failed login attempts.</span>
<a name="l898"><span class="linenum"> 898</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it4638" onMouseOver="hilite(4638)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l899"><span class="linenum"> 899</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'password';
<a name="l900"><span class="linenum"> 900</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['username'] = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('username')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/username.html">username</a>;
<a name="l901"><span class="linenum"> 901</span></a>                  <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l902"><span class="linenum"> 902</span></a>                  <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, 'webservice', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('simpleauthlog', 'webservice'), '' ,
<a name="l903"><span class="linenum"> 903</span></a>                      <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('failedtolog', 'webservice').&quot;: &quot;.<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('username')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/username.html">username</a>.&quot;/&quot;.<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('password')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/password.html">password</a>.&quot; - &quot;.<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>() , 0));
<a name="l904"><span class="linenum"> 904</span></a>                  <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l905"><span class="linenum"> 905</span></a>  
<a name="l906"><span class="linenum"> 906</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('wrongusernamepassword', 'webservice');
<a name="l907"><span class="linenum"> 907</span></a>              }
<a name="l908"><span class="linenum"> 908</span></a>  
<a name="l909"><span class="linenum"> 909</span></a>              <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('username'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('username')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/username.html">username</a>, 'mnethostid'=&gt;<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('mnet_localhost_id')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/mnet_localhost_id.html">mnet_localhost_id</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l910"><span class="linenum"> 910</span></a>  
<a name="l911"><span class="linenum"> 911</span></a>          } else if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authmethod')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/authmethod.html">authmethod</a> == <a class="constant" onClick="logConstant('WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN')" href="../_constants/WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN.html" onMouseOver="constPopup(event,'WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN')">WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN</a>){
<a name="l912"><span class="linenum"> 912</span></a>              <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('authenticate_by_token')" href="../_functions/authenticate_by_token.html" onMouseOver="funcPopup(event,'authenticate_by_token')">authenticate_by_token</a>(<a class="constant" onClick="logConstant('EXTERNAL_TOKEN_PERMANENT')" href="../_constants/EXTERNAL_TOKEN_PERMANENT.html" onMouseOver="constPopup(event,'EXTERNAL_TOKEN_PERMANENT')">EXTERNAL_TOKEN_PERMANENT</a>);
<a name="l913"><span class="linenum"> 913</span></a>          } else {
<a name="l914"><span class="linenum"> 914</span></a>              <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('authenticate_by_token')" href="../_functions/authenticate_by_token.html" onMouseOver="funcPopup(event,'authenticate_by_token')">authenticate_by_token</a>(<a class="constant" onClick="logConstant('EXTERNAL_TOKEN_EMBEDDED')" href="../_constants/EXTERNAL_TOKEN_EMBEDDED.html" onMouseOver="constPopup(event,'EXTERNAL_TOKEN_EMBEDDED')">EXTERNAL_TOKEN_EMBEDDED</a>);
<a name="l915"><span class="linenum"> 915</span></a>          }
<a name="l916"><span class="linenum"> 916</span></a>  
<a name="l917"><span class="linenum"> 917</span></a>  <span class="comment">        //Non admin can not authenticate if maintenance mode</span>
<a name="l918"><span class="linenum"> 918</span></a>          <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('hassiteconfig')" href="../_variables/hassiteconfig.html">$hassiteconfig</a> = <a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>('moodle/site:config', <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(), <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l919"><span class="linenum"> 919</span></a>          if (!empty(<a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>-&gt;<a onClick="logVariable('maintenance_enabled')" class="var it39440" onMouseOver="hilite(39440)" onMouseOut="lolite()" href="../_variables/maintenance_enabled.html">maintenance_enabled</a>) and !<a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('hassiteconfig')" href="../_variables/hassiteconfig.html">$hassiteconfig</a>) {
<a name="l920"><span class="linenum"> 920</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('sitemaintenance', 'admin');
<a name="l921"><span class="linenum"> 921</span></a>          }
<a name="l922"><span class="linenum"> 922</span></a>  
<a name="l923"><span class="linenum"> 923</span></a>  <span class="comment">        //only confirmed user should be able to call web service</span>
<a name="l924"><span class="linenum"> 924</span></a>          if (!empty(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('deleted')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/deleted.html">deleted</a>)) {
<a name="l925"><span class="linenum"> 925</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it4638" onMouseOver="hilite(4638)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l926"><span class="linenum"> 926</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'user_deleted';
<a name="l927"><span class="linenum"> 927</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['username'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>;
<a name="l928"><span class="linenum"> 928</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l929"><span class="linenum"> 929</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, '', '', '', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('wsaccessuserdeleted', 'webservice',
<a name="l930"><span class="linenum"> 930</span></a>                  <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>) . &quot; - &quot;.<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>(), 0, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l931"><span class="linenum"> 931</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l932"><span class="linenum"> 932</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Refused web service access for deleted username: ' . <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l933"><span class="linenum"> 933</span></a>          }
<a name="l934"><span class="linenum"> 934</span></a>  
<a name="l935"><span class="linenum"> 935</span></a>  <span class="comment">        //only confirmed user should be able to call web service</span>
<a name="l936"><span class="linenum"> 936</span></a>          if (empty(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('confirmed')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/confirmed.html">confirmed</a>)) {
<a name="l937"><span class="linenum"> 937</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it4638" onMouseOver="hilite(4638)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l938"><span class="linenum"> 938</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'user_unconfirmed';
<a name="l939"><span class="linenum"> 939</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['username'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>;
<a name="l940"><span class="linenum"> 940</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l941"><span class="linenum"> 941</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, '', '', '', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('wsaccessuserunconfirmed', 'webservice',
<a name="l942"><span class="linenum"> 942</span></a>                  <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>) . &quot; - &quot;.<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>(), 0, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l943"><span class="linenum"> 943</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l944"><span class="linenum"> 944</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('wsaccessuserunconfirmed', 'webservice', '', <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l945"><span class="linenum"> 945</span></a>          }
<a name="l946"><span class="linenum"> 946</span></a>  
<a name="l947"><span class="linenum"> 947</span></a>  <span class="comment">        //check the user is suspended</span>
<a name="l948"><span class="linenum"> 948</span></a>          if (!empty(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('suspended')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/suspended.html">suspended</a>)) {
<a name="l949"><span class="linenum"> 949</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it4638" onMouseOver="hilite(4638)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l950"><span class="linenum"> 950</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'user_unconfirmed';
<a name="l951"><span class="linenum"> 951</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['username'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>;
<a name="l952"><span class="linenum"> 952</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l953"><span class="linenum"> 953</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, '', '', '', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('wsaccessusersuspended', 'webservice',
<a name="l954"><span class="linenum"> 954</span></a>                  <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>) . &quot; - &quot;.<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>(), 0, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l955"><span class="linenum"> 955</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l956"><span class="linenum"> 956</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Refused web service access for suspended username: ' . <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l957"><span class="linenum"> 957</span></a>          }
<a name="l958"><span class="linenum"> 958</span></a>  
<a name="l959"><span class="linenum"> 959</span></a>  <span class="comment">        //retrieve the authentication plugin if no previously done</span>
<a name="l960"><span class="linenum"> 960</span></a>          if (empty(<a class="var it524" onMouseOver="hilite(524)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../_variables/auth.html">$auth</a>)) {
<a name="l961"><span class="linenum"> 961</span></a>            <a class="var it524" onMouseOver="hilite(524)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../_variables/auth.html">$auth</a>  = <a class="function" onClick="logFunction('get_auth_plugin')" href="../_functions/get_auth_plugin.html" onMouseOver="funcPopup(event,'get_auth_plugin')">get_auth_plugin</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/auth.html">auth</a>);
<a name="l962"><span class="linenum"> 962</span></a>          }
<a name="l963"><span class="linenum"> 963</span></a>  
<a name="l964"><span class="linenum"> 964</span></a>  <span class="comment">        // check if credentials have expired</span>
<a name="l965"><span class="linenum"> 965</span></a>          if (!empty(<a class="var it524" onMouseOver="hilite(524)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../_variables/auth.html">$auth</a>-&gt;<a onClick="logVariable('config')" class="var it40437" onMouseOver="hilite(40437)" onMouseOut="lolite()" href="../_variables/config.html">config</a>-&gt;expiration) and <a class="var it524" onMouseOver="hilite(524)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../_variables/auth.html">$auth</a>-&gt;<a onClick="logVariable('config')" class="var it40437" onMouseOver="hilite(40437)" onMouseOut="lolite()" href="../_variables/config.html">config</a>-&gt;expiration == 1) {
<a name="l966"><span class="linenum"> 966</span></a>              <a class="var it4622" onMouseOver="hilite(4622)" onMouseOut="lolite()" onClick="logVariable('days2expire')" href="../_variables/days2expire.html">$days2expire</a> = <a class="var it524" onMouseOver="hilite(524)" onMouseOut="lolite()" onClick="logVariable('auth')" href="../_variables/auth.html">$auth</a>-&gt;<a class="function" onClick="logFunction('password_expire')" href="../_functions/password_expire.html" onMouseOver="funcPopup(event,'password_expire')">password_expire</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l967"><span class="linenum"> 967</span></a>              if (<a class="phpfunction" onClick="logFunction('intval')" href="../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>(<a class="var it4622" onMouseOver="hilite(4622)" onMouseOut="lolite()" onClick="logVariable('days2expire')" href="../_variables/days2expire.html">$days2expire</a>) &lt; 0 ) {
<a name="l968"><span class="linenum"> 968</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it4638" onMouseOver="hilite(4638)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l969"><span class="linenum"> 969</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'password_expired';
<a name="l970"><span class="linenum"> 970</span></a>                  <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['username'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>;
<a name="l971"><span class="linenum"> 971</span></a>                  <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l972"><span class="linenum"> 972</span></a>                  <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, '', '', '', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('wsaccessuserexpired', 'webservice',
<a name="l973"><span class="linenum"> 973</span></a>                      <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>) . &quot; - &quot;.<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>(), 0, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l974"><span class="linenum"> 974</span></a>                  <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l975"><span class="linenum"> 975</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Refused web service access for password expired username: ' . <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l976"><span class="linenum"> 976</span></a>              }
<a name="l977"><span class="linenum"> 977</span></a>          }
<a name="l978"><span class="linenum"> 978</span></a>  
<a name="l979"><span class="linenum"> 979</span></a>  <span class="comment">        //check if the auth method is nologin (in this case refuse connection)</span>
<a name="l980"><span class="linenum"> 980</span></a>          if (<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('auth')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/auth.html">auth</a>=='nologin') {
<a name="l981"><span class="linenum"> 981</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it4638" onMouseOver="hilite(4638)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l982"><span class="linenum"> 982</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'login';
<a name="l983"><span class="linenum"> 983</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['username'] = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>;
<a name="l984"><span class="linenum"> 984</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l985"><span class="linenum"> 985</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, '', '', '', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('wsaccessusernologin', 'webservice',
<a name="l986"><span class="linenum"> 986</span></a>                  <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>) . &quot; - &quot;.<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>(), 0, <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l987"><span class="linenum"> 987</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l988"><span class="linenum"> 988</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Refused web service access for nologin authentication username: ' . <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('username')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/username.html">username</a>);
<a name="l989"><span class="linenum"> 989</span></a>          }
<a name="l990"><span class="linenum"> 990</span></a>  
<a name="l991"><span class="linenum"> 991</span></a>  <span class="comment">        // now fake user login, the session is completely empty too</span>
<a name="l992"><span class="linenum"> 992</span></a>          <a class="function" onClick="logFunction('enrol_check_plugins')" href="../_functions/enrol_check_plugins.html" onMouseOver="funcPopup(event,'enrol_check_plugins')">enrol_check_plugins</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l993"><span class="linenum"> 993</span></a>          \core\session\<a class="class" onClick="logClass('manager')" href="../_classes/manager.html" onMouseOver="classPopup(event,'manager')">manager</a>::<a class="function" onClick="logFunction('set_user')" href="../_functions/set_user.html" onMouseOver="funcPopup(event,'set_user')">set_user</a>(<a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>);
<a name="l994"><span class="linenum"> 994</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a> = <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>-&gt;<a onClick="logVariable('id')" class="var it39447" onMouseOver="hilite(39447)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l995"><span class="linenum"> 995</span></a>  
<a name="l996"><span class="linenum"> 996</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authmethod')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/authmethod.html">authmethod</a> != <a class="constant" onClick="logConstant('WEBSERVICE_AUTHMETHOD_SESSION_TOKEN')" href="../_constants/WEBSERVICE_AUTHMETHOD_SESSION_TOKEN.html" onMouseOver="constPopup(event,'WEBSERVICE_AUTHMETHOD_SESSION_TOKEN')">WEBSERVICE_AUTHMETHOD_SESSION_TOKEN</a> &amp;&amp; !<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(&quot;webservice/<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('wsname')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/wsname.html">wsname</a>:use&quot;, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_context')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/restricted_context.html">restricted_context</a>)) {
<a name="l997"><span class="linenum"> 997</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('You are not allowed to use the {<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('a')" href="../_variables/a.html">$a</a>} protocol (missing capability: webservice/' . <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('wsname')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/wsname.html">wsname</a> . ':use)');
<a name="l998"><span class="linenum"> 998</span></a>          }
<a name="l999"><span class="linenum"> 999</span></a>  
<a name="l1000"><span class="linenum">1000</span></a>          <a class="class" onClick="logClass('external_api')" href="../_classes/external_api.html" onMouseOver="classPopup(event,'external_api')">external_api</a>::<a class="function" onClick="logFunction('set_context_restriction')" href="../_functions/set_context_restriction.html" onMouseOver="funcPopup(event,'set_context_restriction')">set_context_restriction</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_context')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/restricted_context.html">restricted_context</a>);
<a name="l1001"><span class="linenum">1001</span></a>      }
<a name="l1002"><span class="linenum">1002</span></a>  
<a name="l1003"><span class="linenum">1003</span></a>      <span class="comment">/**</span>
<a name="l1004"><span class="linenum">1004</span></a>  <span class="comment">     * User authentication by token</span>
<a name="l1005"><span class="linenum">1005</span></a>  <span class="comment">     *</span>
<a name="l1006"><span class="linenum">1006</span></a>  <span class="comment">     * @param string $tokentype token type (EXTERNAL_TOKEN_EMBEDDED or EXTERNAL_TOKEN_PERMANENT)</span>
<a name="l1007"><span class="linenum">1007</span></a>  <span class="comment">     * @return stdClass the authenticated user</span>
<a name="l1008"><span class="linenum">1008</span></a>  <span class="comment">     * @throws webservice_access_exception</span>
<a name="l1009"><span class="linenum">1009</span></a>  <span class="comment">     */</span>
<a name="l1010"><span class="linenum">1010</span></a>      protected function <a class="function" onClick="logFunction('authenticate_by_token')" href="../_functions/authenticate_by_token.html" onMouseOver="funcPopup(event,'authenticate_by_token')">authenticate_by_token</a>(<a class="var it4631" onMouseOver="hilite(4631)" onMouseOut="lolite()" onClick="logVariable('tokentype')" href="../_variables/tokentype.html">$tokentype</a>){
<a name="l1011"><span class="linenum">1011</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1012"><span class="linenum">1012</span></a>  
<a name="l1013"><span class="linenum">1013</span></a>          <a class="var it4638" onMouseOver="hilite(4638)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a> = array(
<a name="l1014"><span class="linenum">1014</span></a>              'context' =&gt; <a class="class" onClick="logClass('context_system')" href="../_classes/context_system.html" onMouseOver="classPopup(event,'context_system')">context_system</a>::<a class="function" onClick="logFunction('instance')" href="../_functions/instance.html" onMouseOver="funcPopup(event,'instance')">instance</a>(),
<a name="l1015"><span class="linenum">1015</span></a>              'other' =&gt; array(
<a name="l1016"><span class="linenum">1016</span></a>                  'method' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authmethod')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/authmethod.html">authmethod</a>,
<a name="l1017"><span class="linenum">1017</span></a>                  'reason' =&gt; null
<a name="l1018"><span class="linenum">1018</span></a>              )
<a name="l1019"><span class="linenum">1019</span></a>          );
<a name="l1020"><span class="linenum">1020</span></a>  
<a name="l1021"><span class="linenum">1021</span></a>          if (!<a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('external_tokens', array('token'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('token')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/token.html">token</a>, 'tokentype'=&gt;<a class="var it4631" onMouseOver="hilite(4631)" onMouseOut="lolite()" onClick="logVariable('tokentype')" href="../_variables/tokentype.html">$tokentype</a>))) {
<a name="l1022"><span class="linenum">1022</span></a>  <span class="comment">            // Log failed login attempts.</span>
<a name="l1023"><span class="linenum">1023</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it4638" onMouseOver="hilite(4638)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l1024"><span class="linenum">1024</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'invalid_token';
<a name="l1025"><span class="linenum">1025</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l1026"><span class="linenum">1026</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, 'webservice', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('tokenauthlog', 'webservice'), '' ,
<a name="l1027"><span class="linenum">1027</span></a>                  <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('failedtolog', 'webservice').&quot;: &quot;.<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('token')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/token.html">token</a>. &quot; - &quot;.<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>() , 0));
<a name="l1028"><span class="linenum">1028</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1029"><span class="linenum">1029</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('invalidtoken', 'webservice');
<a name="l1030"><span class="linenum">1030</span></a>          }
<a name="l1031"><span class="linenum">1031</span></a>  
<a name="l1032"><span class="linenum">1032</span></a>          if (<a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('validuntil')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/validuntil.html">validuntil</a> and <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('validuntil')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/validuntil.html">validuntil</a> &lt; <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()) {
<a name="l1033"><span class="linenum">1033</span></a>              <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_tokens', array('token'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('token')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/token.html">token</a>, 'tokentype'=&gt;<a class="var it4631" onMouseOver="hilite(4631)" onMouseOut="lolite()" onClick="logVariable('tokentype')" href="../_variables/tokentype.html">$tokentype</a>));
<a name="l1034"><span class="linenum">1034</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Invalid token - token expired - check validuntil time for the token');
<a name="l1035"><span class="linenum">1035</span></a>          }
<a name="l1036"><span class="linenum">1036</span></a>  
<a name="l1037"><span class="linenum">1037</span></a>          if (<a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('sid')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/sid.html">sid</a>){//assumes that if sid is set then there must be a valid associated session no matter the token type
<a name="l1038"><span class="linenum">1038</span></a>              if (!\core\session\<a class="class" onClick="logClass('manager')" href="../_classes/manager.html" onMouseOver="classPopup(event,'manager')">manager</a>::<a class="function" onClick="logFunction('session_exists')" href="../_functions/session_exists.html" onMouseOver="funcPopup(event,'session_exists')">session_exists</a>(<a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('sid')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/sid.html">sid</a>)){
<a name="l1039"><span class="linenum">1039</span></a>                  <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('delete_records')" href="../_functions/delete_records.html" onMouseOver="funcPopup(event,'delete_records')">delete_records</a>('external_tokens', array('sid'=&gt;<a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('sid')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/sid.html">sid</a>));
<a name="l1040"><span class="linenum">1040</span></a>                  throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Invalid session based token - session not found or expired');
<a name="l1041"><span class="linenum">1041</span></a>              }
<a name="l1042"><span class="linenum">1042</span></a>          }
<a name="l1043"><span class="linenum">1043</span></a>  
<a name="l1044"><span class="linenum">1044</span></a>          if (<a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a> and !<a class="function" onClick="logFunction('address_in_subnet')" href="../_functions/address_in_subnet.html" onMouseOver="funcPopup(event,'address_in_subnet')">address_in_subnet</a>(<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>(), <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a>)) {
<a name="l1045"><span class="linenum">1045</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="var it4638" onMouseOver="hilite(4638)" onMouseOut="lolite()" onClick="logVariable('loginfaileddefaultparams')" href="../_variables/loginfaileddefaultparams.html">$loginfaileddefaultparams</a>;
<a name="l1046"><span class="linenum">1046</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['reason'] = 'ip_restricted';
<a name="l1047"><span class="linenum">1047</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>['other']['tokenid'] = <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('id')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l1048"><span class="linenum">1048</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_login_failed')" href="../_classes/webservice_login_failed.html" onMouseOver="classPopup(event,'webservice_login_failed')">webservice_login_failed</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l1049"><span class="linenum">1049</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('add_record_snapshot')" href="../_functions/add_record_snapshot.html" onMouseOver="funcPopup(event,'add_record_snapshot')">add_record_snapshot</a>('external_tokens', <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>);
<a name="l1050"><span class="linenum">1050</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, 'webservice', <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('tokenauthlog', 'webservice'), '' ,
<a name="l1051"><span class="linenum">1051</span></a>                  <a class="function" onClick="logFunction('get_string')" href="../_functions/get_string.html" onMouseOver="funcPopup(event,'get_string')">get_string</a>('failedtolog', 'webservice').&quot;: &quot;.<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>() , 0));
<a name="l1052"><span class="linenum">1052</span></a>              <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1053"><span class="linenum">1053</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>('Invalid service - IP:' . <a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>()
<a name="l1054"><span class="linenum">1054</span></a>                      . ' is not supported - check this allowed user');
<a name="l1055"><span class="linenum">1055</span></a>          }
<a name="l1056"><span class="linenum">1056</span></a>  
<a name="l1057"><span class="linenum">1057</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_context')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/restricted_context.html">restricted_context</a> = context::<a class="function" onClick="logFunction('instance_by_id')" href="../_functions/instance_by_id.html" onMouseOver="funcPopup(event,'instance_by_id')">instance_by_id</a>(<a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('contextid')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/contextid.html">contextid</a>);
<a name="l1058"><span class="linenum">1058</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_serviceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/restricted_serviceid.html">restricted_serviceid</a> = <a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('externalserviceid')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/externalserviceid.html">externalserviceid</a>;
<a name="l1059"><span class="linenum">1059</span></a>  
<a name="l1060"><span class="linenum">1060</span></a>          <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_record')" href="../_functions/get_record.html" onMouseOver="funcPopup(event,'get_record')">get_record</a>('user', array('id'=&gt;<a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('userid')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>), '*', <a class="constant" onClick="logConstant('MUST_EXIST')" href="../_constants/MUST_EXIST.html" onMouseOver="constPopup(event,'MUST_EXIST')">MUST_EXIST</a>);
<a name="l1061"><span class="linenum">1061</span></a>  
<a name="l1062"><span class="linenum">1062</span></a>  <span class="comment">        // log token access</span>
<a name="l1063"><span class="linenum">1063</span></a>          <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('set_field')" href="../_functions/set_field.html" onMouseOver="funcPopup(event,'set_field')">set_field</a>('external_tokens', 'lastaccess', <a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>(), array('id'=&gt;<a class="var it464" onMouseOver="hilite(464)" onMouseOut="lolite()" onClick="logVariable('token')" href="../_variables/token.html">$token</a>-&gt;<a onClick="logVariable('id')" class="var it39452" onMouseOver="hilite(39452)" onMouseOut="lolite()" href="../_variables/id.html">id</a>));
<a name="l1064"><span class="linenum">1064</span></a>  
<a name="l1065"><span class="linenum">1065</span></a>          return <a class="var it119" onMouseOver="hilite(119)" onMouseOut="lolite()" onClick="logVariable('user')" href="../_variables/user.html">$user</a>;
<a name="l1066"><span class="linenum">1066</span></a>  
<a name="l1067"><span class="linenum">1067</span></a>      }
<a name="l1068"><span class="linenum">1068</span></a>  
<a name="l1069"><span class="linenum">1069</span></a>      <span class="comment">/**</span>
<a name="l1070"><span class="linenum">1070</span></a>  <span class="comment">     * Intercept some moodlewssettingXXX $_GET and $_POST parameter</span>
<a name="l1071"><span class="linenum">1071</span></a>  <span class="comment">     * that are related to the web service call and are not the function parameters</span>
<a name="l1072"><span class="linenum">1072</span></a>  <span class="comment">     */</span>
<a name="l1073"><span class="linenum">1073</span></a>      protected function <a class="function" onClick="logFunction('set_web_service_call_settings')" href="../_functions/set_web_service_call_settings.html" onMouseOver="funcPopup(event,'set_web_service_call_settings')">set_web_service_call_settings</a>() {
<a name="l1074"><span class="linenum">1074</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l1075"><span class="linenum">1075</span></a>  
<a name="l1076"><span class="linenum">1076</span></a>  <span class="comment">        // Default web service settings.</span>
<a name="l1077"><span class="linenum">1077</span></a>  <span class="comment">        // Must be the same XXX key name as the external_settings::set_XXX function.</span>
<a name="l1078"><span class="linenum">1078</span></a>  <span class="comment">        // Must be the same XXX ws parameter name as 'moodlewssettingXXX'.</span>
<a name="l1079"><span class="linenum">1079</span></a>          <a class="var it4673" onMouseOver="hilite(4673)" onMouseOut="lolite()" onClick="logVariable('externalsettings')" href="../_variables/externalsettings.html">$externalsettings</a> = array(
<a name="l1080"><span class="linenum">1080</span></a>              'raw' =&gt; false,
<a name="l1081"><span class="linenum">1081</span></a>              'fileurl' =&gt; true,
<a name="l1082"><span class="linenum">1082</span></a>              'filter' =&gt;  false);
<a name="l1083"><span class="linenum">1083</span></a>  
<a name="l1084"><span class="linenum">1084</span></a>  <span class="comment">        // Load the external settings with the web service settings.</span>
<a name="l1085"><span class="linenum">1085</span></a>          <a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../_variables/settings.html">$settings</a> = <a class="class" onClick="logClass('external_settings')" href="../_classes/external_settings.html" onMouseOver="classPopup(event,'external_settings')">external_settings</a>::<a class="function" onClick="logFunction('get_instance')" href="../_functions/get_instance.html" onMouseOver="funcPopup(event,'get_instance')">get_instance</a>();
<a name="l1086"><span class="linenum">1086</span></a>          foreach (<a class="var it4673" onMouseOver="hilite(4673)" onMouseOut="lolite()" onClick="logVariable('externalsettings')" href="../_variables/externalsettings.html">$externalsettings</a> as <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a> =&gt; <a class="var it1163" onMouseOver="hilite(1163)" onMouseOut="lolite()" onClick="logVariable('default')" href="../_variables/default.html">$default</a>) {
<a name="l1087"><span class="linenum">1087</span></a>  
<a name="l1088"><span class="linenum">1088</span></a>              <a class="var it4674" onMouseOver="hilite(4674)" onMouseOut="lolite()" onClick="logVariable('wsparamname')" href="../_variables/wsparamname.html">$wsparamname</a> = 'moodlewssetting' . <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>;
<a name="l1089"><span class="linenum">1089</span></a>  
<a name="l1090"><span class="linenum">1090</span></a>  <span class="comment">            // Retrieve and remove the setting parameter from the request.</span>
<a name="l1091"><span class="linenum">1091</span></a>              <a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../_variables/value.html">$value</a> = <a class="function" onClick="logFunction('optional_param')" href="../_functions/optional_param.html" onMouseOver="funcPopup(event,'optional_param')">optional_param</a>(<a class="var it4674" onMouseOver="hilite(4674)" onMouseOut="lolite()" onClick="logVariable('wsparamname')" href="../_variables/wsparamname.html">$wsparamname</a>, <a class="var it1163" onMouseOver="hilite(1163)" onMouseOut="lolite()" onClick="logVariable('default')" href="../_variables/default.html">$default</a>, <a class="constant" onClick="logConstant('PARAM_BOOL')" href="../_constants/PARAM_BOOL.html" onMouseOver="constPopup(event,'PARAM_BOOL')">PARAM_BOOL</a>);
<a name="l1092"><span class="linenum">1092</span></a>              unset(<a class="var it76" onMouseOver="hilite(76)" onMouseOut="lolite()" onClick="logVariable('_GET')" href="../_variables/_GET.html">$_GET</a>[<a class="var it4674" onMouseOver="hilite(4674)" onMouseOut="lolite()" onClick="logVariable('wsparamname')" href="../_variables/wsparamname.html">$wsparamname</a>]);
<a name="l1093"><span class="linenum">1093</span></a>              unset(<a class="var it2053" onMouseOver="hilite(2053)" onMouseOut="lolite()" onClick="logVariable('_POST')" href="../_variables/_POST.html">$_POST</a>[<a class="var it4674" onMouseOver="hilite(4674)" onMouseOut="lolite()" onClick="logVariable('wsparamname')" href="../_variables/wsparamname.html">$wsparamname</a>]);
<a name="l1094"><span class="linenum">1094</span></a>  
<a name="l1095"><span class="linenum">1095</span></a>              <a class="var it4661" onMouseOver="hilite(4661)" onMouseOut="lolite()" onClick="logVariable('functioname')" href="../_variables/functioname.html">$functioname</a> = 'set_' . <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>;
<a name="l1096"><span class="linenum">1096</span></a>              <a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../_variables/settings.html">$settings</a>-&gt;<a class="var it4661" onMouseOver="hilite(4661)" onMouseOut="lolite()" onClick="logVariable('functioname')" href="../_variables/functioname.html">$functioname</a>(<a class="var it35" onMouseOver="hilite(35)" onMouseOut="lolite()" onClick="logVariable('value')" href="../_variables/value.html">$value</a>);
<a name="l1097"><span class="linenum">1097</span></a>          }
<a name="l1098"><span class="linenum">1098</span></a>  
<a name="l1099"><span class="linenum">1099</span></a>      }
<a name="l1100"><span class="linenum">1100</span></a>  }
<a name="l1101"><span class="linenum">1101</span></a>  
<a name="l1102"><span class="linenum">1102</span></a>  <span class="comment">/**</span>
<a name="l1103"><span class="linenum">1103</span></a>  <span class="comment"> * Special abstraction of our services that allows interaction with stock Zend ws servers.</span>
<a name="l1104"><span class="linenum">1104</span></a>  <span class="comment"> *</span>
<a name="l1105"><span class="linenum">1105</span></a>  <span class="comment"> * @package    core_webservice</span>
<a name="l1106"><span class="linenum">1106</span></a>  <span class="comment"> * @copyright  2009 Jerome Mouneyrac &lt;jerome@moodle.com&gt;</span>
<a name="l1107"><span class="linenum">1107</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l1108"><span class="linenum">1108</span></a>  <span class="comment"> */</span>
<a name="l1109"><span class="linenum">1109</span></a>  abstract class webservice_zend_server extends webservice_server {
<a name="l1110"><span class="linenum">1110</span></a>  
<a name="l1111"><span class="linenum">1111</span></a>  <span class="comment">    /** @var string Name of the zend server class : Zend_Amf_Server, moodle_zend_soap_server, Zend_Soap_AutoDiscover, ...*/</span>
<a name="l1112"><span class="linenum">1112</span></a>      protected <a class="var it4675" onMouseOver="hilite(4675)" onMouseOut="lolite()" onClick="logVariable('zend_class')" href="../_variables/zend_class.html">$zend_class</a>;
<a name="l1113"><span class="linenum">1113</span></a>  
<a name="l1114"><span class="linenum">1114</span></a>  <span class="comment">    /** @var stdClass Zend server instance */</span>
<a name="l1115"><span class="linenum">1115</span></a>      protected <a class="var it4676" onMouseOver="hilite(4676)" onMouseOut="lolite()" onClick="logVariable('zend_server')" href="../_variables/zend_server.html">$zend_server</a>;
<a name="l1116"><span class="linenum">1116</span></a>  
<a name="l1117"><span class="linenum">1117</span></a>  <span class="comment">    /** @var string Virtual web service class with all functions user name execute, created on the fly */</span>
<a name="l1118"><span class="linenum">1118</span></a>      protected <a class="var it4677" onMouseOver="hilite(4677)" onMouseOut="lolite()" onClick="logVariable('service_class')" href="../_variables/service_class.html">$service_class</a>;
<a name="l1119"><span class="linenum">1119</span></a>  
<a name="l1120"><span class="linenum">1120</span></a>      <span class="comment">/**</span>
<a name="l1121"><span class="linenum">1121</span></a>  <span class="comment">     * Constructor</span>
<a name="l1122"><span class="linenum">1122</span></a>  <span class="comment">     *</span>
<a name="l1123"><span class="linenum">1123</span></a>  <span class="comment">     * @param int $authmethod authentication method - one of WEBSERVICE_AUTHMETHOD_*</span>
<a name="l1124"><span class="linenum">1124</span></a>  <span class="comment">     * @param string $zend_class Name of the zend server class</span>
<a name="l1125"><span class="linenum">1125</span></a>  <span class="comment">     */</span>
<a name="l1126"><span class="linenum">1126</span></a>      public function <a class="function" onClick="logFunction('__construct')" href="../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>(<a class="var it4670" onMouseOver="hilite(4670)" onMouseOut="lolite()" onClick="logVariable('authmethod')" href="../_variables/authmethod.html">$authmethod</a>, <a class="var it4675" onMouseOver="hilite(4675)" onMouseOut="lolite()" onClick="logVariable('zend_class')" href="../_variables/zend_class.html">$zend_class</a>) {
<a name="l1127"><span class="linenum">1127</span></a>          parent::<a class="function" onClick="logFunction('__construct')" href="../_functions/__construct.html" onMouseOver="funcPopup(event,'__construct')">__construct</a>(<a class="var it4670" onMouseOver="hilite(4670)" onMouseOut="lolite()" onClick="logVariable('authmethod')" href="../_variables/authmethod.html">$authmethod</a>);
<a name="l1128"><span class="linenum">1128</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('zend_class')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/zend_class.html">zend_class</a> = <a class="var it4675" onMouseOver="hilite(4675)" onMouseOut="lolite()" onClick="logVariable('zend_class')" href="../_variables/zend_class.html">$zend_class</a>;
<a name="l1129"><span class="linenum">1129</span></a>      }
<a name="l1130"><span class="linenum">1130</span></a>  
<a name="l1131"><span class="linenum">1131</span></a>      <span class="comment">/**</span>
<a name="l1132"><span class="linenum">1132</span></a>  <span class="comment">     * Process request from client.</span>
<a name="l1133"><span class="linenum">1133</span></a>  <span class="comment">     *</span>
<a name="l1134"><span class="linenum">1134</span></a>  <span class="comment">     * @uses die</span>
<a name="l1135"><span class="linenum">1135</span></a>  <span class="comment">     */</span>
<a name="l1136"><span class="linenum">1136</span></a>      public function <a class="function" onClick="logFunction('run')" href="../_functions/run.html" onMouseOver="funcPopup(event,'run')">run</a>() {
<a name="l1137"><span class="linenum">1137</span></a>  <span class="comment">        // we will probably need a lot of memory in some functions</span>
<a name="l1138"><span class="linenum">1138</span></a>          <a class="function" onClick="logFunction('raise_memory_limit')" href="../_functions/raise_memory_limit.html" onMouseOver="funcPopup(event,'raise_memory_limit')">raise_memory_limit</a>(<a class="constant" onClick="logConstant('MEMORY_EXTRA')" href="../_constants/MEMORY_EXTRA.html" onMouseOver="constPopup(event,'MEMORY_EXTRA')">MEMORY_EXTRA</a>);
<a name="l1139"><span class="linenum">1139</span></a>  
<a name="l1140"><span class="linenum">1140</span></a>  <span class="comment">        // set some longer timeout, this script is not sending any output,</span>
<a name="l1141"><span class="linenum">1141</span></a>  <span class="comment">        // this means we need to manually extend the timeout operations</span>
<a name="l1142"><span class="linenum">1142</span></a>  <span class="comment">        // that need longer time to finish</span>
<a name="l1143"><span class="linenum">1143</span></a>          <a class="class" onClick="logClass('external_api')" href="../_classes/external_api.html" onMouseOver="classPopup(event,'external_api')">external_api</a>::<a class="function" onClick="logFunction('set_timeout')" href="../_functions/set_timeout.html" onMouseOver="funcPopup(event,'set_timeout')">set_timeout</a>();
<a name="l1144"><span class="linenum">1144</span></a>  
<a name="l1145"><span class="linenum">1145</span></a>  <span class="comment">        // now create the instance of zend server</span>
<a name="l1146"><span class="linenum">1146</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('init_zend_server')" href="../_functions/init_zend_server.html" onMouseOver="funcPopup(event,'init_zend_server')">init_zend_server</a>();
<a name="l1147"><span class="linenum">1147</span></a>  
<a name="l1148"><span class="linenum">1148</span></a>  <span class="comment">        // set up exception handler first, we want to sent them back in correct format that</span>
<a name="l1149"><span class="linenum">1149</span></a>  <span class="comment">        // the other system understands</span>
<a name="l1150"><span class="linenum">1150</span></a>  <span class="comment">        // we do not need to call the original default handler because this ws handler does everything</span>
<a name="l1151"><span class="linenum">1151</span></a>          <a class="phpfunction" onClick="logFunction('set_exception_handler')" href="../_functions/set_exception_handler.html" onMouseOver="phpfuncPopup(event,'set_exception_handler')">set_exception_handler</a>(array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>, 'exception_handler'));
<a name="l1152"><span class="linenum">1152</span></a>  
<a name="l1153"><span class="linenum">1153</span></a>  <span class="comment">        // init all properties from the request data</span>
<a name="l1154"><span class="linenum">1154</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('parse_request')" href="../_functions/parse_request.html" onMouseOver="funcPopup(event,'parse_request')">parse_request</a>();
<a name="l1155"><span class="linenum">1155</span></a>  
<a name="l1156"><span class="linenum">1156</span></a>  <span class="comment">        // this sets up $USER and $SESSION and context restrictions</span>
<a name="l1157"><span class="linenum">1157</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('authenticate_user')" href="../_functions/authenticate_user.html" onMouseOver="funcPopup(event,'authenticate_user')">authenticate_user</a>();
<a name="l1158"><span class="linenum">1158</span></a>  
<a name="l1159"><span class="linenum">1159</span></a>  <span class="comment">        // make a list of all functions user is allowed to excecute</span>
<a name="l1160"><span class="linenum">1160</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('init_service_class')" href="../_functions/init_service_class.html" onMouseOver="funcPopup(event,'init_service_class')">init_service_class</a>();
<a name="l1161"><span class="linenum">1161</span></a>  
<a name="l1162"><span class="linenum">1162</span></a>  <span class="comment">        // tell server what functions are available</span>
<a name="l1163"><span class="linenum">1163</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('zend_server')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/zend_server.html">zend_server</a>-&gt;<a class="function" onClick="logFunction('setClass')" href="../_functions/setclass.html" onMouseOver="funcPopup(event,'setclass')">setClass</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('service_class')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/service_class.html">service_class</a>);
<a name="l1164"><span class="linenum">1164</span></a>  
<a name="l1165"><span class="linenum">1165</span></a>  <span class="comment">        // Log the web service request.</span>
<a name="l1166"><span class="linenum">1166</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array(
<a name="l1167"><span class="linenum">1167</span></a>              'other' =&gt; array(
<a name="l1168"><span class="linenum">1168</span></a>                  'function' =&gt; 'unknown'
<a name="l1169"><span class="linenum">1169</span></a>              )
<a name="l1170"><span class="linenum">1170</span></a>          );
<a name="l1171"><span class="linenum">1171</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_function_called')" href="../_classes/webservice_function_called.html" onMouseOver="classPopup(event,'webservice_function_called')">webservice_function_called</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l1172"><span class="linenum">1172</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, 'webservice', '', '', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('zend_class')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/zend_class.html">zend_class</a>.' '.<a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>(), 0, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>));
<a name="l1173"><span class="linenum">1173</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1174"><span class="linenum">1174</span></a>  
<a name="l1175"><span class="linenum">1175</span></a>  <span class="comment">        //send headers</span>
<a name="l1176"><span class="linenum">1176</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('send_headers')" href="../_functions/send_headers.html" onMouseOver="funcPopup(event,'send_headers')">send_headers</a>();
<a name="l1177"><span class="linenum">1177</span></a>  
<a name="l1178"><span class="linenum">1178</span></a>  <span class="comment">        // execute and return response, this sends some headers too</span>
<a name="l1179"><span class="linenum">1179</span></a>          <a class="var it47" onMouseOver="hilite(47)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('zend_server')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/zend_server.html">zend_server</a>-&gt;<a class="function" onClick="logFunction('handle')" href="../_functions/handle.html" onMouseOver="funcPopup(event,'handle')">handle</a>();
<a name="l1180"><span class="linenum">1180</span></a>  
<a name="l1181"><span class="linenum">1181</span></a>  <span class="comment">        // session cleanup</span>
<a name="l1182"><span class="linenum">1182</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('session_cleanup')" href="../_functions/session_cleanup.html" onMouseOver="funcPopup(event,'session_cleanup')">session_cleanup</a>();
<a name="l1183"><span class="linenum">1183</span></a>  
<a name="l1184"><span class="linenum">1184</span></a>  <span class="comment">        //finally send the result</span>
<a name="l1185"><span class="linenum">1185</span></a>          echo <a class="var it47" onMouseOver="hilite(47)" onMouseOut="lolite()" onClick="logVariable('response')" href="../_variables/response.html">$response</a>;
<a name="l1186"><span class="linenum">1186</span></a>          die;
<a name="l1187"><span class="linenum">1187</span></a>      }
<a name="l1188"><span class="linenum">1188</span></a>  
<a name="l1189"><span class="linenum">1189</span></a>      <span class="comment">/**</span>
<a name="l1190"><span class="linenum">1190</span></a>  <span class="comment">     * Load virtual class needed for Zend api</span>
<a name="l1191"><span class="linenum">1191</span></a>  <span class="comment">     */</span>
<a name="l1192"><span class="linenum">1192</span></a>      protected function <a class="function" onClick="logFunction('init_service_class')" href="../_functions/init_service_class.html" onMouseOver="funcPopup(event,'init_service_class')">init_service_class</a>() {
<a name="l1193"><span class="linenum">1193</span></a>          global <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>;
<a name="l1194"><span class="linenum">1194</span></a>  
<a name="l1195"><span class="linenum">1195</span></a>  <span class="comment">        // first ofall get a complete list of services user is allowed to access</span>
<a name="l1196"><span class="linenum">1196</span></a>  
<a name="l1197"><span class="linenum">1197</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_serviceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/restricted_serviceid.html">restricted_serviceid</a>) {
<a name="l1198"><span class="linenum">1198</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array('sid1'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_serviceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/restricted_serviceid.html">restricted_serviceid</a>, 'sid2'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_serviceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/restricted_serviceid.html">restricted_serviceid</a>);
<a name="l1199"><span class="linenum">1199</span></a>              <a class="var it4678" onMouseOver="hilite(4678)" onMouseOut="lolite()" onClick="logVariable('wscond1')" href="../_variables/wscond1.html">$wscond1</a> = 'AND s.id = :sid1';
<a name="l1200"><span class="linenum">1200</span></a>              <a class="var it4679" onMouseOver="hilite(4679)" onMouseOut="lolite()" onClick="logVariable('wscond2')" href="../_variables/wscond2.html">$wscond2</a> = 'AND s.id = :sid2';
<a name="l1201"><span class="linenum">1201</span></a>          } else {
<a name="l1202"><span class="linenum">1202</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array();
<a name="l1203"><span class="linenum">1203</span></a>              <a class="var it4678" onMouseOver="hilite(4678)" onMouseOut="lolite()" onClick="logVariable('wscond1')" href="../_variables/wscond1.html">$wscond1</a> = '';
<a name="l1204"><span class="linenum">1204</span></a>              <a class="var it4679" onMouseOver="hilite(4679)" onMouseOut="lolite()" onClick="logVariable('wscond2')" href="../_variables/wscond2.html">$wscond2</a> = '';
<a name="l1205"><span class="linenum">1205</span></a>          }
<a name="l1206"><span class="linenum">1206</span></a>  
<a name="l1207"><span class="linenum">1207</span></a>  <span class="comment">        // now make sure the function is listed in at least one service user is allowed to use</span>
<a name="l1208"><span class="linenum">1208</span></a>  <span class="comment">        // allow access only if:</span>
<a name="l1209"><span class="linenum">1209</span></a>  <span class="comment">        //  1/ entry in the external_services_users table if required</span>
<a name="l1210"><span class="linenum">1210</span></a>  <span class="comment">        //  2/ validuntil not reached</span>
<a name="l1211"><span class="linenum">1211</span></a>  <span class="comment">        //  3/ has capability if specified in service desc</span>
<a name="l1212"><span class="linenum">1212</span></a>  <span class="comment">        //  4/ iprestriction</span>
<a name="l1213"><span class="linenum">1213</span></a>  
<a name="l1214"><span class="linenum">1214</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT s.*, NULL AS iprestriction
<a name="l1215"><span class="linenum">1215</span></a>                    FROM {external_services} s
<a name="l1216"><span class="linenum">1216</span></a>                    JOIN {external_services_functions} sf <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (sf.externalserviceid = s.id AND s.restrictedusers = 0)
<a name="l1217"><span class="linenum">1217</span></a>                   WHERE s.enabled = 1 <a class="var it4678" onMouseOver="hilite(4678)" onMouseOut="lolite()" onClick="logVariable('wscond1')" href="../_variables/wscond1.html">$wscond1</a>
<a name="l1218"><span class="linenum">1218</span></a>  
<a name="l1219"><span class="linenum">1219</span></a>                   UNION
<a name="l1220"><span class="linenum">1220</span></a>  
<a name="l1221"><span class="linenum">1221</span></a>                  SELECT s.*, su.iprestriction
<a name="l1222"><span class="linenum">1222</span></a>                    FROM {external_services} s
<a name="l1223"><span class="linenum">1223</span></a>                    JOIN {external_services_functions} sf <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (sf.externalserviceid = s.id AND s.restrictedusers = 1)
<a name="l1224"><span class="linenum">1224</span></a>                    JOIN {external_services_users} su <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (su.externalserviceid = s.id AND su.userid = :userid)
<a name="l1225"><span class="linenum">1225</span></a>                   WHERE s.enabled = 1 AND (su.validuntil IS NULL OR su.validuntil &lt; :now) <a class="var it4679" onMouseOver="hilite(4679)" onMouseOut="lolite()" onClick="logVariable('wscond2')" href="../_variables/wscond2.html">$wscond2</a>&quot;;
<a name="l1226"><span class="linenum">1226</span></a>  
<a name="l1227"><span class="linenum">1227</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, array('userid'=&gt;<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'now'=&gt;<a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()));
<a name="l1228"><span class="linenum">1228</span></a>  
<a name="l1229"><span class="linenum">1229</span></a>          <a class="var it4649" onMouseOver="hilite(4649)" onMouseOut="lolite()" onClick="logVariable('serviceids')" href="../_variables/serviceids.html">$serviceids</a> = array();
<a name="l1230"><span class="linenum">1230</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l1231"><span class="linenum">1231</span></a>  
<a name="l1232"><span class="linenum">1232</span></a>  <span class="comment">        // now make sure user may access at least one service</span>
<a name="l1233"><span class="linenum">1233</span></a>          <a class="var it4680" onMouseOver="hilite(4680)" onMouseOut="lolite()" onClick="logVariable('remoteaddr')" href="../_variables/remoteaddr.html">$remoteaddr</a> = <a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>();
<a name="l1234"><span class="linenum">1234</span></a>          <a class="var it2730" onMouseOver="hilite(2730)" onMouseOut="lolite()" onClick="logVariable('allowed')" href="../_variables/allowed.html">$allowed</a> = false;
<a name="l1235"><span class="linenum">1235</span></a>          foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> as <a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>) {
<a name="l1236"><span class="linenum">1236</span></a>              if (isset(<a class="var it4649" onMouseOver="hilite(4649)" onMouseOut="lolite()" onClick="logVariable('serviceids')" href="../_variables/serviceids.html">$serviceids</a>[<a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('id')" class="var it40434" onMouseOver="hilite(40434)" onMouseOut="lolite()" href="../_variables/id.html">id</a>])) {
<a name="l1237"><span class="linenum">1237</span></a>                  continue;
<a name="l1238"><span class="linenum">1238</span></a>              }
<a name="l1239"><span class="linenum">1239</span></a>              if (<a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('requiredcapability')" class="var it40434" onMouseOver="hilite(40434)" onMouseOut="lolite()" href="../_variables/requiredcapability.html">requiredcapability</a> and !<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(<a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('requiredcapability')" class="var it40434" onMouseOver="hilite(40434)" onMouseOut="lolite()" href="../_variables/requiredcapability.html">requiredcapability</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_context')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/restricted_context.html">restricted_context</a>)) {
<a name="l1240"><span class="linenum">1240</span></a>                  continue; <span class="comment">// cap required, sorry</span>
<a name="l1241"><span class="linenum">1241</span></a>              }
<a name="l1242"><span class="linenum">1242</span></a>              if (<a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it40434" onMouseOver="hilite(40434)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a> and !<a class="function" onClick="logFunction('address_in_subnet')" href="../_functions/address_in_subnet.html" onMouseOver="funcPopup(event,'address_in_subnet')">address_in_subnet</a>(<a class="var it4680" onMouseOver="hilite(4680)" onMouseOut="lolite()" onClick="logVariable('remoteaddr')" href="../_variables/remoteaddr.html">$remoteaddr</a>, <a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it40434" onMouseOver="hilite(40434)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a>)) {
<a name="l1243"><span class="linenum">1243</span></a>                  continue; <span class="comment">// wrong request source ip, sorry</span>
<a name="l1244"><span class="linenum">1244</span></a>              }
<a name="l1245"><span class="linenum">1245</span></a>              <a class="var it4649" onMouseOver="hilite(4649)" onMouseOut="lolite()" onClick="logVariable('serviceids')" href="../_variables/serviceids.html">$serviceids</a>[<a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('id')" class="var it40434" onMouseOver="hilite(40434)" onMouseOut="lolite()" href="../_variables/id.html">id</a>] = <a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('id')" class="var it40434" onMouseOver="hilite(40434)" onMouseOut="lolite()" href="../_variables/id.html">id</a>;
<a name="l1246"><span class="linenum">1246</span></a>          }
<a name="l1247"><span class="linenum">1247</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l1248"><span class="linenum">1248</span></a>  
<a name="l1249"><span class="linenum">1249</span></a>  <span class="comment">        // now get the list of all functions</span>
<a name="l1250"><span class="linenum">1250</span></a>          <a class="var it4681" onMouseOver="hilite(4681)" onMouseOut="lolite()" onClick="logVariable('wsmanager')" href="../_variables/wsmanager.html">$wsmanager</a> = <span class="keyword">new </span><a class="class" onClick="logClass('webservice')" href="../_classes/webservice.html" onMouseOver="classPopup(event,'webservice')">webservice</a>();
<a name="l1251"><span class="linenum">1251</span></a>          <a class="var it3792" onMouseOver="hilite(3792)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a> = <a class="var it4681" onMouseOver="hilite(4681)" onMouseOut="lolite()" onClick="logVariable('wsmanager')" href="../_variables/wsmanager.html">$wsmanager</a>-&gt;<a class="function" onClick="logFunction('get_external_functions')" href="../_functions/get_external_functions.html" onMouseOver="funcPopup(event,'get_external_functions')">get_external_functions</a>(<a class="var it4649" onMouseOver="hilite(4649)" onMouseOut="lolite()" onClick="logVariable('serviceids')" href="../_variables/serviceids.html">$serviceids</a>);
<a name="l1252"><span class="linenum">1252</span></a>  
<a name="l1253"><span class="linenum">1253</span></a>  <span class="comment">        // now make the virtual WS class with all the fuctions for this particular user</span>
<a name="l1254"><span class="linenum">1254</span></a>          <a class="var it3198" onMouseOver="hilite(3198)" onMouseOut="lolite()" onClick="logVariable('methods')" href="../_variables/methods.html">$methods</a> = '';
<a name="l1255"><span class="linenum">1255</span></a>          foreach (<a class="var it3792" onMouseOver="hilite(3792)" onMouseOut="lolite()" onClick="logVariable('functions')" href="../_variables/functions.html">$functions</a> as <a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>) {
<a name="l1256"><span class="linenum">1256</span></a>              <a class="var it3198" onMouseOver="hilite(3198)" onMouseOut="lolite()" onClick="logVariable('methods')" href="../_variables/methods.html">$methods</a> .= <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_virtual_method_code')" href="../_functions/get_virtual_method_code.html" onMouseOver="funcPopup(event,'get_virtual_method_code')">get_virtual_method_code</a>(<a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>);
<a name="l1257"><span class="linenum">1257</span></a>          }
<a name="l1258"><span class="linenum">1258</span></a>  
<a name="l1259"><span class="linenum">1259</span></a>  <span class="comment">        // let's use unique class name, there might be problem in unit tests</span>
<a name="l1260"><span class="linenum">1260</span></a>          <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a> = 'webservices_virtual_class_000000';
<a name="l1261"><span class="linenum">1261</span></a>          while(<a class="phpfunction" onClick="logFunction('class_exists')" href="../_functions/class_exists.html" onMouseOver="phpfuncPopup(event,'class_exists')">class_exists</a>(<a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a>)) {
<a name="l1262"><span class="linenum">1262</span></a>              <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a>++;
<a name="l1263"><span class="linenum">1263</span></a>          }
<a name="l1264"><span class="linenum">1264</span></a>  
<a name="l1265"><span class="linenum">1265</span></a>          <a class="var it2562" onMouseOver="hilite(2562)" onMouseOut="lolite()" onClick="logVariable('code')" href="../_variables/code.html">$code</a> = '
<a name="l1266"><span class="linenum">1266</span></a>  <span class="comment">/**</span>
<a name="l1267"><span class="linenum">1267</span></a>  <span class="comment"> * Virtual class web services for user id '.$USER-&gt;id.' in context '.$this-&gt;restricted_context-&gt;id.'.</span>
<a name="l1268"><span class="linenum">1268</span></a>  <span class="comment"> */</span>
<a name="l1269"><span class="linenum">1269</span></a>  class '.<a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a>.' {
<a name="l1270"><span class="linenum">1270</span></a>  '.<a class="var it3198" onMouseOver="hilite(3198)" onMouseOut="lolite()" onClick="logVariable('methods')" href="../_variables/methods.html">$methods</a>.'
<a name="l1271"><span class="linenum">1271</span></a>  }
<a name="l1272"><span class="linenum">1272</span></a>  ';
<a name="l1273"><span class="linenum">1273</span></a>  
<a name="l1274"><span class="linenum">1274</span></a>  <span class="comment">        // load the virtual class definition into memory</span>
<a name="l1275"><span class="linenum">1275</span></a>          eval(<a class="var it2562" onMouseOver="hilite(2562)" onMouseOut="lolite()" onClick="logVariable('code')" href="../_variables/code.html">$code</a>);
<a name="l1276"><span class="linenum">1276</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('service_class')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/service_class.html">service_class</a> = <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a>;
<a name="l1277"><span class="linenum">1277</span></a>      }
<a name="l1278"><span class="linenum">1278</span></a>  
<a name="l1279"><span class="linenum">1279</span></a>      <span class="comment">/**</span>
<a name="l1280"><span class="linenum">1280</span></a>  <span class="comment">     * returns virtual method code</span>
<a name="l1281"><span class="linenum">1281</span></a>  <span class="comment">     *</span>
<a name="l1282"><span class="linenum">1282</span></a>  <span class="comment">     * @param stdClass $function a record from external_function</span>
<a name="l1283"><span class="linenum">1283</span></a>  <span class="comment">     * @return string PHP code</span>
<a name="l1284"><span class="linenum">1284</span></a>  <span class="comment">     */</span>
<a name="l1285"><span class="linenum">1285</span></a>      protected function <a class="function" onClick="logFunction('get_virtual_method_code')" href="../_functions/get_virtual_method_code.html" onMouseOver="funcPopup(event,'get_virtual_method_code')">get_virtual_method_code</a>(<a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>) {
<a name="l1286"><span class="linenum">1286</span></a>          global <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l1287"><span class="linenum">1287</span></a>  
<a name="l1288"><span class="linenum">1288</span></a>          <a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a> = <a class="function" onClick="logFunction('external_function_info')" href="../_functions/external_function_info.html" onMouseOver="funcPopup(event,'external_function_info')">external_function_info</a>(<a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>);
<a name="l1289"><span class="linenum">1289</span></a>  
<a name="l1290"><span class="linenum">1290</span></a>  <span class="comment">        //arguments in function declaration line with defaults.</span>
<a name="l1291"><span class="linenum">1291</span></a>          <a class="var it4682" onMouseOver="hilite(4682)" onMouseOut="lolite()" onClick="logVariable('paramanddefaults')" href="../_variables/paramanddefaults.html">$paramanddefaults</a>      = array();
<a name="l1292"><span class="linenum">1292</span></a>  <span class="comment">        //arguments used as parameters for external lib call.</span>
<a name="l1293"><span class="linenum">1293</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>      = array();
<a name="l1294"><span class="linenum">1294</span></a>          <a class="var it4683" onMouseOver="hilite(4683)" onMouseOut="lolite()" onClick="logVariable('params_desc')" href="../_variables/params_desc.html">$params_desc</a> = array();
<a name="l1295"><span class="linenum">1295</span></a>          foreach (<a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('parameters_desc')" class="var it40435" onMouseOver="hilite(40435)" onMouseOut="lolite()" href="../_variables/parameters_desc.html">parameters_desc</a>-&gt;keys as <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>=&gt;<a class="var it4684" onMouseOver="hilite(4684)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>) {
<a name="l1296"><span class="linenum">1296</span></a>              <a class="var it396" onMouseOver="hilite(396)" onMouseOut="lolite()" onClick="logVariable('param')" href="../_variables/param.html">$param</a> = '$'.<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>;
<a name="l1297"><span class="linenum">1297</span></a>              <a class="var it4686" onMouseOver="hilite(4686)" onMouseOut="lolite()" onClick="logVariable('paramanddefault')" href="../_variables/paramanddefault.html">$paramanddefault</a> = <a class="var it396" onMouseOver="hilite(396)" onMouseOut="lolite()" onClick="logVariable('param')" href="../_variables/param.html">$param</a>;
<a name="l1298"><span class="linenum">1298</span></a>  <span class="comment">            //need to generate the default if there is any</span>
<a name="l1299"><span class="linenum">1299</span></a>              if (<a class="var it4684" onMouseOver="hilite(4684)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a> instanceof external_value) {
<a name="l1300"><span class="linenum">1300</span></a>                  if (<a class="var it4684" onMouseOver="hilite(4684)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('required')" class="var it40442" onMouseOver="hilite(40442)" onMouseOut="lolite()" href="../_variables/required.html">required</a> == <a class="constant" onClick="logConstant('VALUE_DEFAULT')" href="../_constants/VALUE_DEFAULT.html" onMouseOver="constPopup(event,'VALUE_DEFAULT')">VALUE_DEFAULT</a>) {
<a name="l1301"><span class="linenum">1301</span></a>                      if (<a class="var it4684" onMouseOver="hilite(4684)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('default')" class="var it40442" onMouseOver="hilite(40442)" onMouseOut="lolite()" href="../_variables/default.html">default</a>===null) {
<a name="l1302"><span class="linenum">1302</span></a>                          <a class="var it4686" onMouseOver="hilite(4686)" onMouseOut="lolite()" onClick="logVariable('paramanddefault')" href="../_variables/paramanddefault.html">$paramanddefault</a> .= '=null';
<a name="l1303"><span class="linenum">1303</span></a>                      } else {
<a name="l1304"><span class="linenum">1304</span></a>                          switch(<a class="var it4684" onMouseOver="hilite(4684)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('type')" class="var it40442" onMouseOver="hilite(40442)" onMouseOut="lolite()" href="../_variables/type.html">type</a>) {
<a name="l1305"><span class="linenum">1305</span></a>                              case <a class="constant" onClick="logConstant('PARAM_BOOL')" href="../_constants/PARAM_BOOL.html" onMouseOver="constPopup(event,'PARAM_BOOL')">PARAM_BOOL</a>:
<a name="l1306"><span class="linenum">1306</span></a>                                  <a class="var it4686" onMouseOver="hilite(4686)" onMouseOut="lolite()" onClick="logVariable('paramanddefault')" href="../_variables/paramanddefault.html">$paramanddefault</a> .= '='. (int) <a class="var it4684" onMouseOver="hilite(4684)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('default')" class="var it40442" onMouseOver="hilite(40442)" onMouseOut="lolite()" href="../_variables/default.html">default</a>; break;
<a name="l1307"><span class="linenum">1307</span></a>                              case <a class="constant" onClick="logConstant('PARAM_INT')" href="../_constants/PARAM_INT.html" onMouseOver="constPopup(event,'PARAM_INT')">PARAM_INT</a>:
<a name="l1308"><span class="linenum">1308</span></a>                                  <a class="var it4686" onMouseOver="hilite(4686)" onMouseOut="lolite()" onClick="logVariable('paramanddefault')" href="../_variables/paramanddefault.html">$paramanddefault</a> .= '='.<a class="var it4684" onMouseOver="hilite(4684)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('default')" class="var it40442" onMouseOver="hilite(40442)" onMouseOut="lolite()" href="../_variables/default.html">default</a>; break;
<a name="l1309"><span class="linenum">1309</span></a>                              case <a class="constant" onClick="logConstant('PARAM_FLOAT')" href="../_constants/PARAM_FLOAT.html" onMouseOver="constPopup(event,'PARAM_FLOAT')">PARAM_FLOAT</a>;
<a name="l1310"><span class="linenum">1310</span></a>                                  <a class="var it4686" onMouseOver="hilite(4686)" onMouseOut="lolite()" onClick="logVariable('paramanddefault')" href="../_variables/paramanddefault.html">$paramanddefault</a> .= '='.<a class="var it4684" onMouseOver="hilite(4684)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('default')" class="var it40442" onMouseOver="hilite(40442)" onMouseOut="lolite()" href="../_variables/default.html">default</a>; break;
<a name="l1311"><span class="linenum">1311</span></a>                              default:
<a name="l1312"><span class="linenum">1312</span></a>                                  <a class="var it4686" onMouseOver="hilite(4686)" onMouseOut="lolite()" onClick="logVariable('paramanddefault')" href="../_variables/paramanddefault.html">$paramanddefault</a> .= '=\''.<a class="var it4684" onMouseOver="hilite(4684)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('default')" class="var it40442" onMouseOver="hilite(40442)" onMouseOut="lolite()" href="../_variables/default.html">default</a>.'\'';
<a name="l1313"><span class="linenum">1313</span></a>                          }
<a name="l1314"><span class="linenum">1314</span></a>                      }
<a name="l1315"><span class="linenum">1315</span></a>                  } else if (<a class="var it4684" onMouseOver="hilite(4684)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('required')" class="var it40442" onMouseOver="hilite(40442)" onMouseOut="lolite()" href="../_variables/required.html">required</a> == <a class="constant" onClick="logConstant('VALUE_OPTIONAL')" href="../_constants/VALUE_OPTIONAL.html" onMouseOver="constPopup(event,'VALUE_OPTIONAL')">VALUE_OPTIONAL</a>) {
<a name="l1316"><span class="linenum">1316</span></a>  <span class="comment">                    // It does not make sense to declare a parameter VALUE_OPTIONAL.</span>
<a name="l1317"><span class="linenum">1317</span></a>  <span class="comment">                    // VALUE_OPTIONAL is used only for array/object key.</span>
<a name="l1318"><span class="linenum">1318</span></a>                      throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('erroroptionalparamarray', 'webservice', '', <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>);
<a name="l1319"><span class="linenum">1319</span></a>                  }
<a name="l1320"><span class="linenum">1320</span></a>              } else { //for the moment we do not support default for other structure types
<a name="l1321"><span class="linenum">1321</span></a>                   if (<a class="var it4684" onMouseOver="hilite(4684)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('required')" class="var it40442" onMouseOver="hilite(40442)" onMouseOut="lolite()" href="../_variables/required.html">required</a> == <a class="constant" onClick="logConstant('VALUE_DEFAULT')" href="../_constants/VALUE_DEFAULT.html" onMouseOver="constPopup(event,'VALUE_DEFAULT')">VALUE_DEFAULT</a>) {
<a name="l1322"><span class="linenum">1322</span></a>  <span class="comment">                     //accept empty array as default</span>
<a name="l1323"><span class="linenum">1323</span></a>                       if (isset(<a class="var it4684" onMouseOver="hilite(4684)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('default')" class="var it40442" onMouseOver="hilite(40442)" onMouseOut="lolite()" href="../_variables/default.html">default</a>) and <a class="phpfunction" onClick="logFunction('is_array')" href="../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it4684" onMouseOver="hilite(4684)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('default')" class="var it40442" onMouseOver="hilite(40442)" onMouseOut="lolite()" href="../_variables/default.html">default</a>)
<a name="l1324"><span class="linenum">1324</span></a>                               and empty(<a class="var it4684" onMouseOver="hilite(4684)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('default')" class="var it40442" onMouseOver="hilite(40442)" onMouseOut="lolite()" href="../_variables/default.html">default</a>)) {
<a name="l1325"><span class="linenum">1325</span></a>                           <a class="var it4686" onMouseOver="hilite(4686)" onMouseOut="lolite()" onClick="logVariable('paramanddefault')" href="../_variables/paramanddefault.html">$paramanddefault</a> .= '=array()';
<a name="l1326"><span class="linenum">1326</span></a>                       } else {
<a name="l1327"><span class="linenum">1327</span></a>                          throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('errornotemptydefaultparamarray', 'webservice', '', <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>);
<a name="l1328"><span class="linenum">1328</span></a>                       }
<a name="l1329"><span class="linenum">1329</span></a>                   }
<a name="l1330"><span class="linenum">1330</span></a>                   if (<a class="var it4684" onMouseOver="hilite(4684)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('required')" class="var it40442" onMouseOver="hilite(40442)" onMouseOut="lolite()" href="../_variables/required.html">required</a> == <a class="constant" onClick="logConstant('VALUE_OPTIONAL')" href="../_constants/VALUE_OPTIONAL.html" onMouseOver="constPopup(event,'VALUE_OPTIONAL')">VALUE_OPTIONAL</a>) {
<a name="l1331"><span class="linenum">1331</span></a>                       throw <span class="keyword">new </span><a class="class" onClick="logClass('moodle_exception')" href="../_classes/moodle_exception.html" onMouseOver="classPopup(event,'moodle_exception')">moodle_exception</a>('erroroptionalparamarray', 'webservice', '', <a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>);
<a name="l1332"><span class="linenum">1332</span></a>                   }
<a name="l1333"><span class="linenum">1333</span></a>              }
<a name="l1334"><span class="linenum">1334</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>[] = <a class="var it396" onMouseOver="hilite(396)" onMouseOut="lolite()" onClick="logVariable('param')" href="../_variables/param.html">$param</a>;
<a name="l1335"><span class="linenum">1335</span></a>              <a class="var it4682" onMouseOver="hilite(4682)" onMouseOut="lolite()" onClick="logVariable('paramanddefaults')" href="../_variables/paramanddefaults.html">$paramanddefaults</a>[] = <a class="var it4686" onMouseOver="hilite(4686)" onMouseOut="lolite()" onClick="logVariable('paramanddefault')" href="../_variables/paramanddefault.html">$paramanddefault</a>;
<a name="l1336"><span class="linenum">1336</span></a>              <a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_phpdoc_type')" href="../_functions/get_phpdoc_type.html" onMouseOver="funcPopup(event,'get_phpdoc_type')">get_phpdoc_type</a>(<a class="var it4684" onMouseOver="hilite(4684)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>);
<a name="l1337"><span class="linenum">1337</span></a>              <a class="var it4683" onMouseOver="hilite(4683)" onMouseOut="lolite()" onClick="logVariable('params_desc')" href="../_variables/params_desc.html">$params_desc</a>[] = '     * @param '.<a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>.' $'.<a class="var it5" onMouseOver="hilite(5)" onMouseOut="lolite()" onClick="logVariable('name')" href="../_variables/name.html">$name</a>.' '.<a class="var it4684" onMouseOver="hilite(4684)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('desc')" class="var it40442" onMouseOver="hilite(40442)" onMouseOut="lolite()" href="../_variables/desc.html">desc</a>;
<a name="l1338"><span class="linenum">1338</span></a>          }
<a name="l1339"><span class="linenum">1339</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>                = <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(', ', <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l1340"><span class="linenum">1340</span></a>          <a class="var it4682" onMouseOver="hilite(4682)" onMouseOut="lolite()" onClick="logVariable('paramanddefaults')" href="../_variables/paramanddefaults.html">$paramanddefaults</a>      = <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(', ', <a class="var it4682" onMouseOver="hilite(4682)" onMouseOut="lolite()" onClick="logVariable('paramanddefaults')" href="../_variables/paramanddefaults.html">$paramanddefaults</a>);
<a name="l1341"><span class="linenum">1341</span></a>          <a class="var it4683" onMouseOver="hilite(4683)" onMouseOut="lolite()" onClick="logVariable('params_desc')" href="../_variables/params_desc.html">$params_desc</a>           = <a class="phpfunction" onClick="logFunction('implode')" href="../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(&quot;\n&quot;, <a class="var it4683" onMouseOver="hilite(4683)" onMouseOut="lolite()" onClick="logVariable('params_desc')" href="../_variables/params_desc.html">$params_desc</a>);
<a name="l1342"><span class="linenum">1342</span></a>  
<a name="l1343"><span class="linenum">1343</span></a>          <a class="var it4687" onMouseOver="hilite(4687)" onMouseOut="lolite()" onClick="logVariable('serviceclassmethodbody')" href="../_variables/serviceclassmethodbody.html">$serviceclassmethodbody</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('service_class_method_body')" href="../_functions/service_class_method_body.html" onMouseOver="funcPopup(event,'service_class_method_body')">service_class_method_body</a>(<a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l1344"><span class="linenum">1344</span></a>  
<a name="l1345"><span class="linenum">1345</span></a>          if (<a class="phpfunction" onClick="logFunction('is_null')" href="../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('returns_desc')" class="var it40435" onMouseOver="hilite(40435)" onMouseOut="lolite()" href="../_variables/returns_desc.html">returns_desc</a>)) {
<a name="l1346"><span class="linenum">1346</span></a>              <a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../_variables/return.html">$return</a> = '     * @return void';
<a name="l1347"><span class="linenum">1347</span></a>          } else {
<a name="l1348"><span class="linenum">1348</span></a>              <a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_phpdoc_type')" href="../_functions/get_phpdoc_type.html" onMouseOver="funcPopup(event,'get_phpdoc_type')">get_phpdoc_type</a>(<a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('returns_desc')" class="var it40435" onMouseOver="hilite(40435)" onMouseOut="lolite()" href="../_variables/returns_desc.html">returns_desc</a>);
<a name="l1349"><span class="linenum">1349</span></a>              <a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('return')" href="../_variables/return.html">$return</a> = '     * @return '.<a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>.' '.<a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('returns_desc')" class="var it40435" onMouseOver="hilite(40435)" onMouseOut="lolite()" href="../_variables/returns_desc.html">returns_desc</a>-&gt;desc;
<a name="l1350"><span class="linenum">1350</span></a>          }
<a name="l1351"><span class="linenum">1351</span></a>  
<a name="l1352"><span class="linenum">1352</span></a>  <span class="comment">        // now crate the virtual method that calls the ext implementation</span>
<a name="l1353"><span class="linenum">1353</span></a>  
<a name="l1354"><span class="linenum">1354</span></a>          <a class="var it2562" onMouseOver="hilite(2562)" onMouseOut="lolite()" onClick="logVariable('code')" href="../_variables/code.html">$code</a> = '
<a name="l1355"><span class="linenum">1355</span></a>      <span class="comment">/**</span>
<a name="l1356"><span class="linenum">1356</span></a>  <span class="comment">     * '.$function-&gt;description.'</span>
<a name="l1357"><span class="linenum">1357</span></a>  <span class="comment">     *</span>
<a name="l1358"><span class="linenum">1358</span></a>  <span class="comment">'.$params_desc.'</span>
<a name="l1359"><span class="linenum">1359</span></a>  <span class="comment">'.$return.'</span>
<a name="l1360"><span class="linenum">1360</span></a>  <span class="comment">     */</span>
<a name="l1361"><span class="linenum">1361</span></a>      public function '.<a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('name')" class="var it40435" onMouseOver="hilite(40435)" onMouseOut="lolite()" href="../_variables/name.html">name</a>.'('.<a class="var it4682" onMouseOver="hilite(4682)" onMouseOut="lolite()" onClick="logVariable('paramanddefaults')" href="../_variables/paramanddefaults.html">$paramanddefaults</a>.') {
<a name="l1362"><span class="linenum">1362</span></a>  '.<a class="var it4687" onMouseOver="hilite(4687)" onMouseOut="lolite()" onClick="logVariable('serviceclassmethodbody')" href="../_variables/serviceclassmethodbody.html">$serviceclassmethodbody</a>.'
<a name="l1363"><span class="linenum">1363</span></a>      }
<a name="l1364"><span class="linenum">1364</span></a>  ';
<a name="l1365"><span class="linenum">1365</span></a>          return <a class="var it2562" onMouseOver="hilite(2562)" onMouseOut="lolite()" onClick="logVariable('code')" href="../_variables/code.html">$code</a>;
<a name="l1366"><span class="linenum">1366</span></a>      }
<a name="l1367"><span class="linenum">1367</span></a>  
<a name="l1368"><span class="linenum">1368</span></a>      <span class="comment">/**</span>
<a name="l1369"><span class="linenum">1369</span></a>  <span class="comment">     * Get the phpdoc type for an external_description</span>
<a name="l1370"><span class="linenum">1370</span></a>  <span class="comment">     * external_value =&gt; int, double or string</span>
<a name="l1371"><span class="linenum">1371</span></a>  <span class="comment">     * external_single_structure =&gt; object|struct, on-fly generated stdClass name, ...</span>
<a name="l1372"><span class="linenum">1372</span></a>  <span class="comment">     * external_multiple_structure =&gt; array</span>
<a name="l1373"><span class="linenum">1373</span></a>  <span class="comment">     *</span>
<a name="l1374"><span class="linenum">1374</span></a>  <span class="comment">     * @param string $keydesc any of PARAM_*</span>
<a name="l1375"><span class="linenum">1375</span></a>  <span class="comment">     * @return string phpdoc type (string, double, int, array...)</span>
<a name="l1376"><span class="linenum">1376</span></a>  <span class="comment">     */</span>
<a name="l1377"><span class="linenum">1377</span></a>      protected function <a class="function" onClick="logFunction('get_phpdoc_type')" href="../_functions/get_phpdoc_type.html" onMouseOver="funcPopup(event,'get_phpdoc_type')">get_phpdoc_type</a>(<a class="var it4684" onMouseOver="hilite(4684)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>) {
<a name="l1378"><span class="linenum">1378</span></a>          if (<a class="var it4684" onMouseOver="hilite(4684)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a> instanceof external_value) {
<a name="l1379"><span class="linenum">1379</span></a>              switch(<a class="var it4684" onMouseOver="hilite(4684)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>-&gt;<a onClick="logVariable('type')" class="var it40442" onMouseOver="hilite(40442)" onMouseOut="lolite()" href="../_variables/type.html">type</a>) {
<a name="l1380"><span class="linenum">1380</span></a>                  case <a class="constant" onClick="logConstant('PARAM_BOOL')" href="../_constants/PARAM_BOOL.html" onMouseOver="constPopup(event,'PARAM_BOOL')">PARAM_BOOL</a>: // 0 or 1 only for now
<a name="l1381"><span class="linenum">1381</span></a>                  case <a class="constant" onClick="logConstant('PARAM_INT')" href="../_constants/PARAM_INT.html" onMouseOver="constPopup(event,'PARAM_INT')">PARAM_INT</a>:
<a name="l1382"><span class="linenum">1382</span></a>                      <a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> = 'int'; break;
<a name="l1383"><span class="linenum">1383</span></a>                  case <a class="constant" onClick="logConstant('PARAM_FLOAT')" href="../_constants/PARAM_FLOAT.html" onMouseOver="constPopup(event,'PARAM_FLOAT')">PARAM_FLOAT</a>;
<a name="l1384"><span class="linenum">1384</span></a>                      <a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> = 'double'; break;
<a name="l1385"><span class="linenum">1385</span></a>                  default:
<a name="l1386"><span class="linenum">1386</span></a>                      <a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> = 'string';
<a name="l1387"><span class="linenum">1387</span></a>              }
<a name="l1388"><span class="linenum">1388</span></a>  
<a name="l1389"><span class="linenum">1389</span></a>          } else if (<a class="var it4684" onMouseOver="hilite(4684)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a> instanceof external_single_structure) {
<a name="l1390"><span class="linenum">1390</span></a>              <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a> = <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('generate_simple_struct_class')" href="../_functions/generate_simple_struct_class.html" onMouseOver="funcPopup(event,'generate_simple_struct_class')">generate_simple_struct_class</a>(<a class="var it4684" onMouseOver="hilite(4684)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a>);
<a name="l1391"><span class="linenum">1391</span></a>              <a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> = <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../_variables/classname.html">$classname</a>;
<a name="l1392"><span class="linenum">1392</span></a>  
<a name="l1393"><span class="linenum">1393</span></a>          } else if (<a class="var it4684" onMouseOver="hilite(4684)" onMouseOut="lolite()" onClick="logVariable('keydesc')" href="../_variables/keydesc.html">$keydesc</a> instanceof external_multiple_structure) {
<a name="l1394"><span class="linenum">1394</span></a>              <a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a> = 'array';
<a name="l1395"><span class="linenum">1395</span></a>          }
<a name="l1396"><span class="linenum">1396</span></a>  
<a name="l1397"><span class="linenum">1397</span></a>          return <a class="var it494" onMouseOver="hilite(494)" onMouseOut="lolite()" onClick="logVariable('type')" href="../_variables/type.html">$type</a>;
<a name="l1398"><span class="linenum">1398</span></a>      }
<a name="l1399"><span class="linenum">1399</span></a>  
<a name="l1400"><span class="linenum">1400</span></a>      <span class="comment">/**</span>
<a name="l1401"><span class="linenum">1401</span></a>  <span class="comment">     * Generate 'struct'/'object' type name</span>
<a name="l1402"><span class="linenum">1402</span></a>  <span class="comment">     * Some servers (our Zend ones) parse the phpdoc to know the parameter types.</span>
<a name="l1403"><span class="linenum">1403</span></a>  <span class="comment">     * The purpose to this function is to be overwritten when the common object|struct type are not understood by the server.</span>
<a name="l1404"><span class="linenum">1404</span></a>  <span class="comment">     * See webservice/soap/locallib.php - the SOAP server requires detailed structure)</span>
<a name="l1405"><span class="linenum">1405</span></a>  <span class="comment">     *</span>
<a name="l1406"><span class="linenum">1406</span></a>  <span class="comment">     * @param external_single_structure $structdesc the structure for which we generate the phpdoc type</span>
<a name="l1407"><span class="linenum">1407</span></a>  <span class="comment">     * @return string the phpdoc type</span>
<a name="l1408"><span class="linenum">1408</span></a>  <span class="comment">     */</span>
<a name="l1409"><span class="linenum">1409</span></a>      protected function <a class="function" onClick="logFunction('generate_simple_struct_class')" href="../_functions/generate_simple_struct_class.html" onMouseOver="funcPopup(event,'generate_simple_struct_class')">generate_simple_struct_class</a>(external_single_structure <a class="var it4689" onMouseOver="hilite(4689)" onMouseOut="lolite()" onClick="logVariable('structdesc')" href="../_variables/structdesc.html">$structdesc</a>) {
<a name="l1410"><span class="linenum">1410</span></a>          return 'object|struct'; <span class="comment">//only 'object' is supported by SOAP, 'struct' by XML-RPC MDL-23083</span>
<a name="l1411"><span class="linenum">1411</span></a>      }
<a name="l1412"><span class="linenum">1412</span></a>  
<a name="l1413"><span class="linenum">1413</span></a>      <span class="comment">/**</span>
<a name="l1414"><span class="linenum">1414</span></a>  <span class="comment">     * You can override this function in your child class to add extra code into the dynamically</span>
<a name="l1415"><span class="linenum">1415</span></a>  <span class="comment">     * created service class. For example it is used in the amf server to cast types of parameters and to</span>
<a name="l1416"><span class="linenum">1416</span></a>  <span class="comment">     * cast the return value to the types as specified in the return value description.</span>
<a name="l1417"><span class="linenum">1417</span></a>  <span class="comment">     *</span>
<a name="l1418"><span class="linenum">1418</span></a>  <span class="comment">     * @param stdClass $function a record from external_function</span>
<a name="l1419"><span class="linenum">1419</span></a>  <span class="comment">     * @param array $params web service function parameters</span>
<a name="l1420"><span class="linenum">1420</span></a>  <span class="comment">     * @return string body of the method for $function ie. everything within the {} of the method declaration.</span>
<a name="l1421"><span class="linenum">1421</span></a>  <span class="comment">     */</span>
<a name="l1422"><span class="linenum">1422</span></a>      protected function <a class="function" onClick="logFunction('service_class_method_body')" href="../_functions/service_class_method_body.html" onMouseOver="funcPopup(event,'service_class_method_body')">service_class_method_body</a>(<a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>){
<a name="l1423"><span class="linenum">1423</span></a>  <span class="comment">        //cast the param from object to array (validate_parameters except array only)</span>
<a name="l1424"><span class="linenum">1424</span></a>          <a class="var it4690" onMouseOver="hilite(4690)" onMouseOut="lolite()" onClick="logVariable('castingcode')" href="../_variables/castingcode.html">$castingcode</a> = '';
<a name="l1425"><span class="linenum">1425</span></a>          if (<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>){
<a name="l1426"><span class="linenum">1426</span></a>              <a class="var it4691" onMouseOver="hilite(4691)" onMouseOut="lolite()" onClick="logVariable('paramstocast')" href="../_variables/paramstocast.html">$paramstocast</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l1427"><span class="linenum">1427</span></a>              foreach (<a class="var it4691" onMouseOver="hilite(4691)" onMouseOut="lolite()" onClick="logVariable('paramstocast')" href="../_variables/paramstocast.html">$paramstocast</a> as <a class="var it4692" onMouseOver="hilite(4692)" onMouseOut="lolite()" onClick="logVariable('paramtocast')" href="../_variables/paramtocast.html">$paramtocast</a>) {
<a name="l1428"><span class="linenum">1428</span></a>  <span class="comment">                //clean the parameter from any white space</span>
<a name="l1429"><span class="linenum">1429</span></a>                  <a class="var it4692" onMouseOver="hilite(4692)" onMouseOut="lolite()" onClick="logVariable('paramtocast')" href="../_variables/paramtocast.html">$paramtocast</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it4692" onMouseOver="hilite(4692)" onMouseOut="lolite()" onClick="logVariable('paramtocast')" href="../_variables/paramtocast.html">$paramtocast</a>);
<a name="l1430"><span class="linenum">1430</span></a>                  <a class="var it4690" onMouseOver="hilite(4690)" onMouseOut="lolite()" onClick="logVariable('castingcode')" href="../_variables/castingcode.html">$castingcode</a> .= <a class="var it4692" onMouseOver="hilite(4692)" onMouseOut="lolite()" onClick="logVariable('paramtocast')" href="../_variables/paramtocast.html">$paramtocast</a> .
<a name="l1431"><span class="linenum">1431</span></a>                  '=webservice_zend_server::<a class="function" onClick="logFunction('cast_objects_to_array')" href="../_functions/cast_objects_to_array.html" onMouseOver="funcPopup(event,'cast_objects_to_array')">cast_objects_to_array</a>('.<a class="var it4692" onMouseOver="hilite(4692)" onMouseOut="lolite()" onClick="logVariable('paramtocast')" href="../_variables/paramtocast.html">$paramtocast</a>.');';
<a name="l1432"><span class="linenum">1432</span></a>              }
<a name="l1433"><span class="linenum">1433</span></a>  
<a name="l1434"><span class="linenum">1434</span></a>          }
<a name="l1435"><span class="linenum">1435</span></a>  
<a name="l1436"><span class="linenum">1436</span></a>          <a class="var it4693" onMouseOver="hilite(4693)" onMouseOut="lolite()" onClick="logVariable('descriptionmethod')" href="../_variables/descriptionmethod.html">$descriptionmethod</a> = <a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('methodname')" class="var it40435" onMouseOver="hilite(40435)" onMouseOut="lolite()" href="../_variables/methodname.html">methodname</a>.'_returns()';
<a name="l1437"><span class="linenum">1437</span></a>          <a class="var it4694" onMouseOver="hilite(4694)" onMouseOut="lolite()" onClick="logVariable('callforreturnvaluedesc')" href="../_variables/callforreturnvaluedesc.html">$callforreturnvaluedesc</a> = <a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('classname')" class="var it40435" onMouseOver="hilite(40435)" onMouseOut="lolite()" href="../_variables/classname.html">classname</a>.'::'.<a class="var it4693" onMouseOver="hilite(4693)" onMouseOut="lolite()" onClick="logVariable('descriptionmethod')" href="../_variables/descriptionmethod.html">$descriptionmethod</a>;
<a name="l1438"><span class="linenum">1438</span></a>          return <a class="var it4690" onMouseOver="hilite(4690)" onMouseOut="lolite()" onClick="logVariable('castingcode')" href="../_variables/castingcode.html">$castingcode</a> . '    if ('.<a class="var it4694" onMouseOver="hilite(4694)" onMouseOut="lolite()" onClick="logVariable('callforreturnvaluedesc')" href="../_variables/callforreturnvaluedesc.html">$callforreturnvaluedesc</a>.' == null)  {'.
<a name="l1439"><span class="linenum">1439</span></a>                          <a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('classname')" class="var it40435" onMouseOver="hilite(40435)" onMouseOut="lolite()" href="../_variables/classname.html">classname</a>.'::'.<a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('methodname')" class="var it40435" onMouseOver="hilite(40435)" onMouseOut="lolite()" href="../_variables/methodname.html">methodname</a>.'('.<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>.');
<a name="l1440"><span class="linenum">1440</span></a>                          return null;
<a name="l1441"><span class="linenum">1441</span></a>                      }
<a name="l1442"><span class="linenum">1442</span></a>                      return <a class="class" onClick="logClass('external_api')" href="../_classes/external_api.html" onMouseOver="classPopup(event,'external_api')">external_api</a>::<a class="function" onClick="logFunction('clean_returnvalue')" href="../_functions/clean_returnvalue.html" onMouseOver="funcPopup(event,'clean_returnvalue')">clean_returnvalue</a>('.<a class="var it4694" onMouseOver="hilite(4694)" onMouseOut="lolite()" onClick="logVariable('callforreturnvaluedesc')" href="../_variables/callforreturnvaluedesc.html">$callforreturnvaluedesc</a>.', '.<a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('classname')" class="var it40435" onMouseOver="hilite(40435)" onMouseOut="lolite()" href="../_variables/classname.html">classname</a>.'::'.<a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('methodname')" class="var it40435" onMouseOver="hilite(40435)" onMouseOut="lolite()" href="../_variables/methodname.html">methodname</a>.'('.<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>.'));';
<a name="l1443"><span class="linenum">1443</span></a>      }
<a name="l1444"><span class="linenum">1444</span></a>  
<a name="l1445"><span class="linenum">1445</span></a>      <span class="comment">/**</span>
<a name="l1446"><span class="linenum">1446</span></a>  <span class="comment">     * Recursive function to recurse down into a complex variable and convert all</span>
<a name="l1447"><span class="linenum">1447</span></a>  <span class="comment">     * objects to arrays.</span>
<a name="l1448"><span class="linenum">1448</span></a>  <span class="comment">     *</span>
<a name="l1449"><span class="linenum">1449</span></a>  <span class="comment">     * @param mixed $param value to cast</span>
<a name="l1450"><span class="linenum">1450</span></a>  <span class="comment">     * @return mixed Cast value</span>
<a name="l1451"><span class="linenum">1451</span></a>  <span class="comment">     */</span>
<a name="l1452"><span class="linenum">1452</span></a>      public static function <a class="function" onClick="logFunction('cast_objects_to_array')" href="../_functions/cast_objects_to_array.html" onMouseOver="funcPopup(event,'cast_objects_to_array')">cast_objects_to_array</a>(<a class="var it396" onMouseOver="hilite(396)" onMouseOut="lolite()" onClick="logVariable('param')" href="../_variables/param.html">$param</a>){
<a name="l1453"><span class="linenum">1453</span></a>          if (<a class="phpfunction" onClick="logFunction('is_object')" href="../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it396" onMouseOver="hilite(396)" onMouseOut="lolite()" onClick="logVariable('param')" href="../_variables/param.html">$param</a>)){
<a name="l1454"><span class="linenum">1454</span></a>              <a class="var it396" onMouseOver="hilite(396)" onMouseOut="lolite()" onClick="logVariable('param')" href="../_variables/param.html">$param</a> = (array)<a class="var it396" onMouseOver="hilite(396)" onMouseOut="lolite()" onClick="logVariable('param')" href="../_variables/param.html">$param</a>;
<a name="l1455"><span class="linenum">1455</span></a>          }
<a name="l1456"><span class="linenum">1456</span></a>          if (<a class="phpfunction" onClick="logFunction('is_array')" href="../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it396" onMouseOver="hilite(396)" onMouseOut="lolite()" onClick="logVariable('param')" href="../_variables/param.html">$param</a>)){
<a name="l1457"><span class="linenum">1457</span></a>              <a class="var it4695" onMouseOver="hilite(4695)" onMouseOut="lolite()" onClick="logVariable('toreturn')" href="../_variables/toreturn.html">$toreturn</a> = array();
<a name="l1458"><span class="linenum">1458</span></a>              foreach (<a class="var it396" onMouseOver="hilite(396)" onMouseOut="lolite()" onClick="logVariable('param')" href="../_variables/param.html">$param</a> as <a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>=&gt; <a class="var it396" onMouseOver="hilite(396)" onMouseOut="lolite()" onClick="logVariable('param')" href="../_variables/param.html">$param</a>){
<a name="l1459"><span class="linenum">1459</span></a>                  <a class="var it4695" onMouseOver="hilite(4695)" onMouseOut="lolite()" onClick="logVariable('toreturn')" href="../_variables/toreturn.html">$toreturn</a>[<a class="var it36" onMouseOver="hilite(36)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>] = self::<a class="function" onClick="logFunction('cast_objects_to_array')" href="../_functions/cast_objects_to_array.html" onMouseOver="funcPopup(event,'cast_objects_to_array')">cast_objects_to_array</a>(<a class="var it396" onMouseOver="hilite(396)" onMouseOut="lolite()" onClick="logVariable('param')" href="../_variables/param.html">$param</a>);
<a name="l1460"><span class="linenum">1460</span></a>              }
<a name="l1461"><span class="linenum">1461</span></a>              return <a class="var it4695" onMouseOver="hilite(4695)" onMouseOut="lolite()" onClick="logVariable('toreturn')" href="../_variables/toreturn.html">$toreturn</a>;
<a name="l1462"><span class="linenum">1462</span></a>          } else {
<a name="l1463"><span class="linenum">1463</span></a>              return <a class="var it396" onMouseOver="hilite(396)" onMouseOut="lolite()" onClick="logVariable('param')" href="../_variables/param.html">$param</a>;
<a name="l1464"><span class="linenum">1464</span></a>          }
<a name="l1465"><span class="linenum">1465</span></a>      }
<a name="l1466"><span class="linenum">1466</span></a>  
<a name="l1467"><span class="linenum">1467</span></a>      <span class="comment">/**</span>
<a name="l1468"><span class="linenum">1468</span></a>  <span class="comment">     * Set up zend service class</span>
<a name="l1469"><span class="linenum">1469</span></a>  <span class="comment">     */</span>
<a name="l1470"><span class="linenum">1470</span></a>      protected function <a class="function" onClick="logFunction('init_zend_server')" href="../_functions/init_zend_server.html" onMouseOver="funcPopup(event,'init_zend_server')">init_zend_server</a>() {
<a name="l1471"><span class="linenum">1471</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('zend_server')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/zend_server.html">zend_server</a> = new <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;zend_class();
<a name="l1472"><span class="linenum">1472</span></a>      }
<a name="l1473"><span class="linenum">1473</span></a>  
<a name="l1474"><span class="linenum">1474</span></a>      <span class="comment">/**</span>
<a name="l1475"><span class="linenum">1475</span></a>  <span class="comment">     * This method parses the $_POST and $_GET superglobals and looks for</span>
<a name="l1476"><span class="linenum">1476</span></a>  <span class="comment">     * the following information:</span>
<a name="l1477"><span class="linenum">1477</span></a>  <span class="comment">     *  1/ user authentication - username+password or token (wsusername, wspassword and wstoken parameters)</span>
<a name="l1478"><span class="linenum">1478</span></a>  <span class="comment">     *</span>
<a name="l1479"><span class="linenum">1479</span></a>  <span class="comment">     * @return void</span>
<a name="l1480"><span class="linenum">1480</span></a>  <span class="comment">     */</span>
<a name="l1481"><span class="linenum">1481</span></a>      protected function <a class="function" onClick="logFunction('parse_request')" href="../_functions/parse_request.html" onMouseOver="funcPopup(event,'parse_request')">parse_request</a>() {
<a name="l1482"><span class="linenum">1482</span></a>  
<a name="l1483"><span class="linenum">1483</span></a>  <span class="comment">        // We are going to clean the POST/GET parameters from the parameters specific to the server.</span>
<a name="l1484"><span class="linenum">1484</span></a>          parent::<a class="function" onClick="logFunction('set_web_service_call_settings')" href="../_functions/set_web_service_call_settings.html" onMouseOver="funcPopup(event,'set_web_service_call_settings')">set_web_service_call_settings</a>();
<a name="l1485"><span class="linenum">1485</span></a>  
<a name="l1486"><span class="linenum">1486</span></a>  <span class="comment">        // Get GET and POST paramters.</span>
<a name="l1487"><span class="linenum">1487</span></a>          <a class="var it4696" onMouseOver="hilite(4696)" onMouseOut="lolite()" onClick="logVariable('methodvariables')" href="../_variables/methodvariables.html">$methodvariables</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it76" onMouseOver="hilite(76)" onMouseOut="lolite()" onClick="logVariable('_GET')" href="../_variables/_GET.html">$_GET</a>,<a class="var it2053" onMouseOver="hilite(2053)" onMouseOut="lolite()" onClick="logVariable('_POST')" href="../_variables/_POST.html">$_POST</a>);
<a name="l1488"><span class="linenum">1488</span></a>  
<a name="l1489"><span class="linenum">1489</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authmethod')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/authmethod.html">authmethod</a> == <a class="constant" onClick="logConstant('WEBSERVICE_AUTHMETHOD_USERNAME')" href="../_constants/WEBSERVICE_AUTHMETHOD_USERNAME.html" onMouseOver="constPopup(event,'WEBSERVICE_AUTHMETHOD_USERNAME')">WEBSERVICE_AUTHMETHOD_USERNAME</a>) {
<a name="l1490"><span class="linenum">1490</span></a>  <span class="comment">            //note: some clients have problems with entity encoding :-(</span>
<a name="l1491"><span class="linenum">1491</span></a>              if (isset(<a class="var it4696" onMouseOver="hilite(4696)" onMouseOut="lolite()" onClick="logVariable('methodvariables')" href="../_variables/methodvariables.html">$methodvariables</a>['wsusername'])) {
<a name="l1492"><span class="linenum">1492</span></a>                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('username')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/username.html">username</a> = <a class="var it4696" onMouseOver="hilite(4696)" onMouseOut="lolite()" onClick="logVariable('methodvariables')" href="../_variables/methodvariables.html">$methodvariables</a>['wsusername'];
<a name="l1493"><span class="linenum">1493</span></a>              }
<a name="l1494"><span class="linenum">1494</span></a>              if (isset(<a class="var it4696" onMouseOver="hilite(4696)" onMouseOut="lolite()" onClick="logVariable('methodvariables')" href="../_variables/methodvariables.html">$methodvariables</a>['wspassword'])) {
<a name="l1495"><span class="linenum">1495</span></a>                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('password')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/password.html">password</a> = <a class="var it4696" onMouseOver="hilite(4696)" onMouseOut="lolite()" onClick="logVariable('methodvariables')" href="../_variables/methodvariables.html">$methodvariables</a>['wspassword'];
<a name="l1496"><span class="linenum">1496</span></a>              }
<a name="l1497"><span class="linenum">1497</span></a>          } else {
<a name="l1498"><span class="linenum">1498</span></a>              if (isset(<a class="var it4696" onMouseOver="hilite(4696)" onMouseOut="lolite()" onClick="logVariable('methodvariables')" href="../_variables/methodvariables.html">$methodvariables</a>['wstoken'])) {
<a name="l1499"><span class="linenum">1499</span></a>                  <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('token')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/token.html">token</a> = <a class="var it4696" onMouseOver="hilite(4696)" onMouseOut="lolite()" onClick="logVariable('methodvariables')" href="../_variables/methodvariables.html">$methodvariables</a>['wstoken'];
<a name="l1500"><span class="linenum">1500</span></a>              }
<a name="l1501"><span class="linenum">1501</span></a>          }
<a name="l1502"><span class="linenum">1502</span></a>      }
<a name="l1503"><span class="linenum">1503</span></a>  
<a name="l1504"><span class="linenum">1504</span></a>      <span class="comment">/**</span>
<a name="l1505"><span class="linenum">1505</span></a>  <span class="comment">     * Internal implementation - sending of page headers.</span>
<a name="l1506"><span class="linenum">1506</span></a>  <span class="comment">     */</span>
<a name="l1507"><span class="linenum">1507</span></a>      protected function <a class="function" onClick="logFunction('send_headers')" href="../_functions/send_headers.html" onMouseOver="funcPopup(event,'send_headers')">send_headers</a>() {
<a name="l1508"><span class="linenum">1508</span></a>          <a class="phpfunction" onClick="logFunction('header')" href="../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>('Cache-Control: private, must-revalidate, pre-check=0, post-check=0, max-age=0');
<a name="l1509"><span class="linenum">1509</span></a>          <a class="phpfunction" onClick="logFunction('header')" href="../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>('Expires: '. <a class="phpfunction" onClick="logFunction('gmdate')" href="../_functions/gmdate.html" onMouseOver="phpfuncPopup(event,'gmdate')">gmdate</a>('D, d M Y H:i:s', 0) .' GMT');
<a name="l1510"><span class="linenum">1510</span></a>          <a class="phpfunction" onClick="logFunction('header')" href="../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>('Pragma: no-cache');
<a name="l1511"><span class="linenum">1511</span></a>          <a class="phpfunction" onClick="logFunction('header')" href="../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>('Accept-Ranges: none');
<a name="l1512"><span class="linenum">1512</span></a>      }
<a name="l1513"><span class="linenum">1513</span></a>  
<a name="l1514"><span class="linenum">1514</span></a>      <span class="comment">/**</span>
<a name="l1515"><span class="linenum">1515</span></a>  <span class="comment">     * Specialised exception handler, we can not use the standard one because</span>
<a name="l1516"><span class="linenum">1516</span></a>  <span class="comment">     * it can not just print html to output.</span>
<a name="l1517"><span class="linenum">1517</span></a>  <span class="comment">     *</span>
<a name="l1518"><span class="linenum">1518</span></a>  <span class="comment">     * @param exception $ex</span>
<a name="l1519"><span class="linenum">1519</span></a>  <span class="comment">     * @uses exit</span>
<a name="l1520"><span class="linenum">1520</span></a>  <span class="comment">     */</span>
<a name="l1521"><span class="linenum">1521</span></a>      public function <a class="function" onClick="logFunction('exception_handler')" href="../_functions/exception_handler.html" onMouseOver="funcPopup(event,'exception_handler')">exception_handler</a>(<a class="var it2200" onMouseOver="hilite(2200)" onMouseOut="lolite()" onClick="logVariable('ex')" href="../_variables/ex.html">$ex</a>) {
<a name="l1522"><span class="linenum">1522</span></a>  <span class="comment">        // detect active db transactions, rollback and log as error</span>
<a name="l1523"><span class="linenum">1523</span></a>          <a class="function" onClick="logFunction('abort_all_db_transactions')" href="../_functions/abort_all_db_transactions.html" onMouseOver="funcPopup(event,'abort_all_db_transactions')">abort_all_db_transactions</a>();
<a name="l1524"><span class="linenum">1524</span></a>  
<a name="l1525"><span class="linenum">1525</span></a>  <span class="comment">        // some hacks might need a cleanup hook</span>
<a name="l1526"><span class="linenum">1526</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('session_cleanup')" href="../_functions/session_cleanup.html" onMouseOver="funcPopup(event,'session_cleanup')">session_cleanup</a>(<a class="var it2200" onMouseOver="hilite(2200)" onMouseOut="lolite()" onClick="logVariable('ex')" href="../_variables/ex.html">$ex</a>);
<a name="l1527"><span class="linenum">1527</span></a>  
<a name="l1528"><span class="linenum">1528</span></a>  <span class="comment">        // now let the plugin send the exception to client</span>
<a name="l1529"><span class="linenum">1529</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('send_error')" href="../_functions/send_error.html" onMouseOver="funcPopup(event,'send_error')">send_error</a>(<a class="var it2200" onMouseOver="hilite(2200)" onMouseOut="lolite()" onClick="logVariable('ex')" href="../_variables/ex.html">$ex</a>);
<a name="l1530"><span class="linenum">1530</span></a>  
<a name="l1531"><span class="linenum">1531</span></a>  <span class="comment">        // not much else we can do now, add some logging later</span>
<a name="l1532"><span class="linenum">1532</span></a>          exit(1);
<a name="l1533"><span class="linenum">1533</span></a>      }
<a name="l1534"><span class="linenum">1534</span></a>  
<a name="l1535"><span class="linenum">1535</span></a>      <span class="comment">/**</span>
<a name="l1536"><span class="linenum">1536</span></a>  <span class="comment">     * Send the error information to the WS client</span>
<a name="l1537"><span class="linenum">1537</span></a>  <span class="comment">     * formatted as XML document.</span>
<a name="l1538"><span class="linenum">1538</span></a>  <span class="comment">     *</span>
<a name="l1539"><span class="linenum">1539</span></a>  <span class="comment">     * @param exception $ex</span>
<a name="l1540"><span class="linenum">1540</span></a>  <span class="comment">     */</span>
<a name="l1541"><span class="linenum">1541</span></a>      protected function <a class="function" onClick="logFunction('send_error')" href="../_functions/send_error.html" onMouseOver="funcPopup(event,'send_error')">send_error</a>(<a class="var it2200" onMouseOver="hilite(2200)" onMouseOut="lolite()" onClick="logVariable('ex')" href="../_variables/ex.html">$ex</a>=null) {
<a name="l1542"><span class="linenum">1542</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('send_headers')" href="../_functions/send_headers.html" onMouseOver="funcPopup(event,'send_headers')">send_headers</a>();
<a name="l1543"><span class="linenum">1543</span></a>          echo <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('zend_server')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/zend_server.html">zend_server</a>-&gt;<a class="function" onClick="logFunction('fault')" href="../_functions/fault.html" onMouseOver="funcPopup(event,'fault')">fault</a>(<a class="var it2200" onMouseOver="hilite(2200)" onMouseOut="lolite()" onClick="logVariable('ex')" href="../_variables/ex.html">$ex</a>);
<a name="l1544"><span class="linenum">1544</span></a>      }
<a name="l1545"><span class="linenum">1545</span></a>  
<a name="l1546"><span class="linenum">1546</span></a>      <span class="comment">/**</span>
<a name="l1547"><span class="linenum">1547</span></a>  <span class="comment">     * Future hook needed for emulated sessions.</span>
<a name="l1548"><span class="linenum">1548</span></a>  <span class="comment">     *</span>
<a name="l1549"><span class="linenum">1549</span></a>  <span class="comment">     * @param exception $exception null means normal termination, $exception received when WS call failed</span>
<a name="l1550"><span class="linenum">1550</span></a>  <span class="comment">     */</span>
<a name="l1551"><span class="linenum">1551</span></a>      protected function <a class="function" onClick="logFunction('session_cleanup')" href="../_functions/session_cleanup.html" onMouseOver="funcPopup(event,'session_cleanup')">session_cleanup</a>(<a class="var it4697" onMouseOver="hilite(4697)" onMouseOut="lolite()" onClick="logVariable('exception')" href="../_variables/exception.html">$exception</a>=null) {
<a name="l1552"><span class="linenum">1552</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authmethod')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/authmethod.html">authmethod</a> == <a class="constant" onClick="logConstant('WEBSERVICE_AUTHMETHOD_USERNAME')" href="../_constants/WEBSERVICE_AUTHMETHOD_USERNAME.html" onMouseOver="constPopup(event,'WEBSERVICE_AUTHMETHOD_USERNAME')">WEBSERVICE_AUTHMETHOD_USERNAME</a>) {
<a name="l1553"><span class="linenum">1553</span></a>  <span class="comment">            // nothing needs to be done, there is no persistent session</span>
<a name="l1554"><span class="linenum">1554</span></a>          } else {
<a name="l1555"><span class="linenum">1555</span></a>  <span class="comment">            // close emulated session if used</span>
<a name="l1556"><span class="linenum">1556</span></a>          }
<a name="l1557"><span class="linenum">1557</span></a>      }
<a name="l1558"><span class="linenum">1558</span></a>  
<a name="l1559"><span class="linenum">1559</span></a>  }
<a name="l1560"><span class="linenum">1560</span></a>  
<a name="l1561"><span class="linenum">1561</span></a>  <span class="comment">/**</span>
<a name="l1562"><span class="linenum">1562</span></a>  <span class="comment"> * Web Service server base class.</span>
<a name="l1563"><span class="linenum">1563</span></a>  <span class="comment"> *</span>
<a name="l1564"><span class="linenum">1564</span></a>  <span class="comment"> * This class handles both simple and token authentication.</span>
<a name="l1565"><span class="linenum">1565</span></a>  <span class="comment"> *</span>
<a name="l1566"><span class="linenum">1566</span></a>  <span class="comment"> * @package    core_webservice</span>
<a name="l1567"><span class="linenum">1567</span></a>  <span class="comment"> * @copyright  2009 Petr Skodak</span>
<a name="l1568"><span class="linenum">1568</span></a>  <span class="comment"> * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later</span>
<a name="l1569"><span class="linenum">1569</span></a>  <span class="comment"> */</span>
<a name="l1570"><span class="linenum">1570</span></a>  abstract class webservice_base_server extends webservice_server {
<a name="l1571"><span class="linenum">1571</span></a>  
<a name="l1572"><span class="linenum">1572</span></a>  <span class="comment">    /** @var array The function parameters - the real values submitted in the request */</span>
<a name="l1573"><span class="linenum">1573</span></a>      protected <a class="var it343" onMouseOver="hilite(343)" onMouseOut="lolite()" onClick="logVariable('parameters')" href="../_variables/parameters.html">$parameters</a> = null;
<a name="l1574"><span class="linenum">1574</span></a>  
<a name="l1575"><span class="linenum">1575</span></a>  <span class="comment">    /** @var string The name of the function that is executed */</span>
<a name="l1576"><span class="linenum">1576</span></a>      protected <a class="var it3922" onMouseOver="hilite(3922)" onMouseOut="lolite()" onClick="logVariable('functionname')" href="../_variables/functionname.html">$functionname</a> = null;
<a name="l1577"><span class="linenum">1577</span></a>  
<a name="l1578"><span class="linenum">1578</span></a>  <span class="comment">    /** @var stdClass Full function description */</span>
<a name="l1579"><span class="linenum">1579</span></a>      protected <a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a> = null;
<a name="l1580"><span class="linenum">1580</span></a>  
<a name="l1581"><span class="linenum">1581</span></a>  <span class="comment">    /** @var mixed Function return value */</span>
<a name="l1582"><span class="linenum">1582</span></a>      protected <a class="var it4698" onMouseOver="hilite(4698)" onMouseOut="lolite()" onClick="logVariable('returns')" href="../_variables/returns.html">$returns</a> = null;
<a name="l1583"><span class="linenum">1583</span></a>  
<a name="l1584"><span class="linenum">1584</span></a>      <span class="comment">/**</span>
<a name="l1585"><span class="linenum">1585</span></a>  <span class="comment">     * This method parses the request input, it needs to get:</span>
<a name="l1586"><span class="linenum">1586</span></a>  <span class="comment">     *  1/ user authentication - username+password or token</span>
<a name="l1587"><span class="linenum">1587</span></a>  <span class="comment">     *  2/ function name</span>
<a name="l1588"><span class="linenum">1588</span></a>  <span class="comment">     *  3/ function parameters</span>
<a name="l1589"><span class="linenum">1589</span></a>  <span class="comment">     */</span>
<a name="l1590"><span class="linenum">1590</span></a>      abstract protected function <a class="function" onClick="logFunction('parse_request')" href="../_functions/parse_request.html" onMouseOver="funcPopup(event,'parse_request')">parse_request</a>();
<a name="l1591"><span class="linenum">1591</span></a>  
<a name="l1592"><span class="linenum">1592</span></a>      <span class="comment">/**</span>
<a name="l1593"><span class="linenum">1593</span></a>  <span class="comment">     * Send the result of function call to the WS client.</span>
<a name="l1594"><span class="linenum">1594</span></a>  <span class="comment">     */</span>
<a name="l1595"><span class="linenum">1595</span></a>      abstract protected function <a class="function" onClick="logFunction('send_response')" href="../_functions/send_response.html" onMouseOver="funcPopup(event,'send_response')">send_response</a>();
<a name="l1596"><span class="linenum">1596</span></a>  
<a name="l1597"><span class="linenum">1597</span></a>      <span class="comment">/**</span>
<a name="l1598"><span class="linenum">1598</span></a>  <span class="comment">     * Send the error information to the WS client.</span>
<a name="l1599"><span class="linenum">1599</span></a>  <span class="comment">     *</span>
<a name="l1600"><span class="linenum">1600</span></a>  <span class="comment">     * @param exception $ex</span>
<a name="l1601"><span class="linenum">1601</span></a>  <span class="comment">     */</span>
<a name="l1602"><span class="linenum">1602</span></a>      abstract protected function <a class="function" onClick="logFunction('send_error')" href="../_functions/send_error.html" onMouseOver="funcPopup(event,'send_error')">send_error</a>(<a class="var it2200" onMouseOver="hilite(2200)" onMouseOut="lolite()" onClick="logVariable('ex')" href="../_variables/ex.html">$ex</a>=null);
<a name="l1603"><span class="linenum">1603</span></a>  
<a name="l1604"><span class="linenum">1604</span></a>      <span class="comment">/**</span>
<a name="l1605"><span class="linenum">1605</span></a>  <span class="comment">     * Process request from client.</span>
<a name="l1606"><span class="linenum">1606</span></a>  <span class="comment">     *</span>
<a name="l1607"><span class="linenum">1607</span></a>  <span class="comment">     * @uses die</span>
<a name="l1608"><span class="linenum">1608</span></a>  <span class="comment">     */</span>
<a name="l1609"><span class="linenum">1609</span></a>      public function <a class="function" onClick="logFunction('run')" href="../_functions/run.html" onMouseOver="funcPopup(event,'run')">run</a>() {
<a name="l1610"><span class="linenum">1610</span></a>  <span class="comment">        // we will probably need a lot of memory in some functions</span>
<a name="l1611"><span class="linenum">1611</span></a>          <a class="function" onClick="logFunction('raise_memory_limit')" href="../_functions/raise_memory_limit.html" onMouseOver="funcPopup(event,'raise_memory_limit')">raise_memory_limit</a>(<a class="constant" onClick="logConstant('MEMORY_EXTRA')" href="../_constants/MEMORY_EXTRA.html" onMouseOver="constPopup(event,'MEMORY_EXTRA')">MEMORY_EXTRA</a>);
<a name="l1612"><span class="linenum">1612</span></a>  
<a name="l1613"><span class="linenum">1613</span></a>  <span class="comment">        // set some longer timeout, this script is not sending any output,</span>
<a name="l1614"><span class="linenum">1614</span></a>  <span class="comment">        // this means we need to manually extend the timeout operations</span>
<a name="l1615"><span class="linenum">1615</span></a>  <span class="comment">        // that need longer time to finish</span>
<a name="l1616"><span class="linenum">1616</span></a>          <a class="class" onClick="logClass('external_api')" href="../_classes/external_api.html" onMouseOver="classPopup(event,'external_api')">external_api</a>::<a class="function" onClick="logFunction('set_timeout')" href="../_functions/set_timeout.html" onMouseOver="funcPopup(event,'set_timeout')">set_timeout</a>();
<a name="l1617"><span class="linenum">1617</span></a>  
<a name="l1618"><span class="linenum">1618</span></a>  <span class="comment">        // set up exception handler first, we want to sent them back in correct format that</span>
<a name="l1619"><span class="linenum">1619</span></a>  <span class="comment">        // the other system understands</span>
<a name="l1620"><span class="linenum">1620</span></a>  <span class="comment">        // we do not need to call the original default handler because this ws handler does everything</span>
<a name="l1621"><span class="linenum">1621</span></a>          <a class="phpfunction" onClick="logFunction('set_exception_handler')" href="../_functions/set_exception_handler.html" onMouseOver="phpfuncPopup(event,'set_exception_handler')">set_exception_handler</a>(array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>, 'exception_handler'));
<a name="l1622"><span class="linenum">1622</span></a>  
<a name="l1623"><span class="linenum">1623</span></a>  <span class="comment">        // init all properties from the request data</span>
<a name="l1624"><span class="linenum">1624</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('parse_request')" href="../_functions/parse_request.html" onMouseOver="funcPopup(event,'parse_request')">parse_request</a>();
<a name="l1625"><span class="linenum">1625</span></a>  
<a name="l1626"><span class="linenum">1626</span></a>  <span class="comment">        // authenticate user, this has to be done after the request parsing</span>
<a name="l1627"><span class="linenum">1627</span></a>  <span class="comment">        // this also sets up $USER and $SESSION</span>
<a name="l1628"><span class="linenum">1628</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('authenticate_user')" href="../_functions/authenticate_user.html" onMouseOver="funcPopup(event,'authenticate_user')">authenticate_user</a>();
<a name="l1629"><span class="linenum">1629</span></a>  
<a name="l1630"><span class="linenum">1630</span></a>  <span class="comment">        // find all needed function info and make sure user may actually execute the function</span>
<a name="l1631"><span class="linenum">1631</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('load_function_info')" href="../_functions/load_function_info.html" onMouseOver="funcPopup(event,'load_function_info')">load_function_info</a>();
<a name="l1632"><span class="linenum">1632</span></a>  
<a name="l1633"><span class="linenum">1633</span></a>  <span class="comment">        // Log the web service request.</span>
<a name="l1634"><span class="linenum">1634</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array(
<a name="l1635"><span class="linenum">1635</span></a>              'other' =&gt; array(
<a name="l1636"><span class="linenum">1636</span></a>                  'function' =&gt; <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;functionname
<a name="l1637"><span class="linenum">1637</span></a>              )
<a name="l1638"><span class="linenum">1638</span></a>          );
<a name="l1639"><span class="linenum">1639</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a> = \core\event\<a class="class" onClick="logClass('webservice_function_called')" href="../_classes/webservice_function_called.html" onMouseOver="classPopup(event,'webservice_function_called')">webservice_function_called</a>::<a class="function" onClick="logFunction('create')" href="../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l1640"><span class="linenum">1640</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('set_legacy_logdata')" href="../_functions/set_legacy_logdata.html" onMouseOver="funcPopup(event,'set_legacy_logdata')">set_legacy_logdata</a>(array(<a class="constant" onClick="logConstant('SITEID')" href="../_constants/SITEID.html" onMouseOver="constPopup(event,'SITEID')">SITEID</a>, 'webservice', <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('functionname')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/functionname.html">functionname</a>, '' , <a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>() , 0, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/userid.html">userid</a>));
<a name="l1641"><span class="linenum">1641</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('event')" href="../_variables/event.html">$event</a>-&gt;<a class="function" onClick="logFunction('trigger')" href="../_functions/trigger.html" onMouseOver="funcPopup(event,'trigger')">trigger</a>();
<a name="l1642"><span class="linenum">1642</span></a>  
<a name="l1643"><span class="linenum">1643</span></a>  <span class="comment">        // finally, execute the function - any errors are catched by the default exception handler</span>
<a name="l1644"><span class="linenum">1644</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('execute')" href="../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>();
<a name="l1645"><span class="linenum">1645</span></a>  
<a name="l1646"><span class="linenum">1646</span></a>  <span class="comment">        // send the results back in correct format</span>
<a name="l1647"><span class="linenum">1647</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('send_response')" href="../_functions/send_response.html" onMouseOver="funcPopup(event,'send_response')">send_response</a>();
<a name="l1648"><span class="linenum">1648</span></a>  
<a name="l1649"><span class="linenum">1649</span></a>  <span class="comment">        // session cleanup</span>
<a name="l1650"><span class="linenum">1650</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('session_cleanup')" href="../_functions/session_cleanup.html" onMouseOver="funcPopup(event,'session_cleanup')">session_cleanup</a>();
<a name="l1651"><span class="linenum">1651</span></a>  
<a name="l1652"><span class="linenum">1652</span></a>          die;
<a name="l1653"><span class="linenum">1653</span></a>      }
<a name="l1654"><span class="linenum">1654</span></a>  
<a name="l1655"><span class="linenum">1655</span></a>      <span class="comment">/**</span>
<a name="l1656"><span class="linenum">1656</span></a>  <span class="comment">     * Specialised exception handler, we can not use the standard one because</span>
<a name="l1657"><span class="linenum">1657</span></a>  <span class="comment">     * it can not just print html to output.</span>
<a name="l1658"><span class="linenum">1658</span></a>  <span class="comment">     *</span>
<a name="l1659"><span class="linenum">1659</span></a>  <span class="comment">     * @param exception $ex</span>
<a name="l1660"><span class="linenum">1660</span></a>  <span class="comment">     * $uses exit</span>
<a name="l1661"><span class="linenum">1661</span></a>  <span class="comment">     */</span>
<a name="l1662"><span class="linenum">1662</span></a>      public function <a class="function" onClick="logFunction('exception_handler')" href="../_functions/exception_handler.html" onMouseOver="funcPopup(event,'exception_handler')">exception_handler</a>(<a class="var it2200" onMouseOver="hilite(2200)" onMouseOut="lolite()" onClick="logVariable('ex')" href="../_variables/ex.html">$ex</a>) {
<a name="l1663"><span class="linenum">1663</span></a>  <span class="comment">        // detect active db transactions, rollback and log as error</span>
<a name="l1664"><span class="linenum">1664</span></a>          <a class="function" onClick="logFunction('abort_all_db_transactions')" href="../_functions/abort_all_db_transactions.html" onMouseOver="funcPopup(event,'abort_all_db_transactions')">abort_all_db_transactions</a>();
<a name="l1665"><span class="linenum">1665</span></a>  
<a name="l1666"><span class="linenum">1666</span></a>  <span class="comment">        // some hacks might need a cleanup hook</span>
<a name="l1667"><span class="linenum">1667</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('session_cleanup')" href="../_functions/session_cleanup.html" onMouseOver="funcPopup(event,'session_cleanup')">session_cleanup</a>(<a class="var it2200" onMouseOver="hilite(2200)" onMouseOut="lolite()" onClick="logVariable('ex')" href="../_variables/ex.html">$ex</a>);
<a name="l1668"><span class="linenum">1668</span></a>  
<a name="l1669"><span class="linenum">1669</span></a>  <span class="comment">        // now let the plugin send the exception to client</span>
<a name="l1670"><span class="linenum">1670</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('send_error')" href="../_functions/send_error.html" onMouseOver="funcPopup(event,'send_error')">send_error</a>(<a class="var it2200" onMouseOver="hilite(2200)" onMouseOut="lolite()" onClick="logVariable('ex')" href="../_variables/ex.html">$ex</a>);
<a name="l1671"><span class="linenum">1671</span></a>  
<a name="l1672"><span class="linenum">1672</span></a>  <span class="comment">        // not much else we can do now, add some logging later</span>
<a name="l1673"><span class="linenum">1673</span></a>          exit(1);
<a name="l1674"><span class="linenum">1674</span></a>      }
<a name="l1675"><span class="linenum">1675</span></a>  
<a name="l1676"><span class="linenum">1676</span></a>      <span class="comment">/**</span>
<a name="l1677"><span class="linenum">1677</span></a>  <span class="comment">     * Future hook needed for emulated sessions.</span>
<a name="l1678"><span class="linenum">1678</span></a>  <span class="comment">     *</span>
<a name="l1679"><span class="linenum">1679</span></a>  <span class="comment">     * @param exception $exception null means normal termination, $exception received when WS call failed</span>
<a name="l1680"><span class="linenum">1680</span></a>  <span class="comment">     */</span>
<a name="l1681"><span class="linenum">1681</span></a>      protected function <a class="function" onClick="logFunction('session_cleanup')" href="../_functions/session_cleanup.html" onMouseOver="funcPopup(event,'session_cleanup')">session_cleanup</a>(<a class="var it4697" onMouseOver="hilite(4697)" onMouseOut="lolite()" onClick="logVariable('exception')" href="../_variables/exception.html">$exception</a>=null) {
<a name="l1682"><span class="linenum">1682</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('authmethod')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/authmethod.html">authmethod</a> == <a class="constant" onClick="logConstant('WEBSERVICE_AUTHMETHOD_USERNAME')" href="../_constants/WEBSERVICE_AUTHMETHOD_USERNAME.html" onMouseOver="constPopup(event,'WEBSERVICE_AUTHMETHOD_USERNAME')">WEBSERVICE_AUTHMETHOD_USERNAME</a>) {
<a name="l1683"><span class="linenum">1683</span></a>  <span class="comment">            // nothing needs to be done, there is no persistent session</span>
<a name="l1684"><span class="linenum">1684</span></a>          } else {
<a name="l1685"><span class="linenum">1685</span></a>  <span class="comment">            // close emulated session if used</span>
<a name="l1686"><span class="linenum">1686</span></a>          }
<a name="l1687"><span class="linenum">1687</span></a>      }
<a name="l1688"><span class="linenum">1688</span></a>  
<a name="l1689"><span class="linenum">1689</span></a>      <span class="comment">/**</span>
<a name="l1690"><span class="linenum">1690</span></a>  <span class="comment">     * Fetches the function description from database,</span>
<a name="l1691"><span class="linenum">1691</span></a>  <span class="comment">     * verifies user is allowed to use this function and</span>
<a name="l1692"><span class="linenum">1692</span></a>  <span class="comment">     * loads all paremeters and return descriptions.</span>
<a name="l1693"><span class="linenum">1693</span></a>  <span class="comment">     */</span>
<a name="l1694"><span class="linenum">1694</span></a>      protected function <a class="function" onClick="logFunction('load_function_info')" href="../_functions/load_function_info.html" onMouseOver="funcPopup(event,'load_function_info')">load_function_info</a>() {
<a name="l1695"><span class="linenum">1695</span></a>          global <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>, <a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>, <a class="var it1" onMouseOver="hilite(1)" onMouseOut="lolite()" onClick="logVariable('CFG')" href="../_variables/CFG.html">$CFG</a>;
<a name="l1696"><span class="linenum">1696</span></a>  
<a name="l1697"><span class="linenum">1697</span></a>          if (empty(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('functionname')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/functionname.html">functionname</a>)) {
<a name="l1698"><span class="linenum">1698</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('invalid_parameter_exception')" href="../_classes/invalid_parameter_exception.html" onMouseOver="classPopup(event,'invalid_parameter_exception')">invalid_parameter_exception</a>('Missing function name');
<a name="l1699"><span class="linenum">1699</span></a>          }
<a name="l1700"><span class="linenum">1700</span></a>  
<a name="l1701"><span class="linenum">1701</span></a>  <span class="comment">        // function must exist</span>
<a name="l1702"><span class="linenum">1702</span></a>          <a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a> = <a class="function" onClick="logFunction('external_function_info')" href="../_functions/external_function_info.html" onMouseOver="funcPopup(event,'external_function_info')">external_function_info</a>(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('functionname')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/functionname.html">functionname</a>);
<a name="l1703"><span class="linenum">1703</span></a>  
<a name="l1704"><span class="linenum">1704</span></a>          if (<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_serviceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/restricted_serviceid.html">restricted_serviceid</a>) {
<a name="l1705"><span class="linenum">1705</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array('sid1'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_serviceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/restricted_serviceid.html">restricted_serviceid</a>, 'sid2'=&gt;<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_serviceid')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/restricted_serviceid.html">restricted_serviceid</a>);
<a name="l1706"><span class="linenum">1706</span></a>              <a class="var it4678" onMouseOver="hilite(4678)" onMouseOut="lolite()" onClick="logVariable('wscond1')" href="../_variables/wscond1.html">$wscond1</a> = 'AND s.id = :sid1';
<a name="l1707"><span class="linenum">1707</span></a>              <a class="var it4679" onMouseOver="hilite(4679)" onMouseOut="lolite()" onClick="logVariable('wscond2')" href="../_variables/wscond2.html">$wscond2</a> = 'AND s.id = :sid2';
<a name="l1708"><span class="linenum">1708</span></a>          } else {
<a name="l1709"><span class="linenum">1709</span></a>              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = array();
<a name="l1710"><span class="linenum">1710</span></a>              <a class="var it4678" onMouseOver="hilite(4678)" onMouseOut="lolite()" onClick="logVariable('wscond1')" href="../_variables/wscond1.html">$wscond1</a> = '';
<a name="l1711"><span class="linenum">1711</span></a>              <a class="var it4679" onMouseOver="hilite(4679)" onMouseOut="lolite()" onClick="logVariable('wscond2')" href="../_variables/wscond2.html">$wscond2</a> = '';
<a name="l1712"><span class="linenum">1712</span></a>          }
<a name="l1713"><span class="linenum">1713</span></a>  
<a name="l1714"><span class="linenum">1714</span></a>  <span class="comment">        // now let's verify access control</span>
<a name="l1715"><span class="linenum">1715</span></a>  
<a name="l1716"><span class="linenum">1716</span></a>  <span class="comment">        // now make sure the function is listed in at least one service user is allowed to use</span>
<a name="l1717"><span class="linenum">1717</span></a>  <span class="comment">        // allow access only if:</span>
<a name="l1718"><span class="linenum">1718</span></a>  <span class="comment">        //  1/ entry in the external_services_users table if required</span>
<a name="l1719"><span class="linenum">1719</span></a>  <span class="comment">        //  2/ validuntil not reached</span>
<a name="l1720"><span class="linenum">1720</span></a>  <span class="comment">        //  3/ has capability if specified in service desc</span>
<a name="l1721"><span class="linenum">1721</span></a>  <span class="comment">        //  4/ iprestriction</span>
<a name="l1722"><span class="linenum">1722</span></a>  
<a name="l1723"><span class="linenum">1723</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a> = &quot;SELECT s.*, NULL AS iprestriction
<a name="l1724"><span class="linenum">1724</span></a>                    FROM {external_services} s
<a name="l1725"><span class="linenum">1725</span></a>                    JOIN {external_services_functions} sf <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (sf.externalserviceid = s.id AND s.restrictedusers = 0 AND sf.functionname = :name1)
<a name="l1726"><span class="linenum">1726</span></a>                   WHERE s.enabled = 1 <a class="var it4678" onMouseOver="hilite(4678)" onMouseOut="lolite()" onClick="logVariable('wscond1')" href="../_variables/wscond1.html">$wscond1</a>
<a name="l1727"><span class="linenum">1727</span></a>  
<a name="l1728"><span class="linenum">1728</span></a>                   UNION
<a name="l1729"><span class="linenum">1729</span></a>  
<a name="l1730"><span class="linenum">1730</span></a>                  SELECT s.*, su.iprestriction
<a name="l1731"><span class="linenum">1731</span></a>                    FROM {external_services} s
<a name="l1732"><span class="linenum">1732</span></a>                    JOIN {external_services_functions} sf <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (sf.externalserviceid = s.id AND s.restrictedusers = 1 AND sf.functionname = :name2)
<a name="l1733"><span class="linenum">1733</span></a>                    JOIN {external_services_users} su <a class="function" onClick="logFunction('ON')" href="../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (su.externalserviceid = s.id AND su.userid = :userid)
<a name="l1734"><span class="linenum">1734</span></a>                   WHERE s.enabled = 1 AND (su.validuntil IS NULL OR su.validuntil &lt; :now) <a class="var it4679" onMouseOver="hilite(4679)" onMouseOut="lolite()" onClick="logVariable('wscond2')" href="../_variables/wscond2.html">$wscond2</a>&quot;;
<a name="l1735"><span class="linenum">1735</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>, array('userid'=&gt;<a class="var it9" onMouseOver="hilite(9)" onMouseOut="lolite()" onClick="logVariable('USER')" href="../_variables/USER.html">$USER</a>-&gt;<a onClick="logVariable('id')" class="var it39490" onMouseOver="hilite(39490)" onMouseOut="lolite()" href="../_variables/id.html">id</a>, 'name1'=&gt;<a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('name')" class="var it40435" onMouseOver="hilite(40435)" onMouseOut="lolite()" href="../_variables/name.html">name</a>, 'name2'=&gt;<a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>-&gt;<a onClick="logVariable('name')" class="var it40435" onMouseOver="hilite(40435)" onMouseOut="lolite()" href="../_variables/name.html">name</a>, 'now'=&gt;<a class="phpfunction" onClick="logFunction('time')" href="../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()));
<a name="l1736"><span class="linenum">1736</span></a>  
<a name="l1737"><span class="linenum">1737</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> = <a class="var it2" onMouseOver="hilite(2)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_recordset_sql')" href="../_functions/get_recordset_sql.html" onMouseOver="funcPopup(event,'get_recordset_sql')">get_recordset_sql</a>(<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../_variables/sql.html">$sql</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>);
<a name="l1738"><span class="linenum">1738</span></a>  <span class="comment">        // now make sure user may access at least one service</span>
<a name="l1739"><span class="linenum">1739</span></a>          <a class="var it4680" onMouseOver="hilite(4680)" onMouseOut="lolite()" onClick="logVariable('remoteaddr')" href="../_variables/remoteaddr.html">$remoteaddr</a> = <a class="function" onClick="logFunction('getremoteaddr')" href="../_functions/getremoteaddr.html" onMouseOver="funcPopup(event,'getremoteaddr')">getremoteaddr</a>();
<a name="l1740"><span class="linenum">1740</span></a>          <a class="var it2730" onMouseOver="hilite(2730)" onMouseOut="lolite()" onClick="logVariable('allowed')" href="../_variables/allowed.html">$allowed</a> = false;
<a name="l1741"><span class="linenum">1741</span></a>          foreach (<a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a> as <a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>) {
<a name="l1742"><span class="linenum">1742</span></a>              if (<a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('requiredcapability')" class="var it40434" onMouseOver="hilite(40434)" onMouseOut="lolite()" href="../_variables/requiredcapability.html">requiredcapability</a> and !<a class="function" onClick="logFunction('has_capability')" href="../_functions/has_capability.html" onMouseOver="funcPopup(event,'has_capability')">has_capability</a>(<a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('requiredcapability')" class="var it40434" onMouseOver="hilite(40434)" onMouseOut="lolite()" href="../_variables/requiredcapability.html">requiredcapability</a>, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('restricted_context')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/restricted_context.html">restricted_context</a>)) {
<a name="l1743"><span class="linenum">1743</span></a>                  continue; <span class="comment">// cap required, sorry</span>
<a name="l1744"><span class="linenum">1744</span></a>              }
<a name="l1745"><span class="linenum">1745</span></a>              if (<a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it40434" onMouseOver="hilite(40434)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a> and !<a class="function" onClick="logFunction('address_in_subnet')" href="../_functions/address_in_subnet.html" onMouseOver="funcPopup(event,'address_in_subnet')">address_in_subnet</a>(<a class="var it4680" onMouseOver="hilite(4680)" onMouseOut="lolite()" onClick="logVariable('remoteaddr')" href="../_variables/remoteaddr.html">$remoteaddr</a>, <a class="var it98" onMouseOver="hilite(98)" onMouseOut="lolite()" onClick="logVariable('service')" href="../_variables/service.html">$service</a>-&gt;<a onClick="logVariable('iprestriction')" class="var it40434" onMouseOver="hilite(40434)" onMouseOut="lolite()" href="../_variables/iprestriction.html">iprestriction</a>)) {
<a name="l1746"><span class="linenum">1746</span></a>                  continue; <span class="comment">// wrong request source ip, sorry</span>
<a name="l1747"><span class="linenum">1747</span></a>              }
<a name="l1748"><span class="linenum">1748</span></a>              <a class="var it2730" onMouseOver="hilite(2730)" onMouseOut="lolite()" onClick="logVariable('allowed')" href="../_variables/allowed.html">$allowed</a> = true;
<a name="l1749"><span class="linenum">1749</span></a>              break; <span class="comment">// one service is enough, no need to continue</span>
<a name="l1750"><span class="linenum">1750</span></a>          }
<a name="l1751"><span class="linenum">1751</span></a>          <a class="var it519" onMouseOver="hilite(519)" onMouseOut="lolite()" onClick="logVariable('rs')" href="../_variables/rs.html">$rs</a>-&gt;<a class="function" onClick="logFunction('close')" href="../_functions/close.html" onMouseOver="funcPopup(event,'close')">close</a>();
<a name="l1752"><span class="linenum">1752</span></a>          if (!<a class="var it2730" onMouseOver="hilite(2730)" onMouseOut="lolite()" onClick="logVariable('allowed')" href="../_variables/allowed.html">$allowed</a>) {
<a name="l1753"><span class="linenum">1753</span></a>              throw <span class="keyword">new </span><a class="class" onClick="logClass('webservice_access_exception')" href="../_classes/webservice_access_exception.html" onMouseOver="classPopup(event,'webservice_access_exception')">webservice_access_exception</a>(
<a name="l1754"><span class="linenum">1754</span></a>                      'Access to the function '.<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('functionname')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/functionname.html">functionname</a>.'() is not allowed.
<a name="l1755"><span class="linenum">1755</span></a>                       There could be multiple reasons for this:
<a name="l1756"><span class="linenum">1756</span></a>                       1. The service linked to the user token does not contain the function.
<a name="l1757"><span class="linenum">1757</span></a>                       2. The service is user-restricted and the user is not listed.
<a name="l1758"><span class="linenum">1758</span></a>                       3. The service is IP-restricted and the user IP is not listed.
<a name="l1759"><span class="linenum">1759</span></a>                       4. The service is time-restricted and the time has expired.
<a name="l1760"><span class="linenum">1760</span></a>                       5. The token is time-restricted and the time has expired.
<a name="l1761"><span class="linenum">1761</span></a>                       6. The service requires a specific capability which the user does not have.
<a name="l1762"><span class="linenum">1762</span></a>                       7. The function is called with username/password (no user token is sent)
<a name="l1763"><span class="linenum">1763</span></a>                       and none of the services has the function to allow the user.
<a name="l1764"><span class="linenum">1764</span></a>                       These settings can be found in Administration &gt; Site administration
<a name="l1765"><span class="linenum">1765</span></a>                       &gt; Plugins &gt; Web services &gt; External services and Manage tokens.');
<a name="l1766"><span class="linenum">1766</span></a>          }
<a name="l1767"><span class="linenum">1767</span></a>  
<a name="l1768"><span class="linenum">1768</span></a>  <span class="comment">        // we have all we need now</span>
<a name="l1769"><span class="linenum">1769</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('function')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/function.html">function</a> = <a class="var it412" onMouseOver="hilite(412)" onMouseOut="lolite()" onClick="logVariable('function')" href="../_variables/function.html">$function</a>;
<a name="l1770"><span class="linenum">1770</span></a>      }
<a name="l1771"><span class="linenum">1771</span></a>  
<a name="l1772"><span class="linenum">1772</span></a>      <span class="comment">/**</span>
<a name="l1773"><span class="linenum">1773</span></a>  <span class="comment">     * Execute previously loaded function using parameters parsed from the request data.</span>
<a name="l1774"><span class="linenum">1774</span></a>  <span class="comment">     */</span>
<a name="l1775"><span class="linenum">1775</span></a>      protected function <a class="function" onClick="logFunction('execute')" href="../_functions/execute.html" onMouseOver="funcPopup(event,'execute')">execute</a>() {
<a name="l1776"><span class="linenum">1776</span></a>  <span class="comment">        // validate params, this also sorts the params properly, we need the correct order in the next part</span>
<a name="l1777"><span class="linenum">1777</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('call_user_func')" href="../_functions/call_user_func.html" onMouseOver="phpfuncPopup(event,'call_user_func')">call_user_func</a>(array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('function')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/function.html">function</a>-&gt;classname, 'validate_parameters'), <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('function')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/function.html">function</a>-&gt;parameters_desc, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('parameters')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/parameters.html">parameters</a>);
<a name="l1778"><span class="linenum">1778</span></a>  
<a name="l1779"><span class="linenum">1779</span></a>  <span class="comment">        // execute - yay!</span>
<a name="l1780"><span class="linenum">1780</span></a>          <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('returns')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/returns.html">returns</a> = <a class="phpfunction" onClick="logFunction('call_user_func_array')" href="../_functions/call_user_func_array.html" onMouseOver="phpfuncPopup(event,'call_user_func_array')">call_user_func_array</a>(array(<a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('function')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/function.html">function</a>-&gt;classname, <a class="var it4" onMouseOver="hilite(4)" onMouseOut="lolite()" onClick="logVariable('this')" href="../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('function')" class="var it39456" onMouseOver="hilite(39456)" onMouseOut="lolite()" href="../_variables/function.html">function</a>-&gt;methodname), <a class="phpfunction" onClick="logFunction('array_values')" href="../_functions/array_values.html" onMouseOver="phpfuncPopup(event,'array_values')">array_values</a>(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('params')" href="../_variables/params.html">$params</a>));
<a name="l1781"><span class="linenum">1781</span></a>      }
<a name="l1782"><span class="linenum">1782</span></a>  }
<a name="l1783"><span class="linenum">1783</span></a>  
<a name="l1784"><span class="linenum">1784</span></a>  
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'simpletest': ['simpletest', 'Execute test client WS request ', [['webservice','lib.php',782],['webservice/rest','locallib.php',244],['webservice/xmlrpc','locallib.php',121],['webservice/soap','locallib.php',313]], 1],
'instance_by_id': ['instance_by_id', 'Get a context instance as an object, from a given context id. ', [['lib','accesslib.php',5383]], 174],
'get_external_service_by_id': ['get_external_service_by_id', 'Get an external service for a given service id ', [['webservice','lib.php',619]], 2],
'trigger': ['trigger', '', [['lib/evalmath','evalmath.class.php',438],['lib/classes/event','base.php',682]], 778],
'get_user_ws_token': ['get_user_ws_token', 'Get a full database token record for a given token value ', [['webservice','lib.php',438]], 0],
'get_user_capabilities': ['get_user_capabilities', 'Get user capabilities (with context) Only useful for documentation purpose WARNING: do not use this "broken" function. It was created in the goal to display some capabilities required by users. In theory we should not need to display this kind of information as the front end does not display it itself. In pratice, admins would like the info, for more info you can follow: MDL-29962 ', [['webservice','lib.php',553]], 1],
'load_function_info': ['load_function_info', 'Fetches the function description from database, verifies user is allowed to use this function and loads all paremeters and return descriptions. ', [['webservice','lib.php',1689]], 1],
'add_external_service': ['add_external_service', 'Add a service It generates the timecreated field automatically. ', [['webservice','lib.php',675]], 1],
'get_ws_authorised_users': ['get_ws_authorised_users', 'Return list of allowed users with their options (ip/timecreated / validuntil...) for a given service ', [['webservice','lib.php',249]], 1],
'clean_returnvalue': ['clean_returnvalue', 'Clean response If a response attribute is unknown from the description, we just ignore the attribute. If a response attribute is incorrect, invalid_response_exception is thrown. Note: this function is similar to validate parameters, however it is distinct because parameters validation must be distinct from cleaning return values. ', [['lib','externallib.php',253]], 260],
'on': ['on', '', [['lib/requirejs','require.js',506]], 3494],
'init_zend_server': ['init_zend_server', 'Set up zend service class ', [['webservice','lib.php',1467],['webservice/amf','locallib.php',172],['webservice/xmlrpc','locallib.php',96],['webservice/soap','locallib.php',181]], 4],
'get_phpdoc_type': ['get_phpdoc_type', '', [['webservice','lib.php',1377]], 3],
'handle': ['handle', '', [['lib/editor/tinymce/tiny_mce/3.5.11/plugins/table','editor_plugin_src.js',1102],['lib/zend/Zend/Soap','Server.php',783],['lib/zend/Zend/Amf','Server.php',601],['lib/zend/Zend/Rest','Server.php',169],['lib/zend/Zend/Soap','AutoDiscover.php',452],['lib/xhprof/xhprof_html/jquery','jquery.tooltip.js',121],['lib/zend/Zend/XmlRpc','Server.php',314],['lib/zend/Zend/Server','Interface.php',76],['webservice/soap','locallib.php',77]], 20],
'send_headers': ['send_headers', 'Internal implementation - sending of page headers. ', [['webservice','lib.php',1504],['webservice/rest','locallib.php',173],['lib','weblib.php',1986]], 7],
'cast_objects_to_array': ['cast_objects_to_array', 'Recursive function to recurse down into a complex variable and convert all objects to arrays. ', [['webservice','lib.php',1445]], 3],
'exception_handler': ['exception_handler', 'Specialised exception handler, we can not use the standard one because it can not just print html to output. ', [['webservice','lib.php',1514],['webservice','lib.php',1655]], 0],
'user_login_webservice': ['user_login_webservice', 'Custom auth hook for web services. ', [['auth/webservice','auth.php',57]], 1],
'insert_record': ['insert_record', 'Insert a record into a table and return the "id" field if required. ', [['lib/dml','pgsql_native_moodle_database.php',883],['lib/dml','oci_native_moodle_database.php',1249],['lib/dml','sqlsrv_native_moodle_database.php',978],['lib/dml','mssql_native_moodle_database.php',898],['lib/dml','mysqli_native_moodle_database.php',1177],['lib/dml/tests','dml_test.php',5427],['lib/dml','pdo_moodle_database.php',386],['question/engine/upgrade','upgradelib.php',121]], 1512],
'remove_ws_authorised_user': ['remove_ws_authorised_user', 'Disallow a user to call a service ', [['webservice','lib.php',227]], 1],
'get_virtual_method_code': ['get_virtual_method_code', 'returns virtual method code ', [['webservice','lib.php',1279]], 1],
'has_capability': ['has_capability', 'Wrapper round the has_capability funciton that automatically passes in the quiz context. ', [['mod/quiz','attemptlib.php',299],['mod/quiz','attemptlib.php',884],['lib','accesslib.php',346]], 1929],
'is_enabled_auth': ['is_enabled_auth', 'Checks if a given plugin is in the list of enabled authentication plugins. ', [['lib','moodlelib.php',3580]], 30],
'get_missing_capabilities_by_users': ['get_missing_capabilities_by_users', 'Get missing user capabilities for a given service WARNING: do not use this "broken" function. It was created in the goal to display some capabilities required by users. In theory we should not need to display this kind of information as the front end does not display it itself. In pratice, admins would like the info, for more info you can follow: MDL-29962 ', [['webservice','lib.php',577]], 2],
'get_string': ['get_string', 'Return a core get_string() call ', [['lib/external','externallib.php',112],['lib','moodlelib.php',6538],['lib','moodlelib.php',9417],['lib/classes','string_manager_standard.php',280],['lib/classes','string_manager.php',38],['lib/classes','string_manager_install.php',95],['question/behaviour','behaviourbase.php',756]], 19235],
'get_recordset_sql': ['get_recordset_sql', 'Get a number of records as a moodle_recordset using a SQL statement. ', [['lib/dml','pgsql_native_moodle_database.php',688],['lib/dml','oci_native_moodle_database.php',1065],['lib/dml','sqlsrv_native_moodle_database.php',761],['lib/dml','mssql_native_moodle_database.php',687],['lib/dml','mysqli_native_moodle_database.php',985],['lib/dml/tests','dml_test.php',5423],['lib/dml','pdo_moodle_database.php',251]], 279],
'get_external_functions_by_enabled_services': ['get_external_functions_by_enabled_services', 'Get the functions of a service list (by shortname). It can return only enabled functions if required. ', [['webservice','lib.php',471]], 0],
'get_service_required_capabilities': ['get_service_required_capabilities', 'Get list of required capabilities of a service, sorted by functions Example of returned value: Array ( [moodle_group_create_groups] => Array ( [0] => moodle/course:managegroups ) ', [['webservice','lib.php',516]], 1],
'session_cleanup': ['session_cleanup', 'Future hook needed for emulated sessions. ', [['webservice','lib.php',1546],['webservice','lib.php',1676]], 4],
'get_records_select': ['get_records_select', 'Get a number of records as an array of objects which match a particular WHERE clause. ', [['lib/dml','moodle_database.php',1283]], 163],
'get_records': ['get_records', 'Get a number of records as an array of objects where all the given conditions met. ', [['lib/dml','moodle_database.php',1236],['lib','coursecatlib.php',654],['question','category_class.php',63]], 860],
'add_ws_authorised_user': ['add_ws_authorised_user', 'Allow user to call a service ', [['webservice','lib.php',216]], 1],
'set_field': ['set_field', 'Sets the custom profile field used for testing. ', [['availability/condition/profile/tests','condition_test.php',349],['lib/dml','moodle_database.php',1688]], 462],
'run': ['run', 'Process request from client. ', [['webservice','lib.php',802],['webservice','lib.php',1131],['webservice','lib.php',1604],['lib/behat/classes','behat_command.php',123],['lib/google/src/Google/Service','Dfareporting.php',552],['lib/zend/Zend/Service/Amazon/Ec2','Instance.php',66],['lib/jquery/ui-1.11.4','jquery-ui.js',15350],['lib/lessphp/Visitor','joinSelector.php',16],['lib/lessphp/Visitor','extendFinder.php',24],['lib/lessphp/Visitor','toCSS.php',20],['lib','componentlib.class.php',628],['lib/lessphp/Visitor','processExtends.php',16],['lib/minify/lib','CSSmin.php',54]], 118],
'authenticate_user': ['authenticate_user', 'Authenticate user (used by download/upload file scripts) ', [['webservice','lib.php',52],['webservice','lib.php',851]], 4],
'get_record': ['get_record', 'Get a single database record as an object where all the given conditions met. ', [['lib/dml','moodle_database.php',1413]], 2960],
'fault': ['fault', 'Generate a server fault ', [['lib/zend/Zend/Soap','Server.php',902],['lib/zend/Zend/Amf','Server.php',859],['lib/zend/Zend/Rest','Server.php',434],['lib/zend/Zend/Soap','AutoDiscover.php',440],['webservice/amf','locallib.php',191],['webservice/xmlrpc','locallib.php',39],['lib/zend/Zend/XmlRpc','Server.php',293],['lib/zend/Zend/Server','Interface.php',67],['webservice/soap','locallib.php',39]], 25],
'set_timeout': ['set_timeout', 'Set the the default timeout for fetching remote feeds ', [['lib/simplepie/library','SimplePie.php',769],['lib','externallib.php',162],['mnet/xmlrpc','client.php',34]], 6],
'record_exists': ['record_exists', 'Test whether a record exists in a table where all the given conditions met. ', [['lib/dml','moodle_database.php',1768]], 735],
'get_record_sql': ['get_record_sql', 'Get a single database record as an object using a SQL statement. ', [['lib/dml','oci_native_moodle_database.php',1035],['lib/dml','moodle_database.php',1457]], 140],
'set_web_service_call_settings': ['set_web_service_call_settings', 'Intercept some moodlewssettingXXX $_GET and $_POST parameter that are related to the web service call and are not the function parameters ', [['webservice','lib.php',1069]], 2],
'webservice_protocol_is_enabled': ['webservice_protocol_is_enabled', 'Check if a protocol is enabled ', [['webservice','lib.php',755]], 10],
'raise_memory_limit': ['raise_memory_limit', 'Function to raise the memory limit to a new value. Will respect the memory limit if it is higher, thus allowing settings in php.ini, apache conf or command line switches to override it. ', [['lib','setuplib.php',1139]], 56],
'session_exists': ['session_exists', 'Check the backend contains data for this session id. ', [['lib/classes/session','file.php',78],['lib/classes/session','database.php',84],['lib/classes/session','memcache.php',123],['lib/classes/session','manager.php',524],['lib/classes/session','memcached.php',127]], 13],
'set_legacy_logdata': ['set_legacy_logdata', 'Set the legacy data used for add_to_log(). ', [['lib/classes/event','tag_updated.php',76],['lib/classes/event','course_resources_list_viewed.php',78],['lib/classes/event','content_viewed.php',98],['lib/classes/event','course_category_updated.php',78],['lib/classes/event','webservice_login_failed.php',91],['lib/classes/event','role_capabilities_updated.php',83],['lib/classes/event','webservice_function_called.php',87],['mod/workshop/classes/event','assessable_uploaded.php',122],['mod/assign/classes/event','base.php',99],['lib/classes/event','course_updated.php',103]], 55],
'delete_user_ws_token': ['delete_user_ws_token', 'Delete a token ', [['webservice','lib.php',414]], 2],
'get_instance': ['get_instance', 'Returns the object of type gradingform_XXX_instance (where XXX is the plugin method name) ', [['grade/grading/form','lib.php',474],['blog','locallib.php',859],['question/engine','bank.php',445],['mod/assign','locallib.php',1164],['backup/util/helper','restore_logs_processor.class.php',69],['repository','lib.php',1135],['mnet/service/enrol','locallib.php',57],['lib','externallib.php',794],['backup/util/output','output_controller.class.php',53]], 393],
'address_in_subnet': ['address_in_subnet', 'Function to check the passed address is within the passed subnet ', [['lib','moodlelib.php',7996]], 80],
'service_function_exists': ['service_function_exists', 'Test whether an external function is already linked to a service ', [['webservice','lib.php',701]], 1],
'get_not_associated_external_functions': ['get_not_associated_external_functions', 'Get functions not included in a service ', [['webservice','lib.php',497]], 1],
'set_user': ['set_user', 'Set current user. ', [['lib/classes/session','manager.php',681]], 29],
'authenticate_by_token': ['authenticate_by_token', 'User authentication by token ', [['webservice','lib.php',1003]], 2],
'external_function_info': ['external_function_info', 'Returns detailed function information ', [['lib','externallib.php',28]], 9],
'add_record_snapshot': ['add_record_snapshot', 'Add cached data that will be most probably used in event observers. ', [['lib/classes/event','base.php',757]], 262],
'get_auth_plugin': ['get_auth_plugin', 'Returns an authentication plugin instance. ', [['lib','moodlelib.php',3596]], 76],
'get_external_function_by_id': ['get_external_function_by_id', 'Get an external function for a given function id ', [['webservice','lib.php',647]], 2],
'send_response': ['send_response', 'Send the result of function call to the WS client formatted as XML document. ', [['webservice/rest','locallib.php',97],['course','dnduploadlib.php',664]], 3],
'password_expire': ['password_expire', 'return number of days to user password expires ', [['lib','authlib.php',355],['auth/manual','auth.php',165],['auth/ldap','auth.php',629]], 8],
'list': ['list', '', [['mod/data/preset/imagegallery','jstemplate.js',9]], 1891],
'parse_request': ['parse_request', 'This method parses the $_POST and $_GET superglobals and looks for the following information: 1/ user authentication - username+password or token (wsusername, wspassword and wstoken parameters) ', [['webservice','lib.php',1474],['webservice/rest','locallib.php',51],['webservice/soap','locallib.php',218]], 4],
'add_external_function_to_service': ['add_external_function_to_service', 'Add a function to a service ', [['webservice','lib.php',661]], 1],
'create': ['create', 'Creates a new 2048 bit RSA key pair and returns a unique ID that can be used to reference this key pair when launching new instances. ', [['lib/zend/Zend/Service/Amazon/Ec2','Keypair.php',39],['lib/phpexcel/PHPExcel/Shared/PCLZip','pclzip.lib.php',271],['repository/filesystem','lib.php',283],['lib/zend/Zend/Service/Amazon/Ec2','Securitygroups.php',39],['lib/google/src/Google/Service','Gmail.php',670],['lib/google/src/Google/Service','Gmail.php',827],['course','lib.php',2874],['lib/classes/event','base.php',139],['lib/google/src/Google/Service','Genomics.php',618],['lib/google/src/Google/Service','Genomics.php',717],['lib/google/src/Google/Service','Genomics.php',850],['lib/google/src/Google/Service','Genomics.php',1313],['lib','modinfolib.php',1747],['calendar','lib.php',2651],['lib/zend/Zend/Service/Amazon','Sqs.php',82],['lib','weblib.php',3048],['mod/lesson','locallib.php',1013],['mod/lesson','locallib.php',2166],['mod/lesson','locallib.php',3203],['lib/google/src/Google/Service','Fitness.php',340],['lib/google/src/Google/Service','TagManager.php',1034],['lib/google/src/Google/Service','TagManager.php',1124],['lib/google/src/Google/Service','TagManager.php',1217],['lib/google/src/Google/Service','TagManager.php',1310],['lib/google/src/Google/Service','TagManager.php',1403],['lib/google/src/Google/Service','TagManager.php',1497],['lib/google/src/Google/Service','TagManager.php',1591],['lib/google/src/Google/Service','TagManager.php',1742],['lib/simplepie/library/SimplePie','Cache.php',95],['lib/htmlpurifier/HTMLPurifier','Config.php',114],['lib/htmlpurifier/HTMLPurifier','Lexer.php',53],['lib/google/src/Google/Service','Container.php',314],['lib/adodb','adodb-xmlschema03.inc.php',170],['lib/adodb','adodb-xmlschema03.inc.php',514],['lib/adodb','adodb-xmlschema03.inc.php',779],['lib/adodb','adodb-xmlschema03.inc.php',930],['lib/adodb','adodb-xmlschema03.inc.php',1228],['repository','lib.php',206],['repository','lib.php',1960],['mod/quiz','attemptlib.php',100],['mod/quiz','attemptlib.php',555],['lib/google/src/Google/Service','Games.php',1648],['lib/google/src/Google/Service','Games.php',2012],['lib/google/src/Google/Service','MapsEngine.php',1676],['lib/google/src/Google/Service','MapsEngine.php',1976],['lib/google/src/Google/Service','MapsEngine.php',2252],['lib/google/src/Google/Service','MapsEngine.php',2329],['lib/google/src/Google/Service','MapsEngine.php',2897],['lib/adodb','adodb-xmlschema.inc.php',152],['lib/adodb','adodb-xmlschema.inc.php',473],['lib/adodb','adodb-xmlschema.inc.php',738],['lib/adodb','adodb-xmlschema.inc.php',884],['lib/adodb','adodb-xmlschema.inc.php',1129],['lib/horde/framework/Horde/Imap/Client/Interaction','Server.php',65],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',81],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',58],['lib/google/src/Google/Service','Pubsub.php',219],['lib/google/src/Google/Service','Pubsub.php',364],['lib/htmlpurifier/HTMLPurifier','ElementDef.php',135],['lib/simplepie/library/SimplePie','Registry.php',153],['lib','navigationlib.php',266],['lib/google/src/Google/Service','Dns.php',282],['lib/google/src/Google/Service','Dns.php',355],['lib','coursecatlib.php',328],['mod/quiz/classes','structure.php',65]], 3074],
'optional_param': ['optional_param', 'Returns a particular value for the named variable, taken from POST or GET, otherwise returning a given default. ', [['lib','moodlelib.php',605]], 2167],
'enrol_check_plugins': ['enrol_check_plugins', 'Check all the login enrolment information for the given user object by querying the enrolment plugins ', [['lib','enrollib.php',186]], 8],
'service_class_method_body': ['service_class_method_body', 'You can override this function in your child class to add extra code into the dynamically created service class. For example it is used in the amf server to cast types of parameters and to cast the return value to the types as specified in the return value description. ', [['webservice','lib.php',1413],['webservice/amf','locallib.php',80]], 1],
'abort_all_db_transactions': ['abort_all_db_transactions', 'Unconditionally abort all database transactions, this function should be called from exception handlers only. ', [['lib','setuplib.php',398]], 4],
'get_token_by_id': ['get_token_by_id', 'Return a database token record for a token id ', [['webservice','lib.php',403]], 1],
'set_context_restriction': ['set_context_restriction', 'Set context restriction for all following subsequent function calls. ', [['lib','externallib.php',152]], 1],
'delete_service': ['delete_service', 'Delete a service Also delete function references and authorised user references. ', [['webservice','lib.php',424]], 1],
'get_ws_authorised_user': ['get_ws_authorised_user', 'Return an authorised user with their options (ip/timecreated / validuntil...) ', [['webservice','lib.php',272]], 3],
'is_siteadmin': ['is_siteadmin', 'Check if the user is an admin at the site level. ', [['lib','accesslib.php',604]], 92],
'__construct': ['__construct', 'Constructor ', [['lib/jabber/XMPP','Log.php',67],['lib/zend/Zend/Gdata/Books','VolumeFeed.php',41],['lib/markdown','MarkdownExtra.php',51],['lib/zend/Zend/Gdata/Books/Extension','BooksCategory.php',42],['lib/horde/framework/Horde/Support','Uuid.php',23],['lib/zend/Zend/Validate','Iban.php',106],['repository/wikimedia','wikimedia.php',35],['lib/lessphp/Tree','Operation.php',19],['lib/alfresco/Service','Version.php',38],['lib/filestorage','file_exceptions.php',36],['lib/filestorage','file_exceptions.php',57],['lib/filestorage','file_exceptions.php',89],['lib/filestorage','file_exceptions.php',108],['lib/filestorage','file_exceptions.php',129],['backup/moodle2','backup_activity_task.class.php',45],['lib/htmlpurifier/HTMLPurifier','AttrCollections.php',16],['lib/phpunit/classes','database_driver_testcase.php',55],['lib/google/src/Google/Service','Reseller.php',44],['lib/horde/framework/Horde/Imap/Client/Interaction/Command','Continuation.php',42],['lib/phpunit/classes','advanced_testcase.php',45],['lib/zend/Zend/Service/DeveloperGarden/Request','RequestAbstract.php',40],['lib','outputlib.php',447],['lib','outputlib.php',2000],['repository/filesystem','lib.php',48],['lib/zend/Zend/XmlRpc/Value','Nil.php',40],['lib/lessphp/Tree','NameValue.php',21],['lib/zend/Zend/Gdata/YouTube','UserProfileEntry.php',283],['lib/zend/Zend/Gdata/Gapps','EmailListRecipientEntry.php',69],['lib/simplepie/library/SimplePie','Restriction.php',81],['lib/filebrowser','file_info_context_course.php',39],['lib/filebrowser','file_info_context_course.php',492],['lib/filebrowser','file_info_context_course.php',596],['lib/filebrowser','file_info_context_course.php',745],['lib/minify/lib/MrClay/Cli','Arg.php',82],['lib/horde/framework/Horde/Crypt/Blowfish','Mcrypt.php',47],['lib/classes/update','checker.php',50],['lib/adodb','adodb-active-recordx.inc.php',131],['lib/phpexcel/PHPExcel','Calculation.php',1721],['lib/zend/Zend/Gdata/Photos/Extension','NumPhotos.php',50],['availability/classes','info_module.php',40],['lib/zend/Zend/Gdata/Geo/Extension','GmlPos.php',49],['lib/zend/Zend/Gdata/App/Extension','Link.php',49],['lib/zend/Zend/Gdata/Photos/Extension','Access.php',51],['lib/zend/Zend/Server/Reflection','Parameter.php',58],['lib/zend/Zend/Service/DeveloperGarden/Client','ClientAbstract.php',129],['lib/horde/framework/Horde/Imap/Client','DateTime.php',29],['lib/zend/Zend/Validate/Db','Abstract.php',79],['cache/locks/file','lib.php',66],['lib/phpexcel/PHPExcel/CachedObjectStorage','PHPTemp.php',180],['question/type/missingtype','edit_missingtype_form.php',38],['auth/cas/CAS/CAS','Client.php',862],['lib/horde/framework/Horde/Imap/Client/Data','Envelope.php',46],['lib/zend/Zend/Gdata/Books','VolumeQuery.php',46],['lib/minify/lib/Minify/Cache','XCache.php',22],['lib/zend/Zend/XmlRpc','Request.php',92],['lib/zend/Zend/Service/Delicious','Post.php',74],['lib/zend/Zend/Gdata/Extension','FeedLink.php',53],['lib/zend/Zend/Http/Client/Adapter','Socket.php',97],['lib/grade','grade_object.php',80],['lib/zend/Zend/Gdata/YouTube','ContactFeed.php',55],['backup/util/plan','base_plan.class.php',39],['backup/util/plan','base_plan.class.php',215],['mod/lti/service/toolsettings/classes/local/resource','systemsettings.php',43],['lib/google/src/Google/Auth','LoginTicket.php',35],['lib/phpexcel/PHPExcel/Reader/Excel5','Escher.php',84],['lib/zend/Zend/Service/DeveloperGarden/SecurityTokenServer','Cache.php',59],['question/type/randomsamatch','question.php',114],['lib/zend/Zend/Service/WindowsAzure/Storage','SignedIdentifier.php',49],['lib/zend/Zend/Amf/Parse','OutputStream.php',40],['blocks','moodleblock.class.php',111],['lib/simplepie','autoloader.php',62],['mod/scorm','renderer.php',129],['lib/zend/Zend/Gdata/Extension','Who.php',64],['lib/zend/Zend/Gdata/Gapps','EmailListQuery.php',54],['lib/zend/Zend/Service/Simpy','LinkSet.php',47],['repository/flickr_public','lib.php',49],['lib/horde/framework/Horde/Imap/Client/Base','Debug.php',55],['lib/google/src/Google/Service','Replicapoolupdater.php',47],['admin/tool/generator/classes','site_backend.php',58],['mod/assign','assignmentplugin.php',50],['mod/lti/service/toolsettings/classes/local/resource','linksettings.php',45],['mod/lti/service/profile/classes/local/resource','profile.php',43],['lib/htmlpurifier/HTMLPurifier/AttrDef','Integer.php',36],['lib/horde/framework/Horde/Mail/Transport','Smtpmx.php',138],['backup/util/structure','base_optigroup.class.php',35],['backup/util/structure','base_optigroup.class.php',169],['lib/lessphp/Tree','Anonymous.php',21],['user','renderer.php',186],['lib/zend/Zend/Service/WindowsAzure','Storage.php',170],['lib/google/src/Google','Service.php',26],['lib/lessphp/Tree','Url.php',17],['webservice','lib.php',745],['webservice','lib.php',841],['webservice','lib.php',1120],['lib/phpexcel/PHPExcel/Worksheet/AutoFilter/Column','Rule.php',270],['lib/zend/Zend/Gdata/YouTube/Extension','MediaContent.php',55],['lib/horde/framework/Horde/Support','Randomid.php',26],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','DenyElementDecorator.php',21],['lib/tests','completionlib_test.php',863],['lib/zend/Zend/Service/Amazon','Accessories.php',44],['lib/zend/Zend/Validate/Barcode','Code39ext.php',47],['mod/assign/feedback/editpdf/classes','comment.php',58],['lib/phpexcel/PHPExcel/Writer/PDF','mPDF.php',46],['backup/moodle2','backup_settingslib.php',42],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','GetConferenceTemplateListRequest.php',46],['lib/zend/Zend/XmlRpc/Value','Base64.php',40],['backup/util/structure','backup_structure_processor.class.php',45],['backup/util/structure','backup_structure_processor.class.php',133],['lib/zend/Zend/Service/WindowsAzure/Storage','Blob.php',117],['lib/lessphp','Parser.php',75],['lib/zend/Zend/Service/DeveloperGarden/Response/IpLocation','LocateIPResponse.php',47],['lib/zend/Zend/Gdata','Query.php',72],['lib/zend/Zend/Service/Technorati','TagResultSet.php',57],['lib/zend/Zend/Rest/Client','Result.php',42],['lib/lessphp/Tree','Call.php',19],['lib/zend/Zend/Server/Method','Callback.php',59],['lib/minify/lib/Minify/JS','ClosureCompiler.php',38],['mod/workshop/backup/moodle1','lib.php',308],['lib/zend/Zend/Gdata/YouTube','ActivityFeed.php',54],['admin/tool/log/store/database/classes/log','store.php',47],['lib/zend/Zend/Validate','Alpha.php',65],['lib/zend/Zend/Gdata','Gapps.php',109],['lib/zend/Zend/Service/Flickr','Result.php',174],['question/type/multianswer','edit_multianswer_form.php',58],['mod/assign/feedback/file','renderable.php',44],['lib/horde/framework/Horde','Secret.php',48],['lib/zend/Zend/Gdata/Photos/Extension','AlbumId.php',51],['lib/lessphp/SourceMap','Base64VLQ.php',67],['lib/lessphp/Tree/Mixin','Call.php',14],['auth/cas/CAS/CAS','GracefullTerminationException.php',48],['lib/google/src/Google/Service','Fusiontables.php',48],['grade/report/singleview','lib.php',69],['lib/classes/lock','lock.php',55],['grade/grading/form','lib.php',82],['grade/grading/form','lib.php',766],['blog','locallib.php',71],['blog','locallib.php',581],['blog','locallib.php',849],['blog','locallib.php',894],['blog','locallib.php',953],['blog','locallib.php',1004],['blog','locallib.php',1028],['blog','locallib.php',1038],['blog','locallib.php',1050],['blog','locallib.php',1071],['lib/zend/Zend/Gdata/Exif/Extension','Flash.php',49],['backup/cc/cc_lib','cc_general.php',38],['lib/phpexcel/PHPExcel/Shared/JAMA','Matrix.php',61],['admin/webservice','lib.php',38],['lib/zend/Zend/Validate/File','FilesSize.php',60],['lib/phpexcel/PHPExcel/Writer/PDF','DomPDF.php',46],['lib/horde/framework/Horde/Imap/Client/Data/Format','Nstring.php',27],['repository/boxnet','lib.php',56],['lib/htmlpurifier/HTMLPurifier','Language.php',63],['lib/zend/Zend/Validate','Int.php',53],['lib/horde/framework/Horde/Mail/Transport','Smtphorde.php',62],['lib/zend/Zend/Soap','Server.php',146],['lib/zend/Zend/Gdata/Photos','PhotoEntry.php',215],['lib/zend/Zend/Service/Yahoo','LocalResult.php',111],['lib/zend/Zend/Service/DeveloperGarden/Request/BaseUserService','GetAccountBalance.php',40],['badges/lib','backpacklib.php',40],['lib/zend/Zend/Service/Yahoo','Result.php',77],['lib/form','filemanager.php',306],['lib/lessphp/Tree','Condition.php',18],['lib/pear/PEAR','Exception.php',107],['lib/zend/Zend/Gdata/YouTube/Extension','Racy.php',45],['question/classes/bank','view.php',70],['lib/adodb','adodb.inc.php',2790],['lib/adodb','adodb.inc.php',2865],['lib/zend/Zend/Gdata/App/Extension','Text.php',45],['question/engine/upgrade/tests','helper.php',45],['lib/zend/Zend/Validate/Barcode','Ean5.php',47],['blocks/private_files','renderer.php',83],['backup/util/settings/section','section_backup_setting.class.php',25],['lib/classes','useragent.php',115],['lib/zend/Zend/Gdata/Photos/Extension','CommentCount.php',51],['lib/horde/framework/Horde/Imap/Client/Data/Format','String.php',38],['lib/zend/Zend/Gdata/Spreadsheets/Extension','ColCount.php',49],['lib/horde/framework/Horde/Translation/Handler','Gettext.php',34],['lib/portfolio','exceptions.php',50],['lib/zend/Zend/Gdata/Calendar/Extension','QuickAdd.php',45],['lib/xmldb','xmldb_object.php',55],['lib/zend/Zend/Service','SlideShare.php',283],['webservice/amf','introspector.php',52],['question/behaviour/adaptive','behaviour.php',310],['question/behaviour','behaviourtypebase.php',133],['admin/tool/assignmentupgrade','upgradableassignmentstable.php',49],['course','renderer.php',52],['lib/zend/Zend/Validate','Hostname.php',315],['lib/phpexcel/PHPExcel/CachedObjectStorage','Memcache.php',249],['lib/zend/Zend/Amf','Server.php',134],['enrol/imsenterprise','locallib.php',38],['enrol/imsenterprise','locallib.php',115],['lib/zend/Zend/Http','Cookie.php',98],['lib/lessphp/Tree','Extend.php',28],['lib/zend/Zend/Validate','Barcode.php',75],['lib/zend/Zend/XmlRpc/Value','BigInteger.php',47],['lib/google/src/Google/Service','DoubleClickBidManager.php',40],['lib/google/src/Google/Service','QPXExpress.php',39],['lib/zend/Zend/Server/Reflection/Function','Abstract.php',105],['lib/phpexcel/PHPExcel/Style','Color.php',72],['lib/zend/Zend/Validate/File','Hash.php',60],['backup/util/settings/root','root_backup_setting.class.php',34],['backup/cc/cc_lib','cc_converter_basiclti.php',29],['lib/zend/Zend/Gdata/Photos/Extension','QuotaCurrent.php',50],['lib/zend/Zend/Service/Nirvanix/Namespace','Base.php',76],['lib/horde/framework/Horde/Imap/Client/Fetch','Results.php',54],['lib/zend/Zend/Service/Technorati','DailyCountsResult.php',60],['lib/zend/Zend/Rest','Server.php',102],['lib/zend/Zend/Gdata/Photos','UserFeed.php',106],['lib/tcpdf/include/barcodes','pdf417.php',523],['lib/minify/lib/Minify/CSS','Compressor.php',51],['lib/zend/Zend/Gdata/YouTube/Extension','VideoId.php',44],['lib/google/src/Google/Service','Blogger.php',50],['mod/workshop/allocation/random','lib.php',52],['mod/workshop/allocation/random','lib.php',727],['lib/zend/Zend/Gdata/App/Extension','Published.php',43],['lib/google/src/Google/Service','Doubleclicksearch.php',43],['lib/htmlpurifier/HTMLPurifier/AttrTransform','Nofollow.php',16],['lib/phpexcel/PHPExcel/Shared/trend','powerBestFitClass.php',129],['lib/zend/Zend/Gdata/Photos','AlbumEntry.php',193],['lib/zend/Zend/Gdata/Docs','DocumentListFeed.php',56],['lib/zend/Zend/Gdata/App/Extension','Icon.php',43],['lib/portfolio','plugin.php',445],['lib/zend/Zend/Gdata/Extension','OpenSearchItemsPerPage.php',44],['lib/horde/framework/Horde/Exception','LastError.php',16],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','ID.php',28],['lib/zend/Zend/Service/Yahoo','WebResult.php',83],['lib/horde/framework/Horde/Imap/Client/Interaction','Client.php',34],['lib/google/src/Google/Service','AdExchangeBuyer.php',46],['lib/dtl','file_xml_database_exporter.php',36],['backup/cc','validator.php',30],['backup/cc','validator.php',116],['backup/cc','validator.php',202],['backup/cc','validator.php',230],['backup/cc','validator.php',236],['backup/cc','validator.php',242],['backup/cc','validator.php',248],['backup/cc','validator.php',254],['backup/cc','validator.php',260],['lib/zend/Zend/Gdata/YouTube/Extension','Token.php',44],['lib/phpexcel/PHPExcel/Worksheet','HeaderFooterDrawing.php',87],['lib/phpexcel/PHPExcel/Writer/PDF','tcPDF.php',47],['lib/xmldb','xmldb_field.php',84],['lib/phpexcel/PHPExcel/Writer','Excel2007.php',126],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','GetConferenceStatusRequest.php',65],['lib/google/src/Google/Service','Manager.php',57],['lib/zend/Zend/Service/Amazon','Offer.php',79],['lib/horde/framework/Horde/Imap/Client/Data/Format','Mailbox.php',35],['lib/zend/Zend/Gdata/App','FeedEntryParent.php',129],['lib/zend/Zend/Service/Technorati','KeyInfoResult.php',61],['lib/htmlpurifier/HTMLPurifier/TagTransform','Simple.php',19],['webservice/rest','lib.php',47],['lib/zend/Zend/Service/StrikeIron','Decorator.php',47],['lib/google/src/Google/Http','Batch.php',38],['lib/google/src/Google/Service','Reports.php',47],['auth/cas/CAS/CAS','OutOfSequenceBeforeAuthenticationCallException.php',47],['lib/zend/Zend/Gdata/Media/Extension','MediaKeywords.php',43],['repository/url','lib.php',46],['lib','xmlize.php',31],['mod/forum/classes','potential_subscriber_selector.php',47],['lib/filebrowser','file_info_context_system.php',37],['lib/zend/Zend/Service/Amazon','Abstract.php',74],['lib/zend/Zend/Server','Definition.php',43],['lib/minify/lib/Minify','ImportProcessor.php',48],['lib/zend/Zend/Amf/Util','BinaryStream.php',53],['lib/portfolio','exporter.php',113],['backup/cc/cc_lib','cc_converter_page.php',28],['lib/zend/Zend/Gdata/YouTube','SubscriptionFeed.php',55],['lib/alfresco/Service','SpacesStore.php',28],['repository/recent','lib.php',39],['lib/zend/Zend/Service/DeveloperGarden/IpLocation','IpAddress.php',59],['lib/zend/Zend/Validate','Regex.php',62],['lib/phpexcel/PHPExcel/Shared/trend','exponentialBestFitClass.php',135],['lib/phpexcel/PHPExcel','ReferenceHelper.php',65],['lib','webdavlib.php',84],['lib/htmlpurifier/HTMLPurifier/AttrTransform','TargetBlank.php',17],['auth/cas/CAS/CAS','AuthenticationException.php',53],['lib/zend/Zend/Gdata/Gapps','NicknameQuery.php',54],['lib/bennu','iCalendar_properties.php',28],['lib/bennu','iCalendar_properties.php',220],['lib/bennu','iCalendar_properties.php',238],['lib/bennu','iCalendar_properties.php',259],['lib/bennu','iCalendar_properties.php',275],['lib/bennu','iCalendar_properties.php',296],['lib/bennu','iCalendar_properties.php',343],['lib/bennu','iCalendar_properties.php',358],['lib/bennu','iCalendar_properties.php',376],['lib/bennu','iCalendar_properties.php',391],['lib/bennu','iCalendar_properties.php',406],['lib/bennu','iCalendar_properties.php',447],['lib/bennu','iCalendar_properties.php',462],['lib/bennu','iCalendar_properties.php',485],['lib/bennu','iCalendar_properties.php',509],['lib/bennu','iCalendar_properties.php',524],['lib/bennu','iCalendar_properties.php',555],['lib/bennu','iCalendar_properties.php',573],['lib/bennu','iCalendar_properties.php',594],['lib/bennu','iCalendar_properties.php',637],['lib/bennu','iCalendar_properties.php',680],['lib/bennu','iCalendar_properties.php',724],['lib/bennu','iCalendar_properties.php',747],['lib/bennu','iCalendar_properties.php',782],['lib/bennu','iCalendar_properties.php',808],['lib/bennu','iCalendar_properties.php',849],['lib/bennu','iCalendar_properties.php',864],['lib/bennu','iCalendar_properties.php',905],['lib/bennu','iCalendar_properties.php',938],['lib/bennu','iCalendar_properties.php',952],['lib/bennu','iCalendar_properties.php',965],['lib/bennu','iCalendar_properties.php',987],['lib/bennu','iCalendar_properties.php',1017],['lib/bennu','iCalendar_properties.php',1031],['lib/bennu','iCalendar_properties.php',1061],['lib/bennu','iCalendar_properties.php',1075],['lib/bennu','iCalendar_properties.php',1098],['lib/bennu','iCalendar_properties.php',1110],['lib/bennu','iCalendar_properties.php',1139],['lib/bennu','iCalendar_properties.php',1160],['lib/bennu','iCalendar_properties.php',1181],['lib/bennu','iCalendar_properties.php',1203],['lib/bennu','iCalendar_properties.php',1227],['lib/bennu','iCalendar_properties.php',1260],['lib/bennu','iCalendar_properties.php',1386],['lib/bennu','iCalendar_properties.php',1407],['lib/bennu','iCalendar_properties.php',1429],['lib/bennu','iCalendar_properties.php',1450],['lib/phpexcel/PHPExcel/Calculation','ExceptionHandler.php',36],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Mongo.php',78],['lib/horde/framework/Horde','Domhtml.php',53],['auth/cas/CAS/CAS','OutOfSequenceBeforeProxyException.php',48],['lib/simplepie/library/SimplePie/Parse','Date.php',536],['lib/google/src/Google/Service','Customsearch.php',38],['lib/zend/Zend/Gdata/App','MediaFileSource.php',54],['backup/util/plan','restore_step.class.php',32],['backup/util/plan','restore_step.class.php',104],['lib/lessphp/Tree','Comment.php',17],['availability/tests/fixtures','mock_info.php',40],['lib/htmlpurifier/HTMLPurifier/AttrTransform','EnumToCSS.php',34],['backup/util/ui','base_ui.class.php',84],['lib/phpexcel/PHPExcel','DocumentSecurity.php',73],['lib/htmlpurifier/HTMLPurifier/AttrDef/URI','Host.php',15],['backup/cc/cc_lib','cc_converter_lti.php',29],['lib/zend/Zend/Gdata/YouTube/Extension','Position.php',44],['lib/zend/Zend/Service/WindowsAzure/Credentials','CredentialsAbstract.php',77],['lib/zend/Zend/Soap','AutoDiscover.php',94],['lib/htmlpurifier/HTMLPurifier','URI.php',58],['lib/phpexcel/PHPExcel','IOFactory.php',77],['lib/zend/Zend/Gdata/App/Extension','Email.php',43],['lib/zend/Zend/Gdata/Media/Extension','MediaHash.php',45],['lib/zend/Zend/Gdata/App/Extension','Element.php',42],['lib/google/src/Google/Service','Gmail.php',55],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Multiple.php',33],['repository/dropbox','lib.php',49],['lib/minify/lib/Minify','Source.php',43],['backup/util/dbops','backup_dbops.class.php',37],['lib/google/src/Google/Service','Plus.php',52],['lib/horde/framework/Horde/Imap/Client/Data/Format','List.php',28],['lib/google/src/Google/Service','Spectrum.php',38],['files','renderer.php',1080],['lib/zend/Zend/Validate/Barcode','Ean2.php',47],['course','lib.php',2932],['lib/horde/framework/Horde/Support','ConsistentHash.php',56],['lib/zend/Zend/Service/Simpy','Watchlist.php',89],['lib/phpexcel/PHPExcel','Style.php',101],['lib/zend/Zend/Gdata/YouTube/Extension','CountHint.php',44],['lib/minify/lib/Minify/Cache','Memcache.php',22],['auth/db','auth.php',36],['lib/zend/Zend/Gdata/Gapps','UserQuery.php',54],['admin/roles/classes','assign_user_selector_base.php',40],['lib/zend/Zend/Gdata/Exif/Extension','Model.php',49],['lib/zend/Zend/Gdata/YouTube','PlaylistListFeed.php',55],['lib/zend/Zend/Gdata/Docs','DocumentListEntry.php',42],['mod/quiz/tests','repaginate_test.php',39],['question/engine','questionusage.php',78],['question/engine','questionusage.php',973],['lib/simplepie/library/SimplePie/Cache','MySQL.php',80],['lib/zend/Zend/Service/Twitter','Search.php',70],['lib/zend/Zend/Server/Method','Parameter.php',59],['lib/phpunit/classes','basic_testcase.php',39],['lib/zend/Zend/Service/WindowsAzure/Storage','BlobContainer.php',50],['lib/zend/Zend/Service/DeveloperGarden/Response/LocalSearch','LocalSearchResponse.php',50],['lib/horde/framework/Horde/Imap/Client','Ids.php',78],['mod/wiki/parser/markups','html.php',18],['lib/google/src/Google/Service','Mirror.php',49],['lib/classes/event','base.php',114],['lib/alfresco/Service','Repository.php',36],['lib/zend/Zend/Service/Technorati','CosmosResult.php',84],['backup/moodle2','backup_xml_transformer.class.php',50],['lib/phpexcel/PHPExcel/Reader/Excel5','RC4.php',42],['lib/zend/Zend/Service/Yahoo','PageDataResult.php',47],['lib/zend/Zend/Service/WindowsAzure/Storage','Table.php',99],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','UpdateConferenceTemplateRequest.php',60],['lib/phpexcel/PHPExcel/Shared/JAMA','EigenvalueDecomposition.php',775],['lib/tcpdf','tcpdf_parser.php',92],['lib/minify/lib/Minify/Cache','APC.php',19],['lib/zend/Zend/Gdata','MimeBodyString.php',49],['lib/phpexcel/PHPExcel/Reader','OOCalc.php',55],['lib/phpexcel/PHPExcel/Calculation','FormulaParser.php',92],['lib/google/src/Google/Http','MediaFileUpload.php',73],['lib/zend/Zend/XmlRpc/Client','ServerProxy.php',54],['lib','listlib.php',82],['lib','listlib.php',485],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Background.php',20],['lib/zend/Zend/Gdata/Health','ProfileFeed.php',49],['lib/google/src/Google/Service','Genomics.php',60],['lib/google/src/Google/Service','Urlshortener.php',40],['lib/zend/Zend/Server/Reflection','Method.php',51],['lib/tests','medialib_test.php',631],['lib/htmlpurifier/HTMLPurifier/ChildDef','Required.php',23],['lib/zend/Zend/Soap/Client','DotNet.php',43],['admin/roles/classes','allow_role_page.php',37],['backup/util/dbops','restore_dbops.class.php',1755],['lib/zend/Zend/Service/Yahoo','NewsResult.php',97],['backup/util/plan','restore_task.class.php',32],['backup/util/plan','restore_task.class.php',121],['webservice/rest','locallib.php',40],['lib/simplepie/library/SimplePie','Sanitize.php',75],['lib','uploadlib.php',40],['lib/zend/Zend/Gdata','Health.php',109],['lib','questionlib.php',1269],['lib','questionlib.php',1513],['lib/dml','oci_native_moodle_recordset.php',34],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','RemoveParticipantRequest.php',53],['lib/zend/Zend/XmlRpc/Value','String.php',38],['lib/zend/Zend/Gdata/Calendar/Extension','AccessLevel.php',45],['lib/ddl','database_manager.php',48],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','CreateConferenceTemplateRequest.php',60],['backup/util/xml/parser','progressive_parser.class.php',79],['backup/util/xml/parser','progressive_parser.class.php',305],['backup/util/settings','base_setting.class.php',89],['backup/util/settings','base_setting.class.php',556],['lib/dtl','database_exporter.php',55],['mod/workshop/form/accumulative','lib.php',99],['lib/htmlpurifier/HTMLPurifier','HTMLDefinition.php',182],['grade/report/singleview/classes/local/ui','bulk_insert.php',40],['lib/zend/Zend/Validate','Float.php',53],['lib/zend/Zend/Gdata/Gapps/Extension','EmailList.php',59],['cache/classes','interfaces.php',473],['lib/zend/Zend/Gdata/App/Extension','Edited.php',43],['lib/zend/Zend/Gdata/Gapps','UserEntry.php',103],['lib/lessphp/Tree','Element.php',19],['lib','moodlelib.php',9143],['lib','moodlelib.php',9354],['repository/picasa','lib.php',41],['webservice/soap','lib.php',42],['lib/zend/Zend/Gdata/Calendar','EventEntry.php',71],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Border.php',18],['lib/phpexcel/PHPExcel/Shared/trend','linearBestFitClass.php',98],['backup/cc/cc_lib','cc_assesment_essay.php',25],['lib/zend/Zend/Service/WindowsAzure/RetryPolicy','RetryN.php',56],['lib/dml','moodle_temptables.php',51],['lib/zend/Zend/Gdata/Media/Extension','MediaContent.php',116],['lib/zend/Zend/Gdata/Gapps','EmailListEntry.php',80],['admin/roles/classes','allow_assign_page.php',31],['lib/zend/Zend/Gdata','Books.php',80],['lib/zend/Zend/Amf/Value','MessageHeader.php',64],['lib/zend/Zend/Validate','GreaterThan.php',59],['lib/zend/Zend/Gdata/YouTube/Extension','PlaylistId.php',44],['calendar/classes','rrule_manager.php',182],['lib/phpexcel/PHPExcel/Worksheet','Drawing.php',45],['lib/zend/Zend/Service/ReCaptcha','Response.php',53],['lib/simplepie/library/SimplePie/HTTP','Parser.php',131],['lib/phpexcel/PHPExcel/Style','NumberFormat.php',106],['lib/zend/Zend/Amf/Value/Messaging','RemotingMessage.php',58],['lib/tcpdf','tcpdf.php',1822],['lib/zend/Zend/Gdata/YouTube/Extension','Username.php',44],['lib/zend/Zend/Gdata/Photos/Extension','Version.php',51],['lib/htmlpurifier/HTMLPurifier/AttrTransform','Input.php',14],['lib/zend/Zend/Service/WindowsAzure/Storage','Batch.php',77],['lib/mustache/src/Mustache','Engine.php',61],['lib/xmldb','xmldb_structure.php',40],['lib/zend/Zend/Gdata/Photos','TagEntry.php',61],['webservice/amf','locallib.php',41],['webservice/amf','locallib.php',60],['lib/htmlpurifier/HTMLPurifier/ChildDef','Chameleon.php',36],['lib/horde/framework/Horde/Imap/Client','Base.php',153],['question/type/numerical/tests','form_test.php',40],['lib/google/src/Google/Service','IdentityToolkit.php',38],['comment','locallib.php',39],['lib/zend/Zend/Gdata/Extension','Comments.php',50],['lib/google/src/Google/Service','Resource.php',60],['lib/horde/framework/Horde/Imap/Client/Socket','Catenate.php',37],['lib/zend/Zend/Gdata/YouTube/Extension','Recorded.php',44],['lib/zend/Zend/Amf/Request','Http.php',46],['backup/util/settings','setting_dependency.class.php',68],['backup/util/settings','setting_dependency.class.php',175],['backup/util/settings','setting_dependency.class.php',328],['backup/util/settings','setting_dependency.class.php',439],['backup/util/settings','setting_dependency.class.php',465],['backup/util/settings','setting_dependency.class.php',491],['backup/util/settings','setting_dependency.class.php',556],['question/engine/upgrade','behaviourconverters.php',78],['lib/zend/Zend/Service/DeveloperGarden/ConferenceCall','ParticipantDetail.php',62],['repository/s3','lib.php',39],['lib/minify/lib/MrClay','Cli.php',74],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','AlphaValue.php',6],['lib/horde/framework/Horde/Imap/Client','Tokenize.php',67],['lib/zend/Zend/Gdata/App','HttpException.php',51],['lib/zend/Zend/Soap/Client','Common.php',40],['lib/google/src/Google/Service','Dfareporting.php',45],['lib/lessphp/Output','Mapped.php',39],['lib/classes/output','notification.php',66],['lib/google/src/Google/Service','PlusDomains.php',72],['backup/util/plan','base_task.class.php',40],['backup/util/plan','base_task.class.php',277],['lib/editor/tinymce','adminlib.php',36],['lib/zend/Zend/Service/Amazon/Ec2','Exception.php',41],['lib/phpexcel/PHPExcel/Cell','Hyperlink.php',52],['lib/simplepie/library/SimplePie','Locator.php',68],['lib/phpexcel/PHPExcel/Chart/Renderer','jpgraph.php',846],['lib/xmldb','xmldb_key.php',43],['user/filters','checkbox.php',51],['lib/phpexcel/PHPExcel/Reader','SYLK.php',75],['question/type/numerical','questiontype.php',507],['backup/cc/cc_lib','cc_converter_url.php',29],['lib/zend/Zend/Gdata/App/Extension','Control.php',50],['lib/minify/lib','FirePHP.php',189],['lib/lessphp/Tree/Mixin','Definition.php',18],['lib/zend/Zend/Service/Yahoo','LocalResultSet.php',61],['lib','ddllib.php',80],['lib','ddllib.php',93],['lib','ddllib.php',107],['lib','ddllib.php',126],['lib','ddllib.php',140],['admin/tool/langimport/classes','controller.php',48],['lib/google/src/Google/Auth','AssertionCredentials.php',53],['lib/horde/framework/Horde/Stream','String.php',27],['lib','excellib.class.php',47],['lib','excellib.class.php',155],['lib','excellib.class.php',454],['lib/horde/framework/Horde/Stream','Temp.php',25],['lib/alfresco/Service','VersionHistory.php',34],['lib/zend/Zend/Service/DeveloperGarden/ConferenceCall','ConferenceSchedule.php',81],['mod/quiz/classes','repaginate.php',49],['lib/zend/Zend/Validate','Isbn.php',65],['lib/zend/Zend/Service/Amazon','Image.php',55],['backup/util/ui','restore_ui_components.php',81],['backup/util/ui','restore_ui_components.php',287],['backup/util/ui','restore_ui_components.php',382],['lib/classes/lock','db_record_lock_factory.php',61],['lib/horde/framework/Horde/Stream','TempString.php',40],['lib/htmlpurifier/HTMLPurifier/ConfigSchema','InterchangeBuilder.php',15],['lib/htmlpurifier/HTMLPurifier/ChildDef','Empty.php',22],['lib/zend/Zend/Gdata/Spreadsheets/Extension','Cell.php',76],['question/type/calculated','question.php',188],['question/type/calculated','question.php',303],['lib/horde/framework/Horde/Text','Flowed.php',75],['lib/horde/framework/Horde/Imap/Client/Data/Format','Date.php',25],['lib/zend/Zend/Gdata/Gapps/Extension','Login.php',111],['mod/workshop/form/rubric','lib.php',105],['cohort','locallib.php',37],['cohort','locallib.php',101],['lib/zend/Zend/XmlRpc/Value','DateTime.php',53],['lib/zend/Zend/Service/WindowsAzure/Storage','QueueMessage.php',52],['lib/htmlpurifier/HTMLPurifier','Queue.php',24],['lib/zend/Zend/Amf/Parse','Serializer.php',40],['lib/google/src/Google/Service','GroupsMigration.php',38],['lib/phpexcel/PHPExcel/Worksheet','PageSetup.php',277],['lib/zend/Zend/Gdata/Gapps','ServiceException.php',61],['lib/htmlpurifier/HTMLPurifier','AttrTypes.php',14],['lib/zend/Zend/XmlRpc','Fault.php',100],['lib/zend/Zend/Gdata','Photos.php',124],['question/type/calculated','datasetdefinitions_form.php',53],['lib/phpexcel/PHPExcel/Reader','Excel5.php',424],['question/type/shortanswer','question.php',43],['backup/util/structure','base_final_element.class.php',38],['backup/util/structure','base_final_element.class.php',239],['backup/util/structure','base_final_element.class.php',256],['lib/zend/Zend/Service','LiveDocx.php',67],['backup/util/plan','backup_plan.class.php',36],['backup/util/plan','backup_plan.class.php',130],['lib/google/src/Google/Auth','AppIdentity.php',38],['lib/zend/Zend/Gdata/Exif/Extension','FocalLength.php',49],['lib/zend/Zend/Gdata/App/Extension','Id.php',43],['lib/zend/Zend/Gdata/Books/Extension','PreviewLink.php',42],['mod/chat','locallib.php',179],['mod/chat','locallib.php',227],['lib/google/src/Google/Service','Licensing.php',38],['auth/cas/CAS/CAS/PGTStorage','File.php',105],['lib/zend/Zend/Server/Method','Definition.php',64],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','GetParticipantStatusRequest.php',53],['question/classes/bank','column_base.php',44],['lib/zend/Zend/XmlRpc/Server','Fault.php',67],['lib/zend/Zend/Amf/Value/Messaging','AcknowledgeMessage.php',40],['grade/report/singleview/classes/local/ui','range.php',38],['lib/zend/Zend/Gdata/Books/Extension','Viewability.php',45],['mod/book','locallib.php',405],['lib/zend/Zend/XmlRpc/Value','Array.php',39],['lib/zend/Zend/Service/Technorati','Result.php',63],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','RemoveConferenceTemplateRequest.php',46],['lib/zend/Zend/Gdata/Exif/Extension','Exposure.php',49],['lib/zend/Zend/Gdata/Exif','Feed.php',58],['question/type/randomsamatch/tests','helper.php',121],['lib/htmlpurifier/HTMLPurifier','PropertyListIterator.php',22],['question/engine/upgrade','logger.php',42],['question/engine/upgrade','logger.php',87],['lib/portfolio/formats/leap2a','lib.php',62],['lib/portfolio/formats/leap2a','lib.php',258],['lib/portfolio/formats/leap2a','lib.php',503],['lib/zend/Zend/Gdata/Spreadsheets','CellEntry.php',49],['lib/zend/Zend/Gdata/Photos/Extension','PhotoId.php',49],['lib/zend/Zend/Http/Response','Stream.php',120],['lib','modinfolib.php',429],['lib','modinfolib.php',1680],['lib','modinfolib.php',2516],['lib/dtl','database_importer.php',61],['lib/tcpdf','tcpdf_barcodes_2d.php',58],['lib/zend/Zend/Gdata/Exif/Extension','Iso.php',49],['lib/zend/Zend/Gdata/YouTube','VideoQuery.php',48],['lib/lessphp/Tree','Variable.php',20],['backup/moodle2','restore_activity_task.class.php',48],['lib/htmlpurifier/HTMLPurifier/AttrTransform','ImgSpace.php',24],['lib/google/src/Google/Signer','P12.php',33],['lib/lessphp/Tree','DetachedRuleset.php',15],['lib/zend/Zend/Gdata/YouTube','SubscriptionEntry.php',138],['lib/zend/Zend/Http/Client/Adapter','Test.php',81],['','mdeploy.php',120],['lib/ddl','sqlite_sql_generator.php',73],['lib/google/src/Google/Service','Drive.php',70],['mod/quiz/classes','admin_review_setting.php',82],['lib','pdflib.php',161],['lib/zend/Zend/Gdata/YouTube/Extension','Duration.php',45],['mod/quiz/report','attemptsreport_options.php',95],['lib/zend/Zend/Validate/File','Md5.php',60],['backup/util/helper','restore_questions_parser_processor.class.php',42],['lib/horde/framework/Horde/Imap/Client/Exception','SearchCharset.php',34],['lib/filebrowser','file_info_context_coursecat.php',39],['badges','renderer.php',972],['badges','renderer.php',1013],['badges','renderer.php',1077],['badges','renderer.php',1110],['badges','renderer.php',1136],['lib/horde/framework/Horde/Imap/Client','Socket.php',168],['lib/htmlpurifier/HTMLPurifier/ConfigSchema/Interchange','Id.php',17],['lib/zend/Zend/Gdata/Gapps/Extension','Nickname.php',59],['lib/zend/Zend/Gdata/YouTube/Extension','MediaRating.php',54],['lib/htmlpurifier/HTMLPurifier','UnitConverter.php',50],['mnet/xmlrpc','serverlib.php',674],['completion','data_object.php',68],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Filter.php',15],['lib/horde/framework/Horde/Support','StringStream.php',30],['lib/simplepie/library/SimplePie','gzdecode.php',186],['lib/jabber/XMPP','Roster.php',48],['lib/classes/dml','recordset_walk.php',64],['lib','dmllib.php',69],['lib','dmllib.php',84],['lib','dmllib.php',104],['lib','dmllib.php',129],['lib','dmllib.php',159],['lib','dmllib.php',187],['lib','dmllib.php',240],['lib','dmllib.php',270],['lib/phpexcel/PHPExcel/Worksheet','BaseDrawing.php',129],['lib/google/src/Google/Service','Books.php',57],['mod/assign/feedback/offline','importgradeslib.php',60],['lib/zend/Zend/Gdata','App.php',165],['lib/pear/Net','GeoIP.php',323],['lib/zend/Zend/Gdata/Photos/Extension','Name.php',50],['lib/google/src/Google/Service','AdExchangeSeller.php',53],['lib/zend/Zend/Gdata/Docs','Query.php',75],['lib/zend/Zend/Gdata/YouTube/Extension','Occupation.php',44],['lib/zend/Zend/Gdata/Exif/Extension','Time.php',49],['cache/tests/fixtures','lib.php',325],['lib/horde/framework/Horde/Mail/Rfc822','List.php',61],['lib/google/src/Google/Cache','Memcache.php',42],['lib/dml','sqlsrv_native_moodle_database.php',47],['backup/util/structure','backup_optigroup_element.class.php',51],['backup/cc/cc_lib','cc_converter_resource.php',28],['lib/simplepie/library/SimplePie','Caption.php',98],['mod/lti','OAuth.php',73],['mod/lti','OAuth.php',89],['mod/lti','OAuth.php',244],['mod/lti','OAuth.php',499],['lib/classes','collator.php',58],['lib/zend/Zend/Service/Delicious','PostList.php',56],['lib/classes/output','mustache_filesystem_loader.php',39],['lib/zend/Zend/Service/Amazon/Ec2','Abstract.php',91],['backup/util/xml/parser/processors','grouped_parser_processor.class.php',67],['mod/workshop/form/numerrors','lib.php',102],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','GetConferenceTemplateRequest.php',46],['report/log/classes','table_log.php',52],['lib/zend/Zend/Gdata/YouTube','CommentEntry.php',48],['lib/simplepie/library/SimplePie/Cache','Base.php',70],['lib/zend/Zend/Gdata/YouTube/Extension','Status.php',44],['lib/adodb','adodb-exceptions.inc.php',28],['backup/util/helper','backup_array_iterator.class.php',39],['lib/zend/Zend/Rest','Client.php',54],['lib/zend/Zend/Gdata/YouTube/Extension','Company.php',44],['question/classes/statistics/responses','analysis_for_class.php',68],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','RemoveConferenceTemplateParticipantRequest.php',53],['question/engine','lib.php',770],['question/engine','lib.php',1000],['question/engine','lib.php',1048],['lib/tcpdf','tcpdf_barcodes_1d.php',58],['lib/google/src/Google/Service','Bigquery.php',59],['backup/moodle2','restore_course_task.class.php',41],['lib/zend/Zend/Gdata/Media/Extension','MediaRestriction.php',54],['lib/htmlpurifier/HTMLPurifier','DefinitionCache.php',22],['lib/phpexcel/PHPExcel/Writer','CSV.php',86],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Hashtable.php',73],['cache','disabledlib.php',44],['lib/htmlpurifier/HTMLPurifier','PercentEncoder.php',20],['lib/mustache/src/Mustache/Exception','UnknownTemplateException.php',22],['webservice/xmlrpc','locallib.php',85],['lib/google/src/Google/Service','Freebase.php',38],['mod/lti/service/profile/classes/local/service','profile.php',41],['admin/tool/monitor/classes/output/managesubs','rules.php',56],['backup/util/settings','backup_setting.class.php',43],['grade/report/singleview/classes/local/ui','checkbox_attribute.php',42],['lib/alfresco/Service','ContentData.php',38],['enrol/ldap','lib.php',36],['lib/zend/Zend/Validate/File','MimeType.php',112],['lib/zend/Zend/Gdata/Gbase/Extension','BaseAttribute.php',47],['lib/zend/Zend/Gdata/Gapps','NicknameEntry.php',79],['lib/minify/lib/Minify','HTML.php',49],['lib/zend/Zend/Gdata/Extension','OriginalEvent.php',56],['lib/zend/Zend/Gdata/YouTube','InboxFeed.php',55],['lib/google/src/Google/Service','Groupssettings.php',40],['availability/classes','info.php',55],['lib/horde/framework/Horde/Mail/Rfc822','Group.php',45],['lib/tests','navigationlib_test.php',472],['lib/tests','navigationlib_test.php',530],['lib/tests','navigationlib_test.php',557],['lib/zend/Zend/Service/DeveloperGarden/Request/IpLocation','LocateIPRequest.php',58],['mod/quiz/report/statistics/classes','calculated.php',43],['grade/report/singleview/classes/local/ui','dropdown_attribute.php',49],['cache/stores/memcached','lib.php',107],['lib/zend/Zend/Validate','Between.php',89],['lib/zend/Zend/Gdata/Media/Extension','MediaGroup.php',183],['user/selector','lib.php',85],['user/selector','lib.php',674],['lib/google/src/Google/Service','YouTube.php',68],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Length.php',23],['lib/zend/Zend/Gdata','Exif.php',51],['backup/util/helper','backup_helper.class.php',380],['backup/util/plan','backup_step.class.php',32],['backup/util/plan','backup_step.class.php',55],['backup/util/helper','restore_inforef_parser_processor.class.php',37],['lib/phpexcel/PHPExcel/Cell','DataValidation.php',154],['lib/phpexcel/PHPExcel/CalcEngine','Logger.php',71],['lib/zend/Zend/Gdata','YouTube.php',192],['lib/zend/Zend/Gdata/Calendar/Extension','Link.php',48],['blocks','edit_form.php',47],['lib/dml','mssql_native_moodle_recordset.php',34],['mod/assign','locallib.php',149],['mod/assign','locallib.php',7411],['grade/report/user','lib.php',188],['lib/zend/Zend/Validate/Barcode','Code93ext.php',47],['lib/zend/Zend/Service/DeveloperGarden/Request/BaseUserService','ChangeQuotaPool.php',47],['lib/phpexcel/PHPExcel/CachedObjectStorage','SQLite3.php',294],['lib/horde/framework/Horde/Mail/Transport','Mail.php',53],['lib/zend/Zend/Gdata','Media.php',51],['lib/zend/Zend/Gdata/Gapps/Extension','Quota.php',59],['lib/zend/Zend/Amf/Value','ByteArray.php',38],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','Bool.php',22],['lib/simplepie/library/SimplePie/Cache','File.php',82],['lib/behat/form_field','behat_form_field.php',59],['mod/lti/service/toolproxy/classes/local/resource','toolproxy.php',47],['backup/moodle2','restore_subplugin.class.php',45],['lib/zend/Zend/Gdata/Spreadsheets','SpreadsheetFeed.php',54],['backup/util/structure','base_processor.class.php',49],['lib/zend/Zend/Gdata/Calendar/Extension','Timezone.php',45],['lib/zend/Zend/Validate','Ip.php',56],['lib/zend/Zend/Gdata/Extension','OpenSearchTotalResults.php',44],['badges/criteria','award_criteria_activity.php',45],['lib/zend/Zend/Service/Technorati','DailyCountsResultSet.php',67],['lib/zend/Zend/XmlRpc/Value','Collection.php',40],['lib/google/src/Google/Service','Coordinate.php',47],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','LinkTypes.php',21],['lib/classes/output','mustache_pix_helper.php',43],['lib/zend/Zend/Amf/Value','MessageBody.php',81],['user/classes/output/myprofile','node.php',82],['lib/htmlpurifier/HTMLPurifier','TokenFactory.php',43],['lib/zend/Zend','Registry.php',186],['lib/lessphp/Exception','Chunk.php',19],['lib/dtl','database_mover.php',33],['lib/zend/Zend/Http','CookieJar.php',106],['lib/zend/Zend/Gdata/Extension','Transparency.php',44],['lib/zend/Zend/Gdata/Media/Extension','MediaText.php',64],['lib/phpexcel/PHPExcel/RichText','TextElement.php',43],['lib/simplepie/library/SimplePie','Enclosure.php',219],['lib/google/src/Google/Service','Webmasters.php',46],['lib/lessphp/Tree','Value.php',14],['lib/simplepie/library','SimplePie.php',611],['lib/google/src/Google/Service','Autoscaler.php',46],['lib/zend/Zend/Gdata/App','CaptchaRequiredException.php',64],['lib/behat/features/bootstrap','behat_init_context.php',45],['lib/horde/framework/Horde/Imap/Client/Socket','ClientSort.php',37],['mod/folder','renderer.php',139],['lib/google/src/Google/Service','Webfonts.php',38],['lib/zend/Zend/Gdata/DublinCore/Extension','Description.php',44],['admin/roles/classes','admins_potential_selector.php',30],['lib/zend/Zend/Soap/Client','Local.php',52],['lib/horde/framework/Horde/Imap/Client/Interaction/Server','Tagged.php',36],['lib/lessphp/Tree','Negative.php',14],['mod/quiz','override_form.php',58],['lib/classes/session','file.php',40],['lib/google/src/Google/Auth','OAuth2.php',55],['admin/roles/classes','check_users_selector.php',38],['lib/phpexcel/PHPExcel/Reader/Excel2007','Theme.php',68],['mod/lti/classes/local/ltiservice','service_base.php',63],['lib/alfresco/Service','Store.php',31],['lib/google/src/Google/Service','Audit.php',39],['lib/zend/Zend/Gdata','Gbase.php',95],['mod/wiki','pagelib.php',94],['mod/wiki','pagelib.php',381],['mod/wiki','pagelib.php',986],['mod/wiki','pagelib.php',1195],['mod/wiki','pagelib.php',2201],['mod/wiki','pagelib.php',2429],['lib/simplepie/library/SimplePie/Decode/HTML','Entities.php',80],['calendar','lib.php',1968],['calendar','lib.php',2709],['lib/zend/Zend/Gdata/Photos','AlbumFeed.php',133],['lib/phpmailer','class.phpmailer.php',572],['lib/google/src/Google/Service','Datastore.php',46],['lib/google/src/Google/Service','YouTubeAnalytics.php',45],['lib/lessphp/Tree','Keyword.php',17],['lib/zend/Zend/Service/Amazon','Sqs.php',70],['backup/util/plan','backup_structure_step.class.php',38],['availability/condition/profile/classes','condition.php',73],['lib/simplepie/library/SimplePie','Rating.php',73],['lib/htmlpurifier/HTMLPurifier/AttrTransform','Length.php',19],['lib/horde/framework/Horde/Support','Backtrace.php',20],['lib/simplepie/library/SimplePie','Author.php',81],['report/loglive/classes','table_log.php',50],['lib','completionlib.php',243],['backup/cc/cc_lib','cc_converter_quiz.php',33],['lib/zend/Zend/Gdata/Exif/Extension','Make.php',49],['lib/dml','moodle_database.php',139],['lib/lessphp/Tree','Media.php',18],['lib/horde/framework/Horde/Imap/Client','Url.php',112],['lib/classes/update','info.php',48],['backup/moodle2','backup_subplugin.class.php',44],['backup/util/ui','base_moodleform.class.php',68],['lib/zend/Zend/Gdata/DublinCore/Extension','Creator.php',44],['lib/alfresco/Service','Association.php',28],['lib/zend/Zend/Gdata/Geo/Extension','GeoRssWhere.php',62],['auth/cas/CAS/CAS/PGTStorage','AbstractStorage.php',57],['lib/zend/Zend/Service','Twitter.php',125],['question/classes/statistics/responses','analysis_for_actual_response.php',70],['admin/tool/log/classes/log','store.php',30],['lib/phpexcel/PHPExcel','Comment.php',101],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','CommitConferenceRequest.php',46],['filter','local_settings_form.php',33],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Composite.php',25],['backup/util/plan','base_step.class.php',35],['backup/util/plan','base_step.class.php',127],['badges/classes','assertion.php',49],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','UpdateParticipantRequest.php',67],['lib/phpexcel/PHPExcel','RichText.php',45],['lib/zend/Zend/Gdata/App','Base.php',111],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Db.php',38],['lib/filestorage','file_storage.php',57],['lib/adodb/drivers','adodb-postgres64.inc.php',125],['lib/adodb/drivers','adodb-postgres64.inc.php',904],['lib/phpexcel/PHPExcel/Chart','Title.php',53],['lib/zend/Zend/Mime','Part.php',51],['lib/phpexcel/PHPExcel','Worksheet.php',335],['lib/phpexcel/PHPExcel/Worksheet','MemoryDrawing.php',78],['lib/google/src/Google/Service','Pagespeedonline.php',39],['lib/zend/Zend/Gdata/DublinCore/Extension','Language.php',44],['lib/phpexcel/PHPExcel/Worksheet','SheetView.php',77],['lib/alfresco/Service/WebService','AlfrescoWebService.php',30],['admin/tool/monitor/classes/output/managerules','renderable.php',56],['lib/google/src/Google/Service','ShoppingContent.php',47],['backup/util/xml/parser/processors','selective_exact_parser_processor.class.php',35],['lib/zend/Zend/Gdata/Spreadsheets','ListQuery.php',57],['backup/moodle2','backup_format_plugin.class.php',40],['mod/workshop/allocation/scheduled','lib.php',48],['lib','outputfactories.php',120],['lib','outputfactories.php',367],['lib/zend/Zend/Gdata/Spreadsheets','ListEntry.php',62],['repository/merlot','lib.php',37],['lib/htmlpurifier/HTMLPurifier','PropertyList.php',29],['mod/chat','chatd.php',78],['mod/chat','chatd.php',103],['lib/lessphp/Visitor','extendFinder.php',15],['lib/zend/Zend/Gdata/YouTube/Extension','MediaGroup.php',112],['mod/quiz/report/grading','gradingsettings_form.php',44],['lib/zend/Zend/Service/Simpy','Note.php',104],['lib/zend/Zend/Gdata/Photos/Extension','Rotation.php',51],['lib/phpexcel/PHPExcel/Worksheet','RowDimension.php',89],['lib/editor/tinymce/classes','plugin.php',49],['question/type/calculatedsimple','edit_calculatedsimple_form.php',72],['lib/zend/Zend/XmlRpc/Value','Integer.php',40],['lib/zend/Zend/Validate/File','Upload.php',74],['lib/phpexcel/PHPExcel/Shared/trend','polynomialBestFitClass.php',201],['admin/roles/classes','capability_table_with_risks.php',46],['lib/zend/Zend/Gdata/Extension','EntryLink.php',52],['question/type','questiontypebase.php',55],['question/type','questiontypebase.php',1442],['lib','outputrequirementslib.php',166],['lib/google/src/Google/Service','Appsactivity.php',49],['lib/horde/framework/Horde/Mail/Transport','Smtp.php',100],['lib/zend/Zend/Loader','Autoloader.php',446],['lib/horde/framework/Horde/Support','CombineStream.php',29],['lib/zend/Zend/Gdata','Docs.php',87],['lib/alfresco/Service/Logger','Logger.php',27],['lib/zend/Zend/Gdata/App/Extension','Logo.php',43],['lib/dml','pgsql_native_moodle_recordset.php',44],['backup/cc/cc_lib','cc_version11.php',57],['lib','weblib.php',315],['lib','weblib.php',3025],['lib','weblib.php',3325],['lib','weblib.php',3360],['lib','weblib.php',3435],['backup/cc/cc_lib','xmlbase.php',52],['backup/cc/cc_lib','cc_organization.php',47],['backup/cc/cc_lib','cc_organization.php',145],['mod/lesson','locallib.php',2007],['mod/lesson','locallib.php',2602],['lib/zend/Zend/Service/LiveDocx','MailMerge.php',61],['lib/phpexcel/PHPExcel/Worksheet/Drawing','Shadow.php',101],['lib/zend/Zend/Server/Reflection','ReturnValue.php',47],['lib/minify/lib/Minify','Build.php',77],['lib/horde/framework/Horde','Variables.php',60],['auth/cas/CAS/CAS','ProxyChain.php',48],['lib/phpexcel/PHPExcel','NamedRange.php',73],['lib/zend/Zend/Gdata/Extension','OpenSearchStartIndex.php',44],['lib/horde/framework/Horde/Imap/Client/Password','Xoauth2.php',44],['lib/zend/Zend/Service/Amazon','OfferSet.php',79],['grade/export/txt','grade_export_txt.php',27],['admin/roles/classes','allow_override_page.php',31],['lib/lessphp/Tree','Assignment.php',15],['lib/zend/Zend/Gdata/Books/Extension','ThumbnailLink.php',42],['lib/zend/Zend/Gdata/YouTube/Extension','Uploaded.php',44],['lib/zend/Zend/Gdata/Extension','AttendeeStatus.php',44],['lib/tcpdf/include/barcodes','qrcode.php',631],['lib/zend/Zend/Gdata/Photos/Extension','Weight.php',51],['enrol','locallib.php',125],['enrol','locallib.php',1240],['enrol','locallib.php',1363],['enrol','locallib.php',1414],['enrol','locallib.php',1447],['lib/lessphp/Visitor','toCSS.php',13],['question/classes/statistics/questions','calculator.php',66],['mod/forum','locallib.php',55],['mod/forum','locallib.php',419],['backup/util/helper','restore_prechecks_helper.class.php',213],['grade/edit/tree','lib.php',57],['grade/edit/tree','lib.php',605],['grade/edit/tree','lib.php',638],['grade/edit/tree','lib.php',804],['lib/zend/Zend/Gdata','Geo.php',56],['lib/zend/Zend/Gdata/Books','CollectionFeed.php',41],['lib/classes','string_manager_standard.php',53],['backup/util/loggers','base_logger.class.php',42],['backup/util/loggers','base_logger.class.php',163],['admin/tool/installaddon/classes','validator.php',223],['admin/tool/generator/classes','backend.php',84],['lib/zend/Zend/Service/WindowsAzure/Credentials','SharedAccessSignature.php',53],['lib/zend/Zend/Gdata/Spreadsheets/Extension','Custom.php',49],['availability/condition/completion/classes','condition.php',48],['question/classes/statistics/questions','calculated.php',181],['lib/lessphp/Tree','Javascript.php',20],['mod/quiz','locallib.php',1898],['lib/phpexcel/PHPExcel/Worksheet','ColumnDimension.php',89],['lib/phpexcel/PHPExcel/Reader','Excel2007.php',62],['lib/zend/Zend/Gdata/DublinCore/Extension','Date.php',45],['lib/mustache/src/Mustache/Cache','FilesystemCache.php',27],['lib/zend/Zend/Loader','PluginLoader.php',95],['lib/zend/Zend/Gdata/YouTube/Extension','Description.php',44],['lib/horde/framework/Horde/Imap/Client/Interaction','Command.php',72],['lib/zend/Zend/Gdata/App/Extension','Generator.php',45],['lib/zend/Zend/Gdata/DublinCore/Extension','Rights.php',44],['lib/phpexcel/PHPExcel/Style','Conditional.php',93],['repository/skydrive','lib.php',42],['lib/google/src/Google/Service','SQLAdmin.php',48],['lib/zend/Zend/Gdata/YouTube/Extension','NoEmbed.php',44],['lib/zend/Zend/Gdata/Exif/Extension','ImageUniqueId.php',49],['lib/simplepie/library/SimplePie','Item.php',82],['lib/phpexcel/PHPExcel/Writer/PDF','Core.php',214],['lib/zend/Zend/Validate/File','IsImage.php',53],['lib/zend/Zend/Date','Exception.php',39],['lib/zend/Zend/Amf/Adobe','Introspector.php',65],['lib/htmlpurifier/HTMLPurifier','URIParser.php',10],['lib/zend/Zend/Service','ReCaptcha.php',117],['lib/zend/Zend/Gdata/Health','ProfileEntry.php',61],['lib/zend/Zend/Server/Reflection','Prototype.php',45],['admin/roles/classes','allow_switch_page.php',33],['backup/util/helper','restore_logs_processor.class.php',45],['backup/util/helper','restore_logs_processor.class.php',140],['lib/google/src/Google/Service','Fitness.php',57],['filter/emoticon/tests','filter_test.php',68],['backup/util/helper','convert_helper.class.php',378],['backup/util/ui','restore_ui_stage.class.php',42],['backup/util/ui','restore_ui_stage.class.php',265],['backup/util/ui','restore_ui_stage.class.php',452],['backup/util/ui','restore_ui_stage.class.php',592],['backup/util/ui','restore_ui_stage.class.php',704],['backup/util/ui','restore_ui_stage.class.php',852],['backup/util/ui','restore_ui_stage.class.php',959],['backup/util/ui','restore_ui_stage.class.php',1100],['repository/webdav','lib.php',38],['repository/dropbox','locallib.php',46],['lib/lessphp/Exception','Parser.php',30],['lib/filestorage','tgz_packer.php',726],['lib/filestorage','tgz_packer.php',808],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','URI.php',15],['backup/converter/moodle1','lib.php',725],['backup/converter/moodle1','lib.php',865],['backup/converter/moodle1','lib.php',1145],['backup/converter/moodle1','lib.php',1190],['backup/converter/moodle1','lib.php',1480],['lib/classes/output','mustache_javascript_helper.php',40],['auth/cas/CAS/CAS/ProxiedService/Http','Abstract.php',58],['lib/zend/Zend/Gdata/YouTube/Extension','FirstName.php',44],['lib/zend/Zend/Service/WindowsAzure/Storage','Queue.php',83],['lib/horde/framework/Horde/Imap/Client/Data','Format.php',32],['lib/zend/Zend/Gdata/Media/Extension','MediaDescription.php',53],['lib/google/src/Google/Service','TagManager.php',66],['lib/zend/Zend/Server','Abstract.php',89],['cache/classes','config.php',80],['lib/htmlpurifier/HTMLPurifier','Generator.php',67],['lib','outputcomponents.php',80],['lib','outputcomponents.php',204],['lib','outputcomponents.php',469],['lib','outputcomponents.php',523],['lib','outputcomponents.php',579],['lib','outputcomponents.php',655],['lib','outputcomponents.php',773],['lib','outputcomponents.php',915],['lib','outputcomponents.php',999],['lib','outputcomponents.php',2178],['lib','outputcomponents.php',2217],['lib','outputcomponents.php',2290],['lib','outputcomponents.php',2371],['lib','outputcomponents.php',2574],['lib','outputcomponents.php',2622],['lib','outputcomponents.php',2682],['lib','outputcomponents.php',2855],['lib','outputcomponents.php',3025],['lib','outputcomponents.php',3129],['lib','outputcomponents.php',3196],['lib','outputcomponents.php',3324],['lib','outputcomponents.php',3608],['lib','outputcomponents.php',3637],['lib','outputcomponents.php',3663],['lib','outputcomponents.php',3685],['lib','outputcomponents.php',3714],['lib','outputcomponents.php',3746],['lib/zend/Zend/Validate/Barcode','Code25.php',53],['lib/zend/Zend/Gdata/YouTube','CommentFeed.php',53],['lib/dtl','string_xml_database_importer.php',34],['question/engine','questionattemptstep.php',97],['question/engine','questionattemptstep.php',608],['lib/htmlpurifier/HTMLPurifier/Node','Element.php',39],['lib/simplepie/library/SimplePie','Cache.php',69],['backup/util/ui','renderer.php',813],['grade/export/xls','grade_export_xls.php',24],['lib/google/src/Google/Service','Directory.php',110],['lib/zend/Zend/Gdata/YouTube/Extension','State.php',47],['lib/phpexcel/PHPExcel/Style','Alignment.php',97],['mod/quiz/report/statistics','statistics_table.php',45],['backup/util/structure','base_nested_element.class.php',44],['backup/util/structure','base_nested_element.class.php',258],['lib/zend/Zend/Gdata/DublinCore/Extension','Title.php',44],['lib/htmlpurifier/HTMLPurifier','Config.php',100],['lib/zend/Zend/Validate/Barcode','Code93.php',67],['lib/lessphp','Functions.php',15],['lib/adodb/drivers','adodb-postgres7.inc.php',78],['lib/adodb/drivers','adodb-postgres7.inc.php',273],['lib/adodb/drivers','adodb-postgres7.inc.php',304],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','GetRunningConferenceRequest.php',46],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','UpdateConferenceRequest.php',74],['lib/zend/Zend/Validate','EmailAddress.php',118],['mod/workshop','locallib.php',178],['mod/workshop','locallib.php',2801],['mod/workshop','locallib.php',3236],['mod/workshop','locallib.php',3472],['mod/workshop','locallib.php',3714],['mod/workshop','locallib.php',3800],['mod/workshop','locallib.php',3885],['mod/workshop','locallib.php',3904],['lib/zend/Zend/XmlRpc/Value','Struct.php',39],['lib/zend/Zend/Gdata/Books/Extension','Embeddability.php',45],['lib/horde/framework/Horde/Mime','Mdn.php',35],['cache/stores/static','lib.php',127],['lib','blocklib.php',54],['lib','blocklib.php',152],['lib/zend/Zend/Gdata/Books/Extension','Review.php',46],['lib','componentlib.class.php',597],['lib','componentlib.class.php',821],['lib/zend/Zend/Validate/Barcode','Code39.php',66],['lib/filebrowser','file_info_context_module.php',47],['lib/phpexcel/PHPExcel/Shared/JAMA','CholeskyDecomposition.php',42],['question/engine','states.php',61],['lib/jabber/XMPP','XMLStream.php',171],['lib/jabber/XMPP','XMPP.php',101],['lib/classes/lock','lock_factory.php',39],['lib/tests','collator_test.php',310],['lib/horde/framework/Horde/Imap/Client/Exception','NoSupportPop3.php',26],['course/format','lib.php',78],['lib/ddl','sql_generator.php',175],['lib/zend/Zend/XmlRpc/Generator','GeneratorAbstract.php',35],['mod/quiz','accessmanager.php',45],['lib/zend/Zend/Amf/Value','TraitsInfo.php',53],['admin/tool/monitor/classes/output/managesubs','subs.php',51],['lib/zend/Zend/Service/Nirvanix','Response.php',43],['lib','boxlib.php',293],['repository/flickr_public','image.php',34],['lib/google/src/Google/Service','AppState.php',40],['backup/util/structure','backup_nested_element.class.php',44],['lib/filestorage','zip_archive.php',66],['lib/google/src/Google/Service','Taskqueue.php',44],['lib/zend/Zend/Server/Method','Prototype.php',49],['lib/zend/Zend/Service/Technorati','Author.php',90],['mod/workshop/form/comments','lib.php',99],['lib/phpexcel/PHPExcel/RichText','Run.php',43],['lib/phpexcel/PHPExcel/Chart','DataSeriesValues.php',89],['lib/horde/framework/Horde/Imap/Client/Data','Acl.php',32],['lib/phpexcel/PHPExcel/Writer/Excel2007','WriterPart.php',69],['lib/zend/Zend/Service/Simpy','WatchlistFilter.php',48],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','RemoveConferenceRequest.php',46],['lib/zend/Zend/Gdata/Photos','UserEntry.php',131],['lib/mustache/src/Mustache/Loader','FilesystemLoader.php',33],['lib/zend/Zend/Gdata/Spreadsheets','ListFeed.php',54],['lib/phpexcel/PHPExcel','DocumentProperties.php',131],['lib/phpexcel/PHPExcel/Reader','Excel2003XML.php',62],['lib/lessphp/Tree','Paren.php',14],['lib/zend/Zend/Gdata/Photos/Extension','Thumbnail.php',50],['lib/horde/framework/Horde/Imap/Client','Mailbox.php',62],['admin/tool/customlang','locallib.php',44],['admin/tool/customlang','locallib.php',405],['admin/tool/customlang','locallib.php',471],['backup/util/xml/parser/processors','selective_like_parser_processor.class.php',35],['lib/filebrowser','file_info_context_user.php',39],['lib/google/src/Google/Service','CivicInfo.php',40],['lib/zend/Zend/Gdata/YouTube/Extension','Private.php',44],['lib/zend/Zend/Gdata/YouTube/Extension','Music.php',44],['backup/moodle2','restore_block_task.class.php',45],['lib/zend/Zend','Gdata.php',99],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Number.php',18],['lib/simplepie','moodle_simplepie.php',50],['lib/simplepie','moodle_simplepie.php',121],['lib/phpunit/classes','hint_resultprinter.php',37],['backup/util/plan','restore_plan.class.php',43],['backup/util/plan','restore_plan.class.php',203],['admin/roles/classes','capability_table_base.php',51],['lib/htmlpurifier/HTMLPurifier','Lexer.php',152],['lib/google/src/Google/Service','Container.php',44],['lib/zend/Zend/Service/Simpy','TagSet.php',47],['lib/phpexcel/PHPExcel/Chart','Legend.php',82],['question/type/calculated/tests','helper.php',205],['lib/phpexcel/PHPExcel/Reader','CSV.php',103],['availability/classes','result.php',46],['lib/zend/Zend/XmlRpc/Value','Double.php',40],['backup/util/helper','restore_users_parser_processor.class.php',43],['lib/htmlpurifier/HTMLPurifier/ConfigSchema','ValidatorAtom.php',31],['lib/htmlpurifier/HTMLPurifier/Lexer','PH5P.php',462],['lib/htmlpurifier/HTMLPurifier/Lexer','PH5P.php',1700],['lib/horde/framework/Horde/Mime','Related.php',32],['report/log/classes','renderable.php',93],['lib/horde/framework/Horde/Imap/Client/Base','Mailbox.php',59],['lib/phpexcel/PHPExcel/Style','Font.php',108],['lib/htmlpurifier/HTMLPurifier/ChildDef','Table.php',57],['backup/util/settings/activity','activity_backup_setting.class.php',25],['lib/mustache/src/Mustache/Exception','UnknownHelperException.php',22],['course/tests/fixtures','course_capability_assignment.php',60],['lib/zend/Zend/Service/Amazon','ResultSet.php',68],['lib/zend/Zend/Validate','Callback.php',69],['lib/zend/Zend/Gdata/Books','CollectionEntry.php',41],['lib/zend/Zend/Gdata/DublinCore/Extension','Publisher.php',44],['lib/zend/Zend/Gdata/Spreadsheets','WorksheetEntry.php',56],['badges/lib','bakerlib.php',52],['backup/util/xml','xml_writer.class.php',57],['backup/util/xml','xml_writer.class.php',284],['lib/portfolio','caller.php',67],['lib/zend/Zend/Validate/File','Sha1.php',60],['lib/htmlpurifier/HTMLPurifier/Strategy','Core.php',8],['lib/zend/Zend/Gdata/Media','Feed.php',58],['lib/zend/Zend/Gdata/YouTube/Extension','LastName.php',44],['mod/data','locallib.php',64],['mod/data','locallib.php',431],['lib/zend/Zend/Gdata/App/Extension','Content.php',44],['lib/classes/update','checker_exception.php',37],['backup/cc/cc_lib','cc_manifest.php',45],['lib','odslib.class.php',42],['lib','odslib.class.php',121],['lib','odslib.class.php',419],['lib','odslib.class.php',824],['lib/zend/Zend/Gdata/Books/Extension','AnnotationLink.php',42],['lib/zend/Zend/Gdata/Calendar/Extension','Color.php',46],['backup/util/helper','restore_structure_parser_processor.class.php',41],['admin/tool/log/store/standard/classes/log','store.php',37],['lib/horde/framework/Horde/Imap/Client/Mailbox','List.php',46],['lib/alfresco/Service','Session.php',39],['grade/report/singleview/classes/local/ui','empty_element.php',38],['enrol/database','settingslib.php',34],['lib/phpexcel/PHPExcel/Worksheet/AutoFilter','Column.php',125],['lib/google/src/Google/Service','AndroidPublisher.php',51],['lib/zend/Zend/Service','StrikeIron.php',43],['lib/zend/Zend/Gdata/Books/Extension','InfoLink.php',41],['lib/lessphp/SourceMap','Generator.php',82],['filter/urltolink/tests','filter_test.php',209],['lib/horde/framework/Horde/Socket','Client.php',52],['lib/zend/Zend/Service/Amazon','Item.php',112],['repository','lib.php',116],['repository','lib.php',533],['admin/roles/classes','define_role_table_basic.php',31],['lib/phpexcel/PHPExcel','WorksheetIterator.php',54],['lib/zend/Zend/Gdata/Photos/Extension','NumPhotosRemaining.php',50],['mod/quiz','attemptlib.php',41],['mod/quiz','attemptlib.php',82],['mod/quiz','attemptlib.php',505],['mod/quiz','attemptlib.php',2058],['mod/quiz','attemptlib.php',2113],['lib/zend/Zend/Server/Reflection','Node.php',51],['lib/zend/Zend/Gdata/Media/Extension','MediaTitle.php',49],['lib/zend/Zend','Date.php',123],['lib/zend/Zend','Mime.php',290],['lib','accesslib.php',5301],['lib','accesslib.php',5846],['lib','accesslib.php',6116],['lib','accesslib.php',6357],['lib','accesslib.php',6544],['lib','accesslib.php',6776],['lib','accesslib.php',6998],['lib','accesslib.php',7240],['question/engine/tests','helpers.php',582],['question/engine/tests','helpers.php',594],['question/engine/tests','helpers.php',608],['question/engine/tests','helpers.php',623],['question/engine/tests','helpers.php',637],['question/engine/tests','helpers.php',652],['question/engine/tests','helpers.php',665],['question/engine/tests','helpers.php',676],['question/engine/tests','helpers.php',1180],['lib/zend/Zend/Validate','Ccnum.php',62],['lib/zend/Zend/Gdata/Extension','EventStatus.php',44],['lib/google/src/Google/Verifier','Pem.php',29],['lib/zend/Zend/Service/Technorati','BlogInfoResult.php',74],['admin/tool/log/classes','setting_managestores.php',30],['lib','outputactions.php',60],['lib','outputactions.php',91],['lib','outputactions.php',148],['backup/cc/cc_lib','cc_assesment_truefalse.php',27],['backup/util/ui','restore_moodleform.class.php',34],['grade/report/singleview/classes/local/ui','element.php',47],['mod/quiz/report','attemptsreport_table.php',76],['lib/lessphp/Tree','Attribute.php',16],['lib/phpexcel/PHPExcel/Style','Supervisor.php',52],['lib/zend/Zend/Gdata/Media/Extension','MediaCategory.php',50],['lib/google/src/Google/Service','AdSenseHost.php',49],['lib/zend/Zend/Gdata/Photos/Extension','Checksum.php',51],['lib/lessphp/Tree','Expression.php',16],['mod/workshop','fileinfolib.php',43],['mod/workshop','fileinfolib.php',198],['course/format','renderer.php',44],['lib/zend/Zend/XmlRpc/Value','Boolean.php',40],['blocks/rss_client','editfeed.php',36],['lib/phpexcel/PHPExcel/Worksheet','Protection.php',157],['question/type/numerical','question.php',321],['auth/cas/CAS/CAS/ProxiedService','Imap.php',51],['lib/typo3','class.t3lib_cs.php',509],['lib/simplepie/library/SimplePie/XML/Declaration','Parser.php',110],['lib/zend/Zend/Gdata/Health','ProfileListEntry.php',49],['lib/htmlpurifier/HTMLPurifier/Filter','ExtractStyleBlocks.php',57],['cache/stores/memcache','lib.php',120],['lib/htmlpurifier/HTMLPurifier/AttrDef','Switch.php',29],['lib/zend/Zend/Gdata/Calendar/Extension','WebContent.php',47],['lib/zend/Zend/Gdata/Photos/Extension','Id.php',50],['lib/google/src/Google/Service','Games.php',60],['lib/zend/Zend/Validate/File','Size.php',92],['lib/classes/lock','file_lock_factory.php',57],['lib/htmlpurifier/HTMLPurifier/AttrTransform','SafeParam.php',27],['lib/phpexcel/PHPExcel/Reader','Gnumeric.php',64],['lib','filelib.php',2700],['lib','filelib.php',3560],['lib/classes/session','database.php',52],['lib/zend/Zend/Gdata/YouTube/Extension','Movies.php',44],['grade','lib.php',103],['grade','lib.php',785],['availability/condition/grouping/classes','condition.php',46],['lib/zend/Zend/Service/Technorati','SearchResult.php',84],['lib/dml','mysqli_native_moodle_recordset.php',42],['lib/zend/Zend/XmlRpc','Server.php',186],['mod/assign/feedback/editpdf/classes','annotation.php',66],['lib/htmlpurifier/HTMLPurifier/ConfigSchema','Validator.php',30],['lib/htmlpurifier','HTMLPurifier.php',104],['lib/zend/Zend/Gdata/Media/Extension','MediaPlayer.php',59],['lib/phpexcel/PHPExcel','Cell.php',122],['lib/phpexcel/PHPExcel/CachedObjectStorage','APC.php',248],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Percentage.php',18],['lib','oauthlib.php',65],['lib','oauthlib.php',409],['backup/util/helper','restore_log_rule.class.php',62],['lib/phpexcel/PHPExcel/Calculation','FormulaToken.php',108],['lib/zend/Zend/Server/Reflection','Class.php',66],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','Font.php',22],['mnet/service/enrol','locallib.php',48],['mnet/service/enrol','locallib.php',466],['mnet/service/enrol','locallib.php',537],['repository/flickr','lib.php',51],['lib','csvlib.class.php',64],['lib','csvlib.class.php',398],['lib/google/src/Google/Service','MapsEngine.php',66],['lib/xhprof/xhprof_lib/utils','xhprof_runs.php',87],['lib/filestorage','tgz_extractor.php',119],['lib/zend/Zend/Soap','Client.php',142],['lib/zend/Zend/Gdata/Calendar/Extension','Hidden.php',45],['cache/classes','factory.php',149],['lib/zend/Zend/Gdata/Media/Extension','MediaCredit.php',54],['course','dnduploadlib.php',109],['course','dnduploadlib.php',407],['mod/lti/classes/local/ltiservice','resource_base.php',62],['lib/zend/Zend/Http','Response.php',132],['lib/horde/framework/Horde/Imap/Client','Exception.php',247],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','GetConferenceListRequest.php',63],['backup/util/ui','backup_moodleform.class.php',41],['lib/phpexcel/PHPExcel/Chart','Layout.php',143],['comment','lib.php',100],['lib/phpexcel','PHPExcel.php',354],['grade/export/ods','grade_export_ods.php',24],['auth/cas/CAS/CAS','ProxyTicketException.php',46],['lib/minify/lib','JSMinPlus.php',193],['lib/minify/lib','JSMinPlus.php',726],['lib/minify/lib','JSMinPlus.php',1638],['lib/minify/lib','JSMinPlus.php',1656],['lib/minify/lib','JSMinPlus.php',1748],['lib/zend/Zend/Gdata/YouTube/Extension','Location.php',44],['lib/lessphp/Tree','Dimension.php',15],['lib/phpexcel/PHPExcel/Worksheet','Row.php',54],['lib/phpexcel/PHPExcel/Writer','HTML.php',135],['lib/zend/Zend/Service/Technorati','TagsResultSet.php',41],['backup/moodle2','backup_theme_plugin.class.php',61],['lib/zend/Zend/Gdata','Extension.php',43],['lib/htmlpurifier/HTMLPurifier/ChildDef','Custom.php',36],['lib/google/src/Google/Service','SiteVerification.php',43],['lib/htmlpurifier/HTMLPurifier/Token','Text.php',34],['mod/forum/classes','subscriber_selector_base.php',53],['lib/zend/Zend','Auth.php',45],['lib/phpexcel/PHPExcel/Style','Borders.php',121],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','CreateConferenceRequest.php',67],['lib/zend/Zend/Gdata/Calendar','ListFeed.php',54],['lib/zend/Zend/Gdata/Extension','Visibility.php',44],['webservice/xmlrpc','lib.php',42],['lib/phpexcel/PHPExcel/CachedObjectStorage','CacheBase.php',76],['lib/zend/Zend/Gdata/App','MediaEntry.php',57],['lib/horde/framework/Horde/Mime','Part.php',261],['backup/util/ui','backup_ui_stage.class.php',43],['backup/util/ui','backup_ui_stage.class.php',79],['backup/util/ui','backup_ui_stage.class.php',234],['backup/util/ui','backup_ui_stage.class.php',387],['backup/util/ui','backup_ui_stage.class.php',516],['backup/util/ui','backup_ui_stage.class.php',575],['question/classes/engine/variants','least_used_strategy.php',51],['lib/horde/framework/Horde/Support','Array.php',21],['lib/zend/Zend/Gdata/YouTube/Extension','Statistics.php',93],['lib/zend/Zend/Gdata/Photos/Extension','BytesUsed.php',50],['lib','tablelib.php',127],['lib','tablelib.php',1400],['lib','tablelib.php',1723],['lib/zend/Zend/Gdata/App/Extension','Uri.php',43],['backup/util/plan','backup_task.class.php',32],['backup/util/plan','backup_task.class.php',56],['lib/zend/Zend/Gdata/Media/Extension','MediaCopyright.php',53],['lib/zend/Zend/Gdata/DublinCore/Extension','Identifier.php',44],['backup/util/xml/parser/processors','findpaths_parser_processor.class.php',35],['lib/zend/Zend/Gdata/Gbase','Feed.php',49],['availability/condition/date/classes','condition.php',52],['backup/util/helper','restore_moodlexml_parser_processor.class.php',38],['admin/tool/generator/classes','course_backend.php',116],['lib/google/src/Google/Service','Prediction.php',51],['cache/stores/session','lib.php',131],['cache/classes','dummystore.php',62],['lib/zend/Zend/XmlRpc/Server','System.php',39],['lib/zend/Zend/Service/WindowsAzure/Storage','TableInstance.php',50],['backup/util/settings/course','course_backup_setting.class.php',25],['mod/quiz/classes/question','qubaids_for_users_attempts.php',37],['mod/lesson','override_form.php',58],['lib/zend/Zend/Service/Simpy','WatchlistSet.php',47],['lib/google/src/Google/Service','Compute.php',78],['badges/criteria','award_criteria.php',127],['lib/zend/Zend/Gdata/Calendar/Extension','Selected.php',45],['lib/minify/lib/Minify/Cache','ZendPlatform.php',23],['lib/zend/Zend/Validate','PostCode.php',65],['lib/dml','oci_native_moodle_temptables.php',40],['lib/zend/Zend/Gdata/Photos/Extension','CommentingEnabled.php',51],['lib/simplepie/library/SimplePie','Category.php',81],['auth/cas/CAS/CAS','CookieJar.php',46],['lib/phpexcel/PHPExcel/Reader/Excel5','MD5.php',45],['backup/util/ui','backup_ui_setting.class.php',70],['backup/util/ui','backup_ui_setting.class.php',200],['backup/util/ui','backup_ui_setting.class.php',398],['backup/util/ui','backup_ui_setting.class.php',504],['backup/util/ui','backup_ui_setting.class.php',583],['user/classes/output/myprofile','category.php',68],['grade/report/singleview/classes/local/ui','grade_attribute_format.php',47],['mod/wiki/parser','parser.php',98],['backup/converter','convertlib.php',52],['backup/converter','convertlib.php',277],['repository/googledocs','lib.php',65],['lib/htmlpurifier/HTMLPurifier','Doctype.php',48],['lib/zend/Zend/Validate/File','Extension.php',71],['mod/imscp','locallib.php',289],['lib/classes/session','memcache.php',50],['lib/horde/framework/Horde/Imap/Client','Cache.php',53],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','ImportantDecorator.php',21],['lib/zend/Zend/Service','Simpy.php',53],['lib/horde/framework/Horde/Imap/Client/Interaction','Server.php',91],['lib/zend/Zend/Gdata/Gapps','EmailListRecipientQuery.php',54],['lib/zend/Zend/Gdata/YouTube','PlaylistVideoEntry.php',55],['lib/zend/Zend/Gdata/Photos','CommentEntry.php',85],['lib/horde/framework/Horde/Exception','PermissionDenied.php',15],['lib/zend/Zend/Gdata/YouTube','InboxEntry.php',92],['lib/jabber/XMPP','XMPP_Old.php',45],['lib/horde/framework/Horde/Imap/Client/Data/Format','Nil.php',27],['backup/cc/cc_lib','cc_converter_label.php',28],['lib/phpexcel/PHPExcel/Style','Border.php',75],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','GetConferenceTemplateParticipantRequest.php',53],['enrol/manual','locallib.php',37],['enrol/manual','locallib.php',102],['admin/tool/assignmentupgrade','locallib.php',50],['admin/tool/assignmentupgrade','locallib.php',93],['lib/zend/Zend/Gdata/Exif/Extension','Distance.php',49],['lib/phpexcel/PHPExcel/Writer','PDF.php',46],['lib/zend/Zend/Gdata/Photos/Extension','Size.php',50],['lib/google/src/Google/Service','CloudMonitoring.php',42],['backup/util/xml/output','memory_xml_output.class.php',37],['lib/horde/framework/Horde/Imap/Client/Data','Thread.php',41],['lib/simplepie/library/SimplePie','Credit.php',81],['lib/zend/Zend/Service','Delicious.php',112],['lib/bennu','iCalendar_components.php',21],['lib/bennu','iCalendar_components.php',333],['lib/bennu','iCalendar_components.php',355],['lib/bennu','iCalendar_components.php',433],['lib/bennu','iCalendar_components.php',513],['lib/bennu','iCalendar_components.php',551],['lib/bennu','iCalendar_components.php',602],['lib/bennu','iCalendar_components.php',659],['lib/bennu','iCalendar_components.php',679],['lib','outputrenderers.php',117],['lib','outputrenderers.php',282],['lib','outputrenderers.php',405],['lib','outputrenderers.php',4280],['lib','outputrenderers.php',4533],['lib/zend/Zend/Service/Amazon','ListmaniaList.php',44],['lib/zend/Zend/Service','Flickr.php',54],['backup/util/helper','restore_decode_rule.class.php',47],['backup/util/helper','restore_decode_rule.class.php',192],['lib/mustache/src/Mustache/Exception','UnknownFilterException.php',22],['lib/google/src/Google/Logger','File.php',49],['backup','backup.class.php',146],['lib/zend/Zend/Gdata/App/Extension','Updated.php',43],['lib/zend/Zend/Gdata/YouTube','PlaylistVideoFeed.php',55],['auth/cas/CAS/CAS/PGTStorage','Db.php',122],['lib/phpexcel/PHPExcel/Chart','DataSeries.php',137],['lib/zend/Zend/Gdata/Geo','Feed.php',51],['lib/phpexcel/PHPExcel/Shared/trend','logarithmicBestFitClass.php',107],['backup/util/loggers','file_logger.class.php',35],['admin/roles/classes','admins_existing_selector.php',30],['lib/phpexcel/PHPExcel/Shared/JAMA','LUDecomposition.php',57],['lib/zend/Zend/Gdata/Extension','Reminder.php',48],['course/format/topics','renderer.php',38],['mod/lesson/classes','file_info.php',45],['question/type/calculatedmulti','edit_calculatedmulti_form.php',47],['lib/phpexcel/PHPExcel/Worksheet','AutoFilter.php',62],['lib/minify/lib/HTTP','Encoder.php',75],['lib/zend/Zend/Gdata/App/Extension','Name.php',43],['lib/google/src/Google/Service','Calendar.php',50],['question/type','questionbase.php',124],['question/type','questionbase.php',438],['question/type','questionbase.php',531],['question/type','questionbase.php',750],['question/type','questionbase.php',835],['question/type','questionbase.php',868],['question/type','questionbase.php',914],['question/type','questionbase.php',1013],['lib/dml','database_column_info.php',137],['lib/zend/Zend/Gdata/YouTube/Extension','Gender.php',44],['lib/zend/Zend/Service','Yahoo.php',49],['lib/zend/Zend/Service/Amazon','SimilarProduct.php',44],['lib/mustache/src/Mustache/Exception','SyntaxException.php',23],['lib/htmlpurifier/HTMLPurifier','URIDefinition.php',21],['lib/horde/framework/Horde','Stream.php',50],['lib/google/src/Google/Service','Analytics.php',76],['lib/horde/framework/Horde/Mail/Transport','Mock.php',76],['lib/xmldb','xmldb_file.php',43],['lib/zend/Zend/Gdata/YouTube','PlaylistListEntry.php',97],['lib/zend/Zend/Service/Amazon/Ec2','Response.php',78],['lib/zend/Zend/Soap/Wsdl/Strategy','Composite.php',60],['lib/google/src/Google/Service','Tasks.php',44],['lib/zend/Zend/XmlRpc','Response.php',68],['lib/horde/framework/Horde/Exception','NotFound.php',15],['lib/horde/framework/Horde/Mail/Rfc822','Address.php',66],['lib/zend/Zend/Gdata/Books','VolumeEntry.php',131],['question','previewlib.php',122],['mod/wiki','renderer.php',537],['lib/phpexcel/PHPExcel/Worksheet','RowIterator.php',62],['mod/assign','renderable.php',41],['mod/assign','renderable.php',71],['mod/assign','renderable.php',103],['mod/assign','renderable.php',139],['mod/assign','renderable.php',191],['mod/assign','renderable.php',242],['mod/assign','renderable.php',291],['mod/assign','renderable.php',393],['mod/assign','renderable.php',517],['mod/assign','renderable.php',576],['mod/assign','renderable.php',613],['mod/assign','renderable.php',653],['mod/assign','renderable.php',706],['mod/assign','renderable.php',760],['lib/mustache/src/Mustache','Autoloader.php',19],['lib/zend/Zend/Service/DeveloperGarden/Request/SmsValidation','Invalidate.php',46],['lib/zend/Zend/Service/Yahoo','ImageResult.php',97],['lib/phpexcel/PHPExcel/Worksheet','HeaderFooter.php',183],['mod/quiz/classes/question/bank','custom_view.php',44],['lib/htmlpurifier/HTMLPurifier/Token','Tag.php',33],['lib/zend/Zend/Amf/Adobe','Auth.php',56],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','FontFamily.php',11],['auth/cas/CAS/CAS','TypeMismatchException.php',43],['grade/report/singleview/classes/local/screen','screen.php',67],['lib/zend/Zend/Amf/Parse','Deserializer.php',45],['lib/zend/Zend/Service/Delicious','SimplePost.php',56],['lib/zend/Zend/Service/Technorati','ResultSet.php',112],['cache/classes','loaders.php',196],['cache/classes','loaders.php',1211],['cache/classes','loaders.php',1606],['lib/zend/Zend/Gdata/Gbase','Entry.php',62],['lib/zend/Zend/Validate','Identical.php',64],['lib/horde/framework/Horde/Mail/Transport','Sendmail.php',65],['cache/stores/mongodb','lib.php',116],['mod/quiz/report/statistics/classes','calculator.php',39],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','FrameTarget.php',19],['lib/zend/Zend/Gdata/App/Extension','Draft.php',44],['enrol/ldap','settingslib.php',32],['enrol/ldap','settingslib.php',90],['enrol/ldap','settingslib.php',204],['lib/zend/Zend/Service/DeveloperGarden/ConferenceCall','ConferenceDetail.php',54],['lib/zend/Zend/Service/Yahoo','InlinkDataResult.php',47],['lib/lessphp/Tree','UnicodeDescriptor.php',14],['lib/lessphp/Tree','Directive.php',20],['lib/zend/Zend/Service/Yahoo','VideoResult.php',118],['question/type/calculated','edit_calculated_form.php',51],['lib/classes','string_manager_install.php',43],['lib/google/src/Google/Service','GamesManagement.php',50],['lib/google/src/Google/Logger','Psr.php',37],['grade/report/history/classes/output','user_button.php',40],['lib','externallib.php',129],['lib','externallib.php',426],['lib','externallib.php',457],['lib','externallib.php',488],['lib','externallib.php',517],['lib','externallib.php',649],['lib','externallib.php',684],['lib','externallib.php',782],['backup/util/ui','base_ui_stage.class.php',67],['lib/zend/Zend/Validate','CreditCard.php',136],['lib/zend/Zend/Gdata/Spreadsheets','CellQuery.php',57],['lib/htmlpurifier/HTMLPurifier/AttrDef','Clone.php',18],['mod/quiz/accessrule','accessrulebase.php',52],['lib/mustache/src/Mustache','Context.php',20],['lib/zend/Zend/Service/DeveloperGarden/Request/VoiceButler','CallStatus.php',46],['lib/zend/Zend/Gdata/Spreadsheets','CellFeed.php',78],['backup/util/xml/parser/processors','progressive_parser_processor.class.php',57],['lib/lessphp/Tree','Color.php',15],['lib/zend/Zend/Service/StrikeIron','Base.php',56],['lib/zend/Zend/Gdata/Exif/Extension','FStop.php',49],['lib/htmlpurifier/HTMLPurifier/AttrTransform','BoolToCSS.php',24],['lib/horde/framework/Horde/Imap/Client/Ids','Map.php',44],['lib/zend/Zend/Service/Simpy','Tag.php',48],['lib/htmlpurifier/HTMLPurifier/AttrDef','Enum.php',30],['cache/classes','helper.php',90],['lib/zend/Zend/Soap','Wsdl.php',73],['lib/htmlpurifier/HTMLPurifier/Lexer','DOMLex.php',35],['lib/zend/Zend/Validate/Barcode','Code25interleaved.php',53],['webservice/soap','locallib.php',162],['lib/lessphp/Tree','Quoted.php',20],['lib/simplepie/library/SimplePie/Cache','Memcache.php',81],['lib/zend/Zend/Gdata/YouTube','ActivityEntry.php',88],['backup/controller','restore_controller.class.php',63],['backup/controller','restore_controller.class.php',517],['lib/zend/Zend/Service','Audioscrobbler.php',65],['lib/zend/Zend/Service/Flickr','ResultSet.php',82],['lib/mustache/src/Mustache/Logger','StreamLogger.php',44],['lib/zend/Zend/XmlRpc/Request','Stdin.php',47],['lib/zend/Zend/Service/DeveloperGarden/Request/SmsValidation','Validate.php',63],['mod/glossary','locallib.php',481],['lib/google/src/Google/Logger','Abstract.php',121],['lib/horde/framework/Horde/Support','Guid.php',24],['lib/zend/Zend/Http/Client/Adapter','Curl.php',92],['lib/google/src/Google/Service','Oauth2.php',50],['lib/phpmailer','moodle_phpmailer.php',47],['lib/zend/Zend/Validate/Barcode','Intelligentmail.php',47],['repository/skydrive','microsoftliveapi.php',50],['mod/workshop/allocation/manual','lib.php',51],['lib/zend/Zend/Validate/File','Exists.php',62],['lib/xhprof','xhprof_moodle.php',788],['question/classes/bank/search','category_condition.php',60],['lib/markdown','Markdown.php',96],['grade/report/grader','lib.php',104],['lib/zend/Zend/Gdata/YouTube/Extension','Control.php',48],['lib/zend/Zend/Validate','StringLength.php',79],['question/behaviour','behaviourbase.php',50],['backup/cc/cc_lib','cc_converter_forum.php',29],['lib/zend/Zend/Gdata/Photos/Extension','Nickname.php',50],['lib/zend/Zend/Gdata/Exif/Extension','Tags.php',169],['lib/zend/Zend/Uri','Http.php',108],['lib/zend/Zend/Gdata/YouTube/Extension','Hometown.php',44],['cache/stores/file','lib.php',117],['lib/zend/Zend/Service','Amazon.php',75],['lib/htmlpurifier/HTMLPurifier/DefinitionCache','Decorator.php',12],['lib/zend/Zend/Gdata/Media/Extension','MediaThumbnail.php',64],['lib/zend/Zend/Service/Yahoo','Image.php',56],['lib/zend/Zend/Gdata','Feed.php',87],['lib/google/src/Google/Service','Storage.php',54],['backup/cc/cc_lib','cc_asssesment.php',290],['backup/cc/cc_lib','cc_asssesment.php',345],['backup/cc/cc_lib','cc_asssesment.php',364],['backup/cc/cc_lib','cc_asssesment.php',415],['backup/cc/cc_lib','cc_asssesment.php',476],['backup/cc/cc_lib','cc_asssesment.php',486],['backup/cc/cc_lib','cc_asssesment.php',561],['backup/cc/cc_lib','cc_asssesment.php',585],['backup/cc/cc_lib','cc_asssesment.php',635],['backup/cc/cc_lib','cc_asssesment.php',668],['backup/cc/cc_lib','cc_asssesment.php',693],['backup/cc/cc_lib','cc_asssesment.php',788],['backup/cc/cc_lib','cc_asssesment.php',814],['backup/cc/cc_lib','cc_asssesment.php',838],['backup/cc/cc_lib','cc_asssesment.php',965],['backup/cc/cc_lib','cc_asssesment.php',971],['backup/cc/cc_lib','cc_asssesment.php',986],['backup/cc/cc_lib','cc_asssesment.php',1003],['backup/cc/cc_lib','cc_asssesment.php',1017],['backup/cc/cc_lib','cc_asssesment.php',1045],['backup/cc/cc_lib','cc_asssesment.php',1186],['backup/cc/cc_lib','cc_asssesment.php',1263],['backup/cc/cc_lib','cc_asssesment.php',1317],['backup/cc/cc_lib','cc_asssesment.php',1389],['backup/cc/cc_lib','cc_asssesment.php',1451],['backup/cc/cc_lib','cc_asssesment.php',1558],['backup/cc/cc_lib','cc_asssesment.php',1620],['backup/cc/cc_lib','cc_asssesment.php',1648],['backup/cc/cc_lib','cc_asssesment.php',1716],['backup/cc/cc_lib','cc_asssesment.php',2155],['backup/cc/cc_lib','cc_asssesment.php',2264],['backup/cc/cc_lib','cc_asssesment.php',2469],['admin/tool/uploadcourse/classes','course.php',111],['lib/zend/Zend/Gdata/Extension','Where.php',52],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','ListStyle.php',20],['lib/zend/Zend/Service/Amazon','S3.php',102],['lib/horde/framework/Horde/Stream','Existing.php',28],['backup/util/output','output_controller.class.php',44],['backup/cc/cc_lib','cc_version1.php',57],['question/classes/statistics/responses','analysis_for_question.php',58],['lib/zend/Zend/Service/Simpy','Link.php',104],['backup/converter/moodle1','handlerlib.php',120],['backup/converter/moodle1','handlerlib.php',1710],['backup/converter/moodle1','handlerlib.php',1902],['backup/converter/moodle1','handlerlib.php',2155],['cache','lib.php',66],['cache','lib.php',109],['cache','lib.php',138],['cache','lib.php',183],['lib/zend/Zend/Gdata','Calendar.php',77],['lib/zend/Zend/Validate','Date.php',71],['backup/util/structure','base_atom.class.php',41],['backup/util/structure','base_atom.class.php',114],['backup/util/structure','base_atom.class.php',135],['backup/util/structure','base_atom.class.php',156],['lib/xmldb','xmldb_table.php',49],['lib/htmlpurifier/HTMLPurifier','Encoder.php',10],['backup/cc','cc112moodle.php',59],['lib/zend/Zend/XmlRpc/Client','ServerIntrospection.php',43],['lib/zend/Zend/Gdata/Photos','PhotoFeed.php',147],['backup/controller','backup_controller.class.php',68],['backup/controller','backup_controller.class.php',407],['lib','adminlib.php',792],['lib','adminlib.php',1139],['lib','adminlib.php',1213],['lib','adminlib.php',1356],['lib','adminlib.php',1553],['lib','adminlib.php',1925],['lib','adminlib.php',2037],['lib','adminlib.php',2103],['lib','adminlib.php',2204],['lib','adminlib.php',2246],['lib','adminlib.php',2284],['lib','adminlib.php',2372],['lib','adminlib.php',2406],['lib','adminlib.php',2563],['lib','adminlib.php',2648],['lib','adminlib.php',2877],['lib','adminlib.php',3033],['lib','adminlib.php',3175],['lib','adminlib.php',3266],['lib','adminlib.php',3430],['lib','adminlib.php',3510],['lib','adminlib.php',3621],['lib','adminlib.php',3772],['lib','adminlib.php',4001],['lib','adminlib.php',4068],['lib','adminlib.php',4286],['lib','adminlib.php',4315],['lib','adminlib.php',4344],['lib','adminlib.php',4368],['lib','adminlib.php',4398],['lib','adminlib.php',4434],['lib','adminlib.php',4469],['lib','adminlib.php',4501],['lib','adminlib.php',4591],['lib','adminlib.php',4624],['lib','adminlib.php',4680],['lib','adminlib.php',4704],['lib','adminlib.php',4730],['lib','adminlib.php',4753],['lib','adminlib.php',4770],['lib','adminlib.php',4815],['lib','adminlib.php',4878],['lib','adminlib.php',4913],['lib','adminlib.php',4956],['lib','adminlib.php',5039],['lib','adminlib.php',5169],['lib','adminlib.php',5211],['lib','adminlib.php',5256],['lib','adminlib.php',5313],['lib','adminlib.php',5329],['lib','adminlib.php',5385],['lib','adminlib.php',5610],['lib','adminlib.php',5664],['lib','adminlib.php',5718],['lib','adminlib.php',5735],['lib','adminlib.php',5783],['lib','adminlib.php',5825],['lib','adminlib.php',5876],['lib','adminlib.php',5932],['lib','adminlib.php',6161],['lib','adminlib.php',6341],['lib','adminlib.php',6435],['lib','adminlib.php',6582],['lib','adminlib.php',7206],['lib','adminlib.php',7658],['lib','adminlib.php',7841],['lib','adminlib.php',8128],['lib','adminlib.php',8275],['lib','adminlib.php',8435],['lib','adminlib.php',8582],['lib','adminlib.php',8746],['lib','adminlib.php',8939],['lib','adminlib.php',8993],['lib','adminlib.php',9055],['lib','adminlib.php',9100],['mod/workshop/eval/best','lib.php',44],['lib/zend/Zend/Gdata/Calendar','EventQuery.php',91],['lib/zend/Zend/Service/Technorati','TagResult.php',94],['lib/google/src/Google/Cache','Null.php',26],['enrol/flatfile','adminlib.php',35],['lib/phpexcel/PHPExcel/Chart','PlotArea.php',52],['mod/quiz/report/statistics','statistics_question_table.php',49],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','AddConferenceTemplateParticipantRequest.php',53],['mod/data','lib.php',66],['mod/data','lib.php',2164],['mod/data','lib.php',2438],['mod/data','lib.php',2459],['question/classes/statistics/questions','calculated_for_subquestion.php',57],['lib/horde/framework/Horde/Crypt/Blowfish','Base.php',56],['lib/classes/session','memcached.php',51],['lib/google/src/Google/IO','Abstract.php',37],['availability/classes','info_section.php',40],['lib/zend/Zend/Gdata/YouTube/Extension','Books.php',44],['lib/phpexcel/PHPExcel/Shared/JAMA','QRDecomposition.php',48],['lib/filestorage','stored_file.php',63],['grade/report/history/classes/output','tablelog.php',72],['lib/classes','plugin_manager.php',71],['lib/google/src/Google','Model.php',32],['lib/zend/Zend/Gdata/YouTube/Extension','Relationship.php',44],['lib/horde/framework/Horde/Crypt','Blowfish.php',54],['lib/filebrowser','virtual_root_file.php',45],['auth/cas/CAS/CAS','OutOfSequenceBeforeClientException.php',47],['availability/condition/grade/classes','condition.php',46],['lib/phpexcel/PHPExcel/CachedObjectStorage','DiscISAM.php',188],['admin/roles/classes','check_capability_table.php',40],['lib/zend/Zend/Gdata/Media','Entry.php',60],['lib/zend/Zend/Gdata','MimeFile.php',43],['admin/tool/xmldb/actions','XMLDBAction.class.php',56],['backup/cc/cc_lib','cc_resources.php',102],['lib/zend/Zend/Loader/Autoloader','Resource.php',62],['lib/phpexcel/PHPExcel/Worksheet','PageMargins.php',80],['backup/util/xml/parser/processors','simplified_parser_processor.class.php',46],['lib/simplepie/library/SimplePie','IRI.php',252],['lib/htmlpurifier/HTMLPurifier','ContentSets.php',33],['lib/htmlpurifier/HTMLPurifier','HTMLModuleManager.php',68],['lib/htmlpurifier/HTMLPurifier/Token','Comment.php',19],['lib/zend/Zend/Gdata/Calendar/Extension','SendEventNotifications.php',44],['lib/zend/Zend/Service/WindowsAzure/Storage','TableEntity.php',66],['lib/zend/Zend/Service/DeveloperGarden/Request/LocalSearch','LocalSearchRequest.php',60],['mod/quiz/report/overview','overview_table.php',41],['lib/zend/Zend/Gdata/Photos/Extension','Client.php',51],['backup/cc/cc_lib','cc_converters.php',75],['lib/google/src/Google/Service','AdSense.php',68],['lib/zend/Zend/Gdata','Entry.php',48],['lib','filterlib.php',74],['lib','filterlib.php',382],['lib/lessphp/Tree','Alpha.php',13],['lib/zend/Zend/Gdata','DublinCore.php',51],['lib/horde/framework/Horde/Support','Stack.php',18],['lib/lessphp/Tree','Selector.php',31],['lib/zend/Zend/Service','Nirvanix.php',47],['lib/dtl','file_xml_database_importer.php',34],['mod/workshop','mod_form.php',44],['lib/zend/Zend/Service/Technorati','CosmosResultSet.php',73],['lib/horde/framework/Horde/Imap/Client/Data','AclRights.php',39],['lib/zend/Zend/Gdata/YouTube/Extension','Age.php',44],['repository/s3','S3.php',176],['repository/s3','S3.php',1994],['repository/s3','S3.php',2346],['lib/lessphp/Tree','Ruleset.php',45],['lib/zend/Zend/Service/Simpy','NoteSet.php',47],['backup/util/xml/output','xml_output.class.php',52],['backup/util/xml/output','xml_output.class.php',158],['lib/google/src/Google/Service','Pubsub.php',44],['lib/alfresco/Service','Node.php',51],['lib/zend/Zend/Service','Technorati.php',79],['lib/horde/framework/Horde/Imap/Client/Data','BaseSubject.php',39],['admin/tool/monitor/classes','subscription.php',43],['lib/zend/Zend/Gdata/App/Extension','Person.php',61],['backup/moodle2','backup_course_task.class.php',39],['grade/report/singleview/classes/local/ui','text_attribute.php',42],['lib/dml','sqlsrv_native_moodle_recordset.php',40],['lib/zend/Zend/Gdata/YouTube','ContactEntry.php',61],['lib/zend/Zend/Gdata/Extension','AttendeeType.php',44],['lib/htmlpurifier/HTMLPurifier/AttrDef/HTML','Pixels.php',17],['mod/assignment/backup/moodle1','lib.php',223],['lib/zend/Zend/Gdata/Health/Extension','Ccr.php',43],['lib/horde/framework/Horde/Mail/Rfc822','Identification.php',34],['mod/quiz','mod_form.php',48],['backup/util/structure','restore_path_element.class.php',47],['backup/util/structure','restore_path_element.class.php',128],['lib/zend/Zend/Gdata/Calendar','EventFeed.php',55],['lib/zend/Zend/Gdata/Spreadsheets','DocumentQuery.php',57],['availability/tests/fixtures','mock_condition.php',52],['lib/lessphp','Visitor.php',14],['mod/assign/feedback/editpdf/classes','widget.php',53],['lib/minify/lib/Minify/Cache','File.php',9],['lib/zend/Zend/Gdata/Exif','Entry.php',64],['grade/tests','reportlib_test.php',36],['mod/workshop/allocation','lib.php',103],['lib/zend/Zend/Service/WindowsAzure/Storage','BlobInstance.php',57],['lib/zend/Zend/Gdata/Photos/Extension','User.php',50],['admin/tool/uploadcourse/classes','tracker.php',72],['lib/zend/Zend/Service/Technorati','GetInfoResult.php',52],['lib/zend/Zend/Service/WindowsAzure','SessionHandler.php',61],['lib/zend/Zend/Gdata/YouTube/Extension','Hobbies.php',44],['lib/mustache/src/Mustache/Loader','ArrayLoader.php',31],['lib/zend/Zend/Gdata/Photos/Extension','Width.php',50],['admin/roles/classes','view_role_definition_table.php',28],['lib/phpunit/classes','arraydataset.php',45],['lib/horde/framework/Horde/Imap/Client/Data','Sync.php',133],['lib/zend/Zend','Exception.php',34],['backup/util/xml/parser/tests','parser_test.php',797],['lib/zend/Zend/Validate/File','ImageSize.php',113],['lib/zend/Zend/Validate','Alnum.php',65],['lib/zend/Zend/Service/Flickr','Image.php',62],['lib/phpexcel/PHPExcel/Calculation','Function.php',71],['lib/horde/framework/Horde/Support','Inflector.php',115],['lib/horde/framework/Horde/Exception','Pear.php',22],['question/classes/bank','random_question_loader.php',61],['lib/phpexcel/PHPExcel/Reader','HTML.php',104],['lib/mustache/src/Mustache/Loader','InlineLoader.php',57],['lib/zend/Zend/Gdata/Photos/Extension','QuotaLimit.php',51],['admin/tool/uploadcourse/classes','processor.php',122],['lib/zend/Zend/Gdata/Spreadsheets','WorksheetFeed.php',40],['lib/lessphp/Tree','Rule.php',24],['lib/zend/Zend/Service/Amazon','EditorialReview.php',44],['lib/zend/Zend/Service/ReCaptcha','MailHide.php',86],['lib/htmlpurifier/HTMLPurifier/AttrTransform','NameSync.php',11],['lib/classes/progress','display_if_slow.php',60],['availability/condition/group/classes','condition.php',43],['lib/zend/Zend/Gdata/Photos/Extension','Location.php',50],['backup/moodle2','restore_settingslib.php',125],['lib/filebrowser','file_info.php',43],['repository/equella','lib.php',42],['lib/zend/Zend/Http','Client.php',242],['lib/alfresco/Service','ChildAssociation.php',30],['lib/zend/Zend/Gdata/DublinCore/Extension','Subject.php',44],['lib/zend/Zend/Gdata/App/Extension','Category.php',46],['badges/lib','awardlib.php',55],['admin/roles/classes','override_permissions_table_advanced.php',31],['lib/mustache/src/Mustache','Template.php',29],['backup/util/helper','restore_roles_parser_processor.class.php',39],['lib','csslib.php',1501],['lib','csslib.php',1587],['lib','csslib.php',2068],['lib','csslib.php',2136],['lib','csslib.php',2242],['lib/zend/Zend/Service/WindowsAzure/Storage','QueueInstance.php',49],['mod/lti/service/toolproxy/classes/local/service','toolproxy.php',41],['admin/roles/classes','define_role_table_advanced.php',46],['backup/moodle2','restore_section_task.class.php',42],['mod/lti/service/toolsettings/classes/local/resource','contextsettings.php',44],['lib/google/src/Google','Client.php',71],['lib/simplepie/library/SimplePie/Content/Type','Sniffer.php',69],['backup/moodle2','restore_plugin.class.php',43],['lib/simplepie/library/SimplePie','Registry.php',99],['backup/cc','cc2moodle.php',105],['lib/classes/lock','postgres_lock_factory.php',81],['lib/phpexcel/PHPExcel/Shared','XMLWriter.php',56],['lib/htmlpurifier/HTMLPurifier','Length.php',41],['lib/zend/Zend/Validate/File','Count.php',92],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',54],['lib/editor/atto','adminlib.php',109],['lib/google/src/Google/Service','Admin.php',40],['lib/dml','moodle_transaction.php',40],['backup/util/plan','restore_structure_step.class.php',46],['question/engine','questionattempt.php',166],['question/engine','questionattempt.php',1513],['question/engine','questionattempt.php',1599],['question/engine','questionattempt.php',1684],['lib/zend/Zend/Service/Technorati','Weblog.php',152],['lib/zend/Zend/Service/DeveloperGarden/ConferenceCall','ParticipantStatus.php',48],['lib/htmlpurifier/HTMLPurifier/AttrDef','URI.php',23],['backup/util/helper','restore_decode_content.class.php',50],['backup/util/helper','restore_decode_content.class.php',125],['lib/google/src/Google/Cache','File.php',39],['lib/google/src/Google/Http','Request.php',55],['backup/moodle2','backup_block_task.class.php',43],['lib/simplepie/library/SimplePie','Source.php',61],['lib/google/src/Google/Service','Translate.php',40],['availability/classes','capability_checker.php',49],['lib','navigationlib.php',145],['lib','navigationlib.php',1012],['lib','navigationlib.php',2814],['lib','navigationlib.php',3075],['lib','navigationlib.php',3409],['lib','navigationlib.php',4775],['lib','navigationlib.php',4956],['lib/zend/Zend/Gdata/YouTube/Extension','MediaCredit.php',64],['lib/dml','pdo_moodle_database.php',42],['lib/zend/Zend/Gdata/YouTube/Extension','ReleaseDate.php',44],['lib/htmlpurifier/HTMLPurifier/Printer','ConfigForm.php',40],['lib/htmlpurifier/HTMLPurifier/Printer','ConfigForm.php',221],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','NewParticipantRequest.php',53],['lib/zend/Zend/Gdata/Spreadsheets/Extension','RowCount.php',49],['lib/zend/Zend/Validate/File','IsCompressed.php',53],['lib/zend/Zend/Gdata/Photos/Extension','MaxPhotosPerAlbum.php',51],['lib/zend/Zend/Gdata/Extension','When.php',52],['question/classes/bank/search','hidden_condition.php',42],['report/loglive/classes','renderable.php',73],['mod/lti/classes/local/ltiservice','response.php',58],['lib/zend/Zend/Gdata/Extension','Recurrence.php',43],['lib/zend/Zend/Gdata/Books/Extension','BooksLink.php',41],['backup/util/loggers','database_logger.class.php',40],['lib/phpexcel/PHPExcel/CachedObjectStorage','Wincache.php',250],['lib/phpexcel/PHPExcel','HashTable.php',52],['lib/horde/framework/Horde/Imap/Client/Namespace','List.php',34],['lib/htmlpurifier/HTMLPurifier','Zipper.php',25],['lib/classes/update','deployer.php',42],['lib/zend/Zend/Gdata/YouTube','VideoFeed.php',53],['lib/zend/Zend/Service/DeveloperGarden/Request/BaseUserService','GetQuotaInformation.php',40],['lib/minify/lib','CSSmin.php',43],['lib/zend/Zend/Validate/File','Crc32.php',60],['mod/feedback/item','feedback_item_class.php',20],['question/engine/upgrade','upgradelib.php',280],['question/engine/upgrade','upgradelib.php',381],['lib/simplepie/library/SimplePie','Copyright.php',73],['lib/zend/Zend/Gdata/Spreadsheets','SpreadsheetEntry.php',43],['lib/google/src/Google/Service','Dns.php',50],['lib/zend/Zend/Gdata/Gapps','Query.php',57],['lib/zend/Zend/Gdata/YouTube/Extension','School.php',44],['lib/mustache/src/Mustache','HelperCollection.php',19],['mod/assign','gradingtable.php',68],['backup/util/xml/output','file_xml_output.class.php',37],['lib','upgradelib.php',45],['lib','upgradelib.php',61],['lib','upgradelib.php',76],['lib','upgradelib.php',94],['lib','upgradelib.php',111],['lib/zend/Zend/Service','Akismet.php',77],['lib','googleapi.php',52],['lib','googleapi.php',243],['lib/zend/Zend/Service/Yahoo','ResultSet.php',84],['lib/classes/message/inbound','processing_failed_exception.php',36],['lib','portfoliolib.php',101],['lib/lessphp/Tree','Import.php',30],['lib/phpexcel/PHPExcel/Shared/JAMA','SingularValueDecomposition.php',53],['lib/tests/fixtures','test_renderer_factory.php',41],['mod/lesson','editpage_form.php',41],['grade/report','lib.php',156],['lib/zend/Zend/XmlRpc/Request','Http.php',53],['lib/filebrowser','file_info_stored.php',51],['lib/phpexcel/PHPExcel/Style','Protection.php',57],['lib/google/src/Google','Config.php',30],['lib/horde/framework/Horde/Imap/Client/Exception','ServerResponse.php',44],['lib/zend/Zend/Validate','LessThan.php',58],['grade/export','lib.php',60],['lib/zend/Zend/Gdata/YouTube/Extension','PlaylistTitle.php',44],['availability/classes','tree.php',118],['lib/htmlpurifier/HTMLPurifier/Node','Text.php',35],['question/classes/statistics/responses','analysis_for_subpart.php',50],['lib/zend/Zend/Validate','InArray.php',65],['lib/htmlpurifier/HTMLPurifier/AttrDef/CSS','BackgroundPosition.php',57],['lib/zend/Zend/Gdata/Photos/Extension','Height.php',50],['lib/zend/Zend/Gdata/Gapps','Error.php',76],['backup/util/helper','restore_decode_processor.class.php',47],['backup/util/helper','restore_decode_processor.class.php',182],['lib/phpexcel/PHPExcel','Chart.php',150],['lib/google/src/Google/Service','Replicapool.php',48],['lib/zend/Zend/Gdata/Media/Extension','MediaRating.php',49],['lib/zend/Zend/Gdata/YouTube','VideoEntry.php',175],['admin/tool/installaddon/classes','pluginfo_client.php',68],['admin/tool/installaddon/classes','pluginfo_client.php',206],['lib/google/src/Google/Service','Resourceviews.php',54],['admin/tool/log/store/legacy/classes/log','store.php',33],['backup/moodle2','backup_section_task.class.php',40],['lib/phpexcel/PHPExcel/Worksheet','CellIterator.php',68],['question/type/tests','question_first_matching_answer_grading_strategy_test.php',40],['repository/youtube','lib.php',40],['lib/tcpdf/include/barcodes','datamatrix.php',229],['lib/testing/generator','component_generator_base.php',45],['lib/zend/Zend/Gdata/DublinCore/Extension','Format.php',44],['lib','badgeslib.php',133],['admin/tool/installaddon/classes','installer.php',488],['admin/tool/installaddon/classes','installer.php',745],['lib/zend/Zend/XmlRpc','Client.php',122],['lib/mustache/src/Mustache','LambdaHelper.php',24],['admin/roles/classes','permissions_table.php',38],['lib/jabber/XMPP','XMLObj.php',76],['lib','coursecatlib.php',197],['lib','coursecatlib.php',2668],['question/type','edit_question_form.php',96],['lib/zend/Zend/Gdata','MediaMimeStream.php',80],['mod/quiz/report/responses','last_responses_table.php',39],['lib/zend/Zend/Gdata/Photos/Extension','Timestamp.php',51],['lib','setuplib.php',106],['lib','setuplib.php',158],['lib','setuplib.php',174],['lib','setuplib.php',194],['lib','setuplib.php',224],['lib','setuplib.php',246],['lib','setuplib.php',262],['lib','setuplib.php',284],['lib','setuplib.php',303],['lib','setuplib.php',321],['lib/google/src/Google/Cache','Apc.php',35],['mod/lti/service/toolsettings/classes/local/service','toolsettings.php',41],['lib/htmlpurifier/HTMLPurifier','ErrorCollector.php',57],['lib/lessphp/Tree','Unit.php',16],['lib/zend/Zend/Service/DeveloperGarden/Request/VoiceButler','TearDownCall.php',46],['lib/minify/lib/HTTP','ConditionalGet.php',109],['lib/phpexcel/PHPExcel/CachedObjectStorage','SQLite.php',261],['lib/htmlpurifier/HTMLPurifier','Printer.php',21],['lib/zend/Zend/Service/Amazon','CustomerReview.php',69],['lib/zend/Zend/Gdata/YouTube/Extension','QueryString.php',44],['lib/zend/Zend/Gdata/Gapps/Extension','Name.php',65],['mod/assign','adminlib.php',41],['mod/assign','adminlib.php',102],['lib/lessphp/Tree','RulesetCall.php',14],['lib/zend/Zend/Gdata/Extension','Rating.php',49],['repository/alfresco','lib.php',42],['lib/zend/Zend/Service/Technorati','SearchResultSet.php',49],['lib/zend/Zend/Gdata/Photos','UserQuery.php',71],['enrol','renderer.php',426],['enrol','renderer.php',728],['badges/criteria','award_criteria_course.php',47],['lib/zend/Zend/Gdata/Extension','RecurrenceException.php',56],['lib/phpexcel/PHPExcel/Style','Fill.php',89],['lib/zend/Zend/Service/Technorati','TagsResult.php',60],['lib/horde/framework/Horde/Imap/Client/Interaction','Pipeline.php',60],['lib/google/src/Google/Service','Exception.php',12],['lib/zend/Zend/Gdata','Spreadsheets.php',115],['lib/xmldb','xmldb_index.php',56],['question/classes/statistics/responses','analyser.php',69],['lib/htmlpurifier/HTMLPurifier/Node','Comment.php',19],['lib/zend/Zend/Gdata/Photos/Extension','Position.php',50],['lib/google/src/Google/Auth','Simple.php',32],['lib/zend/Zend/Gdata/Geo/Extension','GmlPoint.php',62],['lib/horde/framework/Horde/Crypt/Blowfish/Php','Base.php',318],['lib/horde/framework/Horde/Imap/Client/Cache','Backend.php',33],['lib/zend/Zend/Rest','Route.php',71],['lib/zend/Zend/Service/DeveloperGarden/Request/ConferenceCall','UpdateConferenceTemplateParticipantRequest.php',60],['question','category_class.php',58],['lib/classes/progress','display.php',48],['lib/horde/framework/Horde/Imap/Client/Exception','NoSupportExtension.php',33],['lib/zend/Zend/Gdata/App/Extension','Rights.php',43],['lib/adodb','adodb-active-record.inc.php',113],['lib/horde/framework/Horde/Exception','Wrapped.php',16],['lib/zend/Zend/Validate','NotEmpty.php',77],['question/type/calculated','datasetitems_form.php',72],['lib/horde/framework/Horde/Support','ObjectStub.php',29],['lib/dml','pdo_moodle_recordset.php',41],['backup/cc/cc_lib','cc_converter_folder.php',28],['lib/horde/framework/Horde/Mime','Mail.php',93],['lib/zend/Zend/Gdata/Calendar','ListEntry.php',85],['admin/tool/monitor/classes','rule.php',44],['backup/cc/cc_lib','cc_utils.php',313],['backup/cc/cc_lib','cc_utils.php',381],['backup/cc/cc_lib','cc_utils.php',437],['lib/horde/framework/Horde/Imap/Client/Auth','DigestMD5.php',69],['lib/zend/Zend/Gdata/Geo','Entry.php',55],['lib/zend/Zend/Gdata/YouTube/Extension','Link.php',48],['lib','flickrlib.php',53],['lib/zend/Zend/Gdata/YouTube/Extension','AboutMe.php',44],['lib/zend/Zend/Service/DeveloperGarden','Credential.php',54],['grade/report/overview','lib.php',76],['lib/simplepie/library/SimplePie','File.php',68],['backup/moodle2','backup_plugin.class.php',44],['lib/zend/Zend/Gdata/Extension','ExtendedProperty.php',46],['backup/cc/cc_lib','cc_assesment_sfib.php',27],['rating','lib.php',114],['rating','lib.php',1070],['lib','dtllib.php',66],['lib/horde/framework/Horde/Imap/Client/Cache/Backend','Cache.php',68],['lib/mustache/src/Mustache/Loader','CascadingLoader.php',20],['question/engine','datalib.php',68],['question/engine','datalib.php',1330],['question/engine','datalib.php',1631],['question/engine','datalib.php',1739],['question/engine','datalib.php',1869],['question/engine','datalib.php',1940],['lib/phpexcel/PHPExcel/Shared/trend','bestFitClass.php',405]], 1047],
'instance': ['instance', 'Retrieve sole instance of the registry. ', [['lib/htmlpurifier/HTMLPurifier','URISchemeRegistry.php',9],['lib/classes/update','checker.php',62],['lib/htmlpurifier/HTMLPurifier','EntityLookup.php',29],['lib/classes','useragent.php',101],['backup/cc','validator.php',35],['lib/portfolio','exporter.php',251],['lib/tests','update_deployer_test.php',69],['lib/tests','string_manager_standard_test.php',124],['lib','modinfolib.php',373],['','mdeploy.php',96],['cache','disabledlib.php',171],['cache','disabledlib.php',296],['admin/tool/installaddon/classes','validator.php',85],['cache/classes','config.php',87],['course/format','lib.php',156],['lib','accesslib.php',6184],['lib','accesslib.php',6436],['lib','accesslib.php',6614],['lib','accesslib.php',6868],['lib','accesslib.php',7129],['lib','accesslib.php',7341],['cache','locallib.php',52],['lib/htmlpurifier','HTMLPurifier.php',251],['cache/classes','factory.php',114],['lib/htmlpurifier/HTMLPurifier','LanguageFactory.php',53],['cache/classes','helper.php',76],['lib/htmlpurifier/HTMLPurifier','DefinitionCacheFactory.php',31],['lib/classes','plugin_manager.php',83],['lib','filterlib.php',81],['lib/htmlpurifier/HTMLPurifier','ConfigSchema.php',80],['lib/classes/update','deployer.php',54],['admin/tool/installaddon/classes','pluginfo_client.php',37],['admin/tool/installaddon/classes','installer.php',40],['backup/cc/cc_lib','cc_utils.php',387],['backup/cc/cc_lib','cc_utils.php',443]], 3942],
'get_records_sql': ['get_records_sql', 'Get a number of records as an array of objects using a SQL statement. ', [['lib/dml','pgsql_native_moodle_database.php',732],['lib/dml','oci_native_moodle_database.php',1102],['lib/dml','sqlsrv_native_moodle_database.php',823],['lib/dml','mssql_native_moodle_database.php',741],['lib/dml','mysqli_native_moodle_database.php',1049],['lib/dml/tests','dml_test.php',5424],['lib/dml','pdo_moodle_database.php',308]], 678],
'execute': ['execute', 'Exceptionally override the execute method, so, based in the activity_included setting, we are able to skip the execution of one task completely ', [['backup/moodle2','backup_activity_task.class.php',205],['backup/converter/moodle1','backuplib.php',10],['filter/tex','latex.php',60],['backup/util/plan','base_plan.class.php',158],['mod/lti/service/toolsettings/classes/local/resource','systemsettings.php',61],['mod/lti/service/toolsettings/classes/local/resource','linksettings.php',63],['mod/lti/service/profile/classes/local/resource','profile.php',76],['webservice','lib.php',1772],['lib/classes/task','context_cleanup_task.php',41],['lib/adodb','adodb.inc.php',967],['enrol/imsenterprise/classes/task','cron_task.php',43],['admin/tool/messageinbound/classes/task','cleanup_task.php',47],['lib/classes/task','calendar_cron_task.php',40],['mod/workshop/allocation/random','lib.php',83],['lib/classes/task','registration_cron_task.php',40],['lib/classes/task','portfolio_cron_task.php',40],['lib/htmlpurifier/HTMLPurifier/Strategy','Composite.php',21],['lib/google/src/Google/Http','Batch.php',56],['backup/converter/imscc11','lib.php',85],['lib/classes/task','file_temp_cleanup_task.php',40],['filter/tex','texdebug.php',287],['admin/tool/monitor/classes','notification_task.php',39],['lib/classes/task','stats_cron_task.php',40],['lib/classes/task','backup_cleanup_task.php',40],['admin/tool/log/store/legacy/classes/task','cleanup_task.php',40],['backup/util/ui','backup_ui.class.php',122],['lib/dml','pgsql_native_moodle_database.php',665],['lib/classes/task','messaging_cleanup_task.php',40],['lib/zend/Zend/Service/WindowsAzure/RetryPolicy','RetryN.php',68],['lib/classes/task','session_cleanup_task.php',40],['lib/classes/task','completion_cron_task.php',40],['lib/dml','oci_native_moodle_database.php',1009],['backup/util/plan','base_task.class.php',162],['lib/adodb/drivers','adodb-pdo.inc.php',464],['backup/util/plan','backup_plan.class.php',112],['backup/util/ui','restore_ui.class.php',206],['backup/converter/imscc11','backuplib.php',42],['backup/moodle2','restore_activity_task.class.php',183],['','mdeploy.php',743],['lib/dml','sqlsrv_native_moodle_database.php',745],['lib/htmlpurifier/HTMLPurifier/Strategy','MakeWellFormed.php',66],['lib/google/src/Google/Http','REST.php',28],['admin/tool/langimport/classes/task','update_langpacks_task.php',44],['mod/lti/service/toolproxy/classes/local/resource','toolproxy.php',62],['lib/classes/task','plagiarism_cron_task.php',40],['admin/tool/messageinbound/classes/task','pickup_task.php',47],['backup/util/plan','backup_structure_step.class.php',50],['mod/forum/classes/task','cron_task.php',39],['mod/workshop/allocation/scheduled','lib.php',128],['lib/classes/task','file_trash_cleanup_task.php',40],['backup/util/plan','restore_execution_step.class.php',25],['lib/tests/fixtures','task_fixtures.php',30],['lib/tests/fixtures','task_fixtures.php',39],['lib/tests/fixtures','task_fixtures.php',48],['lib/tests/fixtures','task_fixtures.php',57],['admin/tool/installaddon/classes','validator.php',114],['backup/util/plan','backup_execution_step.class.php',25],['lib/classes/task','password_reset_cleanup_task.php',40],['lib/classes/task','automated_backup_task.php',40],['backup/converter/moodle1','lib.php',142],['lib/htmlpurifier/HTMLPurifier/Strategy','ValidateAttributes.php',16],['lib/classes/task','create_contexts_task.php',40],['backup/util/plan','restore_plan.class.php',159],['backup/converter/imscc1','lib.php',84],['lib/dml','mssql_native_moodle_database.php',662],['admin/tool/log/store/standard/classes/task','cleanup_task.php',40],['lib/classes/task','cache_cleanup_task.php',40],['lib/classes/task','badges_cron_task.php',40],['lib/classes/task','cache_cron_task.php',40],['backup/util/interfaces','executable.class.php',32],['lib/htmlpurifier/HTMLPurifier/Strategy','FixNesting.php',41],['lib/adodb/drivers','adodb-oci8po.inc.php',52],['lib/classes/task','question_cron_task.php',40],['lib/zend/Zend/Service/WindowsAzure/RetryPolicy','NoRetry.php',37],['lib/dml','mysqli_native_moodle_database.php',955],['lib/htmlpurifier/HTMLPurifier/Strategy','RemoveForeignElements.php',20],['backup/util/plan/tests/fixtures','plan_fixtures.php',47],['backup/util/plan/tests/fixtures','plan_fixtures.php',55],['lib/classes/task','events_cron_task.php',40],['lib/classes/task','delete_unconfirmed_users_task.php',40],['lib/adodb/drivers','adodb-oci8.inc.php',786],['backup/converter/imscc1','backuplib.php',10],['lib/classes/task','tag_cron_task.php',40],['lib/classes/task','blog_cron_task.php',40],['lib/classes/task','send_failed_login_notifications_task.php',43],['lib/classes/task','grade_cron_task.php',40],['lib/dml/tests','dml_test.php',5422],['admin/tool/uploadcourse/classes','processor.php',174],['backup/moodle2','restore_section_task.class.php',87],['mod/lti/service/toolsettings/classes/local/resource','contextsettings.php',62],['lib/google/src/Google','Client.php',545],['backup/util/plan','restore_structure_step.class.php',62],['lib/classes/task','legacy_plugin_cron_task.php',42],['lib/dml','pdo_moodle_database.php',226],['lib/classes/task','check_for_updates_task.php',40],['backup/util/helper','restore_decode_processor.class.php',73],['backup/moodle2','backup_section_task.class.php',97],['webservice/amf/testclient','AMFTester.mxml',282],['lib/classes/task','delete_incomplete_users_task.php',40],['mod/assign','adminlib.php',342],['lib/classes/task','send_new_user_passwords_task.php',40],['admin/tool/monitor/classes/task','clean_events.php',41]], 733],
'generate_simple_struct_class': ['generate_simple_struct_class', 'Generate \'struct\'/\'object\' type name Some servers (our Zend ones) parse the phpdoc to know the parameter types. The purpose to this function is to be overwritten when the common object|struct type are not understood by the server. See webservice/soap/locallib.php - the SOAP server requires detailed structure) ', [['webservice','lib.php',1400],['webservice/soap','locallib.php',267]], 1],
'update_ws_authorised_user': ['update_ws_authorised_user', 'Update allowed user settings (ip restriction, valid until...) ', [['webservice','lib.php',239]], 1],
'update_record': ['update_record', 'Update a record in a table ', [['lib/dml','pgsql_native_moodle_database.php',1137],['lib/dml','oci_native_moodle_database.php',1355],['lib/dml','sqlsrv_native_moodle_database.php',1081],['lib/dml','mssql_native_moodle_database.php',1003],['lib/dml','mysqli_native_moodle_database.php',1397],['lib/dml/tests','dml_test.php',5430],['lib/dml','pdo_moodle_database.php',460]], 565],
'close': ['close', 'Close the connection to the server ', [['lib/zend/Zend/Http/Client/Adapter','Socket.php',486],['lib/tests','completionlib_test.php',888],['lib/adodb','adodb.inc.php',2164],['lib/adodb','adodb.inc.php',2844],['lib/adodb','adodb.inc.php',3536],['lib','webdavlib.php',176],['admin/tool/uploaduser','locallib.php',149],['lib/dml','oci_native_moodle_recordset.php',80],['lib/tcpdf','tcpdf.php',2943],['lib/horde/framework/Horde/Imap/Client','Base.php',1846],['lib','excellib.class.php',93],['lib/zend/Zend/Http/Client/Adapter','Test.php',187],['lib/classes/dml','recordset_walk.php',153],['mod/assign/feedback/offline','importgradeslib.php',178],['lib/pear/Net','GeoIP.php',556],['backup/util/helper','backup_array_iterator.class.php',63],['lib/zend/Zend/Gdata/App','LoggingHttpClientAdapterSocket.php',109],['lib/zend/Zend/Http/Client/Adapter','Proxy.php',266],['lib/dml','mssql_native_moodle_recordset.php',87],['lib/pear/Auth','RADIUS.php',542],['lib/pear/Auth','RADIUS.php',703],['lib/pear/Auth','RADIUS.php',824],['lib/phpmailer','class.smtp.php',507],['lib/phpexcel/PHPExcel/Shared','ZipArchive.php',80],['lib/phpunit/classes','event_sink.php',39],['lib/zend/Zend/Http/Client/Adapter','Interface.php',73],['lib/dml','pgsql_native_moodle_recordset.php',104],['auth/fc','fcFPP.php',72],['lib/filestorage','zip_archive.php',183],['lib','odslib.class.php',71],['lib/horde/framework/Horde/Socket','Client.php',135],['question/engine/tests','helpers.php',1225],['grade','lib.php',323],['lib/dml','mysqli_native_moodle_recordset.php',86],['lib','csvlib.class.php',256],['lib/google/src/Google/Logger','File.php',130],['lib/horde/framework/Horde','Stream.php',585],['lib/phpunit/classes','phpmailer_sink.php',41],['lib/phpunit/classes','message_sink.php',39],['lib/zend/Zend/Http/Client/Adapter','Curl.php',460],['lib/dml','sqlsrv_native_moodle_recordset.php',133],['lib/zend/Zend/Service/WindowsAzure','SessionHandler.php',109],['backup/util/helper','backup_null_iterator.class.php',53],['grade/export','lib.php',662],['lib/dml','pdo_moodle_recordset.php',79]], 1036],
'get_created_by_user_ws_token': ['get_created_by_user_ws_token', 'Return a token that has been created by the user (i.e. to created by an admin) If no tokens exist an exception is thrown ', [['webservice','lib.php',373]], 2],
'send_error': ['send_error', 'Send the error information to the WS client formatted as XML document. ', [['webservice','lib.php',1535],['webservice/rest','locallib.php',132],['webservice/soap','locallib.php',236]], 3],
'get_in_or_equal': ['get_in_or_equal', 'Constructs \'IN()\' or \'=\' sql fragment ', [['lib/dml','oci_native_moodle_database.php',1583],['lib/dml','moodle_database.php',678]], 375],
'update_external_service': ['update_external_service', 'Update a service It modifies the timemodified automatically. ', [['webservice','lib.php',689]], 3],
'get_external_service_by_shortname': ['get_external_service_by_shortname', 'Get an external service for a given shortname ', [['webservice','lib.php',633]], 3],
'setclass': ['setclass', 'Set callback class ', [['lib/zend/Zend/Server/Method','Callback.php',89],['lib/zend/Zend/Soap','Server.php',536],['lib/zend/Zend/Amf','Server.php',711],['lib/zend/Zend/Rest','Server.php',291],['lib/zend/Zend/Soap','AutoDiscover.php',260],['lib/zend/Zend/XmlRpc','Server.php',257],['lib/zend/Zend/Server','Interface.php',46]], 6],
'init_service_class': ['init_service_class', 'Load virtual class needed for Zend api ', [['webservice','lib.php',1189],['webservice/amf','locallib.php',70]], 2],
'delete_records': ['delete_records', 'Delete the records from a table where all the given conditions met. If conditions not specified, table is truncated. ', [['lib/dml','moodle_database.php',1815],['lib/dml','sqlite3_pdo_moodle_database.php',337]], 778],
'generate_user_ws_tokens': ['generate_user_ws_tokens', 'Generate all tokens of a specific user ', [['webservice','lib.php',295]], 1],
'getremoteaddr': ['getremoteaddr', 'Returns most reliable client address ', [['lib','moodlelib.php',8281]], 62],
'get_external_functions': ['get_external_functions', 'Get the functions list of a service list (by id) ', [['webservice','lib.php',449]], 4],
'get_user_ws_tokens': ['get_user_ws_tokens', 'Return all tokens of a specific user + the service state (enabled/disabled) + the authorised user mode (restricted/not restricted) ', [['webservice','lib.php',352]], 1],
'remove_external_function_from_service': ['remove_external_function_from_service', 'Remove a function from a service ', [['webservice','lib.php',716]], 1],
'explode': ['explode', '', [], 1599],
'is_array': ['is_array', '', [], 1820],
'class_exists': ['class_exists', '', [], 273],
'trim': ['trim', '', [], 1889],
'in_array': ['in_array', '', [], 1173],
'call_user_func_array': ['call_user_func_array', '', [], 101],
'time': ['time', '', [], 1768],
'implode': ['implode', '', [], 1259],
'array_key_exists': ['array_key_exists', '', [], 1539],
'array_search': ['array_search', '', [], 188],
'is_null': ['is_null', '', [], 1992],
'set_exception_handler': ['set_exception_handler', '', [], 8],
'uniqid': ['uniqid', '', [], 74],
'array_merge': ['array_merge', '', [], 2320],
'gmdate': ['gmdate', '', [], 145],
'array_values': ['array_values', '', [], 283],
'intval': ['intval', '', [], 484],
'call_user_func': ['call_user_func', '', [], 126],
'define': ['define', '', [], 2170],
'is_object': ['is_object', '', [], 508],
'rand': ['rand', '', [], 107],
'header': ['header', '', [], 1294]};
CLASS_DATA={
'webservice_login_failed': ['webservice_login_failed', 'Web service login failed event class. ', [['lib/classes/event','webservice_login_failed.php',28]], 16],
'context_system': ['context_system', 'System context class ', [['lib','accesslib.php',6106]], 929],
'manager': ['manager', 'Defines MAnager class for myprofile navigation tree. ', [['user/classes/output/myprofile','manager.php',28],['lib/classes/log','manager.php',29],['admin/tool/messageinbound/classes','manager.php',29],['lib/classes/message','manager.php',31],['lib/classes/message/inbound','manager.php',29],['admin/tool/log/classes/log','manager.php',29],['lib/classes/session','manager.php',29],['lib/classes/task','manager.php',28],['lib/classes/event','manager.php',30]], 346],
'coding_exception': ['coding_exception', 'Exception indicating programming error, must be fixed by a programer. For example a core API might throw this type of exception if a plugin calls it incorrectly. ', [['lib','setuplib.php',214]], 867],
'external_api': ['external_api', 'Base class for external api methods. ', [['lib','externallib.php',139]], 302],
'invalid_parameter_exception': ['invalid_parameter_exception', 'Exception indicating malformed parameter problem. This exception is not supposed to be thrown when processing user submitted data in forms. It is more suitable for WS and other low level stuff. ', [['lib','setuplib.php',234]], 58],
'webservice_server_interface': ['webservice_server_interface', 'Mandatory interface for all web service protocol classes ', [['webservice','lib.php',793]], 1],
'webservice_test_client_interface': ['webservice_test_client_interface', 'Mandatory interface for all test client classes. ', [['webservice','lib.php',773]], 3],
'webservice_access_exception': ['webservice_access_exception', 'Exception indicating access control problem in web service call This exception should return general errors about web service setup. Errors related to the user like wrong username/password should not use it, you should not use this exception if you want to let the client implement some code logic against an access error. ', [['webservice','lib.php',732]], 24],
'external_settings': ['external_settings', 'Singleton to handle the external settings. ', [['lib','externallib.php',755]], 3],
'webservice_function_called': ['webservice_function_called', 'Web service function called event class. ', [['lib/classes/event','webservice_function_called.php',28]], 3],
'moodle_exception': ['moodle_exception', 'Base Moodle Exception class ', [['lib','setuplib.php',68]], 478],
'webservice': ['webservice', 'General web service library ', [['webservice','lib.php',43],['lib/classes/plugininfo','webservice.php',30]], 14]};
CONST_DATA={
'PARAM_INT': ['PARAM_INT', '', [['lib','moodlelib.php',156]], 2948],
'VALUE_OPTIONAL': ['VALUE_OPTIONAL', '', [['lib','moodlelib.php',337]], 409],
'PARAM_FLOAT': ['PARAM_FLOAT', '', [['lib','moodlelib.php',146]], 93],
'IGNORE_MISSING': ['IGNORE_MISSING', '', [['lib','dmllib.php',48]], 204],
'SITEID': ['SITEID', '', [['admin/cli','install.php',217],['','install.php',244],['lib/db','install.php',87],['lib','setup.php',748]], 612],
'WEBSERVICE_AUTHMETHOD_USERNAME': ['WEBSERVICE_AUTHMETHOD_USERNAME', '', [['webservice','lib.php',31]], 11],
'EXTERNAL_TOKEN_PERMANENT': ['EXTERNAL_TOKEN_PERMANENT', '', [['lib','moodlelib.php',461]], 11],
'EXTERNAL_TOKEN_EMBEDDED': ['EXTERNAL_TOKEN_EMBEDDED', '', [['lib','moodlelib.php',469]], 6],
'MEMORY_EXTRA': ['MEMORY_EXTRA', '', [['lib','setuplib.php',50]], 37],
'NO_MOODLE_COOKIES': ['NO_MOODLE_COOKIES', '', [['theme','javascript.php',83],['login','token.php',26],['mod/lti','service.php',27],['filter/algebra','pix.php',8],['','help.php',29],['mod/lti','services.php',27],['mod/chat/gui_header_js','chatinput.php',17],['theme','font.php',124],['user','grouppix.php',30],['grade/import/xml','fetch.php',18],['grade/export/xls','dump.php',18],['mod/data','css.php',26],['lib/editor/tinymce','all_strings.php',25],['mod/data','js.php',26],['filter/tex','pix.php',8],['theme','image.php',127],['filter/tex','displaytex.php',28],['auth/ldap','ntlmsso_magic.php',7],['','help_ajax.php',26],['rss','file.php',34],['theme','styles.php',112],['mnet/xmlrpc','server.php',16],['mod/chat/gui_sockets','chatinput.php',17],['badges','assertion.php',28],['mod/chat/gui_header_js','users.php',17],['mod/chat/gui_header_js','jsupdated.php',33],['mod/assign/feedback/editpdf','ajax_progress.php',28],['theme','styles_debug.php',29],['lib/editor/tinymce/plugins/moodleemoticon','dialog.php',25],['webservice','pluginfile.php',34],['grade/export/ods','dump.php',18],['lib','setup.php',753],['lib','setup.php',757],['lib','setup.php',762],['lib','setup.php',765],['lib','setup.php',767],['mod/chat/gui_header_js','jsupdate.php',17],['webservice','upload.php',45],['grade/export/xml','dump.php',18],['lib/editor/tinymce/plugins','loader.php',32],['lib','setuplib.php',831],['grade/export/txt','dump.php',18]], 51],
'MUST_EXIST': ['MUST_EXIST', '', [['lib','dmllib.php',52]], 1252],
'WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN': ['WEBSERVICE_AUTHMETHOD_PERMANENT_TOKEN', '', [['webservice','lib.php',36]], 7],
'WEBSERVICE_AUTHMETHOD_SESSION_TOKEN': ['WEBSERVICE_AUTHMETHOD_SESSION_TOKEN', '', [['webservice','lib.php',41]], 2],
'PARAM_BOOL': ['PARAM_BOOL', '', [['lib','moodlelib.php',108]], 502],
'CAP_ALLOW': ['CAP_ALLOW', '', [['lib','accesslib.php',135]], 1292],
'VALUE_DEFAULT': ['VALUE_DEFAULT', '', [['lib','moodlelib.php',342]], 129]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Thu May 28 19:17:31 2015</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
